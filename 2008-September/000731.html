<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1301 - in trunk: data	data/levels/enigma_experimental data/levels/lib data/schemas	src src/stones
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2008-September/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1301%20-%20in%20trunk%3A%20data%0A%09data/levels/enigma_experimental%20data/levels/lib%20data/schemas%0A%09src%20src/stones&In-Reply-To=%3C200809041150.m84BoliT020923%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000730.html">
   <LINK REL="Next"  HREF="000732.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1301 - in trunk: data	data/levels/enigma_experimental data/levels/lib data/schemas	src src/stones</H1>
    <B>andreasl at mail.berlios.de</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1301%20-%20in%20trunk%3A%20data%0A%09data/levels/enigma_experimental%20data/levels/lib%20data/schemas%0A%09src%20src/stones&In-Reply-To=%3C200809041150.m84BoliT020923%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1301 - in trunk: data	data/levels/enigma_experimental data/levels/lib data/schemas	src src/stones">andreasl at mail.berlios.de
       </A><BR>
    <I>Thu Sep  4 13:50:47 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000730.html">[Enigma-game-svn] r1300 - homepage/input
</A></li>
        <LI>Next message: <A HREF="000732.html">[Enigma-game-svn] r1302 - team_levelpacks/team_test_new_api
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#731">[ date ]</a>
              <a href="thread.html#731">[ thread ]</a>
              <a href="subject.html#731">[ subject ]</a>
              <a href="author.html#731">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: andreasl
Date: 2008-09-04 13:50:38 +0200 (Thu, 04 Sep 2008)
New Revision: 1301

Modified:
   trunk/data/api2init.lua
   trunk/data/levels/enigma_experimental/test_libsoko.xml
   trunk/data/levels/lib/liblua.xml
   trunk/data/levels/lib/libmap.xml
   trunk/data/levels/lib/libsoko-designlist.xml
   trunk/data/levels/lib/libsoko-endphase.xml
   trunk/data/levels/lib/libsoko.xml
   trunk/data/schemas/objects.xml
   trunk/src/stones.cc
   trunk/src/stones/BoulderStone.cc
   trunk/src/stones/LightPassengerStone.cc
   trunk/src/stones/PullStone.cc
   trunk/src/stones/RotatorStone.cc
   trunk/src/stones/RubberbandStone.cc
   trunk/src/stones/ShogunStone.cc
   trunk/src/stones/SwapStone.cc
   trunk/src/stones/Turnstile.cc
Log:
Trunk:
 - Adapt/repair liksoko (part I)
    - Switch to API 2.
    - Switch to current naming of objects.
    - Use of positions instead of coordinates, where feasible.
    - For endphase &quot;knock&quot; no item below the doors are neccessary
      anymore.
    - Repair freeze-checks, allowing attribute &quot;freeze_check&quot;
      for all stones.
    - Repair friction/adhesion-attributes.
    - Harden several stones against segfaults by self-induced
      kills (currently neccessary for libsoko for shogun stones,
      but did it for other stones as well).
    - Reduce magnet strength.
    - Adapt test level enigma_experimental/test_libsoko
 - libmap:
    - Fix libmap.sub.
    - Fix recognition of maps in api2init.
 - liblua:
    - lib.lua.print_table now recognizes positions and objects.
Note:
 - There is no resolver defined for Sokobans.
Todo:
 - Further beautifications, like use of groups.
 - Switch to namespace lib.soko.*.
 - Finetuning of designs.
 - Refman.


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/api2init.lua	2008-09-04 11:50:38 UTC (rev 1301)
@@ -181,11 +181,11 @@
         local ignore = ignorearg
         local map = maparg
         local readdir = readarg or MAP_IDENT
-        if (ignorearg.type == &quot;map&quot;) then
+        if (type(ignore) == &quot;table&quot;) and (type(ignore.defaultkey) == &quot;string&quot;) then
             map = ignorearg
             ignore = map.defaultkey
             readdir = maparg or MAP_IDENT
-        elseif     (type(map.defaultkey) == &quot;string&quot;)
+        elseif (type(map) == &quot;table&quot;) and (type(map.defaultkey) == &quot;string&quot;)
                and (string.len(map.defaultkey) ~= string.len(ignore)) then
             error(&quot;drawmap: Ignore key and default key differ in length.&quot;, 2)
         end

Modified: trunk/data/levels/enigma_experimental/test_libsoko.xml
===================================================================
--- trunk/data/levels/enigma_experimental/test_libsoko.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/levels/enigma_experimental/test_libsoko.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -3,12 +3,13 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;level&quot;&gt;
       &lt;el:identity el:title=&quot;Libsoko - Test&quot; el:subtitle=&quot;&quot; el:id=&quot;test_libsoko&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;2&quot; el:status=&quot;experimental&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;3&quot; el:status=&quot;experimental&quot;/&gt;
       &lt;el:author el:name=&quot;Andreas Lochmann&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2007 Andreas Lochmann&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
-      &lt;el:compatibility el:enigma=&quot;1.00&quot;&gt;
+      &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
         &lt;el:dependency el:path=&quot;lib/libsoko&quot; el:id=&quot;lib/libsoko&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
+        &lt;el:dependency el:path=&quot;lib/liblua&quot; el:id=&quot;lib/liblua&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:score el:easy=&quot;-&quot; el:difficult=&quot;-&quot;/&gt;
@@ -314,15 +315,15 @@
 design_min = 1 --76
 design_max = table.getn(design_list)
 
-design_number = design_max
+design_number = 77 --design_max
 
 --create_sokoball(multilevel2, 1, 1)
 create_sokoball(multilevel2, 13, design_number)
 --create_sokoball(chessoban, 2)
 --draw_sokoball(0, 0, chessoban, 2, nil, true) --leftending)
-set_stone(&quot;st-switch&quot;, 9, 1, {action=&quot;callback&quot;, target=&quot;design_minus_one&quot;})
-set_stone(&quot;st-switch&quot;, 10, 1, {action=&quot;callback&quot;, target=&quot;design_plus_one&quot;})
-design_statistics()
+wo[{9,1}] = {&quot;st_switch&quot;, target=&quot;design_minus_one&quot;}
+wo[{10,1}] = {&quot;st_switch&quot;, target=&quot;design_plus_one&quot;}
+--design_statistics()
 
 function leftending(nr)
   if nr == 2 then
@@ -339,8 +340,8 @@
     design_number = design_max
   end
   recreate_sokoball(design_number)
-  set_stone(&quot;st-switch&quot;, 9, 1, {action=&quot;callback&quot;, target=&quot;design_minus_one&quot;})
-  set_stone(&quot;st-switch&quot;, 10, 1, {action=&quot;callback&quot;, target=&quot;design_plus_one&quot;})
+  wo[{9,1}] = {&quot;st_switch&quot;, target=&quot;design_minus_one&quot;}
+  wo[{10,1}] = {&quot;st_switch&quot;, target=&quot;design_plus_one&quot;}
 end
 function design_plus_one()
   design_number = design_number + 1
@@ -348,11 +349,10 @@
     design_number = design_min
   end
   recreate_sokoball(design_number)
-  set_stone(&quot;st-switch&quot;, 9, 1, {action=&quot;callback&quot;, target=&quot;design_minus_one&quot;})
-  set_stone(&quot;st-switch&quot;, 10, 1, {action=&quot;callback&quot;, target=&quot;design_plus_one&quot;})
+  wo[{9,1}] = {&quot;st_switch&quot;, target=&quot;design_minus_one&quot;}
+  wo[{10,1}] = {&quot;st_switch&quot;, target=&quot;design_plus_one&quot;}
 end
 
-
     ]]&gt;&lt;/el:luamain&gt;
     &lt;el:i18n&gt;
       &lt;el:string el:key=&quot;title&quot;&gt;

Modified: trunk/data/levels/lib/liblua.xml
===================================================================
--- trunk/data/levels/lib/liblua.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/levels/lib/liblua.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -124,7 +124,7 @@
     if type(value) == &quot;number&quot; then
       print((prefix or &quot;&quot;) .. &quot;|&quot; .. key_s .. &quot; = &quot; .. value)
     elseif type(value) == &quot;string&quot; then
-      print((prefix or &quot;&quot;).. &quot;|&quot; .. key_s .. &quot; = \&quot;&quot; .. value .. &quot;\&quot;&quot;)
+      print((prefix or &quot;&quot;) .. &quot;|&quot; .. key_s .. &quot; = \&quot;&quot; .. value .. &quot;\&quot;&quot;)
     elseif type(value) == &quot;table&quot; then
       if (depth or 0) &lt; 5 then
         print((prefix or &quot;&quot;) .. &quot;|&quot; .. key_s .. &quot; = |&quot;)
@@ -135,8 +135,15 @@
       else
         print((prefix or &quot;&quot;) .. &quot;|&quot; .. key_s .. &quot; = | ...&quot;)
       end
+    elseif (type(value) == &quot;userdata&quot;) and (usertype(value) == &quot;position&quot;) then
+      print((prefix or &quot;&quot;) .. &quot;|&quot; .. key_s .. &quot; = position &quot; .. value.x
+            .. &quot;/&quot; .. value.y)
+    elseif (type(value) == &quot;userdata&quot;) and (usertype(value) == &quot;object&quot;) then
+      print((prefix or &quot;&quot;) .. &quot;|&quot; .. key_s .. &quot; = object of name '&quot;
+            .. (value.name or &quot;&quot;) .. &quot;'&quot;)
     else
-      print((prefix or &quot;&quot;).. &quot;|&quot; .. key_s .. &quot; of type &quot; .. type(value))
+      print((prefix or &quot;&quot;) .. &quot;|&quot; .. key_s .. &quot; of type &quot; .. type(value)
+            .. &quot; (usertype '&quot; .. usertype(value) .. &quot;')&quot;)
     end
   end
 end

Modified: trunk/data/levels/lib/libmap.xml
===================================================================
--- trunk/data/levels/lib/libmap.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/levels/lib/libmap.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -141,17 +141,17 @@
   if (type(map) ~= &quot;table&quot;) or (map.type ~= &quot;map&quot;) then
     error(&quot;lib.map.sub: Can only work on maps.&quot;, 2)
   end
-  local pos1, pos2 = arg1, arg2
-  if type(arg2) == &quot;number&quot; and type(arg3) == &quot;number&quot; then
-    -- arg2 and arg3 are width and height
-    pos2 = po(pos1.x + arg2 - 1, pos1.y + arg3 - 1)
-  end
-  if type(pos1) == &quot;table&quot; then
+  local pos1, pos2 = origin, arg2
+  if (type(pos1) == &quot;table&quot;) or (usertype(pos1) == &quot;object&quot;) then
     pos1 = po(pos1)
   end
-  if type(pos2) == &quot;table&quot; then
+  if (type(pos2) == &quot;table&quot;) or (usertype(pos2) == &quot;object&quot;) then
     pos2 = po(pos2)
   end
+  if type(arg2) == &quot;number&quot; and type(arg3) == &quot;number&quot; then
+    -- arg2 and arg3 are width and height
+    pos2 = po(pos1.x + arg2 - 1, pos1.y + arg3 - 1)
+  end
   pos1 = pos1:grid()
   pos2 = pos2:grid()
   if (pos2.x &lt; pos1.x) or (pos2.y &lt; pos1.y) then
@@ -159,11 +159,11 @@
         .. &quot;is not top left-hand corner).&quot;, 2)
   end
   local result = {}
-  for y = pos1.y, pos2.y do
+  local kl = map.keylength
+  for y = pos1.y + 1, pos2.y + 1 do
     if y &lt; map.height then
-      result[y] = string.sub(rawget(map, y) or &quot;&quot;,
-                    pos1.x * map.keylength + 1,
-                    (pos2.x + 1) * map.keylength) or &quot;&quot;
+      result[y-pos1.y] = string.sub(rawget(map, y) or &quot;&quot;,
+                             pos1.x * kl + 1, (pos2.x + 1) * kl) or &quot;&quot;
     end
   end
   return wo:newMap(map.defaultkey, result)  
@@ -179,7 +179,6 @@
   if (usertype(posarg) == &quot;object&quot;) or (usertype(posarg) == &quot;position&quot;) then
     local kl = rawget(map2, &quot;__keylength&quot;)
     local dk = rawget(map2, &quot;__defaultkey&quot;)
-    print(posarg.x..&quot;, &quot;..posarg.y)
     for y = 1, map2.height do
       local line = rawget(map2, y)
       for x = 1, map2.width do

Modified: trunk/data/levels/lib/libsoko-designlist.xml
===================================================================
--- trunk/data/levels/lib/libsoko-designlist.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/levels/lib/libsoko-designlist.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -3,11 +3,11 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;library&quot;&gt;
       &lt;el:identity el:title=&quot;&quot; el:id=&quot;lib/libsoko-designlist&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;1&quot; el:status=&quot;experimental&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;2&quot; el:status=&quot;experimental&quot;/&gt;
       &lt;el:author el:name=&quot;Enigma Team&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
-      &lt;el:copyright&gt;Copyright &#169; 2007 Enigma Team&lt;/el:copyright&gt;
+      &lt;el:copyright&gt;Copyright &#169; 2007, 2008 Enigma Team&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
-      &lt;el:compatibility el:enigma=&quot;1.00&quot;&gt;
+      &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;false&quot; el:single=&quot;false&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:comments&gt;
@@ -34,13 +34,13 @@
 -- If object types (like floors) repeat in the table, they are used in
 -- a checkerboard pattern. You can change this pattern by adding an
 -- element of the form &quot;al:ALGORITHM&quot;, where ALGORITHM is one of the
--- algorithms listed below. Same for &quot;fr:1.23&quot; and &quot;mf:4.5&quot; for friction
+-- algorithms listed below. Same for &quot;fr:1.23&quot; and &quot;ad:4.5&quot; for friction
 -- and mouseforce. From all these attributes, only the last one will
 -- be used, all others ignored. This contrasts with the situation of
--- the gaming objects (&quot;fl-&quot;, &quot;st-&quot;, &quot;it-&quot;), whose order doesn't matter.
+-- the gaming objects (&quot;fl_&quot;, &quot;st_&quot;, &quot;it_&quot;), whose order doesn't matter.
 --
 -- &quot;oxyd&quot; only holds the oxyd's flavor, &quot;endp&quot; the way of resolving the
--- level from Sokoban to opening oxyds. Use &quot;st-none&quot; and &quot;it-none&quot; to
+-- level from Sokoban to opening oxyds. Use &quot;st_nil&quot; and &quot;it_nil&quot; to
 -- place spaces between stones/items.
 --
 -- The table might hold additional flags. Currently, only &quot;white&quot;
@@ -53,17 +53,17 @@
 --   [5] = { outf = &quot;fl-leaves&quot;, inf = &quot;fl-leavesb&quot;, box = &quot;st-wood&quot;
 --           wall = {&quot;st-glass&quot;, &quot;fl-wood&quot;, &quot;fl-leaves&quot;, &quot;al:random&quot;},
 --           oxyd = &quot;a&quot;, white = true,
---           endp = {goal = {&quot;fl-abyss&quot;, &quot;it-none&quot;}, give = &quot;it-hammer&quot;,
+--           endp = {goal = {&quot;fl-abyss&quot;, &quot;it_nil&quot;}, give = &quot;it_hammer&quot;,
 --                   alg = &quot;block:st-break_acwhite&quot;}}
 --
 --   will define design 5. The walls will alternate between
 --   st-glass/fl-wood and st-glass/fl-leaves. The goal will be
---   it-trigger by default. The actor will be ac-whiteball.
+--   it_trigger by default. The actor will be ac-whiteball.
 --   The boxes will be &quot;st-wood&quot;. There will be oxyds visible
 --   from the beginning, but they are blocked by st-break_acwhite.
 --   When all goals are filled, the st-wood are removed by setting
 --   fl-abyss (by which they become fl-stwood), the goal-item is
---   removed. The player is finally given an it-hammer.
+--   removed. The player is finally given an it_hammer.
 --
 -- Possible flags:
 --
@@ -96,7 +96,7 @@
    inf = { &quot;fl-wood&quot; },
   outf = { &quot;fl-water&quot; },
    box = { &quot;st-brownie&quot; },
-  goal = { &quot;it-trigger&quot; },
+  goal = { &quot;it_trigger&quot; },
   oxyd = &quot;a&quot;,
   endp = { alg = &quot;circle&quot; },
   outf_default_stone = &quot;st-invisible&quot;
@@ -105,7 +105,7 @@
 -- outf_default_stone has the following meaning: When outf is drawn
 -- by set_element, but no stone is set, outf_default_stone is used
 -- instead. You can suppress this behaviour by explicitly setting
--- outf = { &quot;fl-myfloor&quot;, &quot;st-none&quot; }.
+-- outf = { &quot;fl-myfloor&quot;, &quot;st_nil&quot; }.
 -- This is done to avoid a chess-stone from jumping into the void,
 -- as a present to the gamer.
 
@@ -116,510 +116,510 @@
 
 -- Ralf's designs
 [1]={box=&quot;st-brownie&quot;, wall=&quot;st-bluegray&quot;, inf=&quot;fl-bluegray&quot;,
-     outf=&quot;fl-space&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-     endp={goal=&quot;st-none&quot;, alg=&quot;circle&quot;}},
+     outf=&quot;fl-space&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+     endp={goal=&quot;st_nil&quot;, alg=&quot;circle&quot;}},
 [2]={box=&quot;st-glass_move&quot;, wall=&quot;st-bluegray&quot;, inf=&quot;fl-bluegray&quot;,
-     outf=&quot;fl-water&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;a&quot;,
+     outf=&quot;fl-water&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;a&quot;,
      endp={goal=&quot;st-glass1_hole&quot;, alg=&quot;ralf&quot;}},
 [3]={box=&quot;st-wood-growing&quot;, wall=&quot;st-bluegray&quot;, inf=&quot;fl-bluegray&quot;,
-     outf=&quot;fl-abyss&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;a&quot;,
-     endp={goal={&quot;st-none&quot;, &quot;fl-stwood&quot;, &quot;it-none&quot;}, wall=&quot;st-thief&quot;, give=&quot;it-hammer&quot;,
+     outf=&quot;fl-abyss&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;a&quot;,
+     endp={goal={&quot;st_nil&quot;, &quot;fl-stwood&quot;, &quot;it_nil&quot;}, wall=&quot;st-thief&quot;, give=&quot;it_hammer&quot;,
            alg=&quot;block:st-plain_cracked&quot;}},
 [4]={box=&quot;st-brownie&quot;, wall=&quot;st-bluegray&quot;, inf=&quot;fl-white&quot;,
-     outf=&quot;fl-sahara&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;c&quot;,
-     endp={goal=&quot;st-none&quot;, wall={&quot;st-none&quot;, &quot;fl-bluegray&quot;}, alg=&quot;outside&quot;}},
+     outf=&quot;fl-sahara&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;c&quot;,
+     endp={goal=&quot;st_nil&quot;, wall={&quot;st_nil&quot;, &quot;fl-bluegray&quot;}, alg=&quot;outside&quot;}},
 [5]={box=&quot;st-wood&quot;, wall=&quot;st-bluegray&quot;, inf=&quot;fl-white&quot;,
-     outf=&quot;fl-space&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;c&quot;,
-     endp={goal={&quot;st-none&quot;, &quot;fl-stwood&quot;, &quot;it-none&quot;}, wall={&quot;st-bluegray_hole&quot;}, alg=&quot;outside:3&quot;}},
+     outf=&quot;fl-space&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;c&quot;,
+     endp={goal={&quot;st_nil&quot;, &quot;fl-stwood&quot;, &quot;it_nil&quot;}, wall={&quot;st-bluegray_hole&quot;}, alg=&quot;outside:3&quot;}},
 [6]={box=&quot;st-greenbrown_move&quot;, wall=&quot;st-bluegray&quot;, inf=&quot;fl-white&quot;,
-     outf=&quot;fl-space&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;c&quot;,
-     endp={goal=&quot;st-greenbrown_hole&quot;, wall=&quot;st-thief&quot;, give=&quot;it-sword&quot;,
-           alg=&quot;block:st-knight&quot;}},
+     outf=&quot;fl-space&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;c&quot;,
+     endp={goal=&quot;st-greenbrown_hole&quot;, wall=&quot;st-thief&quot;, give=&quot;it_sword&quot;,
+           alg=&quot;block:st_knight&quot;}},
 [7]={box=&quot;st-wood&quot;, wall=&quot;st-bluegray&quot;, inf=&quot;fl-white&quot;,
-     outf=&quot;fl-space&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;c&quot;,
-     endp={goal={&quot;st-none&quot;, &quot;fl-stwood&quot;, &quot;it-none&quot;}, alg=&quot;fourswitch&quot;}},
+     outf=&quot;fl-space&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;c&quot;,
+     endp={goal={&quot;st_nil&quot;, &quot;fl-stwood&quot;, &quot;it_nil&quot;}, alg=&quot;fourswitch&quot;}},
 
-[8]={box=&quot;st-rock3_move&quot;, wall=&quot;st-blue-sand&quot;, inf=&quot;fl-light&quot;,
-     outf=&quot;fl-rough-blue&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;d&quot;,
-     endp={goal=&quot;st-rock3_break&quot;, give=&quot;it-hammer&quot;, alg=&quot;ralf&quot;}},
-[9]={box=&quot;st-block&quot;, wall=&quot;st-blue-sand&quot;, inf=&quot;fl-light&quot;,
-     outf=&quot;fl-rough-blue&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;d&quot;,
-     endp={goal=&quot;st-none&quot;, alg=&quot;circle&quot;}},
-[10]={box=&quot;st-shogun&quot;, wall=&quot;st-blue-sand&quot;, inf=&quot;fl-rough&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it-shogun-s&quot;,
-      endp={goal=&quot;st-none&quot;, alg=&quot;magnets&quot;}},
-[11]={box=&quot;st-marble_move&quot;, wall=&quot;st-blue-sand&quot;, inf=&quot;fl-rough&quot;,
-      outf=&quot;fl-abyss&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;b&quot;,
+[8]={box=&quot;st-rock3_move&quot;, wall=&quot;st_bluesand&quot;, inf=&quot;fl-light&quot;,
+     outf=&quot;fl-rough-blue&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;d&quot;,
+     endp={goal=&quot;st-rock3_break&quot;, give=&quot;it_hammer&quot;, alg=&quot;ralf&quot;}},
+[9]={box=&quot;st-block&quot;, wall=&quot;st_bluesand&quot;, inf=&quot;fl-light&quot;,
+     outf=&quot;fl-rough-blue&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;d&quot;,
+     endp={goal=&quot;st_nil&quot;, alg=&quot;circle&quot;}},
+[10]={box=&quot;st_shogun&quot;, wall=&quot;st_bluesand&quot;, inf=&quot;fl-rough&quot;,
+      outf=&quot;fl-space&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it_shogun_s&quot;,
+      endp={goal=&quot;st_nil&quot;, alg=&quot;magnets&quot;}},
+[11]={box=&quot;st-marble_move&quot;, wall=&quot;st_bluesand&quot;, inf=&quot;fl-rough&quot;,
+      outf=&quot;fl-abyss&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;b&quot;,
       endp={goal=&quot;st-marble&quot;, alg=&quot;vortex&quot;}},
-[12]={box=&quot;st-shogun&quot;, wall=&quot;st-blue-sand&quot;, inf=&quot;fl-rough&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it-shogun-s&quot;,
-      endp={goal=&quot;st-none&quot;, give=&quot;it-hammer&quot;, alg=&quot;block:st-stone_break&quot;}},
-[13]={box=&quot;st-block&quot;, wall=&quot;st-blue-sand&quot;, inf=&quot;fl-rough&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;b&quot;,
-      endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, alg=&quot;ralf&quot;}},
+[12]={box=&quot;st_shogun&quot;, wall=&quot;st_bluesand&quot;, inf=&quot;fl-rough&quot;,
+      outf=&quot;fl-space&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it_shogun_s&quot;,
+      endp={goal=&quot;st_nil&quot;, give=&quot;it_hammer&quot;, alg=&quot;block:st-stone_break&quot;}},
+[13]={box=&quot;st-block&quot;, wall=&quot;st_bluesand&quot;, inf=&quot;fl-rough&quot;,
+      outf=&quot;fl-leaves&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;b&quot;,
+      endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, alg=&quot;ralf&quot;}},
 
 [14]={box=&quot;st-brownie&quot;, wall={&quot;st-glass&quot;, &quot;fl-himalaya&quot;, &quot;fl-water&quot;},
-      inf=&quot;fl-himalaya&quot;, outf=&quot;fl-water&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-      endp={goal=&quot;st-pull&quot;, alg=&quot;magnets&quot;}},
+      inf=&quot;fl-himalaya&quot;, outf=&quot;fl-water&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+      endp={goal=&quot;st_pull&quot;, alg=&quot;magnets&quot;}},
 [15]={box=&quot;st-brownie&quot;, wall={&quot;st-glass&quot;, &quot;fl-himalaya&quot;, &quot;fl-water&quot;},
-      inf=&quot;fl-himalaya&quot;, outf=&quot;fl-water&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-      endp={goal=&quot;st-none&quot;, alg=&quot;fourswitch&quot;}},
-[16]={box=&quot;st-shogun&quot;, wall={&quot;st-glass&quot;, &quot;fl-rough-red&quot;, &quot;fl-abyss&quot;},
-      inf=&quot;fl-rough-red&quot;, outf=&quot;fl-abyss&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;c&quot;,
-      goal=&quot;it-shogun-s&quot;,
+      inf=&quot;fl-himalaya&quot;, outf=&quot;fl-water&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+      endp={goal=&quot;st_nil&quot;, alg=&quot;fourswitch&quot;}},
+[16]={box=&quot;st_shogun&quot;, wall={&quot;st-glass&quot;, &quot;fl-rough-red&quot;, &quot;fl-abyss&quot;},
+      inf=&quot;fl-rough-red&quot;, outf=&quot;fl-abyss&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;c&quot;,
+      goal=&quot;it_shogun_s&quot;,
       endp={alg=&quot;circle&quot;}},
 [17]={box=&quot;st-brownie&quot;, wall={&quot;st-glass&quot;, &quot;fl-rough-red&quot;, &quot;fl-sahara&quot;},
-      inf=&quot;fl-rough-red&quot;, outf=&quot;fl-sahara&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;c&quot;,
+      inf=&quot;fl-rough-red&quot;, outf=&quot;fl-sahara&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;c&quot;,
       endp={goal=&quot;st-grate2&quot;, wall=&quot;st-grate2&quot;, alg=&quot;outside&quot;}},
 [18]={box=&quot;st-greenbrown_move&quot;, wall={&quot;st-glass&quot;, &quot;fl-wood&quot;, &quot;fl-water&quot;},
-      inf=&quot;fl-wood&quot;, outf=&quot;fl-water&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;c&quot;,
+      inf=&quot;fl-wood&quot;, outf=&quot;fl-water&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;c&quot;,
       endp={goal=&quot;st-greenbrown_hole&quot;, alg=&quot;ralf&quot;}},
 [19]={box=&quot;st-block&quot;, wall={&quot;st-glass&quot;, &quot;fl-wood&quot;, &quot;fl-abyss&quot;},
-      inf=&quot;fl-wood&quot;, outf=&quot;fl-abyss&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;d&quot;,
-      endp={goal={&quot;fl-abyss&quot;, &quot;it-none&quot;}, alg=&quot;vortex&quot;}},
+      inf=&quot;fl-wood&quot;, outf=&quot;fl-abyss&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;d&quot;,
+      endp={goal={&quot;fl-abyss&quot;, &quot;it_nil&quot;}, alg=&quot;vortex&quot;}},
 [20]={box=&quot;st-wood-growing&quot;, wall={&quot;st-glass&quot;, &quot;fl-wood&quot;, &quot;fl-abyss&quot;},
-      inf=&quot;fl-wood&quot;, outf=&quot;fl-abyss&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;a&quot;,
-      endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, alg=&quot;magnets&quot;}},
+      inf=&quot;fl-wood&quot;, outf=&quot;fl-abyss&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;a&quot;,
+      endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, alg=&quot;magnets&quot;}},
 [21]={box=&quot;st-wood&quot;, wall={&quot;st-glass&quot;, &quot;fl-wood&quot;, &quot;fl-sahara&quot;},
-      inf=&quot;fl-wood&quot;, outf=&quot;fl-sahara&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;c&quot;,
-      endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, give=&quot;ac-bug&quot;, alg=&quot;block:st-bug&quot;}},
-[22]={box=&quot;st-shogun&quot;, wall={&quot;st-glass&quot;, &quot;fl-wood&quot;, &quot;fl-leaves&quot;}, inf=&quot;fl-wood&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it-shogun-s&quot;,
-      endp={goal=&quot;st-none&quot;, give=&quot;it-sword&quot;, alg=&quot;block:st-knight&quot;}},
+      inf=&quot;fl-wood&quot;, outf=&quot;fl-sahara&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;c&quot;,
+      endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, give=&quot;ac-bug&quot;, alg=&quot;block:st-bug&quot;}},
+[22]={box=&quot;st_shogun&quot;, wall={&quot;st-glass&quot;, &quot;fl-wood&quot;, &quot;fl-leaves&quot;}, inf=&quot;fl-wood&quot;,
+      outf=&quot;fl-leaves&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it_shogun_s&quot;,
+      endp={goal=&quot;st_nil&quot;, give=&quot;it_sword&quot;, alg=&quot;block:st_knight&quot;}},
 [23]={box=&quot;st-block&quot;, wall={&quot;st-glass&quot;, &quot;fl-wood&quot;, &quot;fl-abyss&quot;},
-      inf=&quot;fl-wood&quot;, outf=&quot;fl-abyss&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;d&quot;,
-      endp={goal={&quot;st-none&quot;, &quot;it-none&quot;}, alg=&quot;allcrack:1&quot;}},
+      inf=&quot;fl-wood&quot;, outf=&quot;fl-abyss&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;d&quot;,
+      endp={goal={&quot;st_nil&quot;, &quot;it_nil&quot;}, alg=&quot;allcrack:1&quot;}},
 [24]={box=&quot;st-brownie&quot;, wall={&quot;st-glass&quot;, &quot;fl-wood&quot;, &quot;fl-sahara&quot;},
-      inf=&quot;fl-wood&quot;, outf=&quot;fl-sahara&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;c&quot;,
-      endp={goal=&quot;st-none&quot;, give=&quot;ac-bug&quot;, alg=&quot;block:st-bug&quot;}},
+      inf=&quot;fl-wood&quot;, outf=&quot;fl-sahara&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;c&quot;,
+      endp={goal=&quot;st_nil&quot;, give=&quot;ac-bug&quot;, alg=&quot;block:st-bug&quot;}},
 [25]={box=&quot;st-brownie&quot;, wall={&quot;st-glass&quot;, &quot;fl-wood&quot;, &quot;fl-leaves&quot;, &quot;it-cherry&quot;},
-      inf=&quot;fl-wood&quot;, outf=&quot;fl-leaves&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
+      inf=&quot;fl-wood&quot;, outf=&quot;fl-leaves&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
       endp={goal={&quot;st-glass&quot;, &quot;fl-wood&quot;, &quot;fl-leaves&quot;, &quot;it-cherry&quot;},
             give=&quot;it-cherry&quot;, alg=&quot;outside&quot;}},
 
 [26]={box=&quot;st-brownie&quot;, wall=&quot;st-likeoxydc-open&quot;, inf=&quot;fl-acblack&quot;,
-      outf=&quot;fl-water&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;c&quot;,
+      outf=&quot;fl-water&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;c&quot;,
       endp={goal=&quot;st-grate1&quot;, alg=&quot;ralf&quot;}},
 [27]={box=&quot;st-greenbrown_move&quot;, wall=&quot;st-likeoxydc-open&quot;, inf=&quot;fl-acblack&quot;,
-      outf=&quot;fl-water&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;c&quot;,
+      outf=&quot;fl-water&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;c&quot;,
       endp={goal=&quot;st-greenbrown_hole&quot;, alg=&quot;hide&quot;}},
 [28]={box=&quot;st-wood-growing&quot;, wall=&quot;st-likeoxydc-open&quot;, inf=&quot;fl-tigris&quot;,
-      outf=&quot;fl-sahara&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;a&quot;,
-      endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, alg=&quot;fourswitch&quot;}},
+      outf=&quot;fl-sahara&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;a&quot;,
+      endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, alg=&quot;fourswitch&quot;}},
 [29]={box=&quot;st-brownie&quot;, wall=&quot;st-likeoxydc-open&quot;, inf=&quot;fl-tigris&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-      endp={goal=&quot;st-pull&quot;, give=&quot;it-sword&quot;, alg=&quot;block:st-knight&quot;}},
+      outf=&quot;fl-leaves&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+      endp={goal=&quot;st_pull&quot;, give=&quot;it_sword&quot;, alg=&quot;block:st_knight&quot;}},
 [30]={box=&quot;st-wood-growing&quot;, wall=&quot;st-likeoxydc-open&quot;, inf=&quot;fl-tigris&quot;,
-      outf=&quot;fl-sahara&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;a&quot;,
-      endp={goal={&quot;st-none&quot;, &quot;fl-stwood&quot;, &quot;it-none&quot;}, give=&quot;it-hammer&quot;, alg=&quot;block:st-stone_break&quot;}},
+      outf=&quot;fl-sahara&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;a&quot;,
+      endp={goal={&quot;st_nil&quot;, &quot;fl-stwood&quot;, &quot;it_nil&quot;}, give=&quot;it_hammer&quot;, alg=&quot;block:st-stone_break&quot;}},
 [31]={box=&quot;st-glass_move&quot;, wall=&quot;st-likeoxydc-open&quot;, inf=&quot;fl-tigris&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;a&quot;,
+      outf=&quot;fl-space&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;a&quot;,
       endp={wall=&quot;st-grate1&quot;, give=&quot;it-cherry&quot;, alg=&quot;outside:3&quot;}},
 
 [32]={box=&quot;st-block&quot;, wall=&quot;st-metal&quot;, inf=&quot;fl-bluegray&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;d&quot;,
-      endp={goal={&quot;fl-abyss&quot;, &quot;it-none&quot;}, alg=&quot;vortex&quot;}},
-[33]={box=&quot;st-shogun&quot;, wall=&quot;st-metal&quot;, inf=&quot;fl-bluegray&quot;,
-      outf=&quot;fl-rough-blue&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;, goal=&quot;it-shogun-s&quot;,
+      outf=&quot;fl-space&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;d&quot;,
+      endp={goal={&quot;fl-abyss&quot;, &quot;it_nil&quot;}, alg=&quot;vortex&quot;}},
+[33]={box=&quot;st_shogun&quot;, wall=&quot;st-metal&quot;, inf=&quot;fl-bluegray&quot;,
+      outf=&quot;fl-rough-blue&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;, goal=&quot;it_shogun_s&quot;,
       endp={goal=&quot;st-metal_hole&quot;, alg=&quot;magnets&quot;}},
-[34]={box=&quot;st-shogun&quot;, wall=&quot;st-metal&quot;, inf=&quot;fl-white&quot;,
-      outf=&quot;fl-abyss&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it-shogun-s&quot;,
-      endp={goal=&quot;st-none&quot;, alg=&quot;gradients&quot;}},
+[34]={box=&quot;st_shogun&quot;, wall=&quot;st-metal&quot;, inf=&quot;fl-white&quot;,
+      outf=&quot;fl-abyss&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it_shogun_s&quot;,
+      endp={goal=&quot;st_nil&quot;, alg=&quot;gradients&quot;}},
 [35]={box=&quot;st-block&quot;, wall=&quot;st-metal&quot;, inf=&quot;fl-white&quot;,
-      outf=&quot;fl-abyss&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;b&quot;,
+      outf=&quot;fl-abyss&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;b&quot;,
       endp={box=&quot;fl-swamp&quot;, alg=&quot;ralf&quot;}},
-[36]={box=&quot;st-shogun&quot;, wall=&quot;st-metal&quot;, inf=&quot;fl-white&quot;,
-      outf=&quot;fl-abyss&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it-shogun-s&quot;,
+[36]={box=&quot;st_shogun&quot;, wall=&quot;st-metal&quot;, inf=&quot;fl-white&quot;,
+      outf=&quot;fl-abyss&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it_shogun_s&quot;,
       endp={alg=&quot;circle&quot;}},
 
 [37]={box=&quot;st-wood-growing&quot;, wall=&quot;st-rock1&quot;, inf=&quot;fl-light&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;a&quot;,
-      endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, wall=&quot;st-grate2&quot;, alg=&quot;outside&quot;}},
+      outf=&quot;fl-leaves&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;a&quot;,
+      endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, wall=&quot;st-grate2&quot;, alg=&quot;outside&quot;}},
 [38]={box=&quot;st-glass_move&quot;, wall=&quot;st-rock1&quot;, inf=&quot;fl-light&quot;,
-      outf=&quot;fl-abyss&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;a&quot;,
+      outf=&quot;fl-abyss&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;a&quot;,
       endp={give=&quot;it-cherry&quot;, alg=&quot;ralf&quot;}},
 [39]={box=&quot;st-brownie&quot;, wall=&quot;st-rock1&quot;, inf=&quot;fl-light&quot;,
-      outf=&quot;fl-abyss&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
+      outf=&quot;fl-abyss&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
       endp={goal=&quot;st-grate2&quot;, alg=&quot;fourswitch&quot;}},
 [40]={box=&quot;st-glass_move&quot;, wall=&quot;st-rock1&quot;, inf=&quot;fl-light&quot;,
-      outf=&quot;fl-abyss&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;a&quot;,
-      endp={goal=&quot;st-glass1_hole&quot;, give=&quot;it-sword&quot;, alg=&quot;block:st-knight&quot;}},
+      outf=&quot;fl-abyss&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;a&quot;,
+      endp={goal=&quot;st-glass1_hole&quot;, give=&quot;it_sword&quot;, alg=&quot;block:st_knight&quot;}},
 [41]={box=&quot;st-brownie&quot;, wall=&quot;st-rock1&quot;, inf=&quot;fl-rough&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;c&quot;,
-      endp={goal={&quot;st-none&quot;, &quot;it-none&quot;, &quot;fl-hay&quot;}, wall=&quot;st-rock1_hole&quot;,
+      outf=&quot;fl-space&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;c&quot;,
+      endp={goal={&quot;st_nil&quot;, &quot;it_nil&quot;, &quot;fl-hay&quot;}, wall=&quot;st-rock1_hole&quot;,
             alg=&quot;outside:3&quot;}},
 [42]={box=&quot;st-greenbrown_move&quot;, wall=&quot;st-rock1&quot;, inf=&quot;fl-rough&quot;,
-      outf=&quot;fl-sahara&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;c&quot;,
+      outf=&quot;fl-sahara&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;c&quot;,
       endp={goal=&quot;st-greenbrown&quot;, alg=&quot;vortex&quot;}},
 
 [43]={box=&quot;st-brownie&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
+      outf=&quot;fl-space&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
       endp={goal=&quot;st-rock3_hole&quot;, wall=&quot;st-rock3_hole&quot;, alg=&quot;outside:3&quot;}},
 [44]={box=&quot;st-marble_move&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
-      outf=&quot;fl-rough-blue&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;b&quot;,
+      outf=&quot;fl-rough-blue&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;b&quot;,
       endp={&quot;st-marble_hole&quot;, alg=&quot;ralf&quot;}},
 [45]={box=&quot;st-wood-growing&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;a&quot;,
-      endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, give=&quot;ac-bug&quot;, alg=&quot;block:st-bug&quot;}},
-[46]={box=&quot;st-shogun&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
-      outf=&quot;fl-abyss&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;, goal=&quot;it-shogun-s&quot;,
-      endp={goal=&quot;st-none&quot;, give=&quot;it-hammer&quot;, alg=&quot;block:st-plain_cracked&quot;}},
+      outf=&quot;fl-leaves&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;a&quot;,
+      endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, give=&quot;ac-bug&quot;, alg=&quot;block:st-bug&quot;}},
+[46]={box=&quot;st_shogun&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
+      outf=&quot;fl-abyss&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;, goal=&quot;it_shogun_s&quot;,
+      endp={goal=&quot;st_nil&quot;, give=&quot;it_hammer&quot;, alg=&quot;block:st-plain_cracked&quot;}},
 [47]={box=&quot;st-greenbrown_move&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
-      outf=&quot;fl-sahara&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;c&quot;,
+      outf=&quot;fl-sahara&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;c&quot;,
       endp={goal=&quot;st-greenbrown_hole&quot;, give=&quot;ac-bug&quot;, alg=&quot;block:st-bug&quot;}},
 [48]={box=&quot;st-glass_move&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;a&quot;,
+      outf=&quot;fl-leaves&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;a&quot;,
       endp={give=&quot;it-cherry&quot;, alg=&quot;ralf&quot;}},
 [49]={box=&quot;st-marble_move&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
-      outf=&quot;fl-rough-blue&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;b&quot;,
-      endp={goal=&quot;st-marble_hole&quot;, give=&quot;it-hammer&quot;, alg=&quot;block:st-plain_cracked&quot;}},
-[50]={box=&quot;st-shogun&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;a&quot;, goal=&quot;it-shogun-s&quot;,
+      outf=&quot;fl-rough-blue&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;b&quot;,
+      endp={goal=&quot;st-marble_hole&quot;, give=&quot;it_hammer&quot;, alg=&quot;block:st-plain_cracked&quot;}},
+[50]={box=&quot;st_shogun&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
+      outf=&quot;fl-leaves&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;a&quot;, goal=&quot;it_shogun_s&quot;,
       endp={alg=&quot;circle&quot;}},
 [51]={box=&quot;st-wood-growing&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;a&quot;,
-      endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;},
+      outf=&quot;fl-leaves&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;a&quot;,
+      endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;},
             wall={&quot;st-plain_breaking&quot;, &quot;fl-sahara&quot;}, alg=&quot;outside&quot;}},
 [52]={box=&quot;st-wood&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
-      outf=&quot;fl-water&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;c&quot;,
-      endp={goal={&quot;st-grate1&quot;, &quot;it-none&quot;}, alg=&quot;ralf&quot;}},
-[53]={box=&quot;st-shogun&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;d&quot;, goal=&quot;it-shogun-s&quot;,
-      endp={goal={&quot;st-none&quot;, &quot;fl-swamp&quot;}, alg=&quot;fourswitch&quot;}},
+      outf=&quot;fl-water&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;c&quot;,
+      endp={goal={&quot;st-grate1&quot;, &quot;it_nil&quot;}, alg=&quot;ralf&quot;}},
+[53]={box=&quot;st_shogun&quot;, wall=&quot;st-rock3&quot;, inf=&quot;fl-leaves&quot;,
+      outf=&quot;fl-space&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;d&quot;, goal=&quot;it_shogun_s&quot;,
+      endp={goal={&quot;st_nil&quot;, &quot;fl-swamp&quot;}, alg=&quot;fourswitch&quot;}},
 
-[54]={box=&quot;st-shogun&quot;, wall=&quot;st-rock4&quot;, inf=&quot;fl-himalaya&quot;,
-      outf=&quot;fl-water&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it-shogun-s&quot;,
+[54]={box=&quot;st_shogun&quot;, wall=&quot;st-rock4&quot;, inf=&quot;fl-himalaya&quot;,
+      outf=&quot;fl-water&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it_shogun_s&quot;,
       endp={alg=&quot;vortex&quot;}},
 [55]={box=&quot;st-marble_move&quot;, wall=&quot;st-rock4&quot;, inf=&quot;fl-himalaya&quot;,
-      outf=&quot;fl-abyss&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;b&quot;,
+      outf=&quot;fl-abyss&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;b&quot;,
       endp={goal=&quot;st-marble_hole&quot;, alg=&quot;ralf&quot;}},
-[56]={box=&quot;st-shogun&quot;, wall=&quot;st-rock4&quot;, inf=&quot;fl-himalaya&quot;,
-      outf=&quot;fl-abyss&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;b&quot;, goal=&quot;it-shogun-s&quot;,
+[56]={box=&quot;st_shogun&quot;, wall=&quot;st-rock4&quot;, inf=&quot;fl-himalaya&quot;,
+      outf=&quot;fl-abyss&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;b&quot;, goal=&quot;it_shogun_s&quot;,
       endp={alg=&quot;circle&quot;}},
 [57]={box=&quot;st-block&quot;, wall=&quot;st-rock4&quot;, inf=&quot;fl-rough-red&quot;,
-      outf=&quot;fl-rough-blue&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;d&quot;,
+      outf=&quot;fl-rough-blue&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;d&quot;,
       endp={goal=&quot;st-explosion&quot;, wall=&quot;st-explosion&quot;, alg=&quot;outside&quot;}},
 [58]={box=&quot;st-rock3_move&quot;, wall=&quot;st-rock4&quot;, inf=&quot;fl-rough-red&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;d&quot;,
-      endp={goal=&quot;st-plain_cracked&quot;, give=&quot;it-hammer&quot;, alg=&quot;block:st-plain_cracked&quot;}},
-[59]={box=&quot;st-shogun&quot;, wall=&quot;st-rock4&quot;, inf=&quot;fl-rough-red&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;, goal=&quot;it-shogun-s&quot;,
-      endp={goal=&quot;st-none&quot;, alg=&quot;ralf&quot;}},
+      outf=&quot;fl-space&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;d&quot;,
+      endp={goal=&quot;st-plain_cracked&quot;, give=&quot;it_hammer&quot;, alg=&quot;block:st-plain_cracked&quot;}},
+[59]={box=&quot;st_shogun&quot;, wall=&quot;st-rock4&quot;, inf=&quot;fl-rough-red&quot;,
+      outf=&quot;fl-space&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;, goal=&quot;it_shogun_s&quot;,
+      endp={goal=&quot;st_nil&quot;, alg=&quot;ralf&quot;}},
 [60]={box=&quot;st-rock3_move&quot;, wall=&quot;st-rock4&quot;, inf=&quot;fl-rough-red&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;d&quot;,
+      outf=&quot;fl-space&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;d&quot;,
       endp={goal=&quot;st-bug&quot;, give=&quot;ac-bug&quot;, alg=&quot;block:st-bug&quot;}},
 
 [61]={box=&quot;st-greenbrown_move&quot;, wall=&quot;st-rock5&quot;, inf=&quot;fl-samba&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;c&quot;,
+      outf=&quot;fl-leaves&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;c&quot;,
       endp={goal=&quot;st-greenbrown_hole&quot;, alg=&quot;fourswitch&quot;}},
 [62]={box=&quot;st-block&quot;, wall=&quot;st-rock5&quot;, inf=&quot;fl-samba&quot;,
-      outf=&quot;fl-water&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;b&quot;,
-      endp={goal={&quot;fl-water&quot;, &quot;it-none&quot;}, alg=&quot;vortex&quot;}},
+      outf=&quot;fl-water&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;b&quot;,
+      endp={goal={&quot;fl-water&quot;, &quot;it_nil&quot;}, alg=&quot;vortex&quot;}},
 [63]={box=&quot;st-rock3_move&quot;, wall=&quot;st-rock5&quot;, inf=&quot;fl-samba&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;d&quot;,
-      endp={goal=&quot;st-plain_cracked&quot;, give=&quot;it-hammer&quot;,
+      outf=&quot;fl-leaves&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;d&quot;,
+      endp={goal=&quot;st-plain_cracked&quot;, give=&quot;it_hammer&quot;,
             alg=&quot;block:st-plain_cracked&quot;}},
 [64]={box=&quot;st-marble_move&quot;, wall=&quot;st-rock5&quot;, inf=&quot;fl-samba&quot;,
-      outf=&quot;fl-water&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;b&quot;,
+      outf=&quot;fl-water&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;b&quot;,
       endp={goal=&quot;st-marble_hole&quot;, alg=&quot;gradients&quot;}},
 [65]={box=&quot;st-wood-growing&quot;, wall=&quot;st-rock5&quot;, inf=&quot;fl-samba&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;a&quot;,
-      endp={goal={&quot;st-none&quot;, &quot;fl-stwood&quot;, &quot;it-none&quot;}, alg=&quot;ralf&quot;}},
+      outf=&quot;fl-space&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;a&quot;,
+      endp={goal={&quot;st_nil&quot;, &quot;fl-stwood&quot;, &quot;it_nil&quot;}, alg=&quot;ralf&quot;}},
 [66]={box=&quot;st-greenbrown_move&quot;, wall=&quot;st-rock5&quot;, inf=&quot;fl-samba&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;c&quot;,
+      outf=&quot;fl-leaves&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;c&quot;,
       endp={goal=&quot;st-greenbrown&quot;, alg=&quot;vortex&quot;}},
 [67]={box=&quot;st-block&quot;, wall=&quot;st-rock5&quot;, inf=&quot;fl-samba&quot;,
-      outf=&quot;fl-water&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;b&quot;,
+      outf=&quot;fl-water&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;b&quot;,
       endp={alg=&quot;circle&quot;}},
 [68]={box=&quot;st-brownie&quot;, wall=&quot;st-rock5&quot;, inf=&quot;fl-samba&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-      endp={goal=&quot;st-none&quot;, alg=&quot;allcrack:1&quot;}},
+      outf=&quot;fl-space&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+      endp={goal=&quot;st_nil&quot;, alg=&quot;allcrack:1&quot;}},
 [69]={box=&quot;st-block&quot;, wall=&quot;st-rock5&quot;, inf=&quot;fl-samba&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;d&quot;,
-      endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, alg=&quot;ralf&quot;}},
+      outf=&quot;fl-space&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;d&quot;,
+      endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, alg=&quot;ralf&quot;}},
 
 [70]={box=&quot;st-rock3_move&quot;, wall=&quot;st-rock6&quot;, inf=&quot;fl-acblack&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_b&quot;, oxyd=&quot;d&quot;,
+      outf=&quot;fl-space&quot;, door=&quot;st_door_b&quot;, oxyd=&quot;d&quot;,
       endp={goal=&quot;st-plain_breaking&quot;, alg=&quot;ralf&quot;}},
-[71]={box=&quot;st-shogun&quot;, wall=&quot;st-rock6&quot;, inf=&quot;fl-acblack&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;, goal=&quot;it-shogun-s&quot;,
+[71]={box=&quot;st_shogun&quot;, wall=&quot;st-rock6&quot;, inf=&quot;fl-acblack&quot;,
+      outf=&quot;fl-leaves&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;, goal=&quot;it_shogun_s&quot;,
       endp={goal=&quot;st-explosion&quot;, wall=&quot;st-explosion&quot;, alg=&quot;outside&quot;}},
 [72]={box=&quot;st-block&quot;, wall=&quot;st-rock6&quot;, inf=&quot;fl-acblack&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;d&quot;,
-      endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, alg=&quot;magnets&quot;}},
-[73]={box=&quot;st-shogun&quot;, wall=&quot;st-rock6&quot;, inf=&quot;fl-acblack&quot;,
-      outf=&quot;fl-leaves&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;, goal=&quot;it-shogun-s&quot;,
-      endp={goal=&quot;st-knight&quot;, give=&quot;it-sword&quot;, alg=&quot;block:st-knight&quot;}},
-[74]={box=&quot;st-shogun&quot;, wall=&quot;st-rock6&quot;, inf=&quot;fl-tigris&quot;,
-      outf=&quot;fl-rough-blue&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;b&quot;, goal=&quot;it-shogun-s&quot;,
-      endp={goal=&quot;st-none&quot;, alg=&quot;fourswitch&quot;}},
-[75]={box=&quot;st-shogun&quot;, wall=&quot;st-rock6&quot;, inf=&quot;fl-tigris&quot;,
-      outf=&quot;fl-water&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it-shogun-s&quot;,
+      outf=&quot;fl-leaves&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;d&quot;,
+      endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, alg=&quot;magnets&quot;}},
+[73]={box=&quot;st_shogun&quot;, wall=&quot;st-rock6&quot;, inf=&quot;fl-acblack&quot;,
+      outf=&quot;fl-leaves&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;, goal=&quot;it_shogun_s&quot;,
+      endp={goal=&quot;st_knight&quot;, give=&quot;it_sword&quot;, alg=&quot;block:st_knight&quot;}},
+[74]={box=&quot;st_shogun&quot;, wall=&quot;st-rock6&quot;, inf=&quot;fl-tigris&quot;,
+      outf=&quot;fl-rough-blue&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;b&quot;, goal=&quot;it_shogun_s&quot;,
+      endp={goal=&quot;st_nil&quot;, alg=&quot;fourswitch&quot;}},
+[75]={box=&quot;st_shogun&quot;, wall=&quot;st-rock6&quot;, inf=&quot;fl-tigris&quot;,
+      outf=&quot;fl-water&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;, goal=&quot;it_shogun_s&quot;,
       endp={goal=&quot;st-explosion&quot;, alg=&quot;gradients&quot;}},
 
 -- New designs
 [76]={box=&quot;st-glass1_move&quot;, wall=&quot;st-glass2&quot;, inf=&quot;fl-lightgray&quot;,
-      outf=&quot;fl-abyss&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;,
-      endp={goal=&quot;st-pull&quot;, alg=&quot;hide&quot;}},
-[77]={box=&quot;st-rock3_move&quot;, wall=&quot;st-brick&quot;, inf=&quot;fl-darkgray&quot;,
-      outf=&quot;fl-leavesb&quot;, door=&quot;st-door&quot;, oxyd=&quot;a&quot;,
-      endp={goal=&quot;st-plain_cracked&quot;, give=&quot;it-hammer&quot;, alg=&quot;knock&quot;}},
+      outf=&quot;fl-abyss&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;,
+      endp={goal=&quot;st_pull&quot;, alg=&quot;hide&quot;}},
+[77]={box=&quot;st-rock3_move&quot;, wall=&quot;st_brick&quot;, inf=&quot;fl-darkgray&quot;,
+      outf=&quot;fl-leavesb&quot;, door=&quot;st_door_d&quot;, oxyd=&quot;a&quot;,
+      endp={goal=&quot;st-plain_cracked&quot;, give=&quot;it_hammer&quot;, alg=&quot;knock&quot;}},
 [78]={box=&quot;st-rock3_move&quot;, wall=&quot;st-bumps&quot;, inf=&quot;fl-dunes&quot;,
-      outf=&quot;fl-sand&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-      endp={goal=&quot;st-plain_break&quot;, give=&quot;it-hammer&quot;, alg=&quot;block:st-plain_cracked&quot;}},
+      outf=&quot;fl-sand&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+      endp={goal=&quot;st-plain_break&quot;, give=&quot;it_hammer&quot;, alg=&quot;block:st-plain_cracked&quot;}},
 [79]={box=&quot;st-flrock&quot;, wall=&quot;st-camouflage&quot;, inf=&quot;fl-gravel&quot;,
       outf={&quot;fl-gravel&quot;, &quot;st-disco-medium&quot;}, door=&quot;st-camouflage&quot;, oxyd=&quot;b&quot;,
-      endp={goal=&quot;st-camouflage&quot;, open_door={&quot;st-none&quot;, &quot;fl-leavesb&quot;}, alg=&quot;vortex&quot;}},
+      endp={goal=&quot;st-camouflage&quot;, open_door={&quot;st_nil&quot;, &quot;fl-leavesb&quot;}, alg=&quot;vortex&quot;}},
 [80]={box=&quot;st-flhay&quot;, wall=&quot;st-camouflage&quot;, inf=&quot;fl-leaves&quot;,
-      outf={&quot;fl-water:5&quot;, &quot;fl-swamp&quot;, &quot;al:random&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
-      endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;},
-            wall={&quot;st-camouflage_hole&quot;, &quot;st-none:2&quot;, &quot;fl-swamp&quot;, &quot;al:random&quot;},
-            give=&quot;it-umbrella&quot;, alg=&quot;outside:1&quot;}},
+      outf={&quot;fl-water:5&quot;, &quot;fl-swamp&quot;, &quot;al:random&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
+      endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;},
+            wall={&quot;st-camouflage_hole&quot;, &quot;st_nil:2&quot;, &quot;fl-swamp&quot;, &quot;al:random&quot;},
+            give=&quot;it_umbrella&quot;, alg=&quot;outside:1&quot;}},
 [81]={box=&quot;st-glass2_move&quot;, wall={&quot;st-glass1&quot;, &quot;fl-lightgray&quot;}, inf=&quot;fl-black&quot;,
       outf=&quot;fl-white&quot;, door=&quot;st-black4&quot;, oxyd=&quot;c&quot;, white=true,
       endp={goal=&quot;st-yinyang2&quot;, open_door=&quot;st-white4&quot;, alg=&quot;ralf&quot;}},
 [82]={box=&quot;st-wood&quot;, wall={&quot;st-glass1&quot;, &quot;fl-water&quot;}, inf=&quot;fl-sand&quot;,
-      outf=&quot;fl-water&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;c&quot;,
-      endp={goal={&quot;st-none&quot;, &quot;fl-stwood&quot;, &quot;it-none&quot;}, alg=&quot;fourswitch&quot;}},
+      outf=&quot;fl-water&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;c&quot;,
+      endp={goal={&quot;st_nil&quot;, &quot;fl-stwood&quot;, &quot;it_nil&quot;}, alg=&quot;fourswitch&quot;}},
 [83]={box=&quot;st-camouflage_move&quot;, wall=&quot;st-glass2&quot;, inf=&quot;fl-lightgray&quot;,
       outf={&quot;fl-leavesb&quot;, &quot;st-disco-medium&quot;}, door=&quot;st-glass2&quot;, oxyd=&quot;b&quot;,
       endp={goal=&quot;st-camouflage_hole&quot;, open_door=&quot;st-glass1_hole&quot;,
-            outf=&quot;st-none&quot;, alg=&quot;ralf&quot;}},
+            outf=&quot;st_nil&quot;, alg=&quot;ralf&quot;}},
 [84]={box=&quot;st-flrock&quot;, wall=&quot;st-glass2&quot;, inf=&quot;fl-sand&quot;,
-      outf={&quot;fl-water&quot;, &quot;st-disco-medium&quot;}, door=&quot;st-door&quot;, oxyd=&quot;b&quot;,
-      endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, alg=&quot;knock&quot;}},
-[85]={box=&quot;st-flrock&quot;, wall=&quot;st-brick&quot;, inf=&quot;fl-sand&quot;,
-      outf={&quot;fl-water&quot;, &quot;st-disco-medium&quot;}, door=&quot;st-door&quot;, oxyd=&quot;a&quot;,
+      outf={&quot;fl-water&quot;, &quot;st-disco-medium&quot;}, door=&quot;st_door_d&quot;, oxyd=&quot;b&quot;,
+      endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, alg=&quot;knock&quot;}},
+[85]={box=&quot;st-flrock&quot;, wall=&quot;st_brick&quot;, inf=&quot;fl-sand&quot;,
+      outf={&quot;fl-water&quot;, &quot;st-disco-medium&quot;}, door=&quot;st_door_d&quot;, oxyd=&quot;a&quot;,
       endp={goal=&quot;st-black4&quot;, alg=&quot;ralf&quot;}},
 [86]={box=&quot;st-glass1_move&quot;, wall={&quot;st-glass3&quot;, &quot;fl-abyss_fake&quot;}, inf=&quot;fl-red&quot;,
-      outf=&quot;fl-space&quot;, door={&quot;st-none&quot;, &quot;fire&quot;}, oxyd=&quot;a&quot;,
+      outf=&quot;fl-space&quot;, door={&quot;st_nil&quot;, &quot;fire&quot;}, oxyd=&quot;a&quot;,
       endp={goal=&quot;st-explosion&quot;, open_door=&quot;nofire&quot;, alg=&quot;ralf&quot;}},
 [87]={box=&quot;st-rock3_move&quot;, wall={&quot;st-glass3&quot;, &quot;fl-rough-blue&quot;}, inf=&quot;fl-plank&quot;,
       outf=&quot;fl-water&quot;, door=&quot;st-glass3&quot;, oxyd=&quot;a&quot;,
       endp={goal=&quot;st-rock7&quot;, open_door=&quot;st-glass1_hole&quot;, alg=&quot;vortex&quot;}},
 [88]={box=&quot;st-glass1_move&quot;, wall=&quot;st-likeoxyda&quot;, inf=&quot;fl-black&quot;,
-      outf=&quot;fl-abyss&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
+      outf=&quot;fl-abyss&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
       endp={goal=&quot;st-glass1_hole&quot;, alg=&quot;hide&quot;}},
 [89]={box=&quot;st-greenbrown_move&quot;, wall=&quot;st-likeoxyda-open&quot;, inf=&quot;fl-brick&quot;,
-      outf={&quot;fl-mortar&quot;, &quot;st-disco-medium&quot;}, door=&quot;st-door&quot;, oxyd=&quot;a&quot;,
+      outf={&quot;fl-mortar&quot;, &quot;st-disco-medium&quot;}, door=&quot;st_door_d&quot;, oxyd=&quot;a&quot;,
       endp={goal=&quot;st-grate2&quot;, alg=&quot;knock&quot;}},
 [90]={box=&quot;st-rock3_move&quot;, wall=&quot;st-likeoxydb&quot;, inf=&quot;fl-rough-red&quot;,
-      outf=&quot;fl-space&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;,
+      outf=&quot;fl-space&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;,
       endp={goal=&quot;st-plain_breaking&quot;, alg=&quot;hide&quot;}},
 [91]={box=&quot;st-flhay&quot;, wall=&quot;st-likeoxydb-open&quot;, inf=&quot;fl-rough-blue&quot;,
-      outf={&quot;fl-swamp&quot;, &quot;st-disco-light&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;,
-      endp={goal=&quot;st-break_gray&quot;, give=&quot;it-hammer&quot;, alg=&quot;block:st-break_gray&quot;}},
+      outf={&quot;fl-swamp&quot;, &quot;st-disco-light&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;,
+      endp={goal=&quot;st-break_gray&quot;, give=&quot;it_hammer&quot;, alg=&quot;block:st-break_gray&quot;}},
 [92]={box=&quot;st-glass2_move&quot;, wall=&quot;st-likeoxydc&quot;, inf=&quot;fl-sahara&quot;,
-      outf={&quot;fl-water&quot;, &quot;st-disco-light&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;c&quot;,
+      outf={&quot;fl-water&quot;, &quot;st-disco-light&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;c&quot;,
       endp={goal=&quot;st-glass1_hole&quot;, alg=&quot;hide&quot;}},
 [93]={box=&quot;st-glass_move&quot;, wall=&quot;st-likeoxydc-open&quot;, inf=&quot;fl-red&quot;,
       outf={&quot;st-blackballs&quot;, &quot;st-whiteballs&quot;, &quot;fl-abyss&quot;, &quot;al:random&quot;},
-      door=&quot;st-door_a&quot;, oxyd=&quot;c&quot;,
+      door=&quot;st_door_a&quot;, oxyd=&quot;c&quot;,
       endp={goal=&quot;st-black4&quot;, alg=&quot;fourswitch&quot;}},
 [94]={box=&quot;st-glass2_move&quot;, wall=&quot;st-likeoxydd&quot;, inf=&quot;fl-concrete&quot;,
-      outf=&quot;fl-sand&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
+      outf=&quot;fl-sand&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
       endp={goal=&quot;st-glass1_hole&quot;, alg=&quot;hide&quot;}},
 [95]={box=&quot;st-flrock&quot;, wall=&quot;st-likeoxydd-open&quot;, inf=&quot;fl-marble&quot;,
-      outf=&quot;fl-water&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;,
-      endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, outf=&quot;fl-swamp&quot;,
-            give=&quot;it-hammer&quot;, wall=&quot;st-break_gray&quot;, alg=&quot;outside&quot;}},
+      outf=&quot;fl-water&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;,
+      endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, outf=&quot;fl-swamp&quot;,
+            give=&quot;it_hammer&quot;, wall=&quot;st-break_gray&quot;, alg=&quot;outside&quot;}},
 [96]={box=&quot;st-flrock&quot;, wall=&quot;st-marble&quot;, inf=&quot;fl-marble&quot;,
-      outf={&quot;fl-leavesc3&quot;, &quot;fl-leavesd3&quot;}, door=&quot;st-door&quot;, oxyd=&quot;a&quot;,
-      endp={goal={&quot;st-grate2&quot;, &quot;it-none&quot;}, alg=&quot;knock&quot;}},
+      outf={&quot;fl-leavesc3&quot;, &quot;fl-leavesd3&quot;}, door=&quot;st_door_d&quot;, oxyd=&quot;a&quot;,
+      endp={goal={&quot;st-grate2&quot;, &quot;it_nil&quot;}, alg=&quot;knock&quot;}},
 [97]={box=&quot;st-camouflage_move&quot;, wall=&quot;st-marble&quot;, inf=&quot;fl-leaves&quot;,
-      outf={&quot;fl-leaves&quot;, &quot;st-marble&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
+      outf={&quot;fl-leaves&quot;, &quot;st-marble&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
       endp={goal=&quot;st-camouflage_hole&quot;, wall=&quot;st-marble_hole&quot;,
             outf=&quot;st-marble_hole&quot;, alg=&quot;outside&quot;}},
 [98]={box=&quot;st-rock1_move&quot;, wall=&quot;st-redrock&quot;, inf=&quot;fl-acblack&quot;,
       outf={&quot;fl-acblack&quot;, &quot;st-redrock&quot;}, door=&quot;st-rock6&quot;, oxyd=&quot;b&quot;,
-      endp={goal=&quot;st-rock6&quot;, open_door=&quot;st-none&quot;, alg=&quot;vortex&quot;}},
+      endp={goal=&quot;st-rock6&quot;, open_door=&quot;st_nil&quot;, alg=&quot;vortex&quot;}},
 [99]={box=&quot;st-glass1_move&quot;, wall=&quot;st-redrock&quot;, inf=&quot;fl-mortar&quot;,
-      outf=&quot;fl-brick&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;,
+      outf=&quot;fl-brick&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;,
       endp={goal=&quot;st-glass1_hole&quot;, wall={&quot;st-glass1_hole&quot;, &quot;fl-tigris&quot;}, alg=&quot;outside&quot;}},
 [100]={box=&quot;st-block&quot;, wall=&quot;st-redrock&quot;, inf=&quot;fl-mortar&quot;,
-       outf=&quot;fl-water&quot;, door=&quot;st-door&quot;, oxyd=&quot;b&quot;,
-       endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, alg=&quot;ralf&quot;}},
+       outf=&quot;fl-water&quot;, door=&quot;st_door_d&quot;, oxyd=&quot;b&quot;,
+       endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, alg=&quot;ralf&quot;}},
 [101]={box=&quot;st-glass2_move&quot;, wall=&quot;st-redrock&quot;, inf=&quot;fl-leavesb&quot;,
-       outf={&quot;fl-leavesc3&quot;, &quot;fl-leavesd4&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
+       outf={&quot;fl-leavesc3&quot;, &quot;fl-leavesd4&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
        endp={goal=&quot;st-glass1_hole&quot;, alg=&quot;hide&quot;}},
 [102]={box=&quot;st-camouflage_move&quot;, wall=&quot;st-rock2&quot;, inf=&quot;fl-rock&quot;,
-       outf={&quot;fl-rock&quot;, &quot;st-disco-medium&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;,
-       endp={goal={&quot;it-none&quot;, &quot;st-disco-light&quot;, &quot;fl-leavesb&quot;},
+       outf={&quot;fl-rock&quot;, &quot;st-disco-medium&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;,
+       endp={goal={&quot;it_nil&quot;, &quot;st-disco-light&quot;, &quot;fl-leavesb&quot;},
              wall={&quot;st-disco-light&quot;, &quot;fl-gray&quot;}, alg=&quot;outside:3&quot;}},
 [103]={box=&quot;st-glass2_move&quot;, wall=&quot;st-rock2&quot;, inf=&quot;fl-stone&quot;,
-       outf={&quot;fl-water&quot;, &quot;st-disco-medium&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;,
-       endp={goal={&quot;st-pull&quot;, &quot;it-none&quot;, &quot;fl-black&quot;}, alg=&quot;fourswitch&quot;}},
+       outf={&quot;fl-water&quot;, &quot;st-disco-medium&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;,
+       endp={goal={&quot;st_pull&quot;, &quot;it_nil&quot;, &quot;fl-black&quot;}, alg=&quot;fourswitch&quot;}},
 [104]={box=&quot;st-wood&quot;, wall=&quot;st-rock2&quot;, inf=&quot;fl-lightgray&quot;,
-       outf=&quot;fl-space&quot;, door=&quot;st-door&quot;, oxyd=&quot;b&quot;,
-       endp={goal={&quot;st-none&quot;, &quot;fl-marble&quot;, &quot;it-none&quot;}, alg=&quot;knock&quot;}},
+       outf=&quot;fl-space&quot;, door=&quot;st_door_d&quot;, oxyd=&quot;b&quot;,
+       endp={goal={&quot;st_nil&quot;, &quot;fl-marble&quot;, &quot;it_nil&quot;}, alg=&quot;knock&quot;}},
 [105]={box=&quot;st-camouflage_move&quot;, wall=&quot;st-rock7&quot;, inf=&quot;fl-woven&quot;,
-       outf=&quot;fl-gravel&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-       endp={goal={&quot;fl-bluegreenx&quot;, &quot;it-none&quot;, &quot;st-none&quot;}, alg=&quot;magnets&quot;}},
+       outf=&quot;fl-gravel&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+       endp={goal={&quot;fl-bluegreenx&quot;, &quot;it_nil&quot;, &quot;st_nil&quot;}, alg=&quot;magnets&quot;}},
 [106]={box=&quot;st-brownie&quot;, wall=&quot;st-rock7&quot;, inf=&quot;fl-black&quot;,
-       outf=&quot;fl-abyss&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;,
-       endp={goal=&quot;st-bug&quot;, give={&quot;ac-bug&quot;, &quot;it-hammer&quot;}, alg=&quot;block:st-plain_cracked&quot;}},
+       outf=&quot;fl-abyss&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;,
+       endp={goal=&quot;st-bug&quot;, give={&quot;ac-bug&quot;, &quot;it_hammer&quot;}, alg=&quot;block:st-plain_cracked&quot;}},
 [107]={box=&quot;st-glass_move&quot;, wall=&quot;st-rock8&quot;, inf=&quot;fl-plank&quot;,
-       outf={&quot;fl-plank&quot;, &quot;st-rock8&quot;}, door=&quot;st-door&quot;, oxyd=&quot;d&quot;,
+       outf={&quot;fl-plank&quot;, &quot;st-rock8&quot;}, door=&quot;st_door_d&quot;, oxyd=&quot;d&quot;,
        endp={goal=&quot;st-explosion&quot;, alg=&quot;knock&quot;}},
 [108]={box=&quot;st-glass2_move&quot;, wall={&quot;st-rock8&quot;, &quot;fl-water&quot;}, inf=&quot;fl-leaves&quot;,
-       outf=&quot;fl-water&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;c&quot;,
-       endp={goal=&quot;st-pull&quot;, give=&quot;it-hammer&quot;, alg=&quot;block:st-break_gray&quot;}},
+       outf=&quot;fl-water&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;c&quot;,
+       endp={goal=&quot;st_pull&quot;, give=&quot;it_hammer&quot;, alg=&quot;block:st-break_gray&quot;}},
 [109]={box=&quot;st-marble_move&quot;, wall={&quot;st-rock8&quot;, &quot;fl-abyss_fake&quot;}, inf=&quot;fl-stone&quot;,
-       outf=&quot;fl-space&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;c&quot;,
-       endp={goal={&quot;st-none&quot;, &quot;it-none&quot;, &quot;fl-hay&quot;}, wall={&quot;st-none&quot;, &quot;fl-darkgray&quot;},
+       outf=&quot;fl-space&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;c&quot;,
+       endp={goal={&quot;st_nil&quot;, &quot;it_nil&quot;, &quot;fl-hay&quot;}, wall={&quot;st_nil&quot;, &quot;fl-darkgray&quot;},
              alg=&quot;outside:3&quot;}},
 [110]={box=&quot;st-greenbrown_move&quot;, wall=&quot;st-rock9&quot;, inf=&quot;fl-rock&quot;,
        outf={&quot;fl-rock&quot;, &quot;st-rock9&quot;}, door=&quot;st-rock9&quot;, oxyd=&quot;b&quot;,
-       endp={goal=&quot;st-rock9&quot;, open_door=&quot;st-none&quot;, alg=&quot;vortex&quot;}},
+       endp={goal=&quot;st-rock9&quot;, open_door=&quot;st_nil&quot;, alg=&quot;vortex&quot;}},
 [111]={box=&quot;st-glass_move&quot;, wall=&quot;st-rock9&quot;, inf=&quot;fl-sand&quot;,
-       outf=&quot;fl-water&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;c&quot;,
+       outf=&quot;fl-water&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;c&quot;,
        endp={goal=&quot;st-grate2&quot;, alg=&quot;ralf&quot;}},
 [112]={box=&quot;st-camouflage_move&quot;, wall=&quot;st-rock9&quot;, inf=&quot;fl-stone&quot;,
-       outf=&quot;fl-swamp&quot;, door=&quot;st-door&quot;, oxyd=&quot;a&quot;,
+       outf=&quot;fl-swamp&quot;, door=&quot;st_door_d&quot;, oxyd=&quot;a&quot;,
        endp={goal=&quot;st-camouflage_hole&quot;, alg=&quot;knock&quot;}},
 [113]={box=&quot;st-block&quot;, wall=&quot;st-rock10&quot;, inf=&quot;fl-bluegreen&quot;,
-       outf=&quot;fl-abyss&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-       endp={goal={&quot;st-explosion&quot;, &quot;it-none&quot;, &quot;fl-bluegreenx&quot;},
-             wall={&quot;st-explosion&quot;, &quot;fl-marble&quot;}, give=&quot;it-umbrella&quot;, alg=&quot;outside:1&quot;}},
+       outf=&quot;fl-abyss&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+       endp={goal={&quot;st-explosion&quot;, &quot;it_nil&quot;, &quot;fl-bluegreenx&quot;},
+             wall={&quot;st-explosion&quot;, &quot;fl-marble&quot;}, give=&quot;it_umbrella&quot;, alg=&quot;outside:1&quot;}},
 [114]={box=&quot;st-wood&quot;, wall=&quot;st-rock10&quot;, inf=&quot;fl-sand&quot;,
-       outf={&quot;fl-sand&quot;, &quot;st-rock10&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;,
-       endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, give=&quot;it-sword&quot;, alg=&quot;block:st-knight&quot;}},
+       outf={&quot;fl-sand&quot;, &quot;st-rock10&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;,
+       endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, give=&quot;it_sword&quot;, alg=&quot;block:st_knight&quot;}},
 [115]={box=&quot;st-glass2_move&quot;, wall=&quot;st-stone1&quot;, inf={&quot;fl-lightgray&quot;, &quot;fl-white&quot;},
-       outf={&quot;fl-space&quot;, &quot;fl-abyss&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-       endp={goal=&quot;st-glass1_hole&quot;, wall=&quot;st-grate1&quot;, give=&quot;it-umbrella&quot;,
+       outf={&quot;fl-space&quot;, &quot;fl-abyss&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+       endp={goal=&quot;st-glass1_hole&quot;, wall=&quot;st-grate1&quot;, give=&quot;it_umbrella&quot;,
              open_door=&quot;st-grate1&quot;, alg=&quot;block:st-stone1&quot;}},
 [116]={box=&quot;st-rock1_move&quot;, wall=&quot;st-stone1&quot;, inf=&quot;fl-stwood&quot;,
        outf=&quot;fl-water&quot;, door=&quot;st-stone1&quot;, oxyd=&quot;b&quot;,
        endp={goal=&quot;st-rock1_hole&quot;, open_door=&quot;st-grate1&quot;, alg=&quot;ralf&quot;}},
 [117]={box=&quot;st-glass_move&quot;, wall=&quot;st-stone1&quot;, inf=&quot;fl-black&quot;,
-       outf=&quot;st-stone1&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
+       outf=&quot;st-stone1&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
        endp={outf=&quot;st-likeoxydd&quot;, wall=&quot;st-likeoxydd&quot;, inf=&quot;fl-ice&quot;,
-             goal={&quot;st-none&quot;, &quot;it-none&quot;, &quot;fl-ice&quot;}, alg=&quot;hide:1&quot;}},
+             goal={&quot;st_nil&quot;, &quot;it_nil&quot;, &quot;fl-ice&quot;}, alg=&quot;hide:1&quot;}},
 [118]={box=&quot;st-glass_move&quot;, wall=&quot;st-stone2&quot;, inf=&quot;fl-black&quot;,
-       outf=&quot;fl-gravel&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;,
+       outf=&quot;fl-gravel&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;,
        endp={goal=&quot;st-glass&quot;, alg=&quot;vortex&quot;}},
 [119]={box=&quot;st-block&quot;, wall=&quot;st-stone2&quot;, inf=&quot;fl-rough-red&quot;,
-       outf={&quot;fl-rough-blue&quot;, &quot;st-disco-light&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
-       endp={goal=&quot;st-none&quot;, alg=&quot;allcrack:1&quot;}},
+       outf={&quot;fl-rough-blue&quot;, &quot;st-disco-light&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
+       endp={goal=&quot;st_nil&quot;, alg=&quot;allcrack:1&quot;}},
 [120]={box=&quot;st-rock3_move&quot;, wall={&quot;st-marble&quot;, &quot;st-stone2&quot;}, inf=&quot;fl-black&quot;,
        outf={&quot;st-marble&quot;, &quot;st-stone2&quot;}, oxyd=&quot;b&quot;,
-       endp={goal=&quot;st-plain_cracked&quot;, give=&quot;it-hammer&quot;, open_door=&quot;st-none&quot;,
+       endp={goal=&quot;st-plain_cracked&quot;, give=&quot;it_hammer&quot;, open_door=&quot;st_nil&quot;,
              alg=&quot;ralf&quot;}},
 [121]={box=&quot;st-wood&quot;, wall=&quot;st-panel&quot;, inf=&quot;fl-wood&quot;,
-       outf={&quot;fl-leavesd3&quot;, &quot;fl-leavesd2&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-       endp={goal={&quot;it-none&quot;, &quot;fl-swamp&quot;}, open_door=&quot;fl-swamp&quot;, alg=&quot;block:st-wood&quot;}},
+       outf={&quot;fl-leavesd3&quot;, &quot;fl-leavesd2&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+       endp={goal={&quot;it_nil&quot;, &quot;fl-swamp&quot;}, open_door=&quot;fl-swamp&quot;, alg=&quot;block:st-wood&quot;}},
 [122]={box=&quot;st-block&quot;, wall=&quot;st-panel&quot;, inf=&quot;fl-leaves&quot;,
-       outf=&quot;fl-leavesb&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-       endp={goal={&quot;it-none&quot;, &quot;fl-swamp&quot;}, alg=&quot;fourswitch&quot;}},
+       outf=&quot;fl-leavesb&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+       endp={goal={&quot;it_nil&quot;, &quot;fl-swamp&quot;}, alg=&quot;fourswitch&quot;}},
 [123]={box=&quot;st-glass1_move&quot;, wall=&quot;st-woven&quot;, inf=&quot;fl-dunes&quot;,
        outf=&quot;fl-bluegreen&quot;, door=&quot;st-glass1&quot;, oxyd=&quot;a&quot;,
-       endp={goal=&quot;st-pull&quot;, open_door=&quot;st-pull&quot;, alg=&quot;ralf&quot;}},
+       endp={goal=&quot;st_pull&quot;, open_door=&quot;st_pull&quot;, alg=&quot;ralf&quot;}},
 [124]={box=&quot;st-marble_move&quot;, wall=&quot;st-woven&quot;, inf=&quot;fl-hay&quot;,
-       outf=&quot;fl-water&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-       endp={goal=&quot;st-marble_hole&quot;, wall={&quot;st-none&quot;, &quot;fl-woven&quot;},
-       give=&quot;it-umbrella&quot;, alg=&quot;outside:1&quot;}},
+       outf=&quot;fl-water&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+       endp={goal=&quot;st-marble_hole&quot;, wall={&quot;st_nil&quot;, &quot;fl-woven&quot;},
+       give=&quot;it_umbrella&quot;, alg=&quot;outside:1&quot;}},
 [125]={box=&quot;st-rock3_move&quot;, wall=&quot;st-yellow&quot;, inf=&quot;fl-leavesb&quot;,
-       outf=&quot;fl-leaves&quot;, door=&quot;st-door_c&quot;, oxyd=&quot;a&quot;,
+       outf=&quot;fl-leaves&quot;, door=&quot;st_door_c&quot;, oxyd=&quot;a&quot;,
        endp={goal=&quot;st-grate2&quot;, alg=&quot;ralf&quot;}},
 [126]={box=&quot;st-glass_move&quot;, wall=&quot;st-yellow&quot;, inf=&quot;fl-rough-blue&quot;,
-       outf=&quot;fl-abyss&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
-       endp={goal={&quot;st-none&quot;, &quot;it-none&quot;, &quot;fl-ice&quot;}, give=&quot;ac-bug&quot;, alg=&quot;block:st-bug&quot;}},
+       outf=&quot;fl-abyss&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
+       endp={goal={&quot;st_nil&quot;, &quot;it_nil&quot;, &quot;fl-ice&quot;}, give=&quot;ac-bug&quot;, alg=&quot;block:st-bug&quot;}},
 [127]={box=&quot;st-block&quot;, wall=&quot;st-yellow&quot;, inf=&quot;fl-lightgray&quot;,
-       outf=&quot;fl-space&quot;, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
-       endp={goal={&quot;fl-abyss&quot;, &quot;it-none&quot;}, alg=&quot;vortex&quot;}},
+       outf=&quot;fl-space&quot;, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
+       endp={goal={&quot;fl-abyss&quot;, &quot;it_nil&quot;}, alg=&quot;vortex&quot;}},
 [128]={box=&quot;st-glass1_move&quot;, wall=&quot;st-rock7&quot;, inf=&quot;fl-himalaya&quot;,
-       outf={&quot;fl-himalaya&quot;, &quot;st-rock8&quot;, &quot;st-rock7&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
+       outf={&quot;fl-himalaya&quot;, &quot;st-rock8&quot;, &quot;st-rock7&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
        endp={goal=&quot;st-explosion&quot;, alg=&quot;magnets&quot;}},
 [129]={box=&quot;st-camouflage_move&quot;, wall={&quot;st-rock9&quot;, &quot;fl-leavesb&quot;}, inf=&quot;fl-dunes&quot;,
        outf={&quot;fl-leavese1&quot;, &quot;fl-leavese2&quot;, &quot;fl-leavese3&quot;, &quot;fl-leavese4&quot;, &quot;al:waves&quot;},
-       door={&quot;fl-bridge_x&quot;, &quot;fl-bridge_y&quot;, &quot;al:random&quot;, &quot;st-none&quot;}, oxyd=&quot;d&quot;,
+       door={&quot;fl-bridge_x&quot;, &quot;fl-bridge_y&quot;, &quot;al:random&quot;, &quot;st_nil&quot;}, oxyd=&quot;d&quot;,
        endp={goal=&quot;st-camouflage_hole&quot;, alg=&quot;ralf&quot;}},
 [130]={box=&quot;st-glass1_move&quot;, wall=&quot;st-redrock&quot;, inf=&quot;fl-darkgray&quot;,
        outf={&quot;fl-black&quot;, &quot;st-redrock&quot;, &quot;st-invisible:3&quot;, &quot;al:waves&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-       endp={goal=&quot;st-none&quot;, alg=&quot;gradients&quot;}},
+       door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+       endp={goal=&quot;st_nil&quot;, alg=&quot;gradients&quot;}},
 [131]={box=&quot;st-glass1_move&quot;, wall={&quot;st-yellow&quot;, &quot;st-yellow&quot;, &quot;st-redrock&quot;, &quot;st-redrock&quot;, &quot;al:waves&quot;},
        inf=&quot;fl-wood&quot;,
        outf={&quot;fl-wood&quot;, &quot;st-yellow&quot;, &quot;st-yellow&quot;, &quot;st-redrock&quot;, &quot;st-redrock&quot;, &quot;al:waves&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
-       endp={goal={&quot;st-glass1_hole&quot;}, give=&quot;it-hammer&quot;, alg=&quot;block:st-plain_break&quot;}},
+       door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
+       endp={goal={&quot;st-glass1_hole&quot;}, give=&quot;it_hammer&quot;, alg=&quot;block:st-plain_break&quot;}},
 [132]={box=&quot;st-wood&quot;, wall=&quot;st-camouflage&quot;, inf=&quot;fl-leavesb&quot;, oxyd=&quot;d&quot;,
        outf={&quot;fl-water:3&quot;, &quot;fl-swamp&quot;,&quot;al:random&quot;}, door={&quot;fl-water&quot;, &quot;st-glass1_hole&quot;},
-       endp={goal={&quot;fl-swamp&quot;, &quot;it-none&quot;}, inf={&quot;fl-leavesb&quot;, &quot;fl-swamp&quot;, &quot;al:random&quot;}, 
+       endp={goal={&quot;fl-swamp&quot;, &quot;it_nil&quot;}, inf={&quot;fl-leavesb&quot;, &quot;fl-swamp&quot;, &quot;al:random&quot;}, 
              open_door=&quot;fl-swamp&quot;, alg=&quot;ralf&quot;}},
 [133]={box=&quot;st-glass2_move&quot;, wall=&quot;st-metal&quot;, inf=&quot;fl-metal&quot;,
-       outf={&quot;fl-space&quot;, &quot;fl-abyss:3&quot;, &quot;al:random&quot;}, door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
-       endp={goal=&quot;st-glass1_hole&quot;, give=&quot;it-sword&quot;, alg=&quot;block:st-knight&quot;}},
+       outf={&quot;fl-space&quot;, &quot;fl-abyss:3&quot;, &quot;al:random&quot;}, door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
+       endp={goal=&quot;st-glass1_hole&quot;, give=&quot;it_sword&quot;, alg=&quot;block:st_knight&quot;}},
 [134]={box=&quot;st-marble_move&quot;, wall=&quot;st-metal&quot;, inf=&quot;fl-white&quot;,
        outf={&quot;fl-abyss&quot;, &quot;st-grate1&quot;, &quot;st-invisible:3&quot;, &quot;al:waves&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
+       door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
        endp={goal=&quot;st-marble_hole&quot;, alg=&quot;fourswitch&quot;}},
 [135]={box=&quot;st-glass_move&quot;, wall=&quot;st-likeoxydc&quot;, inf=&quot;fl-white&quot;,
        outf={&quot;fl-white&quot;, &quot;st-rock1&quot;, &quot;st-invisible:3&quot;, &quot;al:random&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;c&quot;,
-       endp={goal={&quot;st-glass1_hole&quot;, &quot;it-none&quot;}, alg=&quot;hide&quot;}},
-[136]={box=&quot;st-block&quot;, wall={&quot;st-oneway_white-n&quot;, &quot;st-oneway_white-s&quot;, &quot;st-oneway_white-e&quot;, &quot;st-oneway_white-w&quot;, &quot;al:random&quot;},
+       door=&quot;st_door_a&quot;, oxyd=&quot;c&quot;,
+       endp={goal={&quot;st-glass1_hole&quot;, &quot;it_nil&quot;}, alg=&quot;hide&quot;}},
+[136]={box=&quot;st-block&quot;, wall={&quot;st_oneway_white_n&quot;, &quot;st_oneway_white_s&quot;, &quot;st_oneway_white_e&quot;, &quot;st_oneway_white_w&quot;, &quot;al:random&quot;},
        inf=&quot;fl-rough&quot;, oxyd=&quot;b&quot;,
-       outf={&quot;st-oneway_white-n&quot;, &quot;st-oneway_white-s&quot;, &quot;st-oneway_white-e&quot;, &quot;st-oneway_white-w&quot;, &quot;al:random&quot;},
+       outf={&quot;st_oneway_white_n&quot;, &quot;st_oneway_white_s&quot;, &quot;st_oneway_white_e&quot;, &quot;st_oneway_white_w&quot;, &quot;al:random&quot;},
        endp={alg=&quot;circle&quot;}},
-[137]={box={&quot;st-mirror-p-m&quot;, &quot;st-mirror-p/m&quot;, &quot;st-mirror-p\\m&quot;, &quot;st-mirror-p|m&quot;, &quot;al:random&quot;},
+[137]={box={&quot;st_mirror_slab_nm&quot;, &quot;st_mirror_slab_em&quot;, &quot;st_mirror_slab_sm&quot;, &quot;st_mirror_slab_wm&quot;, &quot;al:random&quot;},
        wall={&quot;st-glass3&quot;, &quot;fl-abyss&quot;}, inf=&quot;fl-metal&quot;, oxyd=&quot;b&quot;,
-       outf={&quot;st-mirror-p-&quot;, &quot;st-mirror-p/&quot;, &quot;st-mirror-p|&quot;, &quot;st-mirror-p\\&quot;, &quot;al:random&quot;},
+       outf={&quot;st_mirror_slab_n&quot;, &quot;st_mirror_slab_e&quot;, &quot;st_mirror_slab_s&quot;, &quot;st_mirror_slab_w&quot;, &quot;al:random&quot;},
        door=&quot;st-glass3&quot;,
-       endp={goal={&quot;st-none&quot;, &quot;it-none&quot;, &quot;fl-darkgray&quot;},
+       endp={goal={&quot;st_nil&quot;, &quot;it_nil&quot;, &quot;fl-darkgray&quot;},
              open_door=&quot;st-glass1_hole&quot;, alg=&quot;ralf&quot;}},
-[138]={box=&quot;st-shogun-s&quot;, wall=&quot;st-panel&quot;, inf=&quot;fl-stwood&quot;, goal=&quot;it-shogun-s&quot;,
+[138]={box=&quot;st_shogun_s&quot;, wall=&quot;st-panel&quot;, inf=&quot;fl-stwood&quot;, goal=&quot;it_shogun_s&quot;,
        outf=&quot;fl-water&quot;, oxyd=&quot;a&quot;,
-       endp={goal=&quot;st-none&quot;, alg=&quot;ralf&quot;, open_door=&quot;st-none&quot;}},
-[139]={box=&quot;st-shogun-s&quot;, wall=&quot;st-blocker&quot;, inf=&quot;fl-black&quot;,
+       endp={goal=&quot;st_nil&quot;, alg=&quot;ralf&quot;, open_door=&quot;st_nil&quot;}},
+[139]={box=&quot;st_shogun_s&quot;, wall=&quot;st_blocker&quot;, inf=&quot;fl-black&quot;,
        outf={&quot;st-white1&quot;, &quot;st-black1&quot;, &quot;fl-springboard&quot;, &quot;fl-abyss_fake&quot;},
-       door=&quot;st-blocker&quot;, oxyd=&quot;b&quot;,
-       endp={goal={&quot;st-none&quot;, &quot;it-none&quot;}, inf={&quot;fl-springboard&quot;, &quot;fl-abyss_fake&quot;},
+       door=&quot;st_blocker&quot;, oxyd=&quot;b&quot;,
+       endp={goal={&quot;st_nil&quot;, &quot;it_nil&quot;}, inf={&quot;fl-springboard&quot;, &quot;fl-abyss_fake&quot;},
              alg=&quot;ralf&quot;}},
 [140]={box=&quot;st-brownie&quot;, wall={&quot;st-stone1&quot;, &quot;fl-leavesb&quot;}, inf={&quot;fl-floor_001&quot;, &quot;fr:3.0&quot;},
        outf={&quot;fl-leavese4&quot;, &quot;fl-leavese2&quot;, &quot;fl-leavese1&quot;, &quot;fl-leavese3&quot;, &quot;al:waves&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
-       endp={goal={&quot;st-grate1&quot;, &quot;it-none&quot;}, alg=&quot;fourswitch&quot;}},
-[141]={box=&quot;st-brownie&quot;, wall={&quot;st-rock4&quot;, &quot;fl-leavesb&quot;}, inf={&quot;fl-bluegreenx&quot;, &quot;mf:1.0&quot;, &quot;fr:3.0&quot;},
+       door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
+       endp={goal={&quot;st-grate1&quot;, &quot;it_nil&quot;}, alg=&quot;fourswitch&quot;}},
+[141]={box=&quot;st-brownie&quot;, wall={&quot;st-rock4&quot;, &quot;fl-leavesb&quot;}, inf={&quot;fl-bluegreenx&quot;, &quot;ad:1.0&quot;, &quot;fr:3.0&quot;},
        outf={&quot;fl-water&quot;, &quot;st-rock10&quot;, &quot;st-invisible:3&quot;, &quot;al:waves&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
-       endp={goal=&quot;st-none&quot;, give=&quot;it-sword&quot;, alg=&quot;block:st-knight&quot;}},
+       door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
+       endp={goal=&quot;st_nil&quot;, give=&quot;it_sword&quot;, alg=&quot;block:st_knight&quot;}},
 [142]={box=&quot;st-glass2_move&quot;, wall={&quot;st-glass1&quot;, &quot;fl-leavesb&quot;}, inf=&quot;fl-leavesb&quot;,
        outf={&quot;fl-leavesc4&quot;, &quot;fl-leavesd2&quot;, &quot;fl-leavesc2&quot;, &quot;fl-leavese3&quot;, &quot;al:waves&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
+       door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
        endp={goal=&quot;st-glass1_hole&quot;, alg=&quot;hide&quot;}},
 [143]={box=&quot;st-block&quot;, wall={&quot;st-rock5&quot;, &quot;fl-stwood&quot;}, inf=&quot;fl-wood&quot;,
        outf={&quot;st-disco-light&quot;, &quot;fl-wood1:3&quot;, &quot;fl-wood2&quot;, &quot;al:waves&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-       endp={goal={&quot;fl-abyss&quot;, &quot;it-none&quot;}, alg=&quot;vortex&quot;}},
+       door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+       endp={goal={&quot;fl-abyss&quot;, &quot;it_nil&quot;}, alg=&quot;vortex&quot;}},
 [144]={box=&quot;st-wood&quot;, wall=&quot;st-rock6&quot;, inf=&quot;fl-bluegreen&quot;,
-       outf={&quot;fl-space&quot;, &quot;it-squashed&quot;, &quot;it-none:3&quot;, &quot;al:random&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;d&quot;,
+       outf={&quot;fl-space&quot;, &quot;it-squashed&quot;, &quot;it_nil:3&quot;, &quot;al:random&quot;},
+       door=&quot;st_door_a&quot;, oxyd=&quot;d&quot;,
        endp={goal=&quot;st-glass2_hole&quot;, wall=&quot;st-glass1_hole&quot;, alg=&quot;outside:3&quot;}},
 [145]={box=&quot;st-glass1_move&quot;, wall={&quot;st-greenbrown&quot;, &quot;fl-sand&quot;}, inf=&quot;fl-dunes&quot;,
-       outf={&quot;fl-sand&quot;, &quot;it-landmine:3&quot;, &quot;it-booze-broken&quot;, &quot;it-none:15&quot;, &quot;al:random&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
+       outf={&quot;fl-sand&quot;, &quot;it_landmine:3&quot;, &quot;it-booze-broken&quot;, &quot;it_nil:15&quot;, &quot;al:random&quot;},
+       door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
        endp={goal=&quot;st-glass1_hole&quot;, alg=&quot;allcrack:1&quot;}},
 [146]={box=&quot;st-wood&quot;, wall=&quot;st-rock1&quot;, inf=&quot;fl-black&quot;,
-       outf={&quot;fl-abyss&quot;, &quot;st-grate1&quot;, &quot;st-none:10&quot;, &quot;al:random&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;b&quot;, white = true,
-       endp={goal={&quot;st-grate1&quot;, &quot;it-none&quot;}, alg=&quot;magnets&quot;}},
+       outf={&quot;fl-abyss&quot;, &quot;st-grate1&quot;, &quot;st_nil:10&quot;, &quot;al:random&quot;},
+       door=&quot;st_door_a&quot;, oxyd=&quot;b&quot;, white = true,
+       endp={goal={&quot;st-grate1&quot;, &quot;it_nil&quot;}, alg=&quot;magnets&quot;}},
 [147]={box=&quot;st-wood&quot;, wall=&quot;st-whiteballs&quot;, inf=&quot;fl-gray&quot;, white = true,
        outf={&quot;fl-gradient5&quot;, &quot;fl-gradient6&quot;, &quot;fl-gradient7&quot;, &quot;fl-gradient8&quot;, &quot;al:waves&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-       endp={goal={&quot;st-none&quot;, &quot;it-none&quot;}, alg=&quot;gradients&quot;}},
-[148]={box=&quot;st-shogun-s&quot;, wall=&quot;st-metal&quot;, inf=&quot;fl-rough-blue&quot;, white = true,
+       door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+       endp={goal={&quot;st_nil&quot;, &quot;it_nil&quot;}, alg=&quot;gradients&quot;}},
+[148]={box=&quot;st_shogun_s&quot;, wall=&quot;st-metal&quot;, inf=&quot;fl-rough-blue&quot;, white = true,
        outf={&quot;fl-rough-red&quot;, &quot;fl-rough-blue&quot;, &quot;st-disco-light&quot;},
-       door=&quot;st-door_a&quot;, oxyd=&quot;a&quot;,
-       endp={goal=&quot;st-break_acblack&quot;, give=&quot;it-hammer&quot;, alg=&quot;block:st-break_acblack&quot;}},
-[149]={box=&quot;st-shogun-s&quot;, wall=&quot;st-yellow&quot;, inf=&quot;fl-samba&quot;,
-       outf=&quot;fl-swamp&quot;, door=&quot;st-door_a&quot;,
-       oxyd=&quot;c&quot;, goal=&quot;it-shogun-s&quot;, white = true,
+       door=&quot;st_door_a&quot;, oxyd=&quot;a&quot;,
+       endp={goal=&quot;st-break_acblack&quot;, give=&quot;it_hammer&quot;, alg=&quot;block:st-break_acblack&quot;}},
+[149]={box=&quot;st_shogun_s&quot;, wall=&quot;st-yellow&quot;, inf=&quot;fl-samba&quot;,
+       outf=&quot;fl-swamp&quot;, door=&quot;st_door_a&quot;,
+       oxyd=&quot;c&quot;, goal=&quot;it_shogun_s&quot;, white = true,
        endp={goal=&quot;st-explosion&quot;, wall={&quot;st-explosion&quot;, &quot;fl-tigris&quot;}, alg=&quot;outside&quot;}},
 
 [150]={box=&quot;st-flrock&quot;, wall=&quot;st-redrock&quot;, inf=&quot;fl-brick&quot;,
-       outf=&quot;fl-space&quot;, door=&quot;st-blocker&quot;, oxyd=&quot;a&quot;, white=true,
-       endp={goal={&quot;st-none&quot;, &quot;fl-rock&quot;, &quot;it-none&quot;}, alg=&quot;ralf&quot;}},
+       outf=&quot;fl-space&quot;, door=&quot;st_blocker&quot;, oxyd=&quot;a&quot;, white=true,
+       endp={goal={&quot;st_nil&quot;, &quot;fl-rock&quot;, &quot;it_nil&quot;}, alg=&quot;ralf&quot;}},
 }
 
 -- endp-algs: circle, ralf, hide, outside, allcrack, block, fourswitch
@@ -627,13 +627,13 @@
 
 
 -- The 75 first designs use the following boxes:
---  st-block  -&gt;  st-black, st-blocker, st-brake, st-laser, fl-swamp
---  st-brownie  -&gt;  st-coinslot, st-pull
+--  st-block  -&gt;  st-black, st_blocker, st-brake, st-laser, fl-swamp
+--  st-brownie  -&gt;  st-coinslot, st_pull
 --  st-glass_move  -&gt;  cherry
 --  st-greenbrown_move  -&gt;  hole
 --  st-marble_move  -&gt;  hole
 --  st-rock3_move  -&gt;  *
---  st-shogun  -&gt;  st-shogun-m (not completely!)
+--  st_shogun  -&gt;  st_shogun-m (not completely!)
 --  st-wood[-growing]  -&gt;  fl-swamp
 
 -- Next follows a table to convert the codes Ralf used in his levels

Modified: trunk/data/levels/lib/libsoko-endphase.xml
===================================================================
--- trunk/data/levels/lib/libsoko-endphase.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/levels/lib/libsoko-endphase.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -3,11 +3,11 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;library&quot;&gt;
       &lt;el:identity el:title=&quot;&quot; el:id=&quot;lib/libsoko-endphase&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;1&quot; el:status=&quot;experimental&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;2&quot; el:status=&quot;experimental&quot;/&gt;
       &lt;el:author el:name=&quot;Enigma Team&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
-      &lt;el:copyright&gt;Copyright &#169; 2007 Enigma Team&lt;/el:copyright&gt;
+      &lt;el:copyright&gt;Copyright &#169; 2007, 2008 Enigma Team&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
-      &lt;el:compatibility el:enigma=&quot;1.00&quot;&gt;
+      &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;false&quot; el:single=&quot;false&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:comments&gt;
@@ -26,17 +26,16 @@
 ------------------------------------------------------------------------
 
 function goal_trigger(onoff, sender)
-  local x, y = enigma.GetPos(sender)
-  local nr = enigma.GetAttrib(sender, &quot;_sokoarea&quot;)
+  local nr = sender._sokoarea
   local more_boxes = false  -- memorizes whether a box was added or removed
   if sokoarea[nr].endphase_started then
     return
   end
 
   -- A new stone? Or has a stone been removed?
-  if(enigma.GetAttrib(sender, &quot;_box&quot;) == 0) then
-    if enigma.GetStone(x,y) then
-      enigma.SetAttrib(sender, &quot;_box&quot;, 1)
+  if(sender._box == 0) then
+    if -wo:st(sender) then
+      sender._box = 1
       sokoarea[nr].goals_filled = sokoarea[nr].goals_filled + 1
       more_boxes = true
     else
@@ -44,7 +43,7 @@
       return
     end
   else
-    enigma.SetAttrib(sender, &quot;_box&quot;, 0)
+    sender._box = 0
     sokoarea[nr].goals_filled = sokoarea[nr].goals_filled - 1
   end
 
@@ -110,7 +109,7 @@
       or (alg == &quot;allcrack&quot;)
       or (alg == &quot;vortex&quot;) then
     endphase_set_block_oxyds(nr, (sokoarea[nr].design.door or
-        sokoarea[nr].design.wall or &quot;st-none&quot;), param)
+        sokoarea[nr].design.wall or &quot;st_nil&quot;), param)
     sokoarea[nr].goal_hook = endphase_goal_hook_ralf
   elseif (alg == &quot;block&quot;) then
     endphase_set_block_oxyds(nr, param)
@@ -134,8 +133,8 @@
   local endp = lib.lua.deep_copy(sokoarea[sokoarea_number].design.endp)
   local alg = endp.alg
   local param = &quot;&quot;
-  local px, py = enigma.GetPos(enigma.GetNamedObject(&quot;marble_&quot;..sokoarea_number..&quot;_1&quot;))
-  
+  local marble = po(no[&quot;marble_&quot;..sokoarea_number..&quot;_1&quot;])
+
   -- decompose alg into algorithm name and additional parameter
   local sep = string.find(alg, &quot;:&quot;)
   if sep then
@@ -157,17 +156,19 @@
   if type(give) == &quot;table&quot; then
     for k, v in pairs(give) do
       if is_item(v) or is_stone(v) or is_floor(v) then
-        set_element(px, py, sokoarea_number, &quot;&quot;, v)
+        set_element(marble, sokoarea_number, &quot;&quot;, v)
       elseif is_actor(v) then
-        set_actor(v, px + 0.5, py + 0.5)
+        wo[marble] = {v, 0.5, 0.5}
       elseif v == &quot;rubberball&quot; then
-        local old_actor = enigma.GetNamedObject(&quot;marble_&quot;..sokoarea_number..&quot;_1&quot;)
+        local old_actor = no[&quot;marble_&quot;..sokoarea_number..&quot;_1&quot;]
         local actor_kind = &quot;ac-whiteball&quot;
         if sokoarea[sokoarea_number].design.white then
           actor_kind = &quot;ac-blackball&quot;
         end
-        local new_actor = set_actor(actor_kind, px+0.5, py+0.5, {controllers=0})
-        AddRubberBand(old_actor, new_actor, 50, 0)
+        wo[marble] = {actor_kind, &quot;rubberball_sokoarea_&quot;..sokoarea_number,
+                        0.5, 0.5, controllers = 0}
+        wo:add({&quot;ot_rubberband&quot;, anchor1 = no[&quot;marble_&quot;..sokoarea_number],
+            anchor2 = no[&quot;rubberball_sokoarea_&quot;..sokoarea_number], strength = 50})
       else
         myerror(&quot;Can't give &quot;..v..&quot;.&quot;)
       end
@@ -200,7 +201,7 @@
     endphase_set_hide_oxyds(sokoarea_number)
     endphase_magnets(sokoarea_number, param)
   elseif alg == &quot;knock&quot; then
-    -- don't do anything; endphase_call_knock_item
+    -- don't do anything; endphase_call_knocking
     -- queries endphase_started.
   else
     -- use default: &quot;circle&quot;
@@ -211,9 +212,8 @@
 function endphase_redraw_level_array(sokoarea_number)
   local nr = sokoarea_number or 1
   local endp = lib.lua.deep_copy(sokoarea[nr].design.endp)
-  local dx = sokoarea[nr].offset.x
-  local dy = sokoarea[nr].offset.y
-
+  local offset = sokoarea[nr].offset
+  
   -- small routine to check the walls and outside
   local function is_oxyd_or_blocker(x,y)
     if sokoarea[nr].list_oxyd[x..&quot;/&quot;..y] then
@@ -226,21 +226,21 @@
   
   -- redraw outside
   for p, v in pairs(sokoarea[nr].list_outside) do
-    if not is_oxyd_or_blocker(v.lx, v.ly) then
-      set_element(v.lx, v.ly, nr, k, endp.outf)
+    if not is_oxyd_or_blocker(v.abs.x, v.abs.y) then
+      set_element(v.abs, nr, k, endp.outf)
     end
   end
   
   -- redraw the rest inside level_array:
   for y = 0, sokoarea[nr].array_height - 1 do
     for x = 0, sokoarea[nr].array_width - 1 do
-      if not is_oxyd_or_blocker(x+dx, y+dy) then
+      if not is_oxyd_or_blocker(x + offset.x, y + offset.y) then
         local ch = sokoarea[nr].level_array[y+1][x+1]
         for k, v in pairs(endp) do
           if    ((k == &quot;inf&quot;)  and char_is_inf(ch))
              or ((k == &quot;wall&quot;) and char_is_wall(ch))
              or ((k == &quot;goal&quot;) and char_is_goal(ch)) then
-            set_element(x+dx, y+dy, nr, k, v)
+            set_element(offset + {x,y}, nr, k, v)
           end
         end
       end
@@ -250,7 +250,7 @@
   -- if existent, redraw blocker floors
   if (sokoarea[nr].list_blocker) and (endp.inf) then
     for p, v in pairs(sokoarea[nr].list_blocker) do
-      set_element(v.lx, v.ly, nr, &quot;inf&quot;, endp.inf)
+      set_element(v.abs, nr, &quot;inf&quot;, endp.inf)
     end
   end 
 end
@@ -260,36 +260,34 @@
 ------------------------------------------------------------------------
 
 function endphase_circle(sokoarea_number)
-  local acname = &quot;marble_&quot;..sokoarea_number..&quot;_1&quot;
   local flavor = sokoarea[sokoarea_number].design.oxyd or &quot;b&quot;
-  local actor = enigma.GetNamedObject(acname)
-  if not actor then
-    acname = &quot;marble&quot;
-    actor = enigma.GetNamedObject(acname)
-    if not actor then
+  local actor = no[&quot;marble_&quot;..sokoarea_number..&quot;_1&quot;]
+  if not -actor then
+    actor = no[&quot;marble&quot;]
+    if not -actor then
       myerror(&quot;No marble found. Please name it 'marble'.&quot;)  
     end
   end
-  local x, y = enigma.GetPos(actor)
-  if x &gt; 10 then
-    x = x - 2
+  local abs = po(actor)
+  if abs.x &gt; 10 then
+    abs = abs + {-2,0}
   end
-  if y &gt; 6 then
-    y = y - 2
+  if abs.y &gt; 6 then
+    abs = abs + {0,-2}
   end
   for j = 0, 2 do
-    set_oxyd(sokoarea_number, {lx = x+j, ly = y-1}, flavor, 2*j)
-    set_oxyd(sokoarea_number, {lx = x-1, ly = y+j}, flavor, 2*j)
-    set_oxyd(sokoarea_number, {lx = x+j, ly = y+3}, flavor, 2*j+1)
-    set_oxyd(sokoarea_number, {lx = x+3, ly = y+j}, flavor, 2*j+1)
+    set_oxyd(sokoarea_number, {abs = abs + {j,-1}}, flavor, 2*j)
+    set_oxyd(sokoarea_number, {abs = abs + {-1,j}}, flavor, 2*j)
+    set_oxyd(sokoarea_number, {abs = abs + {j,3}},  flavor, 2*j+1)
+    set_oxyd(sokoarea_number, {abs = abs + {3,j}},  flavor, 2*j+1)
     for k = 0, 2 do
-      kill_stone(x+j, y+k)
-      kill_item(x+j, y+k)
-      set_element(x+j, y+k, sokoarea_number, &quot;inf&quot;)
+      wo:st(abs + {j,k}):kill()
+      wo:it(abs + {j,k}):kill()
+      set_element(abs + {j,k}, sokoarea_number, &quot;inf&quot;)
     end
   end
-  set_stone(&quot;st-fart&quot;, x+1, y+1, {_sokoarea = sokoarea_number})
-  oxyd_shuffle()
+  wo[abs + {1,1}] = {&quot;st_fart&quot;, _sokoarea = sokoarea_number}
+  wo:shuffleOxyd()
 end
 
 -- endphase_set_outside_oxyds distributes oxyds over the outside and
@@ -299,8 +297,7 @@
 function endphase_set_outside_oxyds(sokoarea_number, param)
   local places = {}
   local nr = sokoarea_number or 1
-  local dx = sokoarea[nr].offset.x
-  local dy = sokoarea[nr].offset.y
+  local offset = sokoarea[nr].offset
   local mx = sokoarea[nr].array_width
   local my = sokoarea[nr].array_height
   local flavor = sokoarea[nr].design.oxyd or &quot;b&quot;
@@ -309,7 +306,7 @@
   -- for the marble.
   for p, v in pairs(lib.lua.combine_tables(sokoarea[nr].list_outside,
                 sokoarea[nr].list_wall_two)) do
-    if (mod(v.lx, 2) == 0) and (mod(v.ly, 2) == 0) then
+    if (v.abs.x % 2 == 0) and (v.abs.y % 2 == 0) then
       table.insert(places, v)
     end
   end
@@ -321,10 +318,10 @@
     -- Not enough places? Then choose corners of level_array.
     -- They should always be at least wall_two and far enough
     -- away from each other.
-    places = { {lx = dx,           ly = dy},
-               {lx = dx + mx - 1,  ly = dy},
-               {lx = dx,           ly = dy + my - 1},
-               {lx = dx + mx - 1,  ly = dy + my - 1} }
+    places = { {abs = offset},
+               {abs = offset + {mx - 1, 0}},
+               {abs = offset + {0, my - 1}},
+               {abs = offset + {mx - 1, my - 1}}}
   elseif max &lt;  20 then  number_pairs = 2
   elseif max &lt;  50 then  number_pairs = 3
   elseif max &lt; 100 then  number_pairs = 4
@@ -340,10 +337,10 @@
   lib.lua.shuffle_table(places)
 
   for j = 1, number_pairs do
-    set_oxyd(sokoarea_number, lib.lua.deep_copy(places[2*j-1]), flavor, j - 1)
-    set_oxyd(sokoarea_number, lib.lua.deep_copy(places[2*j]), flavor, j - 1)
+    set_oxyd(sokoarea_number, places[2*j-1], flavor, j - 1)
+    set_oxyd(sokoarea_number, places[2*j], flavor, j - 1)
   end
-  oxyd_shuffle()
+  wo:shuffleOxyd()
 end
 
 function endphase_set_block_oxyds(sokoarea_number, blocker, max_pairs)
@@ -355,34 +352,32 @@
   -- and the opposite position as oxyd, if it is of type wall_two.
   -- Make sure that each possible oxyd position is assigned at most once,
   -- and that no other oxyds or blockers are near.
-  local function opposite_as_oxyd(x, y, dx, dy)
-    if     sokoarea[nr].list_way[(x+dx)..&quot;/&quot;..(y+dy)]
-       and sokoarea[nr].list_wall_two[(x-dx)..&quot;/&quot;..(y-dy)] then
+  local function opposite_as_oxyd(xy, dxy)
+    if     sokoarea[nr].list_way[(xy.x+dxy.x)..&quot;/&quot;..(xy.y+dxy.y)]
+       and sokoarea[nr].list_wall_two[(xy.x-dxy.x)..&quot;/&quot;..(xy.y-dxy.y)] then
       -- Check that no oxyd has been set on this position before
       -- and no other oxyd or blocker is near the new oxyd or its
       -- blocker.
       for j, w in pairs(oxyds) do
-        if    (lib.math.manhattan_distance(w.blocker.lx, w.blocker.ly, x, y) &lt;= 1)
-           or (lib.math.manhattan_distance(w.lx, w.ly, x, y) &lt;= 1)
-           or (lib.math.manhattan_distance(w.blocker.lx, w.blocker.ly, x-dx, y-dy) &lt;= 1)
-           or (lib.math.manhattan_distance(w.lx, w.ly, x-dx, y-dy) &lt;= 1) then
-          return false
+        if    (lib.math.manhattan_distance(w.blocker.abs, xy) &lt;= 1)
+           or (lib.math.manhattan_distance(w.abs, xy) &lt;= 1)
+           or (lib.math.manhattan_distance(w.blocker.abs, xy - dxy) &lt;= 1)
+           or (lib.math.manhattan_distance(w.abs, xy - dxy) &lt;= 1) then
+          return
         end
       end
-      table.insert(oxyds,
-         {lx = x-dx, ly = y-dy,
-          blocker = {lx = x, ly = y, oxyd = {lx = x-dx, ly = y-dy}},
-          way = {lx = x+dx, ly = y+dy}})
-      return true
+      table.insert(oxyds, {abs = xy - dxy,
+          blocker = {abs = xy, oxyd = {abs = xy - dxy}}, way = {abs = xy + dxy}})
+      return
     end
-    return false
+    return
   end
+  local directions = {po({-1,0}), po({1,0}), po({0,-1}), po({0,1})}
   for p, v in pairs(sokoarea[nr].list_wall_one) do
     if v.count == 1 then
-      opposite_as_oxyd(v.lx, v.ly, -1,  0)
-      opposite_as_oxyd(v.lx, v.ly,  1,  0)
-      opposite_as_oxyd(v.lx, v.ly,  0, -1)
-      opposite_as_oxyd(v.lx, v.ly,  0,  1)
+      for _, dir in ipairs(directions) do
+        opposite_as_oxyd(v.abs, dir)
+      end
     end
   end
 
@@ -391,7 +386,7 @@
   local number_pairs = 2
   if max &lt; 4 then
     -- Not enough places? Choose &quot;circle&quot;-algorithm instead.
-    sokoarea[nr].endp.alg = &quot;circle&quot;
+    sokoarea[nr].design.endp.alg = &quot;circle&quot;
     return
   elseif max &lt;  8 then  number_pairs = 2
   elseif max &lt; 16 then  number_pairs = 3
@@ -409,31 +404,31 @@
   -- set oxyds and blockers
   local function set_block(w)
     local myblocker = lib.lua.deep_copy(blocker)
-    -- if there's an entry &quot;st-door&quot;, choose between st-door-h and st-door-v.
+    -- If there's an entry &quot;st_door_d&quot;, choose the faces.
     if type(myblocker) == &quot;string&quot; then
       myblocker = {myblocker}
     end
     for j, v in pairs(myblocker) do
-      if v == &quot;st-door&quot; then
-        if w.lx == w.oxyd.lx then
-          myblocker[j] = &quot;st-door-h&quot;
+      if v == &quot;st_door_d&quot; then
+        if w.abs.x == w.oxyd.abs.x then
+          myblocker[j] = &quot;st_door_d&quot;
         else
-          myblocker[j] = &quot;st-door-v&quot;
+          myblocker[j] = &quot;st_door_d_ew&quot;
         end        
       end
     end
     -- now set in-floor and blocker, and add to list_blocker.
-    set_element(w.lx, w.ly, nr, &quot;inf&quot;)
-    set_element(w.lx, w.ly, nr, &quot;&quot;, myblocker)
-    sokoarea[nr].list_blocker[(w.lx)..&quot;/&quot;..(w.ly)] = lib.lua.deep_copy(w)
+    set_element(w.abs, nr, &quot;inf&quot;)
+    set_element(w.abs, nr, &quot;&quot;, myblocker)
+    sokoarea[nr].list_blocker[(w.abs.x)..&quot;/&quot;..(w.abs.y)] = lib.lua.deep_copy(w)
   end
   for j = 1, number_pairs do   -- Testlevel: 14
-    set_oxyd(nr, lib.lua.deep_copy(oxyds[2*j-1]), flavor, j - 1)
-    set_oxyd(nr, lib.lua.deep_copy(oxyds[2*j]), flavor, j - 1)
+    set_oxyd(nr, oxyds[2*j-1], flavor, j - 1)
+    set_oxyd(nr, oxyds[2*j], flavor, j - 1)
     set_block(oxyds[2*j-1].blocker)
     set_block(oxyds[2*j].blocker)
   end
-  oxyd_shuffle()
+  wo:shuffleOxyd()
 
   -- assign goals to blockers
   -- Note: There might be more goals as blockers, and, vice versa,
@@ -484,26 +479,26 @@
     set_oxyd(sokoarea_number, places[2*j-1], flavor, j - 1)
     set_oxyd(sokoarea_number, places[2*j], flavor, j - 1)
   end
-  oxyd_shuffle()  
+  wo:shuffleOxyd()
 end
 
 function endphase_gradients(sokoarea_number, param)
   local force = tonumber(param) or 25.0
   for p, v in pairs(sokoarea[sokoarea_number].list_way) do
     local grad_type = random(1,12)
-    set_floor(&quot;fl-gradient&quot;, v.lx, v.ly, {type = grad_type, force = force})
+    wo[v.abs] = {&quot;fl-gradient&quot;, type = grad_type, force = force}
   end
 end
 
 function endphase_magnets(sokoarea_number, param)
-  local force = tonumber(param) or 50.0
+  local force = tonumber(param) or 30.0
   local places = {}
   local nr = sokoarea_number or 1
   local flavor = sokoarea[nr].design.oxyd or &quot;b&quot;
 
   -- add all way-elements which are not goals
   for p, v in pairs(sokoarea[nr].list_way) do
-    if not char_is_goal(sokoarea[nr].level_array[v.ay][v.ax]) then
+    if not char_is_goal(sokoarea[nr].level_array[v.rel.y][v.rel.x]) then
       table.insert(places, v)
     end
   end
@@ -515,8 +510,7 @@
 
   -- set magnets
   for j = 1, number_magnets do
-    set_item(&quot;it-magnet-on&quot;, places[j].lx, places[j].ly,
-             {range = 5, strength = force})
+    wo[places[j].abs] = {&quot;it_magnet_on&quot;, range = 5, strength = force}
   end
 end
 
@@ -544,9 +538,9 @@
   
   -- set fourswitchs
   for j = 1, 2*number_pairs do
-    set_stone(&quot;st-fourswitch&quot;, places[j].lx, places[j].ly,
-        {action=&quot;callback&quot;, target=&quot;endphase_call_fourswitch&quot;, _number=j,
-         _sokoarea = sokoarea_number})
+    wo[places[j].abs] =
+        {&quot;st_fourswitch&quot;, target = &quot;endphase_call_fourswitch&quot;, _number = j,
+         _sokoarea = sokoarea_number}
     places[j].current = 4
     places[j].solve = random(1,4)
     places[j].correct = false
@@ -556,8 +550,8 @@
 end
 
 function endphase_call_fourswitch(onoff, sender)
-  local j = enigma.GetAttrib(sender, &quot;_number&quot;)
-  local nr = enigma.GetAttrib(sender, &quot;_sokoarea&quot;)
+  local j = sender._number
+  local nr = sender._sokoarea
   local places = sokoarea[nr].places
 
   -- When fourswitch is knocked, count it.
@@ -569,8 +563,7 @@
   -- When count is correct, make it &quot;st-likeoxyda-open&quot;.
   if places[j].current == places[j].solve then
     places[j].correct = true
-    set_stone(&quot;st-likeoxyda-open&quot;, places[j].lx, places[j].ly,
-        {_number = 0, _sokoarea = sokoarea_number})
+    wo[places[j].abs] = {&quot;st-likeoxyda-open&quot;, _number = 0, _sokoarea = sokoarea_number}
   end
 
   -- Now the difficult part: If it's the first fourswitch (the one
@@ -581,20 +574,18 @@
   -- time (making it show the new number). This means: Recursion!
   if j ~= 1 then
     -- Trigger all lower fourswitchs
-    local x = places[j-1].lx
-    local y = places[j-1].ly
+    local xy = places[j-1].abs
     if places[j-1].correct then
       -- reset the fourswitch
-      mystone = set_stone(&quot;st-fourswitch&quot;, x, y,
-        {_number = j - 1, _sokoarea = sokoarea_number})
+      wo[xy] = {&quot;st_fourswitch&quot;, _number = j - 1, _sokoarea = sokoarea_number}
+      mystone = wo:st(xy)
       for k = 1, places[j-1].current do
-        SendMessage(mystone, &quot;trigger&quot;)
+        mystone:toggle()
       end
-      enigma.SetAttrib(mystone, &quot;action&quot;, &quot;callback&quot;)
-      enigma.SetAttrib(mystone, &quot;target&quot;, &quot;endphase_call_fourswitch&quot;)
+      mystone.target = &quot;endphase_call_fourswitch&quot;
       places[j-1].correct = false
     end
-    SendMessage(enigma.GetStone(x, y), &quot;trigger&quot;)
+    wo:st(xy):toggle()
   else
     -- Check all fourswitchs
     local correct = true
@@ -607,7 +598,7 @@
         set_oxyd(sokoarea_number, places[2*k-1], flavor, k - 1)
         set_oxyd(sokoarea_number, places[2*k], flavor, k - 1)
       end
-      oxyd_shuffle()
+      wo:shuffleOxyd()
     end
   end  
 end
@@ -615,8 +606,8 @@
 
 function endphase_allcrack(sokoarea_number)
   for p, v in pairs(sokoarea[sokoarea_number].list_way) do
-    if not enigma.GetItem(v.lx, v.ly) then
-      set_item(&quot;it-crack3&quot;, v.lx, v.ly)
+    if not -wo:it(v.abs) then
+      wo[v.abs] = {&quot;it-crack3&quot;}
     end
   end  
 end
@@ -625,49 +616,48 @@
     goals_filled, number_goals)
   local nr = sokoarea_number or 1
   -- verify correct sokoarea-number and existence of &quot;goal_to_blocker&quot;
-  if nr ~= enigma.GetAttrib(sender, &quot;_sokoarea&quot;) then
+  if nr ~= sender._sokoarea then
     myerror(&quot;libsoko: Inconsistent sokoarea numbers in goal hook!&quot;)
   end
   if type(sokoarea[nr].goal_to_blocker) ~= &quot;table&quot; then
     myerror(&quot;libsoko: Blocker list is missing during goal hook!&quot;)
   end
   -- identify the corresponding door and open it
-  local goal_number = enigma.GetAttrib(sender, &quot;_goal_number&quot;)
-  local blocker = sokoarea[nr].goal_to_blocker[goal_number]
+  local blocker = sokoarea[nr].goal_to_blocker[sender._goal_number]
   if blocker then
-    endphase_ralf_open_door(nr, more_boxes, blocker.lx, blocker.ly)  
+    endphase_ralf_open_door(nr, more_boxes, blocker.abs)
   end
 end
 
 function endphase_ralf_open_doors(sokoarea_number)
   for p, v in pairs(sokoarea[sokoarea_number].list_blocker) do
-    endphase_ralf_open_door(sokoarea_number, true, v.lx, v.ly)
+    endphase_ralf_open_door(sokoarea_number, true, v.abs)
   end
 end
 
 -- endphase_ralf_open_door opens or closes a door at position
 -- (X,Y), dependend on the boolean OPEN.
-function endphase_ralf_open_door(sokoarea_number, open, x, y)
+function endphase_ralf_open_door(sokoarea_number, open, xy)
   local door_kind = sokoarea[sokoarea_number].design.endp.open_door
   if door_kind then
     if not open then
       door_kind =    sokoarea[sokoarea_number].design.door
-                  or sokoarea[sokoarea_number].design.wall or &quot;st-none&quot;
+                  or sokoarea[sokoarea_number].design.wall or &quot;st_nil&quot;
     end
-    set_element(x, y, sokoarea_number, &quot;&quot;, door_kind)
+    set_element(xy, sokoarea_number, &quot;&quot;, door_kind)
   else
     -- use default &quot;open&quot;/&quot;close&quot;-messages instead
-    local st = enigma.GetStone(x, y)
-    local it = enigma.GetItem(x, y)
-    local fl = enigma.GetFloor(x, y)
-    if st and enigma.GetAttrib(st, &quot;_sokoarea&quot;) then
-      SendMessage(st, lib.lua.cond(open, &quot;open&quot;, &quot;close&quot;))
+    local st = wo:st(xy)
+    local it = wo:it(xy)
+    local fl = wo:fl(xy)
+    if -st and st._sokoarea then
+      st:message(lib.lua.cond(open, &quot;open&quot;, &quot;close&quot;))
     end
-    if it and enigma.GetAttrib(it, &quot;_sokoarea&quot;) then
-      SendMessage(it, lib.lua.cond(open, &quot;open&quot;, &quot;close&quot;))
+    if -it and it._sokoarea then
+      it:message(lib.lua.cond(open, &quot;open&quot;, &quot;close&quot;))
     end
-    if fl then
-      SendMessage(fl, lib.lua.cond(open, &quot;close&quot;, &quot;open&quot;))
+    if -fl then
+      fl:message(lib.lua.cond(open, &quot;close&quot;, &quot;open&quot;))
     end
   end  
 end
@@ -685,26 +675,26 @@
   end
 
   -- Analyse connected components of list_way, separated by goals.
-  local function mark_component(lx, ly)
-    if     (list_way[lx..&quot;/&quot;..ly])
-       and (not list_way[lx..&quot;/&quot;..ly].component)
-       and (not sokoarea[nr].list_goal[lx..&quot;/&quot;..ly]) then
-      list_way[lx..&quot;/&quot;..ly].component = components
+  local function mark_component(xy)
+    if     (list_way[xy.x..&quot;/&quot;..xy.y])
+       and (not list_way[xy.x..&quot;/&quot;..xy.y].component)
+       and (not sokoarea[nr].list_goal[xy.x..&quot;/&quot;..xy.y]) then
+      list_way[xy.x..&quot;/&quot;..xy.y].component = components
       --set_floor(({&quot;fl-leaves&quot;, &quot;fl-ice&quot;, &quot;fl-red&quot;, &quot;fl-black&quot;, &quot;fl-white&quot;,
       --    &quot;fl-sahara&quot;, &quot;fl-light&quot;, &quot;fl-gray&quot;, &quot;fl-lightgray&quot;, &quot;fl-rough&quot;,
       --    &quot;fl-marble&quot;, &quot;fl-tigris&quot;})[components] or &quot;fl-sand&quot;, lx, ly)
-      table.insert(component[components], {lx = lx, ly = ly})
-      mark_component(lx+1, ly)
-      mark_component(lx-1, ly)
-      mark_component(lx, ly+1)
-      mark_component(lx, ly-1)
+      table.insert(component[components], {abs = xy})
+      mark_component(xy + {1,0})
+      mark_component(xy + {-1,0})
+      mark_component(xy + {0,1})
+      mark_component(xy + {0,-1})
     end
   end
   for p, v in pairs(list_way) do
     if (not list_way[p].component) and (not sokoarea[nr].list_goal[p]) then
       components = components + 1
       component[components] = {oxyds = 0}
-      mark_component(v.lx, v.ly)      
+      mark_component(v.abs)
     end    
   end
 
@@ -715,10 +705,9 @@
 
   -- Analyse oxyds and to which components they belong to.
   for p, v in pairs(sokoarea[nr].list_oxyd) do
-    local component_number = list_way[v.blocker.lx..&quot;/&quot;..v.blocker.ly].component or -1
+    local component_number = list_way[v.blocker.abs.x..&quot;/&quot;..v.blocker.abs.y].component or -1
     if component_number == -1 then
-      set_item(&quot;it-banana&quot;, v.blocker.lx, v.blocker.ly)
-      mydebug(&quot;Banana on &quot;..v.blocker.lx..&quot;/&quot;..v.blocker.ly)
+      myerror(&quot;Error in component calculation.&quot;)
     else
       component[component_number].oxyds = component[component_number].oxyds + 1
     end
@@ -728,7 +717,7 @@
   -- components, plus the one the marble actually occupies.
   local t = {}  -- helper table: components with oxyds or marble
   local u = {}  -- helper table: all components except t
-  local mx, my = enigma.GetPos(enigma.GetNamedObject(&quot;marble_&quot;..nr..&quot;_1&quot;))
+  local mx, my = po(no[&quot;marble_&quot;..nr..&quot;_1&quot;]):xy()
   local marble_component = (list_way[mx..&quot;/&quot;..my] or {}).component
   for j = 1, components do
     if (component[j].oxyds &gt; 0) or (j == marble_component) then
@@ -744,9 +733,8 @@
   end
   component = t
   components = table.getn(component)
-  u = nil
 
-  -- From each component, choose one tile and save the {lx,ly}-entry
+  -- From each component, choose one tile and save the position
   local vortex = {}
   for j = 1, components do
     table.insert(vortex, component[j][random(1, table.getn(component[j]))])
@@ -757,14 +745,14 @@
   local connect = lib.math.cyclic_permutation(components)
 
   -- Now set and connect the vortices
-  for j, v in pairs(vortex) do
+  for j, v in ipairs(vortex) do
     local w = vortex[connect[j]]
     -- Remember: We also allow (we need!) vortices at old blocker-positions.
     -- There could still be a stone over this. This stone might be st-blocker,
     -- which turns to it-blocker and has therefore to be removed. Better
     -- we remove all stones:
-    kill_stone(v.lx, v.ly)
-    set_item(&quot;it-vortex-open&quot;, v.lx, v.ly, {targetx = w.lx, targety = w.ly})
+    wo:st(v.abs):kill()
+    wo[v.abs] = {&quot;it_vortex_open&quot;, destination = w.abs}
   end  
 end
 
@@ -772,10 +760,6 @@
   local nr = sokoarea_number
   local flavor = sokoarea[nr].design.oxyd or &quot;b&quot;
   local places = {}
-  local itemkind = param
-  if (itemkind == nil) or (itemkind == &quot;&quot;) then
-    itemkind = &quot;it-sensor&quot;
-  end
 
   -- add all blockers
   for p, v in pairs(sokoarea[nr].list_blocker) do
@@ -783,63 +767,40 @@
   end
 
   lib.lua.shuffle_table(places)
-  
-  -- set items (for Enigma 1.0), set attributes of door (&gt;= 1.1)
-  for j, v in pairs(places) do
-    set_item(itemkind, v.lx, v.ly, {action=&quot;callback&quot;,
-        target=&quot;endphase_call_knocking&quot;, _number=j, _sokoarea=nr})
-    local st = enigma.GetStone(v.lx, v.ly)
-    if st then
-      enigma.SetAttrib(st, &quot;action&quot;, &quot;callback&quot;)
-      enigma.SetAttrib(st, &quot;target&quot;, &quot;endphase_call_knocking&quot;)
-      local closepos = places[lib.lua.mod(j, table.getn(places)) + 1]
-      local openpos = places[lib.lua.mod(j+1, table.getn(places)) + 1]
-      enigma.SetAttrib(st, &quot;_close_x&quot;, closepos.lx)
-      enigma.SetAttrib(st, &quot;_close_y&quot;, closepos.ly)
-      enigma.SetAttrib(st, &quot;_open_x&quot;, openpos.lx)
-      enigma.SetAttrib(st, &quot;_open_y&quot;, openpos.ly)
-      --enigma.SetAttrib(st, &quot;_close&quot;,
-      --  lib.lua.deep_copy(places[lib.lua.mod(j+1, table.getn(places)) + 1]))
-      --enigma.SetAttrib(st, &quot;_open&quot;,
-      --  lib.lua.deep_copy(places[lib.lua.mod(j+2, table.getn(places)) + 1]))
+
+  -- set attributes of door
+  for j, v in ipairs(places) do
+    local st = wo:st(v.abs)
+    if -st then
+      st.action = &quot;callback&quot;
+      st.target = &quot;endphase_call_knocking&quot;
+      st._close = places[lib.lua.mod(j, table.getn(places)) + 1].abs
+      st._open = places[lib.lua.mod(j+1, table.getn(places)) + 1].abs
+      st._number = j
     end
   end
 end
 
 function endphase_call_knocking(onoff, sender)
-  local j = enigma.GetAttrib(sender, &quot;_number&quot;)
-  local nr = enigma.GetAttrib(sender, &quot;_sokoarea&quot;)
+  local j = sender._number
+  local nr = sender._sokoarea
   if (not nr) or (not j) then
     myerror(&quot;libsoko: Knocking's source has no number or no sokoarea.&quot;)
   end
-  -- Check that it-sensor did not send its message because of
-  -- the marble standing on it:
-  local x, y = enigma.GetPos(sender)
-  local mx, my = enigma.GetPos(enigma.GetNamedObject(&quot;marble_&quot;..nr..&quot;_1&quot;))
-  if (x == mx) and (y == my) then
-    return
-  end
   mydebug(&quot;Knocked on &quot;..j..&quot;/&quot;..sokoarea[nr].number_oxyds)
   -- Deactivate the first door until endphase has started.
   if (j == 1) and (not sokoarea[nr].endphase_started) then
     mydebug(&quot;Door deactivated until endphase.&quot;)
     return
   end
-  -- Get the door (possibly it already is sender), and open or close
-  -- the neccessary doors given as attributes.
-  local mydoor = enigma.GetStone(x, y)
-  if enigma.GetAttrib(mydoor, &quot;_sokoarea&quot;) == nr then
-    local close_x = enigma.GetAttrib(mydoor, &quot;_close_x&quot;)
-    local close_y = enigma.GetAttrib(mydoor, &quot;_close_y&quot;)
-    local open_x = enigma.GetAttrib(mydoor, &quot;_open_x&quot;)
-    local open_y = enigma.GetAttrib(mydoor, &quot;_open_y&quot;)
-    local closedoor = enigma.GetStone(close_x, close_y)
-    local opendoor = enigma.GetStone(open_x, open_y)
-    if closedoor then
-      SendMessage(closedoor, &quot;close&quot;)
+  -- Open or close the neccessary doors given as attributes.
+  if sender._sokoarea == nr then
+    print(po(sender).x..&quot;/&quot;..po(sender).y..&quot;/&quot;..sender:kind())
+    if wo:st(sender._close):is(&quot;st_door&quot;) then
+      wo:st(sender._close):close()
     end
-    if opendoor then
-      SendMessage(opendoor, &quot;open&quot;)
+    if wo:st(sender._open):is(&quot;st_door&quot;) then
+      wo:st(sender._open):open()
     end
   end
 end

Modified: trunk/data/levels/lib/libsoko.xml
===================================================================
--- trunk/data/levels/lib/libsoko.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/levels/lib/libsoko.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -3,11 +3,11 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;library&quot;&gt;
       &lt;el:identity el:title=&quot;&quot; el:id=&quot;lib/libsoko&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;1&quot; el:status=&quot;experimental&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;2&quot; el:status=&quot;experimental&quot;/&gt;
       &lt;el:author el:name=&quot;Enigma Team&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
-      &lt;el:copyright&gt;Copyright &#169; 2007 Enigma Team&lt;/el:copyright&gt;
+      &lt;el:copyright&gt;Copyright &#169; 2007, 2008 Enigma Team&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
-      &lt;el:compatibility el:enigma=&quot;1.00&quot;&gt;
+      &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
         &lt;el:dependency el:path=&quot;lib/liblua&quot; el:id=&quot;lib/liblua&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
         &lt;el:dependency el:path=&quot;lib/libmath&quot; el:id=&quot;lib/libmath&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
         &lt;el:dependency el:path=&quot;lib/libsoko-designlist&quot; el:id=&quot;lib/libsoko-designlist&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
@@ -29,6 +29,8 @@
 -- to understand design tables, and libsoko-endphase.xml for goal-triggering
 -- and endphases.
 
+lib.soko = {}
+
 ------------------------------------------------------------------------
 -- Global variables
 ------------------------------------------------------------------------
@@ -83,39 +85,37 @@
 ------------------------------------------------------------------------
 
 function mydebug(st)
-  --print(st)
+  print(st)
 end
 function mywarning(st)
   print(st)
 end
 function myerror(st)
-  error(st)
+  error(st, 2)
 end
 
-function is_floor(s)        return string.sub(s, 1, 3) == &quot;fl-&quot;  end
-function is_stone(s)        return string.sub(s, 1, 3) == &quot;st-&quot;  end
-function is_item(s)         return string.sub(s, 1, 3) == &quot;it-&quot;  end
-function is_actor(s)        return string.sub(s, 1, 3) == &quot;ac-&quot;  end
-function is_algorithm(s)    return string.sub(s, 1, 3) == &quot;al:&quot;  end
-function is_friction(s)     return string.sub(s, 1, 3) == &quot;fr:&quot;  end
-function is_mousefactor(s)  return string.sub(s, 1, 3) == &quot;mf:&quot;  end
+function is_floor(s)        return string.sub(s, 1, 2) == &quot;fl&quot;  end
+function is_stone(s)        return string.sub(s, 1, 2) == &quot;st&quot;  end
+function is_item(s)         return string.sub(s, 1, 2) == &quot;it&quot;  end
+function is_actor(s)        return string.sub(s, 1, 2) == &quot;ac&quot;  end
+function char_is_outf(ch)   return string.find(ch, &quot;[ ]&quot;)       == 1  end
+function char_is_inf(ch)    return not char_is_outf(ch)               end
 function char_is_wall(ch)   return string.find(ch, &quot;[#]&quot;)       == 1  end
 function char_is_goal(ch)   return string.find(ch, &quot;[\.\*\+N]&quot;) == 1  end
 function char_is_box(ch)    return string.find(ch, &quot;[$\*]&quot;)     == 1  end
 function char_is_chess(ch)  return string.find(ch, &quot;[nN]&quot;)      == 1  end
 function char_is_player(ch) return string.find(ch, &quot;[@\+]&quot;)     == 1  end
-function char_is_outf(ch)   return string.find(ch, &quot;[ ]&quot;)       == 1  end
-function char_is_inf(ch)    return not char_is_outf(ch)               end
 
 -- choose_among_multiples selects a number between 1 and COUNT
 -- based on the coordinates X and Y and the algorithm's name ALG.
-function choose_among_multiples(x, y, count, alg)
+function choose_among_multiples(abs, count, alg)
   if alg == &quot;checkerboard&quot; then
-    return math.mod(mod(x,2)+mod(y,2), count) + 1
+    return (((abs.x%2) + (abs.y%2)) % count) + 1
   elseif alg == &quot;lines&quot; then
-    return math.mod(x + y, count) + 1
+    return ((abs.x + abs.y) % count) + 1
   elseif alg == &quot;waves&quot; then
-    return math.mod(x + y * y + x*y*x + 3*y*x*y*x, count) + 1
+    local x, y = abs:xy()
+    return ((x + y * y + x*y*x + 3*y*x*y*x) % count) + 1
   elseif alg == &quot;random&quot; then
     return math.random(count)
   end
@@ -141,8 +141,8 @@
   local entry = lib.lua.deep_copy(list_entry)
   entry.flavor = flavor
   entry.color = color
-  oxyd(entry.lx, entry.ly, flavor, color)
-  sokoarea[sokoarea_number].list_oxyd[(entry.lx)..&quot;/&quot;..(entry.ly)] = entry
+  wo[entry.abs] = {&quot;st_oxyd&quot;, flavor = flavor, oxydcolor = color}
+  sokoarea[sokoarea_number].list_oxyd[entry.abs.x..&quot;/&quot;..entry.abs.y] = entry
   sokoarea[sokoarea_number].number_oxyds =
       sokoarea[sokoarea_number].number_oxyds + 1
 end
@@ -151,8 +151,7 @@
 -- list_way, list_wall_one and list_wall_two for SOKOAREA_NUMBER.
 function create_lists(sokoarea_number)
   local nr = sokoarea_number or 1
-  local dx = sokoarea[nr].offset.x
-  local dy = sokoarea[nr].offset.y
+  local offset = sokoarea[nr].offset
   local mx = sokoarea[nr].array_width
   local my = sokoarea[nr].array_height
   sokoarea[nr].list_outside = {}
@@ -163,22 +162,24 @@
   for x = 0, mx - 1 do
     for y = 0, my - 1 do
       local ch = sokoarea[nr].level_array[y+1][x+1]
-      local entry = {lx = x+dx, ly = y+dy, ax = x+1, ay = y+1}
+      local entry = {abs = offset + {x,y}, rel = po({x+1, y+1})}
+      local sig = entry.abs.x..&quot;/&quot;..entry.abs.y
       if char_is_outf(ch) then
-        sokoarea[nr].list_outside[(x+dx)..&quot;/&quot;..(y+dy)] = entry
+        sokoarea[nr].list_outside[sig] = entry
       elseif char_is_wall(ch) then
-        sokoarea[nr].list_wall[(x+dx)..&quot;/&quot;..(y+dy)] = entry
+        sokoarea[nr].list_wall[sig] = entry
       else
-        sokoarea[nr].list_way[(x+dx)..&quot;/&quot;..(y+dy)] = entry
-      end        
+        sokoarea[nr].list_way[sig] = entry
+      end
     end
   end
   -- list_outside (outside level_array)
   if sokoarea[nr].level_width and sokoarea[nr].level_height then
     for x = 0, sokoarea[nr].level_width - 1 do
       for y = 0, sokoarea[nr].level_height - 1 do
-        if (x &lt; dx) or (x &gt; mx+dx-1) or (y &lt; dy) or (y &gt; my+dy-1) then
-          sokoarea[nr].list_outside[x..&quot;/&quot;..y] = {lx = x, ly = y}
+        if    (x &lt; offset.x) or (x &gt; mx + offset.x - 1)
+           or (y &lt; offset.y) or (y &gt; my + offset.y - 1) then
+          sokoarea[nr].list_outside[x..&quot;/&quot;..y] = {abs = po({x,y})}
         end
       end
     end
@@ -189,8 +190,8 @@
   -- (iii) it's near a way.
   -- In addition, it counts the number of near ways.
   for p, v in pairs(sokoarea[nr].list_wall) do
-    local x = v.lx
-    local y = v.ly
+    local x = v.abs.x
+    local y = v.abs.y
     if    sokoarea[nr].list_outside[(x-1)..&quot;/&quot;..(y)]
        or sokoarea[nr].list_outside[(x+1)..&quot;/&quot;..(y)]
        or sokoarea[nr].list_outside[(x)..&quot;/&quot;..(y-1)]
@@ -206,7 +207,7 @@
       if sokoarea[nr].list_way[(x)..&quot;/&quot;..(y+1)] then  count = count + 1  end
       if count &gt; 0 then
         sokoarea[nr].list_wall_one[x..&quot;/&quot;..y] =
-            {lx = x, ly = y, ax = v.ax, ay = v.ay, count = count}
+            {abs = v.abs, rel = v.rel, count = count}
       end
     end
   end
@@ -226,7 +227,7 @@
     if not sokoarea[nr].list_wall_two[x..&quot;/&quot;..y] then
       -- create new entry
       sokoarea[nr].list_wall_two[x..&quot;/&quot;..y] =
-          {lx = x, ly = y, ax = nil, ay = nil, wall_one = {}}
+          {abs = po({x,y}), rel = nil, wall_one = {}}
     end
     -- add the corresponding wall_one
     local w = table.getn(sokoarea[nr].list_wall_two[x..&quot;/&quot;..y].wall_one) + 1
@@ -234,10 +235,10 @@
         sokoarea[nr].list_wall_one[one_x..&quot;/&quot;..one_y]
   end
   for p, v in pairs(sokoarea[nr].list_wall_one) do
-    check_ii_and_iii(v.lx+1, v.ly, v.lx, v.ly)
-    check_ii_and_iii(v.lx-1, v.ly, v.lx, v.ly)
-    check_ii_and_iii(v.lx, v.ly+1, v.lx, v.ly)
-    check_ii_and_iii(v.lx, v.ly-1, v.lx, v.ly)
+    check_ii_and_iii(v.abs.x+1, v.abs.y, v.abs.x, v.abs.y)
+    check_ii_and_iii(v.abs.x-1, v.abs.y, v.abs.x, v.abs.y)
+    check_ii_and_iii(v.abs.x, v.abs.y+1, v.abs.x, v.abs.y)
+    check_ii_and_iii(v.abs.x, v.abs.y-1, v.abs.x, v.abs.y)
   end  
 end
 
@@ -248,11 +249,12 @@
   sokoarea[sokoarea_number] = {
     level_array = {},
     design = default_design,
+    algorithms = {},
     number_goals = 0,
     goals_filled = 0,
     actor_count = 0,
     endphase_started = false,
-    offset = {0, 0},
+    offset = po({0, 0}),
     level_width = nil,
     level_height = nil,
     uses_chess = false,
@@ -278,15 +280,15 @@
 
 -- set_element sets element name EL_STR of area SOKOAREA_NUMBER at x, y.
 -- EL_DESIGN is optional and overrides the design of the given sokoarea.
-function set_element(x, y, sokoarea_number, el_str, el_design)
+function set_element(abs, sokoarea_number, el_str, el_design)
   if type(sokoarea[sokoarea_number]) ~= &quot;table&quot; then
     myerror(&quot;Sokoarea table number &quot;..sokoarea_number..&quot; broken or not existing.&quot;)
   end
   local el = el_design or sokoarea[sokoarea_number].design[el_str]
   local in_endphase = sokoarea[sokoarea_number].endphase_started
 
-  if (type(x) ~= &quot;number&quot;) or (type(y) ~= &quot;number&quot;) then
-    myerror(&quot;libsoko.set_element: Coordinates are not numbers!&quot;)
+  if (usertype(abs) ~= &quot;position&quot;) then
+    myerror(&quot;libsoko.set_element: Coordinate is not a position!&quot;)
     return
   end
 
@@ -299,37 +301,33 @@
   local it = {}
   local multiple_alg = &quot;checkerboard&quot;
   local friction = nil
-  local mousefactor = nil
+  local adhesion = nil
   local fire = nil
 
   -- Now analyse EL: Decompose its entries into fl,st,it.
   -- Each entry might in turn hold a &quot;:NUMBER&quot;, which multiplicates it.
   for j, v in pairs(el or {}) do
     if type(v) == &quot;string&quot; then
-      -- Separate the multiplicator
+      -- Separate the multiplicator or argument (separated by &quot;:&quot;)
       local s = v
       local nr = 1
       local sep = string.find(v, &quot;:&quot;)
+      local arg = nil
       if sep then
         s = string.sub(v, 1, sep - 1)
-        nr = tonumber(string.sub(v, sep + 1))
+        arg = string.sub(v, sep + 1)
       end
-      if type(nr) ~= &quot;number&quot; then
-        -- Assume it's not a multiplicator, like in &quot;al:ALGORITHM&quot;.
-        s = v
-        nr = 1
-      end
 
       -- Now sort the entry into tables
-      for j = 1, nr do
-            if is_floor(s)       then  table.insert(fl, s)
-        elseif is_stone(s)       then  table.insert(st, s)
-        elseif is_item(s)        then  table.insert(it, s)
-        elseif is_algorithm(s)   then  multiple_alg = string.sub(s, 4, -1)
-        elseif is_friction(s)    then  friction = tonumber(string.sub(s, 4, -1))
-        elseif is_mousefactor(s) then  mousefactor = tonumber(string.sub(s, 4, -1))
-        elseif s == &quot;fire&quot;       then  fire = true
-        elseif s == &quot;nofire&quot;     then  fire = false
+      for j = 1, tonumber(arg) or 1 do
+            if is_floor(s)    then  table.insert(fl, s)
+        elseif is_stone(s)    then  table.insert(st, s)
+        elseif is_item(s)     then  table.insert(it, s)
+        elseif s == &quot;al&quot;      then  multiple_alg = arg
+        elseif s == &quot;fr&quot;      then  friction = tonumber(arg) or 1
+        elseif s == &quot;ad&quot;      then  adhesion = tonumber(arg) or 1
+        elseif s == &quot;fire&quot;    then  fire = true
+        elseif s == &quot;nofire&quot;  then  fire = false
         else
           mywarning(&quot;Unknown entry &quot;..j..&quot;=&quot;..s..&quot; in design element.&quot;)
         end
@@ -344,76 +342,67 @@
 
   ----------- floor --------------
   if table.getn(fl) &gt; 0 then
-    local flkind = fl[choose_among_multiples(x, y, table.getn(fl), multiple_alg)]
+    local flkind = fl[choose_among_multiples(abs, table.getn(fl), multiple_alg)]
     if flkind == &quot;fl-bridge_x&quot; then
-      created_objects.fl = set_floor(&quot;fl-bridge&quot;, x, y,
-          {type = &quot;x&quot;, burnable = false, eternal = true})
+      wo[abs] = {&quot;fl-bridge&quot;, type = &quot;x&quot;, burnable = false, eternal = true}
     elseif flkind == &quot;fl-bridge_y&quot; then
-      created_objects.fl = set_floor(&quot;fl-bridge&quot;, x, y,
-          {type = &quot;y&quot;, burnable = false, eternal = true})
+      wo[abs] = {&quot;fl-bridge&quot;, type = &quot;y&quot;, burnable = false, eternal = true}
     else
-      created_objects.fl = set_floor(flkind, x, y,
-          {burnable = false, eternal = true})
+      wo[abs] = {flkind, burnable = false, eternal = true}
     end
+    created_objects.fl = wo:fl(abs)
     if type(friction) == &quot;number&quot; then
-      enigma.SetAttrib(created_objects.fl, &quot;friction&quot;, friction)
+      created_objects.fl.friction = friction
     end
-    if type(mousefactor) == &quot;number&quot; then
-      enigma.SetAttrib(created_objects.fl, &quot;mousefactor&quot;, mousefactor)
+    if type(adhesion) == &quot;number&quot; then
+      created_objects.fl.adhesion = adhesion
     end
   end
 
   ----------- stone ---------------
   if table.getn(st) &gt; 0 then
-    local stkind = st[choose_among_multiples(x, y, table.getn(st), multiple_alg)]
-    local existing_stone = enigma.GetStone(x, y)
-    if (not existing_stone) or (enigma.GetKind(existing_stone) ~= &quot;st-oxyd&quot;) then
-      if stkind == &quot;st-none&quot; then
-        kill_stone(x, y)
-      else
-        created_objects.st = set_stone(stkind, x, y, {_sokoarea = sokoarea_number})
-      end
+    local stkind = st[choose_among_multiples(abs, table.getn(st), multiple_alg)]
+    if (not -wo:st(abs)) or (not wo:st(abs):is(&quot;st_oxyd&quot;)) then
+      wo[abs] = {stkind, _sokoarea = sokoarea_number}
+      created_objects.st = wo:st(abs)
     end
   end
 
   ----------- item ----------------
   if table.getn(it) &gt; 0 then
-    local itkind = it[choose_among_multiples(x, y, table.getn(it), multiple_alg)]
+    local itkind = it[choose_among_multiples(abs, table.getn(it), multiple_alg)]
     if sokoarea[sokoarea_number].uses_chess and not in_endphase then
-      itkind = &quot;it-trigger&quot;
-    end    
-    if itkind == &quot;it-none&quot; then
-      kill_item(x, y)
-    else
-      created_objects.it = set_item(itkind, x, y)
+      itkind = &quot;it_trigger&quot;
     end
+    wo[abs] = {itkind}
+    created_objects.it = wo:it(abs)
     if (el_str == &quot;goal&quot;) and not in_endphase then
       local gn = sokoarea[sokoarea_number].number_goals + 1
       sokoarea[sokoarea_number].number_goals = gn
-      sokoarea[sokoarea_number].list_goal[x..&quot;/&quot;..y] = 
-          {lx = x, ly = y, goal_number = gn}
+      sokoarea[sokoarea_number].list_goal[abs.x..&quot;/&quot;..abs.y] =
+          {abs = abs, goal_number = gn}
       if created_objects.it and not in_endphase then
-        enigma.SetAttrib(created_objects.it, &quot;action&quot;, &quot;callback&quot;)
-        enigma.SetAttrib(created_objects.it, &quot;target&quot;, &quot;goal_trigger&quot;)
-        enigma.SetAttrib(created_objects.it, &quot;_box&quot;, 0)
-        enigma.SetAttrib(created_objects.it, &quot;_sokoarea&quot;, sokoarea_number)
-        enigma.SetAttrib(created_objects.it, &quot;_goal_number&quot;, gn)
+        created_objects.it.action = &quot;callback&quot;
+        created_objects.it.target = &quot;goal_trigger&quot;
+        created_objects.it._box = 0
+        created_objects.it._sokoarea = sokoarea_number
+        created_objects.it._goal_number = gn
       end
     end
   end
 
   ----------- fire ----------------
   if fire ~= nil then
-    local myfloor = enigma.GetFloor(x,y)
+    local myfloor = wo:fl(abs)
     if myfloor then
       if fire then
-        enigma.SetAttrib(myfloor, &quot;burnable&quot;, true)
-        enigma.SetAttrib(myfloor, &quot;eternal&quot;, true)
-        SendMessage(myfloor, &quot;forcefire&quot;)
+        myfloor.burnable = true
+        myfloor.eternal = true
+        myfloor:message(&quot;forcefire&quot;)
       else
-        SendMessage(myfloor, &quot;stopfire&quot;)
-        enigma.SetAttrib(myfloor, &quot;burnable&quot;, false)
-        enigma.SetAttrib(myfloor, &quot;eternal&quot;, true)
+        myfloor:message(&quot;stopfire&quot;)
+        myfloor.burnable = false
+        myfloor.eternal = true
       end
     end
   end
@@ -434,8 +423,7 @@
 function draw_level_array(sokoarea_number, outside, draw_actor)
   local nr = sokoarea_number or 1
   local design = sokoarea[nr].design
-  local dx = sokoarea[nr].offset.x
-  local dy = sokoarea[nr].offset.y
+  local offset = sokoarea[nr].offset
   sokoarea[nr].list_goal = {}
 
   -- create level
@@ -443,44 +431,45 @@
     for x = 0, sokoarea[nr].array_width - 1 do
       local ch = sokoarea[nr].level_array[y+1][x+1]
       local obj = {}
+      local abs = offset + {x,y}
       
       -- set floor outside or floor inside
       if (ch == &quot; &quot;) then -- note: space stands for outside, &quot;-&quot; for inside!
         if outside then
-          kill_stone(x+dx, y+dy)
-          kill_item(x+dx, y+dy)
-          set_element(x+dx, y+dy, nr, &quot;outf&quot;)
+          wo:st(abs):kill()
+          wo:it(abs):kill()
+          set_element(abs, nr, &quot;outf&quot;)
         end
       else
-        kill_stone(x+dx, y+dy)
-        kill_item(x+dx, y+dy)
-        obj = set_element(x+dx, y+dy, nr, &quot;inf&quot;)
-        enigma.SetAttrib(obj.fl, &quot;freeze_check&quot;, true)
+        wo:st(abs):kill()
+        wo:it(abs):kill()
+        obj = set_element(abs, nr, &quot;inf&quot;)
+        obj.fl.freeze_check = true
       end
       
       -- Walls
       if char_is_wall(ch) then
-        obj = set_element(x+dx, y+dy, nr, &quot;wall&quot;)
+        obj = set_element(abs, nr, &quot;wall&quot;)
       end
       
       -- Goals
       if char_is_goal(ch) then
-        obj = set_element(x+dx, y+dy, nr, &quot;goal&quot;)
-        enigma.SetAttrib(enigma.GetFloor(x+dx, y+dy), &quot;freeze_check&quot;, false)
+        obj = set_element(abs, nr, &quot;goal&quot;)
+        wo:fl(abs).freeze_check = false
       end
       
       -- Boxes
       if char_is_box(ch) then
-        obj = set_element(x+dx, y+dy, nr, &quot;box&quot;)
-        enigma.SetAttrib(obj.st, &quot;freeze_check&quot;, true)
+        obj = set_element(abs, nr, &quot;box&quot;)
+        obj.st.freeze_check = true
       end
       
       -- Chess-Stones
       if char_is_chess(ch) then
         if design[&quot;white&quot;] then
-          set_stone(&quot;st-chess_white&quot;, x + dx, y + dy)
+          wo[abs] = {&quot;st-chess_white&quot;}
         else
-          set_stone(&quot;st-chess_black&quot;, x + dx, y + dy)
+          wo[abs] = {&quot;st-chess_black&quot;}
         end
       end
       
@@ -489,11 +478,9 @@
         sokoarea[nr].actor_count = sokoarea[nr].actor_count + 1
         local acname = &quot;marble_&quot;..nr..&quot;_&quot;..sokoarea[nr].actor_count
         if design[&quot;white&quot;] then
-          set_actor(&quot;ac-whiteball&quot;, x + 0.5 + dx, y + 0.5 + dy,
-              { name = acname, controllers = 1, player = 0 })
+          wo[abs] = {&quot;#ac-whiteball&quot;, acname, controllers = 1, player = 0}
         else
-          set_actor(&quot;ac-blackball&quot;, x + 0.5 + dx, y + 0.5 + dy,
-              { name = acname })
+          wo[abs] = {&quot;#ac-blackball&quot;, acname}
         end
       end
     end
@@ -835,7 +822,7 @@
   end
   -- fill chosen design with default values where neccessary
   design = lib.lua.combine_tables({design, default_design})
-  -- No stone set for outf, not even &quot;st-none&quot;?
+  -- No stone set for outf, not even &quot;st_nil&quot;?
   -- Use the default outf-stone instead, and remove it on endphase.
   if type(design.outf) ~= &quot;table&quot; then
     design.outf = {design.outf}
@@ -854,7 +841,7 @@
       return design
     end
   end
-  table.insert(design.endp.outf, &quot;st-none&quot;)  
+  table.insert(design.endp.outf, &quot;st_nil&quot;)  
   return design
 end
 
@@ -899,7 +886,8 @@
   local levelh = math.max(sokoarea[1].array_height, 13)
   sokoarea[1].level_width = levelw
   sokoarea[1].level_height = levelh
-  create_world(levelw, levelh)
+  ti[&quot; &quot;] = {&quot;fl-abyss&quot;}
+  wo(ti, &quot; &quot;, levelw, levelh)
   
   -- calculate padding
   local dx = 0
@@ -910,7 +898,7 @@
   if levelh &gt; sokoarea[1].array_height then
     dy = math.floor((levelh - sokoarea[1].array_height) / 2)
   end
-  sokoarea[1].offset = {x = dx, y = dy}
+  sokoarea[1].offset = po({dx, dy})
 
   -- calculate design
   sokoarea[1].design =
@@ -922,7 +910,7 @@
   -- draw level
   for x = 0, levelw - 1 do
     for y = 0, levelh - 1 do
-      set_element(x, y, 1, &quot;outf&quot;)
+      set_element(po({x,y}), 1, &quot;outf&quot;)
     end
   end
   draw_level_array(1, true, true)
@@ -931,9 +919,10 @@
   prepare_endphase(1)
 
   -- Enigma's global variables
-  enigma.ConserveLevel = FALSE
-  enigma.ShowMoves = TRUE
-  display.SetFollowMode(display.FOLLOW_SMOOTH)
+  wo[&quot;ConserveLevel&quot;] = false
+  wo[&quot;ShowMoves&quot;] = true
+  wo[&quot;FollowGrid&quot;] = false
+  wo[&quot;FollowMethod&quot;] = FOLLOW_SCROLL
 
   -- return level width and height
   return levelw, levelh
@@ -953,19 +942,18 @@
   if sokoarea[nr].level_width and sokoarea[nr].level_height then
     for x = 0, sokoarea[nr].level_width - 1 do
       for y = 0, sokoarea[nr].level_height - 1 do
-        kill_stone(x, y)
-        kill_item(x, y)
-        set_element(x, y, nr, &quot;outf&quot;)
+        wo:st(x, y):kill()
+        wo:it(x, y):kill()
+        set_element(po({x,y}), nr, &quot;outf&quot;)
       end
     end
   else
     for x = 0, sokoarea[nr].array_width - 1 do
       for y = 0, sokoarea[nr].array_height - 1 do
-        local rx = x + sokoarea[nr].offset.x
-        local ry = y + sokoarea[nr].offset.y
-        kill_stone(rx, ry)
-        kill_item(rx, ry)
-        set_element(rx, ry, nr, &quot;outf&quot;)
+        local abs = sokoarea[nr].offset + {x,y}
+        wo:st(abs):kill()
+        wo:it(abs):kill()
+        set_element(abs, nr, &quot;outf&quot;)
       end
     end
   end
@@ -997,7 +985,7 @@
 
 -- draw_sokoball draws a sokoball level from argument LEVEL, sublevel
 -- number SUBLEVEL with design DESIGN (see create_sokoball) at offset
--- DX, DY. It's arguments are identical to those of create_sokoball.
+-- OFFSET. It's arguments are identical to those of create_sokoball.
 -- Whereas create_sokoball should be used for sokoball-only levels,
 -- draw_sokoball can be used to add a sokoban type area to a larger
 -- level. The difference is as follows:
@@ -1016,7 +1004,7 @@
 -- Note: Overwriting one sokoarea with another creates problems
 --       with the triggers.
 --
-function draw_sokoball(dx, dy, level, sublevel, design, draw_actor,
+function draw_sokoball(offset, level, sublevel, design, draw_actor,
                        endphase_hook, goal_hook)
   local nr = new_sokoarea()
   -- unpack level
@@ -1024,7 +1012,7 @@
   sokoarea[nr].array_width = table.getn(sokoarea[nr].level_array[1])
   sokoarea[nr].array_height = table.getn(sokoarea[nr].level_array)
   sokoarea[nr].uses_chess = check_chess(nr)
-  sokoarea[nr].offset = {x = dx, y = dy}
+  sokoarea[nr].offset = offset
   sokoarea[nr].design = 
       design_from_description(design, sokoarea[nr].level_array)
   if hook ~= nil then

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/schemas/objects.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -18,6 +18,7 @@
     &lt;attr name=&quot;faces&quot; type=&quot;string&quot; default=&quot;nil&quot; rw=&quot;rw&quot;/&gt;
     &lt;attr name=&quot;fellows&quot; type=&quot;group&quot; default=&quot;nil&quot; rw=&quot;r&quot;/&gt;
     &lt;attr name=&quot;flavor&quot; type=&quot;string&quot; default=&quot;b&quot; rw=&quot;rw&quot;/&gt;
+    &lt;attr name=&quot;freeze_check&quot; type=&quot;bool&quot; default=&quot;false&quot; rw=&quot;rw&quot;/&gt;
     &lt;attr name=&quot;friction&quot; type=&quot;double&quot; default=&quot;nil&quot; rw=&quot;rw&quot;/&gt;
     &lt;attr name=&quot;gradient&quot; type=&quot;double&quot; default=&quot;nil&quot; rw=&quot;rw&quot;/&gt;
     &lt;attr name=&quot;hit_factor&quot; type=&quot;double&quot; default=&quot;nil&quot; rw=&quot;rw&quot;/&gt;
@@ -397,6 +398,7 @@
     &lt;object name=&quot;st&quot; abstract=&quot;true&quot;&gt;
       &lt;attr name=&quot;movable&quot; rw=&quot;r&quot;/&gt;
       &lt;attr name=&quot;fellows&quot;/&gt;
+      &lt;attr name=&quot;freeze_check&quot;/&gt;
       &lt;attr name=&quot;rubbers&quot;/&gt;
       &lt;attr name=&quot;wires&quot;/&gt;
     &lt;/object&gt;

Modified: trunk/src/stones/BoulderStone.cc
===================================================================
--- trunk/src/stones/BoulderStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/BoulderStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -157,8 +157,10 @@
         if (impulse.sender &amp;&amp; impulse.sender-&gt;is_kind(&quot;st_rotator&quot;)) {
             setDir(impulse.dir);  // activate
         }
+        int id = getId();
         move_stone(impulse.dir);  // due to rotator and impulsestone
-        propagateImpulse(impulse);
+        if (Object::getObject(id) != NULL)   // not killed?
+            propagateImpulse(impulse);
     }
 
     Direction BoulderStone::getDir() const {

Modified: trunk/src/stones/LightPassengerStone.cc
===================================================================
--- trunk/src/stones/LightPassengerStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/LightPassengerStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -172,8 +172,10 @@
         Actor *a = dynamic_cast&lt;Actor*&gt;(impulse.sender);
         if (a == NULL &amp;&amp; ((objFlags &amp; OBJBIT_LIGHTNEWDIRS) == NODIRBIT || state == OFF 
                 || server::GameCompatibility != GAMET_ENIGMA)) {
+            int id = getId();
             move_stone(impulse.dir);
-            propagateImpulse(impulse);
+            if (Object::getObject(id) != NULL)   // not killed?
+                propagateImpulse(impulse);
         }
     }
     

Modified: trunk/src/stones/PullStone.cc
===================================================================
--- trunk/src/stones/PullStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/PullStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -86,6 +86,8 @@
             return;                 // avoid unremoveable and border stones
         }
         
+        int id = getId();
+        
         PullStone *vanishStone = dynamic_cast&lt;PullStone *&gt;(MakeObject(&quot;st_pull&quot;));
         vanishStone-&gt;state = VANISHING;
         
@@ -122,8 +124,10 @@
         }
         vanishStone-&gt;setAttr(&quot;$frozen_actors&quot;, actors);
 
-        sound_event(&quot;moveslow&quot;);
-        propagateImpulse(impulse);
+        if (Object::getObject(id) != NULL) {  // not killed?
+            sound_event(&quot;moveslow&quot;);
+            propagateImpulse(impulse);
+        }
     }
     
     void PullStone::alarm() {

Modified: trunk/src/stones/RotatorStone.cc
===================================================================
--- trunk/src/stones/RotatorStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/RotatorStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -118,8 +118,10 @@
 
     void RotatorStone::on_impulse(const Impulse&amp; impulse) {
         if (objFlags &amp; OBJBIT_MOVABLE) {
+            int id = getId();
             move_stone(impulse.dir);
-            propagateImpulse(impulse);
+            if (Object::getObject(id) != NULL)   // not killed?
+                propagateImpulse(impulse);
         }
     }
     

Modified: trunk/src/stones/RubberbandStone.cc
===================================================================
--- trunk/src/stones/RubberbandStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/RubberbandStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -68,8 +68,10 @@
     void RubberbandStone::on_impulse (const Impulse&amp; impulse) {
         Actor *a = dynamic_cast&lt;Actor *&gt;(impulse.sender);
         if (a &amp;&amp; player::WieldedItemIs (a, &quot;it_magicwand&quot;)) {
+            int id = getId();
             move_stone(impulse.dir);
-            propagateImpulse(impulse);
+            if (Object::getObject(id) != NULL)   // not killed?
+                propagateImpulse(impulse);
         }
     }
 

Modified: trunk/src/stones/ShogunStone.cc
===================================================================
--- trunk/src/stones/ShogunStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/ShogunStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -153,6 +153,7 @@
 
     void ShogunStone::on_impulse(const Impulse&amp; impulse) {
         static char * soundevent = &quot;movesmall&quot;;
+        int id = getId();
         
         if (!impulse.byWire &amp;&amp; subShogun != NULL) {
             subShogun-&gt;on_impulse(impulse);
@@ -191,8 +192,8 @@
                 superShogun = s;
 
                 nss-&gt;init_model();     // display new hole         
+                setOwnerPos(newPos);   // the stone is owned at the new position
                 SendMessage(GetItem(newPos), &quot;_shogun&quot;, nss-&gt;getHoles());
-                setOwnerPos(newPos);   // the stone is owned at the new position
             }
             
             server::IncMoveCounter();
@@ -206,7 +207,8 @@
                 }
             }
         }
-        propagateImpulse(impulse);
+        if (Object::getObject(id) != NULL)   // not killed?
+            propagateImpulse(impulse);
     }
     
     int ShogunStone::getHoles() const {

Modified: trunk/src/stones/SwapStone.cc
===================================================================
--- trunk/src/stones/SwapStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/SwapStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -84,6 +84,8 @@
             propagateImpulse(impulse);
             return;                 // avoid unremoveable and border stones
         }
+
+        int id = getId();
         
         SwapStone *vanishStone = dynamic_cast&lt;SwapStone *&gt;(MakeObject(&quot;st_swap&quot;));
         vanishStone-&gt;state = VANISHING;
@@ -102,9 +104,11 @@
             if (Item *it = GetItem(newPos))
                 it-&gt;on_stonehit(this);
 
-        sound_event(&quot;moveslow&quot;);
         server::IncMoveCounter(1);
-        propagateImpulse(impulse);
+        if (Object::getObject(id) != NULL) {  // not killed?
+            sound_event(&quot;moveslow&quot;);
+            propagateImpulse(impulse);
+        }
     }
     
     void SwapStone::alarm() {

Modified: trunk/src/stones/Turnstile.cc
===================================================================
--- trunk/src/stones/Turnstile.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/Turnstile.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -144,6 +144,7 @@
         }
     
         if (can_rotate) {
+            int id = getId();
             sound_event (clockwise ? &quot;turnstileright&quot; : &quot;turnstileleft&quot;);
             sound_event(&quot;movesmall&quot;);
     
@@ -151,7 +152,10 @@
             set_anim(ecl::strf(&quot;st-turnstile%s-anim&quot;, (std::string(&quot;red&quot;) == getAttr(&quot;flavor&quot;).to_string()) ? &quot;&quot; : &quot;-green&quot;));
             rotate_arms(arms, clockwise);
             handleActorsAndItems(clockwise, impulse_sender);
-            
+
+            if (Object::getObject(id) == NULL)   // Killed? Then forget the rest.
+                return can_rotate;
+        
             Direction dir = to_direction(getAttr(&quot;orientation&quot;));
             dir = clockwise ? rotate_cw(dir) : rotate_ccw(dir);
             Stone::setAttr(&quot;orientation&quot;, dir);

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -261,7 +261,7 @@
        || ((ms_e &amp; pm) &amp;&amp; (ms_n &amp; p) &amp;&amp; (ms_se &amp; p))
        || ((ms_e &amp; pm) &amp;&amp; (ms_s &amp; p) &amp;&amp; (ms_ne &amp; p)))
     {
-        ReplaceStone(this_pos, MakeStone(&quot;st-death&quot;));
+        ReplaceStone(this_pos, MakeStone(&quot;st_death&quot;));
         // recheck neighboring stones
         // avoid endless loop with bool freeze_check_running
         if (Stone *st = GetStone(this_pos))


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000730.html">[Enigma-game-svn] r1300 - homepage/input
</A></li>
	<LI>Next message: <A HREF="000732.html">[Enigma-game-svn] r1302 - team_levelpacks/team_test_new_api
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#731">[ date ]</a>
              <a href="thread.html#731">[ thread ]</a>
              <a href="subject.html#731">[ subject ]</a>
              <a href="author.html#731">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
