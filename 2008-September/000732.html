<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1302 - team_levelpacks/team_test_new_api
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2008-September/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1302%20-%20team_levelpacks/team_test_new_api&In-Reply-To=%3C200809041154.m84BsLOv021538%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000731.html">
   <LINK REL="Next"  HREF="000733.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1302 - team_levelpacks/team_test_new_api</H1>
    <B>andreasl at mail.berlios.de</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1302%20-%20team_levelpacks/team_test_new_api&In-Reply-To=%3C200809041154.m84BsLOv021538%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1302 - team_levelpacks/team_test_new_api">andreasl at mail.berlios.de
       </A><BR>
    <I>Thu Sep  4 13:54:21 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000731.html">[Enigma-game-svn] r1301 - in trunk: data	data/levels/enigma_experimental data/levels/lib data/schemas	src src/stones
</A></li>
        <LI>Next message: <A HREF="000733.html">[Enigma-game-svn] r1303 - in trunk: data/gfx40 src src/items	src/stones
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#732">[ date ]</a>
              <a href="thread.html#732">[ thread ]</a>
              <a href="subject.html#732">[ subject ]</a>
              <a href="author.html#732">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: andreasl
Date: 2008-09-04 13:54:20 +0200 (Thu, 04 Sep 2008)
New Revision: 1302

Modified:
   team_levelpacks/team_test_new_api/andreasT02_1.xml
Log:
Test Level new API:
 - Repair/update libmap testlevel.


Modified: team_levelpacks/team_test_new_api/andreasT02_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/andreasT02_1.xml	2008-09-04 11:50:38 UTC (rev 1301)
+++ team_levelpacks/team_test_new_api/andreasT02_1.xml	2008-09-04 11:54:20 UTC (rev 1302)
@@ -2,13 +2,13 @@
 &lt;el:level xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot; xsi:schemaLocation=&quot;<A HREF="http://enigma-game.org/schema/level/1">http://enigma-game.org/schema/level/1</A> level.xsd&quot; xmlns:el=&quot;<A HREF="http://enigma-game.org/schema/level/1">http://enigma-game.org/schema/level/1</A>&quot;&gt;
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;level&quot;&gt;
-      &lt;el:identity el:title=&quot;Map Handling Luatools&quot; el:subtitle=&quot;&quot; el:id=&quot;maphandling_andreas&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;1&quot; el:status=&quot;experimental&quot;/&gt;
+      &lt;el:identity el:title=&quot;Test libmap&quot; el:subtitle=&quot;&quot; el:id=&quot;test_libmap&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;2&quot; el:status=&quot;experimental&quot;/&gt;
       &lt;el:author  el:name=&quot;Andreas Lochmann&quot; el:email=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2008 Andreas Lochmann&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
       &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
-        &lt;el:dependency el:path=&quot;lib/libluatools&quot; el:id=&quot;lib/libluatools&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
+        &lt;el:dependency el:path=&quot;lib/libmap&quot; el:id=&quot;lib/libmap&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;false&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:comments&gt;
@@ -28,12 +28,32 @@
 ti[&quot;F &quot;] = {&quot;fl-rough-blue&quot;}
 ti[&quot;G &quot;] = {&quot;fl-rough&quot;}
 ti[&quot;H &quot;] = {&quot;fl-floor_001&quot;}
+ti[&quot;I &quot;] = {&quot;fl-abyss&quot;}
+ti[&quot;J &quot;] = {&quot;fl-water&quot;}
 
-ti[&quot; @&quot;] = {&quot;#ac-blackball&quot;}
-ti[&quot; d&quot;] = {&quot;st_death&quot;}
+ti[&quot; &quot;] = {&quot;fl-sahara&quot;}
+ti[&quot;A&quot;] = {&quot;fl-leaves&quot;}
+ti[&quot;B&quot;] = {&quot;fl-swamp&quot;}
+ti[&quot;C&quot;] = {&quot;fl-metal&quot;}
+ti[&quot;D&quot;] = {&quot;fl-black&quot;}
+ti[&quot;E&quot;] = {&quot;fl-inverse&quot;}
+ti[&quot;F&quot;] = {&quot;fl-rough-blue&quot;}
+ti[&quot;G&quot;] = {&quot;fl-rough&quot;}
+ti[&quot;H&quot;] = {&quot;fl-floor_001&quot;}
+ti[&quot;R&quot;] = {&quot;fl-red&quot;}
+
+ti[&quot; @&quot;] = {&quot;#ac-blackball&quot;, &quot;marble&quot;}
+ti[&quot; d&quot;] = {&quot;st_death&quot;, &quot;death#&quot;}
 ti[&quot; 1&quot;] = {&quot;it_wrench&quot;}
+ti[&quot; S&quot;] = {&quot;st_switch&quot;, target = &quot;call_switch1&quot;}
+ti[&quot; T&quot;] = {&quot;st_switch&quot;, target = &quot;call_switch2&quot;}
+ti[&quot; U&quot;] = {&quot;st_switch&quot;, target = &quot;call_switch3&quot;}
 
-floor = {
+ti[&quot;@&quot;] = {&quot;#ac-blackball&quot;, &quot;marble&quot;}
+ti[&quot;d&quot;] = {&quot;st_death&quot;, &quot;death#&quot;}
+ti[&quot;1&quot;] = {&quot;it_wrench&quot;, &quot;wrench#&quot;}
+
+map1 = wo:newMap(&quot; &quot;, {
 &quot;                    &quot;,
 &quot;         CCCC  DDDD &quot;,
 &quot;         CCCC  DDDD &quot;,
@@ -46,45 +66,74 @@
 &quot;                    &quot;,
 &quot;                    &quot;,
 &quot;                    &quot;,
-&quot;                    &quot;}
+&quot;                    &quot;})
 
-rest = {
-&quot;                    &quot;,
+map2a = wo:newMap(&quot; &quot;, {
+&quot;1&quot;,
+&quot; &quot;,
+&quot;   &quot;,
+&quot;&quot;,
+&quot;&quot;,
+&quot;     @&quot;})
+
+map2b = wo:newMap(&quot; &quot;, {
+&quot;&quot;,
+&quot;          1   &quot;,
+&quot;          1&quot;,
+&quot;     d    1&quot;,
+&quot;          1   &quot;,
+&quot;          1   &quot;})
+
+map2c = wo:newMap(&quot; &quot;, {
 &quot;                1   &quot;,
-&quot;         d      1   &quot;,
+&quot;   d            1   &quot;,
 &quot;                1   &quot;,
 &quot;                1   &quot;,
-&quot;     @          1   &quot;,
-&quot;          d     1   &quot;,
-&quot;                1   &quot;,
-&quot;                1   &quot;,
-&quot;                1   &quot;,
 &quot;           d    1&quot;,
 &quot;                1   &quot;,
-&quot;                    &quot;}
+&quot;1                  d&quot;})
 
-new_map = luatools.fuse_map_layers(floor, rest)
+map2 = (map2a .. map2b) + map2c
+map3 = map1 * map2
+map3[{0,0}] = &quot;BS&quot;
+map3[{0, map3.height-1}] = &quot;BT&quot;
+map3[{map3.width-1, 0}] = &quot;BU&quot;
 
-luatools.print_map(floor, &quot;|&quot;)
-print(&quot;&quot;)
-luatools.print_map(rest, &quot;|&quot;)
-print(&quot;&quot;)
-luatools.print_map(new_map, &quot;|&quot;)
-print(&quot;&quot;)
+with_bars = map3 * &quot;|&quot;
+with_bars:print(true, &quot;|&quot;)
 
-layers = luatools.split_map_layers(2, new_map)
+levelw, levelh = wo(res.composer(ti), map3)
 
-for _, layer in pairs(layers) do
-  luatools.print_map(layer, &quot;|&quot;)
-  print(&quot;&quot;)
+rect_map = wo:newMap(&quot;-&quot;, map1)
+function call_switch1()
+  wo:drawMap(ti, {0, 0}, &quot;-&quot;, wo:newMap(&quot; &quot;, levelw, levelh))
+  if (rect_map.width &gt; 3) and (rect_map.height &gt; 3) then
+    local sub_map = rect_map:sub({1,1}, rect_map.width-3, rect_map.height-3)
+    rect_map = wo:newMap(&quot;R&quot;, rect_map.width - 1, rect_map.height - 1)
+    rect_map.defaultkey = &quot;-&quot;
+    rect_map:paste(sub_map, {1, 1})
+  end
+  wo:drawMap(ti, no[&quot;marble&quot;], rect_map)
 end
 
-concatted = luatools.concat_maps_vertically(floor, rest)
-luatools.print_map(concatted, &quot;|&quot;)
-print(&quot;&quot;)
+count = 0
+decomap = wo:newMap(&quot;-&quot;, {&quot;I--J&quot;, &quot;I--J&quot;, &quot;I--I&quot;}) * &quot; &quot;
+alldirs = {MAP_IDENT,MAP_ROT_CW,MAP_ROT_180,MAP_ROT_CCW,MAP_MIRROR_BACKSLASH,
+           MAP_MIRROR_HORIZONTAL,MAP_MIRROR_SLASH,MAP_MIRROR_VERTICAL}
+function call_switch2()
+  dir = alldirs[count % #alldirs + 1]
+  wo:drawMap(res.composer(ti), {0, 0}, &quot;-&quot;, map1)
+  for obj in no[&quot;death#*&quot;] do
+    wo:drawMap(res.composer(ti), obj - {1,1}, decomap^dir)
+  end
+  count = count + 1
+end
 
-w, h = wo(res.composer(ti), &quot;  &quot;, new_map)
-
+function call_switch3()
+  map1:replace(&quot;G&quot;, &quot;A&quot;)
+  wo:drawMap(res.composer(ti), {0,0}, map1)
+end
+  
   ]]&gt;&lt;/el:luamain&gt;
     &lt;el:i18n&gt;
      &lt;el:string el:key=&quot;title&quot;&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000731.html">[Enigma-game-svn] r1301 - in trunk: data	data/levels/enigma_experimental data/levels/lib data/schemas	src src/stones
</A></li>
	<LI>Next message: <A HREF="000733.html">[Enigma-game-svn] r1303 - in trunk: data/gfx40 src src/items	src/stones
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#732">[ date ]</a>
              <a href="thread.html#732">[ thread ]</a>
              <a href="subject.html#732">[ subject ]</a>
              <a href="author.html#732">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
