<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1749 - in trunk: doc/reference	lib-src/enigma-core src/gui
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1749%20-%20in%20trunk%3A%20doc/reference%0A%09lib-src/enigma-core%20src/gui&In-Reply-To=%3C200907082334.n68NY5BQ016830%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001177.html">
   <LINK REL="Next"  HREF="001179.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1749 - in trunk: doc/reference	lib-src/enigma-core src/gui</H1>
    <B>ral at mail.berlios.de</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1749%20-%20in%20trunk%3A%20doc/reference%0A%09lib-src/enigma-core%20src/gui&In-Reply-To=%3C200907082334.n68NY5BQ016830%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1749 - in trunk: doc/reference	lib-src/enigma-core src/gui">ral at mail.berlios.de
       </A><BR>
    <I>Thu Jul  9 01:34:05 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001177.html">[Enigma-game-svn] r1748 - in trunk: doc lib-src/enigma-core src	src/gui
</A></li>
        <LI>Next message: <A HREF="001179.html">[Enigma-game-svn] r 1750
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1178">[ date ]</a>
              <a href="thread.html#1178">[ thread ]</a>
              <a href="subject.html#1178">[ subject ]</a>
              <a href="author.html#1178">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ral
Date: 2009-07-09 01:33:50 +0200 (Thu, 09 Jul 2009)
New Revision: 1749

Modified:
   trunk/doc/reference/enigma-ref.texi
   trunk/lib-src/enigma-core/ecl_system.cc
   trunk/src/gui/MainMenu.cc
Log:
Trunk 1.1: 
- refman: multilevel description
- fix 1748 for Windows and local urls


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-07-07 22:53:17 UTC (rev 1748)
+++ trunk/doc/reference/enigma-ref.texi	2009-07-08 23:33:50 UTC (rev 1749)
@@ -1345,9 +1345,11 @@
 * Internationalization (i18n)::
 * Usage::
 * Update and Upgrade::
-* Using Libraries::
+* Library Files::
+* Multilevel Files::
 @end menu
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Getting Started with Levels --------------------
 @node Getting Started with Levels
 @section Getting Started with Levels
 
@@ -1465,6 +1467,7 @@
 based level metadata.
 
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- XML Level structure --------------------
 @node XML Level structure
 @section XML Level structure
 
@@ -1623,6 +1626,7 @@
 
 @end table
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Info metadata --------------------
 @node Info metadata
 @section Info metadata
 
@@ -1651,7 +1655,7 @@
 @b{Attributes:}
 
 @table @asis
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @b{type}, @i{required}, values = ``level'', ``library'', ``multilevel''
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{type}, @i{required}, values = @code{&quot;level&quot;}, @code{&quot;library&quot;}, @code{&quot;multilevel&quot;}
 You may use the schema for single Enigma levels, libraries that contain level
 description parts for reuse, and descriptions for multiple levels at once.
 
@@ -1660,18 +1664,18 @@
 use.
 
 @samp{library} are level description parts that may be included in levels.
-The library may consist simply of Lua code in the luamain node, or additional object
-descriptions in the elements node. Libraries may make use of nearly all nodes besides
-the @samp{/level/protected/info/score} and @samp{/level/*/i18n}, which both must be
-provided, but will not be evaluated. Libraries are included in levels via
-the dependency node-element. See @ref{&lt;compatibility&gt;}.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{Library Files} consist simply of Lua code in the luamain node. Libraries
+may make use of nearly all nodes besides the @samp{/level/protected/info/score}
+and @samp{/level/*/i18n}, which both must be provided, but will not be evaluated.
+Libraries are included in levels via the dependency node-element. See
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{&lt;compatibility&gt;}.
 
 @samp{multilevel} are descriptions for multiple levels at once. The main purpose
 is to support foreign game level formats, like the Sokoban level format, which
-usually describes a whole set of level maps in a single file.
+usually describes a whole set of level maps in a single file (@pxref{Multilevel Files}).
 
 @item @b{quantity}, @i{optional}
-The number of levels contained in a multilevel file.
+The number of levels contained in a multilevel file (@pxref{Multilevel Files}).
 
 @end table
 
@@ -2295,6 +2299,7 @@
 limited to pure US-ASCII. The benefit is that you can use Umlauts and
 other non-ASCII characters within it-document hints.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Internationalization (i18n) --------------------
 @node Internationalization (i18n)
 @section Internationalization (i18n)
 
@@ -2426,6 +2431,7 @@
 contains at least one mistake, the translator will correct it, as shown in the @samp{msgstr}
 string.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Usage --------------------
 @node Usage
 @section Usage
 
@@ -2573,8 +2579,9 @@
 use this element for the same purpose, with the same syntax, without modifying the author's
 protected section.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at node</A> Using Libraries
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at section</A> Using Libraries
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Library Files --------------------
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Library Files
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> Library Files
 
 Libraries are collections of Lua functions for reuse in many levels. To use a library, you must
 declare it as a dependency, as described in @ref{&lt;compatibility&gt;}. Preloading the library is all
@@ -2660,7 +2667,65 @@
 number addition will be loaded for XML load requests, too. Yet the future belongs to the new
 naming scheme, and every new library should follow it from the beginning.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Multilevel Files --------------------
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Multilevel Files
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> Multilevel Files
 
+Another concept of code reusage besides @ref{Library Files} are multilevel files.
+The code contained in a single file generates several levels, called sublevels,
+that appear as autonomous levels in a levelpack. Of course this concept is much
+less flexible than the library concept as other level files can not reuse the 
+code. But you can write a multilevel if you wrote a lot of specific code for a 
+complex level that provides more than just two variants, which would be 
+otherwise presented as @samp{difficult} and @samp{easy} @ref{&lt;modes&gt;}.
+
+But the main reason for multilevel files is the support of foreign game level
+formats like Sokoban, which describe a whole set of levels in a single file.
+Enigma imports these original files with just a few lines of code. It would be
+inefficient, even though being possible, to write an Enigma level stub for
+every level imported from a single foreign file.
+
+But multilevel files have some restrictions. They use a single set of XML
+level metadata. Thus these metadata must fit to all levels. The 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{&lt;version&gt;} will be identical as it reflects either the code version of the
+native level or the version of the imported foreign file. But the other data
+like @ref{&lt;author&gt;}, @ref{&lt;compatibility&gt;} and @ref{&lt;modes&gt;} have to match, too.
+If they do not, you can not use a multilevel file.
+
+Just the values for @samp{title} and @samp{id} will and have to differ for all
+levels described by a single multilevel file. There exists special support for
+multilevels to handle these attributes.
+
+Let us look at all attributes and features of multilevels that differ from
+standard level files.
+
+First you have to declare in the @ref{Info metadata} element the type as 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at code</A>{&quot;multilevel&quot;} and to provide the quantity of generated levels. The 
+sublevels will be numbered from 1 to the given quantity.
+
+In the element @ref{&lt;identity&gt;} you have to provide just one unique level id 
+value. Enigma will automatically append the string @code{&quot;[1]&quot;} for the first
+sublevel, @code{&quot;[2]&quot;} for the second and so on. Thus every sublevel has an
+unique id. 
+
+Additionally you should provide base title for the levels in this metadata
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{&lt;identity&gt;} element. If your title ends with a hash @samp{#} sign Enigma
+will autogenerate titles for the sublevels by appending the sublevel number to
+the given common title string.
+
+For individual sublevel titles the @ref{LUA code} has to provide the titles.
+The title in the @ref{&lt;identity&gt;} element may not end on a hash sign and will
+only be used as a default title base in case the @ref{LUA code} fails to
+provide a sublevel title. Prior execution of the Lua code the global
+attribute @ref{SublevelNumber} gets initialized. The Lua part has either way to
+load the appropriate sublevel based on this number. Now it has additionally to
+set the second special multilevel global attribute @ref{SublevelTitle}.
+
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{&lt;compatibility&gt;} externaldata
+
+
+
 @c ===================  Paradigm  =======================
 @node Enigma Paradigm
 @chapter Enigma Paradigm
@@ -8816,6 +8881,8 @@
 * RubberViolationStrength::
 * ShowMoves::
 * SlopeStrength::
+* SublevelNumber::
+* SublevelTitle::
 * SurviveFinish::
 * SwampSinkTime::
 * WaterSinkTime::
@@ -9272,6 +9339,38 @@
 @item @b{Support:} @ @ @ref{fl_slope}
 @end table
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> SublevelNumber
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> SublevelNumber
+
+A global variable that is only used by @ref{Multilevel Files}. It contains the
+number of the sublevel that should be loaded and played. The number is preset
+to a value between @code{1} and the @samp{quantity} given in the 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{Info metadata}. 
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at table</A> @asis
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Type:} @ @ int
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Values:} @ @ positive integer numbers
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Default:} @ @ @code{1}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Access:} @ @ read only
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Support:} @ @ no objects
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> table
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> SublevelTitle
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> SublevelTitle
+
+A global variable that is only used by @ref{Multilevel Files}. If the sublevel
+provides an individual title this variable must be set on level load to the
+title string. An empty string value causes an auto generated title based on
+the title given in the @ref{&lt;identity&gt;} element and the @ref{SublevelNumber}.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at table</A> @asis
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Type:} @ @ string
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Values:} @ @ any string
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Default:} @ @ @code{&quot;&quot;}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Access:} @ @ read/write
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Support:} @ @ no objects
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> table
+
 @node SurviveFinish
 @subsection SurviveFinish
 

Modified: trunk/lib-src/enigma-core/ecl_system.cc
===================================================================
--- trunk/lib-src/enigma-core/ecl_system.cc	2009-07-07 22:53:17 UTC (rev 1748)
+++ trunk/lib-src/enigma-core/ecl_system.cc	2009-07-08 23:33:50 UTC (rev 1749)
@@ -113,7 +113,7 @@
 bool ecl::BrowseUrl(const std::string url) {
     bool result = true;
 #ifdef __MINGW32__
-    result == (ShellExecute(NULL, &quot;open&quot;, url.c_str(), NULL, NULL, SW_SHOWNORMAL) &gt;= 32);
+    result == ((int)ShellExecute(NULL, &quot;open&quot;, url.c_str(), NULL, NULL, SW_SHOWNORMAL) &gt;= 32);
 #elif MACOSX
     CFStringRef cfurlStr = CFStringCreateWithCString( NULL, url.c_str(), kCFStringEncodingASCII);
 
@@ -135,7 +135,7 @@
 bool ecl::ExploreFolder(const std::string path) {
     bool result = true;
 #ifdef __MINGW32__
-    result == (ShellExecute(NULL, &quot;explore&quot;, path.c_str(), NULL, NULL, SW_SHOWNORMAL) &gt;= 32);
+    result == ((int)ShellExecute(NULL, &quot;explore&quot;, path.c_str(), NULL, NULL, SW_SHOWNORMAL) &gt;= 32);
 #elif MACOSX
     CFStringRef cfurlStr = CFStringCreateWithCString( NULL, path.c_str(), kCFStringEncodingASCII);
 

Modified: trunk/src/gui/MainMenu.cc
===================================================================
--- trunk/src/gui/MainMenu.cc	2009-07-07 22:53:17 UTC (rev 1748)
+++ trunk/src/gui/MainMenu.cc	2009-07-08 23:33:50 UTC (rev 1749)
@@ -246,7 +246,7 @@
         if (w == homepage) {
             ecl::BrowseUrl(&quot;<A HREF="http://www.enigma-game.org">http://www.enigma-game.org</A>&quot;);            
         } else if (w == docs) {
-            ecl::BrowseUrl(app.docPath + &quot;/index.html&quot;);
+            ecl::BrowseUrl(&quot;<A HREF="file://">file://</A>&quot; + app.docPath + &quot;/index.html&quot;);
         } else if (w == paths) {
             showPaths();
         } else if (w == autofolder) {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001177.html">[Enigma-game-svn] r1748 - in trunk: doc lib-src/enigma-core src	src/gui
</A></li>
	<LI>Next message: <A HREF="001179.html">[Enigma-game-svn] r 1750
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1178">[ date ]</a>
              <a href="thread.html#1178">[ thread ]</a>
              <a href="subject.html#1178">[ subject ]</a>
              <a href="author.html#1178">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
