<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r739 - in branches/1.0: data	data/levels/enigma_cross data/levels/enigma_v	data/levels/enigma_vi src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2007-May/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r739%20-%20in%20branches/1.0%3A%20data%0A%09data/levels/enigma_cross%20data/levels/enigma_v%0A%09data/levels/enigma_vi%20src&In-Reply-To=%3C200705172220.l4HMKYsx000309%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000175.html">
   <LINK REL="Next"  HREF="000177.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r739 - in branches/1.0: data	data/levels/enigma_cross data/levels/enigma_v	data/levels/enigma_vi src</H1>
    <B>raoul at BerliOS</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r739%20-%20in%20branches/1.0%3A%20data%0A%09data/levels/enigma_cross%20data/levels/enigma_v%0A%09data/levels/enigma_vi%20src&In-Reply-To=%3C200705172220.l4HMKYsx000309%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r739 - in branches/1.0: data	data/levels/enigma_cross data/levels/enigma_v	data/levels/enigma_vi src">raoul at mail.berlios.de
       </A><BR>
    <I>Fri May 18 00:20:34 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000175.html">[Enigma-game-svn] r738 - branches/1.0/src/lev
</A></li>
        <LI>Next message: <A HREF="000177.html">[Enigma-game-svn] r740 - in branches/1.0/src: gui lev
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#176">[ date ]</a>
              <a href="thread.html#176">[ thread ]</a>
              <a href="subject.html#176">[ subject ]</a>
              <a href="author.html#176">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: raoul
Date: 2007-05-18 00:20:33 +0200 (Fri, 18 May 2007)
New Revision: 739

Added:
   branches/1.0/data/levels/enigma_v/ral01_3.xml
Removed:
   branches/1.0/data/levels/enigma_v/ral01_2.xml
Modified:
   branches/1.0/data/levels/enigma_cross/newlevels.xml
   branches/1.0/data/levels/enigma_cross/newlevels_1.0.1.xml
   branches/1.0/data/levels/enigma_v/index.xml
   branches/1.0/data/levels/enigma_vi/duffy142_1.xml
   branches/1.0/data/levels/enigma_vi/index.xml
   branches/1.0/data/models-2d.lua
   branches/1.0/src/stones_complex.cc
Log:
-&gt; Bugfix #11110 &quot;Capturing a st-thief with no floortile&quot;
-&gt; New shadow (sh-grate1) for st-{black,white}3
-&gt; Levelfix &quot;Firefox&quot; (several shortcuts)
-&gt; Levelfix &quot;Construction Workers&quot; (essential-attribs)



Modified: branches/1.0/data/levels/enigma_cross/newlevels.xml
===================================================================
--- branches/1.0/data/levels/enigma_cross/newlevels.xml	2007-05-15 21:23:17 UTC (rev 738)
+++ branches/1.0/data/levels/enigma_cross/newlevels.xml	2007-05-17 22:20:33 UTC (rev 739)
@@ -143,7 +143,7 @@
     &lt;level _seq=&quot;135&quot; _title=&quot;Glacial Chasm&quot; _xpath=&quot;enigma_v/luc28_1&quot; author=&quot;Lukas Sch&#252;ller&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;luc28&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;136&quot; _title=&quot;Ice-Bomb&quot; _xpath=&quot;enigma_v/andreas21_1&quot; author=&quot;Andreas Lochmann&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;andreas21&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;137&quot; _title=&quot;- Meditation -&quot; _xpath=&quot;enigma_v/raoul08_1&quot; author=&quot;Raoul Bourquin&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;raoul08&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
-    &lt;level _seq=&quot;138&quot; _title=&quot;Firefox&quot; _xpath=&quot;enigma_v/ral01_2&quot; author=&quot;Ronald Lamprecht&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;20060213ral003&quot; rel=&quot;2&quot; rev=&quot;56&quot; score=&quot;2&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
+    &lt;level _seq=&quot;138&quot; _title=&quot;Firefox&quot; _xpath=&quot;enigma_v/ral01_3&quot; author=&quot;Ronald Lamprecht&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;20060213ral003&quot; rel=&quot;3&quot; rev=&quot;72&quot; score=&quot;3&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;139&quot; _title=&quot;You need them&quot; _xpath=&quot;enigma_v/raoul11_1&quot; author=&quot;Raoul Bourquin&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;raoul11&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;140&quot; _title=&quot;Pipes and Plumbing&quot; _xpath=&quot;enigma_v/andreas27_1&quot; author=&quot;Andreas Lochmann&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;andreas27&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;141&quot; _title=&quot;The Chamber&quot; _xpath=&quot;enigma_v/luc31_2&quot; author=&quot;Lukas Sch&#252;ller&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;luc31&quot; rel=&quot;2&quot; rev=&quot;1&quot; score=&quot;2&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;

Modified: branches/1.0/data/levels/enigma_cross/newlevels_1.0.1.xml
===================================================================
--- branches/1.0/data/levels/enigma_cross/newlevels_1.0.1.xml	2007-05-15 21:23:17 UTC (rev 738)
+++ branches/1.0/data/levels/enigma_cross/newlevels_1.0.1.xml	2007-05-17 22:20:33 UTC (rev 739)
@@ -39,7 +39,7 @@
     &lt;level _seq=&quot;31&quot; _title=&quot;Pontoon Bridges&quot; _xpath=&quot;enigma_vi/duffy137_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;duffy137&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;32&quot; _title=&quot;Parish Fair&quot; _xpath=&quot;enigma_vi/duffy143_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;duffy143&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;33&quot; _title=&quot;In the Middle&quot; _xpath=&quot;enigma_vi/duffy141_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;duffy141&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
-    &lt;level _seq=&quot;34&quot; _title=&quot;Construction Workers&quot; _xpath=&quot;enigma_vi/duffy142_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;duffy142&quot; rel=&quot;1&quot; rev=&quot;1&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
+    &lt;level _seq=&quot;34&quot; _title=&quot;Construction Workers&quot; _xpath=&quot;enigma_vi/duffy142_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;duffy142&quot; rel=&quot;1&quot; rev=&quot;2&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;35&quot; _title=&quot;One-Way Woods&quot; _xpath=&quot;enigma_vi/duffy135_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;duffy135&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;36&quot; _title=&quot;Comet&quot; _xpath=&quot;enigma_vii/duffy147_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;duffy147&quot; rel=&quot;1&quot; rev=&quot;1&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;37&quot; _title=&quot;Caribbean Waters&quot; _xpath=&quot;enigma_vii/duffy139_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;duffy139&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;

Modified: branches/1.0/data/levels/enigma_v/index.xml
===================================================================
--- branches/1.0/data/levels/enigma_v/index.xml	2007-05-15 21:23:17 UTC (rev 738)
+++ branches/1.0/data/levels/enigma_v/index.xml	2007-05-17 22:20:33 UTC (rev 739)
@@ -1,7 +1,7 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&gt;
 &lt;index xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot; xsi:noNamespaceSchemaLocation=&quot;index.xsd&quot;&gt;
 
-  &lt;info enigma=&quot;1.00&quot; group=&quot;Enigma&quot; location=&quot;10600&quot; network=&quot;false&quot; owner=&quot;Enigma Team&quot; release=&quot;1&quot; revision=&quot;1&quot; title=&quot;Enigma V&quot;/&gt;
+  &lt;info enigma=&quot;1.00&quot; group=&quot;Enigma&quot; location=&quot;10600&quot; network=&quot;false&quot; owner=&quot;Enigma Team&quot; release=&quot;1&quot; revision=&quot;2&quot; title=&quot;Enigma V&quot;/&gt;
 
   &lt;attributes/&gt;
 
@@ -96,7 +96,7 @@
     &lt;level _seq=&quot;88&quot; _title=&quot;Glacial Chasm&quot; _xpath=&quot;./luc28_1&quot; author=&quot;Lukas Sch&#252;ller&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;luc28&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;89&quot; _title=&quot;Ice-Bomb&quot; _xpath=&quot;./andreas21_1&quot; author=&quot;Andreas Lochmann&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;andreas21&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;90&quot; _title=&quot;- Meditation -&quot; _xpath=&quot;./raoul08_1&quot; author=&quot;Raoul Bourquin&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;raoul08&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
-    &lt;level _seq=&quot;91&quot; _title=&quot;Firefox&quot; _xpath=&quot;./ral01_2&quot; author=&quot;Ronald Lamprecht&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;20060213ral003&quot; rel=&quot;2&quot; rev=&quot;56&quot; score=&quot;2&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
+    &lt;level _seq=&quot;91&quot; _title=&quot;Firefox&quot; _xpath=&quot;./ral01_3&quot; author=&quot;Ronald Lamprecht&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;20060213ral003&quot; rel=&quot;3&quot; rev=&quot;72&quot; score=&quot;3&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;92&quot; _title=&quot;Enigris&quot; _xpath=&quot;./ralf04_1&quot; author=&quot;Ralf Westram&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;ralf04&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;93&quot; _title=&quot;You need them&quot; _xpath=&quot;./raoul11_1&quot; author=&quot;Raoul Bourquin&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;raoul11&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;94&quot; _title=&quot;Pipes and Plumbing&quot; _xpath=&quot;./andreas27_1&quot; author=&quot;Andreas Lochmann&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;andreas27&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;

Deleted: branches/1.0/data/levels/enigma_v/ral01_2.xml
===================================================================
--- branches/1.0/data/levels/enigma_v/ral01_2.xml	2007-05-15 21:23:17 UTC (rev 738)
+++ branches/1.0/data/levels/enigma_v/ral01_2.xml	2007-05-17 22:20:33 UTC (rev 739)
@@ -1,369 +0,0 @@
-&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&gt;
-&lt;el:level xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot; xsi:schemaLocation=&quot;<A HREF="http://enigma-game.org/schema/level/1">http://enigma-game.org/schema/level/1</A> level.xsd&quot; xmlns:el=&quot;<A HREF="http://enigma-game.org/schema/level/1">http://enigma-game.org/schema/level/1</A>&quot;&gt;
-  &lt;el:protected &gt;
-    &lt;el:info el:type=&quot;level&quot;&gt;
-      &lt;el:identity el:title=&quot;Firefox&quot; el:subtitle=&quot;Fire or be fired&quot; el:id=&quot;20060213ral003&quot;/&gt;
-      &lt;el:version el:score=&quot;2&quot; el:release=&quot;2&quot; el:revision=&quot;$Revision: 56 $&quot; el:status=&quot;released&quot;/&gt;
-      &lt;el:author  el:name=&quot;Ronald Lamprecht&quot; el:email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">ral at users.berlios.de</A>&quot;/&gt;
-      &lt;el:copyright&gt;Copyright &#169; 2006 Ronald Lamprecht&lt;/el:copyright&gt;
-      &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
-      &lt;el:compatibility el:enigma=&quot;1.00&quot;&gt;
-        &lt;el:dependency el:path=&quot;lib/natmaze&quot; el:id=&quot;lib/natmaze&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
-      &lt;/el:compatibility&gt;
-      &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
-      &lt;el:comments&gt;
-        &lt;el:credits el:showinfo=&quot;true&quot; el:showstart=&quot;false&quot;&gt;Thanks to Nat Pryce for his libs and code examples&lt;/el:credits&gt;
-        &lt;el:dedication el:showinfo=&quot;true&quot; el:showstart=&quot;false&quot;&gt;To Daniel Heck for his great work on the engine&lt;/el:dedication&gt;
-        &lt;el:code&gt;Lua 5.1&lt;/el:code&gt;
-      &lt;/el:comments&gt;
-      &lt;el:score el:easy=&quot;6:17&quot; el:difficult=&quot;11:35&quot;/&gt;
-    &lt;/el:info&gt;
-    &lt;el:luamain&gt;&lt;![CDATA[
--- Replaced st-wood by st-flrock to support new fire system. -- Andreas 27.9.06
-
-enigma.ConserveLevel = FALSE
-
-set_oxyd = oxyd
-math_floor = floor
-
-function oxyd( x, y, tiles )
-    return set_oxyd( x, y )
-end
-
-function nothing(x, y, tiles)
-    -- create nothing
-end
-
-function floor( floor_type, attribs )
-    return function( x, y, tiles )
-        return set_floor( floor_type, x, y, attribs or {} )
-    end
-end
-
-function stone( stone_type, attribs )
-    return function( x, y, tiles )
-        return set_stone( stone_type, x, y, attribs or {} )
-    end
-end
-
-function item( item_type, attribs )
-    return function( x, y, tiles )
-        return set_item( item_type, x, y, attribs or {} )
-    end
-end
-
-function actor( actor_type, attribs )
-    return function( x, y, tiles )
-        return set_actor( actor_type, x+0.5, y+0.5, attribs or {} )
-    end
-end
-
-function inherit(tile_type)
-    return function( x, y, tiles )
-        return create_tile( tiles, x, y, tile_type )
-    end
-end
-
-function create_world_from_map( tiles, map )
-    create_world( strlen(map[1]), getn(map) )
-    
-    for y = 1,getn(map) do
-        local line = map[y]
-        for x = 1,strlen(line) do
-            local tile = strchar(strbyte(line,x))
-            create_tile( tiles, x-1, y-1, tile )
-        end
-    end
-end
-
-function create_tile( tiles, x, y, tile_type )
-    local constructors = tiles[tile_type]
-
-    if constructors then
-        for i = 1,getn(constructors) do
-            constructors[i](x,y,tiles)
-        end
-    else
-        error(&quot;invalid tile identifier &quot; .. tile_type )
-    end
-end
-
-oxyd_default_flavor = &quot;a&quot;
-
-tiles = {}
-tiles[&quot;-&quot;] = {floor(&quot;fl-rock&quot;, {secure = TRUE})}
-tiles[&quot;.&quot;] = {floor(&quot;fl-hay&quot;, {secure = TRUE})}
-tiles[&quot;,&quot;] = {floor(&quot;fl-wood&quot;, {secure = TRUE})}
-tiles[&quot;i&quot;] = {floor(&quot;fl-ice&quot;, {secure = TRUE})}
-tiles[&quot; &quot;] = {inherit(&quot;.&quot;), item(&quot;it-burnable&quot;)}
-tiles[&quot;;&quot;] = {inherit(&quot;,&quot;), item(&quot;it-burnable&quot;)}
-tiles[&quot;d&quot;] = {inherit(&quot;.&quot;), item(&quot;it-dynamite&quot;)}
-tiles[&quot;h&quot;] = {inherit(&quot;.&quot;), item(&quot;it-weight&quot;)}
-tiles[&quot;L&quot;] = {inherit(&quot;.&quot;), item(&quot;it-extralife&quot;)}
-tiles[&quot;a&quot;] = {inherit(&quot;.&quot;), item(&quot;it-booze&quot;)}
-tiles[&quot;e&quot;] = {inherit(&quot;.&quot;), item(&quot;it-extinguisher_empty&quot;,{name=&quot;extinguisher1&quot;})}
-tiles[&quot;f&quot;] = {inherit(&quot;.&quot;), item(&quot;it-extinguisher&quot;)}
-tiles[&quot;T&quot;] = {inherit(&quot;.&quot;), item(&quot;it-document&quot;,{text=&quot;Do you think a bushman would start to search for an extinguisher in the cellar if a wall of fire were approaching? Be a Firefox - you have the first 5 items to deal with, no more no less!&quot;})}
-tiles[&quot;I0&quot;] = {inherit(&quot;i&quot;), item(&quot;it-crack0&quot;)}
-tiles[&quot;=&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-wood&quot;)}
-tiles[&quot;I&quot;] =  tiles[&quot;I0&quot;]
-tiles[&quot;I3&quot;] = {inherit(&quot;i&quot;), item(&quot;it-crack3&quot;)}
-tiles[&quot;I1&quot;] = {inherit(&quot;i&quot;), item(&quot;it-crack1&quot;)}
-tiles[&quot;I0&quot;] = {inherit(&quot;.&quot;), item(&quot;it-crack0&quot;)}
-tiles[&quot;G&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-grate1&quot;)}
-tiles[&quot;#&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-marble&quot;)}
-tiles[&quot;$&quot;] = {inherit(&quot; &quot;), stone(&quot;st-marble&quot;)}
-tiles[&quot;N1&quot;] = {inherit(&quot;-&quot;), item(&quot;it-trigger&quot;, {invisible=1})} -- anti cracking
-tiles[&quot;N&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-oneway_black-n&quot;)}
-tiles[&quot;S1&quot;] = {inherit(&quot;-&quot;), item(&quot;it-trigger&quot;, {invisible=1, action=&quot;callback&quot;, target=&quot;helpbrokenmaze&quot;})}
-tiles[&quot;S&quot;] = {inherit(&quot;S1&quot;), stone(&quot;st-oneway_black-s&quot;)}
-tiles[&quot;t&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-laser-n&quot;,{on=1})}
-tiles[&quot;n&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-laser-n&quot;,{name=&quot;laser1&quot;,on=0})}
-tiles[&quot;s&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-laser-s&quot;,{on=1})}
-tiles[&quot;b&quot;] = {inherit(&quot;.&quot;), item(&quot;it-blackbomb&quot;)}
-tiles[&quot;x&quot;] = {inherit(&quot;.&quot;), oxyd}
-tiles[&quot;~&quot;] = {floor(&quot;fl-water&quot;)}
-
-tiles[&quot;1&quot;] = {inherit(&quot; &quot;), actor(&quot;ac-blackball&quot;, {player=0})}
-tiles[&quot;2&quot;] = {inherit(&quot;.&quot;), item(&quot;it-trigger&quot;, {invisible=1, action=&quot;on&quot;, target=&quot;laser1&quot;})}
-tiles[&quot;3&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-switch&quot;, {action=&quot;callback&quot;, target=&quot;refill&quot;})}
-tiles[&quot;maze_wall&quot;] = { inherit(&quot;,&quot;), item(&quot;it-burnable&quot;) }
-
-if difficult then
-    tiles[&quot;5&quot;] =  tiles[&quot;h&quot;]
-    tiles[&quot;6&quot;] =  tiles[&quot;h&quot;]
-    tiles[&quot;7&quot;] =  tiles[&quot;e&quot;]
-    tiles[&quot;8&quot;] =  tiles[&quot;a&quot;]
-    tiles[&quot;9&quot;] =  tiles[&quot;d&quot;]
-    tiles[&quot;%&quot;] = {inherit(&quot;I3&quot;), stone(&quot;st-flhay&quot;)}
-    tiles[&quot;C&quot;] = {inherit(&quot;,&quot;), item(&quot;it-cross&quot;)}
-    tiles[&quot;c&quot;] =  tiles[&quot;C&quot;]
-    tiles[&quot;B&quot;] =  tiles[&quot;b&quot;]
-    tiles[&quot;w&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-flrock&quot;)}
-    tiles[&quot;W&quot;] =  tiles[&quot;,&quot;]
-else
-    tiles[&quot;5&quot;] =  tiles[&quot;d&quot;]
-    tiles[&quot;6&quot;] =  tiles[&quot;a&quot;]
-    tiles[&quot;7&quot;] =  tiles[&quot;h&quot;]
-    tiles[&quot;8&quot;] =  tiles[&quot;e&quot;]
-    tiles[&quot;9&quot;] =  tiles[&quot;h&quot;]
-    tiles[&quot;%&quot;] = {inherit(&quot;I1&quot;), stone(&quot;st-flhay&quot;)}
-    tiles[&quot;C&quot;] =  tiles[&quot;,&quot;]
-    tiles[&quot;c&quot;] =  tiles[&quot;.&quot;]
-    tiles[&quot;B&quot;] =  tiles[&quot;.&quot;]
-    tiles[&quot;w&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-wood&quot;)}
-    tiles[&quot;W&quot;] =  tiles[&quot;.&quot;]
-end
-
-
-function refill()
-    local water = 0
-    local floor = enigma.GetFloor(18, 28)
-    local water1 = false
-    local water2 = false
-    local water3 = false
-    if floor ~= nil then
-         if GetKind(floor) == &quot;fl-water&quot; then
-             water = water + 1
-             water1 = true
-         end
-    end
-    floor = enigma.GetFloor(18, 27)
-    if floor ~= nil then
-         if GetKind(floor) == &quot;fl-water&quot; then
-             water = water + 1
-             water2 = true
-         end
-    end
-    floor = enigma.GetFloor(18, 25)
-    if floor ~= nil then
-         if GetKind(floor) == &quot;fl-water&quot; then
-             water = water + 1
-             water3 = true
-         end
-    end
-
-    if water &gt; 0 then
-        local obj = enigma.GetItem(18, 26)
-        local didFill = 0
-        if obj == nil then
-            if water == 3 then
-                set_item(&quot;it-document&quot;, 18, 26, {text=&quot;You can extinguish fire with water. This is a good place to refill your extinguisher. Be aware, water is rare!&quot;})
-            end
-        else
-            if GetKind(obj) == &quot;it-extinguisher_empty&quot; then
-                set_item(&quot;it-extinguisher_medium&quot;, 18, 26, {})
-                water = water -1
-                didFill = 1
-            else
-                if GetKind(obj) == &quot;it-extinguisher_medium&quot; and water &gt; 1 then
-                    set_item(&quot;it-extinguisher&quot;, 18, 26, {})
-                    water = water - 2
-                    didFill = 2
-                end
-            end
-        end
-        if didFill &gt;= 1 and water1 then
-            set_floor(&quot;fl-swamp&quot;, 18, 28, {})
-            didFill = didFill - 1
-        end
-        if didFill &gt;= 1 and water2 then
-            set_floor(&quot;fl-swamp&quot;, 18, 27, {})
-            didFill = didFill - 1
-        end
-        if didFill &gt;= 1 and water3 then
-            set_floor(&quot;fl-swamp&quot;, 18, 25, {})
-        end
-    end
-end
-
-create_world_from_map( tiles, {
-&quot;###########x###############x###########&quot;,
-&quot;#         ===      d      ===         #&quot;,
-&quot;#                                     #&quot;,
-&quot;#                                     #&quot;,
-&quot;#                                     #&quot;,
-&quot;#                                     #&quot;,
-&quot;#=                                   =#&quot;,
-&quot;x=                                   =x&quot;,
-&quot;#=                                   =#&quot;,
-&quot;#                                     #&quot;,
-&quot;#                                     #&quot;,
-&quot;#                                     #&quot;,
-&quot;#                                     #&quot;,
-&quot;#                                     #&quot;,
-&quot;#                                     #&quot;,
-&quot;#                                     #&quot;,
-&quot;#=                                   =#&quot;,
-&quot;x=                                   =x&quot;,
-&quot;#=                                   =#&quot;,
-&quot;#                                     #&quot;,
-&quot;#                                     #&quot;,
-&quot;#                                     #&quot;,
-&quot;#                                     #&quot;,
-&quot;# ===       w           ===           #&quot;,
-&quot;###S##s##N###############x#############&quot;,
-&quot;#  -  . WCcaw    3~#     #   #   #    #&quot;,
-&quot;#     . B         -# ### # # # # # #22#&quot;,
-&quot;#     .   B       ~#Tfx#   #   #   # 1#&quot;,
-&quot;#     .           ~#################22#&quot;,
-&quot;#     .B     ;;;G###           .   ;  #&quot;,
-&quot;#     .      ;x;%  #           .   ;7 #&quot;,
-&quot;#     .      ;;;% x#           .   ;  #&quot;,
-&quot;#;;;###IIIIII#######    b      . 56;8 #&quot;,
-&quot;#           d           .      .   ;  #&quot;,
-&quot;#                       .      .   ;9 #&quot;,
-&quot;#                       .      .   ;  #&quot;,
-&quot;########################n######t#######&quot;
-})
-
-function helpbrokenmaze()
-    set_item(&quot;it-document&quot;, 20, 27, {text=&quot;OOPS! The maze is broken! Prepare to repair the maze before you destroy it.&quot;})
-end
-
-max_depth = 0
-brake_x = -1
-brake_y = -1
-brake_dir = WEST
--- Brake a maze in the middle of the longest path from an arbitrary given
--- root node.
--- Recursive preorder depth first search algorithm.
-function brake_maze(maze, path, depth, x, y, dir)
-    local endpoint = true
-    if dir ~= NORTH and  maze:contains_cell(x, y-1) and
-            maze:can_go_south(x, y-1)  then
-        endpoint = false
-        path[depth] = {cellx=x, celly=y-1, dir=SOUTH}
-        brake_maze(maze, path, depth+1, x, y-1, SOUTH)
-    end
-    if dir ~= SOUTH and  maze:contains_cell(x, y+1) and
-            maze:can_go_south(x, y)  then
-        endpoint = false
-        path[depth] = {cellx=x, celly=y, dir=SOUTH}
-        brake_maze(maze, path, depth+1, x, y+1, NORTH)
-    end
-    if dir ~= WEST and  maze:contains_cell(x-1, y) and
-            maze:can_go_east(x-1, y)  then
-        endpoint = false
-        path[depth] = {cellx=x-1, celly=y, dir=EAST}
-        brake_maze(maze, path, depth+1, x-1, y, EAST)
-    end
-    if dir ~= EAST and  maze:contains_cell(x, y) and
-            maze:can_go_east(x, y)  then
-        endpoint = false
-        path[depth] = {cellx=x, celly=y, dir=EAST}
-        brake_maze(maze, path, depth+1, x+1, y, WEST)
-    end
-    
-    if endpoint == true then
-        if max_depth &lt; depth then     
-            max_depth = depth
-            local infn =   path[math_floor(depth/2)]
-            brake_x = infn.cellx                      
-            brake_y = infn.celly
-            brake_dir = infn.dir
-        end
-    end
-end
-
-function render_broken_maze()
-    local perfect_maze = new_kruskal_maze(19,12)
-    render_maze(perfect_maze, 
-            function(maze,cellx,celly)
-                local x = 1 + cellx*2 
-                local y = 1 + celly*2
-        
-                if not maze:can_go_east(cellx,celly) and maze:contains_cell(cellx+1,celly) then
-                    create_tile( tiles, x+1, y, &quot;maze_wall&quot; )
-                end
-                
-                if not maze:can_go_south(cellx,celly) and maze:contains_cell(cellx,celly+1) then
-                    create_tile( tiles, x, y+1, &quot;maze_wall&quot; )
-                end
-                
-                if maze:contains_cell(cellx+1,celly+1) then
-                    create_tile( tiles, x+1, y+1, &quot;maze_wall&quot; )
-                end
-            end )
-    local path = {}
-    brake_maze(perfect_maze, path, 0, 0, 0, WEST)
-    if brake_dir == EAST then
-        create_tile( tiles, 2+brake_x*2, 1+brake_y*2, &quot;maze_wall&quot; )
-        if not difficult then
-            set_item(&quot;it-pin&quot;, 2+brake_x*2, 1+brake_y*2, {})
-        end
-    elseif brake_dir == SOUTH then
-        create_tile( tiles, 1+brake_x*2, 2+brake_y*2, &quot;maze_wall&quot; )
-        if not difficult then
-            set_item(&quot;it-pin&quot;, 1+brake_x*2, 2+brake_y*2, {})
-        end
-    end
-end
-
-render_broken_maze()
-oxyd_shuffle()
-    ]]&gt;&lt;/el:luamain&gt;
-    &lt;el:i18n&gt;
-      &lt;el:string el:key=&quot;title&quot;&gt;
-        &lt;el:english el:translate=&quot;false&quot;/&gt;
-      &lt;/el:string&gt;
-      &lt;el:string el:key=&quot;subtitle&quot;&gt;
-        &lt;el:english el:translate=&quot;true&quot; el:comment=&quot;Set fire or die&quot;/&gt;
-        &lt;el:translation el:lang=&quot;de&quot;&gt;Brenne oder verbrenne&lt;/el:translation&gt;
-      &lt;/el:string&gt;
-      &lt;el:string el:key=&quot;Do you think a bushman would start to search for an extinguisher in the cellar if a wall of fire were approaching? Be a Firefox - you have the first 5 items to deal with, no more no less!&quot;&gt;
-        &lt;el:english el:comment=&quot;Firefox in sense of clever in handling fire&quot;&gt;Do you think a bushman would start to search for an extinguisher in the cellar if a wall of fire were approaching? Be a Firefox - you have the first 5 items to deal with, no more no less!&lt;/el:english&gt;
-        &lt;el:translation el:lang=&quot;de&quot;&gt;W&#252;rde ein Buschmann anfangen einen Feuerl&#246;scher im Keller zu suchen, wenn eine Feuerwalze naht? Sei ein Fuchs im Feuer - es gibt nur die ersten 5 Gegenst&#228;nde die zur L&#246;sung beitragen k&#246;nnen!&lt;/el:translation&gt;
-      &lt;/el:string&gt;
-      &lt;el:string el:key=&quot;You can extinguish fire with water. This is a good place to refill your extinguisher. Be aware, water is rare!&quot;&gt;
-        &lt;el:english&gt;You can extinguish fire with water. This is a good place to refill your extinguisher. Be aware, water is rare!&lt;/el:english&gt;
-        &lt;el:translation el:lang=&quot;de&quot;&gt;Man kann Feuer mit Wasser l&#246;schen! Hier ist ein guter Ort um Feuerl&#246;scher wieder aufzuf&#252;llen. Wer Wasser verschwendet, j&#228;mmerlich verendet!&lt;/el:translation&gt;
-      &lt;/el:string&gt;
-      &lt;el:string el:key=&quot;OOPS! The maze is broken! Prepare to repair the maze before you destroy it.&quot;&gt;
-        &lt;el:english&gt;OOPS! The maze is broken! Prepare to repair the maze before you destroy it.&lt;/el:english&gt;
-        &lt;el:translation el:lang=&quot;de&quot;&gt;Oh! Das Labyrinth ist unvollst&#228;ndig! Unternimm etwas um das Labyrinth zu reparieren bevor Du es zerst&#246;rst.&lt;/el:translation&gt;
-      &lt;/el:string&gt;
-    &lt;/el:i18n&gt;
-  &lt;/el:protected&gt;
-&lt;/el:level&gt;
-

Added: branches/1.0/data/levels/enigma_v/ral01_3.xml
===================================================================
--- branches/1.0/data/levels/enigma_v/ral01_3.xml	2007-05-15 21:23:17 UTC (rev 738)
+++ branches/1.0/data/levels/enigma_v/ral01_3.xml	2007-05-17 22:20:33 UTC (rev 739)
@@ -0,0 +1,396 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&gt;
+&lt;el:level xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot; xsi:schemaLocation=&quot;<A HREF="http://enigma-game.org/schema/level/1">http://enigma-game.org/schema/level/1</A> level.xsd&quot; xmlns:el=&quot;<A HREF="http://enigma-game.org/schema/level/1">http://enigma-game.org/schema/level/1</A>&quot;&gt;
+  &lt;el:protected &gt;
+    &lt;el:info el:type=&quot;level&quot;&gt;
+      &lt;el:identity el:title=&quot;Firefox&quot; el:subtitle=&quot;Fire or be fired&quot; el:id=&quot;20060213ral003&quot;/&gt;
+      &lt;el:version el:score=&quot;3&quot; el:release=&quot;3&quot; el:revision=&quot;$Revision: 72 $&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:author  el:name=&quot;Ronald Lamprecht&quot; el:email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">ral at users.berlios.de</A>&quot;/&gt;
+      &lt;el:copyright&gt;Copyright &#169; 2006 Ronald Lamprecht&lt;/el:copyright&gt;
+      &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
+      &lt;el:compatibility el:enigma=&quot;1.00&quot;&gt;
+        &lt;el:dependency el:path=&quot;lib/natmaze&quot; el:id=&quot;lib/natmaze&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
+      &lt;/el:compatibility&gt;
+      &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
+      &lt;el:comments&gt;
+        &lt;el:credits el:showinfo=&quot;true&quot; el:showstart=&quot;false&quot;&gt;Thanks to Nat Pryce for his libs and code examples&lt;/el:credits&gt;
+        &lt;el:dedication el:showinfo=&quot;true&quot; el:showstart=&quot;false&quot;&gt;To Daniel Heck for his great work on the engine&lt;/el:dedication&gt;
+        &lt;el:code&gt;Lua 5.1&lt;/el:code&gt;
+      &lt;/el:comments&gt;
+      &lt;el:score el:easy=&quot;6:17&quot; el:difficult=&quot;11:35&quot;/&gt;
+    &lt;/el:info&gt;
+    &lt;el:luamain&gt;&lt;![CDATA[
+-- Replaced st-wood by st-flrock to support new fire system. -- Andreas 27.9.06
+
+enigma.ConserveLevel = FALSE
+
+set_oxyd = oxyd
+math_floor = floor
+oxyd_num = 0
+
+function oxyd( x, y, tiles )
+    return set_oxyd( x, y )
+end
+
+function oxydnamed( x, y, tiles )
+    local o =  set_oxyd( x, y )
+    oxyd_num = oxyd_num + 1
+    SetAttrib(o, &quot;name&quot;, &quot;oxyd&quot;..oxyd_num)
+    return o
+end
+
+function nothing(x, y, tiles)
+    -- create nothing
+end
+
+function floor( floor_type, attribs )
+    return function( x, y, tiles )
+        return set_floor( floor_type, x, y, attribs or {} )
+    end
+end
+
+function stone( stone_type, attribs )
+    return function( x, y, tiles )
+        return set_stone( stone_type, x, y, attribs or {} )
+    end
+end
+
+function item( item_type, attribs )
+    return function( x, y, tiles )
+        return set_item( item_type, x, y, attribs or {} )
+    end
+end
+
+function actor( actor_type, attribs )
+    return function( x, y, tiles )
+        return set_actor( actor_type, x+0.5, y+0.5, attribs or {} )
+    end
+end
+
+function inherit(tile_type)
+    return function( x, y, tiles )
+        return create_tile( tiles, x, y, tile_type )
+    end
+end
+
+function create_world_from_map( tiles, map )
+    create_world( strlen(map[1]), getn(map) )
+    
+    for y = 1,getn(map) do
+        local line = map[y]
+        for x = 1,strlen(line) do
+            local tile = strchar(strbyte(line,x))
+            create_tile( tiles, x-1, y-1, tile )
+        end
+    end
+end
+
+function create_tile( tiles, x, y, tile_type )
+    local constructors = tiles[tile_type]
+
+    if constructors then
+        for i = 1,getn(constructors) do
+            constructors[i](x,y,tiles)
+        end
+    else
+        error(&quot;invalid tile identifier &quot; .. tile_type )
+    end
+end
+
+oxyd_default_flavor = &quot;a&quot;
+
+tiles = {}
+tiles[&quot;-&quot;] = {floor(&quot;fl-rock&quot;, {secure = TRUE})}
+tiles[&quot;.&quot;] = {floor(&quot;fl-hay&quot;, {secure = TRUE})}
+tiles[&quot;,&quot;] = {floor(&quot;fl-wood&quot;, {secure = TRUE})}
+tiles[&quot;i&quot;] = {floor(&quot;fl-ice&quot;, {secure = TRUE})}
+tiles[&quot; &quot;] = {inherit(&quot;.&quot;), item(&quot;it-burnable&quot;)}
+tiles[&quot;;&quot;] = {inherit(&quot;,&quot;), item(&quot;it-burnable&quot;)}
+tiles[&quot;*&quot;] = {inherit(&quot;,&quot;), item(&quot;it-cross&quot;)}
+tiles[&quot;d&quot;] = {inherit(&quot;.&quot;), item(&quot;it-dynamite&quot;)}
+tiles[&quot;h&quot;] = {inherit(&quot;.&quot;), item(&quot;it-weight&quot;)}
+tiles[&quot;L&quot;] = {inherit(&quot;.&quot;), item(&quot;it-extralife&quot;)}
+tiles[&quot;a&quot;] = {inherit(&quot;.&quot;), item(&quot;it-booze&quot;)}
+tiles[&quot;z&quot;] = {inherit(&quot;.&quot;), item(&quot;it-hammer&quot;)}
+tiles[&quot;e&quot;] = {inherit(&quot;.&quot;), item(&quot;it-extinguisher_empty&quot;,{name=&quot;extinguisher1&quot;})}
+tiles[&quot;f&quot;] = {inherit(&quot;-&quot;), item(&quot;it-extinguisher_medium&quot;)}
+tiles[&quot;T&quot;] = {inherit(&quot;-&quot;), item(&quot;it-document&quot;,{text=&quot;Do you think a bushman would start to search for an extinguisher in the cellar if a wall of fire were approaching? Be a Firefox - you have the first 5 items to deal with, no more no less!&quot;})}
+tiles[&quot;I0&quot;] = {inherit(&quot;i&quot;), item(&quot;it-crack0&quot;)}
+tiles[&quot;=&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-wood&quot;)}
+tiles[&quot;I&quot;] =  tiles[&quot;I0&quot;]
+tiles[&quot;I3&quot;] = {inherit(&quot;i&quot;), item(&quot;it-crack3&quot;)}
+tiles[&quot;I1&quot;] = {inherit(&quot;i&quot;), item(&quot;it-crack1&quot;)}
+tiles[&quot;I0&quot;] = {inherit(&quot;.&quot;), item(&quot;it-crack0&quot;)}
+tiles[&quot;G&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-grate1&quot;)}
+tiles[&quot;#&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-marble&quot;)}
+tiles[&quot;$&quot;] = {inherit(&quot; &quot;), stone(&quot;st-marble&quot;)}
+tiles[&quot;N1&quot;] = {inherit(&quot;-&quot;), item(&quot;it-trigger&quot;, {invisible=1})} -- anti cracking
+tiles[&quot;N&quot;] = {inherit(&quot;,&quot;), stone(&quot;st-oneway_black-n&quot;)}
+tiles[&quot;S1&quot;] = {inherit(&quot;-&quot;), item(&quot;it-trigger&quot;, {invisible=1, action=&quot;callback&quot;, target=&quot;helpbrokenmaze&quot;})}
+tiles[&quot;S&quot;] = {inherit(&quot;S1&quot;), stone(&quot;st-oneway_black-s&quot;)}
+tiles[&quot;t&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-laser-n&quot;,{on=1})}
+tiles[&quot;n&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-laser-n&quot;,{name=&quot;laser1&quot;,on=0})}
+tiles[&quot;s&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-laser-s&quot;,{on=1})}
+tiles[&quot;b&quot;] = {inherit(&quot;.&quot;), item(&quot;it-blackbomb&quot;)}
+tiles[&quot;x&quot;] = {inherit(&quot;.&quot;), oxyd}
+tiles[&quot;y&quot;] = {inherit(&quot;.&quot;), oxydnamed}
+tiles[&quot;~&quot;] = {floor(&quot;fl-water&quot;)}
+tiles[&quot;R&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-flrock&quot;)}
+tiles[&quot;H&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-flhay&quot;)}
+tiles[&quot;X1&quot;] = {inherit(&quot;-&quot;), item(&quot;it-cross&quot;)}
+tiles[&quot;X&quot;] = {inherit(&quot;X1&quot;), stone(&quot;st-break_gray&quot;)}
+tiles[&quot;j&quot;] = {inherit(&quot;-&quot;), item(&quot;it-sensor&quot;,{action=&quot;setfire&quot;, target=&quot;homefire&quot;})}
+tiles[&quot;J&quot;] = {floor(&quot;fl-hay&quot;, {secure = TRUE, name=&quot;homefire&quot;})}
+
+tiles[&quot;1&quot;] = {inherit(&quot; &quot;), actor(&quot;ac-blackball&quot;, {player=0})}
+tiles[&quot;2&quot;] = {inherit(&quot;.&quot;), item(&quot;it-trigger&quot;, {invisible=1, action=&quot;on&quot;, target=&quot;laser1&quot;})}
+tiles[&quot;3&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-switch&quot;, {action=&quot;callback&quot;, target=&quot;refill&quot;})}
+tiles[&quot;maze_wall&quot;] = { inherit(&quot;,&quot;), item(&quot;it-burnable&quot;) }
+
+if difficult then
+    tiles[&quot;5&quot;] =  tiles[&quot;h&quot;]
+    tiles[&quot;6&quot;] =  tiles[&quot;h&quot;]
+    tiles[&quot;7&quot;] =  tiles[&quot;e&quot;]
+    tiles[&quot;8&quot;] =  tiles[&quot;z&quot;]
+    tiles[&quot;9&quot;] =  tiles[&quot;d&quot;]
+    tiles[&quot;%&quot;] = {inherit(&quot;I3&quot;), stone(&quot;st-flhay&quot;)}
+    tiles[&quot;C&quot;] = {inherit(&quot;,&quot;), item(&quot;it-cross&quot;)}
+    tiles[&quot;c&quot;] =  tiles[&quot;C&quot;]
+    tiles[&quot;B&quot;] =  tiles[&quot;b&quot;]
+    tiles[&quot;w&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-flrock&quot;)}
+    tiles[&quot;g&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-grate1&quot;)}
+    tiles[&quot;W&quot;] =  tiles[&quot;,&quot;]
+    tiles[&quot;_&quot;] = {inherit(&quot;;&quot;), item(&quot;it-blackbomb&quot;)}
+else
+    tiles[&quot;5&quot;] =  tiles[&quot;d&quot;]
+    tiles[&quot;6&quot;] =  tiles[&quot;z&quot;]
+    tiles[&quot;7&quot;] =  tiles[&quot;h&quot;]
+    tiles[&quot;8&quot;] =  tiles[&quot;e&quot;]
+    tiles[&quot;9&quot;] =  tiles[&quot;h&quot;]
+    tiles[&quot;%&quot;] = {inherit(&quot;I1&quot;), stone(&quot;st-flhay&quot;)}
+    tiles[&quot;C&quot;] =  tiles[&quot;,&quot;]
+    tiles[&quot;c&quot;] =  tiles[&quot;.&quot;]
+    tiles[&quot;B&quot;] =  tiles[&quot;.&quot;]
+    tiles[&quot;w&quot;] = {inherit(&quot;.&quot;), stone(&quot;st-wood&quot;)}
+    tiles[&quot;g&quot;] =  tiles[&quot;.&quot;]
+    tiles[&quot;W&quot;] =  tiles[&quot;.&quot;]
+    tiles[&quot;_&quot;] =  tiles[&quot;;&quot;]
+end
+
+
+function refill()
+    local water = 0
+    local floor = enigma.GetFloor(18, 28)
+    local water1 = false
+    local water2 = false
+    local water3 = false
+    if floor ~= nil then
+         if GetKind(floor) == &quot;fl-water&quot; then
+             water = water + 1
+             water1 = true
+         end
+    end
+    floor = enigma.GetFloor(18, 27)
+    if floor ~= nil then
+         if GetKind(floor) == &quot;fl-water&quot; then
+             water = water + 1
+             water2 = true
+         end
+    end
+    floor = enigma.GetFloor(18, 25)
+    if floor ~= nil then
+         if GetKind(floor) == &quot;fl-water&quot; then
+             water = water + 1
+             water3 = true
+         end
+    end
+
+    if water &gt; 0 then
+        local obj = enigma.GetItem(18, 26)
+        local didFill = 0
+        if obj == nil then
+            if water == 3 then
+                set_item(&quot;it-document&quot;, 18, 26, {text=&quot;You can extinguish fire with water. This is a good place to refill your extinguisher. Be aware, water is rare!&quot;})
+            end
+        else
+            if GetKind(obj) == &quot;it-extinguisher_empty&quot; then
+                set_item(&quot;it-extinguisher_medium&quot;, 18, 26, {})
+                water = water -1
+                didFill = 1
+            else
+                if GetKind(obj) == &quot;it-extinguisher_medium&quot; and water &gt; 1 then
+                    set_item(&quot;it-extinguisher&quot;, 18, 26, {})
+                    water = water - 2
+                    didFill = 2
+                end
+            end
+        end
+        if didFill &gt;= 1 and water1 then
+            set_floor(&quot;fl-swamp&quot;, 18, 28, {})
+            didFill = didFill - 1
+        end
+        if didFill &gt;= 1 and water2 then
+            set_floor(&quot;fl-swamp&quot;, 18, 27, {})
+            didFill = didFill - 1
+        end
+        if didFill &gt;= 1 and water3 then
+            set_floor(&quot;fl-swamp&quot;, 18, 25, {})
+        end
+    end
+end
+
+create_world_from_map( tiles, {
+&quot;###########x###############x###########&quot;,
+&quot;#         ===      d      ===         #&quot;,
+&quot;#                                     #&quot;,
+&quot;#                                     #&quot;,
+&quot;#                                     #&quot;,
+&quot;#                                     #&quot;,
+&quot;#=                                   =#&quot;,
+&quot;x=                                   =x&quot;,
+&quot;#=                                   =#&quot;,
+&quot;#                                     #&quot;,
+&quot;#                                     #&quot;,
+&quot;#                                     #&quot;,
+&quot;#                                     #&quot;,
+&quot;#                                     #&quot;,
+&quot;#                                     #&quot;,
+&quot;#                                     #&quot;,
+&quot;#=                                   =#&quot;,
+&quot;x=                                   =x&quot;,
+&quot;#=                                   =#&quot;,
+&quot;#                                     #&quot;,
+&quot;#                                     #&quot;,
+&quot;#                                     #&quot;,
+&quot;#                                     #&quot;,
+&quot;# ===   g wg            ===           #&quot;,
+&quot;###S##s##N###############x#############&quot;,
+&quot;#  -  . WCcaw    3~#     #   #   #  J #&quot;,
+&quot;#     . B         -#X### # # # # # #22#&quot;,
+&quot;#     .   B       ~#T#yH   #   #   # 1#&quot;,
+&quot;#     .           ~#-###############22#&quot;,
+&quot;#     .B     ;;;G###jf#        .   ,  #&quot;,
+&quot;#     .      ;y;%  ####        .   ,  #&quot;,
+&quot;#     .      ;_;% y#           .   ,7 #&quot;,
+&quot;#;;;###IIIIII#######     b     . 56, 8#&quot;,
+&quot;#           d            .     .   ,9 #&quot;,
+&quot;#                        .     .   ,  #&quot;,
+&quot;#                        .     .   ,  #&quot;,
+&quot;#########################n#####t#######&quot;
+})
+
+function helpbrokenmaze()
+    set_item(&quot;it-document&quot;, 20, 27, {text=&quot;OOPS! The maze is broken! Prepare to repair the maze before you destroy it.&quot;})
+end
+
+max_depth = 0
+brake_x = -1
+brake_y = -1
+brake_dir = WEST
+-- Brake a maze in the middle of the longest path from an arbitrary given
+-- root node.
+-- Recursive preorder depth first search algorithm.
+function brake_maze(maze, path, depth, x, y, dir)
+    local endpoint = true
+    if dir ~= NORTH and  maze:contains_cell(x, y-1) and
+            maze:can_go_south(x, y-1)  then
+        endpoint = false
+        path[depth] = {cellx=x, celly=y-1, dir=SOUTH}
+        brake_maze(maze, path, depth+1, x, y-1, SOUTH)
+    end
+    if dir ~= SOUTH and  maze:contains_cell(x, y+1) and
+            maze:can_go_south(x, y)  then
+        endpoint = false
+        path[depth] = {cellx=x, celly=y, dir=SOUTH}
+        brake_maze(maze, path, depth+1, x, y+1, NORTH)
+    end
+    if dir ~= WEST and  maze:contains_cell(x-1, y) and
+            maze:can_go_east(x-1, y)  then
+        endpoint = false
+        path[depth] = {cellx=x-1, celly=y, dir=EAST}
+        brake_maze(maze, path, depth+1, x-1, y, EAST)
+    end
+    if dir ~= EAST and  maze:contains_cell(x, y) and
+            maze:can_go_east(x, y)  then
+        endpoint = false
+        path[depth] = {cellx=x, celly=y, dir=EAST}
+        brake_maze(maze, path, depth+1, x+1, y, WEST)
+    end
+    
+    if endpoint == true then
+        if max_depth &lt; depth then     
+            max_depth = depth
+            local infn =   path[math_floor(depth/2)]
+            brake_x = infn.cellx                      
+            brake_y = infn.celly
+            brake_dir = infn.dir
+        end
+    end
+end
+
+function render_broken_maze()
+    local perfect_maze = new_kruskal_maze(19,12)
+    render_maze(perfect_maze, 
+            function(maze,cellx,celly)
+                local x = 1 + cellx*2 
+                local y = 1 + celly*2
+        
+                if not maze:can_go_east(cellx,celly) and maze:contains_cell(cellx+1,celly) then
+                    create_tile( tiles, x+1, y, &quot;maze_wall&quot; )
+                end
+                
+                if not maze:can_go_south(cellx,celly) and maze:contains_cell(cellx,celly+1) then
+                    create_tile( tiles, x, y+1, &quot;maze_wall&quot; )
+                end
+                
+                if maze:contains_cell(cellx+1,celly+1) then
+                    create_tile( tiles, x+1, y+1, &quot;maze_wall&quot; )
+                end
+            end )
+    local path = {}
+    brake_maze(perfect_maze, path, 0, 0, 0, WEST)
+    if brake_dir == EAST then
+        create_tile( tiles, 2+brake_x*2, 1+brake_y*2, &quot;maze_wall&quot; )
+        if not difficult then
+            set_item(&quot;it-pin&quot;, 2+brake_x*2, 1+brake_y*2, {})
+        end
+    elseif brake_dir == SOUTH then
+        create_tile( tiles, 1+brake_x*2, 2+brake_y*2, &quot;maze_wall&quot; )
+        if not difficult then
+            set_item(&quot;it-pin&quot;, 1+brake_x*2, 2+brake_y*2, {})
+        end
+    end
+end
+
+render_broken_maze()
+
+repeat
+  oxyd_shuffle()
+  local c1 = enigma.GetAttrib(enigma.GetNamedObject(&quot;oxyd1&quot;), &quot;color&quot;)
+  local c2 = enigma.GetAttrib(enigma.GetNamedObject(&quot;oxyd2&quot;), &quot;color&quot;)
+  local c3 = enigma.GetAttrib(enigma.GetNamedObject(&quot;oxyd3&quot;), &quot;color&quot;)
+until ((c1 ~= c2) and (c1 ~= c3) and (c2 ~= c3))
+    ]]&gt;&lt;/el:luamain&gt;
+    &lt;el:i18n&gt;
+      &lt;el:string el:key=&quot;title&quot;&gt;
+        &lt;el:english el:translate=&quot;false&quot;/&gt;
+      &lt;/el:string&gt;
+      &lt;el:string el:key=&quot;subtitle&quot;&gt;
+        &lt;el:english el:translate=&quot;true&quot; el:comment=&quot;Set fire or die&quot;/&gt;
+        &lt;el:translation el:lang=&quot;de&quot;&gt;Brenne oder verbrenne&lt;/el:translation&gt;
+      &lt;/el:string&gt;
+      &lt;el:string el:key=&quot;Do you think a bushman would start to search for an extinguisher in the cellar if a wall of fire were approaching? Be a Firefox - you have the first 5 items to deal with, no more no less!&quot;&gt;
+        &lt;el:english el:comment=&quot;Firefox in sense of clever in handling fire&quot;&gt;Do you think a bushman would start to search for an extinguisher in the cellar if a wall of fire were approaching? Be a Firefox - you have the first 5 items to deal with, no more no less!&lt;/el:english&gt;
+        &lt;el:translation el:lang=&quot;de&quot;&gt;W&#252;rde ein Buschmann anfangen einen Feuerl&#246;scher im Keller zu suchen, wenn eine Feuerwalze naht? Sei ein Fuchs im Feuer - es gibt nur die ersten 5 Gegenst&#228;nde die zur L&#246;sung beitragen k&#246;nnen!&lt;/el:translation&gt;
+      &lt;/el:string&gt;
+      &lt;el:string el:key=&quot;You can extinguish fire with water. This is a good place to refill your extinguisher. Be aware, water is rare!&quot;&gt;
+        &lt;el:english&gt;You can extinguish fire with water. This is a good place to refill your extinguisher. Be aware, water is rare!&lt;/el:english&gt;
+        &lt;el:translation el:lang=&quot;de&quot;&gt;Man kann Feuer mit Wasser l&#246;schen! Hier ist ein guter Ort um Feuerl&#246;scher wieder aufzuf&#252;llen. Wer Wasser verschwendet, j&#228;mmerlich verendet!&lt;/el:translation&gt;
+      &lt;/el:string&gt;
+      &lt;el:string el:key=&quot;OOPS! The maze is broken! Prepare to repair the maze before you destroy it.&quot;&gt;
+        &lt;el:english&gt;OOPS! The maze is broken! Prepare to repair the maze before you destroy it.&lt;/el:english&gt;
+        &lt;el:translation el:lang=&quot;de&quot;&gt;Oh! Das Labyrinth ist unvollst&#228;ndig! Unternimm etwas um das Labyrinth zu reparieren bevor Du es zerst&#246;rst.&lt;/el:translation&gt;
+      &lt;/el:string&gt;
+    &lt;/el:i18n&gt;
+  &lt;/el:protected&gt;
+&lt;/el:level&gt;
+


Property changes on: branches/1.0/data/levels/enigma_v/ral01_3.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: branches/1.0/data/levels/enigma_vi/duffy142_1.xml
===================================================================
--- branches/1.0/data/levels/enigma_vi/duffy142_1.xml	2007-05-15 21:23:17 UTC (rev 738)
+++ branches/1.0/data/levels/enigma_vi/duffy142_1.xml	2007-05-17 22:20:33 UTC (rev 739)
@@ -3,7 +3,7 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;level&quot;&gt;
       &lt;el:identity el:title=&quot;Construction Workers&quot; el:subtitle=&quot;&quot; el:id=&quot;duffy142&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;1&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;2&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author  el:name=&quot;Jacob Scott&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2007 Jacob Scott&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
@@ -54,10 +54,10 @@
         elseif c == &quot;~&quot; then
             set_floor(&quot;fl-water&quot;,i-1,line)
         elseif c==&quot;z&quot; then
-            set_actor(&quot;ac-blackball&quot;, i-.5,line+.5, {player=0})
+            set_actor(&quot;ac-blackball&quot;, i-.5,line+.5, {player=0, essential=1})
             set_item(&quot;it-yinyang&quot;,i-1,line)
         elseif c==&quot;y&quot; then
-            set_actor(&quot;ac-whiteball&quot;, i-.5,line+.5, {player=1})
+            set_actor(&quot;ac-whiteball&quot;, i-.5,line+.5, {player=1, essential=1})
             set_item(&quot;it-yinyang&quot;,i-1,line)
         elseif c == &quot;g&quot; then
             draw_stones(&quot;st-grate1&quot;,{i-1,line}, {1,1}, 1)

Modified: branches/1.0/data/levels/enigma_vi/index.xml
===================================================================
--- branches/1.0/data/levels/enigma_vi/index.xml	2007-05-15 21:23:17 UTC (rev 738)
+++ branches/1.0/data/levels/enigma_vi/index.xml	2007-05-17 22:20:33 UTC (rev 739)
@@ -101,7 +101,7 @@
     &lt;level _seq=&quot;93&quot; _title=&quot;Parish Fair&quot; _xpath=&quot;./duffy143_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;duffy143&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;94&quot; _title=&quot;In the Middle&quot; _xpath=&quot;./duffy141_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;duffy141&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;95&quot; _title=&quot;Pleasure Garden&quot; _xpath=&quot;./duffy134_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;duffy134&quot; rel=&quot;1&quot; rev=&quot;1&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
-    &lt;level _seq=&quot;96&quot; _title=&quot;Construction Workers&quot; _xpath=&quot;./duffy142_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;duffy142&quot; rel=&quot;1&quot; rev=&quot;1&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
+    &lt;level _seq=&quot;96&quot; _title=&quot;Construction Workers&quot; _xpath=&quot;./duffy142_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;duffy142&quot; rel=&quot;1&quot; rev=&quot;2&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;97&quot; _title=&quot;City Life&quot; _xpath=&quot;./joona03_1&quot; author=&quot;Joona Laire&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;20061119joona503&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;98&quot; _title=&quot;Industrial Puzzles&quot; _xpath=&quot;./raoul30_1&quot; author=&quot;Raoul Bourquin&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;raoul30&quot; rel=&quot;1&quot; rev=&quot;4&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;99&quot; _title=&quot;Polar Bears' Paradise&quot; _xpath=&quot;./ral19_1&quot; author=&quot;Ronald Lamprecht&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;20070314ral394&quot; rel=&quot;1&quot; rev=&quot;68&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;

Modified: branches/1.0/data/models-2d.lua
===================================================================
--- branches/1.0/data/models-2d.lua	2007-05-15 21:23:17 UTC (rev 738)
+++ branches/1.0/data/models-2d.lua	2007-05-17 22:20:33 UTC (rev 739)
@@ -693,7 +693,7 @@
 
 def_stone2(&quot;st-black1&quot;)
 def_stone2(&quot;st-black2&quot;)
-def_stone2(&quot;st-black3&quot;)
+def_stone2(&quot;st-black3&quot;, &quot;sh-grate1&quot;)
 def_stone2(&quot;st-black4&quot;, &quot;sh-white4&quot;)
 def_stone2(&quot;st-block&quot;)
 def_stone2(&quot;st-beads&quot;, &quot;sh-glass&quot;)
@@ -862,7 +862,7 @@
 def_stone(&quot;st-key1&quot;, &quot;sh-round&quot;, {filename=&quot;st-key2&quot;})
 def_stone(&quot;st-white1&quot;)
 def_stone(&quot;st-white2&quot;)
-def_stone(&quot;st-white3&quot;)
+def_stone(&quot;st-white3&quot;, &quot;sh-grate1&quot;)
 def_stone(&quot;st-white4&quot;, &quot;sh-white4&quot;)
 def_stone(&quot;st-yinyang1&quot;)
 def_stone(&quot;st-yinyang2&quot;)

Modified: branches/1.0/src/stones_complex.cc
===================================================================
--- branches/1.0/src/stones_complex.cc	2007-05-15 21:23:17 UTC (rev 738)
+++ branches/1.0/src/stones_complex.cc	2007-05-17 22:20:33 UTC (rev 739)
@@ -3210,10 +3210,12 @@
 
     void ChessStone::on_floor_change() {
         Floor *fl = GetFloor(get_pos());
-        if (fl-&gt;is_kind(&quot;fl-abyss&quot;))
-            try_state(FALLING);
-        if (fl-&gt;is_kind(&quot;fl-swamp&quot;))
-            try_state(SWAMP);
+        if (fl != NULL) {
+            if (fl-&gt;is_kind(&quot;fl-abyss&quot;))
+                try_state(FALLING);
+            if (fl-&gt;is_kind(&quot;fl-swamp&quot;))
+                try_state(SWAMP);
+        }
     }
 }
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000175.html">[Enigma-game-svn] r738 - branches/1.0/src/lev
</A></li>
	<LI>Next message: <A HREF="000177.html">[Enigma-game-svn] r740 - in branches/1.0/src: gui lev
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#176">[ date ]</a>
              <a href="thread.html#176">[ thread ]</a>
              <a href="subject.html#176">[ subject ]</a>
              <a href="author.html#176">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
