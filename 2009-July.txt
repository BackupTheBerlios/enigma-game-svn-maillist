From ral at mail.berlios.de  Wed Jul  1 01:25:11 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 1 Jul 2009 01:25:11 +0200
Subject: [Enigma-game-svn] r1737 - in trunk/src: . gui items lev
Message-ID: <200906302325.n5UNPBVW012558@sheep.berlios.de>

Author: ral
Date: 2009-07-01 01:25:06 +0200 (Wed, 01 Jul 2009)
New Revision: 1737

Added:
   trunk/src/lev/SubProxy.cc
   trunk/src/lev/SubProxy.hh
Modified:
   trunk/src/Makefile.am
   trunk/src/WorldProxy.cc
   trunk/src/client.cc
   trunk/src/gui/GameMenu.cc
   trunk/src/gui/LevelInspector.cc
   trunk/src/gui/LevelMenu.cc
   trunk/src/gui/LevelPackComposer.cc
   trunk/src/items/Bottle.cc
   trunk/src/items/DocumentItem.cc
   trunk/src/lev/Index.cc
   trunk/src/lev/PersistentIndex.cc
   trunk/src/lev/Proxy.cc
   trunk/src/lev/Proxy.hh
   trunk/src/server.cc
   trunk/src/server.hh
Log:
Trunk 1.1: 
- multilevel support:
  - full support on auto folder and persistent levelpacks
  - no support on commandline
  - full composer support
  - global read only attribute "SublevelNumber" for level selection
  - multilevel title with trailing "#" will cause numbered sublevel titles
  - multilevel title without trailing "#" indicates lua based titles:
      - global attribute "SublevelTitle" should be set on level load
      - otherwise the default numbered title is used
  - sublevels use the id of the multilevel file with appended "[n]",
      - no other level id must end on "]"
  - sublevel screenshots, thumbs use a suffix "_n" to the filename


Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/Makefile.am	2009-06-30 23:25:06 UTC (rev 1737)
@@ -283,6 +283,8 @@
 	lev/Proxy.hh		\
 	lev/ScoreManager.cc	\
 	lev/ScoreManager.hh	\
+	lev/SubProxy.cc		\
+	lev/SubProxy.hh		\
 	lev/VolatileIndex.cc	\
 	lev/VolatileIndex.hh	\
 	others/CannonBall.cc	\

Modified: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/WorldProxy.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -74,6 +74,10 @@
             return server::InfiniteReincarnation;
         } else if (key == "ShowMoves") {
             return server::ShowMoves;
+        } else if (key == "SublevelNumber") {
+            return (int)server::SublevelNumber;
+        } else if (key == "SublevelTitle") {
+            return server::SublevelTitle;
         } else if (key == "SurviveFinish") {
             return server::SurviveFinish;
         } else if (key == "Width") {
@@ -179,6 +183,8 @@
         } else if (key == "ShowMoves") {
             server::ShowMoves = val.to_bool();
             STATUSBAR->show_move_counter (server::ShowMoves);
+        } else if (key == "SublevelTitle") {
+            server::SublevelTitle = val.to_string();
         } else if (key == "SurviveFinish") {
             server::SurviveFinish = val.to_bool();
         } else if (key == "CrackSpreading") {

Modified: trunk/src/client.cc
===================================================================
--- trunk/src/client.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/client.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -382,9 +382,7 @@
         case SDLK_F3: 
             if (keymod & KMOD_SHIFT) {
                 // force a reload from file
-                lev::Proxy * curProxy = lev::Proxy::loadedLevel();
-                if (curProxy != NULL)
-                    curProxy->release();
+                lev::Proxy::releaseCache();
                 server::Msg_Command ("restart");
             }
         default:
@@ -448,7 +446,7 @@
         case SDLK_F6: Msg_JumpBack(); break;
 
         case SDLK_F10: {
-            lev::Proxy *level = lev::Proxy::loadedLevel();
+            lev::Proxy *level = lev::Index::getCurrentProxy();
             std::string basename = std::string("screenshots/") +
                     level->getLocalSubstitutionLevelPath();
             std::string fname = basename + ".png";

Modified: trunk/src/gui/GameMenu.cc
===================================================================
--- trunk/src/gui/GameMenu.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/gui/GameMenu.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -1,5 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004,2005,2006 Daniel Heck
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -153,9 +154,7 @@
         else if (w == restart) {
             if (w->lastModifierKeys() & KMOD_CTRL && w->lastModifierKeys() & KMOD_SHIFT) {
                 // force a reload from file
-                lev::Proxy * curProxy = lev::Proxy::loadedLevel();
-                if (curProxy != NULL)
-                    curProxy->release();
+                lev::Proxy::releaseCache();
             }
             client::Stop ();
             server::Msg_LoadLevel(ind->getCurrent(), false);

Modified: trunk/src/gui/LevelInspector.cc
===================================================================
--- trunk/src/gui/LevelInspector.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/gui/LevelInspector.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2006, 2007 Ronald Lamprecht
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -199,7 +199,7 @@
         catch (XLevelLoading &err) {
             std::vector<string> lines;
             std::string errmsg = _("Server Error: could not load level '")
-                                   + aLevel->getNormLevelPath() + "'\n"
+                                   + aLevel->getNormFilePath() + "'\n"
                                    + err.what();
             ecl::split_copy (errmsg, '\n', back_inserter(lines));
             int x     = vshrink?30:60;
@@ -220,7 +220,7 @@
         ecl::Font *menufont = enigma::GetFont("menufont");
         levelPathString = 
                 (levelProxy->getNormPathType() == lev::Proxy::pt_resource) ?
-                levelProxy->getAbsLevelPath() : levelProxy->getNormLevelPath();
+                levelProxy->getAbsLevelPath() : levelProxy->getNormFilePath();
         // substitute all backslashes by slashes
         for (std::string::size_type slpos = levelPathString.find('\\');
                 slpos != std::string::npos; slpos = levelPathString.find('\\')) 

Modified: trunk/src/gui/LevelMenu.cc
===================================================================
--- trunk/src/gui/LevelMenu.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/gui/LevelMenu.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -1,5 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004,2005,2006 Daniel Heck
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -259,9 +260,7 @@
             int ilevel = ind->getCurrentPosition();
             if (w->lastModifierKeys() & KMOD_CTRL && w->lastModifierKeys() & KMOD_SHIFT) {
                 // force a reload from file
-                lev::Proxy * curProxy = lev::Proxy::loadedLevel();
-                if (curProxy != NULL)
-                    curProxy->release();
+                lev::Proxy::releaseCache();
             }
     
             if ((unsigned)ilevel < ind->size()) {
@@ -344,7 +343,7 @@
                 // use the inspector to check the absolute path!
                 lbl_levelname->set_text(ecl::strf("#%d: %s (%s)",
                           ind->getCurrentLevel(), curProxy->getTitle().c_str(), 
-                          curProxy->getNormLevelPath().c_str()));
+                          curProxy->getNormFilePath().c_str()));
             } else {
                 lbl_levelname->set_text(ecl::strf("#%d: %s",
                           ind->getCurrentLevel(), curProxy->getTitle().c_str()));

Modified: trunk/src/gui/LevelPackComposer.cc
===================================================================
--- trunk/src/gui/LevelPackComposer.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/gui/LevelPackComposer.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2006 Ronald Lamprecht
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -173,10 +173,10 @@
                                 break;
                             }
                             if (curIndex->isSource(curProxy) && 
-                                    backups.find(curProxy->getNormLevelPath()) == backups.end()) {
+                                    backups.find(curProxy->getNormFilePath()) == backups.end()) {
                                 // mark as deletion candidate - the final check
                                 // if we delete it really occurs on save
-                                deletions.insert(curProxy->getNormLevelPath());
+                                deletions.insert(curProxy->getNormFilePath());
                             }
                             curIndex->erase(pos);
                             if (pos >= curIndex->size() && pos > 0)
@@ -216,8 +216,8 @@
                                 // insert reference to our copy
                                 curIndex->insertProxy(pos++, levelCopy, true,
                                         var.ctrl, var.unit, var.target, var.extensions);
-                                backups.insert(levelCopy->getNormLevelPath());
-                                deletions.erase(levelCopy->getNormLevelPath());
+                                backups.insert(levelCopy->getNormFilePath());
+                                deletions.erase(levelCopy->getNormFilePath());
                             }
                             isModified = true;
                         }
@@ -357,7 +357,7 @@
         else {
             lbl_levelname->set_text(ecl::strf("#%d:(%s)",
                       ind->getCurrentLevel(), 
-                      curProxy->getNormLevelPath().c_str()));
+                      curProxy->getNormFilePath().c_str()));
         }
         
         int csize = clipboard->size();

Modified: trunk/src/items/Bottle.cc
===================================================================
--- trunk/src/items/Bottle.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/items/Bottle.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -22,6 +22,7 @@
 #include "client.hh"
 //#include "errors.hh"
 //#include "main.hh"
+#include "lev/Index.hh"
 #include "lev/Proxy.hh"
 #include "world.hh"
 
@@ -67,7 +68,7 @@
     ItemAction Bottle::activate(Actor *a, GridPos) {
         if (Value v = getAttr("text")) {
             std::string txt(v);
-            lev::Proxy *level = lev::Proxy::loadedLevel();
+            lev::Proxy *level = lev::Index::getCurrentProxy();
             // after complete switch to Proxy as levelloader the following
             // conditional can be abolished
             if (level)

Modified: trunk/src/items/DocumentItem.cc
===================================================================
--- trunk/src/items/DocumentItem.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/items/DocumentItem.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -22,7 +22,7 @@
 #include "client.hh"
 //#include "errors.hh"
 //#include "main.hh"
-//#include "player.hh"
+#include "lev/Index.hh"
 #include "lev/Proxy.hh"
 #include "world.hh"
 
@@ -51,7 +51,7 @@
     ItemAction DocumentItem::activate(Actor *a, GridPos) {
         if (Value v = getAttr("text")) {
             std::string txt(v);
-            lev::Proxy *level = lev::Proxy::loadedLevel();
+            lev::Proxy *level = lev::Index::getCurrentProxy();
             // after complete switch to Proxy as levelloader the following
             // conditional can be abolished
             if (level)

Modified: trunk/src/lev/Index.cc
===================================================================
--- trunk/src/lev/Index.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/lev/Index.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2006 Ronald Lamprecht
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -619,7 +619,7 @@
     
     bool Index::hasNormLevelPath(std::string path) {
         for (int i = 0; i < proxies.size(); i++) {
-            if (proxies[i]->getNormLevelPath() == path)
+            if (proxies[i]->getNormFilePath() == path)
                 return true;
         }
         return false;

Modified: trunk/src/lev/PersistentIndex.cc
===================================================================
--- trunk/src/lev/PersistentIndex.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/lev/PersistentIndex.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -143,6 +143,23 @@
         if (onlySystemIndices)
             return;
         
+        // register index free auto folder
+        // this needs to be done prior history registration to avoid outdated proxies
+        PersistentIndex * autoIndex = new PersistentIndex("auto", false, true,
+                INDEX_AUTO_PACK_LOCATION, INDEX_AUTO_PACK_NAME);
+        autoIndex->isEditable = false;
+        Index::registerIndex(autoIndex);
+        
+        // register team auto not yet registered new files
+        PersistentIndex * teamautoIndex = new PersistentIndex("team_test_new_api", false, true,
+                75000, "test_new_api");
+        if (teamautoIndex->size() > 0) {
+            teamautoIndex->isEditable = false;
+            Index::registerIndex(teamautoIndex);
+        } else {
+            delete teamautoIndex;
+        }
+        
         // UserPath: register dirs and zips with xml-indices excl auto
         dirIter = DirIter::instance(app.userPath + "/levels");
         while (dirIter->get_next(dirEntry)) {
@@ -190,22 +207,6 @@
             Index::registerIndex(indexCandidates[i]);
         }
 	
-        // register auto not yet registered new files
-        PersistentIndex * autoIndex = new PersistentIndex("auto", false, true,
-                INDEX_AUTO_PACK_LOCATION, INDEX_AUTO_PACK_NAME);
-        autoIndex->isEditable = false;
-        Index::registerIndex(autoIndex);
-        
-        // register team auto not yet registered new files
-        PersistentIndex * teamautoIndex = new PersistentIndex("team_test_new_api", false, true,
-                75000, "test_new_api");
-        if (teamautoIndex->size() > 0) {
-            teamautoIndex->isEditable = false;
-            Index::registerIndex(teamautoIndex);
-        } else {
-            delete teamautoIndex;
-        }
-        
         // check if history is available - else generate a new index
         Index * foundHistory = Index::findIndex("History");
         if ( foundHistory != NULL) {
@@ -246,7 +247,7 @@
     }
     
     int autoIndexProxyCompare(Proxy * first, Proxy * second) {
-        return first->getNormLevelPath() < second->getNormLevelPath();
+        return first->getNormFilePath() < second->getNormFilePath();
     }
     
     void PersistentIndex::load(bool systemOnly, bool update) {
@@ -268,7 +269,7 @@
                             (dirEntry.name.rfind(".xml") == dirEntry.name.size() - 4) ||
                             (dirEntry.name.rfind(".lua") == dirEntry.name.size() - 4))) {
                         Proxy * newProxy = Proxy::autoRegisterLevel(packPath, 
-                                dirEntry.name.substr(0, dirEntry.name.size() - 4));
+                                dirEntry.name.substr(0, dirEntry.name.size() - 4), 1);
                         if (newProxy != NULL) {
                             // first check that the proxy is not in the index
                             //  - may occur if the level is stored as .xml and .lua in the folder
@@ -277,6 +278,12 @@
                                 appendProxy(newProxy);
                             }
                             // do not delete Proxy if not used - we are not the owner!
+                            // register additional sublevels
+                            for (int i = 2; i <= newProxy->getQuantity(); i++) {
+                                Proxy * newSubProxy = Proxy::autoRegisterLevel(packPath, 
+                                        dirEntry.name.substr(0, dirEntry.name.size() - 4), i);
+                                appendProxy(newSubProxy);                                
+                            }
                         }
                     }
                 }
@@ -649,7 +656,7 @@
     }
     
     bool PersistentIndex::isSource(Proxy * aProxy) {
-        std::string proxyPath = aProxy->getNormLevelPath();
+        std::string proxyPath = aProxy->getNormFilePath();
         if (proxyPath[0] == '#')
             // Oxyd reference
             return false;
@@ -751,7 +758,7 @@
             
             Proxy * level = getProxy(i);
             // convert Proxy normLevelPath to pack local path ./* if possible
-            std::string xpath = level->getNormLevelPath();
+            std::string xpath = level->getNormFilePath();
             if (xpath.find(packPath + "/") == 0)
                 xpath = "." + xpath.substr(packPath.size());
             else if (packPath.empty() && xpath.find("/") == std::string::npos)

Modified: trunk/src/lev/Proxy.cc
===================================================================
--- trunk/src/lev/Proxy.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/lev/Proxy.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2006 Ronald Lamprecht
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -17,10 +17,12 @@
  */
 
 #include "lev/Proxy.hh"
+#include "lev/SubProxy.hh"
 
 #include "ecl_system.hh"
 #include "errors.hh"
 #include "gui/ErrorMenu.hh"
+#include "gui/LevelPreviewCache.hh"
 #include "lua.hh"
 #include "main.hh"
 #include "nls.hh"
@@ -60,7 +62,7 @@
 using namespace enigma;
 XERCES_CPP_NAMESPACE_USE 
 
-namespace enigma { namespace lev {     
+namespace enigma { namespace lev {
     // http://enigma-game.org/schema/level/1
     const XMLCh Proxy::levelNS[] = {
             chLatin_h, chLatin_t, chLatin_t, chLatin_p, chColon, chForwardSlash,
@@ -83,12 +85,12 @@
         registeredLibs.clear();
     }
 
-    Proxy *Proxy::currentLevel = NULL;
+    Proxy *Proxy::cachedLevel = NULL;
     
-    Proxy *Proxy::loadedLevel() {
-        return currentLevel;
+    void Proxy::releaseCache() {
+        if (cachedLevel != NULL)
+            cachedLevel->release();
     }
-    
 
     Proxy * Proxy::registerLevel(std::string levelPath, std::string indexPath,
             std::string levelId, std::string levelTitle, std::string levelAuthor,
@@ -97,7 +99,23 @@
         Proxy *theProxy;
         pathType thePathType = pt_resource;
         std::string theNormLevelPath;
+        bool isMulti = false;
+        std::string fileId;
+        unsigned subnum; 
         
+        // Multilevel
+        if (levelId[levelId.size() - 1] == ']') {
+            isMulti = true;
+            std::string::size_type numpos = levelId.find_last_of("[");
+            ASSERT(numpos != std::string::npos, XLevelPackInit, "Proxy - invalid multilevel id");
+            ASSERT(levelId.find_first_not_of("0123456789", numpos+1) == levelId.size() -1, 
+                    XLevelPackInit, "Proxy - invalid multilevel id");
+            std::istringstream subnumstr(levelId.substr(numpos + 1, levelId.size() - numpos - 2));
+            subnumstr >> std::dec >> subnum;
+            fileId = levelId.substr(0, numpos);
+//            Log << "Multilevel Id '" << levelId << "' sublevel " << subnum << " fileId '" << fileId << "'\n";
+        }
+
         // Normalize level path
         if (indexPath == "#commandline") {
             if (levelPath.find("://") != std::string::npos) {
@@ -137,24 +155,43 @@
         // should have different filenames -- but we have to handle it:
         // we generate proxys for each registration and decide on level load
         // evaluating the level metadata which proxy was right.
-        char txt[5];
-        snprintf(txt, sizeof(txt), "%d", levelRelease);        
-        std::string cacheKey = theNormLevelPath + levelId + txt;
+        std::string cacheKey = theNormLevelPath + levelId + ecl::strf("%d", levelRelease);
         std::map<std::string, Proxy *>::iterator i = cache.find(cacheKey);
         if (i != cache.end()) {
             Proxy * candidate = i->second;
             return candidate;
         }
         
-        // create new proxy
-        theProxy = new Proxy(false, thePathType, theNormLevelPath, levelId, levelTitle,
-            levelAuthor, levelScoreVersion, levelRelease, levelHasEasymode, 
-            levelCompatibilty, status, levelRevision);
-        cache.insert(std::make_pair(cacheKey, theProxy));
-        return theProxy;
+        if (!isMulti) {
+            // create new proxy
+            theProxy = new Proxy(false, thePathType, theNormLevelPath, levelId, levelTitle,
+                levelAuthor, levelScoreVersion, levelRelease, levelHasEasymode, 
+                levelCompatibilty, status, levelRevision);
+            cache.insert(std::make_pair(cacheKey, theProxy));
+            return theProxy;
+        } else {
+            // search for existing proxy for multilevel file
+            Proxy * fileProxy;
+            std::string multiCacheKey = theNormLevelPath + fileId + ecl::strf("%d", levelRelease);
+            std::map<std::string, Proxy *>::iterator mi = cache.find(multiCacheKey);
+            if (i != cache.end()) {
+                fileProxy = mi->second;
+            } else {
+                // create new multilevel file proxy
+                fileProxy = new Proxy(false, thePathType, theNormLevelPath, fileId, levelTitle,
+                    levelAuthor, levelScoreVersion, levelRelease, levelHasEasymode, 
+                    levelCompatibilty, status, levelRevision);
+                cache.insert(std::make_pair(multiCacheKey, fileProxy));
+            }
+            // create sublevel proxy
+            theProxy = new SubProxy(fileProxy, subnum, thePathType, theNormLevelPath, levelId, levelTitle);
+            cache.insert(std::make_pair(cacheKey, theProxy));
+            return theProxy;            
+        }
+        
     }
     
-    Proxy * Proxy::autoRegisterLevel(std::string indexPath, std::string filename) {
+    Proxy * Proxy::autoRegisterLevel(std::string indexPath, std::string filename, int subNum) {
         Proxy *theProxy = new Proxy(false, pt_resource, indexPath + "/" + filename , "", "",
             "unknown", 1, 0, false, GAMET_UNKNOWN, STATUS_UNKNOWN);
         try {
@@ -175,16 +212,36 @@
         } else {
             // eliminate duplicates and register
 //            Log << "autoRegisterLevel register '" << indexPath << "/"<< filename << " Title: " << theProxy->getTitle() <<"\n";
-            std::string cacheKey = theProxy->getNormLevelPath() + theProxy->getId() + 
+            std::string cacheKey = theProxy->getNormFilePath() + theProxy->getId() + 
                     ecl::strf("%d", theProxy->getReleaseVersion());
             std::map<std::string, Proxy *>::iterator i = cache.find(cacheKey);
             if (i != cache.end()) {
                 delete theProxy;
+//                Log << "duplicate Proxy - " << cacheKey <<"\n";
                 theProxy = i->second;
             } else {
                 cache.insert(std::make_pair(cacheKey, theProxy));        
             }
         }
+        // multilevel
+        if ((theProxy != NULL) && 
+                (theProxy->isMultiFlag)) {
+            std::string cacheKey = theProxy->getNormFilePath() + theProxy->getId() + ecl::strf("[%d]", subNum) + 
+                    ecl::strf("%d", theProxy->getReleaseVersion());
+            std::map<std::string, Proxy *>::iterator i = cache.find(cacheKey);
+            if (i != cache.end()) {
+                theProxy = i->second;
+            } else {
+                // create sublevel proxy
+                std::string fileTitle = theProxy->getTitle();
+                bool isLuaTitle = (fileTitle[fileTitle.size() - 1] != '#');
+                theProxy = new SubProxy(theProxy, subNum, pt_resource, indexPath + "/" + filename,
+                    theProxy->getId() + ecl::strf("[%d]", subNum), "");
+                cache.insert(std::make_pair(cacheKey, theProxy));
+                if (isLuaTitle)   // update Preview to get lua title
+                    gui::LevelPreviewCache::instance()->updatePreview(theProxy);
+            }
+        }
         return theProxy;
     }
    
@@ -204,7 +261,7 @@
     LowerCaseString searchText("");
     void do_search(const std::map<std::string, Proxy *>::value_type pair) {
         Proxy * candidate = pair.second;
-        if (searchText.containedBy(candidate->getNormLevelPath()) ||
+        if (searchText.containedBy(candidate->getNormFilePath()) ||
                 searchText.containedBy(candidate->getTitle()) ||
                 searchText.containedBy(candidate->getId()) ||
                 searchText.containedBy(candidate->getAuthor())) {
@@ -271,8 +328,8 @@
             std::string levelId, std::string levelTitle, std::string levelAuthor,
             int levelScoreVersion, int levelRelease, bool levelHasEasymode,
             GameType levelCompatibilty,levelStatusType status, int levelRevision) :  
-            isLibraryFlag (proxyIsLibrary), normPathType(thePathType), normLevelPath(theNormLevelPath), 
-            id(levelId), title(levelTitle), author(levelAuthor),
+            isLibraryFlag (proxyIsLibrary), isMultiFlag (false), normPathType(thePathType), normFilePath(theNormLevelPath), 
+            quantity (1), id(levelId), title(levelTitle), author(levelAuthor),
             scoreVersion(levelScoreVersion), releaseVersion(levelRelease),
             revisionNumber(levelRevision), hasEasyModeFlag(levelHasEasymode), 
             engineCompatibility(levelCompatibilty), levelStatus (status), 
@@ -288,14 +345,18 @@
             doc->release();
             doc = NULL;
         }
-        if (this == currentLevel) {
-            currentLevel = NULL;
+        if (this == cachedLevel) {
+            cachedLevel = NULL;
             releaseLibs();
         }
     }
     
+    std::string Proxy::getNormFilePath() {
+        return normFilePath;
+    }
+    
     std::string Proxy::getNormLevelPath() {
-        return normLevelPath;
+        return normFilePath;
     }
     
     std::string Proxy::getLocalSubstitutionLevelPath() {
@@ -342,11 +403,11 @@
         
         // resolve resource path to filepath
         } else if (normPathType == pt_absolute || normPathType == pt_url) { 
-            absLevelPath = normLevelPath;
+            absLevelPath = normFilePath;
         } else if(normPathType == pt_resource) {
-            if(!app.resourceFS->findFile ("levels/" + normLevelPath + ".xml", 
+            if(!app.resourceFS->findFile ("levels/" + normFilePath + ".xml", 
                         absLevelPath, isptr) &&
-                    !app.resourceFS->findFile ("levels/" + normLevelPath + ".lua", 
+                    !app.resourceFS->findFile ("levels/" + normFilePath + ".lua", 
                         absLevelPath, isptr)) {
                 return NULL;
             }
@@ -417,7 +478,7 @@
                 // doc exists - metadata are loaded
                 return;
             if (!isLibraryFlag != expectLevel)
-                    throw XLevelLoading(ecl::strf("Level - Library mismatch on %s", normLevelPath.c_str()));
+                    throw XLevelLoading(ecl::strf("Level - Library mismatch on %s", normFilePath.c_str()));
             // doc exists - we can directly load
             loadDoc();
             return;
@@ -432,9 +493,9 @@
         
         // release current proxy
         if (!isLibraryFlag) {
-            if (currentLevel != NULL)
-                currentLevel->release();
-            currentLevel = this;
+            if (cachedLevel != NULL)
+                cachedLevel->release();
+            cachedLevel = this;
         }
         
         // handle oxyd first
@@ -449,28 +510,28 @@
                 server::AllowSingleOxyds = true;
             server::PrepareLua();
             // use oxyd loader
-            std::string::size_type posSecondHash = normLevelPath.find('#',1);
+            std::string::size_type posSecondHash = normFilePath.find('#',1);
             if (posSecondHash == string::npos)
-                throw XLevelLoading("Bad filename for oxyd level: " + normLevelPath );
-            std::string packName = normLevelPath.substr(1, posSecondHash -1);
-            std::string levelNumber = normLevelPath.substr(posSecondHash + 1);
+                throw XLevelLoading("Bad filename for oxyd level: " + normFilePath );
+            std::string packName = normFilePath.substr(1, posSecondHash -1);
+            std::string levelNumber = normFilePath.substr(posSecondHash + 1);
             if (Index * oxydIndex = Index::findIndex(packName)) {
                 dynamic_cast<oxyd::LevelPack_Oxyd *>(oxydIndex)->load_oxyd_level(atoi(levelNumber.c_str()));
             } else {
-                throw XLevelLoading("Missing oxyd levelpack for: " + normLevelPath);
+                throw XLevelLoading("Missing oxyd levelpack for: " + normFilePath);
             }
             return;
             
         // resolve resource path to filepath
         } else if (normPathType == pt_absolute || normPathType == pt_url) { 
-            absLevelPath = normLevelPath;
+            absLevelPath = normFilePath;
         } else if(normPathType == pt_resource) {
-            if(!app.resourceFS->findFile ("levels/" + normLevelPath + ".xml", 
+            if(!app.resourceFS->findFile ("levels/" + normFilePath + ".xml", 
                         absLevelPath, isptr) &&
-                    !app.resourceFS->findFile ("levels/" + normLevelPath + ".lua", 
+                    !app.resourceFS->findFile ("levels/" + normFilePath + ".lua", 
                         absLevelPath, isptr)) {
                 std::string type = isLibraryFlag ? "library " : "level ";
-                throw XLevelLoading("Could not find " + type + normLevelPath );
+                throw XLevelLoading("Could not find " + type + normFilePath );
             }
         } else
             // error unknown type
@@ -594,14 +655,16 @@
             } else {
                 // check metadata - currently just overwrite
                 isLibraryFlag = (getType() == "library") ? true : false;
+                isMultiFlag = (getType() == "multilevel") ? true : false;
                 if (!updateReleaseVersion()) {
                     release();   // avoid load success on a second read attempt
-                    throw XLevelLoading(ecl::strf("Release version mismatch on %s: requested %d\n", normLevelPath.c_str(), releaseVersion));
+                    throw XLevelLoading(ecl::strf("Release version mismatch on %s: requested %d\n", normFilePath.c_str(), releaseVersion));
                 }
                 if (!updateId()) {
                     release();   // avoid load success on a second read attempt
-                    throw XLevelLoading(ecl::strf("Id mismatch on %s: requested %s\n", normLevelPath.c_str(), id.c_str()));
+                    throw XLevelLoading(ecl::strf("Id mismatch on %s: requested %s\n", normFilePath.c_str(), id.c_str()));
                 }
+                getQuantity();
                 getTitle();
                 getScoreVersion();
                 getRevisionNumber();
@@ -614,7 +677,7 @@
                 getEngineCompatibility();
                 if (!onlyMetadata){   
                     if (!isLibraryFlag != expectLevel)
-                        throw XLevelLoading(ecl::strf("Level - Library mismatch on %s", normLevelPath.c_str()));
+                        throw XLevelLoading(ecl::strf("Level - Library mismatch on %s", normFilePath.c_str()));
                     loadDoc();
                 }
             }
@@ -625,7 +688,7 @@
         if (getEnigmaCompatibility() > ENIGMACOMPATIBITLITY)
             throw XLevelLoading(ecl::strf("Level is incompatible: %s requires Enigma %.2f or above", 
                     absLevelPath.c_str(), getEnigmaCompatibility()));
-        if (this == currentLevel) {    // just level - no libs
+        if (this == cachedLevel) {    // just level - no libs
             server::SetCompatibility(this);
             server::EnigmaCompatibility = getEnigmaCompatibility();
             server::TwoPlayerGame = hasNetworkMode();
@@ -644,7 +707,7 @@
 
     void Proxy::processDependencies() {
         // cleanup on level but not on libs
-        if (this == currentLevel) {
+        if (this == cachedLevel) {
             // cleanup all lib proxies loaded by previous load
             releaseLibs();
         }
@@ -671,7 +734,7 @@
 //                Log << "Deps: Path="<<depPath<<" Id="<< depId <<" Rel="<< depRelease <<" Prel="<< depPreload<< " Url=" << depUrl<<"\n";
                 // load every dependency just once and break circular dependencies
                 // by central load via Level
-                currentLevel->registerPreloadDependency(depPath, depId, depRelease,
+                cachedLevel->registerPreloadDependency(depPath, depId, depRelease,
                         depPreload, depUrl);
             }
         }
@@ -709,7 +772,7 @@
             // relative lib path
             std::string levelDir;
             std::string levelFilename;
-            if (ecl::split_path(normLevelPath, &levelDir, &levelFilename))
+            if (ecl::split_path(normFilePath, &levelDir, &levelFilename))
                 // the level is on subdirectory or in a zip
                 depPath = levelDir + "/" +  depPath.substr(2);
             else
@@ -891,6 +954,14 @@
             return "";
     }
     
+    int Proxy::getQuantity() {
+        if (doc != NULL) {
+            quantity = XMLString::parseInt(infoElem->getAttributeNS(levelNS, 
+                    Utf8ToXML("quantity").x_str()));
+        }
+        return quantity;
+    }
+    
     bool Proxy::updateId() {
         if (doc != NULL) {
             DOMElement *identityElem = 

Modified: trunk/src/lev/Proxy.hh
===================================================================
--- trunk/src/lev/Proxy.hh	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/lev/Proxy.hh	2009-06-30 23:25:06 UTC (rev 1737)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2006 Ronald Lamprecht
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -57,7 +57,7 @@
     public:
         enum pathType { pt_url, pt_resource, pt_absolute, pt_oxyd};
         static const XMLCh levelNS[]; // the XML namespace
-        static Proxy *loadedLevel(); // tmp ?
+        static void releaseCache();
         
         /**
          * The registration of a level.
@@ -81,16 +81,16 @@
                 GameType levelCompatibilty, levelStatusType status =STATUS_RELEASED,
                 int levelRevision = 0);
         
-        static Proxy *autoRegisterLevel(std::string indexPath, std::string filename);
+        static Proxy *autoRegisterLevel(std::string indexPath, std::string filename, int subNum);
 
         static std::string search(std::string text);
         static void countLevels();
         static std::set<std::string> getLevelIds(bool withEasy);
         static std::set<Proxy *> getProxies();
 
-        void loadLevel();
-        void loadMetadata(bool expectLevel);
-        Proxy * copy(std::string newBasePath, std::string newPackPath, bool backup = true);
+        virtual void loadLevel();
+        virtual void loadMetadata(bool expectLevel);
+        virtual Proxy * copy(std::string newBasePath, std::string newPackPath, bool backup = true);
         
         /**
          * Retrieve and translate a level string. The key may be "title",
@@ -100,36 +100,37 @@
          * @arg key     the key for the search string
          * @return      the translation of the string
          */
-        std::string getLocalizedString(const std::string &key);
-        
+        virtual int getQuantity();
         std::string getId();
-        int getScoreVersion();
-        int getReleaseVersion();
-        int getRevisionNumber();
-        levelStatusType getLevelStatus();
-        std::string getAuthor();
-        std::string getTitle(); // english title
-        bool hasEasyMode();
-        bool hasSingleMode();
-        bool hasNetworkMode();
-        std::string getContact();
-        std::string getHomepage();
-        controlType getControl();
-        scoreUnitType getScoreUnit();
-        std::string getScoreTarget();
-        std::string getCredits(bool infoUsage);
-        std::string getDedication(bool infoUsage);
-        int getEasyScore();
-        int getDifficultScore();
-        GameType getEngineCompatibility();
-        double getEnigmaCompatibility();
+        virtual int getScoreVersion();
+        virtual int getReleaseVersion();
+        virtual int getRevisionNumber();
+        virtual std::string getLocalizedString(const std::string &key);
+        virtual levelStatusType getLevelStatus();
+        virtual std::string getAuthor();
+        virtual std::string getTitle(); // untranslated English title
+        virtual bool hasEasyMode();
+        virtual bool hasSingleMode();
+        virtual bool hasNetworkMode();
+        virtual std::string getContact();
+        virtual std::string getHomepage();
+        virtual controlType getControl();
+        virtual scoreUnitType getScoreUnit();
+        virtual std::string getScoreTarget();
+        virtual std::string getCredits(bool infoUsage);
+        virtual std::string getDedication(bool infoUsage);
+        virtual int getEasyScore();
+        virtual int getDifficultScore();
+        virtual GameType getEngineCompatibility();
+        virtual double getEnigmaCompatibility();
         
         /**
-         * the level address that can be used independent of a level pack
+         * the levels file address that can be used independent of a level pack
          * as a crossreference. (stable/welcome, #oxyd#17, http://..., ~/test)
          */
-        std::string getNormLevelPath();
+        std::string getNormFilePath();
         
+        virtual std::string getNormLevelPath();
         /**
          * The normalized level path with all critical characters substituted
          * by '~' to allow url's to be used and to make generated paths portable.
@@ -142,22 +143,33 @@
          * the type of the level address
          */
         Proxy::pathType getNormPathType();
-        std::string getAbsLevelPath();
+        virtual std::string getAbsLevelPath();
         void loadDependency(std::string depId);
+    
+    protected:
+        std::string title;
+        
+        Proxy(bool proxyIsLibrary, pathType thePathType, std::string theNormLevelPath,
+                std::string levelId, std::string levelTitle, std::string levelAuthor,
+                int levelScoreVersion, int levelRelease, bool levelHasEasymode,
+                GameType levelCompatibilty, levelStatusType status, int levelRevision = 0);
+        ~Proxy();
         void release();
+
     private:
-        static Proxy *currentLevel;
+        static Proxy *cachedLevel;           // file proxy only
         static std::map<std::string, Proxy *> cache;
         static std::vector<Proxy *> loadedLibs;
         static std::vector<Proxy *> registeredLibs;
         static void releaseLibs();
         
         bool isLibraryFlag;
+        bool isMultiFlag;
         pathType normPathType;
-        std::string normLevelPath; // stable/welcome, #oxyd#17, http://..., ~/test
+        std::string normFilePath; // stable/welcome, #oxyd#17, http://..., ~/test
         std::string absLevelPath;
+        int quantity;
         std::string id; // level id - old filename or indexname
-        std::string title; // old name
         std::string author;
         int scoreVersion;
         int releaseVersion;
@@ -178,11 +190,6 @@
         XERCES_CPP_NAMESPACE_QUALIFIER DOMElement *infoElem;
         XERCES_CPP_NAMESPACE_QUALIFIER DOMNodeList *stringList;
         
-        Proxy(bool proxyIsLibrary, pathType thePathType, std::string theNormLevelPath,
-                std::string levelId, std::string levelTitle, std::string levelAuthor,
-                int levelScoreVersion, int levelRelease, bool levelHasEasymode,
-                GameType levelCompatibilty, levelStatusType status, int levelRevision = 0);
-        ~Proxy();
         void load(bool onlyMetadata, bool expectLevel);
         void loadDoc();
         void loadLuaCode();

Added: trunk/src/lev/SubProxy.cc
===================================================================
--- trunk/src/lev/SubProxy.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/lev/SubProxy.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -0,0 +1,162 @@
+/*
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ */
+
+#include "lev/SubProxy.hh"
+
+#include "main.hh"
+#include "server.hh"
+
+namespace enigma { namespace lev {
+    
+    SubProxy::SubProxy(Proxy * fileProxy, unsigned num, Proxy::pathType thePathType, std::string theNormLevelPath,
+            std::string levelId, std::string levelTitle) :
+            Proxy(false, thePathType, theNormLevelPath, levelId, levelTitle, "unknown",
+            1, 0, false, GAMET_UNKNOWN, STATUS_UNKNOWN) {
+        multiProxy = fileProxy;
+        subNum = num;
+    }
+    
+    void SubProxy::loadLevel() {
+        server::SublevelNumber = subNum;
+        multiProxy->loadLevel();
+        if (server::SublevelTitle.length() > 0)
+            title = server::SublevelTitle;
+    }
+    
+    void SubProxy::loadMetadata(bool expectLevel) {
+        multiProxy->loadMetadata(expectLevel);
+    }
+    
+    std::string SubProxy::getLocalizedString(const std::string &key) {
+        if (key == "title")
+            return getTitle();   // no localization possible
+        else
+            return multiProxy->getLocalizedString(key);
+    }
+
+    Proxy * SubProxy::copy(std::string newBasePath, std::string newPackPath, bool backup) {
+        Proxy * newMulti = multiProxy->copy(newBasePath, newPackPath, backup);
+        return registerLevel(newMulti->getNormFilePath(), newPackPath, getId(), getTitle(),
+                        getAuthor(), getScoreVersion(), getReleaseVersion(), hasEasyMode(), 
+                        getEngineCompatibility(), getLevelStatus(), getRevisionNumber());
+        
+    }
+    
+    int SubProxy::getQuantity() {
+        return multiProxy->getQuantity();
+    }
+
+    int SubProxy::getScoreVersion() {
+        return multiProxy->getScoreVersion();
+    }
+    int SubProxy::getReleaseVersion() {
+        return multiProxy->getReleaseVersion();
+    }
+    int SubProxy::getRevisionNumber() {
+        return multiProxy->getRevisionNumber();
+    }
+    
+    levelStatusType SubProxy::getLevelStatus() {
+        return multiProxy->getLevelStatus();
+    }
+
+    std::string SubProxy::getAuthor() {
+        return multiProxy->getAuthor();
+    }
+
+    std::string SubProxy::getTitle() {
+        std::string text = title;
+        if (text.size() == 0) {
+            text = multiProxy->getTitle();
+            if (text[text.size() - 1] == '#') {
+                // numbered titles for sublevels are intended
+                text += ecl::strf(" %d", subNum);
+                title = text;  // store generated title for index usage
+            } else {
+                // Lua part will supply title on load
+                text += ecl::strf(" # %d", subNum);  // just a temporary title
+            } 
+        }
+        return text;
+    }
+
+    bool SubProxy::hasEasyMode() {
+        return multiProxy->hasEasyMode();
+    }
+
+    bool SubProxy::hasSingleMode() {
+        return multiProxy->hasSingleMode();
+    }
+
+    bool SubProxy::hasNetworkMode() {
+        return multiProxy->hasNetworkMode();
+    }
+
+    std::string SubProxy::getContact() {
+        return multiProxy->getContact();
+    }
+
+    std::string SubProxy::getHomepage() {
+        return multiProxy->getHomepage();
+    }
+
+    controlType SubProxy::getControl() {
+        return multiProxy->getControl();
+    }
+
+    scoreUnitType SubProxy::getScoreUnit() {
+        return multiProxy->getScoreUnit();
+    }
+
+    std::string SubProxy::getScoreTarget() {
+        return multiProxy->getScoreTarget();
+    }
+
+    std::string SubProxy::getCredits(bool infoUsage) {
+        return multiProxy->getCredits(infoUsage);
+    }
+
+    std::string SubProxy::getDedication(bool infoUsage) {
+        return multiProxy->getDedication(infoUsage);
+    }
+
+    int SubProxy::getEasyScore() {
+        return multiProxy->getEasyScore();
+    }
+
+    int SubProxy::getDifficultScore() {
+        return multiProxy->getDifficultScore();
+    }
+
+    GameType SubProxy::getEngineCompatibility() {
+        return multiProxy->getEngineCompatibility();
+    }
+
+    double SubProxy::getEnigmaCompatibility() {
+        return multiProxy->getEnigmaCompatibility();
+    }
+    
+    std::string SubProxy::getNormLevelPath() {
+        return getNormFilePath() + ecl::strf("_%d", subNum);
+    }
+    
+    std::string SubProxy::getAbsLevelPath() {
+        return multiProxy->getAbsLevelPath();
+    }
+
+}} // namespace enigma::lev


Property changes on: trunk/src/lev/SubProxy.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/lev/SubProxy.hh
===================================================================
--- trunk/src/lev/SubProxy.hh	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/lev/SubProxy.hh	2009-06-30 23:25:06 UTC (rev 1737)
@@ -0,0 +1,65 @@
+/*
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ */
+ 
+#ifndef LEV_SUBPROXY_HH_INCLUDED
+#define LEV_SUBPROXY_HH_INCLUDED
+
+#include "enigma.hh"
+#include "lev/Proxy.hh"
+
+namespace enigma { namespace lev {
+
+    class SubProxy : public Proxy {
+    public:
+        SubProxy(Proxy * fileProxy, unsigned num, pathType thePathType, std::string theNormLevelPath,
+                std::string levelId, std::string levelTitle);
+                
+        virtual void loadLevel();
+        virtual void loadMetadata(bool expectLevel);
+        virtual Proxy * copy(std::string newBasePath, std::string newPackPath, bool backup = true);
+        virtual std::string getLocalizedString(const std::string &key);
+        virtual int getQuantity();
+        virtual int getScoreVersion();
+        virtual int getReleaseVersion();
+        virtual int getRevisionNumber();
+        virtual levelStatusType getLevelStatus();
+        virtual std::string getAuthor();
+        virtual std::string getTitle(); // english title
+        virtual bool hasEasyMode();
+        virtual bool hasSingleMode();
+        virtual bool hasNetworkMode();
+        virtual std::string getContact();
+        virtual std::string getHomepage();
+        virtual controlType getControl();
+        virtual scoreUnitType getScoreUnit();
+        virtual std::string getScoreTarget();
+        virtual std::string getCredits(bool infoUsage);
+        virtual std::string getDedication(bool infoUsage);
+        virtual int getEasyScore();
+        virtual int getDifficultScore();
+        virtual GameType getEngineCompatibility();
+        virtual double getEnigmaCompatibility();
+        virtual std::string getNormLevelPath();
+        virtual std::string getAbsLevelPath();
+        
+    private:
+        Proxy * multiProxy;
+        unsigned subNum;
+    };
+}} // namespace enigma::lev
+#endif


Property changes on: trunk/src/lev/SubProxy.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/server.cc	2009-06-30 23:25:06 UTC (rev 1737)
@@ -78,6 +78,8 @@
 
 double   server::LastMenuTime;
 int      server::MenuCount;
+unsigned server::SublevelNumber;
+std::string server::SublevelTitle;
 
 bool     server::NoCollisions = false;
 
@@ -166,7 +168,7 @@
     catch (XLevelLoading &err) {
         std::string levelPathString = 
             (levelProxy->getNormPathType() == lev::Proxy::pt_resource) ?
-            levelProxy->getAbsLevelPath() : levelProxy->getNormLevelPath();
+            levelProxy->getAbsLevelPath() : levelProxy->getNormFilePath();
         std::string msg = _("Server Error: could not load level '")
                                + levelPathString + "'\n"
                                + err.what();
@@ -180,7 +182,7 @@
     catch (XLevelRuntime &err) {
         std::string levelPathString = 
             (levelProxy->getNormPathType() == lev::Proxy::pt_resource) ?
-            levelProxy->getAbsLevelPath() : levelProxy->getNormLevelPath();
+            levelProxy->getAbsLevelPath() : levelProxy->getNormFilePath();
         std::string msg = _("Server Error: could not load level '")
                                + levelPathString + "'\n"
                                + err.what();
@@ -252,6 +254,8 @@
 {
     state = sv_waiting_for_clients;
     
+    server::SublevelNumber    = 1;
+    server::SublevelTitle     = "";
     server::LastMenuTime      = 0.0;
     server::MenuCount         = 0;
     server::NoCollisions      = false;

Modified: trunk/src/server.hh
===================================================================
--- trunk/src/server.hh	2009-06-27 23:19:26 UTC (rev 1736)
+++ trunk/src/server.hh	2009-06-30 23:25:06 UTC (rev 1737)
@@ -58,6 +58,8 @@
     extern int MenuCount;
     
     extern int32_t  RandomState;
+    extern unsigned SublevelNumber;
+    extern std::string SublevelTitle;
 
     // True: do not reset level when player dies
     extern bool     ConserveLevel;



From ral at mail.berlios.de  Wed Jul  1 20:12:48 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Wed, 1 Jul 2009 20:12:48 +0200
Subject: [Enigma-game-svn] r1738 - team_levelpacks/team_test_new_api
Message-ID: <200907011812.n61ICmgk008114@sheep.berlios.de>

Author: ral
Date: 2009-07-01 20:12:38 +0200 (Wed, 01 Jul 2009)
New Revision: 1738

Added:
   team_levelpacks/team_test_new_api/ralT088_1.xml
   team_levelpacks/team_test_new_api/ralT089_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT021_1.xml
   team_levelpacks/team_test_new_api/ralT035_1.xml
   team_levelpacks/team_test_new_api/ralT071_1.xml
   team_levelpacks/team_test_new_api/ralT087_1.xml
Log:
Test Level new API:
- multilevel testlevels
- some small additions to existing levels


Modified: team_levelpacks/team_test_new_api/ralT021_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT021_1.xml	2009-06-30 23:25:06 UTC (rev 1737)
+++ team_levelpacks/team_test_new_api/ralT021_1.xml	2009-07-01 18:12:38 UTC (rev 1738)
@@ -32,6 +32,8 @@
 ti["S"] = {"st_switch", target="autoclose"}
 ti["r"] = {"it_ring"}
 ti["f"] = {"it_flag"}
+ti["w"] = {"it_wormhole", range=2, destination=po(15, 7)}
+ti["v"] = {"it_wormhole", state=OFF, range=2, destination=po(15, 7)}
 
 ti["1"] = {"#ac_marble"}
 
@@ -47,7 +49,7 @@
 "   S                ",
 "                    ",
 "                    ",
-"                ~   ",
+" v    w         ~   ",
 "                    "
 })
 

Modified: team_levelpacks/team_test_new_api/ralT035_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT035_1.xml	2009-06-30 23:25:06 UTC (rev 1737)
+++ team_levelpacks/team_test_new_api/ralT035_1.xml	2009-07-01 18:12:38 UTC (rev 1738)
@@ -58,7 +58,7 @@
 
 wo:drawMap(myresolver, po({wo.Width-10, wo.Height-5}), "--", {
   "----######",
-  "######----######",
+  "######----########",
   "------######"
 })
 

Modified: team_levelpacks/team_test_new_api/ralT071_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT071_1.xml	2009-06-30 23:25:06 UTC (rev 1737)
+++ team_levelpacks/team_test_new_api/ralT071_1.xml	2009-07-01 18:12:38 UTC (rev 1738)
@@ -28,6 +28,7 @@
 
 ti["m"] = {"it_magicwand"}
 ti["d"] = {"it_dynamite"}
+ti["u"] = {"it_puller_n"}
 ti["w"] = {"st_box"}
 ti["s"] = {"st_swap"}
 ti["p"] = {"st_polarswitch"}
@@ -67,8 +68,8 @@
 ti["@"] = {"#ac_marble"}
 
 w, h = wo(ti, " ", {
+"    uuuuu           ",
 "                    ",
-"                    ",
 ";   ;   .   *   ^  ;",
 ";                  ;",
 ";r                 ;",

Modified: team_levelpacks/team_test_new_api/ralT087_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT087_1.xml	2009-06-30 23:25:06 UTC (rev 1737)
+++ team_levelpacks/team_test_new_api/ralT087_1.xml	2009-07-01 18:12:38 UTC (rev 1738)
@@ -18,6 +18,7 @@
 
 wo["ConserveLevel"] = true
 wo["ExtralifeGlasses"] = SPOT_DEATH + SPOT_LIGHTPASSENGER
+wo["InfiniteReincarnation"] = true
 
 ti[" "] = {"fl_sahara"}
 ti["D"] = {"st_death"}
@@ -30,6 +31,8 @@
 ti["B"] = {"st_boulder_w"}
 
 ti["G"] = {"it_glasses"}
+ti["r"] = {"it_ring"}
+ti["u"] = {"it_umbrella"}
 
 
 ti["b"] = {"it_bag"}
@@ -44,9 +47,9 @@
 "  D      o       R  ",
 "  D                 ",
 "  M  b   @  G       ",
-"  D                 ",
-"      m             ",
-"          S         ",
+"  D               r ",
+"      m           u ",
+"          S       u ",
 "                    ",
 "B             W     ",
 "                    "

Added: team_levelpacks/team_test_new_api/ralT088_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT088_1.xml	2009-06-30 23:25:06 UTC (rev 1737)
+++ team_levelpacks/team_test_new_api/ralT088_1.xml	2009-07-01 18:12:38 UTC (rev 1738)
@@ -0,0 +1,45 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="multilevel" el:quantity="4">
+      <el:identity el:title="Test Multilevel" el:subtitle="" el:id="20090629ral749"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2009 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["SublevelTitle"] =  ({"Multi Sahara","Multi Lawn","Multi Samba","Multi Tigris"})[wo["SublevelNumber"]]
+
+subfloor = ({"fl_sahara","fl_lawn","fl_samba","fl_tigris"})[wo["SublevelNumber"]]
+ti[" "] = {subfloor}
+ti["o"] = {"st_oxyd"}
+
+ti["@"] = {"#ac_marble"}
+
+w, h = wo(ti, " ", {
+"                    ",
+"                    ",
+"                    ",
+"       @            ",
+"                    ",
+"   o            o   ",
+"                    "
+})
+
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT088_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralT089_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT089_1.xml	2009-06-30 23:25:06 UTC (rev 1737)
+++ team_levelpacks/team_test_new_api/ralT089_1.xml	2009-07-01 18:12:38 UTC (rev 1738)
@@ -0,0 +1,43 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="multilevel" el:quantity="3">
+      <el:identity el:title="Test Multi Item #" el:subtitle="" el:id="20090630ral151"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2009 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+item = ({"it_cherry","it_springboard","it_seed"})[wo["SublevelNumber"]]
+ti[" "] = {"fl_sahara"} .. ti{item}
+ti["o"] = {"st_oxyd"}
+
+ti["@"] = {"#ac_marble"}
+
+w, h = wo(ti, " ", {
+"                    ",
+"                    ",
+"                    ",
+"       @            ",
+"                    ",
+"   o            o   ",
+"                    "
+})
+
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT089_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Thu Jul  2 00:00:43 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 2 Jul 2009 00:00:43 +0200
Subject: [Enigma-game-svn] r1739 - in trunk: doc src src/lev src/stones
Message-ID: <200907012200.n61M0hls027881@sheep.berlios.de>

Author: ral
Date: 2009-07-02 00:00:41 +0200 (Thu, 02 Jul 2009)
New Revision: 1739

Modified:
   trunk/doc/README.macosx
   trunk/src/lev/Proxy.cc
   trunk/src/server.cc
   trunk/src/stones/DeathStone.cc
Log:
Trunk 1.1:
- fix st_death: prohibit static variant to be pushed by st_boulder
- fix false current levelpack group on app restart with autoregistered
    multilevel
- update on README.macosx by Sidney


Modified: trunk/doc/README.macosx
===================================================================
--- trunk/doc/README.macosx	2009-07-01 18:12:38 UTC (rev 1738)
+++ trunk/doc/README.macosx	2009-07-01 22:00:41 UTC (rev 1739)
@@ -75,6 +75,15 @@
 that if you are going to build on MacOS 10.5 for a 10.3.9+ or 10.4+
 target, as that requires Macports to be configured specially.
 
+NOTE: ImageMagick is required to build the documentation. There are
+difficulties installing ImageMagick using Macports customised for
+building Enigma on MacOS 10.5 for deployment on 10.3.9+ or 10.4. If
+you are building Enigma that way, download the ImageMagick binaries
+tar file from
+http://www.imagemagick.org/script/binary-releases.php#macosx
+and install according to the directions there. Be sure to export
+MAGICK_HOME as described there,
+
 Step 2a Fix up an autconf problem:
 
 I don't know if this is the most correct way to fix a problem with
@@ -203,6 +212,7 @@
 
  ./autogen.sh
  env CPPFLAGS="-I/opt/local/include" LDFLAGS="-L/opt/local/lib" ./configure
+ make gmo 
  make
  make macapp
 
@@ -212,6 +222,7 @@
  export SDK=/Developer/SDKs/MacOSX10.4u.sdk
  ./autogen.sh
  env CPPFLAGS="-I/opt/local/include -mmacosx-version-min=10.4 -isysroot ${SDK}" LDFLAGS="-L/opt/local/lib -mmacosx-version-min=10.4 -isysroot ${SDK} -Wl,-syslibroot,${SDK}" ./configure
+ make gmo 
  make
  make macapp
 
@@ -221,6 +232,7 @@
  export SDK=/Developer/SDKs/MacOSX10.3.9.sdk
  ./autogen.sh
  env CPPFLAGS="-I/opt/local/include -mmacosx-version-min=10.3 -isysroot ${SDK}" LDFLAGS="-L/opt/local/lib -mmacosx-version-min=10.3 -isysroot ${SDK} -Wl,-syslibroot,${SDK}" ./configure
+ make gmo 
  make
  make macapp
 
@@ -235,7 +247,7 @@
 build. Follow the instructions above to get a build for 10.4+ on the
 Intel machine and for 10.3.9+ on the PPC machine.
 
-On the PPC machine, go into the direcctory tree of the resulting
+On the PPC machine, go into the directory tree of the resulting
 Enigma.app, either using a terminal command line or in the finder
 using control-click Show Package Contents, and copy the file
 Enigma.app/Contents/MacOS/enigma to the Intel machine where you name

Modified: trunk/src/lev/Proxy.cc
===================================================================
--- trunk/src/lev/Proxy.cc	2009-07-01 18:12:38 UTC (rev 1738)
+++ trunk/src/lev/Proxy.cc	2009-07-01 22:00:41 UTC (rev 1739)
@@ -238,8 +238,9 @@
                 theProxy = new SubProxy(theProxy, subNum, pt_resource, indexPath + "/" + filename,
                     theProxy->getId() + ecl::strf("[%d]", subNum), "");
                 cache.insert(std::make_pair(cacheKey, theProxy));
-                if (isLuaTitle)   // update Preview to get lua title
+                if (isLuaTitle) {  // update Preview to get lua title
                     gui::LevelPreviewCache::instance()->updatePreview(theProxy);
+                }
             }
         }
         return theProxy;

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2009-07-01 18:12:38 UTC (rev 1738)
+++ trunk/src/server.cc	2009-07-01 22:00:41 UTC (rev 1739)
@@ -400,14 +400,14 @@
 void server::Msg_LoadLevel (lev::Proxy *levelProxy, bool isPreview) {
     server::CreatingPreview = isPreview;
     if (!isPreview) {
-	// update F6 jump back history
-	if (currentIndex != lev::Index::getCurrentIndex() ||
-		currentLevel != currentIndex->getCurrentPosition()) {
-	    previousIndex = currentIndex;
-	    previousLevel = currentLevel;
-	    currentIndex = lev::Index::getCurrentIndex();
-	    currentLevel = currentIndex->getCurrentPosition();
-	}
+        // update F6 jump back history
+        if (currentIndex != lev::Index::getCurrentIndex() ||
+        	currentLevel != currentIndex->getCurrentPosition()) {
+            previousIndex = currentIndex;
+            previousLevel = currentLevel;
+            currentIndex = lev::Index::getCurrentIndex();
+            currentLevel = currentIndex->getCurrentPosition();
+        }
     }
     load_level(levelProxy, false);
 }
@@ -652,10 +652,13 @@
 
 enigma::Difficulty server::GetDifficulty()
 {
+    if (server::CreatingPreview)
+        return DIFFICULTY_HARD;    // we may not access the current index!
+        
     lev::Index *ind = lev::Index::getCurrentIndex();
     lev::Proxy *curProxy = ind->getCurrent();
     int i= app.state->getInt("Difficulty");
-    if (i == DIFFICULTY_EASY && !server::CreatingPreview && curProxy->hasEasyMode())
+    if (i == DIFFICULTY_EASY  && curProxy->hasEasyMode())
         return DIFFICULTY_EASY;
     else
         return DIFFICULTY_HARD;

Modified: trunk/src/stones/DeathStone.cc
===================================================================
--- trunk/src/stones/DeathStone.cc	2009-07-01 18:12:38 UTC (rev 1738)
+++ trunk/src/stones/DeathStone.cc	2009-07-01 22:00:41 UTC (rev 1739)
@@ -84,7 +84,7 @@
             if (state == IDLE)   // avoid restart of animations
                 init_model();
             return Value();
-        } else if (m.message == "_trigger" && !m.value.to_bool()) {
+        } else if (m.message == "_trigger" && !m.value.to_bool() && (objFlags & OBJBIT_MOVABLE)) {
             Direction incoming = NODIR;
             if (m.sender != NULL)
                 incoming = direction_fromto(dynamic_cast<GridObject *>(m.sender)->get_pos(), get_pos());



From ral at mail.berlios.de  Fri Jul  3 00:30:01 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Fri, 3 Jul 2009 00:30:01 +0200
Subject: [Enigma-game-svn] r1740 - in trunk: . doc src/lev
Message-ID: <200907022230.n62MU1DP017157@sheep.berlios.de>

Author: ral
Date: 2009-07-03 00:29:49 +0200 (Fri, 03 Jul 2009)
New Revision: 1740

Modified:
   trunk/configure.ac
   trunk/doc/REQUIREMENTS
   trunk/src/lev/ScoreManager.cc
Log:
Trunk 1.1:
- Xerces 3.0: update support from r564202 to 3.0 and 3.0.1
Note:
- this breaks Xerces 3.0 pre release compatibility to revisions < 671894
- this patch can be likely applied to Enigma 1.01 as well

Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2009-07-01 22:00:41 UTC (rev 1739)
+++ trunk/configure.ac	2009-07-02 22:29:49 UTC (rev 1740)
@@ -178,7 +178,7 @@
       [AC_MSG_ERROR([not found])])      
    AC_CHECK_LIB(xerces-c, main,,[AC_MSG_ERROR([xerces is required to compile Enigma])])
 else
-  AC_MSG_CHECKING([for Xerces 3.0 experimental version])
+  AC_MSG_CHECKING([for current Xerces release 3.0])
   AC_EGREP_HEADER([gXercesMajVersion = 3],[xercesc/util/XercesVersion.hpp],
       xerces3exp="yes",
       xerces3exp="no")      
@@ -187,7 +187,7 @@
     AC_CHECK_LIB(xerces-c, main,,[AC_MSG_ERROR([xerces is required to compile Enigma])])
   else
     AC_MSG_RESULT([not found])
-    AC_MSG_CHECKING([for Xerces >=2.4 released version])
+    AC_MSG_CHECKING([for old Xerces release >=2.4])
     AC_RUN_IFELSE([AC_LANG_PROGRAM([[#include <xercesc/util/XercesVersion.hpp>]],
           [[if (XERCES_VERSION_MAJOR < 2)
               return 1;

Modified: trunk/doc/REQUIREMENTS
===================================================================
--- trunk/doc/REQUIREMENTS	2009-07-01 22:00:41 UTC (rev 1739)
+++ trunk/doc/REQUIREMENTS	2009-07-02 22:29:49 UTC (rev 1740)
@@ -31,7 +31,7 @@
                 http://www.libsdl.org/projects/SDL_image/
                 SDL_image-devel-1.2.6-VC8.zip (W)
 
-Xerces-C        3.0 r564202     2.4 - 2.7 (L)   < 2.3 (L); 3.0 < r564202
+Xerces-C        3.0.1     2.4 - 2.8 (L)   < 2.3 (L); 3.0 < r671894
 Apache          2.7 : http://xml.apache.org/xerces-c/download.cgi
                       Linux: use rpm spec 
                 3.0 : https://svn.apache.org/repos/asf/xerces/c/trunk

Modified: trunk/src/lev/ScoreManager.cc
===================================================================
--- trunk/src/lev/ScoreManager.cc	2009-07-01 22:00:41 UTC (rev 1739)
+++ trunk/src/lev/ScoreManager.cc	2009-07-02 22:29:49 UTC (rev 1740)
@@ -61,18 +61,24 @@
 namespace {
 #if _XERCES_VERSION >= 30000
     class ScoreDomSerFilter : public DOMLSSerializerFilter {
+        public:
+            virtual DOMNodeFilter::FilterAction acceptNode(const DOMNode *node) const;
 #else
     class ScoreDomSerFilter : public DOMWriterFilter {
-#endif
         public:
             virtual short acceptNode(const DOMNode *node) const;
+#endif
             virtual unsigned long getWhatToShow () const {
                 return DOMNodeFilter::SHOW_ALL;
             }
             virtual void setWhatToShow (unsigned long toShow) {}
     };
     
+#if _XERCES_VERSION >= 30000
+    DOMNodeFilter::FilterAction ScoreDomSerFilter::acceptNode(const DOMNode *node) const {
+#else
     short ScoreDomSerFilter::acceptNode(const DOMNode *node) const {
+#endif
         if (node->getNodeType () == DOMNode::ELEMENT_NODE &&
                  std::string(XMLtoUtf8(node->getNodeName()).c_str()) == "level") {
             const DOMElement *e = dynamic_cast<const DOMElement *>(node);



From ral at mail.berlios.de  Sat Jul  4 15:55:20 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sat, 4 Jul 2009 15:55:20 +0200
Subject: [Enigma-game-svn] r1741 - homepage/input
Message-ID: <200907041355.n64DtKkK027319@sheep.berlios.de>

Author: ral
Date: 2009-07-04 15:55:03 +0200 (Sat, 04 Jul 2009)
New Revision: 1741

Modified:
   homepage/input/download.html
   homepage/input/download_de.html
   homepage/input/download_ru.html
   homepage/input/stat-other.html
   homepage/input/table-hcp.html
   homepage/input/table-rat.html
   homepage/input/table-solved.html
   homepage/input/table-wr.html
   homepage/input/userlist.html
Log:
Homepage:
- statistics June 2009
- download openSUSE link

Modified: homepage/input/download.html
===================================================================
--- homepage/input/download.html	2009-07-02 22:29:49 UTC (rev 1740)
+++ homepage/input/download.html	2009-07-04 13:55:03 UTC (rev 1741)
@@ -94,6 +94,8 @@
 	FreeBSD</a></li>
   <li><a href="http://packages.gentoo.org/package/games-puzzle/enigma">
         Gentoo Linux</a></li>
+  <li><a href="http://en.opensuse.org/Games">
+	openSUSE</a> 10.3, 11.0, 11.1</li>
   <li><a href="http://packages.ubuntu.com/intrepid/enigma">
 	Ubuntu</a></li>
   <li><a href="http://archive.gp2x.de/cgi-bin/cfiles.cgi?0,0,0,0,25,1729">

Modified: homepage/input/download_de.html
===================================================================
--- homepage/input/download_de.html	2009-07-02 22:29:49 UTC (rev 1740)
+++ homepage/input/download_de.html	2009-07-04 13:55:03 UTC (rev 1741)
@@ -102,6 +102,8 @@
 	FreeBSD</a></li>
   <li><a href="http://packages.gentoo.org/package/games-puzzle/enigma">
         Gentoo Linux</a></li>
+  <li><a href="http://en.opensuse.org/Games">
+	openSUSE</a> 10.3, 11.0, 11.1</li>
   <li><a href="http://packages.ubuntu.com/intrepid/enigma">
 	Ubuntu</a></li>
   <li><a href="http://archive.gp2x.de/cgi-bin/cfiles.cgi?0,0,0,0,25,1729">

Modified: homepage/input/download_ru.html
===================================================================
--- homepage/input/download_ru.html	2009-07-02 22:29:49 UTC (rev 1740)
+++ homepage/input/download_ru.html	2009-07-04 13:55:03 UTC (rev 1741)
@@ -92,6 +92,8 @@
 	FreeBSD</a></li>
   <li><a href="http://packages.gentoo.org/package/games-puzzle/enigma">
         Gentoo Linux</a></li>
+  <li><a href="http://en.opensuse.org/Games">
+	openSUSE</a> 10.3, 11.0, 11.1</li>
   <li><a href="http://packages.ubuntu.com/intrepid/enigma">
 	Ubuntu</a></li>
   <li><a href="http://archive.gp2x.de/cgi-bin/cfiles.cgi?0,0,0,0,25,1729">

Modified: homepage/input/stat-other.html
===================================================================
--- homepage/input/stat-other.html	2009-07-02 22:29:49 UTC (rev 1740)
+++ homepage/input/stat-other.html	2009-07-04 13:55:03 UTC (rev 1741)
@@ -1,22 +1,22 @@
   <div class="stat-help">
     <h3>$$Other_Statistics$$</h3>
     <h4>$$Scores$$</h4>
-      94074 $$single_level_scores$$.
+      94765 $$single_level_scores$$.
     <h4>$$Ratings$$</h4>
-      17777 $$single_level_ratings$$ 4.93 $$and_distribution$$: 
+      17819 $$single_level_ratings$$ 4.93 $$and_distribution$$: 
       <table>
         <colgroup><col width="80"><col width="80"></colgroup>
         <tr><th>$$rating$$</th><th>$$count$$</th></tr>
         <tr><td class="num">0</td><td class="num">118</td></tr>
         <tr><td class="num">1</td><td class="num">320</td></tr>
-        <tr><td class="num">2</td><td class="num">917</td></tr>
+        <tr><td class="num">2</td><td class="num">919</td></tr>
         <tr><td class="num">3</td><td class="num">2451</td></tr>
-        <tr><td class="num">4</td><td class="num">3390</td></tr>
-        <tr><td class="num">5</td><td class="num">4246</td></tr>
-        <tr><td class="num">6</td><td class="num">3017</td></tr>
-        <tr><td class="num">7</td><td class="num">2023</td></tr>
-        <tr><td class="num">8</td><td class="num">796</td></tr>
-        <tr><td class="num">9</td><td class="num">330</td></tr>
+        <tr><td class="num">4</td><td class="num">3396</td></tr>
+        <tr><td class="num">5</td><td class="num">4253</td></tr>
+        <tr><td class="num">6</td><td class="num">3029</td></tr>
+        <tr><td class="num">7</td><td class="num">2030</td></tr>
+        <tr><td class="num">8</td><td class="num">801</td></tr>
+        <tr><td class="num">9</td><td class="num">333</td></tr>
         <tr><td class="num">10</td><td class="num">169</td></tr>
       </table>
   </div>

Modified: homepage/input/table-hcp.html
===================================================================
--- homepage/input/table-hcp.html	2009-07-02 22:29:49 UTC (rev 1740)
+++ homepage/input/table-hcp.html	2009-07-04 13:55:03 UTC (rev 1741)
@@ -1,100 +1,100 @@
   <table>
-    <caption>$$Handicap_Statistics$$ $$May$$ 2009</caption>
+    <caption>$$Handicap_Statistics$$ $$June$$ 2009</caption>
     <colgroup><col width="130"><col width="220"></colgroup>
     <tr><th>$$solved_hcp$$</th><th class="left">$$user$$</th></tr>
-     <tr><td class="num">-153.8</td><td class="left">'Moneymaker'</td></tr>
-     <tr><td class="num">-107.5</td><td class="left">'daydreamer'</td></tr>
-     <tr><td class="num">-105.9</td><td class="left">'Medimaster'</td></tr>
-     <tr><td class="num"> -75.3</td><td class="left">'Stupid'</td></tr>
-     <tr><td class="num"> -74.7</td><td class="left">'Johannes'</td></tr>
-     <tr><td class="num"> -67.0</td><td class="left">'Mentist'</td></tr>
-     <tr><td class="num"> -63.8</td><td class="left">'dev0'</td></tr>
-     <tr><td class="num"> -63.4</td><td class="left">'Great Scott'</td></tr>
-     <tr><td class="num"> -58.7</td><td class="left">'Daisy'</td></tr>
-     <tr><td class="num"> -54.8</td><td class="left">'Crystalicum'</td></tr>
-     <tr><td class="num"> -54.0</td><td class="left">'Duffy'</td></tr>
-     <tr><td class="num"> -52.7</td><td class="left">'Malla'</td></tr>
-     <tr><td class="num"> -49.4</td><td class="left">'ryujun'</td></tr>
-     <tr><td class="num"> -44.2</td><td class="left">'Alexandros'</td></tr>
-     <tr><td class="num"> -42.0</td><td class="left">'Django'</td></tr>
-     <tr><td class="num"> -39.6</td><td class="left">'Gloop'</td></tr>
+     <tr><td class="num">-153.7</td><td class="left">'Moneymaker'</td></tr>
+     <tr><td class="num">-119.7</td><td class="left">'Medimaster'</td></tr>
+     <tr><td class="num">-108.3</td><td class="left">'daydreamer'</td></tr>
+     <tr><td class="num"> -75.2</td><td class="left">'Stupid'</td></tr>
+     <tr><td class="num"> -74.6</td><td class="left">'Johannes'</td></tr>
+     <tr><td class="num"> -66.9</td><td class="left">'Mentist'</td></tr>
+     <tr><td class="num"> -63.7</td><td class="left">'dev0'</td></tr>
+     <tr><td class="num"> -63.2</td><td class="left">'Great Scott'</td></tr>
+     <tr><td class="num"> -62.0</td><td class="left">'Daisy'</td></tr>
+     <tr><td class="num"> -54.7</td><td class="left">'Crystalicum'</td></tr>
+     <tr><td class="num"> -53.9</td><td class="left">'Duffy'</td></tr>
+     <tr><td class="num"> -52.6</td><td class="left">'Malla'</td></tr>
+     <tr><td class="num"> -49.3</td><td class="left">'ryujun'</td></tr>
+     <tr><td class="num"> -43.9</td><td class="left">'Alexandros'</td></tr>
+     <tr><td class="num"> -41.9</td><td class="left">'Django'</td></tr>
+     <tr><td class="num"> -39.5</td><td class="left">'Gloop'</td></tr>
      <tr><td class="num"> -32.6</td><td class="left">'Taztunes'</td></tr>
-     <tr><td class="num"> -30.5</td><td class="left">'Safalra'</td></tr>
-     <tr><td class="num"> -30.2</td><td class="left">'Angolino'</td></tr>
-     <tr><td class="num"> -29.6</td><td class="left">'Emmanuel'</td></tr>
-     <tr><td class="num"> -27.7</td><td class="left">'Ludmian'</td></tr>
-     <tr><td class="num"> -24.9</td><td class="left">'B-Huff'</td></tr>
-     <tr><td class="num"> -23.5</td><td class="left">'dpl'</td></tr>
-     <tr><td class="num"> -22.1</td><td class="left">'Zekobah'</td></tr>
+     <tr><td class="num"> -30.4</td><td class="left">'Safalra'</td></tr>
+     <tr><td class="num"> -29.8</td><td class="left">'Angolino'</td></tr>
+     <tr><td class="num"> -29.4</td><td class="left">'Emmanuel'</td></tr>
+     <tr><td class="num"> -27.6</td><td class="left">'Ludmian'</td></tr>
+     <tr><td class="num"> -24.6</td><td class="left">'B-Huff'</td></tr>
+     <tr><td class="num"> -23.4</td><td class="left">'dpl'</td></tr>
+     <tr><td class="num"> -21.9</td><td class="left">'Zekobah'</td></tr>
      <tr><td class="num"> -21.6</td><td class="left">'bojster'</td></tr>
-     <tr><td class="num"> -21.0</td><td class="left">'Ghatotkacha'</td></tr>
-     <tr><td class="num"> -17.9</td><td class="left">'ged'</td></tr>
-     <tr><td class="num"> -16.5</td><td class="left">'hendrik'</td></tr>
-     <tr><td class="num"> -15.7</td><td class="left">'Raoul'</td></tr>
-     <tr><td class="num"> -15.7</td><td class="left">'ABS'</td></tr>
-     <tr><td class="num"> -12.9</td><td class="left">'Ronald'</td></tr>
+     <tr><td class="num"> -20.9</td><td class="left">'Ghatotkacha'</td></tr>
+     <tr><td class="num"> -17.6</td><td class="left">'ged'</td></tr>
+     <tr><td class="num"> -16.3</td><td class="left">'hendrik'</td></tr>
+     <tr><td class="num"> -15.6</td><td class="left">'Raoul'</td></tr>
+     <tr><td class="num"> -15.5</td><td class="left">'ABS'</td></tr>
+     <tr><td class="num"> -12.7</td><td class="left">'Ronald'</td></tr>
      <tr><td class="num"> -12.3</td><td class="left">'Dime'</td></tr>
      <tr><td class="num">  -7.5</td><td class="left">'Lukas'</td></tr>
      <tr><td class="num">  -6.7</td><td class="left">'HuB34'</td></tr>
-     <tr><td class="num">  -3.4</td><td class="left">'Timo'</td></tr>
-     <tr><td class="num">  -3.2</td><td class="left">'Iceshark7'</td></tr>
-     <tr><td class="num">  -2.4</td><td class="left">'joseba'</td></tr>
+     <tr><td class="num">  -3.5</td><td class="left">'Timo'</td></tr>
+     <tr><td class="num">  -3.0</td><td class="left">'Iceshark7'</td></tr>
+     <tr><td class="num">  -2.1</td><td class="left">'joseba'</td></tr>
      <tr><td class="num">  -0.3</td><td class="left">'mecke'</td></tr>
-     <tr><td class="num">   0.8</td><td class="left">'Daniel'</td></tr>
-     <tr><td class="num">   1.3</td><td class="left">'fabian'</td></tr>
-     <tr><td class="num">   1.7</td><td class="left">'U-Punkt'</td></tr>
-     <tr><td class="num">   2.2</td><td class="left">'Hairball'</td></tr>
+     <tr><td class="num">   0.9</td><td class="left">'Daniel'</td></tr>
+     <tr><td class="num">   1.4</td><td class="left">'fabian'</td></tr>
+     <tr><td class="num">   1.8</td><td class="left">'U-Punkt'</td></tr>
+     <tr><td class="num">   2.4</td><td class="left">'Hairball'</td></tr>
      <tr><td class="num">   2.6</td><td class="left">'Craven'</td></tr>
-     <tr><td class="num">   2.6</td><td class="left">'JuSt'</td></tr>
-     <tr><td class="num">   3.2</td><td class="left">'Wuzzy'</td></tr>
-     <tr><td class="num">   3.5</td><td class="left">'Freshman'</td></tr>
+     <tr><td class="num">   2.7</td><td class="left">'JuSt'</td></tr>
+     <tr><td class="num">   3.3</td><td class="left">'Wuzzy'</td></tr>
+     <tr><td class="num">   3.6</td><td class="left">'Freshman'</td></tr>
      <tr><td class="num">   3.7</td><td class="left">'Kevin'</td></tr>
-     <tr><td class="num">   4.3</td><td class="left">'mrduke'</td></tr>
+     <tr><td class="num">   4.4</td><td class="left">'mrduke'</td></tr>
+     <tr><td class="num">   5.3</td><td class="left">'Tiza'</td></tr>
      <tr><td class="num">   5.3</td><td class="left">'para_doks'</td></tr>
-     <tr><td class="num">   5.5</td><td class="left">'Tiza'</td></tr>
      <tr><td class="num">   5.7</td><td class="left">'Tobias'</td></tr>
      <tr><td class="num">   6.2</td><td class="left">'Another'</td></tr>
      <tr><td class="num">   6.8</td><td class="left">'alfred69'</td></tr>
-     <tr><td class="num">   7.0</td><td class="left">'Guglielmo'</td></tr>
-     <tr><td class="num">   8.0</td><td class="left">'Sigma'</td></tr>
-     <tr><td class="num">   8.1</td><td class="left">'serpent'</td></tr>
-     <tr><td class="num">   8.2</td><td class="left">'Andy'</td></tr>
-     <tr><td class="num">  10.2</td><td class="left">'H-J.Epting'</td></tr>
-     <tr><td class="num">  10.4</td><td class="left">'Austin'</td></tr>
-     <tr><td class="num">  11.6</td><td class="left">'shoki'</td></tr>
-     <tr><td class="num">  13.6</td><td class="left">'oxyd4ever'</td></tr>
-     <tr><td class="num">  14.2</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+     <tr><td class="num">   7.1</td><td class="left">'Guglielmo'</td></tr>
+     <tr><td class="num">   8.1</td><td class="left">'Sigma'</td></tr>
+     <tr><td class="num">   8.2</td><td class="left">'serpent'</td></tr>
+     <tr><td class="num">   8.3</td><td class="left">'Andy'</td></tr>
+     <tr><td class="num">   9.8</td><td class="left">'H-J.Epting'</td></tr>
+     <tr><td class="num">  10.6</td><td class="left">'Austin'</td></tr>
+     <tr><td class="num">  11.7</td><td class="left">'shoki'</td></tr>
+     <tr><td class="num">  13.5</td><td class="left">'oxyd4ever'</td></tr>
+     <tr><td class="num">  14.3</td><td class="left">'ShadowPhrogg32642342'</td></tr>
      <tr><td class="num">  16.4</td><td class="left">'Mark P.'</td></tr>
      <tr><td class="num">  16.5</td><td class="left">'Andreas'</td></tr>
      <tr><td class="num">  17.2</td><td class="left">'AlephD'</td></tr>
      <tr><td class="num">  17.5</td><td class="left">'Sim_Ed'</td></tr>
-     <tr><td class="num">  18.1</td><td class="left">'Chocolate Zero'</td></tr>
      <tr><td class="num">  18.1</td><td class="left">'Agnieszka'</td></tr>
-     <tr><td class="num">  18.9</td><td class="left">'casmith_789'</td></tr>
-     <tr><td class="num">  19.7</td><td class="left">'ais523'</td></tr>
+     <tr><td class="num">  18.2</td><td class="left">'Chocolate Zero'</td></tr>
+     <tr><td class="num">  19.1</td><td class="left">'casmith_789'</td></tr>
+     <tr><td class="num">  19.8</td><td class="left">'ais523'</td></tr>
      <tr><td class="num">  21.6</td><td class="left">'Ale'</td></tr>
-     <tr><td class="num">  21.9</td><td class="left">'Alex'</td></tr>
-     <tr><td class="num">  24.3</td><td class="left">'Antonio EE'</td></tr>
-     <tr><td class="num">  24.5</td><td class="left">'Klaus'</td></tr>
+     <tr><td class="num">  22.0</td><td class="left">'Alex'</td></tr>
+     <tr><td class="num">  24.4</td><td class="left">'Antonio EE'</td></tr>
+     <tr><td class="num">  24.6</td><td class="left">'Klaus'</td></tr>
      <tr><td class="num">  24.7</td><td class="left">'Jinajon'</td></tr>
-     <tr><td class="num">  25.1</td><td class="left">'Marc-Hendrik'</td></tr>
-     <tr><td class="num">  25.8</td><td class="left">'Chris'</td></tr>
-     <tr><td class="num">  26.1</td><td class="left">'Thomas'</td></tr>
+     <tr><td class="num">  25.2</td><td class="left">'Marc-Hendrik'</td></tr>
+     <tr><td class="num">  25.9</td><td class="left">'Chris'</td></tr>
+     <tr><td class="num">  26.2</td><td class="left">'Thomas'</td></tr>
      <tr><td class="num">  26.4</td><td class="left">'Feynman'</td></tr>
-     <tr><td class="num">  26.9</td><td class="left">'hdwow'</td></tr>
+     <tr><td class="num">  27.0</td><td class="left">'hdwow'</td></tr>
      <tr><td class="num">  27.1</td><td class="left">'Gottseinsohn'</td></tr>
      <tr><td class="num">  28.0</td><td class="left">'Bent'</td></tr>
-     <tr><td class="num">  28.1</td><td class="left">'Hans-HD'</td></tr>
+     <tr><td class="num">  28.2</td><td class="left">'Hans-HD'</td></tr>
      <tr><td class="num">  29.0</td><td class="left">'un_guru'</td></tr>
-     <tr><td class="num">  29.4</td><td class="left">'Little_Mole'</td></tr>
+     <tr><td class="num">  29.5</td><td class="left">'Little_Mole'</td></tr>
      <tr><td class="num">  29.9</td><td class="left">'J3FF'</td></tr>
-     <tr><td class="num">  30.7</td><td class="left">'biotopa'</td></tr>
+     <tr><td class="num">  30.8</td><td class="left">'biotopa'</td></tr>
      <tr><td class="num">  30.8</td><td class="left">'Vinksu'</td></tr>
+     <tr><td class="num">  31.0</td><td class="left">'evane'</td></tr>
      <tr><td class="num">  31.2</td><td class="left">'oblo'</td></tr>
-     <tr><td class="num">  31.2</td><td class="left">'GiannuzzITA'</td></tr>
-     <tr><td class="num">  31.2</td><td class="left">'evane'</td></tr>
+     <tr><td class="num">  31.3</td><td class="left">'GiannuzzITA'</td></tr>
      <tr><td class="num">  31.7</td><td class="left">'redsantz'</td></tr>
-     <tr><td class="num">  32.9</td><td class="left">'geembo_90'</td></tr>
+     <tr><td class="num">  33.0</td><td class="left">'geembo_90'</td></tr>
      <tr><td class="num">  33.0</td><td class="left">'Edgar_Flesk'</td></tr>
      <tr><td class="num">  33.1</td><td class="left">'Melanie'</td></tr>
      <tr><td class="num">  33.4</td><td class="left">'NorthForty'</td></tr>
@@ -102,16 +102,17 @@
      <tr><td class="num">  33.9</td><td class="left">'erich'</td></tr>
      <tr><td class="num">  34.0</td><td class="left">'Gorn'</td></tr>
      <tr><td class="num">  36.8</td><td class="left">'niebie'</td></tr>
-     <tr><td class="num">  36.8</td><td class="left">'MicWa'</td></tr>
-     <tr><td class="num">  36.9</td><td class="left">'WP319'</td></tr>
+     <tr><td class="num">  36.9</td><td class="left">'MicWa'</td></tr>
+     <tr><td class="num">  37.0</td><td class="left">'WP319'</td></tr>
      <tr><td class="num">  37.3</td><td class="left">'Kosby'</td></tr>
      <tr><td class="num">  38.1</td><td class="left">'alain'</td></tr>
      <tr><td class="num">  39.0</td><td class="left">'Liam Sheehan'</td></tr>
-     <tr><td class="num">  39.5</td><td class="left">'Rugby4ever'</td></tr>
-     <tr><td class="num">  40.4</td><td class="left">'WesleyCrusher'</td></tr>
+     <tr><td class="num">  39.6</td><td class="left">'Rugby4ever'</td></tr>
      <tr><td class="num">  40.5</td><td class="left">'Drotten'</td></tr>
+     <tr><td class="num">  40.5</td><td class="left">'WesleyCrusher'</td></tr>
      <tr><td class="num">  40.8</td><td class="left">'Archcorenth'</td></tr>
-     <tr><td class="num">  40.9</td><td class="left">'Harry Lim'</td></tr>
+     <tr><td class="num">  41.0</td><td class="left">'Harry Lim'</td></tr>
+     <tr><td class="num">  41.2</td><td class="left">'purplerainbow'</td></tr>
      <tr><td class="num">  41.4</td><td class="left">'B-man'</td></tr>
      <tr><td class="num">  41.8</td><td class="left">'Nfol'</td></tr>
      <tr><td class="num">  42.6</td><td class="left">'Tiger'</td></tr>
@@ -119,65 +120,65 @@
      <tr><td class="num">  43.2</td><td class="left">'Vlad'</td></tr>
      <tr><td class="num">  43.4</td><td class="left">'Snaily'</td></tr>
      <tr><td class="num">  44.3</td><td class="left">'Momcat'</td></tr>
-     <tr><td class="num">  45.0</td><td class="left">'Breezy'</td></tr>
-     <tr><td class="num">  45.6</td><td class="left">'Uli'</td></tr>
-     <tr><td class="num">  46.5</td><td class="left">'Tarim'</td></tr>
-     <tr><td class="num">  47.5</td><td class="left">'IntKecsk'</td></tr>
-     <tr><td class="num">  47.9</td><td class="left">'tjRaven'</td></tr>
-     <tr><td class="num">  47.9</td><td class="left">'Jonyzz'</td></tr>
-     <tr><td class="num">  48.4</td><td class="left">'Valkyrie2'</td></tr>
+     <tr><td class="num">  45.1</td><td class="left">'Breezy'</td></tr>
+     <tr><td class="num">  45.7</td><td class="left">'Uli'</td></tr>
+     <tr><td class="num">  46.6</td><td class="left">'Tarim'</td></tr>
+     <tr><td class="num">  47.6</td><td class="left">'IntKecsk'</td></tr>
+     <tr><td class="num">  48.0</td><td class="left">'tjRaven'</td></tr>
+     <tr><td class="num">  48.1</td><td class="left">'Jonyzz'</td></tr>
+     <tr><td class="num">  48.5</td><td class="left">'Valkyrie2'</td></tr>
      <tr><td class="num">  48.7</td><td class="left">'mhatta'</td></tr>
      <tr><td class="num">  48.9</td><td class="left">'ntaeijr'</td></tr>
-     <tr><td class="num">  50.8</td><td class="left">'Zak'</td></tr>
-     <tr><td class="num">  50.9</td><td class="left">'rima'</td></tr>
+     <tr><td class="num">  50.9</td><td class="left">'Zak'</td></tr>
      <tr><td class="num">  51.0</td><td class="left">'Tomson'</td></tr>
-     <tr><td class="num">  51.1</td><td class="left">'Mecki'</td></tr>
+     <tr><td class="num">  51.0</td><td class="left">'rima'</td></tr>
+     <tr><td class="num">  51.2</td><td class="left">'Mecki'</td></tr>
      <tr><td class="num">  51.3</td><td class="left">'brynn'</td></tr>
-     <tr><td class="num">  51.3</td><td class="left">'Sandra'</td></tr>
+     <tr><td class="num">  51.4</td><td class="left">'Sandra'</td></tr>
      <tr><td class="num">  51.4</td><td class="left">'Jeffrey S'</td></tr>
-     <tr><td class="num">  52.1</td><td class="left">'jdcampo'</td></tr>
-     <tr><td class="num">  52.5</td><td class="left">'ReasonAnce'</td></tr>
+     <tr><td class="num">  52.2</td><td class="left">'jdcampo'</td></tr>
+     <tr><td class="num">  52.6</td><td class="left">'ReasonAnce'</td></tr>
      <tr><td class="num">  53.1</td><td class="left">'AkRa'</td></tr>
-     <tr><td class="num">  53.8</td><td class="left">'Slav'</td></tr>
-     <tr><td class="num">  53.8</td><td class="left">'Pascal'</td></tr>
      <tr><td class="num">  53.8</td><td class="left">'Vaily'</td></tr>
+     <tr><td class="num">  53.9</td><td class="left">'Pascal'</td></tr>
+     <tr><td class="num">  54.0</td><td class="left">'Slav'</td></tr>
      <tr><td class="num">  54.7</td><td class="left">'Cyphase'</td></tr>
-     <tr><td class="num">  55.1</td><td class="left">'Turbogurk'</td></tr>
-     <tr><td class="num">  55.1</td><td class="left">'Neophilus'</td></tr>
-     <tr><td class="num">  56.9</td><td class="left">'krazy62'</td></tr>
-     <tr><td class="num">  58.1</td><td class="left">'Adonica'</td></tr>
+     <tr><td class="num">  55.2</td><td class="left">'Neophilus'</td></tr>
+     <tr><td class="num">  55.3</td><td class="left">'Turbogurk'</td></tr>
+     <tr><td class="num">  57.0</td><td class="left">'krazy62'</td></tr>
+     <tr><td class="num">  58.2</td><td class="left">'Adonica'</td></tr>
      <tr><td class="num">  58.5</td><td class="left">'Kadu'</td></tr>
-     <tr><td class="num">  60.0</td><td class="left">'Enrymather'</td></tr>
-     <tr><td class="num">  61.3</td><td class="left">'Sopoforic'</td></tr>
+     <tr><td class="num">  60.1</td><td class="left">'Enrymather'</td></tr>
+     <tr><td class="num">  61.4</td><td class="left">'Sopoforic'</td></tr>
      <tr><td class="num">  61.7</td><td class="left">'jumbo'</td></tr>
-     <tr><td class="num">  62.4</td><td class="left">'jdrexler'</td></tr>
-     <tr><td class="num">  63.1</td><td class="left">'Asbel'</td></tr>
+     <tr><td class="num">  62.5</td><td class="left">'jdrexler'</td></tr>
+     <tr><td class="num">  62.5</td><td class="left">'Jan'</td></tr>
+     <tr><td class="num">  63.2</td><td class="left">'Asbel'</td></tr>
      <tr><td class="num">  64.8</td><td class="left">'tasker'</td></tr>
-     <tr><td class="num">  65.1</td><td class="left">'Meeve'</td></tr>
+     <tr><td class="num">  65.2</td><td class="left">'Meeve'</td></tr>
      <tr><td class="num">  67.1</td><td class="left">'ael'</td></tr>
-     <tr><td class="num">  67.7</td><td class="left">'Samuel'</td></tr>
-     <tr><td class="num">  67.9</td><td class="left">'Sparkey'</td></tr>
-     <tr><td class="num">  68.0</td><td class="left">'schmusi20'</td></tr>
+     <tr><td class="num">  67.6</td><td class="left">'Samuel'</td></tr>
      <tr><td class="num">  68.0</td><td class="left">'Fred_the_wise'</td></tr>
+     <tr><td class="num">  68.0</td><td class="left">'Sparkey'</td></tr>
+     <tr><td class="num">  68.1</td><td class="left">'schmusi20'</td></tr>
      <tr><td class="num">  68.2</td><td class="left">'Alf'</td></tr>
      <tr><td class="num">  70.0</td><td class="left">'Magnus and Susi'</td></tr>
      <tr><td class="num">  70.7</td><td class="left">'Zhura'</td></tr>
      <tr><td class="num">  71.5</td><td class="left">'xmouse'</td></tr>
      <tr><td class="num">  72.8</td><td class="left">'Joona'</td></tr>
      <tr><td class="num">  72.9</td><td class="left">'AQZ'</td></tr>
-     <tr><td class="num">  74.4</td><td class="left">'crypto_rsa'</td></tr>
+     <tr><td class="num">  74.6</td><td class="left">'crypto_rsa'</td></tr>
      <tr><td class="num">  74.7</td><td class="left">'Dvorhagen'</td></tr>
-     <tr><td class="num">  75.5</td><td class="left">'Eselchen'</td></tr>
-     <tr><td class="num">  75.7</td><td class="left">'Nicol?s'</td></tr>
-     <tr><td class="num">  75.8</td><td class="left">'AsuCaga'</td></tr>
-     <tr><td class="num">  75.9</td><td class="left">'jojo'</td></tr>
+     <tr><td class="num">  75.6</td><td class="left">'Eselchen'</td></tr>
+     <tr><td class="num">  75.8</td><td class="left">'Nicol?s'</td></tr>
+     <tr><td class="num">  75.9</td><td class="left">'AsuCaga'</td></tr>
+     <tr><td class="num">  76.0</td><td class="left">'jojo'</td></tr>
      <tr><td class="num">  79.1</td><td class="left">'colonel crayon'</td></tr>
-     <tr><td class="num">  79.8</td><td class="left">'Kroetchen'</td></tr>
-     <tr><td class="num">  80.6</td><td class="left">'Agares'</td></tr>
-     <tr><td class="num">  81.9</td><td class="left">'IIkka'</td></tr>
+     <tr><td class="num">  79.9</td><td class="left">'Kroetchen'</td></tr>
+     <tr><td class="num">  80.8</td><td class="left">'Agares'</td></tr>
+     <tr><td class="num">  81.8</td><td class="left">'IIkka'</td></tr>
      <tr><td class="num">  85.6</td><td class="left">'Miel56'</td></tr>
      <tr><td class="num">  90.2</td><td class="left">'The red O'</td></tr>
      <tr><td class="num">  90.6</td><td class="left">'Sequoyah'</td></tr>
-     <tr><td class="num">  90.9</td><td class="left">'Jan'</td></tr>
-     <tr><td class="num">  92.5</td><td class="left">'Michael'</td></tr>
+     <tr><td class="num">  92.6</td><td class="left">'Michael'</td></tr>
   </table>

Modified: homepage/input/table-rat.html
===================================================================
--- homepage/input/table-rat.html	2009-07-02 22:29:49 UTC (rev 1740)
+++ homepage/input/table-rat.html	2009-07-04 13:55:03 UTC (rev 1741)
@@ -1,11 +1,11 @@
   <table>
-    <caption>$$Rating_Statistics$$ $$May$$ 2009</caption>
+    <caption>$$Rating_Statistics$$ $$June$$ 2009</caption>
     <colgroup><col width="80"><col width="80"><col width="220"></colgroup>
     <tr><th>$$count$$</th><th>$$average$$</th><th class="left">$$user$$</th></tr>    <tr><td class="num">1062</td><td class="num"> 5.06</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1056</td><td class="num"> 4.83</td><td class="left">'Taztunes'</td></tr>
     <tr><td class="num">1045</td><td class="num"> 4.93</td><td class="left">'Crystalicum'</td></tr>
     <tr><td class="num">1038</td><td class="num"> 5.04</td><td class="left">'dev0'</td></tr>
-    <tr><td class="num">899</td><td class="num"> 4.80</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num">900</td><td class="num"> 4.80</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">871</td><td class="num"> 5.09</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num">653</td><td class="num"> 5.01</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num">647</td><td class="num"> 4.79</td><td class="left">'U-Punkt'</td></tr>
@@ -15,11 +15,11 @@
     <tr><td class="num">573</td><td class="num"> 5.16</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">562</td><td class="num"> 4.48</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num">534</td><td class="num"> 4.97</td><td class="left">'B-Huff'</td></tr>
-    <tr><td class="num">511</td><td class="num"> 5.05</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num">512</td><td class="num"> 5.05</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num">511</td><td class="num"> 5.30</td><td class="left">'Lukas'</td></tr>
     <tr><td class="num">482</td><td class="num"> 4.04</td><td class="left">'Vinksu'</td></tr>
+    <tr><td class="num">470</td><td class="num"> 5.01</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num">448</td><td class="num"> 5.08</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num">439</td><td class="num"> 4.98</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num">433</td><td class="num"> 4.36</td><td class="left">'ged'</td></tr>
     <tr><td class="num">388</td><td class="num"> 4.86</td><td class="left">'Gloop'</td></tr>
     <tr><td class="num">307</td><td class="num"> 4.01</td><td class="left">'Sim_Ed'</td></tr>
@@ -33,7 +33,7 @@
     <tr><td class="num">129</td><td class="num"> 5.64</td><td class="left">'Raoul'</td></tr>
     <tr><td class="num">126</td><td class="num"> 5.79</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num">124</td><td class="num"> 4.44</td><td class="left">'Sigma'</td></tr>
-    <tr><td class="num">104</td><td class="num"> 4.20</td><td class="left">'Medimaster'</td></tr>
+    <tr><td class="num">105</td><td class="num"> 4.24</td><td class="left">'Medimaster'</td></tr>
     <tr><td class="num">100</td><td class="num"> 5.08</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num"> 97</td><td class="num"> 4.16</td><td class="left">'Safalra'</td></tr>
     <tr><td class="num"> 91</td><td class="num"> 4.41</td><td class="left">'Zhura'</td></tr>
@@ -65,6 +65,7 @@
     <tr><td class="num"> 13</td><td class="num"> 5.23</td><td class="left">'Samuel'</td></tr>
     <tr><td class="num"> 13</td><td class="num"> 8.15</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 11</td><td class="num"> 6.36</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+    <tr><td class="num"> 11</td><td class="num"> 7.73</td><td class="left">'evane'</td></tr>
     <tr><td class="num"> 10</td><td class="num"> 7.80</td><td class="left">'hdwow'</td></tr>
     <tr><td class="num"> 10</td><td class="num"> 4.90</td><td class="left">'ais523'</td></tr>
     <tr><td class="num">  8</td><td class="num"> 3.25</td><td class="left">'Vlad'</td></tr>
@@ -78,7 +79,6 @@
     <tr><td class="num">  4</td><td class="num">10.00</td><td class="left">'Kevin'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 5.75</td><td class="left">'joseba'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 5.75</td><td class="left">'Emmanuel'</td></tr>
-    <tr><td class="num">  4</td><td class="num"> 7.75</td><td class="left">'evane'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 1.00</td><td class="left">'Hans-HD'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 6.50</td><td class="left">'serpent'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 7.00</td><td class="left">'redsantz'</td></tr>
@@ -92,6 +92,7 @@
     <tr><td class="num">  2</td><td class="num"> 0.00</td><td class="left">'mhatta'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'jumbo'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'ael'</td></tr>
+    <tr><td class="num">  1</td><td class="num"> 9.00</td><td class="left">'purplerainbow'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 6.00</td><td class="left">'Slav'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'Uli'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 0.00</td><td class="left">'Fred_the_wise'</td></tr>

Modified: homepage/input/table-solved.html
===================================================================
--- homepage/input/table-solved.html	2009-07-02 22:29:49 UTC (rev 1740)
+++ homepage/input/table-solved.html	2009-07-04 13:55:03 UTC (rev 1741)
@@ -1,13 +1,13 @@
   <table>
-    <caption>$$Solved_Level_Statistics$$ $$May$$ 2009</caption>
+    <caption>$$Solved_Level_Statistics$$ $$June$$ 2009</caption>
     <colgroup><col width="130"><col width="130"><col width="130"><col width="240"></colgroup>
     <tr><th>$$difficult$$</th><th>$$easy$$</th><th>$$total$$</th><th class="left">$$user$$</th></tr>
     <tr><td class="num">1045/1045</td><td class="num">189/189</td><td class="num">100.00%</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1043/1045</td><td class="num">189/189</td><td class="num"> 99.84%</td><td class="left">'Taztunes'</td></tr>
     <tr><td class="num">1039/1045</td><td class="num">189/189</td><td class="num"> 99.51%</td><td class="left">'dev0'</td></tr>
     <tr><td class="num">1035/1045</td><td class="num">183/189</td><td class="num"> 98.70%</td><td class="left">'Dime'</td></tr>
-    <tr><td class="num">1027/1045</td><td class="num">189/189</td><td class="num"> 98.54%</td><td class="left">'Ronald'</td></tr>
-    <tr><td class="num">1029/1045</td><td class="num">186/189</td><td class="num"> 98.46%</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num">1028/1045</td><td class="num">189/189</td><td class="num"> 98.62%</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num">1029/1045</td><td class="num">187/189</td><td class="num"> 98.54%</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">1034/1045</td><td class="num">181/189</td><td class="num"> 98.46%</td><td class="left">'Moneymaker'</td></tr>
     <tr><td class="num">1029/1045</td><td class="num">185/189</td><td class="num"> 98.38%</td><td class="left">'Freshman'</td></tr>
     <tr><td class="num">1029/1045</td><td class="num">183/189</td><td class="num"> 98.22%</td><td class="left">'Craven'</td></tr>
@@ -15,11 +15,11 @@
     <tr><td class="num">1021/1045</td><td class="num">177/189</td><td class="num"> 97.08%</td><td class="left">'Malla'</td></tr>
     <tr><td class="num">1014/1045</td><td class="num">175/189</td><td class="num"> 96.35%</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num"> 999/1045</td><td class="num">177/189</td><td class="num"> 95.30%</td><td class="left">'biotopa'</td></tr>
-    <tr><td class="num"> 985/1045</td><td class="num">176/189</td><td class="num"> 94.08%</td><td class="left">'Daisy'</td></tr>
+    <tr><td class="num"> 989/1045</td><td class="num">176/189</td><td class="num"> 94.41%</td><td class="left">'Daisy'</td></tr>
     <tr><td class="num"> 970/1045</td><td class="num">166/189</td><td class="num"> 92.06%</td><td class="left">'Andy'</td></tr>
     <tr><td class="num"> 962/1045</td><td class="num">173/189</td><td class="num"> 91.98%</td><td class="left">'mecke'</td></tr>
+    <tr><td class="num"> 956/1045</td><td class="num">163/189</td><td class="num"> 90.68%</td><td class="left">'H-J.Epting'</td></tr>
     <tr><td class="num"> 949/1045</td><td class="num">170/189</td><td class="num"> 90.68%</td><td class="left">'para_doks'</td></tr>
-    <tr><td class="num"> 942/1045</td><td class="num">160/189</td><td class="num"> 89.30%</td><td class="left">'H-J.Epting'</td></tr>
     <tr><td class="num"> 937/1045</td><td class="num">162/189</td><td class="num"> 89.06%</td><td class="left">'Mentist'</td></tr>
     <tr><td class="num"> 922/1045</td><td class="num">154/189</td><td class="num"> 87.20%</td><td class="left">'mrduke'</td></tr>
     <tr><td class="num"> 933/1045</td><td class="num">125/189</td><td class="num"> 85.74%</td><td class="left">'Alex'</td></tr>
@@ -33,7 +33,7 @@
     <tr><td class="num"> 846/1045</td><td class="num">144/189</td><td class="num"> 80.23%</td><td class="left">'Gorn'</td></tr>
     <tr><td class="num"> 854/1045</td><td class="num">131/189</td><td class="num"> 79.82%</td><td class="left">'shoki'</td></tr>
     <tr><td class="num"> 874/1045</td><td class="num">103/189</td><td class="num"> 79.17%</td><td class="left">'Melanie'</td></tr>
-    <tr><td class="num"> 896/1045</td><td class="num"> 54/189</td><td class="num"> 76.99%</td><td class="left">'evane'</td></tr>
+    <tr><td class="num"> 898/1045</td><td class="num"> 54/189</td><td class="num"> 77.15%</td><td class="left">'evane'</td></tr>
     <tr><td class="num"> 950/1045</td><td class="num">  0/189</td><td class="num"> 76.99%</td><td class="left">'Tarim'</td></tr>
     <tr><td class="num"> 804/1045</td><td class="num">142/189</td><td class="num"> 76.66%</td><td class="left">'Safalra'</td></tr>
     <tr><td class="num"> 800/1045</td><td class="num">135/189</td><td class="num"> 75.77%</td><td class="left">'dpl'</td></tr>
@@ -53,11 +53,11 @@
     <tr><td class="num"> 650/1045</td><td class="num">110/189</td><td class="num"> 61.59%</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 681/1045</td><td class="num"> 78/189</td><td class="num"> 61.51%</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 659/1045</td><td class="num"> 95/189</td><td class="num"> 61.10%</td><td class="left">'Marc-Hendrik'</td></tr>
+    <tr><td class="num"> 631/1045</td><td class="num"> 98/189</td><td class="num"> 59.08%</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num"> 665/1045</td><td class="num"> 64/189</td><td class="num"> 59.08%</td><td class="left">'alain'</td></tr>
     <tr><td class="num"> 643/1045</td><td class="num"> 83/189</td><td class="num"> 58.83%</td><td class="left">'Great Scott'</td></tr>
     <tr><td class="num"> 714/1045</td><td class="num">  0/189</td><td class="num"> 57.86%</td><td class="left">'Gottseinsohn'</td></tr>
     <tr><td class="num"> 637/1045</td><td class="num"> 63/189</td><td class="num"> 56.73%</td><td class="left">'ais523'</td></tr>
-    <tr><td class="num"> 604/1045</td><td class="num"> 94/189</td><td class="num"> 56.56%</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num"> 620/1045</td><td class="num"> 72/189</td><td class="num"> 56.08%</td><td class="left">'Breezy'</td></tr>
     <tr><td class="num"> 636/1045</td><td class="num"> 55/189</td><td class="num"> 56.00%</td><td class="left">'fabian'</td></tr>
     <tr><td class="num"> 575/1045</td><td class="num">115/189</td><td class="num"> 55.92%</td><td class="left">'Mark P.'</td></tr>
@@ -65,8 +65,8 @@
     <tr><td class="num"> 599/1045</td><td class="num"> 80/189</td><td class="num"> 55.02%</td><td class="left">'serpent'</td></tr>
     <tr><td class="num"> 577/1045</td><td class="num">100/189</td><td class="num"> 54.86%</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 634/1045</td><td class="num"> 43/189</td><td class="num"> 54.86%</td><td class="left">'Klaus'</td></tr>
+    <tr><td class="num"> 561/1045</td><td class="num">110/189</td><td class="num"> 54.38%</td><td class="left">'oxyd4ever'</td></tr>
     <tr><td class="num"> 576/1045</td><td class="num"> 93/189</td><td class="num"> 54.21%</td><td class="left">'Guglielmo'</td></tr>
-    <tr><td class="num"> 552/1045</td><td class="num">107/189</td><td class="num"> 53.40%</td><td class="left">'oxyd4ever'</td></tr>
     <tr><td class="num"> 525/1045</td><td class="num"> 95/189</td><td class="num"> 50.24%</td><td class="left">'ShadowPhrogg32642342'</td></tr>
     <tr><td class="num"> 589/1045</td><td class="num"> 26/189</td><td class="num"> 49.84%</td><td class="left">'hdwow'</td></tr>
     <tr><td class="num"> 533/1045</td><td class="num"> 82/189</td><td class="num"> 49.84%</td><td class="left">'Wuzzy'</td></tr>
@@ -89,9 +89,9 @@
     <tr><td class="num"> 503/1045</td><td class="num">  7/189</td><td class="num"> 41.33%</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num"> 397/1045</td><td class="num"> 93/189</td><td class="num"> 39.71%</td><td class="left">'Hairball'</td></tr>
     <tr><td class="num"> 440/1045</td><td class="num"> 50/189</td><td class="num"> 39.71%</td><td class="left">'ged'</td></tr>
+    <tr><td class="num"> 412/1045</td><td class="num"> 70/189</td><td class="num"> 39.06%</td><td class="left">'Medimaster'</td></tr>
     <tr><td class="num"> 369/1045</td><td class="num">112/189</td><td class="num"> 38.98%</td><td class="left">'Jinajon'</td></tr>
     <tr><td class="num"> 438/1045</td><td class="num">  3/189</td><td class="num"> 35.74%</td><td class="left">'oblo'</td></tr>
-    <tr><td class="num"> 375/1045</td><td class="num"> 66/189</td><td class="num"> 35.74%</td><td class="left">'Medimaster'</td></tr>
     <tr><td class="num"> 396/1045</td><td class="num"> 43/189</td><td class="num"> 35.58%</td><td class="left">'Jeffrey S'</td></tr>
     <tr><td class="num"> 359/1045</td><td class="num"> 74/189</td><td class="num"> 35.09%</td><td class="left">'Crystalicum'</td></tr>
     <tr><td class="num"> 392/1045</td><td class="num"> 40/189</td><td class="num"> 35.01%</td><td class="left">'hendrik'</td></tr>
@@ -99,6 +99,7 @@
     <tr><td class="num"> 389/1045</td><td class="num"> 37/189</td><td class="num"> 34.52%</td><td class="left">'Mecki'</td></tr>
     <tr><td class="num"> 397/1045</td><td class="num"> 24/189</td><td class="num"> 34.12%</td><td class="left">'Chocolate Zero'</td></tr>
     <tr><td class="num"> 358/1045</td><td class="num"> 53/189</td><td class="num"> 33.31%</td><td class="left">'casmith_789'</td></tr>
+    <tr><td class="num"> 364/1045</td><td class="num"> 41/189</td><td class="num"> 32.82%</td><td class="left">'purplerainbow'</td></tr>
     <tr><td class="num"> 392/1045</td><td class="num"> 12/189</td><td class="num"> 32.74%</td><td class="left">'NorthForty'</td></tr>
     <tr><td class="num"> 344/1045</td><td class="num"> 51/189</td><td class="num"> 32.01%</td><td class="left">'Momcat'</td></tr>
     <tr><td class="num"> 382/1045</td><td class="num"> 10/189</td><td class="num"> 31.77%</td><td class="left">'J3FF'</td></tr>
@@ -131,6 +132,7 @@
     <tr><td class="num"> 188/1045</td><td class="num"> 33/189</td><td class="num"> 17.91%</td><td class="left">'Pascal'</td></tr>
     <tr><td class="num"> 209/1045</td><td class="num"> 11/189</td><td class="num"> 17.83%</td><td class="left">'GiannuzzITA'</td></tr>
     <tr><td class="num"> 206/1045</td><td class="num">  4/189</td><td class="num"> 17.02%</td><td class="left">'krazy62'</td></tr>
+    <tr><td class="num"> 165/1045</td><td class="num"> 37/189</td><td class="num"> 16.37%</td><td class="left">'Jan'</td></tr>
     <tr><td class="num"> 181/1045</td><td class="num"> 20/189</td><td class="num"> 16.29%</td><td class="left">'Vaily'</td></tr>
     <tr><td class="num"> 170/1045</td><td class="num"> 26/189</td><td class="num"> 15.88%</td><td class="left">'jumbo'</td></tr>
     <tr><td class="num"> 156/1045</td><td class="num"> 24/189</td><td class="num"> 14.59%</td><td class="left">'jdcampo'</td></tr>
@@ -178,6 +180,5 @@
     <tr><td class="num">  39/1045</td><td class="num">  0/189</td><td class="num">  3.16%</td><td class="left">'Sequoyah'</td></tr>
     <tr><td class="num">  27/1045</td><td class="num">  5/189</td><td class="num">  2.59%</td><td class="left">'Miel56'</td></tr>
     <tr><td class="num">  23/1045</td><td class="num">  5/189</td><td class="num">  2.27%</td><td class="left">'The red O'</td></tr>
-    <tr><td class="num">  13/1045</td><td class="num"> 13/189</td><td class="num">  2.11%</td><td class="left">'Jan'</td></tr>
     <tr><td class="num">   7/1045</td><td class="num"> 12/189</td><td class="num">  1.54%</td><td class="left">'Michael'</td></tr>
   </table>

Modified: homepage/input/table-wr.html
===================================================================
--- homepage/input/table-wr.html	2009-07-02 22:29:49 UTC (rev 1740)
+++ homepage/input/table-wr.html	2009-07-04 13:55:03 UTC (rev 1741)
@@ -1,49 +1,48 @@
   <table>
-    <caption>$$Worldrecord_Statistics$$ $$May$$ 2009</caption>
+    <caption>$$Worldrecord_Statistics$$ $$June$$ 2009</caption>
     <colgroup><col width="80"><col width="80"><col width="470"></colgroup>
     <tr><th>$$total$$</th><th>$$shared$$</th><th class="left">$$user$$</th></tr>
-    <tr><td class="num">990</td><td class="num">269</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">253</td><td class="num">151</td><td class="left">'Medimaster'</td></tr>
-    <tr><td class="num">146</td><td class="num">122</td><td class="left">'daydreamer'</td></tr>
-    <tr><td class="num">136</td><td class="num">134</td><td class="left">'Crystalicum'</td></tr>
-    <tr><td class="num">104</td><td class="num"> 69</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num"> 78</td><td class="num"> 73</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num"> 72</td><td class="num"> 66</td><td class="left">'dev0'</td></tr>
-    <tr><td class="num"> 66</td><td class="num"> 65</td><td class="left">'Mentist'</td></tr>
-    <tr><td class="num"> 44</td><td class="num"> 39</td><td class="left">'Daisy'</td></tr>
-    <tr><td class="num"> 35</td><td class="num"> 30</td><td class="left">'Duffy'</td></tr>
-    <tr><td class="num"> 32</td><td class="num"> 23</td><td class="left">'Malla'</td></tr>
-    <tr><td class="num"> 32</td><td class="num"> 31</td><td class="left">'Ghatotkacha'</td></tr>
-    <tr><td class="num"> 26</td><td class="num"> 25</td><td class="left">'Angolino'</td></tr>
-    <tr><td class="num"> 25</td><td class="num"> 24</td><td class="left">'Django'</td></tr>
-    <tr><td class="num"> 25</td><td class="num"> 25</td><td class="left">'Great Scott'</td></tr>
-    <tr><td class="num"> 24</td><td class="num"> 22</td><td class="left">'Alexandros' + 'Zekobah'</td></tr>
-    <tr><td class="num"> 23</td><td class="num"> 23</td><td class="left">'Iceshark7' + 'ryujun'</td></tr>
-    <tr><td class="num"> 21</td><td class="num"> 21</td><td class="left">'joseba'</td></tr>
-    <tr><td class="num"> 16</td><td class="num"> 14</td><td class="left">'Emmanuel'</td></tr>
-    <tr><td class="num"> 16</td><td class="num"> 16</td><td class="left">'ged'</td></tr>
+    <tr><td class="num">929</td><td class="num">259</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">328</td><td class="num">172</td><td class="left">'Medimaster'</td></tr>
+    <tr><td class="num">142</td><td class="num">118</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num">124</td><td class="num">122</td><td class="left">'Crystalicum'</td></tr>
+    <tr><td class="num">102</td><td class="num"> 69</td><td class="left">'Stupid'</td></tr>
+    <tr><td class="num"> 74</td><td class="num"> 69</td><td class="left">'Johannes'</td></tr>
+    <tr><td class="num"> 65</td><td class="num"> 59</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num"> 63</td><td class="num"> 62</td><td class="left">'Mentist'</td></tr>
+    <tr><td class="num"> 50</td><td class="num"> 43</td><td class="left">'Daisy'</td></tr>
+    <tr><td class="num"> 32</td><td class="num"> 27</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num"> 31</td><td class="num"> 22</td><td class="left">'Malla'</td></tr>
+    <tr><td class="num"> 29</td><td class="num"> 28</td><td class="left">'Ghatotkacha'</td></tr>
+    <tr><td class="num"> 23</td><td class="num"> 21</td><td class="left">'Alexandros'</td></tr>
+    <tr><td class="num"> 23</td><td class="num"> 22</td><td class="left">'Django'</td></tr>
+    <tr><td class="num"> 23</td><td class="num"> 23</td><td class="left">'Great Scott'</td></tr>
+    <tr><td class="num"> 22</td><td class="num"> 20</td><td class="left">'Zekobah'</td></tr>
+    <tr><td class="num"> 22</td><td class="num"> 21</td><td class="left">'Angolino'</td></tr>
+    <tr><td class="num"> 21</td><td class="num"> 21</td><td class="left">'joseba' + 'Iceshark7'</td></tr>
+    <tr><td class="num"> 20</td><td class="num"> 20</td><td class="left">'ryujun'</td></tr>
+    <tr><td class="num"> 15</td><td class="num"> 13</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 14</td><td class="num"> 12</td><td class="left">'B-Huff'</td></tr>
-    <tr><td class="num"> 14</td><td class="num"> 14</td><td class="left">'Safalra'</td></tr>
+    <tr><td class="num"> 14</td><td class="num"> 14</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 13</td><td class="num">  8</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num"> 13</td><td class="num"> 12</td><td class="left">'HuB34'</td></tr>
-    <tr><td class="num"> 13</td><td class="num"> 13</td><td class="left">'Ludmian'</td></tr>
-    <tr><td class="num"> 10</td><td class="num"> 10</td><td class="left">'bojster' + 'casmith_789'</td></tr>
+    <tr><td class="num"> 13</td><td class="num"> 13</td><td class="left">'Safalra' + 'Ludmian'</td></tr>
     <tr><td class="num">  9</td><td class="num">  7</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-    <tr><td class="num">  9</td><td class="num">  8</td><td class="left">'Gloop'</td></tr>
-    <tr><td class="num">  9</td><td class="num">  9</td><td class="left">'fabian' + 'dpl'</td></tr>
-    <tr><td class="num">  8</td><td class="num">  7</td><td class="left">'Chocolate Zero' + 'Dime'</td></tr>
-    <tr><td class="num">  8</td><td class="num">  8</td><td class="left">'H-J.Epting'</td></tr>
-    <tr><td class="num">  7</td><td class="num">  6</td><td class="left">'Edgar_Flesk'</td></tr>
-    <tr><td class="num">  6</td><td class="num">  5</td><td class="left">'Guglielmo'</td></tr>
+    <tr><td class="num">  9</td><td class="num">  9</td><td class="left">'bojster' + 'fabian'</td></tr>
+    <tr><td class="num">  8</td><td class="num">  7</td><td class="left">'Chocolate Zero'</td></tr>
+    <tr><td class="num">  8</td><td class="num">  8</td><td class="left">'Gloop' + 'casmith_789' + 'dpl'</td></tr>
+    <tr><td class="num">  7</td><td class="num">  6</td><td class="left">'Dime'</td></tr>
+    <tr><td class="num">  7</td><td class="num">  7</td><td class="left">'H-J.Epting'</td></tr>
+    <tr><td class="num">  6</td><td class="num">  5</td><td class="left">'Guglielmo' + 'Edgar_Flesk'</td></tr>
     <tr><td class="num">  6</td><td class="num">  6</td><td class="left">'ABS'</td></tr>
     <tr><td class="num">  5</td><td class="num">  3</td><td class="left">'Breezy'</td></tr>
     <tr><td class="num">  5</td><td class="num">  4</td><td class="left">'Another'</td></tr>
-    <tr><td class="num">  5</td><td class="num">  5</td><td class="left">'Raoul' + 'Thomas' + 'mecke' + 'Chris' + 'Tobias' + 'Wuzzy' + 'Ralf'</td></tr>
-    <tr><td class="num">  4</td><td class="num">  4</td><td class="left">'Taztunes' + 'U-Punkt' + 'J3FF' + 'para_doks' + 'GiannuzzITA' + 'Lukas'</td></tr>
+    <tr><td class="num">  5</td><td class="num">  5</td><td class="left">'Thomas' + 'Chris' + 'Ralf'</td></tr>
+    <tr><td class="num">  4</td><td class="num">  4</td><td class="left">'Taztunes' + 'U-Punkt' + 'Raoul' + 'J3FF' + 'para_doks' + 'mecke' + 'Tobias' + 'Wuzzy' + 'Lukas'</td></tr>
     <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'Hairball' + 'Stephanie'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'Sigma' + 'Tiza' + 'Neophilus' + 'Nicol?s' + 'Cyphase' + 'Andy'</td></tr>
-    <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'alfred69' + 'ReasonAnce' + 'mrduke' + 'geembo_90' + 'Drotten' + 'Sim_Ed' + 'hendrik' + 'Bent' + 'Austin' + 'Snaily' + 'Craven' + 'Sopoforic' + 'Ingo' + 'serpent'</td></tr>
+    <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'GiannuzzITA'</td></tr>
+    <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'alfred69' + 'ReasonAnce' + 'mrduke' + 'Sigma' + 'geembo_90' + 'Tiza' + 'Drotten' + 'Neophilus' + 'Sim_Ed' + 'Nicol?s' + 'Cyphase' + 'Andy' + 'hendrik' + 'Austin' + 'Snaily' + 'Craven' + 'Sopoforic' + 'Ingo' + 'serpent'</td></tr>
     <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'Feynman' + 'alain' + 'colonel crayon' + 'Gorn' + 'Nat'</td></tr>
-    <tr><td class="num">  1</td><td class="num">  1</td><td class="left">'Agares' + 'Tiger' + 'Zak' + 'Daniel' + 'Slav' + 'niebie' + 'Andreas' + 'AlephD' + 'Samuel' + 'tjRaven' + 'Mark P.' + 'oblo' + 'Pascal' + 'hdwow' + 'B-man' + 'Asbel' + 'Vlad' + 'Jinajon' + 'Vaily' + 'Antonio EE' + 'JuSt' + 'Timo'</td></tr>
-    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'tasker' + 'jumbo' + 'Miel56' + 'Zhura' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'ntaeijr' + 'Eselchen' + 'ael' + 'biotopa' + 'Ale' + 'brynn' + 'IntKecsk' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'jdrexler' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'Valkyrie2' + 'Fred_the_wise' + 'Jan' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'Kroetchen' + 'crypto_rsa' + 'Harry Lim' + 'Sequoyah' + 'AkRa' + 'Momcat' + 'Tomson' + 'NorthForty' + 'Mecki' + 'The red O' + 'gringer' + 'IIkka' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'Kadu' + 'shoki' + 'Enrymather' + 'jojo' + 'WesleyCrusher' + 'evane' + 'rima' + 'Klaus' + 'MicWa' + 'AsuCaga' + 'oxyd4ever' + 'Jonyzz' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'un_guru' + 'krazy62' + 'Dvorhagen' + 'Sparkey' + 'ais523' + 'Holger' + 'Ingo_K' + 'Ant' + 'Melanie' + 'IChrisI' + 'redsa!
 ntz' + 'Markus' + 'Michael' + 'Liam Sheehan' + 'Tarim' + 'Agnieszka'</td></tr>
+    <tr><td class="num">  1</td><td class="num">  1</td><td class="left">'Agares' + 'Tiger' + 'Zak' + 'Daniel' + 'Slav' + 'niebie' + 'Andreas' + 'AlephD' + 'Samuel' + 'tjRaven' + 'Mark P.' + 'oblo' + 'Pascal' + 'hdwow' + 'B-man' + 'Asbel' + 'Vlad' + 'Bent' + 'Vaily' + 'Antonio EE' + 'JuSt' + 'Timo'</td></tr>
+    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'tasker' + 'jumbo' + 'Miel56' + 'Zhura' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'ntaeijr' + 'Eselchen' + 'ael' + 'biotopa' + 'Ale' + 'brynn' + 'IntKecsk' + 'purplerainbow' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'jdrexler' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'Valkyrie2' + 'Fred_the_wise' + 'Jan' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'Kroetchen' + 'crypto_rsa' + 'Harry Lim' + 'Sequoyah' + 'AkRa' + 'Momcat' + 'Tomson' + 'NorthForty' + 'Mecki' + 'The red O' + 'gringer' + 'IIkka' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'Kadu' + 'shoki' + 'Enrymather' + 'jojo' + 'WesleyCrusher' + 'evane' + 'Jinajon' + 'rima' + 'Klaus' + 'MicWa' + 'AsuCaga' + 'oxyd4ever' + 'Jonyzz' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'un_guru' + 'krazy62' + 'Dvorhagen' + 'Sparkey' + 'ais523' + 'Holger' + 'Ingo_K' + 'Ant' + !
 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Michael' + 'Liam Sheehan' + 'Tarim' + 'Agnieszka'</td></tr>
   </table>

Modified: homepage/input/userlist.html
===================================================================
--- homepage/input/userlist.html	2009-07-02 22:29:49 UTC (rev 1740)
+++ homepage/input/userlist.html	2009-07-04 13:55:03 UTC (rev 1741)
@@ -137,6 +137,7 @@
     <li>oxyd4ever</li>
     <li>para_doks</li>
     <li>Pascal</li>
+    <li>purplerainbow</li>
     <li>Ralf</li>
     <li>Raoul</li>
     <li>ReasonAnce</li>



From ral at mail.berlios.de  Sun Jul  5 01:28:11 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 5 Jul 2009 01:28:11 +0200
Subject: [Enigma-game-svn] r1742 - in trunk/src: actors stones
Message-ID: <200907042328.n64NSBoP032640@sheep.berlios.de>

Author: ral
Date: 2009-07-05 01:28:10 +0200 (Sun, 05 Jul 2009)
New Revision: 1742

Modified:
   trunk/src/actors/Balls.cc
   trunk/src/stones/StandardStones.cc
Log:
Trunk 1.1:
- fix standard stones collision sounds
- fix pearl sinking in water in non Enigma modes

Modified: trunk/src/actors/Balls.cc
===================================================================
--- trunk/src/actors/Balls.cc	2009-07-04 13:55:03 UTC (rev 1741)
+++ trunk/src/actors/Balls.cc	2009-07-04 23:28:10 UTC (rev 1742)
@@ -567,10 +567,11 @@
     }
     
     void Pearl::sink(double dtime) {
-        if (server::GameCompatibility != GAMET_ENIGMA)
-            return;    // do not sink pearls in oxyd modes
-        else
-            BasicBall::sink(dtime);
+        if (server::GameCompatibility != GAMET_ENIGMA) {
+            if (m_actorinfo.field->floor->isKind("fl_swamp"))  
+                return;    // do not sink pearls in swamp in oxyd modes
+        }
+        BasicBall::sink(dtime);
     }
 
     int Pearl::traitsIdx() const {

Modified: trunk/src/stones/StandardStones.cc
===================================================================
--- trunk/src/stones/StandardStones.cc	2009-07-04 13:55:03 UTC (rev 1741)
+++ trunk/src/stones/StandardStones.cc	2009-07-04 23:28:10 UTC (rev 1742)
@@ -81,7 +81,7 @@
     }
 
     const char *StandardStone::collision_sound() {
-        return (objFlags & OBJBIT_CLOTH) ? "stone" : "cloth";
+        return (objFlags & OBJBIT_CLOTH) ? "cloth" : "stone";
     }
     
     int StandardStone::traitsIdx() const {



From ral at mail.berlios.de  Sun Jul  5 11:48:14 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 5 Jul 2009 11:48:14 +0200
Subject: [Enigma-game-svn] r1743 - trunk/src/stones
Message-ID: <200907050948.n659mECA007943@sheep.berlios.de>

Author: ral
Date: 2009-07-05 11:48:13 +0200 (Sun, 05 Jul 2009)
New Revision: 1743

Modified:
   trunk/src/stones/GlassStones.cc
   trunk/src/stones/GreenBrownStone.cc
Log:
Trunk 1.1:
- fix glass and greenbrown stones collision sounds


Modified: trunk/src/stones/GlassStones.cc
===================================================================
--- trunk/src/stones/GlassStones.cc	2009-07-04 23:28:10 UTC (rev 1742)
+++ trunk/src/stones/GlassStones.cc	2009-07-05 09:48:13 UTC (rev 1743)
@@ -97,7 +97,7 @@
     }
 
     const char *GlassStone::collision_sound() {
-        return (objFlags & OBJBIT_CLOTH) ? "stone" : "cloth";
+        return (objFlags & OBJBIT_CLOTH) ? "cloth" : "stone";
     }
     
     int GlassStone::traitsIdx() const {

Modified: trunk/src/stones/GreenBrownStone.cc
===================================================================
--- trunk/src/stones/GreenBrownStone.cc	2009-07-04 23:28:10 UTC (rev 1742)
+++ trunk/src/stones/GreenBrownStone.cc	2009-07-05 09:48:13 UTC (rev 1743)
@@ -105,7 +105,7 @@
     }
 
     const char *GreenBrownStone::collision_sound() {
-        return (objFlags & OBJBIT_CLOTH) ? "stone" : "cloth";
+        return (objFlags & OBJBIT_CLOTH) ? "cloth" : "stone";
     }
     
     int GreenBrownStone::traitsIdx() const {



From ral at mail.berlios.de  Sun Jul  5 18:09:02 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 5 Jul 2009 18:09:02 +0200
Subject: [Enigma-game-svn] r1744 - in trunk: . src src/gui src/items src/lev
Message-ID: <200907051609.n65G923W019223@sheep.berlios.de>

Author: ral
Date: 2009-07-05 18:08:50 +0200 (Sun, 05 Jul 2009)
New Revision: 1744

Modified:
   trunk/configure.ac
   trunk/src/SoundEngine.hh
   trunk/src/gui/LevelPackMenu.cc
   trunk/src/gui/LevelPackMenu.hh
   trunk/src/items/SimpleItems.cc
   trunk/src/lev/RatingManager.cc
Log:
Trunk 1.1:
- fixes of some missing return statements


Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2009-07-05 09:48:13 UTC (rev 1743)
+++ trunk/configure.ac	2009-07-05 16:08:50 UTC (rev 1744)
@@ -172,7 +172,7 @@
 dnl Check for xerces
 dnl ----------------------------------------
 if test "$MINGW32" = yes; then
-  AC_MSG_CHECKING([for Xerces 3.0 experimental version])
+  AC_MSG_CHECKING([for Xerces release 3.0])
   AC_EGREP_HEADER([gXercesMajVersion = 3],[xercesc/util/XercesVersion.hpp],
       [AC_MSG_RESULT([found])],
       [AC_MSG_ERROR([not found])])      

Modified: trunk/src/SoundEngine.hh
===================================================================
--- trunk/src/SoundEngine.hh	2009-07-05 09:48:13 UTC (rev 1743)
+++ trunk/src/SoundEngine.hh	2009-07-05 16:08:50 UTC (rev 1744)
@@ -117,7 +117,7 @@
         bool is_music_playing() { return false; }
         void clear_cache() {}
         void define_sound (const SoundName &, const SoundData &) {}
-        bool play_sound (const SoundEvent &) {}
+        bool play_sound (const SoundEvent &) { return false;}
         void cache_sound(const SoundEffect &s) {}
         void set_listenerpos (ecl::V2 pos) {}
         void tick(double /*dtime*/) {}

Modified: trunk/src/gui/LevelPackMenu.cc
===================================================================
--- trunk/src/gui/LevelPackMenu.cc	2009-07-05 09:48:13 UTC (rev 1743)
+++ trunk/src/gui/LevelPackMenu.cc	2009-07-05 16:08:50 UTC (rev 1744)
@@ -308,7 +308,7 @@
         }
     }
     
-    bool LevelPackMenu::manageLevelMenu() {
+    void LevelPackMenu::manageLevelMenu() {
         bool finished = false;
         while (!finished) {
             {        

Modified: trunk/src/gui/LevelPackMenu.hh
===================================================================
--- trunk/src/gui/LevelPackMenu.hh	2009-07-05 09:48:13 UTC (rev 1743)
+++ trunk/src/gui/LevelPackMenu.hh	2009-07-05 16:08:50 UTC (rev 1744)
@@ -46,7 +46,7 @@
     class LevelPackMenu : public Menu {
     public:
         LevelPackMenu();
-        bool manageLevelMenu();
+        void manageLevelMenu();
         virtual bool manage();
 
         bool on_event (const SDL_Event &e);

Modified: trunk/src/items/SimpleItems.cc
===================================================================
--- trunk/src/items/SimpleItems.cc	2009-07-05 09:48:13 UTC (rev 1743)
+++ trunk/src/items/SimpleItems.cc	2009-07-05 16:08:50 UTC (rev 1744)
@@ -256,6 +256,7 @@
             }
             return ITEM_KILL;
         }
+        return ITEM_KEEP;
     }
     
     DEF_ITEMTRAITS(Pencil, "it_pencil", it_pencil);

Modified: trunk/src/lev/RatingManager.cc
===================================================================
--- trunk/src/lev/RatingManager.cc	2009-07-05 09:48:13 UTC (rev 1743)
+++ trunk/src/lev/RatingManager.cc	2009-07-05 16:08:50 UTC (rev 1744)
@@ -529,7 +529,7 @@
             default:
                 ecl::Assert <XFrontend> (false, "RatingManager::getBestScore illegal difficulty");
         }
-                
+        return -1;
     }
     
     std::string RatingManager::cutHolders(std::string org, int factor) {
@@ -566,6 +566,7 @@
             default:
                 ecl::Assert <XFrontend> (false, "RatingManager::getBestScoreHolder illegal difficulty");
         }
+        return "";
     }
 
     short RatingManager::getBestScoreEasy(Proxy *levelProxy) {
@@ -612,7 +613,7 @@
             default:
                 ecl::Assert <XFrontend> (false, "RatingManager::getParScore illegal difficulty");
         }
-                
+        return -1;
     }
     
     short RatingManager::getParScoreEasy(Proxy *levelProxy) {



From ral at mail.berlios.de  Sun Jul  5 18:16:07 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 5 Jul 2009 18:16:07 +0200
Subject: [Enigma-game-svn] r1745 - in branches/1.01: . doc intl
	lib-src/enigma-core src src/gui src/lev
Message-ID: <200907051616.n65GG7Ae019965@sheep.berlios.de>

Author: ral
Date: 2009-07-05 18:15:51 +0200 (Sun, 05 Jul 2009)
New Revision: 1745

Modified:
   branches/1.01/configure.ac
   branches/1.01/doc/REQUIREMENTS
   branches/1.01/intl/localename.c
   branches/1.01/lib-src/enigma-core/ecl_sys_localename.cc
   branches/1.01/src/PropertyManager.cc
   branches/1.01/src/StateManager.cc
   branches/1.01/src/gui/LevelPackComposer.cc
   branches/1.01/src/gui/LevelPackMenu.cc
   branches/1.01/src/gui/LevelPackMenu.hh
   branches/1.01/src/items.cc
   branches/1.01/src/lev/Index.cc
   branches/1.01/src/lev/RatingManager.cc
   branches/1.01/src/lev/ScoreManager.cc
   branches/1.01/src/lua.cc
   branches/1.01/src/main.cc
   branches/1.01/src/sound_internal.hh
   branches/1.01/src/stones_complex.cc
Log:
Branch 1.01:  merge of fixes from trunk
- r825: SDL 1.2.12 support, localename fixes
- r832: Xerces 3.0 syntax incompatibility introduced in r564202
- r1395: GCC 4.4 compatibility
- r1731: GCC 4.4 warning
- r1740: Xerces 3.0 syntax incompatibility introduced in r671894
- r1744: missing return statements


Modified: branches/1.01/configure.ac
===================================================================
--- branches/1.01/configure.ac	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/configure.ac	2009-07-05 16:15:51 UTC (rev 1745)
@@ -123,7 +123,7 @@
 AC_CHECK_LIB(SDL_mixer, Mix_QuickLoad_RAW, have_mix_quickload="yes", have_mix_quickload="no")
 
 if test "$have_mix_quickload" = no; then
-   AC_MSG_ERROR([SDL_mixer >= 1.2.5 is required to compile Enigma])
+  AC_MSG_ERROR([SDL_mixer >= 1.2.5 is required to compile Enigma])
 fi
 
 dnl ----------------------------------------
@@ -167,22 +167,22 @@
 dnl Check for xerces
 dnl ----------------------------------------
 if test "$MINGW32" = yes; then
-  AC_MSG_CHECKING([for Xerces 3.0 experimental version])
+  AC_MSG_CHECKING([for Xerces release 3.0])
   AC_EGREP_HEADER([gXercesMajVersion = 3],[xercesc/util/XercesVersion.hpp],
       [AC_MSG_RESULT([found])],
       [AC_MSG_ERROR([not found])])      
-   AC_CHECK_LIB(xerces, main,,[AC_MSG_ERROR([xerces is required to compile Enigma])])
+   AC_CHECK_LIB(xerces-c, main,,[AC_MSG_ERROR([xerces is required to compile Enigma])])
 else
-  AC_MSG_CHECKING([for Xerces 3.0 experimental version])
+  AC_MSG_CHECKING([for current Xerces release 3.0])
   AC_EGREP_HEADER([gXercesMajVersion = 3],[xercesc/util/XercesVersion.hpp],
       xerces3exp="yes",
       xerces3exp="no")      
   if test "x$xerces3exp" = xyes; then
     AC_MSG_RESULT([found])
-    AC_CHECK_LIB(xerces, main,,[AC_MSG_ERROR([xerces is required to compile Enigma])])
+    AC_CHECK_LIB(xerces-c, main,,[AC_MSG_ERROR([xerces is required to compile Enigma])])
   else
     AC_MSG_RESULT([not found])
-    AC_MSG_CHECKING([for Xerces >=2.4 released version])
+    AC_MSG_CHECKING([for old Xerces release >=2.4])
     AC_RUN_IFELSE([AC_LANG_PROGRAM([[#include <xercesc/util/XercesVersion.hpp>]],
           [[if (XERCES_VERSION_MAJOR < 2)
               return 1;

Modified: branches/1.01/doc/REQUIREMENTS
===================================================================
--- branches/1.01/doc/REQUIREMENTS	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/doc/REQUIREMENTS	2009-07-05 16:15:51 UTC (rev 1745)
@@ -15,32 +15,31 @@
 
 Libraries:
 ----------
-SDL-devel       1.2.9, 1.2.11      (no 1.2.10 on Mac!) 
+SDL-devel       1.2.12 -  1.2.9, 1.2.11      (no 1.2.10 on Mac!) 
                 http://www.libsdl.org/download-1.2.php
                 SDL-devel-1.2.9-mingw32.tar.gz (Mingw32)
                 
-SDL_ttf-devel   2.0.7
+SDL_ttf-devel   2.0.9 -  2.0.7
                 http://www.libsdl.org/projects/SDL_ttf/
                 SDL_ttf-devel-2.0.7-VC6.zip (W)
                 
-SDL_mixer-devel 1.2.6
+SDL_mixer-devel 1.2.8 - 1.2.7
                 http://www.libsdl.org/projects/SDL_mixer/
                 SDL_mixer-devel-1.2.6-VC6.zip
                 
-SDL_image-devel 1.2.4
+SDL_image-devel 1.2.6
                 http://www.libsdl.org/projects/SDL_image/
                 SDL_image-devel-1.2.4-VC6.zip (W)
 
-Xerces-C        3.0 r454356     2.4 - 2.7 (L)   < 2.3 (L); 3.0 < r454356
+Xerces-C        3.0.1     2.4 - 3.0.1 (L)   < 2.3 (L); 3.0 < r671894
 Apache          2.7 : http://xml.apache.org/xerces-c/download.cgi
                       Linux: use rpm spec 
                 3.0 : https://svn.apache.org/repos/asf/xerces/c/trunk
                       Linux: ./configure --prefix=/mysweethome; make; install)
                       Windows: see doc/README.mingw
 
-libpng          1.2.7                           
-/GnuWin32       http://gnuwin32.sourceforge.net/packages/libpng.htm
-                Developer files (W)
+libpng          1.2.18  - must be compatible to dynamic SDL_imager libs                         
+	        http://sourceforge.net/project/showfiles.php?group_id=5624                Developer files (W)
                 (The 1.2.8 dll is incompatible to SDL_image 1.2.4)
                 
 zlib            1.2.3
@@ -52,7 +51,9 @@
 
 gcc             3.4.2 (W)   - 4.0 (L)                    
 GNU/mingw       http://www.mingw.org/download.shtml
-                MinGW-4.1.0.exe + MinSYS-1.0.10.exe + msysDTK-1.0.1
+                MinGW-5.1.3.exe + MinSYS-1.0.10.exe + msysDTK-1.0.1 with
+		w32api 3.9 + binutils 2.16.91-20060119-1 +
+		gcc-core 3.4.2-20040916-1 + gcc-g++ 3.4.2-20040916-1	
                 (crosscompiler see doc/README.mingw and etc/build-cross.sh)
 
 autoconf        2.59                            <= 2.56
@@ -60,7 +61,7 @@
                 msys-autoconf-2.59.tar.bz2
 
 
-texi2html       1.76                            < 1.70 ?
+texi2html       1.78, 1.76                            < 1.70 ?
                 http://www.nongnu.org/texi2html/
 
 gettext         0.14.4
@@ -79,7 +80,7 @@
 AT&T            http://www.graphviz.org/About.php
                 (for source documentation)
 
-upx             1.2.5
+upx             3.00 -  1.2.5
                 http://upx.sourceforge.net/
 
 ccache          2.4 (L)

Modified: branches/1.01/intl/localename.c
===================================================================
--- branches/1.01/intl/localename.c	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/intl/localename.c	2009-07-05 16:15:51 UTC (rev 1745)
@@ -484,10 +484,10 @@
 # define SUBLANG_AZERI_CYRILLIC 0x02
 # endif
 # ifndef SUBLANG_BENGALI_INDIA
-# define SUBLANG_BENGALI_INDIA 0x00
+# define SUBLANG_BENGALI_INDIA 0x01
 # endif
 # ifndef SUBLANG_BENGALI_BANGLADESH
-# define SUBLANG_BENGALI_BANGLADESH 0x01
+# define SUBLANG_BENGALI_BANGLADESH 0x02
 # endif
 # ifndef SUBLANG_CHINESE_MACAU
 # define SUBLANG_CHINESE_MACAU 0x05
@@ -580,16 +580,16 @@
 # define SUBLANG_NEPALI_INDIA 0x02
 # endif
 # ifndef SUBLANG_PUNJABI_INDIA
-# define SUBLANG_PUNJABI_INDIA 0x00
+# define SUBLANG_PUNJABI_INDIA 0x01
 # endif
 # ifndef SUBLANG_PUNJABI_PAKISTAN
-# define SUBLANG_PUNJABI_PAKISTAN 0x01
+# define SUBLANG_PUNJABI_PAKISTAN 0x02
 # endif
 # ifndef SUBLANG_ROMANIAN_ROMANIA
-# define SUBLANG_ROMANIAN_ROMANIA 0x00
+# define SUBLANG_ROMANIAN_ROMANIA 0x01
 # endif
 # ifndef SUBLANG_ROMANIAN_MOLDOVA
-# define SUBLANG_ROMANIAN_MOLDOVA 0x01
+# define SUBLANG_ROMANIAN_MOLDOVA 0x02
 # endif
 # ifndef SUBLANG_SERBIAN_LATIN
 # define SUBLANG_SERBIAN_LATIN 0x02
@@ -597,12 +597,12 @@
 # ifndef SUBLANG_SERBIAN_CYRILLIC
 # define SUBLANG_SERBIAN_CYRILLIC 0x03
 # endif
-# ifndef SUBLANG_SINDHI_INDIA
-# define SUBLANG_SINDHI_INDIA 0x00
-# endif
 # ifndef SUBLANG_SINDHI_PAKISTAN
 # define SUBLANG_SINDHI_PAKISTAN 0x01
 # endif
+# ifndef SUBLANG_SINDHI_AFGHANISTAN
+# define SUBLANG_SINDHI_AFGHANISTAN 0x02
+# endif
 # ifndef SUBLANG_SPANISH_GUATEMALA
 # define SUBLANG_SPANISH_GUATEMALA 0x04
 # endif
@@ -660,14 +660,14 @@
 # ifndef SUBLANG_TAMAZIGHT_ARABIC
 # define SUBLANG_TAMAZIGHT_ARABIC 0x01
 # endif
-# ifndef SUBLANG_TAMAZIGHT_LATIN
-# define SUBLANG_TAMAZIGHT_LATIN 0x02
+# ifndef SUBLANG_TAMAZIGHT_ALGERIA_LATIN
+# define SUBLANG_TAMAZIGHT_ALGERIA_LATIN 0x02
 # endif
 # ifndef SUBLANG_TIGRINYA_ETHIOPIA
-# define SUBLANG_TIGRINYA_ETHIOPIA 0x00
+# define SUBLANG_TIGRINYA_ETHIOPIA 0x01
 # endif
 # ifndef SUBLANG_TIGRINYA_ERITREA
-# define SUBLANG_TIGRINYA_ERITREA 0x01
+# define SUBLANG_TIGRINYA_ERITREA 0x02
 # endif
 # ifndef SUBLANG_URDU_PAKISTAN
 # define SUBLANG_URDU_PAKISTAN 0x01
@@ -1038,8 +1038,8 @@
     case LANG_SINDHI:
       switch (sub)
 	{
-	case SUBLANG_SINDHI_INDIA: return "sd_IN";
 	case SUBLANG_SINDHI_PAKISTAN: return "sd_PK";
+	case SUBLANG_SINDHI_AFGHANISTAN: return "sd_AF";
 	}
       return "sd";
     case LANG_SINHALESE: return "si_LK";
@@ -1092,7 +1092,7 @@
 	{
 	/* FIXME: Adjust this when Tamazight locales appear on Unix.  */
 	case SUBLANG_TAMAZIGHT_ARABIC: return "ber_MA at arabic";
-	case SUBLANG_TAMAZIGHT_LATIN: return "ber_MA at latin";
+	case SUBLANG_TAMAZIGHT_ALGERIA_LATIN: return "ber_MA at latin";
 	}
       return "ber_MA";
     case LANG_TAMIL:

Modified: branches/1.01/lib-src/enigma-core/ecl_sys_localename.cc
===================================================================
--- branches/1.01/lib-src/enigma-core/ecl_sys_localename.cc	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/lib-src/enigma-core/ecl_sys_localename.cc	2009-07-05 16:15:51 UTC (rev 1745)
@@ -490,10 +490,10 @@
 # define SUBLANG_AZERI_CYRILLIC 0x02
 # endif
 # ifndef SUBLANG_BENGALI_INDIA
-# define SUBLANG_BENGALI_INDIA 0x00
+# define SUBLANG_BENGALI_INDIA 0x01
 # endif
 # ifndef SUBLANG_BENGALI_BANGLADESH
-# define SUBLANG_BENGALI_BANGLADESH 0x01
+# define SUBLANG_BENGALI_BANGLADESH 0x02
 # endif
 # ifndef SUBLANG_CHINESE_MACAU
 # define SUBLANG_CHINESE_MACAU 0x05
@@ -586,16 +586,16 @@
 # define SUBLANG_NEPALI_INDIA 0x02
 # endif
 # ifndef SUBLANG_PUNJABI_INDIA
-# define SUBLANG_PUNJABI_INDIA 0x00
+# define SUBLANG_PUNJABI_INDIA 0x01
 # endif
 # ifndef SUBLANG_PUNJABI_PAKISTAN
-# define SUBLANG_PUNJABI_PAKISTAN 0x01
+# define SUBLANG_PUNJABI_PAKISTAN 0x02
 # endif
 # ifndef SUBLANG_ROMANIAN_ROMANIA
-# define SUBLANG_ROMANIAN_ROMANIA 0x00
+# define SUBLANG_ROMANIAN_ROMANIA 0x01
 # endif
 # ifndef SUBLANG_ROMANIAN_MOLDOVA
-# define SUBLANG_ROMANIAN_MOLDOVA 0x01
+# define SUBLANG_ROMANIAN_MOLDOVA 0x02
 # endif
 # ifndef SUBLANG_SERBIAN_LATIN
 # define SUBLANG_SERBIAN_LATIN 0x02
@@ -603,12 +603,12 @@
 # ifndef SUBLANG_SERBIAN_CYRILLIC
 # define SUBLANG_SERBIAN_CYRILLIC 0x03
 # endif
-# ifndef SUBLANG_SINDHI_INDIA
-# define SUBLANG_SINDHI_INDIA 0x00
-# endif
 # ifndef SUBLANG_SINDHI_PAKISTAN
 # define SUBLANG_SINDHI_PAKISTAN 0x01
 # endif
+# ifndef SUBLANG_SINDHI_AFGHANISTAN
+# define SUBLANG_SINDHI_AFGHANISTAN 0x02
+# endif
 # ifndef SUBLANG_SPANISH_GUATEMALA
 # define SUBLANG_SPANISH_GUATEMALA 0x04
 # endif
@@ -666,14 +666,14 @@
 # ifndef SUBLANG_TAMAZIGHT_ARABIC
 # define SUBLANG_TAMAZIGHT_ARABIC 0x01
 # endif
-# ifndef SUBLANG_TAMAZIGHT_LATIN
-# define SUBLANG_TAMAZIGHT_LATIN 0x02
+# ifndef SUBLANG_TAMAZIGHT_ALGERIA_LATIN
+# define SUBLANG_TAMAZIGHT_ALGERIA_LATIN 0x02
 # endif
 # ifndef SUBLANG_TIGRINYA_ETHIOPIA
-# define SUBLANG_TIGRINYA_ETHIOPIA 0x00
+# define SUBLANG_TIGRINYA_ETHIOPIA 0x01
 # endif
 # ifndef SUBLANG_TIGRINYA_ERITREA
-# define SUBLANG_TIGRINYA_ERITREA 0x01
+# define SUBLANG_TIGRINYA_ERITREA 0x02
 # endif
 # ifndef SUBLANG_URDU_PAKISTAN
 # define SUBLANG_URDU_PAKISTAN 0x01
@@ -1060,8 +1060,8 @@
     case LANG_SINDHI:
       switch (sub)
 	{
-	case SUBLANG_SINDHI_INDIA: return "sd_IN";
 	case SUBLANG_SINDHI_PAKISTAN: return "sd_PK";
+	case SUBLANG_SINDHI_AFGHANISTAN: return "sd_AF";
 	}
       return "sd";
     case LANG_SINHALESE: return "si_LK";
@@ -1114,7 +1114,7 @@
 	{
 	/* FIXME: Adjust this when Tamazight locales appear on Unix.  */
 	case SUBLANG_TAMAZIGHT_ARABIC: return "ber_MA at arabic";
-	case SUBLANG_TAMAZIGHT_LATIN: return "ber_MA at latin";
+	case SUBLANG_TAMAZIGHT_ALGERIA_LATIN: return "ber_MA at latin";
 	}
       return "ber_MA";
     case LANG_TAMIL:

Modified: branches/1.01/src/PropertyManager.cc
===================================================================
--- branches/1.01/src/PropertyManager.cc	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/PropertyManager.cc	2009-07-05 16:15:51 UTC (rev 1745)
@@ -28,6 +28,7 @@
 #include "XMLtoLocal.hh"
 #include "XMLtoUtf8.hh"
 #include "ecl_system.hh"
+#include <cstdio>
 #include <iostream>
 #include <xercesc/dom/DOM.hpp>
 #include <xercesc/util/XMLDouble.hpp>

Modified: branches/1.01/src/StateManager.cc
===================================================================
--- branches/1.01/src/StateManager.cc	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/StateManager.cc	2009-07-05 16:15:51 UTC (rev 1745)
@@ -31,6 +31,7 @@
 #include "XMLtoUtf8.hh"
 #include "ecl_system.hh"
 #include "gui/ErrorMenu.hh"
+#include <cstdio>
 #include <iostream>
 #include <sstream>
 #include <xercesc/dom/DOM.hpp>

Modified: branches/1.01/src/gui/LevelPackComposer.cc
===================================================================
--- branches/1.01/src/gui/LevelPackComposer.cc	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/gui/LevelPackComposer.cc	2009-07-05 16:15:51 UTC (rev 1745)
@@ -29,6 +29,8 @@
 
 #include "main.hh"
 
+#include <cstdio>
+
 using namespace ecl;
 using namespace std;
 

Modified: branches/1.01/src/gui/LevelPackMenu.cc
===================================================================
--- branches/1.01/src/gui/LevelPackMenu.cc	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/gui/LevelPackMenu.cc	2009-07-05 16:15:51 UTC (rev 1745)
@@ -299,7 +299,7 @@
         }
     }
     
-    bool LevelPackMenu::manageLevelMenu() {
+    void LevelPackMenu::manageLevelMenu() {
         bool finished = false;
         while (!finished) {
             {        

Modified: branches/1.01/src/gui/LevelPackMenu.hh
===================================================================
--- branches/1.01/src/gui/LevelPackMenu.hh	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/gui/LevelPackMenu.hh	2009-07-05 16:15:51 UTC (rev 1745)
@@ -46,7 +46,7 @@
     class LevelPackMenu : public Menu {
     public:
         LevelPackMenu();
-        bool manageLevelMenu();
+        void manageLevelMenu();
         virtual bool manage();
 
         bool on_event (const SDL_Event &e);

Modified: branches/1.01/src/items.cc
===================================================================
--- branches/1.01/src/items.cc	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/items.cc	2009-07-05 16:15:51 UTC (rev 1745)
@@ -1423,7 +1423,7 @@
         void animcb() {
             GridPos p= get_pos();
             if ((server::GameCompatibility == GAMET_OXYDMAGNUM || server::GameCompatibility == GAMET_OXYD1) &&
-                (get_stone_name() == "st-wood-growing" && GetStone(p))) {
+                (!strcmp(get_stone_name(),"st-wood-growing") && GetStone(p))) {
                 string model = GetStone(p)->get_kind();
                 if (model == "st-grate1") {
                     SetFloor(p, MakeFloor("fl-stwood"));
@@ -3313,6 +3313,7 @@
                 }
                 return ITEM_KILL;
             }
+            return ITEM_KEEP;
         }
 
     public:

Modified: branches/1.01/src/lev/Index.cc
===================================================================
--- branches/1.01/src/lev/Index.cc	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/lev/Index.cc	2009-07-05 16:15:51 UTC (rev 1745)
@@ -27,6 +27,7 @@
 #include "lev/ScoreManager.hh"
 #include "lev/RatingManager.hh"
 
+#include <cstdio>
 
 namespace enigma { namespace lev {
 

Modified: branches/1.01/src/lev/RatingManager.cc
===================================================================
--- branches/1.01/src/lev/RatingManager.cc	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/lev/RatingManager.cc	2009-07-05 16:15:51 UTC (rev 1745)
@@ -529,7 +529,7 @@
             default:
                 ecl::Assert <XFrontend> (false, "RatingManager::getBestScore illegal difficulty");
         }
-                
+        return -1;
     }
     
     std::string RatingManager::cutHolders(std::string org, int factor) {
@@ -566,6 +566,7 @@
             default:
                 ecl::Assert <XFrontend> (false, "RatingManager::getBestScoreHolder illegal difficulty");
         }
+        return "";
     }
 
     short RatingManager::getBestScoreEasy(Proxy *levelProxy) {
@@ -612,7 +613,7 @@
             default:
                 ecl::Assert <XFrontend> (false, "RatingManager::getParScore illegal difficulty");
         }
-                
+        return -1;
     }
     
     short RatingManager::getParScoreEasy(Proxy *levelProxy) {

Modified: branches/1.01/src/lev/ScoreManager.cc
===================================================================
--- branches/1.01/src/lev/ScoreManager.cc	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/lev/ScoreManager.cc	2009-07-05 16:15:51 UTC (rev 1745)
@@ -61,18 +61,24 @@
 namespace {
 #if _XERCES_VERSION >= 30000
     class ScoreDomSerFilter : public DOMLSSerializerFilter {
+        public:
+            virtual DOMNodeFilter::FilterAction acceptNode(const DOMNode *node) const;
 #else
     class ScoreDomSerFilter : public DOMWriterFilter {
-#endif
         public:
             virtual short acceptNode(const DOMNode *node) const;
+#endif
             virtual unsigned long getWhatToShow () const {
                 return DOMNodeFilter::SHOW_ALL;
             }
             virtual void setWhatToShow (unsigned long toShow) {}
     };
     
+#if _XERCES_VERSION >= 30000
+    DOMNodeFilter::FilterAction ScoreDomSerFilter::acceptNode(const DOMNode *node) const {
+#else
     short ScoreDomSerFilter::acceptNode(const DOMNode *node) const {
+#endif
         if (node->getNodeType () == DOMNode::ELEMENT_NODE &&
                  std::string(XMLtoUtf8(node->getNodeName()).c_str()) == "level") {
             const DOMElement *e = dynamic_cast<const DOMElement *>(node);

Modified: branches/1.01/src/lua.cc
===================================================================
--- branches/1.01/src/lua.cc	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/lua.cc	2009-07-05 16:15:51 UTC (rev 1745)
@@ -574,7 +574,7 @@
     int         y       = round_down<int>(lua_tonumber(L, 2));
     const char *dir     = lua_tostring(L,3);
     const char *allowed = "wsen";
-    char       *found   = strchr(allowed, dir[0]);
+    const char *found   = strchr(allowed, dir[0]);
 
     if (found && found[0]) 
         world::AddScramble(GridPos(x,y), enigma::Direction(found-allowed));

Modified: branches/1.01/src/main.cc
===================================================================
--- branches/1.01/src/main.cc	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/main.cc	2009-07-05 16:15:51 UTC (rev 1745)
@@ -300,6 +300,9 @@
     }
 
     // ----- Initialize SDL library
+#ifdef WIN32
+    SDL_putenv("SDL_VIDEODRIVER=directx");  //needed for SDL 1.2.12 that favors GDI which crashes on SetGamma
+#endif
     int sdl_flags = SDL_INIT_VIDEO;
     if (enigma::WizardMode)
         sdl_flags |= SDL_INIT_NOPARACHUTE;

Modified: branches/1.01/src/sound_internal.hh
===================================================================
--- branches/1.01/src/sound_internal.hh	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/sound_internal.hh	2009-07-05 16:15:51 UTC (rev 1745)
@@ -181,7 +181,7 @@
         bool play_music (const std::string &/*filename*/) { return false; }
         void stop_music() {}
         void fadeout_music() {}
-        bool play_sound (const SoundEvent &) {}
+        bool play_sound (const SoundEvent &) { return false;}
         void define_sound (const SoundName &, const std::string &/*filename*/) {}
         void define_sound (const SoundName &, const SoundData &) {}
         void set_listenerpos (ecl::V2 pos) {}

Modified: branches/1.01/src/stones_complex.cc
===================================================================
--- branches/1.01/src/stones_complex.cc	2009-07-05 16:08:50 UTC (rev 1744)
+++ branches/1.01/src/stones_complex.cc	2009-07-05 16:15:51 UTC (rev 1745)
@@ -3104,6 +3104,7 @@
                 return Value();
             }
         }
+        return Value();
     }
 
     void ChessStone::alarm() {



From ral at mail.berlios.de  Mon Jul  6 21:28:53 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Mon, 6 Jul 2009 21:28:53 +0200
Subject: [Enigma-game-svn] r1746 - in trunk: data doc/reference
Message-ID: <200907061928.n66JSrTH015371@sheep.berlios.de>

Author: ral
Date: 2009-07-06 21:28:42 +0200 (Mon, 06 Jul 2009)
New Revision: 1746

Modified:
   trunk/data/api2init.lua
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk 1.1: 
- refman typo fixes
- renaming of constant (IN)DISPENSIBLE to (IN)DISPENSABLE


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2009-07-05 16:15:51 UTC (rev 1745)
+++ trunk/data/api2init.lua	2009-07-06 19:28:42 UTC (rev 1746)
@@ -166,8 +166,10 @@
            [NORTHWEST]=NW, [SOUTHWEST]=SW, [SOUTHEAST]=SE, [NORTHEAST]=NE}
 
 -- essential
-DISPENSIBLE   = 0
-INDISPENSIBLE = 1
+DISPENSIBLE   = 0   -- typo to be deleted when all levels are updated
+INDISPENSIBLE = 1   -- typo to be deleted when all levels are updated
+DISPENSABLE   = 0
+INDISPENSABLE = 1
 PERKIND       = 2
 
 -- meditation

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-07-05 16:15:51 UTC (rev 1745)
+++ trunk/doc/reference/enigma-ref.texi	2009-07-06 19:28:42 UTC (rev 1746)
@@ -46,7 +46,7 @@
 * Advanced Features::           Resolvers, Scrolling, Flood, Fire, etc.
 * Extension Development::       Resolver, Library Development
 * Guidelines and Hints::        Tips and Recommendations for Levels to be included in Enigma
-* Compatibility::               Enigine Mode and Version Compatibility
+* Compatibility::               Engine Mode and Version Compatibility
 * Object Index::
 * Attribute Index::
 * Message Index::
@@ -478,7 +478,7 @@
 Different floors can have different fraction and mouseforce, space,
 ice, inverted floor, some stones sink while others swim, black grates
 that hold rotors and tops away, dynamite, dynamite-breakable stones,
-spade, bolders, magic-wand to change bolder-direction, bolders sink
+spade, boulders, magic-wand to change boulder-direction, boulders sink
 into an abyss, sheets of glass, spoon, actors and items may hide under
 movable stones, small not-killer whiteballs, coloured one-way-streets,
 actorimpulse-stones (``bumpers''), rotors can fly over an abyss,
@@ -1002,7 +1002,7 @@
 which you should store on your @samp{user path}.
 
 If you maintained several of your own levelpacks, Enigma 0.92 allowed you to keep them
-in several subdirectories of the @samp{levels} directory.However, since it also allowed you to
+in several subdirectories of the @samp{levels} directory. However, since it also allowed you to
 keep all level files and different indices in the @samp{levels} directory
 itself, you will run into trouble with the auto conversion, because Enigma 1.00 allows only one
 levelpack with attached level files per directory.
@@ -1137,7 +1137,7 @@
 string for identification purposes.
 
 Finally, when you have completed the configuration, you can create the levelpack by
-clickling @samp{OK}. Enigma will create the levelpack on your @samp{userpath}
+clicking @samp{OK}. Enigma will create the levelpack on your @samp{userpath}
 (@pxref{Locating Resources}).
 
 If you decide not to create a new levelpack, just click @samp{Undo}. Enigma will not create or
@@ -1403,7 +1403,7 @@
 First we declare some keys for objects we like to use in our level map. We
 just add each key to our @i{ti} tiles repository and assign an object tile
 description that consists of the object kind name in these simple cases. The
-two character prefix of the kind name shows us the basic object typ like floor,
+two character prefix of the kind name shows us the basic object type like floor,
 item, stone, actor, etc.
 
 @example
@@ -1477,7 +1477,7 @@
 <@i{el}:@b{level} xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="@i{http://enigma-game.org/schema/level/1 level.xsd http://enigma-game.org/schema/editor editor.xsd}" xmlns:@i{el}="@i{http://enigma-game.org/schema/level/1}" xmlns:@i{ee}="@i{http://enigma-game.org/schema/editor}">
   <@i{el}:@b{protected}>
     <@i{el}:@b{info} @i{el}:@b{type}="@var{level}">
-      <!-- required elements omited -->
+      <!-- required elements omitted -->
     </@i{el}:@b{info}>
     <@i{el}:@b{elements}/>
     <@i{el}:@b{luamain}><![CDATA[
@@ -1536,7 +1536,7 @@
 @b{Elements:}
 
 @table @asis
- at item @b{/level}, @i{required, single occurence}
+ at item @b{/level}, @i{required, single occurrence}
 This is the root node. Only one instance of this node occurs per file. Like the first XML
 declaration line, this second line is quite fixed. There are two versions. The simple 3-attribute
 version, as used in the first example, and only level editor programs use the 4-attribute version
@@ -2983,7 +2983,7 @@
 characters are only allowed as far as they are explained in the following text.
 
 @cindex auto naming
-It is up to you to ensure unique names. Reusage of an already assigned name
+It is up to you to ensure unique names. Reuse of an already assigned name
 will unname the prior object and assign the name to the new object. To simplify
 the naming of larger groups of similar objects you can add the hash sign
 @samp{#} as the last character to a name, e.g. @samp{mydoor#}. This causes Enigma
@@ -3335,13 +3335,13 @@
 will be sent.
 
 Usually actions are performed at once. That is very important as the sequence
-of actions if often essential. Condider an @ref{st_box} being pushed from one
+of actions if often essential. Consider an @ref{st_box} being pushed from one
 @ref{it_trigger} to a neighboring one, or just an @ref{ac_marble} moving from
 the first trigger to the neighboring one. In both cases it is important that
 the first trigger is released prior the second one to be pressed. If this
 sequence gets mixed up both triggers could be pressed by a single object for
 a moment what could cause major shortcuts in a level. Thus all actions are
-preformed in the logical sequence and in a stable, repeatable sequence without
+performed in the logical sequence and in a stable, repeatable sequence without
 any random.
 
 Action may be simple or sometimes be very complex world rearrangements. But in
@@ -3351,7 +3351,7 @@
 an @ref{st_switch} which in turn kills the first trigger is as critical as the
 trigger killing itself. We do generally discourage you to kill any object
 within its own action, as there is no dissolving animation and the WYSIWYG
-user paradigma is violated, too. But if there is urgent need for reasons of the
+user paradigm is violated, too. But if there is urgent need for reasons of the
 level gaming logic you can perform the action in a secure, delayed mode. Just
 add the attribute @ref{safeaction} with value @samp{true} to the self killing
 sender object. The action will no longer be performed at once, but with a
@@ -3577,25 +3577,25 @@
 @node Level Initialization
 @subsection Level Initialization
 
-Knowing what has been preloaded and knowing exaktly which objects we have to
+Knowing what has been preloaded and knowing exactly which objects we have to
 set in which state, it is time to have a look on how your level code is 
 processed. The main issue is to guarantee that all parts referenced have been
 set up properly in advance.
 
 Prior execution of the first line of your code the world exists just as an
 abstract handle, but not as grid array able to accept objects. Thus the first
-lines of code should set up all @ref{Global Attributes} derivating from their
+lines of code should set up all @ref{Global Attributes} deviating from their
 defaults. Even though many attributes can be set or changes later on and even
 on runtime, there are some attributes like @ref{ProvideExtralifes} that take
 only effect if being set prior world creation, or others like @ref{MaxOxydColor}
 that must be set prior their first usage. Our recommendation is to collect all
-global attribut settings at the very beginning of the level.
+global attribute settings at the very beginning of the level.
 
 The second section of your level code should be the declaration of tiles. Being
 just declarations these code lines do not set objects to the world. They just
 depend on global attributes and may reference each other. Listing them all
 together in a code section makes it easy to maintain the overview and to avoid
-dependecy conflicts.
+dependency conflicts.
 
 If you use @ref{Resolvers} you should put their declarations in the next code
 section as they may refer to tiles and global attributes and need to be set up
@@ -3608,7 +3608,7 @@
 
 Thus subsequent code lines should @ref{add} other objects, draw additional
 maps of objects and finalize some objects. The most common statement for such
-a finialization is the @ref{shuffleOxyd} method. It needs to know all 
+a finalization is the @ref{shuffleOxyd} method. It needs to know all 
 @ref{st_oxyd} to be able to color and shuffle them. Another finalization may
 be a custom rendering of a maze, that extracts the maze shape out of the
 level map (@pxref{res.maze}).
@@ -4535,7 +4535,7 @@
 @var{sorted_group} = @var{group}:@b{sort}()
 @end example
 Sort group objects in linear order according to given direction vector, or
-direction determined by the first two objects. Or order objects cicular around
+direction determined by the first two objects. Or order objects circular around
 their center. If no argument is given order objects lexically.
 
 @item @b{Subset Group:}
@@ -4690,7 +4690,7 @@
 02    @i{wo}["@b{FollowGrid}"] = @var{false}
 03    @i{wo}["@b{FollowMethod}"] = @var{FOLLOW_SCROLL}
 04
-05    @i{ti}["@var{ }"] = @{"@b{fl_fale_abyss}"@} .. @i{ti}(@{"@b{st_lightglass}"@})
+05    @i{ti}["@var{ }"] = @{"@b{fl_fake_abyss}"@} .. @i{ti}(@{"@b{st_lightglass}"@})
 06
 07    @i{ti}["@var{!}"] = @{"@b{fl_blueslab}", "@var{blue#}", @var{_color}="@var{blue}"@}
 08    @i{ti}["@var{@@}"] = @{"@b{fl_pinkbumps}", "@var{orange#}", @var{_color}="@var{orange}"@}
@@ -4785,7 +4785,7 @@
 setting special @ref{Global Attributes}.
 
 @example
-05    @i{ti}["@var{ }"] = @{"@b{fl-abyss_fake}"@} .. @i{ti}(@{"@b{st-glass1}"@})
+05    @i{ti}["@var{ }"] = @{"@b{fl_fake_abyss}"@} .. @i{ti}(@{"@b{st_lightglass}"@})
 32    @i{wo}(@i{ti}, "@var{ }", @{
 @end example
 The inaccessible areas are filled with a transparent glass on top of a black
@@ -5241,7 +5241,7 @@
 result = @var{pos} + <@var{pos} | @var{obj} | @var{cpos} | @var{polist}>
 @end example
 
-allows you to write any of the follwing lines in your level
+allows you to write any of the following lines in your level
 
 @example
 @var{result} = @var{pos} + @var{pos}
@@ -5256,7 +5256,7 @@
 x = pos["x"]
 @end example
 
-requires the Lua square bracktes to be coded literally. Of course you are
+requires the Lua square brackets to be coded literally. Of course you are
 still free to name your position variable and the resulting value variable
 whatever you like.
 
@@ -5286,7 +5286,7 @@
 table will afterwards both reference the same modified table.
 
 We will denote for every new data type the character of being a value or a
-reference. If you are unfamilar to the resulting effects you may want to read
+reference. If you are unfamiliar to the resulting effects you may want to read
 the appendix about @ref{Caveats}.
 
 @c ----------------- Polymorphism and Overloading --------------------
@@ -5299,7 +5299,7 @@
 a @ref{Position}. This is due to the fact that objects support most of the
 position features as well. Objects are no positions, but they do speak the
 same language. This feature is called @samp{polymorphism} and helps you to
-simplify your code significantly. In the follwing subchapters you should
+simplify your code significantly. In the following subchapters you should
 carefully look at the syntax to understand which types of arguments do fit in
 seamlessly.
 
@@ -5307,10 +5307,10 @@
 The number of usable operators is limited by Lua. Thus an addition of two data
 by the @samp{+} operator causes different actions depending on the involved data
 themselves. An addition of two positions results in an vectorial addition. But
-the addition of two groups results in a join of the groups. This reusage of a
+the addition of two groups results in a join of the groups. This reuse of a
 single operator is called @samp{overloading}.
 
-Overloading combined with polymorphism can cause situations that are ambiguos
+Overloading combined with polymorphism can cause situations that are ambiguous
 by design. E.g. we decided to allow the addition of a position with an object
 resulting in the vectorial addition of the objects position to the first one.
 At the same time we want to be able to join an object with an existing group
@@ -5331,7 +5331,7 @@
 Even though we introduce just the ten additional fundamental datatypes as
 described in the following subchapters, the API does additionally differ
 the same datatype according to its usage. E.g. a standard Lua number is used to
-describe the @ref{state} of an object. Just in rare occurences the state will 
+describe the @ref{state} of an object. Just in rare occurrences the state will 
 reflect a real number like the state of @ref{ot_counter}. For most objects
 the state will just be one of a given set of allowed values, which happen to
 be described by numbers by the API. Thus we speak of a pseudo datatype
@@ -5358,7 +5358,7 @@
 being normalized to the length of 1.
 
 A given @samp{orientation} can be transformed into a @samp{direction} value by
-the convertion table @ref{ORI2DIR}.
+the conversion table @ref{ORI2DIR}.
 
 @c ----------------- Position --------------------
 
@@ -5415,7 +5415,7 @@
 
 @item @b{Details:}
 When a position is added to or subtracted from another position or data 
-convertable to a position the result is the position value representing the 
+convertible to a position the result is the position value representing the 
 vectorial addition or difference of both arguments.
 
 If a position is added to subtracted from a position list a new list is created
@@ -5606,7 +5606,7 @@
 
 Note that the @ref{Object}s @samp{exists} method reports the existence of the
 object. Evaluation of @samp{po(obj):exists()} may result in @samp{false} for
-exisiting objects. E.g. this result occurs for @ref{Item Objects} currently 
+existing objects. E.g. this result occurs for @ref{Item Objects} currently 
 being part of a player's inventory. The item exists, but is not part of the 
 world. But items contained in a bag placed in the world will report the same 
 position as the bag.
@@ -5623,7 +5623,7 @@
 @node Object
 @section Object
 
-This datatype handels all world participating objects as described in
+This datatype handles all world participating objects as described in
 @ref{Object Layers}. When you request an object you get a reference to this
 object and not the object itself. You can modify the object, but the object
 can be modified by user actions, too. Deleting your reference by assigning
@@ -5635,7 +5635,7 @@
 reference, which we call a @samp{NULL} reference, is no longer fatal with the
 new API. Any write accesses on such references are simply ignored. Thus you can
 send messages to object references independently of their validity. Just on
-read accesses you may want to prior check the existance of an object as you
+read accesses you may want to prior check the existence of an object as you
 would get @samp{nil} values on access of @samp{NULL} references.
 
 Objects take attributes that you access by Lua index methods. Additional to
@@ -5654,7 +5654,7 @@
 world are limited to positions within the world. But be aware that portable 
 @ref{Item Objects} can well be part of a player's inventory and thus report a 
 position  outside of the world. Actors will always report positions rounded to 
-the containing grid. This feature is legacy. As Lua code is anyway unapropriate
+the containing grid. This feature is legacy. As Lua code is anyway inappropriate
 to handle actor movements we maintained this rounding feature.
 
 Objects support standard set operators of @ref{Group}s, too, as long as one
@@ -5854,7 +5854,7 @@
 
 @item @b{Details:}
 When an object is added to or subtracted from another position or data 
-convertable to a position the result is the position value representing the 
+convertible to a position the result is the position value representing the 
 vectorial addition or difference of both positions.
 
 If an object is added to subtracted from a position list a new list is created
@@ -5900,7 +5900,7 @@
 result = @i{group} + @i{obj}
 
 @item @b{Details:}
-A new set containg the objects of the group plus the single object is returned.
+A new set containing the objects of the group plus the single object is returned.
 The object sequence is maintained. If the object is already member of the group
 the new group will contain just one object reference, namely the first one in
 sequence.
@@ -5923,7 +5923,7 @@
 result = @i{group} * @i{obj}
 
 @item @b{Details:}
-A new set cointaing just the object iteself, in case it is part of the group, 
+A new set containing just the object itself, in case it is part of the group, 
 too, or an empty group returned.
 
 @item @b{Syntax Samples:}
@@ -5944,7 +5944,7 @@
 result = @i{group} - @i{obj}
 
 @item @b{Details:}
-In the first case a new set containg just the object itself, if it is not part
+In the first case a new set containing just the object itself, if it is not part
 of the group, too, or an empty group returned. In the second case the new group
 contains all members of the old group without the object. The sequence of
 objects remains untouched.
@@ -6195,7 +6195,7 @@
 
 
 @item @b{Details:}
-A new set containg any object of of both arguments just once, is returned. The
+A new set containing any object of of both arguments just once, is returned. The
 object sequence is maintained. If an object is member of both arguments the new
 group will contain just one object reference, namely the first one in sequence.
 
@@ -6217,7 +6217,7 @@
 result = @i{group} * <@i{obj}|@i{group}>
 
 @item @b{Details:}
-A new set cointaing just those objects that a contained in both arguments. The
+A new set containing just those objects that a contained in both arguments. The
 objects are returned in the same sequence as they appear in the first argument.
 
 @item @b{Syntax Samples:}
@@ -6238,7 +6238,7 @@
 result = @i{group} - <@i{obj}|@i{group}>
 
 @item @b{Details:}
-A new set containg just those objects of the first argument, that are not
+A new set containing just those objects of the first argument, that are not
 contained in the second argument is returned. The sequence of the objects
 in the new group is the same as in the first argument.
 
@@ -6285,10 +6285,10 @@
 all invalid @samp{NULL} object reference are removed in the resulting group by
 this method call.
 
-With a string argument @code{"circular"} the objects are aranged arround their
+With a string argument @code{"circular"} the objects are arranged around their
 center by their angle. The distance from this center has no influence.
 
-With a string argument @code{"linear"} the objects are aranged in a linear 
+With a string argument @code{"linear"} the objects are arranged in a linear 
 fashion. You either supply a @ref{Position} as sorting direction vector, or
 the first two objects of the group will define the sorting direction as default.
 
@@ -6327,7 +6327,7 @@
 group. In this case the absolute value determines the number of selected objects
 counted backwards from the last one in sequence.
 
-With two positive numbers as arguements you define the first and the last sequence
+With two positive numbers as arguments you define the first and the last sequence
 index of the requested subset.
 
 With two numbers, but the second one being negative, you define the first object
@@ -6369,12 +6369,12 @@
 @node NamedObjects
 @section NamedObjects
 
-The datatyp NamedObjects is used by just one object, the singleton repository
+The datatype NamedObjects is used by just one object, the singleton repository
 of named objects. Whenever you name an object, @xref{Object Naming}, this
 repository registers its name and allows you to retrieve the object lateron
 by providing its name.
 
-Being a singleton you can not create new NamedObjets. The singleton is stored
+Being a singleton you can not create new NamedObjects. The singleton is stored
 at the global variable @samp{no} on level load.
 
 @menu
@@ -6396,10 +6396,10 @@
 the unique object with the given name, or an invalid @samp{NULL} object if no
 object exists with the given name.
 
-If the requested name contains a wildcard character, either an asterix @samp{*}
+If the requested name contains a wildcard character, either an asterisk @samp{*}
 or a question mark @samp{?}, a @ref{Group} containing all objects with matching
-names is returned. An asterix matches zero, one or several arbitrary characters. 
-A question mark matches a single arbitrary character. Both wildcard charchters
+names is returned. An asterisk matches zero, one or several arbitrary characters. 
+A question mark matches a single arbitrary character. Both wildcard characters
 can be used anywhere in the string and in arbitrary multiplicity. Anyway the
 result is always returned as a @ref{Group}. The group may contain multiple
 objects, just a single object, or even no objects at all when no existing object
@@ -6407,7 +6407,7 @@
 
 @item @b{Syntax Samples:}
 @example
- at var{obj} = @i{no}["@var{mydoor}"]       -- exakte name match
+ at var{obj} = @i{no}["@var{mydoor}"]       -- exact name match
 @var{group} = @i{no}["@var{mydoors#*}"]  -- any suffix
 @var{group} = @i{no}["@var{mydoor?}"]    -- just one char suffix
 @var{group} = @i{no}["@var{mydoors?#*}"] -- matches e.g. "mydoorsA#123435", "mydoorsB#1213"
@@ -6463,7 +6463,7 @@
 convert a given list of unique grid positions to a group of floors without
 loosing any information. Now you can apply all group methods on the floors, like
 shuffling, sorting, subgrouping, etc.. Finally you can convert the resulting
-group back to a persistent position list. Of course the convertions preserve
+group back to a persistent position list. Of course the conversions preserve
 the sequence of members.
 
 Some additional position specific operators are supplied to allow simple
@@ -6580,7 +6580,7 @@
 result = <@i{pos} | @i{obj} | @i{cpos}> <@b{+}|@b{-}> @i{polist}
 
 @item @b{Details:}
-If a position or data convertable to a position is added to or subtracted from 
+If a position or data convertible to a position is added to or subtracted from 
 a position list a new list is created with the positions representing the sum or
 difference of the position with every member of the position list. In total the
 position list is shifted by the position as a vector.
@@ -6620,7 +6620,7 @@
 @node Positions Repository
 @section Positions Repository
 
-The Positions datatyp is just used by a single instance, the singleton 
+The Positions datatype is just used by a single instance, the singleton 
 repository of named positions. Besides the management of named positions it
 provides useful conversions of other datatypes to position based types.
 
@@ -6640,8 +6640,8 @@
 @menu
 * Positions Repository Request::  Index Operator @samp{[]} read
 * Positions Repository Storage::  Index Operator @samp{[]} write
-* Position Convertion::           Function @samp{po()}
-* PositionList Convertion::       Function @samp{po()}
+* Position Conversion::           Function @samp{po()}
+* PositionList Conversion::       Function @samp{po()}
 @end menu
 
 @c ----------------- Positions Repository Request --------------------
@@ -6655,22 +6655,22 @@
 @item @b{Details:}
 Request of one or several positions from the repository. If no wildcard 
 characters are used in the name the @ref{Position} value of the unique object
-with the given name, if existant, is returned. It no object exists with the 
+with the given name, if existent, is returned. It no object exists with the 
 name, the last position stored with the same name is returned. If no position
 exists the value @samp{nil} is returned.
 
-If the requested name contains a wildcard character, either an asterix @samp{*}
+If the requested name contains a wildcard character, either an asterisk @samp{*}
 or a question mark @samp{?}, a @ref{PositionList} containing all positions with
-matching names is returned. An asterix matches zero, one or several arbitrary 
+matching names is returned. An asterisk matches zero, one or several arbitrary 
 characters. A question mark matches a single arbitrary character. Both wildcard
-charchters can be used anywhere in the string and in arbitrary multiplicity.
+characters can be used anywhere in the string and in arbitrary multiplicity.
 Anyway the result is always returned as a @ref{PositionList}. The list may
 contain multiple positions, just a single position, or even no position at all
 when no existing position matches your name pattern.
 
 @item @b{Syntax Samples:}
 @example
- at var{pos} = @i{po}["@var{mydoor}"]        -- exakte name match
+ at var{pos} = @i{po}["@var{mydoor}"]        -- exact name match
 @var{polist} = @i{po}["@var{mydoors#*}"]  -- any suffix
 @var{polist} = @i{po}["@var{mydoor?}"]    -- just one char suffix
 @var{polist} = @i{po}["@var{mydoors?#*}"] -- matches e.g. "mydoorsA#123435", "mydoorsB#1213"
@@ -6696,9 +6696,9 @@
 @end example
 @end table
 
- at c ----------------- Position Convertion --------------------
- at node Position Convertion
- at subsection Position Convertion
+ at c ----------------- Position Conversion --------------------
+ at node Position Conversion
+ at subsection Position Conversion
 
 @table @asis
 @item @b{Syntax:}
@@ -6716,9 +6716,9 @@
 @end example
 @end table
 
- at c ----------------- PositionList Convertion --------------------
- at node PositionList Convertion
- at subsection PositionList Convertion
+ at c ----------------- PositionList Conversion --------------------
+ at node PositionList Conversion
+ at subsection PositionList Conversion
 
 @table @asis
 @item @b{Syntax:}
@@ -6756,11 +6756,11 @@
 second example uses the shortcut of specifying the name attribute value as
 second table entry, that will be stored at table position @samp{2}. It has to
 be a string value. The third variation, that is useful for actor declarations,
-stores the grid offsets in x and y directions in the table postions @samp{2} and
+stores the grid offsets in x and y directions in the table positions @samp{2} and
 @samp{3}. Of course you can not use the name attribute shortcut in the same
 declaration.
 
-These table driven object declarations are always suffcient if you just want to
+These table driven object declarations are always sufficient if you just want to
 set a single object at once. But tiles do often take an item or a stone besides
 a floor. So we need an Enigma data type being able to handle these multiple
 declarations. This is the @samp{tile} data type. It can take just one object
@@ -6795,7 +6795,7 @@
 one of the first two evaluated arguments needs to be a tile as two Lua tables
 do not know how to concat. 
 
-Note that Lua does evaluate the @samp{..} operatorfrom right to left! Thus you
+Note that Lua does evaluate the @samp{..} operator from right to left! Thus you
 need either use proper braces or you need to guarantee that at least one of the
 two rightmost tokens is a tile.
 
@@ -6815,7 +6815,7 @@
 @node Tiles Repository
 @section Tiles Repository
 
-The Tiles datatyp is just used by a single instance, the singleton repository of
+The Tiles datatype is just used by a single instance, the singleton repository of
 @ref{Tile and Object Declaration}s. Besides the management of tiles it provides
 useful conversions of table based object declarations to tiles.
 
@@ -6828,7 +6828,7 @@
 
 You can assign a tile to every key just once. A reassign causes an error. On
 one hand this allow internal implementation optimization, but on the other hand
-an unforerseen key reassignement is the most common level coding error that 
+an unforeseen key reassignment is the most common level coding error that 
 needs to be reported.
 
 For task driven samples @pxref{Tiles and World Tasks}. 
@@ -6836,7 +6836,7 @@
 @menu
 * Tiles Storage::     Store a tile for a key
 * Tiles Request::     Retrieve a tile for a key
-* Tile Convertion::   Convert an object declartion into a tile
+* Tile Conversion::   Convert an object declaration into a tile
 @end menu
 
 @c ----------------- Tiles Storage --------------------
@@ -6877,7 +6877,7 @@
 Request of the tile that has been assigned to the given key. If no tile has yet
 been stored for the key a Lua @samp{nil} value is returned. Note that this
 tiles repository does not use wildcard characters as the named objects and
-postions repositories do. The asterix @samp{*} and question mark @samp{?} are
+positions repositories do. The asterisk @samp{*} and question mark @samp{?} are
 just keys as any other characters.
 
 @item @b{Syntax Samples:}
@@ -6886,10 +6886,10 @@
 @end example
 @end table
 
- at c ----------------- Tile Convertion --------------------
+ at c ----------------- Tile Conversion --------------------
 
- at node Tile Convertion
- at subsection Tile Convertion
+ at node Tile Conversion
+ at subsection Tile Conversion
 
 @table @asis
 @item @b{Syntax:}
@@ -6913,13 +6913,13 @@
 
 The World datatype is just used by a single instance, another singleton object.
 A reference to this singleton is stored at the Lua global variable @samp{wo} on
-level load. Being a singleton you can not instanciate another World object.
+level load. Being a singleton you can not instantiate another World object.
 
 But even though the singleton @samp{wo} already exists on load of a level the
 world is still undefined in all aspects. From the first line of Lua code you
 can access the @ref{Global Attributes}. But the world gets really set up with
 the @ref{World Creation}. After this call the world has a well defined size
-and is filled with an inital set of objects that you can access and modify
+and is filled with an initial set of objects that you can access and modify
 from this moment on.
 
 @menu
@@ -7477,7 +7477,7 @@
 * fl::              Floor retrieval
 * grp::             Create a group out of the argument objects
 * it::              Item retrieval
-* ORI2DIR::         Orientation to direction convertion
+* ORI2DIR::         Orientation to direction conversion
 * random::          Random number generator
 * st::              Stone retrieval
 * usertype::        Type info for Enigma userdata types 
@@ -7803,7 +7803,7 @@
 
 @item @b{Details:}
 Returns a new @ref{Group} that is build up by the objects listed by the 
-arguements. The contents objects must be either listed in a Lua table, given
+arguments. The contents objects must be either listed in a Lua table, given
 as multiple single object arguments or an existing group. In all cases the
 sequence of objects is maintained in the returned new group, but all invalid
 @samp{NULL} objects are omitted. In case one object is listed multiple times
@@ -8545,7 +8545,7 @@
 @item @samp{ON} = @code{1}, all switch like objects
 @item @samp{CLOSED} = @code{0}, all door like objects
 @item @samp{OPEN} = @code{1}, all door like objects
- at item @samp{IDLE} = @code{0}, other objects in the default passiv state
+ at item @samp{IDLE} = @code{0}, other objects in the default passive state
 @item @samp{ACTIVE} = @code{1}, other objects in the active state
 @item @samp{OXYDPAIR} = @code{2}, just by @ref{st_oxyd}
 @item @samp{LIGHT} = @code{0}, by @ref{st_disco}
@@ -8695,8 +8695,8 @@
 is appropriate for an object and do avoid using numbers. 
 
 @itemize @bullet
- at item @samp{DISPENSIBLE} = @code{0}, by all actors and @ref{it_meditation}
- at item @samp{INDISPENSIBLE} = @code{1}, by all actors and @ref{it_meditation}
+ at item @samp{DISPENSABLE} = @code{0}, by all actors and @ref{it_meditation}
+ at item @samp{INDISPENSABLE} = @code{1}, by all actors and @ref{it_meditation}
 @item @samp{PERKIND} = @code{2}, by all actors
 @end itemize
 
@@ -8749,7 +8749,7 @@
 
 Constants for screen scrolling global attributes @ref{FollowMethod} and
 @ref{FollowAction}. Please choose the constants that are appropriate for 
-screen scrolling and do avoid using numbers or poition values. 
+screen scrolling and do avoid using numbers or position values. 
 
 @itemize @bullet
 @item @samp{FOLLOW_NO} = @code{0}, by global @ref{FollowMethod}
@@ -8843,7 +8843,7 @@
 
 A global variable that enables the user to commit suicide with all owned
 actors by pressing @samp{F3}. As this legacy feature can cause unexpected
-shortcuts, you can deny this freedom. A single actor suicide as commited by
+shortcuts, you can deny this freedom. A single actor suicide as committed by
 activation of an @ref{it_spoon} is not affected by this global variable.
 
 @table @asis
@@ -9125,7 +9125,7 @@
 at strategic positions. The main purpose of this flag is the support of easy
 modes for very lethal levels, that should give the user the opportunity to
 exercise difficult patterns. Usage of this flag for the regular difficult mode
-is depreceated.
+is deprecated.
 
 @table @asis
 @item @b{Type:} @ @ bool
@@ -9404,7 +9404,7 @@
 @end iftex
 @end macro
 @c
-WORK IN PROGRESS - The follwing table is still incomplete!
+WORK IN PROGRESS - The following table is still incomplete!
 @multitable @columnfractions .08 .25 .08 .25 .09 .25
 @item @image{images/fl_abyss, 12mm} @tab @yref{fl_abyss}
 @tab @image{images/fl_adhesionless, 12mm} @tab @yref{fl_adhesionless}
@@ -9472,7 +9472,7 @@
 * freeze_check (floor)::    Freeze Checking
 * friction (floor)::        Decelerating friction force factor
 * ignitable::               -
-* indestructible::          System Flag for destruction resistence 
+* indestructible::          System Flag for destruction resistance 
 * initfire::                -
 * noash::                   -
 * push_directions::         Puzzle Shuffle Hint
@@ -9605,11 +9605,11 @@
 @subsection fragility (floor)
 
 A value denoting the probability that a brittle floor plate, that is a floor
-with an @ref{it_crack} on top, continues to desintegrate on events like an actor
+with an @ref{it_crack} on top, continues to disintegrate on events like an actor
 entering, passing a neighboring @ref{it_crack}, nearby explosions or fire 
-heating. A value of @code{1.0} ensures that the crack continues to desintegrate
+heating. A value of @code{1.0} ensures that the crack continues to disintegrate
 on these events, a value of @code{0.0} prohibits visible cracks to get larger.
-This value is defaulted by @ref{Fragility} and superceeded by @ref{it_crack}
+This value is defaulted by @ref{Fragility} and superseded by @ref{it_crack}
 specific values.
 
 @table @asis
@@ -9668,7 +9668,7 @@
 Most floors can dissolve to @ref{fl_abyss} or @ref{fl_water} on destruction
 by explosions, fire, @ref{ot_cannonball} hits, @ref{it_crack}, @ref{it_trap},
 etc. But a few like @ref{fl_abyss}, @ref{fl_water} and @ref{fl_swamp} are
-indestrctible by all these events.
+indestructible by all these events.
 
 @table @asis
 @item @b{Type:} @ @ boolean
@@ -11075,7 +11075,7 @@
 are floodable by default.
 
 As soon as you add a @samp{fl_water_source} or set the @samp{state} to 
- at samp{FLOODING}, the water starts to spread to floodable neigboring grids with
+ at samp{FLOODING}, the water starts to spread to floodable neighboring grids with
 a speed defined by the attribute @samp{interval}. The speed will be inherited to
 floors flooded by a stream.
 
@@ -11232,7 +11232,7 @@
 @tab @image{images/it_magicwand, 12mm} @tab @yref{it_magicwand}
 @tab @image{images/it_magnet_off, 12mm} @tab @yref{it_magnet}
 @item @image{images/it_meditation_bump, 12mm} @tab @yref{it_meditation}_bump
- at tab @image{images/it_meditation_caldera, 12mm} @tab @yref{it_meditation}_caledera
+ at tab @image{images/it_meditation_caldera, 12mm} @tab @yref{it_meditation}_caldera
 @tab @image{images/it_meditation_dent, 12mm} @tab @yref{it_meditation}_dent
 @item @image{images/it_meditation_hill, 12mm} @tab @yref{it_meditation}_hill
 @tab @image{images/it_meditation_hollow, 12mm} @tab @yref{it_meditation}_hollow
@@ -11492,22 +11492,22 @@
 @obindex it_bottle
 
 A bottle can be filled either with booze or with a message. When a bottle
-breaks the remnants are leathal sherds.
+breaks the remnants are lethal sherds.
 
 A bottle filled with booze makes any ball like actor that activates it drunken.
 The control of actor gets difficult as it will likely no longer move straight
-into the intended direction. Fortunalty the period of drunkeness lasts just
+into the intended direction. Fortunately the period of drunkenness lasts just
 5 seconds per default. But you can set this time by the attribute 
 @samp{interval} to other values. The bottle will be dropped on activation.
 Activation of several bottles in sequence will lead to longer periods of
-drunkeness as the intervalls will sum up.
+drunkenness as the intervals will sum up.
 
 Alternatively you can fill the bottle with a message by the attribute 
 @samp{text}. Like @ref{it_document} the message gets displayed on activation.
 Of course the actor does not get drunken in this case.
 
 When a stone gets pushed over a bottle it will break to sherds. These 
-remnants are leathal to @ref{ac_marble} and @ref{ac_pearl} when entering the
+remnants are lethal to @ref{ac_marble} and @ref{ac_pearl} when entering the
 affected grid. But of course they can jump over the broken bottle or pass it
 while being protected by an activated @ref{it_umbrella}. Unlike @ref{it_death}
 the broken bottle can be removed by an actor by activation of an @ref{it_brush}
@@ -11815,12 +11815,12 @@
 at any free grid position. It ignites on drop, or if positioned on the floor in
 @samp{IDLE} state it ignites on laser light, nearby fire and other nearby 
 explosions as those caused by @ref{it_bomb}, @ref{st_dispenser}, or other 
-dyamite. A falling @ref{ot_cannonball} lets it explode immediately without prior
+dynamite. A falling @ref{ot_cannonball} lets it explode immediately without prior
 ignition.
 
 On ignition its fuse starts burning. During this @samp{ACTIVE} state the
 dynamite can longer be picked up. After a short time the dynamite explodes
-causing on the 8 neigboring positions items to ignite and some stones like
+causing on the 8 neighboring positions items to ignite and some stones like
 @ref{st_break} to dissolve, too. The explosion leaves at its position an
 @ref{it_meditation}_hollow on all floor kinds besides @ref{fl_ice} where an
 @ref{it_crack}_water remains.
@@ -11880,7 +11880,7 @@
 visible for the user by a color spot. Green is a @samp{FULL} extinguisher, 
 yellow a @samp{MEDIUM} filled extinguisher and red an @samp{EMPTY} extinguisher.
 
-Extinguishers themself are fireprotected as long as they are not empty.
+Extinguishers themselves are fireprotected as long as they are not empty.
 
 The @samp{toggle} messages refills an extinguisher by one load until it is
 @samp{FULL} again.
@@ -12016,7 +12016,7 @@
 Glasses can make invisible @ref{st_death} visible, can uncover invisible
 passages by making hollow stones transparent, can make inactive
 @ref{st_lightpassenger} be distinguishable from @ref{st_darkglass}, can make
-invisble @ref{it_sensor}, @ref{it_trap} and @ref{st_actorimpulse} be visible.
+invisible @ref{it_sensor}, @ref{it_trap} and @ref{st_actorimpulse} be visible.
 
 All these features are configurable by the constants @samp{SPOT_DEATH},
 @samp{SPOT_HOLLOW}, @samp{SPOT_LIGHTPASSENGER}, @samp{SPOT_SENSOR},
@@ -12494,11 +12494,11 @@
 @subsection it_spoon
 @obindex it_spoon
 
-Dropping a spoon is a medivial synonym for dying. The poor people had nothing
+Dropping a spoon is a medieval synonym for dying. The poor people had nothing
 besides a wooden spoon. They never dropped it. They had to peg out to give away
 their spoon.
 
-Thus an Enigma spoon shatters the actor who dropps it. When a player owns 
+Thus an Enigma spoon shatters the actor who drops it. When a player owns 
 multiple actors just the active one gets killed. This is an essential difference
 to pressing F3, what shatters all actors of all players. When providing a spoon
 you may sometimes want to revoke the ability to commit a global suicide by
@@ -12567,7 +12567,7 @@
 @end example
 
 The replacement item is randomly chosen out of the given selection. By listing
-an item several times you can take influence on the likelyhood.
+an item several times you can take influence on the likelihood.
 
 The tile declarations referenced by a key may even contain objects besides
 items. But you should make rare and proper usage of this feature.
@@ -12788,7 +12788,7 @@
 * it_springboard::     Static Spring
 * it_squashed::        Remnant of squashed Fruits
 * it_strip::           Narrow Bridge
-* it_trap::            Unvisible, covered Abyss
+* it_trap::            Invisible, covered Abyss
 * it_trigger::         Floor Switch for Actors and Stones
 * it_vortex::          Teleport of Marbles
 * it_wormhole::        Teleport of Actors
@@ -12886,12 +12886,12 @@
 A bomb is an explosive that can not be picked up. It ignites on laser light, 
 nearby fire and other nearby explosions as those caused by other @ref{it_bomb}s,
 @ref{it_dynamite}, @ref{st_dispenser} exploding directly above a bomb, or simply
-by a solide stone being pushed over them (just a few stones like @ref{st_shogun},
+by a solid stone being pushed over them (just a few stones like @ref{st_shogun},
 @ref{st_box}_hay do not cause bombs to ignite). A falling @ref{ot_cannonball}
 lets it explode immediately without prior ignition.
 
 On ignition its fuse starts burning. After a short time the bomb explodes
-causing on the 8 neigboring positions items to ignite and some stones like
+causing on the 8 neighboring positions items to ignite and some stones like
 @ref{st_break} to dissolve, too. 
 
 @samp{BLACK} bombs will cause destructible items on the 4 neighboring positions
@@ -12942,7 +12942,7 @@
 
 A legacy item representing the fire state and handling the visible animation.
 This item is nowadays mainly an internal system item as the @ref{Fire Spreading}
-with its attributes and messages is mainly handeled by the @ref{Floor Objects}.
+with its attributes and messages is mainly handled by the @ref{Floor Objects}.
 But it may be essential for your understanding to be aware of this object in
 all its variants. You may also need to make use of all variants on level 
 initialization due to the @ref{Snapshot Principle}.
@@ -12954,7 +12954,7 @@
 instead.
 @item @samp{oil} - is the visible variant of the invisible burnable item.
 @item @samp{ignited} - carries the starting-animation of fire; send the 
- at samp{setfire} message to a floor or set the foor with attribute 
+ at samp{setfire} message to a floor or set the floor with attribute 
 @samp{initfire} instead.
 @item @samp{burning} - carries the animation of burning fire. Use setfire instead.
 @item @samp{ash} - the unburnable remnant of a fire.
@@ -13268,7 +13268,7 @@
 @item @b{Messages:} none
 @item @b{Variants:}
 @table @asis
- at item @image{images/it_laser, 12mm} @b{it_laserbeam} can not be instanciated by levels
+ at item @image{images/it_laser, 12mm} @b{it_laserbeam} can not be instantiated by levels
 @end table
 @end table
 
@@ -13383,7 +13383,7 @@
 @table @asis
 @item @b{state}, @ @ @i{values}: @code{MEDITATION_CALDERA}, @code{MEDITATION_HOLLOW}, @code{MEDITATION_DENT}, @code{MEDITATION_BUMP}, @code{MEDITATION_HILL}, @code{MEDITATION_VOLCANO}; @ @ @i{default}: @code{MEDITATION_HOLLOW} @ @ @xref{state}
 The shape of the meditation.
- at item @b{essential} @ @ @i{values}: @code{DISPENSIBLE}, @code{INDISPENSIBLE}; @ @ @i{default}: @code{DISPENSIBLE}
+ at item @b{essential} @ @ @i{values}: @code{DISPENSABLE}, @code{INDISPENSABLE}; @ @ @i{default}: @code{DISPENSABLE}
 Essentialness of being filled with a meditation marble to fulfill the
 @ref{Ending Conditions}.
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: @code{nil} @ @ @xref{friction}
@@ -13494,7 +13494,7 @@
 top will start in state @samp{ON} without sending actions due to the
 @ref{Snapshot Principle}.
 
-Note that a dot is freezable by an @ref{st_ice} and can thus be delocated to
+Note that a dot is freezable by an @ref{st_ice} and can thus be relocated to
 another position.
 
 @table @asis
@@ -13926,7 +13926,7 @@
 @node Stone Overview
 @section Stone Overview
 
-WORK IN PROGRESS - The follwing table is still incomplete!
+WORK IN PROGRESS - The following table is still incomplete!
 @multitable @columnfractions .08 .25 .08 .25 .09 .25
 @item @image{images/st_actorimpulse, 12mm} @tab @yref{st_actorimpulse}
 @tab @image{images/st_ancient, 12mm} @tab @yref{st_ancient}
@@ -16112,7 +16112,7 @@
 pass it (@pxref{Transparent Stones}).
 
 Ice blocks shatter on nearby @ref{it_bomb} and @ref{it_dynamite} explosions and
-on @ref{ot_cannonball} hits. The ice will spead to the four direct neighboring
+on @ref{ot_cannonball} hits. The ice will spread to the four direct neighboring
 grid positions and will cover these and the originating position with 
 @ref{fl_ice}. Just @ref{fl_abyss} will not be covered by this ice floor and
 remains unchanged. Thus an exploding bomb leaves an @ref{fl_abyss} at its
@@ -16359,7 +16359,7 @@
 A switch that is triggered by actor hits and laser light. It switches instantly
 to state @samp{ON} and when it is no longer illuminated it switches back to
 state @samp{OFF} after a given @samp{interval}. Repetitive actor hits and
-continuing laser light will prolong the @samp{ON} state untill a trailing
+continuing laser light will prolong the @samp{ON} state until a trailing
 @samp{interval} after the last hit has been expired. A similar object without
 light sensitiveness is the @ref{st_monoflop}.
 
@@ -17102,7 +17102,7 @@
 While the switch is not transparent in its default off state, it switches to
 a transparent on state.
 
-The switch looks like an @ref{st_darkglass} in its intransparent off state and like
+The switch looks like an @ref{st_darkglass} in its opaque off state and like
 an @ref{st_lightglass} in its transparent on state. Like other 
 @ref{Transparent Stones} it is passable for invisible actors.
 
@@ -18105,8 +18105,8 @@
 to the border will shatter actors instead.
 
 Any actor moved by a turnstile is directly warped to its new position without
-touching any grid inbetween. Thus actors can pass abyss or water floors,
-but they will not grab any items located on the grid positions inbetween.
+touching any grid in between. Thus actors can pass abyss or water floors,
+but they will not grab any items located on the grid positions in between.
 The relative position of an actor within the grid is maintained during its
 circular move. Thus two small actors moved at the same time keep their relative
 positioning. It is guaranteed that any moved actors will fall even into a tiny
@@ -18324,7 +18324,7 @@
 required speed by adding @ref{it_weight}, by revealing an @ref{it_hammer}, or by
 weakening the window faces by prior scratching it with an @ref{it_ring}. Green
 safety glass windows will never break on actor attacks and actors will not 
-shatter on hitting saftey glass.
+shatter on hitting safety glass.
 
 Bomb explosions can shatter window faces, too. Normal blue window faces adjacent
 to a bomb explosion will break. Green safety glass faces will break only if
@@ -18356,7 +18356,7 @@
 west, is guaranteed on read access but arbitrary on write access.
 @item @b{secure} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 Green safety glass is secure, whereas normal blue is not.
- at item @b{scatches} @ @ @i{values}: string; @ @ @i{default}: @code{""}
+ at item @b{scratches} @ @ @i{values}: string; @ @ @i{default}: @code{""}
 Describes the scratched window faces of the stone. The string is a substring of
 @code{"nesw"} listing the affected faces. The sequence of the sides, north, east,
 south, west, is guaranteed on read access but arbitrary on write access.
@@ -18615,9 +18615,9 @@
 @subsection essential
 
 Describes the necessity of an actor to be alive in case of multiple actors being
-attached to a player. A value @samp{DISPENSIBLE} marks an actor as not essential.
+attached to a player. A value @samp{DISPENSABLE} marks an actor as not essential.
 The player may well continue to play with other actors that he controls which
-are still alive. A value of @samp{INDISPENSIBLE} marks an actor as totally
+are still alive. A value of @samp{INDISPENSABLE} marks an actor as totally
 necessary. If such an actor cannot be resurrected after a death, the player is
 essentially dead. A value of @samp{PERKIND} marks an actor as partially
 essential. Not the actor itself needs to survive but the number of actors of
@@ -18633,7 +18633,7 @@
 
 @table @asis
 @item @b{Type:} @ @ number
- at item @b{Values:} @ @ @code{DISPENSIBLE}, @code{INDISPENSIBLE}, @code{PERKIND}
+ at item @b{Values:} @ @ @code{DISPENSABLE}, @code{INDISPENSABLE}, @code{PERKIND}
 @item @b{Default:} @ @ @code{}
 @item @b{Access:} @ @ read/write
 @end table
@@ -19111,7 +19111,7 @@
 where the rubberband starts to apply the opposite directed forces onto the
 actors, like a spring would do. Thus a positive @samp{strength} would lead to a
 repelling force, a negative one to an attracting force. A rubberband with a
-length inbetween @samp{threshold} and @samp{length} will apply no forces.
+length in between @samp{threshold} and @samp{length} will apply no forces.
 
 In some cases you do want to limit the length of the rubberband. You can do this
 by setting @samp{min} and @samp{max} attributes. Actors will bounce on these
@@ -19130,7 +19130,7 @@
 to violate the limits any further you may need to increase this constant.
 
 Rubberbands can be cut by @ref{st_scissors}, by an @ref{it_vortex} or
- at ref{it_wormhole} with a set @samp{scissors} attribute ,by receiving a
+ at ref{it_wormhole} with a set @samp{scissors} attribute, by receiving a
 @ref{kill} message, by one of the anchors receiving a @ref{disconnect} message
 or a stone anchor that ceases to exist.
 
@@ -19447,7 +19447,7 @@
 
 @item @b{Syntax Samples:}
 @example
-all_contacts = lib.lua.combine_tables(telephon_numbers, email_addresses)
+all_contacts = lib.lua.combine_tables(telephone_numbers, email_addresses)
 @end example
 
 @item @b{Details:}
@@ -22312,7 +22312,7 @@
 substituted. But in this case the substitution is composed of a single percent
 sign followed by an integer number, that counts the key position within the
 given range, starting with the given offset or default @code{1}. Thus a key of 
- at samp{c} in the syntax sampe above will target the door @samp{door%3}. You 
+ at samp{c} in the syntax sample above will target the door @samp{door%3}. You 
 would need to use the key @samp{C} in the map for the matching door.
 
 The template tile definitions can well be composed of several concatenated
@@ -22527,7 +22527,7 @@
 direction, they may be just connected to its 4 neighbors or to 6 neighbors in
 hexagonal mazes or three dimensional mazes. You can write and plug in your own
 maze generation and rendering algorithms. And finally you can analyse,
-postprocess and even modify your maze even after the inital creation.
+postprocess and even modify your maze even after the initial creation.
 
 From the mathematical point of view we provide the basic structures for
 generation of quite arbitrary directed graphs. Our maze consists of cells, the
@@ -22578,13 +22578,13 @@
 @item @i{keyvalue} = <area=@i{area_value} | render = @i{render_value} | kernel = @i{kernel_value} | spacing = @i{spacing_value} | persistent=@i{persistence}>
 Values for given keys that may occur in any sequence in the anonymous table.
 @item @i{area_value} = @{<@i{rectangular_area} | @i{marked_area}>@}
-The maze area specification, that is either defined as an rectangluar area
+The maze area specification, that is either defined as an rectangular area
 or an area marked in the the world's map.
 @item @i{rectangular_area} = @i{anchor}, @i{width}, @i{height}
 An rectangular area that is given by an anchor position within the world and
 two numbers for the width and height measured in maze cells.
 @item @i{anchor}
-Anything that is convertable to a @ref{Position} that denotes the upper left
+Anything that is convertible to a @ref{Position} that denotes the upper left
 edge of the rectangular maze area. Besides a position value, an object reference
 or a name string of an object or position are supported value types.
 @item @i{marked_area}
@@ -22601,7 +22601,7 @@
 The specification for drawing the maze. In case of a missing specification
 no drawing will be done at all. If the default standard renderer should be used
 its parameters can be directly supplied, other renderers need a type 
-specification plus the necesssary configuration information.
+specification plus the necessary configuration information.
 @item @i{std_renderer_args} = @i{passage_keys} [, <@i{wall_key} [, @i{kernel_key}] | @i{cell_map}>]]
 The standard renderer takes info about tile keys to be used for the passages,
 and either a cell map, or additional tile keys for the wall and optionally the
@@ -22629,11 +22629,11 @@
 @item @i{renderer}
 The function that does the rendering. By default it is 
 @samp{lib.maze.renderer_standard} with the above given arguments. Other supplied
-renederers are @samp{lib.maze.renderer_window} and 
+renderers are @samp{lib.maze.renderer_window} and 
 @samp{lib.maze.renderer_strip}
 
 @item @i{persistence}
-A boolean flag that default to @samp{false}. You nees to set it to @samp{true}
+A boolean flag that defaults to @samp{false}. You need to set it to @samp{true}
 if you want to access the maze or any of its cells after the level 
 initialization. Otherwise the maze reference handle with all its data may get
 invalid due to memory garbage collection. This is no problem for most mazes,
@@ -23069,7 +23069,7 @@
 @ref{fl_wood}, @ref{fl_hay} and @ref{fl_rock} do not require to be explicitly 
 marked floodable as they are floodable by default. The marked area is the 
 maximum area that may be flooded. But obstacles may block the flood temporarily
-or permantently.
+or permanently.
 
 A flood starts at a source.  As soon as you add a @samp{fl_water_source} or set
 the @samp{state} to @samp{FLOODING}, the @ref{fl_water} starts to spread to
@@ -23096,9 +23096,9 @@
 In contrast to these floor building stones the @ref{st_puzzle} does neither
 fall on static nor on flooding @ref{fl_water}. As a solid stone it will even 
 block a flood on neighboring grids to reach its position. But of course once
-moved completly over @ref{fl_water} the puzzle will fall if its own conditions
+moved completely over @ref{fl_water} the puzzle will fall if its own conditions
 are met. The successor @ref{fl_gray} will not build a bridge over water. It
-fills up the ditch and replaces the water completly. Thus the user can use 
+fills up the ditch and replaces the water completely. Thus the user can use 
 puzzles to stop a flood.
 
 When a flood stream spreads to a new floor items on these floors may be affected.
@@ -23107,7 +23107,7 @@
 
 Further active components of the flood concept are @ref{it_vortex} and
 @ref{it_wormhole}. Besides actors both do spread a flood. The @ref{it_wormhole}
-speads the flood to its @samp{destination} if the floor at this grid is marked
+spreads the flood to its @samp{destination} if the floor at this grid is marked
 @samp{floodable}. An @ref{it_vortex} will flood all its @samp{destination}s,
 but of course just if it is in state @samp{OPEN}. In case the destinations are
 vortices, too, they must be open, too, for a successful flood spreading. When the
@@ -23746,7 +23746,7 @@
 committed to maintain all features in future versions of Enigma.
 
 But for inclusion of your levels into the Enigma project we would like to
-recommend conformance to some common standards. These few points gurantee that
+recommend conformance to some common standards. These few points guarantee that
 your levels can easily be processed by our administration tools, the players
 can talk about your level and your level remains editable by the project
 maintainers in case of urgent need.



From ral at mail.berlios.de  Tue Jul  7 01:13:17 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 7 Jul 2009 01:13:17 +0200
Subject: [Enigma-game-svn] r1747 - in trunk/doc: manual manual/images
	reference reference/images
Message-ID: <200907062313.n66NDHLk011007@sheep.berlios.de>

Author: ral
Date: 2009-07-07 01:13:15 +0200 (Tue, 07 Jul 2009)
New Revision: 1747

Modified:
   trunk/doc/manual/Makefile.am
   trunk/doc/manual/images/Makefile.am
   trunk/doc/reference/Makefile.am
   trunk/doc/reference/images/Makefile.am
Log:
Trunk 1.1:
- drop support of elder TeX versions and remove png to pdf image convertions
- fix makefiles in doc dirs concerning targets "clean" and "mostlyclean"



Modified: trunk/doc/manual/Makefile.am
===================================================================
--- trunk/doc/manual/Makefile.am	2009-07-06 19:28:42 UTC (rev 1746)
+++ trunk/doc/manual/Makefile.am	2009-07-06 23:13:15 UTC (rev 1747)
@@ -11,6 +11,10 @@
 
 EXTRA_DIST = $(TEXI) $(html_DATA)
 
+MOSTLYCLEANFILES = enigma{,_de,_fr}.{at,ats,aux,cp,cps,fn,fns,ky,log,ms,mss,ob,obs,pg,toc,tp,vr,vrs}
+CLEANFILES = enigma{,_de,_fr}.{pdf,html}
+
+
 %.html : %.texi
 	@if [ "${TEXI2HTML}" ]; then \
 	  if test "$<" = "enigma_ru.texi"; then \

Modified: trunk/doc/manual/images/Makefile.am
===================================================================
--- trunk/doc/manual/images/Makefile.am	2009-07-06 19:28:42 UTC (rev 1746)
+++ trunk/doc/manual/images/Makefile.am	2009-07-06 23:13:15 UTC (rev 1747)
@@ -1,14 +1,6 @@
 PNG = $(wildcard $(srcdir)/*.png)
-PDF = $(addprefix $(if $(builddir), $(builddir)/,), $(addsuffix .pdf, $(basename $(notdir $(PNG)))))
 
 pngdir=@datadir@/doc/enigma/manual/images
 png_DATA=$(PNG)
 
-SUFFIXES = .png .pdf
-
-pdf: $(PDF)
-
-.png.pdf:
-	convert -density 112x112 $< $@
-
 EXTRA_DIST = $(PNG)

Modified: trunk/doc/reference/Makefile.am
===================================================================
--- trunk/doc/reference/Makefile.am	2009-07-06 19:28:42 UTC (rev 1746)
+++ trunk/doc/reference/Makefile.am	2009-07-06 23:13:15 UTC (rev 1747)
@@ -9,6 +9,8 @@
 
 EXTRA_DIST = enigma-ref.texi enigma-t2h.init $(ref_DATA)
 
+MOSTLYCLEANFILES = enigma-ref.{at,ats,aux,cp,cps,fn,fns,ky,log,ms,mss,ob,obs,pg,toc,tp,vr,vrs}
+CLEANFILES = enigma-ref.{pdf,html}
 
 enigma-ref.html: $(srcdir)/enigma-ref.texi $(srcdir)/enigma-t2h.init
 	@if [ "${TEXI2HTML}" ]; then \
@@ -27,8 +29,3 @@
 
 %.pdf: %.texi
 	$(TEXI2DVI) --pdf $<
-# Better use $(TEXI2PDF). May be missing on elder systems.
-
-clean:
-	$(RM) enigma-ref.pdf
-	$(RM) enigma-ref.{at,ats,aux,cp,cps,fn,fns,ky,log,ms,mss,ob,obs,pg,toc,tp,vr,vrs}

Modified: trunk/doc/reference/images/Makefile.am
===================================================================
--- trunk/doc/reference/images/Makefile.am	2009-07-06 19:28:42 UTC (rev 1746)
+++ trunk/doc/reference/images/Makefile.am	2009-07-06 23:13:15 UTC (rev 1747)
@@ -234,28 +234,18 @@
 
 PNGSOURCE = $(addprefix $(GFXDIR), $(PNGLIST))
 
-# PDFLIST is deprecated (on elder systems pdflatex needs pdf images)
-PDFLIST = $(addsuffix .pdf, $(basename $(PNGLIST)))
 
 pngdir = @datadir@/doc/enigma/reference/images
 png_DATA = $(PNG) $(PNGLIST)
 
 .SUFFIXES = .png
 
-all: $(PNGLIST) $(PDFLIST) first_level.pdf
+all: $(PNGLIST)
 
-clean:
-	$(RM) $(PNGLIST)
-	$(RM) $(PDFLIST)
-	$(RM) first_level.pdf
-
-first_level.pdf: first_level.png
-	convert -density 112x112 $< $@
-
 %.png: $(GFXDIR)/%.png
 	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< $@
 
-%.pdf: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< $@
+CLEANFILES = $(PNGLIST)
 
 EXTRA_DIST = $(PNG)
+



From ral at mail.berlios.de  Wed Jul  8 00:53:19 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 8 Jul 2009 00:53:19 +0200
Subject: [Enigma-game-svn] r1748 - in trunk: doc lib-src/enigma-core src
	src/gui
Message-ID: <200907072253.n67MrJR2006752@sheep.berlios.de>

Author: ral
Date: 2009-07-08 00:53:17 +0200 (Wed, 08 Jul 2009)
New Revision: 1748

Added:
   trunk/lib-src/enigma-core/ecl_system.cc
Removed:
   trunk/lib-src/enigma-core/ecl_system_unix.cc
Modified:
   trunk/doc/REQUIREMENTS
   trunk/lib-src/enigma-core/Makefile.am
   trunk/lib-src/enigma-core/ecl_system.hh
   trunk/src/Makefile.am
   trunk/src/gui/MainMenu.cc
   trunk/src/gui/MainMenu.hh
   trunk/src/main.cc
   trunk/src/main.hh
Log:
Trunk 1.1: 
- new help menu:
  - browse homepage
  - browse documentation
  - show paths
  - locate auto folder in desktop explorer
  - locate score file in desktop explorer
  - credits
- improved main menu for 320x240


Modified: trunk/doc/REQUIREMENTS
===================================================================
--- trunk/doc/REQUIREMENTS	2009-07-06 23:13:15 UTC (rev 1747)
+++ trunk/doc/REQUIREMENTS	2009-07-07 22:53:17 UTC (rev 1748)
@@ -50,6 +50,8 @@
 		http://curl.haxx.se/
 		just http,ftp,ipv6 support are required
 
+xdg-utils	(L) only on runtime
+
 Tools:
 ------
 

Modified: trunk/lib-src/enigma-core/Makefile.am
===================================================================
--- trunk/lib-src/enigma-core/Makefile.am	2009-07-06 23:13:15 UTC (rev 1747)
+++ trunk/lib-src/enigma-core/Makefile.am	2009-07-07 22:53:17 UTC (rev 1748)
@@ -32,7 +32,7 @@
 	ecl_sdl.hh 			\
 	ecl_sdl.cc			\
 	ecl_system.hh 			\
-	ecl_system_unix.cc 		\
+	ecl_system.cc	 		\
 	ecl_sys_localename.cc		\
 	ecl_utf.hh                      \
 	ecl_utf.cc                      \

Copied: trunk/lib-src/enigma-core/ecl_system.cc (from rev 1747, trunk/lib-src/enigma-core/ecl_system_unix.cc)
===================================================================
--- trunk/lib-src/enigma-core/ecl_system_unix.cc	2009-07-06 23:13:15 UTC (rev 1747)
+++ trunk/lib-src/enigma-core/ecl_system.cc	2009-07-07 22:53:17 UTC (rev 1748)
@@ -0,0 +1,228 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#include "ecl_system.hh"
+#include "ecl_util.hh"
+
+#include <cstdlib>
+#include <iostream>
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <locale.h>
+#include <unistd.h>
+#include <cassert>
+
+#include <config.h>
+
+#ifdef __MINGW32__
+#include <windows.h>
+#include <shellapi.h>
+#elif MACOSX
+#include <Carbon/Carbon.h>
+#include <CoreFoundation/CoreFoundation.h>
+#include <CoreServices/CoreServices.h>
+#endif
+
+using namespace ecl;
+using std::string;
+
+#ifdef __MINGW32__
+const char *ecl::PathSeparator = "\\";      // for path assembly
+const char *ecl::PathsSeparator = ";";      // for listing paths in a string
+#else
+const char *ecl::PathSeparator = "/";       // for path assembly
+const char *ecl::PathsSeparator = ":";      // for listing paths in a string
+#endif
+const char *ecl::PathSeparators = "/\\";    // for path splits
+
+string ecl::ExpandPath (const string &pth)
+{
+    string path = pth;
+    string::size_type p=path.find("~");
+    if (p != string::npos) {
+        string home;
+        if (char *h = getenv("HOME"))
+            home = h;
+        path.replace(p, 1, home);
+    }
+    return path;
+}
+
+bool ecl::FileExists (const std::string &fname)
+{
+    struct stat s;
+    return (stat(fname.c_str(), &s)==0 && S_ISREG(s.st_mode));
+}
+
+time_t ecl::FileModTime (const std::string &fname)
+{
+    struct stat s;
+    if (stat(fname.c_str(), &s) == 0) {
+        return s.st_mtime;
+    }
+
+    return 0;                   // beginning of time
+}
+
+bool ecl::FolderExists (const std::string &fname)
+{
+    struct stat s;
+    return (stat(fname.c_str(), &s)==0 && S_ISDIR(s.st_mode));
+}
+
+bool ecl::FolderCreate (const std::string &fname)
+{
+    string parent_folder;
+    string sub_folder;
+    bool   ok = true;
+
+    assert(!FolderExists(fname));
+
+    if (split_path(fname, &parent_folder, &sub_folder)) {
+        if (!FolderExists(parent_folder)) {
+            ok = FolderCreate(parent_folder);
+        }
+    }
+
+    if (ok) {
+#ifdef __MINGW32__
+        ok = mkdir(fname.c_str()) == 0;
+#else
+        ok = mkdir(fname.c_str(), 0777) == 0;
+#endif
+    }
+    return ok;
+}
+
+bool ecl::BrowseUrl(const std::string url) {
+    bool result = true;
+#ifdef __MINGW32__
+    result == (ShellExecute(NULL, "open", url.c_str(), NULL, NULL, SW_SHOWNORMAL) >= 32);
+#elif MACOSX
+    CFStringRef cfurlStr = CFStringCreateWithCString( NULL, url.c_str(), kCFStringEncodingASCII);
+
+    // Create a URL object:
+    CFURLRef cfurl = CFURLCreateWithString (NULL, cfurlStr, NULL);
+
+    // Open the URL:
+    LSOpenCFURLRef(cfurl, NULL);
+
+    // Release the created resources:
+    CFRelease(cfurl);
+    CFRelease(cfurlStr);
+#else
+    result = (system(("xdg-open " + url + " &").c_str()) == 0);
+#endif
+    return result;
+}
+
+bool ecl::ExploreFolder(const std::string path) {
+    bool result = true;
+#ifdef __MINGW32__
+    result == (ShellExecute(NULL, "explore", path.c_str(), NULL, NULL, SW_SHOWNORMAL) >= 32);
+#elif MACOSX
+    CFStringRef cfurlStr = CFStringCreateWithCString( NULL, path.c_str(), kCFStringEncodingASCII);
+
+    // Create a URL object:
+    CFURLRef cfurl = CFURLCreateWithString (NULL, cfurlStr, NULL);
+
+    // Open the URL:
+    LSOpenCFURLRef(cfurl, NULL);
+
+    // Release the created resources:
+    CFRelease(cfurl);
+    CFRelease(cfurlStr);
+#else
+    result = (system(("xdg-open " + path + " &").c_str()) == 0);
+#endif
+    return result;
+}
+
+#ifdef __MINGW32__
+// should be ecl_system_windows.cc ?
+std::string ecl::ApplicationDataPath()
+{
+    typedef HRESULT (WINAPI *SHGETFOLDERPATH)( HWND, int, HANDLE, DWORD, LPTSTR );
+#   define CSIDL_FLAG_CREATE 0x8000
+#   define CSIDL_APPDATA 0x1A
+#   define SHGFP_TYPE_CURRENT 0
+
+    HINSTANCE shfolder_dll;
+    SHGETFOLDERPATH SHGetFolderPath ;
+
+    static bool didRun = false;
+    static std::string result = "";  // remember exec results 
+    
+    if (!didRun) {
+        didRun = true;
+        /* load the shfolder.dll to retreive SHGetFolderPath */
+        if( ( shfolder_dll = LoadLibrary("shfolder.dll") ) != NULL )
+        {
+            SHGetFolderPath = (SHGETFOLDERPATH)GetProcAddress( shfolder_dll, "SHGetFolderPathA");
+            if ( SHGetFolderPath != NULL )
+            {
+                TCHAR szPath[MAX_PATH] = "";
+    
+                /* get the "Application Data" folder for the current user */
+                if( S_OK == SHGetFolderPath( NULL, CSIDL_APPDATA | CSIDL_FLAG_CREATE,
+                                             NULL, SHGFP_TYPE_CURRENT, szPath) )
+                {
+                    result = szPath;
+                }
+            }
+            FreeLibrary( shfolder_dll);
+        }
+    }
+    return result;
+}
+
+void ecl::ToLowerCase(std::string &filename) {
+    for (int i = 0; i < filename.length(); i++) {
+	char c = filename[i];
+	if (c >= 'A' && c <= 'Z')
+	    filename.replace(i, 1, 1, c - 'A' + 'a');
+    }
+}
+
+std::set<std::string> ecl::UniqueFilenameSet(std::set<std::string> inSet) {
+    std::set<std::string>::iterator it = inSet.begin();
+    std::set<std::string> outSet;
+    std::set<std::string> lowerSet;
+    for (; it != inSet.end(); it++) {
+	std::string name = *it;
+	ecl::ToLowerCase(name);
+	if (lowerSet.find(name) == lowerSet.end()) {
+	    outSet.insert(*it);
+	    lowerSet.insert(name);
+	}
+    }
+    return outSet;
+}
+
+#endif
+
+
+std::string ecl::GetLanguageCode (const std::string &ln)
+{
+    if (ln == "C" || ln == "POSIX" || ln.size() < 2)
+        return "en";
+
+    return ln.substr (0, 2);
+}
+

Modified: trunk/lib-src/enigma-core/ecl_system.hh
===================================================================
--- trunk/lib-src/enigma-core/ecl_system.hh	2009-07-06 23:13:15 UTC (rev 1747)
+++ trunk/lib-src/enigma-core/ecl_system.hh	2009-07-07 22:53:17 UTC (rev 1748)
@@ -36,6 +36,9 @@
         
     bool FolderExists (const std::string &fname);
     bool FolderCreate (const std::string &fname);
+    
+    bool BrowseUrl(const std::string url);
+    bool ExploreFolder(const std::string path);
 
 #ifdef __MINGW32__
     std::string ApplicationDataPath();

Deleted: trunk/lib-src/enigma-core/ecl_system_unix.cc
===================================================================
--- trunk/lib-src/enigma-core/ecl_system_unix.cc	2009-07-06 23:13:15 UTC (rev 1747)
+++ trunk/lib-src/enigma-core/ecl_system_unix.cc	2009-07-07 22:53:17 UTC (rev 1748)
@@ -1,178 +0,0 @@
-/*
- * Copyright (C) 2002,2003,2004 Daniel Heck
- *
- * This program is free software; you can redistribute it and/or
- * modify it under the terms of the GNU General Public License
- * as published by the Free Software Foundation; either version 2
- * of the License, or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along
- * with this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
- *
- */
-#include "ecl_system.hh"
-#include "ecl_util.hh"
-
-#include <cstdlib>
-#include <iostream>
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <locale.h>
-#include <unistd.h>
-#include <cassert>
-
-#include <config.h>
-
-#ifdef __MINGW32__
-#include <windows.h>
-#endif
-
-using namespace ecl;
-using std::string;
-
-#ifdef __MINGW32__
-const char *ecl::PathSeparator = "\\";      // for path assembly
-const char *ecl::PathsSeparator = ";";      // for listing paths in a string
-#else
-const char *ecl::PathSeparator = "/";       // for path assembly
-const char *ecl::PathsSeparator = ":";      // for listing paths in a string
-#endif
-const char *ecl::PathSeparators = "/\\";    // for path splits
-
-string ecl::ExpandPath (const string &pth)
-{
-    string path = pth;
-    string::size_type p=path.find("~");
-    if (p != string::npos) {
-        string home;
-        if (char *h = getenv("HOME"))
-            home = h;
-        path.replace(p, 1, home);
-    }
-    return path;
-}
-
-bool ecl::FileExists (const std::string &fname)
-{
-    struct stat s;
-    return (stat(fname.c_str(), &s)==0 && S_ISREG(s.st_mode));
-}
-
-time_t ecl::FileModTime (const std::string &fname)
-{
-    struct stat s;
-    if (stat(fname.c_str(), &s) == 0) {
-        return s.st_mtime;
-    }
-
-    return 0;                   // beginning of time
-}
-
-bool ecl::FolderExists (const std::string &fname)
-{
-    struct stat s;
-    return (stat(fname.c_str(), &s)==0 && S_ISDIR(s.st_mode));
-}
-
-bool ecl::FolderCreate (const std::string &fname)
-{
-    string parent_folder;
-    string sub_folder;
-    bool   ok = true;
-
-    assert(!FolderExists(fname));
-
-    if (split_path(fname, &parent_folder, &sub_folder)) {
-        if (!FolderExists(parent_folder)) {
-            ok = FolderCreate(parent_folder);
-        }
-    }
-
-    if (ok) {
-#ifdef __MINGW32__
-        ok = mkdir(fname.c_str()) == 0;
-#else
-        ok = mkdir(fname.c_str(), 0777) == 0;
-#endif
-    }
-    return ok;
-}
-
-#ifdef __MINGW32__
-// should be ecl_system_windows.cc ?
-std::string ecl::ApplicationDataPath()
-{
-    typedef HRESULT (WINAPI *SHGETFOLDERPATH)( HWND, int, HANDLE, DWORD, LPTSTR );
-#   define CSIDL_FLAG_CREATE 0x8000
-#   define CSIDL_APPDATA 0x1A
-#   define SHGFP_TYPE_CURRENT 0
-
-    HINSTANCE shfolder_dll;
-    SHGETFOLDERPATH SHGetFolderPath ;
-
-    static bool didRun = false;
-    static std::string result = "";  // remember exec results 
-    
-    if (!didRun) {
-        didRun = true;
-        /* load the shfolder.dll to retreive SHGetFolderPath */
-        if( ( shfolder_dll = LoadLibrary("shfolder.dll") ) != NULL )
-        {
-            SHGetFolderPath = (SHGETFOLDERPATH)GetProcAddress( shfolder_dll, "SHGetFolderPathA");
-            if ( SHGetFolderPath != NULL )
-            {
-                TCHAR szPath[MAX_PATH] = "";
-    
-                /* get the "Application Data" folder for the current user */
-                if( S_OK == SHGetFolderPath( NULL, CSIDL_APPDATA | CSIDL_FLAG_CREATE,
-                                             NULL, SHGFP_TYPE_CURRENT, szPath) )
-                {
-                    result = szPath;
-                }
-            }
-            FreeLibrary( shfolder_dll);
-        }
-    }
-    return result;
-}
-
-void ecl::ToLowerCase(std::string &filename) {
-    for (int i = 0; i < filename.length(); i++) {
-	char c = filename[i];
-	if (c >= 'A' && c <= 'Z')
-	    filename.replace(i, 1, 1, c - 'A' + 'a');
-    }
-}
-
-std::set<std::string> ecl::UniqueFilenameSet(std::set<std::string> inSet) {
-    std::set<std::string>::iterator it = inSet.begin();
-    std::set<std::string> outSet;
-    std::set<std::string> lowerSet;
-    for (; it != inSet.end(); it++) {
-	std::string name = *it;
-	ecl::ToLowerCase(name);
-	if (lowerSet.find(name) == lowerSet.end()) {
-	    outSet.insert(*it);
-	    lowerSet.insert(name);
-	}
-    }
-    return outSet;
-}
-
-#endif
-
-
-std::string ecl::GetLanguageCode (const std::string &ln)
-{
-    if (ln == "C" || ln == "POSIX" || ln.size() < 2)
-        return "en";
-
-    return ln.substr (0, 2);
-}
-

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-07-06 23:13:15 UTC (rev 1747)
+++ trunk/src/Makefile.am	2009-07-07 22:53:17 UTC (rev 1748)
@@ -11,6 +11,7 @@
 
 CXXFLAGS = @CXXFLAGS@\
 	-DSYSTEM_DATA_DIR=\"$(datadir)/enigma\" \
+	-DDOCDIR=\"$(docdir)\" \
 	-DLOCALEDIR=\"$(localedir_enigma)\" \
 	-I$(top_srcdir)/lib-src/zipios++  \
 	-I$(top_builddir)/lib-src/zipios++ \

Modified: trunk/src/gui/MainMenu.cc
===================================================================
--- trunk/src/gui/MainMenu.cc	2009-07-06 23:13:15 UTC (rev 1747)
+++ trunk/src/gui/MainMenu.cc	2009-07-07 22:53:17 UTC (rev 1748)
@@ -1,6 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004,2005,2006 Daniel Heck
- *
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
  * as published by the Free Software Foundation; either version 2
@@ -20,7 +20,6 @@
 #include "gui/MainMenu.hh"
 #include "gui/LevelMenu.hh"
 #include "gui/OptionsMenu.hh"
-#include "gui/HelpMenu.hh"
 #include "gui/InfoMenu.hh"
 #include "gui/LevelPackMenu.hh"
 #include "gui/LevelPreviewCache.hh"
@@ -65,7 +64,7 @@
         const video::VMInfo *vminfo = video::GetInfo();
     
         BuildVList b(this, Rect((vminfo->width - 150)/2,150,150,40), 5);
-        m_startgame = b.add(new StaticTextButton(N_("Start Game"), this));
+        startgame = b.add(new StaticTextButton(N_("Start Game"), this));
         m_joingame = b.add(new StaticTextButton(N_("Join Game"), this));
         m_back = b.add(new StaticTextButton(N_("Back"), this));
     }
@@ -81,7 +80,7 @@
     
     void NetworkMenu::on_action(gui::Widget *w)
     {
-        if (w == m_startgame) {
+        if (w == startgame) {
             netgame::Start();
         } 
         else if (w == m_joingame) {
@@ -102,7 +101,7 @@
     }
     
 
-    /* -------------------- Main menu -------------------- */
+    /* -------------------- Help menu -------------------- */
     static const char *credit_text[] = {
         N_("Main developers of the 1.10 release:"),
         N_("  RONALD LAMPRECHT (lead)"),
@@ -121,7 +120,7 @@
         N_("Enigma is free software and may be distributed under the"),
         N_("terms of the GNU General Public License, version 2."),
         " ",
-        N_("Copyright (C) 2002-2007 Daniel Heck and contributors."),
+        N_("Copyright (C) 2002-2009 Daniel Heck and contributors."),
         0,
         N_("Main developer of all releases:"),
         " ",
@@ -218,6 +217,132 @@
         0,
     };
     
+    MainHelpMenu::MainHelpMenu () {
+        const video::VMInfo *vminfo = video::GetInfo();
+        const bool vshrink = vminfo->width < 640 ;
+    
+        BuildVList b = vshrink? BuildVList(this, Rect(40, 40, 100, 25), 3)
+                : BuildVList(this, Rect((vminfo->width - 150)/2, vminfo->tt ? 80 : 150, 150, 40), 7);
+        BuildVList br = vshrink? BuildVList(this, Rect(180, 40, 100, 25), 4) : BuildVList(this, Rect(0, 0, 0, 0), 0);
+        BuildVList *brp = vshrink? &br : &b;
+        
+        homepage = b.add(new StaticTextButton(N_("Homepage"), this));
+        docs = b.add(new StaticTextButton(N_("Dokumentation"), this));
+        paths = b.add(new StaticTextButton(N_("Paths"), this));
+        autofolder = brp->add(new StaticTextButton(N_("Locate Auto"), this));
+        scorefolder = brp->add(new StaticTextButton(N_("Locate Score"), this));
+        credits = brp->add(new StaticTextButton(N_("Credits"), this));
+        back = brp->add(new StaticTextButton(N_("Back"), this));
+    }
+    
+    MainHelpMenu::~MainHelpMenu () {
+    }
+    
+    bool MainHelpMenu::on_event (const SDL_Event &e)  {
+        return false;
+    }
+    
+    void MainHelpMenu::on_action(gui::Widget *w) {
+        if (w == homepage) {
+            ecl::BrowseUrl("http://www.enigma-game.org");            
+        } else if (w == docs) {
+            ecl::BrowseUrl(app.docPath + "/index.html");
+        } else if (w == paths) {
+            showPaths();
+        } else if (w == autofolder) {
+            ecl::ExploreFolder(app.userPath + "/levels/auto");
+        } else if (w == scorefolder) {
+            ecl::ExploreFolder(app.userPath);
+        } else if (w == credits) {
+            displayInfo(credit_text, 6);
+        } else if (w == back) {
+            Menu::quit();
+        } else
+            return;
+        invalidate_all();
+    }
+    
+    void MainHelpMenu::draw_background(ecl::GC &gc) {
+        video::SetCaption (("Enigma - Help Menu"));
+        blit(gc, 0,0, enigma::GetImage("menu_bg", ".jpg"));
+    }
+    
+    void MainHelpMenu::tick(double dtime) {
+    }
+    
+    void MainHelpMenu::showPaths() {
+        const char *pathtext[25];
+        std::string pathstrings[25];
+        std::string work;
+        Font *menufont = enigma::GetFont("menufont");
+        const video::VMInfo *vminfo = video::GetInfo();
+        int width = vminfo->width - 80;
+        int i = 0;
+        
+        pathtext[i++] = N_("Preferences Path:");
+        work = app.prefPath;
+        do {
+            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
+            pathstrings[i] = "    " + work.substr(0,breakPos);
+            pathtext[i] = pathstrings[i].c_str();
+            work = work.substr(breakPos);
+            i++;
+        } while(!work.empty() );
+        pathtext[i++] = " ";
+        pathtext[i++] = N_("User Path:");
+        work = app.userPath;
+        do {
+            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
+            pathstrings[i] = "    " + work.substr(0,breakPos);
+            pathtext[i] = pathstrings[i].c_str();
+            work = work.substr(breakPos);
+            i++;
+        } while(!work.empty() );
+        pathtext[i++] = " ";
+        pathtext[i++] = N_("User Image Path:");
+        work = app.userImagePath;
+        do {
+            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
+            pathstrings[i] = "    " + work.substr(0,breakPos);
+            pathtext[i] = pathstrings[i].c_str();
+            work = work.substr(breakPos);
+            i++;
+        } while(!work.empty() );
+        pathtext[i++] = " ";
+        pathtext[i++] = N_("System Path:");
+        work = app.systemFS->getDataPath();
+        do {
+            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
+            pathstrings[i] = "    " + work.substr(0,breakPos);
+            pathtext[i] = pathstrings[i].c_str();
+            work = work.substr(breakPos);
+            i++;
+        } while(!work.empty() );
+        pathtext[i++] = " ";
+        pathtext[i++] = N_("Resource Paths:");
+        work = app.resourceFS->getDataPath();
+        do {
+            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
+            pathstrings[i] = "    " + work.substr(0,breakPos);
+            pathtext[i] = pathstrings[i].c_str();
+            work = work.substr(breakPos);
+            i++;
+        } while(!work.empty() );
+        pathtext[i++] = " ";
+        pathtext[i++] = N_("L10n Path:");
+        work = app.l10nPath;
+        do {
+            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
+            pathstrings[i] = "    " + work.substr(0,breakPos);
+            pathtext[i] = pathstrings[i].c_str();
+            work = work.substr(breakPos);
+            i++;
+        } while(!work.empty() );
+        pathtext[i++] = 0;
+        displayInfo(pathtext, 1);
+    }
+    
+    /* -------------------- Main menu -------------------- */
     MainMenu::MainMenu() 
     {
         build_menu();
@@ -232,16 +357,22 @@
 #ifdef ENABLE_EXPERIMENTAL
         y[1] = 150;
 #endif
-        BuildVList b(this, Rect((vminfo->width - 150)/2, y[vminfo->tt], 150, vshrink?20:40), 5);
-        m_startgame = b.add(new StaticTextButton(N_("Start Game"), this));
-        m_levelpack = b.add(new StaticTextButton(N_("Level Pack"), this));
+        BuildVList b(this, Rect(vshrink?40:(vminfo->width - 150)/2, vshrink?120:y[vminfo->tt], vshrink?100:150, vshrink?25:40), vshrink?3:6);
+        BuildVList br = vshrink? BuildVList(this, Rect(180, 120, 100, 25), 3) : BuildVList(this, Rect(0, 0, 0, 0), 0);
+        BuildVList *brp = vshrink? &br : &b;
+        startgame = b.add(new StaticTextButton(N_("Start Game"), this));
+        levelpack = b.add(new StaticTextButton(N_("Level Pack"), this));
 #ifdef ENABLE_EXPERIMENTAL
         m_netgame   = b.add(new StaticTextButton(N_("Network Game"), this));
         leveled     = b.add(new StaticTextButton(N_("Editor"), this));
 #endif
         options     = b.add(new StaticTextButton(N_("Options"), this));
-        credits     = b.add(new StaticTextButton(N_("Credits"), this));
-        quit        = b.add(new StaticTextButton(N_("Quit"), this));
+#if 0
+        update      = brp->add(new StaticTextButton(N_("Update"), this));
+#endif
+        help        = brp->add(new StaticTextButton(N_("Help"), this));
+        quit        = brp->add(new StaticTextButton(N_("Quit"), this));
+        
         int ly = vminfo->width - 5 - 35*(NUMENTRIES(nls::languages) - 1);
         //BuildHList l(this, Rect(ly, (vminfo->height) - 30, 30, 20), 5);
         BuildHList l(this, Rect(ly, 10, 30, 20), 5);
@@ -283,10 +414,13 @@
             case SDL_KEYDOWN:
                 SDLKey keysym = e.key.keysym.sym;
                 switch (keysym) {
-                case SDLK_F2:     
-                    show_paths();
+                case SDLK_F1:
+                case SDLK_F2: {
+                    MainHelpMenu m;
+                    m.manage();
                     invalidate_all();
                     return true;
+                }
                 default:
                     break;
                 }
@@ -297,16 +431,17 @@
 
     void MainMenu::on_action(Widget *w) 
     {
-        if (w == m_startgame) {            
+        if (w == startgame) {            
             LevelPackMenu m;
             m.manageLevelMenu();
-        } else if (w == m_levelpack) {
+        } else if (w == levelpack) {
             LevelPackMenu m;
             m.manage();
-        } else if (w == credits) {
-            displayInfo(credit_text, 6);
         } else if (w == options) {
             ShowOptionsMenu(0);
+        } else if (w == help) {
+            MainHelpMenu m;
+            m.manage();
     
     #ifdef ENABLE_EXPERIMENTAL
         } else if (w == m_netgame) {
@@ -340,78 +475,6 @@
             invalidate_all();
         }
     }
-        
-    void MainMenu::show_paths() {
-        const char *pathtext[25];
-        std::string pathstrings[25];
-        std::string work;
-        Font *menufont = enigma::GetFont("menufont");
-        const video::VMInfo *vminfo = video::GetInfo();
-        int width = vminfo->width - 80;
-        int i = 0;
-        
-        pathtext[i++] = N_("Preferences Path:");
-        work = app.prefPath;
-        do {
-            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
-            pathstrings[i] = "    " + work.substr(0,breakPos);
-            pathtext[i] = pathstrings[i].c_str();
-            work = work.substr(breakPos);
-            i++;
-        } while(!work.empty() );
-        pathtext[i++] = " ";
-        pathtext[i++] = N_("User Path:");
-        work = app.userPath;
-        do {
-            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
-            pathstrings[i] = "    " + work.substr(0,breakPos);
-            pathtext[i] = pathstrings[i].c_str();
-            work = work.substr(breakPos);
-            i++;
-        } while(!work.empty() );
-        pathtext[i++] = " ";
-        pathtext[i++] = N_("User Image Path:");
-        work = app.userImagePath;
-        do {
-            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
-            pathstrings[i] = "    " + work.substr(0,breakPos);
-            pathtext[i] = pathstrings[i].c_str();
-            work = work.substr(breakPos);
-            i++;
-        } while(!work.empty() );
-        pathtext[i++] = " ";
-        pathtext[i++] = N_("System Path:");
-        work = app.systemFS->getDataPath();
-        do {
-            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
-            pathstrings[i] = "    " + work.substr(0,breakPos);
-            pathtext[i] = pathstrings[i].c_str();
-            work = work.substr(breakPos);
-            i++;
-        } while(!work.empty() );
-        pathtext[i++] = " ";
-        pathtext[i++] = N_("Resource Paths:");
-        work = app.resourceFS->getDataPath();
-        do {
-            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
-            pathstrings[i] = "    " + work.substr(0,breakPos);
-            pathtext[i] = pathstrings[i].c_str();
-            work = work.substr(breakPos);
-            i++;
-        } while(!work.empty() );
-        pathtext[i++] = " ";
-        pathtext[i++] = N_("L10n Path:");
-        work = app.l10nPath;
-        do {
-            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
-            pathstrings[i] = "    " + work.substr(0,breakPos);
-            pathtext[i] = pathstrings[i].c_str();
-            work = work.substr(breakPos);
-            i++;
-        } while(!work.empty() );
-        pathtext[i++] = 0;
-        displayInfo(pathtext, 1);
-    }
     
 /* -------------------- Functions -------------------- */
     

Modified: trunk/src/gui/MainMenu.hh
===================================================================
--- trunk/src/gui/MainMenu.hh	2009-07-06 23:13:15 UTC (rev 1747)
+++ trunk/src/gui/MainMenu.hh	2009-07-07 22:53:17 UTC (rev 1748)
@@ -1,5 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004,2005,2006 Daniel Heck
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -41,22 +42,49 @@
         void on_action(Widget *w);
 
         // Private methods.
-        void show_paths();
         void build_menu();
 
         // Variables.
-        Widget *m_startgame;
-        Widget *m_levelpack;
+        Widget *startgame;
+        Widget *levelpack;
         Widget *m_netgame;
         Widget *leveled;
-        Widget *manual;
         Widget *options;
-        Widget *credits;
+        Widget *update;
+        Widget *help;
         Widget *quit;
         Widget *lpack;
         std::vector <Widget*> language;
     };
 
+/* -------------------- MainHelpMenu -------------------- */
+        
+    class MainHelpMenu : public gui::Menu {
+    public:
+        MainHelpMenu ();
+        ~MainHelpMenu ();
+    private:
+        // ActionListener interface.
+        bool on_event (const SDL_Event &e);
+        void on_action(gui::Widget *w);
+
+        // Menu interface.
+        void draw_background(ecl::GC &gc);
+        void tick(double dtime);
+
+        // Private methods.
+        void showPaths();
+
+        // Variables.
+        gui::Widget *homepage;
+        gui::Widget *docs;
+        gui::Widget *paths;
+        gui::Widget *autofolder;
+        gui::Widget *scorefolder;
+        gui::Widget *credits;
+        gui::Widget *back;
+    };
+
 /* -------------------- NetworkMenu -------------------- */
         
     class NetworkMenu : public gui::Menu {
@@ -73,7 +101,7 @@
         void tick(double dtime);
 
         // Variables.
-        gui::Widget *m_startgame;
+        gui::Widget *startgame;
         gui::Widget *m_joingame;
         gui::Widget *m_back;
     };

Modified: trunk/src/main.cc
===================================================================
--- trunk/src/main.cc	2009-07-06 23:13:15 UTC (rev 1747)
+++ trunk/src/main.cc	2009-07-07 22:53:17 UTC (rev 1748)
@@ -1,5 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004,2005 Daniel Heck
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -496,6 +497,17 @@
          systemFS->prepend_dir(systemCmdDataPath);
     Log << "systemFS = \"" << systemFS->getDataPath() << "\"\n"; 
     
+    // docPath
+    docPath = DOCDIR;    // defined in src/Makefile.am 
+#ifdef __MINGW32__
+    if (progDirExists) {
+        docPath = progDir;
+    }
+#elif MACOSX
+    docPath = progDir + "/../Resources/doc";
+#endif
+    Log << "docPath = \"" << docPath << "\"\n"; 
+    
     // l10nPath
     l10nPath = LOCALEDIR;    // defined in src/Makefile.am
 #ifdef __MINGW32__

Modified: trunk/src/main.hh
===================================================================
--- trunk/src/main.hh	2009-07-06 23:13:15 UTC (rev 1747)
+++ trunk/src/main.hh	2009-07-07 22:53:17 UTC (rev 1748)
@@ -1,5 +1,6 @@
 /*
  * Copyright (C) 2003,2004 Daniel Heck
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -130,6 +131,11 @@
         std::string prefPath;
         
         /**
+         * the path to the documentation. 
+         */
+        std::string docPath;
+        
+        /**
          * the path to the gettext l10n data. 
          */
         std::string l10nPath;



From ral at mail.berlios.de  Thu Jul  9 01:34:05 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Thu, 9 Jul 2009 01:34:05 +0200
Subject: [Enigma-game-svn] r1749 - in trunk: doc/reference
	lib-src/enigma-core src/gui
Message-ID: <200907082334.n68NY5BQ016830@sheep.berlios.de>

Author: ral
Date: 2009-07-09 01:33:50 +0200 (Thu, 09 Jul 2009)
New Revision: 1749

Modified:
   trunk/doc/reference/enigma-ref.texi
   trunk/lib-src/enigma-core/ecl_system.cc
   trunk/src/gui/MainMenu.cc
Log:
Trunk 1.1: 
- refman: multilevel description
- fix 1748 for Windows and local urls


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-07-07 22:53:17 UTC (rev 1748)
+++ trunk/doc/reference/enigma-ref.texi	2009-07-08 23:33:50 UTC (rev 1749)
@@ -1345,9 +1345,11 @@
 * Internationalization (i18n)::
 * Usage::
 * Update and Upgrade::
-* Using Libraries::
+* Library Files::
+* Multilevel Files::
 @end menu
 
+ at c ----------------- Getting Started with Levels --------------------
 @node Getting Started with Levels
 @section Getting Started with Levels
 
@@ -1465,6 +1467,7 @@
 based level metadata.
 
 
+ at c ----------------- XML Level structure --------------------
 @node XML Level structure
 @section XML Level structure
 
@@ -1623,6 +1626,7 @@
 
 @end table
 
+ at c ----------------- Info metadata --------------------
 @node Info metadata
 @section Info metadata
 
@@ -1651,7 +1655,7 @@
 @b{Attributes:}
 
 @table @asis
- at item @b{type}, @i{required}, values = ``level'', ``library'', ``multilevel''
+ at item @b{type}, @i{required}, values = @code{"level"}, @code{"library"}, @code{"multilevel"}
 You may use the schema for single Enigma levels, libraries that contain level
 description parts for reuse, and descriptions for multiple levels at once.
 
@@ -1660,18 +1664,18 @@
 use.
 
 @samp{library} are level description parts that may be included in levels.
-The library may consist simply of Lua code in the luamain node, or additional object
-descriptions in the elements node. Libraries may make use of nearly all nodes besides
-the @samp{/level/protected/info/score} and @samp{/level/*/i18n}, which both must be
-provided, but will not be evaluated. Libraries are included in levels via
-the dependency node-element. See @ref{<compatibility>}.
+ at ref{Library Files} consist simply of Lua code in the luamain node. Libraries
+may make use of nearly all nodes besides the @samp{/level/protected/info/score}
+and @samp{/level/*/i18n}, which both must be provided, but will not be evaluated.
+Libraries are included in levels via the dependency node-element. See
+ at ref{<compatibility>}.
 
 @samp{multilevel} are descriptions for multiple levels at once. The main purpose
 is to support foreign game level formats, like the Sokoban level format, which
-usually describes a whole set of level maps in a single file.
+usually describes a whole set of level maps in a single file (@pxref{Multilevel Files}).
 
 @item @b{quantity}, @i{optional}
-The number of levels contained in a multilevel file.
+The number of levels contained in a multilevel file (@pxref{Multilevel Files}).
 
 @end table
 
@@ -2295,6 +2299,7 @@
 limited to pure US-ASCII. The benefit is that you can use Umlauts and
 other non-ASCII characters within it-document hints.
 
+ at c ----------------- Internationalization (i18n) --------------------
 @node Internationalization (i18n)
 @section Internationalization (i18n)
 
@@ -2426,6 +2431,7 @@
 contains at least one mistake, the translator will correct it, as shown in the @samp{msgstr}
 string.
 
+ at c ----------------- Usage --------------------
 @node Usage
 @section Usage
 
@@ -2573,8 +2579,9 @@
 use this element for the same purpose, with the same syntax, without modifying the author's
 protected section.
 
- at node Using Libraries
- at section Using Libraries
+ at c ----------------- Library Files --------------------
+ at node Library Files
+ at section Library Files
 
 Libraries are collections of Lua functions for reuse in many levels. To use a library, you must
 declare it as a dependency, as described in @ref{<compatibility>}. Preloading the library is all
@@ -2660,7 +2667,65 @@
 number addition will be loaded for XML load requests, too. Yet the future belongs to the new
 naming scheme, and every new library should follow it from the beginning.
 
+ at c ----------------- Multilevel Files --------------------
+ at node Multilevel Files
+ at section Multilevel Files
 
+Another concept of code reusage besides @ref{Library Files} are multilevel files.
+The code contained in a single file generates several levels, called sublevels,
+that appear as autonomous levels in a levelpack. Of course this concept is much
+less flexible than the library concept as other level files can not reuse the 
+code. But you can write a multilevel if you wrote a lot of specific code for a 
+complex level that provides more than just two variants, which would be 
+otherwise presented as @samp{difficult} and @samp{easy} @ref{<modes>}.
+
+But the main reason for multilevel files is the support of foreign game level
+formats like Sokoban, which describe a whole set of levels in a single file.
+Enigma imports these original files with just a few lines of code. It would be
+inefficient, even though being possible, to write an Enigma level stub for
+every level imported from a single foreign file.
+
+But multilevel files have some restrictions. They use a single set of XML
+level metadata. Thus these metadata must fit to all levels. The 
+ at ref{<version>} will be identical as it reflects either the code version of the
+native level or the version of the imported foreign file. But the other data
+like @ref{<author>}, @ref{<compatibility>} and @ref{<modes>} have to match, too.
+If they do not, you can not use a multilevel file.
+
+Just the values for @samp{title} and @samp{id} will and have to differ for all
+levels described by a single multilevel file. There exists special support for
+multilevels to handle these attributes.
+
+Let us look at all attributes and features of multilevels that differ from
+standard level files.
+
+First you have to declare in the @ref{Info metadata} element the type as 
+ at code{"multilevel"} and to provide the quantity of generated levels. The 
+sublevels will be numbered from 1 to the given quantity.
+
+In the element @ref{<identity>} you have to provide just one unique level id 
+value. Enigma will automatically append the string @code{"[1]"} for the first
+sublevel, @code{"[2]"} for the second and so on. Thus every sublevel has an
+unique id. 
+
+Additionally you should provide base title for the levels in this metadata
+ at ref{<identity>} element. If your title ends with a hash @samp{#} sign Enigma
+will autogenerate titles for the sublevels by appending the sublevel number to
+the given common title string.
+
+For individual sublevel titles the @ref{LUA code} has to provide the titles.
+The title in the @ref{<identity>} element may not end on a hash sign and will
+only be used as a default title base in case the @ref{LUA code} fails to
+provide a sublevel title. Prior execution of the Lua code the global
+attribute @ref{SublevelNumber} gets initialized. The Lua part has either way to
+load the appropriate sublevel based on this number. Now it has additionally to
+set the second special multilevel global attribute @ref{SublevelTitle}.
+
+
+ at ref{<compatibility>} externaldata
+
+
+
 @c ===================  Paradigm  =======================
 @node Enigma Paradigm
 @chapter Enigma Paradigm
@@ -8816,6 +8881,8 @@
 * RubberViolationStrength::
 * ShowMoves::
 * SlopeStrength::
+* SublevelNumber::
+* SublevelTitle::
 * SurviveFinish::
 * SwampSinkTime::
 * WaterSinkTime::
@@ -9272,6 +9339,38 @@
 @item @b{Support:} @ @ @ref{fl_slope}
 @end table
 
+ at node SublevelNumber
+ at subsection SublevelNumber
+
+A global variable that is only used by @ref{Multilevel Files}. It contains the
+number of the sublevel that should be loaded and played. The number is preset
+to a value between @code{1} and the @samp{quantity} given in the 
+ at ref{Info metadata}. 
+
+ at table @asis
+ at item @b{Type:} @ @ int
+ at item @b{Values:} @ @ positive integer numbers
+ at item @b{Default:} @ @ @code{1}
+ at item @b{Access:} @ @ read only
+ at item @b{Support:} @ @ no objects
+ at end table
+
+ at node SublevelTitle
+ at subsection SublevelTitle
+
+A global variable that is only used by @ref{Multilevel Files}. If the sublevel
+provides an individual title this variable must be set on level load to the
+title string. An empty string value causes an auto generated title based on
+the title given in the @ref{<identity>} element and the @ref{SublevelNumber}.
+
+ at table @asis
+ at item @b{Type:} @ @ string
+ at item @b{Values:} @ @ any string
+ at item @b{Default:} @ @ @code{""}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ no objects
+ at end table
+
 @node SurviveFinish
 @subsection SurviveFinish
 

Modified: trunk/lib-src/enigma-core/ecl_system.cc
===================================================================
--- trunk/lib-src/enigma-core/ecl_system.cc	2009-07-07 22:53:17 UTC (rev 1748)
+++ trunk/lib-src/enigma-core/ecl_system.cc	2009-07-08 23:33:50 UTC (rev 1749)
@@ -113,7 +113,7 @@
 bool ecl::BrowseUrl(const std::string url) {
     bool result = true;
 #ifdef __MINGW32__
-    result == (ShellExecute(NULL, "open", url.c_str(), NULL, NULL, SW_SHOWNORMAL) >= 32);
+    result == ((int)ShellExecute(NULL, "open", url.c_str(), NULL, NULL, SW_SHOWNORMAL) >= 32);
 #elif MACOSX
     CFStringRef cfurlStr = CFStringCreateWithCString( NULL, url.c_str(), kCFStringEncodingASCII);
 
@@ -135,7 +135,7 @@
 bool ecl::ExploreFolder(const std::string path) {
     bool result = true;
 #ifdef __MINGW32__
-    result == (ShellExecute(NULL, "explore", path.c_str(), NULL, NULL, SW_SHOWNORMAL) >= 32);
+    result == ((int)ShellExecute(NULL, "explore", path.c_str(), NULL, NULL, SW_SHOWNORMAL) >= 32);
 #elif MACOSX
     CFStringRef cfurlStr = CFStringCreateWithCString( NULL, path.c_str(), kCFStringEncodingASCII);
 

Modified: trunk/src/gui/MainMenu.cc
===================================================================
--- trunk/src/gui/MainMenu.cc	2009-07-07 22:53:17 UTC (rev 1748)
+++ trunk/src/gui/MainMenu.cc	2009-07-08 23:33:50 UTC (rev 1749)
@@ -246,7 +246,7 @@
         if (w == homepage) {
             ecl::BrowseUrl("http://www.enigma-game.org");            
         } else if (w == docs) {
-            ecl::BrowseUrl(app.docPath + "/index.html");
+            ecl::BrowseUrl("file://" + app.docPath + "/index.html");
         } else if (w == paths) {
             showPaths();
         } else if (w == autofolder) {



From raoulb at bluewin.ch  Sat Jul 11 22:00:28 2009
From: raoulb at bluewin.ch (Raoul)
Date: Sat, 11 Jul 2009 22:00:28 +0200
Subject: [Enigma-game-svn] r 1750
Message-ID: <20090711220028.1d886142@amarok.loinet.zh>

-> New extralife item images and sources
-> Extralife dispenser stone images, sources and code
-> Puzzlestone images splitted
-> Merged fl-normal images into fl_metal.png
-> Removed support for extralife special inventory models
-> Fixed model bug with some st-magic*
-> Fixed a few gfx bugs (pink borders etc)


From ral at mail.berlios.de  Sun Jul 12 00:35:09 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 12 Jul 2009 00:35:09 +0200
Subject: [Enigma-game-svn] r1751 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 doc/reference doc/reference/images src/stones
Message-ID: <200907112235.n6BMZ9pn008679@sheep.berlios.de>

Author: ral
Date: 2009-07-12 00:35:03 +0200 (Sun, 12 Jul 2009)
New Revision: 1751

Added:
   trunk/data/gfx32/ac_bug.png
   trunk/data/gfx32/ac_horse.png
   trunk/data/gfx32/ac_marble_black.png
   trunk/data/gfx32/ac_marble_white.png
   trunk/data/gfx32/ac_pearl_white.png
   trunk/data/gfx32/ac_rotor.png
   trunk/data/gfx32/ac_top.png
   trunk/data/gfx32/fl_slope.png
   trunk/data/gfx32/fl_wood.png
   trunk/data/gfx32/fl_wood_framed.png
   trunk/data/gfx32/st_disco.png
   trunk/data/gfx32/st_door_b.png
   trunk/data/gfx32/st_door_d_ew.png
   trunk/data/gfx32/st_door_d_ns.png
   trunk/data/gfx32/st_flat_break.png
   trunk/data/gfx32/st_mail.png
   trunk/data/gfx32/st_monoflop.png
   trunk/data/gfx32/st_shogun.png
   trunk/data/gfx32/st_timer.png
   trunk/data/gfx40/ac_bug.png
   trunk/data/gfx40/ac_horse.png
   trunk/data/gfx40/ac_marble_black.png
   trunk/data/gfx40/ac_marble_white.png
   trunk/data/gfx40/ac_pearl_white.png
   trunk/data/gfx40/ac_rotor.png
   trunk/data/gfx40/ac_top.png
   trunk/data/gfx40/fl_slope.png
   trunk/data/gfx40/fl_wood.png
   trunk/data/gfx40/fl_wood_framed.png
   trunk/data/gfx40/st_disco.png
   trunk/data/gfx40/st_door_b.png
   trunk/data/gfx40/st_door_d_ew.png
   trunk/data/gfx40/st_door_d_ns.png
   trunk/data/gfx40/st_flat_break.png
   trunk/data/gfx40/st_mail.png
   trunk/data/gfx40/st_monoflop.png
   trunk/data/gfx40/st_shogun.png
   trunk/data/gfx40/st_timer.png
   trunk/data/gfx48/ac_bug.png
   trunk/data/gfx48/ac_horse.png
   trunk/data/gfx48/ac_marble_black.png
   trunk/data/gfx48/ac_marble_white.png
   trunk/data/gfx48/ac_pearl_white.png
   trunk/data/gfx48/ac_rotor.png
   trunk/data/gfx48/ac_top.png
   trunk/data/gfx48/fl_slope.png
   trunk/data/gfx48/fl_wood.png
   trunk/data/gfx48/fl_wood_framed.png
   trunk/data/gfx48/st_disco.png
   trunk/data/gfx48/st_door_b.png
   trunk/data/gfx48/st_door_d_ew.png
   trunk/data/gfx48/st_door_d_ns.png
   trunk/data/gfx48/st_flat_break.png
   trunk/data/gfx48/st_mail.png
   trunk/data/gfx48/st_monoflop.png
   trunk/data/gfx48/st_shogun.png
   trunk/data/gfx48/st_timer.png
   trunk/doc/reference/images/construction.png
Removed:
   trunk/data/gfx32/fg-blackball.png
   trunk/data/gfx32/fg-bug.png
   trunk/data/gfx32/fg-horse.png
   trunk/data/gfx32/fg-rotor.png
   trunk/data/gfx32/fg-top.png
   trunk/data/gfx32/fg-whiteball-small.png
   trunk/data/gfx32/fg-whiteball.png
   trunk/data/gfx32/fl-gradient2.png
   trunk/data/gfx32/fl-stwood.png
   trunk/data/gfx32/fl-wood.png
   trunk/data/gfx32/st-disco.png
   trunk/data/gfx32/st-doorb.png
   trunk/data/gfx32/st-doorh.png
   trunk/data/gfx32/st-doorv.png
   trunk/data/gfx32/st-mail.png
   trunk/data/gfx32/st-shogun.png
   trunk/data/gfx32/st-time1switch.png
   trunk/data/gfx32/st-timer.png
   trunk/data/gfx32/st_flat-break.png
   trunk/data/gfx40/fg-blackball.png
   trunk/data/gfx40/fg-bug.png
   trunk/data/gfx40/fg-horse.png
   trunk/data/gfx40/fg-rotor.png
   trunk/data/gfx40/fg-top.png
   trunk/data/gfx40/fg-whiteball-small.png
   trunk/data/gfx40/fg-whiteball.png
   trunk/data/gfx40/fl-gradient2.png
   trunk/data/gfx40/fl-stwood.png
   trunk/data/gfx40/fl-wood.png
   trunk/data/gfx40/st-disco.png
   trunk/data/gfx40/st-doorb.png
   trunk/data/gfx40/st-doorh.png
   trunk/data/gfx40/st-doorv.png
   trunk/data/gfx40/st-mail.png
   trunk/data/gfx40/st-shogun.png
   trunk/data/gfx40/st-time1switch.png
   trunk/data/gfx40/st-timer.png
   trunk/data/gfx40/st_flat-break.png
   trunk/data/gfx48/fg-blackball.png
   trunk/data/gfx48/fg-bug.png
   trunk/data/gfx48/fg-horse.png
   trunk/data/gfx48/fg-rotor.png
   trunk/data/gfx48/fg-top.png
   trunk/data/gfx48/fg-whiteball-small.png
   trunk/data/gfx48/fg-whiteball.png
   trunk/data/gfx48/fl-gradient2.png
   trunk/data/gfx48/fl-stwood.png
   trunk/data/gfx48/fl-wood.png
   trunk/data/gfx48/st-disco.png
   trunk/data/gfx48/st-doorb.png
   trunk/data/gfx48/st-doorh.png
   trunk/data/gfx48/st-doorv.png
   trunk/data/gfx48/st-mail.png
   trunk/data/gfx48/st-shogun.png
   trunk/data/gfx48/st-time1switch.png
   trunk/data/gfx48/st-timer.png
   trunk/data/gfx48/st_flat-break.png
Modified:
   trunk/data/models-2d.lua
   trunk/doc/reference/enigma-ref.texi
   trunk/doc/reference/images/Makefile.am
   trunk/src/stones/Door.cc
   trunk/src/stones/LaserSwitch.cc
   trunk/src/stones/MailStone.cc
   trunk/src/stones/MonoFlopStone.cc
   trunk/src/stones/ShogunStone.cc
   trunk/src/stones/TimerStone.cc
Log:
Trunk 1.1:
- refman images: support for multiimages, framed floors and other composed
    images
- renaming of images fl-gradient2, fl-wood, fl-stwood, st-mail, st-shogun,
    st-disco, st-timer, st-time1switch, st-door*, fg-*
- refman addition of all remaning object images (more than 300 additions)
- fix broken image st_magic_brick
- add refman entry for st_dispenser_extralife


Copied: trunk/data/gfx32/ac_bug.png (from rev 1748, trunk/data/gfx32/fg-bug.png)

Copied: trunk/data/gfx32/ac_horse.png (from rev 1748, trunk/data/gfx32/fg-horse.png)

Added: trunk/data/gfx32/ac_marble_black.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/ac_marble_black.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Copied: trunk/data/gfx32/ac_marble_white.png (from rev 1748, trunk/data/gfx32/fg-whiteball.png)

Copied: trunk/data/gfx32/ac_pearl_white.png (from rev 1748, trunk/data/gfx32/fg-whiteball-small.png)

Copied: trunk/data/gfx32/ac_rotor.png (from rev 1748, trunk/data/gfx32/fg-rotor.png)

Copied: trunk/data/gfx32/ac_top.png (from rev 1748, trunk/data/gfx32/fg-top.png)

Deleted: trunk/data/gfx32/fg-blackball.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fg-bug.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fg-horse.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fg-rotor.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fg-top.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fg-whiteball-small.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fg-whiteball.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-gradient2.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-stwood.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-wood.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/fl_slope.png (from rev 1748, trunk/data/gfx32/fl-gradient2.png)

Added: trunk/data/gfx32/fl_wood.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/fl_wood.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Copied: trunk/data/gfx32/fl_wood_framed.png (from rev 1748, trunk/data/gfx32/fl-stwood.png)

Deleted: trunk/data/gfx32/st-disco.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-doorb.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-doorh.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-doorv.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-mail.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-shogun.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-time1switch.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-timer.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/st_disco.png (from rev 1748, trunk/data/gfx32/st-disco.png)

Copied: trunk/data/gfx32/st_door_b.png (from rev 1748, trunk/data/gfx32/st-doorb.png)

Added: trunk/data/gfx32/st_door_d_ew.png
===================================================================
--- trunk/data/gfx32/st_door_d_ew.png	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/data/gfx32/st_door_d_ew.png	2009-07-11 22:35:03 UTC (rev 1751)
@@ -0,0 +1,7 @@
+?PNG
+
+
+?B??N
+?#C??????`??pK2P????9P???
+'???????Uj[???(?=i|???Z=i?]??w:Z??g???bC?p#|?@?([???80??????X??????*?A_??(?\m????????,?@(a?l!T??	??)????-?<4k?%u?e`?-eo???????f[9?6({,?@??????T??q?d:?5?,?4'?>???????d:ppBb{?h5?J}k9?8??@???9P???????o`&??M??gN?e2C?
+?O?????H?]d?,??Z??|R?w)27i8@????_j1?2j
\ No newline at end of file

Added: trunk/data/gfx32/st_door_d_ns.png
===================================================================
--- trunk/data/gfx32/st_door_d_ns.png	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/data/gfx32/st_door_d_ns.png	2009-07-11 22:35:03 UTC (rev 1751)
@@ -0,0 +1,11 @@
+?PNG
+
+
+???O?So?????{????t?~????[W???\?v/~??y?????q??y?????
+S????;???
+@?T'`?S8$???9H3^???p??7.O?m???P?`3@H
+W??C??1???EAC??X?????}?%???;?????5? ??Q?>???Pk
+6Yw0T/??2k??o????I(?zU1K} $??
+??W????c(??'?jJ??h4:#}??~????????h??4?-????????a????*?!?.??:?_]@m?cf?????X?s?r?et?X??????????ZE???	 $??
+	/2?j?????	?~u>k"H?u
+?X3????#2??g0E?1?
\ No newline at end of file

Deleted: trunk/data/gfx32/st_flat-break.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/st_flat_break.png (from rev 1748, trunk/data/gfx32/st_flat-break.png)

Copied: trunk/data/gfx32/st_mail.png (from rev 1748, trunk/data/gfx32/st-mail.png)

Copied: trunk/data/gfx32/st_monoflop.png (from rev 1748, trunk/data/gfx32/st-time1switch.png)

Copied: trunk/data/gfx32/st_shogun.png (from rev 1748, trunk/data/gfx32/st-shogun.png)

Copied: trunk/data/gfx32/st_timer.png (from rev 1748, trunk/data/gfx32/st-timer.png)

Copied: trunk/data/gfx40/ac_bug.png (from rev 1748, trunk/data/gfx40/fg-bug.png)

Copied: trunk/data/gfx40/ac_horse.png (from rev 1748, trunk/data/gfx40/fg-horse.png)

Added: trunk/data/gfx40/ac_marble_black.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/ac_marble_black.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Copied: trunk/data/gfx40/ac_marble_white.png (from rev 1748, trunk/data/gfx40/fg-whiteball.png)

Copied: trunk/data/gfx40/ac_pearl_white.png (from rev 1748, trunk/data/gfx40/fg-whiteball-small.png)

Copied: trunk/data/gfx40/ac_rotor.png (from rev 1748, trunk/data/gfx40/fg-rotor.png)

Copied: trunk/data/gfx40/ac_top.png (from rev 1748, trunk/data/gfx40/fg-top.png)

Deleted: trunk/data/gfx40/fg-blackball.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fg-bug.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fg-horse.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fg-rotor.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fg-top.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fg-whiteball-small.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fg-whiteball.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-gradient2.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-stwood.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-wood.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/fl_slope.png (from rev 1748, trunk/data/gfx40/fl-gradient2.png)

Copied: trunk/data/gfx40/fl_wood.png (from rev 1748, trunk/data/gfx40/fl-wood.png)

Copied: trunk/data/gfx40/fl_wood_framed.png (from rev 1748, trunk/data/gfx40/fl-stwood.png)

Deleted: trunk/data/gfx40/st-disco.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-doorb.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-doorh.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-doorv.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-mail.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-shogun.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-time1switch.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-timer.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/st_disco.png (from rev 1748, trunk/data/gfx40/st-disco.png)

Copied: trunk/data/gfx40/st_door_b.png (from rev 1748, trunk/data/gfx40/st-doorb.png)

Added: trunk/data/gfx40/st_door_d_ew.png
===================================================================
--- trunk/data/gfx40/st_door_d_ew.png	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/data/gfx40/st_door_d_ew.png	2009-07-11 22:35:03 UTC (rev 1751)
@@ -0,0 +1,31 @@
+?PNG
+
+
+/-??!?
+?????p?i?q???;??????w????????mD?%??? B?:?2DQ?????6????????.??r2?JK?;<[?D??=???[Q??;w?D?y??%?a5???????"??y?{?????????6?o?.??Cz>?o!?5B?#????k?U??x??z??dDUW?UEP??e?Q?u|7??I?_d??pc$i?!Zo??????-n?5X??_!?o??F??????F?-F_`1c????<??(???]???:=??2?3Z????t5???QJ?3??.?eFg+?I?l?dYE,?&Q9Bu?E?c??"??f???????jB)??i????????}????Q?23?C-7p?E!?.?Zk?V?L=G??bG?x??Z[??,>WY??Y?9??9'????l?U?<e{i?}?`?Em????
+Q???9?
+<?;m?v?????=??????[?	?5?????????L?O&s????????:???PM%???a?m????/?$+?t??n????/^(?lt;lucJ!(??v?????R?t??n[_??*t?9???<???c?1???"n??R,??v?K???\U??R? ??#r'?????5?????t^???z???>???h?y??#??:3?*+???9%,?B????]???T???????5?@??s??????K??+????s[?%?1?g??ZK???"]?($^???u??KN1??`???>?p?????V?A?::?%?3aL??@
+??ls??D??u?[????=d/?7?????UY=e??i??\d?"{??????7o?`?????{7?8????|:?????????]0x"?.?*Jf??Y?s?e???I{????zF??1??r??8+???M??*s???!?k????51a??A??@? ????^??
+?e???	B?&????????$)?d????$G4\
+?
+??????Vs\5???h???e?#???>i	[h??J???
+_???o?????(?lTk,F?T???? ??C?jS(???5?$??u??????8?N?}	qI9LI?M?????"'??xWxeE???L????g??P2F???y???Z????'.?k????g>??O?????K???????? j?kE??f??a7?~?%:??T?*yF??^e?-????/-y?s~???"?'T0/rLip*C[E?4??????X_i???3?\Q	A?BT?`?!I{?J?????]? ??JG?B^??'Pc??J*??H*???Dq???2M??-B??$-)???tx???R?Y????1???$+n>?:?T-7?6????N??c?dU??e?!!???d??|ddq?Q???JTU???Ew???0!?????D?Jd???????7h?nP[M??????????=2??~d??f????uL?}??W?<???????3??????i ???-??k??!??~???z?[?I??b???2?wP?F?)UQ??T|7?=`<P&?eq?I??6??U?Sg?<OT????p???!?EF?-?D?R???????D?nw?N?X?PZ3???	?2??ZAQf?????~??<?(??B?S???}??Y#?+B?X7Xp'??Y?c?.?2?w2-z??? ??=?y'????92?4;?1?e?(?#?e?2????????DH7X?|?I????!I]~??n???Z?G?n???????f???z??u????x?K?j???O/}?-?U?(U??u??4?X?????
+??/u??0????B[?^???_vYd#?	I??!???????D????#
+???Z8?@!???
+?d???Ei???A?E?`4Q????,??p?????M<g ?}l?K;?M??????4&??q??9?1k?'??c/????8rV??5??Eio??(0???)?#??k??????2?F??Q??"]I5?>0J%?Q?|?x.?:?C?N,g?O????UY\K|/????*?????|?=1??J8?1?Y(?G??X??NuD?tz????r?q0????V5???Qb??c??1J)z-U???7??4??Ww ??PY???c?????d?X]e??1JV?	Z7C??????S[???V??F??????w?~T??H???x2????z?vXU?QU?u??9????;q?	8??(0?????x?m???r??????=???J]??{?qH????t	<????4?{?J1??????^??????bq?q?]K???2/??? ?Z??I??????DF???h???-/????L?KUN1O???7??<??y?Bau]??N ?????oRd?S????.f?*#?%????Vs??????`??h?????K?|L??&D?B?a??5?oZt??9J??DY*!?DqR`?<????????|M<????O???h?\z8????D?U??z????N?H^????&???]?2????????????^???9y??,,??($U??A?K???KX?2%?"?"?(jA?Xm?zF???U????\@W*L??B?W!9?E?5jS`?E?P?;??JF$^???????QW%??6?D?IuIV????T-u@?-J???]????{????X???','???g??|??-?????K-?v?0?5lq at Q??????L?K?92+??
+???????.s?h?CP?]????)?+,??0????t?1?W??CM??????????fc0??	??^G??r????V?%c?N?@?6???9??e,?4?'?F
+?*IQ6D??N0JI?????u???Z??nwQ??UThco1$??$?K??P+;?:??e4/????]??y?????h????@???9???}???2?H?????9u?5o??/X?/????]c?i???$? ?e?S??<?J#???K???|?????|?BF??
+?7??U??p?p???WK?????S?F{?I??????????TH??'?\??S??:a?b1????-I???????|`n??+?pv?t?@)?????</???ar7??"??@h?tAu?kB????zA?_aQtXm???(????"?[$????	?+???c?}"? |?f;??l?b?@???b?X?{	Z??????????????/>??????04:??W???(I?G??o?.???SO^9*????;??/3??b??1?U?-?h>??|???o???:?q?x?#??H??aH?c?b??W???1s???f?? pB??S	???D?
+I?_?????!y?}?H?V?SW??%g??ut^???V??2???q??J?J]1???????>?w???a?????wXc~???K2??d|D????_???q?<???????????\?i:GJ?'??N?m??c??????'?.W?1y?A?p???z<???=???eS??#?{o<??????D?EV@:???]?N
+??N?M???{o\?????x???? _?????????&?#?{?F????r?+{\K???????w????7=?F?xU??\??k????R?G<O>B???,7?,??#?w?spc?
+??N?M4????g?G{B?Z????.??EzU?????3?G?%M?E?R??oy?QuM?jclFo?M?E?xx?4?1??+[{???FCz???e@?v?:)bk???@??????y??>??w=|???o?<?OI??????G???C?>?{?u2??=?zc>?|??sw?]?j?xZS?9C??0]??????????K??e??~?????m6?????zD???V8$?P??r??v<????????=F?w??5`??????d?K?????a??	????'??w?6??????
+?j???[??J'.?9u?+???????y^???????F:???V???n?1??pq???$m???U:?Y?q??B?;????}^?????X?d?Q??JPT Z=????9?k??????g???P9??le??????????~p?q??r6{k(??j??,S?2EU??2?E??;n;?R??A??6?????o?F?s???$?a?"?????:B???????td?a???Mm3??u6?:?^8?-q??F/???}??+??????e??????{W?q???</?s!????gm?h?^??:?L????R???O}?????-agI?IY%?U??x??(?TU?Q?G??s???mp???3?!??J???o?v????B????????@6<?n?JY?R6?k:f)?Y?ag???q??n@??J)=????t?g3z?:m??a?N?O^?,?))?,?????N.?????t??"?>???Z-?????n)??????>?YH???h??????a?
+k?E??QZ?ahR~??19???d2?%?w}/u?	%=7a?????(??(??-l???????@??????2ug??CZi???&?`??F?mrd?"?U?M????%?+??T?|?17G?8?,5[6?rX?????`???g~??<a?|W???+????	Ein??N?????o?U?s0??????.~??.<?ei?????0t]??\?w????i?%)i?`????x
+???r? :Fz>???????gy???t?1??????z??????jxL&#R?f?<???5????k???PQ???c??????^?X'?H?????S8v??.#?%m?``.???	x?b5/%R??????-??5s?R????u?q??[R???F?>n?c?R?'?7??1
+c?-??7??l??8XB_rz??xr?Q5'TC???????x???s??:??c??f????D??"_?6+\+???v???)???<~?x?????,???@??N1?A???qLP? j?? %B?Q??c\o??E???<??S?V?C??[L?8??#2?U9???y?eQ?T????_@??H	D?$\#??~?????,?.????=?3??}?[????O??	???R???????????9????m????????????????R?????E?
+0?R:???H?r??)??I?[???????\z?*_??X?|?^???R????????
+oO?????~?????	HY??$e?{?????f??,??!(???????gw^sH)?G?<??Eo=?????uBR?~???Q?2??^/Z?} ??$??L??@?c???S?x???]??C6??$?u???O4\b6?1?Y??P?e??<$????k?z?U?S???w??L(tC\????*??"U]??x??????#9WQ?A?k`^@?p>??#A???+?O?}??E@???R?S???,D??Zle?t?tuY??f?i??e9u???9??Sc??t?/???n?' e;e??????W ??kC??6[#???S?&?????R??#?4Bk|u?zV?L?	?N1K#???????c?r?p??j?r??3)??Y/??Z??VUM??Q?eZ?~?C?s\????JY?JQk?7?u?C?/??mr?!??@%#???qR??h??R?B?<C!-?&F??h???????w?H~???T?YE????f;?;?K?zA????]?0Y?l???+)???d?P>?t?????	4???1???yv?*
+lYPd	]?RZ???7?t{R??71?5??&+?|??????es?B?cww??KI?????????Y?)fs???V?Qg?K??_?MF???j	?i?D?s??%4+N?????
+?**r8S??Zqi2????x???5=?!o?_?\?;???0?O???h????uO??IbI??`?
+Qg?? ?9NH????????*??p<??
+Lx;??1I???&/????<)1???Qw??J?c??KdY??????eI??
\ No newline at end of file

Added: trunk/data/gfx40/st_door_d_ns.png
===================================================================
--- trunk/data/gfx40/st_door_d_ns.png	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/data/gfx40/st_door_d_ns.png	2009-07-11 22:35:03 UTC (rev 1751)
@@ -0,0 +1,33 @@
+?PNG
+
+
+
+?CfS
+0
+?k??sj!|?l:?V?9	?,bu?'???p
+???b?9*?4?h?t???????JR?_b?{O??w??(???????iz$?]?p??e??)?=	??/`u?Dd??}?!/?j?zF_??V?????{?._-??;88|???VV??????D^??-????{????N???????w?????????????~?:&Dq?|??sx??,R?4?w???????z??G?g???????????l:?x???Y{??s?Y;??DzL@?7
+?????<D?EoS?a2?`??????[?????*????m???N??a?;??_??,R?????5??????9t??0??2?o?X=?~??+c??>:?????!&z?R?s?????I??r_*|?????rA?h??~?S+?@??OO1?h???????\?????9??c??(?oi???Q???i??d+??W)uI??'????TvB?,m+????GUU}??????>l-????|,o??`2g?B(}r????#??{(??c?~????d??????O??p?????????DU?tm??????O?$Y?HE??8??-]???8N>c??,?????O???,Y?d??%K?,Y?d?_L?O???t8??l?wg?J????W???????:?Iy???^w????U?8 at J?|?z?d:9aV??"EL?9T???????t2???????H??A? ????	mOZ\?????9?s?I??_?/????l????????l%???~c}2?|qm??c&9????H??H?f?&H?b| ?,?????(?)????j???d??
+9G?>????JP?R??Z??
+d;??!???999Bi????@+{+????9??'Xi?:B????^??&/??a?XB????4?????@$?4?_???s??)g??d??L??g???Q??{?P?a???????>?lv???Ef??8?oi???2??8??W=????.z|?,ZA???W'????5???<?R?G?z^????ni?r??S???^??????_#?#????1?????8??6gq?}???~????????EQ??/??o?????W???T??????????Y?p2f#???6B?|??{??h?i<!p?1?4X????????N(???s?????g??????????9m?ZGOje??G.P??????????	r{{?e?8Dz???????s??%?????? ??w+?V?S???????h??JS5s??????m????.$??l?	?+??????!KGt]????V6
+2?S?5I? ???[:U?????1??F??Q??@?46??-u}S'$?@?>?:|??????c???????A:???????4???\9???E?j-6????:"nl2DZ??C}?kE????????."????1?x?e???????+?M???x??d??'G?1r?????7?8?
+?)BE?|1?/??d2C??????!]?N?~*!?V?????}?G????@?????b?bJ????.b?;?GY?F?????R?]U7???j??yz&?<??}z??q:????3d=??????R?????"??<T?B???h?3???=??S???<?;?????;?~???y?R???"pDaH?S?V?|??[RP5?1?V???b??v?S!+??!\}???%??x??#??,}?????????w?????3w??????QV?TO??3n3?S??'?-??b????"?w??Q{?^???4M{?h???????x??????l?o?uG???r}e~?^(jok%z?*Q? ?????A`9?N?vkt.C???}]???m8??? a???l
+????U????	ah8??1?B??+?(Z???+???RV ?? ?v??F??PLg4m??^??NU?D? [[a?????e[???Z2??Jz?F?????c??lh?St2??z???U????	?\]}?i?;2%r???h?VM??N?b;?VC??????Q.??r?2s?O?????-?/?????~??N??a-??????px_?t???????????N=?jr?P???3??*?^??dC29 ?2??d??????,?0*?X?u?]qL~????d??,?|?F??f????%K?,Y?d??%K?,Y???"???/??:u
+??f?%\?G??K??9?2?????f??sG?(A?!??????+y??f??w??p?c<?i?B-P?!^?D??%??FY??8&???????nI?$`?"?
+NN????8????x??@???1?cz??L????(Ox??C???????8??k?EM5???>"?@09??i?f???5!??????Y'i?????????X??B?E???]?dV3/?g#???^?w??\??i??O/?/\?1??????8?p?U?g8B??F??A????SX;$@R????1???	???????w?;1~??????????cA?-??w???????Z=?k??l5??r??x}C?*U??(?????/.?$?'Y?;?}t}D?8J?E?]???c??+/qp??????X???=?Gf????~?>k?_=??{o;??>?I??0M??;EWV????gY??H?H????M???e???'?N?P?#|?!?7?????|V?D?[rL??????G>???Z?????9*c???i'??*?n?F???}:?J?W?#u
+a5as????$????mY?5??j????u??WYMWh????????7V???o^?m@??2~??|v????)M c<??Szi??G8M????a?O??8?_ca'X??nhZ?q?39E??-=?/???=????X??N(???0?){?u ??gh????t?h?wqQ?1]?dL?)tB?J<Q?Q?y????S???_?w??????'v?p"A??P?tr?+?<??
+2?3wr??FX??O??S&QO??????~??oI??N?????Y!???????w??????O ?X?69??? "
+4??P?g?%??>???15C??~?s??[?,????8*??^%?R?U4m????f?5|_???????	r???>jt???)Dp'^|^lX?^!?w?IE)????]<??O2???!j@?E?b?N!M?Q?u
+???K?Q???????9wD>???h/?G?Td?x	8d??????_,Y?d??%K?,Y?d??%o??/??h?Nf?y???t]??Y?hQ?=?????w???O????m???|????{?	?
+?|>??*?%??N?xs1c??B?L3}?1??O???y?o????h??rZ}????rG??tb?DY?U
+<d???bF??.S?z??????(?=??o:&?e.y`g???p?-???5?.????V??q?(h?!????r\?,??C?	?}??q??0?i3N?r???y?????)>om??jy???	??\?L?;?d	? ???*+?G??o#w]]Au?Lo?p?L?h?Fyd???!????X??i>g^bU?y??-?e?5o?==?<??q?H6 <<???H_?,fyfs?G? ? ??v??tl0;?2????? SLW0?]?v?????p8??????????????#!Bx?z??P????fsh?u?????g?8M???!?cj????yl??=?????W4?M?,?p????5????^??G??A?&??OsG2q?4M?}?5
+?????????e`'?q?8?-^B?F#t??w?sB?':69$s3?????zN?????
+???H;?????c??8&o?#?o????z5?Z??*n~??i??C?zJ??????f?r??e?\%B?D??"??&???????a'+?v?H3!?vi??I?2?fp?P?	?7?	9??J&4??=???#t?N?f`?I=?`??+w??s?%[???5Ze?T??:Y ??@??(a??4^rX|???`?N?????:S?m1m?d|L????,??????vY,fd;?h}????0?c??????y??x??!?@???????,???u? ?n??v??\G9??SVRC?2??????s9.??T_?u????4?$o>????=Ui??+}?)??????l?Cs??0C????T?%?<??G?????)?9??Q?3l?8???W?????Q? >?bA?W??)?????d??(z?4?C3h[???????f?BnQ{w????!:Gb5.?T??A?R????
+l!>???????.s??&7?5?????<?z?m??1???
+a?R?mSC? ??????H[?(???hG???9?Bw4zNhzz???tf?U???~???C????8&7??8'
+?V5(sD??M]-DA?? ?0C9??sl?S;?E???#ww????9N?x?#w??:[??????U?????9@ P???? J???????????9????.??X4HH?5?ohu??t????#??1?N??ijd3?Wx?%m0??m?????r??p??l??t?????M???k??h?qy?P?????????????f?
+?b??T??????qLn??>=??}A??^p?U???F?kh???u0?H8?&#"?A?????v??>{;????b??>6?!???fw??p?$???Y??!??j???>'???~?????????0??S_??????_????O}?????????x??'MS???3	??0?2?SV??$	?:???z?;Q?<{?<A ?????a??CH?"?[??.?h?]@?(Bu?&????m??????????|>???_??o??????^).|x??I??????(/??;?j?Q{?96?-$u?qT??C?4EZ????O? ??8?P?????u??&??Tu??3???:?9~3a:?0????9C C.|?h???????_d0?l?cr?E?
+M????m:???9?????	??:??['2 XP??5??^B??FL???<@??U?H???m??????n)?J??L????]??!?????#?
+^??b^b?)a|??d7????f??Uw	c?o?'S
+????w???E???~????jnC???C?$??d?	???-L'G????5?o???I?q&x?YV?'W??o??R?(?????H??Qwe???1?;??#"o?1???????b??????x???fxB?5?C?2@?T?????s??)?8'U?i?i????(?`?k?F????A6?a?Z"???K??u?(??
+'(?bq?N??d????1????5FA????=??'??f?3?~????%s?}?????9l????????G??????
+??<?s:}???#??????aM?f??m???tz5D??8???u?:g?
\ No newline at end of file

Deleted: trunk/data/gfx40/st_flat-break.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/st_flat_break.png (from rev 1748, trunk/data/gfx40/st_flat-break.png)

Copied: trunk/data/gfx40/st_mail.png (from rev 1748, trunk/data/gfx40/st-mail.png)

Copied: trunk/data/gfx40/st_monoflop.png (from rev 1748, trunk/data/gfx40/st-time1switch.png)

Copied: trunk/data/gfx40/st_shogun.png (from rev 1748, trunk/data/gfx40/st-shogun.png)

Copied: trunk/data/gfx40/st_timer.png (from rev 1748, trunk/data/gfx40/st-timer.png)

Copied: trunk/data/gfx48/ac_bug.png (from rev 1748, trunk/data/gfx48/fg-bug.png)

Copied: trunk/data/gfx48/ac_horse.png (from rev 1748, trunk/data/gfx48/fg-horse.png)

Copied: trunk/data/gfx48/ac_marble_black.png (from rev 1748, trunk/data/gfx48/fg-blackball.png)

Copied: trunk/data/gfx48/ac_marble_white.png (from rev 1748, trunk/data/gfx48/fg-whiteball.png)

Copied: trunk/data/gfx48/ac_pearl_white.png (from rev 1748, trunk/data/gfx48/fg-whiteball-small.png)

Copied: trunk/data/gfx48/ac_rotor.png (from rev 1748, trunk/data/gfx48/fg-rotor.png)

Copied: trunk/data/gfx48/ac_top.png (from rev 1748, trunk/data/gfx48/fg-top.png)

Deleted: trunk/data/gfx48/fg-blackball.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fg-bug.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fg-horse.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fg-rotor.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fg-top.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fg-whiteball-small.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fg-whiteball.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-gradient2.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-stwood.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-wood.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/fl_slope.png (from rev 1748, trunk/data/gfx48/fl-gradient2.png)

Copied: trunk/data/gfx48/fl_wood.png (from rev 1748, trunk/data/gfx48/fl-wood.png)

Copied: trunk/data/gfx48/fl_wood_framed.png (from rev 1748, trunk/data/gfx48/fl-stwood.png)

Deleted: trunk/data/gfx48/st-disco.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-doorb.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-doorh.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-doorv.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-mail.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-shogun.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-time1switch.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-timer.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/st_disco.png (from rev 1748, trunk/data/gfx48/st-disco.png)

Copied: trunk/data/gfx48/st_door_b.png (from rev 1748, trunk/data/gfx48/st-doorb.png)

Added: trunk/data/gfx48/st_door_d_ew.png
===================================================================
--- trunk/data/gfx48/st_door_d_ew.png	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/data/gfx48/st_door_d_ew.png	2009-07-11 22:35:03 UTC (rev 1751)
@@ -0,0 +1,45 @@
+?PNG
+
+
+?wb?w?.F/?W_???!>???+??q?s?O,????}?'??7???>?[?n>?g?g???O>c"??z??|?`9z??=BB?????W??X?CNN?e??O`}N.??b??????f?y??_?~????????????g???Nl.D?d?'???????.????1?gg,????t??????^??W????'????S?l????S??w??[?K?*?a??s????[?u=JAv	??@2]?R?C-q?9^6????W?UE?=q????v?
+U?Bt????*???h?R?|)7??;d?B?1@???LI?PDK??	+b?0???tn$?)?-|JI??"?bY?>?-D:?P)??.?4T)?5J?R?a
+?'??~p?}??????
+c-Yb??j(f???|&??w?? Vb?(M?????? ?"?
+?uW?r?	?VTjdG?1??)R?I;??
+$?D???sz?!??????'c	?bL5Jy?I?C??m????@
+_B?T:
+??D?????'???&X?!??\??CN??i;\?2?}?j???Nt??W??]r??????????????w?u???W?S?? e<U?j??l{????gw???o????+K??S/?.b????????.U_[???<????\j?.??x??????K7X?s10??
+?q?)FAN???CK?OLs\??V??,d??A?????#t?????ez9 @L	?G?dl? .C ?L?jKPP?(i$?????Q?nX????}BV?Ia??5S<??RKuE?F??????J=e\aR?V????Q???j?L1:?R ???=C,?3?mX?<??'T2??
+?E????1???w?@?????C?w.?????;?8^????@J???o?g??V,7?;a????ZN\?0FBL?y??@Y???]N??*?m????6?6U]#?U????G?O??H???Vk?zDJ?H?????h?np???????R? {x?~?[? t????1FF???V?????IeF??F$??k?,??m?bTA?[?2?e_????B?S?L????.?00'=? ????????X????'=???iE+'l?D??P????R>Ii<y?????*9???iA\?|}2??\?L?b?,Wk???~??t?s??q????'??/?1R?,???,S?v?W??????1cG?9c?:"?1??*?\R?5?Xp.?XV4J@
+???????}J%?0?
+???F?V?Z;???.|&???Q?@8??&?B?S4?15?c at i??qCVl??s?????>Wl?m4?????b?????9???T?5?TD=?1X????A)?(?+.???!4?????????^???y??kRo?wZ-N?Y??}ot~?D??????uH?%P??????S???u7???I????GF?0x?y?U?????#????`?b?D?b5???0CD??????%???r.??@4x??JArD???%dC?4td,?zbJ7v~$E?%Q?KC??5yB?z?WQ??V??*?\P?U+ju?B`??????:0~$?Z??jy?@????`?????B??RP):r???q??,A??*?j?1.?a6?3????@?.??)?X?~??8_zv??^??i??~?????6Lw?d?3?D?s?????UA(????yX?'	N??}v??uu/?L??F????Pr????m???????e'teN?%?;??n?c?5?!?}=g???????(	+???:?? b???&?	~?y?]_&?G??H')??Gr??????????_~?????????4Sr0?	?????? F?[? {}:???F??E?n??{???d?6??zV??K??????nC??$?ND?MR???}??g3??}bk$"?????!?)~X?;?{N6???????H)???!???D:??????N?|?"??[D
+?;?~?s??U??b??|?>hP??b??7??	?R?L???wy?T??ye2???sIm?|??UO??ze???U?z?zq????7cw?k???????????3??????u7???G??E???\"k??!Z0??#??<???0??P?u?P?X*?(??!???UF	? 1?'D?h?iJ?.\??n?
+?????j?????u?3m,Y????&?-???m'?Zqv?`3,?&????Lg???d?2??S?D????????F??QV:??Gb??	!'Ty???d? ?x????Q???("??G?'H????pF?z&cf??4????x?????????^???_?fS&9???Y??>??|y`?(a????X????oWt_W???????{?g+J????Q~??? F,??Y?=? ?nM?#!*?X???>?
+???8?AR????l?e&?k?8?L?kz?????
+?5?	?R??-????wX??[??k*6R?3?????q??B?-??j?r??^??2??Z??~c????q1???Ia??v???np?K??>??B?*?n?|??Xc?=??#?56?0???v?R??Dt=b :O?E??V#?E|{?@/u?n???????#??(Y??#??b??????;uf??Q?p?L?m?E;?-[?K????uE?OX[????????*M?2?B??#Zi??e?f??"??OSVA4	???Z\X?r???0WY?t?@/u???IN?ciA??????????????<?AU4?o7????-????_???^6EH%??????????Q|]s?<hG???1??h<%??t#F?D?D?s=a?Ha?????e???>????5u???W????`A??%????+?n??I??^ov?~m:?7????e2UVd?Ao???i??L?Xq|>?%A?BF??6?	?R???k?X?`?o??A=b? NOO~?\??@Y>????1????\?:&$B6?,+?-Z%;????t???6TF?4?$? 6cG	s9?.u???J)CJ?$E???I??DD?G"????AD$?a?q/ng???p?X?8???fu??????a??????*??(+r??1q~?by~?m????e???.???????7??}xx??J?q?[0l?X????j??mL?6m??????GRW?>?^?p?	?????\.?7}?5^?R???f?;<??>??.?{?5???????j4??n}????Z+f?	uS\"??.u???n?kO}????????????>{?j?	1\O?B.?J?m????
+?????b??g>s{2?A)q$?LJ	c?'/7?.u?????=?L&??V?\$??$'b???}B????T$???d?q??t6???K/|??/?????u?=?Yb?`??????/???#??P???f?????z????????S?f?|????v???Z???	?R???????~??/}?[;m??f??O?U\?st??????~g??=?????6?g???????w?{??MU????[r???,5J??vD?Z?"?L??????uey?????R?0?}??4???C^.?!^?1]?Rg~???_}?^z???????Q?5????r??Z???Wpu?\??????????}???{FR?x?pvE<?[????l3{????I?????9u?(????XT5?d?R;??? ?)9?D?(?Ra?f*?.r?@/u??bf?ER?8.??!?G?????/|?+???????????c???	????b?
+?f??/???????????<}5i0{U7e>?y?????????3?????L???=?9g+g??DZ\R?w???h(s&vCc*?V?	?R?z???_}?K??o6rrz?V?w???H ?s??[;?o??{??????o~???vp????z??1???~?+???x??[???fUjB???.?9?]???F??)1^?s?hR??????F7?is?????J??s?2$?	+????ah??H]?^&?K???d?^??g???W???kO}?????8yQ08???/???k??????TaO??XS???f???zz?zd??p???h?J?[K? ?X?V?J1'6???@?z?IEUU?"?[??z\v ??78??u?1??K???i?h,l$??Ii?.O?x??~???}G??m???u?)???>????/?/?????\;??G?M;??f;{/li????_zv??_?TU??d??tx???gA??G???L?+??
+e??>???Y?2g???A?v??
+??"??t?8"?a?r+?R[7(??q
+?=??????[U?	?R????O=?????[u?p=??|??_|[??M??i1?PF?L!?u????QL8a6? ??x7p~v$?r?M?{LXQ?!!|?R??S?L-?#??"?V????z??????9<?J/??>:???*i?$?7?Qc?%?O,z????:?_????????EX?.7(.??\????????/~?^{??_xf??????O>???_??W_??>???????f????????/??|?OJ????&?`)[I?????? ??{?TT?!?$uL?zf?FU3?A#???NmK1PY?kM;ii*??5?-?92?
+??(?:d??%,???[S?U????.<???)?ZE??FNBN?T*`u&r????9????8?_Mg??/}??o???W???y??{d??B?/>?????????a6?}??L^i?CbO?2Z?)*??t?1??S??b?5??!?? a??5QR?V;?v??fD??zF???????????????K1?^c?	f|?"jr?VFH]4m-????,P???>?????2???:0Zp\v??D??>;;???c5:??}??Z?7???4M???????B?L8?pc????`??5?2?	+$?jF?$???f??x?)5???R?-6?
+Y???????v?Pe?R???)cu2?_] pg???Z??[??'??	a?+V?#??XN????$??c?w?S5TU???K)x?X??h???T4ky??`a???z???4????^{??=?q??
+?5??????*??j??uW?(?yDXU??:Y??q$IE??@?d2PU?$?75?z????)w?0?eR&ufm4?0?0e?b?j?X?@???XH~?#??T?1Hr????f?D74?R????
+?b
+9gb*`??#z???0y?
+	?@S??E?*???VC/{?T\@??hD2?u??Q?????????g?o???1?????uL?v^?5?]??(??l?(??????!??))P???J2W&?I?9?SF?R?????%??,?V???v2cj#uY??}"???`X Y??5RV?Pp?8?J??bg2g?[J??"d?
+?J)f??FUMQf?????|?H??ULE?FB??????h?4?d???1%?J??? ?????x??|!??rN?????X ?oiOZ?N?jy?E??u???R?????? ????L???	+Z???????r??:????v????????5g??,;????/???{??Z????,*???"B??>L?#T???t1??????? |*??aB=ZrJ B??	?kGb?Xv?H[??6!?0???0??m?D?x??9~??CRx?#???}T?1G????_}?????????Bh%W???f??#p?%{w????E??(j8f-?j?f?t?ZF?LjO[?1[Y????j???$9?/+Pk+Z???}t?O)?Tv?fB???[??RJ???i?p??P??? 9't??]??}|H??d)???[@x???Q??BG???R6?
+F?Pa????#,KdK?_?!??;EP8]???91Uk?R?PpQ???????????{F?Qht?V?(@???"?X?<b???O?????H?Z??????$c???,!??[2??CAY??Sj??d?FR???W
+??U?????
+T?@?	?^<???Y`e?l?r??t?J;l??L(?<:uLQ???'M????"S<dG.??(,?hz????Z?2?IB??r
+?????????%??s"E,F$?a?????\j?????A?1?bq??'D??6[B`aRe?U???!u??!a??*k?:S?b?=aI?!1}&???GJ?????0?uw??D???#??.%??#????k???[??{??#??_y??????????????k_??w}??<l?Ta??V??
+???H#?g????u???2.*
+	cFJ??^???N1uG;??nFf??A!??"^?hKn??f??????dT??!??fAU?0?G?vK?????I	????v0???(bAW?x??#t???E`?@.[C`??j`n+r?O*?P`?
+<M\?[0????4!?H7??2%???[?D*%?wT}?08L
+??cO?G?8bI?????@???]??]???]`c,(~+?d?? ???<:a???!?b6?`?6??.x??DL??J?|???Q?Gx?N?8?g??'9=???z???0????6?u?:N?q??u:`P?X?)?s??h???.???pQ?q?M????????^sB???0P?{h%?????yR:D???#?9j?J?[A??a?8vh???'c"???`h?[??&?(JN?5u????
+A&[C?R
+?9?P3?}R,?i?El1?n??~?/?g?@????"??}??SN)?|?,??\Xo:?C??u=???C?*EH?`K?^@?)??jk?T
+?d?,?u??d7?nl ?Z???t??+Gh?hU3?m?????BU3z%tr???*??E?J???3?N???&????WJ!G?c?.?T???j?4?,{?s????#aC?om???K?;4?#???HHBc?I?&?t`?"k???5j???0k
+;????n<!?%Y???????? s?s?nI	#?|B?9P?l)?
+????9q?S"?+??Z??!???(uN????n$#???laH(tZ???JM?4Cd???~p8??:??%%?(?E?G?$*??{y1??E??????,?M;?z?^Y6Jh)LUbV??L?]????W???uTy@%?PJ!?B?[:?????E??;?&"?\H??r?H??????????>?????3?sP
+??TDY?????8R??c???DrQ,???y??ht?e????PXj??????idon	?????	Q??Sea*?(sRX??#$Dtp??G?.?????2~R?$wFq?(???56?u17`?	e???????pL?#???????+K-?9??`h?rQr??g=?/X???K??Q
\ No newline at end of file

Added: trunk/data/gfx48/st_door_d_ns.png
===================================================================
--- trunk/data/gfx48/st_door_d_ns.png	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/data/gfx48/st_door_d_ns.png	2009-07-11 22:35:03 UTC (rev 1751)
@@ -0,0 +1,49 @@
+?PNG
+
+
+
+?CfS
+?$:'??????G?x??????????1.>?(?k?>????/|??????<FDr?????0?[?xz???7??7?(O>-???x|??W??7??O???????A??@k???????Y8}?9%?@??X?V????i\b?o?1K??l/??-????*2*;?H??c?????G?VT????Qc at o6????hbIL5:?A?>5?>???Qj??%??R&????%?????-?jM????$G???/{V??Q?*FDU?>???5?}????????????Z????'9????<??h?tl????A??w?r??
+=??dkYmu?}rE?~?jW?+Y????1??`i?????u?/<?t!???*??`????r???!????????????`??Mf????a!????b???Exy?;*Y???s|	????_???;???1???8ks???dLYUh?E5?)EB?$r??,??????!?????8?L?W?0??H)>??e??;v???c??;v???c??;>?k?o?????I at hR"???????????ws??
+?$Z???G???n?aE??<@??lY??<z?????;?????W????/=w3??(E??2?	????C??!?&?X?~?}g??;z??G???????F????<???O~?????+q@?k??????????z??-??H:???????"???51????QR0?JDNl6k?^???2?c?=???DD???8?%? ??uHL?!2?P??E?1>_02?hqJ??6O??[?.J?H,?81???!?O???C????$?U???A?}?c(<c?PB????!????5F?NbN.????^??l>?6k??Y?6{?U?.???a?$*?+z[d?
+BU?4?(Uq???)?"Q??????
+?)??+?d??|????Co9B?K?
+???%??4))dq?6S?????8Q?5rNH?t??	??;C,??.?^??????~???|,E????tT%Y???L??AeA?!9???>??%.?d??D??T?????Nsp0???z^?V???zS????=??w??????????u??%?u?E<b?z?L?eJ?"???tFoyhQD:Q?3!??tK???????z??C4M??>???????s???7??u?R?|?w???4????
+q???^???????
+?W??g-?????e1F????;?T?x?st???AD?_?[???H$$}@??h?:????	?{??&8?,u??}?*???@???B
+???????BSN?1)!l??Y?c?*??~A?G???z?N???DY???????*2!B???P??????k?_`?{??Q?}b?KL.?H??gW?????k?v??Hw?K#P??BA?I???? ??X?K?:St-~???,X?m?????V???+???-?,R?CC???l??V?_,????????w???+??7?>o?;?u$?????@+??>dAV???;/;??\?)
+???B?
+?-1??f???C!??????x(\???)1?9F0FQ??om#b4??)?sB?WN&?S>??!??#??c??c??)?.%w???c??;v???c??;v?????9????fF?????g?|2?C??????+p?q?????2?6hw?,o??>????s??<!I????O????$Wa????@??->????w??(??:?6?~??r???B:???T?bEN	Z????7?M?????c?;4??????P?2hdh?D?O?Cuk???&e??????Ag??f??0H???))?{?#???[Z4??D?St?`<?P?FA!SK?V?!?o?0?i???	??y?P?????w??????W!??B$?L????q???\M?+bN???@d?s????3??G?;?????A/1c????[|??(??zD??Y?:?????M?i[?,?x??E?
+GN????9c<O)}?????#?HY!eF~?27?\e"???c??;v???c??;v???c??G??'7r?$????m??/>Zw???o>????P???$f???????>J???? ?DJoS?>bw??????R?|5{&O?ty}???nu????v?9????pA`S??;??????/p?????Om?J???Yc??FxEX?ez?X?T????oSEE?!q?`H??l??`9D?@???????????k??&??z???????mtt??O?y??G???_G??T?????!(??Z????e?L5Ze???>?s?3[?M?*???"?-????}C???~?3s/?????9B?_??j??+??????dp?\2/1f??\#:I?K??+?9?"???
+-??K*R?~KVM????))GU:????????ULzN?9.H?fH?Zb??q?G&??t?@?n?k?h???9????s
+#KD^c???F?I???K0?rz???5d?I?)?uO0??C??[#?$??t}???-??n???X?	??Lu9SI(?\???f?1??l?BS??fEUh%?@?C??o??
+???]@?v; ?
+)d1g}???c??^?h??????U`???Y??(??s????^??????dv????Z*?2??$? R??$?Su+\??!#??FfB?!A^G?	??a???n?4??H)0.<??W????+Gh??0?K??xe<??)F???X?UOY(?hJM?I??????]G?9I*jNH?E???:???a<??D?W??????76u?G?,?????HHEH?QU0!h?],(????aS??S??g?t???GH9U?2W?$]?G?46
+d???GxF??I??u2????GG??j??i??z?n???
+??%????????5?ct?`r ????cfjtc??=??Q?$?C?W?A0????x/1?g?-??????F??O??A???}w????u?\??$?
+#Zx?t???<l?*FL?bsA?D??????@?-?R??e
+????=F&j?e?.?]????G?oP?7?C???T?~?i ???@???N????#? K??F):???~K???)Ej0:??"x?K???|O?i??~(!)u????=p?V?s?h?2?39ZJQ???OS??,=9o	$W???????'???`*??Hi????]??32IN??????F??|v??????#T?N??A??)???rF
+?0????rKk+??d?*2?A_l:r???F_??$???o[b???4?E?b??7[??a??`E??#$V??p9???H?L??}?u??6n?	?C?Q?L???[?6???@?.:vd??????>??6c?/r.X?C???jK????f?| w?-G???tf?OJ?)?b??Q???w?$????	?<f*{??4????_.????????-/??0??al.)LF
+?:X???`?p??z????~??~????N???C?C?)9B?a??*.	?	?)?$?1YF[?
+W?T5??)?@&%C?!???9E?o>?`fYJB?4c8?9?G]^J)??R?o]?J?	I #??7_#JF??hz??;v???c??;v???c??;v|??7Nn&??7P???!euu?7?[???CUU???cc4B??g??G(e??AFq??b/?L?%???K?%?:,?e????=??????W?????	?(2???????Pg????SJ????=??S?#?(?}Dv? ?\Ik#?5???G?}[???=h?~?O???3?~?????????#G(???.i?F??$F$O\?5(??1!?E?H?D????n?L?:?DL?;???????????#.??W???K?PKj?l?>?%*?q??N:
+j?f?%?C??`??#
+K???Z?????=h??X.l}D?%E?;Gh??2!???????}?m??7`Id??f?g??b?KF??!?7X??;???z:??qx?!???
+?.[$?,???n????HY ?#?Cj=?9??2*8?>S[??"o>?;|??l?????z??~h?\@(I&!?????!Y?? F? ? ?
+?(:4:x??
+?)?  ???!v?e?1???	%{eO?W???T????w??????F??????Lu?????oI?OD?!?DY?????u"1?[ShIYH2
+#0f???????>?xT?? F)?4t?{???!?xy???.???Q_?N??xf??#!&?????>???el<?"??G???k?g??k?j??/qQ1Y??$????6c??,???p?mZ?7?'??gf?o;B??:??IrB41>???59gd???c;\????iQ2?-#=??}l???FeE'*\(?????Q??Rd?? Fwes????|J?~?P??f???F?9????#rvd? ??v68rvUbbD????i????`s???j?????#aR?U??C?Y???	b?D9l0?a???e?????????y??e?W?4?xo@?{D9!?=T????X?P??t?N3F??SC?5h?@7Dw???J	????B	J9???tGR\RBZ?T23???f?9??h???ZFf?W?B!?{??fr??(]???t????y ??? Q??ls?"?????1B8??1????2L??8+Pr?2?xs?????j7ch=????)b.?k3Hq ??]g?y?8?k0?&?6??'????*?6%)????,^T?????DGNs&?????E??????}C?+X;0?-???1??0??pC??-?[??CH?G?Vq??????zu???%??S~?????j???z???$???.qI????G??X???F?H??kj??s?1??a??????
+?d??H??I???B\????]J!t?g?-???????????????????{??h'?????Z-rrJ[6d9??}L,Q?%?>?(?@?%=O"???1t=?D??w?e??D1?????? E%?v?sS??????e?@@]7=???`/???1vO?n~???,?`?E?Qf? ?D?-?KzZ6?B??????fK?+????lv3?t????.?
+j? D??`?=?F"??????",??b?I???u????=f???????h?ym(?????!fO?Dj?A???8A?Hz?????#tS??|Gk#??`D???8??N???58!?PEOp+??_?C???5??wu?????_{?]??????%???#??2???%6????a,2*f\8j??h3????(4P:???[?<e^??Lh?2??B?D??G????U=?
+???z?,?????t?8B?????U?????-GH?w???w?J:FU?UL????>?a?O>?ER???TS?????.??K???$9K?4]???Caq?Q?_#?99C??;??ol???r???#T??,???????$RJR??C$????EWaD??h@\?Q7?x??!?	?d??N'h%??"??Bj*?????Q???Xw?`%9*<%.??!
+B?Y??Fr?L?b?aUB{??????fo??1??-?y??g?'?1??Wo??6#?}?4AQ??>????$?????????E?|????g?oJ????\?? ?b??rG?52Y?~???:i?B??!D?????????????d????O??V?"??gH?A????C?`?}?lT?s?K%??vk??h7??n?????E??=?nEN]?Bb?FU??5?????K??LtMU8#Z+h??.??aC6S?oJ?Q
+????"!G?????\?7s?JF???PE$?HJ???T????1??MGH??!??  H<xF?Q""?U?e???*???=9~?\?;v???c??;v???c??;v???????fB
+?????.d???_(?Q$"?????%????z?#WO4K!?R ?|?/??)R??YbL?"E??_|?'}??????C?H??jud%????]?g?3l*???`7?\???C3???w?Cow??RY
+AUT?
+c
+
+e?	?0xp????rB?O?s??3??3??5B@(t9B??b?,S3????$??
+J&?6?(P1PHG4?d/?a?s?m????Q???'???|??y??'??vd!?:??a?L?%^?i?????i??V?]??H???m7?[?	???/??
+?dgn@???6MDs?S\?P??By?n??J(????%?i???|;?r5bn?0N?xb??p???	?s#????5r?$2?@?	?Y?=(?Fr??X7P	?9??H????????5??5`??2h?A???+ at D?r?0%FK?kV??5??8'?6?O?
+?0k??;X?G97L?@?"%??Q???-C?<	?EE?????K???H???;???-??{|?ql??#???G??@?.@^???D?+?5?9??q	H?B??R?K%?Y?f??ZRvc??2O[d??E??(????%1???????"P???{j??m?bM???^????RQ???M?Cp?X?	???C?S????S??G?O????????????6d?b<?7?R?????+???[K?=???	F8f????M:0f????`_G??1f???U???S?
+?t?CJqL@????1????F??l
+?A3?\???G?S?<]_S?????????,???_???o??S??c\?0?%??>? J6Zc?@??j?O??)?C???)?*?mfh[???d?(?E)?K?.L???($A]?L\?qT?V????-??$1?"??<HW]`h??z???
\ No newline at end of file

Deleted: trunk/data/gfx48/st_flat-break.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/st_flat_break.png (from rev 1748, trunk/data/gfx48/st_flat-break.png)

Copied: trunk/data/gfx48/st_mail.png (from rev 1748, trunk/data/gfx48/st-mail.png)

Copied: trunk/data/gfx48/st_monoflop.png (from rev 1748, trunk/data/gfx48/st-time1switch.png)

Copied: trunk/data/gfx48/st_shogun.png (from rev 1748, trunk/data/gfx48/st-shogun.png)

Copied: trunk/data/gfx48/st_timer.png (from rev 1748, trunk/data/gfx48/st-timer.png)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/data/models-2d.lua	2009-07-11 22:35:03 UTC (rev 1751)
@@ -37,17 +37,17 @@
     local images,frames,shadows
 
     -- Normal Blackball
-    images = SpriteImages("fg-blackball", 2, 0.5, 0.32)
+    images = SpriteImages("ac_marble_black", 2, 0.5, 0.32)
     shadows = SpriteImage("sh-blackball", 0.4, 0.29)
-    DefShModel("ac_marble_black", "fg-blackball1", "sh-blackball")
-    DefShModel("ac_marble_black-shine", "fg-blackball2", "sh-blackball")
+    DefShModel("ac_marble_black", "ac_marble_black1", "sh-blackball")
+    DefShModel("ac_marble_black-shine", "ac_marble_black2", "sh-blackball")
 
     -- Normal Whiteball
     -- Use shadow from black ball
     DefAlias("sh-whiteball", "sh-blackball")
-    images = SpriteImages("fg-whiteball", 2, 0.5, 0.32)
-    DefShModel("ac_marble_white", "fg-whiteball1", "sh-whiteball")
-    DefShModel("ac_marble_white-shine", "fg-whiteball2", "sh-whiteball")
+    images = SpriteImages("ac_marble_white", 2, 0.5, 0.32)
+    DefShModel("ac_marble_white", "ac_marble_white1", "sh-whiteball")
+    DefShModel("ac_marble_white-shine", "ac_marble_white2", "sh-whiteball")
 
     -- Falling Blackball
     images = SpriteImages("ac-blackball-fall", 10)
@@ -124,8 +124,8 @@
 
     -- Normal
     SpriteImage ("sh-whiteball-small", 0.4, 0.41)
-    SpriteImage ("fg-whiteball-small", 0.5, 0.43)
-    DefShModel("ac_pearl_white", "fg-whiteball-small", "sh-whiteball-small")
+    SpriteImage ("ac_pearl_white", 0.5, 0.43)
+    DefShModel("ac_pearl_white", "ac_pearl_white", "sh-whiteball-small")
     DefAlias ("ac_pearl_white-shine", "ac_pearl_white")
 
     -- Falling
@@ -171,14 +171,20 @@
     DefAlias("ac_killer", "ac_pearl_white")
 end
 
+-- Marbles in inventory  --
+do
+    DefImage("inv-blackball")
+    DefImage("inv-whiteball")
+end
+
 ----------------------------
 -- not ball-shaped actors --
 ----------------------------
 
 -- ac-bug --
 do
-    SpriteImage("fg-bug",0.5,0.44)
-    DefShModel("ac_bug", "fg-bug", "sh-whiteball-small")
+    SpriteImage("ac_bug",0.5,0.44)
+    DefShModel("ac_bug", "ac_bug", "sh-whiteball-small")
 end
 
 -- ac-cannonball --
@@ -188,14 +194,14 @@
 
 -- ac-horse --
 do
-    SpriteImage("fg-horse",0.5,0.18)
+    SpriteImage("ac_horse",0.5,0.18)
     SpriteImage("sh_horse", 0.4)
-    DefShModel("ac_horse", "fg-horse", "sh_horse")
+    DefShModel("ac_horse", "ac_horse", "sh_horse")
 end
 
 -- ac-rotor --
 do
-    local fg = SpriteImages("fg-rotor",9)
+    local fg = SpriteImages("ac_rotor",9)
     local bg = SpriteImages("sh_rotor", 9, 0.4)
 
     frames = {}
@@ -208,7 +214,7 @@
 
 -- ac-top --
 do
-    local fg = SpriteImages("fg-top", 9, 0.5, 0.3)
+    local fg = SpriteImages("ac_top", 9, 0.5, 0.3)
     local bg = SpriteImage("sh_top", 0.4, 0.3)
 
     frames = {}
@@ -250,6 +256,7 @@
         {"fl_ivory"},
         {"fl_platinum"},
         {"fl_adhesionless", noframe = true},
+        {"fl-normal"},
         {"fl_sand"},
         {"fl_stone"},
         {"fl_white"},
@@ -266,7 +273,7 @@
         {"fl_hay", 4},
         {"fl_himalaya", 4},
         {"fl_marble", 4},
-        {"fl_metal", 7},
+        {"fl_metal", 6},
         {"fl_mortar", 2, 2},
         {"fl_plank", 4},
         {"fl_red", 4},
@@ -277,7 +284,7 @@
         {"fl_sahara", 4},
         {"fl_samba", 2},
         {"fl_space", 3, 2, noframe = true},
-        {"fl-stwood", 2},
+        {"fl_wood_framed", 2},
         {"fl_swamp", 4, noframe = true},
         {"fl_tigris", 4},
         {"fl_water", 4, noframe = true},
@@ -317,32 +324,32 @@
 
 -- gradients
 do
-    DefSubimages("fl-gradient2", {w=6, h=4, modelname="fl-gradient"})
-    DefAlias("fl_slope", "fl-gradient21")
-    DefAlias("fl_slope_pw", "fl-gradient4")
-    DefAlias("fl_slope_ps", "fl-gradient1")
-    DefAlias("fl_slope_pe", "fl-gradient3")
-    DefAlias("fl_slope_pn", "fl-gradient2")
-    DefAlias("fl_slope_inw", "fl-gradient12")
-    DefAlias("fl_slope_isw", "fl-gradient11")
-    DefAlias("fl_slope_ise", "fl-gradient9")
-    DefAlias("fl_slope_ine", "fl-gradient10")
-    DefAlias("fl_slope_onw", "fl-gradient8")
-    DefAlias("fl_slope_osw", "fl-gradient6")
-    DefAlias("fl_slope_ose", "fl-gradient5")
-    DefAlias("fl_slope_one", "fl-gradient7")
-    DefAlias("fl_slope_tw", "fl-gradient21")
-    DefAlias("fl_slope_ts", "fl-gradient21")
-    DefAlias("fl_slope_te", "fl-gradient21")
-    DefAlias("fl_slope_tn", "fl-gradient21")
-    DefAlias("fl_slope_twl", "fl-gradient2")
-    DefAlias("fl_slope_tsl", "fl-gradient4")
-    DefAlias("fl_slope_tel", "fl-gradient1")
-    DefAlias("fl_slope_tnl", "fl-gradient3")
-    DefAlias("fl_slope_twr", "fl-gradient1")
-    DefAlias("fl_slope_tsr", "fl-gradient3")
-    DefAlias("fl_slope_ter", "fl-gradient2")
-    DefAlias("fl_slope_tnr", "fl-gradient4")
+    DefSubimages("fl_slope", {w=6, h=4, modelname="fl_slope"})
+    DefAlias("fl_slope", "fl_slope21")
+    DefAlias("fl_slope_pw", "fl_slope4")
+    DefAlias("fl_slope_ps", "fl_slope1")
+    DefAlias("fl_slope_pe", "fl_slope3")
+    DefAlias("fl_slope_pn", "fl_slope2")
+    DefAlias("fl_slope_inw", "fl_slope12")
+    DefAlias("fl_slope_isw", "fl_slope11")
+    DefAlias("fl_slope_ise", "fl_slope9")
+    DefAlias("fl_slope_ine", "fl_slope10")
+    DefAlias("fl_slope_onw", "fl_slope8")
+    DefAlias("fl_slope_osw", "fl_slope6")
+    DefAlias("fl_slope_ose", "fl_slope5")
+    DefAlias("fl_slope_one", "fl_slope7")
+    DefAlias("fl_slope_tw", "fl_slope21")
+    DefAlias("fl_slope_ts", "fl_slope21")
+    DefAlias("fl_slope_te", "fl_slope21")
+    DefAlias("fl_slope_tn", "fl_slope21")
+    DefAlias("fl_slope_twl", "fl_slope2")
+    DefAlias("fl_slope_tsl", "fl_slope4")
+    DefAlias("fl_slope_tel", "fl_slope1")
+    DefAlias("fl_slope_tnl", "fl_slope3")
+    DefAlias("fl_slope_twr", "fl_slope1")
+    DefAlias("fl_slope_tsr", "fl_slope3")
+    DefAlias("fl_slope_ter", "fl_slope2")
+    DefAlias("fl_slope_tnr", "fl_slope4")
 end
 
 -- leaves --
@@ -367,17 +374,10 @@
 
 -- wooden floor --
 do
-    DefSubimages("fl-wood", {w=1, h=4, modelname="fl-woodx"})
-    DefRandFloor("fl-wood", {"fl-woodx1", "fl-woodx2", "fl-woodx3", "fl-woodx4"})
-    DefRandFloor("fl-wood1", {"fl-woodx3", "fl-woodx4"})
-    DefRandFloor("fl-wood2", {"fl-woodx1", "fl-woodx2"})
-
-    DefAlias("fl_wood", "fl-wood")
-    DefAlias("fl_wood1", "fl-wood1")
-    DefAlias("fl_wood2", "fl-wood2")
-    DefAlias("fl_wood_framed", "fl-stwood")
-    DefAlias("fl_wood_framed1", "fl-stwood1")
-    DefAlias("fl_wood_framed2", "fl-stwood2")
+    DefSubimages("fl_wood", {w=1, h=4, modelname="fl-woodx"})
+    DefRandFloor("fl_wood", {"fl-woodx1", "fl-woodx2", "fl-woodx3", "fl-woodx4"})
+    DefRandFloor("fl_wood1", {"fl-woodx3", "fl-woodx4"})
+    DefRandFloor("fl_wood2", {"fl-woodx1", "fl-woodx2"})
 end
 
 -- yinyang floor --
@@ -402,15 +402,15 @@
     DefAlias("fl_metal_4", "fl_metal4")
     DefAlias("fl_metal_5", "fl_metal5")
     DefAlias("fl_metal_6", "fl_metal6")
-    DefAlias("fl_metal_7", "fl_metal7")
-    DefAlias("fl_metal_7n", "fl_metal7")
+    DefAlias("fl_metal_7", "fl-normal")
+    DefAlias("fl_metal_7n", "fl-normal")
     DefAlias("fl_metal_1_framed", "fl_metal1_framed")
     DefAlias("fl_metal_2_framed", "fl_metal2_framed")
     DefAlias("fl_metal_3_framed", "fl_metal3_framed")
     DefAlias("fl_metal_4_framed", "fl_metal4_framed")
     DefAlias("fl_metal_5_framed", "fl_metal5_framed")
     DefAlias("fl_metal_6_framed", "fl_metal6_framed")
-    DefAlias("fl_metal_7_framed", "fl_metal7_framed")
+    DefAlias("fl_metal_7_framed", "fl-normal_framed")
     DefAlias("fl-space-force", "fl_space")
     DefAlias("fl_samba_h", "fl_samba1")
     DefAlias("fl_samba_v", "fl_samba2")
@@ -833,13 +833,6 @@
     DefStone("st_yinyang_inactive", "sh_round")
 end
 
--- st_magic --
-do
-    DefAlias("st_magic_oxydc", "st_oxydc")
-    DefAlias("st_magic_oxyda", "st_oxyda")
-    DefAlias("st_magic_brick", "st_brick")
-end
-
 ---------------------
 -- Animated stones --
 ---------------------
@@ -951,9 +944,9 @@
     DefSolidStone("st_coinslot_active", "st_coinslot_insert18")
 end
 
--- st-disco --
+-- st_disco --
 do
-    DefTiles("st-disco", {"st_disco0","st_disco1","st_disco2"})
+    DefTiles("st_disco", {"st_disco0","st_disco1","st_disco2"})
 end
 
 -- st_death --
@@ -967,7 +960,7 @@
     DefRoundStoneWithAnim("st_yinyang", 6, 140)
 end
 
--- st-dynamite, st-bombs, st-whitebombs, extralife-dispenser --
+-- st-dynamite, st-bombs, st-whitebombs --
 do
     function make_bombstone(name)
         local images = DefSubimages(name, {h=7})
@@ -980,12 +973,6 @@
     make_bombstone("st_dispenser_bombwhite")
 end
 
--- st_dispenser_extralife --
-do
-    local images = DefSubimages("st_dispenser_extralife", {h=7})
-    DefRoundStone("st_dispenser_extralife", "st_dispenser_extralife1")
-end
-
 -- st-flash --
 do
     local images = DefSubimages("st_flash", {h=1})
@@ -1050,13 +1037,6 @@
     make_laser("-n")
 end
 
--- laserswitch --
-do
-    DefStone("st-laserswitch0", "sh_round", {filename="st_oxydb"})
-    DefAnimImages("laserswitch-blink", RepeatAnim(PingPong(BuildFrames(FrameNames("st_fakeoxyd_blink", 1,4),50))), {loop=1})
-    DefShModel("st-laserswitch1", "laserswitch-blink", "sh_round")
-end
-
 -- st_lightpassenger --
 do
     local img = DefSubimages("st_lightpassenger", {h=7})
@@ -1095,13 +1075,13 @@
     display.DefineRandModel("st_dongle", table.getn(nlist), nlist)
 end
 
--- st-mail --
+-- st_mail --
 do
-    local images = DefSubimages("st-mail", {h=4})
-    DefSolidStone("st-mail-n", images[1])
-    DefSolidStone("st-mail-e", images[2])
-    DefSolidStone("st-mail-w", images[3])
-    DefSolidStone("st-mail-s", images[4])
+    local images = DefSubimages("st_mail", {h=4})
+    DefSolidStone("st_mail_n", images[1])
+    DefSolidStone("st_mail_e", images[2])
+    DefSolidStone("st_mail_w", images[3])
+    DefSolidStone("st_mail_s", images[4])
 end
 
 -- st_oneway, st_oneway_black, st_oneway_white --
@@ -1136,19 +1116,16 @@
 
 -- st-puzzle* --
 do
-    DefSubimages("st_puzzle_blue", {modelname="st_puzzlex",w=4,h=4,startindex=0})
-    DefSubimages("st_puzzle_yellow", {modelname="st_puzzlex",w=4,h=4,startindex=16})
-    DefSubimages("st_puzzle_blue_hollow", {modelname="st_puzzlex",w=4,h=4,startindex=32})
-    DefSubimages("st_puzzle_yellow_hollow", {modelname="st_puzzlex",w=4,h=4,startindex=48})
+    DefSubimages("st_puzzle", {modelname="st_puzzlex",w=16,h=4,startindex=0})
     -- Full puzzels
     for i=0,31  do DefSolidStone("st_puzzle"..i, "st_puzzlex"..i) end
     -- Hollow puzzels
     for i=32,63  do DefShModel("st_puzzle"..i, "st_puzzlex"..i, "sh_puzzle_hollow") end
 end
 
--- st_flat-break --
+-- st_flat_break --
 do
-    local images = DefSubimages("st_flat-break", {h=6})
+    local images = DefSubimages("st_flat_break", {h=6})
     DefAnim("flat_break-anim",BuildFrames(images,50))
     DefSolidStone("st_flat_breaking", "flat_break-anim")
     DefAlias("st_plaster_breaking", "st_flat_breaking")
@@ -1182,15 +1159,15 @@
 -- st-shogun* --
 do
     DefImages{"sh_shogun_s","sh_shogun_m", "sh_shogun_l"}
-    DefSubimages("st-shogun", {modelname="st-shogun-fg",h=7})
+    DefSubimages("st_shogun", {modelname="st-shogun-fg",h=7})
 
-    DefShModel("st-shogun1", "st-shogun-fg1", "sh_shogun_s")
-    DefShModel("st-shogun2", "st-shogun-fg2", "sh_shogun_m")
-    DefShModel("st-shogun3", "st-shogun-fg3", "sh_shogun_s")
-    DefShModel("st-shogun4", "st-shogun-fg4", "sh_shogun_l")
-    DefShModel("st-shogun5", "st-shogun-fg5", "sh_shogun_s")
-    DefShModel("st-shogun6", "st-shogun-fg6", "sh_shogun_m")
-    DefShModel("st-shogun7", "st-shogun-fg7", "sh_shogun_s")
+    DefShModel("st_shogun1", "st-shogun-fg1", "sh_shogun_s")
+    DefShModel("st_shogun2", "st-shogun-fg2", "sh_shogun_m")
+    DefShModel("st_shogun3", "st-shogun-fg3", "sh_shogun_s")
+    DefShModel("st_shogun4", "st-shogun-fg4", "sh_shogun_l")
+    DefShModel("st_shogun5", "st-shogun-fg5", "sh_shogun_s")
+    DefShModel("st_shogun6", "st-shogun-fg6", "sh_shogun_m")
+    DefShModel("st_shogun7", "st-shogun-fg7", "sh_shogun_s")
 end
 
 -- st_stoneimpulse --
@@ -1246,23 +1223,29 @@
     mkswitch("st_switch_white", "switch_white")
 end
 
--- st-timer --
+-- st_timer --
 do
-    local images = DefSubimages("st-timer", {h=4})
-    DefAnim("timer-anim", BuildFrames(images, 120), 1)
-    DefRoundStone("st-timer", "timer-anim")
-    DefRoundStone("st-timeroff", "st-timer1")
+    local images = DefSubimages("st_timer", {h=4})
+    DefAnim("timer_anim", BuildFrames(images, 120), 1)
+    DefRoundStone("st_timer", "timer_anim")
+    DefRoundStone("st_timeroff", "st_timer1")
 end
 
--- st-timeswitch --
+-- st_monoflop, st_laserswitch --
 do
-    DefStone("st-timeswitch", "sh_round")
-
-    local images = DefSubimages("st-time1switch", {h=2})
-    DefAnim("st-time1switch-anim", BuildFrames (images, 180), 1)
-    DefShModel("st-time1switch", "st-time1switch-anim", "sh_round")
+    local images = DefSubimages("st_monoflop", {h=2})
+    DefRoundStone("st_monoflop", "st_monoflop1")
+    DefAnim("st_monoflop_anim", BuildFrames (images, 180), 1)
+    DefShModel("st_monoflop_anim", "st_monoflop_anim", "sh_round")
 end
+-- laserswitch --
+do
+    DefStone("st_laserswitch0", "sh_round", {filename="st_oxydb"})
+    DefAnimImages("laserswitch-blink", RepeatAnim(PingPong(BuildFrames(FrameNames("st_fakeoxyd_blink", 1,4),50))), {loop=1})
+    DefShModel("st_laserswitch1", "laserswitch-blink", "sh_round")
+end
 
+
 -- st_turnstile --
 do
     local images = DefSubimages("st_turnstile", {h=2})
@@ -1616,59 +1599,66 @@
     DefShModel("st_oxyde-4", "st_oxyde-4_peep", "sh_round")
 end
 
--- st-doorh, st-doorv --
+-- st_magic --
 do
+    DefAlias("st_magic_brick", "st_brick")
+    DefAlias("st_magic_oxyda", "st_oxyda")
+    DefAlias("st_magic_oxydc", "st_oxydc")
+end
+
+-- st_door_d --
+do
     local f,img,sh
 
-    img=DefSubimages("st-doorh", {h=7})
+    img=DefSubimages("st_door_d_ns", {h=7})
     sh=DefSubimages("sh_doorh", {h=7,imgw=ShadowSize,imgh=ShadowSize})
-    DefShModel("st-doorh-open", img[1], sh[1])
-    DefShModel("st-doorh-closed", img[7], sh[7])
+    DefShModel("st_door_d_ns_open", img[1], sh[1])
+    DefShModel("st_door_d_ns_closed", img[7], sh[7])
     DefAnim("doorh-opening-fg", ReverseFrames(BuildFrames(img, 60)))
     DefAnim("doorh-opening-bg", ReverseFrames(BuildFrames(sh, 60)))
-    DefShModel("st-doorh-opening", "doorh-opening-fg", "doorh-opening-bg")
+    DefShModel("st_door_d_ns_opening", "doorh-opening-fg", "doorh-opening-bg")
     DefAnim("doorh-closing-fg", BuildFrames(img, 60))
     DefAnim("doorh-closing-bg", BuildFrames(sh, 60))
-    DefShModel("st-doorh-closing", "doorh-closing-fg", "doorh-closing-bg")
+    DefShModel("st_door_d_ns_closing", "doorh-closing-fg", "doorh-closing-bg")
 
-    img=DefSubimages("st-doorv", {w=7})
+    img=DefSubimages("st_door_d_ew", {w=7})
     sh=DefSubimages("sh_doorv", {w=7,imgw=ShadowSize,imgh=ShadowSize})
-    DefShModel("st-doorv-open", img[1], sh[1])
-    DefShModel("st-doorv-closed", img[7], sh[7])
+    DefShModel("st_door_d_ew_open", img[1], sh[1])
+    DefShModel("st_door_d_ew_closed", img[7], sh[7])
     DefAnim("doorv-opening-fg", ReverseFrames(BuildFrames(img, 60)))
     DefAnim("doorv-opening-bg", ReverseFrames(BuildFrames(sh, 60)))
-    DefShModel("st-doorv-opening", "doorv-opening-fg", "doorv-opening-bg")
+    DefShModel("st_door_d_ew_opening", "doorv-opening-fg", "doorv-opening-bg")
     DefAnim("doorv-closing-fg", BuildFrames(img, 60))
     DefAnim("doorv-closing-bg", BuildFrames(sh, 60))
-    DefShModel("st-doorv-closing", "doorv-closing-fg", "doorv-closing-bg")
+    DefShModel("st_door_d_ew_closing", "doorv-closing-fg", "doorv-closing-bg")
 end
 
--- st-door_a --
+-- st_door_a --
 do
-    DefAlias("st-door_a-open", "st_grate_cross")
-    DefAlias("st-door_a-closed", "st_oxyda")
-    local f = BuildFrames({"st-door_a-closed", "st-door_a-open"},60)
-    DefAnim("st-door_a-opening", f)
-    DefAnim("st-door_a-closing", ReverseFrames(f))
+    DefAlias("st_door_a_open", "st_grate_cross")
+    DefAlias("st_door_a_closed", "st_oxyda")
+    local f = BuildFrames({"st_door_a_closed", "st_door_a_open"},60)
+    DefAnim("st_door_a_opening", f)
+    DefAnim("st_door_a_closing", ReverseFrames(f))
 end
 
--- st-door_b --
+-- st_door_b --
 do
-    DefAlias("st-door_b-open", "invisible")
-    DefAlias("st-door_b-closed", "st_flat")
-    local img=DefSubimages("st-doorb", {modelname="doorb", h=8})
+    DefAlias("st_door_b_open", "invisible")
+    DefAlias("st_door_b_closed", "st_flat")
+    local img=DefSubimages("st_door_b", {modelname="doorb", h=8})
     local f = BuildFrames(img,60)
-    DefAnim("st-door_b-opening", f)
-    DefAnim("st-door_b-closing", ReverseFrames(f))
+    DefAnim("st_door_b_opening", f)
+    DefAnim("st_door_b_closing", ReverseFrames(f))
 end
 
--- st-door_c --
+-- st_door_c --
 do
-    DefAlias("st-door_c-open", "st_grate_framed")
-    DefAlias("st-door_c-closed", "st_flat")
-    frames=BuildFrames({"st-door_c-closed","st-door_c-open"},60)
-    DefAnim("st-door_c-opening", frames)
-    DefAnim("st-door_c-closing", ReverseFrames(frames))
+    DefAlias("st_door_c_open", "st_grate_framed")
+    DefAlias("st_door_c_closed", "st_flat")
+    frames=BuildFrames({"st_door_c_closed","st_door_c_open"},60)
+    DefAnim("st_door_c_opening", frames)
+    DefAnim("st_door_c_closing", ReverseFrames(frames))
 end
 
 -- st_quake --

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/doc/reference/enigma-ref.texi	2009-07-11 22:35:03 UTC (rev 1751)
@@ -9503,7 +9503,6 @@
 @end iftex
 @end macro
 @c
-WORK IN PROGRESS - The following table is still incomplete!
 @multitable @columnfractions .08 .25 .08 .25 .09 .25
 @item @image{images/fl_abyss, 12mm} @tab @yref{fl_abyss}
 @tab @image{images/fl_adhesionless, 12mm} @tab @yref{fl_adhesionless}
@@ -9543,15 +9542,23 @@
 @tab @image{images/fl_sahara, 12mm} @tab @yref{fl_sahara}
 @item @image{images/fl_samba, 12mm} @tab @yref{fl_samba}
 @tab @image{images/fl_sand, 12mm} @tab @yref{fl_sand}
- at tab @image{images/fl_space, 12mm} @tab @yref{fl_space}
- at item @image{images/fl_stone, 12mm} @tab @yref{fl_stone}
+ at tab @image{images/fl_slope_f, 12mm} @tab @yref{fl_slope}
+ at item @image{images/fl_slope, 12mm} @tab @yref{fl_slope}_ps
+ at tab @image{images/fl_slope_c, 12mm} @tab @yref{fl_slope}_ise
+ at tab @image{images/fl_slope_b, 12mm} @tab @yref{fl_slope}_ose
+ at item @image{images/fl_space, 12mm} @tab @yref{fl_space}
+ at tab @image{images/fl_stone, 12mm} @tab @yref{fl_stone}
 @tab @image{images/fl_swamp, 12mm} @tab @yref{fl_swamp}
- at tab @image{images/fl_tigris, 12mm} @tab @yref{fl_tigris}
- at item @image{images/fl_water, 12mm} @tab @yref{fl_water}
+ at item @image{images/fl_thief, 12mm} @tab @yref{fl_thief}
+ at tab @image{images/fl_thief_capture, 12mm} @tab @yref{fl_thief}
+ at tab @image{images/fl_thief_drunken, 12mm} @tab @yref{fl_thief}
+ at item @image{images/fl_tigris, 12mm} @tab @yref{fl_tigris}
+ at tab @image{images/fl_water, 12mm} @tab @yref{fl_water}
 @tab @image{images/fl_white, 12mm} @tab @yref{fl_white}
+ at item @image{images/fl_wood, 12mm} @tab @yref{fl_wood}
 @tab @image{images/fl_woven, 12mm} @tab @yref{fl_woven}
- at item @image{images/fl_yinyang_yang, 12mm} @tab @yref{fl_yinyang}_yang
- at tab @image{images/fl_yinyang_yin, 12mm} @tab @yref{fl_yinyang}_yin
+ at tab @image{images/fl_yinyang_yang, 12mm} @tab @yref{fl_yinyang}_yang
+ at item @image{images/fl_yinyang_yin, 12mm} @tab @yref{fl_yinyang}_yin
 @end multitable
 
 @c ----------------- Floor Attributes --------------------
@@ -9935,7 +9942,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_aquamarine, 12mm} @b{fl_aquamarine}
- at item @b{fl_aquamarine_framed} 
+ at item @image{images/fl_aquamarine_framed, 12mm} @b{fl_aquamarine_framed} 
 @end table
 @end table
 
@@ -9959,7 +9966,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_bast, 12mm} @b{fl_bast} 
- at item @b{fl_bast_framed}
+ at item @image{images/fl_bast_framed, 12mm} @b{fl_bast_framed}
 @end table
 @end table
 
@@ -9981,7 +9988,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_bluegray, 12mm} @b{fl_bluegray}
- at item @b{fl_bluegray_framed}
+ at item @image{images/fl_bluegray_framed, 12mm} @b{fl_bluegray_framed}
 @end table
 @end table
 
@@ -10003,7 +10010,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_bluegreen, 12mm} @b{fl_bluegreen}
- at item @b{fl_bluegreen_framed}
+ at item @image{images/fl_bluegreen_framed, 12mm} @b{fl_bluegreen_framed}
 @end table
 @end table
 
@@ -10026,7 +10033,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_blueslab, 12mm} @b{fl_blueslab}
- at item @b{fl_blueslab_framed}
+ at item @image{images/fl_blueslab_framed, 12mm} @b{fl_blueslab_framed}
 @end table
 @end table
 
@@ -10048,7 +10055,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_brick, 12mm} @b{fl_brick}
- at item @b{fl_brick_framed}
+ at item @image{images/fl_brick_framed, 12mm}  @b{fl_brick_framed}
 @end table
 @end table
 
@@ -10071,7 +10078,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_bright, 12mm} @b{fl_bright}
- at item @b{fl_bright_framed}
+ at item @image{images/fl_bright_framed, 12mm} @b{fl_bright_framed}
 @end table
 @end table
 
@@ -10093,7 +10100,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_concrete, 12mm} @b{fl_concrete}
- at item @b{fl_concrete_framed}
+ at item @image{images/fl_concrete_framed, 12mm} @b{fl_concrete_framed}
 @end table
 @end table
 
@@ -10116,7 +10123,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_dark, 12mm} @b{fl_dark}
- at item @b{fl_dark_framed}
+ at item @image{images/fl_dark_framed, 12mm} @b{fl_dark_framed}
 @end table
 @end table
 
@@ -10138,7 +10145,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_darkgray, 12mm} @b{fl_darkgray}
- at item @b{fl_darkgray_framed}
+ at item @image{images/fl_darkgray_framed, 12mm}@b{fl_darkgray_framed}
 @end table
 @end table
 
@@ -10160,7 +10167,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_dunes, 12mm} @b{fl_dunes}
- at item @b{fl_dunes_framed}
+ at item @image{images/fl_dunes_framed, 12mm} @b{fl_dunes_framed}
 @end table
 @end table
 
@@ -10182,7 +10189,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_gravel, 12mm} @b{fl_gravel}
- at item @b{fl_gravel_framed}
+ at item @image{images/fl_gravel_framed, 12mm} @b{fl_gravel_framed}
 @end table
 @end table
 
@@ -10204,7 +10211,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_gray, 12mm} @b{fl_gray}
- at item @b{fl_gray_framed}
+ at item @image{images/fl_gray_framed, 12mm} @b{fl_gray_framed}
 @end table
 @end table
 
@@ -10226,7 +10233,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_himalaya, 12mm} @b{fl_himalaya}
- at item @b{fl_himalaya_framed}
+ at item @image{images/fl_himalaya_framed, 12mm} @b{fl_himalaya_framed}
 @end table
 @end table
 
@@ -10248,7 +10255,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_ivory, 12mm} @b{fl_ivory}
- at item @b{fl_ivory_framed}
+ at item @image{images/fl_ivory_framed, 12mm} @b{fl_ivory_framed}
 @end table
 @end table
 
@@ -10271,24 +10278,24 @@
 @end table
 
 @item @b{Variants:}
- at table @asis
- at item @b{fl_lawn}: texture = @samp{"a"}
- at item @b{fl_lawn_a}: texture = @samp{"a"}
- at item @b{fl_lawn_b}: texture = @samp{"b"}
- at item @b{fl_lawn_c1}: texture = @samp{"c1"}
- at item @b{fl_lawn_c2}: texture = @samp{"c2"}
- at item @b{fl_lawn_c3}: texture = @samp{"c3"}
- at item @b{fl_lawn_c4}: texture = @samp{"c4"}
- at item @b{fl_lawn_d1}: texture = @samp{"d1"}
- at item @b{fl_lawn_d2}: texture = @samp{"d2"}
- at item @b{fl_lawn_d3}: texture = @samp{"d3"}
- at item @b{fl_lawn_d4}: texture = @samp{"d4"}
- at item @b{fl_lawn_e1}: texture = @samp{"e1"}
- at item @b{fl_lawn_e2}: texture = @samp{"e2"}
- at item @b{fl_lawn_e3}: texture = @samp{"e3"}
- at item @b{fl_lawn_e4}: texture = @samp{"e4"}
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/fl_lawn, 12mm} @tab @b{fl_lawn_a}: texture = @samp{"a"}
+ at tab @image{images/fl_lawn_c, 12mm} @tab @b{fl_lawn_b}: texture = @samp{"b"}
+ at item @image{images/fl_lawn_e, 12mm} @tab @b{fl_lawn_c1}: texture = @samp{"c1"}
+ at tab @image{images/fl_lawn_f, 12mm} @tab @b{fl_lawn_c3}: texture = @samp{"c3"}
+ at item @image{images/fl_lawn_e2, 12mm} @tab @b{fl_lawn_c2}: texture = @samp{"c2"}
+ at tab @image{images/fl_lawn_f2, 12mm} @tab @b{fl_lawn_c4}: texture = @samp{"c4"}
+ at item @image{images/fl_lawn_g, 12mm} @tab @b{fl_lawn_d1}: texture = @samp{"d1"}
+ at tab @image{images/fl_lawn_h, 12mm} @tab @b{fl_lawn_d3}: texture = @samp{"d3"}
+ at item @image{images/fl_lawn_g2, 12mm} @tab @b{fl_lawn_d2}: texture = @samp{"d2"}
+ at tab @image{images/fl_lawn_h2, 12mm} @tab @b{fl_lawn_d4}: texture = @samp{"d4"}
+ at item @image{images/fl_lawn_i, 12mm} @tab @b{fl_lawn_e1}: texture = @samp{"e1"}
+ at tab @image{images/fl_lawn_j, 12mm} @tab @b{fl_lawn_e3}: texture = @samp{"e3"}
+ at item @image{images/fl_lawn_i2, 12mm} @tab @b{fl_lawn_e2}: texture = @samp{"e2"}
+ at tab @image{images/fl_lawn_j2, 12mm} @tab @b{fl_lawn_e4}: texture = @samp{"e4"}
+ at item @image{images/fl_lawn, 12mm} @tab @b{fl_lawn}: texture = @samp{"a"}
+ at end multitable
 @end table
- at end table
 
 @c ----------------- Marble Floor --------------------
 @node fl_marble
@@ -10308,7 +10315,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_marble, 12mm} @b{fl_marble}
- at item @b{fl_marble_framed}
+ at item @image{images/fl_marble_framed, 12mm} @b{fl_marble_framed}
 @end table
 @end table
 
@@ -10330,25 +10337,25 @@
 @end table
 
 @item @b{Variants:}
- at table @asis
- at item @b{fl_metal}: texture = @samp{random}
- at item @b{fl_metal_1}: texture = @code{1}
- at item @b{fl_metal_2}: texture = @code{2}
- at item @b{fl_metal_3}: texture = @code{3}
- at item @b{fl_metal_4}: texture = @code{4}
- at item @b{fl_metal_5}: texture = @code{5}
- at item @b{fl_metal_6}: texture = @code{6}
- at item @b{fl_metal_7}: texture = @code{7}
- at item @b{fl_metal_framed}: texture = @samp{random}
- at item @b{fl_metal_1_framed}: texture = @code{1}
- at item @b{fl_metal_2_framed}: texture = @code{2}
- at item @b{fl_metal_3_framed}: texture = @code{3}
- at item @b{fl_metal_4_framed}: texture = @code{4}
- at item @b{fl_metal_5_framed}: texture = @code{5}
- at item @b{fl_metal_6_framed}: texture = @code{6}
- at item @b{fl_metal_7_framed}: texture = @code{7}
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/fl_metal, 12mm} @tab @b{fl_metal}: texture = @samp{random}
+ at tab @image{images/fl_metal_framed, 12mm} @tab @b{fl_metal_framed}: texture = @samp{random}
+ at item @image{images/fl_metal, 12mm} @tab @b{fl_metal_1}: texture = @code{1}
+ at tab @image{images/fl_metal_framed, 12mm} @tab @b{fl_metal_1_framed}: texture = @code{1}
+ at item @image{images/fl_metal_2, 12mm} @tab @b{fl_metal_2}: texture = @code{2}
+ at tab @image{images/construction, 12mm} @tab @b{fl_metal_2_framed}: texture = @code{2}
+ at item @image{images/fl_metal_3, 12mm} @tab @b{fl_metal_3}: texture = @code{3}
+ at tab @image{images/construction, 12mm} @tab @b{fl_metal_3_framed}: texture = @code{3}
+ at item @image{images/fl_metal_4, 12mm} @tab @b{fl_metal_4}: texture = @code{4}
+ at tab @image{images/construction, 12mm} @tab @b{fl_metal_4_framed}: texture = @code{4}
+ at item @image{images/fl_metal_5, 12mm} @tab @b{fl_metal_5}: texture = @code{5}
+ at tab @image{images/construction, 12mm} @tab @b{fl_metal_5_framed}: texture = @code{5}
+ at item @image{images/fl_metal_6, 12mm} @tab @b{fl_metal_6}: texture = @code{6}
+ at tab @image{images/construction, 12mm} @tab @b{fl_metal_6_framed}: texture = @code{6}
+ at item @image{images/fl_metal_7, 12mm} @tab @b{fl_metal_7}: texture = @code{7}
+ at tab @image{images/construction, 12mm} @tab @b{fl_metal_7_framed}: texture = @code{7}
+ at end multitable
 @end table
- at end table
 
 @c ----------------- Mortar Floor --------------------
 @node fl_mortar
@@ -10368,7 +10375,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_mortar, 12mm} @b{fl_mortar}
- at item @b{fl_mortar_framed}
+ at item @image{images/fl_mortar_framed, 12mm} @b{fl_mortar_framed}
 @end table
 @end table
 
@@ -10390,7 +10397,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_pinkbumps, 12mm} @b{fl_pinkbumps}
- at item @b{fl_pinkbumps_framed}
+ at item @image{images/fl_pinkbumps_framed, 12mm} @b{fl_pinkbumps_framed}
 @end table
 @end table
 
@@ -10414,7 +10421,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_plank, 12mm} @b{fl_plank}
- at item @b{fl_plank_framed}
+ at item @image{images/fl_plank_framed, 12mm} @b{fl_plank_framed}
 @end table
 @end table
 
@@ -10436,7 +10443,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_platinum, 12mm} @b{fl_platinum}
- at item @b{fl_platinum_framed}
+ at item @image{images/fl_platinum_framed, 12mm} @b{fl_platinum_framed}
 @end table
 @end table
 
@@ -10458,7 +10465,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_red, 12mm} @b{fl_red}
- at item @b{fl_red_framed}
+ at item @image{images/fl_red_framed, 12mm} @b{fl_red_framed}
 @end table
 @end table
 
@@ -10481,7 +10488,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_redslab, 12mm} @b{fl_redslab}
- at item @b{fl_redslab_framed}
+ at item @image{images/fl_redslab_framed, 12mm} @b{fl_redslab_framed}
 @end table
 @end table
 
@@ -10503,7 +10510,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_rough, 12mm} @b{fl_rough}
- at item @b{fl_rough_framed}
+ at item @image{images/fl_rough_framed, 12mm} @b{fl_rough_framed}
 @end table
 @end table
 
@@ -10525,7 +10532,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_sahara, 12mm} @b{fl_sahara}
- at item @b{fl_sahara_framed}
+ at item @image{images/fl_sahara_framed, 12mm} @b{fl_sahara_framed}
 @end table
 @end table
 
@@ -10550,12 +10557,12 @@
 
 @item @b{Variants:}
 @table @asis
- at item @b{fl_samba}: texture = @samp{random}
- at item @b{fl_samba_h}: texture = @code{"h"}
- at item @b{fl_samba_v}: texture = @code{"v"}
- at item @b{fl_samba_framed}: texture = @samp{random}
- at item @b{fl_samba_h_framed}: texture = @code{"h"}
- at item @b{fl_samba_v_framed}: texture = @code{"v"}
+ at item @image{images/fl_samba, 12mm} @b{fl_samba}: texture = @samp{random}
+ at item @image{images/fl_samba, 12mm} @b{fl_samba_h}: texture = @code{"h"}
+ at item @image{images/fl_samba_2, 12mm} @b{fl_samba_v}: texture = @code{"v"}
+ at item @image{images/fl_samba_framed, 12mm} @b{fl_samba_framed}: texture = @samp{random}
+ at item @image{images/fl_samba_framed, 12mm} @b{fl_samba_h_framed}: texture = @code{"h"}
+ at item @image{images/construction, 12mm} @b{fl_samba_v_framed}: texture = @code{"v"}
 @end table
 @end table
 
@@ -10577,7 +10584,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_sand, 12mm} @b{fl_sand}
- at item @b{fl_sand_framed}
+ at item @image{images/fl_sand_framed, 12mm} @b{fl_sand_framed}
 @end table
 @end table
 
@@ -10622,7 +10629,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_stone, 12mm} @b{fl_stone}
- at item @b{fl_stone_framed}
+ at item @image{images/fl_stone_framed, 12mm} @b{fl_stone_framed}
 @end table
 @end table
 
@@ -10644,7 +10651,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_tigris, 12mm} @b{fl_tigris}
- at item @b{fl_tigris_framed}
+ at item @image{images/fl_tigris_framed, 12mm} @b{fl_tigris_framed}
 @end table
 @end table
 
@@ -10666,7 +10673,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_white, 12mm} @b{fl_white}
- at item @b{fl_white_framed}
+ at item @image{images/fl_white_framed, 12mm} @b{fl_white_framed}
 @end table
 @end table
 
@@ -10688,7 +10695,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_woven, 12mm} @b{fl_woven}
- at item @b{fl_woven_framed}
+ at item @image{images/fl_woven_framed, 12mm} @b{fl_woven_framed}
 @end table
 @end table
 
@@ -10888,7 +10895,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_hay, 12mm} @b{fl_hay}
- at item @b{fl_hay_framed}: faces = @code{"nesw"}
+ at item @image{images/fl_hay_framed, 12mm} @b{fl_hay_framed}: faces = @code{"nesw"}
 @end table
 @end table
 
@@ -10973,7 +10980,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_rock, 12mm} @b{fl_rock}
- at item @b{fl_rock_framed}: faces = @code{"nesw"}
+ at item @image{images/fl_rock_framed, 12mm} @b{fl_rock_framed}: faces = @code{"nesw"}
 @end table
 @end table
 
@@ -11040,36 +11047,35 @@
 @item @b{Messages:} None
 
 @item @b{Variants:}
- at table @asis
- at item @b{fl_slope} slope = @samp{NODIR}, shape = @code{""}
- at item @b{fl_slope_pw} slope = @samp{WEST}, shape = @code{"pw"}
- at item @b{fl_slope_ps} slope = @samp{SOUTH}, shape = @code{"ps"}
- at item @b{fl_slope_pe} slope = @samp{EAST}, shape = @code{"pe"}
- at item @b{fl_slope_pn} slope = @samp{NORTH}, shape = @code{"pn"}
- at item @b{fl_slope_inw} slope = @samp{NORTHWEST}, shape = @code{"inw"}
- at item @b{fl_slope_isw} slope = @samp{SOUTHWEST}, shape = @code{"isw"}
- at item @b{fl_slope_ise} slope = @samp{SOUTHEAST}, shape = @code{"ise"}
- at item @b{fl_slope_ine} slope = @samp{NORTHEAST}, shape = @code{"ine"}
- at item @b{fl_slope_onw} slope = @samp{NORTHWEST}, shape = @code{"onw"}
- at item @b{fl_slope_osw} slope = @samp{SOUTHWEST}, shape = @code{"osw"}
- at item @b{fl_slope_ose} slope = @samp{SOUTHEAST}, shape = @code{"ose"}
- at item @b{fl_slope_one} slope = @samp{NORTHEAST}, shape = @code{"one"}
- at item @b{fl_slope_tw} slope = @samp{WEST}, shape = @code{"tw"}
- at item @b{fl_slope_ts} slope = @samp{SOUTH}, shape = @code{"ts"}
- at item @b{fl_slope_te} slope = @samp{EAST}, shape = @code{"te"}
- at item @b{fl_slope_tn} slope = @samp{NORTH}, shape = @code{"tn"}
- at item @b{fl_slope_twl} slope = @samp{NORTHWEST}, shape = @code{"twl"}
- at item @b{fl_slope_tsl} slope = @samp{SOUTHWEST}, shape = @code{"tsl"}
- at item @b{fl_slope_tel} slope = @samp{SOUTHEAST}, shape = @code{"tel"}
- at item @b{fl_slope_tnl} slope = @samp{NORTHEAST}, shape = @code{"tnl"}
- at item @b{fl_slope_twr} slope = @samp{SOUTHWEST}, shape = @code{"twr"}
- at item @b{fl_slope_tsr} slope = @samp{SOUTHEAST}, shape = @code{"tsr"}
- at item @b{fl_slope_ter} slope = @samp{NORTHEAST}, shape = @code{"ter"}
- at item @b{fl_slope_tnr} slope = @samp{NORTHWEST}, shape = @code{"tnr"}
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/fl_slope_f, 12mm} @tab @b{fl_slope} slope = @samp{NODIR}, shape = @code{""} @tab @tab
+ at item @image{images/fl_slope_4, 12mm} @tab @b{fl_slope_pw} slope = @samp{WEST}, shape = @code{"pw"}
+ at tab @image{images/fl_slope, 12mm} @tab @b{fl_slope_ps} slope = @samp{SOUTH}, shape = @code{"ps"}
+ at item @image{images/fl_slope_3, 12mm} @tab @b{fl_slope_pe} slope = @samp{EAST}, shape = @code{"pe"}
+ at tab @image{images/fl_slope_2, 12mm} @tab @b{fl_slope_pn} slope = @samp{NORTH}, shape = @code{"pn"}
+ at item @image{images/fl_slope_c4, 12mm} @tab @b{fl_slope_inw} slope = @samp{NORTHWEST}, shape = @code{"inw"}
+ at tab @image{images/fl_slope_c3, 12mm} @tab @b{fl_slope_isw} slope = @samp{SOUTHWEST}, shape = @code{"isw"}
+ at item @image{images/fl_slope_c, 12mm} @tab @b{fl_slope_ise} slope = @samp{SOUTHEAST}, shape = @code{"ise"}
+ at tab @image{images/fl_slope_c2, 12mm} @tab @b{fl_slope_ine} slope = @samp{NORTHEAST}, shape = @code{"ine"}
+ at item @image{images/fl_slope_b4, 12mm} @tab @b{fl_slope_onw} slope = @samp{NORTHWEST}, shape = @code{"onw"}
+ at tab @image{images/fl_slope_b2, 12mm} @tab @b{fl_slope_osw} slope = @samp{SOUTHWEST}, shape = @code{"osw"}
+ at item @image{images/fl_slope_b, 12mm} @tab @b{fl_slope_ose} slope = @samp{SOUTHEAST}, shape = @code{"ose"}
+ at tab @image{images/fl_slope_b3, 12mm} @tab @b{fl_slope_one} slope = @samp{NORTHEAST}, shape = @code{"one"}
+ at item @image{images/fl_slope_f, 12mm} @tab @b{fl_slope_tw} slope = @samp{WEST}, shape = @code{"tw"}
+ at tab @image{images/fl_slope_f, 12mm} @tab @b{fl_slope_ts} slope = @samp{SOUTH}, shape = @code{"ts"}
+ at item @image{images/fl_slope_f, 12mm} @tab @b{fl_slope_te} slope = @samp{EAST}, shape = @code{"te"}
+ at tab @image{images/fl_slope_f, 12mm} @tab @b{fl_slope_tn} slope = @samp{NORTH}, shape = @code{"tn"}
+ at item @image{images/fl_slope_2, 12mm} @tab @b{fl_slope_twl} slope = @samp{NORTHWEST}, shape = @code{"twl"}
+ at tab @image{images/fl_slope_4, 12mm} @tab @b{fl_slope_tsl} slope = @samp{SOUTHWEST}, shape = @code{"tsl"}
+ at item @image{images/fl_slope, 12mm} @tab @b{fl_slope_tel} slope = @samp{SOUTHEAST}, shape = @code{"tel"}
+ at tab @image{images/fl_slope_3, 12mm} @tab @b{fl_slope_tnl} slope = @samp{NORTHEAST}, shape = @code{"tnl"}
+ at item @image{images/fl_slope, 12mm} @tab @b{fl_slope_twr} slope = @samp{SOUTHWEST}, shape = @code{"twr"}
+ at tab @image{images/fl_slope_3, 12mm} @tab @b{fl_slope_tsr} slope = @samp{SOUTHEAST}, shape = @code{"tsr"}
+ at item @image{images/fl_slope_2, 12mm} @tab @b{fl_slope_ter} slope = @samp{NORTHEAST}, shape = @code{"ter"}
+ at tab @image{images/fl_slope_4, 12mm} @tab @b{fl_slope_tnr} slope = @samp{NORTHWEST}, shape = @code{"tnr"}
+ at end multitable
 @end table
 
- at end table
-
 @c ----------------- Swamp Floor --------------------
 @node fl_swamp
 @subsection fl_swamp
@@ -11140,7 +11146,10 @@
 
 @item @b{Variants:}
 @table @asis
- at item @image{images/fl_bluegray, 12mm} @b{fl_thief}
+ at item @image{images/fl_bluegray, 12mm} @b{fl_thief}: hidden
+ at item @image{images/fl_thief, 12mm} @b{fl_thief}: showing up at the moment when stealing items
+ at item @image{images/fl_thief_capture, 12mm} @b{fl_thief}: when being captured
+ at item @image{images/fl_thief_drunken, 12mm} @b{fl_thief}: drunken thief
 @end table
 @end table
 
@@ -11232,12 +11241,12 @@
 
 @item @b{Variants:}
 @table @asis
- at item @b{fl_wood}: texture = random
- at item @b{fl_wood_h}: texture = @code{"h"}
- at item @b{fl_wood_v}: texture = @code{"v"}
- at item @b{fl_wood_framed}: texture = random, faces = @code{"nesw"}
- at item @b{fl_wood_framed_h}: texture = @code{"h"}, faces = @code{"nesw"}
- at item @b{fl_wood_framed_v}: texture = @code{"v"}, faces = @code{"nesw"}
+ at item @image{images/fl_wood, 12mm} @b{fl_wood}: texture = random
+ at item @image{images/fl_wood_3, 12mm} @b{fl_wood_h}: texture = @code{"h"}
+ at item @image{images/fl_wood, 12mm} @b{fl_wood_v}: texture = @code{"v"}
+ at item @image{images/fl_wood_framed, 12mm} @b{fl_wood_framed}: texture = random, faces = @code{"nesw"}
+ at item @image{images/fl_wood_framed, 12mm} @b{fl_wood_framed_h}: texture = @code{"h"}, faces = @code{"nesw"}
+ at item @image{images/fl_wood_framed_2, 12mm} @b{fl_wood_framed_v}: texture = @code{"v"}, faces = @code{"nesw"}
 @end table
 @end table
 
@@ -11352,7 +11361,7 @@
 @tab @image{images/it_spring_drop, 12mm} @tab @yref{it_spring}_drop
 @tab @image{images/it_spring_keep, 12mm} @tab @yref{it_spring}_keep
 @item @image{images/it_squashed, 12mm} @tab @yref{it_squashed}
- at tab @image{images/it_strip, 12mm} @tab @yref{it_strip}
+ at tab @image{images/it_strip_b2, 12mm} @tab @yref{it_strip}_ew
 @tab @image{images/it_surprise, 12mm} @tab @yref{it_surprise}
 @item @image{images/it_sword, 12mm} @tab @yref{it_sword}
 @tab @image{images/it_trap, 12mm} @tab @yref{it_trap}
@@ -12401,10 +12410,10 @@
 
 @item @b{Variants:}
 @table @asis
- at item @image{images/fl_white, 12mm} @b{it_puller} orientation = @code{WEST}
- at item @image{images/fl_white, 12mm} @b{it_puller_w} orientation = @code{WEST}
- at item @image{images/fl_white, 12mm} @b{it_puller_s} orientation = @code{SOUTH}
- at item @image{images/fl_white, 12mm} @b{it_puller_e} orientation = @code{EAST}
+ at item @image{images/it_puller_4, 12mm} @b{it_puller} orientation = @code{WEST}
+ at item @image{images/it_puller_4, 12mm} @b{it_puller_w} orientation = @code{WEST}
+ at item @image{images/it_puller_3, 12mm} @b{it_puller_s} orientation = @code{SOUTH}
+ at item @image{images/it_puller_2, 12mm} @b{it_puller_e} orientation = @code{EAST}
 @item @image{images/it_puller, 12mm} @b{it_puller_n} orientation = @code{NORTH}
 @end table
 @end table
@@ -13717,28 +13726,26 @@
 @end table
 
 @item @b{Variants:}
- at table @asis
- at item @image{images/it_strip, 12mm} @b{it_strip}: connections = @code{""}
- at item @image{images/fl_white, 12mm} @b{it_strip_w}: connections = @code{"w"}
- at item @image{images/fl_white, 12mm} @b{it_strip_s}: connections = @code{"s"}
- at item @image{images/fl_white, 12mm} @b{it_strip_sw}: connections = @code{"sw"}
- at item @image{images/fl_white, 12mm} @b{it_strip_e}: connections = @code{"e"}
- at item @image{images/fl_white, 12mm} @b{it_strip_ew}: connections = @code{"ew"}
- at item @image{images/fl_white, 12mm} @b{it_strip_es}: connections = @code{"es"}
- at item @image{images/fl_white, 12mm} @b{it_strip_esw}: connections = @code{"esw"}
- at item @image{images/fl_white, 12mm} @b{it_strip_n}: connections = @code{"n"}
- at item @image{images/fl_white, 12mm} @b{it_strip_nw}: connections = @code{"nw"}
- at item @image{images/fl_white, 12mm} @b{it_strip_ns}: connections = @code{"ns"}
- at item @image{images/fl_white, 12mm} @b{it_strip_nsw}: connections = @code{"nsw"}
- at item @image{images/fl_white, 12mm} @b{it_strip_ne}: connections = @code{"ne"}
- at item @image{images/fl_white, 12mm} @b{it_strip_new}: connections = @code{"new"}
- at item @image{images/fl_white, 12mm} @b{it_strip_nes}: connections = @code{"nes"}
- at item @image{images/fl_white, 12mm} @b{it_strip_nesw}: connections = @code{"nesw"}
-
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/it_strip, 12mm}@tab @b{it_strip}: connections = @code{""}
+ at tab @image{images/it_strip_2, 12mm}@tab @b{it_strip_w}: connections = @code{"w"}
+ at item @image{images/it_strip_3, 12mm}@tab @b{it_strip_s}: connections = @code{"s"}
+ at tab @image{images/it_strip_4, 12mm}@tab @b{it_strip_sw}: connections = @code{"sw"}
+ at item @image{images/it_strip_b, 12mm}@tab @b{it_strip_e}: connections = @code{"e"}
+ at tab @image{images/it_strip_b2, 12mm}@tab @b{it_strip_ew}: connections = @code{"ew"}
+ at item @image{images/it_strip_b3, 12mm}@tab @b{it_strip_es}: connections = @code{"es"}
+ at tab @image{images/it_strip_b4, 12mm}@tab @b{it_strip_esw}: connections = @code{"esw"}
+ at item @image{images/it_strip_c, 12mm}@tab @b{it_strip_n}: connections = @code{"n"}
+ at tab @image{images/it_strip_c2, 12mm}@tab @b{it_strip_nw}: connections = @code{"nw"}
+ at item @image{images/it_strip_c3, 12mm}@tab @b{it_strip_ns}: connections = @code{"ns"}
+ at tab @image{images/it_strip_c4, 12mm}@tab @b{it_strip_nsw}: connections = @code{"nsw"}
+ at item @image{images/it_strip_d, 12mm}@tab @b{it_strip_ne}: connections = @code{"ne"}
+ at tab @image{images/it_strip_d2, 12mm}@tab @b{it_strip_new}: connections = @code{"new"}
+ at item @image{images/it_strip_d3, 12mm}@tab @b{it_strip_nes}: connections = @code{"nes"}
+ at tab @image{images/it_strip_d4, 12mm}@tab @b{it_strip_nesw}: connections = @code{"nesw"}
+ at end multitable
 @end table
 
- at end table
-
 @c ----------------- Trap Item --------------------
 @node it_trap
 @subsection it_trap
@@ -14025,14 +14032,13 @@
 @node Stone Overview
 @section Stone Overview
 
-WORK IN PROGRESS - The following table is still incomplete!
 @multitable @columnfractions .08 .25 .08 .25 .09 .25
 @item @image{images/st_actorimpulse, 12mm} @tab @yref{st_actorimpulse}
 @tab @image{images/st_ancient, 12mm} @tab @yref{st_ancient}
 @tab @image{images/st_beads, 12mm} @tab @yref{st_beads}
 @item @image{images/st_blocker, 12mm} @tab @yref{st_blocker}
 @tab @image{images/st_boulder, 12mm} @tab @yref{st_boulder}
- at tab @image{images/st_bluegray, 12mm} @tab @yref{st_bluegray}
+ at tab @image{images/st_bluegray, 12mm} @tab @yref{st_bluegray} or @yref{st_thief}
 @item @image{images/st_bluesand, 12mm} @tab @yref{st_bluesand}
 @tab @image{images/st_blur_cross, 12mm} @tab @yref{st_blur}_cross
 @tab @image{images/st_blur_straight, 12mm} @tab @yref{st_blur}_straight
@@ -14061,50 +14067,74 @@
 @tab @image{images/st_darkglass, 12mm} @tab @yref{st_darkglass}
 @tab @image{images/st_darkgray, 12mm} @tab @yref{st_darkgray}
 @item @image{images/st_death, 12mm} @tab @yref{st_death}
- at tab @image{images/st_dispenser_bombblack, 12mm} @tab @yref{st_dispenser}_bombblack
+ at tab @image{images/st_disco, 12mm} @tab @yref{st_disco}_light
+ at tab @image{images/st_disco_2, 12mm} @tab @yref{st_disco}_medium
+ at item @image{images/st_disco_3, 12mm} @tab @yref{st_disco}_dark
+ at tab @image{images/st_door_d_ew_g, 12mm} @tab @yref{st_door}_d (ew)
+ at tab @image{images/st_door_d_ns_7, 12mm} @tab @yref{st_door}_d (ns)
+ at item @image{images/st_dispenser_bombblack, 12mm} @tab @yref{st_dispenser}_bombblack
 @tab @image{images/st_dispenser_bombwhite, 12mm} @tab @yref{st_dispenser}_bombwhite
- at item @image{images/st_dispenser_dynamite, 12mm} @tab @yref{st_dispenser}_dynamite
+ at tab @image{images/st_dispenser_dynamite, 12mm} @tab @yref{st_dispenser}_dynamite
+ at item @image{images/st_dispenser_extralife, 12mm} @tab @yref{st_dispenser}_extralife
+ at tab @image{images/st_oxydc_open, 12mm} @tab @yref{st_fake}_oxydc (open)
 @tab @image{images/st_flash, 12mm} @tab @yref{st_flash}
- at tab @image{images/st_flat, 12mm} @tab @yref{st_flat}
- at item @image{images/st_floppy_off, 12mm} @tab @yref{st_floppy}_off
+ at item @image{images/st_flat, 12mm} @tab @yref{st_flat}
+ at tab @image{images/st_floppy_off, 12mm} @tab @yref{st_floppy}_off
 @tab @image{images/st_floppy_on, 12mm} @tab @yref{st_floppy}_on
- at tab @image{images/st_fourswitch, 12mm} @tab @yref{st_fourswitch}
- at item @image{images/st_granite, 12mm} @tab @yref{st_granite}
+ at item @image{images/st_fourswitch, 12mm} @tab @yref{st_fourswitch}
+ at tab @image{images/st_granite, 12mm} @tab @yref{st_granite}
 @tab @image{images/st_grate_cross, 12mm} @tab @yref{st_grate}_cross
- at tab @image{images/st_grate_framed, 12mm} @tab @yref{st_grate}_framed
- at item @image{images/st_greenbrown, 12mm} @tab @yref{st_greenbrown}
+ at item @image{images/st_grate_framed, 12mm} @tab @yref{st_grate}_framed
+ at tab @image{images/st_greenbrown, 12mm} @tab @yref{st_greenbrown}
 @tab @image{images/st_greengray, 12mm} @tab @yref{st_greengray}
- at tab @image{images/st_ice, 12mm} @tab @yref{st_ice}
- at item                            @tab @yref{st_invisible}
+ at item @image{images/st_ice, 12mm} @tab @yref{st_ice}
+ at tab                            @tab @yref{st_invisible}
 @tab @image{images/st_jamb_black, 12mm} @tab @yref{st_jamb}_black
- at tab @image{images/st_jamb_white, 12mm} @tab @yref{st_jamb}_white
- at item @image{images/st_key_off, 12mm} @tab @yref{st_key}_off
+ at item @image{images/st_jamb_white, 12mm} @tab @yref{st_jamb}_white
+ at tab @image{images/st_key_off, 12mm} @tab @yref{st_key}_off
 @tab @image{images/st_key_on, 12mm} @tab @yref{st_key}_on
- at tab @image{images/st_knight, 12mm} @tab @yref{st_knight}
- at item @image{images/st_lightglass, 12mm} @tab @yref{st_lightglass}
- at tab @image{images/st_lightpassenger, 12mm} @tab @yref{st_lightpassenger}
+ at item @image{images/st_knight, 12mm} @tab @yref{st_knight}
+ at tab @image{images/st_laser_w_0001, 12mm} @tab @yref{st_laser}
+ at tab @image{images/st_lightglass, 12mm} @tab @yref{st_lightglass}
+ at item @image{images/st_lightpassenger, 12mm} @tab @yref{st_lightpassenger}
+ at tab @image{images/st_mail, 12mm} @tab @yref{st_mail}
 @tab @image{images/st_metal, 12mm} @tab @yref{st_metal}
- at item @image{images/st_oxyda, 12mm} @tab @yref{st_oxyd}_a
+ at item @image{images/st_mirror_static_04, 12mm} @tab @yref{st_mirror}_triangle
+ at tab @image{images/st_mirror_static_08, 12mm} @tab @yref{st_mirror}_triangle
+ at tab @image{images/st_mirror_static_12, 12mm} @tab @yref{st_mirror}_slab
+ at item @image{images/st_mirror_static_16, 12mm} @tab @yref{st_mirror}_slab
+ at tab @image{images/st_mirror_static_20, 12mm} @tab @yref{st_mirror}_sheets
+ at tab @image{images/st_monoflop, 12mm} @tab @yref{st_monoflop}
+ at item @image{images/st_monoflop_2, 12mm} @tab @yref{st_monoflop}
+ at tab @image{images/st_oneway, 12mm} @tab @yref{st_oneway}
+ at tab @image{images/st_oneway_b, 12mm} @tab @yref{st_oneway}_black
+ at item @image{images/st_oneway_c, 12mm} @tab @yref{st_oneway}_white
+ at tab @image{images/st_oxyda, 12mm} @tab @yref{st_oxyd}_a
 @tab @image{images/st_oxydb, 12mm} @tab @yref{st_oxyd}_b
- at tab @image{images/st_oxydc, 12mm} @tab @yref{st_oxyd}_c
- at item @image{images/st_oxydd, 12mm} @tab @yref{st_oxyd}_d
+ at item @image{images/st_oxydc, 12mm} @tab @yref{st_oxyd}_c
+ at tab @image{images/st_oxydd, 12mm} @tab @yref{st_oxyd}_d
 @tab @image{images/st_oxyde, 12mm} @tab @yref{st_oxyd}_e
- at tab @image{images/st_panel, 12mm} @tab @yref{st_panel}
- at item @image{images/st_passage_black_square, 12mm} @tab @yref{st_passage}_black
+ at item @image{images/st_panel, 12mm} @tab @yref{st_panel}
+ at tab @image{images/st_passage_black_square, 12mm} @tab @yref{st_passage}_black
 @tab @image{images/st_passage_black_slash, 12mm} @tab @yref{st_passage}_black
- at tab @image{images/st_passage_black_cross, 12mm} @tab @yref{st_passage}_black
- at item @image{images/st_passage_black_frame, 12mm} @tab @yref{st_passage}_black
+ at item @image{images/st_passage_black_cross, 12mm} @tab @yref{st_passage}_black
+ at tab @image{images/st_passage_black_frame, 12mm} @tab @yref{st_passage}_black
 @tab @image{images/st_passage_white_square, 12mm} @tab @yref{st_passage}_white
- at tab @image{images/st_passage_white_slash, 12mm} @tab @yref{st_passage}_white
- at item @image{images/st_passage_white_cross, 12mm} @tab @yref{st_passage}_white
+ at item @image{images/st_passage_white_slash, 12mm} @tab @yref{st_passage}_white
+ at tab @image{images/st_passage_white_cross, 12mm} @tab @yref{st_passage}_white
 @tab @image{images/st_passage_white_frame, 12mm} @tab @yref{st_passage}_white
- at tab @image{images/st_pinkbumps, 12mm} @tab @yref{st_pinkbumps}
- at item @image{images/st_plaster, 12mm} @tab @yref{st_plaster}
+ at item @image{images/st_pinkbumps, 12mm} @tab @yref{st_pinkbumps}
+ at tab @image{images/st_plaster, 12mm} @tab @yref{st_plaster}
 @tab @image{images/st_plop_slate, 12mm} @tab @yref{st_plop}_slate
- at tab @image{images/st_portal_horse, 12mm} @tab @yref{st_portal}
- at item @image{images/st_pull, 12mm} @tab @yref{st_pull}
+ at item @image{images/st_portal_horse, 12mm} @tab @yref{st_portal}
+ at tab @image{images/st_pull, 12mm} @tab @yref{st_pull}
 @tab @image{images/st_purplegray, 12mm} @tab @yref{st_purplegray}
- at tab @image{images/st_purplemarble, 12mm} @tab @yref{st_purplemarble}
+ at item @image{images/st_purplemarble, 12mm} @tab @yref{st_purplemarble}
+ at tab @image{images/st_puzzle_blue_3, 12mm} @tab @yref{st_puzzle}_blue or @yref{st_turnstilearm}_n
+ at tab @image{images/st_puzzle_blue_d3, 12mm} @tab @yref{st_puzzle}_blue
+ at item @image{images/st_puzzle_blue_hollow_d3, 12mm} @tab @yref{st_puzzle}_blue
+ at tab @image{images/st_puzzle_yellow_d3, 12mm} @tab @yref{st_puzzle}_yellow
+ at tab @image{images/st_puzzle_yellow_hollow_d3, 12mm} @tab @yref{st_puzzle}_yellow
 @item @image{images/st_rawglass, 12mm} @tab @yref{st_rawglass}
 @tab @image{images/st_rawglass_quad, 12mm} @tab @yref{st_rawglass}_quad
 @tab @image{images/st_redbrown, 12mm} @tab @yref{st_redbrown}
@@ -14115,6 +14145,9 @@
 @tab @image{images/st_rotator_cw, 12mm} @tab @yref{st_rotator}_cw
 @tab @image{images/st_rubberband, 12mm} @tab @yref{st_rubberband}
 @item @image{images/st_scissors, 12mm} @tab @yref{st_scissors}
+ at tab @image{images/st_shogun, 12mm} @tab @yref{st_shogun}_s
+ at tab @image{images/st_shogun_2, 12mm} @tab @yref{st_shogun}_m
+ at item @image{images/st_shogun_4, 12mm} @tab @yref{st_shogun}_l
 @tab @image{images/st_spitter_idle, 12mm} @tab @yref{st_spitter}
 @tab @image{images/st_stoneimpulse, 12mm} @tab @yref{st_stoneimpulse}
 @item @image{images/st_stoneimpulse_hollow, 12mm} @tab @yref{st_stoneimpulse}_hollow
@@ -14123,15 +14156,23 @@
 @item @image{images/st_switch, 12mm} @tab @yref{st_switch}
 @tab @image{images/st_switch_black, 12mm} @tab @yref{st_switch}_black
 @tab @image{images/st_switch_white, 12mm} @tab @yref{st_switch}_white
+ at item @image{images/st_thief, 12mm} @tab @yref{st_thief}
+ at tab @image{images/st_thief_capture, 12mm} @tab @yref{st_thief}
+ at tab @image{images/st_thief_drunken, 12mm} @tab @yref{st_thief}
 @item @image{images/st_tigris, 12mm} @tab @yref{st_tigris}
- at tab @image{images/st_turnstile, 12mm} @tab @yref{st_turnstile}
+ at tab @image{images/st_timer, 12mm} @tab @yref{st_timer}
+ at tab @image{images/st_timer_2, 12mm} @tab @yref{st_timer}
+ at item @image{images/st_turnstile, 12mm} @tab @yref{st_turnstile}
 @tab @image{images/st_turnstile_green, 12mm} @tab @yref{st_turnstile}_green
- at item @image{images/st_woven, 12mm} @tab @yref{st_woven}
+ at tab @image{images/st_window_blue_3, 12mm} @tab @yref{st_window}
+ at item @image{images/st_window_green_3, 12mm} @tab @yref{st_window}
+ at tab @image{images/st_woven, 12mm} @tab @yref{st_woven}
 @tab @image{images/st_yellow, 12mm} @tab @yref{st_yellow}
- at tab @image{images/st_yinyang, 12mm} @tab @yref{st_yinyang}
- at item @image{images/st_yinyang_inactive, 12mm} @tab @yref{st_yinyang}_inactive 
+ at item @image{images/st_yinyang, 12mm} @tab @yref{st_yinyang}
+ at tab @image{images/st_yinyang_inactive, 12mm} @tab @yref{st_yinyang}_inactive 
 @end multitable
 
+
 @c ----------------- Stone Attributes --------------------
 @node Stone Attributes
 @section Stone Attributes
@@ -14668,28 +14709,26 @@
 
 @table @asis
 @item @b{Variants:}
- at table @asis
- at item @image{images/st_bluesand, 12mm} @b{st_bluesand}: connections = @code{""}
- at item @b{st_bluesand_w}: connections = @code{"w"}
- at item @b{st_bluesand_s}: connections = @code{"s"}
- at item @b{st_bluesand_sw}: connections = @code{"sw"}
- at item @b{st_bluesand_e}: connections = @code{"e"}
- at item @b{st_bluesand_ew}: connections = @code{"ew"}
- at item @b{st_bluesand_es}: connections = @code{"es"}
- at item @b{st_bluesand_esw}: connections = @code{"esw"}
- at item @b{st_bluesand_n}: connections = @code{"n"}
- at item @b{st_bluesand_nw}: connections = @code{"nw"}
- at item @b{st_bluesand_ns}: connections = @code{"ns"}
- at item @b{st_bluesand_nsw}: connections = @code{"nsw"}
- at item @b{st_bluesand_ne}: connections = @code{"ne"}
- at item @b{st_bluesand_new}: connections = @code{"new"}
- at item @b{st_bluesand_nes}: connections = @code{"nes"}
- at item @b{st_bluesand_nesw}: connections = @code{"nesw"}
-
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/st_bluesand, 12mm}@tab @b{st_bluesand}: connections = @code{""}
+ at tab @image{images/st_bluesand_2, 12mm}@tab @b{st_bluesand_w}: connections = @code{"w"}
+ at item @image{images/st_bluesand_3, 12mm}@tab @b{st_bluesand_s}: connections = @code{"s"}
+ at tab @image{images/st_bluesand_4, 12mm}@tab @b{st_bluesand_sw}: connections = @code{"sw"}
+ at item @image{images/st_bluesand_b, 12mm}@tab @b{st_bluesand_e}: connections = @code{"e"}
+ at tab @image{images/st_bluesand_b2, 12mm}@tab @b{st_bluesand_ew}: connections = @code{"ew"}
+ at item @image{images/st_bluesand_b3, 12mm}@tab @b{st_bluesand_es}: connections = @code{"es"}
+ at tab @image{images/st_bluesand_b4, 12mm}@tab @b{st_bluesand_esw}: connections = @code{"esw"}
+ at item @image{images/st_bluesand_c, 12mm}@tab @b{st_bluesand_n}: connections = @code{"n"}
+ at tab @image{images/st_bluesand_c2, 12mm}@tab @b{st_bluesand_nw}: connections = @code{"nw"}
+ at item @image{images/st_bluesand_c3, 12mm}@tab @b{st_bluesand_ns}: connections = @code{"ns"}
+ at tab @image{images/st_bluesand_c4, 12mm}@tab @b{st_bluesand_nsw}: connections = @code{"nsw"}
+ at item @image{images/st_bluesand_d, 12mm}@tab @b{st_bluesand_ne}: connections = @code{"ne"}
+ at tab @image{images/st_bluesand_d2, 12mm}@tab @b{st_bluesand_new}: connections = @code{"new"}
+ at item @image{images/st_bluesand_d3, 12mm}@tab @b{st_bluesand_nes}: connections = @code{"nes"}
+ at tab @image{images/st_bluesand_d4, 12mm}@tab @b{st_bluesand_nesw}: connections = @code{"nesw"}
+ at end multitable
 @end table
 
- at end table
-
 @c ----------------- Brick Stone --------------------
 @node st_brick
 @subsection st_brick
@@ -14700,27 +14739,25 @@
 
 @table @asis
 @item @b{Variants:}
- at table @asis
- at item @image{images/st_brick, 12mm} @b{st_brick}: connections = @code{""}
- at item @b{st_brick_w}: connections = @code{"w"}
- at item @b{st_brick_s}: connections = @code{"s"}
- at item @b{st_brick_sw}: connections = @code{"sw"}
- at item @b{st_brick_e}: connections = @code{"e"}
- at item @b{st_brick_ew}: connections = @code{"ew"}
- at item @b{st_brick_es}: connections = @code{"es"}
- at item @b{st_brick_esw}: connections = @code{"esw"}
- at item @b{st_brick_n}: connections = @code{"n"}
- at item @b{st_brick_nw}: connections = @code{"nw"}
- at item @b{st_brick_ns}: connections = @code{"ns"}
- at item @b{st_brick_nsw}: connections = @code{"nsw"}
- at item @b{st_brick_ne}: connections = @code{"ne"}
- at item @b{st_brick_new}: connections = @code{"new"}
- at item @b{st_brick_nes}: connections = @code{"nes"}
- at item @b{st_brick_nesw}: connections = @code{"nesw"}
-
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/st_brick, 12mm}@tab @b{st_brick}: connections = @code{""}
+ at tab @image{images/st_brick_2, 12mm}@tab @b{st_brick_w}: connections = @code{"w"}
+ at item @image{images/st_brick_3, 12mm}@tab @b{st_brick_s}: connections = @code{"s"}
+ at tab @image{images/st_brick_4, 12mm}@tab @b{st_brick_sw}: connections = @code{"sw"}
+ at item @image{images/st_brick_b, 12mm}@tab @b{st_brick_e}: connections = @code{"e"}
+ at tab @image{images/st_brick_b2, 12mm}@tab @b{st_brick_ew}: connections = @code{"ew"}
+ at item @image{images/st_brick_b3, 12mm}@tab @b{st_brick_es}: connections = @code{"es"}
+ at tab @image{images/st_brick_b4, 12mm}@tab @b{st_brick_esw}: connections = @code{"esw"}
+ at item @image{images/st_brick_c, 12mm}@tab @b{st_brick_n}: connections = @code{"n"}
+ at tab @image{images/st_brick_c2, 12mm}@tab @b{st_brick_nw}: connections = @code{"nw"}
+ at item @image{images/st_brick_c3, 12mm}@tab @b{st_brick_ns}: connections = @code{"ns"}
+ at tab @image{images/st_brick_c4, 12mm}@tab @b{st_brick_nsw}: connections = @code{"nsw"}
+ at item @image{images/st_brick_d, 12mm}@tab @b{st_brick_ne}: connections = @code{"ne"}
+ at tab @image{images/st_brick_d2, 12mm}@tab @b{st_brick_new}: connections = @code{"new"}
+ at item @image{images/st_brick_d3, 12mm}@tab @b{st_brick_nes}: connections = @code{"nes"}
+ at tab @image{images/st_brick_d4, 12mm}@tab @b{st_brick_nesw}: connections = @code{"nesw"}
+ at end multitable
 @end table
-
- at end table
 @c ----------------- Panel Stone --------------------
 @node st_panel
 @subsection st_panel
@@ -14731,29 +14768,27 @@
 
 @table @asis
 @item @b{Variants:}
- at table @asis
- at item @image{images/st_panel, 12mm} @b{st_panel}: connections = @code{""}
- at item @b{st_panel_w}: connections = @code{"w"}
- at item @b{st_panel_s}: connections = @code{"s"}
- at item @b{st_panel_sw}: connections = @code{"sw"}
- at item @b{st_panel_e}: connections = @code{"e"}
- at item @b{st_panel_ew}: connections = @code{"ew"}
- at item @b{st_panel_es}: connections = @code{"es"}
- at item @b{st_panel_esw}: connections = @code{"esw"}
- at item @b{st_panel_n}: connections = @code{"n"}
- at item @b{st_panel_nw}: connections = @code{"nw"}
- at item @b{st_panel_ns}: connections = @code{"ns"}
- at item @b{st_panel_nsw}: connections = @code{"nsw"}
- at item @b{st_panel_ne}: connections = @code{"ne"}
- at item @b{st_panel_new}: connections = @code{"new"}
- at item @b{st_panel_nes}: connections = @code{"nes"}
- at item @b{st_panel_nesw}: connections = @code{"nesw"}
-
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/st_panel, 12mm}@tab  @b{st_panel}: connections = @code{""}
+ at tab @image{images/st_panel_2, 12mm}@tab @b{st_panel_w}: connections = @code{"w"}
+ at item @image{images/st_panel_3, 12mm}@tab @b{st_panel_s}: connections = @code{"s"}
+ at tab @image{images/st_panel_4, 12mm}@tab @b{st_panel_sw}: connections = @code{"sw"}
+ at item @image{images/st_panel_b, 12mm}@tab @b{st_panel_e}: connections = @code{"e"}
+ at tab @image{images/st_panel_b2, 12mm}@tab @b{st_panel_ew}: connections = @code{"ew"}
+ at item @image{images/st_panel_b3, 12mm}@tab @b{st_panel_es}: connections = @code{"es"}
+ at tab @image{images/st_panel_b4, 12mm}@tab @b{st_panel_esw}: connections = @code{"esw"}
+ at item @image{images/st_panel_c, 12mm}@tab @b{st_panel_n}: connections = @code{"n"}
+ at tab @image{images/st_panel_c2, 12mm}@tab @b{st_panel_nw}: connections = @code{"nw"}
+ at item @image{images/st_panel_c3, 12mm}@tab @b{st_panel_ns}: connections = @code{"ns"}
+ at tab @image{images/st_panel_c4, 12mm}@tab @b{st_panel_nsw}: connections = @code{"nsw"}
+ at item @image{images/st_panel_d, 12mm}@tab @b{st_panel_ne}: connections = @code{"ne"}
+ at tab @image{images/st_panel_d2, 12mm}@tab @b{st_panel_new}: connections = @code{"new"}
+ at item @image{images/st_panel_d3, 12mm}@tab @b{st_panel_nes}: connections = @code{"nes"}
+ at tab @image{images/st_panel_d4, 12mm}@tab @b{st_panel_nesw}: connections = @code{"nesw"}
+ at end multitable
 @end table
 
- at end table
 
-
 @c ----------------- Special Stones --------------------
 @node Special Stones
 @section Special Stones
@@ -15102,9 +15137,9 @@
 @table @asis
 @item @image{images/st_boulder, 12mm} @b{st_boulder}
 @item @image{images/st_boulder, 12mm} @b{st_boulder_n}: orientation = @code{NORTH}
- at item @image{images/fl_white, 12mm} @b{st_boulder_e}: orientation = @code{EAST}
- at item @image{images/fl_white, 12mm} @b{st_boulder_s}: orientation = @code{SOUTH}
- at item @image{images/fl_white, 12mm} @b{st_boulder_w}: orientation = @code{WEST}
+ at item @image{images/st_boulder_b, 12mm} @b{st_boulder_e}: orientation = @code{EAST}
+ at item @image{images/st_boulder_c, 12mm} @b{st_boulder_s}: orientation = @code{SOUTH}
+ at item @image{images/st_boulder_d, 12mm} @b{st_boulder_w}: orientation = @code{WEST}
 @end table
 
 @end table
@@ -15170,10 +15205,10 @@
 @item @image{images/st_box_wood, 12mm} @b{st_box}: flavor=@code{"wood"}
 @item @image{images/st_box_wood, 12mm} @b{st_box_wood}: flavor=@code{"wood"}
 @item @image{images/st_box_wood, 12mm} @b{st_box_wood_h}: flavor=@code{"wood"}
- at item @image{images/fl_white, 12mm} @b{st_box_wood_v}: flavor=@code{"wood"}
- at item @image{images/fl_white, 12mm} @b{st_box_wood_growing}: flavor=@code{"wood"}
+ at item @image{images/st_box_wood_2, 12mm} @b{st_box_wood_v}: flavor=@code{"wood"}
+ at item @image{images/st_box_wood_growing, 12mm} @b{st_box_wood_growing}: flavor=@code{"wood"}
 @item @image{images/st_box_hay, 12mm} @b{st_box_hay}: flavor=@code{"hay"}
- at item @image{images/fl_white, 12mm} @b{st_box_hay_growing}: flavor=@code{"hay"}
+ at item @image{images/st_box_hay_growing, 12mm} @b{st_box_hay_growing}: flavor=@code{"hay"}
 @item @image{images/st_box_rock, 12mm} @b{st_box_rock}: flavor=@code{"rock"}
 @end table
 
@@ -15641,10 +15676,10 @@
 
 @item @b{Variants:}
 @table @asis
- at item @b{st_disco}: state = @code{LIGHT}
- at item @b{st_disco_light}: state = @code{LIGHT}
- at item @b{st_disco_medium}: state = @code{MEDIUM}
- at item @b{st_disco_dark}: state = @code{DARK}
+ at item @image{images/st_disco, 12mm} @b{st_disco}: state = @code{LIGHT}
+ at item @image{images/st_disco, 12mm} @b{st_disco_light}: state = @code{LIGHT}
+ at item @image{images/st_disco_2, 12mm} @b{st_disco_medium}: state = @code{MEDIUM}
+ at item @image{images/st_disco_3, 12mm} @b{st_disco_dark}: state = @code{DARK}
 @end table
 
 @end table
@@ -15657,13 +15692,13 @@
 An item dispenser in some item flavors.
 
 On every actor hit the dispenser adds a new item given by the attribute 
- at samp{flavor}, namely @ref{it_bomb} in color black or white, or @ref{it_dynamite},
-to the inventory of the actor's owner. Of course an item will just be added
-if the inventory is capable of adding a further item. Additionally the 
-dispenser's @samp{stock} must supply a further item. The default stock of 1000
-items should be enough for usual demands. But you can limit the supply to just
-a few counted items. This @samp{stock} attribute gets decremented every time
-an actor takes an item.
+ at samp{flavor}, namely @ref{it_bomb} in color black or white, @ref{it_dynamite}
+or @ref{it_extralife} to the inventory of the actor's owner. Of course an item 
+will just be added if the inventory is capable of adding a further item. 
+Additionally the dispenser's @samp{stock} must supply a further item. The 
+default stock of 1000 items should be enough for usual demands. But you can 
+limit the supply to just a few counted items. This @samp{stock} attribute gets
+decremented every time an actor takes an item.
 
 The dispenser stone does break on adjacent @ref{it_bomb} explosions and 
 adjacent dispenser stone breaks. On its break it will itself cause adjacent
@@ -15676,7 +15711,7 @@
 @item @b{Attributes:}
 
 @table @asis
- at item @b{flavor} @ @ @i{values}: @code{"bombblack"}, @code{"bombwhite"}, @code{"dynamite"}; @ @ @i{default}: @code{"bombblack"};
+ at item @b{flavor} @ @ @i{values}: @code{"bombblack"}, @code{"bombwhite"}, @code{"dynamite"}, @code{"extralife"}; @ @ @i{default}: @code{"bombblack"};
 @item @b{stock}, @ @ @i{values}: integer numbers; @ @ @i{default}: @code{1000}: @ @ @xref{state}
 @end table
 
@@ -15691,6 +15726,7 @@
 @item @image{images/st_dispenser_bombblack, 12mm} @b{st_dispenser_bombblack}: flavor=@code{"bombblack"}
 @item @image{images/st_dispenser_bombwhite, 12mm} @b{st_dispenser_bombwhite}: flavor=@code{"bombwhite"}
 @item @image{images/st_dispenser_dynamite, 12mm} @b{st_dispenser_dynamite}: flavor=@code{"dynamite"}
+ at item @image{images/st_dispenser_extralife, 12mm} @b{st_dispenser_extralife}: flavor=@code{"extralife"}
 @end table
 
 @end table
@@ -15709,10 +15745,10 @@
 represent grid filling block doors. Flavor @code{"a"} looks in the closed state
 like @ref{st_oxyd} of flavor @code{"a"} and in the opened state like an
 @ref{st_grate} of flavor @code{"cross"}. Flavor @code{"b"} looks in the closed 
-state like @ref{st_flat} and in the opened state like an @ref{st_grate} of
-flavor @code{"framed"}. Flavor @code{"c"} looks in the closed state like
- at ref{st_flat} but opens to an invisible, free passable, but still existing and
-grid blocking stone. The flavor @code{"d"} represents a faces based door, that 
+state like @ref{st_flat} but opens to an invisible, free passable, but still
+existing and grid blocking stone. Flavor @code{"c"} looks in the closed state
+like @ref{st_flat} and in the opened state like an @ref{st_grate} of flavor
+ at code{"framed"}. The flavor @code{"d"} represents a faces based door, that 
 opens or blocks just the given faces of the grid. Currently just the 
 combinations of two parallel aligned door faces, aka horizontal and vertical 
 doors, are supported.
@@ -15788,13 +15824,18 @@
 objects like @ref{st_jamb}.
 
 @item @b{Variants:}
- at table @asis
- at item @b{st_door}: flavor = @code{"d"}
- at item @b{st_door_a}: flavor = @code{"a"}
- at item @b{st_door_b}: flavor = @code{"b"}
- at item @b{st_door_c}: flavor = @code{"c"}
- at item @b{st_door_d}: flavor = @code{"d"}
- at end table
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/st_oxyda, 12mm}@tab  @b{st_door_a}: flavor = @code{"a"}, state = @code{CLOSED}
+ at tab @image{images/st_grate_cross, 12mm}@tab  @b{st_door_a}: flavor = @code{"a"}, state = @code{OPEN}
+ at item @image{images/st_flat, 12mm}@tab  @b{st_door_b}: flavor = @code{"b"}, state = @code{CLOSED}
+ at tab @image{images/fl_white, 12mm}@tab  @b{st_door_b}: flavor = @code{"b"}, state = @code{OPEN}
+ at item @image{images/st_flat, 12mm}@tab  @b{st_door_c}: flavor = @code{"c"}, state = @code{CLOSED}
+ at tab @image{images/st_grate_framed, 12mm}@tab  @b{st_door_c}: flavor = @code{"c"}, state = @code{OPEN}
+ at item @image{images/st_door_d_ns_7, 12mm}@tab  @b{st_door_d}: flavor = @code{"d"}, faces = @code{"ns"}, state = @code{CLOSED}
+ at tab @image{images/st_door_d_ns, 12mm}@tab  @b{st_door_d}: flavor = @code{"d"}, faces = @code{"ns"}, state = @code{OPEN}
+ at item @image{images/st_door_d_ew_g, 12mm}@tab  @b{st_door_d}: flavor = @code{"d"}, faces = @code{"ew"}, state = @code{CLOSED}
+ at tab @image{images/st_door_d_ew, 12mm}@tab  @b{st_door_d}: flavor = @code{"d"}, faces = @code{"ew"}, state = @code{OPEN}
+ at end multitable
 
 @end table
 
@@ -15834,19 +15875,23 @@
 @item @b{Action:} none
 
 @item @b{Variants:}
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/st_oxydb, 12mm} @b{st_fake_quake}: flavor=@code{"quake"}, state=@code{IDLE}
+ at tab @image{images/st_fakeoxyd_blink_0003, 12mm} @b{st_fake_quake}: flavor=@code{"quake"}, state=@code{ACTIVE}
+ at item @image{images/st_oxyda, 12mm} @b{st_fake_oxyda}: flavor=@code{"oxyda"}, state=@code{CLOSED}
+ at tab @image{images/st_oxyda_open, 12mm} @b{st_fake_oxyda}: flavor=@code{"oxyda"}, state=@code{OPEN}
+ at item @image{images/st_oxydb, 12mm} @b{st_fake_oxydb}: flavor=@code{"oxydb"}, state=@code{CLOSED}
+ at tab @image{images/st_oxydb_open, 12mm} @b{st_fake_oxydb}: flavor=@code{"oxydb"}, state=@code{OPEN}
+ at item @image{images/st_oxydc, 12mm} @b{st_fake_oxydc}: flavor=@code{"oxydc"}, state=@code{CLOSED}
+ at tab @image{images/st_oxydc_open, 12mm} @b{st_fake_oxydc}: flavor=@code{"oxydc"}, state=@code{OPEN}
+ at item @image{images/st_oxydd, 12mm} @b{st_fake_oxydd}: flavor=@code{"oxydd"}, state=@code{CLOSED}
+ at tab @image{images/st_oxydb_open, 12mm} @b{st_fake_oxydd}: flavor=@code{"oxydd"}, state=@code{OPEN}
+ at item @image{images/st_oxydb, 12mm} @b{st_fake_oxyde}: flavor=@code{"oxyde"}, state=@code{CLOSED}
+ at tab @image{images/st_oxydb_open, 12mm} @b{st_fake_oxyde}: flavor=@code{"oxyde"}, state=@code{OPEN}
+ at end multitable
 
- at table @asis
- at item @b{st_fake}: flavor=@code{"quake"}, state=@code{IDLE}
- at item @b{st_fake_quake}: flavor=@code{"quake"}, state=@code{IDLE}
- at item @b{st_fake_oxyda}: flavor=@code{"oxyda"}, state=@code{CLOSED}
- at item @b{st_fake_oxydb}: flavor=@code{"oxydb"}, state=@code{CLOSED}
- at item @b{st_fake_oxydc}: flavor=@code{"oxydc"}, state=@code{CLOSED}
- at item @b{st_fake_oxydd}: flavor=@code{"oxydd"}, state=@code{CLOSED}
- at item @b{st_fake_oxyde}: flavor=@code{"oxyde"}, state=@code{CLOSED}
 @end table
 
- at end table
-
 @c ----------------- Flash Stone --------------------
 @node st_flash
 @subsection st_flash
@@ -15942,7 +15987,7 @@
 @item @image{images/st_flat_cracked, 12mm} @b{st_flat_cracked}: 
 @item @image{images/st_flat_fire, 12mm} @b{st_flat_burnable}: burnable=@code{"true"}
 @item @image{images/st_flat_fire, 12mm} @b{st_flat_moveburnable}: movable=@code{"true"}, burnable=@code{"true"}
- at item @image{images/fl_white, 12mm} @b{st_flat_breaking}: breakable=@code{"true"}
+ at item @image{images/st_flat_break, 12mm} @b{st_flat_breaking}: breakable=@code{"true"}
 @end table
 @end table
 
@@ -16086,16 +16131,14 @@
 @item @b{Action:} none
 
 @item @b{Variants:}
-
- at table @asis
- at item @b{st_ghost}: flavor=@code{"purplemarble"}
- at item @b{st_ghost_purplemarble}: flavor=@code{"purplemarble"}
- at item @b{st_ghost_greenbrown}: flavor=@code{"greenbrown"}
- at item @b{st_ghost_break}: flavor=@code{"break"}
+ at multitable @columnfractions .08 .52 .40
+ at item @image{images/fl_white, 12mm}@tab @b{st_ghost}: flavor=@code{"purplemarble"} @tab at image{images/st_purplemarble, 12mm}
+ at item @image{images/fl_white, 12mm}@tab @b{st_ghost_purplemarble}: flavor=@code{"purplemarble"} @tab at image{images/st_purplemarble, 12mm}
+ at item @image{images/fl_white, 12mm}@tab @b{st_ghost_greenbrown}: flavor=@code{"greenbrown"} @tab at image{images/st_greenbrown, 12mm}
+ at item @image{images/fl_white, 12mm}@tab @b{st_ghost_break}: flavor=@code{"break"} @tab at image{images/st_break_plain, 12mm}
+ at end multitable
 @end table
 
- at end table
-
 @c ----------------- Grate Stone --------------------
 @node st_grate
 @subsection st_grate
@@ -16157,7 +16200,7 @@
 @item @image{images/st_greenbrown, 12mm} @b{st_greenbrown}
 @item @image{images/st_greenbrown, 12mm} @b{st_greenbrown_hollow}
 @item @image{images/st_greenbrown, 12mm} @b{st_greenbrown_movable}
- at item @image{images/fl_white, 12mm} @b{st_greenbrown_growing}
+ at item @image{images/st_greenbrown_growing, 12mm} @b{st_greenbrown_growing}
 @end table
 @end table
 
@@ -16439,17 +16482,18 @@
 @item @b{Action:} none
 
 @item @b{Variants:}
-
- at table @asis
- at item @b{st_laser}
- at item @b{st_laser_w}: orientation = @code{WEST}
- at item @b{st_laser_s}: orientation = @code{SOUTH}
- at item @b{st_laser_e}: orientation = @code{EAST}
- at item @b{st_laser_n}: orientation = @code{NORTH}
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/st_laser_w_0001, 12mm}@tab @b{st_laser_w}: orientation = @code{WEST}, state = @code{OFF}
+ at tab @image{images/st_laser_w_0006, 12mm}@tab @b{st_laser_w}: orientation = @code{WEST}, state = @code{ON}
+ at item @image{images/st_laser_s_0001, 12mm}@tab @b{st_laser_s}: orientation = @code{SOUTH}, state = @code{OFF}
+ at tab @image{images/st_laser_s_0006, 12mm}@tab @b{st_laser_s}: orientation = @code{SOUTH}, state = @code{ON}
+ at item @image{images/st_laser_e_0001, 12mm}@tab @b{st_laser_e}: orientation = @code{EAST}, state = @code{OFF}
+ at tab @image{images/st_laser_e_0006, 12mm}@tab @b{st_laser_e}: orientation = @code{EAST}, state = @code{ON}
+ at item @image{images/st_laser_n_0001, 12mm}@tab @b{st_laser_n}: orientation = @code{NORTH}, state = @code{OFF}
+ at tab @image{images/st_laser_n_0006, 12mm}@tab @b{st_laser_n}: orientation = @code{NORTH}, state = @code{ON}
+ at end multitable
 @end table
 
- at end table
-
 @c ----------------- Laserflop Stone --------------------
 @node st_laserflop
 @subsection st_laserflop
@@ -16494,6 +16538,11 @@
 @end table
 
 @item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
+ at item @b{Variants:}
+ at table @asis
+ at item @image{images/st_monoflop, 12mm} @b{st_laserflop}: state = @code{OFF}
+ at item @image{images/st_monoflop_2, 12mm} @b{st_laserflop}: state = @code{ON}
+ at end table
 
 @end table
 
@@ -16526,7 +16575,11 @@
 
 @item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
 
+ at table @asis
+ at item @image{images/st_oxydb, 12mm} @b{st_laserswitch}: state = @code{OFF}
+ at item @image{images/st_fakeoxyd_blink_0003, 12mm} @b{st_laserswitch}: state = @code{ON}
 @end table
+ at end table
 
 @c ----------------- Lightglass Stone --------------------
 @node st_lightglass
@@ -16685,10 +16738,10 @@
 @item @b{Variants:}
 
 @table @asis
- at item @b{st_magic}: flavor=@code{"brick"}
- at item @b{st_magic_brick}: flavor=@code{"brick"}
- at item @b{st_magic_oxyda}: flavor=@code{"oxyda"}
- at item @b{st_magic_oxydc}: flavor=@code{"oxydc"}
+ at item @image{images/st_brick, 12mm} @b{st_magic}: flavor=@code{"brick"}
+ at item @image{images/st_brick, 12mm} @b{st_magic_brick}: flavor=@code{"brick"}
+ at item @image{images/st_oxyda, 12mm} @b{st_magic_oxyda}: flavor=@code{"oxyda"}
+ at item @image{images/st_oxydc, 12mm} @b{st_magic_oxydc}: flavor=@code{"oxydc"}
 @end table
 
 @end table
@@ -16722,11 +16775,11 @@
 @item @b{Variants:}
 
 @table @asis
- at item @b{st_mail}: orientation = @code{NORTH}
- at item @b{st_mail_w}: orientation = @code{WEST}
- at item @b{st_mail_s}: orientation = @code{SOUTH}
- at item @b{st_mail_e}: orientation = @code{EAST}
- at item @b{st_mail_n}: orientation = @code{NORTH}
+ at item @image{images/st_mail, 12mm} @b{st_mail}: orientation = @code{NORTH}
+ at item @image{images/st_mail_3, 12mm} @b{st_mail_w}: orientation = @code{WEST}
+ at item @image{images/st_mail_4, 12mm} @b{st_mail_s}: orientation = @code{SOUTH}
+ at item @image{images/st_mail_2, 12mm} @b{st_mail_e}: orientation = @code{EAST}
+ at item @image{images/st_mail, 12mm} @b{st_mail_n}: orientation = @code{NORTH}
 @end table
 
 @end table
@@ -16812,16 +16865,51 @@
 @item @b{Action:} none
 
 @item @b{Variants:}
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/st_mirror_static_03, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{NORTH}, transparent = @code{false}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_03, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{NORTH}, transparent = @code{false}, movable = @code{true}
+ at item @image{images/st_mirror_static_04, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{EAST}, transparent = @code{false}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_04, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{EAST}, transparent = @code{false}, movable = @code{true}
+ at item @image{images/st_mirror_static_01, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{SOUTH}, transparent = @code{false}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_01, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{SOUTH}, transparent = @code{false}, movable = @code{true}
+ at item @image{images/st_mirror_static_02, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{WEST}, transparent = @code{false}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_02, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{WEST}, transparent = @code{false}, movable = @code{true}
+ at item @image{images/st_mirror_static_07, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{NORTH}, transparent = @code{true}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_07, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{NORTH}, transparent = @code{true}, movable = @code{true}
+ at item @image{images/st_mirror_static_08, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{EAST}, transparent = @code{true}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_08, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{EAST}, transparent = @code{true}, movable = @code{true}
+ at item @image{images/st_mirror_static_05, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{SOUTH}, transparent = @code{true}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_05, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{SOUTH}, transparent = @code{true}, movable = @code{true}
+ at item @image{images/st_mirror_static_06, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{WEST}, transparent = @code{true}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_06, 12mm}@tab @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{WEST}, transparent = @code{true}, movable = @code{true}
+ at item @image{images/st_mirror_static_11, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{NORTH}, transparent = @code{false}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_11, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{NORTH}, transparent = @code{false}, movable = @code{true}
+ at item @image{images/st_mirror_static_12, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{EAST}, transparent = @code{false}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_12, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{EAST}, transparent = @code{false}, movable = @code{true}
+ at item @image{images/st_mirror_static_09, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{SOUTH}, transparent = @code{false}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_09, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{SOUTH}, transparent = @code{false}, movable = @code{true}
+ at item @image{images/st_mirror_static_10, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{WEST}, transparent = @code{false}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_10, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{WEST}, transparent = @code{false}, movable = @code{true}
+ at item @image{images/st_mirror_static_15, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{NORTH}, transparent = @code{true}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_15, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{NORTH}, transparent = @code{true}, movable = @code{true}
+ at item @image{images/st_mirror_static_16, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{EAST}, transparent = @code{true}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_16, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{EAST}, transparent = @code{true}, movable = @code{true}
+ at item @image{images/st_mirror_static_13, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{SOUTH}, transparent = @code{true}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_13, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{SOUTH}, transparent = @code{true}, movable = @code{true}
+ at item @image{images/st_mirror_static_14, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{WEST}, transparent = @code{true}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_14, 12mm}@tab @b{st_mirror_slab}: flavor=@code{slab}, state = @code{WEST}, transparent = @code{true}, movable = @code{true}
+ at item @image{images/st_mirror_static_19, 12mm}@tab @b{st_mirror_sheets}: flavor=@code{sheets}, state = @code{NORTH}, transparent = @code{true}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_19, 12mm}@tab @b{st_mirror_sheets}: flavor=@code{sheets}, state = @code{NORTH}, transparent = @code{true}, movable = @code{true}
+ at item @image{images/st_mirror_static_20, 12mm}@tab @b{st_mirror_sheets}: flavor=@code{sheets}, state = @code{EAST}, transparent = @code{true}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_20, 12mm}@tab @b{st_mirror_sheets}: flavor=@code{sheets}, state = @code{EAST}, transparent = @code{true}, movable = @code{true}
+ at item @image{images/st_mirror_static_17, 12mm}@tab @b{st_mirror_sheets}: flavor=@code{sheets}, state = @code{SOUTH}, transparent = @code{true}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_17, 12mm}@tab @b{st_mirror_sheets}: flavor=@code{sheets}, state = @code{SOUTH}, transparent = @code{true}, movable = @code{true}
+ at item @image{images/st_mirror_static_18, 12mm}@tab @b{st_mirror_sheets}: flavor=@code{sheets}, state = @code{WEST}, transparent = @code{true}, movable = @code{false}
+ at tab @image{images/st_mirror_movable_18, 12mm}@tab @b{st_mirror_sheets}: flavor=@code{sheets}, state = @code{WEST}, transparent = @code{true}, movable = @code{true}
+ at end multitable
 
- at table @asis
- at item @b{st_mirror}: flavor=@code{slab}, state = @code{NORTH}
- at item @b{st_mirror_slab}: flavor=@code{slab}, state = @code{NORTH}
- at item @b{st_mirror_sheets}: flavor=@code{sheets}, state = @code{NORTH}
- at item @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{NORTH}
 @end table
 
- at end table
-
 @c ----------------- Monoflop Stone --------------------
 @node st_monoflop
 @subsection st_monoflop
@@ -16860,7 +16948,12 @@
 
 @item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
 
+ at item @b{Variants:}
+ at table @asis
+ at item @image{images/st_monoflop, 12mm} @b{st_monoflop}: state = @code{OFF}
+ at item @image{images/st_monoflop_2, 12mm} @b{st_monoflop}: state = @code{ON}
 @end table
+ at end table
 
 @c ----------------- Oneway Stone --------------------
 @node st_oneway
@@ -16916,15 +17009,22 @@
 @item @b{Action:} none
 
 @item @b{Variants:}
-
- at table @asis
- at item @b{st_oneway}
- at item @b{st_oneway_black}: color = @code{BLACK}
- at item @b{st_oneway_white}: color = @code{WHITE}
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/st_oneway, 12mm}@tab  @b{st_oneway}: orientation = @code{EAST}
+ at tab @image{images/st_oneway_2, 12mm}@tab @b{st_oneway}: orientation = @code{NORTH}
+ at item @image{images/st_oneway_3, 12mm}@tab @b{st_oneway}: orientation = @code{SOUTH}
+ at tab @image{images/st_oneway_4, 12mm}@tab @b{st_oneway}: orientation = @code{WEST}
+ at item @image{images/st_oneway_b, 12mm}@tab @b{st_oneway_black}: color = @code{BLACK}; orientation = @code{EAST}
+ at tab @image{images/st_oneway_b2, 12mm}@tab @b{st_oneway_black}: color = @code{BLACK}; orientation = @code{NORTH}
+ at item @image{images/st_oneway_b3, 12mm}@tab @b{st_oneway_black}: color = @code{BLACK}; orientation = @code{SOUTH}
+ at tab @image{images/st_oneway_b4, 12mm}@tab @b{st_oneway_black}: color = @code{BLACK}; orientation = @code{WEST}
+ at item @image{images/st_oneway_c, 12mm}@tab @b{st_oneway_white}: color = @code{WHITE}; orientation = @code{EAST}
+ at tab @image{images/st_oneway_c2, 12mm}@tab @b{st_oneway_white}: color = @code{WHITE}; orientation = @code{NORTH}
+ at item @image{images/st_oneway_c3, 12mm}@tab @b{st_oneway_white}: color = @code{WHITE}; orientation = @code{SOUTH}
+ at tab @image{images/st_oneway_c4, 12mm}@tab @b{st_oneway_white}: color = @code{WHITE}; orientation = @code{WEST}
+ at end multitable
 @end table
 
- at end table
-
 @c ----------------- Oxyd Stone --------------------
 @node st_oxyd
 @subsection st_oxyd
@@ -17224,7 +17324,12 @@
 
 @item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
 
+ at item @b{Variants:}
+ at table @asis
+ at item @image{images/st_darkglass, 12mm} @b{st_polarswitch}: state = @code{OFF}
+ at item @image{images/st_lightglass, 12mm} @b{st_polarswitch}: state = @code{ON}
 @end table
+ at end table
 
 @c ----------------- Portal Stone --------------------
 @node st_portal
@@ -17451,11 +17556,72 @@
 
 @item @b{Variants:}
 
- at table @asis
- at item @b{st_puzzle}: color = @code{BLUE}
- at item @b{st_puzzle_blue}: color = @code{BLUE}
- at item @b{st_puzzle_yellow}: color = @code{YELLOW}
- at end table
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/st_puzzle_blue, 12mm}@tab  @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{""}, hollow = @code{false}
+ at tab @image{images/st_puzzle_blue_2, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"w"}, hollow = @code{false}
+ at item @image{images/st_puzzle_blue_3, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"s"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_blue_4, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"sw"}, hollow = @code{false}
+ at item @image{images/st_puzzle_blue_b, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"e"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_blue_b2, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"ew"}, hollow = @code{false}
+ at item @image{images/st_puzzle_blue_b3, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"es"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_blue_b4, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"esw"}, hollow = @code{false}
+ at item @image{images/st_puzzle_blue_c, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"n"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_blue_c2, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"nw"}, hollow = @code{false}
+ at item @image{images/st_puzzle_blue_c3, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"ns"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_blue_c4, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"nsw"}, hollow = @code{false}
+ at item @image{images/st_puzzle_blue_d, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"ne"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_blue_d2, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"new"}, hollow = @code{false}
+ at item @image{images/st_puzzle_blue_d3, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"nes"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_blue_d4, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"nesw"}, hollow = @code{false}
+ at item @image{images/st_puzzle_blue_hollow, 12mm}@tab  @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{""}, hollow = @code{true}
+ at tab @image{images/st_puzzle_blue_hollow_2, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"w"}, hollow = @code{true}
+ at item @image{images/st_puzzle_blue_hollow_3, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"s"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_blue_hollow_4, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"sw"}, hollow = @code{true}
+ at item @image{images/st_puzzle_blue_hollow_b, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"e"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_blue_hollow_b2, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"ew"}, hollow = @code{true}
+ at item @image{images/st_puzzle_blue_hollow_b3, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"es"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_blue_hollow_b4, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"esw"}, hollow = @code{true}
+ at item @image{images/st_puzzle_blue_hollow_c, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"n"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_blue_hollow_c2, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"nw"}, hollow = @code{true}
+ at item @image{images/st_puzzle_blue_hollow_c3, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"ns"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_blue_hollow_c4, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"nsw"}, hollow = @code{true}
+ at item @image{images/st_puzzle_blue_hollow_d, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"ne"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_blue_hollow_d2, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"new"}, hollow = @code{true}
+ at item @image{images/st_puzzle_blue_hollow_d3, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"nes"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_blue_hollow_d4, 12mm}@tab @b{st_puzzle_blue}: color = @code{BLUE}, connections = @code{"nesw"}, hollow = @code{true}
+ at item @image{images/st_puzzle_yellow, 12mm}@tab  @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{""}, hollow = @code{false}
+ at tab @image{images/st_puzzle_yellow_2, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"w"}, hollow = @code{false}
+ at item @image{images/st_puzzle_yellow_3, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"s"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_yellow_4, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"sw"}, hollow = @code{false}
+ at item @image{images/st_puzzle_yellow_b, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"e"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_yellow_b2, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"ew"}, hollow = @code{false}
+ at item @image{images/st_puzzle_yellow_b3, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"es"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_yellow_b4, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"esw"}, hollow = @code{false}
+ at item @image{images/st_puzzle_yellow_c, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"n"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_yellow_c2, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"nw"}, hollow = @code{false}
+ at item @image{images/st_puzzle_yellow_c3, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"ns"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_yellow_c4, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"nsw"}, hollow = @code{false}
+ at item @image{images/st_puzzle_yellow_d, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"ne"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_yellow_d2, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"new"}, hollow = @code{false}
+ at item @image{images/st_puzzle_yellow_d3, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"nes"}, hollow = @code{false}
+ at tab @image{images/st_puzzle_yellow_d4, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"nesw"}, hollow = @code{false}
+ at item @image{images/st_puzzle_yellow_hollow, 12mm}@tab  @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{""}, hollow = @code{true}
+ at tab @image{images/st_puzzle_yellow_hollow_2, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"w"}, hollow = @code{true}
+ at item @image{images/st_puzzle_yellow_hollow_3, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"s"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_yellow_hollow_4, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"sw"}, hollow = @code{true}
+ at item @image{images/st_puzzle_yellow_hollow_b, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"e"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_yellow_hollow_b2, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"ew"}, hollow = @code{true}
+ at item @image{images/st_puzzle_yellow_hollow_b3, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"es"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_yellow_hollow_b4, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"esw"}, hollow = @code{true}
+ at item @image{images/st_puzzle_yellow_hollow_c, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"n"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_yellow_hollow_c2, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"nw"}, hollow = @code{true}
+ at item @image{images/st_puzzle_yellow_hollow_c3, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"ns"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_yellow_hollow_c4, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"nsw"}, hollow = @code{true}
+ at item @image{images/st_puzzle_yellow_hollow_d, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"ne"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_yellow_hollow_d2, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"new"}, hollow = @code{true}
+ at item @image{images/st_puzzle_yellow_hollow_d3, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"nes"}, hollow = @code{true}
+ at tab @image{images/st_puzzle_yellow_hollow_d4, 12mm}@tab @b{st_puzzle_yellow}: color = @code{YELLOW}, connections = @code{"nesw"}, hollow = @code{true}
+ at end multitable
 
 @end table
 
@@ -17500,7 +17666,12 @@
 
 @item @b{Action:} none
 
+ at table @asis
+ at item @image{images/st_oxydb, 12mm} @b{st_quake}: state = @code{IDLE}
+ at item @image{images/st_fakeoxyd_blink_0003, 12mm} @b{st_quake}: state = @code{ACTIVE}
+ at item @image{images/st_quake_break, 12mm} @b{st_quake}: state = @code{BREAKING}
 @end table
+ at end table
 
 @c ----------------- Rawglass Stone --------------------
 @node st_rawglass
@@ -17737,14 +17908,14 @@
 @item @b{Variants:}
 
 @table @asis
- at item @b{st_shogun}: flavor = @code{"s"}
- at item @b{st_shogun_s}: flavor = @code{"s"}
- at item @b{st_shogun_m}: flavor = @code{"m"}
- at item @b{st_shogun_sm}: flavor = @code{"sm"}
- at item @b{st_shogun_l}: flavor = @code{"l"}
- at item @b{st_shogun_sl}: flavor = @code{"sl"}
- at item @b{st_shogun_ml}: flavor = @code{"ml"}
- at item @b{st_shogun_sml}: flavor = @code{"sml"}
+ at item @image{images/st_shogun, 12mm} @b{st_shogun}: flavor = @code{"s"}
+ at item @image{images/st_shogun, 12mm} @b{st_shogun_s}: flavor = @code{"s"}
+ at item @image{images/st_shogun_2, 12mm} @b{st_shogun_m}: flavor = @code{"m"}
+ at item @image{images/st_shogun_3, 12mm} @b{st_shogun_sm}: flavor = @code{"sm"}
+ at item @image{images/st_shogun_4, 12mm} @b{st_shogun_l}: flavor = @code{"l"}
+ at item @image{images/st_shogun_5, 12mm} @b{st_shogun_sl}: flavor = @code{"sl"}
+ at item @image{images/st_shogun_6, 12mm} @b{st_shogun_ml}: flavor = @code{"ml"}
+ at item @image{images/st_shogun_7, 12mm} @b{st_shogun_sml}: flavor = @code{"sml"}
 @end table
 
 @end table
@@ -17937,7 +18108,7 @@
 @item @image{images/st_stoneimpulse, 12mm} @b{st_stoneimpulse}
 @item @image{images/st_stoneimpulse, 12mm} @b{st_stoneimpulse_movable}: movable = @code{true}
 @item @image{images/st_stoneimpulse_hollow, 12mm} @b{st_stoneimpulse_hollow}: hollow = @code{true}
- at item @image{images/st_stoneimpulse, 12mm} @b{st_stoneimpulse_steady}: steady = @code{true}
+ at item @image{images/st_stoneimpulse_6, 12mm} @b{st_stoneimpulse_steady}: steady = @code{true}
 @item @image{images/st_stoneimpulse, 12mm} @b{st_stoneimpulse_new}:
 A stone that is about to pulse when being set.
 @end table
@@ -18119,7 +18290,15 @@
 @item @b{Messages:} none
 
 @item @b{Action:}  none
+
+ at item @b{Variants:}
+ at table @asis
+ at item @image{images/st_bluegray, 12mm} @b{st_thief}: hidden
+ at item @image{images/st_thief, 12mm} @b{st_thief}: showing up at the moment when stealing items
+ at item @image{images/st_thief_capture, 12mm} @b{st_thief}: when being captured
+ at item @image{images/st_thief_drunken, 12mm} @b{st_thief}: drunken thief
 @end table
+ at end table
 
 @c ----------------- Timer Stone --------------------
 @node st_timer
@@ -18177,7 +18356,13 @@
 The action value starts with @samp{true} and alternates on every event between
 @samp{false} and @samp{true}. A timer that is reset starts again with value
 @samp{true}
+
+ at item @b{Variants:}
+ at table @asis
+ at item @image{images/st_timer, 12mm} @b{st_timer}: state = @code{OFF}
+ at item @image{images/st_timer_2, 12mm} @b{st_timer}: state = @code{ON}
 @end table
+ at end table
 
 @c ----------------- Turnstile Pivot Stone --------------------
 @node st_turnstile
@@ -18329,11 +18514,11 @@
 
 @item @b{Variants:}
 @table @asis
- at item @b{st_turnstilearm}: orientation = @code{NORTH}
- at item @b{st_turnstilearm_n}: orientation = @code{NORTH}
- at item @b{st_turnstilearm_e}: orientation = @code{EAST}
- at item @b{st_turnstilearm_s}: orientation = @code{SOUTH}
- at item @b{st_turnstilearm_w}: orientation = @code{WEST}
+ at item @image{images/st_puzzle_blue_3, 12mm} @b{st_turnstilearm}: orientation = @code{NORTH}
+ at item @image{images/st_puzzle_blue_3, 12mm} @b{st_turnstilearm_n}: orientation = @code{NORTH}
+ at item @image{images/st_puzzle_blue_2, 12mm} @b{st_turnstilearm_e}: orientation = @code{EAST}
+ at item @image{images/st_puzzle_blue_c, 12mm} @b{st_turnstilearm_s}: orientation = @code{SOUTH}
+ at item @image{images/st_puzzle_blue_b, 12mm} @b{st_turnstilearm_w}: orientation = @code{WEST}
 @end table
 @end table
 
@@ -18390,12 +18575,12 @@
 
 @item @b{Variants:}
 @table @asis
- at item @b{st_volcano}: state = @code{IDLE}
- at item @b{st_volcano_idle}: state = @code{IDLE}
- at item @b{st_volcano_active}: state = @code{ACTIVE}
- at item @b{st_volcano_new}:
+ at item @image{images/st_flat, 12mm} @b{st_volcano}: state = @code{IDLE}
+ at item @image{images/st_flat, 12mm} @b{st_volcano_idle}: state = @code{IDLE}
+ at item @image{images/st_fakeoxyd_blink_0003, 12mm} @b{st_volcano_active}: state = @code{ACTIVE}
+ at item @image{images/it_seed, 12mm} @b{st_volcano_new}:
 An active volcano starting in the seed like phase.
- at item @b{st_volcano_growing}:
+ at item @image{images/st_volcano_growing, 12mm} @b{st_volcano_growing}:
 An active volcano starting in the growing phase.
 @end table
 @end table
@@ -18469,26 +18654,41 @@
 @end table
 
 @item @b{Variants:}
- at table @asis
- at item @b{st_window}: faces = @code{"s"}
- at item @b{st_window_w}: faces = @code{"w"}
- at item @b{st_window_s}: faces = @code{"s"}
- at item @b{st_window_sw}: faces = @code{"sw"}
- at item @b{st_window_e}: faces = @code{"e"}
- at item @b{st_window_ew}: faces = @code{"ew"}
- at item @b{st_window_es}: faces = @code{"es"}
- at item @b{st_window_esw}: faces = @code{"esw"}
- at item @b{st_window_n}: faces = @code{"n"}
- at item @b{st_window_nw}: faces = @code{"nw"}
- at item @b{st_window_ns}: faces = @code{"ns"}
- at item @b{st_window_nsw}: faces = @code{"nsw"}
- at item @b{st_window_ne}: faces = @code{"ne"}
- at item @b{st_window_new}: faces = @code{"new"}
- at item @b{st_window_nes}: faces = @code{"nes"}
- at item @b{st_window_nesw}: faces = @code{"nesw"}
-
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/st_window_blue_3, 12mm}@tab @b{st_window}: faces = @code{"s"}, secure = @code{false}
+ at tab @image{images/st_window_green_3, 12mm}@tab @b{st_window}: faces = @code{"s"}, secure = @code{true}
+ at item @image{images/st_window_blue_2, 12mm}@tab @b{st_window_w}: faces = @code{"w"}, secure = @code{false}
+ at tab @image{images/st_window_green_2, 12mm}@tab @b{st_window_w}: faces = @code{"w"}, secure = @code{true}
+ at item @image{images/st_window_blue_3, 12mm}@tab @b{st_window_s}: faces = @code{"s"}, secure = @code{false}
+ at tab @image{images/st_window_green_3, 12mm}@tab @b{st_window_s}: faces = @code{"s"}, secure = @code{true}
+ at item @image{images/st_window_blue_4, 12mm}@tab @b{st_window_sw}: faces = @code{"sw"}, secure = @code{false}
+ at tab @image{images/st_window_green_4, 12mm}@tab @b{st_window_sw}: faces = @code{"sw"}, secure = @code{true}
+ at item @image{images/st_window_blue_b, 12mm}@tab @b{st_window_e}: faces = @code{"e"}, secure = @code{false}
+ at tab @image{images/st_window_green_b, 12mm}@tab @b{st_window_e}: faces = @code{"e"}, secure = @code{true}
+ at item @image{images/st_window_blue_b2, 12mm}@tab @b{st_window_ew}: faces = @code{"ew"}, secure = @code{false}
+ at tab @image{images/st_window_green_b2, 12mm}@tab @b{st_window_ew}: faces = @code{"ew"}, secure = @code{true}
+ at item @image{images/st_window_blue_b3, 12mm}@tab @b{st_window_es}: faces = @code{"es"}, secure = @code{false}
+ at tab @image{images/st_window_green_b3, 12mm}@tab @b{st_window_es}: faces = @code{"es"}, secure = @code{true}
+ at item @image{images/st_window_blue_b4, 12mm}@tab @b{st_window_esw}: faces = @code{"esw"}, secure = @code{false}
+ at tab @image{images/st_window_green_b4, 12mm}@tab @b{st_window_esw}: faces = @code{"esw"}, secure = @code{true}
+ at item @image{images/st_window_blue_c, 12mm}@tab @b{st_window_n}: faces = @code{"n"}, secure = @code{false}
+ at tab @image{images/st_window_green_c, 12mm}@tab @b{st_window_n}: faces = @code{"n"}, secure = @code{true}
+ at item @image{images/st_window_blue_c2, 12mm}@tab @b{st_window_nw}: faces = @code{"nw"}, secure = @code{false}
+ at tab @image{images/st_window_green_c2, 12mm}@tab @b{st_window_nw}: faces = @code{"nw"}, secure = @code{true}
+ at item @image{images/st_window_blue_c3, 12mm}@tab @b{st_window_ns}: faces = @code{"ns"}, secure = @code{false}
+ at tab @image{images/st_window_green_c3, 12mm}@tab @b{st_window_ns}: faces = @code{"ns"}, secure = @code{true}
+ at item @image{images/st_window_blue_c4, 12mm}@tab @b{st_window_nsw}: faces = @code{"nsw"}, secure = @code{false}
+ at tab @image{images/st_window_green_c4, 12mm}@tab @b{st_window_nsw}: faces = @code{"nsw"}, secure = @code{true}
+ at item @image{images/st_window_blue_d, 12mm}@tab @b{st_window_ne}: faces = @code{"ne"}, secure = @code{false}
+ at tab @image{images/st_window_green_d, 12mm}@tab @b{st_window_ne}: faces = @code{"ne"}, secure = @code{true}
+ at item @image{images/st_window_blue_d2, 12mm}@tab @b{st_window_new}: faces = @code{"new"}, secure = @code{false}
+ at tab @image{images/st_window_green_d2, 12mm}@tab @b{st_window_new}: faces = @code{"new"}, secure = @code{true}
+ at item @image{images/st_window_blue_d3, 12mm}@tab @b{st_window_nes}: faces = @code{"nes"}, secure = @code{false}
+ at tab @image{images/st_window_green_d3, 12mm}@tab @b{st_window_nes}: faces = @code{"nes"}, secure = @code{true}
+ at item @image{images/st_window_blue_d4, 12mm}@tab @b{st_window_nesw}: faces = @code{"nesw"}, secure = @code{false}
+ at tab @image{images/st_window_green_d4, 12mm}@tab @b{st_window_nesw}: faces = @code{"nesw"}, secure = @code{true}
+ at end multitable
 @end table
- at end table
 
 @c ----------------- Yinyang Stone --------------------
 @node st_yinyang
@@ -18832,7 +19032,7 @@
 @item @b{Variants:}
 
 @table @asis
- at item @b{ac_bug}: color = @code{nil}, controllers = @code{CTRL_NONE}, owner = @code{nil}
+ at item @image{images/ac_bug, 14mm} @b{ac_bug}: color = @code{nil}, controllers = @code{CTRL_NONE}, owner = @code{nil}
 @end table
 
 @end table
@@ -18877,7 +19077,7 @@
 @item @b{Variants:}
 
 @table @asis
- at item @b{ac_horse}: controllers = @code{CTRL_NONE}, owner = @code{nil}
+ at item @image{images/ac_horse, 14mm} @b{ac_horse}: controllers = @code{CTRL_NONE}, owner = @code{nil}
 @end table
 
 @end table
@@ -18916,7 +19116,7 @@
 @item @b{Variants:}
 
 @table @asis
- at item @b{ac_killer}: color = @code{WHITE}, controllers = @code{CTRL_YINYANG}, owner = @code{nil}
+ at item @image{images/ac_pearl_white, 14mm} @b{ac_killer}: color = @code{WHITE}, controllers = @code{CTRL_YINYANG}, owner = @code{nil}
 @end table
 
 @end table
@@ -18955,9 +19155,9 @@
 @item @b{Variants:}
 
 @table @asis
- at item @b{ac_marble}: color = @code{BLACK}, controllers = @code{CTRL_YIN}, owner = @code{YIN}
- at item @b{ac_marble_black}: color = @code{BLACK}, controllers = @code{CTRL_YIN}, owner = @code{YIN}
- at item @b{ac_marble_white}: color = @code{WHITE}, controllers = @code{CTRL_YANG}, owner = @code{YANG}
+ at item @image{images/ac_marble_black, 14mm}  @b{ac_marble}: color = @code{BLACK}, controllers = @code{CTRL_YIN}, owner = @code{YIN}
+ at item @image{images/ac_marble_black, 14mm} @b{ac_marble_black}: color = @code{BLACK}, controllers = @code{CTRL_YIN}, owner = @code{YIN}
+ at item @image{images/ac_marble_white, 14mm} @b{ac_marble_white}: color = @code{WHITE}, controllers = @code{CTRL_YANG}, owner = @code{YANG}
 @end table
 
 @end table
@@ -18996,8 +19196,8 @@
 @item @b{Variants:}
 
 @table @asis
- at item @b{ac_pearl}: color = @code{WHITE}, controllers = @code{CTRL_YINYANG}, owner = @code{YIN}
- at item @b{ac_pearl_white}: color = @code{WHITE}, controllers = @code{CTRL_YINYANG}, owner = @code{YIN}
+ at item @image{images/ac_pearl_white, 14mm} @b{ac_pearl}: color = @code{WHITE}, controllers = @code{CTRL_YINYANG}, owner = @code{YIN}
+ at item @image{images/ac_pearl_white, 14mm} @b{ac_pearl_white}: color = @code{WHITE}, controllers = @code{CTRL_YINYANG}, owner = @code{YIN}
 @end table
 
 @end table
@@ -19060,7 +19260,7 @@
 @item @b{Variants:}
 
 @table @asis
- at item @b{ac_rotor}: color = @code{nil}, controllers = @code{CTRL_NONE}, owner = @code{nil}
+ at item @image{images/ac_rotor, 14mm} @b{ac_rotor}: color = @code{nil}, controllers = @code{CTRL_NONE}, owner = @code{nil}
 @end table
 
 @end table
@@ -19117,7 +19317,7 @@
 @item @b{Variants:}
 
 @table @asis
- at item @b{ac_top}: color = @code{nil}, controllers = @code{CTRL_NONE}, owner = @code{nil}
+ at item @image{images/ac_top, 14mm} @b{ac_top}: color = @code{nil}, controllers = @code{CTRL_NONE}, owner = @code{nil}
 @end table
 
 @end table

Modified: trunk/doc/reference/images/Makefile.am
===================================================================
--- trunk/doc/reference/images/Makefile.am	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/doc/reference/images/Makefile.am	2009-07-11 22:35:03 UTC (rev 1751)
@@ -1,55 +1,40 @@
 
-PNG = first_level.png
+PNG = first_level.png construction.png
 
 GFXDIR = ../../../data/gfx48
 
 # List of files to copy from GFXDIR
-PNGLIST = \
-	fl_abyss.png \
+SIMPLEPNG = \
+	ac_bug.png \
+	ac_horse.png \
+	ac_marble_black.png \
+	ac_marble_white.png \
+	ac_pearl_white.png \
+	ac_rotor.png \
+	ac_top.png \
+        fl_abyss.png \
 	fl_adhesionless.png \
-	fl_aquamarine.png \
-	fl_bast.png \
-	fl_bluegray.png \
-	fl_bluegreen.png \
-	fl_blueslab.png \
-	fl_brick.png \
 	fl_bridge_bw_closed.png \
 	fl_bridge_gc_closed.png \
-	fl_bright.png \
-	fl_concrete.png \
-	fl_dark.png \
-	fl_darkgray.png \
-	fl_dunes.png \
-	fl_fake_trigger.png \
-	fl_gravel.png \
-	fl_gray.png \
-	fl_hay.png \
-	fl_himalaya.png \
 	fl_ice.png \
 	fl_inverse_gray.png \
 	fl_inverse_white.png \
-	fl_ivory.png \
-	fl_lawn.png \
-	fl_marble.png \
-	fl_metal.png \
-	fl_mortar.png \
-	fl_pinkbumps.png \
-	fl_plank.png \
-	fl_platinum.png \
-	fl_red.png \
-	fl_redslab.png \
-	fl_rock.png \
-	fl_rough.png \
-	fl_sahara.png \
-	fl_samba.png \
-	fl_sand.png \
+	fl_lawn.png  fl_lawn_c.png \
+	fl_lawn_e.png fl_lawn_e2.png fl_lawn_f.png fl_lawn_f2.png \
+	fl_lawn_g.png fl_lawn_g2.png fl_lawn_h.png fl_lawn_h2.png \
+	fl_lawn_i.png fl_lawn_i2.png fl_lawn_j.png fl_lawn_j2.png \
+	fl_metal_2.png fl_metal_3.png fl_metal_4.png fl_metal_5.png \
+	fl_metal_6.png fl_metal_7.png \
+	fl_samba_2.png \
+	fl_slope.png fl_slope_2.png fl_slope_3.png fl_slope_4.png \
+	fl_slope_b.png fl_slope_b2.png fl_slope_b3.png fl_slope_b4.png \
+	fl_slope_c.png fl_slope_c2.png fl_slope_c3.png fl_slope_c4.png \
+	fl_slope_f.png\
 	fl_space.png \
-	fl_stone.png \
 	fl_swamp.png \
-	fl_tigris.png \
 	fl_water.png \
-	fl_white.png \
-	fl_woven.png \
+	fl_wood.png fl_wood_3.png \
+	fl_wood_framed.png fl_wood_framed_2.png \
 	fl_yinyang_yang.png \
 	fl_yinyang_yin.png \
 	it_bag.png \
@@ -100,7 +85,7 @@
 	it_pencil.png \
 	it_pin.png \
 	it_pipe.png \
-	it_puller.png \
+	it_puller.png it_puller_2.png it_puller_3.png it_puller_4.png \
 	it_ring.png \
 	it_rubberband.png \
 	it_seed.png \
@@ -115,7 +100,10 @@
 	it_spring_drop.png \
 	it_spring_keep.png \
 	it_squashed.png \
-	it_strip.png \
+	it_strip.png it_strip_2.png it_strip_3.png it_strip_4.png \
+	it_strip_b.png it_strip_b2.png it_strip_b3.png it_strip_b4.png \
+	it_strip_c.png it_strip_c2.png it_strip_c3.png it_strip_c4.png \
+	it_strip_d.png it_strip_d2.png it_strip_d3.png it_strip_d4.png \
 	it_surprise.png \
 	it_sword.png \
 	it_trap.png \
@@ -131,13 +119,16 @@
 	st_beads.png \
 	st_blocker.png \
 	st_bluegray.png \
-	st_bluesand.png \
+	st_bluesand.png st_bluesand_2.png st_bluesand_3.png st_bluesand_4.png \
+	st_bluesand_b.png st_bluesand_b2.png st_bluesand_b3.png st_bluesand_b4.png \
+	st_bluesand_c.png st_bluesand_c2.png st_bluesand_c3.png st_bluesand_c4.png \
+	st_bluesand_d.png st_bluesand_d2.png st_bluesand_d3.png st_bluesand_d4.png \
 	st_blur_cross.png \
 	st_blur_straight.png \
-	st_boulder.png \
-	st_box_hay.png \
+	st_boulder.png st_boulder_b.png st_boulder_c.png st_boulder_d.png \
+	st_box_hay.png st_box_hay_growing.png \
 	st_box_rock.png \
-	st_box_wood.png \
+	st_box_wood.png st_box_wood_2.png st_box_wood_growing.png \
 	st_brake.png \
 	st_break_black.png \
 	st_break_boulder.png \
@@ -145,7 +136,10 @@
 	st_break_oxydc.png \
 	st_break_plain.png \
 	st_break_white.png \
-	st_brick.png \
+	st_brick.png st_brick_2.png st_brick_3.png st_brick_4.png \
+	st_brick_b.png st_brick_b2.png st_brick_b3.png st_brick_b4.png \
+	st_brick_c.png st_brick_c2.png st_brick_c3.png st_brick_c4.png \
+	st_brick_d.png st_brick_d2.png st_brick_d3.png st_brick_d4.png \
 	st_brownie.png \
 	st_brownmarble.png \
 	st_brownpyramide.png \
@@ -161,11 +155,17 @@
 	st_darkgray.png \
 	st_death.png \
 	st_death_light.png \
+	st_disco.png st_disco_2.png st_disco_3.png \
 	st_dispenser_bombblack.png \
 	st_dispenser_bombwhite.png \
 	st_dispenser_dynamite.png \
+	st_dispenser_extralife.png \
+	st_door_d_ew.png st_door_d_ew_g.png \
+	st_door_d_ns.png st_door_d_ns_7.png \
+	st_fakeoxyd_blink_0003.png \
 	st_flash.png \
 	st_flat.png \
+	st_flat_break.png \
 	st_flat_cracked.png \
 	st_flat_fire.png \
 	st_floppy_off.png \
@@ -174,7 +174,7 @@
 	st_granite.png \
 	st_grate_cross.png \
 	st_grate_framed.png \
-	st_greenbrown.png \
+	st_greenbrown.png st_greenbrown_growing.png \
 	st_greengray.png \
 	st_ice.png \
 	st_jamb_black.png \
@@ -184,13 +184,35 @@
 	st_knight.png \
 	st_lightglass.png \
 	st_lightpassenger.png \
+	st_mail.png st_mail_2.png st_mail_3.png st_mail_4.png \
 	st_metal.png \
-	st_oxyda.png \
-	st_oxydb.png \
-	st_oxydc.png \
+	st_mirror_static_01.png st_mirror_static_02.png st_mirror_static_03.png \
+	st_mirror_static_04.png st_mirror_static_05.png st_mirror_static_06.png \
+	st_mirror_static_07.png st_mirror_static_08.png st_mirror_static_09.png \
+	st_mirror_static_10.png st_mirror_static_11.png st_mirror_static_12.png \
+	st_mirror_static_13.png st_mirror_static_14.png st_mirror_static_15.png \
+	st_mirror_static_16.png st_mirror_static_17.png st_mirror_static_18.png \
+	st_mirror_static_19.png st_mirror_static_20.png \
+	st_mirror_movable_01.png st_mirror_movable_02.png st_mirror_movable_03.png \
+	st_mirror_movable_04.png st_mirror_movable_05.png st_mirror_movable_06.png \
+	st_mirror_movable_07.png st_mirror_movable_08.png st_mirror_movable_09.png \
+	st_mirror_movable_10.png st_mirror_movable_11.png st_mirror_movable_12.png \
+	st_mirror_movable_13.png st_mirror_movable_14.png st_mirror_movable_15.png \
+	st_mirror_movable_16.png st_mirror_movable_17.png st_mirror_movable_18.png \
+	st_mirror_movable_19.png st_mirror_movable_20.png \
+	st_monoflop.png st_monoflop_2.png \
+	st_oneway.png st_oneway_2.png st_oneway_3.png st_oneway_4.png \
+	st_oneway_b.png st_oneway_b2.png st_oneway_b3.png st_oneway_b4.png \
+	st_oneway_c.png st_oneway_c2.png st_oneway_c3.png st_oneway_c4.png \
+	st_oxyda.png st_oxyda_open.png  \
+	st_oxydb.png st_oxydb_open.png  \
+	st_oxydc.png st_oxydc_open.png \
 	st_oxydd.png \
 	st_oxyde.png \
-	st_panel.png \
+	st_panel.png st_panel_2.png st_panel_3.png st_panel_4.png \
+	st_panel_b.png st_panel_b2.png st_panel_b3.png st_panel_b4.png \
+	st_panel_c.png st_panel_c2.png st_panel_c3.png st_panel_c4.png \
+	st_panel_d.png st_panel_d2.png st_panel_d3.png st_panel_d4.png \
 	st_passage_black_cross.png \
 	st_passage_black_frame.png \
 	st_passage_black_slash.png \
@@ -203,9 +225,27 @@
 	st_plaster.png \
 	st_plop_slate.png \
 	st_pull.png \
+	st_puzzle.png \
 	st_portal_horse.png \
 	st_purplegray.png \
 	st_purplemarble.png \
+	st_puzzle_blue.png st_puzzle_blue_2.png st_puzzle_blue_3.png st_puzzle_blue_4.png \
+	st_puzzle_blue_b.png st_puzzle_blue_b2.png st_puzzle_blue_b3.png st_puzzle_blue_b4.png \
+	st_puzzle_blue_c.png st_puzzle_blue_c2.png st_puzzle_blue_c3.png st_puzzle_blue_c4.png \
+	st_puzzle_blue_d.png st_puzzle_blue_d2.png st_puzzle_blue_d3.png st_puzzle_blue_d4.png \
+	st_puzzle_blue_hollow.png st_puzzle_blue_hollow_2.png st_puzzle_blue_hollow_3.png st_puzzle_blue_hollow_4.png \
+	st_puzzle_blue_hollow_b.png st_puzzle_blue_hollow_b2.png st_puzzle_blue_hollow_b3.png st_puzzle_blue_hollow_b4.png \
+	st_puzzle_blue_hollow_c.png st_puzzle_blue_hollow_c2.png st_puzzle_blue_hollow_c3.png st_puzzle_blue_hollow_c4.png \
+	st_puzzle_blue_hollow_d.png st_puzzle_blue_hollow_d2.png st_puzzle_blue_hollow_d3.png st_puzzle_blue_hollow_d4.png \
+	st_puzzle_yellow.png st_puzzle_yellow_2.png st_puzzle_yellow_3.png st_puzzle_yellow_4.png \
+	st_puzzle_yellow_b.png st_puzzle_yellow_b2.png st_puzzle_yellow_b3.png st_puzzle_yellow_b4.png \
+	st_puzzle_yellow_c.png st_puzzle_yellow_c2.png st_puzzle_yellow_c3.png st_puzzle_yellow_c4.png \
+	st_puzzle_yellow_d.png st_puzzle_yellow_d2.png st_puzzle_yellow_d3.png st_puzzle_yellow_d4.png \
+	st_puzzle_yellow_hollow.png st_puzzle_yellow_hollow_2.png st_puzzle_yellow_hollow_3.png st_puzzle_yellow_hollow_4.png \
+	st_puzzle_yellow_hollow_b.png st_puzzle_yellow_hollow_b2.png st_puzzle_yellow_hollow_b3.png st_puzzle_yellow_hollow_b4.png \
+	st_puzzle_yellow_hollow_c.png st_puzzle_yellow_hollow_c2.png st_puzzle_yellow_hollow_c3.png st_puzzle_yellow_hollow_c4.png \
+	st_puzzle_yellow_hollow_d.png st_puzzle_yellow_hollow_d2.png st_puzzle_yellow_hollow_d3.png st_puzzle_yellow_hollow_d4.png \
+	st_quake_break.png \
 	st_rawglass.png \
 	st_rawglass_quad.png \
 	st_redbrown.png \
@@ -217,7 +257,9 @@
 	st_rubberband.png \
 	st_spitter_idle.png \
 	st_scissors.png \
-	st_stoneimpulse.png \
+	st_shogun.png st_shogun_2.png st_shogun_3.png st_shogun_4.png \
+	st_shogun_5.png st_shogun_6.png st_shogun_7.png \
+	st_stoneimpulse.png st_stoneimpulse_6.png \
 	st_stoneimpulse_hollow.png \
 	st_surprise.png \
 	st_swap.png \
@@ -225,23 +267,199 @@
 	st_switch_black.png \
 	st_switch_white.png \
 	st_tigris.png \
+	st_timer.png st_timer_2.png \
 	st_turnstile.png \
 	st_turnstile_green.png \
+	st_volcano_growing.png \
+	st_window_blue_2.png st_window_blue_3.png st_window_blue_4.png \
+	st_window_blue_b.png st_window_blue_b2.png st_window_blue_b3.png st_window_blue_b4.png \
+	st_window_blue_c.png st_window_blue_c2.png st_window_blue_c3.png st_window_blue_c4.png \
+	st_window_blue_d.png st_window_blue_d2.png st_window_blue_d3.png st_window_blue_d4.png \
+	st_window_green_2.png st_window_green_3.png st_window_green_4.png \
+	st_window_green_b.png st_window_green_b2.png st_window_green_b3.png st_window_green_b4.png \
+	st_window_green_c.png st_window_green_c2.png st_window_green_c3.png st_window_green_c4.png \
+	st_window_green_d.png st_window_green_d2.png st_window_green_d3.png st_window_green_d4.png \
 	st_woven.png \
 	st_yellow.png \
 	st_yinyang.png \
 	st_yinyang_inactive.png
 
-PNGSOURCE = $(addprefix $(GFXDIR), $(PNGLIST))
+FRAMABLEFLOORS = \
+	fl_aquamarine.png \
+	fl_bast.png \
+	fl_bluegray.png \
+	fl_bluegreen.png \
+	fl_blueslab.png \
+	fl_brick.png \
+	fl_bright.png \
+	fl_concrete.png \
+	fl_dark.png \
+	fl_darkgray.png \
+	fl_dunes.png \
+	fl_fake_trigger.png \
+	fl_gravel.png \
+	fl_gray.png \
+	fl_hay.png \
+	fl_himalaya.png \
+	fl_ivory.png \
+	fl_marble.png \
+	fl_metal.png \
+	fl_mortar.png \
+	fl_pinkbumps.png \
+	fl_plank.png \
+	fl_platinum.png \
+	fl_red.png \
+	fl_redslab.png \
+	fl_rock.png \
+	fl_rough.png \
+	fl_sahara.png \
+	fl_samba.png \
+	fl_sand.png \
+	fl_stone.png \
+	fl_tigris.png \
+	fl_white.png \
+	fl_woven.png
 
+FRAMEDFLOORS = $(addsuffix _framed.png, $(basename $(FRAMABLEFLOORS)))
 
+LASERS = st_laser_w_0001.png st_laser_w_0006.png \
+	st_laser_s_0001.png st_laser_s_0006.png \
+	st_laser_e_0001.png st_laser_e_0006.png \
+	st_laser_n_0001.png st_laser_n_0006.png
+
+THIEVES = st_thief.png st_thief_capture.png st_thief_drunken.png \
+	fl_thief.png fl_thief_capture.png fl_thief_drunken.png
+
+PNGLIST = $(SIMPLEPNG) $(FRAMABLEFLOORS) $(FRAMEDFLOORS) $(LASERS) $(THIEVES)
+
 pngdir = @datadir@/doc/enigma/reference/images
 png_DATA = $(PNG) $(PNGLIST)
 
-.SUFFIXES = .png
-
 all: $(PNGLIST)
 
+%_framed.png: $(GFXDIR)/%.png $(GFXDIR)/floor_frame.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 -composite $< $(GFXDIR)/floor_frame.png $@
+
+st_laser_%.png: $(GFXDIR)/st-laser-%.png $(GFXDIR)/st-laser-base.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 -composite $(GFXDIR)/st-laser-base.png $< $@
+
+st_mirror_static_%.png: $(GFXDIR)/st-mirrortempl_00%.png $(GFXDIR)/st-mirror-static.png
+	convert -density 112x112 -units PixelsPerCentimeter -composite $(GFXDIR)/st-mirror-static.png $< $@
+
+st_mirror_movable_%.png: $(GFXDIR)/st-mirrortempl_00%.png $(GFXDIR)/st-mirror-movable.png
+	convert -density 112x112 -units PixelsPerCentimeter -composite $(GFXDIR)/st-mirror-movable.png $< $@
+
+%_thief.png: $(GFXDIR)/%_bluegray.png $(GFXDIR)/thief_template.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+288 $(GFXDIR)/thief_template.png thief_template.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< thief_base.png
+	convert -density 112x112 -units PixelsPerCentimeter -composite thief_base.png thief_template.png $@
+	rm thief_template.png thief_base.png
+
+%_thief_capture.png: $(GFXDIR)/%_bluegray.png $(GFXDIR)/thief_capture_template.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+288 $(GFXDIR)/thief_capture_template.png thief_template.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< thief_base.png
+	convert -density 112x112 -units PixelsPerCentimeter -composite thief_base.png thief_template.png $@
+	rm thief_template.png thief_base.png
+
+%_thief_drunken.png: $(GFXDIR)/%_bluegray.png $(GFXDIR)/thief_drunken_template.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $(GFXDIR)/thief_drunken_template.png thief_template.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< thief_base.png
+	convert -density 112x112 -units PixelsPerCentimeter -composite thief_base.png thief_template.png $@
+	rm thief_template.png thief_base.png
+
+ac_%.png: $(GFXDIR)/ac_%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 60x60+0+0 $< $@
+
+%_2.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+48 $< $@
+
+%_3.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+96 $< $@
+
+%_4.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+144 $< $@
+
+%_5.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+192 $< $@
+
+%_6.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+240 $< $@
+
+%_7.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+288 $< $@
+
+%_b.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+48+0 $< $@
+
+%_b2.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+48+48 $< $@
+
+%_b3.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+48+96 $< $@
+
+%_b4.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+48+144 $< $@
+
+%_c.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+96+0 $< $@
+
+%_c2.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+96+48 $< $@
+
+%_c3.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+96+96 $< $@
+
+%_c4.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+96+144 $< $@
+
+%_d.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+144+0 $< $@
+
+%_d2.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+144+48 $< $@
+
+%_d3.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+144+96 $< $@
+
+%_d4.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+144+144 $< $@
+
+%_e.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+192+0 $< $@
+	
+%_e2.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+192+48 $< $@
+
+%_f.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+240+0 $< $@
+	
+%_f2.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+240+48 $< $@
+
+%_g.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+288+0 $< $@
+	
+%_g2.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+288+48 $< $@
+
+%_h.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+336+0 $< $@
+	
+%_h2.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+336+48 $< $@
+
+%_i.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+384+0 $< $@
+	
+%_i2.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+384+48 $< $@
+
+%_j.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+432+0 $< $@
+	
+%_j2.png: $(GFXDIR)/%.png
+	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+432+48 $< $@
+
 %.png: $(GFXDIR)/%.png
 	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< $@
 

Added: trunk/doc/reference/images/construction.png
===================================================================
(Binary files differ)


Property changes on: trunk/doc/reference/images/construction.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Modified: trunk/src/stones/Door.cc
===================================================================
--- trunk/src/stones/Door.cc	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/src/stones/Door.cc	2009-07-11 22:35:03 UTC (rev 1751)
@@ -80,9 +80,9 @@
     void Door::init_model() {
         string mname = model_basename();
         if (state == CLOSED)
-            mname += "-closed";
+            mname += "_closed";
         else if (state==OPEN)
-            mname += "-open";
+            mname += "_open";
         set_model(mname);
     }
 
@@ -149,9 +149,9 @@
     std::string Door::model_basename() {
         std::string flavor = getAttr("flavor").to_string();
         if (flavor != "d")
-            return std::string("st-door_") + flavor;
+            return std::string("st_door_") + flavor;
         else
-            return (getConnections() == (WESTBIT | EASTBIT)) ? "st-doorh": "st-doorv";
+            return (getConnections() == (WESTBIT | EASTBIT)) ? "st_door_d_ns" : "st_door_d_ew";
     }
     
     void Door::set_iState(int newState) {
@@ -159,14 +159,14 @@
             std::string basename = model_basename();
             switch (newState) {
                 case OPEN:
-                    set_model(basename+"-open");
+                    set_model(basename+"_open");
                     MaybeRecalcLight(get_pos());
                     SendMessage(GetFloor(get_pos()), "_checkflood");
                     for (Direction d = NORTH; d != NODIR; d = previous(d))
                         SendMessage(GetFloor(move(get_pos(), d)), "_checkflood");
                     break;
                 case CLOSED:
-                    set_model(basename+"-closed");
+                    set_model(basename+"_closed");
                     ShatterActorsInsideField (get_pos());
                     MaybeRecalcLight(get_pos()); // maybe superfluous
                     break;
@@ -175,14 +175,14 @@
                     if (state == CLOSING)
                         get_model()->reverse();
                     else
-                        set_anim(basename+"-opening");
+                        set_anim(basename+"_opening");
                     break;
                 case CLOSING:
                     sound_event((getAttr("flavor").to_string() == "d") ? "doorclose" : "");
                     if (state == OPENING)
                         get_model()->reverse();
                     else
-                        set_anim(basename+"-closing");
+                        set_anim(basename+"_closing");
                     ShatterActorsInsideField (get_pos());
                     MaybeRecalcLight(get_pos());
                     break;

Modified: trunk/src/stones/LaserSwitch.cc
===================================================================
--- trunk/src/stones/LaserSwitch.cc	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/src/stones/LaserSwitch.cc	2009-07-11 22:35:03 UTC (rev 1751)
@@ -55,7 +55,7 @@
     }
     
     void LaserSwitch::init_model() {
-        set_model(ecl::strf("st-laserswitch%d", state == ON ? 1 : 0));
+        set_model(ecl::strf("st_laserswitch%d", state == ON ? 1 : 0));
     }
     
     void LaserSwitch::on_creation(GridPos p) {

Modified: trunk/src/stones/MailStone.cc
===================================================================
--- trunk/src/stones/MailStone.cc	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/src/stones/MailStone.cc	2009-07-11 22:35:03 UTC (rev 1751)
@@ -45,8 +45,8 @@
     }
 
     void MailStone::init_model() {
-        string mname = "st-mail" ;
-        set_model(mname + to_suffix(getOrientation()));
+        string mname = "st_mail" ;
+        set_model(mname + toSuffix(getOrientation()));
     }
     
     void MailStone::actor_hit(const StoneContact &sc) {

Modified: trunk/src/stones/MonoFlopStone.cc
===================================================================
--- trunk/src/stones/MonoFlopStone.cc	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/src/stones/MonoFlopStone.cc	2009-07-11 22:35:03 UTC (rev 1751)
@@ -73,7 +73,7 @@
     }
     
     void MonoFlopStone::init_model() {
-        set_model(state <= OFF_NEW ? "st-timeswitch" : "st-time1switch");
+        set_model(state <= OFF_NEW ? "st_monoflop" : "st_monoflop_anim");
     }
     
     void MonoFlopStone::on_creation (GridPos p) {

Modified: trunk/src/stones/ShogunStone.cc
===================================================================
--- trunk/src/stones/ShogunStone.cc	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/src/stones/ShogunStone.cc	2009-07-11 22:35:03 UTC (rev 1751)
@@ -100,7 +100,7 @@
     }
     
     void ShogunStone::init_model() {
-        set_model(ecl::strf("st-shogun%d", getHoles()/S));
+        set_model(ecl::strf("st_shogun%d", getHoles()/S));
     }
     
     void ShogunStone::setOwnerPos(GridPos po) {

Modified: trunk/src/stones/TimerStone.cc
===================================================================
--- trunk/src/stones/TimerStone.cc	2009-07-11 19:58:16 UTC (rev 1750)
+++ trunk/src/stones/TimerStone.cc	2009-07-11 22:35:03 UTC (rev 1751)
@@ -70,7 +70,7 @@
         if (getAttr("invisible").to_bool()) {
             set_model("invisible");
         } else {
-            set_model(state == OFF ? "st-timeroff" : "st-timer");
+            set_model(state == OFF ? "st_timeroff" : "st_timer");
         }
     }
     



From ral at mail.berlios.de  Sun Jul 12 01:06:11 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 12 Jul 2009 01:06:11 +0200
Subject: [Enigma-game-svn] r1752 - in trunk/doc/reference: . images
Message-ID: <200907112306.n6BN6BwV008765@sheep.berlios.de>

Author: ral
Date: 2009-07-12 01:05:49 +0200 (Sun, 12 Jul 2009)
New Revision: 1752

Modified:
   trunk/doc/reference/enigma-ref.texi
   trunk/doc/reference/images/Makefile.am
Log:
Trunk 1.1: 
- fix r1751 - makefile problem

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-07-11 22:35:03 UTC (rev 1751)
+++ trunk/doc/reference/enigma-ref.texi	2009-07-11 23:05:49 UTC (rev 1752)
@@ -1745,9 +1745,12 @@
 
 @table @asis
 @item @b{title}, @i{required}
-The English title of the level. Make sure that the title is not too long, since Enigma
-will use it on the level selection menu. Translations of the title can be provided
-in the @ref{Internationalization (i18n)} sections.
+The English title of the level. The string can contain arbitrary characters
+that are displayable by Enigma's font and XML conformant. Just in case of
+ at ref{Multilevel files} a trailing hash sign has a special meaning. Anyway please
+make sure that the title is not too long, since Enigma will use it on the level
+selection menu. Translations of the title can be provided in the
+ at ref{Internationalization (i18n)} sections.
 
 @item @b{subtitle}, @i{optional}
 An optional English subtitle. Used for title parts that are too long for the
@@ -1757,13 +1760,15 @@
 
 @item @b{id}, @i{required}
 This is the central system identification string of the level that remains valid
-for all time, independent of upcoming release updates. Enigma's single demand
-on the id is that it is unique among all levels created by all authors
-around the world.
+for all time, independent of upcoming release updates. The id string should not
+contain spaces, braces and wildcard characters, that means no character out
+of @samp{*? ()[]@{@}}. Enigma's main demand on the id is that it is unique among
+all levels created by all authors around the world and that it does not end on a
+closing square bracket.
 
-Since you can edit levels with any text editor or different special Enigma level editors, there is no
-control about the uniqueness. Thus, we have to provide a simple convention to avoid any
-possible id clashes:
+Since you can edit levels with any text editor or different special Enigma level
+editors, there is no control about the uniqueness. Thus, we have to provide a
+simple convention to avoid any possible id clashes:
 
 @var{@b{YYYYMMDDuserNNN}}
 
@@ -1775,8 +1780,8 @@
 never exposed to users.
 
 For backward compatibility, legacy levels keep their former filename as the
-new level id, and do not fit in the name schema given above. Still, that does no harm since the
-only requirement is the uniqueness.
+new level id, and do not fit in the name schema given above. Still, that does 
+not harm since the only requirement is the uniqueness.
 
 @end table
 

Modified: trunk/doc/reference/images/Makefile.am
===================================================================
--- trunk/doc/reference/images/Makefile.am	2009-07-11 22:35:03 UTC (rev 1751)
+++ trunk/doc/reference/images/Makefile.am	2009-07-11 23:05:49 UTC (rev 1752)
@@ -225,7 +225,6 @@
 	st_plaster.png \
 	st_plop_slate.png \
 	st_pull.png \
-	st_puzzle.png \
 	st_portal_horse.png \
 	st_purplegray.png \
 	st_purplemarble.png \



From raoul at mail.berlios.de  Sun Jul 12 21:15:15 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sun, 12 Jul 2009 21:15:15 +0200
Subject: [Enigma-game-svn] r1753 - in trunk/data: . levels/enigma_i
	levels/enigma_ii levels/enigma_iii levels/enigma_iv
	levels/enigma_v levels/enigma_vi levels/enigma_vii
	levels/enigma_viii
Message-ID: <200907121915.n6CJFFuL013879@sheep.berlios.de>

Author: raoul
Date: 2009-07-12 21:15:12 +0200 (Sun, 12 Jul 2009)
New Revision: 1753

Modified:
   trunk/data/api2init.lua
   trunk/data/levels/enigma_i/siegfried36_2.xml
   trunk/data/levels/enigma_ii/ant16_3.xml
   trunk/data/levels/enigma_ii/siegfried37_2.xml
   trunk/data/levels/enigma_iii/ant15_2.xml
   trunk/data/levels/enigma_iii/nat30_2.xml
   trunk/data/levels/enigma_iii/nat31_2.xml
   trunk/data/levels/enigma_iii/ss11_2.xml
   trunk/data/levels/enigma_iv/ant23_2.xml
   trunk/data/levels/enigma_iv/duffy17_3.xml
   trunk/data/levels/enigma_v/duffy22_2.xml
   trunk/data/levels/enigma_v/nat15_2.xml
   trunk/data/levels/enigma_v/ral05_2.xml
   trunk/data/levels/enigma_v/ralf11_3.xml
   trunk/data/levels/enigma_v/ralf12_2.xml
   trunk/data/levels/enigma_v/ss10_2.xml
   trunk/data/levels/enigma_vi/ral08_2.xml
   trunk/data/levels/enigma_vi/raoul29_1.xml
   trunk/data/levels/enigma_vii/alain28_2.xml
   trunk/data/levels/enigma_vii/duffy148_2.xml
   trunk/data/levels/enigma_vii/ral20_2.xml
   trunk/data/levels/enigma_vii/ral22_2.xml
   trunk/data/levels/enigma_viii/andreas56_1.xml
   trunk/data/levels/enigma_viii/devnull08_1.xml
   trunk/data/levels/enigma_viii/devnull09_1.xml
   trunk/data/levels/enigma_viii/devnull11_1.xml
   trunk/data/levels/enigma_viii/devnull12_1.xml
   trunk/data/levels/enigma_viii/devnull19_1.xml
   trunk/data/levels/enigma_viii/devnull27_1.xml
   trunk/data/levels/enigma_viii/devnull28_1.xml
   trunk/data/levels/enigma_viii/ral23_1.xml
   trunk/data/levels/enigma_viii/ral43_1.xml
Log:
-> Renamed constants (IN)DISPENSIBLE to (IN)DISPENSABLE in all levels
-> Removed old version from api init.



Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/api2init.lua	2009-07-12 19:15:12 UTC (rev 1753)
@@ -166,8 +166,6 @@
            [NORTHWEST]=NW, [SOUTHWEST]=SW, [SOUTHEAST]=SE, [NORTHEAST]=NE}
 
 -- essential
-DISPENSIBLE   = 0   -- typo to be deleted when all levels are updated
-INDISPENSIBLE = 1   -- typo to be deleted when all levels are updated
 DISPENSABLE   = 0
 INDISPENSABLE = 1
 PERKIND       = 2

Modified: trunk/data/levels/enigma_i/siegfried36_2.xml
===================================================================
--- trunk/data/levels/enigma_i/siegfried36_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_i/siegfried36_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="- Meditation -" el:subtitle="" el:id="meditation15"/>
-      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="4" el:status="released"/>
       <el:author  el:name="Siegfried Fennig" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2002 Siegfried Fennig</el:copyright>
       <el:license el:type="Donated to Enigma under the projects license" el:open="true"/>
@@ -28,7 +28,7 @@
 ti["c"] = {"fl_slope_inw"}
 ti["d"] = {"fl_slope_ine"}
 ti["o"] = {"it_meditation_hollow"}
-ti["@"] = {"#ac_pearl", essential=INDISPENSIBLE}
+ti["@"] = {"#ac_pearl", essential=INDISPENSABLE}
 
 wo(ti, "-", {
     "                                                          ",

Modified: trunk/data/levels/enigma_ii/ant16_3.xml
===================================================================
--- trunk/data/levels/enigma_ii/ant16_3.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_ii/ant16_3.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="- Meditation -" el:subtitle="" el:id="ant16"/>
-      <el:version el:score="2" el:release="3" el:revision="2" el:status="released"/>
+      <el:version el:score="2" el:release="3" el:revision="3" el:status="released"/>
       <el:author  el:name="Petr Machata" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Petr Machata</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -21,7 +21,7 @@
 ti["="] = ti["~"] .. {"st_death"}      -- no maze water
 ti["#"] = {"st_granite"}
 ti["o"] = {"it_meditation_hollow"}
-ti["@"] = {"it_magnet", state=ON} .. ti({"#ac_pearl", essential=INDISPENSIBLE})
+ti["@"] = {"it_magnet", state=ON} .. ti({"#ac_pearl", essential=INDISPENSABLE})
 
 maze = res.maze(ti, {area={"~"}, render={"-", "~", "-"}})
 

Modified: trunk/data/levels/enigma_ii/siegfried37_2.xml
===================================================================
--- trunk/data/levels/enigma_ii/siegfried37_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_ii/siegfried37_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="- Meditation -" el:subtitle="" el:id="meditation16"/>
-      <el:version el:score="1" el:release="2" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
       <el:author el:name="Siegfried Fennig" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? Siegfried Fennig</el:copyright>
       <el:license el:type="Donated to Enigma under the projects license" el:open="true"/>
@@ -28,7 +28,7 @@
 ti["c"] = {"fl_slope_inw"}
 ti["d"] = {"fl_slope_ine"}
 ti["o"] = {"it_meditation_hollow"}
-ti["@"] = {"#ac_pearl", essential=INDISPENSIBLE}
+ti["@"] = {"#ac_pearl", essential=INDISPENSABLE}
 
 wo(ti, "-", {
     "                    ",

Modified: trunk/data/levels/enigma_iii/ant15_2.xml
===================================================================
--- trunk/data/levels/enigma_iii/ant15_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_iii/ant15_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="- Snow White -" el:subtitle="" el:id="ant15"/>
-      <el:version el:score="1" el:release="2" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
       <el:author  el:name="Petr Machata" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Petr Machata</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -42,7 +42,7 @@
 local theta = 2.0*math.pi/number
 local segment = 2.0*radius*math.sin(theta/2.0)
 for i=0,number-1 do
-    wo[no["white"]+po(0.5,0.5)+po(radius*math.cos(i*theta-math.pi/2.0), radius*math.sin(i*theta-math.pi/2.0))] = {"ac_pearl", name="ball#", controllers=CTRL_NONE, essential=INDISPENSIBLE}
+    wo[no["white"]+po(0.5,0.5)+po(radius*math.cos(i*theta-math.pi/2.0), radius*math.sin(i*theta-math.pi/2.0))] = {"ac_pearl", name="ball#", controllers=CTRL_NONE, essential=INDISPENSABLE}
 end
 local balls = no["ball#*"]:sort("circular")
 for i=0,#balls-1 do

Modified: trunk/data/levels/enigma_iii/nat30_2.xml
===================================================================
--- trunk/data/levels/enigma_iii/nat30_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_iii/nat30_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Bad Flowers" el:subtitle="" el:id="nat30"/>
-      <el:version el:score="2" el:release="2" el:revision="2" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="3" el:status="released"/>
       <el:author  el:name="Nat Pryce" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2005 Nat Pryce</el:copyright>
       <el:license el:type="GPL version 2" el:open="true"/>
@@ -17,8 +17,8 @@
 ti["#"] = {"st_metal"}
 ti["o"] = {"it_meditation"}
 ti["."] = {"ac_marble"}
-ti["1"] = {"ac_pearl", essential=INDISPENSIBLE}
-ti["2"] = {"ac_pearl", adhesion=-1.0, essential=INDISPENSIBLE}
+ti["1"] = {"ac_pearl", essential=INDISPENSABLE}
+ti["2"] = {"ac_pearl", adhesion=-1.0, essential=INDISPENSABLE}
 
 w, h = wo(ti, " ", {
     "####################",

Modified: trunk/data/levels/enigma_iii/nat31_2.xml
===================================================================
--- trunk/data/levels/enigma_iii/nat31_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_iii/nat31_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Too Many Holes" el:subtitle="" el:id="nat31"/>
-      <el:version el:score="2" el:release="2" el:revision="2" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="3" el:status="released"/>
       <el:author  el:name="Nat Pryce" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2005 Nat Pryce</el:copyright>
       <el:license el:type="GPL version 2" el:open="true"/>
@@ -16,8 +16,8 @@
 ti[" "] = {"fl_lawn"}
 ti["#"] = {"st_lightglass"}
 ti["*"] = {"st_lightglass", name="inner_border#"}
-ti["o"] = {"it_meditation_hollow", essential=INDISPENSIBLE}
-ti["."] = {"ac_pearl", 0.0, 0.5, essential=INDISPENSIBLE}
+ti["o"] = {"it_meditation_hollow", essential=INDISPENSABLE}
+ti["."] = {"ac_pearl", 0.0, 0.5, essential=INDISPENSABLE}
 
 width, height = wo(ti, " ", 58, 37)
 wo:drawBorder(po(0,0), po(57, 36), ti["#"])

Modified: trunk/data/levels/enigma_iii/ss11_2.xml
===================================================================
--- trunk/data/levels/enigma_iii/ss11_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_iii/ss11_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
     <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Blind Date" el:subtitle="" el:id="ss11"/>
-      <el:version el:score="1" el:release="2" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
       <el:author  el:name="Sven Siggelkow" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Sven Siggelkow</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -19,7 +19,7 @@
 ti["o"] = {"it_meditation_hollow"}
 ti["X"] = {"st_grate", flavor="cross"}
 ti["S"] = {"st_swap"}
-ti["@"] = {"#ac_pearl", essential=INDISPENSIBLE}
+ti["@"] = {"#ac_pearl", essential=INDISPENSABLE}
 
 wo(ti, " ", {
     "####################",

Modified: trunk/data/levels/enigma_iv/ant23_2.xml
===================================================================
--- trunk/data/levels/enigma_iv/ant23_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_iv/ant23_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="- Meditation -" el:subtitle="" el:id="ant23"/>
-      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="4" el:status="released"/>
       <el:author  el:name="Petr Machata" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Petr Machata</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -26,7 +26,7 @@
     wo["MeditationStrength"] = 1.3
 end
 ti["W"] = {"st_plop_slate", name="boxes#"}
-ti["@"] = {"#ac_pearl", name="balls#", target="@boxes#*", essential=INDISPENSIBLE}
+ti["@"] = {"#ac_pearl", name="balls#", target="@boxes#*", essential=INDISPENSABLE}
 
 local resolver = res.autotile(ti, {"a", "d", "T"}, {"A", "D", "U"})
 wo(resolver, " ", {

Modified: trunk/data/levels/enigma_iv/duffy17_3.xml
===================================================================
--- trunk/data/levels/enigma_iv/duffy17_3.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_iv/duffy17_3.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Double-Spiral" el:subtitle="" el:id="duffy17"/>
-      <el:version el:score="2" el:release="3" el:revision="3" el:status="released"/>
+      <el:version el:score="2" el:release="3" el:revision="4" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -48,8 +48,8 @@
 ti["F"] = {"st_floppy", target = "door3"}
 ti["b"] = ti[" "] .. {"it_brush"}
 ti["O"] = {"st_oxyd"}
-ti["@"] = {"#ac_marble_black", essential = INDISPENSIBLE}
-ti["*"] = {"#ac_marble_white", essential = INDISPENSIBLE}
+ti["@"] = {"#ac_marble_black", essential = INDISPENSABLE}
+ti["*"] = {"#ac_marble_white", essential = INDISPENSABLE}
 
 w, h = wo(ti, " ", {
     "#######################################",

Modified: trunk/data/levels/enigma_v/duffy22_2.xml
===================================================================
--- trunk/data/levels/enigma_v/duffy22_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_v/duffy22_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Choo-Choo" el:subtitle="" el:id="duffy22"/>
-      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="4" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -34,10 +34,10 @@
 ti["t"] = {"it_trigger", action_1="flip", target_1="@@boulder#*", action_0="callback", target_0="boulder"}
 ti["u"] = {"it_trigger", action_1="turn", target="@@boulder#*"}
 ti["O"] = {"st_oxyd", name="oxyd"}
-ti["."] = {"#ac_pearl", controllers=CTRL_NONE, owner=YANG, essential=INDISPENSIBLE, name="actor#"}
+ti["."] = {"#ac_pearl", controllers=CTRL_NONE, owner=YANG, essential=INDISPENSABLE, name="actor#"}
 if wo["IsDifficult"] then
     ti["*"] = {"st_death"}
-    ti[":"] = {"#ac_pearl", controllers=CTRL_NONE, owner=YANG, essential=INDISPENSIBLE, name="actor#"}
+    ti[":"] = {"#ac_pearl", controllers=CTRL_NONE, owner=YANG, essential=INDISPENSABLE, name="actor#"}
 else
     ti["*"] = {"st_greenbrown"}
     ti[":"] = ti[" "]

Modified: trunk/data/levels/enigma_v/nat15_2.xml
===================================================================
--- trunk/data/levels/enigma_v/nat15_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_v/nat15_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Caterpillar" el:subtitle="" el:id="nat15"/>
-      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
       <el:author  el:name="Nat Pryce" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Nat Pryce</el:copyright>
       <el:license el:type="GPL version 2" el:open="true"/>
@@ -27,7 +27,7 @@
 ti["^"] = ti["."] .. {"st_oneway", color=WHITE, orientation=NORTH}
 ti["V"] = ti["."] .. {"st_oneway", color=WHITE, orientation=SOUTH}
 ti["t"] = ti["-"] .. {"it_trigger", name="triggers#", target="concat"}
-ti["*"] = ti["W"] .. {"#ac_marble_white", name="whiteballs#", essential=INDISPENSIBLE}
+ti["*"] = ti["W"] .. {"#ac_marble_white", name="whiteballs#", essential=INDISPENSABLE}
 ti["@"] = {"#ac_marble_black", name="blackball"}
 
 local map = {

Modified: trunk/data/levels/enigma_v/ral05_2.xml
===================================================================
--- trunk/data/levels/enigma_v/ral05_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_v/ral05_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title ="Catwalk Meditation" el:id="20060505ral007"/>
-      <el:version el:score="2" el:release="2" el:revision="$Revision: 159 $" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="$Revision: 160 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2006,2009 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -23,7 +23,7 @@
 ti["="] = {"st_redbrown_hollow"} .. ti{"fl_fake_abyss", force_y=-500}
 ti["o"] = {"it_meditation_dent"} .. ti["."]
 
-ti["1"] = ti["."] .. {"#ac_pearl", essential=INDISPENSIBLE}
+ti["1"] = ti["."] .. {"#ac_pearl", essential=INDISPENSABLE}
 
 if wo["IsDifficult"] then
     ti["t"] = ti["."] .. {"it_trigger", target="nocompress"}

Modified: trunk/data/levels/enigma_v/ralf11_3.xml
===================================================================
--- trunk/data/levels/enigma_v/ralf11_3.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_v/ralf11_3.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Swamp Stomp" el:subtitle="" el:id="ralf11"/>
-      <el:version el:score="2" el:release="3" el:revision="2" el:status="released"/>
+      <el:version el:score="2" el:release="3" el:revision="3" el:status="released"/>
       <el:author  el:name="Ralf Westram" el:email="amgine at reallysoft.de" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Ralf Westram</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -41,7 +41,7 @@
 end
 ti["#"] = {"fl_blueslab"} .. ti({"st_rawglass"})
 ti["O"] = {"fl_blueslab"} .. ti({"st_oxyd"})
-ti["*"] = ti["-"] .. {"#ac_marble_white", essential=INDISPENSIBLE}
+ti["*"] = ti["-"] .. {"#ac_marble_white", essential=INDISPENSABLE}
 ti["@"] = ti["-"] .. {"#ac_marble_black"}
 
 wo(ti, " ", {

Modified: trunk/data/levels/enigma_v/ralf12_2.xml
===================================================================
--- trunk/data/levels/enigma_v/ralf12_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_v/ralf12_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="- Meditation -" el:subtitle="" el:id="ralf12"/>
-      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
       <el:author  el:name="Ralf Westram" el:email="amgine at reallysoft.de" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Ralf Westram</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -24,7 +24,7 @@
 ti["trigger"] = {"it_trigger", target="counter%%", action="signal"}
 ti["R"] = {"st_puzzle", color=YELLOW}
 ti["S"] = ti({"st_puzzle", color=YELLOW}) .. {"it_meditation_hollow"}
-ti["@ "] = {"#ac_pearl", essential=INDISPENSIBLE}
+ti["@ "] = {"#ac_pearl", essential=INDISPENSABLE}
 
 local resolver = res.autotile(res.puzzle(ti, "R", "S"), {"t", "trigger"}, {"D", "door"})
 

Modified: trunk/data/levels/enigma_v/ss10_2.xml
===================================================================
--- trunk/data/levels/enigma_v/ss10_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_v/ss10_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Jumpin' Jack Flash" el:subtitle="" el:id="ss10"/>
-      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
       <el:author  el:name="Sven Siggelkow" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Sven Siggelkow</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -26,9 +26,9 @@
 ti["T"] = {"st_mirror", flavor="triangle", orientation=SOUTH, movable=true}
 ti[">"] = {"st_laser", orientation=EAST, state=ON, name="laser"}
 ti["S"] = {"st_switch", target="laser"}
-ti["o"] = {"it_meditation_hollow", essential=INDISPENSIBLE}
+ti["o"] = {"it_meditation_hollow", essential=INDISPENSABLE}
 ti["b"] = cond(wo["IsDifficult"], ti[" "], {"it_spade"})
-ti["*"] = {"ac_pearl", 0.0, 0.5, essential=INDISPENSIBLE}
+ti["*"] = {"ac_pearl", 0.0, 0.5, essential=INDISPENSABLE}
 ti["@"] = {"ac_marble_black", 0.0, 0.5}
 
 wo(ti, " ", {

Modified: trunk/data/levels/enigma_vi/ral08_2.xml
===================================================================
--- trunk/data/levels/enigma_vi/ral08_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_vi/ral08_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title ="Hot Meditation" el:id="20060527ral010"/>
-      <el:version el:score="1" el:release="2" el:revision="$Revision: 166 $" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="$Revision: 167 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2006,2009 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -23,7 +23,7 @@
 ti[","] = {"fl_wood"}
 ti[";"] = {"it_burnable"} .. ti[","]
 ti["o"] = {"it_meditation"}
-ti["1"] = {"#ac_pearl", essential=INDISPENSIBLE}
+ti["1"] = {"#ac_pearl", essential=INDISPENSABLE}
 
 if wo["IsDifficult"] then
     ti["O"] = ti["o"]

Modified: trunk/data/levels/enigma_vi/raoul29_1.xml
===================================================================
--- trunk/data/levels/enigma_vi/raoul29_1.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_vi/raoul29_1.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Same task ..." el:subtitle="... different Mirrors" el:id="raoul29"/>
-      <el:version el:score="1" el:release="1" el:revision="11" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="12" el:status="released"/>
       <el:author  el:name="Raoul Bourquin" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Raoul Bourquin</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -33,8 +33,8 @@
 ti["L"] = {"st_laser", orientation=WEST, name="l_west"}
 ti["l"] = {"st_laser", orientation=EAST, name="l_east"}
 ti["O"] = {"st_oxyd", flavor="b"}
-ti["A"] = ti["y"] .. {"#ac_marble_black", essential=INDISPENSIBLE}
-ti["B"] = ti["y"] .. {"#ac_marble_white", essential=INDISPENSIBLE}
+ti["A"] = ti["y"] .. {"#ac_marble_black", essential=INDISPENSABLE}
+ti["B"] = ti["y"] .. {"#ac_marble_white", essential=INDISPENSABLE}
 if  wo["IsDifficult"]  then
     ti["~"] = {"fl_abyss", friction=0.25}
     ti["*"] = ti["~"] .. {"ac_rotor", 0.0, 0.5, strength=20, range=15, prefercurrent=1}

Modified: trunk/data/levels/enigma_vii/alain28_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/alain28_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_vii/alain28_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Pool with a pole" el:subtitle="" el:id="alain28"/>
-      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
       <el:author  el:name="Alain Busser" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2006 Alain Busser</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -20,7 +20,7 @@
 ti["#"] = {"st_actorimpulse"}
 ti["x"] = {"st_passage_white_frame"}
 ti["-"] = {"fl_slope_te"}
-ti["O"] = {"it_meditation_hollow", essential = INDISPENSIBLE}
+ti["O"] = {"it_meditation_hollow", essential = INDISPENSABLE}
 ti["o"] = {"#ac_pearl", owner = nil, controllers = 0}
 ti["@"] = {"#ac_marble_black", name = "black", owner = 0}
 ti["*"] = {"#ac_marble_white", name = "white", owner = 0}

Modified: trunk/data/levels/enigma_vii/duffy148_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/duffy148_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_vii/duffy148_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Speed Meditation" el:subtitle="Beware of Bumps and Radar Impulses" el:id="duffy148"/>
-      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="4" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -20,7 +20,7 @@
 ti["T"] = {"st_timer", action="signal", target="pulser", interval=1.5}
 ti["H"] = {"it_meditation_hollow"}
 ti["h"] = {"it_meditation_hill"}
-ti["@"] = {"#ac_pearl", essential=INDISPENSIBLE}
+ti["@"] = {"#ac_pearl", essential=INDISPENSABLE}
 
 wo(ti, " ", {
     "####################T",

Modified: trunk/data/levels/enigma_vii/ral20_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/ral20_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_vii/ral20_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Meditation in Peace" el:subtitle="Funeral on Deep Sea" el:id="20070502ral466"/>
-      <el:version el:score="2" el:release="2" el:revision="$Revision: 148 $" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="$Revision: 149 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2006,2009 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -42,7 +42,7 @@
 ti["s"] = {"it_spade"}
 ti["t"] = {"it_document", text="Health"}
 
-ti["2"] = {"#ac_pearl", owner=DEFAULT, controllers=CTRL_NONE, essential=INDISPENSIBLE}
+ti["2"] = {"#ac_pearl", owner=DEFAULT, controllers=CTRL_NONE, essential=INDISPENSABLE}
 
 ti["T"] = ti["~"] .. {"st_timer", invisible=1, interval=0.1, target="wave"}
 

Modified: trunk/data/levels/enigma_vii/ral22_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/ral22_2.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_vii/ral22_2.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Maze for Two" el:subtitle="Keep distance!" el:id="20071017ral096"/>
-      <el:version el:score="2" el:release="2" el:revision="$Revision: 100 $" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="$Revision: 101 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2007,2009 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -25,8 +25,8 @@
 ti["#"] = {"st_redbrown"}
 ti["y"] = {"it_yinyang"}
 ti["x"] = {"st_oxyd_d", "oxyd#*"}
-ti["@b"] = {"#ac_marble_black", controllers=CTRL_YINYANG, essential=INDISPENSIBLE} .. ti["y"]
-ti["@w"] = {"#ac_marble_white", controllers=CTRL_YINYANG, essential=INDISPENSIBLE} .. ti["y"]
+ti["@b"] = {"#ac_marble_black", controllers=CTRL_YINYANG, essential=INDISPENSABLE} .. ti["y"]
+ti["@w"] = {"#ac_marble_white", controllers=CTRL_YINYANG, essential=INDISPENSABLE} .. ti["y"]
 ti["wall"] = ti[" "]
 ti["wall_white"] = {"st_passage_black", flavor="square"} .. ti["-"]
 ti["wall_black"] = {"st_passage_white", flavor="square"} .. ti["-"]

Modified: trunk/data/levels/enigma_viii/andreas56_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/andreas56_1.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_viii/andreas56_1.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="5 Days and 5 Nights" el:subtitle="" el:id="andreas56"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2009 Andreas Lochmann</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -25,7 +25,7 @@
 ti["Y"] = {"st_yinyang", loop = false, target = "change_design"}
 ti["B"] = {"st_blur_cross"}
 ti["S"] = {"st_surprise", selection = {"st_passage_black", "st_passage_white"}}
-ti["@"] = {"#ac_marble", essential = INDISPENSIBLE}
+ti["@"] = {"#ac_marble", essential = INDISPENSABLE}
 
 if wo["IsDifficult"] then
     ti["%"] = {"#ac_killer", controllers = CTRL_YANG, adhesion = 0.7, owner = YANG}

Modified: trunk/data/levels/enigma_viii/devnull08_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/devnull08_1.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_viii/devnull08_1.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Relaxing at the sea" el:subtitle="" el:id="devnull08"/>
-      <el:version el:score="1" el:release="1" el:revision="22" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="23" el:status="released"/>
       <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 dev0</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -31,9 +31,9 @@
 ti["w "] = {"st_box_wood"}
 ti["R "] = {"st_darkgray"}
 ti["% "] = {"it_document", text = "text1"}
-ti["7 "] = {"it_meditation_hollow", essential = DISPENSIBLE}
-ti["8 "] = {"it_meditation_hollow", essential = INDISPENSIBLE} .. ti["p "]
-ti["9 "] = {"it_meditation_hollow", essential = INDISPENSIBLE}
+ti["7 "] = {"it_meditation_hollow", essential = DISPENSABLE}
+ti["8 "] = {"it_meditation_hollow", essential = INDISPENSABLE} .. ti["p "]
+ti["9 "] = {"it_meditation_hollow", essential = INDISPENSABLE}
 if wo["IsDifficult"] then
     ti["P "] = ti["p "]
     ti["W "] = ti[" r"]
@@ -41,8 +41,8 @@
     ti["P "] = ti[" r"]
     ti["W "] = ti["p "]
 end
-ti["1 "] = {"#ac_pearl_white", essential = INDISPENSIBLE}
-ti["2 "] = {"#ac_pearl_white", essential = INDISPENSIBLE} .. ti["p "]
+ti["1 "] = {"#ac_pearl_white", essential = INDISPENSABLE}
+ti["2 "] = {"#ac_pearl_white", essential = INDISPENSABLE} .. ti["p "]
 
 wo(res.composer(ti), "  ",
 { "            . . . . : : : : : : : . . . . : ",

Modified: trunk/data/levels/enigma_viii/devnull09_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/devnull09_1.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_viii/devnull09_1.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Under control?" el:subtitle="" el:id="devnull09"/>
-      <el:version el:score="1" el:release="1" el:revision="9" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="10" el:status="released"/>
       <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 dev0</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -34,10 +34,10 @@
 ti["A"] = ti[" "] .. {"st_window_esw", secure = true}
 ti["H"] = ti[" "] .. {"st_window_ew",  secure = true}
 ti["J"] = ti[" "] .. {"st_window_ns",  secure = true}
-ti["9"] = ti["C"] .. {"#ac_pearl_white", essential=INDISPENSIBLE}
-ti["8"] = ti["I"] .. {"#ac_pearl_white", essential=INDISPENSIBLE}
-ti["7"] = ti["C"] .. {"#ac_pearl_white", essential=INDISPENSIBLE}
-ti["6"] = ti["I"] .. {"#ac_pearl_white", essential=INDISPENSIBLE}
+ti["9"] = ti["C"] .. {"#ac_pearl_white", essential=INDISPENSABLE}
+ti["8"] = ti["I"] .. {"#ac_pearl_white", essential=INDISPENSABLE}
+ti["7"] = ti["C"] .. {"#ac_pearl_white", essential=INDISPENSABLE}
+ti["6"] = ti["I"] .. {"#ac_pearl_white", essential=INDISPENSABLE}
 
 wo(ti, " ",
 -- 0         1         2

Modified: trunk/data/levels/enigma_viii/devnull11_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/devnull11_1.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_viii/devnull11_1.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="2 + 2" el:id="devnull11"/>
-      <el:version el:score="1" el:release="1" el:revision="6" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="7" el:status="released"/>
       <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 dev0</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -54,10 +54,10 @@
 ti["O "] = {"st_oxyd", "oxyds3#"}
 ti["p "] = {"st_oxyd", "oxyds2#"}
 ti["P "] = {"st_oxyd", "oxyds4#"}
-ti[" k"] = {"#ac_marble_black", "marbleNE", essential = INDISPENSIBLE}
-ti[" K"] = ti({"fl_bridge_gc", state = CLOSED}) .. ti({"#ac_marble_black", "marbleSW", essential = INDISPENSIBLE})
-ti[" i"] = ti[" ."] .. {"#ac_marble_white", "marbleNW", essential = INDISPENSIBLE}
-ti[" I"] = ti({"fl_dark", friction = 5.5}) .. {"#ac_marble_white", "marbleSE", essential = INDISPENSIBLE}
+ti[" k"] = {"#ac_marble_black", "marbleNE", essential = INDISPENSABLE}
+ti[" K"] = ti({"fl_bridge_gc", state = CLOSED}) .. ti({"#ac_marble_black", "marbleSW", essential = INDISPENSABLE})
+ti[" i"] = ti[" ."] .. {"#ac_marble_white", "marbleNW", essential = INDISPENSABLE}
+ti[" I"] = ti({"fl_dark", friction = 5.5}) .. {"#ac_marble_white", "marbleSE", essential = INDISPENSABLE}
 if  wo["IsDifficult"] then
   ti["q."] = ti[" ~"]
   ti[" :"] = ti[" ~"]

Modified: trunk/data/levels/enigma_viii/devnull12_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/devnull12_1.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_viii/devnull12_1.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title=" - Meditation - " el:id="devnull12"/>
-      <el:version el:score="1" el:release="1" el:revision="8" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="9" el:status="released"/>
       <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 dev0</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -36,9 +36,9 @@
 end
 ti["8"] = ti["h"] .. {"st_window_s", secure = true}
 ti["7"] = ti["h"] .. {"st_window_n", secure = true}
-ti["@"] = ti[" "] .. {"#ac_pearl_white", essential=INDISPENSIBLE}
-ti["9"] = ti[" "] .. {"#ac_pearl_white", essential=INDISPENSIBLE}
-ti["6"] = ti[" "] .. {"#ac_pearl_white", essential=INDISPENSIBLE}
+ti["@"] = ti[" "] .. {"#ac_pearl_white", essential=INDISPENSABLE}
+ti["9"] = ti[" "] .. {"#ac_pearl_white", essential=INDISPENSABLE}
+ti["6"] = ti[" "] .. {"#ac_pearl_white", essential=INDISPENSABLE}
 
 wo(ti, " ",
 -- 0         1         2

Modified: trunk/data/levels/enigma_viii/devnull19_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/devnull19_1.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_viii/devnull19_1.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Near Halley I" el:subtitle="" el:id="devnull19"/>
-      <el:version el:score="1" el:release="1" el:revision="6" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="7" el:status="released"/>
       <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 dev0</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -22,8 +22,8 @@
 ti["wo"] = ti["  "] .. {"st_passage_white_frame"}
 ti["o "] = ti["  "] .. {"st_oxyd", name = "north#"}
 ti["O "] = ti["  "] .. {"st_oxyd", name = "south#"}
-ti["@b"] = ti["  "] .. {"#ac_marble_black", essential = INDISPENSIBLE}
-ti["@w"] = ti["  "] .. {"#ac_marble_white", essential = INDISPENSIBLE}
+ti["@b"] = ti["  "] .. {"#ac_marble_black", essential = INDISPENSABLE}
+ti["@w"] = ti["  "] .. {"#ac_marble_white", essential = INDISPENSABLE}
 ti["P"] = ti["  "] .. {"st_puzzle_blue", intensity = 4}
 
 if wo["IsDifficult"] then

Modified: trunk/data/levels/enigma_viii/devnull27_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/devnull27_1.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_viii/devnull27_1.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Two Is A Company III" el:subtitle="" el:id="devnull27"/>
-      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="4" el:status="released"/>
       <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 dev0</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -24,8 +24,8 @@
 ti["box"] = {"st_box_rock", "box%%"}
 ti["o"] = {"st_oxyd_a", name = "left#"}
 ti["O"] = {"st_oxyd_a", name = "right#"}
-ti["@"] = {"#ac_marble_black", essential = INDISPENSIBLE}
-ti["*"] = {"#ac_marble_white", essential = INDISPENSIBLE}
+ti["@"] = {"#ac_marble_black", essential = INDISPENSABLE}
+ti["*"] = {"#ac_marble_white", essential = INDISPENSABLE}
 
 wo(res.autotile(ti, {"1", "6", "box"}), " ", {
     "##################O#",

Modified: trunk/data/levels/enigma_viii/devnull28_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/devnull28_1.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_viii/devnull28_1.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Two Is A Company IV" el:subtitle="" el:id="devnull28"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 dev0</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -25,8 +25,8 @@
 ti["W"] = {"st_box_rock", "white"}
 ti["o"] = {"st_oxyd_a", name = "left#", static = true}
 ti["O"] = {"st_oxyd_a", name = "right#", static = true}
-ti["@"] = {"#ac_marble_black", essential = INDISPENSIBLE}
-ti["*"] = {"#ac_marble_white", essential = INDISPENSIBLE}
+ti["@"] = {"#ac_marble_black", essential = INDISPENSABLE}
+ti["*"] = {"#ac_marble_white", essential = INDISPENSABLE}
 
 local resolver = res.autotile(ti, {"1", "2", "box"}, {"3", "4", "pull"})
 wo(resolver, " ", {

Modified: trunk/data/levels/enigma_viii/ral23_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral23_1.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_viii/ral23_1.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Maze for Two II" el:subtitle="Keep distance!" el:id="20090330ral370"/>
-      <el:version el:score="2" el:release="2" el:revision="$Revision: 169 $" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="$Revision: 170 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2007,2009 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -25,8 +25,8 @@
 ti["#"] = {"st_granite"}
 ti["y"] = {"it_yinyang"}
 ti["x"] = {"st_oxyd_d", "oxyd#*"}
-ti["@b"] = {"#ac_marble_black", controllers=CTRL_YINYANG, essential=INDISPENSIBLE} .. ti["y"]
-ti["@w"] = {"#ac_marble_white", controllers=CTRL_YINYANG, essential=INDISPENSIBLE} .. ti["y"]
+ti["@b"] = {"#ac_marble_black", controllers=CTRL_YINYANG, essential=INDISPENSABLE} .. ti["y"]
+ti["@w"] = {"#ac_marble_white", controllers=CTRL_YINYANG, essential=INDISPENSABLE} .. ti["y"]
 ti["wall"] = ti[" "]
 ti["wall_white"] = {"st_passage_black", flavor="square"} .. ti["-"]
 ti["wall_black"] = {"st_passage_white", flavor="square"} .. ti["-"]

Modified: trunk/data/levels/enigma_viii/ral43_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral43_1.xml	2009-07-11 23:05:49 UTC (rev 1752)
+++ trunk/data/levels/enigma_viii/ral43_1.xml	2009-07-12 19:15:12 UTC (rev 1753)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Mole Hill Meditation" el:subtitle="" el:id="20090112ral228"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 138 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 139 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2009 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -27,7 +27,7 @@
 ti["wormholes"] = {"it_wormhole", range=0.3, destination="hill%%"}
 ti["hills"] = {"it_meditation_hill", "hill%%"}
 
-ti["@"] = {"#ac_pearl", essential=INDISPENSIBLE}
+ti["@"] = {"#ac_pearl", essential=INDISPENSABLE}
 
 resolver = res.autotile(ti, {"a", "d", "wormholes"}, {"A", "D", "hills"})
 



From ral at mail.berlios.de  Sun Jul 12 22:13:50 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 12 Jul 2009 22:13:50 +0200
Subject: [Enigma-game-svn] r1754 - in trunk: . data doc doc/reference
	doc/reference/images src/stones
Message-ID: <200907122013.n6CKDoLl019840@sheep.berlios.de>

Author: ral
Date: 2009-07-12 22:13:48 +0200 (Sun, 12 Jul 2009)
New Revision: 1754

Modified:
   trunk/configure.ac
   trunk/data/models-2d.lua
   trunk/doc/REQUIREMENTS
   trunk/doc/reference/enigma-ref.texi
   trunk/doc/reference/images/Makefile.am
   trunk/src/stones/PuzzleStone.cc
Log:
Trunk 1.1:
- refman images add oxyd colors
- config.ac: add ImageMagick convert tool
- fix models-2d.lua merge errors of r1751
- fix puzzle: remove sound event on touching unmovable clusters


Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2009-07-12 19:15:12 UTC (rev 1753)
+++ trunk/configure.ac	2009-07-12 20:13:48 UTC (rev 1754)
@@ -66,8 +66,11 @@
 fi
 
 dnl ---------- Texi2html ----------
-AC_PATH_PROG(TEXI2HTML, texi2html, "")
+AC_PATH_PROG([TEXI2HTML], [texi2html], [""])
 
+dnl ---------- ImageMagick ----------
+AC_PATH_PROG([CONVERT], [convert], [""])
+
 dnl ---------- Use the included tolua ----------
 AC_SUBST([TOLUA])
 TOLUA=["\$(top_builddir)/tools/tolua"]

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2009-07-12 19:15:12 UTC (rev 1753)
+++ trunk/data/models-2d.lua	2009-07-12 20:13:48 UTC (rev 1754)
@@ -171,11 +171,6 @@
     DefAlias("ac_killer", "ac_pearl_white")
 end
 
--- Marbles in inventory  --
-do
-    DefImage("inv-blackball")
-    DefImage("inv-whiteball")
-end
 
 ----------------------------
 -- not ball-shaped actors --
@@ -256,7 +251,6 @@
         {"fl_ivory"},
         {"fl_platinum"},
         {"fl_adhesionless", noframe = true},
-        {"fl-normal"},
         {"fl_sand"},
         {"fl_stone"},
         {"fl_white"},
@@ -273,7 +267,7 @@
         {"fl_hay", 4},
         {"fl_himalaya", 4},
         {"fl_marble", 4},
-        {"fl_metal", 6},
+        {"fl_metal", 7},
         {"fl_mortar", 2, 2},
         {"fl_plank", 4},
         {"fl_red", 4},
@@ -402,15 +396,15 @@
     DefAlias("fl_metal_4", "fl_metal4")
     DefAlias("fl_metal_5", "fl_metal5")
     DefAlias("fl_metal_6", "fl_metal6")
-    DefAlias("fl_metal_7", "fl-normal")
-    DefAlias("fl_metal_7n", "fl-normal")
+    DefAlias("fl_metal_7", "fl_metal7")
+    DefAlias("fl_metal_7n", "fl_metal7")
     DefAlias("fl_metal_1_framed", "fl_metal1_framed")
     DefAlias("fl_metal_2_framed", "fl_metal2_framed")
     DefAlias("fl_metal_3_framed", "fl_metal3_framed")
     DefAlias("fl_metal_4_framed", "fl_metal4_framed")
     DefAlias("fl_metal_5_framed", "fl_metal5_framed")
     DefAlias("fl_metal_6_framed", "fl_metal6_framed")
-    DefAlias("fl_metal_7_framed", "fl-normal_framed")
+    DefAlias("fl_metal_7_framed", "fl_metal7_framed")
     DefAlias("fl-space-force", "fl_space")
     DefAlias("fl_samba_h", "fl_samba1")
     DefAlias("fl_samba_v", "fl_samba2")
@@ -960,7 +954,7 @@
     DefRoundStoneWithAnim("st_yinyang", 6, 140)
 end
 
--- st-dynamite, st-bombs, st-whitebombs --
+-- st_dispenser --
 do
     function make_bombstone(name)
         local images = DefSubimages(name, {h=7})
@@ -973,6 +967,12 @@
     make_bombstone("st_dispenser_bombwhite")
 end
 
+-- st_dispenser_extralife --
+do
+    local images = DefSubimages("st_dispenser_extralife", {h=7})
+    DefRoundStone("st_dispenser_extralife", "st_dispenser_extralife1")
+end
+
 -- st-flash --
 do
     local images = DefSubimages("st_flash", {h=1})
@@ -1116,7 +1116,10 @@
 
 -- st-puzzle* --
 do
-    DefSubimages("st_puzzle", {modelname="st_puzzlex",w=16,h=4,startindex=0})
+    DefSubimages("st_puzzle_blue", {modelname="st_puzzlex",w=4,h=4,startindex=0})
+    DefSubimages("st_puzzle_yellow", {modelname="st_puzzlex",w=4,h=4,startindex=16})
+    DefSubimages("st_puzzle_blue_hollow", {modelname="st_puzzlex",w=4,h=4,startindex=32})
+    DefSubimages("st_puzzle_yellow_hollow", {modelname="st_puzzlex",w=4,h=4,startindex=48})
     -- Full puzzels
     for i=0,31  do DefSolidStone("st_puzzle"..i, "st_puzzlex"..i) end
     -- Hollow puzzels

Modified: trunk/doc/REQUIREMENTS
===================================================================
--- trunk/doc/REQUIREMENTS	2009-07-12 19:15:12 UTC (rev 1753)
+++ trunk/doc/REQUIREMENTS	2009-07-12 20:13:48 UTC (rev 1754)
@@ -97,7 +97,7 @@
 
 ImageMagick     
                 http://www.imagemagick.org
-                (just convert tool for png to pdf convertion)
+                (just convert tool)
 
 TeX
                 (for pdf generation)

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-07-12 19:15:12 UTC (rev 1753)
+++ trunk/doc/reference/enigma-ref.texi	2009-07-12 20:13:48 UTC (rev 1754)
@@ -17130,6 +17130,22 @@
 @item @code{"e"} black, flat stone that provides a peep hole after closing
 @end table
 @item @b{oxydcolor}, @ @ @i{values}: @code{OXYD_AUTO}, @code{OXYD_FAKE}, @code{OXYD_QUAKE}, @code{OXYD_BOLD}, @code{OXYD_BLUE}, @code{OXYD_RED}, @code{OXYD_GREEN}, @code{OXYD_YELLOW}, @code{OXYD_CYAN}, @code{OXYD_PURPLE}, @code{OXYD_WHITE}, @code{OXYD_BLACK}, @code{OXYD_GRAY}, @code{OXYD_ORANGE}, @code{OXYD_PINE}, @code{OXYD_BROWN}; @ @ @i{default}: @code{OXYD_AUTO}
+ at multitable @columnfractions .08 .17 .08 .17 .08 .17 .08 .17
+ at item @image{images/st_oxyd_color_0001, 10mm}@tab @code{OXYD_BLUE}
+ at tab @image{images/st_oxyd_color_0002, 10mm}@tab @code{OXYD_RED}
+ at tab @image{images/st_oxyd_color_0003, 10mm}@tab @code{OXYD_GREEN}
+ at tab @image{images/st_oxyd_color_0004, 10mm}@tab @code{OXYD_YELLOW}
+ at item @image{images/st_oxyd_color_0005, 10mm}@tab @code{OXYD_CYAN}
+ at tab @image{images/st_oxyd_color_0006, 10mm}@tab @code{OXYD_PURPLE}
+ at tab @image{images/st_oxyd_color_0007, 10mm}@tab @code{OXYD_WHITE}
+ at tab @image{images/st_oxyd_color_0008, 10mm}@tab @code{OXYD_BLACK}
+ at item @image{images/st_oxyd_color_0009, 10mm}@tab @code{OXYD_GRAY}
+ at tab @image{images/st_oxyd_color_0010, 10mm}@tab @code{OXYD_ORANGE}
+ at tab @image{images/st_oxyd_color_0011, 10mm}@tab @code{OXYD_PINE}
+ at tab @image{images/st_oxyd_color_0012, 10mm}@tab @code{OXYD_BROWN}
+ at item @image{images/st_oxyd_color_0097, 10mm}@tab @code{OXYD_QUAKE}
+ at tab @image{images/st_oxyd_color_0096, 10mm}@tab @code{OXYD_BOLD}
+ at end multitable
 @item @b{noshuffle} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 @item @b{static} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 Static oxyds are neither swappable nor pullable.

Modified: trunk/doc/reference/images/Makefile.am
===================================================================
--- trunk/doc/reference/images/Makefile.am	2009-07-12 19:15:12 UTC (rev 1753)
+++ trunk/doc/reference/images/Makefile.am	2009-07-12 20:13:48 UTC (rev 1754)
@@ -209,6 +209,11 @@
 	st_oxydc.png st_oxydc_open.png \
 	st_oxydd.png \
 	st_oxyde.png \
+	st_oxyd_color_0001.png st_oxyd_color_0002.png st_oxyd_color_0003.png \
+	st_oxyd_color_0004.png st_oxyd_color_0005.png st_oxyd_color_0006.png \
+	st_oxyd_color_0007.png st_oxyd_color_0008.png st_oxyd_color_0009.png \
+	st_oxyd_color_0010.png st_oxyd_color_0011.png st_oxyd_color_0012.png \
+	st_oxyd_color_0096.png st_oxyd_color_0097.png \
 	st_panel.png st_panel_2.png st_panel_3.png st_panel_4.png \
 	st_panel_b.png st_panel_b2.png st_panel_b3.png st_panel_b4.png \
 	st_panel_c.png st_panel_c2.png st_panel_c3.png st_panel_c4.png \
@@ -337,130 +342,130 @@
 all: $(PNGLIST)
 
 %_framed.png: $(GFXDIR)/%.png $(GFXDIR)/floor_frame.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 -composite $< $(GFXDIR)/floor_frame.png $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 -composite $< $(GFXDIR)/floor_frame.png $@
 
 st_laser_%.png: $(GFXDIR)/st-laser-%.png $(GFXDIR)/st-laser-base.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 -composite $(GFXDIR)/st-laser-base.png $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 -composite $(GFXDIR)/st-laser-base.png $< $@
 
 st_mirror_static_%.png: $(GFXDIR)/st-mirrortempl_00%.png $(GFXDIR)/st-mirror-static.png
-	convert -density 112x112 -units PixelsPerCentimeter -composite $(GFXDIR)/st-mirror-static.png $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -composite $(GFXDIR)/st-mirror-static.png $< $@
 
 st_mirror_movable_%.png: $(GFXDIR)/st-mirrortempl_00%.png $(GFXDIR)/st-mirror-movable.png
-	convert -density 112x112 -units PixelsPerCentimeter -composite $(GFXDIR)/st-mirror-movable.png $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -composite $(GFXDIR)/st-mirror-movable.png $< $@
 
 %_thief.png: $(GFXDIR)/%_bluegray.png $(GFXDIR)/thief_template.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+288 $(GFXDIR)/thief_template.png thief_template.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< thief_base.png
-	convert -density 112x112 -units PixelsPerCentimeter -composite thief_base.png thief_template.png $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+288 $(GFXDIR)/thief_template.png thief_template.png
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< thief_base.png
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -composite thief_base.png thief_template.png $@
 	rm thief_template.png thief_base.png
 
 %_thief_capture.png: $(GFXDIR)/%_bluegray.png $(GFXDIR)/thief_capture_template.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+288 $(GFXDIR)/thief_capture_template.png thief_template.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< thief_base.png
-	convert -density 112x112 -units PixelsPerCentimeter -composite thief_base.png thief_template.png $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+288 $(GFXDIR)/thief_capture_template.png thief_template.png
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< thief_base.png
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -composite thief_base.png thief_template.png $@
 	rm thief_template.png thief_base.png
 
 %_thief_drunken.png: $(GFXDIR)/%_bluegray.png $(GFXDIR)/thief_drunken_template.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $(GFXDIR)/thief_drunken_template.png thief_template.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< thief_base.png
-	convert -density 112x112 -units PixelsPerCentimeter -composite thief_base.png thief_template.png $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $(GFXDIR)/thief_drunken_template.png thief_template.png
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< thief_base.png
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -composite thief_base.png thief_template.png $@
 	rm thief_template.png thief_base.png
 
 ac_%.png: $(GFXDIR)/ac_%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 60x60+0+0 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 60x60+0+0 $< $@
 
 %_2.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+48 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+48 $< $@
 
 %_3.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+96 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+96 $< $@
 
 %_4.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+144 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+144 $< $@
 
 %_5.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+192 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+192 $< $@
 
 %_6.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+240 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+240 $< $@
 
 %_7.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+288 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+288 $< $@
 
 %_b.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+48+0 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+48+0 $< $@
 
 %_b2.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+48+48 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+48+48 $< $@
 
 %_b3.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+48+96 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+48+96 $< $@
 
 %_b4.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+48+144 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+48+144 $< $@
 
 %_c.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+96+0 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+96+0 $< $@
 
 %_c2.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+96+48 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+96+48 $< $@
 
 %_c3.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+96+96 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+96+96 $< $@
 
 %_c4.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+96+144 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+96+144 $< $@
 
 %_d.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+144+0 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+144+0 $< $@
 
 %_d2.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+144+48 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+144+48 $< $@
 
 %_d3.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+144+96 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+144+96 $< $@
 
 %_d4.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+144+144 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+144+144 $< $@
 
 %_e.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+192+0 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+192+0 $< $@
 	
 %_e2.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+192+48 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+192+48 $< $@
 
 %_f.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+240+0 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+240+0 $< $@
 	
 %_f2.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+240+48 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+240+48 $< $@
 
 %_g.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+288+0 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+288+0 $< $@
 	
 %_g2.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+288+48 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+288+48 $< $@
 
 %_h.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+336+0 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+336+0 $< $@
 	
 %_h2.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+336+48 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+336+48 $< $@
 
 %_i.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+384+0 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+384+0 $< $@
 	
 %_i2.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+384+48 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+384+48 $< $@
 
 %_j.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+432+0 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+432+0 $< $@
 	
 %_j2.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+432+48 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+432+48 $< $@
 
 %.png: $(GFXDIR)/%.png
-	convert -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< $@
+	$(CONVERT) -density 112x112 -units PixelsPerCentimeter -crop 48x48+0+0 $< $@
 
 CLEANFILES = $(PNGLIST)
 

Modified: trunk/src/stones/PuzzleStone.cc
===================================================================
--- trunk/src/stones/PuzzleStone.cc	2009-07-12 19:15:12 UTC (rev 1753)
+++ trunk/src/stones/PuzzleStone.cc	2009-07-12 20:13:48 UTC (rev 1754)
@@ -244,7 +244,7 @@
             // 3) Last chance: try to rotate the row or column
             if (has_magic_wand) {
                 rotateLine(rotate_dir);
-            } else {
+            } else if (move_dir != NODIR) {
                 // we can not move - otherwise we would have send the impulse in 2)
                 // but we need to propagate the impulse
                 sc.actor->send_impulse(get_pos(), move_dir);
@@ -397,6 +397,9 @@
     }
 
     bool PuzzleStone::moveCluster(bool waterSink, Direction dir, bool checkOnly) {
+        if (dir == NODIR) 
+            return false;
+        
         PuzzleList cluster;
         bool isComplete = findFragment(cluster, true);
 



From ral at mail.berlios.de  Sun Jul 12 22:48:56 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 12 Jul 2009 22:48:56 +0200
Subject: [Enigma-game-svn] r1755 - trunk/src
Message-ID: <200907122048.n6CKmujl024551@sheep.berlios.de>

Author: ral
Date: 2009-07-12 22:48:39 +0200 (Sun, 12 Jul 2009)
New Revision: 1755

Modified:
   trunk/src/Utf8ToXML.cc
   trunk/src/XMLtoUtf8.cc
Log:
Trunk 1.1:
- Xerces 3.0: handle syntax change of r553923 that causes problems on 64 bit

Modified: trunk/src/Utf8ToXML.cc
===================================================================
--- trunk/src/Utf8ToXML.cc	2009-07-12 20:13:48 UTC (rev 1754)
+++ trunk/src/Utf8ToXML.cc	2009-07-12 20:48:39 UTC (rev 1755)
@@ -40,11 +40,19 @@
     }
 
     void Utf8ToXML::init(const char * const toTranscode) {
+#if _XERCES_VERSION >= 30000
+        XMLSize_t srcLength = std::strlen(toTranscode) + 1;
+        // make safe assumptions on utf-16 size
+        XMLSize_t maxDestLength = srcLength;
+        XMLSize_t charsEaten;
+        XMLSize_t destLength;
+#else
         unsigned int srcLength = std::strlen(toTranscode) + 1;
         // make safe assumptions on utf-16 size
         unsigned int maxDestLength = srcLength;
         unsigned int charsEaten;
         unsigned int destLength;
+#endif
         unsigned char *charSizes = new unsigned char[maxDestLength]; // just junk
         // make a buffer - size does not matter - the object is temporary 
         xmlString = new XMLCh[maxDestLength];

Modified: trunk/src/XMLtoUtf8.cc
===================================================================
--- trunk/src/XMLtoUtf8.cc	2009-07-12 20:13:48 UTC (rev 1754)
+++ trunk/src/XMLtoUtf8.cc	2009-07-12 20:48:39 UTC (rev 1755)
@@ -27,11 +27,19 @@
 namespace enigma
 {
     XMLtoUtf8::XMLtoUtf8(const XMLCh* const toTranscode) {
+#if _XERCES_VERSION >= 30000
+        XMLSize_t srcLength = XMLString::stringLen(toTranscode) + 1;
+        // make safe assumptions on utf-8 size
+        XMLSize_t maxDestLength = 3 * srcLength;
+        XMLSize_t charsEaten;
+        XMLSize_t destLength;
+#else
         unsigned int srcLength = XMLString::stringLen(toTranscode) + 1;
         // make safe assumptions on utf-8 size
         unsigned int maxDestLength = 3 * srcLength;
         unsigned int charsEaten;
         unsigned int destLength;
+#endif
         // make a buffer - size does not matter - the object is temporary 
         utf8String = new char[maxDestLength];
         // transcode to utf-8 -- there are no unrepresentable chars



From ral at mail.berlios.de  Sun Jul 12 22:50:11 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 12 Jul 2009 22:50:11 +0200
Subject: [Enigma-game-svn] r1756 - branches/1.01/src
Message-ID: <200907122050.n6CKoBGR024749@sheep.berlios.de>

Author: ral
Date: 2009-07-12 22:50:02 +0200 (Sun, 12 Jul 2009)
New Revision: 1756

Modified:
   branches/1.01/src/Utf8ToXML.cc
   branches/1.01/src/XMLtoUtf8.cc
Log:
Branch 1.01: merge of fix from trunk
- r1755: Xerces 3.0: handle syntax change of r553923 that causes problems on 64 bit

Modified: branches/1.01/src/Utf8ToXML.cc
===================================================================
--- branches/1.01/src/Utf8ToXML.cc	2009-07-12 20:48:39 UTC (rev 1755)
+++ branches/1.01/src/Utf8ToXML.cc	2009-07-12 20:50:02 UTC (rev 1756)
@@ -40,11 +40,19 @@
     }
 
     void Utf8ToXML::init(const char * const toTranscode) {
+#if _XERCES_VERSION >= 30000
+        XMLSize_t srcLength = std::strlen(toTranscode) + 1;
+        // make safe assumptions on utf-16 size
+        XMLSize_t maxDestLength = srcLength;
+        XMLSize_t charsEaten;
+        XMLSize_t destLength;
+#else
         unsigned int srcLength = std::strlen(toTranscode) + 1;
         // make safe assumptions on utf-16 size
         unsigned int maxDestLength = srcLength;
         unsigned int charsEaten;
         unsigned int destLength;
+#endif
         unsigned char *charSizes = new unsigned char[maxDestLength]; // just junk
         // make a buffer - size does not matter - the object is temporary 
         xmlString = new XMLCh[maxDestLength];

Modified: branches/1.01/src/XMLtoUtf8.cc
===================================================================
--- branches/1.01/src/XMLtoUtf8.cc	2009-07-12 20:48:39 UTC (rev 1755)
+++ branches/1.01/src/XMLtoUtf8.cc	2009-07-12 20:50:02 UTC (rev 1756)
@@ -27,11 +27,19 @@
 namespace enigma
 {
     XMLtoUtf8::XMLtoUtf8(const XMLCh* const toTranscode) {
+#if _XERCES_VERSION >= 30000
+        XMLSize_t srcLength = XMLString::stringLen(toTranscode) + 1;
+        // make safe assumptions on utf-8 size
+        XMLSize_t maxDestLength = 3 * srcLength;
+        XMLSize_t charsEaten;
+        XMLSize_t destLength;
+#else
         unsigned int srcLength = XMLString::stringLen(toTranscode) + 1;
         // make safe assumptions on utf-8 size
         unsigned int maxDestLength = 3 * srcLength;
         unsigned int charsEaten;
         unsigned int destLength;
+#endif
         // make a buffer - size does not matter - the object is temporary 
         utf8String = new char[maxDestLength];
         // transcode to utf-8 -- there are no unrepresentable chars



From ral at mail.berlios.de  Tue Jul 14 23:01:18 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 14 Jul 2009 23:01:18 +0200
Subject: [Enigma-game-svn] r1757 - trunk/src/others
Message-ID: <200907142101.n6EL1IU3018642@sheep.berlios.de>

Author: ral
Date: 2009-07-14 23:01:17 +0200 (Tue, 14 Jul 2009)
New Revision: 1757

Modified:
   trunk/src/others/Rubberband.cc
   trunk/src/others/Rubberband.hh
Log:
Trunk 1.1:
- Rubberband: kill existing rubberband between two anchors when a new one
    is established between same anchors:
    - the user can't see two rubbers
    - danger of automatic addition of infinte rubberbands
    - danger of contradicting min, max values


Modified: trunk/src/others/Rubberband.cc
===================================================================
--- trunk/src/others/Rubberband.cc	2009-07-12 20:50:02 UTC (rev 1756)
+++ trunk/src/others/Rubberband.cc	2009-07-14 21:01:17 UTC (rev 1757)
@@ -38,9 +38,9 @@
             anchor1 = dynamic_cast<Actor *>((Object *)val);
             ASSERT(anchor1 != NULL, XLevelRuntime, "Rubberband: 'anchor1' is no actor");
             ASSERT(anchor1 != anchor2.ac, XLevelRuntime, "Rubberband: 'anchor1' is identical to 'anchor2'");
-            switchAnchor(old, anchor1, (objFlags & OBJBIT_STONE) ? (Object *)anchor2.st : (Object *)anchor2.ac);
+            switchAnchor(old, anchor1, anchor2Object());
         } else if (key == "anchor2") {
-            Object * old = (objFlags & OBJBIT_STONE) ? (Object *)anchor2.st : (Object *)anchor2.ac;
+            Object * old = anchor2Object();
             Object * obj = val;
             if (obj != NULL && obj->getObjectType() == Object::ACTOR) {
                 anchor2.ac = dynamic_cast<Actor *>((Object *)val);
@@ -75,7 +75,7 @@
         if (key == "anchor1") {
             return anchor1;
         } else if (key == "anchor2") {
-            return (objFlags & OBJBIT_STONE) ? (Object *)anchor2.st : (Object *)anchor2.ac;
+            return anchor2Object();
         } else if (key == "strength") {
             return strength;
         } else if (key == "length") {
@@ -122,8 +122,8 @@
     
     void Rubberband::preRemoval() {
         model.kill();
-        switchAnchor(anchor1, NULL, (objFlags & OBJBIT_STONE) ? (Object *)anchor2.st : (Object *)anchor2.ac);
-        switchAnchor((objFlags & OBJBIT_STONE) ? (Object *)anchor2.st : (Object *)anchor2.ac, NULL, anchor1);        
+        switchAnchor(anchor1, NULL, anchor2Object());
+        switchAnchor(anchor2Object(), NULL, anchor1);        
     }
     
     void Rubberband::tick(double dt) {
@@ -277,7 +277,11 @@
 
     }
     
-    ecl::V2 Rubberband::posAnchor2() {
+    Object * Rubberband::anchor2Object() const {
+        return (objFlags & OBJBIT_STONE) ? (Object *)anchor2.st : (Object *)anchor2.ac;
+    }
+    
+    ecl::V2 Rubberband::posAnchor2() const {
         return (objFlags & OBJBIT_STONE) ? anchor2.st->getOwnerPos().center() : anchor2.ac->get_pos();
     }
     
@@ -307,6 +311,24 @@
             olist.push_back(this);
             newAnchor->setAttr("rubbers", olist);
             if (otherAnchor != NULL) {
+                // check on existing rubberbands between anchors
+                olist = newAnchor->getAttr("fellows");
+                ObjectList::iterator it = find(olist.begin(), olist.end(), otherAnchor);
+                if (it != olist.end()) {
+                    // we do not allow two rubberbands between identical anchors!
+                    // - the user can't see it
+                    // - danger of automatic addition of infinte rubberbands, that cause the engine to stop
+                    // - danger of contradicting min, max values
+                    olist = newAnchor->getAttr("rubbers");
+                    for (it = olist.begin(); it != olist.end(); ++it) {
+                        Rubberband *oldRubber = dynamic_cast<Rubberband *>(*it);
+                        if (otherAnchor == oldRubber->anchor1 || otherAnchor == oldRubber->anchor2Object()) {
+                            KillOther(oldRubber);
+                            break;
+                        }
+                    }
+                }
+                
                 // add both anchors to each others fellows list
                 olist = newAnchor->getAttr("fellows");
                 olist.push_back(otherAnchor);

Modified: trunk/src/others/Rubberband.hh
===================================================================
--- trunk/src/others/Rubberband.hh	2009-07-12 20:50:02 UTC (rev 1756)
+++ trunk/src/others/Rubberband.hh	2009-07-14 21:01:17 UTC (rev 1757)
@@ -67,7 +67,8 @@
         double maxLength;
         display::RubberHandle model;
         
-        ecl::V2 posAnchor2();
+        Object * anchor2Object() const;
+        ecl::V2 posAnchor2() const;
         void switchAnchor(Object *oldAnchor, Object *newAnchor, Object *otherAnchor);
     };
 



From ral at mail.berlios.de  Thu Jul 16 00:27:04 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 16 Jul 2009 00:27:04 +0200
Subject: [Enigma-game-svn] r1758 - in trunk/src: lev others
Message-ID: <200907152227.n6FMR47v030148@sheep.berlios.de>

Author: ral
Date: 2009-07-16 00:27:03 +0200 (Thu, 16 Jul 2009)
New Revision: 1758

Modified:
   trunk/src/lev/VolatileIndex.cc
   trunk/src/others/Rubberband.cc
   trunk/src/others/Rubberband.hh
Log:
Trunk 1.1:
- fix invalid level release number "0" assigned to unreadable command line
    levels, that causes trouble in history and on composer created indices.


Modified: trunk/src/lev/VolatileIndex.cc
===================================================================
--- trunk/src/lev/VolatileIndex.cc	2009-07-14 21:01:17 UTC (rev 1757)
+++ trunk/src/lev/VolatileIndex.cc	2009-07-15 22:27:03 UTC (rev 1758)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2006 Ronald Lamprecht
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -33,7 +33,7 @@
             levelCount++;
             Proxy * aProxy = Proxy::registerLevel(levelpaths[i], "#commandline",
                     ecl::strf("_%d",levelCount), ecl::strf("Level %d", i), "unknown",
-                    1, 0, false, GAMET_UNKNOWN, STATUS_UNKNOWN); 
+                    1, 1, false, GAMET_UNKNOWN, STATUS_UNKNOWN); 
             proxies.push_back(aProxy);
             try {
                 aProxy->loadMetadata(true);

Modified: trunk/src/others/Rubberband.cc
===================================================================
--- trunk/src/others/Rubberband.cc	2009-07-14 21:01:17 UTC (rev 1757)
+++ trunk/src/others/Rubberband.cc	2009-07-15 22:27:03 UTC (rev 1758)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License

Modified: trunk/src/others/Rubberband.hh
===================================================================
--- trunk/src/others/Rubberband.hh	2009-07-14 21:01:17 UTC (rev 1757)
+++ trunk/src/others/Rubberband.hh	2009-07-15 22:27:03 UTC (rev 1758)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License



From ral at mail.berlios.de  Fri Jul 17 23:32:54 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 17 Jul 2009 23:32:54 +0200
Subject: [Enigma-game-svn] r1759 - in trunk: data src src/actors src/gui
	src/lev
Message-ID: <200907172132.n6HLWsrm000300@sheep.berlios.de>

Author: ral
Date: 2009-07-17 23:32:53 +0200 (Fri, 17 Jul 2009)
New Revision: 1759

Modified:
   trunk/data/sound-defaults.lua
   trunk/src/actors/Balls.cc
   trunk/src/game.cc
   trunk/src/gui/LevelInspector.cc
   trunk/src/lev/Proxy.cc
   trunk/src/lev/Proxy.hh
   trunk/src/lev/VolatileIndex.cc
Log:
Trunk 1.1:
- fix quickfix r1758: do block unreadable command line levels like in auto 
    folder with an error message.
- fix pearl shatter sound assignment
- add usage comments to sound-defaults table
- measure level load time, show it in level inspector + F2


Modified: trunk/data/sound-defaults.lua
===================================================================
--- trunk/data/sound-defaults.lua	2009-07-15 22:27:03 UTC (rev 1758)
+++ trunk/data/sound-defaults.lua	2009-07-17 21:32:53 UTC (rev 1759)
@@ -109,40 +109,40 @@
 
 soundtable_enigma = {
     [""]           = "",        -- empty sound
-    ballcollision  = "enigma/ballcollision",
+    ballcollision  = "enigma/ballcollision",  -- world
     blockerdown    = "",
     blockerup      = "",
-    bomb_black      = "enigma/explosion1",
-    bomb_white      = "enigma/explosion1",
+    bomb_black      = "enigma/explosion1", -- it_bomb
+    bomb_white      = "enigma/explosion1", -- it_bomb
     bottle         = "",
-    bumper         = "enigma/bumper",
+    bumper         = "enigma/bumper",     -- st_actorimpulse
     cloth          = { file="enigma/st-thud", damp_max = 4.0 },
     coinslotoff    = "",
     coinsloton     = "enigma/st-coinslot",
-    crack          = "",
-    doorclose      = "enigma/doorclose",  -- missing
-    dooropen       = "enigma/dooropen",   -- missing
-    drown          = "enigma/drown",
-    dynamite       = "enigma/explosion2", -- replace?
+    crack          = "",                  -- st_window ring scratch, it_crack enlarge
+    doorclose      = "enigma/doorclose",  -- missing, st_door_d
+    dooropen       = "enigma/dooropen",   -- missing, st_door_d
+    drown          = "enigma/drown",      -- st_plop, st_flat falling
+    dynamite       = "enigma/explosion2", -- replace?, it_dyanmite, it_puller explosion
     electric       = "enigma/st-stone",   -- replace
     exit           = { file="enigma/exit", global=true },  -- missing
     extinguish     = "",
-    fakeoxyd       = { file="enigma/st-fakeoxyd", volume=0.3 },
+    fakeoxyd       = { file="enigma/st-fakeoxyd", volume=0.3 }, -- st_fake
     falldown       = "enigma/falldown",   -- missing, unused (falling is shatter!)
-    finished       = { file="enigma/finished", global=true },  -- missing
-    floordestroy   = "",
-    fourswitch     = "enigma/st-switch", 
+    finished       = { file="enigma/finished", global=true },  -- missing, client on finish
+    floordestroy   = "",                  -- it_crack dissolve floor
+    fourswitch     = "enigma/st-switch",  -- st_fourswitch turn
     glass          = "enigma/st-metal",   -- replace
-    hitfloor       = "enigma/stone",      -- missing, used by it-vortex
-    impulse        = "",
+    hitfloor       = "enigma/stone",      -- missing, it-vortex ball swallowed
+    impulse        = "",                  -- st_stoneimpulse
     intro          = { file="enigma/intro", global=true },  -- missing
     invrotate      = { file="enigma/invrotate", global=true },
-    itemtransform  = "enigma/st-magic",
-    jump           = "enigma/boink",
+    itemtransform  = "enigma/st-magic",   -- it_coin, it_extralife, it_hammer, it_banana, it_sword, it_umbrella laser transform
+    jump           = "enigma/boink",       -- balls jumping
     jumppad        = "",
-    landmine       = "enigma/explosion2",  -- replace?
+    landmine       = "enigma/explosion2",  -- replace?, it_landmine
     laserloop      = "",
-    laseron        = { file="enigma/st-laser", damp_max = 20.0, damp_inc = 2.0 },
+    laseron        = { file="enigma/st-laser", damp_max = 20.0, damp_inc = 2.0 }, -- it_laser
     laseroff       = "",
     lock           = "",
     magneton       = "",
@@ -154,41 +154,41 @@
     menustop        = { file="enigma/menustop", global=true },
     menuswitch      = { file="enigma/menuswitch", global=true },
     metal          = "enigma/st-metal",
-    mirrorturn     = "enigma/st-mirrorturn",
+    mirrorturn     = "enigma/st-mirrorturn", -- st_mirror
     movebig        = "enigma/st-move",
     moveslow       = "enigma/st-move",
     movesmall      = { file="enigma/st-move", damp_max = 10.0, damp_inc = 2.0 },
     oxydclose      = "enigma/st-oxydclose",  -- missing, not neccessary I think
     oxydopen       = { file="enigma/st-oxydopen", damp_max = 200.0, damp_inc = 5.0 },
     oxydopened     = "enigma/st-oxydopened",
-    pickup         = { file="enigma/pickup", global=true },
-    puller         = "",
+    pickup         = { file="enigma/pickup", global=true }, -- it_bag pickup
+    puller         = "",                 -- it_puller rotating
     puzzlerotate   = "enigma/st-move",
-    quake          = "enigma/quake",
-    rubberband     = "enigma/boing",
-    scissors       = "",
-    seedgrow       = "enigma/seedgrow",  -- missing
-    shatter        = "enigma/shatter",
-    shattersmall   = "enigma/shatter",   -- replace, "shattersmall" is missing
+    quake          = "enigma/quake",     -- st_quake, st_oxyd fart
+    rubberband     = "enigma/boing",     -- st7it_rubberband connect 
+    scissors       = "",                 -- st_scissors snip
+    seedgrow       = "enigma/seedgrow",  -- missing, it_seed
+    shatter        = "enigma/shatter",   -- st_window, it_bottle, it_glasses breaking
+    shattersmall   = "enigma/shatter",   -- replace, "shattersmall" is missing, st_pearl shatter
     shogunoff      = "",
     shogunon       = "",
-    shuffle        = "enigma/switch",
+    shuffle        = "enigma/switch",    -- st_oxyd
     skull          = "",
-    spade          = "",
+    spade          = "",                 -- it_spade
     squish         = "",
     stone          = "enigma/st-stone",
-    stonedestroy   = "enigma/explosion0",
-    stonepaint     = "enigma/st-magic",
-    stonetransform = "enigma/st-magic",
-    swamp          = "enigma/swamped",
-    switchmarbles  = "enigma/warp",      -- missing
+    stonedestroy   = "enigma/explosion0",  -- stone breaking
+    stonepaint     = "enigma/st-magic",  -- st_magic brick, st_ghost paint, st_flat pencil, st_chess recolor
+    stonetransform = "enigma/st-magic",  -- st_surprise, st_magic oxyd*
+    swamp          = "enigma/swamped",   -- balls sinking
+    switchmarbles  = "enigma/warp",      -- missing, it_ring
     switchoff      = "",
     switchon       = "enigma/st-switch",
-    switchplayer   = "enigma/switch",
+    switchplayer   = "enigma/switch",    -- st/it_yinyang
     sword          = "",
-    thief          = "enigma/thief",     -- missing
-    triggerdown    = "enigma/it-triggerdown",
-    triggerup      = "enigma/it-triggerup",
+    thief          = "enigma/thief",     -- missing, st/fl_thief stealing
+    triggerdown    = "enigma/it-triggerdown", -- it_trigger
+    triggerup      = "enigma/it-triggerup",   -- it_trigger
     turnstileleft  = "enigma/turnstileleft",  -- missing
     turnstileright = "enigma/turnstileright", -- missing
     umbrellaoff    = "",
@@ -199,7 +199,7 @@
     vortexopen     = "enigma/dooropen",  -- missing
     warp           = "enigma/warp",      -- missing, maybe suck2?
     wood           = "enigma/wood",
-    yinyang        = "enigma/st-magic",
+    yinyang        = "enigma/st-magic",  -- st_blur transformation,
 }
 
 soundtable_silent = {

Modified: trunk/src/actors/Balls.cc
===================================================================
--- trunk/src/actors/Balls.cc	2009-07-15 22:27:03 UTC (rev 1758)
+++ trunk/src/actors/Balls.cc	2009-07-17 21:32:53 UTC (rev 1759)
@@ -258,7 +258,7 @@
                 break;
             case FALLING:
                 set_model(kind+"-fallen"); // invisible
-                if (get_id (this) == ac_marble_white)
+                if (get_id (this) == ac_pearl_white)
                     sound_event("shattersmall");
                 else
                     sound_event("shatter");

Modified: trunk/src/game.cc
===================================================================
--- trunk/src/game.cc	2009-07-15 22:27:03 UTC (rev 1758)
+++ trunk/src/game.cc	2009-07-17 21:32:53 UTC (rev 1759)
@@ -72,7 +72,12 @@
     video::HideMouse();
     sdl::TempInputGrab grab(enigma::Nograb ? SDL_GRAB_OFF : SDL_GRAB_ON);
 
+//    Uint32 start_tick_time = SDL_GetTicks();
+
     server::Msg_LoadLevel(ind->getCurrent(), false);
+    
+//    double dtimelog = (SDL_GetTicks() - start_tick_time)/1000.0;
+//    Log << "StartGame  time " << dtimelog << "\n";
 
     double dtime = 0;
     last_tick_time=SDL_GetTicks();

Modified: trunk/src/gui/LevelInspector.cc
===================================================================
--- trunk/src/gui/LevelInspector.cc	2009-07-15 22:27:03 UTC (rev 1758)
+++ trunk/src/gui/LevelInspector.cc	2009-07-17 21:32:53 UTC (rev 1759)
@@ -492,6 +492,8 @@
         if (idLines >= 1) {
             add(new Label(N_("Id: "), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
             add(new Label(levelProxy->getId(), HALIGN_LEFT),Rect(hmargin+110+10, vnext, textwidth, 25));
+            add(new Label(N_("Load time: "), HALIGN_LEFT),Rect(hmargin+110+10+200+10, vnext, 110, 25));
+            add(new Label(ecl::strf("%g", levelProxy->getLoadtime()), HALIGN_LEFT),Rect(hmargin+110+10+200+10+90+10, vnext, 110, 25));
             vnext += (25 + vspacing)*idLines;
         }
         if (compatibilityLines >= 1) {

Modified: trunk/src/lev/Proxy.cc
===================================================================
--- trunk/src/lev/Proxy.cc	2009-07-15 22:27:03 UTC (rev 1758)
+++ trunk/src/lev/Proxy.cc	2009-07-17 21:32:53 UTC (rev 1759)
@@ -32,7 +32,9 @@
 #include "Utf8ToXML.hh"
 #include "XMLtoUtf8.hh"
 #include "lev/Index.hh"
+#include "ecl_sdl.hh"
 
+
 #include <cassert>
 #include <fstream>
 #include <iostream>
@@ -334,7 +336,7 @@
             scoreVersion(levelScoreVersion), releaseVersion(levelRelease),
             revisionNumber(levelRevision), hasEasyModeFlag(levelHasEasymode), 
             engineCompatibility(levelCompatibilty), levelStatus (status), 
-            scoreUnit (duration), doc(NULL) {
+            scoreUnit (duration), doc(NULL), loadtime (0) {
     }
         
     Proxy::~Proxy() {
@@ -485,6 +487,7 @@
             return;
         }
 
+        Uint32 start_tick_time = SDL_GetTicks();   // meassure time for level loading
         bool useFileLoader = false;
         bool isXML = true;
         std::auto_ptr<std::istream> isptr;
@@ -683,6 +686,7 @@
                 }
             }
         }
+        loadtime = (SDL_GetTicks() - start_tick_time)/1000.0;
     }
     
     void Proxy::loadDoc() {
@@ -1283,5 +1287,9 @@
                 return atoi(text.substr(0,colon).c_str()) * 60 +
                         atoi(text.substr(colon+1).c_str());
         }
-    }    
+    }
+    
+    double Proxy::getLoadtime() {
+        return loadtime;
+    }
 }} // namespace enigma::lev

Modified: trunk/src/lev/Proxy.hh
===================================================================
--- trunk/src/lev/Proxy.hh	2009-07-15 22:27:03 UTC (rev 1758)
+++ trunk/src/lev/Proxy.hh	2009-07-17 21:32:53 UTC (rev 1759)
@@ -145,6 +145,7 @@
         Proxy::pathType getNormPathType();
         virtual std::string getAbsLevelPath();
         void loadDependency(std::string depId);
+        double getLoadtime();
     
     protected:
         std::string title;
@@ -189,6 +190,7 @@
         XERCES_CPP_NAMESPACE_QUALIFIER DOMDocument *doc;
         XERCES_CPP_NAMESPACE_QUALIFIER DOMElement *infoElem;
         XERCES_CPP_NAMESPACE_QUALIFIER DOMNodeList *stringList;
+        double loadtime;
         
         void load(bool onlyMetadata, bool expectLevel);
         void loadDoc();

Modified: trunk/src/lev/VolatileIndex.cc
===================================================================
--- trunk/src/lev/VolatileIndex.cc	2009-07-15 22:27:03 UTC (rev 1758)
+++ trunk/src/lev/VolatileIndex.cc	2009-07-17 21:32:53 UTC (rev 1759)
@@ -18,10 +18,11 @@
 
 #include "lev/VolatileIndex.hh"
 #include "errors.hh"
+#include "gui/ErrorMenu.hh"
 #include "main.hh"
+#include "nls.hh"
 
 
-
 namespace enigma { namespace lev {
 
     int VolatileIndex::levelCount = 0;
@@ -30,16 +31,22 @@
             const std::vector<string> levelpaths, double defaultLocation) : 
             Index(anIndexName, aGroupName, defaultLocation) {
         for (unsigned i=0; i<levelpaths.size(); i++) {
-            levelCount++;
             Proxy * aProxy = Proxy::registerLevel(levelpaths[i], "#commandline",
                     ecl::strf("_%d",levelCount), ecl::strf("Level %d", i), "unknown",
-                    1, 1, false, GAMET_UNKNOWN, STATUS_UNKNOWN); 
-            proxies.push_back(aProxy);
+                    1, 0, false, GAMET_UNKNOWN, STATUS_UNKNOWN); 
             try {
                 aProxy->loadMetadata(true);
+                levelCount++;
+                proxies.push_back(aProxy);
             }
             catch (XLevelLoading &err) {
                 Log << "Level load error on '" << levelpaths[i] << "\n";
+                std::string message = _("Error on auto registration of levelfile: ");
+                message += levelpaths[i] + "\n\n";
+                message += _("Note: the level will not show up in the \"Startup Folder\" levelpack!\n\n");
+                message += err.what();
+                gui::ErrorMenu m(message, N_("Continue"));
+                m.manage();
             }
         }
     }



From raoul at mail.berlios.de  Sun Jul 19 15:32:02 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sun, 19 Jul 2009 15:32:02 +0200
Subject: [Enigma-game-svn] r1760 - in trunk/data/levels: enigma_cross
	enigma_i enigma_ii enigma_iii enigma_iv enigma_ix
	enigma_tutorial enigma_vi enigma_viii
Message-ID: <200907191332.n6JDW2Qu032470@sheep.berlios.de>

Author: raoul
Date: 2009-07-19 15:31:58 +0200 (Sun, 19 Jul 2009)
New Revision: 1760

Added:
   trunk/data/levels/enigma_i/martin04_2.xml
   trunk/data/levels/enigma_i/richi03_2.xml
   trunk/data/levels/enigma_ii/edward10_2.xml
   trunk/data/levels/enigma_iii/duffy57_2.xml
   trunk/data/levels/enigma_iv/duffy01_2.xml
   trunk/data/levels/enigma_iv/raywick01_3.xml
   trunk/data/levels/enigma_iv/wb11_2.xml
   trunk/data/levels/enigma_iv/wb12_2.xml
   trunk/data/levels/enigma_ix/andreas57_1.xml
   trunk/data/levels/enigma_ix/andreas58_1.xml
   trunk/data/levels/enigma_ix/mecke36_1.xml
   trunk/data/levels/enigma_ix/pulley14_1.xml
   trunk/data/levels/enigma_ix/ral49_1.xml
   trunk/data/levels/enigma_vi/andreas28_3.xml
Removed:
   trunk/data/levels/enigma_i/martin04_1.xml
   trunk/data/levels/enigma_i/richi03_1.xml
   trunk/data/levels/enigma_ii/edward10_1.xml
   trunk/data/levels/enigma_iii/duffy57_1.xml
   trunk/data/levels/enigma_iv/duffy01_1.xml
   trunk/data/levels/enigma_iv/raywick01_2.xml
   trunk/data/levels/enigma_iv/wb11_1.xml
   trunk/data/levels/enigma_iv/wb12_1.xml
   trunk/data/levels/enigma_vi/andreas28_2.xml
Modified:
   trunk/data/levels/enigma_cross/enigma0_92_1.xml
   trunk/data/levels/enigma_cross/enigma0_92_2.xml
   trunk/data/levels/enigma_cross/newlevels.xml
   trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
   trunk/data/levels/enigma_i/index.xml
   trunk/data/levels/enigma_i/ralf03_2.xml
   trunk/data/levels/enigma_ii/index.xml
   trunk/data/levels/enigma_iii/illmind11_2.xml
   trunk/data/levels/enigma_iii/index.xml
   trunk/data/levels/enigma_iv/index.xml
   trunk/data/levels/enigma_ix/index.xml
   trunk/data/levels/enigma_tutorial/index.xml
   trunk/data/levels/enigma_vi/index.xml
   trunk/data/levels/enigma_viii/ais06_1.xml
   trunk/data/levels/enigma_viii/andreas47_1.xml
   trunk/data/levels/enigma_viii/ral32_1.xml
   trunk/data/levels/enigma_viii/ral33_1.xml
Log:
-> New levels (pulley14, ...)
-> A few rewritings
-> Bugfixes (andreas28, ...)


Modified: trunk/data/levels/enigma_cross/enigma0_92_1.xml
===================================================================
--- trunk/data/levels/enigma_cross/enigma0_92_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_cross/enigma0_92_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Facets" location="15100" network="false" owner="Enigma Team" release="1" revision="34" title="Enigma 0.92 - 1"/>
+  <info enigma="1.00" group="Facets" location="15100" network="false" owner="Enigma Team" release="1" revision="35" title="Enigma 0.92 - 1"/>
 
   <attributes/>
 
@@ -10,7 +10,7 @@
     <level _seq="2" _title="Is It Easy?" _xpath="enigma_i/martin06_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin06" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="3" _title="Pharaoh's Tomb" _xpath="enigma_ii/siegfried13_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level4d" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="4" _title="Feel Your Way" _xpath="enigma_i/siegfried06_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level3a" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="5" _title="Sokoban Revival" _xpath="enigma_i/martin04_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin04" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="5" _title="Sokoban Revival" _xpath="enigma_i/martin04_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin04" rel="2" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="6" _title="Black Is Beautiful" _xpath="enigma_iii/martin15_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin15" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="7" _title="Round Trip" _xpath="enigma_ii/martin35_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin35" rel="2" rev="2" score="2" target="time" unit="duration"/>
     <level _seq="8" _title="Light Switches" _xpath="enigma_i/martin08_2" author="Martin Hawlisch" ctrl="force" easy="true" id="martin08" rel="2" rev="2" score="2" target="time" unit="duration"/>
@@ -106,7 +106,7 @@
     <level _seq="98" _title="Gopher It" _xpath="enigma_ii/nat34_2" author="Nat Pryce" ctrl="force" easy="false" id="natmaze3" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="99" _title="- Meditation -" _xpath="enigma_i/ant24_2" author="Petr Machata" ctrl="force" easy="false" id="ant24" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="100" _title="Spiders" _xpath="enigma_v/ant26_1" author="Petr Machata" ctrl="force" easy="false" id="ant26" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="101" _title="Meditation Puzzle" _xpath="enigma_iv/duffy01_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy1" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="101" _title="Meditation Puzzle" _xpath="enigma_iv/duffy01_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy1" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="102" _title="Come To Me" _xpath="enigma_ii/ant20_2" author="Petr Machata" ctrl="force" easy="false" id="ant20" rel="2" rev="2" score="2" target="time" unit="duration"/>
     <level _seq="103" _title="Corridors" _xpath="enigma_ii/siegfried29_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level9f" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="104" _title="Dustwalkers" _xpath="enigma_ii/ant06_1" author="Petr Machata" ctrl="force" easy="false" id="ant06" rel="1" rev="0" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/enigma0_92_2.xml
===================================================================
--- trunk/data/levels/enigma_cross/enigma0_92_2.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_cross/enigma0_92_2.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Facets" location="15200" network="false" owner="Enigma Team" release="1" revision="39" title="Enigma 0.92 - 2"/>
+  <info enigma="1.00" group="Facets" location="15200" network="false" owner="Enigma Team" release="1" revision="40" title="Enigma 0.92 - 2"/>
 
   <attributes/>
 
@@ -70,7 +70,7 @@
     <level _seq="62" _title="TNT Shortage?" _xpath="enigma_iv/siegfried74_1" author="Siegfried Fennig" ctrl="force" easy="false" id="siegfried74" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="63" _title="Tunnels" _xpath="enigma_iv/martin82_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin82" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="64" _title="Growing The Doors" _xpath="enigma_i/martin88_3" author="Martin Hawlisch" ctrl="force" easy="false" id="martin88" rel="3" rev="3" score="2" target="time" unit="duration"/>
-    <level _seq="65" _title="Doors Galore" _xpath="enigma_iv/raywick01_2" author="Ray Wick" ctrl="force" easy="true" id="RayWick001" rel="2" rev="1" score="2" target="time" unit="duration"/>
+    <level _seq="65" _title="Doors Galore" _xpath="enigma_iv/raywick01_3" author="Ray Wick" ctrl="force" easy="true" id="RayWick001" rel="3" rev="3" score="3" target="time" unit="duration"/>
     <level _seq="66" _title="Time is Money" _xpath="enigma_i/nat11_2" author="Nat Pryce" ctrl="force" easy="false" id="nat11" rel="2" rev="0" score="2" target="time" unit="duration"/>
     <level _seq="67" _title="What's the Problem?" _xpath="enigma_iv/ss14_1" author="Sven Siggelkow" ctrl="force" easy="true" id="ss14" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="68" _title="Family Business" _xpath="enigma_iii/duffy20_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy20" rel="2" rev="1" score="2" target="time" unit="duration"/>
@@ -137,7 +137,7 @@
     <level _seq="129" _title="Keepaway" _xpath="enigma_iii/duffy54_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy54" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="130" _title="Build Up Speed" _xpath="enigma_iii/duffy55_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy55" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="131" _title="Crossfire" _xpath="enigma_v/duffy56_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy56" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="132" _title="Fool the Watchdog" _xpath="enigma_iii/duffy57_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy57" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="132" _title="Fool the Watchdog" _xpath="enigma_iii/duffy57_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy57" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="133" _title="Upstream Journey" _xpath="enigma_iii/duffy58_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy58" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="134" _title="Space Meditation" _xpath="enigma_ii/duffy59_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy59" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="135" _title="Automatic Transmission" _xpath="enigma_iii/duffy60_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy60" rel="2" rev="2" score="1" target="time" unit="duration"/>
@@ -165,10 +165,10 @@
     <level _seq="157" _title="Easy Skyscraper" _xpath="enigma_iii/wb07_1" author="Jon 'WB' Sneyers" ctrl="force" easy="true" id="wb7" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="158" _title="Spiral Race" _xpath="enigma_i/wb06_2" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb6" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="159" _title="Block its way!" _xpath="enigma_iii/wb05_2" author="Jon 'WB' Sneyers" ctrl="force" easy="true" id="wb5" rel="2" rev="1" score="2" target="time" unit="duration"/>
-    <level _seq="160" _title="Little Puzzles" _xpath="enigma_iv/wb11_1" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb11" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="160" _title="Little Puzzles" _xpath="enigma_iv/wb11_2" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb11" rel="2" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="161" _title="- Meditation -" _xpath="enigma_ii/wb10_2" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb10" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="162" _title="Tough Skyscraper" _xpath="enigma_iii/wb08_1" author="Jon 'WB' Sneyers" ctrl="force" easy="true" id="wb8" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="163" _title="Big Adventures" _xpath="enigma_iv/wb12_1" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb12" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="163" _title="Big Adventures" _xpath="enigma_iv/wb12_2" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb12" rel="2" rev="0" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Modified: trunk/data/levels/enigma_cross/newlevels.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_cross/newlevels.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Facets" location="15400" network="false" owner="Enigma Team" release="1" revision="48" title="Enigma 1.00 new"/>
+  <info enigma="1.00" group="Facets" location="15400" network="false" owner="Enigma Team" release="1" revision="49" title="Enigma 1.00 new"/>
 
   <attributes/>
 
@@ -18,7 +18,7 @@
     <level _seq="10" _title="Encased" _xpath="enigma_i/xerxes01_1" author="Xerxes M. Dynatos" ctrl="force" easy="false" id="xerxes01" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="11" _title="Without Tremor" _xpath="enigma_i/richi04_2" author="Richi B?tzer" ctrl="force" easy="false" id="richi04" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="12" _title="- Meditation -" _xpath="enigma_i/alain04_1" author="Alain Busser" ctrl="force" easy="false" id="alain04" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="13" _title="Light Barrier" _xpath="enigma_i/richi03_1" author="Richi B?tzer" ctrl="force" easy="false" id="richi03" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="13" _title="Light Barrier" _xpath="enigma_i/richi03_2" author="Richi B?tzer" ctrl="force" easy="false" id="richi03" rel="2" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="14" _title="Dead Ball Walking" _xpath="enigma_i/illmind08_2" author="illmind" ctrl="force" easy="false" id="illmind08" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="15" _title="The Enigmhanoi Towers" _xpath="enigma_i/alain05_2" author="Alain Busser" ctrl="force" easy="true" id="alain05" rel="2" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="16" _title="Mirror Room" _xpath="enigma_i/luc12_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc12" rel="2" rev="1" score="1" target="time" unit="duration"/>
@@ -45,7 +45,7 @@
     <level _seq="37" _title="Laser Paradise" _xpath="enigma_ii/illmind05_1" author="illmind" ctrl="force" easy="false" id="illmind05" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="38" _title="Spaceleast" _xpath="enigma_ii/andreas15_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas15" rel="2" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="39" _title="The Fuse" _xpath="enigma_ii/capkoh02_1" author="capkoh" ctrl="force" easy="false" id="capkoh02" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="40" _title="- Meditation -" _xpath="enigma_ii/edward10_1" author="Edward" ctrl="force" easy="false" id="edward10" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="40" _title="- Meditation -" _xpath="enigma_ii/edward10_2" author="Edward" ctrl="force" easy="false" id="edward10" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="41" _title="Knight Moves" _xpath="enigma_ii/illmind04_1" author="illmind" ctrl="force" easy="false" id="illmind04" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="42" _title="Buridan" _xpath="enigma_ii/alain01_1" author="Alain Busser" ctrl="force" easy="false" id="alain01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="43" _title="Moure-Switches" _xpath="enigma_ii/andreas10_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas10" rel="2" rev="5" score="1" target="time" unit="duration"/>
@@ -165,7 +165,7 @@
     <level _seq="157" _title="Laserpowered" _xpath="enigma_vi/raoul20_2" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul20" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="158" _title="Oxydmoron" _xpath="enigma_vi/raoul14_2" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul14" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="159" _title="Bomb raider" _xpath="enigma_vi/alain27_1" author="Alain Busser" ctrl="force" easy="true" id="alain27" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="160" _title="Dancing on Light Beams" _xpath="enigma_vi/andreas28_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas28" rel="2" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="160" _title="Dancing on Light Beams" _xpath="enigma_vi/andreas28_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas28" rel="3" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="161" _title="- Meditation -" _xpath="enigma_vi/alain25_2" author="Alain Busser + Raoul Bourquin" ctrl="force" easy="true" id="alain25" rel="2" rev="2" score="2" target="time" unit="duration"/>
     <level _seq="162" _title="Checkmate I" _xpath="enigma_vi/andreas29_2" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas29" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="163" _title="The Stable" _xpath="enigma_vi/andreas30_3" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas30" rel="3" rev="3" score="2" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="56" title="Enigma 1.1 new"/>
+  <info enigma="1.00" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="57" title="Enigma 1.1 new"/>
 
   <attributes/>
 
@@ -178,6 +178,11 @@
     <level _seq="170" _title="Crabwise I" _xpath="enigma_viii/devnull34_2" author="/dev/null" ctrl="force" easy="true" id="devnull34" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="171" _title="Crabwise II" _xpath="enigma_viii/devnull35_2" author="/dev/null" ctrl="force" easy="true" id="devnull35" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="172" _title="Su Dyxo" _xpath="enigma_ix/ais33_1" author="Alex Smith" ctrl="force" easy="true" id="20090525ais523001" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="173" _title="Camel and Needle" _xpath="enigma_ix/andreas57_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas57" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="174" _title="Water Galore" _xpath="enigma_ix/ral49_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20090620ral141" rel="1" rev="178" score="1" target="time" unit="duration"/>
+    <level _seq="175" _title="pinnacles1" _xpath="enigma_ix/mecke36_1" author="mecke" ctrl="force" easy="true" id="mecke36" rel="1" rev="15" score="1" target="time" unit="duration"/>
+    <level _seq="176" _title="Symopal" _xpath="enigma_ix/andreas58_1" author="Andreas Lochmann, Ronald Lamprecht" ctrl="force" easy="true" id="andreas58" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="177" _title="The Pilgrim's Progress" _xpath="enigma_ix/pulley14_1" author="Mark Pulley" ctrl="force" easy="false" id="20080101pulley001" rel="2" rev="1" score="2" target="time" unit="duration"/>
   </levels>
 
 </index>

Modified: trunk/data/levels/enigma_i/index.xml
===================================================================
--- trunk/data/levels/enigma_i/index.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_i/index.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10200" network="false" owner="Enigma Team" release="1" revision="25" title="Enigma I"/>
+  <info enigma="1.00" group="Enigma" location="10200" network="false" owner="Enigma Team" release="1" revision="26" title="Enigma I"/>
 
   <attributes/>
 
@@ -46,9 +46,9 @@
     <level _seq="38" _title="Encased" _xpath="./xerxes01_1" author="Xerxes M. Dynatos" ctrl="force" easy="false" id="xerxes01" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="39" _title="Without Tremor" _xpath="./richi04_2" author="Richi B?tzer" ctrl="force" easy="false" id="richi04" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="40" _title="- Meditation -" _xpath="./alain04_1" author="Alain Busser" ctrl="force" easy="false" id="alain04" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="41" _title="Light Barrier" _xpath="./richi03_1" author="Richi B?tzer" ctrl="force" easy="false" id="richi03" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="41" _title="Light Barrier" _xpath="./richi03_2" author="Richi B?tzer" ctrl="force" easy="false" id="richi03" rel="2" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="42" _title="Basement" _xpath="./siegfried26_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level9c" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="43" _title="Sokoban Revival" _xpath="./martin04_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin04" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="43" _title="Sokoban Revival" _xpath="./martin04_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin04" rel="2" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="44" _title="Dead Ball Walking" _xpath="./illmind08_2" author="illmind" ctrl="force" easy="false" id="illmind08" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="45" _title="Duck and Cover" _xpath="./nat02_2" author="Nat Pryce" ctrl="force" easy="true" id="nat2" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="46" _title="Oxyd Maze" _xpath="./duffy79_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy79" rel="1" rev="1" score="1" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_i/martin04_1.xml
===================================================================
--- trunk/data/levels/enigma_i/martin04_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_i/martin04_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,86 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Sokoban Revival" el:subtitle="" el:id="martin04"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
-      <el:author  el:name="Martin Hawlisch" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Martin Hawlisch</el:copyright>
-      <el:license el:type="GPL version 2" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-levelw = 20
-levelh = 13
-
-create_world( levelw, levelh)
-oxyd_default_flavor="a"
-fill_floor("fl-acblack", 0,0,levelw,levelh)
-
-function renderLine( line, pattern)
-    for i=1, strlen(pattern) do
-        local c = strsub( pattern, i, i)
-        if c =="#" then
-            set_stone( "st-stone1", i-1, line)
-        elseif c == "o" then
-            oxyd( i-1, line)
-        elseif c == "m" then
-            set_stone( "st-wood-growing", i-1, line)
-        end
-    end
-end
-
--- Floor:   " "
--- Border:  "#"
--- Oxyd:    "o"
--- Movable: "m"
-
-renderLine(  0, "####################")
-renderLine(  1, "#   =   #o##########")
-renderLine(  2, "# ###m  #          #")
-renderLine(  3, "# ###  m##########|#")
-renderLine(  4, "#o#  m m ##      = #")
-renderLine(  5, "### # ## #o ###### #")
-renderLine(  6, "#   # ## ####  ss# #")
-renderLine(  7, "# m  m         ss# #")
-renderLine(  8, "##### ### # #  ss# #")
-renderLine(  9, "#  o#     #|###### #")
-renderLine( 10, "#|########>        #")
-renderLine( 11, "#           <#######")
-renderLine( 12, "####################")
-
-set_stone("st-door", 4, 1 , {name="door1", type="v"})
-set_item("it-trigger", 15,6, {action="openclose", target="door1"})
-
-set_stone("st-door", 17, 4 , {name="door2", type="v"})
-set_item("it-trigger", 16,6, {action="openclose", target="door2"})
-
-set_attrib(laser(12,11, TRUE, WEST), "name", "laser1")
-set_item("it-trigger", 15,7, {action="onoff", target="laser1"})
-
-set_stone("st-door", 18, 3 , {name="door4", type="h"})
-set_item("it-trigger", 16,7, {action="openclose", target="door4"})
-
-set_attrib(laser(10,10, TRUE, EAST), "name", "laser2")
-set_item("it-trigger", 15,8, {action="onoff", target="laser2"})
-
-set_stone("st-door", 1, 10 , {name="door6", type="h"})
-set_item("it-trigger", 16,8, {action="openclose", target="door6"})
-
-oxyd_shuffle()
-
-set_actor("ac-blackball", 11.5, 8.5)
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_i/martin04_2.xml (from rev 1759, trunk/data/levels/enigma_i/martin04_1.xml)
===================================================================
--- trunk/data/levels/enigma_i/martin04_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_i/martin04_2.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,54 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Sokoban Revival" el:subtitle="" el:id="martin04"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Martin Hawlisch" el:email=""/>
+      <el:copyright>Copyright ? 2003 Martin Hawlisch</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+        <el:credits el:showinfo="false" el:showstart="false">A variation of an Original Sokoban level, ? 1982 Thinking Rabbit</el:credits>
+        <el:code>Converted to new API by /dev/null in June 2009.</el:code>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_yinyang_yin", invisible = true}
+ti["#"] = {"st_brownpyramide"}
+ti["+"] = {"st_box_wood"}
+ti["triggers"] = {"it_trigger", target = "hurdles%%"}
+ti["laser_e"] = {"st_laser_e", "hurdles%%", state=ON}
+ti["laser_w"] = {"st_laser_w", "hurdles%%", state=ON}
+ti["door_h"] = {"st_door", "hurdles%%", flavor="d", faces="ew"}
+ti["door_v"] = {"st_door", "hurdles%%", flavor="d", faces="ns"}
+ti["o"] = {"st_oxyd_a", name="left#"}
+ti["O"] = {"st_oxyd_a", name="right#"}
+ti["@"] = {"#ac_marble_black"}
+
+wo(res.autotile(ti, {"a", "f", "triggers"}, {"A", "B", "door_h"}, {"C", "D", "door_v", 3}, {"E", "E", "laser_e",5}, {"F", "F", "laser_w", 6}), " ", {
+    "####################",
+    "#   A   #O##########",
+    "# ###+  #          #",
+    "# ###  +##########C#",
+    "#o#  + + ##      B #",
+    "### # ## #O ###### #",
+    "#   # ## ####  ab# #",
+    "# +  +         fc# #",
+    "##### ### #@#  ed# #",
+    "#  o#     # ###### #",
+    "#D########E        #",
+    "#           F#######",
+    "####################"})
+
+wo:shuffleOxyd({"left#*", max=0},{"right#*", max=0} )
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_i/ralf03_2.xml
===================================================================
--- trunk/data/levels/enigma_i/ralf03_2.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_i/ralf03_2.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Welcome to the Machine" el:subtitle="" el:id="ralf03"/>
-      <el:version el:score="1" el:release="2" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
       <el:author  el:name="Ralf Westram" el:email="amgine at reallysoft.de" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Ralf Westram</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -28,10 +28,10 @@
 ti["D"] = {"st_plaster"}
 ti["."] = {"st_nil"}
 ti["S"] = {"st_switch", target="rotate", instant=true, safeaction=true}
-ti["1"] = {"st_oxyd", flavor="a", name="center1#", _kind=1, _rotation=0, _direction=1}
-ti["2"] = {"st_oxyd", flavor="a", name="center2#", _kind=2, _rotation=1, _direction=-1}
-ti["3"] = {"st_oxyd", flavor="a", name="center3#", _kind=3, _rotation=2, _direction=1}
-ti["4"] = {"st_oxyd", flavor="a", name="center4#", _kind=4, _rotation=3, _direction=-1}
+ti["1"] = {"st_oxyd", flavor="a", name="center1#", _kind=1}
+ti["2"] = {"st_oxyd", flavor="a", name="center2#", _kind=2}
+ti["3"] = {"st_oxyd", flavor="a", name="center3#", _kind=3}
+ti["4"] = {"st_oxyd", flavor="a", name="center4#", _kind=4}
 ti["d"] = {"it_document", text="text1"}
 ti["e"] = {"it_document", text="text2"}
 ti["@"] = {"ac_marble_black"}
@@ -61,28 +61,33 @@
     "#  ---    ---    ---    ---  #",
     "##############################"})
 
-part1 = {"    A  ", " SAAAA ", "AA   AA", "     A ", "AA   A ", " AA AA ", "  A A  "}
-part2 = {"    B  ", " SBBBB ", "BB   BB", "     B ", "BB   B ", " BB BB ", "  B B  "}
-part3 = {"    C  ", " SCCCC ", "CC   CC", "     C ", "CC   C ", " CC CC ", "  C C  "}
-part4 = {"    D  ", " SDDDD ", "DD   DD", "     D ", "DD   D ", " DD DD ", "  D D  "}
-part5 = {"    .  ", " ..... ", "..   ..", "     . ", "..   . ", " .. .. ", "  . .  "}
+local rotation = {MAP_IDENT, MAP_ROT_CW, MAP_ROT_180, MAP_ROT_CCW}
+local direction = {MAP_ROT_CW, MAP_ROT_CCW, MAP_ROT_CW, MAP_ROT_CCW}
 
-parts = {wo:newMap(" ", part1), wo:newMap(" ", part2), wo:newMap(" ", part3), wo:newMap(" ", part4), wo:newMap(" ", part5)}
+local part1 = {"    A  ", " SAAAA ", "AA   AA", "     A ", "AA   A ", " AA AA ", "  A A  "}
+local part2 = {"    B  ", " SBBBB ", "BB   BB", "     B ", "BB   B ", " BB BB ", "  B B  "}
+local part3 = {"    C  ", " SCCCC ", "CC   CC", "     C ", "CC   C ", " CC CC ", "  C C  "}
+local part4 = {"    D  ", " SDDDD ", "DD   DD", "     D ", "DD   D ", " DD DD ", "  D D  "}
+local part5 = {"    .  ", " ..... ", "..   ..", "     . ", "..   . ", " .. .. ", "  . .  "}
 
+local parts = {wo:newMap(" ", part1), wo:newMap(" ", part2), wo:newMap(" ", part3), wo:newMap(" ", part4), wo:newMap(" ", part5)}
+
 function rotate(value, sender)
     local centerstone = no["center?#*"]:nearest(sender)
-    local similarcenters = st(no["center"..centerstone["_kind"].."#*"])
+    local kind = centerstone["_kind"]
+    local similarcenters = st(no["center"..kind.."#*"])
+    local old_rotation = rotation[kind]
+    rotation[kind] = rotation[kind]^direction[kind]
     for center in similarcenters do
-        wo:drawMap(ti, po(center)-po(3, 3), parts[5]^center["_rotation"])
-        center["_rotation"] = (center["_rotation"]+center["_direction"])%4
-        wo:drawMap(ti, po(center)-po(3, 3), parts[center["_kind"]]^center["_rotation"])
+        wo:drawMap(ti, po(center)-po(3, 3), parts[5]^old_rotation)
+        wo:drawMap(ti, po(center)-po(3, 3), parts[kind]^rotation[kind])
     end
 end
 
 -- init:
 local centers = no["center?#*"]
 for center in centers do
-    wo:drawMap(ti, po(center)-po(3, 3), parts[center["_kind"]]^center["_rotation"])
+    wo:drawMap(ti, po(center)-po(3, 3), parts[center["_kind"]]^rotation[center["_kind"]])
 end
 
 wo:shuffleOxyd()

Deleted: trunk/data/levels/enigma_i/richi03_1.xml
===================================================================
--- trunk/data/levels/enigma_i/richi03_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_i/richi03_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,59 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Light Barrier" el:subtitle="" el:id="richi03"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
-      <el:author  el:name="Richi B?tzer" el:email="" el:homepage="enigma.mal2.ch"/>
-      <el:copyright>Copyright ?2005 Richi B?tzer</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-create_world(20, 13)
-
-fill_floor("fl-bluegray", 0,0,20,13)
-fill_floor("fl-water",4 ,1,2,11)
-fill_floor("fl-water",8 ,3,2,2)
-fill_floor("fl-water",8 ,9,3,3)
-fill_floor("fl-water",11 ,6,2,2)
-fill_floor("fl-water",14 ,9,2,2)
-
-draw_border("st-wood")
-set_stone("st-laser", 6, 0, {name="laser1", dir=SOUTH, on="1"})
-set_stone("st-switch", 9,11, {action="onoff", target="laser1"})
-
-set_stone("st-fart", 0,12, {name="fart1"})
-set_stone("st-timer", 0,0, {action="trigger", target="fart1", interval=10})
-
-set_stone( "st-wood", 10, 3)
-set_stone( "st-wood", 10, 4)
-set_stone( "st-wood", 13, 6)
-set_stone( "st-wood", 13, 7)
-set_stone( "st-wood", 16, 9)
-set_stone( "st-wood", 16, 10)
-
-local ac1=set_actor("ac-blackball", 16.5,3.5, {player=0, mouseforce="1"})
-
-oxyd(1,1)
-oxyd(1,3)
-oxyd(1,5)
-oxyd(1,7)
-oxyd(1,9)
-oxyd(1,11)
-oxyd_default_flavor = "c"
-oxyd_shuffle()
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_i/richi03_2.xml (from rev 1759, trunk/data/levels/enigma_i/richi03_1.xml)
===================================================================
--- trunk/data/levels/enigma_i/richi03_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_i/richi03_2.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,49 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Light Barrier" el:subtitle="" el:id="richi03"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author el:name="Richi B?tzer" el:email="" el:homepage="enigma.mal2.ch"/>
+      <el:copyright>Copyright ?2005 Richi B?tzer</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by level administrators, June 2009</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_bluegray"}
+ti["~"] = {"fl_water"}
+ti["#"] = {"st_box_wood"}
+ti["L"] = {"st_laser_s", name="laser", state=ON}
+ti["S"] = {"st_switch", target="laser"}
+ti["Q"] = {"st_quake", name="quake"}
+ti["T"] = {"st_timer", target="quake", interval=10}
+ti["O"] = {"st_oxyd_c", "all_oxyds#"}
+ti["@"] = {"#ac_marble_black"}
+
+wo(ti, " ", {
+    "T#####L#############",
+    "#O  ~~             #",
+    "#   ~~             #",
+    "#O  ~~  ~~#     @  #",
+    "#   ~~  ~~#        #",
+    "#O  ~~             #",
+    "#   ~~     ~~#     #",
+    "#O  ~~     ~~#     #",
+    "#   ~~             #",
+    "#O  ~~  ~~~   ~~#  #",
+    "#   ~~  ~~~   ~~#  #",
+    "#O  ~~  ~S~        #",
+    "Q###################"})
+
+wo:shuffleOxyd({"all_oxyds#*", linear=true})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_ii/edward10_1.xml
===================================================================
--- trunk/data/levels/enigma_ii/edward10_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_ii/edward10_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,68 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="- Meditation -" el:subtitle="" el:id="edward10"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
-      <el:author  el:name="Edward" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2006 Edward</el:copyright>
-      <el:license el:type="Donated to Enigma under the projects license" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="0:19"/>
-    </el:info>
-    <el:luamain><![CDATA[
-create_world(20,13)
-
-fill_floor("fl-abyss",0,0,20,13)
-
-function renderLine(line,pattern)
-    for i=1, strlen(pattern) do
-        local c=strsub(pattern,i,i)
-        if c=="#" then
-            set_floor("fl-wood",i-1,line)
-        elseif c=="+" then
-            set_floor("fl-gradient",i-1,line,{type="22"})
-        elseif c=="*" then
-            set_floor("fl-wood",i-1,line)
-            set_item("it-wormhole",i-1,line,{targetx=7.5,targety=8.5})
-        elseif c=="0" then
-            set_floor("fl-wood",i-1,line)
-            set_item("it-wormhole",i-1,line,{targetx=12.5,targety=8.5})            
-        elseif c=="O" then
-            set_floor("fl-wood",i-1,line)
-            set_item("it-hollow",i-1,line)
-        elseif c=="o" then
-            set_floor("fl-wood",i-1,line)
-            set_actor("ac-whiteball-small",(i-1)+.5,line+.5,{player=0, essential=1})
-        elseif c=="-" then
-            set_floor("fl-wood",i-1,line)
-        end
-    end
-end
-
-renderLine(00,"                    ")
-renderLine(01,"         ##         ")
-renderLine(02,"         *0         ")
-renderLine(03,"    ############    ")
-renderLine(04,"  ################  ")
-renderLine(05,"  ################  ")
-renderLine(06,"   ####OOOOOO####   ")
-renderLine(07,"   ###++----++###   ")
-renderLine(08,"   ###+o----o+###   ")
-renderLine(09,"   o# +      + #o   ")
-renderLine(10,"      +      +      ")
-renderLine(11,"      o      o      ")
-renderLine(12,"                    ")
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="true"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_ii/edward10_2.xml (from rev 1759, trunk/data/levels/enigma_ii/edward10_1.xml)
===================================================================
--- trunk/data/levels/enigma_ii/edward10_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_ii/edward10_2.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,48 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="- Meditation -" el:subtitle="" el:id="edward10"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Edward" el:email=""/>
+      <el:copyright>Copyright ? 2006 Edward</el:copyright>
+      <el:license el:type="Donated to Enigma under the project's license" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by daydreamer, June 2009</el:code>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="0:19"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_wood"}
+ti["-"] = {"fl_abyss"}
+ti["^"] = {"fl_slope", slope=NORTH}
+ti["v"] = {"it_wormhole_on", destination = "posV"}
+ti["w"] = {"it_wormhole_on", destination = "posW"}
+ti["o"] = {"it_meditation_hollow"}
+ti["@"] = {"#ac_pearl", essential=INDISPENSABLE}
+ti["V"] = ti["@"] .. {"fl_wood", name = "posV"}
+ti["W"] = ti["@"] .. {"fl_wood", name = "posW"}
+
+wo(ti, " ", {
+    "------------------",
+    "--------  --------",
+    "--------vw--------",
+    "---            ---",
+    "-                -",
+    "-                -",
+    "--    oooooo    --",
+    "--   ^^    ^^   --",
+    "--   ^V    W^   --",
+    "--@ -^------^- @--",
+    "-----^------^-----",
+    "----- at ------@-----",
+    "------------------"})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_ii/index.xml
===================================================================
--- trunk/data/levels/enigma_ii/index.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_ii/index.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10300" network="false" owner="Enigma Team" release="1" revision="29" title="Enigma II"/>
+  <info enigma="1.00" group="Enigma" location="10300" network="false" owner="Enigma Team" release="1" revision="30" title="Enigma II"/>
 
   <attributes/>
 
@@ -65,7 +65,7 @@
     <level _seq="57" _title="Floppy Swapping" _xpath="./martin19_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin19" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="58" _title="The Fuse" _xpath="./capkoh02_1" author="capkoh" ctrl="force" easy="false" id="capkoh02" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="59" _title="The Disappearing Block" _xpath="./duffy02_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy2" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="60" _title="- Meditation -" _xpath="./edward10_1" author="Edward" ctrl="force" easy="false" id="edward10" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="60" _title="- Meditation -" _xpath="./edward10_2" author="Edward" ctrl="force" easy="false" id="edward10" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="61" _title="Knight Moves" _xpath="./illmind04_1" author="illmind" ctrl="force" easy="false" id="illmind04" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="62" _title="Drunk" _xpath="./duffy38_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy38" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="63" _title="Do It Yourself" _xpath="./martin97_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin97" rel="1" rev="0" score="1" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_iii/duffy57_1.xml
===================================================================
--- trunk/data/levels/enigma_iii/duffy57_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_iii/duffy57_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,85 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Fool the Watchdog" el:subtitle="" el:id="duffy57"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
-      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-rooms_wide=1
-rooms_high=1
-
-levelw=1+(19*rooms_wide)
-levelh=1+(12*rooms_high)
-
-create_world( levelw, levelh)
-
-fill_floor("fl-mortar", 0,0,levelw,levelh)
-
-function renderLine( line, pattern)
-    for i=1, strlen(pattern) do
-        local c = strsub( pattern, i, i)
-        if c =="#" then
-            set_stone( "st-greenbrown", i-1, line)
-        elseif c == "o" then
-            oxyd( i-1, line)
-        elseif c == "*" then
-            set_stone( "st-brownie", i-1, line)
-        elseif c == "!" then
-            abyss(i-1,line)
-        elseif c=="w" then
-            set_actor("ac-whiteball-small", i-.5,line+.5, {player=1, mouseforce=0, essential=1})
-        elseif c=="W" then
-            set_actor("ac-whiteball-small", i-1,line+.5, {player=1, mouseforce=0, essential=1})
-        elseif c == "g" then
-            draw_stones("st-grate1",{i-1,line}, {1,1}, 1)
-        elseif c=="+" then
-            set_stone( "st-wood", i-1, line)
-        elseif c=="=" then
-            set_floor("fl-space",i-1,line)
-        elseif c=="i" then
-            set_floor("fl-ice",i-1,line)
-        elseif c=="h" then
-            set_item("it-hollow",i-1,line)
-            set_floor("fl-ice",i-1,line)
-        elseif c=="H" then
-            set_item("it-hollow",i-1,line)
-        elseif c=="R" then
-            set_actor("ac-rotor", i-1,line+.5, {attacknearest=0, player=1, mouseforce=0, range=40, force=60})
-        elseif c=="z" then
-            set_actor("ac-blackball", i-.5,line+.5, {player=0, essential=1})
-        end
-    end
-end
-
-renderLine(00,"####################")
-renderLine(01,"#iiii          iiii#")
-renderLine(02,"#ihii H  ww  H iihi#")
-renderLine(03,"#ii==          ==ii#")
-renderLine(04,"#ii==  w    w  ==ii#")
-renderLine(05,"#                  #")
-renderLine(06,"#zH ww  H RH  ww H #")
-renderLine(07,"#                  #")
-renderLine(08,"#ii==  w    w  ==ii#")
-renderLine(09,"#ii==          ==ii#")
-renderLine(10,"#ihii H  ww  H iihi#")
-renderLine(11,"#iiii          iiii#")
-renderLine(12,"####################")
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_iii/duffy57_2.xml (from rev 1759, trunk/data/levels/enigma_iii/duffy57_1.xml)
===================================================================
--- trunk/data/levels/enigma_iii/duffy57_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_iii/duffy57_2.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,47 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Fool the Watchdog" el:subtitle="" el:id="duffy57"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Jacob Scott" el:email=""/>
+      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>Converted to new API by daydreamer, June 2009</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_mortar"}
+ti["-"] = {"fl_ice"}
+ti["="] = {"fl_space"}
+ti["#"] = {"st_greenbrown"}
+ti["o"] = {"it_meditation_hollow"}
+ti["O"] = ti["-"] .. ti["o"]
+ti["R"] = {"#ac_rotor", attacknearest=false, range=40.0, strength=60.0}
+ti["p"] = {"#ac_pearl", adhesion=0.0, essential=INDISPENSABLE}
+ti["@"] = {"#ac_marble_black"}
+
+wo(ti, " ", {
+    "####################",
+    "#----          ----#",
+    "#-O-- o  pp  o --O-#",
+    "#--==          ==--#",
+    "#--==  p    p  ==--#",
+    "#                  #",
+    "#@o pp  o Ro  pp o #",
+    "#                  #",
+    "#--==  p    p  ==--#",
+    "#--==          ==--#",
+    "#-O-- o  pp  o --O-#",
+    "#----          ----#",
+    "####################"})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_iii/illmind11_2.xml
===================================================================
--- trunk/data/levels/enigma_iii/illmind11_2.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_iii/illmind11_2.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Waterworld" el:subtitle="" el:id="illmind11"/>
-      <el:version el:score="2" el:release="2" el:revision="6" el:status="stable"/>
+      <el:version el:score="2" el:release="2" el:revision="6" el:status="released"/>
       <el:author el:name="illmind" el:email="support at mag-heut.net" el:homepage="http://www.mag-heut.net/"/>
       <el:copyright>Copyright ? 2003 illmind</el:copyright>
       <el:license el:type="GPL version 2" el:open="true"/>
@@ -16,7 +16,6 @@
       <el:score el:easy="-" el:difficult="-"/>
     </el:info>
     <el:luamain><![CDATA[
-
 wo["SlopeStrength"] = 30
 wo["ShowMoves"] = true
 

Modified: trunk/data/levels/enigma_iii/index.xml
===================================================================
--- trunk/data/levels/enigma_iii/index.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_iii/index.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10400" network="false" owner="Enigma Team" release="1" revision="29" title="Enigma III"/>
+  <info enigma="1.00" group="Enigma" location="10400" network="false" owner="Enigma Team" release="1" revision="30" title="Enigma III"/>
 
   <attributes/>
 
@@ -95,7 +95,7 @@
     <level _seq="87" _title="Tilt Maze" _xpath="./duffy69_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy69" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="88" _title="Think Fast" _xpath="./duffy85_2" author="Jacob Scott" ctrl="force" easy="true" id="duffy85" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="89" _title="Overshoot" _xpath="./ss02_1" author="Sven Siggelkow" ctrl="force" easy="true" id="ss2" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="90" _title="Fool the Watchdog" _xpath="./duffy57_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy57" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="90" _title="Fool the Watchdog" _xpath="./duffy57_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy57" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="91" _title="The Sargasso Sea" _xpath="./martin17_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin17" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="92" _title="Hidden Danger" _xpath="./martin81_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin81" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="93" _title="Cover Your Ears" _xpath="./duffy40_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy40" rel="1" rev="1" score="1" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_iv/duffy01_1.xml
===================================================================
--- trunk/data/levels/enigma_iv/duffy01_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_iv/duffy01_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,118 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Meditation Puzzle" el:subtitle="" el:id="duffy1"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
-      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-rooms_wide=1
-rooms_high=1
-
-levelw=1+(19*rooms_wide)
-levelh=1+(12*rooms_high)
-
-create_world( levelw, levelh)
-draw_border("st-brownie")
-fill_floor("fl-leaves", 0,0,levelw,levelh)
-
-set_stone( "st-greenbrown", 1, 7)
-set_stone( "st-greenbrown", 2, 7)
-set_stone( "st-greenbrown", 3, 7)
-fill_floor("fl-water", 4,7, 1,1)
-set_stone( "st-greenbrown", 5, 7)
-set_stone( "st-greenbrown", 6, 7)
-set_stone( "st-greenbrown", 7, 7)
-set_stone( "st-greenbrown", 8, 7)
-set_stone( "st-greenbrown", 9, 7)
-set_stone( "st-greenbrown", 10, 7)
-set_stone( "st-greenbrown", 11, 7)
-set_stone( "st-greenbrown", 12, 7)
-set_stone( "st-greenbrown", 13, 7)
-set_stone( "st-greenbrown", 14, 7)
-set_stone( "st-greenbrown", 15, 7)
-set_stone( "st-greenbrown", 16, 7)
-fill_floor("fl-water", 17,7, 1,1)
-set_stone( "st-greenbrown", 18, 7)
-
-set_stone( "st-greenbrown", 17, 2)
-
-set_stone( "st-greenbrown", 16, 6)
-set_stone( "st-greenbrown", 18, 6)
-
-set_stone( "st-greenbrown", 8, 8)
-
-set_stone( "st-greenbrown", 2, 1)
-set_stone( "st-greenbrown", 2, 2)
-set_stone( "st-greenbrown", 2, 3)
-set_stone( "st-greenbrown", 2, 5)
-fill_floor("fl-water", 2,6, 1,1)
-
-set_stone( "st-greenbrown", 11, 1)
-set_stone( "st-greenbrown", 11, 2)
-fill_floor("fl-water", 11,4, 1,1)
-set_stone( "st-greenbrown", 11, 5)
-set_stone( "st-greenbrown", 11, 6)
-
-fill_floor("fl-water", 3,10, 1,1)
-fill_floor("fl-water", 4,10, 1,1)
-fill_floor("fl-water", 13,10, 1,1)
-
-fill_floor("fl-metal", 17,1, 1,1)
-
-set_stone( "st-greenbrown", 12, 3)
-set_stone( "st-greenbrown", 13, 3)
-set_stone( "st-greenbrown", 15, 3)
-set_stone( "st-greenbrown", 16, 3)
-set_stone( "st-greenbrown", 17, 3)
-set_stone( "st-greenbrown", 18, 3)
-set_stone( "st-greenbrown", 12, 2)
-
-set_stone( "st-wood", 15, 5)
-set_stone( "st-wood", 15, 2)
-
-set_stone( "st-greenbrown", 9, 4)
-
-oneway( 17, 6, enigma.NORTH)
-
-set_stone( "st-shogun-l", 13,5)
-set_stone( "st-shogun-s",4, 2)
-set_stone( "st-shogun-m", 12,10)
-
-set_stone( "st-wood", 5, 3)
-set_stone( "st-wood", 7, 3)
-
-set_stone("st-door", 17, 1 , {name="door3", type="v"})
-set_item("it-trigger", 1,6, {action="openclose", target="door3"})
-
-set_stone("st-door", 2, 4 , {name="door1", type="v"})
-set_item("it-trigger", 13,1, {action="openclose", target="door1"})
-
-set_stone("st-door", 14, 3 , {name="door2", type="h"})
-shogundot3(8,2, {target="door2", action="openclose"})
-
----draw_stones("st-stone_break", {10,5}, {1,0},3)
-
-hollow(1,1)
-hollow(18,2)
-
-set_actor("ac-whiteball-small", 7.5,2, {player=0, essential=1})
-set_actor("ac-whiteball-small", 2,9, {player=0, essential=1})
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_iv/duffy01_2.xml (from rev 1759, trunk/data/levels/enigma_iv/duffy01_1.xml)
===================================================================
--- trunk/data/levels/enigma_iv/duffy01_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_iv/duffy01_2.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,56 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Meditation Puzzle" el:subtitle="" el:id="duffy1"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Jacob Scott" el:email=""/>
+      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>Converted to new API by daydreamer, June 2009</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_lawn"}
+ti["~"] = {"fl_water"}
+ti["."] = {"fl_metal"}
+ti["#"] = {"st_brownie"}
+ti["="] = {"st_greenbrown"}
+ti["W"] = {"st_box_wood"}
+ti["S"] = {"st_shogun_s"}
+ti["M"] = {"st_shogun_m"}
+ti["L"] = {"st_shogun_l"}
+ti["^"] = {"st_oneway_n"}
+ti["A"] = {"st_door", name="door1", flavor="d", faces="ns"}
+ti["B"] = {"st_door", name="door2", flavor="d", faces="ew"}
+ti["C"] = ti["."] .. {"st_door", name="door3", flavor="d", faces="ew" }
+ti["a"] = {"it_shogun_l", target="door1"}
+ti["b"] = {"it_trigger", target="door2"}
+ti["c"] = {"it_trigger", target="door3"}
+ti["o"] = {"it_meditation_hollow"}
+ti["@"] = {"#ac_pearl", essential=INDISPENSABLE}
+
+wo(ti, " ", {
+    "####################",
+    "#o=        = b   C #",
+    "# = S @ a  ==  W =o#",
+    "# =  W W    ==A====#",
+    "# B      = ~       #",
+    "# =        = L W   #",
+    "#c~        =    =^=#",
+    "#===~============~=#",
+    "#       =          #",
+    "#  @               #",
+    "#   ~~      M~     #",
+    "#                  #",
+    "####################"})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_iv/index.xml
===================================================================
--- trunk/data/levels/enigma_iv/index.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_iv/index.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10500" network="false" owner="Enigma Team" release="1" revision="44" title="Enigma IV"/>
+  <info enigma="1.00" group="Enigma" location="10500" network="false" owner="Enigma Team" release="1" revision="45" title="Enigma IV"/>
 
   <attributes/>
 
@@ -14,7 +14,7 @@
     <level _seq="6" _title="TNT Shortage?" _xpath="./siegfried74_1" author="Siegfried Fennig" ctrl="force" easy="false" id="siegfried74" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="7" _title="Antimaze" _xpath="./luc02_3" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc02" rel="3" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="8" _title="Boulder-Puzzle" _xpath="./duffy06_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy6" rel="2" rev="3" score="1" target="time" unit="duration"/>
-    <level _seq="9" _title="Doors Galore" _xpath="./raywick01_2" author="Ray Wick" ctrl="force" easy="true" id="RayWick001" rel="2" rev="1" score="2" target="time" unit="duration"/>
+    <level _seq="9" _title="Doors Galore" _xpath="./raywick01_3" author="Ray Wick" ctrl="force" easy="true" id="RayWick001" rel="3" rev="3" score="3" target="time" unit="duration"/>
     <level _seq="10" _title="Slide it in" _xpath="./ss13_1" author="Sven Siggelkow" ctrl="force" easy="true" id="ss13" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="11" _title="Switch-Switch" _xpath="./raywick02_2" author="Ray Wick" ctrl="force" easy="false" id="RayWick002" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="12" _title="Slinky-Racing" _xpath="./duffy14_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy14" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -25,7 +25,7 @@
     <level _seq="17" _title="Flood Gates" _xpath="./nat08_2" author="Nat Pryce" ctrl="force" easy="false" id="nat8" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="18" _title="Sierpinski" _xpath="./alain10_1" author="Alain Busser" ctrl="force" easy="false" id="alain10" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="19" _title="Labyrinth of Puzzles" _xpath="./duffy35_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy35" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="20" _title="Meditation Puzzle" _xpath="./duffy01_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy1" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="20" _title="Meditation Puzzle" _xpath="./duffy01_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy1" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="21" _title="NO Trespassing" _xpath="./martin104_1" author="Martin Hawlisch" ctrl="force" easy="true" id="martin104" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="22" _title="Symmetry" _xpath="./ant31_1" author="Petr Machata" ctrl="force" easy="false" id="ant31" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="23" _title="Bavarian Madness" _xpath="./ss08_1" author="Sven Siggelkow" ctrl="force" easy="false" id="ss8" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -104,8 +104,8 @@
     <level _seq="96" _title="TODO" _xpath="lib/todo" author="Martin Hawlisch" ctrl="force" easy="false" id="todo" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="97" _title="Over the Lake" _xpath="./siegfried27_2" author="Siegfried Fennig" ctrl="force" easy="false" id="level9d" rel="2" rev="4" score="2" target="time" unit="duration"/>
     <level _seq="98" _title="Bizarro World" _xpath="./duffy73_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy73" rel="3" rev="23" score="2" target="time" unit="duration"/>
-    <level _seq="99" _title="Little Puzzles" _xpath="./wb11_1" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb11" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="100" _title="Big Adventures" _xpath="./wb12_1" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb12" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="99" _title="Little Puzzles" _xpath="./wb11_2" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb11" rel="2" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="100" _title="Big Adventures" _xpath="./wb12_2" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb12" rel="2" rev="0" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Deleted: trunk/data/levels/enigma_iv/raywick01_2.xml
===================================================================
--- trunk/data/levels/enigma_iv/raywick01_2.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_iv/raywick01_2.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,274 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Doors Galore" el:subtitle="" el:id="RayWick001"/>
-      <el:version el:score="2" el:release="2" el:revision="1" el:status="released"/>
-      <el:author  el:name="Ray Wick" el:email="RayRWick at AOL.com" el:homepage=""/>
-      <el:copyright>Copyright ? Ray Wick</el:copyright>
-      <el:license el:type="Donated to Enigma under the projects license" el:open="true"/>
-      <el:compatibility el:enigma="1.00" el:engine="enigma"/>
-      <el:modes el:easy="true" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:credits el:showinfo="true" el:showstart="false">Difficult variation by Ronald Lamprecht.</el:credits>
-        <el:code>
-	  Authors original level modified to maintain "enigma" compatibility by a 
-	  solution neutral minimal change. Authors version as easy mode with an 
-	  additional variation from Ronald Lamprecht as difficult mode.
-	</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-enigma.ConserveLevel = FALSE
-
-LAND_FLOOR = "fl-brick"
-SOFT_FLOOR = "fl-hay"
-WATER_FLOOR = "fl-water"
-WALL = "st-brick"
-
-if difficult then
-level = {
-    "#@###S#L##########@#",
-    "#6#~~~~~J 0@# > #B1#",
-    "C ~~~ ~~~~###5# D  $",
-    "#     ~~~~~~~ E H G#",
-    "#b+++ ~~~~~~@ #4# 7@",
-    "#e    ~~~!~~+ ! #8##",
-    "#  a ~~~~~~~~ !   ##",
-    "# ~~~~~~~~~~~ #c???#",
-    "# ~~~@~~d~~ * #??+ #",
-    "# ~~~~~~  + + ###  #",
-    "# ~~~~gx  +++ 3 #9I#",
-    "# >  +. +    +# < 2@",
-    "#@##########!!###A##"
-}
-else
-level = {
-    "#@###S#L##########@#",
-    "#6#~~~~~@~~~~ > #B1#",
-    "C ~~~ ~~~~~~#5# D  $",
-    "#     ~~~~~~~ E H G#",
-    "#b+++ ~~~~~~@ #4# 7@",
-    "#e    ~~~!~~+ ! #8##",
-    "#  a ~~~~~~~~ !   ##",
-    "# ~~~~~~~~~~~ #c???#",
-    "# ~~~@~~d~~ * #??+ #",
-    "# ~~~~~~  + + ###  #",
-    "# ~~~~gx  +++ 3 #9I#",
-    "# >  +.      +# < 2@",
-    "#@##########!!###A##"
-}
-end
-
-cells = {}
-cells["!"] = function( x, y )
-    set_stone( "st-stoneimpulse", x, y )
-end
-
-cells["#"] = function( x, y )
-    set_stone( WALL, x, y )
-end
-cells["*"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_actor( "ac-blackball", x+0.5, y+0.5 )
-end
-cells["@"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    oxyd(x,y)
-end
-cells["+"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-wood", x, y )
-end
-cells["~"] = function( x, y )
-    set_floor( WATER_FLOOR, x, y )
-end
-cells["$"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-coinslot", x, y, {action="callback", target="funcc"})
-end
-cells["<"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-oneway-w", x, y)
-end
-cells["v"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-oneway-s", x, y)
-end
-cells[">"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-oneway-e", x, y)
-end
-cells["^"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-oneway-n", x, y)
-end
-cells["g"] = function( x, y )
-    set_floor( WATER_FLOOR, x, y )
-    set_stone( "st-glass", x, y)
-end
-cells["?"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_item( "it-coin1", x, y )
-end
-cells["x"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_item( "it-blackbomb", x, y )
-end
-cells["x"] = function( x, y )
-    set_floor( "fl-water", x, y )
-    set_stone( "st-glass", x, y)
-    set_item( "it-blackbomb", x, y )
-end
-cells["."] = function( x, y )
-    set_floor( "fl-wood", x, y )
-    set_item( "it-burnable_oil", x, y )
-end
-cells[" "] = function( x, y )
-    set_floor( LAND_FLOOR, x,y )
-end
-cells["1"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    doorh(x, y, {name="door1"} )
-end
-cells["2"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    doorv(x, y, {name="door2"} )
-end
-cells["3"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    doorv(x, y, {name="door3"} )
-end
-cells["4"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    doorh(x, y, {name="door4"} )
-end
-cells["5"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    doorh(x, y, {name="door5"} )
-end
-cells["6"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    doorh(x, y, {name="door6"} )
-end
-cells["7"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    doorv(x, y, {name="door7"} )
-end
-cells["8"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    doorh(x, y, {name="door8"} )
-end
-cells["9"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    doorh(x, y, {name="door9"} )
-end
-cells["0"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    doorv(x, y, {name="door0"} )
-end
-cells["A"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-key_a", x, y, {action="openclose", target="door1"})
-end
-cells["B"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-key_b", x, y, {action="openclose", target="door2"})
-end
-cells["C"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-key_c", x, y, {action="openclose", target="door3"})
-end
-cells["D"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-floppy", x, y, {action="openclose", target="door4"})
-end
-cells["E"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-floppy", x, y, {action="openclose", target="door5"})
-end
-cells["F"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-floppy", x, y, {action="openclose", target="door6"})
-end
-cells["G"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-floppy", x, y, {action="openclose", target="door7"})
-end
-cells["H"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-floppy", x, y, {action="openclose", target="door8"})
-end
-cells["I"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-floppy", x, y, {action="openclose", target="door9"})
-end
-cells["J"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_item( "it-trigger", x, y, {action="openclose", target="door0"})
-end
-cells["L"] = function( x, y )
-    set_floor( SOFT_FLOOR, x, y )
-    set_attrib(laser(x, y, FALSE, SOUTH), "name", "laser")
-end
-cells["S"] = function( x, y )
-    set_floor( SOFT_FLOOR, x, y )
-    set_stone( "st-switch", x, y, {target="laser", action="onoff", on=1 })
-end
-cells["a"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_item( "it-key_a", x, y )
-end
-cells["b"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_item( "it-key_b", x, y )
-end
-cells["c"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-wood", x, y )
-    set_item( "it-key_c", x, y )
-end
-cells["d"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_item( "it-floppy", x, y )
-end
-cells["e"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_stone( "st-wood", x, y )
-    set_item( "it-floppy", x, y )
-end
-cells["f"] = function( x, y )
-    set_floor( LAND_FLOOR, x, y )
-    set_item( "it-floppy", x, y )
-end
-
-create_world( strlen(level[1]), getn(level) )
-fill_floor (LAND_FLOOR)
-
-for y,line in pairs(level) do
-    for x = 1,strlen(line) do
-        cell = strchar(strbyte(line,x))
-        cells[cell]( x-1, y-1 )
-    end
-end
-oxyd_shuffle()
-through=0
-function funcc()
-    if through==1 then
-        through=0
-    end
-    if through==0 then
-        SendMessage("door3", "openclose")
-        SendMessage("door6", "openclose")
-    end
-    through=through+1
-end
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_iv/raywick01_3.xml (from rev 1734, trunk/data/levels/enigma_iv/raywick01_2.xml)
===================================================================
--- trunk/data/levels/enigma_iv/raywick01_2.xml	2009-06-23 00:34:20 UTC (rev 1734)
+++ trunk/data/levels/enigma_iv/raywick01_3.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,66 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title ="Doors Galore" el:id="RayWick001"/>
+      <el:version el:score="3" el:release="3" el:revision="3" el:status="released"/>
+      <el:author  el:name="Ray Wick" el:email="RayRWick at AOL.com"/>
+      <el:copyright>Copyright ? Ray Wick</el:copyright>
+      <el:license el:type="Donated to Enigma under the projects license" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Lamprecht</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = not wo["IsDifficult"]
+
+ti["  "] = cond(wo["IsDifficult"], {"fl_brick"}, {"fl_brick", friction=6.4})
+ti[" ~"] = {"fl_water"}
+ti["f "] = {"it_floppy"}
+ti["g "] = cond(wo["IsDifficult"], ti["  "], ti["f "])
+ti["? "] = cond(wo["IsDifficult"], {"it_coin_s"}, ti["  "])
+ti["x "] = {"it_bomb_black"}
+ti["d "] = {"it_dynamite"}
+ti["* "] = {"st_oxyd"}
+ti["# "] = {"st_brick"}
+ti["+ "] = {"st_box_hay"}
+ti["e "] = ti["+ "] .. ti["f "]
+ti["! "] = {"st_stoneimpulse"}
+ti["> "] = {"st_oneway_e"}
+ti["< "] = {"st_oneway_w"}
+ti["@ "] = {"#ac_marble"}
+if wo["IsDifficult"] then
+    ti["%6"] = {"st_coinslot", target={"door%6", "door%3"}}
+    ti["L3"] = ti["# "]
+end
+ti["K3"] = ti["+ "] .. cond(wo["IsDifficult"], {"it_nil"}, {"it_key", code="%3"})
+ti["doorsh"]  = {"st_door_d", "door%%", faces="ns"}
+ti["doorsv"]  = {"st_door_d", "door%%", faces="ew"}
+ti["floppys"] = {"st_floppy", target="door%%"}
+ti["locks"]   = {"st_key", code="%%", target="door%%"}
+ti["keys"]    = {"it_key", code="%%"}
+
+local myres = res.autotile(res.composer(ti), {"=", "doorsh"}, {"|", "doorsv"}, {"%", "floppys"}, {"L", "locks"}, {"K", "keys"})
+
+wo(myres, "  ", {
+    "# * # # # # # # # # # # # # # # # # * # ",
+    "# =3#  ~ ~ ~ ~ ~ ~*  ~ ~ ~  >   # L2=1# ",
+    "L3   ~ ~ ~   ~ ~ ~ ~ ~ ~# =5#   %4    %6",
+    "#            ~ ~ ~ ~ ~ ~ ~  %5  %8  %7# ",
+    "# K2+ + +    ~ ~ ~ ~ ~ ~*   # =4#   |7* ",
+    "# e          ~ ~ ~!  ~ ~+   !   # =8# # ",
+    "#     K1   ~ ~ ~ ~ ~ ~ ~ ~  !       # # ",
+    "#    ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~  # K3? ? ? # ",
+    "#    ~ ~ ~*  ~ ~f  ~ ~  @   # ? ? +   # ",
+    "#    ~ ~ ~ ~ ~ ~    +   +   # # #     # ",
+    "#    ~ ~ ~ ~ ~ ~    + + +   |6  # =9%9# ",
+    "#   >   g + x d           + #   <   |2* ",
+    "# * # # # # # # # # # # ! ! # # # L1# # "})
+
+wo:shuffleOxyd()
+ ]]></el:luamain>
+    <el:i18n>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_iv/wb11_1.xml
===================================================================
--- trunk/data/levels/enigma_iv/wb11_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_iv/wb11_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,114 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Little Puzzles" el:subtitle="" el:id="wb11"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
-      <el:author  el:name="Jon 'WB' Sneyers" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Jon 'WB' Sneyers</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-       <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-cells={}
-
-cells[";"]=cell{floor="fl-tigris"}
-cells[" "]=cell{floor="fl-samba"}
-cells["/"]=cell{floor="fl-stone"}
-cells[":"]=cell{floor="fl-leaves"}
-cells["%"]=cell{floor="fl-sand"}
-cells["w"]=cell{stone="st-wood"}
-cells["W"]=cell{parent=cells[":"], stone={"st-wood"}}
-cells["i"]=cell{stone="st-stoneimpulse"}
-cells["I"]=cell{stone="st-stoneimpulse-hollow"}
-
-cells["G"]=cell{stone="st-grate1"}
-cells["#"]=cell{stone="st-rock6"}
-cells["="]=cell{stone="st-rock1"}
-cells["R"]=cell{stone="st-rock8"}
-cells["B"]=cell{parent=cells[":"],stone="st-black4"}
-cells["b"]=cell{parent=cells[":"],stone="st-white4"}
-cells["@"]=cell{floor="fl-abyss"}
-cells["."]=cell{floor="fl-water"}
-cells["S"]=cell{floor="fl-space"}
-
-cells["H"]=cell{stone="st-chameleon"}
-
-cells["&"]=cell{{{oneway, EAST}}}
-cells["%"]=cell{{{oneway, WEST}}}
-cells["l"]=cell{{{oneway, SOUTH}}}
-cells["j"]=cell{{{oneway, NORTH}}}
-
-cells["V"]=cell{parent=cells[" "], stone="st-bolder-s"}
-cells[">"]=cell{parent=cells[" "], stone="st-bolder-e"}
-cells["<"]=cell{parent=cells[" "], stone="st-bolder-w"}
-cells["^"]=cell{parent=cells[" "], stone="st-bolder-n"}
-
-cells["t"]=cell{stone={face="st-door", attr={name="doorA", type="v"}}}
-cells["T"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorA"}}}
-cells["O"]=cell{actor={face="ac-blackball", attr={player=0}}}
-cells["o"]=cell{actor={face="ac-whiteball", attr={player=1}}}
-cells["0"]=oxyd
-cells["y"]=cell{item= {face="it-yinyang"}}
-cells["1"]=cell{{{document, "text1"}}}
-cells["2"]=cell{{{document, "text2"}}}
-cells["3"]=cell{{{document, "text3"}}}
-
-level = {      
---  012345678901234567890123456789012345678
-   "=======================================",
-   "= O ===            = www              =",
-   "i       =====0==== =  w ....   ....   =",
-   "iw====  &        = =  w......y......  =",
-   "=    =  &   ===  = %w w.............  =",
-   "= =  =  &   =T=  = % w  ...........   =",
-   "= =jj=  ===== =  ===     .........    =",
-   "= =           =    = ==== .......wwwww=",
-   "=0===========i===  =SSSS=  .....   w  =",
-   "===         =  0=  =SSSS    ...    w  =",
-   "=   =l=l=l= =jl==  =SSSS=    .     w  =",
-   "=   &  1  %        =0SSS=          w  =",
-   "=ll==0===0==========================jj=",
-   "=   ........   =   % % & & & & % & %  =",
-   "= w ...    . w = 0 =j=j=l=j=j=l=j=j=j==",
-   "= ww. .    . 2 & = % & % % & & & % &  =",
-   "= w . .    . w = = =j=l=l=j=l=j=j=j=l==",
-   "=   ........   = = & & % & % & & & %  =",
-   "==j==========l==j===================lj=",
-   "0   3 t     %      =   =  ..0... ...  =",
-   "==0   ============ = w   w...... ...  =",
-   "0 =0  =  w ..... = =ww w w   ... .....=",
-   "=  ==== wwww ...y= & w w     ... ...  =",
-   "0o       w ..... = &   =   ..... ...  0",
-   "==0==0=================================",
---  012345678901234567890123456789012345678
-}
-
-set_default_parent(cells[" "])
-create_world_by_map(level)
-oxyd_shuffle()
-oxyd_default_flavor = "a"
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-      <el:string el:key="text1">
-        <el:english el:translate="true">Oops ... you're stuck ...     Try again ...</el:english>
-      </el:string> 
-      <el:string el:key="text2">
-        <el:english el:translate="true">Congratulations, you reached this side ...      but can you get to the oxyds? </el:english>
-      </el:string> 
-      <el:string el:key="text3">
-        <el:english el:translate="true">Well done!</el:english>
-      </el:string> 
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_iv/wb11_2.xml (from rev 1734, trunk/data/levels/enigma_iv/wb11_1.xml)
===================================================================
--- trunk/data/levels/enigma_iv/wb11_1.xml	2009-06-23 00:34:20 UTC (rev 1734)
+++ trunk/data/levels/enigma_iv/wb11_2.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,80 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Little Puzzles" el:subtitle="" el:id="wb11"/>
+      <el:version el:score="1" el:release="2" el:revision="1" el:status="released"/>
+      <el:author  el:name="Jon 'WB' Sneyers" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2003 Jon 'WB' Sneyers</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by /dev/null (June 2009)</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_samba"}
+ti["."] = {"fl_space"}
+ti["~"] = {"fl_water"}
+ti["#"] = {"st_granite"}
+ti["+"] = {"st_box"}
+ti["d"] = {"it_trigger", target = "door"}
+ti["D"] = {"st_door", "door", faces= "ew", state = CLOSED}
+ti["^"] = {"st_oneway", orientation = NORTH}
+ti[">"] = {"st_oneway", orientation = EAST}
+ti["V"] = {"st_oneway", orientation = SOUTH}
+ti["<"] = {"st_oneway", orientation = WEST}
+ti["I"] = {"st_stoneimpulse"}
+ti["y"] = {"it_yinyang"}
+ti["1"] = {"it_document", text = "text1"}
+ti["2"] = {"it_document", text = "text2"}
+ti["3"] = {"it_document", text = "text3"}
+ti["O"] = {"st_oxyd"}
+ti["@"] = {"#ac_marble_black"}
+ti["*"] = {"#ac_marble_white"}
+
+wo(ti, " ", {
+    "#######################################",
+    "# @ ###            # +++              #",
+    "I       #####O#### #  + ~~~~   ~~~~   #",
+    "I+####  >        # #  +~~~~~~y~~~~~~  #",
+    "#    #  >   ###  # <+ +~~~~~~~~~~~~~  #",
+    "# #  #  >   #d#  # < +  ~~~~~~~~~~~   #",
+    "# #^^#  ##### #  ###     ~~~~~~~~~    #",
+    "# #           #    # #### ~~~~~~~+++++#",
+    "#O###########I###  #....#  ~~~~~   +  #",
+    "###         #  O#  #....    ~~~    +  #",
+    "#   #V#V#V# #^V##  #....#    ~     +  #",
+    "#   >  1  <        #O...#          +  #",
+    "#VV##O###O##########################^^#",
+    "#   ~~~~~~~~   #   < < > > > > < > <  #",
+    "# + ~~~    ~ + # O #^#^#V#^#^#V#^#^#^##",
+    "# ++~ ~    ~ 2 > # < > < < > > > < >  #",
+    "# + ~ ~    ~ + # # #^#V#V#^#V#^#^#^#V##",
+    "#   ~~~~~~~~   # # > > < > < > > > <  #",
+    "##^##########V##^###################V^#",
+    "O   3 D     <      #   #  ~~O~~~ ~~~  #",
+    "##O   ############ # +   +~~~~~~ ~~~  #",
+    "O #O  #  + ~~~~~ # #++ + +   ~~~ ~~~~~#",
+    "#  #### ++++ ~~~y# > + +     ~~~ ~~~  #",
+    "O*       + ~~~~~ # >   #   ~~~~~ ~~~  O",
+    "##O##O#################################"})
+
+wo:shuffleOxyd()
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+      <el:string el:key="text1">
+        <el:english el:translate="true">Oops ... you're stuck ...     Try again ...</el:english>
+      </el:string>
+      <el:string el:key="text2">
+        <el:english el:translate="true">Congratulations, you reached this side ...      but can you get to the oxyds? </el:english>
+      </el:string>
+      <el:string el:key="text3">
+        <el:english el:translate="true">Well done!</el:english>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_iv/wb12_1.xml
===================================================================
--- trunk/data/levels/enigma_iv/wb12_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_iv/wb12_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,158 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Big Adventures" el:subtitle="" el:id="wb12"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
-      <el:author  el:name="Jon 'WB' Sneyers" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Jon 'WB' Sneyers</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-       <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-cells={}
-
-cells[";"]=cell{floor="fl-tigris"}
-cells[" "]=cell{floor="fl-samba"}
-cells["/"]=cell{floor="fl-stone"}
-cells["9"]=cell{floor="fl-leaves"}
-cells["6"]=cell{floor="fl-sand"}
-cells[":"]=cell{floor="fl-rough"}
-cells["5"]=cell{floor="fl-swamp"}
-cells["w"]=cell{stone="st-wood"}
-cells["W"]=cell{parent=cells[":"], stone={"st-wood"}}
-cells["x"]=cell{stone="st-stoneimpulse"}
-cells["X"]=cell{stone="st-stoneimpulse-hollow"}
-
-cells["#"]=cell{stone="st-grate1"}
-cells["="]=cell{stone="st-rock1"}
-cells["R"]=cell{stone="st-rock7"}
-cells["r"]=cell{parent=cells[":"],stone="st-stone_break"}
-cells["p"]=cell{item="it-hammer"}
-cells["Q"]=cell{item="it-blackbomb"}
-cells["+"]=cell{item="it-spring2"}
-
-cells["."]=cell{floor="fl-abyss"}
-cells["@"]=cell{floor="fl-water"}
-cells["S"]=cell{floor="fl-space"}
-
-cells["H"]=cell{stone="st-chameleon"}
-
-cells["&"]=cell{{{oneway, EAST}}}
-cells["%"]=cell{{{oneway, WEST}}}
-cells["l"]=cell{{{oneway, SOUTH}}}
-cells["j"]=cell{{{oneway, NORTH}}}
-cells["V"]=cell{parent=cells[" "], stone="st-bolder-s"}
-cells[">"]=cell{parent=cells[" "], stone="st-bolder-e"}
-cells["<"]=cell{parent=cells[" "], stone="st-bolder-w"}
-cells["^"]=cell{parent=cells[" "], stone="st-bolder-n"}
-
-cells["a"]=cell{stone={face="st-door", attr={name="doorA", type="v"}}}
-cells["b"]=cell{stone={face="st-door", attr={name="doorB", type="v"}}}
-cells["c"]=cell{stone={face="st-door", attr={name="doorC", type="v"}}}
-cells["d"]=cell{stone={face="st-door", attr={name="doorD", type="h"}}}
-cells["e"]=cell{stone={face="st-door", attr={name="doorE", type="h"}}}
-cells["f"]=cell{stone={face="st-door", attr={name="doorF", type="h"}}}
-cells["g"]=cell{stone={face="st-door", attr={name="doorG", type="h"}}}
-cells["h"]=cell{stone={face="st-door", attr={name="doorH", type="v"}}}
-cells["i"]=cell{stone={face="st-door", attr={name="doorI", type="h"}}}
-cells["k"]=cell{stone={face="st-door", attr={name="doorK", type="v"}}}
-cells["m"]=cell{stone={face="st-door", attr={name="doorM", type="v"}}}
-cells["n"]=cell{stone={face="st-door", attr={name="doorN", type="v"}}}
-cells["A"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorA"}}}
-cells["B"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorB"}}}
-cells["C"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorC"}}}
-cells["D"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorD"}}}
-cells["E"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorE"}}}
-cells["F"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorF"}}}
-cells["G"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorG"}}}
-cells["H"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorH"}}}
-cells["I"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorI"}}}
-cells["K"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorK"}}}
-cells["M"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorM"}}}
-cells["N"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorN"}}}
-
-cells["z"]=cell{stone={face="st-door", attr={name="doorZ", type="h"}}}
-cells["Z"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorZ"}}}
-cells["y"]=cell{stone={face="st-door", attr={name="doorY", type="h"}}}
-cells["Y"]=cell{item= {face="it-trigger", attr={action="openclose", target="doorY"}}}
-
-cells["O"]=cell{actor={face="ac-blackball", attr={player=0}}}
-cells["0"]=oxyd
-cells["1"]=cell{{{document, "text1"}}}
-cells["2"]=cell{{{document, "text2"}}}
-cells["3"]=cell{{{document, "text3"}}}
-cells["4"]=cell{{{document, "text4"}}}
-
-level = {      
---  0123456789012345678|012345678901234567|0123456789012345678
-   "==========================================================",
-   "=H@@@@@@@@W::rR6666&  =     =     =G= =SSSSS SSSSSSSSSS=K=",
-   "=@@@@@@@@WW:rR666:@=  =     =  @  = = =SSSSS SSSSSSSSSS=S=",
-   "=@@@@@@@WW:rR666:@@= w=w =  =  =  = = &  SSSwSSSSSS   S=S=",
-   "=@@@@@@WW:rR666:@@@=  w  =     =  @ = =SSSSS SSSSSS   S=S=",
-   "=@@@@@WW:rR666:@   =     =     =      =SSSSS SSSSSS   SSS=",
-   "=@@@@WW:rR666:@@ @ ==============================SSSSSSSS=",
-   "=@@@WW:rR666:@   @ %     @@@@@@@@@@@@@=         =SSSSSSSS=",
-   "=@@WW:rR666:@@ @@@@=@   @@   @@ @@    = @@@@@@@@=SSSSSSSS=",
-   "=@WW:rR666:@@@    @=@@ @@ + @@ + @@ + %w  w at w   =SSSSSSSS=",
-   "=WW:rR666:@@@@@@@ @=@@@@   @@     @@  =@@ @@@ @@=======  =",
-   "=W:rR666:@        @=@@@@@@@@@@@@@@@@@@=         =        =",
-   "=::Rr666R=l====================================j====ll====",
-   "=:::Rr66r=         =0=0===0=0=    2   = & % & & =      @ =",
-   "=:::rR66R= w w w   =         =   === O=j=j=j=l=l=     w@ =",
-   "=::WRr66r=  w w  = = 0=0=0=0 =   ====== & % % % =@@@   @w=",
-   "=::Rr666R= w w w = =    4    =www== @@=j=j=l=l=j=E @@@@@@=",
-   "=:WR666Rr=#@@=#@@= =0=0   0=0=      @@& & & & & =  @   @ =",
-   "=:rR666R:=@@@#@@@= =====j=========  @@===========  @ w @1=",
-   "=:R666R::=@#@#@#@= = k = =AM #=========F  @     =@@@ w @w=",
-   "=:R666r::=@@@=@@@= =d=g=i=B      #### =  @@@ ww =@     @ =",
-   "=:rR66rR:=@RR=@RR= =e= h =CN #=# #  # %  @@@  w =@   @@w =",
-   "=:R666R::=   w   = =f==========#wwwww = @@@@ ww =@@@@@@w =",
-   "=:R666r::=       =Y= a b c m n        =D @@@    %      ww=",
-   "=:rR66RR:=ll==============================================",
-   "=::r666r:=  =Z  3= & =SSS=   =www w ww=@@@@@@555==========",
-   "=::R666R:=  == w = = =S=S= = = wQw wQ =  w  =555=55555====",
-   "=::rR66r:=   ==y==z= =S=S=S= &w w w w & w w =  w&5555555==",
-   "=::Rr66R:==        =S=S=SSS============  w  =555=55555555=",
-   "=::rR66r::==========SSS=====xXXXXXXXXx=@@@@@@555===555555=",
-   "=::R666R:::::::::::=====xxxxxxxxXxxxXx==============55555=",
-   "=:Rr66rRrRrRrRrRrW:=   =<xxx   xXxXXXx=  555555===5555555=",
-   "=:rR666rRr666666RrR= =       xXxXxXxxx= =5555555555555555=",
-   "=:Rr666666666666666% =======x=XXXxXxXX% =5=555555555555===",
-   "=::Rr66666rRrRr6666% =I    =<=>=xXXxXx===5================",
-   "=::WRrRrRrR:::RrRrR===  =<x  =  xXXXXX=55555555555555555p=",
-   "=========================xx==xxxxxxxxx===================="
-}
-
-set_default_parent(cells[" "])
-create_world_by_map(level)
-oxyd_shuffle()
-oxyd_default_flavor = "a"
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-      <el:string el:key="text1">
-        <el:english el:translate="true">Too many wooden blocks!  Try the other way ...</el:english>
-      </el:string> 
-      <el:string el:key="text2">
-        <el:english el:translate="true">Greetings, adventurer!    The road ahead is long and dangerous, so be careful!</el:english>
-      </el:string> 
-      <el:string el:key="text3">
-        <el:english el:translate="true">Well done, adventurer!    Good luck!</el:english>
-      </el:string> 
-      <el:string el:key="text4">
-        <el:english el:translate="true">Congratulations, adventurer!  You did it!</el:english>
-      </el:string> 
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_iv/wb12_2.xml (from rev 1734, trunk/data/levels/enigma_iv/wb12_1.xml)
===================================================================
--- trunk/data/levels/enigma_iv/wb12_1.xml	2009-06-23 00:34:20 UTC (rev 1734)
+++ trunk/data/levels/enigma_iv/wb12_2.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,108 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Big Adventures" el:subtitle="" el:id="wb12"/>
+      <el:version el:score="1" el:release="2" el:revision="1" el:status="released"/>
+      <el:author  el:name="Jon 'WB' Sneyers" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2003 Jon 'WB' Sneyers</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by /dev/null (June 2009)</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_samba"}
+ti["~"] = {"fl_water"}
+ti[","] = {"fl_sand"}
+ti["."] = {"fl_rough"}
+ti[":"] = {"fl_swamp"}
+ti["-"] = {"fl_space"}
+ti["#"] = {"st_granite"}
+ti["*"] = {"st_greengray"}
+ti["+"] = ti["."] .. {"st_break_oxydc"}
+ti["="] = {"st_stoneimpulse"}
+ti["!"] = {"st_stoneimpulse_hollow"}
+ti["X"] = {"st_grate_cross"}
+ti["W"] = {"st_box"}
+ti["w"] = ti["."] .. ti["W"]
+ti["^"] = {"st_oneway", orientation = NORTH}
+ti[">"] = {"st_oneway", orientation = EAST}
+ti["V"] = {"st_oneway", orientation = SOUTH}
+ti["<"] = {"st_oneway", orientation = WEST}
+ti["6"] = {"st_boulder_e"}
+ti["4"] = {"st_boulder_w"}
+ti["triggers"] = {"it_trigger", target = "hurdles%%"}
+ti["doorsEW"] = {"st_door", "hurdles%%", faces = "ew"}
+ti["doorsNS"] = {"st_door", "hurdles%%", faces = "ns"}
+ti["s"] = {"it_spring_drop"}
+ti["t"] = {"it_hammer"}
+ti["x"] = {"it_bomb"}
+ti["y"] = {"it_document", text = "text1"}
+ti["Y"] = {"it_document", text = "text2"}
+ti["z"] = {"it_document", text = "text3"}
+ti["Z"] = {"it_document", text = "text4"}
+ti["O"] = {"st_oxyd"}
+ti["@"] = {"#ac_marble_black"}
+
+wo(res.autotile(ti, {"a", "n", "triggers"}, {"A", "G", "doorsEW"}, {"H", "N", "doorsNS", 8}), " ", {
+    "##########################################################",
+    "#d~~~~~~~~w..+*,,,,>  #     #     #k# #----- ----------#e#",
+    "#~~~~~~~~ww.+*,,,.~#  #     #  ~  # # #----- ----------#-#",
+    "#~~~~~~~ww.+*,,,.~~# W#W #  #  #  # # >  ---W------   -#-#",
+    "#~~~~~~ww.+*,,,.~~~#  W  #     #  ~ # #----- ------   -#-#",
+    "#~~~~~ww.+*,,,.~   #     #     #      #----- ------   ---#",
+    "#~~~~ww.+*,,,.~~ ~ ##############################--------#",
+    "#~~~ww.+*,,,.~   ~ <     ~~~~~~~~~~~~~#         #--------#",
+    "#~~ww.+*,,,.~~ ~~~~#~   ~~   ~~ ~~    # ~~~~~~~~#--------#",
+    "#~ww.+*,,,.~~~    ~#~~ ~~ s ~~ s ~~ s <W  W~W   #--------#",
+    "#ww.+*,,,.~~~~~~~ ~#~~~~   ~~     ~~  #~~ ~~~ ~~#######  #",
+    "#w.+*,,,.~        ~#~~~~~~~~~~~~~~~~~~#         #        #",
+    "#..*+,,,*#V####################################^####VV####",
+    "#...*+,,+#         #O#O###O#O#    Y   # > < > > #      ~ #",
+    "#...+*,,*# W W W   #         #   ### @#^#^#^#V#V#     W~ #",
+    "#..w*+,,+#  W W  # # O#O#O#O #   ###### > < < < #~~~   ~W#",
+    "#..*+,,,*# W W W # #    Z    #WWW## ~~#^#^#V#V#^#i ~~~~~~#",
+    "#.w*,,,*+#X~~#X~~# #O#O   O#O#      ~~> > > > > #  ~   ~ #",
+    "#.+*,,,*.#~~~X~~~# #####^#########  ~~###########  ~ W ~y#",
+    "#.*,,,*..#~X~X~X~# # E # #af X#########j  ~     #~~~ W ~W#",
+    "#.*,,,+..#~~~#~~~# #H#K#L#b      XXXX #  ~~~ WW #~     ~ #",
+    "#.+*,,+*.#~**#~**# #I# D #cg X#X X  X <  ~~~  W #~   ~~W #",
+    "#.*,,,*..#   W   # #J##########XWWWWW # ~~~~ WW #~~~~~~W #",
+    "#.*,,,+..#       #m# A B C F G        #h ~~~    <      WW#",
+    "#.+*,,**.#VV##############################################",
+    "#..+,,,+.#  #n  z# > #---#   #WWW W WW#~~~~~~:::##########",
+    "#..*,,,*.#  ## W # # #-#-# # # WxW Wx #  W  #:::#:::::####",
+    "#..+*,,+.#   ##M##N# #-#-#-# >W W W W > W W #  W>:::::::##",
+    "#..*+,,*.##        #-#-#---############  W  #:::#::::::::#",
+    "#..+*,,+..##########---#####=!!!!!!!!=#~~~~~~:::###::::::#",
+    "#..*,,,*...........#####========!===!=##############:::::#",
+    "#.*+,,+*+*+*+*+*+w.#   #4!!!   =!=!!!=#  ::::::###:::::::#",
+    "#.+*,,,+*+,,,,,,*+*# #       =!=!=!===# #::::::::::::::::#",
+    "#.*+,,,,,,,,,,,,,,,< #######=#!!!=!=!!< #:#::::::::::::###",
+    "#..*+,,,,,+*+*+,,,,< #l    #4#6#=!!=!=###:################",
+    "#..w*+*+*+*...*+*+*###  #4=  #  =!!!!!#:::::::::::::::::t#",
+    "#########################==##=========####################"})
+
+wo:shuffleOxyd()
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+      <el:string el:key="text1">
+        <el:english el:translate="true">Too many wooden blocks!  Try the other way ...</el:english>
+      </el:string>
+      <el:string el:key="text2">
+        <el:english el:translate="true">Greetings, adventurer!    The road ahead is long and dangerous, so be careful!</el:english>
+      </el:string>
+      <el:string el:key="text3">
+        <el:english el:translate="true">Well done, adventurer!    Good luck!</el:english>
+      </el:string>
+      <el:string el:key="text4">
+        <el:english el:translate="true">Congratulations, adventurer!  You did it!</el:english>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Added: trunk/data/levels/enigma_ix/andreas57_1.xml
===================================================================
--- trunk/data/levels/enigma_ix/andreas57_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_ix/andreas57_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,67 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Camel and Needle" el:subtitle="" el:id="andreas57"/>
+      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2009 Andreas Lochmann</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:score el:easy="-" el:difficult="15:38"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl_sand"}
+ti["#1"] = {"st_granite"}
+ti["#2"] = {"st_box_hay"}
+ti["#3"] = {"st_brownmarble"}
+ti["@"] = {"#ac_marble"}
+ti["box"] = {"st_box_hay", "hay%%"}
+ti["trigger"] = {"it_trigger", target = "door%%#*"}
+ti["door"] = {"st_door", "door%%#", faces = "ew"}
+ti["Y"] = {"st_oxyd", oxydcolor = OXYD_BROWN}
+
+w, h = wo(res.random(res.autotile(ti, {"A", "L", "box"}, {"a", "l", "trigger"}, {"M", "X", "door"}),
+                     "#", {"#1", "#2", "#3"}), " ", {
+   "##########################################################",
+   "#                  ####################                  #",
+   "#            c     #######YXWVUTSRQPONM     C        @   #",
+   "#            b a   ####################   A B            #",
+   "#                  ####################                  #",
+   "#       l k        ####################        K L       #",
+   "#        e                                      E        #",
+   "#     d     f      ####################      D     F     #",
+   "#                  ####################                  #",
+   "#                  ####################                  #",
+   "#    g h   i j     MNOPQRSTUVWXY#######     G H   I J    #",
+   "#                  ####################                  #",
+   "##########################################################"
+})
+
+wo:add({"ot_wire", anchor1 = no["hay%1"], anchor2 = no["hay%2"]})
+wo:add({"ot_wire", anchor1 = no["hay%1"], anchor2 = no["hay%3"]})
+wo:add({"ot_wire", anchor1 = no["hay%2"], anchor2 = no["hay%3"]})
+wo:add({"ot_wire", anchor1 = no["hay%2"], anchor2 = no["hay%4"]})
+wo:add({"ot_wire", anchor1 = no["hay%4"], anchor2 = no["hay%6"]})
+wo:add({"ot_wire", anchor1 = no["hay%4"], anchor2 = no["hay%7"]})
+wo:add({"ot_wire", anchor1 = no["hay%4"], anchor2 = no["hay%8"]})
+wo:add({"ot_wire", anchor1 = no["hay%6"], anchor2 = no["hay%9"]})
+wo:add({"ot_wire", anchor1 = no["hay%6"], anchor2 = no["hay%10"]})
+wo:add({"ot_wire", anchor1 = no["hay%4"], anchor2 = no["hay%11"]})
+wo:add({"ot_wire", anchor1 = no["hay%5"], anchor2 = no["hay%11"]})
+wo:add({"ot_wire", anchor1 = no["hay%5"], anchor2 = no["hay%12"]})
+wo:add({"ot_wire", anchor1 = no["hay%6"], anchor2 = no["hay%12"]})
+
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_ix/andreas57_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_ix/andreas58_1.xml
===================================================================
--- trunk/data/levels/enigma_ix/andreas58_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_ix/andreas58_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,158 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Symopal" el:subtitle="" el:id="andreas58"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:author el:name="Andreas Lochmann, Ronald Lamprecht" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2009 Andreas Lochmann, Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libmath" el:id="lib/libmath" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:score el:easy="3:01" el:difficult="7:50"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+wo["ConserveLevel"] = true
+wo["AllowSingleOxyds"] = true
+
+ti[" "] = {"fl_blueslab"}
+ti[","] = {"fl_water", "spot_left#"}
+ti["#"] = {"fl_blueslab", "wall_left#"}
+ti[":"] = {"it_seed", _free = true}
+ti[";"] = {"it_seed", _free = false, flavor = "greenbrown"}
+ti["@"] = {"ac_pearl"}
+ti["#1"] = {"st_flat"}
+ti["#2"] = {"st_plaster"}
+ti["P"] = {"st_oxyd", flavor = "b", oxydcolor = OXYD_WHITE}
+ti["D"] = {"st_door", "doors#", flavor = "c"}
+ti["K"] = {"st_death"}
+
+oxyd_colors = {OXYD_RED, OXYD_BLUE, OXYD_GREEN, OXYD_YELLOW, OXYD_ORANGE, OXYD_PURPLE}
+for j = 1, #oxyd_colors do
+    ti["O" .. oxyd_colors[j]] = ti{"fl_water"} .. {"st_oxyd_e", oxydcolor = oxyd_colors[j], target = "oxyd_callback"}
+end
+
+if wo["IsDifficult"] then
+
+w, h = wo(ti, " ", {
+ -- 01234567890123456789
+   "##########          ",
+   "###      #          ",
+   "##  ,,,,            ",
+   "#  ,,,,,,           ",
+   "#   , ,             ",
+   "#  ,,,,,,           ",
+   "##  ,,,,,           ",
+   "PDD      ,       DDP",
+   "##  ,,,,,           ",
+   "#  ,,,,,,           ",
+   "#  ,,,,,  @         ",
+   "##       #          ",
+   "##########          "
+})
+
+else
+
+w, h = wo(ti, " ", {
+ -- 01234567890123456789
+   "##########          ",
+   "###      #          ",
+   "##  ,,,,            ",
+   "#  ,,,,,,           ",
+   "#                   ",
+   "#  ,,,,,            ",
+   "##  ,,,,,           ",
+   "PDD              DDP",
+   "##  ,,,,,           ",
+   "#  ,,,,,            ",
+   "#         @         ",
+   "##       #          ",
+   "##########          "
+})
+
+end
+----------------------------------------
+--  Fill in oxyds and symmetric wall  --
+----------------------------------------
+
+spots_left = po(no["spot_left#*"]:shuffle())
+colors_left = lib.math.permutation((#spots_left)/2)
+colors_right = lib.math.permutation((#spots_left)/2)
+
+function mirrored_pos(pos)
+    return po(19 - pos.x, pos.y)
+end
+
+for j = 1, (#spots_left)/2 do
+    local color_left = oxyd_colors[colors_left[j] % (#oxyd_colors) + 1]
+    local color_right = oxyd_colors[colors_right[j] % (#oxyd_colors) + 1]
+    wo[spots_left[2*j - 1]] = ti["O" .. color_left]
+    wo[spots_left[2*j]] = ti["O" .. color_left]
+    wo[mirrored_pos(spots_left[2*j - 1])] = ti["O" .. color_right]
+    wo[mirrored_pos(spots_left[2*j])] = ti["O" .. color_right]
+end
+
+for wall in no["wall_left#*"]:shuffle() do
+    local chosen = cond(math.random(5) == 1, "#2", "#1")
+    wo[wall] = ti[chosen]
+    wo[mirrored_pos(po(wall))] = ti[chosen]
+end
+
+----------------------------------
+--  Opal and postinit function  --
+----------------------------------
+
+last_oxyd = 0
+function oxyd_callback(is_on, sender)
+    if sender.state == OXYDPAIR then
+        oxyds = grp(sender, last_oxyd)
+        wo[sender] = ti[":"]
+        fl(sender)._free = true
+        wo[last_oxyd] = ti[";"]
+        fl(last_oxyd)._free = false
+        it(oxyds):grow()
+        no["opal_counter"]:signal(1)
+    elseif sender.state == OPEN then
+        last_oxyd = sender
+    end
+end
+
+function postinit()
+    st(spots_left[1]):peepall()
+end
+
+----------------------------------
+--  Counter and Solution Check  --
+----------------------------------
+
+wo:add({"ot_counter", "opal_counter", ["target_" .. #spots_left] = "counter_callback"})
+
+function counter_callback()
+    local solved = true
+    for j = 1, #spots_left do
+        local left = fl(spots_left[j])._free or false
+        local right = fl(mirrored_pos(spots_left[j]))._free or false
+        solved = solved and (left == right)
+    end
+    if solved then
+        no["doors#*"]:open()
+    else
+        wo[no["doors#*"]] = ti["K"]
+        wo:add(YIN, {"it_document", text = "text1"})
+    end
+end
+
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+      <el:string el:key="text1">
+        <el:english el:translate="true">It's not symmetric!</el:english>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_ix/andreas58_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/data/levels/enigma_ix/index.xml
===================================================================
--- trunk/data/levels/enigma_ix/index.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_ix/index.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,13 +1,18 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="11100" network="false" owner="Enigma Team" release="1" revision="2" title="Enigma IX"/>
+  <info enigma="1.00" group="Enigma" location="11100" network="false" owner="Enigma Team" release="1" revision="3" title="Enigma IX"/>
 
   <attributes/>
 
   <levels>
     <level _seq="1" _title="Welcome" _xpath="./welcometopack9_1" author="Raoul Bourquin" ctrl="force" easy="true" id="welcometopack9" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="2" _title="Su Dyxo" _xpath="./ais33_1" author="Alex Smith" ctrl="force" easy="true" id="20090525ais523001" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="3" _title="Camel and Needle" _xpath="./andreas57_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas57" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="4" _title="Water Galore" _xpath="./ral49_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20090620ral141" rel="1" rev="178" score="1" target="time" unit="duration"/>
+    <level _seq="5" _title="pinnacles1" _xpath="./mecke36_1" author="mecke" ctrl="force" easy="true" id="mecke36" rel="1" rev="15" score="1" target="time" unit="duration"/>
+    <level _seq="6" _title="Symopal" _xpath="./andreas58_1" author="Andreas Lochmann, Ronald Lamprecht" ctrl="force" easy="true" id="andreas58" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="7" _title="The Pilgrim's Progress" _xpath="./pulley14_1" author="Mark Pulley" ctrl="force" easy="false" id="20080101pulley001" rel="2" rev="1" score="2" target="time" unit="duration"/>
   </levels>
 
 </index>

Added: trunk/data/levels/enigma_ix/mecke36_1.xml
===================================================================
--- trunk/data/levels/enigma_ix/mecke36_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_ix/mecke36_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,84 @@
+<?xml version="1.0" encoding="utf-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Pinnacles I" el:subtitle="~on a special chessboard" el:id="mecke36"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision:16 $" el:status="released"/>
+      <el:author el:name="mecke" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2009 Thomas Bernhardt</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:score el:easy="8:42" el:difficult="10:12"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti["  "] = {"fl_abyss"}
+ti["~ "] = {"fl_water"}
+ti["# "] = {"fl_lawn_a"}
+
+if wo ["IsDifficult"] then
+    ti["$ "] = {"fl_space"}
+    ti["! "] = {"fl_redslab"}
+    ti["? "] = {"it_strip_ew"}
+    ti[" ."] = {"it_seed_volcano"}
+    ti[" c"] = {"it_banana"}
+    ti[" !"] = {"st_quake"}
+    ti[" m"] = ti["$ "] .. {"st_rawglass_movable"}
+    ti[" M"] = ti[" m"] .. {"it_cherry"}
+    ti[" X"] = {"it_bottle_broken"}
+    ti[" u"] = ti["$ "] .. {"it_coffee"}
+else
+    ti["! "] = {"fl_hay"}
+    ti[" ."] = {"it_seed_hay"}
+    ti[" c"] = {"it_cherry"}
+    ti[" !"] = {"st_bluesand"}
+    ti["$ "] = {"fl_himalaya"}
+    ti["? "] = {"fl_himalaya"}
+    ti[" X"] = {"it_hammer"}
+    ti[" u"] = ti["$ "] .. {"it_umbrella"}
+    ti[" M"] = ti["# "] .. {"st_yellow"}
+end
+
+ti[" I"] = {"st_stoneimpulse"}
+ti[" D"] = {"st_death"}
+ti[" &"] = {"st_shogun_s"}
+ti[" d"] = {"st_disco_medium"}
+ti[" '"] = ti[" u"] .. {"st_rawglass"}
+ti[" v"] = {"it_puller_s"}
+ti[" Y"] = {"st_oxyd", flavor="b", name="leftoxyd#"}
+ti[" y"] = {"st_oxyd", flavor="b", name="rightoxyd#"}
+ti[" @"] = {"#ac_marble_black"}
+ti["opener1"] = ti["# "] .. {"it_shogun_s", target="doora%%"}
+ti["opener2"] = ti["! "] .. {"it_shogun_s", target="bridgeb%%"}
+ti["over"] = ti[" c"] .. {"fl_bridge_bw", name="bridgeb%%"}
+ti["doorera"] = ti["? "] .. {"st_door", flavor="b", name="doora%%"}
+
+local autotiler = res.autotile(ti, {"i", "opener1"}, {"j", "opener2"}, {"d", "doorera"}, {"e", "over"})
+
+wo(res.composer(autotiler), "  ", {
+    "!!#!!!#!!!#!!!#I!I#!!!#I!I#!!!#!!!#!!!#!",
+    "#!!!i1! i2!!# ! #&! # !&# ! #!j1# j2#!!!",
+    "!!!!!!# !&i3!&# j4# ! i4!&# j3# ! #!!!#!",
+    "#!!!# ! # ! #!! #!! # !!# !!# ! # ! #!!!",
+    "!Yd0e5#!! #!! i5!X# ! #Xj5# !!# !!e9d2#y",
+    "#Yd9e4! #&! #!!&#!!!#!!!# !!# !&# e8d3!y",
+    "!Yd8e3# !!# !@#.$ $v#d M~ #!! #!! e6d4#y",
+    "#Yd6e2!&# ! #!!&#!!!#!!!# !!# ! #&e7d5!y",
+    "!Yd7e1# ! #&!!i6!&# ! #&j6#!!&# ! e0d1#y",
+    "#!!!i8!!# ! $'! # ! # ! # $'# ! #!j8!!!!",
+    "!!# !!i9!&# !!# j7#!!!i7!&#!! #&j9#!! #!",
+    "#!!!# ! i0! # ! #&! # !&# ! # j0# ! #!!!",
+    "!!#!!!#!!!#!!!#I!I#!!!#I!I#!!!#!!!#!!!#!"})
+
+wo:shuffleOxyd({"leftoxyd#*", max=2}, {"rightoxyd#*", max=2})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+      <el:string el:key="subtitle">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_ix/mecke36_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_ix/pulley14_1.xml
===================================================================
--- trunk/data/levels/enigma_ix/pulley14_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_ix/pulley14_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,595 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="The Pilgrim's Progress" el:subtitle="" el:id="20080101pulley001"/>
+      <el:version el:score="2" el:release="2" el:revision="1" el:status="stable"/>
+      <el:author  el:name="Mark Pulley" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 Mark Pulley</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:score el:easy="-" el:difficult="5:17"/>
+    </el:info>
+    <el:luamain><![CDATA[
+-- FLOORS
+ti["  "] = {"fl_lawn_b"} -- dark
+ti[" a"] = {"fl_pinkbumps"} -- Vanity Fair
+ti[" c"] = {"fl_bright"} -- Celestial City
+ti[" d"] = {"fl_brick"} -- City Of Destruction
+ti[" g"] = {"fl_slope_ts", force_y=100} -- Hill Of Difficulty
+ti[" h"] = {"fl_red", burnable=false} -- Hell
+ti[" l"] = {"fl_lawn_a"}
+ti[" p"] = {"fl_tigris"} -- Beautiful Palace
+ti[" q"] = {"fl_space"}
+ti[" v"] = {"fl_slope_ts"} -- Down
+ti[" w"] = {"fl_adhesionless"}
+ti[" A"] = {"fl_fake_abyss"}
+ti[" D"] = {"fl_swamp"} -- Slough of Despond
+ti[" H"] = {"fl_red", eternal=true} -- Hell
+ti[" S"] = {"fl_sand"}
+ti[" T"] = {"fl_sahara"}
+ti[" U"] = {"fl_slope_ps", force_y=100} -- Hill Of Difficulty
+ti[" V"] = {"fl_slope_ts", force_y=400} -- Down GRAVITY
+ti[" W"] = {"fl_water"}
+ti[" 1"] = {"fl_lawn_c1"} -- light. dark at top left
+ti[" 3"] = {"fl_lawn_d1"} -- dark. light at top left
+ti[" 4"] = {"fl_lawn_d2"} -- dark. light at bottom left
+ti[" 5"] = {"fl_lawn_e1"} -- diagonal. dark at top left
+ti[" 6"] = {"fl_slope_tn", force_y=-400} -- Up GRAVITY
+ti[" 7"] = {"fl_lawn_e2"} -- diagonal. dark at bottom left
+ti[" 8"] = {"fl_slope_inw"} -- Up and left
+ti[" 9"] = {"fl_slope_ine"} -- Up and right
+ti[" !"] = {"fl_lawn_c3"} -- light. dark at top right
+ti[" $"] = {"fl_lawn_d4"} -- dark. light at bottom right
+ti[" %"] = {"fl_lawn_e3"} -- diagonal. dark at top right
+ti[" ^"] = {"fl_slope_tn"} -- Up
+ti[" &"] = {"fl_lawn_e4"} -- diagonal. dark at bottom right
+ti[" *"] = {"fl_slope_isw"} -- Down and left
+ti[" ("] = {"fl_slope_ise"} -- Down and right
+ti[" ["] = {"fl_slope_isw", force_x=-400, force_y=400} -- Down and left GRAVITY
+ti[" ]"] = {"fl_slope_ise", force_x=400, force_y=400} -- Down and right GRAVITY
+ti[" {"] = {"fl_slope_inw", force_x=-400, force_y=-400} -- Up and left GRAVITY
+ti[" }"] = {"fl_slope_ine", force_x=400, force_y=-400} -- Up and right GRAVITY
+ti[" |"] = {"fl_plank", burnable=false}
+ti[" <"] = {"fl_slope_tw"} -- Left
+ti[" >"] = {"fl_slope_te"} -- Right
+ti[" ,"] = {"fl_slope_tw", force_x=-400} -- Left GRAVITY
+ti[" ."] = {"fl_slope_te", force_x=400} -- Right GRAVITY
+
+--Meditation items
+ti["g "] = {"it_meditation_hollow"}
+ti["h "] = {"it_meditation_hill"}
+ti["k "] = {"it_meditation_dent"}
+ti["l "] = {"it_meditation_bump"}
+ti["v "] = {"it_nil"}
+
+-- STONES, ITEMS, ACTORS
+ti["a "] = {"st_actorimpulse"}
+ti["b "] = {"st_camouflage"}
+ti["c "] = {"it_crack_l"}
+ti["d "] = {"it_coin_l"} .. ti({"st_invisible"})
+ti["e "] = {"st_oneway", state=EAST}
+ti["f*"] = {"#ac_rotor", range=5, strength=100, name="Lion%%"} -- Lions
+ti["i*"] = {"st_purplemarble", name="LionChain%%"} -- Lion attachments
+ti["j "] = {"st_camouflage", name="Sepulchre"}
+ti["m "] = {"st_volcano", name="Sinai"}
+ti["n "] = {"st_oneway", state=NORTH}
+ti["o "] = {"it_sword"}
+ti["p "] = {"it_umbrella"}
+ti["q "] = {"st_door_d_ew", state=CLOSED, name="DoorI", action="open", target="DoorI"}
+ti["r "] = {"it_flag_black"}
+ti["s "] = {"st_oneway", state=SOUTH}
+ti["t "] = {"st_door_a", name="DoorC", state = OPEN} -- Door to Celestial City
+ti["u "] = {"st_door_a", name="DoorH"} -- Door to Hell
+ti["w "] = {"st_oneway", state=WEST}
+ti["x "] = {"st_key", code="1", action="toggle", target="Door1"} -- opens Celestial City
+ti["y "] = {"st_woven"}
+ti["z "] = {"st_door_a", name="Door1"} -- opens Celestial City
+ti["A "] = {"st_portal_horse"} -- Passage for Burden
+ti["B "] = {"st_camouflage_hollow"}
+ti["C "] = {"st_brick", cluster=1} --City of Destruction
+ti["D "] = {"st_oneway_black", state=EAST}
+ti["E "] = {"it_burnable_burning"} .. ti({"st_invisible"})
+ti["G "] = {"st_redrock"} -- Hell / Vanity Fair
+ti["H "] = {"it_burnable_burning"} -- Hell
+ti["J "] = {"it_cross", action="callback",target="Cross"}
+ti["K "] = {"st_purplemarble"} -- Beautiful Palace
+ti["L "] = {"st_grate_cross"}
+ti["M "] = {"it_sensor", invisible=true, action="toggle", target="Sinai"}
+ti["N "] = {"st_oneway_white", state=NORTH}
+ti["O "] = {"st_key", code="3", action={"callback"}, target={"Promise"}}
+ti["P "] = {"it_key", code="3",name="Key3"}
+ti["Q "] = {"st_door_a", name="Door3"}
+ti["R "] = {"st_invisible"}
+ti["S "] = {"st_yellow"}
+ti["T "] = {"it_brush"}
+ti["U*"] = {"fl_sahara", name = "Horse%%"}
+ti["V "] = {"it_seed_greenbrown"}
+ti["W "] = {"st_box_wood"}
+ti["X "] = {"st_disco_light"}
+ti["Y "] = {"st_disco_medium"}
+ti["Z "] = {"st_oneway_black", state=NORTH}
+ti["1*"] = ti({"it_document", text="text%%"}) .. {"fl_brick"}
+ti["2*"] = ti({"it_document", text="text%%"}) .. {"fl_lawn_a"}
+ti["3*"] = ti({"it_document", text="text%%"}) .. {"fl_sand"}
+ti["4*"] = ti({"it_document", text="text%%"}) .. {"fl_lawn_b"}
+ti["5*"] = ti({"it_document", text="text%%"}) .. {"fl_slope_te", force_x=400}
+ti["6*"] = ti({"it_document", text="text%%"}) .. {"fl_bright"}
+ti["7*"] = ti({"it_document", text="text%%"}) .. {"fl_tigris"}
+ti["8*"] = ti({"it_document", text="text%%"}) .. {"fl_red", burnable=false}
+ti["9*"] = {"it_document", text="text%%"} .. (ti{"st_disco_medium"} .. {"fl_lawn_a"})
+ti["0 "] = {"st_oxyd_e", name="oxyd#"}
+ti["~ "] = {"st_key", code="2", action="toggle", target="Door2"}
+ti["` "] = {"it_key", code="2"}
+ti["- "] = {"st_door_a", name="Door2"}
+ti[") "] = {"it_sensor", invisible=true, action="callback",target="VainHope"} -- Cheat across river - can't get into Celestial City
+ti["_ "] = ti({"st_oneway_black", state=NORTH}) .. {"it_sensor", invisible=true, action="callback",target="MeetHopeful"}
+ti["+ "] = ti({"st_oneway_black", state=NORTH}) .. {"it_sensor", invisible=true, action="callback",target="MeetFaithful"}
+ti["= "] = {"st_scissors"}
+ti["| "] = {"it_squashed"}
+ti[": "] = {"#ac_bug"}
+ti["; "] = {"it_sensor", invisible=true, action="callback",target="ApollyonDefeat"}
+
+local baseresolver  = res.autotile(ti, {"U", "U*"},{"f", "f*"},{"i", "i*"},{"1", "1*"},{"2", "2*"},{"3", "3*"},{"4", "4*"},{"5", "5*"},{"6", "6*"},{"7", "7*"},{"8", "8*"},{"9", "9*"})
+local topresolver  = res.composer(baseresolver)
+
+--      |                   1         1       | 2         2         3         3     |   4         4         5         5   |   5
+--      | 1       5         0         5       | 0         5         0         5     |   0         5         0         5   |   9
+w, h = wo(topresolver, "  ", {
+ "b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b     ",
+ "b  c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c cb     ",--01
+ "b  c c c c c c c c c c c c c c0c c c c c c c c c0c c c c c c c c c0c c c c c c c c c0c c c c c c c c c c c c c c cb     ",
+ "b  c c c c c0c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c0c c c c c cb     ",
+ "b  c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c cb     ",
+ "b  c c c c c c c c c c c c c c0c c c c c c c c c0c c c c c c c c c0c c c c c c c c c0c c c c c c c c c c c c c c cb     ",--05
+ "b  c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c cb     ",
+ "b  c c c c c0c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c c0c c c c c cb     ",
+ "b  c c c c c c c c c c c c c c0c c c c c c c c c0c c c c c c c c c0c c c c c c c c c0c c c c c c c c c c c c c c cb     ",--Celestial City
+ "b  c c c c c c c c c c c c c c c c c c c c c c c c c c c c6w c c c c c c c c c c c c c c c c c c c c c c c c c c cb     ",
+ "b b b b b b b b b b b b b b b b b b b b b b b b b b b  6= t6= b b b b b b b b b b b b b b b b b b b b b b b b b b G G G ",--10
+ "b  . . . . . . . . . . . . . . . . . . . . . . . . .e.W6V, Wu. . . . . . . . . . . . . . . . . . . . . . . . . . .e. VG ",
+ "b n6b b b b b b b b b b b b b b b b b b b b b b b b b x b z6b b b b b b b b b b b b b b b b b b b b b b b b b b b G  VG ",--
+ "b  6b                                                                                                             b  VG ",
+ "b  6b n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n n b  VG ",
+ "b  6b  v v v v v v   v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v vb  VG ",--15
+ "b  6b  v v v v v v   v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v v vb  VG ",
+ "b  6b  W W W W W W   W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W Wb  VG ",
+ "b  6b XWXWXWXWXWXW  XWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWb  VG ",
+ "b  6b YWYWYWYWYWYW) YWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWb  VG ",
+ "b  6b YWYWYWYWYWYW  YWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWYWb  VG ",--20
+ "b  6b XWXWXWXWXWXW  XWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWXWb  VG ",
+ "b  6b  W W W W W W   W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W W Wb  VG ",-- Black River / River Of Death
+ "b  6b             4u                                    4v                                                        b  VG ",
+ "b  6b                                                                       b b b b b b b b b b b b b b b b b b b b  VG ",--
+ "b  6b                                                                          w w w w w w w w w w w w w w w w w wb  VG ",--25
+ "b  6b                                                                          w w w w w w w w w w w w w w w w w wb  VG ",-- Land of Beulah
+ "b  6b                                                                          w w w w w w w w w w w w w w w w w wb  VG ",
+ "b  6b                                                                          w w w w w w w w w w w w w w w w w wb  VG ",
+ "b  6b                                                                          w w w w w w w w w w w w w w w w w wb  VG ",
+ "b  6b                                                   r                 4t l w w w w w w w w w w w w w w w w w wb  VG ",--30
+ "b  6b                                                                        l w w w w w w w w w w w w w w w w w wb  VG ",
+ "b  6b                                                                          w w w w w w w w w w w w w w w w w wb  VG ",
+ "b  6b                                                                          w w w w w w w w w w w w w w w w w wb  VG ",-- Enchanted ground
+ "b  6b                                                                          w w w w w w w w w w w w w w w w w wb  VG ",
+ "b  6b                                                                       b  w w w w w w w w w w w w w w w w w wb  VG ",--35
+ "b  6b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b b                  l2s                b  VG ",--
+ "b  6b                                 b                 b b                 b                  l l                b  VG ",
+ "b  6b                                 b                 b b                 b                5 l l                b  VG ",
+ "b  6b                                 b                 b b                 b              5 l l &                b  VG ",
+ "b  6b              5 l l l l l l l l lwl l2r l l l %             5 l l l l lel l l l l l l l l &                  b  VG ",--40
+ "b  6b              l l l l l l l l l lwl l l l l l l %         5 l l l l l lel l l l l l l l &                    b  VG ",
+ "b  6b              l l &              b            7 l 4     $ l &          b                                     b  VG ",
+ "b  6b              l l                b              7 l l l l &            b                                     b  VG ",--Two paths - left: flatterer (to net), rig ht: correct
+ "b  6b              l l                b                7 l l &              b                                     b  VG ",
+ "b  6b              l l                b                  l l                b                                     b  VG ",--45
+ "b  6b            5 l l                b                  l l                b                                     b  VG ",-- Plain
+ "b  6b            l l &                b                  l l                b                                     b  VG ",
+ "b  6b b b b b b sVsVb b b b b b b b b b                 2q l                b b b b b b b b b b b b b b b b b b b b  VG ",--
+ "b  6b  q q q q q q qw,                             8 ^ ^ ^ ^ ^ ^ 9             8 ^ ^ ^ ^ ^ ^ ^ ^ 9                b  VG ",
+ "b  6b  q q q q q q qw,                             < 8 ^ ^ ^ ^ 9 >             < 8 ^ ^ ^ ^ ^ ^ 9 .                b  VG ",--50
+ "b  6b  q q q q q q qw, 8 ^ ^ ^ ^ ^ 9               < < l l l l > >             < < 8 ^ ^ ^ ^ 9 . .                b  VG ",
+ "b  6b  q q q q q q qw, < 8 ^ ^ ^ 9 >               < < l l l l > >             < < <         . . .                b  VG ",
+ "b  6b  q q q q q q qw, < <       > >               < < l l l l > >             < < <         . . .   8 ^ ^ ^ ^ ^ 9b  VG ",-- Delectable Mountains
+ "b  6b  q q q q q q qw, < <       > >               < < l l l l > >             < < <         . . .   < 8 ^ ^ ^ 9 >b  VG ",
+ "b  6b  q q q q q q qw, < <       > >               < * v v v v ( >             < < <         . . .  EHEHEHEHEHEHEHEH VG ",--55
+ "b  6b  q q q q q q qw, < * v v v ( >               * v v v v v v (             < < * v v v v ( . .      B B B B   e. VG ",
+ "b  6b  q q q q q q qw, * v v v v v (                     l l                   < * v v v v v v ( .  EHEHEHEHEHEHEHEH VG ",
+ "b  6b  q q q q q q qw,                                   l l                   * v v v v v v v v (   < * v v v ( >b  VG ",
+ "b  6b  q q q q q q qw,                                  2p l                                         * v v v v v (b  VG ",
+ "b  6b :}b b b b b b b b b b b b b b b b b b b b b b b b  7 l %b b b b b b b b b b b b b b b b b b b b b b b b b b b  VG ",--60
+ "b  6b :}b B B B b B B B B B B B B B B b               b    7 l l l %                                              b  VG ", -- random it_meditation added after map
+ "b  6b :}b B b B b B b b b b b b b b B b               b            7 %                                            b  VG ",
+ "b  6b :}b B b B b B b B B B B B B B B b               b              7 %                                          b  VG ",
+ "b  6b B B B b B B B b B b b b b b b b b               b      1 l !     l                                          b  VG ",
+ "b  6b B b b b b b b b B B B B B B B B b               b      l   7 l l &                                          b  VG ",--65
+ "b  6b B B B B B B B b B b b b b b b B b               b      l                                                    b  VG ",
+ "b  6b b b b b b b B b B B B B B B b 4owl l %          b      7 %                                                  b  VG ",-- Doubting Castle / By-Path Meadow
+ "b  6b B B B B B B B b b b b b b B b   wl l l %        b        7 l l %                                            b  VG ",
+ "b  6b B b b b b b b B B B B B B B b B b  7 l l l %    b              l                                            b  VG ",
+ "b  6b B b B B B B b B b b b b b b b B b    7 l l l %  b          5 l &                                            b  VG ",--70
+ "b  6b B B B b b B b B B b B B B B B B b        7 l l %b        5 &                                                b  VG ",
+ "b  6b b b b b B B b b B b B b b b b b b n n n n n7nlnlb b b b blb b b b b b b b b b b b b b b b b b b b b b b b b b  VG ",--
+ "b  6b B B B B B b b b B b B B B B B B b            l l l %  v5v&             W W W W W W W       W W W W W W W W Wb  VG ",
+ "b  6b B B B B B Q B b B b b b b b b B b            7 l l l %vl         W W W W W W W W W W W W W W W W W W W W W Wb  VG ",
+ "b  6b B B B B B b B b B B B B B B B B b              7 l l l &       W W W W W W W W W W W W W W W W W W W W W W Wb  VG ",--75
+ "b  6O B B B B B b B b b b b b b b b b b                  l l     W W W W W           W W W W W W W W W            b  VG ",
+ "b  6b b b b b b b B b B B B B B B b B e                52n l   W W W W W                                          b  VG ",-- Pleasant meadow / River of the Water of Life
+ "b  6b B B B B B B B b B b b b b B b B e              5 l l l W W W W W                                            b  VG ",
+ "b  6b B b b b b b b b B b B B B B b B b            5 l l l W W W W W                                              b  VG ",
+ "b  6b B b B B B b B B B b B b B b b B b          5 l l l W W W W W                                                b  VG ",--80
+ "b  6b B b B b B b B b b b B b B b b B b          l l l l W W W W W                                                b  VG ",
+ "b  6b B b B b B b B b B b B b b b b B b          l l l l W W W W W                                                b  VG ",
+ "b  6b B B B b B B B b B B B B B B B B b          l l l l W W W W W                                                b  VG ",
+ "b  6b b b b b b b b b b b b b b b b b b          7 l l l l W W W W                                                b  VG ",--
+ "b  6b                                 b            l l l l W W W W W                                              b  VG ",--85
+ "b  6b    8 ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ 9               7 l l l l W W W W W W                                          b  VG ",
+ "b  6b    < 8 ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ 9 >                 l l l l l W W W W W W W W W                                  b  VG ",-- Hill Lucre
+ "b  6b    < < 8 ^ ^ ^ ^ ^ ^ ^ ^ 9 > >                 7 l l l l       W W W W W W W W W W W                        b  VG ",
+ "b  6b    < < <c c c c c c c c  > > >                   l l l l                 W W W W W W W W W                  b  VG ",
+ "b  6b    < < <c d d d d d d c  > > >                   l l l l                       W W W W W W W W              b  VG ",--90
+ "b  6b    < < <c c c c c c c c  > > >                   l l l l                               W W W W W W          b  VG ",
+ "b  6b    < < * v v v v v v v v ( > >                   l l l l                                     W W W W W      b  VG ",
+ "b  6b    < * v v v v v v v v v v ( >                   l l l l                                       W W W W W    b  VG ",
+ "b  6b    * v v v v v v v v v v v v (                   l2m l l                                         W W W W W Wb  VG ",-- Plain called Ease
+ "=  6b b                               b                l l l l              b                            W W W W Wb  VG ",--95
+ "= N6= G G G G G G G G G G G G G G G G G G G G G G G G G N _ G G G G G G G G G G G G G G G G G G G G G G G G G G G G  VG ",--
+ "=  6D> > > > > > > > > > > > > > > > > > > > > > > > >r>  Z G aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaGaaaaaaaaaG  VG ",
+ "=  6= G G G G G G G G G G G G G G G G G G G G G G G G G G G G aa a a a a a a a a a a a aaa a a aGa a a aGa a a aaaG  VG ",
+ "=  6G aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaa aaa aaa aGa aaa aGa aGa aaaG  VG ",
+ "=  6G aa a a aaa a a aaa a a aaa a a a a a a a a a a a a a a aaa a a a a a aaa a a aaa aaa aaa aGa aaa aGa aGa aaaG  VG ",--100
+ "=  6G aa aaa aaa aaa aaa aaa aaa aaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaa aaa aaa aaa aaa aaa aaa aGa aGa aGa aaaG  VG ",
+ "G  6G aa aaa aaa aaa aaa aaa aaa a a a a a a a a a a a aaa a a aaa a a aaa aaa aaa a a aaa aaa aaa aGa aGa aGa aaaG  VG ",
+ "G  6G aa aaa aaa aaa aaa aaa aaaaaaaaaaaaaaaaaaaaa aaa aaa aaa aaa aaa aaa aaa aaaaaaaaaaa aGa aaa aGa aaa aGa aaaG  VG ",-- Vanity Fair
+ "G  6G aa aaa aaa aaa aaa aaa a a a a a a a a a aaa aaa a a aaa a a aaa a a aaa a a a a a a aGa a a aGa a a aGa aaaG  VG ",
+ "G  6G aa aaa aaa aaa aaa aaaaaaaaaaaaaaaaaaaaa aaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaGaaaaaaaGa aaaG  VG ",--105
+ "G  6 a a aaa a a aaa a a aaa a a a a a a a a a a a aaaG G G G G G G G G G G G aa a a a a a a a a a a a a a a a aaaG  VG ",
+ "G a6aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaG  . .e. . . . . .5l . .e. aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaG  VG ",
+ "G G G G G G G G G G G G G G G G G G G G G G G G G G G G  a aG G G G G G G G G G G G G G G G G G G G G G G G G G G G  VG ",--
+ "b  T T T T T T T T T T T T T T T T T T T T T T T T T T T S S T T T T T T T T T T T T T T T T T T T T T T T T T T Tb  VG ",
+ "b  T T T T T T T T T T T T T T T T T T T T T T T T T T T S S T T T T T T T T T T T T T T T T T T T T T T T T T T Tb  VG ",--110
+ "b  T T T T T T T T T T T T T T T T T T T T T T T T T T T S S T T T T T T T T T T T T T T T T T T T T T T T T T T Tb  VG ",-- Wilderness
+ "b  T T T T T T T T T T T T T T T T T T T T T T T T T T T S S T T T T T T T T T T T T T T T T T T T T T T T T T T Tb  VG ",
+ "b  T T T T T T T T T T T TU1 T T T T T T T T T T T T T T S S T T T T T T T T T T T T T T T T T T T TU2 T T T T T Tb  VG ",
+ "b  T T T T T T T T T T T T T T T T T T T T T T T T T T T S S T T T T T T T T T T T T T T T T T T T T T T T T T T Tb  VG ",-- meets talkative
+ "b  T T T T T T T T T T T T T T T T T T T T T T T T T T T S S T T T T T T T T T T T T T T T T T T T T T T T T T T Tb  VG ",--115
+ "b  T T T T T T T T T T T T T T T T T T T T T T T T T T T S3k T T T T T T T T T T T T T T T T T T T T T T T T T T Tb  VG ",
+ "b  T T T T T T T T T T T T T T T T T T T T T T T T T T T S S T T T T T T T T T T T T T T T T T T T T T T T T T T Tb  VG ",
+ "b  T T T T T TU4 T T T T T T T T T T T T T T T T T T T T S S T T T T T T T T T T T T T TU3 T T T T T T T T T T T Tb  VG ",
+ "b  T T T T T T T T T T T T T T T T T T T T T T T T T T T S S T T T T T T T T T T T T T T T T T T T T T T T T T T Tb  VG ",
+ "b  T T T T T T T T T T T T T T T T T T T T T T T T T T T S S T T T T T T T T T T T T T T T T T T T T T T T T T T Tb  VG ",--120
+ "b                                                        l l                                                      b  VG ",
+ "b                                                        l l                                                      b  VG ",
+ "b                                                        l l                                                      b  VG ",
+ "b                                                        l l                                                      b  VG ",
+ "b                                                        l l                                                      b  VG ",--125
+ "b                                                        l l                                                      b  VG ",
+ "b                                                        l l                                                      b  VG ",
+ "b                                                        l l                                                      b  VG ",-- meets Faithful
+ "b                                                        l l                                                      b  VG ",
+ "b                                                        l l                                                      b  VG ",--130
+ "b                                                       2j l                                                      b  VG ",
+ "b b b b b b b b b b b b b b b b b b b b b b b b b b b b +lNlb b b b b b b b b b b b b b b b b b b b b b b b b b b b  VG ",--
+ "b YlYlYlYlYlYlYlYlYlYlYlYlYWYlYlYlYlYlYlYlYWYWYWYlYlYlYlYlYlYlYlYlYlYlYlYlYlYlY.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y. VG ",
+ "b YlYlYWYWYWYlYlYlYlYWYWYWYWYWYlYlYlYlYWYWYWYWYWYWYlYlYlYlYlYlYlYlYlYWYlYlYlYlY.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y. VG ",
+ "b YlYWYWYWYlYlYlYlYlYlYWYWYWYWYlYlYlYlYlYlYWYWYWYWYlYlYlYlYlYlYWYWYWYWYlYlYlYlY.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y. VG ",--135
+ "b YlYlYWYWYWYWYlYlYlYlYlYlYlYlYlYWYWYWYWYlYlYWYWYlYlYlYlYlYlYlYlYlYWYWYlYlYlYlY.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y. VG ",
+ "b YlYlYlYlYWYWYWYWYlYlYlYlYlYlYlYlYWYWYWYlYlYlYlYlYlYlYWYlYlYlYlYlYlYlYlYWYWYWY.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y. VG ",
+ "b YlYlYlYWYWYWYlYlYlYlYlYWYWYlYlYlYWYlYlYlYlYlYlYlYlYWYWYlYlYlYWYWYlYlYlYWYWYlY.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y. VG ",
+ "b YlYlYlYWYWYWYWYlYlYlYWYWYWYlYlYlYlYlYlYlYWYWYlYlYlYlYWYlYlYWYWYWYWYlYlYlYlYlY.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y. VG ",-- Valley of the Shadow of Death
+ "b YlYlYlYlYlYlYlYlYlYWYWYWYlYlYlYlYlYWYWYWYWYWYlYlYlYlYlYlYlYWYWYlYlYlYlYlYlYlY.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y. VG ",--140
+ "b YWYWYlYlYlYlYlYlYlYWYWYWYWYlYlYlYWYWYWYlYlYlYlYlYlYlYlYlYlYlYlYlYlYlYlYlYlYlY.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y. VG ",
+ "b YlYWYWYWYWYlYlYlYlYlYlYlYlYlYlYlYlYlYWYWYlYlYlYlYWYWYWYlYlYlYlYlYlYWYWYWYlYlY.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y. VG ",
+ "b YlYlYWYWYlYlYlYWYWYWYWYlYlYlYlYlYlYlYWYWYlYlYlYlYWYWYW9iYlYlYlYlYWYWYWYWYWYlY.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y.Y. VG ",
+ "b b b b b b b b b b b b b b b b b b b b b b b b b b b b blblb b b b b b b b b b b b b b b b b b b b b b b b b b b b  VG ",--
+ "b                                                        l l                                                      b  VG ",--145
+ "b                                                        l l                        b b b b b b b b b b           b  VG ",
+ "b                                                        l l                        e> > > > > > > > vb           b  VG ",
+ "b                                                        l l                        b b b b b b b b  vb           b  VG ",
+ "b                                                        l l                                      b  vb           b  VG ",
+ "b                                                        l l                              b b b b b  vb           b  VG ",--150
+ "b                                                        l l                              b  v < < < <b           b  VG ",
+ "b                                                        l l                              b  vb b b b b           b  VG ",-- Valley of Humiliation (Apollyon)
+ "b                                                        l l                              b  vb                   b  VG ",
+ "b                                                        l l                              b  vb b b b b b b b b b b  VG ",
+ "b                                                        l2h                              b  > > > > > > > > > >;>e> VG ",--155
+ "b  ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^b b b b b b b b b b b b b  VG ",--
+ "b  ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^b  VG ",
+ "b  ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^b  VG ",
+ "b  ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^b  VG ",
+ "b  ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^b  VG ",--160
+ "b  ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^b  VG ",-- Slope
+ "b  ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^b  VG ",
+ "b  ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^b  VG ",
+ "b  ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^b  VG ",
+ "b  ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^b  VG ",--165
+ "b  ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^b  VG ",
+ "b  ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^b  VG ",
+ "K K K K K K K K K K K K K K K K K K K K K K K K K K K K  p pK K K K K K K K K K K K K K K K K K K K K K K K K K K K  VG ",--
+ "K  p p p p pK  p p p p p p p p p p p pK  p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p pK  VG ",
+ "K  p p p p pK  p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p pb  p p p p p p p p p p p p p p pb  pK  VG ",--170
+ "K  p pop p pK  p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p pb  p p pb b b b b b b b b  p p pb  pK  VG ",
+ "K  p p p p pK  p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p pb b b  pb  p p p p p p pb  pb b b  pK  VG ",-- Palace called Beautiful
+ "K  p ppp p pK  p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p pb  pb  pb  p p p p p p pb  pb  pb  pK  VG ",
+ "K  p p p p p-p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p pK K K K K K K K K K K K K K K K K K K K  VG ",
+ "K  p ppp p pK  p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p pK  p p p p p p p p p p p p p p p p p pK  VG ",--175
+ "K  p p p p pK  p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p pb b b  p p p p p p p p p p p pK  VG ",
+ "K  p prp p pK  p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p pb b b b b b b b b b b b  p p pK  VG ",
+ "K  p p p p p~  p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p pb  p p p p p pb  p p p p pK  VG ",
+ "K  p p p p pK  p p p p p p p p p p p pK  p p p p p p p p7g p p p p p p p p pK  p p p p p p p p p p p p p p p p p pK  VG ",
+ "K K K K K K K K K K K K K K K K K K K K K K K K K K K K nlnlK K K K K K K K K K K K K K K K K K K K K K K K K K K K  VG ",--180
+ "b B B B b B B B b B B B B B B B B B B b                  l l                b  . . . . . . . . . . . . . . . . . .e. VG ",
+ "b B b B B B b B b B b b b b b b b b B b                  l l                b  6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6b  VG ",
+ "b B b b b b b B b B B B B b B B B B B b                  l l                b  6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6b  VG ",
+ "b B b B B B b B b b b b B b B b b b b b                  l l                b  6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6b  VG ",
+ "b B b B b B b B B B B B B b B B B B B b                  l l                b  6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6b  VG ",--185
+ "b B B B b B b b b B b b b b b b b b B i1      f1         l l        f2      i2 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6b  VG ",-- Lions
+ "b b b B b B b B B B b B B B B B B b B b                  l l                b  6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6b  VG ",
+ "b B B B b B B B b B B B b b b b B b B b                  l l                b  6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6b  VG ",
+ "b B b b b b b b b b b B B B B b B b B b                  l l                b  6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6b  VG ",
+ "b B b B B B b B B B b b b b B b B b B b                  l l                b  6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6b  VG ",--190
+ "b B B B b B B B b B B B B B B b B B B b                  l l                b  6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6b  VG ",
+ "b b b b b b b b b B b b b b b b b b b b b b b b b b b b nlnlb b b b b b b b b  { 6 6 6 } { } 6 6 6 6 { 6 6 6 6 6 }b  VG ",--
+ "b                  l                  b  g g g g g g g g U Ub  V V V V [ , ,b  , { 6 } . [ ] 6 6 6 } , { 6 6 6 } .b  VG ",
+ "b                  7 %                b  g g g g g g g U U Ub  ]       , , ,b  , , S . . { 6 6 6 } . , , { 6 } . .b  VG ",
+ "b                    l                b  g g g g g g U Ub b  ]         , , ,b  , [ V ] . , { 6 } . . , , , S . . .b  VG ",--195
+ "b                    l                b  g g g g g g U                 , , ,b  [ V V V ] , , S . . . , , [ V ] . .b  VG ",--  Way called Destruction
+ "b                    7 %              b  g g g g g g Ub b b b  6 6 6 6 { , ,b  V V V V V , [ V ] . . , [ V V V ] .b  VG ",--  Hill of difficulty
+ "b                      7 %            b  g g g g g g U U g gb  6 6 6 6 6 { ,b  . [ 6 6 6 [ V V V ] 6 6 6 } V V V ]b  VG ",-- Way called Danger
+ "b                        7 %          b  g g g g g g g U g gb b b b b b b b b  . , [ 6 6 6 ] . , , { 6 } . 6 6 6 6b  VG ",
+ "b                          l          b  g g g g g g g U U g g g g g g g g gb  . , , [ 6 ] . . , , , S . . [ 6 6 6b  VG ",--200
+ "b                          l          b  g g g g g g g g U g g g g g g g g gb  . , , , S . . . , , [ V ] . , [ 6 ]b  VG ",
+ "b                          7 %        b  g g g g g g g g U U g g g g g g g gb  . , , { V } . . , [ V V V ] , , S .b  VG ",
+ "b                            7 %      b  g g g g g g g g g U g g g g g g g gb  . , { V V V } . [ V V V V V , { V }b  VG ",
+ "b n n n n n n n n n n n n n n nln n n b  g g g g g g g g g U g g g g g g g gb b n n n5n&n n n n n n n n n n n n n b  VG ",
+ "b                              7 %    w  V V V V V V V V V U V V V V V V V Ve      5 &                            b  VG ",--205
+ "b                                7 l lw% V V V V V V V V U U V V V V V 5 l lel l l &                              b  VG ",
+ "b                                  7 lwl l l % W W W V V U U V V 5 l l l l lel l &                                b  VG ",-- path divides in three
+ "b                                     w7 l l l l l l l l l l l l l l l l l le&                                    b  VG ",
+ "b                                     w      7 l l l l l l l l l l l l &    e                                     b  VG ",
+ "b                                     w            7 l l l2f l l &          e                                     b  VG ",--210
+ "b                                     w               b  l lb               e                                     b  VG ",
+ "b                                     w               b  l lb               e                                     b  VG ",
+ "b                                     w               b  l lb               e                                     b  VG ",-- plain
+ "b                                     w               b  l lb               e                                     b  VG ",
+ "b                                     w               b  l lb               e                                     b  VG ",--215
+ "C C C C C C C C C C C C C C C C C C C C b b b b b b b b nlnlb b b b b b b b C C C C C C C C C C C C C C C C C C C C  VG ",--
+ "C EHEHEHEHEHEHEHEHEHEHEHEHEHEHEHEHEHEHC  S S S S S S S S S S S S S S S S S SC  A A A A A A A A A A A A A A A A A AC  VG ",
+ "C  W W W W W W W W W W W W W W W W W WC  S S S S S S S S SJS S S S S S S S SC  A A A A A A A A`A A A A A A A A A AC  VG ",
+ "C  | | | | | | | | | | | | | | | | | |C  v v v v v v v v v v v v v v v v v vC  A A A A ARARARARARARARARA A A A A AC  VG ",
+ "C  | | | | | | | | | | | | | | | | | |C  v v v v v v v v v v v v v v v v v vC  A A A A ARA A A A A A ARA A A A A AC  VG ",--220
+ "C  | | | | | | | | | | | | | | | | | |C  v v v v v v v v v v v v v v v v v vC  A A A A ARA A A A A A ARA A A A A AC  VG ",
+ "C  | | | | | | | | | | | | | | | | | |C  v v v v v v v v v v v v v v v v v vC  A A A A ARA A A A A A ARA A A A A AC  VG ",
+ "C  | | | | | | | | | | | | | | | | | |C  v v v v v v v v v v v v v v v v v vC  A A A A ARARARARARARARARA A A A A AC  VG ",-- Mt Calvary
+ "C  | | | | | | | | | | | | | | | | | |C  v v v v v v v v v v v v v v v v v vC  A A A A A A A A A A A A A A A A A AC  VG ",
+ "C  | | | | | | | | | | | | | | | | | |C  v v v v v v v v v v v v v v v v v vC  A A A A A A A A A A A A A A A A A AC  VG ",--225
+ "C  | | | | | | | | | | | | | | | | | |C  v v v v v v v v v v v v v v v v v vC  A A A A A A A A A A A A A A A A A AC  VG ",
+ "C  | | | | | | | | | | | | | | | | | |C  v v v v v v v v v v v v v v v v v vC  A A A A A A A A A A A A A A A A A AC  VG ",
+ "C C C C C C C C C  | |C C C C C C C C C ASASASASASASASAS v vASASASASASASASASC C C C C C C SSSS S SSSSSC C C C C C C  VG ",--
+ "C  | | | | | | | | | | | | | | | | | |C b b b b b b b bS    bSB B B B B B B C  A A A ASSSS S S S S S SSSSS A A A AC  VG ",
+ "C  | | | | | | | | | | | | | | | | | |C b b b b b b b bS    bSB B B B B B b C  A ASSSS S S S S S S S S S SSSSS A AC  VG ",--230
+ "C  | |b|b|b| | | | | | | | |b|b|b| | |C b b b b b b b bS    bSB B B B B B b C SSSS S S S S S S S S S S S S S SSSSSC  VG ",
+ "C  | |b|b|b| | | | | | | | |b|b|b| | |C b b b b b b b bS    bSB B B B B B b C  ASS S S S S S S S S S S S S S SSS AC  VG ",
+ "C  | |b|b|b| | | | | | | | |b|b|b| | |C b b b b b b b bS    bSB B B B B B b C  ASS S S S S S S S S S S S S S SSS AC  VG ",
+ "C  | | |b| | | | | | | | | | |b| | | |C b b b b b b b bS    bSB B B B B B b C  ASS S S S S S S S S S S S S S SSS AC  VG ",
+ "C  |P|b|b|b| | | | | | | | |b|b|b| | |C b b b b b b b b     b B B B B B B b C  ASS S S S S S S S S S S S S S SSS AC  VG ",--235
+ "C  |b| |b| |b| | | | | | |b| |b| |b| |C b b b b b b b b     b B B B B B B b C  ASS S S S S S S S S S S S S S SSS AC  VG ",
+ "C  | | |b| | | | | | | | | | |b| | | |C b b b b b b b b     b B B B B B B b C  ASS S S S S S S S S S S S S S SSS AC  VG ",
+ "C  | |b| |b| | | | | | | | |b| |b| | |C b b b b b b b b     b b b b B b b b C RASS S S S S S S S S S S S S S SSSRAC  VG ",
+ "C  |b| | | |b| | | | | | |b| | | |b| |C b b b b b b b b     b b b b j b b C  | S S S S S S S S S S S S S S S S S SC  VG ",
+ "C C C C C C C C C  | |C C C C C C C C C C C C C C C C C  | |C C C C C C C  | | |C C C C C C C C C C C C C C C C C C  VG ",--240
+ "C ||||||||||||||||||||||||||||||||||||C  | | | | | | | | | | | | | | | | | | |C  ] ] V V [ S S SMS [ V V V V [ [ [b  VG ",
+ "C ||||||||||||||||||||||||||||||||||||C  | | | | | | | | | | | | | | | | | |C  ] ] ] S S S S { 6MSMS VMSMSMS [ [ ,b  VG ",
+ "C ||||||||||||||||||||||||||||||||||||C  | | | | | | | | | | | | | | | | | |C  ] ] S S { 6 { { 6 }MSMSMS }MSMS , ,b  VG ",-- Interpreter's House
+ "C ||||||||||||||||||||||||||||||||||||C  | | | | | | | | | | | | | | | | | |C  . S S { { , , { 6 } 6 6 6 } .MS , ,b  VG ",
+ "C |||||||||||||||||||||||||||||||||||| | | | | | | | | | | | | | | | | | | |C  . S , , , , , , S . . . . . .MS [ [b  VG ",--245
+ "C |||||||||||||||||||||||||||||||||||| | | | | | | | | | | | | | | | | | | |C  . S S , , , , [ V ] . . . . .MSMS [b  VG ",
+ "C |||||||||||||||||||||||||||||||||||| | | | | | | | | | | | | | | | | | | |C  . . S , , , [ V V V ] . . . . .MSMSL. VG ",
+ "C ||||||||||||||||||||||||||||||||||||C  | | | | | | | | | | | | | | | | | |C  . S S , , [ V V V V V ] . . . } 6 6A. VG ",
+ "C ||||||||||||||||||||||||||||||||||||C  | | |b|b|b| | | | | | | | | | | | |C  . S , , , S S S S [ [ [ [ [ . 6 6 6A. VG ",
+ "C ||||||||||||||||||||||||||||||||||||C  | | |b|b|b|b|b|b|b|b|b|b|b|b| | | |C  . S S S V S 6 6 S S S [ [ [ [ } } }A. VG ",--250
+ "C ||||||||||||||||||||||||||||||||||T|C  | | | | |b| | | | | |b| | | | | | |C  } } } S S S 6 6 6 6 S S [ [ [ [ } }A. VG ",
+ "C C C C C C C C C  | | |C C C C C C C C C C C C C C C C C C C C C C C C C C C  } } } 6 6 6 6 6 6 6 } S [ [ [ [ [ }A. VG ",--
+ "C  | | | | | | | | | | | | | | | | | |C          l l                        b  6 6 6 6 6 6 6 6 6 } . S S S [ [ [ [A. VG ",
+ "C  | | |S| |S| |S| | | | | | | | | | |C 4d       l l %                      b  6 6 , , , , { 6 } . . . . S S [ [ [b  VG ",
+ "C  | | |S|S|S|S|S| | | | | | | | | | |q|         7 l l                      b  6 6 , , , , ,m  . . . . . . S S , ,b  VG ",--255
+ "C  | | | |b|b|b| | | | | | | | | | | |C            l l %                    b  V V V V [ , ,m  . . . . . . . S , ,b  VG ",
+ "C  | | | |b|b|b| | | | | | | | | | | |C            7 l l                    b  V V V V [ , [ V ] . . . . S S S , ,b  VG ",
+ "C  | | | | |b| | |K|K| | | | | | | | |C b b b b b y LlLly b b b b b b b b b b  V V V , , [ V V V ] . . S S { { { ,b  VG ",-- Wicket Gate
+ "C  | | |b|b|b|b|b|K|K| | | | | | | | |C              l l                   5Ll S S S , [ V V V V V ] S S { { { { {b  VG ",
+ "C  | | | | |b| | | | | | | | | | | | |C              l l %               5 &b      S S V V V V V V S S { { { { { {b  VG ",--260
+ "C  | | | |b|b|b| | | | | | | | | | | |C              7 l l           5 l &  b        S S V V S S S S { { { { { { {b  VG ",-- Mt Sinai
+ "C  | | | |b| |b| | | | | | | | | | | |C                l l 4 $ l l l &      b          S S S S { 6 6 { { { { { { {b  VG ",
+ "C  | | | |b| |b| | | | | | | | | | | |C                7 l l l l &          b                    { 6 6 { { { { { {b  VG ",
+ "C C C C C C C C C C C C C C C C C C C C                  l l &              b b b b b b b b b b b b b b b b b b b b  VG ",--
+ "C 1a d d d d d d d d d dC  d d d d d dC                  l l                                             W W W W Wb  VG ",--265
+ "C  d dC C C C C C C C  dC  dC C C C  dC  D D D D D D D D D D D D D D D D D D D D D D D D D D D D D D D D W W W D Db  VG ",
+ "C  dC  d d dC  d d d d dC  d d d dC  dC  D D W W D D W W W D D D D D D D D D D D D D D D D D D W W D D D D D D D Db  VG ",
+ "C  dC  dC  dC C C C C C C  dC C  dC  dC  W W W W D D D D D D D W W W D D D D W W D D D D D D D D W W W D D D D D Db  VG ",
+ "C  dC  dC  dC  d d d d d d d dC  dC C C  D D D D D D D D D D D D W W D D D D W W D D D D D D D D W W W D D D D D Db  VG ",
+ "C  dC  dC  dC  dC C C C C C  dC  d d dC  D D D D D D D D W W D D D D D D D W W W D D D D D D D W W W D D D D D D Db  VG ",--270
+ "C  dC  dC  dC  dC  d d d d d dC  dC  dC  D D D W W W D D D D D D D D D D D D D D D D D D D D D D D D D D D D D D Db  VG ",-- slough of despond
+ "C  dC  dC  dC  dC  dC C C C C C  dC  dC  D D D W W W W D D D D D W W D W D D D D D D D W W D D D D D D D D D D D Db  VG ",
+ "C  d d dC  dC  dC  dC  d d d d d dC  dC  D D D W D D D D D D D D D W W W D D D D D D D W W W W D D D D D D D D D Db  VG ",
+ "C C C C C  dC  dC  dC  dC C C C C C  dC  D D D D D D D D D D D D D D D D D D D D D D D D D W W D D D D D D D D D DeV VG ",
+ "C  d d d d dC  dC  dC  d d d d d dC  dC                 2c l                                                      AS VG ",--275
+ "C  dC C C C C  dC  dC C C C C C  dC  dC                  l l                G G G G G G G G G G G G G G G G G G G sV VG ",--
+ "C  dC  d d d d dC  d d d d d dC  dC  dC                $ l &                G  h h h h h h h hLhLhLhLhLh h h8x h h h ,G ",
+ "C  dC  dC C C C C C C C C C  dC  dC  dC                l l                  G  hG G G G G G G G G G G G G G = = = = n6G ",
+ "C  dC  dC  d d d d d d d dC  dC  dC  dC              5 l l                  G  h h h h hHH h h h h h h h h h h h hG  6G ",-- plain
+ "C  dC  dC  dC C C C C C  dC  dC  dC  dC              l l 3                  G HHHHHHHH hHH hHHHHHHHHHHHHHHHHHHHH hG  6G ",--280
+ "C  dC  d d d dC  d d d d dC  dC  dC  dC              l l                    G  h h h h hHH hHH h h h h h h h hHH hG  6G ",
+ "C  dC C C C  dC  dC C C C C  dC  dC C C C C C C C C  l lC C C C C C C C C C G  hHHHHHHHHHH hHH hHHHHHHHHHHHH hHH hG  6G ",
+ "C  d d d d d dC  dC  d d dC  dC  d d d d d d d d dC  l lC  d d d d dC  d d dG  hHH h h hHH hHH h h h h h hHH hHH hG  6G ",
+ "C C C C C C C C  dC  dC  dC  dC C C C C C C C C C C  l2bC  dC C C C C  dC  dG  hHH hHH hHH hHHHHHHHHHHHH hHH hHH hG  6G ",
+ "C  d d d d d d d dC  dC  dC  d d d d d d d d d d d d d dC  d d d d d d dC  dG  hHH hHH hHH h h h h h h h hHH hHH hG  6G ",--285
+ "C  dC C C C C C C C  dC  dC C C C C C C C C C C C C C C C C C C C C C C C  de  hHH hHH hHHHHHHHHHHHHHHHHHHHH hHH hG  6G ",
+ "C  d d d d d d d d d dC  d d d d d d d d d d d d d d d d d d d d d d d d d dAS h h hHH h h h h h h h h h h h hHH he. 6G ",--city of destruction
+ "C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C C G G G G G G G G G G G G G G G G G G G G G G "})--288
+--      |                   1         1       | 2         2         3         3     |   4         4         5         5   |   5
+--      | 1       5         0         5       | 0         5         0         5     |   0         5         0         5   |   9
+
+
+
+--Meditation items
+  wo:drawMap(res.random(ti, "v ", {"v ", "g ", "h ", "k ", "l "}), po(28,60), "  ", {
+ "v v                                                       ",--60
+ "v v v v v v v v v v v v v v v v v v v v v v v v v v v v v ",
+ "v v v v v v v v v v v v v v v v v v v v v v v v v v v v v ",
+ "v v v v v v v v v v v v v v v v v v v v v v v v v v v v v ",
+ "v v v v v v v v v v v v v v v v v v v v v v v v v v v v v ",
+ "v v v v v v v v v v v v v v v v v v v v v v v v v v v v v ",--65
+ "v v v v v v v v v v v v v v v v v v v v v v v v v v v v v ",
+ "v v v v v v v v v v v v v v v v v v v v v v v v v v v v v ",
+ "v v v v v v v v v v v v v v v v v v v v v v v v v v v v v ",
+ "v v v v v v v v v v v v v v v v v v v v v v v v v v v v v ",
+ "v v v v v v v v v v v v v v v v v v v v v v v v v v v v v ",--70
+ "v v v v v v v v v v v v v v v v v v v v v v v v v v v v v ",
+ "                                                          ",--
+ "    v v                                                   ",
+ "    v                                                     "})
+
+if wo["CreatingPreview"] then
+  wo[{29, 5.5}] = {"ac_marble_black"}
+  wo[{26.5, 5.5}] = {"ac_marble_white"}
+  wo[{31.5, 5.5}] = {"ac_marble_white"}
+end
+
+wo[no["Key3"]] = ti({"st_chameleon"})
+
+wo[{2.5, 265.5}] = {"ac_marble_black", name="Christian"}
+wo[{2.5, 266.5}] = {"ac_horse", name="Burden"}
+wo[{1.5, 150.5}] = {"ac_rotor", name="Apollyon", range=30, gohome=0, strength=20, attacknearest = true}
+wo[{29.5, 130.5}] = {"ac_marble_white", name="Faithful"}
+wo[{29.5, 117.5}] = {"ac_horse", strength=10, destination={"Horse%1", "Horse%2", "Horse%3", "Horse%4"}}
+wo[{28.5, 96.5}] = {"ac_marble_white", name="Hopeful"}
+wo[{48.5, 221.5}] = {"ac_top", range=10,gohome=0,strength=100}
+
+wo:add({"ot_rubberband", anchor1="Burden", anchor2="Christian", length=1, strength=20, max=1.05, min=0.95})
+wo:add({"ot_rubberband", anchor1="Lion%1", anchor2="LionChain%1", length=4, strength=20, max=8, min=3.95})
+wo:add({"ot_rubberband", anchor1="Lion%2", anchor2="LionChain%2", length=4, strength=20, max=8, min=3.95})
+
+wo:shuffleOxyd()
+no["oxyd#*"][1]:peepall()
+
+wo["WaterSinkTime"] = 10
+wo["Fragility"] = 1
+
+function Cross()
+  wo[{29, 217}] = {"it_key", code="1"} -- opens Celestial City
+  wo[{38, 218}] = {"st_scissors", action="callback", target="RemoveBurden"}
+  wo[{28, 218}] = {"it_document", text="text%e"}
+end
+
+function ApollyonDefeat()
+  wo[{28, 144}] = {"st_oneway", state=NORTH}
+  wo[{29, 144}] = {"st_oneway", state=NORTH}
+end
+
+function RemoveBurden()
+  wo:add({"ot_rubberband", anchor1="Burden", anchor2="Sepulchre", length=1, strength=100, max=1.05, min=0.95})
+end
+
+function VainHope() -- Cheat across river - can't get into Celestial City
+  no["DoorC"]:message("close")
+  no["DoorH"]:message("open")
+  wo[{29, 11}] = {"fl_slope_te", force_x=100}
+  wo[{29, 12}] = {"fl_slope_tn", force_y=-100}
+end
+
+function Promise() -- Opening passage using key called Promise
+  no["Door3"]:message("open")
+  wo:drawRect(po(28,72), po(56,72), ti({"st_oneway", state=NORTH}))
+end
+
+function MeetFaithful()
+  wo:add({"ot_rubberband", anchor1="Christian", anchor2="Faithful", length=1, strength=20, max=1.05, min=0.95})
+end
+
+function MeetHopeful()
+  wo:add({"ot_rubberband", anchor1="Christian", anchor2="Hopeful", length=1, strength=20, max=1.05, min=0.95})
+end
+
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+      <el:string el:key="subtitle">
+        <el:english el:translate="false">Story by John Bunyan</el:english>
+      </el:string>
+      <el:string el:key="text%a">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">I your dear friend am in myself undone, by reason of a Burden that lieth hard upon me.</el:english>
+      </el:string>
+      <el:string el:key="text%b">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">Do you see yonder Wicket Gate?</el:english>
+      </el:string>
+      <el:string el:key="text%c">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">They drew nigh to a very miry Slough. The name of the Slough was Despond.</el:english>
+      </el:string>
+      <el:string el:key="text%d">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">Knock, and it shall be opened unto you.</el:english>
+      </el:string>
+      <el:string el:key="text%e">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">His Burden loosed from off his shoulders, and fell from his back, and began to tumble, and so continued to do, till it came to the mouth of the Sepulchre, where it fell in, and I saw it no more.</el:english>
+      </el:string>
+      <el:string el:key="text%f">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">They came to the foot of the hill Difficulty.</el:english>
+      </el:string>
+      <el:string el:key="text%g">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">There was a very stately palace before him, the name of which was Beautiful.</el:english>
+      </el:string>
+      <el:string el:key="text%h">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">He had gone but a little way, before he espied a foul Fiend coming over the field to meet him.</el:english>
+      </el:string>
+      <el:string el:key="text%i">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">At the end of this Valley was another, called, The Valley of the Shadow Of Death.</el:english>
+      </el:string>
+      <el:string el:key="text%j">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">He saw Faithful before him on his Journey.</el:english>
+      </el:string>
+      <el:string el:key="text%k">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">As they went on, Faithful, as he chanced to look to one side, saw a man whose name was Talkative.</el:english>
+      </el:string>
+      <el:string el:key="text%l">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">They presently saw a Town before them, and the name of that Town is Vanity.</el:english>
+      </el:string>
+      <el:string el:key="text%m">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">Christian went not forth alone; for there was one whose name was Hopeful who joined himself unto him.</el:english>
+      </el:string>
+      <el:string el:key="text%n">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">There was on the Left Hand of the road a Meadow, and a Stile to go over into it, and that meadow is called By-Path-Meadow.</el:english>
+      </el:string>
+      <el:string el:key="text%o">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">Now there was, not far from the place where they lay, a castle, called Doubting-Castle, the owner of which was Giant Despair.</el:english>
+      </el:string>
+      <el:string el:key="text%p">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">They went then till they came to the Delectable Mountains.</el:english>
+      </el:string>
+      <el:string el:key="text%q">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">Beware of the Flatterer.</el:english>
+      </el:string>
+      <el:string el:key="text%r">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan - exact quote is 'Follow me, said the man, it is thither that I am going' - a couple of words have been changed to make sense out of context." el:translate="true">Follow me, said the Flatterer, it is to the Coelestial City that I am going.</el:english>
+      </el:string>
+      <el:string el:key="text%s">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">They came into a certain Country, whose air naturally tended to make one drowzy.</el:english>
+      </el:string>
+      <el:string el:key="text%t">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">The Pilgrims were got over the Enchanted ground, and entering into the Country of Beulah.</el:english>
+      </el:string>
+      <el:string el:key="text%u">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">There was then in that place one Vain-Hope, a ferryman, that with his boat helped him over.</el:english>
+      </el:string>
+      <el:string el:key="text%v">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">At the sight therefore of this River, the Pilgrims were much astounded, but the men that went with them, said, You must go through, or you cannot come at the Gate.</el:english>
+      </el:string>
+      <el:string el:key="text%w">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan." el:translate="true">I looked in after them; and behold the City shone like the Sun.</el:english>
+      </el:string>
+      <el:string el:key="text%x">
+        <el:english el:comment="Quote from 'The Pilgrim's Progress' by John Bunyan - quote taken from the section of the Shepherds in the Delectable Mountains" el:translate="true">They also thought they heard there a rumbling noise, as of fire, and a Cry of some tormented, and that they smelt the scent of Brimstone.</el:english>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_ix/pulley14_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_ix/ral49_1.xml
===================================================================
--- trunk/data/levels/enigma_ix/ral49_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_ix/ral49_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,82 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title ="Water Galore" el:subtitle="Variations on a theme by Ray Wick" el:id="20090620ral141"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 178 $" el:status="released"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2009 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+        <el:credits el:showinfo="true" el:showstart="false">Thanks to Ray for his inspiring "Doors Galore".</el:credits>
+      </el:comments>
+      <el:score el:easy="5:35" el:difficult="5:05"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = false
+wo["ProvideExtralifes"] = false
+
+ti["  "] = {"fl_ivory", friction=4.0, adhesion=1.8}
+ti[" ~"] = {"fl_water"}
+ti[" -"] = cond(wo["IsDifficult"], ti[" ~"], ti["  "])
+ti["f "] = {"it_floppy"}
+ti["g "] = cond(wo["IsDifficult"], ti["f "], ti["  "])
+ti["? "] = {"it_coin_s"}
+ti["x "] = {"it_bomb_black"}
+ti["d "] = {"it_dynamite"}
+ti["* "] = {"st_oxyd"}
+ti["*1"] = {"st_oxyd", "oxydA#"}
+ti["*2"] = {"st_oxyd", "oxydB#"}
+ti["# "] = {"st_brick", cluster=1}
+ti["+ "] = cond(wo["IsDifficult"], {"st_box_wood"}, {"st_box_hay"})
+ti["e "] = cond(wo["IsDifficult"], ti["  "], ti["+ "] .. ti["f "])
+ti["E "] = cond(wo["IsDifficult"], ti["+ "] .. ti["f "], ti["  "])
+ti["! "] = {"st_stoneimpulse"}
+ti["> "] = {"st_oneway_e"}
+ti["< "] = {"st_oneway_w"}
+ti["@ "] = {"#ac_marble"}
+
+ti["%6"] = {"st_coinslot", target={"door%6", "door%3"}}
+ti["t "] = {"it_trigger", target="door%0"}
+ti["l "] = cond(wo["IsDifficult"], ti["# "], {"st_laser_s", "laser"})
+ti["s "] = cond(wo["IsDifficult"], ti["# "], {"st_switch", target="laser"})
+ti["L "] = cond(wo["IsDifficult"], {"st_laser_e", "laser"}, ti["# "])
+ti["S "] = cond(wo["IsDifficult"], {"st_switch", target="laser"}, ti["# "])
+
+ti["doorsh"]  = {"st_door_d", "door%%", faces="ns"}
+ti["doorsv"]  = {"st_door_d", "door%%", faces="ew"}
+ti["floppys"] = {"st_floppy", target="door%%"}
+ti["locks"]   = {"st_key", code="%%", target="door%%"}
+ti["keys"]    = {"it_key", code="%%"}
+
+local myres = res.autotile(res.composer(ti), {"=", "doorsh"}, {"|", "doorsv"},
+    {"%", "floppys"}, {"L", "locks"}, {"K", "keys"})
+
+wo(myres, "  ", {
+    "# *2# # # s # l # # # # # # # # # # * # ",
+    "# =3#  ~ ~ ~ ~ ~t   |0*2#   >   # L2=1# ",
+    "#  - ~ ~ ~ - ~ ~ ~ ~# # # =5#   %4    %6",
+    "#            ~ ~ ~ ~ ~ ~ ~  %5  %8  %7# ",
+    "# K2+ + +    ~ ~ ~ ~ ~ ~*   # =4#   |7*1",
+    "L e        - ~ ~ ~!  ~ ~+   !   # =8# # ",
+    "# E   K1   ~ ~ ~ ~ ~ ~ ~ ~  !       S # ",
+    "#    ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~  # + ? ? ? # ",
+    "#    ~ ~ ~*  ~ ~f  ~ ~  @   # ? ? +   # ",
+    "#    ~ ~ ~ ~ ~ ~    +   +   # # #     # ",
+    "#    ~ ~ ~ ~ ~ ~    + + +   |6  # =9%9# ",
+    "#   >   g + x d           + #   <   |2* ",
+    "# * # # # # # # # # # # ! ! # # # L1# # "
+})
+
+if wo["IsDifficult"] then
+    wo:shuffleOxyd({"oxydA#*", "oxydB#*", min=1})
+else
+    wo:shuffleOxyd()
+end
+    ]]></el:luamain>
+    <el:i18n>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_ix/ral49_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/data/levels/enigma_tutorial/index.xml
===================================================================
--- trunk/data/levels/enigma_tutorial/index.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_tutorial/index.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10100" network="false" owner="Enigma Team" release="1" revision="23" title="Tutorial"/>
+  <info enigma="1.00" group="Enigma" location="10100" network="false" owner="Enigma Team" release="1" revision="24" title="Tutorial"/>
 
   <attributes/>
 
@@ -47,7 +47,7 @@
     <level _seq="39" _title="Light Switches" _xpath="enigma_i/martin08_2" author="Martin Hawlisch" ctrl="force" easy="true" id="martin08" rel="2" rev="2" score="2" target="time" unit="duration"/>
     <level _seq="40" _title="- Meditation -" _xpath="enigma_i/siegfried33_2" author="Siegfried Fennig" ctrl="force" easy="false" id="meditation1" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="41" _title="Mirror Room" _xpath="enigma_i/luc12_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc12" rel="2" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="42" _title="Sokoban Revival" _xpath="enigma_i/martin04_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin04" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="42" _title="Sokoban Revival" _xpath="enigma_i/martin04_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin04" rel="2" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="43" _title="Mirror Room II" _xpath="enigma_i/luc17_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc17" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="44" _title="Mission Impossible" _xpath="enigma_i/martin14_1" author="Martin Hawlisch" ctrl="force" easy="true" id="martin14" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="45" _title="Brittle Planks" _xpath="enigma_i/martin92_2" author="Martin Hawlisch" ctrl="force" easy="true" id="martin92" rel="2" rev="1" score="2" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_vi/andreas28_2.xml
===================================================================
--- trunk/data/levels/enigma_vi/andreas28_2.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_vi/andreas28_2.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,60 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Dancing on Light Beams" el:subtitle="" el:id="andreas28"/>
-      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
-      <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2006, 2009 Andreas Lochmann</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="1.10">
-      </el:compatibility>
-      <el:modes el:easy="true" el:single="true" el:network="false"/>
-      <el:comments>
-      </el:comments>
-      <el:score el:easy="01:08" el:difficult="01:19"/>
-    </el:info>
-    <el:luamain><![CDATA[
-
-ti[" "] = {"fl_stone"}
-ti["#"] = {"st_concrete"}
-ti["B"] = {"st_polarswitch"}
-ti["L"] = {"st_lightpassenger"}
-ti["M"] = {"st_stoneimpulse_movable"}
-ti["S"] = {"st_laser", orientation = SOUTH, state = ON}
-ti["N"] = {"st_laser", orientation = NORTH, state = ON}
-ti["E"] = {"st_laser", orientation = EAST, state = ON}
-ti["W"] = {"st_laser", orientation = WEST, state = ON}
-ti["O"] = {"st_oxyd", flavor = "b"}
-ti["@"] = {"#ac_marble", adhesion = 1.7}
-
-if wo["IsDifficult"] then
-    ti["s"] = ti[" "]
-else
-    ti["s"] = {"it_spring_keep"}
-end
-
-wo(ti, " ", {"##S##S##############",
-             "# B  B             #",
-             "#          BW  S S #",
-             "#  S B         B B #",
-             "#  B Ls@  EB       #",
-             "EB        B    B   #",
-             "#            B    BW",
-             "#    B  B       BBW#",
-             "#EB           B    #",
-             "#       B   B      #",
-             "########N###N####  #",
-             "#M M M M M M M M  BW",
-             "##########OOOOOO####"})
-
-wo:shuffleOxyd()
-
- ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_vi/andreas28_3.xml (from rev 1759, trunk/data/levels/enigma_vi/andreas28_2.xml)
===================================================================
--- trunk/data/levels/enigma_vi/andreas28_2.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_vi/andreas28_3.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -0,0 +1,61 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Dancing on Light Beams" el:subtitle="" el:id="andreas28"/>
+      <el:version el:score="2" el:release="3" el:revision="3" el:status="released"/>
+      <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2006, 2009 Andreas Lochmann</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="01:08" el:difficult="01:19"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+ti[" "] = {"fl_stone"}
+ti["#"] = {"st_concrete"}
+ti["B"] = {"st_polarswitch"}
+ti["L"] = {"st_lightpassenger"}
+ti["M"] = {"st_stoneimpulse_movable"}
+ti["D"] = {"st_death_movable"}
+ti["S"] = {"st_laser", orientation = SOUTH, state = ON}
+ti["N"] = {"st_laser", orientation = NORTH, state = ON}
+ti["E"] = {"st_laser", orientation = EAST, state = ON}
+ti["W"] = {"st_laser", orientation = WEST, state = ON}
+ti["O"] = {"st_oxyd", flavor = "b"}
+ti["@"] = {"#ac_marble", adhesion = 1.7}
+
+if wo["IsDifficult"] then
+    ti["s"] = ti[" "]
+else
+    ti["s"] = {"it_spring_keep"}
+end
+
+wo(ti, " ", {"##S##S##############",
+             "# B  B             #",
+             "#          BW  S S #",
+             "#  S B         B B #",
+             "#  B Ls@  EB       #",
+             "EB        B    B   #",
+             "#            B    BW",
+             "#    B  B       BBW#",
+             "#EB           B    #",
+             "#       B   B      #",
+             "########N###N####  #",
+             "#              D  BW",
+             "##########OOOOOO####"})
+
+wo:shuffleOxyd()
+
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_vi/index.xml
===================================================================
--- trunk/data/levels/enigma_vi/index.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_vi/index.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10700" network="false" owner="Enigma Team" release="1" revision="46" title="Enigma VI"/>
+  <info enigma="1.00" group="Enigma" location="10700" network="false" owner="Enigma Team" release="1" revision="47" title="Enigma VI"/>
 
   <attributes/>
 
@@ -49,7 +49,7 @@
     <level _seq="41" _title="Laserpowered" _xpath="./raoul20_2" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul20" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="42" _title="Basketball" _xpath="./ral03_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20060213ral005" rel="2" rev="43" score="2" target="time" unit="duration"/>
     <level _seq="43" _title="Edwards Mountain" _xpath="./edward11_1" author="Edward" ctrl="force" easy="true" id="edward11" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="44" _title="Dancing on Light Beams" _xpath="./andreas28_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas28" rel="2" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="44" _title="Dancing on Light Beams" _xpath="./andreas28_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas28" rel="3" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="45" _title="Wormhole Madness!" _xpath="./edward24_1" author="Edward" ctrl="force" easy="false" id="edward24" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="46" _title="Alcatraz" _xpath="./ralf14_2" author="Ralf Westram" ctrl="force" easy="true" id="ralf14" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="47" _title="Chess, Bugs &amp; Rock'n'Roll" _xpath="./andreas31_2" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas31" rel="2" rev="12" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_viii/ais06_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ais06_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_viii/ais06_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Transforming Numbers" el:subtitle="" el:id="20090406ais523002"/>
-      <el:version el:score="1" el:release="1" el:revision="4" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="5" el:status="released"/>
       <el:author  el:name="Alex Smith" el:email="ais523 at bham.ac.uk" el:homepage=""/>
       <el:copyright>Copyright ? 2009 Alex Smith</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -340,7 +340,6 @@
     -- Work out the new number as digits
     local di1 = dform[i1]
     local di1d = lib.math.digits(v3,10)
-    if v3 == 0 then di1d = {0} end -- Work around a lib.math.digits bug
     for j = 1, #di1 do
         if #di1 - j < #di1d then
             setdigit(di1[j],di1d[#di1-j+1],false)

Modified: trunk/data/levels/enigma_viii/andreas47_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/andreas47_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_viii/andreas47_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="The Show Jumper" el:subtitle="" el:id="andreas47"/>
-      <el:version el:score="1" el:release="1" el:revision="11" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="12" el:status="released"/>
       <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Andreas Lochmann</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -145,20 +145,20 @@
   end
 end
 
-for y, line in pairs(floor_plus) do
-  for x, ways in pairs(line) do
+for y, line in ipairs(floor_plus) do
+  for x, ways in ipairs(line) do
     if ways >= 0 then
-      local dirs = lib.math.digits(ways, 2)
+      local dirs = lib.math.digits(ways, 2, true)
       local rx, ry = 2*x+y-4, 2*y-x+3
       add_dirs(rx, ry, dirs)
     end
   end
 end
 
-for y, line in pairs(floor_percent) do
-  for x, ways in pairs(line) do
+for y, line in ipairs(floor_percent) do
+  for x, ways in ipairs(line) do
     if ways >= 0 then
-      local dirs = lib.math.digits(ways, 2)
+      local dirs = lib.math.digits(ways, 2, true)
       local rx, ry = 2*x-y+5, 2*y+x-8
       add_dirs(rx, ry, dirs)
     end

Modified: trunk/data/levels/enigma_viii/ral32_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral32_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_viii/ral32_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Panelled Puzzle I" el:subtitle="" el:id="20080820ral639"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 177 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 179 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2008,2009 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -28,7 +28,7 @@
 
 ti["*"] = {"st_spitter", "spitter", secure=true}
 ti["X"] = {"st_pull", "eastpull"} .. ti{"fl_redslab_framed"} .. ti{"it_trigger", invisible=true, target="spitter"}
-ti["S"] = {"st_switch", target="balls"}
+ti["S"] = {"st_dispenser_extralife"}
 ti["$"] = {"it_extralife"}
 
 ti["@"] = {"#ac_marble"}
@@ -85,11 +85,6 @@
     end
 end
 
-function balls()
-    -- we are currently missing an extralife dispenser
-    wo:add(YIN, ti["$"]..ti["$"]..ti["$"]..ti["$"]..ti["$"])
-end
-
 function conjure()
     if state == 0 and wo["IsDifficult"] then
         -- now we play an odd parity

Modified: trunk/data/levels/enigma_viii/ral33_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral33_1.xml	2009-07-17 21:32:53 UTC (rev 1759)
+++ trunk/data/levels/enigma_viii/ral33_1.xml	2009-07-19 13:31:58 UTC (rev 1760)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Panelled Puzzle II" el:subtitle="" el:id="20090308ral237"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 177 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 179 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2009 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -28,7 +28,7 @@
 
 ti["*"] = {"st_spitter", "spitter", secure=true}
 ti["X"] = {"st_pull", "eastpull"} .. ti{"fl_redslab_framed"} .. ti{"it_trigger", invisible=true, target="spitter"}
-ti["S"] = {"st_switch", target="balls"}
+ti["S"] = {"st_dispenser_extralife"}
 ti["$"] = {"it_extralife"}
 
 ti["@"] = {"#ac_marble"}
@@ -91,11 +91,6 @@
     wo[no["tr%"..i]] = {"st_puzzle", connections=connections[perm[i]]}
 end
 
-function balls()
-    -- we are currently missing an extralife dispenser
-    wo:add(YIN, ti["$"]..ti["$"]..ti["$"]..ti["$"]..ti["$"])
-end
-
 function conjure()
     if state == 1 and wo["IsDifficult"] then
         -- now we play an even parity



From ral at mail.berlios.de  Sun Jul 19 23:09:13 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 19 Jul 2009 23:09:13 +0200
Subject: [Enigma-game-svn] r1761 - in trunk/src: . lev
Message-ID: <200907192109.n6JL9Dds032494@sheep.berlios.de>

Author: ral
Date: 2009-07-19 23:09:12 +0200 (Sun, 19 Jul 2009)
New Revision: 1761

Modified:
   trunk/src/file.cc
   trunk/src/file.hh
   trunk/src/lev/Proxy.cc
   trunk/src/lev/Proxy.hh
   trunk/src/lev/SubProxy.cc
   trunk/src/lev/SubProxy.hh
   trunk/src/lua.cc
   trunk/src/main.cc
Log:
Trunk 1.1: 
- support of external data:
  - legal local "path" attribut values are "./anyname" and 
      "externaldata/anyname"
  - all external data files are stored at "path" with suffix ".txt"
  - download of "url" via curl (http, ftp, ...)
  - download only when no local copy exists
  - store downloaded file at "path"
  - Lua API extension: wo:externalData("path") for retrieval as string
Note:
  - together with multilevel feature and libimport any Sokoban levelpack
    is now directly playable on Enigma.
  - libimport currently supports only linefeed terminated files
  - levelpack composer does not yet support external data
  - some error checks needs to be improved in external data support

Modified: trunk/src/file.cc
===================================================================
--- trunk/src/file.cc	2009-07-19 13:31:58 UTC (rev 1760)
+++ trunk/src/file.cc	2009-07-19 21:09:12 UTC (rev 1761)
@@ -1,5 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004,2005 Daniel Heck
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -17,6 +18,8 @@
  *
  */
 #include "file.hh"
+
+#include "errors.hh"
 #include "enigma.hh"
 #include "video.hh"
 #include "main.hh"
@@ -33,6 +36,7 @@
 #include <ios>
 #include <iostream>
 #include <fstream>
+#include <curl/curl.h>
 
 using namespace enigma;
 using namespace ecl;
@@ -380,3 +384,38 @@
     ofs.close();
     return !ofs.fail();
 }
+
+    CURL *easycurl;
+    
+    bool enigma::InitCurl() {
+        if (curl_global_init(CURL_GLOBAL_ALL) != 0)
+            return false;
+        
+        easycurl = curl_easy_init();
+        return easycurl != NULL;
+    }
+    
+    void enigma::ShutdownCurl() {
+        curl_easy_cleanup(easycurl);
+        curl_global_cleanup();
+    }
+    
+    size_t curl_writefunction(void *src, size_t size, size_t nmemb, void *dataptr) {
+        ByteVec *dest = (ByteVec *)dataptr;
+        size_t oldlen = dest->size();
+        dest->resize(oldlen + size * nmemb);
+        std::memcpy(&(*dest)[oldlen], src, size * nmemb);
+        Log << "curl write " << size * nmemb << " new size " << dest->size() << "\n";
+        return size * nmemb;
+    }
+    
+    void enigma::Downloadfile(std::string url, ByteVec &dst) {
+        ASSERT(curl_easy_setopt(easycurl, CURLOPT_URL, url.c_str()) == CURLE_OK, XLevelLoading, 
+                ("Curl url error on '" + url + "'").c_str());
+        ASSERT(curl_easy_setopt(easycurl, CURLOPT_WRITEFUNCTION, curl_writefunction) == CURLE_OK, XLevelLoading, 
+                ("Curl funtion error on '" + url + "'").c_str());
+        ASSERT(curl_easy_setopt(easycurl, CURLOPT_WRITEDATA, &dst) == CURLE_OK, XLevelLoading, 
+                ("Curl data set error on '" + url + "'").c_str());
+        ASSERT(curl_easy_perform(easycurl) == CURLE_OK, XLevelLoading,
+                ("Curl download error on '" + url + "'").c_str());
+    }

Modified: trunk/src/file.hh
===================================================================
--- trunk/src/file.hh	2009-07-19 13:31:58 UTC (rev 1760)
+++ trunk/src/file.hh	2009-07-19 21:09:12 UTC (rev 1761)
@@ -1,5 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -19,11 +20,12 @@
 #ifndef FILE_HH_INCLUDED
 #define FILE_HH_INCLUDED
 
+#include "ecl_error.hh"
+
 #include <iosfwd>
 #include <vector>
 #include <list>
 #include <memory>
-#include "ecl_error.hh"
 
 namespace enigma
 {
@@ -185,7 +187,11 @@
     };
 
 /* -------------------- Helper functions -------------------- */
-
+    
+    bool InitCurl();
+    void ShutdownCurl();
+    void Downloadfile(std::string url, ByteVec &dst);
+    
     /*! Load a complete file/input stream `is' into `dst'.  */
     std::istream &Readfile (std::istream &is, ByteVec &dst, int blocksize=512);
     bool Copyfile(std::string fromPath, std::string toPath);

Modified: trunk/src/lev/Proxy.cc
===================================================================
--- trunk/src/lev/Proxy.cc	2009-07-19 13:31:58 UTC (rev 1760)
+++ trunk/src/lev/Proxy.cc	2009-07-19 21:09:12 UTC (rev 1761)
@@ -408,9 +408,9 @@
         } else if (normPathType == pt_absolute || normPathType == pt_url) { 
             absLevelPath = normFilePath;
         } else if(normPathType == pt_resource) {
-            if(!app.resourceFS->findFile ("levels/" + normFilePath + ".xml", 
+            if(!app.resourceFS->findFile("levels/" + normFilePath + ".xml", 
                         absLevelPath, isptr) &&
-                    !app.resourceFS->findFile ("levels/" + normFilePath + ".lua", 
+                    !app.resourceFS->findFile("levels/" + normFilePath + ".lua", 
                         absLevelPath, isptr)) {
                 return NULL;
             }
@@ -444,11 +444,11 @@
             // preload plain Lua file or zipped level
             if (isptr.get() != NULL) {
                 // zipped file
-                Readfile (*isptr, levelCode);
+                Readfile(*isptr, levelCode);
             } else {
                 // plain file
                 basic_ifstream<char> ifs(absLevelPath.c_str(), ios::binary | ios::in);
-                Readfile (ifs, levelCode);
+                Readfile(ifs, levelCode);
             }
             std::string oPath = newBasePath + "/" + newPackPath + "/" + filename;
             if (backup) {
@@ -545,7 +545,7 @@
         // xml or lua
         size_t extbegin = absLevelPath.rfind ('.');
         if (extbegin != string::npos) {
-            string ext = absLevelPath.substr (extbegin);
+            std::string ext = absLevelPath.substr(extbegin);
         
             if (normPathType != pt_url && (ext == ".lua" || ext == ".ell")) {
                 useFileLoader = true;
@@ -555,10 +555,10 @@
                 // use file loader only for zipped xml files
                 useFileLoader = (isptr.get() != NULL) ? true : false;
             } else {
-                throw XLevelLoading ("Unknown file extension in " + absLevelPath);
+                throw XLevelLoading("Unknown file extension in " + absLevelPath);
             }
         } else {
-                throw XLevelLoading ("Unknown file extension in " + absLevelPath);
+                throw XLevelLoading("Unknown file extension in " + absLevelPath);
         }
 
         // load
@@ -707,6 +707,7 @@
             server::PrepareLua();
         }
         processDependencies();
+        processExternaldata();
         loadLuaCode();
     }
 
@@ -848,6 +849,101 @@
             throw XLevelLoading("load attempt of undeclared library");
     }
     
+    void Proxy::processExternaldata() {
+        if (doc != NULL) {
+            DOMNodeList *extList = infoElem->getElementsByTagNameNS(
+                    levelNS, Utf8ToXML("externaldata").x_str());
+            for (int i = 0, l = extList->getLength();  i < l; i++) {
+                DOMElement *extElem = dynamic_cast<DOMElement *>(extList->item(i));
+                std::string extNormPath;
+                std::string extUrl;
+                extNormPath = XMLtoUtf8(extElem->getAttributeNS(levelNS, 
+                        Utf8ToXML("path").x_str())).c_str();
+                extUrl = XMLtoUtf8(extElem->getAttributeNS(levelNS, 
+                        Utf8ToXML("url").x_str())).c_str();
+//                Log << "EData: Path="<<extNormPath<< " Url=" << extUrl<<"\n";
+                // load every external data resource just once even if multiple urls are given
+                if (externalData.find(extNormPath) == externalData.end()) {
+                    std::auto_ptr<std::istream> isptr;
+                    ByteVec extCode;
+                    
+                    std::string extFilename;
+                    std::string extPath;
+                    bool isLocal = true;
+                    if (extNormPath.find("./") == 0) {
+                        extFilename = extNormPath.substr(2);
+                        if (normPathType == pt_resource) {
+                            extPath = normFilePath.substr(0, normFilePath.rfind('/') + 1) + extFilename + ".txt";
+                        } else if (normPathType == pt_absolute) {
+                            extPath = absLevelPath.substr(0, absLevelPath.rfind('/') + 1) + extFilename + ".txt";
+                        } else
+                            ASSERT(false, XLevelLoading, ("Invalid external data path '" + extNormPath + "'").c_str());
+                    } else if  (extNormPath.find("externaldata/") == 0) {
+                        extFilename = extNormPath.substr(13);
+                        isLocal = false;
+                        extPath = extNormPath + ".txt";
+                    } else {
+                        ASSERT(false, XLevelLoading, ("Invalid external data path '" + extNormPath + "'").c_str());
+                    }
+                    
+                    // TODO check extFilename no further /, no suffix, legal chars
+                    
+                    // resolve resource path to filepath
+                    std::string absExtPath;
+//                    Log << "External data extPath " << extPath << "\n";
+                    bool haveLocalCopy = true;
+                    if (normPathType == pt_absolute) {
+                        absExtPath = extPath;
+                    } else { 
+                        haveLocalCopy = app.resourceFS->findFile("levels/" + extPath, absExtPath, isptr);
+                    }
+
+                    // preload plain file or zipped file
+                    if (haveLocalCopy && isptr.get() != NULL) {
+                        // zipped file
+                        Readfile(*isptr, extCode);
+                    } else if (haveLocalCopy) {
+                        // plain file
+                        basic_ifstream<char> ifs(absExtPath.c_str(), ios::binary | ios::in);
+                        if (ifs != NULL)
+                            Readfile(ifs, extCode);
+                        else
+                            haveLocalCopy = false;
+                    }
+                    
+                    if (!haveLocalCopy) {
+                        // need to download via curl
+                        absExtPath = app.userPath + "/levels/" + extPath;
+//                        Log << "External data download via curl '" << extUrl << "' - '" << absExtPath <<"'\n";
+
+                        // TODO try catch assertions with proper handling, checksums
+                        Downloadfile(extUrl, extCode);
+                        
+                        // save a local copy
+                        ofstream ofs(absExtPath.c_str(), ios::binary | ios::out);
+                        ofs.write(&extCode[0], extCode.size());
+                        ofs.close();
+                        if (ofs.fail())
+                            Log << "External data failed to write local copy to '" << absExtPath << "'\n";
+                        
+                        // terminate the yet unterminated code string
+                        extCode.push_back(0);
+                    }
+                    
+                    std::string extString = reinterpret_cast<const char *>(&extCode[0]);
+//                    Log << "External data loaded:\n" << extString << "\n";
+                    externalData[extNormPath] = extString;
+                }
+            }
+        }
+    }
+    
+    std::string Proxy::getExternalData(std::string pathId) {
+        std::map<std::string, std::string>::iterator itr = externalData.find(pathId); // [] access would create map entries!
+        ASSERT(itr != externalData.end(), XLevelRuntime, ("Unknown external data access '" + pathId + "'\n").c_str());
+        return itr->second;
+    }
+    
     void Proxy::loadLuaCode() {
         lua_State *L = lua::LevelState();
         DOMNodeList * luamainList = doc->getElementsByTagNameNS(levelNS, Utf8ToXML("luamain").x_str());

Modified: trunk/src/lev/Proxy.hh
===================================================================
--- trunk/src/lev/Proxy.hh	2009-07-19 13:31:58 UTC (rev 1760)
+++ trunk/src/lev/Proxy.hh	2009-07-19 21:09:12 UTC (rev 1761)
@@ -123,6 +123,7 @@
         virtual int getDifficultScore();
         virtual GameType getEngineCompatibility();
         virtual double getEnigmaCompatibility();
+        virtual std::string getExternalData(std::string pathId);
         
         /**
          * the levels file address that can be used independent of a level pack
@@ -180,6 +181,7 @@
         bool hasSingleModeFlag;
         bool hasNetworkModeFlag;
         scoreUnitType scoreUnit;
+        std::map<std::string, std::string> externalData;
         /**
          * The compatibility that needs to be preset on level load.
          * Usually level set the compatibility themselves on load. But heritage
@@ -195,7 +197,8 @@
         void load(bool onlyMetadata, bool expectLevel);
         void loadDoc();
         void loadLuaCode();
-        void processDependencies();   
+        void processDependencies();
+        void processExternaldata();
         void registerPreloadDependency(std::string depPath, std::string depId,
             int depRelease, bool depPreload, std::string depUrl);
         std::string getType();

Modified: trunk/src/lev/SubProxy.cc
===================================================================
--- trunk/src/lev/SubProxy.cc	2009-07-19 13:31:58 UTC (rev 1760)
+++ trunk/src/lev/SubProxy.cc	2009-07-19 21:09:12 UTC (rev 1761)
@@ -151,6 +151,10 @@
         return multiProxy->getEnigmaCompatibility();
     }
     
+    std::string SubProxy::getExternalData(std::string pathId) {
+        return multiProxy->getExternalData(pathId);
+    }
+    
     std::string SubProxy::getNormLevelPath() {
         return getNormFilePath() + ecl::strf("_%d", subNum);
     }

Modified: trunk/src/lev/SubProxy.hh
===================================================================
--- trunk/src/lev/SubProxy.hh	2009-07-19 13:31:58 UTC (rev 1760)
+++ trunk/src/lev/SubProxy.hh	2009-07-19 21:09:12 UTC (rev 1761)
@@ -54,6 +54,7 @@
         virtual int getDifficultScore();
         virtual GameType getEngineCompatibility();
         virtual double getEnigmaCompatibility();
+        virtual std::string getExternalData(std::string pathId);
         virtual std::string getNormLevelPath();
         virtual std::string getAbsLevelPath();
         

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2009-07-19 13:31:58 UTC (rev 1760)
+++ trunk/src/lua.cc	2009-07-19 21:09:12 UTC (rev 1761)
@@ -2799,6 +2799,17 @@
     return 0;
 }
 
+static int externalData(lua_State *L) {
+    // world, path  -- 
+    if (!lua_isstring(L, 2)) {
+            throwLuaError(L, "External data access without path id string");
+            return 0;
+    }
+    lev::Proxy * curProxy = lev::Index::getCurrentProxy();
+    lua_pushstring(L, curProxy->getExternalData(lua_tostring(L, 2)).c_str());
+    return 1;
+}
+
 MethodMap tileMethodeMap;
 
 static int dispatchTileWriteAccess(lua_State *L) {
@@ -3506,6 +3517,7 @@
     {getItem,                       "it"},
     {getStone,                      "st"},
     {shuffleOxyd,                   "shuffleOxyd"},
+    {externalData,                  "externalData"},
     {0,0}
 };
 

Modified: trunk/src/main.cc
===================================================================
--- trunk/src/main.cc	2009-07-19 13:31:58 UTC (rev 1760)
+++ trunk/src/main.cc	2009-07-19 21:09:12 UTC (rev 1761)
@@ -345,8 +345,14 @@
     lua::CheckedDoFile (L, app.systemFS, "sound-defaults.lua");
     lua::DoSubfolderfile (L, "soundsets", "soundset.lua");
 
-    // ----- Initialize network layer
-    if (enet_initialize () != 0) {
+    // ----- Initialize TCP network layer
+    if (!InitCurl()) {
+        fprintf (stderr, "An error occurred while initializing Curl.\n");
+        exit (1);
+    }
+    
+    // ----- Initialize UDP network layer
+    if (enet_initialize() != 0) {
         fprintf (stderr, "An error occurred while initializing ENet.\n");
         exit (1);
     }
@@ -693,6 +699,8 @@
         ecl::FolderCreate (userPath + "/levels/auto");
     if (!ecl::FolderExists(userPath + "/levels/cross"))
         ecl::FolderCreate (userPath + "/levels/cross");
+    if (!ecl::FolderExists(userPath + "/levels/externaldata"))
+        ecl::FolderCreate (userPath + "/levels/externaldata");
     if (!ecl::FolderExists(userPath + "/levels/legacy_dat"))
         ecl::FolderCreate (userPath + "/levels/legacy_dat");   
     if (!ecl::FolderExists(userPath + "/backup"))
@@ -833,6 +841,7 @@
     video::Shutdown();
     sound::Shutdown();
     enet_deinitialize();
+    enigma::ShutdownCurl();
     lua::ShutdownGlobal();
     XMLPlatformUtils::Terminate();
     delete ::nullbuffer;



From ral at mail.berlios.de  Mon Jul 20 23:07:44 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 20 Jul 2009 23:07:44 +0200
Subject: [Enigma-game-svn] r1762 - in trunk: data/levels/lib src src/items
	src/lev
Message-ID: <200907202107.n6KL7ibr006847@sheep.berlios.de>

Author: ral
Date: 2009-07-20 23:07:39 +0200 (Mon, 20 Jul 2009)
New Revision: 1762

Modified:
   trunk/data/levels/lib/libimport.xml
   trunk/src/client.cc
   trunk/src/file.cc
   trunk/src/items/Bottle.cc
   trunk/src/items/DocumentItem.cc
   trunk/src/lev/PersistentIndex.cc
   trunk/src/lev/Proxy.cc
   trunk/src/lev/SubProxy.cc
   trunk/src/lua.cc
   trunk/src/server.cc
   trunk/src/server.hh
Log:
Trunk 1.1: 
- fix r1761 missing include for gcc 4.3++
- fix problems on thumbnail generation due to false level Proxy access
- libimport add support for CR+LF line terminated Sokoban files
- sort autonamed multilevels in autofolder by their sublevel number

Modified: trunk/data/levels/lib/libimport.xml
===================================================================
--- trunk/data/levels/lib/libimport.xml	2009-07-19 21:09:12 UTC (rev 1761)
+++ trunk/data/levels/lib/libimport.xml	2009-07-20 21:07:39 UTC (rev 1762)
@@ -142,6 +142,7 @@
       "[ \-\#\_\$\.@\*0-9Nn\+]*"  -- all allowed characters except line ending
    .. "[\#\$\.@\*Nn\+]+"          -- at least one non-space character
    .. "[ \-\#\_\$\.@\*0-9Nn\+]*"  -- again all allowed characters except line ending
+   .. "[\r]?"                     -- maybe a carriage return from line ending
 
 function lib.import.map_sokoban(multilevel, sublevel_number, keylength_one)
     assert_type(multilevel, "lib.import.map_sokoban first argument", 2, "non-empty string")
@@ -149,6 +150,7 @@
     local level
     level = lib.import.unpack_multilevel(multilevel .. "\n", sublevel_number or 1, "sokoban")
     level = lib.import.uncompress_rle(level, {error_on_multiple = "|\n"})
+    level = lib.import.string_replace(level, "\r\n", "\n")
     level = lib.import.string_replace(level, "|", "\n")
     level = lib.import.string_remove_multiples(level .. "\n", "\n")
     local map = lib.import.level_to_map(level, "\n", " ")

Modified: trunk/src/client.cc
===================================================================
--- trunk/src/client.cc	2009-07-19 21:09:12 UTC (rev 1761)
+++ trunk/src/client.cc	2009-07-20 21:07:39 UTC (rev 1762)
@@ -446,7 +446,7 @@
         case SDLK_F6: Msg_JumpBack(); break;
 
         case SDLK_F10: {
-            lev::Proxy *level = lev::Index::getCurrentProxy();
+            lev::Proxy *level = server::LoadedProxy;
             std::string basename = std::string("screenshots/") +
                     level->getLocalSubstitutionLevelPath();
             std::string fname = basename + ".png";

Modified: trunk/src/file.cc
===================================================================
--- trunk/src/file.cc	2009-07-19 21:09:12 UTC (rev 1761)
+++ trunk/src/file.cc	2009-07-20 21:07:39 UTC (rev 1762)
@@ -33,6 +33,7 @@
 #include <dirent.h>
 #endif
 #include <algorithm>
+#include <cstring>
 #include <ios>
 #include <iostream>
 #include <fstream>
@@ -405,7 +406,7 @@
         size_t oldlen = dest->size();
         dest->resize(oldlen + size * nmemb);
         std::memcpy(&(*dest)[oldlen], src, size * nmemb);
-        Log << "curl write " << size * nmemb << " new size " << dest->size() << "\n";
+//        Log << "curl write " << size * nmemb << " new size " << dest->size() << "\n";
         return size * nmemb;
     }
     

Modified: trunk/src/items/Bottle.cc
===================================================================
--- trunk/src/items/Bottle.cc	2009-07-19 21:09:12 UTC (rev 1761)
+++ trunk/src/items/Bottle.cc	2009-07-20 21:07:39 UTC (rev 1762)
@@ -24,6 +24,7 @@
 //#include "main.hh"
 #include "lev/Index.hh"
 #include "lev/Proxy.hh"
+#include "server.hh"
 #include "world.hh"
 
 namespace enigma {
@@ -68,12 +69,8 @@
     ItemAction Bottle::activate(Actor *a, GridPos) {
         if (Value v = getAttr("text")) {
             std::string txt(v);
-            lev::Proxy *level = lev::Index::getCurrentProxy();
-            // after complete switch to Proxy as levelloader the following
-            // conditional can be abolished
-            if (level)
-                // translate text
-                txt = level->getLocalizedString(txt);
+            // translate text
+            txt = server::LoadedProxy->getLocalizedString(txt);
             client::Msg_ShowText(txt, true);
             return ITEM_KILL;          // remove from inventory
         } else if (state == IDLE) {

Modified: trunk/src/items/DocumentItem.cc
===================================================================
--- trunk/src/items/DocumentItem.cc	2009-07-19 21:09:12 UTC (rev 1761)
+++ trunk/src/items/DocumentItem.cc	2009-07-20 21:07:39 UTC (rev 1762)
@@ -24,6 +24,7 @@
 //#include "main.hh"
 #include "lev/Index.hh"
 #include "lev/Proxy.hh"
+#include "server.hh"
 #include "world.hh"
 
 namespace enigma {
@@ -51,12 +52,8 @@
     ItemAction DocumentItem::activate(Actor *a, GridPos) {
         if (Value v = getAttr("text")) {
             std::string txt(v);
-            lev::Proxy *level = lev::Index::getCurrentProxy();
-            // after complete switch to Proxy as levelloader the following
-            // conditional can be abolished
-            if (level)
-                // translate text
-                txt = level->getLocalizedString(txt);
+            // translate text
+            txt = server::LoadedProxy->getLocalizedString(txt);
             client::Msg_ShowText(txt, true);
         }
         return ITEM_KILL;          // remove from inventory

Modified: trunk/src/lev/PersistentIndex.cc
===================================================================
--- trunk/src/lev/PersistentIndex.cc	2009-07-19 21:09:12 UTC (rev 1761)
+++ trunk/src/lev/PersistentIndex.cc	2009-07-20 21:07:39 UTC (rev 1762)
@@ -247,7 +247,7 @@
     }
     
     int autoIndexProxyCompare(Proxy * first, Proxy * second) {
-        return first->getNormFilePath() < second->getNormFilePath();
+        return first->getNormLevelPath() < second->getNormLevelPath();
     }
     
     void PersistentIndex::load(bool systemOnly, bool update) {

Modified: trunk/src/lev/Proxy.cc
===================================================================
--- trunk/src/lev/Proxy.cc	2009-07-19 21:09:12 UTC (rev 1761)
+++ trunk/src/lev/Proxy.cc	2009-07-20 21:07:39 UTC (rev 1762)
@@ -931,6 +931,7 @@
                     }
                     
                     std::string extString = reinterpret_cast<const char *>(&extCode[0]);
+                    Log << "External data loaded:\n" << extNormPath << "\n";
 //                    Log << "External data loaded:\n" << extString << "\n";
                     externalData[extNormPath] = extString;
                 }

Modified: trunk/src/lev/SubProxy.cc
===================================================================
--- trunk/src/lev/SubProxy.cc	2009-07-19 21:09:12 UTC (rev 1761)
+++ trunk/src/lev/SubProxy.cc	2009-07-20 21:07:39 UTC (rev 1762)
@@ -156,7 +156,7 @@
     }
     
     std::string SubProxy::getNormLevelPath() {
-        return getNormFilePath() + ecl::strf("_%d", subNum);
+        return getNormFilePath() + ecl::strf("_%.3d", subNum);
     }
     
     std::string SubProxy::getAbsLevelPath() {

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2009-07-19 21:09:12 UTC (rev 1761)
+++ trunk/src/lua.cc	2009-07-20 21:07:39 UTC (rev 1762)
@@ -945,9 +945,8 @@
 int loadLib(lua_State *L) 
 {
     const char *id = lua_tostring(L, 1);
-    lev::Proxy * curProxy = lev::Index::getCurrentProxy();
     try {
-        curProxy->loadDependency(id);
+        server::LoadedProxy->loadDependency(id);
     } catch (XLevelLoading &err) {
         throwLuaError(L, err.what());
     }
@@ -2805,8 +2804,7 @@
             throwLuaError(L, "External data access without path id string");
             return 0;
     }
-    lev::Proxy * curProxy = lev::Index::getCurrentProxy();
-    lua_pushstring(L, curProxy->getExternalData(lua_tostring(L, 2)).c_str());
+    lua_pushstring(L, server::LoadedProxy->getExternalData(lua_tostring(L, 2)).c_str());
     return 1;
 }
 

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2009-07-19 21:09:12 UTC (rev 1761)
+++ trunk/src/server.cc	2009-07-20 21:07:39 UTC (rev 1762)
@@ -78,6 +78,7 @@
 
 double   server::LastMenuTime;
 int      server::MenuCount;
+lev::Proxy * server::LoadedProxy;
 unsigned server::SublevelNumber;
 std::string server::SublevelTitle;
 
@@ -149,6 +150,7 @@
 void load_level(lev::Proxy *levelProxy, bool isRestart)
 {
     try {
+        server::LoadedProxy = levelProxy;
         server::PrepareLevel();
         IsLevelRestart = isRestart;
 

Modified: trunk/src/server.hh
===================================================================
--- trunk/src/server.hh	2009-07-19 21:09:12 UTC (rev 1761)
+++ trunk/src/server.hh	2009-07-20 21:07:39 UTC (rev 1762)
@@ -57,6 +57,7 @@
     extern double LastMenuTime;
     extern int MenuCount;
     
+    extern lev::Proxy * LoadedProxy;
     extern int32_t  RandomState;
     extern unsigned SublevelNumber;
     extern std::string SublevelTitle;



From ral at mail.berlios.de  Mon Jul 20 23:17:33 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 20 Jul 2009 23:17:33 +0200
Subject: [Enigma-game-svn] r1763 - trunk/src
Message-ID: <200907202117.n6KLHXKR007735@sheep.berlios.de>

Author: ral
Date: 2009-07-20 23:17:33 +0200 (Mon, 20 Jul 2009)
New Revision: 1763

Modified:
   trunk/src/Makefile.am
   trunk/src/main.cc
Log:
Trunk 1.1:
- Mac OS X patch by Sidney:
  - move documentation to Resources/docs
  - retrieve absolute program call path for opening of docs with browser


Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-07-20 21:07:39 UTC (rev 1762)
+++ trunk/src/Makefile.am	2009-07-20 21:17:33 UTC (rev 1763)
@@ -525,7 +525,7 @@
 	strip $(bundle_name)/Contents/MacOS/enigma
 
 # Special target to copy the doc files to the MacOS dmg staging area
-bundle_doc := $(bundle_root)/Documentation
+bundle_doc := $(bundle_name)/Contents/Resources/doc
 .PHONY: bundle-doc
 bundle-doc:
 	-rm -rf $(bundle_doc)

Modified: trunk/src/main.cc
===================================================================
--- trunk/src/main.cc	2009-07-20 21:07:39 UTC (rev 1762)
+++ trunk/src/main.cc	2009-07-20 21:17:33 UTC (rev 1763)
@@ -64,6 +64,9 @@
 #ifdef MACOSX
 // for search paths
 #include "NSSystemDirectories.h"
+#include <Carbon/Carbon.h>
+#include <CoreFoundation/CoreFoundation.h>
+#include <CoreServices/CoreServices.h>
 #endif
 
 using namespace std;
@@ -238,6 +241,19 @@
     sscanf(PACKAGE_VERSION, "%4lf", &enigmaVersion);
 
     progCallPath = argv[0];
+#if MACOSX
+    CFBundleRef mainBundle = CFBundleGetMainBundle();
+    CFURLRef cfurlmain = CFBundleCopyExecutableURL(mainBundle);
+    CFStringRef cffileStr = CFURLCopyFileSystemPath(cfurlmain, kCFURLPOSIXPathStyle);
+    CFIndex cfmax = CFStringGetMaximumSizeOfFileSystemRepresentation(cffileStr);
+    char localbuffer[cfmax];
+    if (CFStringGetFileSystemRepresentation(cffileStr, localbuffer, cfmax)) {
+      progCallPath = localbuffer; // error skips this and defaults to argv[0] which works for most purposes
+    }
+    CFRelease(mainBundle);
+    CFRelease(cfurlmain);
+    CFRelease(cffileStr);
+#endif
     copy(argv+1, argv+argc, back_inserter(args));
     
     // parse commandline arguments -- needs args



From ral at mail.berlios.de  Tue Jul 21 01:18:37 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 21 Jul 2009 01:18:37 +0200
Subject: [Enigma-game-svn] r1764 - in trunk/src: . gui lev
Message-ID: <200907202318.n6KNIbfr004463@sheep.berlios.de>

Author: ral
Date: 2009-07-21 01:18:33 +0200 (Tue, 21 Jul 2009)
New Revision: 1764

Modified:
   trunk/src/gui/LevelMenu.cc
   trunk/src/lev/Index.cc
   trunk/src/lev/Index.hh
   trunk/src/lev/PersistentIndex.cc
   trunk/src/lev/PersistentIndex.hh
   trunk/src/lev/Proxy.cc
   trunk/src/lev/VolatileIndex.cc
   trunk/src/lev/VolatileIndex.hh
   trunk/src/oxyd.cc
   trunk/src/oxyd_internal.hh
Log:
Trunk 1.1: 
- extend auto folder update to handle multilevel changes

Modified: trunk/src/gui/LevelMenu.cc
===================================================================
--- trunk/src/gui/LevelMenu.cc	2009-07-20 21:17:33 UTC (rev 1763)
+++ trunk/src/gui/LevelMenu.cc	2009-07-20 23:18:33 UTC (rev 1764)
@@ -230,7 +230,7 @@
                     next_unsolved();
                     break;
                 case SDLK_F7:
-                    lev::Index::getCurrentIndex()->updateFromProxies();
+                    lev::Index::getCurrentIndex()->updateFromFolder();
                     draw_all();
                     break;
                 case SDLK_u: {

Modified: trunk/src/lev/Index.cc
===================================================================
--- trunk/src/lev/Index.cc	2009-07-20 21:17:33 UTC (rev 1763)
+++ trunk/src/lev/Index.cc	2009-07-20 23:18:33 UTC (rev 1764)
@@ -693,6 +693,7 @@
     }
     
     void Index::updateFromProxies() {
+        Proxy::releaseCache();   // enforce a reload from file
         for (int i = 0, l = proxies.size();  i < l; i++) {
             try {
                 proxies[i]->loadMetadata(true);

Modified: trunk/src/lev/Index.hh
===================================================================
--- trunk/src/lev/Index.hh	2009-07-20 21:17:33 UTC (rev 1763)
+++ trunk/src/lev/Index.hh	2009-07-20 23:18:33 UTC (rev 1764)
@@ -126,7 +126,8 @@
                 scoreUnitType varUnit = duration, std::string varTarget = "time",
                 std::map<std::string, std::string> varExtensions = nullExtensions);
         virtual void clear();
-        virtual void updateFromProxies();
+        void updateFromProxies();
+        virtual void updateFromFolder() = 0;
 
         // ---------- LevelPack legacy methods ---to be renamed ------- */
         /*! Return the default SoundSet (see options::SoundSet for meaning) */

Modified: trunk/src/lev/PersistentIndex.cc
===================================================================
--- trunk/src/lev/PersistentIndex.cc	2009-07-20 21:17:33 UTC (rev 1763)
+++ trunk/src/lev/PersistentIndex.cc	2009-07-20 23:18:33 UTC (rev 1764)
@@ -674,13 +674,16 @@
         }
     }
     
-    void PersistentIndex::updateFromProxies() {
+    void PersistentIndex::updateFromFolder() {
         if (!isAuto)
             return;
         
+        // force a reload of metadata to update existing proxies
+        // for multilevels it is essential to do this prior the reload
+        Index::updateFromProxies();
         clear();
+        // now reload - existing proxies are reused, but we have updated them already
         load(false);
-        Index::updateFromProxies();
     }
     
     bool PersistentIndex::save(bool allowOverwrite) {

Modified: trunk/src/lev/PersistentIndex.hh
===================================================================
--- trunk/src/lev/PersistentIndex.hh	2009-07-20 21:17:33 UTC (rev 1763)
+++ trunk/src/lev/PersistentIndex.hh	2009-07-20 23:18:33 UTC (rev 1764)
@@ -101,7 +101,7 @@
         void erase(int pos);
         void exchange(int pos1, int pos2);
         virtual bool isSource(Proxy * aProxy);
-        virtual void updateFromProxies();
+        virtual void updateFromFolder();
         bool save(bool allowOverwrite = true);
     protected:
         std::string packPath;  // "auto", "",...

Modified: trunk/src/lev/Proxy.cc
===================================================================
--- trunk/src/lev/Proxy.cc	2009-07-20 21:17:33 UTC (rev 1763)
+++ trunk/src/lev/Proxy.cc	2009-07-20 23:18:33 UTC (rev 1764)
@@ -247,7 +247,6 @@
         }
         return theProxy;
     }
-   
 
     struct LowerCaseString {
         std::string low;

Modified: trunk/src/lev/VolatileIndex.cc
===================================================================
--- trunk/src/lev/VolatileIndex.cc	2009-07-20 21:17:33 UTC (rev 1763)
+++ trunk/src/lev/VolatileIndex.cc	2009-07-20 23:18:33 UTC (rev 1764)
@@ -57,4 +57,7 @@
         proxies.clear();
         currentPosition = 0;
     }
+    
+    void VolatileIndex::updateFromFolder() {
+    }
 }} // namespace enigma::lev

Modified: trunk/src/lev/VolatileIndex.hh
===================================================================
--- trunk/src/lev/VolatileIndex.hh	2009-07-20 21:17:33 UTC (rev 1763)
+++ trunk/src/lev/VolatileIndex.hh	2009-07-20 23:18:33 UTC (rev 1764)
@@ -38,6 +38,7 @@
                 double defaultLocation = INDEX_DEFAULT_PACK_LOCATION);
         ~VolatileIndex();
         virtual void clear();
+        virtual void updateFromFolder();
     private:
         static int levelCount;  // used for volatile level ids - necessary for lua levels
     };

Modified: trunk/src/oxyd.cc
===================================================================
--- trunk/src/oxyd.cc	2009-07-20 21:17:33 UTC (rev 1763)
+++ trunk/src/oxyd.cc	2009-07-20 23:18:33 UTC (rev 1764)
@@ -771,6 +771,9 @@
     Log << "Levelpack '" << get_name() << "' has " << nlevels << " levels." << endl;
 }
 
+void LevelPack_Oxyd::updateFromFolder() {
+}
+
 const char* LevelPack_Oxyd::get_default_SoundSet() const 
 { 
     return sound::GetOxydSoundSet(m_datfile->getVersion()).c_str();

Modified: trunk/src/oxyd_internal.hh
===================================================================
--- trunk/src/oxyd_internal.hh	2009-07-20 21:17:33 UTC (rev 1763)
+++ trunk/src/oxyd_internal.hh	2009-07-20 23:18:33 UTC (rev 1764)
@@ -155,6 +155,7 @@
                         int idx_start, int idx_end, bool twoplayers);
 
         void load_oxyd_level (size_t index);
+        virtual void updateFromFolder();
 
         /* ---------- LevelPack interface ---------- */
         string get_name() const;



From andreasl at mail.berlios.de  Tue Jul 21 14:44:24 2009
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Tue, 21 Jul 2009 14:44:24 +0200
Subject: [Enigma-game-svn] r1765 - trunk/data/levels/lib
Message-ID: <200907211244.n6LCiOKH011551@sheep.berlios.de>

Author: andreasl
Date: 2009-07-21 14:44:23 +0200 (Tue, 21 Jul 2009)
New Revision: 1765

Modified:
   trunk/data/levels/lib/libimport.xml
   trunk/data/levels/lib/libsoko.xml
   trunk/data/levels/lib/libsoko_designlist.xml
Log:
Trunk:
 - Fix libsoko/libsoko_designlist: At start of endphase, inf has not
   been drawn correctly due to a missing ignore-key.
 - Replace obsolete string.gfind by string.gmatch.


Modified: trunk/data/levels/lib/libimport.xml
===================================================================
--- trunk/data/levels/lib/libimport.xml	2009-07-20 23:18:33 UTC (rev 1764)
+++ trunk/data/levels/lib/libimport.xml	2009-07-21 12:44:23 UTC (rev 1765)
@@ -43,7 +43,7 @@
     local level = ""
     -- search the correct sublevel by pattern matching, line for line
     local in_level = false
-    for line in string.gfind(multilevel, "([^\n\|]*)[\n\|]") do
+    for line in string.gmatch(multilevel, "([^\n\|]*)[\n\|]") do
         local start_match, end_match = string.find(line, lib.import.line_regexp[format])
         if (start_match == 1) and (end_match == string.len(line)) then
             if not in_level then

Modified: trunk/data/levels/lib/libsoko.xml
===================================================================
--- trunk/data/levels/lib/libsoko.xml	2009-07-20 23:18:33 UTC (rev 1764)
+++ trunk/data/levels/lib/libsoko.xml	2009-07-21 12:44:23 UTC (rev 1765)
@@ -28,6 +28,7 @@
 setmetatable(lib.soko, getmetatable(lib))
 lib.soko.keys_to_field_names = {["  "] = "inf", ["- "] = "outf", ["$ "] = "box",
     ["# "] = "wall", [" ."] = "goal", ["D "] = "door", ["d "] = "open_door"}
+lib.soko.ignore_key = "Ig"  -- This key may not appear in any Sokoban-level.
     
 -- The following constants are defined in libsoko_designlist:
 -- RESOLVE_ALL = 0
@@ -511,7 +512,7 @@
     local alg = endp.alg
     local marbles = no["marble#*"]
     -- redraw level and give items
-    wo:drawMap(lib.soko.resolver_endphase, po(0,0), lib.soko.map)
+    wo:drawMap(lib.soko.resolver_endphase, po(0,0), lib.soko.ignore_key, lib.soko.map)
     local give = lib.lua.deep_copy(endp.give)
     if type(give) == "string" then
         give = {{give}}

Modified: trunk/data/levels/lib/libsoko_designlist.xml
===================================================================
--- trunk/data/levels/lib/libsoko_designlist.xml	2009-07-20 23:18:33 UTC (rev 1764)
+++ trunk/data/levels/lib/libsoko_designlist.xml	2009-07-21 12:44:23 UTC (rev 1765)
@@ -1332,7 +1332,7 @@
          door = "st_blocker",
          oxyd = "b",
          endp = {inf = {"fl_white", "fl_fake_abyss", res = RESOLVE_CHECKERBOARD},
-                 goal = {"st_nil", "it_nil"},
+                 goal = {"st_nil", "it_nil", {"fl_white", "fl_fake_abyss", res = RESOLVE_CHECKERBOARD}},
                  alg = "ralf"}},
 [140] = {inf = ti{"fl_bast", friction = 3.0},
          outf = {"fl_lawn_e4", "fl_lawn_e2", "fl_lawn_e1", "fl_lawn_e3", res = RESOLVE_WAVES},



From ral at mail.berlios.de  Tue Jul 21 23:22:28 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 21 Jul 2009 23:22:28 +0200
Subject: [Enigma-game-svn] r1766 - in trunk: lib-src/enigma-core src src/gui
Message-ID: <200907212122.n6LLMS7P022018@sheep.berlios.de>

Author: ral
Date: 2009-07-21 23:22:28 +0200 (Tue, 21 Jul 2009)
New Revision: 1766

Modified:
   trunk/lib-src/enigma-core/ecl_system.cc
   trunk/src/Makefile.am
   trunk/src/gui/MainMenu.cc
Log:
Trunk 1.1:
- Mac OS X patch by Sidney:
  - support for auto folder and enigma.score folder exploration


Modified: trunk/lib-src/enigma-core/ecl_system.cc
===================================================================
--- trunk/lib-src/enigma-core/ecl_system.cc	2009-07-21 12:44:23 UTC (rev 1765)
+++ trunk/lib-src/enigma-core/ecl_system.cc	2009-07-21 21:22:28 UTC (rev 1766)
@@ -137,17 +137,9 @@
 #ifdef __MINGW32__
     result == ((int)ShellExecute(NULL, "explore", path.c_str(), NULL, NULL, SW_SHOWNORMAL) >= 32);
 #elif MACOSX
-    CFStringRef cfurlStr = CFStringCreateWithCString( NULL, path.c_str(), kCFStringEncodingASCII);
-
-    // Create a URL object:
-    CFURLRef cfurl = CFURLCreateWithString (NULL, cfurlStr, NULL);
-
-    // Open the URL:
-    LSOpenCFURLRef(cfurl, NULL);
-
-    // Release the created resources:
-    CFRelease(cfurl);
-    CFRelease(cfurlStr);
+    FSRef fref;
+    FSPathMakeRef((UInt8*)path.c_str(), &fref, NULL);
+    LSOpenFSRef(&fref, NULL);
 #else
     result = (system(("xdg-open " + path + " &").c_str()) == 0);
 #endif

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-07-21 12:44:23 UTC (rev 1765)
+++ trunk/src/Makefile.am	2009-07-21 21:22:28 UTC (rev 1766)
@@ -563,7 +563,7 @@
 static_prefix := `$(SDL_CONFIG) --prefix`
 .PHONY: enigma-fw-mosx
 enigma-fw-mosx: $(enigma_OBJECTS) $(enigma_DEPENDENCIES)
-	$(CXX) $(LDFLAGS) -o enigma-fw $(enigma_OBJECTS) $(enigma_DEPENDENCIES) $(static_prefix)/lib/libintl.a /usr/lib/libiconv.dylib $(static_prefix)/lib/libxerces-c.a -L$(static_prefix)/lib -lsdlmain -lz -framework SDL -framework SDL_image -framework SDL_mixer -framework Cocoa -framework OpenGL -framework SDL_ttf $(static_prefix)/lib/libpng.a 
+	$(CXX) $(LDFLAGS) -o enigma-fw $(enigma_OBJECTS) $(enigma_DEPENDENCIES) $(static_prefix)/lib/libintl.a /usr/lib/libiconv.dylib /usr/lib/libcurl.dylib $(static_prefix)/lib/libxerces-c.a -L$(static_prefix)/lib -lsdlmain -lz -framework SDL -framework SDL_image -framework SDL_mixer -framework Cocoa -framework OpenGL -framework SDL_ttf $(static_prefix)/lib/libpng.a 
 
 # Special target to make a disk image of the bundled app
 .PHONY: bundle-dmg

Modified: trunk/src/gui/MainMenu.cc
===================================================================
--- trunk/src/gui/MainMenu.cc	2009-07-21 12:44:23 UTC (rev 1765)
+++ trunk/src/gui/MainMenu.cc	2009-07-21 21:22:28 UTC (rev 1766)
@@ -227,7 +227,7 @@
         BuildVList *brp = vshrink? &br : &b;
         
         homepage = b.add(new StaticTextButton(N_("Homepage"), this));
-        docs = b.add(new StaticTextButton(N_("Dokumentation"), this));
+        docs = b.add(new StaticTextButton(N_("Documentation"), this));
         paths = b.add(new StaticTextButton(N_("Paths"), this));
         autofolder = brp->add(new StaticTextButton(N_("Locate Auto"), this));
         scorefolder = brp->add(new StaticTextButton(N_("Locate Score"), this));



From ral at mail.berlios.de  Wed Jul 22 00:15:03 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 22 Jul 2009 00:15:03 +0200
Subject: [Enigma-game-svn] r1767 - trunk/src/lev
Message-ID: <200907212215.n6LMF3n5027642@sheep.berlios.de>

Author: ral
Date: 2009-07-22 00:15:02 +0200 (Wed, 22 Jul 2009)
New Revision: 1767

Modified:
   trunk/src/lev/Proxy.cc
   trunk/src/lev/Proxy.hh
Log:
Trunk 1.1: 
- load all level via buffer
- support all curl protocols for internet based levels
- adjust lua line count to correct numbers in error messages
  (just UTF-8, ASCII, Windows-1252 but not for UTF-16 encoding)


Modified: trunk/src/lev/Proxy.cc
===================================================================
--- trunk/src/lev/Proxy.cc	2009-07-21 21:22:28 UTC (rev 1766)
+++ trunk/src/lev/Proxy.cc	2009-07-21 22:15:02 UTC (rev 1767)
@@ -547,12 +547,9 @@
             std::string ext = absLevelPath.substr(extbegin);
         
             if (normPathType != pt_url && (ext == ".lua" || ext == ".ell")) {
-                useFileLoader = true;
                 isXML = false;  // preliminary - may still be lua commented xml
             } else if (ext == ".xml" || ext == ".elx") {
                 isXML = true;
-                // use file loader only for zipped xml files
-                useFileLoader = (isptr.get() != NULL) ? true : false;
             } else {
                 throw XLevelLoading("Unknown file extension in " + absLevelPath);
             }
@@ -560,82 +557,105 @@
                 throw XLevelLoading("Unknown file extension in " + absLevelPath);
         }
 
-        // load
-        
-        if (useFileLoader) {
-            // preload plain Lua file or zipped level
-            if (isptr.get() != NULL) {
-                // zipped file
-                Readfile (*isptr, levelCode);
-            } else {
-                // plain file
-                basic_ifstream<char> ifs(absLevelPath.c_str(), ios::binary | ios::in);
-                Readfile (ifs, levelCode);
-            }
+        // preload file into buffer
+        if (normPathType == pt_url) {
+            // url address via curl
+            Downloadfile(normFilePath, levelCode);
+        } else if (isptr.get() != NULL) {
+            // zipped file
+            Readfile (*isptr, levelCode);
+        } else {
+            // plain file
+            basic_ifstream<char> ifs(absLevelPath.c_str(), ios::binary | ios::in);
+            Readfile (ifs, levelCode);
+        }
  
-            if(!isXML) {
-                if(levelCode.size() >= 8 && std::string("--xml-- ").compare(
-                        0, 8, &(levelCode[0]), 8) == 0) {
-                    isXML = true;
-                    // delete lua "--xml-- " comments in level code
-                    int s = levelCode.size();
-                    int i = 0;
-                    int j = 0;
-                    for (i=8, j=0; i < s;) {
-                        char c = levelCode[j++] = levelCode[i++];
-                        if(c == '\n') {
-                            if(s >= i+8 && std::string("--xml-- ").compare(
-                                    0, 8, &(levelCode[i]), 8) == 0) {
-                                i += 8;
-                            }
+        if(!isXML) {
+            if (levelCode.size() >= 8 && std::string("--xml-- ").compare(
+                    0, 8, &(levelCode[0]), 8) == 0) {
+                isXML = true;
+                // delete lua "--xml-- " comments in level code
+                int s = levelCode.size();
+                int i = 0;
+                int j = 0;
+                for (i=8, j=0; i < s;) {
+                    char c = levelCode[j++] = levelCode[i++];
+                    if(c == '\n') {
+                        if(s >= i+8 && std::string("--xml-- ").compare(
+                                0, 8, &(levelCode[i]), 8) == 0) {
+                            i += 8;
                         }
                     }
-                    levelCode.resize(j);
-                } else if (!onlyMetadata){
-                    // handle pure lua
-                    // load plain lua file
-                    doc = NULL;
-                    const char *buffer = reinterpret_cast<const char *>(&levelCode[0]);
-                    // add debugging info to lua code
-                    std::string luaCode = "--@" + absLevelPath + "\n" + 
-                                buffer;
-                    lua_State *L = lua::LevelState();
-                    if (luaL_dostring(L, luaCode.c_str() ) != 0) {
-                        lua_setglobal (L, "_LASTERROR");
-                        throw XLevelLoading(lua::LastError(L));
-                    }
-                } else {
-                    // ensure that metadata are consistent - called for all
-                    // new commanline lua levels
-                    if (releaseVersion == 0)
-                        releaseVersion = 1;
                 }
+                levelCode.resize(j);
+            } else if (!onlyMetadata){
+                // handle pure lua
+                // load plain lua file
+                doc = NULL;
+                const char *buffer = reinterpret_cast<const char *>(&levelCode[0]);
+                // add debugging info to lua code
+                std::string luaCode = "--@" + absLevelPath + "\n" + 
+                            buffer;
+                lua_State *L = lua::LevelState();
+                if (luaL_dostring(L, luaCode.c_str() ) != 0) {
+                    lua_setglobal (L, "_LASTERROR");
+                    throw XLevelLoading(lua::LastError(L));
+                }
+            } else {
+                // ensure that metadata are consistent - called for all
+                // new commanline lua levels
+                if (releaseVersion == 0)
+                    releaseVersion = 1;
             }
         }
+        
         if (isXML) {
+            // count XML header lines for proper Lua line count messages
+            static const char *luaId = "<el:luamain><![CDATA[";
+            int codeSize = levelCode.size();
+            headerLines = 0;
+            int idPtr = 0;
+            bool pendingCR = false;
+            for (int i = 0; i < codeSize; i++) {
+                char c = levelCode[i];
+                if (pendingCR && c == '\n') {
+                    pendingCR = false;
+                } else if (c == '\r') {
+                    headerLines++;
+                    pendingCR = true;
+                    idPtr = 0;
+                } else if (c == '\n') {
+                    headerLines++;
+                    pendingCR = false;
+                    idPtr = 0;
+                } else if (c == luaId[idPtr]) {
+                    idPtr++;
+                    if (idPtr == 20) {
+                        break;
+                    }
+                }
+            }
+            
+            // load XML
             try {
                 std::ostringstream errStream;
                 app.domParserErrorHandler->resetErrors();
                 app.domParserErrorHandler->reportToOstream(&errStream);
                 app.domParserSchemaResolver->resetResolver();
                 app.domParserSchemaResolver->addSchemaId("level.xsd","level.xsd");
-                if (!useFileLoader) {
-                    // local xml file or URL
-                    doc = app.domParser->parseURI(absLevelPath.c_str());
-                } else {
-                    // preloaded lua-commented xml or zipped xml
+                
+                // preloaded lua-commented xml or zipped xml
 #if _XERCES_VERSION >= 30000
-                    std::auto_ptr<DOMLSInput> domInputLevelSource ( new Wrapper4InputSource(
-                            new MemBufInputSource(reinterpret_cast<const XMLByte *>(&(levelCode[0])),
-                            levelCode.size(), absLevelPath.c_str(), false)));
-                    doc = app.domParser->parse(domInputLevelSource.get());
+                std::auto_ptr<DOMLSInput> domInputLevelSource ( new Wrapper4InputSource(
+                        new MemBufInputSource(reinterpret_cast<const XMLByte *>(&(levelCode[0])),
+                        levelCode.size(), absLevelPath.c_str(), false)));
+                doc = app.domParser->parse(domInputLevelSource.get());
 #else    
-                    std::auto_ptr<Wrapper4InputSource> domInputLevelSource ( new Wrapper4InputSource(
-                            new MemBufInputSource(reinterpret_cast<const XMLByte *>(&(levelCode[0])),
-                            levelCode.size(), absLevelPath.c_str(), false)));
-                    doc = app.domParser->parse(*domInputLevelSource);
+                std::auto_ptr<Wrapper4InputSource> domInputLevelSource ( new Wrapper4InputSource(
+                        new MemBufInputSource(reinterpret_cast<const XMLByte *>(&(levelCode[0])),
+                        levelCode.size(), absLevelPath.c_str(), false)));
+                doc = app.domParser->parse(*domInputLevelSource);
 #endif
-                }
                 if (doc != NULL && !app.domParserErrorHandler->getSawErrors()) {
                     infoElem = dynamic_cast<DOMElement *>(doc->getElementsByTagNameNS(
                             levelNS, Utf8ToXML("info").x_str())->item(0));
@@ -950,7 +970,7 @@
         if (luamainList->getLength() == 1) {
             DOMElement *luamain  = dynamic_cast<DOMElement *>(luamainList->item(0));
             // add debugging info to lua code
-            std::string luaCode = "--@" + absLevelPath + "\n" + 
+            std::string luaCode = "--@" + absLevelPath + std::string(headerLines, '\n') +
                         XMLtoUtf8(luamain->getTextContent()).c_str();
             if (luaL_dostring(L, luaCode.c_str() ) != 0) {
                 lua_setglobal (L, "_LASTERROR");

Modified: trunk/src/lev/Proxy.hh
===================================================================
--- trunk/src/lev/Proxy.hh	2009-07-21 21:22:28 UTC (rev 1766)
+++ trunk/src/lev/Proxy.hh	2009-07-21 22:15:02 UTC (rev 1767)
@@ -165,6 +165,7 @@
         static std::vector<Proxy *> registeredLibs;
         static void releaseLibs();
         
+        int headerLines;
         bool isLibraryFlag;
         bool isMultiFlag;
         pathType normPathType;



From ral at mail.berlios.de  Wed Jul 22 00:56:37 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 22 Jul 2009 00:56:37 +0200
Subject: [Enigma-game-svn] r1768 - trunk/src/others
Message-ID: <200907212256.n6LMubiG023055@sheep.berlios.de>

Author: ral
Date: 2009-07-22 00:56:27 +0200 (Wed, 22 Jul 2009)
New Revision: 1768

Modified:
   trunk/src/others/Rubberband.cc
Log:
Trunk 1.1:
- partial fix of crashes on multiple rubberbands with other anchors that
  all use the same name while getting connected.
  Note: never rename an object that while it is connected to a rubberband
    or a wire


Modified: trunk/src/others/Rubberband.cc
===================================================================
--- trunk/src/others/Rubberband.cc	2009-07-21 22:15:02 UTC (rev 1767)
+++ trunk/src/others/Rubberband.cc	2009-07-21 22:56:27 UTC (rev 1768)
@@ -307,9 +307,7 @@
             }            
         }
         if (newAnchor != NULL) {
-            ObjectList olist = newAnchor->getAttr("rubbers");
-            olist.push_back(this);
-            newAnchor->setAttr("rubbers", olist);
+            ObjectList olist;
             if (otherAnchor != NULL) {
                 // check on existing rubberbands between anchors
                 olist = newAnchor->getAttr("fellows");
@@ -337,6 +335,9 @@
                 olist.push_back(newAnchor);
                 otherAnchor->setAttr("fellows", olist);
             }
+            olist = newAnchor->getAttr("rubbers");
+            olist.push_back(this);
+            newAnchor->setAttr("rubbers", olist);
         }
     }
 



From a_abraham at mail.berlios.de  Wed Jul 22 20:48:13 2009
From: a_abraham at mail.berlios.de (a_abraham at mail.berlios.de)
Date: Wed, 22 Jul 2009 20:48:13 +0200
Subject: [Enigma-game-svn] r1769 - trunk/data/gfx/flags25x15
Message-ID: <200907221848.n6MImD9v004610@sheep.berlios.de>

Author: a_abraham
Date: 2009-07-22 20:47:20 +0200 (Wed, 22 Jul 2009)
New Revision: 1769

Modified:
   trunk/data/gfx/flags25x15/gr-shaded.png
Log:
Added shaded flag for greece.


Modified: trunk/data/gfx/flags25x15/gr-shaded.png
===================================================================
(Binary files differ)



From ral at mail.berlios.de  Thu Jul 23 00:56:37 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 23 Jul 2009 00:56:37 +0200
Subject: [Enigma-game-svn] r1770 - trunk/src
Message-ID: <200907222256.n6MMubeP020120@sheep.berlios.de>

Author: ral
Date: 2009-07-23 00:56:34 +0200 (Thu, 23 Jul 2009)
New Revision: 1770

Modified:
   trunk/src/Object.cc
   trunk/src/lua.cc
   trunk/src/stones.cc
Log:
Trunk 1.1:
- second part of fix r1768: repair broken fellow attributes on renaming
    and name clashes.
- keep wires and rubberbands on stone transformation like st_ghost, st_magic
    st_blur


Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2009-07-22 18:47:20 UTC (rev 1769)
+++ trunk/src/Object.cc	2009-07-22 22:56:34 UTC (rev 1770)
@@ -196,7 +196,7 @@
                 objFlags |= OBJBIT_NOP;
             else
                 objFlags &= ~OBJBIT_NOP;
-        
+            
         } else if (val) {        // only set non-default values
             if (val.getType() == Value::NIL /*&& server::EnigmaCompatibility >= 1.10*/)
                 // delete attribute
@@ -209,9 +209,37 @@
     
     void Object::setAttrChecked(const std::string& key, const Value &val) {
         // allow all user attributes and those system attributes with write allowance
-        if (key == "name")
+        if (key == "name") {
+            std::string oldName = getAttr("name").to_string();
+            std::string newName = val.to_string();
+            bool isRename =  oldName.size() > 0 && newName != oldName;
+            
+            // on name clash unname other object with same name and repair all fellow references
+            Object *victim = GetNamedObject(newName);
+            if (victim != NULL) {
+                UnnameObject(victim);
+                ObjectList olist = victim->getAttr("fellows");
+                for (ObjectList::iterator itr = olist.begin(); itr != olist.end(); ++itr) {
+                    ObjectList olist2 = (*itr)->getAttr("fellows");
+                    olist2.remove(NULL);
+                    olist2.push_back(victim);
+                    (*itr)->setAttr("fellows", olist2);
+                }
+            }
+            
             NameObject(this, val.to_string());
-        else if (key.find('_') == 0 || ObjectValidator::instance()->validateAttributeWrite(this, key, val))
+            
+            // in case of a renaming repair all fellow reference that will now be NULL instead of this
+            if (isRename) {
+                ObjectList olist = getAttr("fellows");
+                for (ObjectList::iterator itr = olist.begin(); itr != olist.end(); ++itr) {
+                    ObjectList olist2 = (*itr)->getAttr("fellows");
+                    olist2.remove(NULL);
+                    olist2.push_back(this);
+                    (*itr)->setAttr("fellows", olist2);
+                }
+            }
+        } else if (key.find('_') == 0 || ObjectValidator::instance()->validateAttributeWrite(this, key, val))
             setAttr(key, val);
         else
             ASSERT(false, XLevelRuntime, ecl::strf("Object: attribute '%s' write not allowed for kind '%s'",

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2009-07-22 18:47:20 UTC (rev 1769)
+++ trunk/src/lua.cc	2009-07-22 22:56:34 UTC (rev 1770)
@@ -1299,7 +1299,7 @@
             obj->setAttrChecked(key, to_value(L, -2));  // name set gets handeled by Object
          } else if (lua_tointeger(L, -1) == 2) {  // second entry without a string key is taken as name
              if (!lua_isnumber(L, -2) && lua_isstring(L, -2))
-                 NameObject(obj, lua_tostring(L, -2));
+                 obj->setAttrChecked("name", lua_tostring(L, -2));
          }
          lua_pop(L, 2);  // remove copy key + value, leave original key for loop
     }    

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2009-07-22 18:47:20 UTC (rev 1769)
+++ trunk/src/stones.cc	2009-07-22 22:56:34 UTC (rev 1770)
@@ -1,5 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -42,6 +43,14 @@
 void Stone::transform(std::string kind) {
     Stone *newStone = MakeStone(kind.c_str());
     transferIdentity(newStone);          // subclasses may hook this call
+    ObjectList olist = getAttr("rubbers");
+    for (ObjectList::iterator itr = olist.begin(); itr != olist.end(); ++itr) {
+        (*itr)->setAttr("anchor2", newStone);
+    }
+    olist = getAttr("wires");
+    for (ObjectList::iterator itr = olist.begin(); itr != olist.end(); ++itr) {
+        (*itr)->setAttr((this == (*itr)->getAttr("anchor1")) ? "anchor1" : "anchor2", newStone);
+    }
     SetStone(get_pos(), newStone);
 }
 



From a_abraham at mail.berlios.de  Sat Jul 25 20:43:11 2009
From: a_abraham at mail.berlios.de (a_abraham at mail.berlios.de)
Date: Sat, 25 Jul 2009 20:43:11 +0200
Subject: [Enigma-game-svn] r1771 - in trunk/src: . gui lev
Message-ID: <200907251843.n6PIhBIK008305@sheep.berlios.de>

Author: a_abraham
Date: 2009-07-25 20:43:08 +0200 (Sat, 25 Jul 2009)
New Revision: 1771

Modified:
   trunk/src/gui/OptionsMenu.cc
   trunk/src/lev/ScoreManager.cc
   trunk/src/lev/ScoreManager.hh
   trunk/src/main.cc
Log:
Upload functionality added
- libcurl is used to post data
- option added to enable/disable upload
- setting for web-address



Modified: trunk/src/gui/OptionsMenu.cc
===================================================================
--- trunk/src/gui/OptionsMenu.cc	2009-07-22 22:56:34 UTC (rev 1770)
+++ trunk/src/gui/OptionsMenu.cc	2009-07-25 18:43:08 UTC (rev 1771)
@@ -139,6 +139,9 @@
         RatingsUpdateButton() : BoolOptionButton("RatingsAutoUpdate", N_("Auto"), N_("Never"), this) {}
     };
 
+    struct ScoreUploadButton : public BoolOptionButton {
+        ScoreUploadButton() : BoolOptionButton("ScoreAutoUpload", N_("Always"), N_("Never"), this) {}
+    };
 
 
     /* -------------------- VideoModeButton -------------------- */
@@ -492,6 +495,7 @@
                 OPTIONS_NEW_LB(N_("Sound volume: "), new SoundVolumeButton())
                 OPTIONS_NEW_LB(N_("Music volume: "), new MusicVolumeButton())
                 OPTIONS_NEW_LB(N_("Ratings update: "), new RatingsUpdateButton())
+                OPTIONS_NEW_LB(N_("Score upload: "), new ScoreUploadButton())
                 userNameTF = new TextField(app.state->getString("UserName"));
                 userNameTF->setMaxChars(20);
                 userNameTF->setInvalidChars("+");

Modified: trunk/src/lev/ScoreManager.cc
===================================================================
--- trunk/src/lev/ScoreManager.cc	2009-07-22 22:56:34 UTC (rev 1770)
+++ trunk/src/lev/ScoreManager.cc	2009-07-25 18:43:08 UTC (rev 1771)
@@ -35,6 +35,9 @@
 #include "main.hh"
 #include "options.hh"
 
+#include <curl/curl.h>
+#include <curl/easy.h>
+
 #include <cmath>
 #include <ctime>
 #include <iostream>
@@ -138,7 +141,7 @@
                 hasValidStateUserId = true;
                 Log << "User id '" << stateUserId << "'\n";
             } else 
-                Log << "Bad user id '" << ecl::strf("%.4lX %.4lX %.4lX %.4lX",i1, i2,i3, i4) << "'\n";
+                Log << "Bad user id '" << ecl::strf("%.4lX %.4lX %.4lX %.4lX",i1, i2, i3, i4) << "'\n";
                 
         }
         
@@ -168,7 +171,7 @@
                 std::ostringstream content;
                 readFromZipStream(zipStream, content);
                 std::string score = content.str();
- #if _XERCES_VERSION >= 30000
+#if _XERCES_VERSION >= 30000
                 std::auto_ptr<DOMLSInput> domInputScoreSource ( new Wrapper4InputSource(
                         new MemBufInputSource(reinterpret_cast<const XMLByte *>(score.c_str()),
                         score.size(), "", false)));
@@ -332,7 +335,7 @@
         int len = target.size();
         unsigned r = 0;
         const char *p = target.c_str();
-        
+
         while (len--)
             r = (r<<8 & 0xFFFF) ^ ctab[(r >> 8) ^ *p++];
         return ecl::strf("%.4lX", r); 
@@ -509,12 +512,13 @@
             m.manage();          
         } else
             Log << "Score save o.k.\n";
-        
+
         return result;
     }
 
     void ScoreManager::shutdown() {
         save();
+        upload();
         if (doc != NULL)
             doc->release();
         doc = NULL;
@@ -1139,4 +1143,66 @@
         }
         return result;
     }
+
+    /*
+     * Post the score file to an internet upload server
+     */
+    int ScoreManager::upload() {
+      CURL *curl;
+      CURLcode res;
+
+      struct curl_httppost *formpost=NULL;
+      struct curl_httppost *lastptr=NULL;
+      std::string scoreBasePath = app.userPath + "/enigma.score";
+      std::string uploadURL;
+      app.prefs->getProperty("ScoreUploadURL", uploadURL);
+
+      if (app.prefs->getBool("ScoreAutoUpload") == true &&
+	  !app.state->getString("UserName").empty() &&
+	  doc != NULL && isModified)
+      {
+	Log << "Sending score to " << uploadURL << "\n";
+
+	curl_global_init(CURL_GLOBAL_ALL);
+
+	/* Fill in the file upload field and the submit field */
+	curl_formadd(&formpost, &lastptr,
+		     CURLFORM_COPYNAME, "uploaded_file",
+		     CURLFORM_FILE, scoreBasePath.c_str(), CURLFORM_END);
+	curl_formadd(&formpost, &lastptr,
+		     CURLFORM_COPYNAME, "submit",
+		     CURLFORM_COPYCONTENTS, "Upload", CURLFORM_END);
+	
+	curl = curl_easy_init();
+	if(curl) {
+	  std::string agent = "Enigma "; 
+	  std::ostringstream ostr;
+	  ostr << app.getEnigmaVersion(); // setprecision?
+	  std::string strValue = ostr.str();
+	  agent.append(ostr.str());
+#if MACOSX
+	  agent.append(", MacOSX, User ");
+#elif __MINGW32__
+	  agent.append(", Windows, User ");
+#else
+	  agent.append(", Linux, User ");
+#endif
+	  agent.append(app.state->getString("UserName"));
+
+	  curl_easy_setopt(curl, CURLOPT_URL, uploadURL.c_str());
+	  curl_easy_setopt(curl, CURLOPT_USERAGENT, agent.c_str());
+	  curl_easy_setopt(curl, CURLOPT_HTTPPOST, formpost);
+
+	  res = curl_easy_perform(curl);
+	  if (res != 0)
+	    Log << "Libcurl error " << res << " on upload.\n";
+	  
+	  curl_easy_cleanup(curl);
+	  curl_formfree(formpost);
+	} else
+	  Log << "Could not init libcurl.\n";
+      }
+      return 0;
+    }
+
 }} // namespace enigma::lev

Modified: trunk/src/lev/ScoreManager.hh
===================================================================
--- trunk/src/lev/ScoreManager.hh	2009-07-22 22:56:34 UTC (rev 1770)
+++ trunk/src/lev/ScoreManager.hh	2009-07-25 18:43:08 UTC (rev 1771)
@@ -121,7 +121,12 @@
         bool hasValidUserId;
         bool didUpgrade;
         bool isModified;
-        
+
+        /**
+         * Uploads the score file to a server.
+         */
+        int upload();
+      
         void finishUserId(unsigned id3);
         std::string sec(std::string target);
         XERCES_CPP_NAMESPACE_QUALIFIER DOMElement * getLevel(lev::Proxy *levelProxy);

Modified: trunk/src/main.cc
===================================================================
--- trunk/src/main.cc	2009-07-22 22:56:34 UTC (rev 1770)
+++ trunk/src/main.cc	2009-07-25 18:43:08 UTC (rev 1771)
@@ -656,6 +656,9 @@
 }	
 
 void Application::initUserDatapaths() {
+
+    app.prefs->setProperty("ScoreUploadURL", "http://enigma.bplaced.net/enigma.php");
+
     // userPath
     userPath = prefs->getString("UserPath");
     if (userPath.empty()) {



From ral at mail.berlios.de  Sat Jul 25 22:10:43 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 25 Jul 2009 22:10:43 +0200
Subject: [Enigma-game-svn] r1772 - in trunk/src: . gui lev
Message-ID: <200907252010.n6PKAhlc017914@sheep.berlios.de>

Author: ral
Date: 2009-07-25 22:10:43 +0200 (Sat, 25 Jul 2009)
New Revision: 1772

Modified:
   trunk/src/gui/OptionsMenu.cc
   trunk/src/lev/ScoreManager.cc
   trunk/src/lev/ScoreManager.hh
   trunk/src/main.cc
Log:
trunk 1.1:
- revert unauthorized trunk change of r1771 by Andreas Abraham



Modified: trunk/src/gui/OptionsMenu.cc
===================================================================
--- trunk/src/gui/OptionsMenu.cc	2009-07-25 18:43:08 UTC (rev 1771)
+++ trunk/src/gui/OptionsMenu.cc	2009-07-25 20:10:43 UTC (rev 1772)
@@ -139,9 +139,6 @@
         RatingsUpdateButton() : BoolOptionButton("RatingsAutoUpdate", N_("Auto"), N_("Never"), this) {}
     };
 
-    struct ScoreUploadButton : public BoolOptionButton {
-        ScoreUploadButton() : BoolOptionButton("ScoreAutoUpload", N_("Always"), N_("Never"), this) {}
-    };
 
 
     /* -------------------- VideoModeButton -------------------- */
@@ -495,7 +492,6 @@
                 OPTIONS_NEW_LB(N_("Sound volume: "), new SoundVolumeButton())
                 OPTIONS_NEW_LB(N_("Music volume: "), new MusicVolumeButton())
                 OPTIONS_NEW_LB(N_("Ratings update: "), new RatingsUpdateButton())
-                OPTIONS_NEW_LB(N_("Score upload: "), new ScoreUploadButton())
                 userNameTF = new TextField(app.state->getString("UserName"));
                 userNameTF->setMaxChars(20);
                 userNameTF->setInvalidChars("+");

Modified: trunk/src/lev/ScoreManager.cc
===================================================================
--- trunk/src/lev/ScoreManager.cc	2009-07-25 18:43:08 UTC (rev 1771)
+++ trunk/src/lev/ScoreManager.cc	2009-07-25 20:10:43 UTC (rev 1772)
@@ -35,9 +35,6 @@
 #include "main.hh"
 #include "options.hh"
 
-#include <curl/curl.h>
-#include <curl/easy.h>
-
 #include <cmath>
 #include <ctime>
 #include <iostream>
@@ -141,7 +138,7 @@
                 hasValidStateUserId = true;
                 Log << "User id '" << stateUserId << "'\n";
             } else 
-                Log << "Bad user id '" << ecl::strf("%.4lX %.4lX %.4lX %.4lX",i1, i2, i3, i4) << "'\n";
+                Log << "Bad user id '" << ecl::strf("%.4lX %.4lX %.4lX %.4lX",i1, i2,i3, i4) << "'\n";
                 
         }
         
@@ -171,7 +168,7 @@
                 std::ostringstream content;
                 readFromZipStream(zipStream, content);
                 std::string score = content.str();
-#if _XERCES_VERSION >= 30000
+ #if _XERCES_VERSION >= 30000
                 std::auto_ptr<DOMLSInput> domInputScoreSource ( new Wrapper4InputSource(
                         new MemBufInputSource(reinterpret_cast<const XMLByte *>(score.c_str()),
                         score.size(), "", false)));
@@ -335,7 +332,7 @@
         int len = target.size();
         unsigned r = 0;
         const char *p = target.c_str();
-
+        
         while (len--)
             r = (r<<8 & 0xFFFF) ^ ctab[(r >> 8) ^ *p++];
         return ecl::strf("%.4lX", r); 
@@ -512,13 +509,12 @@
             m.manage();          
         } else
             Log << "Score save o.k.\n";
-
+        
         return result;
     }
 
     void ScoreManager::shutdown() {
         save();
-        upload();
         if (doc != NULL)
             doc->release();
         doc = NULL;
@@ -1143,66 +1139,4 @@
         }
         return result;
     }
-
-    /*
-     * Post the score file to an internet upload server
-     */
-    int ScoreManager::upload() {
-      CURL *curl;
-      CURLcode res;
-
-      struct curl_httppost *formpost=NULL;
-      struct curl_httppost *lastptr=NULL;
-      std::string scoreBasePath = app.userPath + "/enigma.score";
-      std::string uploadURL;
-      app.prefs->getProperty("ScoreUploadURL", uploadURL);
-
-      if (app.prefs->getBool("ScoreAutoUpload") == true &&
-	  !app.state->getString("UserName").empty() &&
-	  doc != NULL && isModified)
-      {
-	Log << "Sending score to " << uploadURL << "\n";
-
-	curl_global_init(CURL_GLOBAL_ALL);
-
-	/* Fill in the file upload field and the submit field */
-	curl_formadd(&formpost, &lastptr,
-		     CURLFORM_COPYNAME, "uploaded_file",
-		     CURLFORM_FILE, scoreBasePath.c_str(), CURLFORM_END);
-	curl_formadd(&formpost, &lastptr,
-		     CURLFORM_COPYNAME, "submit",
-		     CURLFORM_COPYCONTENTS, "Upload", CURLFORM_END);
-	
-	curl = curl_easy_init();
-	if(curl) {
-	  std::string agent = "Enigma "; 
-	  std::ostringstream ostr;
-	  ostr << app.getEnigmaVersion(); // setprecision?
-	  std::string strValue = ostr.str();
-	  agent.append(ostr.str());
-#if MACOSX
-	  agent.append(", MacOSX, User ");
-#elif __MINGW32__
-	  agent.append(", Windows, User ");
-#else
-	  agent.append(", Linux, User ");
-#endif
-	  agent.append(app.state->getString("UserName"));
-
-	  curl_easy_setopt(curl, CURLOPT_URL, uploadURL.c_str());
-	  curl_easy_setopt(curl, CURLOPT_USERAGENT, agent.c_str());
-	  curl_easy_setopt(curl, CURLOPT_HTTPPOST, formpost);
-
-	  res = curl_easy_perform(curl);
-	  if (res != 0)
-	    Log << "Libcurl error " << res << " on upload.\n";
-	  
-	  curl_easy_cleanup(curl);
-	  curl_formfree(formpost);
-	} else
-	  Log << "Could not init libcurl.\n";
-      }
-      return 0;
-    }
-
 }} // namespace enigma::lev

Modified: trunk/src/lev/ScoreManager.hh
===================================================================
--- trunk/src/lev/ScoreManager.hh	2009-07-25 18:43:08 UTC (rev 1771)
+++ trunk/src/lev/ScoreManager.hh	2009-07-25 20:10:43 UTC (rev 1772)
@@ -121,12 +121,7 @@
         bool hasValidUserId;
         bool didUpgrade;
         bool isModified;
-
-        /**
-         * Uploads the score file to a server.
-         */
-        int upload();
-      
+        
         void finishUserId(unsigned id3);
         std::string sec(std::string target);
         XERCES_CPP_NAMESPACE_QUALIFIER DOMElement * getLevel(lev::Proxy *levelProxy);

Modified: trunk/src/main.cc
===================================================================
--- trunk/src/main.cc	2009-07-25 18:43:08 UTC (rev 1771)
+++ trunk/src/main.cc	2009-07-25 20:10:43 UTC (rev 1772)
@@ -656,9 +656,6 @@
 }	
 
 void Application::initUserDatapaths() {
-
-    app.prefs->setProperty("ScoreUploadURL", "http://enigma.bplaced.net/enigma.php");
-
     // userPath
     userPath = prefs->getString("UserPath");
     if (userPath.empty()) {



From ral at mail.berlios.de  Sun Jul 26 13:45:22 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 26 Jul 2009 13:45:22 +0200
Subject: [Enigma-game-svn] r1773 - in trunk: data/schemas src/gui src/lev
Message-ID: <200907261145.n6QBjMrk026370@sheep.berlios.de>

Author: ral
Date: 2009-07-26 13:45:01 +0200 (Sun, 26 Jul 2009)
New Revision: 1773

Modified:
   trunk/data/schemas/index.xml
   trunk/src/gui/LevelPackConfig.cc
   trunk/src/gui/LevelPackConfig.hh
   trunk/src/lev/PersistentIndex.cc
   trunk/src/lev/PersistentIndex.hh
Log:
Trunk 1.1: 
- add levels/sokoballs as another folder for sokoban based levelpacks:
  - LevelPackConfig shows flag "Sokoball", values "yes", "no"
  - on new levelpacks this flag can be set and the storage path will be adjusted


Modified: trunk/data/schemas/index.xml
===================================================================
--- trunk/data/schemas/index.xml	2009-07-25 20:10:43 UTC (rev 1772)
+++ trunk/data/schemas/index.xml	2009-07-26 11:45:01 UTC (rev 1773)
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd" >
-  <info title="" group="" owner="" location="200000" release="1" revision="1" network="false" enigma="1.00"/>
+  <info title="" group="" owner="" location="200000" release="1" revision="1" network="false" enigma="1.10"/>
   <attributes/>
   <levels>
   </levels>

Modified: trunk/src/gui/LevelPackConfig.cc
===================================================================
--- trunk/src/gui/LevelPackConfig.cc	2009-07-25 20:10:43 UTC (rev 1772)
+++ trunk/src/gui/LevelPackConfig.cc	2009-07-26 11:45:01 UTC (rev 1773)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2006, 2007 Ronald Lamprecht
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -79,8 +79,27 @@
         ImageButton::draw(gc, r);
     }
     
+    /* -------------------- Sokoball Button -------------------- */
+
+    SokoballButton::SokoballButton(bool initialMode) : TextButton(this) {
+        mode = initialMode;
+    }
+
+    void SokoballButton::on_action(Widget *) {
+        mode = !mode;
+        invalidate();
+    }
     
+    std::string SokoballButton::get_text() const {
+        return mode ? N_("Yes") : N_("No");
+    }
     
+    bool SokoballButton::isSokoball() {
+        return mode;
+    }
+    
+    /* -------------------- LevelPackConfig -------------------- */
+    
     LevelPackConfig::LevelPackConfig(std::string indexName, std::string groupName,
             bool forceGroupReasign) : isReasignOnly (forceGroupReasign), 
             undo_quit (false), didEditMetaData (false), titleTF (NULL) {
@@ -216,6 +235,7 @@
             but_metadata = new StaticTextButton(N_("Edit Metadata"), this);
         else
             but_metadata = new Label();
+        Label * sokoballLabel = new Label("Sokoball:", HALIGN_RIGHT);
         Label * releaseLabel = new Label(N_("Release:"), HALIGN_RIGHT);
         Label * revisionLabel = new Label(N_("Revision:"), HALIGN_RIGHT);
         Label * compatibilityLabel = new Label(N_("Compatibility:"), HALIGN_RIGHT);
@@ -224,20 +244,20 @@
         
         if (!isReasignOnly) {
             metaVList->add_back(but_metadata);
-            metaVList->add_back(new Label());
-	    if (WizardMode) {
-		metaVList->add_back(releaseLabel);
-		metaVList->add_back(revisionLabel);
-	    } else {
-		metaVList->add_back(new Label());
-		metaVList->add_back(new Label());
-	    }
+            metaVList->add_back(sokoballLabel);
+            if (WizardMode) {
+                metaVList->add_back(releaseLabel);
+                metaVList->add_back(revisionLabel);
+            } else {
+                metaVList->add_back(new Label());
+                metaVList->add_back(new Label());
+            }
             metaVList->add_back(crossmodeLabel);
-	    if (WizardMode) {
-		metaVList->add_back(compatibilityLabel);
-	    } else {
-		metaVList->add_back(new Label());
-	    }
+            if (WizardMode) {
+                metaVList->add_back(compatibilityLabel);
+            } else {
+                metaVList->add_back(new Label());
+            }
             metaVList->add_back(defLocationLabel);
             metaVList->add_back(new Label());
         }
@@ -247,12 +267,16 @@
         valueMetaVList->set_alignment(HALIGN_CENTER, VALIGN_CENTER);
         valueMetaVList->set_default_size(vshrink?37:75, vshrink?17:35);
         Widget * levelmodeWidget;
+        Widget * sokoballValueWidget;
         if (indexName.empty()){
             levelmode = new LevelmodeButton(false);
             levelmodeWidget = levelmode;
+            sokoballValueButton = new SokoballButton(false);
+            sokoballValueWidget = sokoballValueButton;
         } else {
             levelmodeWidget = new Image(isPersistent && !(persIndex->isCross()) ?
                     "ic-link_copy" : "ic-link");
+            sokoballValueWidget = new Label(isPersistent && (persIndex->getPackPath().find("sokoballs/") == 0) ? "yes" : "no");
         }
         defLocationValueLabel = new Label(ecl::strf("%g", packIndex->getDefaultLocation()));
         releaseValueLabel = new Label(isPersistent ? ecl::strf("%d", persIndex->getRelease()) : "-");
@@ -261,20 +285,20 @@
         
         if (!isReasignOnly) {
             valueMetaVList->add_back(new Label());
-            valueMetaVList->add_back(new Label());
-	    if (WizardMode) {
-            valueMetaVList->add_back(releaseValueLabel);
-            valueMetaVList->add_back(revisionValueLabel);
-	    } else {
-            valueMetaVList->add_back(new Label());
-            valueMetaVList->add_back(new Label());
-	    }
+            valueMetaVList->add_back(sokoballValueWidget);
+            if (WizardMode) {
+                valueMetaVList->add_back(releaseValueLabel);
+                valueMetaVList->add_back(revisionValueLabel);
+            } else {
+                valueMetaVList->add_back(new Label());
+                valueMetaVList->add_back(new Label());
+            }
             valueMetaVList->add_back(levelmodeWidget);
-	    if (WizardMode) {
-            valueMetaVList->add_back(compatibilityValueLabel);
-	    } else {
-            valueMetaVList->add_back(new Label());
-	    }
+            if (WizardMode) {
+                valueMetaVList->add_back(compatibilityValueLabel);
+            } else {
+                valueMetaVList->add_back(new Label());
+            }
             valueMetaVList->add_back(defLocationValueLabel);
             valueMetaVList->add_back(new Label());
         }
@@ -361,17 +385,17 @@
             defLocationTF = new TextField(defLocationValueLabel->getText()); 
             valueMetaVList->exchange_child(defLocationValueLabel, defLocationTF);
             delete defLocationValueLabel;
-	    if (WizardMode) {
-		releaseTF = new TextField(releaseValueLabel->getText()); 
-		valueMetaVList->exchange_child(releaseValueLabel, releaseTF);
-		delete releaseValueLabel;
-		revisionTF = new TextField(revisionValueLabel->getText()); 
-		valueMetaVList->exchange_child(revisionValueLabel, revisionTF);
-		delete revisionValueLabel;
-		compatibilityTF = new TextField(compatibilityValueLabel->getText()); 
-		valueMetaVList->exchange_child(compatibilityValueLabel, compatibilityTF);
-		delete compatibilityValueLabel;
-	    }
+            if (WizardMode) {
+                releaseTF = new TextField(releaseValueLabel->getText()); 
+                valueMetaVList->exchange_child(releaseValueLabel, releaseTF);
+                delete releaseValueLabel;
+                revisionTF = new TextField(revisionValueLabel->getText()); 
+                valueMetaVList->exchange_child(revisionValueLabel, revisionTF);
+                delete revisionValueLabel;
+                compatibilityTF = new TextField(compatibilityValueLabel->getText()); 
+                valueMetaVList->exchange_child(compatibilityValueLabel, compatibilityTF);
+                delete compatibilityValueLabel;
+            }
         }
     }
     
@@ -399,11 +423,12 @@
             newtitle = newtitle.substr(0 , lastChar + 1);
             newtitle = newtitle.substr(newtitle.find_first_not_of(" "));
             if (newtitle != persIndex->getName()) {
+                bool isSokoball = persIndex->getPackPath().find("sokoballs/");
                 if (isNewIndex) {
                     // check for filename usability of title
                     const std::string validChars("_- .#0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");
                     if (newtitle.find_first_not_of(validChars, 0) != std::string::npos ||
-			    (newtitle.length() >= 1 && newtitle[0] == '.')) {
+                            (newtitle.length() >= 1 && newtitle[0] == '.')) {
                         errorLabel->set_text(N_("Error: use only \"a-zA-Z0-9 _-#\" for levelpack title"));
                         return false;               
                     }
@@ -411,8 +436,10 @@
                     // set packPath to cross if link only
                     if (levelmode->isLinkOnly())
                         persIndex->markNewAsCross();
+                    
+                    isSokoball = sokoballValueButton->isSokoball();
                 }
-                if (!persIndex->setName(newtitle)) {
+                if (!persIndex->setName(newtitle, isSokoball)) {
                     errorLabel->set_text(N_("Error: title already in use - choose another title"));
                     return false;
                 }
@@ -439,27 +466,27 @@
                     int i = 0;
                     // check value - keep old value on error 
                     if ((sscanf(releaseTF->getText().c_str(),"%d", &i) == 1) &&
-                	    i > 0) {
-                	persIndex->setRelease(i);
-                	needSave = true;
+                            i > 0) {
+                        persIndex->setRelease(i);
+                        needSave = true;
                     }
                 }
                 if (revisionTF->getText() != ecl::strf("%d", persIndex->getRevision())) {
                     int i = 0;
                     // check value - keep old value on error 
                     if ((sscanf(revisionTF->getText().c_str(),"%d", &i) == 1) &&
-                	    i > 0) {
-                	persIndex->setRevision(i);
-                	needSave = true;
+                            i > 0) {
+                        persIndex->setRevision(i);
+                        needSave = true;
                     }
                 }
                 if (compatibilityTF->getText() != ecl::strf("%.2f", persIndex->getCompatibility())) {
                     double d = 0;
                     // check value - keep old value on error 
                     if ((sscanf(compatibilityTF->getText().c_str(),"%lg", &d) == 1) &&
-                	    d >= 1) {
-                	persIndex->setCompatibility(d);
-                	needSave = true;
+                            d >= 1) {
+                        persIndex->setCompatibility(d);
+                        needSave = true;
                     }
                 }
             }

Modified: trunk/src/gui/LevelPackConfig.hh
===================================================================
--- trunk/src/gui/LevelPackConfig.hh	2009-07-25 20:10:43 UTC (rev 1772)
+++ trunk/src/gui/LevelPackConfig.hh	2009-07-26 11:45:01 UTC (rev 1773)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2006 Ronald Lamprecht
+ * Copyright (C) 2006,2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -39,7 +39,7 @@
 
     class LevelmodeButton : public ImageButton {
         // ActionListener interface.
-        void on_action(Widget *);
+        virtual void on_action(Widget *);
     public:
         LevelmodeButton(bool initialMode = false);
         bool isLinkOnly();
@@ -49,7 +49,20 @@
         bool mode;
     };
 
+    class SokoballButton : public TextButton {
+        // ActionListener interface.
+        virtual void on_action(Widget *);
+        
+        // TextButton interface.
+        virtual std::string get_text() const;
+    public:
+        SokoballButton(bool initialMode = false);
+        bool isSokoball();
+    private:
+        bool mode;
+    };
 
+
     class LevelPackConfig : public gui::Menu {
     public:
         LevelPackConfig (std::string indexName, std::string groupName = "",
@@ -79,6 +92,7 @@
         LevelmodeButton *levelmode;
         Label       *defLocationValueLabel;
         TextField   *defLocationTF;
+        SokoballButton *sokoballValueButton;
         Label       *releaseValueLabel;
         TextField   *releaseTF;
         Label       *revisionValueLabel;

Modified: trunk/src/lev/PersistentIndex.cc
===================================================================
--- trunk/src/lev/PersistentIndex.cc	2009-07-25 20:10:43 UTC (rev 1772)
+++ trunk/src/lev/PersistentIndex.cc	2009-07-26 11:45:01 UTC (rev 1773)
@@ -101,7 +101,8 @@
             dirIter = DirIter::instance(sysPaths[i] + "/levels");
             while (dirIter->get_next(dirEntry)) {
                 if (dirEntry.is_dir && dirEntry.name != "." && dirEntry.name != ".." &&
-                        dirEntry.name != ".svn" && dirEntry.name != "enigma_cross") {
+                        dirEntry.name != ".svn" && dirEntry.name != "enigma_cross" && 
+                        dirEntry.name != "sokoballs") {
                     candidates.insert(dirEntry.name);
                 }
                 else {
@@ -112,6 +113,21 @@
                 }
             }
             delete dirIter;
+            // check for sokoball levelpacks
+            dirIter = DirIter::instance(sysPaths[i] + "/levels/sokoballs");
+            while (dirIter->get_next(dirEntry)) {
+                if (dirEntry.is_dir && dirEntry.name != "." && dirEntry.name != ".." &&
+                        dirEntry.name != ".svn") {
+                    candidates.insert("sokoballs/" + dirEntry.name);
+                }
+                else {
+                    std::string::size_type zipPos = dirEntry.name.rfind(".zip");
+                    if (zipPos != std::string::npos && zipPos == dirEntry.name.size() - 4) {
+                        candidates.insert("sokoballs/" + dirEntry.name.substr(0, dirEntry.name.size() - 4));
+                    }
+                }
+            }
+            delete dirIter;
         }
 
         for (std::set<std::string>::iterator i = candidates.begin(); 
@@ -121,7 +137,7 @@
             // decide if a user copy is an update
             PersistentIndex * anIndex = new PersistentIndex(*i, true);
             anIndex->isUserOwned = false;
-            Log << "precheck: " << *i << "\n";
+//            Log << "precheck: " << *i << "\n";
             checkCandidate(anIndex);
         }
 
@@ -166,7 +182,7 @@
             if (dirEntry.is_dir && dirEntry.name != "." && dirEntry.name != ".." &&
                     dirEntry.name != ".svn" && dirEntry.name != "auto" &&
                     dirEntry.name != "cross" && dirEntry.name != "enigma_cross" && 
-                    dirEntry.name != "legacy_dat") {
+                    dirEntry.name != "legacy_dat" &&  dirEntry.name != "sokoballs") {
                     candidates2.insert(dirEntry.name);
             }
             else {
@@ -177,6 +193,21 @@
             }
         }
         delete dirIter;
+        // User Path: register sokoballs
+        dirIter = DirIter::instance(app.userPath + "/levels/sokoballs");
+        while (dirIter->get_next(dirEntry)) {
+            if (dirEntry.is_dir && dirEntry.name != "." && dirEntry.name != ".." &&
+                    dirEntry.name != ".svn") {
+                    candidates2.insert("sokoballs/" + dirEntry.name);
+            }
+            else {
+                std::string::size_type zipPos = dirEntry.name.rfind(".zip");
+                if (zipPos != std::string::npos && zipPos == dirEntry.name.size() - 4) {
+                        candidates2.insert("sokoballs/" + dirEntry.name.substr(0, dirEntry.name.size() - 4));
+                }
+            }
+        }
+        delete dirIter;
 
         candidates2.insert("");
 #ifdef __MINGW32__
@@ -187,6 +218,7 @@
 #endif
         for (std::set<std::string>::iterator i = candidates2.begin(); 
                 i != candidates2.end(); i++) {
+//            Log << "sokoball candidate2 " << *i << " - check \n";
             PersistentIndex * anIndex = new PersistentIndex(*i, false);
             checkCandidate(anIndex);
         }
@@ -487,7 +519,7 @@
         return packPath;
     }
     
-    bool PersistentIndex::setName(std::string newName) {
+    bool PersistentIndex::setName(std::string newName, bool isSokoball) {
         if (findIndex(newName) != NULL)
             return false;  // do not allow duplicate names
         
@@ -503,7 +535,7 @@
             // generate usabale path name and check it it usable
             if (fileName == "cross" || fileName == "enigma_cross" ||
                     fileName == "legacy_dat" || fileName == "auto" ||
-                    fileName == "history") {
+                    fileName == "sokoballs" || fileName == "history") {
                 return false;
             } 
             // check if the name would conflict with existing files
@@ -516,7 +548,7 @@
                 return false;
             }
             if (packPath == " ") {
-                packPath = fileName;
+                packPath = (isSokoball ? "sokoballs/" : "") + fileName;
                 indexFilename = INDEX_STD_FILENAME;
             } else
                 indexFilename = fileName + ".xml";

Modified: trunk/src/lev/PersistentIndex.hh
===================================================================
--- trunk/src/lev/PersistentIndex.hh	2009-07-25 20:10:43 UTC (rev 1772)
+++ trunk/src/lev/PersistentIndex.hh	2009-07-26 11:45:01 UTC (rev 1773)
@@ -76,7 +76,7 @@
         void load(bool systemOnly, bool update = false);
         void loadDoc();
         std::string getPackPath();
-        bool setName(std::string newName);
+        bool setName(std::string newName, bool isSokoball);
         std::string getOwner();
         void setOwner(std::string newOwner);
         int getRelease();



From ral at mail.berlios.de  Sun Jul 26 22:16:40 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 26 Jul 2009 22:16:40 +0200
Subject: [Enigma-game-svn] r1774 - in trunk: doc/reference
	doc/reference/images lib-src/enigma-core src/gui
Message-ID: <200907262016.n6QKGe0H002550@sheep.berlios.de>

Author: ral
Date: 2009-07-26 22:16:27 +0200 (Sun, 26 Jul 2009)
New Revision: 1774

Added:
   trunk/doc/reference/images/ralD006_1.png
Modified:
   trunk/doc/reference/enigma-ref.texi
   trunk/doc/reference/images/Makefile.am
   trunk/lib-src/enigma-core/ecl_system.cc
   trunk/lib-src/enigma-core/ecl_system.hh
   trunk/src/gui/LevelInspector.cc
   trunk/src/gui/MainMenu.cc
Log:
Trunk 1.1:
- Windows path beautifier to correct separator mixture slashes and backslashes
- refman add missing demo level images 
- refman some fixes and minor additions

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-07-26 11:45:01 UTC (rev 1773)
+++ trunk/doc/reference/enigma-ref.texi	2009-07-26 20:16:27 UTC (rev 1774)
@@ -1363,11 +1363,11 @@
  2    @i{ti}["@var{#}"] = @{"@b{st_box}"@}
  3    @i{ti}["@var{O}"] = @{"@b{st_oxyd}"@}
  4    if @i{wo}["@b{IsDifficult}"] then
- 5	@i{ti}["@var{Q}"] = @{"@b{st_quake}", @b{name}="@var{quake}"@}
- 6	@i{ti}["@var{T}"] = @{"@b{st_timer}", @b{interval}=@var{10.0}, @b{target}="@var{quake}"@}
+ 5        @i{ti}["@var{Q}"] = @{"@b{st_quake}", @b{name}="@var{quake}"@}
+ 6        @i{ti}["@var{T}"] = @{"@b{st_timer}", @b{interval}=@var{10.0}, @b{target}="@var{quake}"@}
  7    else
- 8	@i{ti}["@var{Q}"] = @i{ti}[" "]
- 9	@i{ti}["@var{T}"] = @i{ti}[" "]
+ 8        @i{ti}["@var{Q}"] = @i{ti}[" "]
+ 9        @i{ti}["@var{T}"] = @i{ti}[" "]
 10    end
 11    @i{ti}["@var{@@}"] = @{"@b{ac_marble_black}", @var{0.0}, @var{0.5}@}
 11
@@ -1410,11 +1410,11 @@
 
 @example
  4    if @i{wo}["@b{IsDifficult}"] then
- 5	@i{ti}["@var{Q}"] = @{"@b{st_quake}", @b{name}="@var{quake}"@}
- 6	@i{ti}["@var{T}"] = @{"@b{st_timer}", @b{interval}=@var{10.0}, @b{target}="@var{quake}"@}
+ 5        @i{ti}["@var{Q}"] = @{"@b{st_quake}", @b{name}="@var{quake}"@}
+ 6        @i{ti}["@var{T}"] = @{"@b{st_timer}", @b{interval}=@var{10.0}, @b{target}="@var{quake}"@}
  7    else
- 8	@i{ti}["@var{Q}"] = @i{ti}[" "]
- 9	@i{ti}["@var{T}"] = @i{ti}[" "]
+ 8        @i{ti}["@var{Q}"] = @i{ti}[" "]
+ 9        @i{ti}["@var{T}"] = @i{ti}[" "]
 10    end
 @end example
 
@@ -1442,19 +1442,19 @@
 
 @example
 12    @i{wo}(@i{ti}, " ", @{
-13	"@var{####################}",
-14	"@var{#                  #}",
-15	"@var{#                  #}",
-16	"@var{#  O            O  #}",
-17	"@var{#         @@        #}",
-18	"@var{#                  #}",
-19	"@var{#        QT        #}",
-20	"@var{#                  #}",
-21	"@var{#                  #}",
-22	"@var{#  O            O  #}",
-23	"@var{#                  #}",
-24	"@var{#                  #}",
-25	"@var{####################}"@})
+13        "@var{####################}",
+14        "@var{#                  #}",
+15        "@var{#                  #}",
+16        "@var{#  O            O  #}",
+17        "@var{#         @@        #}",
+18        "@var{#                  #}",
+19        "@var{#        QT        #}",
+20        "@var{#                  #}",
+21        "@var{#                  #}",
+22        "@var{#  O            O  #}",
+23        "@var{#                  #}",
+24        "@var{#                  #}",
+25        "@var{####################}"@})
 @end example
 
 Now we can create the world simply by providing a map. We just need to call
@@ -2039,29 +2039,33 @@
 none.
 
 @item @b{externaldata}, @i{optional, multiple occurrence}
-You can use this element to specify any external data file this level
-depends on. You can specify several files by multiple occurrence of this
+You can use this element to specify any external text data file this level
+depends on. You can specify several files by multiple occurrences of this
 element. Files declared can be read via the Lua interface.
 
-This feature should support levels that simulate foreign games like Sokoban within Enigma. Due
-to copyrights and license conditions, including some data within a level may not be possible.
-However, distributing the data in the original unmodified format may be legal.
+This feature should support levels that simulate foreign games like Sokoban
+within Enigma. Due to copyrights and license conditions, the inclusion of such
+data within a level or even the distribution with Enigma may not be possible.
+However, distributing or downloading the data in the original unmodified format
+may be legal.
 
 @b{Attributes:}
 @table @asis
- at item @b{path}, @i{optional}
-The resource path of the external data file with its suffix. Since the data are usually level-
-specific, you should store them with the level in the same levelpack directory. Thus, a relative
-resource path, such as @samp{./datafile.ext}
-is preferable.
+ at item @b{path}, @i{required}
+The resource path of the external data file without its suffix @samp{.txt}. The
+path has to be either of the format @code{"./name"} for an external data file
+that is locally  stored in the same folder as the level file, or will be saved
+at this position when it gets downloaded. Or the path can be of the format
+ at code{"externaldata/name"} for shared external data files, that are referenced
+by multiple level files stored at different folders. The external data file will
+be locally stored or gets saved in the folder @{"levels/externaldata"}. In any
+case the local name of the external data file will have the suffix @samp{.txt}
+to mark it readable but not executable for the local operating system.
 
 @item @b{url}, @i{optional}
-This optional attribute allows you to specify an online address for the external data
-file. This method can access only well-formed xml data files.
-
-You should use the online access method only as a backup address or due to very restrictive
-license conditions that make it impossible to distribute the data file with Enigma.
-
+This optional attribute allows you to specify an internet download address for
+the external data file. On first access a missing external data file will be
+downloaded and a copy will be stored locally for further access.
 @end table
 
 @b{Contents:}
@@ -2713,7 +2717,7 @@
 sublevel, @code{"[2]"} for the second and so on. Thus every sublevel has an
 unique id. 
 
-Additionally you should provide base title for the levels in this metadata
+Additionally you should provide a base title for the levels in this metadata
 @ref{<identity>} element. If your title ends with a hash @samp{#} sign Enigma
 will autogenerate titles for the sublevels by appending the sublevel number to
 the given common title string.
@@ -2723,8 +2727,8 @@
 only be used as a default title base in case the @ref{LUA code} fails to
 provide a sublevel title. Prior execution of the Lua code the global
 attribute @ref{SublevelNumber} gets initialized. The Lua part has either way to
-load the appropriate sublevel based on this number. Now it has additionally to
-set the second special multilevel global attribute @ref{SublevelTitle}.
+load the appropriate sublevel based on this number. Now it has additionally the
+task to set the second special multilevel global attribute @ref{SublevelTitle}.
 
 
 @ref{<compatibility>} externaldata
@@ -3474,6 +3478,9 @@
 The @ref{Advanced Lua Examples} will show examples of real powerful callback
 functions with a line by line comment.
 
+Further usage and aspects of callbacks in the level's lifecycle are given in
+the section @ref{Callbacks and Load Balancing}.
+
 @c ----------------- Object State --------------------
 @node Object State
 @subsection Object State
@@ -3578,7 +3585,7 @@
 * Level Initialization::
 * Object Transformation::         Identity Transfer in case of Transformations
 * Named Positions::               Positions as successors of killed Floors
-* Callbacks and Timers::
+* Callbacks and Load Balancing::
 * Level Restart::
 * Ending Conditions::
 @end menu
@@ -3687,14 +3694,14 @@
 local used functions that need to be integrated to precede. Please keep such
 functions near by their usage and within the same code section.
 
-Another set of functions that you may want to add are @ref{Callbacks}. We 
-recommend to append these functions as the last section as they are not called
-within the level initialization itself.
+Another set of functions that you may want to add are @ref{Callbacks and Load 
+Balancing}. We recommend to append these functions as the last section as they
+are not called within the level initialization itself.
 
 But there is one very special exception. The @code{postinit()} callback is
 called after the level initialization code has been processed and all subsequent
 engine internal initialization has been finished. If this function is present
-in a level it gets execute directly before the first mouse movement event gets
+in a level it gets executed directly before the first mouse movement event gets
 processed. Thus you can rely within this function that all objects are set up
 in their final state. If you have need of such a postinit callback you should
 put it after all the level intialization code and in front of other callback
@@ -3743,10 +3750,18 @@
 Note that a request for a named position will include all positions of matching
 named objects as well as those named positions derived from killed floors.
 
- at c ----------------- Callbacks and Timers --------------------
- at node Callbacks and Timers
- at subsection Callbacks and Timers
+ at c ----------------- Callbacks and Load Balancing --------------------
+ at node Callbacks and Load Balancing
+ at subsection Callbacks and Load Balancing
 
+The most flexible feature for a level author to establish an unique behaviour
+of his level are @ref{Callback Function}s. 
+
+ at ref{Target - Action} kill warning
+ at ref{ot_timer}
+
+global and res.*.function
+
 @c ----------------- Level Restart --------------------
 @node Level Restart
 @subsection Level Restart
@@ -3907,6 +3922,8 @@
 
 The resulting level looks like this in the game
 
+ at image{images/ralD006_1, 150mm}
+
 Let us now analyse the code line by line.
 
 Lines 1 to 14 are the XML metadata of the level as described in
@@ -11753,15 +11770,21 @@
 
 A magic item that makes the activating actor for 8 seconds invisible. But not
 all actors become invisible. Just the ball like actors @ref{ac_marble} and
- at ref{ac_pearl} do vanish. Other actors just drop the cherry on activation.
+ at ref{ac_pearl} do vanish.
 
 An invisible actor can walk through most kinds of glass 
-(@pxref{Transparent Stones}) and as being invisible
-they do no longer attract hostile @ref{ac_rotor} and @ref{ac_top}.
+(@pxref{Transparent Stones}) and as being invisible they do no longer attract
+hostile @ref{ac_rotor} and @ref{ac_top}.
 
 When several cherries are activated in sequence each does prolong the actor's
 time of invisibility by additional 8 seconds.
 
+Other actors drop the cherry as an @ref{it_squashed} on activation. Sending a 
+cherry via an @ref{st_mail} results in an  @ref{it_squashed}, too. This
+gives you the control that a cherry added to one player's inventory can not be
+easily transfered to other actors assigned to the other player. Just 
+ at ref{st_thief} and @ref{fl_thief} are able to steal the cherry undamaged.
+
 When a stone is pushed over a cherry an @ref{it_squashed} remains as remnants.
 
 @table @asis

Modified: trunk/doc/reference/images/Makefile.am
===================================================================
--- trunk/doc/reference/images/Makefile.am	2009-07-26 11:45:01 UTC (rev 1773)
+++ trunk/doc/reference/images/Makefile.am	2009-07-26 20:16:27 UTC (rev 1774)
@@ -1,5 +1,5 @@
 
-PNG = first_level.png construction.png
+PNG = first_level.png construction.png ralD006_1.png
 
 GFXDIR = ../../../data/gfx48
 

Added: trunk/doc/reference/images/ralD006_1.png
===================================================================
(Binary files differ)


Property changes on: trunk/doc/reference/images/ralD006_1.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Modified: trunk/lib-src/enigma-core/ecl_system.cc
===================================================================
--- trunk/lib-src/enigma-core/ecl_system.cc	2009-07-26 11:45:01 UTC (rev 1773)
+++ trunk/lib-src/enigma-core/ecl_system.cc	2009-07-26 20:16:27 UTC (rev 1774)
@@ -51,12 +51,11 @@
 #endif
 const char *ecl::PathSeparators = "/\\";    // for path splits
 
-string ecl::ExpandPath (const string &pth)
-{
-    string path = pth;
-    string::size_type p=path.find("~");
+std::string ecl::ExpandPath (const string &pth) {
+    std::string path = pth;
+    std::string::size_type p=path.find("~");
     if (p != string::npos) {
-        string home;
+        std::string home;
         if (char *h = getenv("HOME"))
             home = h;
         path.replace(p, 1, home);
@@ -64,6 +63,17 @@
     return path;
 }
 
+std::string ecl::BeautifyPath(const std::string path) {
+    std::string foreignSeparators = ecl::PathSeparators;
+    foreignSeparators.erase(foreignSeparators.find(ecl::PathSeparator));
+    std::string result = path;
+    for (std::string::size_type pos = result.find_first_of(foreignSeparators);
+            pos != std::string::npos; pos = result.find_first_of(foreignSeparators)) {
+        result.replace(pos, 1, ecl::PathSeparator);
+    }
+    return result;
+}
+
 bool ecl::FileExists (const std::string &fname)
 {
     struct stat s;

Modified: trunk/lib-src/enigma-core/ecl_system.hh
===================================================================
--- trunk/lib-src/enigma-core/ecl_system.hh	2009-07-26 11:45:01 UTC (rev 1773)
+++ trunk/lib-src/enigma-core/ecl_system.hh	2009-07-26 20:16:27 UTC (rev 1774)
@@ -30,6 +30,7 @@
     extern const char *PathsSeparator;
 
     std::string ExpandPath (const std::string &path);
+    std::string BeautifyPath(const std::string path);
 
     bool        FileExists (const std::string &fname);
     std::time_t FileModTime (const std::string &fname);

Modified: trunk/src/gui/LevelInspector.cc
===================================================================
--- trunk/src/gui/LevelInspector.cc	2009-07-26 11:45:01 UTC (rev 1773)
+++ trunk/src/gui/LevelInspector.cc	2009-07-26 20:16:27 UTC (rev 1774)
@@ -471,10 +471,12 @@
         }
         if (levelPathLines >= 1) {
             add(new Label(N_("Level Path: "), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
-            std::string workString = levelPathString;
+            bool localSeparator = (levelProxy->getNormPathType() == lev::Proxy::pt_resource) ||
+                        (levelProxy->getNormPathType() == lev::Proxy::pt_absolute);
+            std::string workString = localSeparator ? ecl::BeautifyPath(levelPathString) : levelPathString;
             for (int i = 0; i< levelPathLines - 1; i++) {
                 std::string::size_type breakPos = breakString(menufont, workString, 
-                        "/", textwidth);
+                        localSeparator ? ecl::PathSeparator : "/", textwidth);
                 add(new Label(workString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+(vshrink?55+5:110+10),vnext,textwidth,vshrink?12:25));
                 workString = workString.substr(breakPos);
                 vnext += ((vshrink?12:25) + vspacing);

Modified: trunk/src/gui/MainMenu.cc
===================================================================
--- trunk/src/gui/MainMenu.cc	2009-07-26 11:45:01 UTC (rev 1773)
+++ trunk/src/gui/MainMenu.cc	2009-07-26 20:16:27 UTC (rev 1774)
@@ -250,9 +250,9 @@
         } else if (w == paths) {
             showPaths();
         } else if (w == autofolder) {
-            ecl::ExploreFolder(app.userPath + "/levels/auto");
+            ecl::ExploreFolder(ecl::BeautifyPath(app.userPath + "/levels/auto"));
         } else if (w == scorefolder) {
-            ecl::ExploreFolder(app.userPath);
+            ecl::ExploreFolder(ecl::BeautifyPath(app.userPath));
         } else if (w == credits) {
             displayInfo(credit_text, 6);
         } else if (w == back) {
@@ -280,9 +280,9 @@
         int i = 0;
         
         pathtext[i++] = N_("Preferences Path:");
-        work = app.prefPath;
+        work = ecl::BeautifyPath(app.prefPath);
         do {
-            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
+            std::string::size_type breakPos = breakString(menufont, work, ecl::PathSeparators, width);
             pathstrings[i] = "    " + work.substr(0,breakPos);
             pathtext[i] = pathstrings[i].c_str();
             work = work.substr(breakPos);
@@ -290,9 +290,9 @@
         } while(!work.empty() );
         pathtext[i++] = " ";
         pathtext[i++] = N_("User Path:");
-        work = app.userPath;
+        work = ecl::BeautifyPath(app.userPath);
         do {
-            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
+            std::string::size_type breakPos = breakString(menufont, work, ecl::PathSeparators, width);
             pathstrings[i] = "    " + work.substr(0,breakPos);
             pathtext[i] = pathstrings[i].c_str();
             work = work.substr(breakPos);
@@ -300,9 +300,9 @@
         } while(!work.empty() );
         pathtext[i++] = " ";
         pathtext[i++] = N_("User Image Path:");
-        work = app.userImagePath;
+        work = ecl::BeautifyPath(app.userImagePath);
         do {
-            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
+            std::string::size_type breakPos = breakString(menufont, work, ecl::PathSeparators, width);
             pathstrings[i] = "    " + work.substr(0,breakPos);
             pathtext[i] = pathstrings[i].c_str();
             work = work.substr(breakPos);
@@ -310,9 +310,9 @@
         } while(!work.empty() );
         pathtext[i++] = " ";
         pathtext[i++] = N_("System Path:");
-        work = app.systemFS->getDataPath();
+        work = ecl::BeautifyPath(app.systemFS->getDataPath());
         do {
-            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
+            std::string::size_type breakPos = breakString(menufont, work, ecl::PathSeparators, width);
             pathstrings[i] = "    " + work.substr(0,breakPos);
             pathtext[i] = pathstrings[i].c_str();
             work = work.substr(breakPos);
@@ -320,9 +320,9 @@
         } while(!work.empty() );
         pathtext[i++] = " ";
         pathtext[i++] = N_("Resource Paths:");
-        work = app.resourceFS->getDataPath();
+        work = ecl::BeautifyPath(app.resourceFS->getDataPath());
         do {
-            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
+            std::string::size_type breakPos = breakString(menufont, work, ecl::PathSeparators, width);
             pathstrings[i] = "    " + work.substr(0,breakPos);
             pathtext[i] = pathstrings[i].c_str();
             work = work.substr(breakPos);
@@ -330,9 +330,9 @@
         } while(!work.empty() );
         pathtext[i++] = " ";
         pathtext[i++] = N_("L10n Path:");
-        work = app.l10nPath;
+        work = ecl::BeautifyPath(app.l10nPath);
         do {
-            std::string::size_type breakPos = breakString(menufont, work,"/\\", width);
+            std::string::size_type breakPos = breakString(menufont, work, ecl::PathSeparators, width);
             pathstrings[i] = "    " + work.substr(0,breakPos);
             pathtext[i] = pathstrings[i].c_str();
             work = work.substr(breakPos);



From raoul at mail.berlios.de  Fri Jul 31 02:52:42 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Fri, 31 Jul 2009 02:52:42 +0200
Subject: [Enigma-game-svn] r1775 - trunk/data/levels/enigma_pentomino_i
Message-ID: <200907310052.n6V0qgoq005767@sheep.berlios.de>

Author: raoul
Date: 2009-07-31 02:52:41 +0200 (Fri, 31 Jul 2009)
New Revision: 1775

Added:
   trunk/data/levels/enigma_pentomino_i/pento17_1.xml
   trunk/data/levels/enigma_pentomino_i/pento18_1.xml
   trunk/data/levels/enigma_pentomino_i/pento19_1.xml
Modified:
   trunk/data/levels/enigma_pentomino_i/index.xml
Log:
-> Added missing pentominoes



Modified: trunk/data/levels/enigma_pentomino_i/index.xml
===================================================================
--- trunk/data/levels/enigma_pentomino_i/index.xml	2009-07-26 20:16:27 UTC (rev 1774)
+++ trunk/data/levels/enigma_pentomino_i/index.xml	2009-07-31 00:52:41 UTC (rev 1775)
@@ -21,91 +21,90 @@
     <level _seq="13" _title="Pentomino XIV" _xpath="./pento14_1" author="Enigma Team" ctrl="force" easy="false" id="pento14" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="14" _title="Pentomino XV" _xpath="./pento15_1" author="Enigma Team" ctrl="force" easy="false" id="pento15" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="15" _title="Pentomino XVI" _xpath="./pento16_1" author="Enigma Team" ctrl="force" easy="false" id="pento16" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="16" _title="TODO" _xpath="lib/todo" author="Martin Hawlisch" ctrl="force" easy="false" id="todo" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="17" _title="TODO" _xpath="lib/todo" author="Martin Hawlisch" ctrl="force" easy="false" id="todo" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="18" _title="TODO" _xpath="lib/todo" author="Martin Hawlisch" ctrl="force" easy="false" id="todo" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="19" _title="TODO" _xpath="lib/todo" author="Martin Hawlisch" ctrl="force" easy="false" id="todo" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="20" _title="Pentomino XX" _xpath="./pento20_1" author="Enigma Team" ctrl="force" easy="false" id="pento20" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="21" _title="Pentomino XXI" _xpath="./pento21_1" author="Enigma Team" ctrl="force" easy="false" id="pento21" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="22" _title="Pentomino XXII" _xpath="./pento22_1" author="Enigma Team" ctrl="force" easy="false" id="pento22" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="23" _title="Pentomino XXIII" _xpath="./pento23_1" author="Enigma Team" ctrl="force" easy="false" id="pento23" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="24" _title="Pentomino XXIV" _xpath="./pento24_1" author="Enigma Team" ctrl="force" easy="false" id="pento24" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="25" _title="Pentomino XXV" _xpath="./pento25_1" author="Enigma Team" ctrl="force" easy="false" id="pento25" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="26" _title="Pentomino XXVI" _xpath="./pento26_1" author="Enigma Team" ctrl="force" easy="false" id="pento26" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="27" _title="Pentomino XXVII" _xpath="./pento27_1" author="Enigma Team" ctrl="force" easy="false" id="pento27" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="28" _title="Pentomino XXVIII" _xpath="./pento28_1" author="Enigma Team" ctrl="force" easy="false" id="pento28" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="29" _title="Pentomino XXIX" _xpath="./pento29_1" author="Enigma Team" ctrl="force" easy="false" id="pento29" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="30" _title="Pentomino XXX" _xpath="./pento30_1" author="Enigma Team" ctrl="force" easy="false" id="pento30" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="31" _title="Pentomino XXXI" _xpath="./pento31_1" author="Enigma Team" ctrl="force" easy="false" id="pento31" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="32" _title="Pentomino XXXII" _xpath="./pento32_1" author="Enigma Team" ctrl="force" easy="false" id="pento32" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="33" _title="Pentomino XXXIII" _xpath="./pento33_1" author="Enigma Team" ctrl="force" easy="false" id="pento33" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="34" _title="Pentomino XXXIV" _xpath="./pento34_1" author="Enigma Team" ctrl="force" easy="false" id="pento34" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="35" _title="Pentomino XXXV" _xpath="./pento35_1" author="Enigma Team" ctrl="force" easy="false" id="pento35" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="36" _title="Pentomino XXXVI" _xpath="./pento36_1" author="Enigma Team" ctrl="force" easy="false" id="pento36" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="37" _title="Pentomino XXXVII" _xpath="./pento37_1" author="Enigma Team" ctrl="force" easy="false" id="pento37" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="38" _title="Pentomino XXXVIII" _xpath="./pento38_1" author="Enigma Team" ctrl="force" easy="false" id="pento38" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="39" _title="Pentomino XXXIX" _xpath="./pento39_1" author="Enigma Team" ctrl="force" easy="false" id="pento39" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="40" _title="Pentomino XL" _xpath="./pento40_1" author="Enigma Team" ctrl="force" easy="false" id="pento40" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="41" _title="Pentomino XLI" _xpath="./pento41_1" author="Enigma Team" ctrl="force" easy="false" id="pento41" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="42" _title="Pentomino XLII" _xpath="./pento42_1" author="Enigma Team" ctrl="force" easy="false" id="pento42" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="43" _title="Pentomino XLIII" _xpath="./pento43_1" author="Enigma Team" ctrl="force" easy="false" id="pento43" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="44" _title="Pentomino XLIV" _xpath="./pento44_1" author="Enigma Team" ctrl="force" easy="false" id="pento44" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="45" _title="Pentomino XLV" _xpath="./pento45_1" author="Enigma Team" ctrl="force" easy="false" id="pento45" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="46" _title="Pentomino XLVI" _xpath="./pento46_1" author="Enigma Team" ctrl="force" easy="false" id="pento46" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="47" _title="Pentomino XLVII" _xpath="./pento47_1" author="Enigma Team" ctrl="force" easy="false" id="pento47" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="48" _title="Pentomino XLVIII" _xpath="./pento48_1" author="Enigma Team" ctrl="force" easy="false" id="pento48" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="49" _title="Pentomino XLIX" _xpath="./pento49_1" author="Enigma Team" ctrl="force" easy="false" id="pento49" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="50" _title="Pentomino L" _xpath="./pento50_1" author="Enigma Team" ctrl="force" easy="false" id="pento50" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="51" _title="Pentomino LI" _xpath="./pento51_1" author="Enigma Team" ctrl="force" easy="false" id="pento51" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="52" _title="Pentomino LII" _xpath="./pento52_1" author="Enigma Team" ctrl="force" easy="false" id="pento52" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="53" _title="Pentomino LIII" _xpath="./pento53_1" author="Enigma Team" ctrl="force" easy="false" id="pento53" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="54" _title="Pentomino LIV" _xpath="./pento54_1" author="Enigma Team" ctrl="force" easy="false" id="pento54" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="55" _title="Pentomino LV" _xpath="./pento55_1" author="Enigma Team" ctrl="force" easy="false" id="pento55" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="56" _title="Pentomino LVI" _xpath="./pento56_1" author="Enigma Team" ctrl="force" easy="false" id="pento56" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="57" _title="Pentomino LVII" _xpath="./pento57_1" author="Enigma Team" ctrl="force" easy="false" id="pento57" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="58" _title="Pentomino LVIII" _xpath="./pento58_1" author="Enigma Team" ctrl="force" easy="false" id="pento58" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="59" _title="Pentomino LIX" _xpath="./pento59_1" author="Enigma Team" ctrl="force" easy="false" id="pento59" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="60" _title="Pentomino LX" _xpath="./pento60_1" author="Enigma Team" ctrl="force" easy="false" id="pento60" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="61" _title="Pentomino LXI" _xpath="./pento61_1" author="Enigma Team" ctrl="force" easy="false" id="pento61" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="62" _title="Pentomino LXII" _xpath="./pento62_1" author="Enigma Team" ctrl="force" easy="false" id="pento62" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="63" _title="Pentomino LXIII" _xpath="./pento63_1" author="Enigma Team" ctrl="force" easy="false" id="pento63" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="64" _title="Pentomino LXIV" _xpath="./pento64_1" author="Enigma Team" ctrl="force" easy="false" id="pento64" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="65" _title="Pentomino LXV" _xpath="./pento65_1" author="Enigma Team" ctrl="force" easy="false" id="pento65" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="66" _title="Pentomino LXVI" _xpath="./pento66_1" author="Enigma Team" ctrl="force" easy="false" id="pento66" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="67" _title="Pentomino LXVII" _xpath="./pento67_1" author="Enigma Team" ctrl="force" easy="false" id="pento67" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="68" _title="Pentomino LXVIII" _xpath="./pento68_1" author="Enigma Team" ctrl="force" easy="false" id="pento68" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="69" _title="Pentomino LXIX" _xpath="./pento69_1" author="Enigma Team" ctrl="force" easy="false" id="pento69" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="70" _title="Pentomino LXX" _xpath="./pento70_1" author="Enigma Team" ctrl="force" easy="false" id="pento70" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="71" _title="Pentomino LXXI" _xpath="./pento71_1" author="Enigma Team" ctrl="force" easy="false" id="pento71" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="72" _title="Pentomino LXXII" _xpath="./pento72_1" author="Enigma Team" ctrl="force" easy="false" id="pento72" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="73" _title="Pentomino LXXIII" _xpath="./pento73_1" author="Enigma Team" ctrl="force" easy="false" id="pento73" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="74" _title="Pentomino LXXIV" _xpath="./pento74_1" author="Enigma Team" ctrl="force" easy="false" id="pento74" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="75" _title="Pentomino LXXV" _xpath="./pento75_1" author="Enigma Team" ctrl="force" easy="false" id="pento75" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="76" _title="Pentomino LXXVI" _xpath="./pento76_1" author="Enigma Team" ctrl="force" easy="false" id="pento76" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="77" _title="Pentomino LXXVII" _xpath="./pento77_1" author="Enigma Team" ctrl="force" easy="false" id="pento77" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="78" _title="Pentomino LXXVIII" _xpath="./pento78_1" author="Enigma Team" ctrl="force" easy="false" id="pento78" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="79" _title="Pentomino LXXIX" _xpath="./pento79_1" author="Enigma Team" ctrl="force" easy="false" id="pento79" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="80" _title="Pentomino LXXX" _xpath="./pento80_1" author="Enigma Team" ctrl="force" easy="false" id="pento80" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="81" _title="Pentomino LXXXI" _xpath="./pento81_1" author="Enigma Team" ctrl="force" easy="false" id="pento81" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="82" _title="Pentomino LXXXII" _xpath="./pento82_1" author="Enigma Team" ctrl="force" easy="false" id="pento82" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="83" _title="Pentomino LXXXIII" _xpath="./pento83_1" author="Enigma Team" ctrl="force" easy="false" id="pento83" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="84" _title="Pentomino LXXXIV" _xpath="./pento84_1" author="Enigma Team" ctrl="force" easy="false" id="pento84" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="85" _title="Pentomino LXXXV" _xpath="./pento85_1" author="Enigma Team" ctrl="force" easy="false" id="pento85" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="86" _title="Pentomino LXXXVI" _xpath="./pento86_1" author="Enigma Team" ctrl="force" easy="false" id="pento86" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="87" _title="Pentomino LXXXVII" _xpath="./pento87_1" author="Enigma Team" ctrl="force" easy="false" id="pento87" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="88" _title="Pentomino LXXXVIII" _xpath="./pento88_1" author="Enigma Team" ctrl="force" easy="false" id="pento88" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="89" _title="Pentomino LXXXIX" _xpath="./pento89_1" author="Enigma Team" ctrl="force" easy="false" id="pento89" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="90" _title="Pentomino XC" _xpath="./pento90_1" author="Enigma Team" ctrl="force" easy="false" id="pento90" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="91" _title="Pentomino XCI" _xpath="./pento91_1" author="Enigma Team" ctrl="force" easy="false" id="pento91" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="92" _title="Pentomino XCII" _xpath="./pento92_1" author="Enigma Team" ctrl="force" easy="false" id="pento92" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="93" _title="Pentomino XCIII" _xpath="./pento93_1" author="Enigma Team" ctrl="force" easy="false" id="pento93" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="94" _title="Pentomino XCIV" _xpath="./pento94_1" author="Enigma Team" ctrl="force" easy="false" id="pento94" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="95" _title="Pentomino XCV" _xpath="./pento95_1" author="Enigma Team" ctrl="force" easy="false" id="pento95" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="96" _title="Pentomino XCVI" _xpath="./pento96_1" author="Enigma Team" ctrl="force" easy="false" id="pento96" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="97" _title="Pentomino XCVII" _xpath="./pento97_1" author="Enigma Team" ctrl="force" easy="false" id="pento97" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="98" _title="Pentomino XCVIII" _xpath="./pento98_1" author="Enigma Team" ctrl="force" easy="false" id="pento98" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="99" _title="Pentomino XCIX" _xpath="./pento99_1" author="Enigma Team" ctrl="force" easy="false" id="pento99" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="100" _title="Pentomino C" _xpath="./pento100_1" author="Enigma Team" ctrl="force" easy="false" id="pento100" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="16" _title="Pentomino XVII" _xpath="./pento17_1" author="Enigma Team" ctrl="force" easy="false" id="pento17" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="17" _title="Pentomino XVIII" _xpath="./pento18_1" author="Enigma Team" ctrl="force" easy="false" id="pento18" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="18" _title="Pentomino XIX" _xpath="./pento19_1" author="Enigma Team" ctrl="force" easy="false" id="pento19" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="19" _title="Pentomino XX" _xpath="./pento20_1" author="Enigma Team" ctrl="force" easy="false" id="pento20" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="20" _title="Pentomino XXI" _xpath="./pento21_1" author="Enigma Team" ctrl="force" easy="false" id="pento21" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="21" _title="Pentomino XXII" _xpath="./pento22_1" author="Enigma Team" ctrl="force" easy="false" id="pento22" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="22" _title="Pentomino XXIII" _xpath="./pento23_1" author="Enigma Team" ctrl="force" easy="false" id="pento23" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="23" _title="Pentomino XXIV" _xpath="./pento24_1" author="Enigma Team" ctrl="force" easy="false" id="pento24" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="24" _title="Pentomino XXV" _xpath="./pento25_1" author="Enigma Team" ctrl="force" easy="false" id="pento25" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="25" _title="Pentomino XXVI" _xpath="./pento26_1" author="Enigma Team" ctrl="force" easy="false" id="pento26" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="26" _title="Pentomino XXVII" _xpath="./pento27_1" author="Enigma Team" ctrl="force" easy="false" id="pento27" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="27" _title="Pentomino XXVIII" _xpath="./pento28_1" author="Enigma Team" ctrl="force" easy="false" id="pento28" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="28" _title="Pentomino XXIX" _xpath="./pento29_1" author="Enigma Team" ctrl="force" easy="false" id="pento29" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="29" _title="Pentomino XXX" _xpath="./pento30_1" author="Enigma Team" ctrl="force" easy="false" id="pento30" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="30" _title="Pentomino XXXI" _xpath="./pento31_1" author="Enigma Team" ctrl="force" easy="false" id="pento31" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="31" _title="Pentomino XXXII" _xpath="./pento32_1" author="Enigma Team" ctrl="force" easy="false" id="pento32" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="32" _title="Pentomino XXXIII" _xpath="./pento33_1" author="Enigma Team" ctrl="force" easy="false" id="pento33" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="33" _title="Pentomino XXXIV" _xpath="./pento34_1" author="Enigma Team" ctrl="force" easy="false" id="pento34" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="34" _title="Pentomino XXXV" _xpath="./pento35_1" author="Enigma Team" ctrl="force" easy="false" id="pento35" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="35" _title="Pentomino XXXVI" _xpath="./pento36_1" author="Enigma Team" ctrl="force" easy="false" id="pento36" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="36" _title="Pentomino XXXVII" _xpath="./pento37_1" author="Enigma Team" ctrl="force" easy="false" id="pento37" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="37" _title="Pentomino XXXVIII" _xpath="./pento38_1" author="Enigma Team" ctrl="force" easy="false" id="pento38" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="38" _title="Pentomino XXXIX" _xpath="./pento39_1" author="Enigma Team" ctrl="force" easy="false" id="pento39" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="39" _title="Pentomino XL" _xpath="./pento40_1" author="Enigma Team" ctrl="force" easy="false" id="pento40" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="40" _title="Pentomino XLI" _xpath="./pento41_1" author="Enigma Team" ctrl="force" easy="false" id="pento41" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="41" _title="Pentomino XLII" _xpath="./pento42_1" author="Enigma Team" ctrl="force" easy="false" id="pento42" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="42" _title="Pentomino XLIII" _xpath="./pento43_1" author="Enigma Team" ctrl="force" easy="false" id="pento43" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="43" _title="Pentomino XLIV" _xpath="./pento44_1" author="Enigma Team" ctrl="force" easy="false" id="pento44" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="44" _title="Pentomino XLV" _xpath="./pento45_1" author="Enigma Team" ctrl="force" easy="false" id="pento45" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="45" _title="Pentomino XLVI" _xpath="./pento46_1" author="Enigma Team" ctrl="force" easy="false" id="pento46" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="46" _title="Pentomino XLVII" _xpath="./pento47_1" author="Enigma Team" ctrl="force" easy="false" id="pento47" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="47" _title="Pentomino XLVIII" _xpath="./pento48_1" author="Enigma Team" ctrl="force" easy="false" id="pento48" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="48" _title="Pentomino XLIX" _xpath="./pento49_1" author="Enigma Team" ctrl="force" easy="false" id="pento49" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="49" _title="Pentomino L" _xpath="./pento50_1" author="Enigma Team" ctrl="force" easy="false" id="pento50" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="50" _title="Pentomino LI" _xpath="./pento51_1" author="Enigma Team" ctrl="force" easy="false" id="pento51" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="51" _title="Pentomino LII" _xpath="./pento52_1" author="Enigma Team" ctrl="force" easy="false" id="pento52" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="52" _title="Pentomino LIII" _xpath="./pento53_1" author="Enigma Team" ctrl="force" easy="false" id="pento53" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="53" _title="Pentomino LIV" _xpath="./pento54_1" author="Enigma Team" ctrl="force" easy="false" id="pento54" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="54" _title="Pentomino LV" _xpath="./pento55_1" author="Enigma Team" ctrl="force" easy="false" id="pento55" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="55" _title="Pentomino LVI" _xpath="./pento56_1" author="Enigma Team" ctrl="force" easy="false" id="pento56" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="56" _title="Pentomino LVII" _xpath="./pento57_1" author="Enigma Team" ctrl="force" easy="false" id="pento57" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="57" _title="Pentomino LVIII" _xpath="./pento58_1" author="Enigma Team" ctrl="force" easy="false" id="pento58" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="58" _title="Pentomino LIX" _xpath="./pento59_1" author="Enigma Team" ctrl="force" easy="false" id="pento59" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="59" _title="Pentomino LX" _xpath="./pento60_1" author="Enigma Team" ctrl="force" easy="false" id="pento60" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="60" _title="Pentomino LXI" _xpath="./pento61_1" author="Enigma Team" ctrl="force" easy="false" id="pento61" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="61" _title="Pentomino LXII" _xpath="./pento62_1" author="Enigma Team" ctrl="force" easy="false" id="pento62" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="62" _title="Pentomino LXIII" _xpath="./pento63_1" author="Enigma Team" ctrl="force" easy="false" id="pento63" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="63" _title="Pentomino LXIV" _xpath="./pento64_1" author="Enigma Team" ctrl="force" easy="false" id="pento64" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="64" _title="Pentomino LXV" _xpath="./pento65_1" author="Enigma Team" ctrl="force" easy="false" id="pento65" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="65" _title="Pentomino LXVI" _xpath="./pento66_1" author="Enigma Team" ctrl="force" easy="false" id="pento66" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="66" _title="Pentomino LXVII" _xpath="./pento67_1" author="Enigma Team" ctrl="force" easy="false" id="pento67" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="67" _title="Pentomino LXVIII" _xpath="./pento68_1" author="Enigma Team" ctrl="force" easy="false" id="pento68" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="68" _title="Pentomino LXIX" _xpath="./pento69_1" author="Enigma Team" ctrl="force" easy="false" id="pento69" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="69" _title="Pentomino LXX" _xpath="./pento70_1" author="Enigma Team" ctrl="force" easy="false" id="pento70" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="70" _title="Pentomino LXXI" _xpath="./pento71_1" author="Enigma Team" ctrl="force" easy="false" id="pento71" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="71" _title="Pentomino LXXII" _xpath="./pento72_1" author="Enigma Team" ctrl="force" easy="false" id="pento72" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="72" _title="Pentomino LXXIII" _xpath="./pento73_1" author="Enigma Team" ctrl="force" easy="false" id="pento73" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="73" _title="Pentomino LXXIV" _xpath="./pento74_1" author="Enigma Team" ctrl="force" easy="false" id="pento74" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="74" _title="Pentomino LXXV" _xpath="./pento75_1" author="Enigma Team" ctrl="force" easy="false" id="pento75" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="75" _title="Pentomino LXXVI" _xpath="./pento76_1" author="Enigma Team" ctrl="force" easy="false" id="pento76" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="76" _title="Pentomino LXXVII" _xpath="./pento77_1" author="Enigma Team" ctrl="force" easy="false" id="pento77" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="77" _title="Pentomino LXXVIII" _xpath="./pento78_1" author="Enigma Team" ctrl="force" easy="false" id="pento78" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="78" _title="Pentomino LXXIX" _xpath="./pento79_1" author="Enigma Team" ctrl="force" easy="false" id="pento79" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="79" _title="Pentomino LXXX" _xpath="./pento80_1" author="Enigma Team" ctrl="force" easy="false" id="pento80" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="80" _title="Pentomino LXXXI" _xpath="./pento81_1" author="Enigma Team" ctrl="force" easy="false" id="pento81" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="81" _title="Pentomino LXXXII" _xpath="./pento82_1" author="Enigma Team" ctrl="force" easy="false" id="pento82" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="82" _title="Pentomino LXXXIII" _xpath="./pento83_1" author="Enigma Team" ctrl="force" easy="false" id="pento83" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="83" _title="Pentomino LXXXIV" _xpath="./pento84_1" author="Enigma Team" ctrl="force" easy="false" id="pento84" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="84" _title="Pentomino LXXXV" _xpath="./pento85_1" author="Enigma Team" ctrl="force" easy="false" id="pento85" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="85" _title="Pentomino LXXXVI" _xpath="./pento86_1" author="Enigma Team" ctrl="force" easy="false" id="pento86" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="86" _title="Pentomino LXXXVII" _xpath="./pento87_1" author="Enigma Team" ctrl="force" easy="false" id="pento87" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="87" _title="Pentomino LXXXVIII" _xpath="./pento88_1" author="Enigma Team" ctrl="force" easy="false" id="pento88" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="88" _title="Pentomino LXXXIX" _xpath="./pento89_1" author="Enigma Team" ctrl="force" easy="false" id="pento89" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="89" _title="Pentomino XC" _xpath="./pento90_1" author="Enigma Team" ctrl="force" easy="false" id="pento90" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="90" _title="Pentomino XCI" _xpath="./pento91_1" author="Enigma Team" ctrl="force" easy="false" id="pento91" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="91" _title="Pentomino XCII" _xpath="./pento92_1" author="Enigma Team" ctrl="force" easy="false" id="pento92" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="92" _title="Pentomino XCIII" _xpath="./pento93_1" author="Enigma Team" ctrl="force" easy="false" id="pento93" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="93" _title="Pentomino XCIV" _xpath="./pento94_1" author="Enigma Team" ctrl="force" easy="false" id="pento94" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="94" _title="Pentomino XCV" _xpath="./pento95_1" author="Enigma Team" ctrl="force" easy="false" id="pento95" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="95" _title="Pentomino XCVI" _xpath="./pento96_1" author="Enigma Team" ctrl="force" easy="false" id="pento96" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="96" _title="Pentomino XCVII" _xpath="./pento97_1" author="Enigma Team" ctrl="force" easy="false" id="pento97" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="97" _title="Pentomino XCVIII" _xpath="./pento98_1" author="Enigma Team" ctrl="force" easy="false" id="pento98" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="98" _title="Pentomino XCIX" _xpath="./pento99_1" author="Enigma Team" ctrl="force" easy="false" id="pento99" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="99" _title="Pentomino C" _xpath="./pento100_1" author="Enigma Team" ctrl="force" easy="false" id="pento100" rel="1" rev="1" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Added: trunk/data/levels/enigma_pentomino_i/pento17_1.xml
===================================================================
--- trunk/data/levels/enigma_pentomino_i/pento17_1.xml	2009-07-26 20:16:27 UTC (rev 1774)
+++ trunk/data/levels/enigma_pentomino_i/pento17_1.xml	2009-07-31 00:52:41 UTC (rev 1775)
@@ -0,0 +1,75 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Pentomino XVII" el:subtitle="13 solutions" el:id="pento17"/>
+      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:author el:name="Enigma Team" el:email=""/>
+      <el:copyright>Copyright ? 2009 Enigma Team</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libpento" el:id="lib/libpento" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["FollowGrid"] = true
+wo["FollowMethod"] = FOLLOW_SCROLL
+wo["FollowAction"] = FOLLOW_HALFSCREEN
+
+ti[" "] = {"fl_plank"}
+ti["+"] = {"fl_bluegreen", "source#"}
+ti["."] = {"fl_lawn", "target#"}
+ti["#"] = {"st_bluesand", cluster=1}
+ti["%"] = {"st_bluesand", name="oxyd#", cluster=2}
+ti["&"] = {"st_switch", target="pento.next"}
+ti["/"] = {"st_fourswitch", target="pento.rotate"}
+ti["|"] = {"st_switch", target="pento.mirror"}
+ti["*"] = {"st_oxyd"}
+ti["n"] = {"it_puller_n"}
+ti["e"] = {"it_puller_e"}
+ti["s"] = {"it_puller_s"}
+ti["w"] = {"it_puller_w"}
+ti["N"] = ti["n"] .. ti({"fl_plank","pullers"})
+ti["!"] = {"it_sensor", target="addpullers", invisible=true}
+ti["@"] = {"#ac_marble"}
+
+pento = res.pento(ti, "source", "target")
+
+wo(pento, " ", {
+    "#########%%%#&#/#|##",
+    "#     ...         @%",
+    "#     ...    +++++ %",
+    "#     ...    +++++ %",
+    "#........    +++++ %",
+    "#........    +++++ %",
+    "#..... ..... +++++ %",
+    "#   ........       %",
+    "#   ........       %",
+    "#   ...            %",
+    "#   ...       !!!!!%",
+    "#   ...       !Nesw%",
+    "#######%%%%%%%%%%%%#"})
+
+wo:add({"ot_timer", interval=0.5, target="check"})
+
+function check(value, sender)
+    if pento.check() then
+        sender.state=OFF
+        wo[no["oxyd#*"]:shuffle():sub(12)] = ti["*"]
+        wo:shuffleOxyd()
+    end
+end
+
+function addpullers()
+    wo:drawMap(ti, no["pullers"], " ", {"nesw"})
+end
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_pentomino_i/pento17_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_pentomino_i/pento18_1.xml
===================================================================
--- trunk/data/levels/enigma_pentomino_i/pento18_1.xml	2009-07-26 20:16:27 UTC (rev 1774)
+++ trunk/data/levels/enigma_pentomino_i/pento18_1.xml	2009-07-31 00:52:41 UTC (rev 1775)
@@ -0,0 +1,75 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Pentomino XVIII" el:subtitle="2 solutions" el:id="pento18"/>
+      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:author el:name="Enigma Team" el:email=""/>
+      <el:copyright>Copyright ? 2009 Enigma Team</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libpento" el:id="lib/libpento" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["FollowGrid"] = true
+wo["FollowMethod"] = FOLLOW_SCROLL
+wo["FollowAction"] = FOLLOW_HALFSCREEN
+
+ti[" "] = {"fl_plank"}
+ti["+"] = {"fl_bluegreen", "source#"}
+ti["."] = {"fl_lawn", "target#"}
+ti["#"] = {"st_bluesand", cluster=1}
+ti["%"] = {"st_bluesand", name="oxyd#", cluster=2}
+ti["&"] = {"st_switch", target="pento.next"}
+ti["/"] = {"st_fourswitch", target="pento.rotate"}
+ti["|"] = {"st_switch", target="pento.mirror"}
+ti["*"] = {"st_oxyd"}
+ti["n"] = {"it_puller_n"}
+ti["e"] = {"it_puller_e"}
+ti["s"] = {"it_puller_s"}
+ti["w"] = {"it_puller_w"}
+ti["N"] = ti["n"] .. ti({"fl_plank","pullers"})
+ti["!"] = {"it_sensor", target="addpullers", invisible=true}
+ti["@"] = {"#ac_marble"}
+
+pento = res.pento(ti, "source", "target")
+
+wo(pento, " ", {
+    "#%%%%%%%%%%%%%%%%%%#",
+    "%                  #",
+    "%                  #",
+    "% ..........       #",
+    "% .......... +++++ &",
+    "% .. .... .. +++++ #",
+    "% ..      .. at +++++ /",
+    "% .. .... .. +++++ #",
+    "% .......... +++++ |",
+    "% ..........       #",
+    "%             !!!!!#",
+    "%             !Nesw#",
+    "#%%%%%%%%%%%%%%%%%%#"})
+
+wo:add({"ot_timer", interval=0.5, target="check"})
+
+function check(value, sender)
+    if pento.check() then
+        sender.state=OFF
+        wo[no["oxyd#*"]:shuffle():sub(12)] = ti["*"]
+        wo:shuffleOxyd()
+    end
+end
+
+function addpullers()
+    wo:drawMap(ti, no["pullers"], " ", {"nesw"})
+end
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_pentomino_i/pento18_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_pentomino_i/pento19_1.xml
===================================================================
--- trunk/data/levels/enigma_pentomino_i/pento19_1.xml	2009-07-26 20:16:27 UTC (rev 1774)
+++ trunk/data/levels/enigma_pentomino_i/pento19_1.xml	2009-07-31 00:52:41 UTC (rev 1775)
@@ -0,0 +1,75 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Pentomino XIX" el:subtitle="26 solutions" el:id="pento19"/>
+      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:author el:name="Enigma Team" el:email=""/>
+      <el:copyright>Copyright ? 2009 Enigma Team</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libpento" el:id="lib/libpento" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["FollowGrid"] = true
+wo["FollowMethod"] = FOLLOW_SCROLL
+wo["FollowAction"] = FOLLOW_HALFSCREEN
+
+ti[" "] = {"fl_plank"}
+ti["+"] = {"fl_bluegreen", "source#"}
+ti["."] = {"fl_lawn", "target#"}
+ti["#"] = {"st_bluesand", cluster=1}
+ti["%"] = {"st_bluesand", name="oxyd#", cluster=2}
+ti["&"] = {"st_switch", target="pento.next"}
+ti["/"] = {"st_fourswitch", target="pento.rotate"}
+ti["|"] = {"st_switch", target="pento.mirror"}
+ti["*"] = {"st_oxyd"}
+ti["n"] = {"it_puller_n"}
+ti["e"] = {"it_puller_e"}
+ti["s"] = {"it_puller_s"}
+ti["w"] = {"it_puller_w"}
+ti["N"] = ti["n"] .. ti({"fl_plank","pullers"})
+ti["!"] = {"it_sensor", target="addpullers", invisible=true}
+ti["@"] = {"#ac_marble"}
+
+pento = res.pento(ti, "source", "target")
+
+wo(pento, " ", {
+    "#%%%%%%%%%%%%%%%%%%#",
+    "%                  #",
+    "%                  #",
+    "%  ........        #",
+    "% .......... +++++ &",
+    "% .. .... .. +++++ #",
+    "% .. .... .. at +++++ /",
+    "% .. .... .. +++++ #",
+    "% .......... +++++ |",
+    "%  ........        #",
+    "%             !!!!!#",
+    "%             !Nesw#",
+    "#%%%%%%%%%%%%%%%%%%#"})
+
+wo:add({"ot_timer", interval=0.5, target="check"})
+
+function check(value, sender)
+    if pento.check() then
+        sender.state=OFF
+        wo[no["oxyd#*"]:shuffle():sub(12)] = ti["*"]
+        wo:shuffleOxyd()
+    end
+end
+
+function addpullers()
+    wo:drawMap(ti, no["pullers"], " ", {"nesw"})
+end
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_pentomino_i/pento19_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native



