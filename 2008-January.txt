From ral at mail.berlios.de  Tue Jan  1 19:27:04 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 1 Jan 2008 19:27:04 +0100
Subject: [Enigma-game-svn] r959 - homepage/input
Message-ID: <200801011827.m01IR4Or027716@sheep.berlios.de>

Author: ral
Date: 2008-01-01 19:27:02 +0100 (Tue, 01 Jan 2008)
New Revision: 959

Modified:
   homepage/input/stat-other.html
   homepage/input/table-hcp.html
   homepage/input/table-rat.html
   homepage/input/table-solved.html
   homepage/input/table-wr.html
   homepage/input/userlist.html
Log:
Homepage:
- statistics December 2007

Modified: homepage/input/stat-other.html
===================================================================
--- homepage/input/stat-other.html	2007-12-28 22:46:53 UTC (rev 958)
+++ homepage/input/stat-other.html	2008-01-01 18:27:02 UTC (rev 959)
@@ -1,22 +1,22 @@
   <div class="stat-help">
     <h3>$$Other_Statistics$$</h3>
     <h4>$$Scores$$</h4>
-      64290 $$single_level_scores$$.
+      67135 $$single_level_scores$$.
     <h4>$$Ratings$$</h4>
-      12065 $$single_level_ratings$$ 4.86 $$and_distribution$$: 
+      12983 $$single_level_ratings$$ 4.86 $$and_distribution$$: 
       <table>
         <colgroup><col width="80"><col width="80"></colgroup>
         <tr><th>$$rating$$</th><th>$$count$$</th></tr>
         <tr><td class="num">0</td><td class="num">47</td></tr>
-        <tr><td class="num">1</td><td class="num">244</td></tr>
-        <tr><td class="num">2</td><td class="num">652</td></tr>
-        <tr><td class="num">3</td><td class="num">1795</td></tr>
-        <tr><td class="num">4</td><td class="num">2347</td></tr>
-        <tr><td class="num">5</td><td class="num">2877</td></tr>
-        <tr><td class="num">6</td><td class="num">1971</td></tr>
-        <tr><td class="num">7</td><td class="num">1350</td></tr>
-        <tr><td class="num">8</td><td class="num">488</td></tr>
-        <tr><td class="num">9</td><td class="num">201</td></tr>
-        <tr><td class="num">10</td><td class="num">93</td></tr>
+        <tr><td class="num">1</td><td class="num">247</td></tr>
+        <tr><td class="num">2</td><td class="num">690</td></tr>
+        <tr><td class="num">3</td><td class="num">1937</td></tr>
+        <tr><td class="num">4</td><td class="num">2547</td></tr>
+        <tr><td class="num">5</td><td class="num">3102</td></tr>
+        <tr><td class="num">6</td><td class="num">2139</td></tr>
+        <tr><td class="num">7</td><td class="num">1446</td></tr>
+        <tr><td class="num">8</td><td class="num">518</td></tr>
+        <tr><td class="num">9</td><td class="num">213</td></tr>
+        <tr><td class="num">10</td><td class="num">97</td></tr>
       </table>
   </div>

Modified: homepage/input/table-hcp.html
===================================================================
--- homepage/input/table-hcp.html	2007-12-28 22:46:53 UTC (rev 958)
+++ homepage/input/table-hcp.html	2008-01-01 18:27:02 UTC (rev 959)
@@ -1,125 +1,129 @@
   <table>
-    <caption>$$Handicap_Statistics$$ $$November$$ 2007</caption>
+    <caption>$$Handicap_Statistics$$ $$December$$ 2007</caption>
     <colgroup><col width="130"><col width="220"></colgroup>
     <tr><th>$$solved_hcp$$</th><th class="left">$$user$$</th></tr>
-     <tr><td class="num">-137.2</td><td class="left">'Moneymaker'</td></tr>
-     <tr><td class="num"> -88.3</td><td class="left">'Johannes'</td></tr>
-     <tr><td class="num"> -88.1</td><td class="left">'Stupid'</td></tr>
-     <tr><td class="num"> -76.4</td><td class="left">'Great Scott'</td></tr>
-     <tr><td class="num"> -65.6</td><td class="left">'Duffy'</td></tr>
-     <tr><td class="num"> -59.7</td><td class="left">'daydreamer'</td></tr>
-     <tr><td class="num"> -50.9</td><td class="left">'Django'</td></tr>
-     <tr><td class="num"> -43.9</td><td class="left">'Alexandros'</td></tr>
-     <tr><td class="num"> -43.4</td><td class="left">'Taztunes'</td></tr>
-     <tr><td class="num"> -39.0</td><td class="left">'Safalra'</td></tr>
-     <tr><td class="num"> -31.3</td><td class="left">'bojster'</td></tr>
-     <tr><td class="num"> -31.3</td><td class="left">'ryujun'</td></tr>
-     <tr><td class="num"> -28.2</td><td class="left">'hendrik'</td></tr>
-     <tr><td class="num"> -25.1</td><td class="left">'ged'</td></tr>
-     <tr><td class="num"> -23.8</td><td class="left">'Ludmian'</td></tr>
-     <tr><td class="num"> -23.4</td><td class="left">'Raoul'</td></tr>
-     <tr><td class="num"> -20.1</td><td class="left">'Ghatotkacha'</td></tr>
-     <tr><td class="num"> -18.3</td><td class="left">'Ronald'</td></tr>
-     <tr><td class="num"> -17.1</td><td class="left">'dpl'</td></tr>
-     <tr><td class="num"> -16.0</td><td class="left">'Lukas'</td></tr>
-     <tr><td class="num"> -15.2</td><td class="left">'HuB34'</td></tr>
-     <tr><td class="num"> -11.8</td><td class="left">'ABS'</td></tr>
-     <tr><td class="num"> -11.7</td><td class="left">'joseba'</td></tr>
-     <tr><td class="num"> -11.0</td><td class="left">'dev0'</td></tr>
-     <tr><td class="num"> -10.9</td><td class="left">'Iceshark7'</td></tr>
-     <tr><td class="num">  -8.3</td><td class="left">'Daniel'</td></tr>
-     <tr><td class="num">  -6.7</td><td class="left">'fabian'</td></tr>
-     <tr><td class="num">  -5.3</td><td class="left">'B-Huff'</td></tr>
-     <tr><td class="num">  -5.2</td><td class="left">'Craven'</td></tr>
-     <tr><td class="num">  -4.8</td><td class="left">'JuSt'</td></tr>
-     <tr><td class="num">  -4.6</td><td class="left">'Wuzzy'</td></tr>
-     <tr><td class="num">  -1.8</td><td class="left">'para_doks'</td></tr>
-     <tr><td class="num">  -1.6</td><td class="left">'Tobias'</td></tr>
-     <tr><td class="num">  -0.6</td><td class="left">'Guglielmo'</td></tr>
-     <tr><td class="num">   0.7</td><td class="left">'serpent'</td></tr>
-     <tr><td class="num">   2.1</td><td class="left">'Zekobah'</td></tr>
-     <tr><td class="num">   2.6</td><td class="left">'Emmanuel'</td></tr>
-     <tr><td class="num">   6.0</td><td class="left">'mrduke'</td></tr>
-     <tr><td class="num">   7.7</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-     <tr><td class="num">   9.3</td><td class="left">'Andreas'</td></tr>
-     <tr><td class="num">  10.1</td><td class="left">'alfred69'</td></tr>
-     <tr><td class="num">  10.3</td><td class="left">'Chocolate Zero'</td></tr>
-     <tr><td class="num">  11.6</td><td class="left">'Sim_Ed'</td></tr>
-     <tr><td class="num">  11.8</td><td class="left">'Agnieszka'</td></tr>
-     <tr><td class="num">  12.0</td><td class="left">'shoki'</td></tr>
-     <tr><td class="num">  12.5</td><td class="left">'Mark P.'</td></tr>
-     <tr><td class="num">  14.2</td><td class="left">'U-Punkt'</td></tr>
-     <tr><td class="num">  14.9</td><td class="left">'Tiza'</td></tr>
-     <tr><td class="num">  16.7</td><td class="left">'Alex'</td></tr>
-     <tr><td class="num">  17.5</td><td class="left">'Andy'</td></tr>
-     <tr><td class="num">  19.8</td><td class="left">'Klaus'</td></tr>
-     <tr><td class="num">  19.8</td><td class="left">'Chris'</td></tr>
-     <tr><td class="num">  19.9</td><td class="left">'Marc-Hendrik'</td></tr>
-     <tr><td class="num">  20.5</td><td class="left">'Bent'</td></tr>
-     <tr><td class="num">  20.8</td><td class="left">'Thomas'</td></tr>
-     <tr><td class="num">  21.8</td><td class="left">'hdwow'</td></tr>
-     <tr><td class="num">  22.7</td><td class="left">'Gottseinsohn'</td></tr>
-     <tr><td class="num">  23.6</td><td class="left">'Ale'</td></tr>
-     <tr><td class="num">  24.9</td><td class="left">'J3FF'</td></tr>
-     <tr><td class="num">  24.9</td><td class="left">'Little_Mole'</td></tr>
-     <tr><td class="num">  26.1</td><td class="left">'biotopa'</td></tr>
-     <tr><td class="num">  27.1</td><td class="left">'geembo_90'</td></tr>
-     <tr><td class="num">  27.4</td><td class="left">'redsantz'</td></tr>
-     <tr><td class="num">  28.5</td><td class="left">'Edgar_Flesk'</td></tr>
-     <tr><td class="num">  28.7</td><td class="left">'IChrisI'</td></tr>
-     <tr><td class="num">  29.0</td><td class="left">'Melanie'</td></tr>
-     <tr><td class="num">  29.2</td><td class="left">'NorthForty'</td></tr>
-     <tr><td class="num">  29.3</td><td class="left">'erich'</td></tr>
-     <tr><td class="num">  29.7</td><td class="left">'Davacardo'</td></tr>
-     <tr><td class="num">  31.1</td><td class="left">'Vinksu'</td></tr>
-     <tr><td class="num">  32.7</td><td class="left">'niebie'</td></tr>
-     <tr><td class="num">  32.7</td><td class="left">'MicWa'</td></tr>
-     <tr><td class="num">  32.8</td><td class="left">'WP319'</td></tr>
-     <tr><td class="num">  32.9</td><td class="left">'Gorn'</td></tr>
-     <tr><td class="num">  34.7</td><td class="left">'Rugby4ever'</td></tr>
-     <tr><td class="num">  36.5</td><td class="left">'Drotten'</td></tr>
-     <tr><td class="num">  37.1</td><td class="left">'B-man'</td></tr>
-     <tr><td class="num">  37.1</td><td class="left">'Archcorenth'</td></tr>
-     <tr><td class="num">  37.3</td><td class="left">'Harry Lim'</td></tr>
-     <tr><td class="num">  38.4</td><td class="left">'Nfol'</td></tr>
-     <tr><td class="num">  38.8</td><td class="left">'Tiger'</td></tr>
-     <tr><td class="num">  39.8</td><td class="left">'Vlad'</td></tr>
-     <tr><td class="num">  40.8</td><td class="left">'Momcat'</td></tr>
-     <tr><td class="num">  41.3</td><td class="left">'Uli'</td></tr>
-     <tr><td class="num">  42.6</td><td class="left">'Breezy'</td></tr>
-     <tr><td class="num">  43.1</td><td class="left">'Liam Sheehan'</td></tr>
-     <tr><td class="num">  43.3</td><td class="left">'Tarim'</td></tr>
-     <tr><td class="num">  43.8</td><td class="left">'IntKecsk'</td></tr>
-     <tr><td class="num">  44.3</td><td class="left">'Antonio EE'</td></tr>
-     <tr><td class="num">  45.6</td><td class="left">'mhatta'</td></tr>
-     <tr><td class="num">  47.0</td><td class="left">'Zak'</td></tr>
-     <tr><td class="num">  47.6</td><td class="left">'Valkyrie2'</td></tr>
-     <tr><td class="num">  48.0</td><td class="left">'Sandra'</td></tr>
-     <tr><td class="num">  49.1</td><td class="left">'jdcampo'</td></tr>
-     <tr><td class="num">  49.4</td><td class="left">'Jeffrey S'</td></tr>
-     <tr><td class="num">  50.3</td><td class="left">'Vaily'</td></tr>
-     <tr><td class="num">  50.4</td><td class="left">'brynn'</td></tr>
-     <tr><td class="num">  51.6</td><td class="left">'Neophilus'</td></tr>
-     <tr><td class="num">  51.7</td><td class="left">'Turbogurk'</td></tr>
-     <tr><td class="num">  51.9</td><td class="left">'Cyphase'</td></tr>
-     <tr><td class="num">  54.1</td><td class="left">'krazy62'</td></tr>
-     <tr><td class="num">  54.8</td><td class="left">'Adonica'</td></tr>
-     <tr><td class="num">  60.6</td><td class="left">'Asbel'</td></tr>
-     <tr><td class="num">  62.1</td><td class="left">'Meeve'</td></tr>
-     <tr><td class="num">  65.1</td><td class="left">'ael'</td></tr>
-     <tr><td class="num">  65.5</td><td class="left">'Samuel'</td></tr>
-     <tr><td class="num">  66.4</td><td class="left">'Alf'</td></tr>
-     <tr><td class="num">  67.9</td><td class="left">'Magnus and Susi'</td></tr>
-     <tr><td class="num">  68.4</td><td class="left">'Mecki'</td></tr>
-     <tr><td class="num">  69.2</td><td class="left">'xmouse'</td></tr>
-     <tr><td class="num">  70.9</td><td class="left">'Joona'</td></tr>
-     <tr><td class="num">  71.3</td><td class="left">'AQZ'</td></tr>
-     <tr><td class="num">  73.3</td><td class="left">'Dvorhagen'</td></tr>
-     <tr><td class="num">  74.3</td><td class="left">'jojo'</td></tr>
-     <tr><td class="num">  74.5</td><td class="left">'AsuCaga'</td></tr>
-     <tr><td class="num">  79.0</td><td class="left">'AkRa'</td></tr>
-     <tr><td class="num">  79.7</td><td class="left">'Agares'</td></tr>
-     <tr><td class="num">  84.5</td><td class="left">'Miel56'</td></tr>
-     <tr><td class="num">  89.7</td><td class="left">'The red O'</td></tr>
-     <tr><td class="num">  92.1</td><td class="left">'Michael'</td></tr>
+     <tr><td class="num">-136.2</td><td class="left">'Moneymaker'</td></tr>
+     <tr><td class="num"> -85.4</td><td class="left">'Stupid'</td></tr>
+     <tr><td class="num"> -85.4</td><td class="left">'Johannes'</td></tr>
+     <tr><td class="num"> -73.2</td><td class="left">'Great Scott'</td></tr>
+     <tr><td class="num"> -63.4</td><td class="left">'Duffy'</td></tr>
+     <tr><td class="num"> -59.2</td><td class="left">'daydreamer'</td></tr>
+     <tr><td class="num"> -48.2</td><td class="left">'Django'</td></tr>
+     <tr><td class="num"> -44.5</td><td class="left">'Alexandros'</td></tr>
+     <tr><td class="num"> -42.4</td><td class="left">'Taztunes'</td></tr>
+     <tr><td class="num"> -39.4</td><td class="left">'Safalra'</td></tr>
+     <tr><td class="num"> -34.6</td><td class="left">'Gloop'</td></tr>
+     <tr><td class="num"> -31.1</td><td class="left">'ryujun'</td></tr>
+     <tr><td class="num"> -29.0</td><td class="left">'bojster'</td></tr>
+     <tr><td class="num"> -25.1</td><td class="left">'hendrik'</td></tr>
+     <tr><td class="num"> -23.5</td><td class="left">'ABS'</td></tr>
+     <tr><td class="num"> -23.4</td><td class="left">'B-Huff'</td></tr>
+     <tr><td class="num"> -22.2</td><td class="left">'ged'</td></tr>
+     <tr><td class="num"> -21.5</td><td class="left">'Zekobah'</td></tr>
+     <tr><td class="num"> -20.8</td><td class="left">'Raoul'</td></tr>
+     <tr><td class="num"> -20.5</td><td class="left">'Ludmian'</td></tr>
+     <tr><td class="num"> -20.4</td><td class="left">'Emmanuel'</td></tr>
+     <tr><td class="num"> -17.5</td><td class="left">'Ghatotkacha'</td></tr>
+     <tr><td class="num"> -17.0</td><td class="left">'Ronald'</td></tr>
+     <tr><td class="num"> -16.2</td><td class="left">'dev0'</td></tr>
+     <tr><td class="num"> -14.6</td><td class="left">'dpl'</td></tr>
+     <tr><td class="num"> -14.5</td><td class="left">'Lukas'</td></tr>
+     <tr><td class="num"> -13.1</td><td class="left">'HuB34'</td></tr>
+     <tr><td class="num">  -9.4</td><td class="left">'joseba'</td></tr>
+     <tr><td class="num">  -8.8</td><td class="left">'Iceshark7'</td></tr>
+     <tr><td class="num">  -5.9</td><td class="left">'Daniel'</td></tr>
+     <tr><td class="num">  -4.6</td><td class="left">'fabian'</td></tr>
+     <tr><td class="num">  -3.6</td><td class="left">'Craven'</td></tr>
+     <tr><td class="num">  -3.1</td><td class="left">'JuSt'</td></tr>
+     <tr><td class="num">  -2.4</td><td class="left">'Wuzzy'</td></tr>
+     <tr><td class="num">  -0.2</td><td class="left">'para_doks'</td></tr>
+     <tr><td class="num">  -0.0</td><td class="left">'Tobias'</td></tr>
+     <tr><td class="num">   1.4</td><td class="left">'Guglielmo'</td></tr>
+     <tr><td class="num">   2.4</td><td class="left">'Andy'</td></tr>
+     <tr><td class="num">   2.7</td><td class="left">'serpent'</td></tr>
+     <tr><td class="num">   4.7</td><td class="left">'Austin'</td></tr>
+     <tr><td class="num">   6.8</td><td class="left">'mrduke'</td></tr>
+     <tr><td class="num">   9.6</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+     <tr><td class="num">  11.0</td><td class="left">'Andreas'</td></tr>
+     <tr><td class="num">  11.7</td><td class="left">'alfred69'</td></tr>
+     <tr><td class="num">  12.3</td><td class="left">'Chocolate Zero'</td></tr>
+     <tr><td class="num">  13.1</td><td class="left">'Sim_Ed'</td></tr>
+     <tr><td class="num">  13.5</td><td class="left">'shoki'</td></tr>
+     <tr><td class="num">  13.5</td><td class="left">'Agnieszka'</td></tr>
+     <tr><td class="num">  14.1</td><td class="left">'Mark P.'</td></tr>
+     <tr><td class="num">  15.8</td><td class="left">'U-Punkt'</td></tr>
+     <tr><td class="num">  16.8</td><td class="left">'Tiza'</td></tr>
+     <tr><td class="num">  17.8</td><td class="left">'Alex'</td></tr>
+     <tr><td class="num">  20.9</td><td class="left">'Klaus'</td></tr>
+     <tr><td class="num">  21.2</td><td class="left">'Marc-Hendrik'</td></tr>
+     <tr><td class="num">  21.4</td><td class="left">'Chris'</td></tr>
+     <tr><td class="num">  22.3</td><td class="left">'Bent'</td></tr>
+     <tr><td class="num">  22.3</td><td class="left">'Thomas'</td></tr>
+     <tr><td class="num">  23.0</td><td class="left">'hdwow'</td></tr>
+     <tr><td class="num">  23.6</td><td class="left">'Gottseinsohn'</td></tr>
+     <tr><td class="num">  24.6</td><td class="left">'Ale'</td></tr>
+     <tr><td class="num">  26.0</td><td class="left">'Little_Mole'</td></tr>
+     <tr><td class="num">  26.1</td><td class="left">'J3FF'</td></tr>
+     <tr><td class="num">  27.0</td><td class="left">'biotopa'</td></tr>
+     <tr><td class="num">  28.4</td><td class="left">'redsantz'</td></tr>
+     <tr><td class="num">  28.8</td><td class="left">'geembo_90'</td></tr>
+     <tr><td class="num">  29.6</td><td class="left">'Edgar_Flesk'</td></tr>
+     <tr><td class="num">  29.9</td><td class="left">'Melanie'</td></tr>
+     <tr><td class="num">  30.1</td><td class="left">'IChrisI'</td></tr>
+     <tr><td class="num">  30.3</td><td class="left">'erich'</td></tr>
+     <tr><td class="num">  30.4</td><td class="left">'NorthForty'</td></tr>
+     <tr><td class="num">  31.0</td><td class="left">'Davacardo'</td></tr>
+     <tr><td class="num">  32.0</td><td class="left">'Vinksu'</td></tr>
+     <tr><td class="num">  32.2</td><td class="left">'Gorn'</td></tr>
+     <tr><td class="num">  33.7</td><td class="left">'niebie'</td></tr>
+     <tr><td class="num">  33.8</td><td class="left">'WP319'</td></tr>
+     <tr><td class="num">  33.9</td><td class="left">'MicWa'</td></tr>
+     <tr><td class="num">  35.7</td><td class="left">'Rugby4ever'</td></tr>
+     <tr><td class="num">  37.5</td><td class="left">'Drotten'</td></tr>
+     <tr><td class="num">  38.1</td><td class="left">'Archcorenth'</td></tr>
+     <tr><td class="num">  38.2</td><td class="left">'B-man'</td></tr>
+     <tr><td class="num">  38.2</td><td class="left">'Harry Lim'</td></tr>
+     <tr><td class="num">  39.6</td><td class="left">'Nfol'</td></tr>
+     <tr><td class="num">  39.7</td><td class="left">'Tiger'</td></tr>
+     <tr><td class="num">  40.5</td><td class="left">'Snaily'</td></tr>
+     <tr><td class="num">  40.8</td><td class="left">'Vlad'</td></tr>
+     <tr><td class="num">  41.8</td><td class="left">'Momcat'</td></tr>
+     <tr><td class="num">  42.4</td><td class="left">'Uli'</td></tr>
+     <tr><td class="num">  42.8</td><td class="left">'Breezy'</td></tr>
+     <tr><td class="num">  44.0</td><td class="left">'Tarim'</td></tr>
+     <tr><td class="num">  44.1</td><td class="left">'Liam Sheehan'</td></tr>
+     <tr><td class="num">  44.9</td><td class="left">'IntKecsk'</td></tr>
+     <tr><td class="num">  45.2</td><td class="left">'Antonio EE'</td></tr>
+     <tr><td class="num">  46.2</td><td class="left">'ntaeijr'</td></tr>
+     <tr><td class="num">  46.6</td><td class="left">'mhatta'</td></tr>
+     <tr><td class="num">  47.8</td><td class="left">'Zak'</td></tr>
+     <tr><td class="num">  48.4</td><td class="left">'Valkyrie2'</td></tr>
+     <tr><td class="num">  48.9</td><td class="left">'Sandra'</td></tr>
+     <tr><td class="num">  49.8</td><td class="left">'jdcampo'</td></tr>
+     <tr><td class="num">  50.2</td><td class="left">'Jeffrey S'</td></tr>
+     <tr><td class="num">  51.0</td><td class="left">'brynn'</td></tr>
+     <tr><td class="num">  51.1</td><td class="left">'Vaily'</td></tr>
+     <tr><td class="num">  52.3</td><td class="left">'Turbogurk'</td></tr>
+     <tr><td class="num">  52.4</td><td class="left">'Neophilus'</td></tr>
+     <tr><td class="num">  52.6</td><td class="left">'Cyphase'</td></tr>
+     <tr><td class="num">  54.8</td><td class="left">'krazy62'</td></tr>
+     <tr><td class="num">  55.7</td><td class="left">'Adonica'</td></tr>
+     <tr><td class="num">  61.1</td><td class="left">'Asbel'</td></tr>
+     <tr><td class="num">  62.9</td><td class="left">'Meeve'</td></tr>
+     <tr><td class="num">  65.6</td><td class="left">'ael'</td></tr>
+     <tr><td class="num">  66.0</td><td class="left">'Samuel'</td></tr>
+     <tr><td class="num">  67.0</td><td class="left">'Alf'</td></tr>
+     <tr><td class="num">  68.5</td><td class="left">'Magnus and Susi'</td></tr>
+     <tr><td class="num">  68.6</td><td class="left">'Mecki'</td></tr>
+     <tr><td class="num">  69.7</td><td class="left">'xmouse'</td></tr>
+     <tr><td class="num">  71.3</td><td class="left">'Joona'</td></tr>
+     <tr><td class="num">  71.6</td><td class="left">'AQZ'</td></tr>
+     <tr><td class="num">  73.6</td><td class="left">'Dvorhagen'</td></tr>
+     <tr><td class="num">  74.6</td><td class="left">'jojo'</td></tr>
+     <tr><td class="num">  74.7</td><td class="left">'AsuCaga'</td></tr>
+     <tr><td class="num">  79.3</td><td class="left">'AkRa'</td></tr>
+     <tr><td class="num">  79.9</td><td class="left">'Agares'</td></tr>
+     <tr><td class="num">  84.6</td><td class="left">'Miel56'</td></tr>
+     <tr><td class="num">  89.8</td><td class="left">'The red O'</td></tr>
+     <tr><td class="num">  92.2</td><td class="left">'Michael'</td></tr>
   </table>

Modified: homepage/input/table-rat.html
===================================================================
--- homepage/input/table-rat.html	2007-12-28 22:46:53 UTC (rev 958)
+++ homepage/input/table-rat.html	2008-01-01 18:27:02 UTC (rev 959)
@@ -1,30 +1,31 @@
   <table>
-    <caption>$$Rating_Statistics$$ $$November$$ 2007</caption>
+    <caption>$$Rating_Statistics$$ $$December$$ 2007</caption>
     <colgroup><col width="80"><col width="80"><col width="220"></colgroup>
-    <tr><th>$$count$$</th><th>$$average$$</th><th class="left">$$user$$</th></tr>    <tr><td class="num">1039</td><td class="num"> 5.03</td><td class="left">'ryujun'</td></tr>
-    <tr><td class="num">1029</td><td class="num"> 4.81</td><td class="left">'Taztunes'</td></tr>
+    <tr><th>$$count$$</th><th>$$average$$</th><th class="left">$$user$$</th></tr>    <tr><td class="num">1058</td><td class="num"> 5.05</td><td class="left">'ryujun'</td></tr>
+    <tr><td class="num">1056</td><td class="num"> 4.83</td><td class="left">'Taztunes'</td></tr>
     <tr><td class="num">871</td><td class="num"> 5.09</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num">847</td><td class="num"> 4.78</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num">853</td><td class="num"> 4.78</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num">713</td><td class="num"> 4.78</td><td class="left">'dev0'</td></tr>
     <tr><td class="num">653</td><td class="num"> 5.01</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num">625</td><td class="num"> 4.98</td><td class="left">'Moneymaker'</td></tr>
     <tr><td class="num">613</td><td class="num"> 4.20</td><td class="left">'shoki'</td></tr>
-    <tr><td class="num">570</td><td class="num"> 4.74</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num">511</td><td class="num"> 5.30</td><td class="left">'Lukas'</td></tr>
     <tr><td class="num">505</td><td class="num"> 5.07</td><td class="left">'dpl'</td></tr>
-    <tr><td class="num">496</td><td class="num"> 5.27</td><td class="left">'Lukas'</td></tr>
-    <tr><td class="num">453</td><td class="num"> 5.02</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num">464</td><td class="num"> 5.02</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num">461</td><td class="num"> 4.89</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num">448</td><td class="num"> 5.08</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num">428</td><td class="num"> 4.22</td><td class="left">'Alexandros'</td></tr>
+    <tr><td class="num">432</td><td class="num"> 4.23</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num">424</td><td class="num"> 4.35</td><td class="left">'ged'</td></tr>
     <tr><td class="num">379</td><td class="num"> 4.93</td><td class="left">'U-Punkt'</td></tr>
     <tr><td class="num">348</td><td class="num"> 4.09</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num">307</td><td class="num"> 4.01</td><td class="left">'Sim_Ed'</td></tr>
+    <tr><td class="num">282</td><td class="num"> 4.59</td><td class="left">'ABS'</td></tr>
+    <tr><td class="num">275</td><td class="num"> 4.68</td><td class="left">'Gloop'</td></tr>
     <tr><td class="num">254</td><td class="num"> 4.91</td><td class="left">'JuSt'</td></tr>
-    <tr><td class="num">226</td><td class="num"> 4.95</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num">208</td><td class="num"> 6.15</td><td class="left">'Momcat'</td></tr>
     <tr><td class="num">187</td><td class="num"> 5.05</td><td class="left">'WP319'</td></tr>
     <tr><td class="num">135</td><td class="num"> 4.13</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num">129</td><td class="num"> 5.64</td><td class="left">'Raoul'</td></tr>
-    <tr><td class="num">123</td><td class="num"> 4.38</td><td class="left">'ABS'</td></tr>
     <tr><td class="num"> 99</td><td class="num"> 5.01</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num"> 97</td><td class="num"> 4.16</td><td class="left">'Safalra'</td></tr>
     <tr><td class="num"> 85</td><td class="num"> 4.76</td><td class="left">'para_doks'</td></tr>
@@ -34,8 +35,9 @@
     <tr><td class="num"> 49</td><td class="num"> 4.90</td><td class="left">'hendrik'</td></tr>
     <tr><td class="num"> 43</td><td class="num"> 3.74</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 30</td><td class="num"> 4.40</td><td class="left">'Archcorenth'</td></tr>
+    <tr><td class="num"> 25</td><td class="num"> 6.04</td><td class="left">'mrduke'</td></tr>
     <tr><td class="num"> 25</td><td class="num"> 4.88</td><td class="left">'Drotten'</td></tr>
-    <tr><td class="num"> 23</td><td class="num"> 6.00</td><td class="left">'mrduke'</td></tr>
+    <tr><td class="num"> 18</td><td class="num"> 7.44</td><td class="left">'Mark P.'</td></tr>
     <tr><td class="num"> 17</td><td class="num"> 5.53</td><td class="left">'Jeffrey S'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 7.63</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 13</td><td class="num"> 7.69</td><td class="left">'Ale'</td></tr>
@@ -43,19 +45,19 @@
     <tr><td class="num"> 11</td><td class="num"> 6.36</td><td class="left">'ShadowPhrogg32642342'</td></tr>
     <tr><td class="num"> 10</td><td class="num"> 7.80</td><td class="left">'hdwow'</td></tr>
     <tr><td class="num">  8</td><td class="num"> 3.25</td><td class="left">'Vlad'</td></tr>
+    <tr><td class="num">  7</td><td class="num"> 4.29</td><td class="left">'Snaily'</td></tr>
     <tr><td class="num">  5</td><td class="num"> 6.80</td><td class="left">'Breezy'</td></tr>
     <tr><td class="num">  5</td><td class="num"> 9.20</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 6.75</td><td class="left">'Agares'</td></tr>
-    <tr><td class="num">  4</td><td class="num">10.00</td><td class="left">'Mark P.'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 5.75</td><td class="left">'joseba'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 6.50</td><td class="left">'serpent'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 7.00</td><td class="left">'redsantz'</td></tr>
     <tr><td class="num">  3</td><td class="num"> 0.67</td><td class="left">'Turbogurk'</td></tr>
+    <tr><td class="num">  3</td><td class="num"> 7.67</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num">  3</td><td class="num"> 7.67</td><td class="left">'Joona'</td></tr>
     <tr><td class="num">  3</td><td class="num"> 3.00</td><td class="left">'Rugby4ever'</td></tr>
     <tr><td class="num">  3</td><td class="num"> 4.33</td><td class="left">'krazy62'</td></tr>
     <tr><td class="num">  2</td><td class="num"> 6.00</td><td class="left">'Mecki'</td></tr>
-    <tr><td class="num">  2</td><td class="num"> 8.00</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num">  2</td><td class="num"> 0.00</td><td class="left">'mhatta'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'ael'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'Uli'</td></tr>

Modified: homepage/input/table-solved.html
===================================================================
--- homepage/input/table-solved.html	2007-12-28 22:46:53 UTC (rev 958)
+++ homepage/input/table-solved.html	2008-01-01 18:27:02 UTC (rev 959)
@@ -1,64 +1,67 @@
   <table>
-    <caption>$$Solved_Level_Statistics$$ $$November$$ 2007</caption>
+    <caption>$$Solved_Level_Statistics$$ $$December$$ 2007</caption>
     <colgroup><col width="130"><col width="130"><col width="130"><col width="240"></colgroup>
     <tr><th>$$difficult$$</th><th>$$easy$$</th><th>$$total$$</th><th class="left">$$user$$</th></tr>
     <tr><td class="num">1043/1045</td><td class="num">189/189</td><td class="num"> 99.84%</td><td class="left">'Taztunes'</td></tr>
+    <tr><td class="num">1041/1045</td><td class="num">189/189</td><td class="num"> 99.68%</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1029/1045</td><td class="num">183/189</td><td class="num"> 98.22%</td><td class="left">'Craven'</td></tr>
     <tr><td class="num">1028/1045</td><td class="num">178/189</td><td class="num"> 97.73%</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">1020/1045</td><td class="num">184/189</td><td class="num"> 97.57%</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1014/1045</td><td class="num">175/189</td><td class="num"> 96.35%</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num">1006/1045</td><td class="num">178/189</td><td class="num"> 95.95%</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num">1007/1045</td><td class="num">178/189</td><td class="num"> 96.03%</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num"> 999/1045</td><td class="num">177/189</td><td class="num"> 95.30%</td><td class="left">'biotopa'</td></tr>
-    <tr><td class="num"> 966/1045</td><td class="num">168/189</td><td class="num"> 91.90%</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num"> 969/1045</td><td class="num">170/189</td><td class="num"> 92.30%</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num"> 970/1045</td><td class="num">166/189</td><td class="num"> 92.06%</td><td class="left">'Andy'</td></tr>
     <tr><td class="num"> 949/1045</td><td class="num">170/189</td><td class="num"> 90.68%</td><td class="left">'para_doks'</td></tr>
-    <tr><td class="num"> 943/1045</td><td class="num">158/189</td><td class="num"> 89.22%</td><td class="left">'Andy'</td></tr>
     <tr><td class="num"> 933/1045</td><td class="num">125/189</td><td class="num"> 85.74%</td><td class="left">'Alex'</td></tr>
     <tr><td class="num"> 914/1045</td><td class="num">135/189</td><td class="num"> 85.01%</td><td class="left">'JuSt'</td></tr>
     <tr><td class="num"> 894/1045</td><td class="num">140/189</td><td class="num"> 83.79%</td><td class="left">'Johannes'</td></tr>
+    <tr><td class="num"> 887/1045</td><td class="num">143/189</td><td class="num"> 83.47%</td><td class="left">'mrduke'</td></tr>
     <tr><td class="num"> 863/1045</td><td class="num">161/189</td><td class="num"> 82.98%</td><td class="left">'Tobias'</td></tr>
     <tr><td class="num"> 915/1045</td><td class="num">105/189</td><td class="num"> 82.66%</td><td class="left">'Django'</td></tr>
     <tr><td class="num"> 849/1045</td><td class="num">151/189</td><td class="num"> 81.04%</td><td class="left">'WP319'</td></tr>
-    <tr><td class="num"> 858/1045</td><td class="num">135/189</td><td class="num"> 80.47%</td><td class="left">'mrduke'</td></tr>
+    <tr><td class="num"> 867/1045</td><td class="num">124/189</td><td class="num"> 80.31%</td><td class="left">'Lukas'</td></tr>
     <tr><td class="num"> 874/1045</td><td class="num">103/189</td><td class="num"> 79.17%</td><td class="left">'Melanie'</td></tr>
     <tr><td class="num"> 841/1045</td><td class="num">123/189</td><td class="num"> 78.12%</td><td class="left">'shoki'</td></tr>
-    <tr><td class="num"> 841/1045</td><td class="num">114/189</td><td class="num"> 77.39%</td><td class="left">'Lukas'</td></tr>
     <tr><td class="num"> 950/1045</td><td class="num">  0/189</td><td class="num"> 76.99%</td><td class="left">'Tarim'</td></tr>
-    <tr><td class="num"> 798/1045</td><td class="num">141/189</td><td class="num"> 76.09%</td><td class="left">'Safalra'</td></tr>
+    <tr><td class="num"> 804/1045</td><td class="num">142/189</td><td class="num"> 76.66%</td><td class="left">'Safalra'</td></tr>
     <tr><td class="num"> 938/1045</td><td class="num">  1/189</td><td class="num"> 76.09%</td><td class="left">'Ale'</td></tr>
+    <tr><td class="num"> 747/1045</td><td class="num">137/189</td><td class="num"> 71.64%</td><td class="left">'Gloop'</td></tr>
+    <tr><td class="num"> 763/1045</td><td class="num">121/189</td><td class="num"> 71.64%</td><td class="left">'Gorn'</td></tr>
+    <tr><td class="num"> 738/1045</td><td class="num">131/189</td><td class="num"> 70.42%</td><td class="left">'ABS'</td></tr>
     <tr><td class="num"> 762/1045</td><td class="num"> 73/189</td><td class="num"> 67.67%</td><td class="left">'redsantz'</td></tr>
     <tr><td class="num"> 745/1045</td><td class="num"> 73/189</td><td class="num"> 66.29%</td><td class="left">'brynn'</td></tr>
+    <tr><td class="num"> 699/1045</td><td class="num">118/189</td><td class="num"> 66.21%</td><td class="left">'dev0'</td></tr>
     <tr><td class="num"> 734/1045</td><td class="num"> 82/189</td><td class="num"> 66.13%</td><td class="left">'bojster'</td></tr>
     <tr><td class="num"> 782/1045</td><td class="num"> 33/189</td><td class="num"> 66.05%</td><td class="left">'Sim_Ed'</td></tr>
-    <tr><td class="num"> 694/1045</td><td class="num">113/189</td><td class="num"> 65.40%</td><td class="left">'Gorn'</td></tr>
     <tr><td class="num"> 716/1045</td><td class="num"> 90/189</td><td class="num"> 65.32%</td><td class="left">'U-Punkt'</td></tr>
     <tr><td class="num"> 766/1045</td><td class="num"> 37/189</td><td class="num"> 65.07%</td><td class="left">'alfred69'</td></tr>
-    <tr><td class="num"> 675/1045</td><td class="num">126/189</td><td class="num"> 64.91%</td><td class="left">'ABS'</td></tr>
     <tr><td class="num"> 681/1045</td><td class="num"> 78/189</td><td class="num"> 61.51%</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 659/1045</td><td class="num"> 95/189</td><td class="num"> 61.10%</td><td class="left">'Marc-Hendrik'</td></tr>
     <tr><td class="num"> 633/1045</td><td class="num">110/189</td><td class="num"> 60.21%</td><td class="left">'Raoul'</td></tr>
+    <tr><td class="num"> 625/1045</td><td class="num">108/189</td><td class="num"> 59.40%</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num"> 643/1045</td><td class="num"> 83/189</td><td class="num"> 58.83%</td><td class="left">'Great Scott'</td></tr>
     <tr><td class="num"> 714/1045</td><td class="num">  0/189</td><td class="num"> 57.86%</td><td class="left">'Gottseinsohn'</td></tr>
-    <tr><td class="num"> 605/1045</td><td class="num">106/189</td><td class="num"> 57.62%</td><td class="left">'dev0'</td></tr>
     <tr><td class="num"> 625/1045</td><td class="num"> 82/189</td><td class="num"> 57.29%</td><td class="left">'dpl'</td></tr>
     <tr><td class="num"> 636/1045</td><td class="num"> 55/189</td><td class="num"> 56.00%</td><td class="left">'fabian'</td></tr>
+    <tr><td class="num"> 612/1045</td><td class="num"> 70/189</td><td class="num"> 55.27%</td><td class="left">'Breezy'</td></tr>
     <tr><td class="num"> 588/1045</td><td class="num"> 93/189</td><td class="num"> 55.19%</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 599/1045</td><td class="num"> 80/189</td><td class="num"> 55.02%</td><td class="left">'serpent'</td></tr>
     <tr><td class="num"> 634/1045</td><td class="num"> 43/189</td><td class="num"> 54.86%</td><td class="left">'Klaus'</td></tr>
-    <tr><td class="num"> 559/1045</td><td class="num">111/189</td><td class="num"> 54.29%</td><td class="left">'Mark P.'</td></tr>
+    <tr><td class="num"> 564/1045</td><td class="num">112/189</td><td class="num"> 54.78%</td><td class="left">'Mark P.'</td></tr>
+    <tr><td class="num"> 555/1045</td><td class="num">117/189</td><td class="num"> 54.46%</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 576/1045</td><td class="num"> 93/189</td><td class="num"> 54.21%</td><td class="left">'Guglielmo'</td></tr>
-    <tr><td class="num"> 596/1045</td><td class="num"> 60/189</td><td class="num"> 53.16%</td><td class="left">'Breezy'</td></tr>
     <tr><td class="num"> 570/1045</td><td class="num"> 83/189</td><td class="num"> 52.92%</td><td class="left">'Ludmian'</td></tr>
-    <tr><td class="num"> 537/1045</td><td class="num">113/189</td><td class="num"> 52.67%</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 525/1045</td><td class="num"> 95/189</td><td class="num"> 50.24%</td><td class="left">'ShadowPhrogg32642342'</td></tr>
     <tr><td class="num"> 589/1045</td><td class="num"> 26/189</td><td class="num"> 49.84%</td><td class="left">'hdwow'</td></tr>
     <tr><td class="num"> 533/1045</td><td class="num"> 82/189</td><td class="num"> 49.84%</td><td class="left">'Wuzzy'</td></tr>
     <tr><td class="num"> 506/1045</td><td class="num">108/189</td><td class="num"> 49.76%</td><td class="left">'Agnieszka'</td></tr>
     <tr><td class="num"> 613/1045</td><td class="num">  0/189</td><td class="num"> 49.68%</td><td class="left">'Little_Mole'</td></tr>
-    <tr><td class="num"> 498/1045</td><td class="num"> 93/189</td><td class="num"> 47.89%</td><td class="left">'B-Huff'</td></tr>
+    <tr><td class="num"> 478/1045</td><td class="num">101/189</td><td class="num"> 46.92%</td><td class="left">'Austin'</td></tr>
+    <tr><td class="num"> 478/1045</td><td class="num"> 81/189</td><td class="num"> 45.30%</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 519/1045</td><td class="num"> 37/189</td><td class="num"> 45.06%</td><td class="left">'Valkyrie2'</td></tr>
     <tr><td class="num"> 516/1045</td><td class="num"> 24/189</td><td class="num"> 43.76%</td><td class="left">'niebie'</td></tr>
     <tr><td class="num"> 494/1045</td><td class="num"> 26/189</td><td class="num"> 42.14%</td><td class="left">'Daniel'</td></tr>
-    <tr><td class="num"> 504/1045</td><td class="num"> 12/189</td><td class="num"> 41.82%</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num"> 506/1045</td><td class="num"> 12/189</td><td class="num"> 41.98%</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num"> 503/1045</td><td class="num">  7/189</td><td class="num"> 41.33%</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num"> 433/1045</td><td class="num"> 45/189</td><td class="num"> 38.74%</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 391/1045</td><td class="num"> 54/189</td><td class="num"> 36.06%</td><td class="left">'Tiza'</td></tr>
@@ -66,13 +69,13 @@
     <tr><td class="num"> 392/1045</td><td class="num"> 40/189</td><td class="num"> 35.01%</td><td class="left">'hendrik'</td></tr>
     <tr><td class="num"> 391/1045</td><td class="num"> 36/189</td><td class="num"> 34.60%</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 397/1045</td><td class="num"> 24/189</td><td class="num"> 34.12%</td><td class="left">'Chocolate Zero'</td></tr>
+    <tr><td class="num"> 333/1045</td><td class="num"> 86/189</td><td class="num"> 33.95%</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 376/1045</td><td class="num"> 35/189</td><td class="num"> 33.31%</td><td class="left">'Jeffrey S'</td></tr>
     <tr><td class="num"> 392/1045</td><td class="num"> 12/189</td><td class="num"> 32.74%</td><td class="left">'NorthForty'</td></tr>
     <tr><td class="num"> 344/1045</td><td class="num"> 51/189</td><td class="num"> 32.01%</td><td class="left">'Momcat'</td></tr>
     <tr><td class="num"> 382/1045</td><td class="num"> 10/189</td><td class="num"> 31.77%</td><td class="left">'J3FF'</td></tr>
     <tr><td class="num"> 335/1045</td><td class="num"> 50/189</td><td class="num"> 31.20%</td><td class="left">'Harry Lim'</td></tr>
     <tr><td class="num"> 346/1045</td><td class="num"> 38/189</td><td class="num"> 31.12%</td><td class="left">'Liam Sheehan'</td></tr>
-    <tr><td class="num"> 332/1045</td><td class="num"> 48/189</td><td class="num"> 30.79%</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 361/1045</td><td class="num"> 18/189</td><td class="num"> 30.71%</td><td class="left">'MicWa'</td></tr>
     <tr><td class="num"> 306/1045</td><td class="num"> 71/189</td><td class="num"> 30.55%</td><td class="left">'Davacardo'</td></tr>
     <tr><td class="num"> 336/1045</td><td class="num"> 41/189</td><td class="num"> 30.55%</td><td class="left">'Antonio EE'</td></tr>
@@ -82,15 +85,16 @@
     <tr><td class="num"> 281/1045</td><td class="num"> 63/189</td><td class="num"> 27.88%</td><td class="left">'erich'</td></tr>
     <tr><td class="num"> 295/1045</td><td class="num"> 29/189</td><td class="num"> 26.26%</td><td class="left">'Tiger'</td></tr>
     <tr><td class="num"> 288/1045</td><td class="num"> 36/189</td><td class="num"> 26.26%</td><td class="left">'Drotten'</td></tr>
-    <tr><td class="num"> 252/1045</td><td class="num"> 63/189</td><td class="num"> 25.53%</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 261/1045</td><td class="num"> 53/189</td><td class="num"> 25.45%</td><td class="left">'Andreas'</td></tr>
     <tr><td class="num"> 287/1045</td><td class="num"> 18/189</td><td class="num"> 24.72%</td><td class="left">'Nfol'</td></tr>
     <tr><td class="num"> 276/1045</td><td class="num"> 15/189</td><td class="num"> 23.58%</td><td class="left">'Thomas'</td></tr>
     <tr><td class="num"> 245/1045</td><td class="num"> 36/189</td><td class="num"> 22.77%</td><td class="left">'B-man'</td></tr>
     <tr><td class="num"> 259/1045</td><td class="num">  7/189</td><td class="num"> 21.56%</td><td class="left">'geembo_90'</td></tr>
+    <tr><td class="num"> 243/1045</td><td class="num"> 23/189</td><td class="num"> 21.56%</td><td class="left">'Snaily'</td></tr>
     <tr><td class="num"> 201/1045</td><td class="num"> 54/189</td><td class="num"> 20.66%</td><td class="left">'mhatta'</td></tr>
     <tr><td class="num"> 210/1045</td><td class="num"> 38/189</td><td class="num"> 20.10%</td><td class="left">'Sandra'</td></tr>
     <tr><td class="num"> 208/1045</td><td class="num"> 33/189</td><td class="num"> 19.53%</td><td class="left">'Uli'</td></tr>
+    <tr><td class="num"> 203/1045</td><td class="num"> 34/189</td><td class="num"> 19.21%</td><td class="left">'ntaeijr'</td></tr>
     <tr><td class="num"> 214/1045</td><td class="num"> 19/189</td><td class="num"> 18.88%</td><td class="left">'Adonica'</td></tr>
     <tr><td class="num"> 206/1045</td><td class="num">  4/189</td><td class="num"> 17.02%</td><td class="left">'krazy62'</td></tr>
     <tr><td class="num"> 181/1045</td><td class="num"> 20/189</td><td class="num"> 16.29%</td><td class="left">'Vaily'</td></tr>

Modified: homepage/input/table-wr.html
===================================================================
--- homepage/input/table-wr.html	2007-12-28 22:46:53 UTC (rev 958)
+++ homepage/input/table-wr.html	2008-01-01 18:27:02 UTC (rev 959)
@@ -1,52 +1,52 @@
   <table>
-    <caption>$$Worldrecord_Statistics$$ $$November$$ 2007</caption>
+    <caption>$$Worldrecord_Statistics$$ $$December$$ 2007</caption>
     <colgroup><col width="80"><col width="80"><col width="470"></colgroup>
     <tr><th>$$total$$</th><th>$$shared$$</th><th class="left">$$user$$</th></tr>
-    <tr><td class="num">823</td><td class="num">254</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">243</td><td class="num">119</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num">168</td><td class="num">133</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num"> 91</td><td class="num"> 51</td><td class="left">'Duffy'</td></tr>
-    <tr><td class="num"> 87</td><td class="num"> 67</td><td class="left">'daydreamer'</td></tr>
-    <tr><td class="num"> 74</td><td class="num"> 58</td><td class="left">'Great Scott'</td></tr>
-    <tr><td class="num"> 42</td><td class="num"> 36</td><td class="left">'Django'</td></tr>
-    <tr><td class="num"> 37</td><td class="num"> 31</td><td class="left">'Iceshark7'</td></tr>
+    <tr><td class="num">841</td><td class="num">264</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">238</td><td class="num">118</td><td class="left">'Stupid'</td></tr>
+    <tr><td class="num">164</td><td class="num">132</td><td class="left">'Johannes'</td></tr>
+    <tr><td class="num"> 91</td><td class="num"> 53</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num"> 77</td><td class="num"> 65</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num"> 69</td><td class="num"> 58</td><td class="left">'Great Scott'</td></tr>
+    <tr><td class="num"> 40</td><td class="num"> 36</td><td class="left">'Django'</td></tr>
+    <tr><td class="num"> 37</td><td class="num"> 32</td><td class="left">'Iceshark7'</td></tr>
+    <tr><td class="num"> 36</td><td class="num"> 29</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 36</td><td class="num"> 33</td><td class="left">'joseba'</td></tr>
-    <tr><td class="num"> 33</td><td class="num"> 26</td><td class="left">'Alexandros'</td></tr>
-    <tr><td class="num"> 29</td><td class="num"> 26</td><td class="left">'Ghatotkacha'</td></tr>
-    <tr><td class="num"> 24</td><td class="num">  9</td><td class="left">'Ronald'</td></tr>
-    <tr><td class="num"> 24</td><td class="num"> 19</td><td class="left">'Ludmian'</td></tr>
-    <tr><td class="num"> 24</td><td class="num"> 20</td><td class="left">'ged'</td></tr>
-    <tr><td class="num"> 23</td><td class="num"> 20</td><td class="left">'Safalra'</td></tr>
-    <tr><td class="num"> 22</td><td class="num"> 14</td><td class="left">'Zekobah'</td></tr>
-    <tr><td class="num"> 20</td><td class="num"> 18</td><td class="left">'bojster'</td></tr>
-    <tr><td class="num"> 18</td><td class="num">  5</td><td class="left">'ryujun'</td></tr>
+    <tr><td class="num"> 28</td><td class="num"> 26</td><td class="left">'Ghatotkacha'</td></tr>
+    <tr><td class="num"> 26</td><td class="num"> 18</td><td class="left">'Zekobah'</td></tr>
+    <tr><td class="num"> 23</td><td class="num"> 18</td><td class="left">'Ludmian'</td></tr>
+    <tr><td class="num"> 23</td><td class="num"> 20</td><td class="left">'ged'</td></tr>
+    <tr><td class="num"> 23</td><td class="num"> 21</td><td class="left">'Safalra'</td></tr>
+    <tr><td class="num"> 22</td><td class="num">  9</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num"> 22</td><td class="num"> 13</td><td class="left">'Emmanuel'</td></tr>
+    <tr><td class="num"> 20</td><td class="num">  4</td><td class="left">'ryujun'</td></tr>
+    <tr><td class="num"> 19</td><td class="num"> 15</td><td class="left">'ABS'</td></tr>
+    <tr><td class="num"> 19</td><td class="num"> 18</td><td class="left">'bojster'</td></tr>
     <tr><td class="num"> 18</td><td class="num"> 12</td><td class="left">'HuB34'</td></tr>
-    <tr><td class="num"> 14</td><td class="num">  9</td><td class="left">'Chocolate Zero'</td></tr>
-    <tr><td class="num"> 10</td><td class="num">  4</td><td class="left">'Taztunes'</td></tr>
+    <tr><td class="num"> 13</td><td class="num">  5</td><td class="left">'Taztunes'</td></tr>
+    <tr><td class="num"> 13</td><td class="num">  8</td><td class="left">'Chocolate Zero'</td></tr>
+    <tr><td class="num"> 13</td><td class="num">  9</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num"> 10</td><td class="num">  5</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-    <tr><td class="num"> 10</td><td class="num">  7</td><td class="left">'B-Huff'</td></tr>
-    <tr><td class="num"> 10</td><td class="num">  9</td><td class="left">'ABS'</td></tr>
     <tr><td class="num"> 10</td><td class="num"> 10</td><td class="left">'fabian'</td></tr>
-    <tr><td class="num">  9</td><td class="num">  7</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">  8</td><td class="num">  3</td><td class="left">'Breezy'</td></tr>
-    <tr><td class="num">  8</td><td class="num">  7</td><td class="left">'Wuzzy'</td></tr>
+    <tr><td class="num">  8</td><td class="num">  6</td><td class="left">'Gloop'</td></tr>
+    <tr><td class="num">  8</td><td class="num">  7</td><td class="left">'dpl' + 'Wuzzy'</td></tr>
     <tr><td class="num">  7</td><td class="num">  5</td><td class="left">'Lukas'</td></tr>
     <tr><td class="num">  7</td><td class="num">  6</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num">  6</td><td class="num">  3</td><td class="left">'para_doks'</td></tr>
     <tr><td class="num">  6</td><td class="num">  4</td><td class="left">'Raoul'</td></tr>
     <tr><td class="num">  6</td><td class="num">  5</td><td class="left">'Guglielmo'</td></tr>
     <tr><td class="num">  6</td><td class="num">  6</td><td class="left">'Tobias'</td></tr>
-    <tr><td class="num">  5</td><td class="num">  2</td><td class="left">'Craven'</td></tr>
-    <tr><td class="num">  5</td><td class="num">  5</td><td class="left">'Cyphase' + 'Emmanuel' + 'Thomas' + 'Chris' + 'Ralf'</td></tr>
-    <tr><td class="num">  4</td><td class="num">  2</td><td class="left">'Bent'</td></tr>
+    <tr><td class="num">  5</td><td class="num">  5</td><td class="left">'Cyphase' + 'Thomas' + 'Chris' + 'Ralf'</td></tr>
+    <tr><td class="num">  4</td><td class="num">  2</td><td class="left">'Bent' + 'Craven'</td></tr>
+    <tr><td class="num">  4</td><td class="num">  3</td><td class="left">'Andy'</td></tr>
     <tr><td class="num">  4</td><td class="num">  4</td><td class="left">'J3FF'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  1</td><td class="left">'shoki'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'hendrik' + 'Stephanie'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'geembo_90' + 'Neophilus'</td></tr>
+    <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'Austin' + 'Stephanie'</td></tr>
+    <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'geembo_90' + 'Neophilus' + 'hendrik'</td></tr>
     <tr><td class="num">  2</td><td class="num">  0</td><td class="left">'Ale' + 'Daniel'</td></tr>
     <tr><td class="num">  2</td><td class="num">  1</td><td class="left">'mrduke' + 'U-Punkt' + 'Vlad' + 'JuSt'</td></tr>
-    <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'Drotten' + 'Sim_Ed' + 'Ingo' + 'serpent'</td></tr>
-    <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'biotopa' + 'Alex' + 'Gorn' + 'Ant' + 'Melanie' + 'IChrisI' + 'Nat'</td></tr>
+    <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'Drotten' + 'Sim_Ed' + 'Snaily' + 'Ingo' + 'serpent'</td></tr>
+    <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'ntaeijr' + 'dev0' + 'Alex' + 'shoki' + 'Gorn' + 'Ant' + 'Melanie' + 'IChrisI' + 'Nat'</td></tr>
     <tr><td class="num">  1</td><td class="num">  1</td><td class="left">'alfred69' + 'Agares' + 'Tiger' + 'Zak' + 'Tiza' + 'niebie' + 'Andreas' + 'Samuel' + 'Mark P.' + 'jdcampo' + 'hdwow' + 'B-man' + 'Asbel' + 'Vaily' + 'Meeve' + 'krazy62'</td></tr>
-    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'Miel56' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'Mecki' + 'ael' + 'brynn' + 'IntKecsk' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'Magnus and Susi' + 'WP319' + 'dev0' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Little_Mole' + 'Harry Lim' + 'AkRa' + 'Momcat' + 'Andy' + 'NorthForty' + 'The red O' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'jojo' + 'Klaus' + 'Valkyrie2' + 'MicWa' + 'AsuCaga' + 'Rugby4ever' + 'Archcorenth' + 'mhatta' + 'Dvorhagen' + 'Antonio EE' + 'Holger' + 'Ingo_K' + 'redsantz' + 'Markus' + 'Liam Sheehan' + 'Michael' + 'Tarim' + 'Agnieszka'</td></tr>
+    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'Miel56' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'Mecki' + 'ael' + 'biotopa' + 'brynn' + 'IntKecsk' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'Magnus and Susi' + 'WP319' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Little_Mole' + 'Harry Lim' + 'AkRa' + 'Momcat' + 'NorthForty' + 'The red O' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'jojo' + 'Klaus' + 'Valkyrie2' + 'MicWa' + 'AsuCaga' + 'Rugby4ever' + 'Archcorenth' + 'mhatta' + 'Dvorhagen' + 'Antonio EE' + 'Holger' + 'Ingo_K' + 'redsantz' + 'Markus' + 'Liam Sheehan' + 'Michael' + 'Tarim' + 'Agnieszka'</td></tr>
   </table>

Modified: homepage/input/userlist.html
===================================================================
--- homepage/input/userlist.html	2007-12-28 22:46:53 UTC (rev 958)
+++ homepage/input/userlist.html	2008-01-01 18:27:02 UTC (rev 959)
@@ -20,6 +20,7 @@
     <li>Archcorenth</li>
     <li>Asbel</li>
     <li>AsuCaga</li>
+    <li>Austin</li>
     <li>Bent</li>
     <li>B-Huff</li>
     <li>biotopa</li>
@@ -47,6 +48,7 @@
     <li>ged</li>
     <li>geembo_90</li>
     <li>Ghatotkacha</li>
+    <li>Gloop</li>
     <li>Gorn</li>
     <li>Gottseinsohn</li>
     <li>Great Scott</li>
@@ -94,6 +96,7 @@
     <li>Nfol</li>
     <li>niebie</li>
     <li>NorthForty</li>
+    <li>ntaeijr</li>
     <li>para_doks</li>
     <li>Ralf</li>
     <li>Raoul</li>
@@ -108,6 +111,7 @@
     <li>ShadowPhrogg32642342</li>
     <li>shoki</li>
     <li>Sim_Ed</li>
+    <li>Snaily</li>
     <li>Stephanie</li>
     <li>Stupid</li>
     <li>Tarim</li>



From andreasl at mail.berlios.de  Wed Jan  2 01:09:32 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Wed, 2 Jan 2008 01:09:32 +0100
Subject: [Enigma-game-svn] r960 - in homepage: images images/articles
	images/lotm input input/articles input/lotm
Message-ID: <200801020009.m0209WYE007942@sheep.berlios.de>

Author: andreasl
Date: 2008-01-02 01:08:49 +0100 (Wed, 02 Jan 2008)
New Revision: 960

Added:
   homepage/images/articles/
   homepage/images/articles/eoya_2007_a.png
   homepage/images/articles/eoya_2007_b.png
   homepage/images/articles/eoya_2007_c.png
   homepage/images/articles/eoya_2007_d.png
   homepage/images/articles/eoya_2007_e.png
   homepage/images/articles/eoya_2007_f.png
   homepage/images/articles/eoya_2007_g.png
   homepage/images/articles/eoya_2007_h.png
   homepage/images/articles/eoya_2007_i.png
   homepage/images/articles/unknown.png
   homepage/images/articles/unknown_medium.png
   homepage/input/articles/
   homepage/input/articles/eoya_2007.html
   homepage/input/articles/eoya_2007_de.html
Removed:
   homepage/images/lotm/lotm.png
Modified:
   homepage/images/lotm/lotm-history.png
   homepage/input/infobox.html
   homepage/input/infobox_de.html
   homepage/input/lotm/lotm_archive_data.lua
   homepage/input/output-files.lua
Log:
Homepage:
 - Added article about "End of Year Awards" and
   "Level of the Year" (German and proofread English)
 - New-Year's greetings in infobox
 - Updated LotM-history for January
   (is "data from December 2007" correct?)
Note:
 - The EoYA-article is not grouped with the
   LotM-articles, but in an own, new directory
     input/articles,
   dedicated for articles of all origins other
   than LotM.
Todo:
 - Russian translation
 - News about EoYA
 - EoYA: full statistics


Added: homepage/images/articles/eoya_2007_a.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/eoya_2007_a.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/articles/eoya_2007_b.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/eoya_2007_b.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/articles/eoya_2007_c.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/eoya_2007_c.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/articles/eoya_2007_d.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/eoya_2007_d.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/articles/eoya_2007_e.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/eoya_2007_e.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/articles/eoya_2007_f.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/eoya_2007_f.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/articles/eoya_2007_g.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/eoya_2007_g.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/articles/eoya_2007_h.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/eoya_2007_h.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/articles/eoya_2007_i.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/eoya_2007_i.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/articles/unknown.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/unknown.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/articles/unknown_medium.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/unknown_medium.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: homepage/images/lotm/lotm-history.png
===================================================================
(Binary files differ)

Deleted: homepage/images/lotm/lotm.png
===================================================================
(Binary files differ)

Added: homepage/input/articles/eoya_2007.html
===================================================================
--- homepage/input/articles/eoya_2007.html	2008-01-01 18:27:02 UTC (rev 959)
+++ homepage/input/articles/eoya_2007.html	2008-01-02 00:08:49 UTC (rev 960)
@@ -0,0 +1,235 @@
+<div class="lotm">
+<h2>End of Year Awards 2007</h2>
+
+<p>During the past month, we asked our dear readers to vote for the best levels Enigma has to offer, in five categories, and to answer some questions of a general nature. Many thanks to all those who took the time (and it was a long questionnaire after all) and gave us the answers we were longing for. Instead of a Level-of-the-Month-January article, we now present the results of this poll.</p>
+
+<h3>Results of the general questions</h3>
+
+<p>To maintain the tension, we start with the more general statistics: All in all, we registered 741 clicks; 73
+users and up to 40 votes per question, which gives us a broad insight in how our pro-gamers play. And slightly more than half of all voters requested the German questionnaire.</p>
+
+<p>Most people (42%) came to Enigma during version 0.8x. I remember that I was one of them, I found Enigma packed with SuSE, surfed the net and saw that Enigma 0.92 was already there.
+
+</p>
+
+<p>A remarkable majority of 69% of all players use Windows 2000 or XP, often together with some Linux. The preferred Linux versions are Debian and Ubuntu. Another fascinating aspect is that around twice as many gamers use Windows 95/98 or ME (6 of 39) than Vista (3 of 39). 3 of 39 gamers use Mac OS (&quot;Tiger&quot; 1 vs. &quot;Panther&quot; 2). One gamer uses (in addition to Windows) a completely different operating system, and I'm still wondering which system this might be ... Finally, 2 of 39 use a dualcore, and 1 uses a gp2x.
+Originally we thought, we could drop support for the older versions of Windows and Mac OS. But the poll showed us that these systems are still widely used today, far more than expected.</p>
+
+<p>A quite polarizing question focused on the difficulty of the levels. We got 37 answers to this question, and about the half (16) states that the difficulty is okay the way it is. However, 9 claimed the levels should be easier, while 3 gamers wanted them to be more difficult. The opinions on the scattering of the difficulty varied widely - 8 want it to be less scattered, 6 say it should be more so.  </p>
+
+<p>Next, we asked for people's favorite kind of levels, and here the community found some common ground: Large majorities (over 50%) prefer small, quickly playable puzzle levels and levels that explore new combinations and gaming objects. Some 38% like large adventure levels, and only a minority of 14% would like to see more dexterity-levels or levels with large, difficult puzzles. 32% would like to see more levels of &quot;other types&quot;, and unfortunately I'm unsure which types this might be. I'm surprised (and personally rather happy) about this outcome, though it shows that the &quot;Level of the Month&quot; is not necessarily the most popular.   
+Of course, all level authors are still free to program their favorite kind of levels - however these statistics might offer some direction.  </p>
+
+<p>We all know the importance of the mag-heut.net-forum to Enigma's community. This is reflected by the answers to our next question about the importance of  various information channels: From 1 to 5 points, the forum reached an average of 4.097, the homepage followed with 4.059. The other channels were of far less importance: the developer mailing list (2.86), private communication (2.75), other (2.4), announcement mailing list (2.14) and the yahoo oxyd group (1.58). This confirmed our assumptions.
+</p>
+
+<p>We also asked you for your opinions about the future development of Enigma, and asked you to rate several topics. The results were quite difficult to evaluate, particularly as 9 of the 34 votes did not include all topics - but as an overall result, many new levels should have the highest priority, followed by a level editor, new objects (remember that many gamers would like to see more levels to explore new objects and features) and bug-fixes. Of medium priority are the netplay mode, backstage info (incl. LotM), and a save-system for exploration. Far behind we found the urge for new graphics and sounds, for tournaments and ports of Enigma to other platforms. Surely, it's difficult to assign priorities to topics we would all like to have - however, I find these data quite interesting, though it will only have a minor influence on our short-termed plans.</p>
+
+<p>We also got lots of nice, encouraging comments, thanks to all of you for these! :-)</p>
+
+<div class="quote">
+Enigma 0.22 was finished on December 30, 2001: it was a small
+development snapshot I created for backup purposes, almost three
+months before the first public release.  The main reason Enigma 0.22
+never left my hard drive is that there wasn't anything to play yet: I
+hadn't even started to program the black marble and its interaction
+with the other game objects.  But the graphics for some game objects
+like dynamite, bombs and the umbrella were already in place (and
+haven't changed much since then) and there was one single ``level'' I
+had created for testing.  So, here it is, the <b>Level of the Year 2001</b>:
+
+</div>
+
+
+<div class="lotmpic">
+  <img src="$$imagedir$$/articles/eoya_2007_a.png" alt="Level of the Year 2001" border="0">
+  <div class="imagetitle">
+Level of the Year 2001</div>
+</div>
+
+<div class="quote">
+<nobr>For the technically</nobr> interested readers, here is the source file of this first level:
+
+<pre>(o2-create-world &quot;Test Level&quot; 40 40)
+
+(draw-stones &quot;st-brownie&quot; 5 5  1 1  5)
+(draw-stones &quot;st-brownie&quot; 11 11  1 -1  5)
+(draw-stones &quot;st-brownie&quot; 2 6  1 -1  5)
+(draw-items &quot;it-umbrella&quot; 3 3  1 0  10)
+(set-item &quot;it-document&quot; '(10 4) 'text &quot;There's treasure everywhere&quot;)
+
+(fill-floor &quot;fl-sand&quot; 0 0 40 40)
+(fill-floor &quot;fl-rock&quot; 5 5 8 8)
+
+(o2-set-actor 12 5 (o2-make-object &quot;ac-blackball&quot;))
+
+(set-stone &quot;st-grate1&quot;
+
+            (list 15 5 
+                  10 10
+                  10 11
+                  10 12))
+</pre>
+
+</div>
+
+
+<div class="quote">
+Today, almost six years later, choosing a Level of the Year is not
+quite that easy.  Since Enigma's humble beginnings in 2001, the number
+of levels has skyrocketed to more than 1000, and solving even half of
+them requires a lot of dedication.  That some players have
+nevertheless managed to finish more than 90% of all levels is
+therefore even more impressive!  And it appears unlikely that things
+will change: if the past six years are indicative of the future,
+Enigma aficionados will have to solve at least one level every two
+days just to keep up with the new ones...
+
+</div>
+
+
+<div class="quote">
+The levels that won this year's competition are clearly some of the
+finest levels available.  &quot;Find the proper key&quot;-style puzzles are
+ubiquitous in &quot;modern&quot; 3D games, but the Best One-Screener shows how
+to do it properly.  The Best Level Series contains two levels that
+were among the first levels to engage directly with the player,
+taunting and challenging him, which still create a very special
+gaming experience.  The winner in the Best Design category goes even
+further: the combination of an almost epic tale of mystery and
+adventure, hairy puzzles, and a beautiful visual design makes it one
+of the most challenging and rewarding Enigma levels of all time.  The
+two Funniest Levels are truly original in the way they turn the idea
+of a &quot;meditation&quot; level upside down, and the best Yin-Yang level is an
+old friend: it was one of the first levels that employed the Yin-Yang
+objects, and to this day it remains one of the best ones.
+
+
+</div>
+
+
+<div class="quote">
+The award for the &quot;Level of the Year 2007&quot; finally goes to an
+all-time favourite level created by one of Enigma's master level
+designers.  It's sprawling maze filled with puzzles, suprises and
+dangers, and solving it should definitely be on your list of New
+Year's resolutions, if it isn't already...</div>
+
+
+<div class="quote">
+This year's Level of the Year award is the first of its kind, and I
+truly hope that it will become a tradition in the small but vibrant
+Enigma community.  The creativity of Enigma's level designers
+continues to amaze me, and I think it is the true reason for the
+game's success and its lasting appeal.  And, let's not fool ourselves:
+it's really the levels that reward us, and not the other way around.
+
+</div>
+
+
+<div class="author">
+
+Daniel Heck</div>
+
+
+<p>And here they are:</p>
+
+<h3>Best Onescreener 2007: &quot;Doors Galore&quot; by Ray Wick</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_h.png" alt="Doors Galore, IV/9" border="0">
+
+Doors Galore, IV/9</p>
+
+<p>&quot;Doors Galore&quot; is one of the most surprising and &quot;oxydian&quot; levels in Enigma, utilizing standard objects in new and fascinating ways. With 3.89 of 5 possible points, Ray Wick got a remarkable winning margin over &quot;Plan Ahead&quot; (3.59) and &quot;Industrial Puzzles&quot; (3.50).</p>
+
+<h3>Best Levelseries 2007: &quot;Gods of Enigma&quot; by moonpearl</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_f.png" alt="Gods of Enigma, V/67" border="0">
+
+Gods of Enigma, V/67</p>
+
+<div class="lotmpic">
+  <img src="$$imagedir$$/articles/eoya_2007_g.png" alt="Gods of Enigma II, V/69" border="0">
+  <div class="imagetitle">
+
+Gods of Enigma II, V/69</div>
+</div>
+
+<p>The &quot;Gods of Enigma&quot; level series by moonpearl came to Enigma via the mag-heut.net forum and set out to conquer the hearts of Enigma's players, and absolutely successful: With the heighest score of all votes, 4.23 points, it outrivaled even the enormously high results of &quot;Little Puzzles &amp; Big Adventures&quot; (4.03), and the &quot;Seed Puzzles&quot; (3.70).</p>
+
+<h3><nobr>Best Design 2007: &quot;The Aztec Temple&quot; </nobr>by Dominik Lehmann</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_i.png" alt="The Aztec Temple, VI/100" border="0">
+
+The Aztec Temple, VI/100</p>
+
+<p>The design award was arranged among three giants:
+Yet, with 4.19 points, the Level of the Month May 2007 &quot;The Aztec Temple&quot; dwarfed &quot;Mountain Climbing&quot; (3.80) and &quot;Solar System&quot; (3.68), and established a new terrain for Enigma's levels: After space ships, forests, cities and dark caverns, from now on the jungle will be a new possible setting for our level authors.</p>
+
+<h3>Funniest Levels 2007: &quot;Advancing&quot; and &quot;Mountain Climbing&quot; by Joseph Dunne</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_d.png" alt="Advancing, VII/23" border="0">
+
+Advancing, VII/23</p>
+
+<div class="lotmpic">
+  <img src="$$imagedir$$/articles/eoya_2007_e.png" alt="Mountain Climbing, VII/22" border="0">
+  <div class="imagetitle">
+Mountain Climbing, VII/22</div>
+</div>
+
+<p>Joseph Dunne made the double strike: His grandious levels &quot;Advancing&quot; and &quot;Mountain Climbing&quot; both received 3.786 points out of 5, and show what Enigma can be as well: The unique design of his levels reflects the lightness of these levels' atmospheres, framed by not slightly that easy puzzles. He outwitted even &quot;Diving&quot; (3.55) and &quot;What's the Problem?&quot; (3.52).</p>
+
+<h3><nobr>Best Yin-Yang Level 2007: &quot;Teamwork&quot; </nobr>by Jacob Scott</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_c.png" alt="Teamwork, III/18" border="0">
+
+Teamwork, III/18</p>
+
+<p>&quot;Teamwork&quot; is the most accurate description of the best Yin-Yang level of Enigma: Jacob showed with this level of the great old ones, what cooperation really means, and with 3.83 points &quot;Teamwork&quot; still shows respect for its comrades &quot;Turnstiles for Two&quot; (3.75) and &quot;Manamana&quot; (3.64).</p>
+
+<p>And now, to the most important category:</p>
+
+<h3>Level of the Year 2007: &quot;Island Labyrinth&quot; by Jacob Scott!</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_b.png" alt="Island Labyrinth, V/100" border="0">
+
+Island Labyrinth, V/100</p>
+
+<p>In the end, it really became exciting again, as four levels made large jumps up to become Level of the Year 2007: &quot;Quadropolis&quot; and &quot;Temple of Gold&quot; both overtook &quot;The Aztec Temple&quot;, and &quot;Houdini&quot; left &quot;Labyrinth of Puzzles&quot;, &quot;The Aztec Temple&quot; and even &quot;Temple of Gold&quot; behind itself - five levels between 9.10 and 9.25 points! But in the end, none of them was able to compete against &quot;Island Labyrinth&quot;: 5 of its 8 votes are the full 10 points, one 9, one 8 and one 7, which confirms Jacob Scott the undisputed title of Level Author of the Year 2007!</p>
+
+<h3>Coming to the end ...</h3>
+
+<p>This first round of our Level-of-the-Month series now amusingly ends the same way it started in March 2007: with &quot;Island Labyrinth&quot;. You may reread its article <a href="$$lotm_200703$$">here</a>. And at this point it's time for us to thank all those people who helped us over the last year with our articles: First of all to all contributors of comments; to 
+Alejandro Lacava,
+Ronald Lamprecht,
+Andreas Geldmacher,
+Hubai Andr&aacute;s,
+Tarim,
+Raoul Bourquin,
+illmind,
+Manfredi Carta,
+Manuel K&ouml;nig,
+Linda Mihalic,
+Mark Pulley,
+Lukas Sch&uuml;ller,
+Shoki,
+Spioni,
+Craven,
+and Daniel Heck.
+Greatest thanks go out to Clifford J. Tasner (Taztunes), who proofread every single article, and helped us with - believe it or not - five comments! He was always there when we needed one more contribution, and always on time. Great thanks also go to Yuriy, who takes the trouble to translate all our articles into Russian for our Russian friends, often within only 24 hours, and to Joe, who was the main author of July's article. Many thanks to all of you!</p>
+
+<p>We also want to thank our level authors, who wrote the ten terrific levels we were able to report on during the last year, and who contributed comments for our articles as well: Thank you, Jacob Scott, Manuel K&ouml;nig, Dominik Lehmann, Ronald Lamprecht, Barry and Lori Mead, Johannes Laire, Raoul Bourquin, and Jon 'WB' Sneyers. And thanks to the originator of the Enigma project, to Daniel Heck, as well as Meinolf Schneider, who gave birth to Esprit and Oxyd, our constant inspirations.</p>
+
+<p>You can find the current statistics of our ten LotM's in the <a href="$$lotm$$">LotM-archive</a>, and the exact statistical results of the poll will soon be online <a href="$$eoya_2007_statistics$$">here</a>.</p>
+
+<p>Happy New Year's Level,<br>
+<i>Andreas &amp;Harry</i></p>
+
+</div>

Added: homepage/input/articles/eoya_2007_de.html
===================================================================
--- homepage/input/articles/eoya_2007_de.html	2008-01-01 18:27:02 UTC (rev 959)
+++ homepage/input/articles/eoya_2007_de.html	2008-01-02 00:08:49 UTC (rev 960)
@@ -0,0 +1,194 @@
+<div class="lotm">
+<h2>Jahresendauszeichnungen 2007</h2>
+
+<p>W&auml;hrend des vergangenen Monats haben wir unsere lieben Leser gebeten, die besten Levels zu bewerten, die Enigma zu bieten hat, in f&uuml;nf Kategorien, und ein paar Fragen allgemeinerer Natur zu beantworten. Vielen Dank an all die, die sich daf&uuml;r die Zeit genommen haben (und es war letztlich ein ziemlich langer Fragebogen) und uns die Antworten gaben, nach denen wir suchten. Anstelle eines Level-des-Monats-Januar-Artikel, pr&auml;sentieren wir nun die Ergebnisse dieser Umfrage.
+</p>
+
+<h3>Ergebnisse der allgemeinen Fragen</h3>
+
+<p>Um die Spannung aufrecht zu erhalten, beginnen wir mit den allgemeineren Statistiken: Insgesamt haben wir 741 Klicks registriert, 73 Nutzer und bis zu 40 Antworten pro Frage, was uns einen breiten Einblick darin gibt, wir unsere professionellen Spieler spielen. Und: Etwas mehr als die H&auml;lfte aller Spieler nutzten den deutschsprachigen Fragebogen.
+</p>
+
+<p>Die meisten (42%) stie&szlig;en zu Enigma w&auml;hrend Version 0.8x. Ich erinnere mich, dass ich einer von ihnen war, ich fand Enigma als Paket f&uuml;r SuSE, surfte durchs Netz und sah, dass Enigma 0.92 bereits drau&szlig;en war.
+</p>
+
+<p>Eine bemerkenswerte Mehrheit von 69% aller Spieler benutzen Windows 2000 oder XP, oft zusammen mit einem Linux. Die bevorzugten Linux Versionen sind Debian und Ubuntu. Ein weiterer faszinierender Aspekt ist, dass etwa doppelt so viele Spieler Windows 95/98 oder ME verwenden (6 von 39) als Vista (3 von 39). 3 von 39 Spielern nutzen Mac OS (&quot;Tiger&quot; 1 zu &quot;Panther&quot; 2). Ein Spieler nutzt (zus&auml;tzlich zu einem Windows) ein komplett anderes Betriebssystem, und ich frage mich nach wie vor, welches System das sein mag ... Schlie&szlig;lich benutzen 2 von 39 einen Dualcore und einer nutzt einen gp2x. Urspr&uuml;nglich dachten wir, wir k&ouml;nnten die Unterst&uuml;tzung f&uuml;r die &auml;lteren Versionen von Windows und Mac OS einstellen. Aber die Umfrage hat uns gezeigt, dass diese Systeme da drau&szlig;en noch immer verwendet werden, weit h&auml;ufiger als erwartet.</p>
+
+<p>Eine ziemlich polarisierende Frage zielte auf den Schwierigkeitsgrad der Levels ab. Wir bekamen 37 Antworten zu dieser Frage, und etwa die H&auml;lfte (16) findet, dass der Schwierigkeitsgrad richtig ist, so wie er ist. Jedoch m&ouml;chten 9 die Levels lieber einfacher haben, und 3 Spieler lieber schwerer. Die Streuung der Schwierigkeit ist umstritten - 8 w&uuml;nschen sich eine kleinere Streuung, 6 h&auml;tten gerne eine gr&ouml;&szlig;ere. 
+</p>
+
+<p>Als n&auml;chstes fragten wir nach der bevorzugten Levelart, und hier findet unsere Gemeinschaft eine gemeinsame Basis: Gro&szlig;e Mehrheiten (&uuml;ber 50%) bevorzugen kleine, schnell spielbare R&auml;tsellevel und Levels zum Erforschen neuer Kombinationen und neuer Spielobjekte. Etwa 38% m&ouml;gen gro&szlig;e Abenteuerlevel, und nur eine Minderheit von 14% w&uuml;rde gerne mehr Geschicklichkeits-Levels sehen, oder gro&szlig;e, schwere R&auml;tsel. 32% h&auml;tten gerne mehr Levels von &quot;anderem Typ&quot;, und leider bin ich unsicher, welche Arten das noch sein m&ouml;gen. Ich bin &uuml;berrascht (und pers&ouml;nlich auch gl&uuml;cklich) &uuml;ber dieses Ergebnis. obwohl es zeigt, dass der &quot;Level des Monats&quot; nicht unbedingt die beliebtesten Levels wiederspiegelt. Nat&uuml;rlich steht es allen Levelautoren nach wie vor frei, Landschaften nach ihrem Gusto zu programmieren - jedoch, in Zweifelsf&auml;llen, m&ouml;gen diese Zahlen vielleicht einen Hinweis ge!
 ben.
+
+</p>
+
+<p>Wir alle kennen die Wichtigkeit des mag-heut.net-Forums f&uuml;r Enigmas Gemeinschaft. Dies wird auch reflektiert von den Antworten auf unsere n&auml;chste Frage nach der Wichtigkeit der verschiedenen Informationskan&auml;le: Von 1 bis 5 Punkten, erreichte das Forum einen Schnitt von 4,10, die Homepage folgt mit 4,06. Die anderen Kan&auml;le sind von weit geringerer Bedeutung: die Entwickler-Mailing-Liste (2,86), private Kommunikation (2,75), weiteres (2,4), die Ank&uuml;ndigungs-Mailing-Liste (2,14) und die Yahoo Oxyd-Gruppe (1,58). Dies best&auml;tigte unsere Vermutungen.
+</p>
+
+<p>Wir haben Sie auch nach Ihrer Meinung &uuml;ber die weitere Entwicklung von Enigma gefragt, und gebeten, die verschiedenen Arbeitsgebiete zu bewerten. Das Ergebnis ist sehr schwierig auszuwerten, insbesondere da 9 von 34 Antworten nicht alle Arbeitsgebiete enthalten - aber als wesentliches Resultat, sollten neue Levels die h&ouml;chste Priorit&auml;t haben, gefolgt von einem Leveleditor, neuen Objekten (wir erinnern uns daran, dass viele Spieler gerne mehr Levels zum Erforschen neuer Spielobjekte und Features sehen w&uuml;rden), sowie Fehlerbehebung. Von mittlerer Priorit&auml;t sind der Zweispielermodus (via Netz), Hintergrundinformationen (einschlie&szlig;lich dem LdM) und ein System zum Abspeichern w&auml;hrend der Erforschung. Weiter hinten finden wir den Wunsch nach neuen Grafiken und Sounds, nach Turnieren und Portierungen von Enigma auf andere Plattformen. Sicher, es ist schwierig, allen Gebieten Priorit&auml;ten zuzuordnen, die man gerne h&auml;tte - wie auch imm!
 er, ich finde diese Bewertung durchaus interessant, obwohl sie nur einen geringen Einfluss auf unsere kurzfristigen Pl&auml;ne aus&uuml;ben wird.</p>
+
+<p>Wir haben auch viele nette und ermunternde Kommentare bekommen, vielen Dank an alle daf&uuml;r! :-)</p>
+
+<div class="quote">
+Enigma 0.22 wurde am 30. Dezember 2001 fertig: Es war ein kleiner Schnappschuss aus der Entwicklung, den ich als Backup gemacht hatte, fast drei Monate vor dem ersten &ouml;ffentlichen Release. Der Hauptgrund, aus dem Enigma 0.22 niemals meine Festplatte verlassen hat, war, dass es noch nichts zu Spielen gab: Ich hatte noch nicht mal angefangen, die schwarze Murmel und ihre Interaktion mit den anderen Spielobjekten zu programmieren. Aber die Grafik f&uuml;r einige Spielobjekte wie Dynamit, Bomben und den Regenschirm war bereits fertig (und hat sich seit damals nicht wesentlich ver&auml;ndert), und es gab einen einzelnen &quot;Level&quot;, den ich zu Testzwecken geschrieben hatte, Nun, hier ist er, der <b>Level des Jahres 2001</b>:</div>
+
+
+<div class="lotmpic">
+  <img src="$$imagedir$$/articles/eoya_2007_a.png" alt="Level des Jahres 2001" border="0">
+  <div class="imagetitle">
+Level des Jahres 2001</div>
+</div>
+
+<div class="quote">
+<nobr>F&uuml;r den technisch interessierten </nobr>Leser ist hier der Quellcode dieses ersten Levels:
+
+<pre>(o2-create-world &quot;Test Level&quot; 40 40)
+
+(draw-stones &quot;st-brownie&quot; 5 5  1 1  5)
+(draw-stones &quot;st-brownie&quot; 11 11  1 -1  5)
+(draw-stones &quot;st-brownie&quot; 2 6  1 -1  5)
+(draw-items &quot;it-umbrella&quot; 3 3  1 0  10)
+(set-item &quot;it-document&quot; '(10 4) 'text &quot;There's treasure everywhere&quot;)
+
+(fill-floor &quot;fl-sand&quot; 0 0 40 40)
+(fill-floor &quot;fl-rock&quot; 5 5 8 8)
+
+(o2-set-actor 12 5 (o2-make-object &quot;ac-blackball&quot;))
+
+(set-stone &quot;st-grate1&quot;
+
+            (list 15 5 
+                  10 10
+                  10 11
+                  10 12))
+</pre>
+
+</div>
+
+
+<div class="quote">
+Heute, fast sechs Jahre sp&auml;ter, ist es nicht ganz so einfach, einen Level des Jahres zu w&auml;hlen. Seit Enigmas bescheidenen Anf&auml;ngen 2001 wurde die Zahl der Levels auf &uuml;ber 1000 katapultiert, und allein nur die H&auml;lfte von ihnen zu l&ouml;sen, n&ouml;tigt einem viel Hingabe zum Spiel ab. Dass es einige Spieler trotzdem geschafft haben, mehr als 90% aller Levels zu l&ouml;sen, ist dementsprechend umso beeindruckender! Und es erscheint unwahrscheinlich, dass sich dies in Zukunft &auml;ndern wird: Wenn die vergangenen sechs Jahre auf die Zukunft &uuml;bertragen werden d&uuml;rfen, werden Enigmas Fans mindestens alle zwei Tage einen Level l&ouml;sen m&uuml;ssen, nur um mit dem Ansturm neuer Levels mitzuhalten ...
+
+</div>
+
+
+<div class="quote">
+Die Levels, die den diesj&auml;hrigen Wettbewerb gewonnen haben, sind ganz klar einige der feinsten Landschaften, die es zur Zeit f&uuml;r Enigma gibt. R&auml;tsel im &quot;Finde den richtigen Schl&uuml;ssel&quot;-Sinn sind in &quot;modernen&quot; 3D-Spielen allgegenw&auml;rtig, aber der Beste Onescreener zeigt, wie's richtig geht. Die Beste Levelserie enth&auml;lt zwei Levels, die unter den ersten Landschaften waren, die direkt die Aufmerksamkeit des Spielers weckten, ihn verh&ouml;hnen und herausfordern, was noch immer eine einzigartige Spielerfahrung kreiert. Der Sieger in der Kategorie &quot;Bestes Design&quot; geht sogar noch weiter: Die Kombination einer fast epischen Geschichte von Mysterium und Abenteuer, haarstr&auml;ubende R&auml;tsel und eine wundervolles visuelles Design machen diesen Level zu einem der herausfordernsten und lohnenswertesten in Enigma aller Zeiten. Die beiden Lustigsten Level sind wahrhaft originell in der Art, wie sie die Idee der Meditations-L!
 andschaften auf den Kopf stellen, und der Beste Yin-Yang-Level ist ein alter Freund: Er war unter den ersten Levels, die die Yin-Yang-Objekte verwendeten, und bleibt bis heute einer der besten.
+
+</div>
+
+
+<div class="quote">
+Schlie&szlig;lich geht der Preis des &quot;Levels des Jahres 2007&quot; an eine Landschaft, die in ihrer Beliebtheit bislang unerreicht ist, und von einem von Enigmas Meisterleveldesignern geschrieben wurde. Sein sich lang erstreckender Irrgarten, angef&uuml;llt mit R&auml;tseln, &Uuml;berraschungen und Gefahren, und ihn zu l&ouml;sen, sollen definit auf Ihrer Liste guter Vors&auml;tze f&uuml;r das neue Jahr stehen, wenn er das noch nicht ist ...
+</div>
+
+<div class="quote">
+Der Preis zum &quot;Level des Jahres&quot; ist der erste seiner Art, und ich hoffe wahrhaft, dass er zu einer Tradition der kleinen, aber lebhaften Enigma Gemeinschaft wird. Die Kreativit&auml;t von Enigmas Leveldesignern verbl&uuml;fft mich weiterhin, und ich denke, das das sie der wahre Grund f&uuml;r den Erfolg des Spiels und seinen lange wirkenden Charme ist. Und, schlie&szlig;lich, um uns selbst nicht zu t&auml;uschen: Es sind wirklich die Levels, die uns belohnen, nicht anders herum.
+
+</div>
+
+
+<div class="author">
+Daniel Heck</div>
+
+
+<p>Und hier sind sie:</p>
+
+<h3>Bester Onescreener 2007: &quot;Doors Galore&quot; von Ray Wick</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_h.png" alt="Doors Galore, IV/9" border="0">
+
+Doors Galore, IV/9</p>
+
+<p>&quot;Doors Galore&quot; ist einer der &uuml;berraschendsten und &quot;oxydischsten&quot; Levels in Enigma, verwendet dabei nur Standardobjekte auf neue und faszinierende Weise. Mit 3,89 von 5 m&ouml;glichen Punkten hat Ray Wick einen bemerkenswerten Vorsprung vor &quot;Plan Ahead&quot; (3,59) und &quot;Industrial Puzzles&quot; (3,50).</p>
+
+<h3>Beste Levelserie 2007: &quot;Gods of Enigma&quot; von moonpearl</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_f.png" alt="Gods of Enigma, V/67" border="0">
+
+Gods of Enigma, V/67</p>
+
+<div class="lotmpic">
+  <img src="$$imagedir$$/articles/eoya_2007_g.png" alt="Gods of Enigma II, V/69" border="0">
+  <div class="imagetitle">
+
+Gods of Enigma II, V/69</div>
+</div>
+
+<p>Die &quot;Gods of Enigma&quot;-Levelserie von moonpearl erreichte Enigma &uuml;ber das mag-heut.net-Forum und zog aus, die Herzen der Enigmaspieler zu erobern - und war absolut erfolgreich: Mit der h&ouml;chsten Wertung aller Levels quer durch alle f&uuml;nf Kategorien, 4,23 Punkten, &uuml;bertrafen die &quot;Gods of Enigma&quot; sogar die enorm hohen Ergebnisse von &quot;Little Puzzles &amp; Big Adventures&quot; (4,03) und den &quot;Seed Puzzles&quot; (3,70).</p>
+
+<h3><nobr>Bestes Design 2007: &quot;The Aztec Temple&quot; </nobr>von Dominik Lehmann</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_i.png" alt="The Aztec Temple, VI/100" border="0">
+
+The Aztec Temple, VI/100</p>
+
+<p>Der Designpreis wurde unter drei Giganten ausgemacht: Dennoch hat der Level des Monats Mai 2007, &quot;The Aztec Temple&quot;, mit 4,19 Punkten &quot;Mountain Climbing&quot; (3,80) und &quot;Solar System&quot; (3,68) in den Schatten gestellt, und eine v&ouml;llig neue Umgebung f&uuml;r Enigmas Levels etabliert: Neben Raumschiffen, W&auml;ldern, St&auml;dten und dunklen Gassen, wird von nun an der Dschungel ein neues m&ouml;gliches Setting f&uuml;r unsere Levelautoren sein.</p>
+
+<h3>Lustigste Levels 2007: &quot;Advancing&quot; und &quot;Mountain Climbing&quot; von Joseph Dunne</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_d.png" alt="Advancing, VII/23" border="0">
+
+Advancing, VII/23</p>
+
+<div class="lotmpic">
+  <img src="$$imagedir$$/articles/eoya_2007_e.png" alt="Mountain Climbing, VII/22" border="0">
+  <div class="imagetitle">
+Mountain Climbing, VII/22</div>
+</div>
+
+<p>Joseph Dunne schaffte einen Doppelschlag: Seine grandiosen Levels &quot;Advancing&quot; und &quot;Mountain Climbing&quot; erreichten beide 3,786 von 5 Punkten, und demonstrierten, was Enigma auch sein kann: Das einzigartige Design seiner Levels spiegelt die Leichtigkeit ihrer Spielatmosph&auml;ren wieder, eingerahmt von nicht ganz so leichten R&auml;tseln. Er hat damit sogar &quot;Diving&quot; (3,55) und &quot;What's the Problem?&quot; (3,52) ausgestochen.</p>
+
+<h3><nobr>Bester Yin-Yang-Level 2007: &quot;Teamwork&quot; </nobr>von Jacob Scott</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_c.png" alt="Teamwork, III/18" border="0">
+
+Teamwork, III/18</p>
+
+<p>&quot;Teamwork&quot; ist die treffendste Bezeichnung f&uuml;r den besten Yin-Yang-Level in Enigma: Jacob zeigt mit diesem klassischen Level, was Zusammenarbeit wirklich bedeutet, und mit 3,83 Punkten zeigt &quot;Teamwork&quot; noch Respekt vor seinen Kameraden &quot;Turnstiles for Two&quot; (3,75) und &quot;Manamana&quot; (3,64).</p>
+
+<p>Und nun, die wichtigste Kategorie:</p>
+
+<h3>Level des Jahres 2007: &quot;Island Labyrinth&quot; von Jacob Scott!</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_b.png" alt="Island Labyrinth, V/100" border="0">
+
+Island Labyrinth, V/100</p>
+
+<p>Zum Ende ist es doch nochmal spannend geworden, da gleich vier Levels einen gro&szlig;en Sprung nach oben gemacht haben, um Level des Jahres 2007 zu werden: &quot;Quadropolis&quot; und &quot;Temple of Gold&quot; haben beide &quot;The Aztec Temple&quot; &uuml;berholt, und Houdini lie&szlig; &quot;Labyrinth of Puzzles&quot;, &quot;The Aztec Temple&quot; und sogar &quot;Temple of Gold&quot; hinter sich - f&uuml;nf Levels zwischen 9.10 und 9.25 Punkten! Aber am Ende konnte keiner von ihnen &quot;Island Labyrinth&quot; das Wasser reichen: 5 seiner 8 Wertungen sind volle 10 Punkte, eine 9, eine 8 und eine 7 f&uuml;llen die Wertung auf, was Jacob Scott als unbestrittenden Levelautor des Jahres 2007 best&auml;tigt!</p>
+
+<h3>Wir kommen zum Ende ...</h3>
+
+<p>Diese erste Runde unserer Level-des-Monats-Serie endet nun am&uuml;santerweise, wie sie im M&auml;rz 2007 begonnen hat: mit &quot;Island Labyrinth&quot;. Sie k&ouml;nnen seinen Artikel <a href="$$lotm_200703$$">hier</a> nochmal nachlesen. Und an dieser Stelle wird es Zeit, dass wir uns bei all den Leuten bedanken, die uns &uuml;ber das letzte Jahr geholfen haben, unsere Artikel zu schreiben: Zuerst mal jenen, die einen Kommentar beigetragen haben, an
+Alejandro Lacava,
+Ronald Lamprecht,
+Andreas Geldmacher,
+Hubai Andr&aacute;s,
+Tarim,
+Raoul Bourquin,
+illmind,
+Manfredi Carta,
+Manuel K&ouml;nig,
+Linda Mihalic,
+Mark Pulley,
+Lukas Sch&uuml;ller,
+Shoki,
+Spioni,
+Craven,
+und Daniel Heck.
+Gr&ouml;&szlig;ter Dank geht an Taztunes, der die englische Version jeden einzelnen Artikels korrekturgelesen hat, und uns mit sage und schreibe f&uuml;nf Kommentaren ausgeholfen hat! Er war immer da, wenn wir einen weiteren Beitrag brauchten, und immer
+p&uuml;nktlich. Gro&szlig;er Dank geht auch an Yuriy, der die M&uuml;he auf sich nimmt, jeden unserer Artikel f&uuml;r unsere russischen Freunde ins Russische zu &uuml;bersetzen, oft innerhalb von nur 24 Stunden, und an Joe, der der federf&uuml;hrende Autor des Juli-Artikels war. Vielen Dank an Euch alle!</p>
+
+<p>Wir wollen auch unseren Levelautoren danken, die die gro&szlig;artigen zehn Levels geschrieben haben, &uuml;ber die wir w&auml;hrend des letzten Jahres berichten durften, und die ebenfalls Kommentare f&uuml;r unsere Artikel beigesteuert haben: Vielen Dank Jacob Scott, Manuel K&ouml;nig, Dominik Lehmann, Ronald Lamprecht, Barry and Lori Mead, Johannes Laire, Raoul Bourquin, und Jon 'WB' Sneyers. Und Dank geht an den Gr&uuml;nder des Enigma-Projektes, an Daniel Heck, ebenso wie an Meinolf Schneider, der Esprit und Oxyd geschaffen hat, unsere steten Inspirationen.</p>
+
+<p>Sie k&ouml;nnen die aktuellen Statistiken unserer zehn LdMs im <a href="$$lotm$$">LdM-Archiv</a> finden, und die genauen statistischen Ergebnisse der Abstimmung werden bald schon <a href="$$eoya_2007_statistics$$">hier</a> online sein.</p>
+
+<p>Frohes Neues Level-Jahr,<br>
+<i>Andreas &amp;Harry</i></p>
+
+</div>

Modified: homepage/input/infobox.html
===================================================================
--- homepage/input/infobox.html	2008-01-01 18:27:02 UTC (rev 959)
+++ homepage/input/infobox.html	2008-01-02 00:08:49 UTC (rev 960)
@@ -1,13 +1,22 @@
     <div class="infobody">
        <div class="info">
-         <h3>More than 10,000 level ratings</h3>
-         This month we reached the 10,000-ratings mark. Thanks to all the
-         sedulous players, who sent us their opinions!
-         <h3>Level of the Month</h3>
+         <h3>Happy IV/2!</h3>
+         The Enigma Team wishes everyone a Happy New Year!
+         Let's hope for many new levels in 2008&mdash;some are
+         already in the starting blocks&hellip;
+         <!--<h3>Level of the Month</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
+         </div>  -->
+         <h3>End-of-Year Awards</h3>
+         <a href="$$eoya_2007$$"><img src="images/articles/unknown_medium.png"
+         alt="Which might be the Level of the Year?" border="0"></a>
+         <div class="imagetitle">
+           The best levels of 2007 are chosen and the Level of the Year 2007
+           has been determined - find out who got the awards
+           <a href="$$eoya_2007$$">here</a>!
          </div>
          <h3>PAR and Hcp Recalibration</h3>
 	 Due to the increasing number of score submitters we are now able to

Modified: homepage/input/infobox_de.html
===================================================================
--- homepage/input/infobox_de.html	2008-01-01 18:27:02 UTC (rev 959)
+++ homepage/input/infobox_de.html	2008-01-02 00:08:49 UTC (rev 960)
@@ -1,14 +1,22 @@
     <div class="infobody">
        <div class="info">
-         <h3>&Uuml;ber 10.000 Levelbewertungen</h3>
-         Diesen Monat haben wir die 10.000er Marke bei den Ratings
-         &uuml;berboten. Vielen Dank an die unerm&uuml;dlichen Spieler,
-         die uns ihre Meinung mitgeteilt haben!
-         <h3>Level des Monats</h3>
+         <h3>Frohes IV/2!</h3>
+         Das Enigma-Team w&uuml;nscht allen ein frohes neues Jahr!
+         Lasst uns auf viele neue Levels in 2008 hoffen - einige
+         stehen bereits in den Startbl&ouml;cken&hellip;
+         <!--<h3>Level des Monats</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
+         </div>-->
+         <h3>Jahresend-<br>auszeichnungen</h3>
+         <a href="$$eoya_2007$$"><img src="images/articles/unknown_medium.png"
+         alt="Welches mag der Level des Jahres sein?" border="0"></a>
+         <div class="imagetitle">
+           Die besten Levels aus 2007 sind gew&auml;hlt und der Level des
+           Jahres 2007 steht fest - finden Sie <a href="$$eoya_2007$$">hier</a>
+           raus, wer die Preise gewonnen hat!
          </div>
          <h3>PAR und Hcp Recalibration</h3>
 	 Aufgrund der gestiegenen Anzahl an Einsendungen von Ergebnissen

Modified: homepage/input/lotm/lotm_archive_data.lua
===================================================================
--- homepage/input/lotm/lotm_archive_data.lua	2008-01-01 18:27:02 UTC (rev 959)
+++ homepage/input/lotm/lotm_archive_data.lua	2008-01-02 00:08:49 UTC (rev 960)
@@ -99,19 +99,19 @@
 -- format: Level Title, current_rating, current_votes, additional text
 
 lotm_rating(    "Island Labyrinth",  9.25,   8,  "")
-lotm_rating(  "Pneumatic Delivery",  7.77,  13,  "")
-lotm_rating(    "The Aztec Temple",  9.13,   8,  "(1 up)")
-lotm_rating("Labyrinth of Puzzles",  8.92,  13,  "")
+lotm_rating(  "Pneumatic Delivery",  7.86,  14,  "")
+lotm_rating(    "The Aztec Temple",  9.10,  10,  "(3 down)")
+lotm_rating("Labyrinth of Puzzles",  8.92,  13,  "(1 down)")
 lotm_rating(           "Elaborate",  8.63,   8,  "")
-lotm_rating(             "Houdini",  8.86,  10,  "")
-lotm_rating(           "Tool Time",  8.50,  16,  "")
-lotm_rating(         "Quadropolis",  9.11,   9,  "(2 down)")
-lotm_rating(      "Big Adventures",  8.33,  18,  "")
-lotm_rating(      "Temple of Gold",  9.00,   5,  "<b>(newcomer)</b>")
+lotm_rating(             "Houdini",  9.18,  10,  "(3 up)")
+lotm_rating(           "Tool Time",  8.60,  20,  "")
+lotm_rating(         "Quadropolis",  9.20,  10,  "(1 up)")
+lotm_rating(      "Big Adventures",  8.43,  21,  "")
+lotm_rating(      "Temple of Gold",  9.17,   6,  "")
 
 -- Don't forget to adjust the archive dates:
 
-lotm_archive_data_from = { month = 10, year = 2007 }
+lotm_archive_data_from = { month = 12, year = 2007 }
 
 lotm_current = lotm_archive_data[table.getn(lotm_archive_data)]
 

Modified: homepage/input/output-files.lua
===================================================================
--- homepage/input/output-files.lua	2008-01-01 18:27:02 UTC (rev 959)
+++ homepage/input/output-files.lua	2008-01-02 00:08:49 UTC (rev 960)
@@ -453,3 +453,33 @@
     lotm_anchor_position_ru = "<b>?????????? (1.01)</b>",
     lotm_anchor_position_es = "<b>Posici&oacute;n (1.01)</b>",
 }
+
+--------------------------------------------------------------------------------
+
+----------------------------------------------------------------------
+-- Remaining Articles
+----------------------------------------------------------------------
+
+----------------------------------------------------------------------
+-- End of Year Awards 2007
+----------------------------------------------------------------------
+html.eoya_2007 = {
+    outfile = "eoya_2007.html",
+    title = "End of Year Awards 2007",
+    title_de = "Jahresendauszeichnungen 2007",
+    --ru-- title_ru = "End of Year Awards 2007",
+    --es-- title_es = "End of Year Awards 2007",
+    rightcolumn = {},
+    body = {"articles/eoya_2007"}
+}    
+
+html.eoya_2007_statistics = {
+    outfile = "eoya_2007_statistics.html",
+    title = "End of Year Awards 2007 - Statistiken",
+    title_de = "Jahresendauszeichnungen 2007 - Statistiken",
+    --ru-- title_ru = "End of Year Awards 2007",
+    --es-- title_es = "End of Year Awards 2007",
+    rightcolumn = {},
+    body = {} --{"articles/eoya_2007_statistics"}
+}
+



From andreasl at mail.berlios.de  Wed Jan  2 23:00:40 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Wed, 2 Jan 2008 23:00:40 +0100
Subject: [Enigma-game-svn] r961 - in homepage: images/articles input
	input/articles
Message-ID: <200801022200.m02M0eFk011893@sheep.berlios.de>

Author: andreasl
Date: 2008-01-02 23:00:37 +0100 (Wed, 02 Jan 2008)
New Revision: 961

Added:
   homepage/images/articles/eoya_2007.png
Modified:
   homepage/input/articles/eoya_2007.html
   homepage/input/articles/eoya_2007_de.html
   homepage/input/infobox.html
   homepage/input/infobox_de.html
Log:
Homepage: Changes to EoYA-article:

 - new image for infobox (note to Yuriy: the link changed!)

 - line-breaking of some paragraphs

 - changes to the following paragraph:
   
  A remarkable majority of 69% of all players use Windows 2000 or XP, often
  together with some Linux. The preferred Linux versions are Debian and Ubuntu.
  Another fascinating aspect is that around twice as many gamers use Windows 95/98
  or ME (6 of 39) than Vista (3 of 39). 3 of 39 gamers use Mac OS
  (&quot;Tiger&quot; 1 vs. &quot;Panther&quot; 2). One gamer uses (in addition to
  Windows) a completely different operating system, and I'm still wondering which
  system this might be ... Finally, 2 of 39 use a dualcore, and 1 uses a gp2x.
  The usage rates of 95/98/ME and Panther shows us that we need to speed optimize
  Enigma to keep it running seamlessly even on computers which are a few years
  old, and that we need to continue support for these systems for the upcoming
  releases.

 - inserted the following paragraph:

  Most gamers (more than 76%) seriously tried to solve at least half of all
  levels. Still, nearly one third try to solve all of them, regardless of type!
  That's some very important figure for us, as it might help to gauge the PAR
  values and to better understand the ratings.
 
 - inserted the following before the comment:
   
  <h3>&quot;It's really the levels that reward us, and not the other way
  around&quot;</h3>
  
  <p>The following is a very special comment:</p>

 - adjusted "eoya_2007_a.png" to the textflow (another environment)
      


Added: homepage/images/articles/eoya_2007.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/eoya_2007.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: homepage/input/articles/eoya_2007.html
===================================================================
--- homepage/input/articles/eoya_2007.html	2008-01-02 00:08:49 UTC (rev 960)
+++ homepage/input/articles/eoya_2007.html	2008-01-02 22:00:37 UTC (rev 961)
@@ -1,32 +1,91 @@
 <div class="lotm">
 <h2>End of Year Awards 2007</h2>
 
-<p>During the past month, we asked our dear readers to vote for the best levels Enigma has to offer, in five categories, and to answer some questions of a general nature. Many thanks to all those who took the time (and it was a long questionnaire after all) and gave us the answers we were longing for. Instead of a Level-of-the-Month-January article, we now present the results of this poll.</p>
+<p>During the past month, we asked our dear readers to vote for the best levels
+Enigma has to offer, in five categories, and to answer some questions of a
+general nature. Many thanks to all those who took the time (and it was a long
+questionnaire after all) and gave us the answers we were longing for. Instead of
+a Level-of-the-Month-January article, we now present the results of this
+poll.</p>
 
 <h3>Results of the general questions</h3>
 
-<p>To maintain the tension, we start with the more general statistics: All in all, we registered 741 clicks; 73
-users and up to 40 votes per question, which gives us a broad insight in how our pro-gamers play. And slightly more than half of all voters requested the German questionnaire.</p>
+<p>To maintain the tension, we start with the more general statistics: All in
+all, we registered 741 clicks; 73 users and up to 40 votes per question, which
+gives us a broad insight in how our pro-gamers play. And slightly more than half
+of all voters requested the German questionnaire.</p>
 
-<p>Most people (42%) came to Enigma during version 0.8x. I remember that I was one of them, I found Enigma packed with SuSE, surfed the net and saw that Enigma 0.92 was already there.
+<p>Most people (42%) came to Enigma during version 0.8x. I remember that I was
+one of them, I found Enigma packed with SuSE, surfed the net and saw that Enigma
+0.92 was already there.
 
 </p>
 
-<p>A remarkable majority of 69% of all players use Windows 2000 or XP, often together with some Linux. The preferred Linux versions are Debian and Ubuntu. Another fascinating aspect is that around twice as many gamers use Windows 95/98 or ME (6 of 39) than Vista (3 of 39). 3 of 39 gamers use Mac OS (&quot;Tiger&quot; 1 vs. &quot;Panther&quot; 2). One gamer uses (in addition to Windows) a completely different operating system, and I'm still wondering which system this might be ... Finally, 2 of 39 use a dualcore, and 1 uses a gp2x.
-Originally we thought, we could drop support for the older versions of Windows and Mac OS. But the poll showed us that these systems are still widely used today, far more than expected.</p>
+<p>A remarkable majority of 69% of all players use Windows 2000 or XP, often
+together with some Linux. The preferred Linux versions are Debian and Ubuntu.
+Another fascinating aspect is that around twice as many gamers use Windows 95/98
+or ME (6 of 39) than Vista (3 of 39). 3 of 39 gamers use Mac OS
+(&quot;Tiger&quot; 1 vs. &quot;Panther&quot; 2). One gamer uses (in addition to
+Windows) a completely different operating system, and I'm still wondering which
+system this might be ... Finally, 2 of 39 use a dualcore, and 1 uses a gp2x.
+The usage rates of 95/98/ME and Panther shows us that we need to speed optimize
+Enigma to keep it running seamlessly even on computers which are a few years
+old, and that we need to continue support for these systems for the upcoming
+releases.</p>
 
-<p>A quite polarizing question focused on the difficulty of the levels. We got 37 answers to this question, and about the half (16) states that the difficulty is okay the way it is. However, 9 claimed the levels should be easier, while 3 gamers wanted them to be more difficult. The opinions on the scattering of the difficulty varied widely - 8 want it to be less scattered, 6 say it should be more so.  </p>
+<p>A quite polarizing question focused on the difficulty of the levels. We got
+37 answers to this question, and about the half (16) states that the difficulty
+is okay the way it is. However, 9 claimed the levels should be easier, while 3
+gamers wanted them to be more difficult. The opinions on the scattering of the
+difficulty varied widely - 8 want it to be less scattered, 6 say it should be
+more so.  </p>
 
-<p>Next, we asked for people's favorite kind of levels, and here the community found some common ground: Large majorities (over 50%) prefer small, quickly playable puzzle levels and levels that explore new combinations and gaming objects. Some 38% like large adventure levels, and only a minority of 14% would like to see more dexterity-levels or levels with large, difficult puzzles. 32% would like to see more levels of &quot;other types&quot;, and unfortunately I'm unsure which types this might be. I'm surprised (and personally rather happy) about this outcome, though it shows that the &quot;Level of the Month&quot; is not necessarily the most popular.   
-Of course, all level authors are still free to program their favorite kind of levels - however these statistics might offer some direction.  </p>
+<p>Next, we asked for people's favorite kind of levels, and here the community
+found some common ground: Large majorities (over 50%) prefer small, quickly
+playable puzzle levels and levels that explore new combinations and gaming
+objects. Some 38% like large adventure levels, and only a minority of 14% would
+like to see more dexterity-levels or levels with large, difficult puzzles. 32%
+would like to see more levels of &quot;other types&quot;, and unfortunately I'm
+unsure which types this might be. I'm surprised (and personally rather happy)
+about this outcome, though it shows that the &quot;Level of the Month&quot; is
+not necessarily the most popular.    Of course, all level authors are still free
+to program their favorite kind of levels - however these statistics might offer
+some direction.  </p>
 
-<p>We all know the importance of the mag-heut.net-forum to Enigma's community. This is reflected by the answers to our next question about the importance of  various information channels: From 1 to 5 points, the forum reached an average of 4.097, the homepage followed with 4.059. The other channels were of far less importance: the developer mailing list (2.86), private communication (2.75), other (2.4), announcement mailing list (2.14) and the yahoo oxyd group (1.58). This confirmed our assumptions.
-</p>
+<p>Most gamers (more than 76%) seriously tried to solve at least half of all
+levels. Still, nearly one third try to solve all of them, regardless of type!
+That's some very important figure for us, as it might help to gauge the PAR
+values and to better understand the ratings.</p>
 
-<p>We also asked you for your opinions about the future development of Enigma, and asked you to rate several topics. The results were quite difficult to evaluate, particularly as 9 of the 34 votes did not include all topics - but as an overall result, many new levels should have the highest priority, followed by a level editor, new objects (remember that many gamers would like to see more levels to explore new objects and features) and bug-fixes. Of medium priority are the netplay mode, backstage info (incl. LotM), and a save-system for exploration. Far behind we found the urge for new graphics and sounds, for tournaments and ports of Enigma to other platforms. Surely, it's difficult to assign priorities to topics we would all like to have - however, I find these data quite interesting, though it will only have a minor influence on our short-termed plans.</p>
+<p>We all know the importance of the mag-heut.net-forum to Enigma's community.
+This is reflected by the answers to our next question about the importance of 
+various information channels: From 1 to 5 points, the forum reached an average
+of 4.097, the homepage followed with 4.059. The other channels were of far less
+importance: the developer mailing list (2.86), private communication (2.75),
+other (2.4), announcement mailing list (2.14) and the yahoo oxyd group (1.58).
+This confirmed our assumptions. </p>
 
-<p>We also got lots of nice, encouraging comments, thanks to all of you for these! :-)</p>
+<p>We also asked you for your opinions about the future development of Enigma,
+and asked you to rate several topics. The results were quite difficult to
+evaluate, particularly as 9 of the 34 votes did not include all topics - but as
+an overall result, many new levels should have the highest priority, followed by
+a level editor, new objects (remember that many gamers would like to see more
+levels to explore new objects and features) and bug-fixes. Of medium priority
+are the netplay mode, backstage info (incl. LotM), and a save-system for
+exploration. Far behind we found the urge for new graphics and sounds, for
+tournaments and ports of Enigma to other platforms. Surely, it's difficult to
+assign priorities to topics we would all like to have - however, I find these
+data quite interesting, though it will only have a minor influence on our
+short-termed plans.</p>
 
+<p>We also got lots of nice, encouraging comments, thanks to all of you for
+these! :-)</p>
+
+<h3>&quot;It's really the levels that reward us, and not the other way
+around&quot;</h3>
+
+<p>The following is a very special comment:</p>
+
 <div class="quote">
 Enigma 0.22 was finished on December 30, 2001: it was a small
 development snapshot I created for backup purposes, almost three
@@ -38,17 +97,22 @@
 haven't changed much since then) and there was one single ``level'' I
 had created for testing.  So, here it is, the <b>Level of the Year 2001</b>:
 
+<br><br>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_a.png" alt="Level of the Year 2001" border="0">
+  <div class="imagetitle">
+Level of the Year 2001</div>
+
 </div>
 
-
-<div class="lotmpic">
+<!--<div class="lotmpic">
   <img src="$$imagedir$$/articles/eoya_2007_a.png" alt="Level of the Year 2001" border="0">
   <div class="imagetitle">
 Level of the Year 2001</div>
-</div>
+</div>-->
 
 <div class="quote">
-<nobr>For the technically</nobr> interested readers, here is the source file of this first level:
+<nobr>For the technically</nobr> interested readers, here is the source file of
+this first level:
 
 <pre>(o2-create-world &quot;Test Level&quot; 40 40)
 
@@ -141,7 +205,11 @@
 
 Doors Galore, IV/9</p>
 
-<p>&quot;Doors Galore&quot; is one of the most surprising and &quot;oxydian&quot; levels in Enigma, utilizing standard objects in new and fascinating ways. With 3.89 of 5 possible points, Ray Wick got a remarkable winning margin over &quot;Plan Ahead&quot; (3.59) and &quot;Industrial Puzzles&quot; (3.50).</p>
+<p>&quot;Doors Galore&quot; is one of the most surprising and
+&quot;oxydian&quot; levels in Enigma, utilizing standard objects in new and
+fascinating ways. With 3.89 of 5 possible points, Ray Wick got a remarkable
+winning margin over &quot;Plan Ahead&quot; (3.59) and &quot;Industrial
+Puzzles&quot; (3.50).</p>
 
 <h3>Best Levelseries 2007: &quot;Gods of Enigma&quot; by moonpearl</h3>
 
@@ -157,19 +225,29 @@
 Gods of Enigma II, V/69</div>
 </div>
 
-<p>The &quot;Gods of Enigma&quot; level series by moonpearl came to Enigma via the mag-heut.net forum and set out to conquer the hearts of Enigma's players, and absolutely successful: With the heighest score of all votes, 4.23 points, it outrivaled even the enormously high results of &quot;Little Puzzles &amp; Big Adventures&quot; (4.03), and the &quot;Seed Puzzles&quot; (3.70).</p>
+<p>The &quot;Gods of Enigma&quot; level series by moonpearl came to Enigma via
+the mag-heut.net forum and set out to conquer the hearts of Enigma's players,
+and absolutely successful: With the heighest score of all votes, 4.23 points, it
+outrivaled even the enormously high results of &quot;Little Puzzles &amp; Big
+Adventures&quot; (4.03), and the &quot;Seed Puzzles&quot; (3.70).</p>
 
-<h3><nobr>Best Design 2007: &quot;The Aztec Temple&quot; </nobr>by Dominik Lehmann</h3>
+<h3><nobr>Best Design 2007: &quot;The Aztec Temple&quot; </nobr>by Dominik
+Lehmann</h3>
 
 <p>
   <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_i.png" alt="The Aztec Temple, VI/100" border="0">
 
 The Aztec Temple, VI/100</p>
 
-<p>The design award was arranged among three giants:
-Yet, with 4.19 points, the Level of the Month May 2007 &quot;The Aztec Temple&quot; dwarfed &quot;Mountain Climbing&quot; (3.80) and &quot;Solar System&quot; (3.68), and established a new terrain for Enigma's levels: After space ships, forests, cities and dark caverns, from now on the jungle will be a new possible setting for our level authors.</p>
+<p>The design award was arranged among three giants: Yet, with 4.19 points, the
+Level of the Month May 2007 &quot;The Aztec Temple&quot; dwarfed &quot;Mountain
+Climbing&quot; (3.80) and &quot;Solar System&quot; (3.68), and established a new
+terrain for Enigma's levels: After space ships, forests, cities and dark
+caverns, from now on the jungle will be a new possible setting for our level
+authors.</p>
 
-<h3>Funniest Levels 2007: &quot;Advancing&quot; and &quot;Mountain Climbing&quot; by Joseph Dunne</h3>
+<h3>Funniest Levels 2007: &quot;Advancing&quot; and &quot;Mountain
+Climbing&quot; by Joseph Dunne</h3>
 
 <p>
   <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_d.png" alt="Advancing, VII/23" border="0">
@@ -182,7 +260,12 @@
 Mountain Climbing, VII/22</div>
 </div>
 
-<p>Joseph Dunne made the double strike: His grandious levels &quot;Advancing&quot; and &quot;Mountain Climbing&quot; both received 3.786 points out of 5, and show what Enigma can be as well: The unique design of his levels reflects the lightness of these levels' atmospheres, framed by not slightly that easy puzzles. He outwitted even &quot;Diving&quot; (3.55) and &quot;What's the Problem?&quot; (3.52).</p>
+<p>Joseph Dunne made the double strike: His grandious levels
+&quot;Advancing&quot; and &quot;Mountain Climbing&quot; both received 3.786
+points out of 5, and show what Enigma can be as well: The unique design of his
+levels reflects the lightness of these levels' atmospheres, framed by the
+gravity of the puzzles themselves. He outwitted even &quot;Diving&quot; (3.55)
+and &quot;What's the Problem?&quot; (3.52).</p>
 
 <h3><nobr>Best Yin-Yang Level 2007: &quot;Teamwork&quot; </nobr>by Jacob Scott</h3>
 
@@ -191,7 +274,11 @@
 
 Teamwork, III/18</p>
 
-<p>&quot;Teamwork&quot; is the most accurate description of the best Yin-Yang level of Enigma: Jacob showed with this level of the great old ones, what cooperation really means, and with 3.83 points &quot;Teamwork&quot; still shows respect for its comrades &quot;Turnstiles for Two&quot; (3.75) and &quot;Manamana&quot; (3.64).</p>
+<p>&quot;Teamwork&quot; is the most accurate description of the best Yin-Yang
+level of Enigma: Jacob showed with this level of the great old ones, what
+cooperation really means, and with 3.83 points &quot;Teamwork&quot; still shows
+respect for its comrades &quot;Turnstiles for Two&quot; (3.75) and
+&quot;Manamana&quot; (3.64).</p>
 
 <p>And now, to the most important category:</p>
 
@@ -202,11 +289,23 @@
 
 Island Labyrinth, V/100</p>
 
-<p>In the end, it really became exciting again, as four levels made large jumps up to become Level of the Year 2007: &quot;Quadropolis&quot; and &quot;Temple of Gold&quot; both overtook &quot;The Aztec Temple&quot;, and &quot;Houdini&quot; left &quot;Labyrinth of Puzzles&quot;, &quot;The Aztec Temple&quot; and even &quot;Temple of Gold&quot; behind itself - five levels between 9.10 and 9.25 points! But in the end, none of them was able to compete against &quot;Island Labyrinth&quot;: 5 of its 8 votes are the full 10 points, one 9, one 8 and one 7, which confirms Jacob Scott the undisputed title of Level Author of the Year 2007!</p>
+<p>In the end, it really became exciting again, as four levels made large jumps
+up to become Level of the Year 2007: &quot;Quadropolis&quot; and &quot;Temple of
+Gold&quot; both overtook &quot;The Aztec Temple&quot;, and &quot;Houdini&quot;
+left &quot;Labyrinth of Puzzles&quot;, &quot;The Aztec Temple&quot; and even
+&quot;Temple of Gold&quot; behind itself - five levels between 9.10 and 9.25
+points! But in the end, none of them was able to compete against &quot;Island
+Labyrinth&quot;: 5 of its 8 votes are the full 10 points, one 9, one 8 and one
+7, which confirms Jacob Scott the undisputed title of Level Author of the Year
+2007!</p>
 
 <h3>Coming to the end ...</h3>
 
-<p>This first round of our Level-of-the-Month series now amusingly ends the same way it started in March 2007: with &quot;Island Labyrinth&quot;. You may reread its article <a href="$$lotm_200703$$">here</a>. And at this point it's time for us to thank all those people who helped us over the last year with our articles: First of all to all contributors of comments; to 
+<p>This first round of our Level-of-the-Month series now amusingly ends the same
+way it started in March 2007: with &quot;Island Labyrinth&quot;. You may reread
+its article <a href="$$lotm_200703$$">here</a>. And at this point it's time for
+us to thank all those people who helped us over the last year with our articles:
+First of all to all contributors of comments; to
 Alejandro Lacava,
 Ronald Lamprecht,
 Andreas Geldmacher,
@@ -223,11 +322,24 @@
 Spioni,
 Craven,
 and Daniel Heck.
-Greatest thanks go out to Clifford J. Tasner (Taztunes), who proofread every single article, and helped us with - believe it or not - five comments! He was always there when we needed one more contribution, and always on time. Great thanks also go to Yuriy, who takes the trouble to translate all our articles into Russian for our Russian friends, often within only 24 hours, and to Joe, who was the main author of July's article. Many thanks to all of you!</p>
+Greatest thanks go out to Clifford J. Tasner (Taztunes), who proofread every
+single article, and helped us with - believe it or not - five comments! He was
+always there when we needed one more contribution, and always on time. Great
+thanks also go to Yuriy, who takes the trouble to translate all our articles
+into Russian for our Russian friends, often within only 24 hours, and to Joe,
+who was the main author of July's article. Many thanks to all of you!</p>
 
-<p>We also want to thank our level authors, who wrote the ten terrific levels we were able to report on during the last year, and who contributed comments for our articles as well: Thank you, Jacob Scott, Manuel K&ouml;nig, Dominik Lehmann, Ronald Lamprecht, Barry and Lori Mead, Johannes Laire, Raoul Bourquin, and Jon 'WB' Sneyers. And thanks to the originator of the Enigma project, to Daniel Heck, as well as Meinolf Schneider, who gave birth to Esprit and Oxyd, our constant inspirations.</p>
+<p>We also want to thank our level authors, who wrote the ten terrific levels we
+were able to report on during the last year, and who contributed comments for
+our articles as well: Thank you, Jacob Scott, Manuel K&ouml;nig, Dominik
+Lehmann, Ronald Lamprecht, Barry and Lori Mead, Johannes Laire, Raoul Bourquin,
+and Jon 'WB' Sneyers. And thanks to the originator of the Enigma project, to
+Daniel Heck, as well as Meinolf Schneider, who gave birth to Esprit and Oxyd,
+our constant inspirations.</p>
 
-<p>You can find the current statistics of our ten LotM's in the <a href="$$lotm$$">LotM-archive</a>, and the exact statistical results of the poll will soon be online <a href="$$eoya_2007_statistics$$">here</a>.</p>
+<p>You can find the current statistics of our ten LotM's in the <a
+href="$$lotm$$">LotM-archive</a>, and the exact statistical results of the poll
+will soon be online <a href="$$eoya_2007_statistics$$">here</a>.</p>
 
 <p>Happy New Year's Level,<br>
 <i>Andreas &amp;Harry</i></p>

Modified: homepage/input/articles/eoya_2007_de.html
===================================================================
--- homepage/input/articles/eoya_2007_de.html	2008-01-02 00:08:49 UTC (rev 960)
+++ homepage/input/articles/eoya_2007_de.html	2008-01-02 22:00:37 UTC (rev 961)
@@ -1,45 +1,130 @@
 <div class="lotm">
 <h2>Jahresendauszeichnungen 2007</h2>
 
-<p>W&auml;hrend des vergangenen Monats haben wir unsere lieben Leser gebeten, die besten Levels zu bewerten, die Enigma zu bieten hat, in f&uuml;nf Kategorien, und ein paar Fragen allgemeinerer Natur zu beantworten. Vielen Dank an all die, die sich daf&uuml;r die Zeit genommen haben (und es war letztlich ein ziemlich langer Fragebogen) und uns die Antworten gaben, nach denen wir suchten. Anstelle eines Level-des-Monats-Januar-Artikel, pr&auml;sentieren wir nun die Ergebnisse dieser Umfrage.
-</p>
+<p>W&auml;hrend des vergangenen Monats haben wir unsere lieben Leser gebeten,
+die besten Levels zu bewerten, die Enigma zu bieten hat, in f&uuml;nf
+Kategorien, und ein paar Fragen allgemeinerer Natur zu beantworten. Vielen Dank
+an all die, die sich daf&uuml;r die Zeit genommen haben (und es war letztlich
+ein ziemlich langer Fragebogen) und uns die Antworten gaben, nach denen wir
+suchten. Anstelle eines Level-des-Monats-Januar-Artikel, pr&auml;sentieren wir
+nun die Ergebnisse dieser Umfrage. </p>
 
 <h3>Ergebnisse der allgemeinen Fragen</h3>
 
-<p>Um die Spannung aufrecht zu erhalten, beginnen wir mit den allgemeineren Statistiken: Insgesamt haben wir 741 Klicks registriert, 73 Nutzer und bis zu 40 Antworten pro Frage, was uns einen breiten Einblick darin gibt, wir unsere professionellen Spieler spielen. Und: Etwas mehr als die H&auml;lfte aller Spieler nutzten den deutschsprachigen Fragebogen.
-</p>
+<p>Um die Spannung aufrecht zu erhalten, beginnen wir mit den allgemeineren
+Statistiken: Insgesamt haben wir 741 Klicks registriert, 73 Nutzer und bis zu 40
+Antworten pro Frage, was uns einen breiten Einblick darin gibt, wir unsere
+professionellen Spieler spielen. Und: Etwas mehr als die H&auml;lfte aller
+Spieler nutzten den deutschsprachigen Fragebogen. </p>
 
-<p>Die meisten (42%) stie&szlig;en zu Enigma w&auml;hrend Version 0.8x. Ich erinnere mich, dass ich einer von ihnen war, ich fand Enigma als Paket f&uuml;r SuSE, surfte durchs Netz und sah, dass Enigma 0.92 bereits drau&szlig;en war.
+<p>Die meisten (42%) stie&szlig;en zu Enigma w&auml;hrend Version 0.8x. Ich
+erinnere mich, dass ich einer von ihnen war, ich fand Enigma als Paket f&uuml;r
+SuSE, surfte durchs Netz und sah, dass Enigma 0.92 bereits drau&szlig;en war.
 </p>
 
-<p>Eine bemerkenswerte Mehrheit von 69% aller Spieler benutzen Windows 2000 oder XP, oft zusammen mit einem Linux. Die bevorzugten Linux Versionen sind Debian und Ubuntu. Ein weiterer faszinierender Aspekt ist, dass etwa doppelt so viele Spieler Windows 95/98 oder ME verwenden (6 von 39) als Vista (3 von 39). 3 von 39 Spielern nutzen Mac OS (&quot;Tiger&quot; 1 zu &quot;Panther&quot; 2). Ein Spieler nutzt (zus&auml;tzlich zu einem Windows) ein komplett anderes Betriebssystem, und ich frage mich nach wie vor, welches System das sein mag ... Schlie&szlig;lich benutzen 2 von 39 einen Dualcore und einer nutzt einen gp2x. Urspr&uuml;nglich dachten wir, wir k&ouml;nnten die Unterst&uuml;tzung f&uuml;r die &auml;lteren Versionen von Windows und Mac OS einstellen. Aber die Umfrage hat uns gezeigt, dass diese Systeme da drau&szlig;en noch immer verwendet werden, weit h&auml;ufiger als erwartet.</p>
+<p>Eine bemerkenswerte Mehrheit von 69% aller Spieler benutzen Windows 2000 oder
+XP, oft zusammen mit einem Linux. Die bevorzugten Linux Versionen sind Debian
+und Ubuntu. Ein weiterer faszinierender Aspekt ist, dass etwa doppelt so viele
+Spieler Windows 95/98 oder ME verwenden (6 von 39) als Vista (3 von 39). 3 von
+39 Spielern nutzen Mac OS (&quot;Tiger&quot; 1 zu &quot;Panther&quot; 2). Ein
+Spieler nutzt (zus&auml;tzlich zu einem Windows) ein komplett anderes
+Betriebssystem, und ich frage mich nach wie vor, welches System das sein mag ...
+Schlie&szlig;lich benutzen 2 von 39 einen Dualcore und einer nutzt einen gp2x.
+Die Benutzungsquote von 95/98/ME und Panther zeigt uns, dass wir Enigma auf
+Geschwindigkeit optimieren m&uuml;ssen, damit es auch auf Rechnern noch weich
+l&auml;uft, die bereits ein paar Jahre alt sind, und dass wir die
+Unterst&uuml;tzung f&uuml;r diese Systeme auch in den n&auml;chsten Releases
+beibehalten sollten.</p>
 
-<p>Eine ziemlich polarisierende Frage zielte auf den Schwierigkeitsgrad der Levels ab. Wir bekamen 37 Antworten zu dieser Frage, und etwa die H&auml;lfte (16) findet, dass der Schwierigkeitsgrad richtig ist, so wie er ist. Jedoch m&ouml;chten 9 die Levels lieber einfacher haben, und 3 Spieler lieber schwerer. Die Streuung der Schwierigkeit ist umstritten - 8 w&uuml;nschen sich eine kleinere Streuung, 6 h&auml;tten gerne eine gr&ouml;&szlig;ere. 
-</p>
+<p>Eine ziemlich polarisierende Frage zielte auf den Schwierigkeitsgrad der
+Levels ab. Wir bekamen 37 Antworten zu dieser Frage, und etwa die H&auml;lfte
+(16) findet, dass der Schwierigkeitsgrad richtig ist, so wie er ist. Jedoch
+m&ouml;chten 9 die Levels lieber einfacher haben, und 3 Spieler lieber schwerer.
+Die Streuung der Schwierigkeit ist umstritten - 8 w&uuml;nschen sich eine
+kleinere Streuung, 6 h&auml;tten gerne eine gr&ouml;&szlig;ere.  </p>
 
-<p>Als n&auml;chstes fragten wir nach der bevorzugten Levelart, und hier findet unsere Gemeinschaft eine gemeinsame Basis: Gro&szlig;e Mehrheiten (&uuml;ber 50%) bevorzugen kleine, schnell spielbare R&auml;tsellevel und Levels zum Erforschen neuer Kombinationen und neuer Spielobjekte. Etwa 38% m&ouml;gen gro&szlig;e Abenteuerlevel, und nur eine Minderheit von 14% w&uuml;rde gerne mehr Geschicklichkeits-Levels sehen, oder gro&szlig;e, schwere R&auml;tsel. 32% h&auml;tten gerne mehr Levels von &quot;anderem Typ&quot;, und leider bin ich unsicher, welche Arten das noch sein m&ouml;gen. Ich bin &uuml;berrascht (und pers&ouml;nlich auch gl&uuml;cklich) &uuml;ber dieses Ergebnis. obwohl es zeigt, dass der &quot;Level des Monats&quot; nicht unbedingt die beliebtesten Levels wiederspiegelt. Nat&uuml;rlich steht es allen Levelautoren nach wie vor frei, Landschaften nach ihrem Gusto zu programmieren - jedoch, in Zweifelsf&auml;llen, m&ouml;gen diese Zahlen vielleicht einen Hinweis ge!
 ben.
+<p>Als n&auml;chstes fragten wir nach der bevorzugten Levelart, und hier findet
+unsere Gemeinschaft eine gemeinsame Basis: Gro&szlig;e Mehrheiten (&uuml;ber
+50%) bevorzugen kleine, schnell spielbare R&auml;tsellevel und Levels zum
+Erforschen neuer Kombinationen und neuer Spielobjekte. Etwa 38% m&ouml;gen
+gro&szlig;e Abenteuerlevel, und nur eine Minderheit von 14% w&uuml;rde gerne
+mehr Geschicklichkeits-Levels sehen, oder gro&szlig;e, schwere R&auml;tsel. 32%
+h&auml;tten gerne mehr Levels von &quot;anderem Typ&quot;, und leider bin ich
+unsicher, welche Arten das noch sein m&ouml;gen. Ich bin &uuml;berrascht (und
+pers&ouml;nlich auch gl&uuml;cklich) &uuml;ber dieses Ergebnis. obwohl es zeigt,
+dass der &quot;Level des Monats&quot; nicht unbedingt die beliebtesten Levels
+wiederspiegelt. Nat&uuml;rlich steht es allen Levelautoren nach wie vor frei,
+Landschaften nach ihrem Gusto zu programmieren - jedoch, in Zweifelsf&auml;llen,
+m&ouml;gen diese Zahlen vielleicht einen Hinweis geben.
 
 </p>
 
-<p>Wir alle kennen die Wichtigkeit des mag-heut.net-Forums f&uuml;r Enigmas Gemeinschaft. Dies wird auch reflektiert von den Antworten auf unsere n&auml;chste Frage nach der Wichtigkeit der verschiedenen Informationskan&auml;le: Von 1 bis 5 Punkten, erreichte das Forum einen Schnitt von 4,10, die Homepage folgt mit 4,06. Die anderen Kan&auml;le sind von weit geringerer Bedeutung: die Entwickler-Mailing-Liste (2,86), private Kommunikation (2,75), weiteres (2,4), die Ank&uuml;ndigungs-Mailing-Liste (2,14) und die Yahoo Oxyd-Gruppe (1,58). Dies best&auml;tigte unsere Vermutungen.
-</p>
+<p>Die meisten Spieler (&uuml;ber 76%) versuchten mindestens die H&auml;lfte
+aller Levels ernsthaft zu l&ouml;sen, unabh&auml;ngig vom Typ! Das ist eine
+sehr wichtige Zahl f&uuml;r uns, da sie helfen kann, die PAR-Werte zu eichen
+und die Bewertungen besser zu verstehen.</p>
 
-<p>Wir haben Sie auch nach Ihrer Meinung &uuml;ber die weitere Entwicklung von Enigma gefragt, und gebeten, die verschiedenen Arbeitsgebiete zu bewerten. Das Ergebnis ist sehr schwierig auszuwerten, insbesondere da 9 von 34 Antworten nicht alle Arbeitsgebiete enthalten - aber als wesentliches Resultat, sollten neue Levels die h&ouml;chste Priorit&auml;t haben, gefolgt von einem Leveleditor, neuen Objekten (wir erinnern uns daran, dass viele Spieler gerne mehr Levels zum Erforschen neuer Spielobjekte und Features sehen w&uuml;rden), sowie Fehlerbehebung. Von mittlerer Priorit&auml;t sind der Zweispielermodus (via Netz), Hintergrundinformationen (einschlie&szlig;lich dem LdM) und ein System zum Abspeichern w&auml;hrend der Erforschung. Weiter hinten finden wir den Wunsch nach neuen Grafiken und Sounds, nach Turnieren und Portierungen von Enigma auf andere Plattformen. Sicher, es ist schwierig, allen Gebieten Priorit&auml;ten zuzuordnen, die man gerne h&auml;tte - wie auch imm!
 er, ich finde diese Bewertung durchaus interessant, obwohl sie nur einen geringen Einfluss auf unsere kurzfristigen Pl&auml;ne aus&uuml;ben wird.</p>
+<p>Wir alle kennen die Wichtigkeit des mag-heut.net-Forums f&uuml;r Enigmas
+Gemeinschaft. Dies wird auch reflektiert von den Antworten auf unsere
+n&auml;chste Frage nach der Wichtigkeit der verschiedenen
+Informationskan&auml;le: Von 1 bis 5 Punkten, erreichte das Forum einen Schnitt
+von 4,10, die Homepage folgt mit 4,06. Die anderen Kan&auml;le sind von weit
+geringerer Bedeutung: die Entwickler-Mailing-Liste (2,86), private Kommunikation
+(2,75), weiteres (2,4), die Ank&uuml;ndigungs-Mailing-Liste (2,14) und die Yahoo
+Oxyd-Gruppe (1,58). Dies best&auml;tigte unsere Vermutungen. </p>
 
-<p>Wir haben auch viele nette und ermunternde Kommentare bekommen, vielen Dank an alle daf&uuml;r! :-)</p>
+<p>Wir haben Sie auch nach Ihrer Meinung &uuml;ber die weitere Entwicklung von
+Enigma gefragt, und gebeten, die verschiedenen Arbeitsgebiete zu bewerten. Das
+Ergebnis ist sehr schwierig auszuwerten, insbesondere da 9 von 34 Antworten
+nicht alle Arbeitsgebiete enthalten - aber als wesentliches Resultat, sollten
+neue Levels die h&ouml;chste Priorit&auml;t haben, gefolgt von einem
+Leveleditor, neuen Objekten (wir erinnern uns daran, dass viele Spieler gerne
+mehr Levels zum Erforschen neuer Spielobjekte und Features sehen w&uuml;rden),
+sowie Fehlerbehebung. Von mittlerer Priorit&auml;t sind der Zweispielermodus
+(via Netz), Hintergrundinformationen (einschlie&szlig;lich dem LdM) und ein
+System zum Abspeichern w&auml;hrend der Erforschung. Weiter hinten finden wir
+den Wunsch nach neuen Grafiken und Sounds, nach Turnieren und Portierungen von
+Enigma auf andere Plattformen. Sicher, es ist schwierig, allen Gebieten
+Priorit&auml;ten zuzuordnen, die man gerne h&auml;tte - wie auch immer, ich
+finde diese Bewertung durchaus interessant, obwohl sie nur einen geringen
+Einfluss auf unsere kurzfristigen Pl&auml;ne aus&uuml;ben wird.</p>
 
+<p>Wir haben auch viele nette und ermunternde Kommentare bekommen, vielen Dank
+an alle daf&uuml;r! :-)</p>
+
+<h3>&quot;Es sind wirklich die Levels, die uns belohnen, nicht anders
+herum&quot;</h3>
+
+<p>Hier nun ein ganz besonderer Kommentar:</p>
+
 <div class="quote">
-Enigma 0.22 wurde am 30. Dezember 2001 fertig: Es war ein kleiner Schnappschuss aus der Entwicklung, den ich als Backup gemacht hatte, fast drei Monate vor dem ersten &ouml;ffentlichen Release. Der Hauptgrund, aus dem Enigma 0.22 niemals meine Festplatte verlassen hat, war, dass es noch nichts zu Spielen gab: Ich hatte noch nicht mal angefangen, die schwarze Murmel und ihre Interaktion mit den anderen Spielobjekten zu programmieren. Aber die Grafik f&uuml;r einige Spielobjekte wie Dynamit, Bomben und den Regenschirm war bereits fertig (und hat sich seit damals nicht wesentlich ver&auml;ndert), und es gab einen einzelnen &quot;Level&quot;, den ich zu Testzwecken geschrieben hatte, Nun, hier ist er, der <b>Level des Jahres 2001</b>:</div>
+Enigma 0.22 wurde am 30. Dezember 2001 fertig: Es war ein kleiner Schnappschuss
+aus der Entwicklung, den ich als Backup gemacht hatte, fast drei Monate vor dem
+ersten &ouml;ffentlichen Release. Der Hauptgrund, aus dem Enigma 0.22 niemals
+meine Festplatte verlassen hat, war, dass es noch nichts zu Spielen gab: Ich
+hatte noch nicht mal angefangen, die schwarze Murmel und ihre Interaktion mit
+den anderen Spielobjekten zu programmieren. Aber die Grafik f&uuml;r einige
+Spielobjekte wie Dynamit, Bomben und den Regenschirm war bereits fertig (und hat
+sich seit damals nicht wesentlich ver&auml;ndert), und es gab einen einzelnen
+&quot;Level&quot;, den ich zu Testzwecken geschrieben hatte, Nun, hier ist er,
+der <b>Level des Jahres 2001</b>:
 
+<br><br>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_a.png" alt="Level of the Year 2001" border="0">
+  <div class="imagetitle">
+Level of the Year 2001</div>
 
-<div class="lotmpic">
+</div>
+
+<!--<div class="lotmpic">
   <img src="$$imagedir$$/articles/eoya_2007_a.png" alt="Level des Jahres 2001" border="0">
   <div class="imagetitle">
 Level des Jahres 2001</div>
-</div>
+</div>-->
 
 <div class="quote">
-<nobr>F&uuml;r den technisch interessierten </nobr>Leser ist hier der Quellcode dieses ersten Levels:
+<nobr>F&uuml;r den technisch interessierten </nobr>Leser ist hier der Quellcode
+dieses ersten Levels:
 
 <pre>(o2-create-world &quot;Test Level&quot; 40 40)
 
@@ -66,27 +151,55 @@
 
 
 <div class="quote">
-Heute, fast sechs Jahre sp&auml;ter, ist es nicht ganz so einfach, einen Level des Jahres zu w&auml;hlen. Seit Enigmas bescheidenen Anf&auml;ngen 2001 wurde die Zahl der Levels auf &uuml;ber 1000 katapultiert, und allein nur die H&auml;lfte von ihnen zu l&ouml;sen, n&ouml;tigt einem viel Hingabe zum Spiel ab. Dass es einige Spieler trotzdem geschafft haben, mehr als 90% aller Levels zu l&ouml;sen, ist dementsprechend umso beeindruckender! Und es erscheint unwahrscheinlich, dass sich dies in Zukunft &auml;ndern wird: Wenn die vergangenen sechs Jahre auf die Zukunft &uuml;bertragen werden d&uuml;rfen, werden Enigmas Fans mindestens alle zwei Tage einen Level l&ouml;sen m&uuml;ssen, nur um mit dem Ansturm neuer Levels mitzuhalten ...
+Heute, fast sechs Jahre sp&auml;ter, ist es nicht ganz so einfach, einen Level
+des Jahres zu w&auml;hlen. Seit Enigmas bescheidenen Anf&auml;ngen 2001 wurde
+die Zahl der Levels auf &uuml;ber 1000 katapultiert, und allein nur die
+H&auml;lfte von ihnen zu l&ouml;sen, n&ouml;tigt einem viel Hingabe zum Spiel
+ab. Dass es einige Spieler trotzdem geschafft haben, mehr als 90% aller Levels
+zu l&ouml;sen, ist dementsprechend umso beeindruckender! Und es erscheint
+unwahrscheinlich, dass sich dies in Zukunft &auml;ndern wird: Wenn die
+vergangenen sechs Jahre auf die Zukunft &uuml;bertragen werden d&uuml;rfen,
+werden Enigmas Fans mindestens alle zwei Tage einen Level l&ouml;sen
+m&uuml;ssen, nur um mit dem Ansturm neuer Levels mitzuhalten ... </div>
 
-</div>
 
-
 <div class="quote">
-Die Levels, die den diesj&auml;hrigen Wettbewerb gewonnen haben, sind ganz klar einige der feinsten Landschaften, die es zur Zeit f&uuml;r Enigma gibt. R&auml;tsel im &quot;Finde den richtigen Schl&uuml;ssel&quot;-Sinn sind in &quot;modernen&quot; 3D-Spielen allgegenw&auml;rtig, aber der Beste Onescreener zeigt, wie's richtig geht. Die Beste Levelserie enth&auml;lt zwei Levels, die unter den ersten Landschaften waren, die direkt die Aufmerksamkeit des Spielers weckten, ihn verh&ouml;hnen und herausfordern, was noch immer eine einzigartige Spielerfahrung kreiert. Der Sieger in der Kategorie &quot;Bestes Design&quot; geht sogar noch weiter: Die Kombination einer fast epischen Geschichte von Mysterium und Abenteuer, haarstr&auml;ubende R&auml;tsel und eine wundervolles visuelles Design machen diesen Level zu einem der herausfordernsten und lohnenswertesten in Enigma aller Zeiten. Die beiden Lustigsten Level sind wahrhaft originell in der Art, wie sie die Idee der Meditations-L!
 andschaften auf den Kopf stellen, und der Beste Yin-Yang-Level ist ein alter Freund: Er war unter den ersten Levels, die die Yin-Yang-Objekte verwendeten, und bleibt bis heute einer der besten.
+Die Levels, die den diesj&auml;hrigen Wettbewerb gewonnen haben, sind ganz klar
+einige der feinsten Landschaften, die es zur Zeit f&uuml;r Enigma gibt.
+R&auml;tsel im &quot;Finde den richtigen Schl&uuml;ssel&quot;-Sinn sind in
+&quot;modernen&quot; 3D-Spielen allgegenw&auml;rtig, aber der Beste Onescreener
+zeigt, wie's richtig geht. Die Beste Levelserie enth&auml;lt zwei Levels, die
+unter den ersten Landschaften waren, die direkt die Aufmerksamkeit des Spielers
+weckten, ihn verh&ouml;hnen und herausfordern, was noch immer eine einzigartige
+Spielerfahrung kreiert. Der Sieger in der Kategorie &quot;Bestes Design&quot;
+geht sogar noch weiter: Die Kombination einer fast epischen Geschichte von
+Mysterium und Abenteuer, haarstr&auml;ubende R&auml;tsel und eine wundervolles
+visuelles Design machen diesen Level zu einem der herausfordernsten und
+lohnenswertesten in Enigma aller Zeiten. Die beiden Lustigsten Level sind
+wahrhaft originell in der Art, wie sie die Idee der Meditations-Landschaften auf
+den Kopf stellen, und der Beste Yin-Yang-Level ist ein alter Freund: Er war
+unter den ersten Levels, die die Yin-Yang-Objekte verwendeten, und bleibt bis
+heute einer der besten.</div>
 
-</div>
 
-
 <div class="quote">
-Schlie&szlig;lich geht der Preis des &quot;Levels des Jahres 2007&quot; an eine Landschaft, die in ihrer Beliebtheit bislang unerreicht ist, und von einem von Enigmas Meisterleveldesignern geschrieben wurde. Sein sich lang erstreckender Irrgarten, angef&uuml;llt mit R&auml;tseln, &Uuml;berraschungen und Gefahren, und ihn zu l&ouml;sen, sollen definit auf Ihrer Liste guter Vors&auml;tze f&uuml;r das neue Jahr stehen, wenn er das noch nicht ist ...
-</div>
+Schlie&szlig;lich geht der Preis des &quot;Levels des Jahres 2007&quot; an eine
+Landschaft, die in ihrer Beliebtheit bislang unerreicht ist, und von einem von
+Enigmas Meisterleveldesignern geschrieben wurde. Sein sich lang erstreckender
+Irrgarten, angef&uuml;llt mit R&auml;tseln, &Uuml;berraschungen und Gefahren,
+und ihn zu l&ouml;sen, sollen definit auf Ihrer Liste guter Vors&auml;tze
+f&uuml;r das neue Jahr stehen, wenn er das noch nicht ist ... </div>
 
 <div class="quote">
-Der Preis zum &quot;Level des Jahres&quot; ist der erste seiner Art, und ich hoffe wahrhaft, dass er zu einer Tradition der kleinen, aber lebhaften Enigma Gemeinschaft wird. Die Kreativit&auml;t von Enigmas Leveldesignern verbl&uuml;fft mich weiterhin, und ich denke, das das sie der wahre Grund f&uuml;r den Erfolg des Spiels und seinen lange wirkenden Charme ist. Und, schlie&szlig;lich, um uns selbst nicht zu t&auml;uschen: Es sind wirklich die Levels, die uns belohnen, nicht anders herum.
+Der Preis zum &quot;Level des Jahres&quot; ist der erste seiner Art, und ich
+hoffe wahrhaft, dass er zu einer Tradition der kleinen, aber lebhaften Enigma
+Gemeinschaft wird. Die Kreativit&auml;t von Enigmas Leveldesignern
+verbl&uuml;fft mich weiterhin, und ich denke, das das sie der wahre Grund
+f&uuml;r den Erfolg des Spiels und seinen lange wirkenden Charme ist. Und,
+schlie&szlig;lich, um uns selbst nicht zu t&auml;uschen: Es sind wirklich die
+Levels, die uns belohnen, nicht anders herum.</div>
 
-</div>
 
-
 <div class="author">
 Daniel Heck</div>
 
@@ -100,7 +213,11 @@
 
 Doors Galore, IV/9</p>
 
-<p>&quot;Doors Galore&quot; ist einer der &uuml;berraschendsten und &quot;oxydischsten&quot; Levels in Enigma, verwendet dabei nur Standardobjekte auf neue und faszinierende Weise. Mit 3,89 von 5 m&ouml;glichen Punkten hat Ray Wick einen bemerkenswerten Vorsprung vor &quot;Plan Ahead&quot; (3,59) und &quot;Industrial Puzzles&quot; (3,50).</p>
+<p>&quot;Doors Galore&quot; ist einer der &uuml;berraschendsten und
+&quot;oxydischsten&quot; Levels in Enigma, verwendet dabei nur Standardobjekte
+auf neue und faszinierende Weise. Mit 3,89 von 5 m&ouml;glichen Punkten hat Ray
+Wick einen bemerkenswerten Vorsprung vor &quot;Plan Ahead&quot; (3,59) und
+&quot;Industrial Puzzles&quot; (3,50).</p>
 
 <h3>Beste Levelserie 2007: &quot;Gods of Enigma&quot; von moonpearl</h3>
 
@@ -116,18 +233,32 @@
 Gods of Enigma II, V/69</div>
 </div>
 
-<p>Die &quot;Gods of Enigma&quot;-Levelserie von moonpearl erreichte Enigma &uuml;ber das mag-heut.net-Forum und zog aus, die Herzen der Enigmaspieler zu erobern - und war absolut erfolgreich: Mit der h&ouml;chsten Wertung aller Levels quer durch alle f&uuml;nf Kategorien, 4,23 Punkten, &uuml;bertrafen die &quot;Gods of Enigma&quot; sogar die enorm hohen Ergebnisse von &quot;Little Puzzles &amp; Big Adventures&quot; (4,03) und den &quot;Seed Puzzles&quot; (3,70).</p>
+<p>Die &quot;Gods of Enigma&quot;-Levelserie von moonpearl erreichte Enigma
+&uuml;ber das mag-heut.net-Forum und zog aus, die Herzen der Enigmaspieler zu
+erobern - und war absolut erfolgreich: Mit der h&ouml;chsten Wertung aller
+Levels quer durch alle f&uuml;nf Kategorien, 4,23 Punkten, &uuml;bertrafen die
+&quot;Gods of Enigma&quot; sogar die enorm hohen Ergebnisse von &quot;Little
+Puzzles &amp; Big Adventures&quot; (4,03) und den &quot;Seed Puzzles&quot;
+(3,70).</p>
 
-<h3><nobr>Bestes Design 2007: &quot;The Aztec Temple&quot; </nobr>von Dominik Lehmann</h3>
+<h3><nobr>Bestes Design 2007: &quot;The Aztec Temple&quot; </nobr>von Dominik
+Lehmann</h3>
 
 <p>
   <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_i.png" alt="The Aztec Temple, VI/100" border="0">
 
 The Aztec Temple, VI/100</p>
 
-<p>Der Designpreis wurde unter drei Giganten ausgemacht: Dennoch hat der Level des Monats Mai 2007, &quot;The Aztec Temple&quot;, mit 4,19 Punkten &quot;Mountain Climbing&quot; (3,80) und &quot;Solar System&quot; (3,68) in den Schatten gestellt, und eine v&ouml;llig neue Umgebung f&uuml;r Enigmas Levels etabliert: Neben Raumschiffen, W&auml;ldern, St&auml;dten und dunklen Gassen, wird von nun an der Dschungel ein neues m&ouml;gliches Setting f&uuml;r unsere Levelautoren sein.</p>
+<p>Der Designpreis wurde unter drei Giganten ausgemacht: Dennoch hat der Level
+des Monats Mai 2007, &quot;The Aztec Temple&quot;, mit 4,19 Punkten
+&quot;Mountain Climbing&quot; (3,80) und &quot;Solar System&quot; (3,68) in den
+Schatten gestellt, und eine v&ouml;llig neue Umgebung f&uuml;r Enigmas Levels
+etabliert: Neben Raumschiffen, W&auml;ldern, St&auml;dten und dunklen Gassen,
+wird von nun an der Dschungel ein neues m&ouml;gliches Setting f&uuml;r unsere
+Levelautoren sein.</p>
 
-<h3>Lustigste Levels 2007: &quot;Advancing&quot; und &quot;Mountain Climbing&quot; von Joseph Dunne</h3>
+<h3>Lustigste Levels 2007: &quot;Advancing&quot; und &quot;Mountain
+Climbing&quot; von Joseph Dunne</h3>
 
 <p>
   <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_d.png" alt="Advancing, VII/23" border="0">
@@ -140,16 +271,27 @@
 Mountain Climbing, VII/22</div>
 </div>
 
-<p>Joseph Dunne schaffte einen Doppelschlag: Seine grandiosen Levels &quot;Advancing&quot; und &quot;Mountain Climbing&quot; erreichten beide 3,786 von 5 Punkten, und demonstrierten, was Enigma auch sein kann: Das einzigartige Design seiner Levels spiegelt die Leichtigkeit ihrer Spielatmosph&auml;ren wieder, eingerahmt von nicht ganz so leichten R&auml;tseln. Er hat damit sogar &quot;Diving&quot; (3,55) und &quot;What's the Problem?&quot; (3,52) ausgestochen.</p>
+<p>Joseph Dunne schaffte einen Doppelschlag: Seine grandiosen Levels
+&quot;Advancing&quot; und &quot;Mountain Climbing&quot; erreichten beide 3,786
+von 5 Punkten, und demonstrierten, was Enigma auch sein kann: Das einzigartige
+Design seiner Levels spiegelt die Leichtigkeit ihrer Spielatmosph&auml;ren
+wieder, eingerahmt von nicht ganz so leichten R&auml;tseln. Er hat damit sogar
+&quot;Diving&quot; (3,55) und &quot;What's the Problem?&quot; (3,52)
+ausgestochen.</p>
 
-<h3><nobr>Bester Yin-Yang-Level 2007: &quot;Teamwork&quot; </nobr>von Jacob Scott</h3>
+<h3><nobr>Bester Yin-Yang-Level 2007: &quot;Teamwork&quot; </nobr>von Jacob
+Scott</h3>
 
 <p>
   <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_c.png" alt="Teamwork, III/18" border="0">
 
 Teamwork, III/18</p>
 
-<p>&quot;Teamwork&quot; ist die treffendste Bezeichnung f&uuml;r den besten Yin-Yang-Level in Enigma: Jacob zeigt mit diesem klassischen Level, was Zusammenarbeit wirklich bedeutet, und mit 3,83 Punkten zeigt &quot;Teamwork&quot; noch Respekt vor seinen Kameraden &quot;Turnstiles for Two&quot; (3,75) und &quot;Manamana&quot; (3,64).</p>
+<p>&quot;Teamwork&quot; ist die treffendste Bezeichnung f&uuml;r den besten
+Yin-Yang-Level in Enigma: Jacob zeigt mit diesem klassischen Level, was
+Zusammenarbeit wirklich bedeutet, und mit 3,83 Punkten zeigt
+&quot;Teamwork&quot; noch Respekt vor seinen Kameraden &quot;Turnstiles for
+Two&quot; (3,75) und &quot;Manamana&quot; (3,64).</p>
 
 <p>Und nun, die wichtigste Kategorie:</p>
 
@@ -160,11 +302,26 @@
 
 Island Labyrinth, V/100</p>
 
-<p>Zum Ende ist es doch nochmal spannend geworden, da gleich vier Levels einen gro&szlig;en Sprung nach oben gemacht haben, um Level des Jahres 2007 zu werden: &quot;Quadropolis&quot; und &quot;Temple of Gold&quot; haben beide &quot;The Aztec Temple&quot; &uuml;berholt, und Houdini lie&szlig; &quot;Labyrinth of Puzzles&quot;, &quot;The Aztec Temple&quot; und sogar &quot;Temple of Gold&quot; hinter sich - f&uuml;nf Levels zwischen 9.10 und 9.25 Punkten! Aber am Ende konnte keiner von ihnen &quot;Island Labyrinth&quot; das Wasser reichen: 5 seiner 8 Wertungen sind volle 10 Punkte, eine 9, eine 8 und eine 7 f&uuml;llen die Wertung auf, was Jacob Scott als unbestrittenden Levelautor des Jahres 2007 best&auml;tigt!</p>
+<p>Zum Ende ist es doch nochmal spannend geworden, da gleich vier Levels einen
+gro&szlig;en Sprung nach oben gemacht haben, um Level des Jahres 2007 zu werden:
+&quot;Quadropolis&quot; und &quot;Temple of Gold&quot; haben beide &quot;The
+Aztec Temple&quot; &uuml;berholt, und Houdini lie&szlig; &quot;Labyrinth of
+Puzzles&quot;, &quot;The Aztec Temple&quot; und sogar &quot;Temple of Gold&quot;
+hinter sich - f&uuml;nf Levels zwischen 9.10 und 9.25 Punkten! Aber am Ende
+konnte keiner von ihnen &quot;Island Labyrinth&quot; das Wasser reichen: 5
+seiner 8 Wertungen sind volle 10 Punkte, eine 9, eine 8 und eine 7 f&uuml;llen
+die Wertung auf, was Jacob Scott als unbestrittenden Levelautor des Jahres 2007
+best&auml;tigt!</p>
 
 <h3>Wir kommen zum Ende ...</h3>
 
-<p>Diese erste Runde unserer Level-des-Monats-Serie endet nun am&uuml;santerweise, wie sie im M&auml;rz 2007 begonnen hat: mit &quot;Island Labyrinth&quot;. Sie k&ouml;nnen seinen Artikel <a href="$$lotm_200703$$">hier</a> nochmal nachlesen. Und an dieser Stelle wird es Zeit, dass wir uns bei all den Leuten bedanken, die uns &uuml;ber das letzte Jahr geholfen haben, unsere Artikel zu schreiben: Zuerst mal jenen, die einen Kommentar beigetragen haben, an
+<p>Diese erste Runde unserer Level-des-Monats-Serie endet nun
+am&uuml;santerweise, wie sie im M&auml;rz 2007 begonnen hat: mit &quot;Island
+Labyrinth&quot;. Sie k&ouml;nnen seinen Artikel <a
+href="$$lotm_200703$$">hier</a> nochmal nachlesen. Und an dieser Stelle wird es
+Zeit, dass wir uns bei all den Leuten bedanken, die uns &uuml;ber das letzte
+Jahr geholfen haben, unsere Artikel zu schreiben: Zuerst mal jenen, die einen
+Kommentar beigetragen haben, an
 Alejandro Lacava,
 Ronald Lamprecht,
 Andreas Geldmacher,
@@ -181,12 +338,28 @@
 Spioni,
 Craven,
 und Daniel Heck.
-Gr&ouml;&szlig;ter Dank geht an Taztunes, der die englische Version jeden einzelnen Artikels korrekturgelesen hat, und uns mit sage und schreibe f&uuml;nf Kommentaren ausgeholfen hat! Er war immer da, wenn wir einen weiteren Beitrag brauchten, und immer
-p&uuml;nktlich. Gro&szlig;er Dank geht auch an Yuriy, der die M&uuml;he auf sich nimmt, jeden unserer Artikel f&uuml;r unsere russischen Freunde ins Russische zu &uuml;bersetzen, oft innerhalb von nur 24 Stunden, und an Joe, der der federf&uuml;hrende Autor des Juli-Artikels war. Vielen Dank an Euch alle!</p>
+Gr&ouml;&szlig;ter Dank geht an Taztunes, der die englische Version jeden
+einzelnen Artikels korrekturgelesen hat, und uns mit sage und schreibe f&uuml;nf
+Kommentaren ausgeholfen hat! Er war immer da, wenn wir einen weiteren Beitrag
+brauchten, und immer p&uuml;nktlich. Gro&szlig;er Dank geht auch an Yuriy, der
+die M&uuml;he auf sich nimmt, jeden unserer Artikel f&uuml;r unsere russischen
+Freunde ins Russische zu &uuml;bersetzen, oft innerhalb von nur 24 Stunden, und
+an Joe, der der federf&uuml;hrende Autor des Juli-Artikels war. Vielen Dank an
+Euch alle!</p>
 
-<p>Wir wollen auch unseren Levelautoren danken, die die gro&szlig;artigen zehn Levels geschrieben haben, &uuml;ber die wir w&auml;hrend des letzten Jahres berichten durften, und die ebenfalls Kommentare f&uuml;r unsere Artikel beigesteuert haben: Vielen Dank Jacob Scott, Manuel K&ouml;nig, Dominik Lehmann, Ronald Lamprecht, Barry and Lori Mead, Johannes Laire, Raoul Bourquin, und Jon 'WB' Sneyers. Und Dank geht an den Gr&uuml;nder des Enigma-Projektes, an Daniel Heck, ebenso wie an Meinolf Schneider, der Esprit und Oxyd geschaffen hat, unsere steten Inspirationen.</p>
+<p>Wir wollen auch unseren Levelautoren danken, die die gro&szlig;artigen zehn
+Levels geschrieben haben, &uuml;ber die wir w&auml;hrend des letzten Jahres
+berichten durften, und die ebenfalls Kommentare f&uuml;r unsere Artikel
+beigesteuert haben: Vielen Dank Jacob Scott, Manuel K&ouml;nig, Dominik Lehmann,
+Ronald Lamprecht, Barry and Lori Mead, Johannes Laire, Raoul Bourquin, und Jon
+'WB' Sneyers. Und Dank geht an den Gr&uuml;nder des Enigma-Projektes, an Daniel
+Heck, ebenso wie an Meinolf Schneider, der Esprit und Oxyd geschaffen hat,
+unsere steten Inspirationen.</p>
 
-<p>Sie k&ouml;nnen die aktuellen Statistiken unserer zehn LdMs im <a href="$$lotm$$">LdM-Archiv</a> finden, und die genauen statistischen Ergebnisse der Abstimmung werden bald schon <a href="$$eoya_2007_statistics$$">hier</a> online sein.</p>
+<p>Sie k&ouml;nnen die aktuellen Statistiken unserer zehn LdMs im <a
+href="$$lotm$$">LdM-Archiv</a> finden, und die genauen statistischen Ergebnisse
+der Abstimmung werden bald schon <a href="$$eoya_2007_statistics$$">hier</a>
+online sein.</p>
 
 <p>Frohes Neues Level-Jahr,<br>
 <i>Andreas &amp;Harry</i></p>

Modified: homepage/input/infobox.html
===================================================================
--- homepage/input/infobox.html	2008-01-02 00:08:49 UTC (rev 960)
+++ homepage/input/infobox.html	2008-01-02 22:00:37 UTC (rev 961)
@@ -11,7 +11,7 @@
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
          </div>  -->
          <h3>End-of-Year Awards</h3>
-         <a href="$$eoya_2007$$"><img src="images/articles/unknown_medium.png"
+         <a href="$$eoya_2007$$"><img src="images/articles/eoya_2007.png"
          alt="Which might be the Level of the Year?" border="0"></a>
          <div class="imagetitle">
            The best levels of 2007 are chosen and the Level of the Year 2007

Modified: homepage/input/infobox_de.html
===================================================================
--- homepage/input/infobox_de.html	2008-01-02 00:08:49 UTC (rev 960)
+++ homepage/input/infobox_de.html	2008-01-02 22:00:37 UTC (rev 961)
@@ -11,7 +11,7 @@
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
          </div>-->
          <h3>Jahresend-<br>auszeichnungen</h3>
-         <a href="$$eoya_2007$$"><img src="images/articles/unknown_medium.png"
+         <a href="$$eoya_2007$$"><img src="images/articles/eoya_2007.png"
          alt="Welches mag der Level des Jahres sein?" border="0"></a>
          <div class="imagetitle">
            Die besten Levels aus 2007 sind gew&auml;hlt und der Level des



From ral at mail.berlios.de  Thu Jan  3 16:20:30 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 3 Jan 2008 16:20:30 +0100
Subject: [Enigma-game-svn] r962 - in trunk: data src src/stones
Message-ID: <200801031520.m03FKUnt004373@sheep.berlios.de>

Author: ral
Date: 2008-01-03 16:20:27 +0100 (Thu, 03 Jan 2008)
New Revision: 962

Added:
   trunk/src/StateObject.cc
   trunk/src/StateObject.hh
   trunk/src/stones/FourSwitch.cc
   trunk/src/stones/FourSwitch.hh
   trunk/src/stones/Switch.cc
   trunk/src/stones/Switch.hh
Modified:
   trunk/data/init.lua
   trunk/src/GridObject.cc
   trunk/src/GridObject.hh
   trunk/src/Makefile.am
   trunk/src/Object.cc
   trunk/src/Object.hh
   trunk/src/Value.cc
   trunk/src/Value.hh
   trunk/src/actors.cc
   trunk/src/actors.hh
   trunk/src/display.hh
   trunk/src/floors.cc
   trunk/src/items.cc
   trunk/src/laser.cc
   trunk/src/lua.cc
   trunk/src/lua.hh
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/st_switches.cc
   trunk/src/stones.cc
   trunk/src/stones.hh
   trunk/src/stones/OxydStone.cc
   trunk/src/stones/WindowStone.cc
   trunk/src/stones/WindowStone.hh
   trunk/src/stones_complex.cc
   trunk/src/stones_simple.cc
   trunk/src/world.cc
Log:
Trunk 1.1: reengineering of onoff objects and switches
- new subclass StateObject as basis for all gaming objects
- Switch rewrite: added "color" attribute, "inverse" support
- FourSwitch rewrite:
  - state set/get attribute representing the direction
  - action value of direction for global targets to steer boulder, oneway
    (direction made compatible to signal values 1,0)
  - action value bool for triggering on state dependent targets
  - "inverse" support
  - added "counterclock" attribute defaulting to false
  - "toggle", "signal" support
- renaming support for new API - new obect names:
  st_switch, st_switch_black, st_switch_white, st_fourswitch
- invert support extended from bool to arbitrary values
- message: overriden methods call their direct superclass
- Value added operator <=,>=(int)
Note:
- Blocking of unsupported messages and attributes of StateObject is
  still missing.

Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/data/init.lua	2008-01-03 15:20:27 UTC (rev 962)
@@ -1,5 +1,6 @@
 ------------------------------------------------------------------------
 -- Copyright (C) 2002,2003,2004,2005 Daniel Heck
+-- Copyright (C) 2007,2008 Ronald Lamprecht
 --
 -- This program is free software; you can redistribute it and/or
 -- modify it under the terms of the GNU General Public License
@@ -34,17 +35,59 @@
 -- Compatibility for old API --
 -------------------------------
 
+enigma._MakeObject = enigma.MakeObject
+enigma._GetKind = enigma.GetKind
 enigma._SetAttrib = enigma.SetAttrib
 enigma._GetAttrib = enigma.GetAttrib
 
+RenamingObjectsOld2New = {
+}
+
+RenamingObjectsNew2Old = {
+    st_fourswitch = "st-fourswitch",
+    st_switch = "st-switch",
+    st_switch_black = "st-switch_black",
+    st_switch_white = "st-switch_white"
+}
+
+for k,v in pairs(RenamingObjectsNew2Old) do
+    RenamingObjectsOld2New[v] = k
+end
+
+function enigma.MakeObject(name)
+    newname = RenamingObjectsOld2New[name]
+    if newname ~= nil then
+        return enigma._MakeObject(newname)
+    else
+        return enigma._MakeObject(name)
+    end
+end
+
+function enigma.GetKind(obj)
+    local _newname = enigma._GetKind(obj)
+    local _oldname = RenamingObjectsNew2Old[_newname]
+    if _oldname ~= nil then
+        return _oldname
+    else
+        return _newname
+    end
+end
+
 function enigma.SetAttrib(obj, key, val)
      local _val = val
      local _key = key
-     if enigma.GetKind(obj) == "st-oxyd" then
+     local _obj_name = enigma.GetKind(obj)
+     if _obj_name == "st-oxyd" then
          if key == "color" then
 	     _val = 0 + val   -- convert to int
 	 end
      end
+     if (_obj_name == "st-switch") or (_obj_name == "st-switch_black")
+             or (_obj_name == "st-switch_black") then
+         if key == "on" then
+	     _key = "state"   -- new attr name
+	 end
+     end
      if key == "targetx" then
          local d = enigma._GetAttrib(obj, "destination")
          if (en.usertype(d) == "position") then
@@ -68,8 +111,18 @@
 
 function enigma.GetAttrib(obj, key)
      local _key = key
-     local val = enigma._GetAttrib(obj, key)
-     if enigma.GetKind(obj) == "st-oxyd" then
+     local _obj_name = enigma.GetKind(obj)
+
+     if (_obj_name == "st-switch") or (_obj_name == "st-switch_black")
+             or (_obj_name == "st-switch_black") then
+         if key == "on" then
+	     _key = "state"
+	 end
+     end
+
+     local val = enigma._GetAttrib(obj, _key)
+     
+     if _obj_name == "st-oxyd" then
          if key == "color" then
 	     val = "" .. val   -- convert to string
 	 end
@@ -89,6 +142,11 @@
      return val
 end
 
+MessageRenaming = {
+    st_switch__onoff = "toggle",
+    st_switch_black__onoff = "toggle",
+    st_switch_white__onoff = "toggle"
+}
 ----------------------
 -- old API 1.0      --
 ----------------------

Modified: trunk/src/GridObject.cc
===================================================================
--- trunk/src/GridObject.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/GridObject.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -93,7 +93,7 @@
     {
         return sound::EmitSoundEvent (name, get_pos().center(), getVolume(name, this, vol));
     }
-    
+ 
     void GridObject::warning(const char *format, ...) const 
     {
         va_list        arg_ptr;
@@ -108,4 +108,9 @@
         va_end(arg_ptr);
     }
     
+    void GridObject::setState(int extState) {
+        StateObject::setState(extState);
+        init_model();
+    }
+    
 } // namespace enigma

Modified: trunk/src/GridObject.hh
===================================================================
--- trunk/src/GridObject.hh	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/GridObject.hh	2008-01-03 15:20:27 UTC (rev 962)
@@ -20,7 +20,7 @@
 #ifndef GRIDOBJECT_HH
 #define GRIDOBJECT_HH
 
-#include "Object.hh"
+#include "StateObject.hh"
 
 #include "display.hh"
 #include "ecl_alist.hh"
@@ -39,10 +39,10 @@
      * placed on "The Grid", i.e., for floor tiles, items, and
      * stones. 
      */
-    class GridObject : public Object, public display::ModelCallback {
+    class GridObject : public StateObject, public display::ModelCallback {
     public:
         GridObject() : pos (GridPos(-1, -1)) {}
-        GridObject(const char * kind) : Object(kind), pos (GridPos(-1, -1)) {}
+        GridObject(const char * kind) : StateObject(kind), pos (GridPos(-1, -1)) {}
 
         void creation(GridPos p) {
             pos = p;
@@ -74,6 +74,8 @@
          * players will return positions outside of the world. 
          */
         GridPos getOwnerPos();
+        
+        virtual bool isDisplayable() {return pos.x >= 0;}
 
         // GridObject interface
         virtual void on_laserhit (Direction) {}
@@ -105,6 +107,9 @@
             kill_model (p);
         }
 
+        // StateObject interface
+        virtual void setState(int extState);
+
     private:
         // ModelCallback interface.
         void animcb() {}

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/Makefile.am	2008-01-03 15:20:27 UTC (rev 962)
@@ -107,6 +107,8 @@
 	sound.cc 		\
 	sound.hh 		\
 	sound_internal.hh	\
+	StateObject.cc		\
+	StateObject.hh		\
 	StateManager.cc		\
 	StateManager.hh		\
 	stones.cc 		\
@@ -188,8 +190,12 @@
 	lev/VolatileIndex.hh	\
 	stones/ConnectiveStone.cc	\
 	stones/ConnectiveStone.hh	\
+	stones/FourSwitch.cc	\
+	stones/FourSwitch.hh	\
 	stones/OxydStone.cc	\
 	stones/OxydStone.hh	\
+	stones/Switch.cc	\
+	stones/Switch.hh	\
 	stones/WindowStone.cc	\
 	stones/WindowStone.hh
 

Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/Object.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -24,6 +24,7 @@
 #include "game.hh"
 #include "main.hh"
 #include "lua.hh"
+#include "server.hh"
 #include "sound.hh"
 #include "world.hh"
 
@@ -175,9 +176,8 @@
     
     void Object::performAction(const Value& val) {
         Value messageValue = val;
-        if (messageValue.getType() == Value::BOOL)   // bool values may be inverted
-            if (getDefaultedAttr("inverse", false).to_bool())
-                messageValue = !messageValue.to_bool();  // invert value
+        if (getDefaultedAttr("inverse", false).to_bool())
+            messageValue = invertActionValue(val);
 
         TokenList targets = getAttr("target");
         TokenList actions = getAttr("action");
@@ -204,14 +204,21 @@
                     }
                 }
                 // else ignore this no longer valid target
-    //            Log << "PerformAction target not valid\n";
+//                Log << "PerformAction target not valid\n";
             } else {
                 // send message to all objects
                 if (action == "") 
                     action = "toggle";
                 for (ObjectList::iterator oit = ol.begin(); oit != ol.end(); ++oit) {
                     if (*oit != NULL) {
-                        SendMessage(*oit, Message(action, messageValue, this));                    
+                        std::string obj_action = action;
+                        if (server::EnigmaCompatibility < 1.10) {
+                            // we may need to translate the new API message to old API
+                            obj_action = lua::NewMessageName(lua::LevelState(), *oit, action);
+//                            if (obj_action != action)
+//                                Log << "PerformAction renamed '" << action << "' to '" << obj_action << "' for receiver '" << (*oit)->get_kind() << "'\n";
+                        }
+                        SendMessage(*oit, Message(obj_action, messageValue, this));                    
                     }
                 }
             }
@@ -220,6 +227,12 @@
         }
     }
     
+    Value Object::invertActionValue(const Value &val) const {
+        if (val.getType() == Value::BOOL)   // bool values may be inverted
+            return !val.to_bool();  // invert value
+        return val;
+    }
+    
     /* Send an impulse to position 'dest' into direction dir.  If 'dest'
        contains a stone, on_impulse() is called for that stone */
     void Object::send_impulse(const GridPos& dest, Direction dir) 

Modified: trunk/src/Object.hh
===================================================================
--- trunk/src/Object.hh	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/Object.hh	2008-01-03 15:20:27 UTC (rev 962)
@@ -156,7 +156,10 @@
          * doors or switching lasers on and off). It interprets the
          * "action" and "target" attributes of `o'. 
          */
-        void performAction(const Value& val);
+        void performAction(const Value &val);
+        
+        virtual Value invertActionValue(const Value &val) const;
+        
     private:
         friend void InitWorld();   // for bootFinished() access
         

Added: trunk/src/StateObject.cc
===================================================================
--- trunk/src/StateObject.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/StateObject.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -0,0 +1,91 @@
+/*
+ * Copyright (C) 2007,2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "StateObject.hh"
+
+#include "world.hh"
+//#include "main.hh"
+
+namespace enigma {
+
+/* -------------------- StateObject implementation -------------------- */
+    StateObject::StateObject() : Object(), state (0) {
+    }
+    
+    StateObject::StateObject(const char * kind) : Object(kind), state (0) {
+    }
+    
+    Value StateObject::message(const Message &m) {
+        if (m.message == "toggle") {
+            toggleState();
+        } else if (m.message == "signal") {
+            int v = m.value;    // action bools are converted to int
+            if (v >= 0)
+                setState(v % 2);  // allow fourswitches to send dir as signal value
+            return Value();
+        } else if (m.message == "on" || m.message == "open") {
+            setState(1);
+            return Value();
+        } else if (m.message == "off" || m.message == "close") {
+            setState(0);
+            return Value();
+        }
+        return Object::message(m);
+    }
+    
+    Value StateObject::getAttr(const string &key) const {
+        if (key == "state")
+            return externalState();
+        return Object::getAttr(key);
+    }
+    
+    void StateObject::set_attrib(const string& key, const Value &val) {
+        if (key == "state") {
+            if (val >= minState() && val <= maxState())
+                setState(val);
+            return;
+        }
+        Object::set_attrib(key, val);
+    }
+    
+    int StateObject::maxState() {
+        return 1;  // default 2 state
+    }
+    
+    int StateObject::minState() {
+        return 0;  // default 2 state
+    }
+    void StateObject::toggleState() {
+        // default round robin on external states
+        int extState = externalState();
+        if (extState + 1 <= maxState())
+            setState(extState + 1);
+        else
+            setState(minState());
+    }
+    
+    int StateObject::externalState() const {
+        return state;       // default behaviour internal = external state
+    }
+    
+    void StateObject::setState(int extState) {
+        state = extState;   // default behaviour internal = external state
+    }
+    
+} // namespace enigma


Property changes on: trunk/src/StateObject.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/StateObject.hh
===================================================================
--- trunk/src/StateObject.hh	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/StateObject.hh	2008-01-03 15:20:27 UTC (rev 962)
@@ -0,0 +1,140 @@
+/*
+ * Copyright (C) 2007,2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef STATEOBJECT_HH
+#define STATEOBJECT_HH
+
+#include "Object.hh"
+
+
+namespace enigma {
+
+    /** 
+     * The base class for all gaming objects that have different states that
+     * can be toggled by means of messages, actions or attribute settings.
+     * This class is the successor of the former OnOffStone and OnOffItem.
+     * Being a superclass of all gaming objects it provides a common interface
+     * for the handling of states. The state is not limited to 2 states like
+     * the common on/off and open/close. Arbitrary number of external states 
+     * are supported. E.g. FourSwitches have 4 states that describe the current
+     * direction.<p>
+     * But the external state - the logical gaming state used in level lua code -
+     * is often just a small subset of states that an object has to distinguish.
+     * Additional display related states, timer related states and internal
+     * gaming logic states require sometimes a much more complex state machine.
+     * <p>
+     * The maximum set of states that we call the internal state of a final
+     * gaming object class should be stored in StateObjects state ivar. It is
+     * the responsibility of StateObject to guarantee the persistence and
+     * cloning of the internal state.<p>
+     * StateObject provides the common interface for state management with hooks
+     * for all needs like conversion of external to and from internal states,
+     * common messages like toggle, signal, on, off, open, close and checked
+     * setter and getter for the state as a pseudo attribute.<p>
+     * Furtheron its default implementation suits the needs a simple 2 state
+     * on/off or open/close object. More complex stated objects will need to
+     * override the hook methods to their needs.
+     */
+    class StateObject : public Object {
+    public:
+        StateObject();
+        StateObject(const char * kind);
+        
+        // Object Interface
+        
+        /**
+         * Handle the messages "toggle", "signal", "on", "off", "open", "close".
+         * Any subclass should forward these messages to its superclass without
+         * interfering these messages. Per default these messages will be blocked
+         * by SendMessage() if they are not explicitly declared for the final
+         * subclass in objects.xml.
+         */
+        virtual Value message(const Message &m);
+        
+        /**
+         * Handle the attribute "state" by a pseudo implementation. Subclasses
+         * shall not interfere with this attribute but override the method
+         * "externalState()" on demand.
+         */
+        virtual Value getAttr(const string &key) const;
+        
+        /**
+         * Handle the attribute "state" by a pseudo implementation. Subclasses
+         * shall not interfere with this attribute but override the method
+         * "setState()". New state values are checked against min and max. 
+         */
+        virtual void set_attrib(const string& key, const Value &val);
+        
+    protected:
+        /**
+         * The storage location of the internal state. This ivar is logically
+         * owned by the final discrete object class which will define in most
+         * cases an enum called iState that lists all states. All intermediate
+         * classes between StateObject and the state owning subclass will just
+         * be aware of the external state that they access via the setter and
+         * getter methods. Just these two methods in their StateObject default
+         * implementation will directly access this ivar (besides the gaming
+         * logic indepent persistence and cloning methods). 
+         */
+        int state;
+        
+        /**
+         * The maximum number of the external state. It defaults to 1, and 
+         * should be overridden by the final subclass just on demand. 
+         */
+        virtual int maxState();
+        
+        /**
+         * The minimum number of the external state. It defaults to 0, and
+         * should be overridden by the final subclass just on demand.
+         */
+        virtual int minState();
+        
+        /**
+         * The method that is called on toggle messages to switch the object
+         * to the next external state. The default implementation is a round
+         * robin of the external state from minState() to maxState() and returning
+         * to minState() again. Override this method if the toggle operation
+         * changes the states in another sequence..
+         */
+        virtual void toggleState();
+        
+        /**
+         * Access method that translates the internal state stored in "state" to
+         * the external gaming logic state. The default implementation is a
+         * direct return of the state which suits a one to one mapping between
+         * internal and external states. If additional internal states or another
+         * mapping is used this method needs to be overwritten. All access to
+         * the external state by any other intermediate class has to use this
+         * method.
+         */
+        virtual int externalState() const;
+        
+        /**
+         * Setter method for external state that switches the object to the
+         * appropriate internal state. The default implementation is a direct
+         * storage of the external state as the internal state. Most final
+         * subclasses will have to override this method to cause some actions,
+         * to send messages and to switch the display model.
+         */
+        virtual void setState(int extState);
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/StateObject.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/Value.cc
===================================================================
--- trunk/src/Value.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/Value.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -210,6 +210,14 @@
         return (int) *this != i;
     }
     
+    bool Value::operator<=(int i) const {
+        return (int) *this <= i;
+    }
+    
+    bool Value::operator>=(int i) const {
+        return (int) *this >= i;
+    }
+    
     Value::operator bool() const {
         if (isDefault())
             return false;

Modified: trunk/src/Value.hh
===================================================================
--- trunk/src/Value.hh	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/Value.hh	2008-01-03 15:20:27 UTC (rev 962)
@@ -138,6 +138,8 @@
         bool operator==(int i) const;          ///< Compare value with int without casting.
                                                ///< f.e <code>if (v == 2)</code>
         bool operator!=(int i) const;          ///< Compare value with int without casting
+        bool operator<=(int i) const;          ///< Compare value with int without casting
+        bool operator>=(int i) const;          ///< Compare value with int without casting
         
         /**
          * Test of a value for explicit existence besides a default.

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/actors.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -92,7 +92,7 @@
 /* -------------------- Actor -------------------- */
 
 Actor::Actor (const ActorTraits &tr)
-: Object(tr.name),
+: StateObject(tr.name),
   m_actorinfo(),
   m_sprite(),
   startingpos(), 
@@ -268,7 +268,7 @@
         startingpos = get_pos();
         return Value();
     }
-    return Object::message(m);
+    return StateObject::message(m);
 }
 
 bool Actor::sound_event (const char *name, double vol) {

Modified: trunk/src/actors.hh
===================================================================
--- trunk/src/actors.hh	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/actors.hh	2008-01-03 15:20:27 UTC (rev 962)
@@ -19,7 +19,7 @@
 #ifndef ACTORS_HH_INCLUDED
 #define ACTORS_HH_INCLUDED
 
-#include "Object.hh"
+#include "StateObject.hh"
 
 namespace enigma {
 
@@ -104,7 +104,7 @@
     };
 
 
-    class Actor : public Object, public display::ModelCallback {
+    class Actor : public StateObject, public display::ModelCallback {
         friend class World;
         friend class ActorsInRangeIterator;
     public:

Modified: trunk/src/display.hh
===================================================================
--- trunk/src/display.hh	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/display.hh	2008-01-03 15:20:27 UTC (rev 962)
@@ -38,6 +38,7 @@
     public:
         virtual ~ModelCallback() {}
         virtual void animcb() = 0;
+        virtual bool isDisplayable() {return true;}
     };
 
     class Animation {

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/floors.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -75,7 +75,7 @@
         return force_fire();
     if (m.message == "stopfire")
         return stop_fire(true);
-    return Object::message(m);
+    return GridObject::message(m);
 }
 
 ecl::V2 Floor::process_mouseforce (Actor *a, ecl::V2 force) {

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/items.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -209,7 +209,7 @@
                 set_on(false);
                 return Value();
             }
-            return Object::message(m);
+            return Item::message(m);
         }
 
         // OnOffItem interface
@@ -284,7 +284,7 @@
                     return Value();
                 }
             }
-            return Object::message(m);
+            return Item::message(m);
         }
 
 
@@ -513,7 +513,7 @@
                     return Value();
                 }
             }
-            return Object::message(m);
+            return Item::message(m);
         }
 
     public:
@@ -755,7 +755,7 @@
         shovel();
         return Value();
     } 
-    return Object::message(m);
+    return Item::message(m);
 }
 
 V2 HillHollow::vec_to_center (V2 v)
@@ -1084,7 +1084,7 @@
             } else if (m.message == "expl" || m.message == "bombstone") {
                 explode = true;
             } else {
-                return Object::message(m);
+                return Item::message(m);
             }
 
             if (explode)
@@ -1152,7 +1152,7 @@
                 change_state(BURNING);
                 return Value(1.0);  // caught message -> no fire!
             }
-            return Object::message(m);
+            return Item::message(m);
         }
         void animcb() { explode(); }
         void on_laserhit(Direction) {
@@ -1195,7 +1195,7 @@
                 burn();
                 return Value(1.0);  // caught message -> no fire!
             }
-            return Object::message(m);
+            return Item::message(m);
         }
 
     private:
@@ -1343,7 +1343,7 @@
                 update_state();                
                 return Value();
             }
-            return Object::message(m);
+            return Item::message(m);
         }
     };
 
@@ -1410,7 +1410,7 @@
                 start_growing();
                 return Value();
             }
-            return Object::message(m);
+            return Item::message(m);
         }
 
         void start_growing() {
@@ -1560,7 +1560,7 @@
             return Value();
         }
     }
-    return Object::message(m);
+    return Item::message(m);
 }
 
 
@@ -1948,7 +1948,7 @@
             performAction(getAttr("$grabbed_actor"));
         return Value();
     }
-    return Object::message(m);
+    return Item::message(m);
 }
 
 void Vortex::init_model() {
@@ -2219,7 +2219,7 @@
                 replace (it_explosion1);
                 return Value();
             }
-            return Object::message(m);
+            return Item::message(m);
         }
     public:
         static void setup() {
@@ -2410,7 +2410,7 @@
                 replace(it_debris);
                 return Value(1.0);
             }
-            return Object::message(m);
+            return Item::message(m);
         }
 
         bool do_crack() {
@@ -2512,7 +2512,7 @@
         if (m.message == "trigger" || m.message == "ignite" || m.message == "expl")
             return SendMessage(fl, "ignite");
     }
-    return Object::message(m);
+    return Item::message(m);
 }
 
 void Burnable::animcb() {
@@ -2768,7 +2768,7 @@
         else if (m.message == "close")
             open = 0;
         else
-            return Object::message(m);
+            return Item::message(m);
 
         if (open == 1)  { // shrink
             if (state == COVERED)
@@ -2880,7 +2880,7 @@
                     SendMessage (floor, "open");
                 return Value();
             }
-            return Object::message(m);
+            return Item::message(m);
         }
     public:
         OxydBridge() {}
@@ -2930,7 +2930,7 @@
             } else if (m.message == "_hitactor") {
                 return getAttr("$hitactor");
             }
-            return Object::message(m);
+            return Item::message(m);
         }
     };
     DEF_TRAITSF(Sensor, "it-sensor", it_sensor, itf_static | itf_invisible);
@@ -2969,7 +2969,7 @@
                     performAction(type != 0);
                 return Value();
             }
-            return Object::message(m);
+            return Item::message(m);
         }
 
         // type of signal filter
@@ -3041,7 +3041,7 @@
         kill();
         return Value();
     }
-    return Object::message(m);
+    return Item::message(m);
 }
 
 /* -------------------- EasyKeepStone -------------------- */
@@ -3060,7 +3060,7 @@
                 kill();
                 return Value();
             }
-            return Object::message(m);
+            return Item::message(m);
         }
     public:
         EasyKeepStone() {}
@@ -3083,7 +3083,7 @@
                 kill();
                 return Value();
             }
-            return Object::message(m);
+            return Item::message(m);
         }
     public:
         OnePKillStone () {}
@@ -3102,7 +3102,7 @@
                 kill();
                 return Value();
             }
-            return Object::message(m);
+            return Item::message(m);
         }
     public:
         TwoPKillStone () {}
@@ -3229,7 +3229,7 @@
                     return Value();
                 }
             }
-            return Object::message(m);
+            return Item::message(m);
         }
 
     public:

Modified: trunk/src/laser.cc
===================================================================
--- trunk/src/laser.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/laser.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -554,7 +554,7 @@
         MaybeRecalcLight(get_pos());
         return Value();
     }
-    return Object::message(m);
+    return Stone::message(m);
 }
 
 void MirrorStone::actor_hit(const StoneContact &sc)

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/lua.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -2500,6 +2500,22 @@
     return _lua_err_code(retval);
 }
 
+std::string NewMessageName(lua_State *L, const Object *obj, const std::string &message) {
+    std::string result;
+    lua_getglobal(L, "MessageRenaming");
+    if (lua_istable(L, -1)) {
+        lua_pushstring(L, ecl::strf("%s__%s", obj->get_kind(), message.c_str()).c_str());
+        lua_gettable(L, -2);
+        if (!lua_isnil(L, -1))
+            result = lua_tostring(L, -1);
+        else
+            result = message;
+        lua_pop(L, 1);
+    }
+    lua_pop(L, 1);
+    return result;
+}
+
 Error DoAbsoluteFile(lua_State *L, const string &filename)
 {
     int oldtop = lua_gettop(L);

Modified: trunk/src/lua.hh
===================================================================
--- trunk/src/lua.hh	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/lua.hh	2008-01-03 15:20:27 UTC (rev 962)
@@ -96,6 +96,8 @@
     /*! Call a Lua function with a (large) byte vector as the sole
       argument.  Currently only used for loading XML levels. */
     Error CallFunc (lua_State *L, const char *funcname, const ByteVec &arg);
+    
+    std::string NewMessageName(lua_State *L, const Object *obj, const std::string &message);
 
     /**
      * Run a Lua script using a given absolute path.

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/ox_extra.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -162,7 +162,7 @@
     "st-plain_hole",     // OxydExtra stone 0x25
     "st-plain_move",     // OxydExtra stone 0x26
     "st-wood",           // OxydExtra stone 0x27
-    "st-switch",         // OxydExtra stone 0x28
+    "st_switch",         // OxydExtra stone 0x28
     UNUSED,              // OxydExtra stone 0x29
     UNUSED,              // OxydExtra stone 0x2a
     UNUSED,              // OxydExtra stone 0x2b

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/ox_magnum.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -166,14 +166,14 @@
     "st-plain_hole",            // OxydMagnum stone 0x29
     "st-plain_move",            // OxydMagnum stone 0x2a
     "st-wood",                  // OxydMagnum stone 0x2b
-    "st-switch",                // OxydMagnum stone 0x2c
+    "st_switch",                // OxydMagnum stone 0x2c
     "st-floppy",                // OxydMagnum stone 0x2d (in normal Oxyd Magnum Levels unused!)
     UNUSED,                     // OxydMagnum stone 0x2e
-    "st-fourswitch",            // OxydMagnum stone 0x2f (Level 89 and 92)
+    "st_fourswitch",            // OxydMagnum stone 0x2f (Level 89 and 92)
     "st-key",                   // OxydMagnum stone 0x30
     "st-floppy",                // OxydMagnum stone 0x31
     "st-knight",                // OxydMagnum stone 0x32
-    "st-fourswitch",            // OxydMagnum stone 0x33 (Level 51 and 100)
+    "st_fourswitch",            // OxydMagnum stone 0x33 (Level 51 and 100)
     "st-death",                 // OxydMagnum stone 0x34
     "st-death_invisible",       // OxydMagnum stone 0x35
     "st-oneway_black-w",        // OxydMagnum stone 0x36
@@ -268,7 +268,7 @@
     UNUSED,                     // OxydMagnum stone 0x8f
     "st-redrock",               // OxydMagnum stone 0x90 (Level 89 only)
     UNUSED,                     // OxydMagnum stone 0x91
-    "st-fourswitch",            // OxydMagnum stone 0x92 (Level 51 only)
+    "st_fourswitch",            // OxydMagnum stone 0x92 (Level 51 only)
     "st-yinyang1",              // OxydMagnum stone 0x93
     "st-break_acwhite",         // OxydMagnum stone 0x94
     "st-break_acblack",         // OxydMagnum stone 0x95

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/ox_oxyd1.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -196,10 +196,10 @@
     "st-plain_hole",            // Oxyd1 stone 0x29
     "st-plain_move",            // Oxyd1 stone 0x2a
     "st-wood",                  // Oxyd1 stone 0x2b
-    "st-switch",                // Oxyd1 stone 0x2c
-    "st-switch_black",          // Oxyd1 stone 0x2d
-    "st-switch_white",          // Oxyd1 stone 0x2e
-    "st-fourswitch",            // Oxyd1 stone 0x2f
+    "st_switch",                // Oxyd1 stone 0x2c
+    "st_switch_black",          // Oxyd1 stone 0x2d
+    "st_switch_white",          // Oxyd1 stone 0x2e
+    "st_fourswitch",            // Oxyd1 stone 0x2f
     "st-key",                   // Oxyd1 stone 0x30
     "st-floppy",                // Oxyd1 stone 0x31
     "st-knight",                // Oxyd1 stone 0x32
@@ -298,7 +298,7 @@
     UNUSED,                     // Oxyd1 stone 0x8f
     "st-whiteballs",            // Oxyd1 stone 0x90
     "st-blackballs",            // Oxyd1 stone 0x91
-    "st-fourswitch",            // Oxyd1 stone 0x92
+    "st_fourswitch",            // Oxyd1 stone 0x92
     "st-yinyang1",              // Oxyd1 stone 0x93
     "st-break_acwhite",         // Oxyd1 stone 0x94
     "st-break_acblack",         // Oxyd1 stone 0x95

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/ox_peroxyd.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -234,10 +234,10 @@
     "st-bluegray_hole",         // PerOxyd stone 0x25
     "st-plain_move",            // PerOxyd stone 0x26
     "st-wood",                  // PerOxyd stone 0x27
-    "st-switch",                // PerOxyd stone 0x28
-    "st-switch_black",          // PerOxyd stone 0x29
-    "st-switch_white",          // PerOxyd stone 0x2a
-    "st-fourswitch",            // PerOxyd stone 0x2b
+    "st_switch",                // PerOxyd stone 0x28
+    "st_switch_black",          // PerOxyd stone 0x29
+    "st_switch_white",          // PerOxyd stone 0x2a
+    "st_fourswitch",            // PerOxyd stone 0x2b
     "st-key",                   // PerOxyd stone 0x2c
     "st-floppy",                // PerOxyd stone 0x2d
     "",                         // PerOxyd stone 0x2e (?)

Modified: trunk/src/st_switches.cc
===================================================================
--- trunk/src/st_switches.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/st_switches.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -30,137 +30,7 @@
 
 namespace enigma {
 
-/* -------------------- Switch -------------------- */
 
-namespace
-{
-    class SwitchStone : public OnOffStone {
-        CLONEOBJ(SwitchStone);
-    public:
-        SwitchStone() : OnOffStone("st-switch"), state(IDLE) {}
-    private:
-        enum State { IDLE, TOGGLING } state;
-
-        void init_model() {
-            set_model(is_on() ? "st-switch-on" : "st-switch-off");
-        }
-
-        void actor_hit(const StoneContact &/*sc*/) {
-            set_on (!is_on());
-        }
-
-        virtual void set_on(bool newon) {
-            if (state == IDLE && newon != is_on()) {
-//                set_attrib("on", enigma::Value(newon));
-                sound_event ("switchon");
-                state = TOGGLING;
-                if (newon)
-                    set_anim("st-switch-turnon");
-                else
-                    set_anim("st-switch-turnoff");
-                performAction(newon);
-            }
-        }
-
-        void animcb() {
-            state = IDLE;
-            set_attrib("on", enigma::Value(!is_on()));
-            init_model();
-//            set_on(!is_on());
-        }
-        const char *collision_sound() { return "metal"; }
-    };
-}
-
-/* -------------------- Switch_black -------------------- */
-
-namespace
-{
-    class Switch_black : public OnOffStone {
-        CLONEOBJ(Switch_black);
-    public:
-        Switch_black() : OnOffStone("st-switch_black"), 
-                         state(IDLE) 
-        {}
-    private:
-        enum State { IDLE, TOGGLING } state;
-        void init_model() {
-            set_model(is_on() ? "st-switch_black-on" : "st-switch_black-off");
-        }
-
-        void actor_hit(const StoneContact &sc) {
-            if (get_id (sc.actor) == ac_blackball)
-                set_on (!is_on());
-        }
-
-        virtual void set_on(bool newon) {
-            if (state == IDLE && newon != is_on()) {
-//                set_attrib("on", enigma::Value(newon));
-                sound_event ("switchon");
-                state = TOGGLING;
-                if (newon)
-                    set_anim("st-switch_black-turnon");
-                else
-                    set_anim("st-switch_black-turnoff");
-                performAction(newon);
-            }
-        }
-        void animcb() {
-            state = IDLE;
-            set_attrib("on", enigma::Value(!is_on()));
-            init_model();
-//            set_on(!is_on());
-        }
-
-        const char *collision_sound() { return "metal"; }
-    };
-}
-
-/* -------------------- Switch_white -------------------- */
-
-namespace
-{
-    class Switch_white : public OnOffStone {
-        CLONEOBJ(Switch_white);
-    public:
-        Switch_white() : OnOffStone("st-switch_white"), 
-                         state(IDLE) 
-        {}
-    private:
-        enum State { IDLE, TOGGLING } state;
-        void init_model() {
-            set_model(is_on() ? "st-switch_white-on" : "st-switch_white-off");
-        }
-
-        void actor_hit(const StoneContact &sc) {
-            if (get_id (sc.actor) == ac_whiteball)
-                set_on (!is_on());
-        }
-
-        virtual void set_on(bool newon) {
-            if (state == IDLE && newon != is_on()) {
-//                set_attrib("on", enigma::Value(newon));
-                sound_event ("switchon");
-                state = TOGGLING;
-                if (newon)
-                    set_anim("st-switch_white-turnon");
-                else
-                    set_anim("st-switch_white-turnoff");
-                performAction(newon);
-            }
-        }
-        void animcb() {
-            state = IDLE;
-            set_attrib("on", enigma::Value(!is_on()));
-            init_model();
-        }
-
-        const char *collision_sound() { return "metal"; }
-    };
-}
-
-
-
 /* -------------------- Coin slot -------------------- */
 
 namespace
@@ -360,90 +230,6 @@
 }
 
 
-/* -------------------- FourSwitch -------------------- */
-
-// Attributes:
-//
-// :on              1 or 0
-// :target,action   as usual
-
-namespace
-{
-    class FourSwitch : public OnOffStone {
-        CLONEOBJ(FourSwitch);
-        DECL_TRAITS;
-    public:
-        FourSwitch() : OnOffStone("st-fourswitch"), 
-                       m_direction(NORTH), 
-                       m_inactive_so_far (true)
-        {}
-        
-        Value getAttr(const string &key) const {
-            if (key == "state")
-                return direction2state(m_direction);
-            return Object::getAttr(key);
-        }
-    private:
-        static int direction2state(Direction dir) {
-            return 3 - dir;
-        };
-        
-        // Variables
-        Direction m_direction;
-        bool m_inactive_so_far;
-
-        // Private methods
-        void turn() {
-            bool isGlobalTarget = getAttr("target");
-            
-            if (!m_inactive_so_far && !isGlobalTarget) {
-                performAction(false);  // signal off for old direction state
-            } else
-                m_inactive_so_far = false;
-
-            m_direction = rotate_cw(m_direction);
-            init_model();
-            set_on(!is_on());
-            sound_event("fourswitch");
-
-            if (isGlobalTarget) {
-                performAction((server::EnigmaCompatibility < 1.10) ? is_on() : 3 - m_direction);
-            } else {
-                performAction(true);  // signal on for new direction state
-            }
-        }
-
-        void init_model() {
-            switch (m_direction) {
-                case NORTH: set_model("st-fourswitch-n"); break;
-                case EAST:  set_model("st-fourswitch-e"); break;
-                case SOUTH: set_model("st-fourswitch-s"); break;
-                case WEST:  set_model("st-fourswitch-w"); break;
-                case NODIR: ASSERT(0, XLevelRuntime,
-                    "FourSwitch: no direction defined (found in init_model)");
-            }
-        }
-
-        void actor_hit(const StoneContact &/*sc*/) {
-            turn();
-        }
-
-        virtual Value message(const Message &m)
-        {
-            if (m.message == "signal" || m.message == "trigger") {
-                if (server::GameCompatibility == enigma::GAMET_ENIGMA || m.value == 1)
-                    turn();
-                return Value();
-            }
-            return Object::message(m);
-        }
-
-        const char *collision_sound() { return "metal"; }
-    };
-    DEF_TRAITS(FourSwitch, "st-fourswitch", st_fourswitch);
-}
-
-
 /* -------------------- Laser / Time switches -------------------- */
 
 namespace
@@ -691,16 +477,12 @@
 {
     Register (new CoinSlot);
     Register (new FloppyStone);
-    Register (new FourSwitch);
     Register (new KeyStone);
     Register (new KeyStone_a);
     Register (new KeyStone_b);
     Register (new KeyStone_c);
     Register (new LaserSwitch);
     Register (new LaserTimeSwitch);
-    Register (new SwitchStone);
-    Register (new Switch_black);
-    Register (new Switch_white);
     Register (new TimeSwitch);
 }
 

Added: trunk/src/stones/FourSwitch.cc
===================================================================
--- trunk/src/stones/FourSwitch.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/stones/FourSwitch.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -0,0 +1,113 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/FourSwitch.hh"
+#include "main.hh"
+#include "server.hh"
+
+namespace enigma {
+    FourSwitch::FourSwitch() : Stone (), m_inactive_so_far (true) {
+        state = NORTH;
+    }
+    
+    Value FourSwitch::message(const Message &m) {
+        if (m.message == "signal" || m.message == "trigger") {
+            if ((((int)(m.value)) % 2 == 1) || (server::GameCompatibility == enigma::GAMET_ENIGMA
+                    && (server::EnigmaCompatibility < 1.10))) // Enigma 1.00 did turn on 0, too
+                turn();
+            return Value();
+        }
+        return Stone::message(m);
+    }
+    
+    Value FourSwitch::invertActionValue(const Value &val) const {
+        if (val.getType() == Value::DOUBLE) {
+            return 3 - (int)val;     // invert direction for Enigma 1.00 like signal values
+        }
+        return Stone::invertActionValue(val);
+    }
+    
+    int FourSwitch::maxState() {
+        return 3;  // dir representing state
+    }
+    
+    void FourSwitch::toggleState() {
+        turn();
+    }
+    
+    void FourSwitch::setState(int newState) {
+        // just explicit set attribute "state" will set an arbitrary new state
+        turn((state - newState + 4) % 4, true);  // the count is clockwise
+    }
+    
+    void FourSwitch::init_model() {
+        set_model(std::string("st-fourswitch") + to_suffix((Direction)state));
+    }
+    
+    void FourSwitch::actor_hit(const StoneContact &sc) {
+        turn();
+    }
+
+    const char *FourSwitch::collision_sound() {
+         return "metal";
+    }
+    
+    void FourSwitch::turn(int num, bool fixedClockwise) {
+        if (num == 0)   // do not perform actions if not turning at all - may occur on set state
+            return;
+        
+        bool isGlobalTarget = getAttr("target");   // destinguish state dependent target_0,... 
+        
+        if (isDisplayable()) {
+            if (!m_inactive_so_far && !isGlobalTarget) {
+                performAction(false);  // signal off for old direction state on first turn
+            } else
+                m_inactive_so_far = false;
+        }
+
+        bool clockwise = !(getDefaultedAttr("counterclock", false).to_bool());
+        for (int i = 0; i < num; i++)
+            if (clockwise || fixedClockwise)
+                state = rotate_cw((Direction)state);
+            else
+                state = rotate_ccw((Direction)state);
+        
+        if (isDisplayable()) {
+            init_model();
+            sound_event("fourswitch");
+    
+            if (isGlobalTarget) {
+                // state independent callback function on old API with bool true for WEST, EAST
+                // and direction on new API - the direction value suits bolder, oneway orientate 
+                // messages and can be inverted to for old API like signal usage.
+                performAction((server::EnigmaCompatibility < 1.10) ? (state % 2) == 0 : state);
+            } else {
+                performAction(true);  // signal on for new direction state
+            }
+        }
+    }
+    
+    DEF_TRAITS(FourSwitch, "st_fourswitch", st_fourswitch);
+    
+    BOOT_REGISTER_START
+        BootRegister(new FourSwitch(), "st_fourswitch");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/FourSwitch.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/FourSwitch.hh
===================================================================
--- trunk/src/stones/FourSwitch.hh	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/stones/FourSwitch.hh	2008-01-03 15:20:27 UTC (rev 962)
@@ -0,0 +1,86 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef FOURSWITCH_HH
+#define FOURSWITCH_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * A switch that points to one of the four directions turning on every
+     * switching event. It is a StateObject with 4 states that directly
+     * represent the pointing direction. "toggle", "signal", and get/set of
+     * the state are fully supported. The FourSwitch starts per default in
+     * NORTH. The turning direction is clockwise per default and can be set
+     * by the bool attribute "counterclock".<p>
+     * Due to history and as very useful feature this object has two modes
+     * of actions, a state dependent and a "global" state independent mode:
+     * <p>
+     * In the state dependent mode the state dependent target (target_0,...)
+     * of the old state will receive an action value of "false" prior to
+     * the turn. The new state will receive an action value of "true" after
+     * the turn. This suits any connect signal receiver.<p>
+     * But in the global mode just one action is send to the global "target"
+     * with the direction representing value of the new state. This value
+     * suits messages to objects like OneWayStone and BoulderStone. But it
+     * works with signal messages to any StateObject as well, switching them
+     * on and off in turn. To change the meaning of on and off you can set
+     * the "inverse" attribute to "true".<p>
+     * The Fourswitch is turned just on signal values of "1". Use "toggle"
+     * messages to switch indepent of values.<p>
+     * The state can be set anytime to any direction. Actions are performed
+     * accordingly.<p>
+     * Please note that due to compatibility just bool values are send to
+     * global targets in the old API.
+     */
+    class FourSwitch : public Stone {
+        CLONEOBJ(FourSwitch);
+        DECL_TRAITS;
+    public:
+        FourSwitch();
+        
+        // Object interface
+        virtual Value message(const Message &m);
+
+        virtual Value invertActionValue(const Value &val) const;
+        
+        // StateObject interface
+        virtual int maxState();
+        virtual void toggleState();
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+                
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+        virtual const char *collision_sound();
+        
+    private:
+        bool m_inactive_so_far;  // TODO store flag in Object mask
+        
+        void turn(int num = 1, bool fixedClockwise = false);
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/FourSwitch.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/stones/OxydStone.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -875,7 +875,7 @@
             initColors();
             return Value();
         }
-        return Object::message(m);
+        return PhotoStone::message(m);
     }
     
     void OxydStone::set_attrib(const string& key, const Value &val) {
@@ -893,7 +893,7 @@
     
     Value OxydStone::getAttr(const string &key) const {
         // TODO "state" 0=CLOSE || CLOSING; 1 = other iState values
-        return Object::getAttr(key);
+        return PhotoStone::getAttr(key);
     }
     
     void OxydStone::actor_hit(const StoneContact &/*sc*/) {

Added: trunk/src/stones/Switch.cc
===================================================================
--- trunk/src/stones/Switch.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/stones/Switch.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -0,0 +1,111 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2007 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/Switch.hh"
+//#include "main.hh"
+
+namespace enigma {
+    Switch::Switch(Value v) : Stone () {
+        if (v.getType() != Value::NIL)
+            set_attrib("color", v);
+        state = OFF;
+    }
+
+    void Switch::set_attrib(const string& key, const Value &val) {
+        if (isDisplayable())
+            if (key == "color" && state <= ON) {   // recoloring of a switch
+                Stone::set_attrib(key, val);
+                init_model();
+                return;
+            }
+        Stone::set_attrib(key, val);
+    }
+    
+    int Switch::externalState() const {
+        return state % 2;   // 0 for OFF, TURNON, 1 for ON, TURNOFF
+    }
+    
+    void Switch::setState(int extState) {
+        if (isDisplayable()) {
+            if (state <= ON && extState != state) {
+                sound_event ("switchon");
+                state += 2;  // OFF->TURNON, ON->TURNOFF
+                set_anim(ecl::strf("st-switch%s%s", colorName(), extState ? "-turnon" : "-turnoff"));
+            } else if (state == TURNON && extState == OFF) {
+                state = TURNOFF;
+                get_model()->reverse();  // reverse anim
+            } else if (state == TURNOFF && extState == ON) {
+                state = TURNON;
+                get_model()->reverse();  // reverse anim
+            }
+        } else  // object initialisation
+            state = extState;
+    }
+
+    void Switch::init_model() {
+        set_model(ecl::strf("st-switch%s%s", colorName(), state == ON ? "-on" : "-off"));
+    }
+    
+    void Switch::animcb() {
+        state = TURNOFF - state;
+        performAction(state == ON);   // action after state is reached
+        init_model();
+    }
+    
+    void Switch::actor_hit(const StoneContact &sc) {
+        int ic = iColor();
+        if (ic == 0 || (ic == 1 && get_id(sc.actor) == ac_blackball)
+                 || (ic == 2 && get_id (sc.actor) == ac_whiteball))  // TODO why no small whiteballs?
+            setState(ON - state);  // switch on only if OFF, switch off only if ON, otherwise ignore
+    }
+
+    const char *Switch::collision_sound() {
+         return "metal";
+    }
+    
+    int Switch::iColor() const {
+        Value v = getAttr("color");
+        return v ? (int)v + 1 : 0;
+    }
+    
+    const char* Switch::colorName() const {
+        switch (iColor()) {
+            case 1:
+                return "_black";
+            case 2:
+                return "_white";
+            default: ;
+         }
+        return "";
+    }
+    
+    StoneTraits Switch::traits[3] = {
+        {"st_switch", st_switch, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_switch_black", st_switch, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_switch_white", st_switch, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+    };
+    
+    BOOT_REGISTER_START
+        BootRegister(new Switch(Value()), "st_switch");
+        BootRegister(new Switch(Value(0)), "st_switch_black");
+        BootRegister(new Switch(Value(1)), "st_switch_white");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/Switch.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/Switch.hh
===================================================================
--- trunk/src/stones/Switch.hh	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/stones/Switch.hh	2008-01-03 15:20:27 UTC (rev 962)
@@ -0,0 +1,71 @@
+/*
+ * Copyright (C) 2007 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef SWITCH_HH
+#define SWITCH_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * A standard colored 2 state on/off switch that can be toggled only actors
+     * of a compatible color. It is a StateObject with 4 internal states as the
+     * state changes are animated. The external states are mapped. The messages
+     * "toggle", "signal", "on", "off" and get/set of the state are fully supported.
+     * The switch starts per default in state OFF.<p>
+     * Switches can be recolored by setting the "color" attribute. They can
+     * send inverse action values by setting the "inverse" attribute.<p>
+     * Note that the state changes not directly on messages and attribute settings.
+     * The actions will be performed after the turning animation finished. This
+     * is a small derivation from the inconsistent 1.00 behaviour.
+     */
+    class Switch : public Stone {
+        CLONEOBJ(Switch);
+        DECL_TRAITS_ARRAY(3, iColor());
+    private:
+        enum iState { OFF, ON, TURNON, TURNOFF };  // sequence is essential!
+    public:
+        Switch(Value v);
+        
+        // Object interface
+        virtual void set_attrib(const string& key, const Value &val);
+        
+        virtual int externalState() const;
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+        virtual const char *collision_sound();
+        
+    private:
+        int iColor() const;
+        const char* colorName() const;
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/Switch.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/stones/WindowStone.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -85,11 +85,11 @@
         }
     }
     
-    Value WindowStone::message(const string &msg, const Value &val) {
-        if (msg == "inner_pull" ) {
-            return Value(tryInnerPull(to_direction(val)));
+    Value WindowStone::message(const Message &m) {
+        if (m.message == "inner_pull" ) {
+            return Value(tryInnerPull(to_direction(m.value)));
         }
-        return Value();
+        return ConnectiveStone::message(m);
     }
     
     bool WindowStone::tryInnerPull(Direction dir) {

Modified: trunk/src/stones/WindowStone.hh
===================================================================
--- trunk/src/stones/WindowStone.hh	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/stones/WindowStone.hh	2008-01-03 15:20:27 UTC (rev 962)
@@ -57,7 +57,7 @@
         }
         virtual bool is_sticky(const Actor *a) const;
         StoneResponse collision_response(const StoneContact &sc);
-        virtual Value message(const string &msg, const Value &val);
+        virtual Value message(const Message &m);
     private:
         DirectionBits breakingFaces;
         bool tryInnerPull(Direction dir);

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/stones.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -367,7 +367,7 @@
                 performAction(m.value);
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
     private:
         double get_charge() {
@@ -671,7 +671,7 @@
                 ReplaceStone(get_pos(), MakeStone("st-plain_hole"));
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
         void actor_hit (const StoneContact &sc) {
             if (player::WieldedItemIs (sc.actor, "it-pencil")) {
@@ -702,7 +702,7 @@
                 ReplaceStone(get_pos(), MakeStone("st-plain"));
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
 
         StoneResponse collision_response(const StoneContact &) 
@@ -751,7 +751,7 @@
                 break_me();
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
         void actor_hit (const StoneContact &sc) {
             if (player::WieldedItemIs (sc.actor, "it-hammer")) {
@@ -792,7 +792,7 @@
                 break_me();
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
         const char *collision_sound() {return "metal";}
     public:
@@ -834,7 +834,7 @@
                 break_me();
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
         void on_move() {
             Stone::on_move();
@@ -909,7 +909,7 @@
                     }
                 }
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
     public:
         BlackBallsStone() : Stone ("st-blackballs") {
@@ -948,7 +948,7 @@
                     }
                 }
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
 
     public:

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/stones.hh	2008-01-03 15:20:27 UTC (rev 962)
@@ -87,6 +87,7 @@
         st_stoneimpulse_movable,
         st_surprise,
         st_swap,
+        st_switch,
         st_thief,
         st_turnstile,
         st_turnstile_e,

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/stones_complex.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -435,7 +435,7 @@
         init_model();
         return Value();
     }
-    return Object::message(m);
+    return Stone::message(m);
 }
 
 void OneWayBase::actor_hit(const StoneContact &sc) {
@@ -606,7 +606,7 @@
                 init_model();
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
     };
     DEF_TRAITSM(BolderStone, "st-bolder", st_bolder, MOVABLE_IRREGULAR);
@@ -724,7 +724,7 @@
                     change_state(GROWING);
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
 
         void actor_contact(Actor *a) {
@@ -789,7 +789,7 @@
                 }
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
 
         void spread( GridPos p) {
@@ -1334,7 +1334,7 @@
         }
         return Value();
     }
-    return Object::message(m);
+    return ConnectiveStone::message(m);
 }
 
 void PuzzleStone::on_impulse(const Impulse& impulse) 
@@ -1591,7 +1591,7 @@
     } else if (m.message == "signal") {
         newstate = m.value.to_bool() ? OPENING : CLOSING;
     } else {
-        return Object::message(m);
+        return Stone::message(m);
     }
     
     if (newstate==OPENING && (state==CLOSED || state==CLOSING))
@@ -1789,7 +1789,7 @@
                 notify_item();
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
 
         void add_hole(Holes h) {
@@ -1956,7 +1956,7 @@
                 change_state (PULSING);
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
 
         void animcb() {
@@ -2340,7 +2340,7 @@
             rotate(true, 0);
         return Value();
     }
-    return Object::message(m);
+    return Stone::message(m);
 }
 
 
@@ -2946,7 +2946,7 @@
             set_color(1 - (int)getAttr("color"));
             return Value();
         }
-        return Object::message(m);
+        return Stone::message(m);
     }
 
     Value ChessStone::message_move(Direction dir1, Direction dir2) {
@@ -3141,7 +3141,7 @@
                 set_on(state == INACTIVE);
                 return Value();
             }
-            return Object::message(m);
+            return PhotoStone::message(m);
         }
 
         void alarm() {

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/stones_simple.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -147,7 +147,7 @@
                 }
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
 
         const SimpleStoneTraits *traits; // owned by simple_stone_traits
@@ -278,7 +278,7 @@
                 KillStone (get_pos());
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
     public:
         EasyModeStone() 
@@ -554,6 +554,14 @@
                 set_anim(get_break_anim());
             }
         }
+        
+        virtual Value message(const Message &m) {
+            if (m.message =="ignite" || m.message == "expl" || m.message == "bombstone") {
+                break_me();
+                return Value();
+            }
+            return Stone::message(m);
+        }
     private:
         const char *collision_sound() { return "stone"; }
 
@@ -567,13 +575,6 @@
         void animcb() {
             KillStone(get_pos());
         }
-        virtual Value message(const Message &m) {
-            if (m.message =="ignite" || m.message == "expl" || m.message == "bombstone") {
-                break_me();
-                return Value();
-            }
-            return Object::message(m);
-        }
 
         virtual string get_break_anim() const  {
             return string(get_kind())+"-anim";
@@ -667,7 +668,7 @@
                 break_me();
                 return Value();
             }
-            return Object::message(m);
+            return BreakableStone::message(m);
         }
     };
     DEF_TRAITSM(Break_bolder, "st-break_bolder", st_break_bolder, MOVABLE_BREAKABLE);
@@ -1017,7 +1018,7 @@
                 maybe_fall_or_stopfire();
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
 
         // in oxyd1 only fall when moving
@@ -1414,7 +1415,7 @@
         change_state(BREAKING);
         return Value();
     }
-    return Object::message(m);
+    return Stone::message(m);
 }
 
 
@@ -1523,7 +1524,7 @@
         set_anim(string(get_kind()) + "-captured");
         return Value(1);
     }
-    return Object::message(m);
+    return Stone::message(m);
 }
 
 // -------------------------
@@ -1607,7 +1608,7 @@
                     return Value();
                 }
             } // GameCompatibility != GAMET_ENIGMA
-            return Object::message(m);
+            return ActorImpulseBase::message(m);
         }
 
     public:
@@ -1704,7 +1705,7 @@
                 init_model();
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
 
         bool is_floating() const { return true; }
@@ -1849,7 +1850,7 @@
         change_state(BREAK);
         return Value();
     }
-    return Object::message(m);
+    return Stone::message(m);
 }
 
 void BombStone::actor_hit(const StoneContact &sc) 
@@ -1965,7 +1966,7 @@
                 }
                 return Value();
             }
-            Object::message(m);
+            return DeathStone::message(m);
         }
     public:
         DeathStoneInvisible() : visible(false) {}
@@ -2031,7 +2032,7 @@
                 explode();
                 return Value();
             }
-            Object::message(m);
+            return Stone::message(m);
         }
 
         bool is_sticky(const Actor *) const 
@@ -2083,7 +2084,7 @@
                 darken();
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
     };
     class DiscoLight : public DiscoStone {
@@ -2224,7 +2225,7 @@
                 break_me();
                 return Value(1.0);
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
 
         void actor_hit(const StoneContact &sc) {
@@ -2255,7 +2256,7 @@
                 break_me();
                 return Value();
             }
-            return Object::message(m);
+            return Stone::message(m);
         }
 
         void actor_hit(const StoneContact &sc) {

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-01-02 22:00:37 UTC (rev 961)
+++ trunk/src/world.cc	2008-01-03 15:20:27 UTC (rev 962)
@@ -1851,7 +1851,7 @@
     // fourswitch: 4 subsequent AddSignal calls for state specific signals
     if (src->getObjectType() == Object::STONE
             && get_id(dynamic_cast<Stone *>(src)) == st_fourswitch) {
-        for (int i = 0;; i++) {
+        for (int i = NORTH;; i--) {
             if (!src->getAttr(ecl::strf("target_%d", i))) {
                 target_key = ecl::strf("target_%d", i);
                 action_key = ecl::strf("action_%d", i);



From andreasl at mail.berlios.de  Thu Jan  3 22:40:05 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Thu, 3 Jan 2008 22:40:05 +0100
Subject: [Enigma-game-svn] r963 - homepage/input/articles
Message-ID: <200801032140.m03Le5SV018683@sheep.berlios.de>

Author: andreasl
Date: 2008-01-03 22:40:05 +0100 (Thu, 03 Jan 2008)
New Revision: 963

Modified:
   homepage/input/articles/eoya_2007.html
   homepage/input/articles/eoya_2007_de.html
Log:
Homepage:
 - Removed <nobr>-tags from EoYA-articles.


Modified: homepage/input/articles/eoya_2007.html
===================================================================
--- homepage/input/articles/eoya_2007.html	2008-01-03 15:20:27 UTC (rev 962)
+++ homepage/input/articles/eoya_2007.html	2008-01-03 21:40:05 UTC (rev 963)
@@ -111,7 +111,7 @@
 </div>-->
 
 <div class="quote">
-<nobr>For the technically</nobr> interested readers, here is the source file of
+For the technically interested readers, here is the source file of
 this first level:
 
 <pre>(o2-create-world &quot;Test Level&quot; 40 40)
@@ -231,7 +231,7 @@
 outrivaled even the enormously high results of &quot;Little Puzzles &amp; Big
 Adventures&quot; (4.03), and the &quot;Seed Puzzles&quot; (3.70).</p>
 
-<h3><nobr>Best Design 2007: &quot;The Aztec Temple&quot; </nobr>by Dominik
+<h3>Best Design 2007: &quot;The Aztec Temple&quot; by Dominik
 Lehmann</h3>
 
 <p>
@@ -267,7 +267,7 @@
 gravity of the puzzles themselves. He outwitted even &quot;Diving&quot; (3.55)
 and &quot;What's the Problem?&quot; (3.52).</p>
 
-<h3><nobr>Best Yin-Yang Level 2007: &quot;Teamwork&quot; </nobr>by Jacob Scott</h3>
+<h3>Best Yin-Yang Level 2007: &quot;Teamwork&quot; by Jacob Scott</h3>
 
 <p>
   <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_c.png" alt="Teamwork, III/18" border="0">

Modified: homepage/input/articles/eoya_2007_de.html
===================================================================
--- homepage/input/articles/eoya_2007_de.html	2008-01-03 15:20:27 UTC (rev 962)
+++ homepage/input/articles/eoya_2007_de.html	2008-01-03 21:40:05 UTC (rev 963)
@@ -123,7 +123,7 @@
 </div>-->
 
 <div class="quote">
-<nobr>F&uuml;r den technisch interessierten </nobr>Leser ist hier der Quellcode
+F&uuml;r den technisch interessierten Leser ist hier der Quellcode
 dieses ersten Levels:
 
 <pre>(o2-create-world &quot;Test Level&quot; 40 40)
@@ -241,7 +241,7 @@
 Puzzles &amp; Big Adventures&quot; (4,03) und den &quot;Seed Puzzles&quot;
 (3,70).</p>
 
-<h3><nobr>Bestes Design 2007: &quot;The Aztec Temple&quot; </nobr>von Dominik
+<h3>Bestes Design 2007: &quot;The Aztec Temple&quot; von Dominik
 Lehmann</h3>
 
 <p>
@@ -279,7 +279,7 @@
 &quot;Diving&quot; (3,55) und &quot;What's the Problem?&quot; (3,52)
 ausgestochen.</p>
 
-<h3><nobr>Bester Yin-Yang-Level 2007: &quot;Teamwork&quot; </nobr>von Jacob
+<h3>Bester Yin-Yang-Level 2007: &quot;Teamwork&quot; von Jacob
 Scott</h3>
 
 <p>



From ral at mail.berlios.de  Fri Jan  4 11:09:00 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 4 Jan 2008 11:09:00 +0100
Subject: [Enigma-game-svn] r964 - in homepage: images/articles input/articles
Message-ID: <200801041009.m04A909h032275@sheep.berlios.de>

Author: ral
Date: 2008-01-04 11:09:00 +0100 (Fri, 04 Jan 2008)
New Revision: 964

Added:
   homepage/images/articles/longline.png
Modified:
   homepage/input/articles/eoya_2007.html
   homepage/input/articles/eoya_2007_de.html
Log:
Homepage:
- corrected formatting by introduction of an unvisible dummy image

Added: homepage/images/articles/longline.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/articles/longline.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Modified: homepage/input/articles/eoya_2007.html
===================================================================
--- homepage/input/articles/eoya_2007.html	2008-01-03 21:40:05 UTC (rev 963)
+++ homepage/input/articles/eoya_2007.html	2008-01-04 10:09:00 UTC (rev 964)
@@ -231,6 +231,10 @@
 outrivaled even the enormously high results of &quot;Little Puzzles &amp; Big
 Adventures&quot; (4.03), and the &quot;Seed Puzzles&quot; (3.70).</p>
 
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/longline.png" alt="" border="0">
+</p>
+
 <h3>Best Design 2007: &quot;The Aztec Temple&quot; by Dominik
 Lehmann</h3>
 
@@ -267,6 +271,10 @@
 gravity of the puzzles themselves. He outwitted even &quot;Diving&quot; (3.55)
 and &quot;What's the Problem?&quot; (3.52).</p>
 
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/longline.png" alt="" border="0">
+</p>
+
 <h3>Best Yin-Yang Level 2007: &quot;Teamwork&quot; by Jacob Scott</h3>
 
 <p>

Modified: homepage/input/articles/eoya_2007_de.html
===================================================================
--- homepage/input/articles/eoya_2007_de.html	2008-01-03 21:40:05 UTC (rev 963)
+++ homepage/input/articles/eoya_2007_de.html	2008-01-04 10:09:00 UTC (rev 964)
@@ -241,6 +241,10 @@
 Puzzles &amp; Big Adventures&quot; (4,03) und den &quot;Seed Puzzles&quot;
 (3,70).</p>
 
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/longline.png" alt="" border="0">
+</p>
+
 <h3>Bestes Design 2007: &quot;The Aztec Temple&quot; von Dominik
 Lehmann</h3>
 
@@ -279,6 +283,10 @@
 &quot;Diving&quot; (3,55) und &quot;What's the Problem?&quot; (3,52)
 ausgestochen.</p>
 
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/longline.png" alt="" border="0">
+</p>
+
 <h3>Bester Yin-Yang-Level 2007: &quot;Teamwork&quot; von Jacob
 Scott</h3>
 



From ral at mail.berlios.de  Fri Jan  4 18:13:53 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 4 Jan 2008 18:13:53 +0100
Subject: [Enigma-game-svn] r965 - trunk/src/stones
Message-ID: <200801041713.m04HDrX9014060@sheep.berlios.de>

Author: ral
Date: 2008-01-04 18:13:53 +0100 (Fri, 04 Jan 2008)
New Revision: 965

Modified:
   trunk/src/stones/Switch.cc
Log:
Trunk 1.1: 
- fix r962: switches crash on kill within own callback action ("Moure Switches")
Note:
- a temporary fix, as the main problem remains unsolved. Objects like 
  FourSwitch, Boulder, etc. that issue several performAction in sequence
  can not be deleted within a callback function. A reengineering of
  performAction will follow.


Modified: trunk/src/stones/Switch.cc
===================================================================
--- trunk/src/stones/Switch.cc	2008-01-04 10:09:00 UTC (rev 964)
+++ trunk/src/stones/Switch.cc	2008-01-04 17:13:53 UTC (rev 965)
@@ -65,8 +65,8 @@
     
     void Switch::animcb() {
         state = TURNOFF - state;
+        init_model();
         performAction(state == ON);   // action after state is reached
-        init_model();
     }
     
     void Switch::actor_hit(const StoneContact &sc) {



From raoul at mail.berlios.de  Fri Jan  4 18:31:40 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Fri, 4 Jan 2008 18:31:40 +0100
Subject: [Enigma-game-svn] r966 - in homepage/input: . articles
Message-ID: <200801041731.m04HVevs020416@sheep.berlios.de>

Author: raoul
Date: 2008-01-04 18:31:39 +0100 (Fri, 04 Jan 2008)
New Revision: 966

Modified:
   homepage/input/articles/eoya_2007.html
   homepage/input/articles/eoya_2007_de.html
   homepage/input/infobox.html
   homepage/input/infobox_de.html
Log:
-> escaped "..." as "&hellip;"



Modified: homepage/input/articles/eoya_2007.html
===================================================================
--- homepage/input/articles/eoya_2007.html	2008-01-04 17:13:53 UTC (rev 965)
+++ homepage/input/articles/eoya_2007.html	2008-01-04 17:31:39 UTC (rev 966)
@@ -27,7 +27,7 @@
 or ME (6 of 39) than Vista (3 of 39). 3 of 39 gamers use Mac OS
 (&quot;Tiger&quot; 1 vs. &quot;Panther&quot; 2). One gamer uses (in addition to
 Windows) a completely different operating system, and I'm still wondering which
-system this might be ... Finally, 2 of 39 use a dualcore, and 1 uses a gp2x.
+system this might be &hellip; Finally, 2 of 39 use a dualcore, and 1 uses a gp2x.
 The usage rates of 95/98/ME and Panther shows us that we need to speed optimize
 Enigma to keep it running seamlessly even on computers which are a few years
 old, and that we need to continue support for these systems for the upcoming
@@ -147,7 +147,7 @@
 therefore even more impressive!  And it appears unlikely that things
 will change: if the past six years are indicative of the future,
 Enigma aficionados will have to solve at least one level every two
-days just to keep up with the new ones...
+days just to keep up with the new ones&hellip;
 
 </div>
 
@@ -177,7 +177,7 @@
 all-time favourite level created by one of Enigma's master level
 designers.  It's sprawling maze filled with puzzles, suprises and
 dangers, and solving it should definitely be on your list of New
-Year's resolutions, if it isn't already...</div>
+Year's resolutions, if it isn't already&hellip;</div>
 
 
 <div class="quote">
@@ -307,7 +307,7 @@
 7, which confirms Jacob Scott the undisputed title of Level Author of the Year
 2007!</p>
 
-<h3>Coming to the end ...</h3>
+<h3>Coming to the end &hellip;</h3>
 
 <p>This first round of our Level-of-the-Month series now amusingly ends the same
 way it started in March 2007: with &quot;Island Labyrinth&quot;. You may reread

Modified: homepage/input/articles/eoya_2007_de.html
===================================================================
--- homepage/input/articles/eoya_2007_de.html	2008-01-04 17:13:53 UTC (rev 965)
+++ homepage/input/articles/eoya_2007_de.html	2008-01-04 17:31:39 UTC (rev 966)
@@ -28,7 +28,7 @@
 Spieler Windows 95/98 oder ME verwenden (6 von 39) als Vista (3 von 39). 3 von
 39 Spielern nutzen Mac OS (&quot;Tiger&quot; 1 zu &quot;Panther&quot; 2). Ein
 Spieler nutzt (zus&auml;tzlich zu einem Windows) ein komplett anderes
-Betriebssystem, und ich frage mich nach wie vor, welches System das sein mag ...
+Betriebssystem, und ich frage mich nach wie vor, welches System das sein mag &hellip;
 Schlie&szlig;lich benutzen 2 von 39 einen Dualcore und einer nutzt einen gp2x.
 Die Benutzungsquote von 95/98/ME und Panther zeigt uns, dass wir Enigma auf
 Geschwindigkeit optimieren m&uuml;ssen, damit es auch auf Rechnern noch weich
@@ -160,7 +160,7 @@
 unwahrscheinlich, dass sich dies in Zukunft &auml;ndern wird: Wenn die
 vergangenen sechs Jahre auf die Zukunft &uuml;bertragen werden d&uuml;rfen,
 werden Enigmas Fans mindestens alle zwei Tage einen Level l&ouml;sen
-m&uuml;ssen, nur um mit dem Ansturm neuer Levels mitzuhalten ... </div>
+m&uuml;ssen, nur um mit dem Ansturm neuer Levels mitzuhalten &hellip; </div>
 
 
 <div class="quote">
@@ -188,7 +188,7 @@
 Enigmas Meisterleveldesignern geschrieben wurde. Sein sich lang erstreckender
 Irrgarten, angef&uuml;llt mit R&auml;tseln, &Uuml;berraschungen und Gefahren,
 und ihn zu l&ouml;sen, sollen definit auf Ihrer Liste guter Vors&auml;tze
-f&uuml;r das neue Jahr stehen, wenn er das noch nicht ist ... </div>
+f&uuml;r das neue Jahr stehen, wenn er das noch nicht ist &hellip; </div>
 
 <div class="quote">
 Der Preis zum &quot;Level des Jahres&quot; ist der erste seiner Art, und ich
@@ -321,7 +321,7 @@
 die Wertung auf, was Jacob Scott als unbestrittenden Levelautor des Jahres 2007
 best&auml;tigt!</p>
 
-<h3>Wir kommen zum Ende ...</h3>
+<h3>Wir kommen zum Ende &hellip;</h3>
 
 <p>Diese erste Runde unserer Level-des-Monats-Serie endet nun
 am&uuml;santerweise, wie sie im M&auml;rz 2007 begonnen hat: mit &quot;Island

Modified: homepage/input/infobox.html
===================================================================
--- homepage/input/infobox.html	2008-01-04 17:13:53 UTC (rev 965)
+++ homepage/input/infobox.html	2008-01-04 17:31:39 UTC (rev 966)
@@ -3,7 +3,7 @@
          <h3>Happy IV/2!</h3>
          The Enigma Team wishes everyone a Happy New Year!
          Let's hope for many new levels in 2008&mdash;some are
-         already in the starting blocks&hellip;
+         already in the starting blocks &hellip;
          <!--<h3>Level of the Month</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>

Modified: homepage/input/infobox_de.html
===================================================================
--- homepage/input/infobox_de.html	2008-01-04 17:13:53 UTC (rev 965)
+++ homepage/input/infobox_de.html	2008-01-04 17:31:39 UTC (rev 966)
@@ -3,7 +3,7 @@
          <h3>Frohes IV/2!</h3>
          Das Enigma-Team w&uuml;nscht allen ein frohes neues Jahr!
          Lasst uns auf viele neue Levels in 2008 hoffen - einige
-         stehen bereits in den Startbl&ouml;cken&hellip;
+         stehen bereits in den Startbl&ouml;cken &hellip;
          <!--<h3>Level des Monats</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>



From dheck at mail.berlios.de  Sat Jan  5 00:22:10 2008
From: dheck at mail.berlios.de (dheck at BerliOS)
Date: Sat, 5 Jan 2008 00:22:10 +0100
Subject: [Enigma-game-svn] r967 - trunk/src
Message-ID: <200801042322.m04NMAE6030417@sheep.berlios.de>

Author: dheck
Date: 2008-01-05 00:22:09 +0100 (Sat, 05 Jan 2008)
New Revision: 967

Modified:
   trunk/src/oxyd.cc
Log:
cleanup

Modified: trunk/src/oxyd.cc
===================================================================
--- trunk/src/oxyd.cc	2008-01-04 17:31:39 UTC (rev 966)
+++ trunk/src/oxyd.cc	2008-01-04 23:22:09 UTC (rev 967)
@@ -41,15 +41,9 @@
 
 using namespace std;
 using namespace enigma;
-using enigma::Stone;
-using enigma::MakeStone;
-//using enigma::Item;
-using enigma::MakeItem;
-
 using namespace oxyd;
 using OxydLib::Level;
 
-
 /* -------------------- Helper functions -------------------- */
 
 namespace 
@@ -167,10 +161,8 @@
         }
         return false;
     }
-
 }
 
-
 /* -------------------- CommandString implementation -------------------- */
 
 CommandString::CommandString(const string &cmd) 



From dheck at mail.berlios.de  Sat Jan  5 02:04:46 2008
From: dheck at mail.berlios.de (dheck at BerliOS)
Date: Sat, 5 Jan 2008 02:04:46 +0100
Subject: [Enigma-game-svn] r968 - in trunk: . data data/fonts data/gfx
 data/gfx32 data/gfx40 data/gfx48 data/gfx64 data/levels
 data/levels/enigma_cross data/levels/enigma_esprit
 data/levels/enigma_experimental data/levels/enigma_i data/levels/enigma_ii
 data/levels/enigma_iii data/levels/enigma_iv
 data/levels/enigma_mas_microban data/levels/enigma_microban
 data/levels/enigma_oxyd data/levels/enigma_oxydextra
 data/levels/enigma_oxydmagnum data/levels/enigma_peroxyd
 data/levels/enigma_sokoban data/levels/enigma_stable
 data/levels/enigma_tutorial data/levels/enigma_v data/levels/enigma_vi
 data/levels/enigma_vii data/levels/lib data/levels/patches data/schemas
 data/sound data/soundsets data/soundsets/enigma data/thumbs doc doc/images
 doc/images/flags25x15 doc/manual doc/manual/images doc/reference
 doc/reference/images etc intl lib-src lib-src/enet lib-src/enet/include
 lib-src/enet/include/enet lib-src/enigma-core lib-src/lua lib-src/oxydlib
 lib-src/zipios++ lib-src/zipios++/src lib-src/zipios++/zi! pios++ m4 po src
 tools
Message-ID: <200801050104.m0514k4S025980@sheep.berlios.de>

Author: dheck
Date: 2008-01-05 02:04:44 +0100 (Sat, 05 Jan 2008)
New Revision: 968

Added:
   trunk/.gitignore
   trunk/data/.gitignore
   trunk/data/fonts/.gitignore
   trunk/data/gfx/.gitignore
   trunk/data/gfx32/.gitignore
   trunk/data/gfx40/.gitignore
   trunk/data/gfx48/.gitignore
   trunk/data/gfx64/.gitignore
   trunk/data/levels/.gitignore
   trunk/data/levels/enigma_cross/.gitignore
   trunk/data/levels/enigma_esprit/.gitignore
   trunk/data/levels/enigma_experimental/.gitignore
   trunk/data/levels/enigma_i/.gitignore
   trunk/data/levels/enigma_ii/.gitignore
   trunk/data/levels/enigma_iii/.gitignore
   trunk/data/levels/enigma_iv/.gitignore
   trunk/data/levels/enigma_mas_microban/.gitignore
   trunk/data/levels/enigma_microban/.gitignore
   trunk/data/levels/enigma_oxyd/.gitignore
   trunk/data/levels/enigma_oxydextra/.gitignore
   trunk/data/levels/enigma_oxydmagnum/.gitignore
   trunk/data/levels/enigma_peroxyd/.gitignore
   trunk/data/levels/enigma_sokoban/.gitignore
   trunk/data/levels/enigma_stable/.gitignore
   trunk/data/levels/enigma_tutorial/.gitignore
   trunk/data/levels/enigma_v/.gitignore
   trunk/data/levels/enigma_vi/.gitignore
   trunk/data/levels/enigma_vii/.gitignore
   trunk/data/levels/lib/.gitignore
   trunk/data/levels/patches/.gitignore
   trunk/data/schemas/.gitignore
   trunk/data/sound/.gitignore
   trunk/data/soundsets/.gitignore
   trunk/data/soundsets/enigma/.gitignore
   trunk/data/thumbs/.gitignore
   trunk/doc/.gitignore
   trunk/doc/images/.gitignore
   trunk/doc/images/flags25x15/.gitignore
   trunk/doc/manual/.gitignore
   trunk/doc/manual/images/.gitignore
   trunk/doc/reference/.gitignore
   trunk/doc/reference/images/.gitignore
   trunk/etc/.gitignore
   trunk/intl/.gitignore
   trunk/lib-src/.gitignore
   trunk/lib-src/enet/.gitignore
   trunk/lib-src/enet/include/.gitignore
   trunk/lib-src/enet/include/enet/.gitignore
   trunk/lib-src/enigma-core/.gitignore
   trunk/lib-src/lua/.gitignore
   trunk/lib-src/oxydlib/.gitignore
   trunk/lib-src/zipios++/.gitignore
   trunk/lib-src/zipios++/src/.gitignore
   trunk/lib-src/zipios++/zipios++/.gitignore
   trunk/m4/.gitignore
   trunk/po/.gitignore
   trunk/src/.gitignore
   trunk/tools/.gitignore
Log:
Added .gitignore files to make git happy

(Okay, so I'm experimenting with yet another version control system,
but having the full history in merely 28MB plus seamless SVN integration
via git-svn is even more irresistable than I thought... :-)

Added: trunk/.gitignore
===================================================================
--- trunk/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,13 @@
+/+build
+/Makefile
+/Makefile.in
+/aclocal.m4
+/autom4te.cache
+/config.guess
+/config.log
+/config.status
+/config.sub
+/configure
+/depcomp
+/install-sh
+/missing

Added: trunk/data/.gitignore
===================================================================
--- trunk/data/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/fonts/.gitignore
===================================================================
--- trunk/data/fonts/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/fonts/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/gfx/.gitignore
===================================================================
--- trunk/data/gfx/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/gfx/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/gfx32/.gitignore
===================================================================
--- trunk/data/gfx32/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/gfx32/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/gfx40/.gitignore
===================================================================
--- trunk/data/gfx40/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/gfx40/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/gfx48/.gitignore
===================================================================
--- trunk/data/gfx48/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/gfx48/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/gfx64/.gitignore
===================================================================
--- trunk/data/gfx64/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/gfx64/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/.gitignore
===================================================================
--- trunk/data/levels/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/levels/enigma_cross/.gitignore
===================================================================
--- trunk/data/levels/enigma_cross/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_cross/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/levels/enigma_esprit/.gitignore
===================================================================
--- trunk/data/levels/enigma_esprit/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_esprit/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_experimental/.gitignore
===================================================================
--- trunk/data/levels/enigma_experimental/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_experimental/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_i/.gitignore
===================================================================
--- trunk/data/levels/enigma_i/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_i/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_ii/.gitignore
===================================================================
--- trunk/data/levels/enigma_ii/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_ii/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_iii/.gitignore
===================================================================
--- trunk/data/levels/enigma_iii/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_iii/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_iv/.gitignore
===================================================================
--- trunk/data/levels/enigma_iv/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_iv/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_mas_microban/.gitignore
===================================================================
--- trunk/data/levels/enigma_mas_microban/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_mas_microban/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_microban/.gitignore
===================================================================
--- trunk/data/levels/enigma_microban/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_microban/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_oxyd/.gitignore
===================================================================
--- trunk/data/levels/enigma_oxyd/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_oxyd/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_oxydextra/.gitignore
===================================================================
--- trunk/data/levels/enigma_oxydextra/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_oxydextra/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_oxydmagnum/.gitignore
===================================================================
--- trunk/data/levels/enigma_oxydmagnum/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_oxydmagnum/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_peroxyd/.gitignore
===================================================================
--- trunk/data/levels/enigma_peroxyd/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_peroxyd/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_sokoban/.gitignore
===================================================================
--- trunk/data/levels/enigma_sokoban/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_sokoban/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_stable/.gitignore
===================================================================
--- trunk/data/levels/enigma_stable/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_stable/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_tutorial/.gitignore
===================================================================
--- trunk/data/levels/enigma_tutorial/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_tutorial/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_v/.gitignore
===================================================================
--- trunk/data/levels/enigma_v/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_v/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_vi/.gitignore
===================================================================
--- trunk/data/levels/enigma_vi/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_vi/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_vii/.gitignore
===================================================================
--- trunk/data/levels/enigma_vii/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/enigma_vii/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/lib/.gitignore
===================================================================
--- trunk/data/levels/lib/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/lib/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/patches/.gitignore
===================================================================
--- trunk/data/levels/patches/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/levels/patches/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/schemas/.gitignore
===================================================================
--- trunk/data/schemas/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/schemas/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/sound/.gitignore
===================================================================
--- trunk/data/sound/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/sound/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/soundsets/.gitignore
===================================================================
--- trunk/data/soundsets/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/soundsets/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/soundsets/enigma/.gitignore
===================================================================
--- trunk/data/soundsets/enigma/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/soundsets/enigma/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/data/thumbs/.gitignore
===================================================================
--- trunk/data/thumbs/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/data/thumbs/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/doc/.gitignore
===================================================================
--- trunk/doc/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/doc/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/doc/images/.gitignore
===================================================================
--- trunk/doc/images/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/doc/images/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/doc/images/flags25x15/.gitignore
===================================================================
--- trunk/doc/images/flags25x15/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/doc/images/flags25x15/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/doc/manual/.gitignore
===================================================================
--- trunk/doc/manual/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/doc/manual/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,13 @@
+/Makefile
+/Makefile.in
+/*.html
+/*.aux
+/*.cp
+/*.vr
+/*.ky
+/*.tp
+/*.log
+/*.fn
+/*.pdf
+/*.pg
+/*.toc

Added: trunk/doc/manual/images/.gitignore
===================================================================
--- trunk/doc/manual/images/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/doc/manual/images/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,3 @@
+/Makefile
+/Makefile.in
+/*.pdf

Added: trunk/doc/reference/.gitignore
===================================================================
--- trunk/doc/reference/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/doc/reference/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,16 @@
+/Makefile
+/Makefile.in
+/*.html
+/*.aux
+/*.cp
+/*.vr
+/*.ky
+/*.tp
+/*.log
+/*.fn
+/*.pdf
+/*.vrs
+/*.cps
+/*.toc
+/*.fns
+/*.pg

Added: trunk/doc/reference/images/.gitignore
===================================================================
--- trunk/doc/reference/images/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/doc/reference/images/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,3 @@
+/Makefile
+/Makefile.in
+/*.pdf

Added: trunk/etc/.gitignore
===================================================================
--- trunk/etc/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/etc/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,8 @@
+/Makefile
+/Makefile.in
+/enigma.nsi
+/enigma.spec
+/mingw32-dist.sh
+/*.dll
+/Enigma-w32-*.zip
+/Info.plist

Added: trunk/intl/.gitignore
===================================================================
--- trunk/intl/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/intl/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,7 @@
+/Makefile
+/libgnuintl.h
+/libintl.a
+/libintl.h
+/ref-del.sed
+/ref-add.sed
+/charset.alias

Added: trunk/lib-src/.gitignore
===================================================================
--- trunk/lib-src/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/lib-src/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/lib-src/enet/.gitignore
===================================================================
--- trunk/lib-src/enet/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/lib-src/enet/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,12 @@
+/Makefile
+/Makefile.in
+/aclocal.m4
+/autom4te.cache
+/config.log
+/config.status
+/configure
+/depcomp
+/libenet.a
+/missing
+/install-sh
+/.deps

Added: trunk/lib-src/enet/include/.gitignore
===================================================================
--- trunk/lib-src/enet/include/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/lib-src/enet/include/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/lib-src/enet/include/enet/.gitignore
===================================================================
--- trunk/lib-src/enet/include/enet/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/lib-src/enet/include/enet/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/lib-src/enigma-core/.gitignore
===================================================================
--- trunk/lib-src/enigma-core/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/lib-src/enigma-core/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,4 @@
+/Makefile
+/Makefile.in
+/.deps
+/libecl.a

Added: trunk/lib-src/lua/.gitignore
===================================================================
--- trunk/lib-src/lua/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/lib-src/lua/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,4 @@
+/Makefile
+/Makefile.in
+/.deps
+/liblua.a

Added: trunk/lib-src/oxydlib/.gitignore
===================================================================
--- trunk/lib-src/oxydlib/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/lib-src/oxydlib/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,12 @@
+/Makefile
+/Makefile.in
+/.deps
+/liboxyd.a
+/extractchunks
+/extractchunks.exe
+/extractbitmaps
+/extractbitmaps.exe
+/printlevels
+/printlevels.exe
+/printstats
+/printstats.exe

Added: trunk/lib-src/zipios++/.gitignore
===================================================================
--- trunk/lib-src/zipios++/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/lib-src/zipios++/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,11 @@
+/Makefile
+/Makefile.in
+/aclocal.m4
+/autom4te.cache
+/config.log
+/config.status
+/configure
+/depcomp
+/install-sh
+/missing
+/mkinstalldirs

Added: trunk/lib-src/zipios++/src/.gitignore
===================================================================
--- trunk/lib-src/zipios++/src/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/lib-src/zipios++/src/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,4 @@
+/Makefile
+/Makefile.in
+/.deps
+/libzipios.a

Added: trunk/lib-src/zipios++/zipios++/.gitignore
===================================================================
--- trunk/lib-src/zipios++/zipios++/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/lib-src/zipios++/zipios++/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,5 @@
+/Makefile
+/Makefile.in
+/stamp-h1
+/zipios-config.h
+/zipios-config.h.in

Added: trunk/m4/.gitignore
===================================================================
--- trunk/m4/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/m4/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,2 @@
+/Makefile
+/Makefile.in

Added: trunk/po/.gitignore
===================================================================
--- trunk/po/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/po/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,7 @@
+/*.gmo
+/Makefile
+/Makefile.in
+/POTFILES
+/remove-potcdate.sed
+/stamp-po
+/level_i18n.cc

Added: trunk/src/.gitignore
===================================================================
--- trunk/src/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/src/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,10 @@
+/Makefile
+/Makefile.in
+/config.h
+/enigma
+/enigma.exe
+/stamp-h1
+/config.h.in
+/.deps
+/doc
+/doc_full

Added: trunk/tools/.gitignore
===================================================================
--- trunk/tools/.gitignore	2008-01-04 23:22:09 UTC (rev 967)
+++ trunk/tools/.gitignore	2008-01-05 01:04:44 UTC (rev 968)
@@ -0,0 +1,7 @@
+/Makefile
+/Makefile.in
+/.deps
+/tolua
+/tolua.exe
+/ttf2bmf
+/ttf2bmf.exe



From dheck at mail.berlios.de  Sat Jan  5 02:04:59 2008
From: dheck at mail.berlios.de (dheck at BerliOS)
Date: Sat, 5 Jan 2008 02:04:59 +0100
Subject: [Enigma-game-svn] r969 - trunk/src
Message-ID: <200801050104.m0514xLX026052@sheep.berlios.de>

Author: dheck
Date: 2008-01-05 02:04:59 +0100 (Sat, 05 Jan 2008)
New Revision: 969

Modified:
   trunk/src/sound.cc
   trunk/src/sound_internal.hh
Log:
Implemented sound preloading

- this adds SoundEngine::cache_sound() as a new virtual function that must
be implemented in every subclass that wants to provide preloading
- removed unused define_sound() variant
- the current implementation is a little brittle because it relies on the
naming conventions established by eventKey(); somewhat surprisingly,
SoundSets do not contain a list of sound effects...

Modified: trunk/src/sound.cc
===================================================================
--- trunk/src/sound.cc	2008-01-05 01:04:44 UTC (rev 968)
+++ trunk/src/sound.cc	2008-01-05 01:04:59 UTC (rev 969)
@@ -274,6 +274,13 @@
         return i->second;
 }
 
+void SoundEngine_SDL::cache_sound(const SoundEffect &s) 
+{
+    string filename = s.getFilename();
+    if (filename != "")
+        cache_sound(filename);
+}
+
 bool SoundEngine_SDL::play_sound (const SoundEvent &s)
 {
     int channel = already_playing (s);
@@ -317,14 +324,7 @@
     }
 }
 
-
 void SoundEngine_SDL::define_sound (
-    const SoundName &/*name*/,
-    const std::string &/*filename*/)
-{
-}
-
-void SoundEngine_SDL::define_sound (
     const SoundName &name, 
     const SoundData &data)
 {
@@ -534,7 +534,7 @@
 
         float srcinc = float (len-1) / float (newlen); 
         for (unsigned i=0; i<newlen; ++i) {
-            int srcidx = ecl::round_down <int> (i * srcinc); // srcpos);
+            int srcidx = ecl::round_down <int> (i * srcinc);
             float a2 = i*srcinc - srcidx;
             float a1 = 1.0f - a2;
             dst[i] = static_cast<Sint8> ((a1*src[srcidx] + a2*src[srcidx+1])/2);
@@ -634,7 +634,8 @@
 
 /*! These functions fill in data for the sound sets, initialises and
   activates them. Return false, if something went wrong, e.g. when an
-  oxyd sound set is mentioned to not accessible oxyd version. */
+  oxyd sound set is mentioned, but the corresponding oxyd version
+  wasn't found. */
 
 bool SoundEngine::defineSoundSet(string soundset_name, string soundset_key,
                                  int button_position)
@@ -666,6 +667,7 @@
         return false;
     if(isOxyd() &&  !oxyd::InitOxydSoundSet(getOxydVersion()))
         return false;
+
     sound_engine->setActiveSoundSetKey(getSoundSetKey());
     return true;
 }
@@ -713,8 +715,10 @@
     if (soundset_name == "Default")
         soundset_name = getDefaultSoundSet();
     clear_cache();
-    if (sound_sets[soundset_name].activate()) 
+    if (sound_sets[soundset_name].activate())  {
+        preloadSoundEffects();
         Log << "Activated sound set '" << soundset_name << "'.\n";
+    }
     else {
         // Fallback, happens e.g. when oxyd sound set can't be established or 
         // a user soundset is given which doesn't exist anymore.
@@ -743,6 +747,7 @@
     }
     clear_cache();
     if (sound_sets[soundset_name].activate()) {
+        preloadSoundEffects();
         Log << "Switched to sound set '" << soundset_name << "' (key '" 
             << soundset_key << "').\n";
     } else
@@ -750,6 +755,19 @@
             << soundset_key << "').\n";
 }
 
+/*! Pre-cache all sound effects so that they can be played without lag
+  when the game is running. */
+void SoundEngine::preloadSoundEffects()
+{
+    SoundEffectRepository::iterator i = sound_effects.begin(), 
+        end = sound_effects.end();
+    string prefix = getActiveSoundSetKey() + "#";
+    for (; i != end; ++i) {
+        if (i->first.compare(0, prefix.size(), prefix) == 0)
+            cache_sound(i->second);
+    }
+}
+
 void sound::SetActiveSoundSet(string soundset_name)
 {
     sound_engine->setActiveSoundSet(soundset_name);
@@ -816,7 +834,7 @@
             << pos[0] << "," << pos[1] << "\n";
         return false;
     } else {
-        return (*i).second.play(pos, volume, force_global);
+        return i->second.play(pos, volume, force_global);
     }
 }
 

Modified: trunk/src/sound_internal.hh
===================================================================
--- trunk/src/sound_internal.hh	2008-01-05 01:04:44 UTC (rev 968)
+++ trunk/src/sound_internal.hh	2008-01-05 01:04:59 UTC (rev 969)
@@ -53,6 +53,7 @@
         }
 
         void setFilename(string filename_) { filename = filename_; }
+        string getFilename() const { return filename; }
         bool play(const ecl::V2 &pos = ecl::V2(), double vol = 1.0, bool glob = false);
         DampingData getDampingData() { return damp; }
         string getSoundSetKey() { return soundset_key; }
@@ -124,9 +125,9 @@
         // ---------- Sound effects ----------
 
         virtual void clear_cache() = 0;
-        virtual void define_sound (const SoundName &, const std::string &filename)=0;
         virtual void define_sound (const SoundName &, const SoundData &)=0;
         virtual bool play_sound (const SoundEvent &s) = 0;
+        virtual void cache_sound(const SoundEffect &s) = 0;
         virtual void set_listenerpos (ecl::V2 pos) = 0;
         virtual void tick (double dtime) {}
 
@@ -150,9 +151,13 @@
         bool defineSoundSetOxyd(string soundset_name, string soundset_key,
                                 OxydLib::OxydVersion oxyd_ver, int button_position);
         string getOxydSoundSet(OxydLib::OxydVersion oxyd_ver);
+
         int convertToOldSoundSetNumber(string soundset_name);
         string convertFromOldSoundSetNumber(int soundset_number);
+
         void setActiveSoundSet(string soundset_name);
+        void preloadSoundEffects();
+
         void setSoundSetCount(int count) { sound_set_count = count; }
         int getSoundSetCount() { return sound_set_count; }
         int getButtonPosition(string soundset_name) {
@@ -181,8 +186,9 @@
         bool play_music (const std::string &/*filename*/) { return false; }
         void stop_music() {}
         void fadeout_music() {}
+
         bool play_sound (const SoundEvent &) {}
-        void define_sound (const SoundName &, const std::string &/*filename*/) {}
+        void cache_sound(const SoundEffect &s) {}
         void define_sound (const SoundName &, const SoundData &) {}
         void set_listenerpos (ecl::V2 pos) {}
     };
@@ -205,11 +211,10 @@
         void fadeout_music();
 
         bool play_sound(const SoundEvent &s);
+        void cache_sound(const SoundEffect &s);
         void clear_cache();
-        void define_sound (const SoundName &, const std::string &filename);
         void define_sound (const SoundName &, const SoundData &);
 
-
         void set_listenerpos (ecl::V2 pos) { m_listenerpos = pos; }
         void tick (double dtime);
     private:



From ged at mail.berlios.de  Sat Jan  5 10:34:52 2008
From: ged at mail.berlios.de (ged at mail.berlios.de)
Date: Sat, 5 Jan 2008 10:34:52 +0100
Subject: [Enigma-game-svn] r970 - homepage/input/articles
Message-ID: <200801050934.m059Yqwx003816@sheep.berlios.de>

Author: ged
Date: 2008-01-05 10:34:50 +0100 (Sat, 05 Jan 2008)
New Revision: 970

Added:
   homepage/input/articles/eoya_2007_ru.html
Log:
Homepage: added Russian translation of EoYA, modified infobox

Added: homepage/input/articles/eoya_2007_ru.html
===================================================================
--- homepage/input/articles/eoya_2007_ru.html	2008-01-05 01:04:59 UTC (rev 969)
+++ homepage/input/articles/eoya_2007_ru.html	2008-01-05 09:34:50 UTC (rev 970)
@@ -0,0 +1,242 @@
+<div class="lotm">
+<h2>??????? ????? ???? 2007</h2>
+
+<p>?? ?????????? ?????????? ?????? ?? ??????? ????? ????????? ????????? ????????????? ?? ?????? ?? ???????????? ??????? Enigma, ? ???? ??????????, ? ???????? ?? ????????? ????? ????????. ??????? ??????? ???? ???, ??? ?????? ????? (? ??? ? ????? ??? ??????? ?????) ? ??? ??? ????????? ??????. ?????? ??????, ??????????? ?????????? ?????? ??????, ?????? ?? ?????????? ?????????? ????? ??????.</p>
+
+<h3>?????????? ????? ????????</h3>
+
+<p>????? ???????? ???????, ?? ?????? ? ????? ????? ??????????: ????? ?? ???????????????? 741 ????; 73
+???????????? ? ?????? 40 ??????? ?? ??????, ??? ???? ??? ????? ????????? ????, ??? ?????? ???? ???????????????? ??????. ? ???? ?????? ???????? ???? ?????????? ??????? ???????? ??????? ??????.</p>
+
+<p>??????????? ????? (42%) ?????????????? ? Enigma ? ?????? 0.8x. ? ?????, ??? ? ??? ????? ?? ???, ? ????? Enigma ? ????????? ? SuSE, ??????? ? ???? ? ?????????, ??? ??? ??? ???? Enigma 0.92.
+
+</p>
+
+<p>?????????? ??????????? (69%) ???? ??????? ?????????? Windows 2000 ??? XP, ????? ?????? ? ?????-???? Linux. ????? ?????????? ?????? Linux - Debian ? Ubuntu. ?????? ???????????? ???? ??????? ? ???, ??? ? ??? ???? ?????? ??????? ?????????? Windows 95/98 ??? ME (6 ?? 39), ? ?? Vista (3 ?? 39). 3 ?? 39 ??????? ?????????? Mac OS (&quot;Tiger&quot; 1 vs. &quot;Panther&quot; 2). ???? ????? ?????????? (?????? ? Windows) ????????? ?????? ???????????? ???????, ? ? ??? ??? ?????, ??? ??? ????? ???? ?? ??????? ... ???????, 2 ?? 39 ?????????? dualcore, ? 1 ?????????? gp2x.
+?????????? ????????????? 95/98/ME ? Panther ???? ??? ??????, ??? ??? ????? ?????????????? ???????? Enigma, ????? ??? ?????????? ????????? ???????? ???? ?? ???????????, ??????? ??? ????????? ???, ? ??????? ??? ????? ????????? ????????? ??? ???? ?????? ? ????????? ????????.</p>
+
+<p>????? ??????? ?????????? ?????? ?? ?????? ? ????????? ???????. ?? ???????? 37 ??????? ?? ???? ?????? ? ????? ???????? (16) ????????, ??? ?? ?????????? ??? ? ???????. ??????, 9 ???????, ??? ?????? ?????? ???? ?????, ? ?? ?????, ??? 3 ?????? ????? ?? ??? ?????? ?????????. ?????? ? ???????? ????????? ??????????? ????? ??????? - 8 ?????, ????? ??????? ??? ??????, 6 ???????, ??? ?? ?????? ???? ??????.  </p>
+
+<p>????? ?? ?????? ??????? ???? ??????? ? ????? ?????????? ?????? ? ?????????? ????????: ??????????? (????? 50%) ???????????? ?????????, ?????? ?????????? ??????-??????????? ? ??????, ? ??????? ???? ????? ?????????? ? ??????? ???????. 38% ???????? ??????? ??????-???????????, ? ?????? ??????????? ? 14% ???????? ?? ??????? ?????? ??????? ?? ???????? ??? ??????? ? ????????, ???????? ?????????????. 32% ?????? ?? ??????? ?????? ??????? &quot;?????? ?????&quot; ?, ? ?????????, ? ?? ???????????, ??? ??? ????? ???? ?? ????. ???? ?????? (? ????????? ?????????) ????? ?????????, ???? ?? ? ??????????, ??? &quot;??????? ??????&quot; ?? ??????????? ????? ??????????   
+???????, ??? ?????? ??????? ????? ???????? ????????? ?? ??????? ???? ??????? - ?? ??? ?????????? ????? ?????????? ????????? ???????????. </p>
+
+<p>??????????? ??????? (????? 76%) ??????? ???????? ?????? ?? ??????? ???? ???????? ???? ???????. ? ?? ?? ?????, ?????? ?????? ?????? ?? ??? ???????? ?????? ??? ?? ???, ???????? ?? ???! ??? ????? ?????? ??????? ??? ???, ????????? ??? ????? ?????? ????????? ???????? PAR ? ????? ?????? ??????.</p>
+
+<p>??? ?? ????? ???????? ?????? mag-heut.net ??? ?????????? Enigma. ??? ???????? ? ??????? ?? ????????? ??? ?????? ? ???????? ????????? ?????????? ??????????: ?? ????? ?????? ?? 1 ?? 5, ????? ??????? ? ??????? 4.097, ?? ??? ??????? ???????? ???????? ? ??????????? 4.059. ? ?????? ?????????? ???????? ??????????? ??????: ?????? ???????? ????????????? (2.86), ?????? ????????? (2.75), ?????? (2.4), ??????????? ? ??????? ????? ?????? (2.14) ? ?????? oxyd ? yahoo (1.58). ??? ??????????? ???? ?????????????.
+</p>
+
+<p>?? ????? ?????????????? ????? ??????? ? ?????????? ???????? Enigma ? ????????? ??? ??????? ????????? ???. ??????? ?????????? ?????????? ???????? ??????, ? ????????? ?????? ??? 9 ?? 34 ??????? ?? ???????? ? ???? ?????? ?? ???? ????? - ??, ???? ???????? ?????????, ?????????? ????????? ? ???????? ?????????? ????? ???????, ?????? ???? ???????? ???????, ????? ??????? (?????????, ??? ?????? ?????? ????? ?????? ?????? ??????? ??? ???????????? ????? ???????? ? ????????????) ? ??????????? ??????. ??????? ????????? ? ???????? ??????, ????????????? ?????????? (??????? ??) ? ??????? ?????????? ??? ????????????. ?????? ?????? ????????? ??????? ? ????? ??????? ? ??????, ???????? ? ???????????? Enigma ?? ?????? ?????????. ???????, ?????? ?????????? ??? ??? ??????????, ?????? ??? ????? ??????? - ??????, ? ?????? ??? ?????? ???????? ???????????, ???? ??? ?????? ? ?? ????? ?? ??????? ??????? ?? ???? ????????? ?????.</p>
+
+<p>????? ?? ???????? ?????, ?????????? ???????????, ??????? ??? ???? ?? ???! :-)</p>
+
+<h3>&quot;??? ????????????? ??????, ????????? ????, ? ?? ??? ?? ?? ???????&quot;</h3>
+
+<p>????????? ??????????? - ??????:</p>
+
+<div class="quote">
+Enigma 0.22 ???? ???????? 30 ??????? 2001 ????: ??? ??? ????????? ????
+??????????????? ??????, ??????? ? ?????? ??????????? ?? ??? ?????? ?? 
+??????? ?????????? ??????? ??? ??????????? ??????. ???????? ??????? ?? ??????? Enigma 0.22
+??????? ?? ????? ?? ??????? ????? ???????? ????? ? ???, ??? ??? ???? ??? ?? ??????????: ?
+??? ?? ????? ???? ???????????????? ??????? ?????????? ?????? ? ??? ?????????????? ? 
+??????? ???????? ?????????. ?? ??????? ??? ????????? ??????? ???????? ????? ????????, ???? ? ????? 
+??? ?????????????? (? ?? ??????? ?????????? ? ??? ???), ? ??? ??? ???????????? ``???????'', ????????? ????
+??? ????????????. ????, ??? ?? - <b>??????? ???? 2001</b>:
+
+</div>
+
+
+<div class="lotmpic">
+  <img src="$$imagedir$$/articles/eoya_2007_a.png" alt="??????? ???? 2001" border="0">
+  <div class="imagetitle">
+??????? ???? 2001</div>
+</div>
+
+<div class="quote">
+<nobr>??? ?????????, ?????????????? ??????????? ????????, ??? ???????? ???? ????? ??????? ??????:</nobr>
+
+<pre>(o2-create-world &quot;Test Level&quot; 40 40)
+
+(draw-stones &quot;st-brownie&quot; 5 5  1 1  5)
+(draw-stones &quot;st-brownie&quot; 11 11  1 -1  5)
+(draw-stones &quot;st-brownie&quot; 2 6  1 -1  5)
+(draw-items &quot;it-umbrella&quot; 3 3  1 0  10)
+(set-item &quot;it-document&quot; '(10 4) 'text &quot;There's treasure everywhere&quot;)
+
+(fill-floor &quot;fl-sand&quot; 0 0 40 40)
+(fill-floor &quot;fl-rock&quot; 5 5 8 8)
+
+(o2-set-actor 12 5 (o2-make-object &quot;ac-blackball&quot;))
+
+(set-stone &quot;st-grate1&quot;
+
+            (list 15 5 
+                  10 10
+                  10 11
+                  10 12))
+</pre>
+
+</div>
+
+
+<div class="quote">
+???????, ????? ????? ??? ??????, ??????? ??????? ???? ?? ??? ??????.
+?? ???????? ????????? Enigma ? 2001, ????? ??????? ???????????? ????????
+?? ????? ??? 1000, ? ??????? ???? ???????? ?? ??? ??????? ?????????? ????????.
+??????? ????????? ?????? ??????? ?? ?????? ????????? ?????? 90% ???? ??????? ? ??? ??????????!
+??????? ?????????????, ??? ???-???? ?????????: ???? ????????? ????????? ????? ??? ????????????? ?? ???????,
+?? ???????????? Enigma ????? ????? ?????? ???? ?? ???? ??????? ?????? ??? ???, ?????? ????? ??????????
+??? ??????? ???????????...
+
+</div>
+
+
+<div class="quote">
+??????, ??????? ???????? ? ???????????? ????? ???? ???????? ???? ?? ?????????????
+???????. ??????????? ???? &quot;????? ?????????? ????&quot; ??????????? ????????????
+? &quot;???????????&quot; 3D ?????, ?? ?????? ???????????? ??????? ??????????
+?????? ??? ?????? ????. ? ?????? ????? ??????? ???? ??? ??????, ???????
+???? ????? ?????? ??????? ????????????????? ?????????????? ? ???????,
+?????????????? ? ?????????? ???, ??????? ??? ?? ???????? ???????? ????????????? ???????
+????. ?????????? ? ????????? ?????? ?????????? ???????? ????????? ??????????????: 
+????????? ????? ????????? ??????? ???? ? ???????????, ??????? ??????????? ? ??????????????
+??????????? ?????????? ?????? ??? ???? ?? ????? ??????? ? ??????? ??????? Enigma ???? ??????. 
+??? ????? ???????? ?????? ???????? ???????????, ????????? ????? ???? ??????????? ????
+?????? ??? &quot;?????????&quot; ? ??? ?? ??????, ? ?????? ?????? ???-??? ??????? ??? ?????? ????:
+?? ??? ????? ?? ?????? ???????, ??????? ???????????? ??????? ???-???, ? ?? ??? ??? ?? ???????? ????? ?? ??????.
+
+</div>
+
+
+<div class="quote">
+??????? ?? &quot;??????? ???? 2007&quot; ??????? ?????? ?
+??????????? ???????? ??????, ?????????? ????? ?? ????????-?????????? ??????? Enigma.
+??? ??????????? ???????? ? ?????????????, ?????????? ? ??????????? ? ?? ??????? ????? 
+?????? ??????? ? ????? ?????? ????? ?? ????? ???, ???? ??? ??? ??? ???...</div>
+
+
+<div class="quote">
+??????? ????? ???? ?? ??????? ???? - ?????? ? ????? ????, ? ? 
+???????? ???????, ??? ??? ?????? ????????? ? ?????????, ?? ???????????? ??????????
+Enigma. ?????????? ?????????? ??????? Enigma ?????????? ???? ????????, ? ? ????? ??? ???????? ???????
+?????? ???? ? ?? ?????????? ?????????????????. ?, ?? ????? ?????????? ????:
+??? ????????????? ??????, ????????? ????, ? ?? ???-?? ?? ???????.
+
+</div>
+
+
+<div class="author">
+
+Daniel Heck</div>
+
+
+<p>? ??? ? ???:</p>
+
+<h3>?????? ???????????? ??????? 2007: &quot;Doors Galore&quot; ?? Ray Wick</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_h.png" alt="Doors Galore, IV/9" border="0">
+
+Doors Galore, IV/9</p>
+
+<p>&quot;Doors Galore&quot; - ???? ?? ????? ???????????? ? &quot;????????&quot; ??????? ? Enigma, ???????????? ??????? ??????? ?????? ? ?????????????? ?????????. ? 3.89 ?? 5 ????????? ?????, Ray Wick ?????????? ?????????? ??????, ??????????? ?? &quot;Plan Ahead&quot; (3.59) ? &quot;Industrial Puzzles&quot; (3.50).</p>
+
+<h3>?????? ????? ??????? 2007: &quot;Gods of Enigma&quot; ?? moonpearl</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_f.png" alt="Gods of Enigma, V/67" border="0">
+
+Gods of Enigma, V/67</p>
+
+<div class="lotmpic">
+  <img src="$$imagedir$$/articles/eoya_2007_g.png" alt="Gods of Enigma II, V/69" border="0">
+  <div class="imagetitle">
+
+Gods of Enigma II, V/69</div>
+</div>
+
+<p>????? ??????? &quot;Gods of Enigma&quot; ?? moonpearl ?????? ? Enigma ????? ????? mag-heut.net ? ?????????? ? ?????????? ?????? ??????? Enigma ? ????????? ???????: ? ?????? ??????????? ?? ????, 4.23 ????, ??? ????????? ???? ???????? ??????? ?????????? &quot;Little Puzzles &amp; Big Adventures&quot; (4.03) ? &quot;Seed Puzzles&quot; (3.70).</p>
+
+<p>
+<img class="leftimage" src="$$imagedir$$/articles/longline.png" alt="" border="0">
+</p>
+
+<h3>?????? ?????????? 2007: &quot;The Aztec Temple&quot; ?? Dominik Lehmann</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_i.png" alt="The Aztec Temple, VI/100" border="0">
+
+The Aztec Temple, VI/100</p>
+
+<p>??????? ?? ?????????? ?????????????? ????? ????? ?????????:
+??????? ?????? ??? 2007, ? 4.19 ??????, &quot;The Aztec Temple&quot; ???????????? &quot;Mountain Climbing&quot; (3.80) ? &quot;Solar System&quot; (3.68), ? ?????????? ? ?????? Enigma ????? ?????????: ????? ??????????? ????????, ?????, ??????? ? ?????? ?????, ? ????? ??????? ??????? ??????
+????? ????????? ?????????? ??? ????? ??????? ???????.</p>
+
+<h3>????? ???????? ?????? 2007: &quot;Advancing&quot; ? &quot;Mountain Climbing&quot; ?? Joseph Dunne</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_d.png" alt="Advancing, VII/23" border="0">
+
+Advancing, VII/23</p>
+
+<div class="lotmpic">
+  <img src="$$imagedir$$/articles/eoya_2007_e.png" alt="Mountain Climbing, VII/22" border="0">
+  <div class="imagetitle">
+Mountain Climbing, VII/22</div>
+</div>
+
+<p>Joseph Dunne ?????? ??????? ????: ??? ??????????? ?????? &quot;Advancing&quot; ? &quot;Mountain Climbing&quot; ??? ???????? 3.786 ????? ?? 5 ?, ????? ????, ???????? ????? ????? ???? Enigma: ?????????? ?????? ??? ??????? ???????? ???????? ????????? ???? ???????, ???????????? ????????? ????????? ???????????. ?? ?????????? ???? &quot;Diving&quot; (3.55) ? &quot;What's the Problem?&quot; (3.52).</p>
+
+<p>
+<img class="leftimage" src="$$imagedir$$/articles/longline.png" alt="" border="0">
+</p>
+
+<h3>?????? ???-??? ??????? 2007: &quot;Teamwork&quot; ?? Jacob Scott</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_c.png" alt="Teamwork, III/18" border="0">
+
+Teamwork, III/18</p>
+
+<p>&quot;Teamwork&quot; ????? ?????? ??????????? ??????? ???-??? ?????? Enigma: ???? ??????? ?????? ??????? Jacob ???????, ??? ?? ????? ???? ?????? ?????????? ????????, ? ? 3.83 ?????? &quot;Teamwork&quot; ??? ??? ?????????? ???????? ????? ????????? &quot;Turnstiles for Two&quot; (3.75) ? &quot;Manamana&quot; (3.64).</p>
+
+<p>? ??????, ????? ?????? ?????????:</p>
+
+<h3>??????? ???? 2007: &quot;Island Labyrinth&quot; ?? Jacob Scott!</h3>
+
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/eoya_2007_b.png" alt="Island Labyrinth, V/100" border="0">
+
+Island Labyrinth, V/100</p>
+
+<p>? ?????, ?? ????? ???? ????? ????????? ????????, ????? ?????? ?????? ?????? ??????? ??????, ????? ????? ??????? ???? 2007: ? &quot;Quadropolis&quot;, ? &quot;Temple of Gold&quot; ??????? &quot;The Aztec Temple&quot;, ? &quot;Houdini&quot;, &quot;Labyrinth of Puzzles&quot;, &quot;The Aztec Temple&quot; ? ???? &quot;Temple of Gold&quot; ???? ?? ?????? ???????? ?? ??? ?? ?????? - ???? ??????? ????? 9.10 ? 9.25! ?? ? ?????, ?? ???? ?? ??? ?? ???? ??????????? ? &quot;Island Labyrinth&quot;: 5 ?? ??? 8 ?????? - ????????? 10 ?????, ???? 9, ???? 8 ? ???? 7, ??? ???????? Jacob Scott ?????????? ????? ?????? ?????? ???? 2007!</p>
+
+<h3>?????????? ...</h3>
+
+<p>?????? ????? ????? ????? ??????? ?????? ?????? ??????? ?????????? ??? ??, ? ???? ??????? ? ????? 2007: &quot;Island Labyrinth&quot;. ?? ?????? ?????????? ?????? ? ??? <a href="$$lotm_200703$$">?????</a>. ? ?????? ????? ????????????? ???? ??? ?????, ??????? ???????? ??? ? ?????? ???????? ?? ?????????? ????: ?????? ????? ??????? ????, ??? ???????? ???? ???????????; ? ??????: 
+Alejandro Lacava,
+Ronald Lamprecht,
+Andreas Geldmacher,
+Hubai Andr&aacute;s,
+Tarim,
+Raoul Bourquin,
+illmind,
+Manfredi Carta,
+Manuel K&ouml;nig,
+Linda Mihalic,
+Mark Pulley,
+Lukas Sch&uuml;ller,
+Shoki,
+Spioni,
+Craven,
+? Daniel Heck.
+???????? ????????????? Clifford J. Tasner (Taztunes), ??????? ???????? ?????? ?????? ? ????? ??? - ?????? ??? ??? - ????? ????????! ????? ??? ????? ?????? ????????? ?? ?????? ????? ? ?????? ???????. ????? ??????? ??????? Yuriy, ??????? ????????? ? ???????? ???? ????? ?????? ?? ??????? ??? ????? ??????? ??????, ????? ????? ?? 24 ????, ? Joe, ??????? ??? ???????? ??????? ???????? ??????. ??????? ??????? ???? ???!</p>
+
+<p>?? ????? ????? ????????????? ????? ??????? ???????, ??????? ???????? 10 ???????? ???????, ? ??????? ?? ????? ??????????? ?????????? ?? ?????????? ?????????? ????, ? ????? ???, ??? ???????? ??? ???? ?????? ??? ??????: ???????, Jacob Scott, Manuel K&ouml;nig, Dominik Lehmann, Ronald Lamprecht, Barry ? Lori Mead, Johannes Laire, Raoul Bourquin ? Jon 'WB' Sneyers. ? ??????? ?????????? ??????? Enigma, Daniel Heck, ??? ?? ??? ? Meinolf Schneider, ??????? ??? ????? Esprit ? Oxyd, ????? ?????????? ?????????????.</p>
+
+<p>??????? ?????????? ????? ?????? ?? ?? ?????? ????? ? <a href="$$lotm$$">?????? ??</a>, ? ?????? ?????????? ?????? ????? ????? ???????????? <a href="$$eoya_2007_statistics$$">?????</a>.</p>
+
+<p>??????????? ??????????? ??????,<br>
+<i>Andreas &amp;Harry</i></p>
+
+</div>


Property changes on: homepage/input/articles/eoya_2007_ru.html
___________________________________________________________________
Name: svn:eol-style
   + native



From ged at mail.berlios.de  Sat Jan  5 16:08:28 2008
From: ged at mail.berlios.de (ged at mail.berlios.de)
Date: Sat, 5 Jan 2008 16:08:28 +0100
Subject: [Enigma-game-svn] r971 - homepage/input
Message-ID: <200801051508.m05F8SSJ011163@sheep.berlios.de>

Author: ged
Date: 2008-01-05 16:08:26 +0100 (Sat, 05 Jan 2008)
New Revision: 971

Modified:
   homepage/input/infobox_ru.html
Log:
Homepage: infobox_ru

Modified: homepage/input/infobox_ru.html
===================================================================
--- homepage/input/infobox_ru.html	2008-01-05 09:34:50 UTC (rev 970)
+++ homepage/input/infobox_ru.html	2008-01-05 15:08:26 UTC (rev 971)
@@ -1,13 +1,19 @@
     <div class="infobody">
        <div class="info">
-         <h3>????? 10 000 ?????? ???????</h3>
-         ? ???? ?????? ?? ???????? ??????? ? 10 000 ?????? ???????. ??????? ???? ???????? ???????,
-         ??????? ????????? ???? ??????!
-         <h3>??????? ??????</h3>
+         <h3>??????????? IV/2!</h3>
+         ??????? Enigma ?????? ??????? ??????????? ?????? ????!
+         ?? ???? ????? ????? ??????? ? 2008&mdash;????????? ??? ? ?????????? &hellip;
+         <!--<h3>Level of the Month</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
+         </div>  -->
+         <h3>??????? ????? ????</h3>
+         <a href="$$eoya_2007$$"><img src="images/articles/eoya_2007.png"
+         alt="????? ????? ???? ??????? ?????" border="0"></a>
+         <div class="imagetitle">
+           ?????? ?????? 2007 ???????, ? ??????? ???? 2007 ????????? - ??????? ??? ??????? ??????? <a href="$$eoya_2007$$">?????</a>!
          </div>
          <h3>???????????? PAR ? Hcp</h3>
 	 ?? ????????? ????????? ????? ??????????? ???????????, ?? ??????



From andreasl at mail.berlios.de  Sun Jan  6 02:45:13 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Sun, 6 Jan 2008 02:45:13 +0100
Subject: [Enigma-game-svn] r972 - in homepage/input: . articles
Message-ID: <200801060145.m061jDut019910@sheep.berlios.de>

Author: andreasl
Date: 2008-01-06 02:45:12 +0100 (Sun, 06 Jan 2008)
New Revision: 972

Added:
   homepage/input/articles/eoya_2007_statistics.html
   homepage/input/articles/eoya_2007_statistics_de.html
Modified:
   homepage/input/articles/eoya_2007.html
   homepage/input/articles/eoya_2007_de.html
   homepage/input/output-files.lua
Log:
Homepage:
 - Added EoYA-2007-Statistics-pages
   (German and English, not proofread)
Todo:
 - Validation
 - Maybe translation, but this page is
   of low importance. Only few people
   will read it.


Modified: homepage/input/articles/eoya_2007.html
===================================================================
--- homepage/input/articles/eoya_2007.html	2008-01-05 15:08:26 UTC (rev 971)
+++ homepage/input/articles/eoya_2007.html	2008-01-06 01:45:12 UTC (rev 972)
@@ -347,7 +347,7 @@
 
 <p>You can find the current statistics of our ten LotM's in the <a
 href="$$lotm$$">LotM-archive</a>, and the exact statistical results of the poll
-will soon be online <a href="$$eoya_2007_statistics$$">here</a>.</p>
+you can find <a href="$$eoya_2007_statistics$$">here</a>.</p>
 
 <p>Happy New Year's Level,<br>
 <i>Andreas &amp;Harry</i></p>

Modified: homepage/input/articles/eoya_2007_de.html
===================================================================
--- homepage/input/articles/eoya_2007_de.html	2008-01-05 15:08:26 UTC (rev 971)
+++ homepage/input/articles/eoya_2007_de.html	2008-01-06 01:45:12 UTC (rev 972)
@@ -366,8 +366,7 @@
 
 <p>Sie k&ouml;nnen die aktuellen Statistiken unserer zehn LdMs im <a
 href="$$lotm$$">LdM-Archiv</a> finden, und die genauen statistischen Ergebnisse
-der Abstimmung werden bald schon <a href="$$eoya_2007_statistics$$">hier</a>
-online sein.</p>
+der Abstimmung finden Sie <a href="$$eoya_2007_statistics$$">hier</a>.</p>
 
 <p>Frohes Neues Level-Jahr,<br>
 <i>Andreas &amp;Harry</i></p>

Added: homepage/input/articles/eoya_2007_statistics.html
===================================================================
--- homepage/input/articles/eoya_2007_statistics.html	2008-01-05 15:08:26 UTC (rev 971)
+++ homepage/input/articles/eoya_2007_statistics.html	2008-01-06 01:45:12 UTC (rev 972)
@@ -0,0 +1,864 @@
+
+<h2>End of Year Awards 2007 - Pure Statistics</h2>
+
+<p><a href="$$eoya_2007$$">Back to article.</a></p>
+
+<h3>Best Onescreener</h3>
+
+<p>Levels, which comprise of only one screen, have difficulties to become Level of the Month. Yet, there are many pearls in this category, which earn to be celebrated.</p>
+
+<p>You can give each level 1 up to 5 points, 5 is the best. Vote with &quot;-&quot;, if you don't know the level or don't want to judge it.</p>
+
+<p>In total 34 votes plus 37 empty votes.</p>
+<p><table border=1>
+<tr><th align=right>Points</th><th align=right>Votes</th>
+
+<th align=right><b>Average</b></th>
+<th align=left></th></tr>
+<tr><td align=right>109</td><td align=right>28</td><td align=right>3.893</td><td align=left>Doors Galore (IV/9)
+</td></tr>
+<tr><td align=right>104</td><td align=right>29</td><td align=right>3.586</td><td align=left>Plan Ahead (V/21)
+</td></tr>
+<tr><td align=right>77</td><td align=right>22</td><td align=right>3.500</td><td align=left>Industrial Puzzles (VI/98)
+
+</td></tr>
+<tr><td align=right>96</td><td align=right>28</td><td align=right>3.429</td><td align=left>Laser Path (V/4)
+</td></tr>
+<tr><td align=right>72</td><td align=right>21</td><td align=right>3.429</td><td align=left>Protected Exhibition (VII/16)</td></tr>
+<tr><td align=right>106</td><td align=right>31</td><td align=right>3.419</td><td align=left>Door Maze (II/46)
+</td></tr>
+<tr><td align=right>86</td><td align=right>27</td><td align=right>3.185</td><td align=left>Changing Positions (III/97)
+
+</td></tr>
+<tr><td align=right>85</td><td align=right>27</td><td align=right>3.148</td><td align=left>Rhapsody on Cracks (VI/13)
+</td></tr>
+<tr><td align=right>94</td><td align=right>30</td><td align=right>3.133</td><td align=left>Easy? (I/8)
+</td></tr>
+<tr><td align=right>79</td><td align=right>26</td><td align=right>3.038</td><td align=left>Switch-Switch (IV/11)
+</td></tr>
+<tr><td align=right>56</td><td align=right>20</td><td align=right>2.800</td><td align=left>Cold Meditation (VII/21)
+
+</td></tr>
+<tr><td align=right>84</td><td align=right>30</td><td align=right>2.800</td><td align=left>Coloured Doors (III/8)
+</td></tr>
+<tr><td align=right>78</td><td align=right>28</td><td align=right>2.786</td><td align=left>Alcatraz (VI/46)
+</td></tr>
+<tr><td align=right>75</td><td align=right>27</td><td align=right>2.778</td><td align=left>Laser Games (IV/86)
+</td></tr>
+<tr><td align=right>58</td><td align=right>23</td><td align=right>2.522</td><td align=left>Im-pull-se (VI/9)
+
+</td></tr>
+<tr><td align=right>64</td><td align=right>26</td><td align=right>2.462</td><td align=left>Island of Safety (V/34)
+</td></tr>
+</table></p>
+<h3>Best Levelseries</h3>
+
+<p>Many levels give rise to series in Enigma, which absolutely can be seen as a whole. These series are our next category.</p>
+
+<p>In total 32 votes plus 30 empty votes.</p>
+<p><table border=1>
+<tr><th align=right>Points</th><th align=right>Votes</th>
+
+<th align=right><b>Average</b></th>
+<th align=left></th></tr>
+<tr><td align=right>127</td><td align=right>30</td><td align=right>4.233</td><td align=left>Gods of Enigma (V/67, 69)
+</td></tr>
+<tr><td align=right>121</td><td align=right>30</td><td align=right>4.033</td><td align=left>Little Puzzles &amp; Big Adventures (IV/99, 100)
+</td></tr>
+<tr><td align=right>100</td><td align=right>27</td><td align=right>3.704</td><td align=left>Seed Puzzles (IV/71, 74)
+
+</td></tr>
+<tr><td align=right>89</td><td align=right>27</td><td align=right>3.296</td><td align=left>Doors Galore &amp; Switch-Switch (IV/9, 11)
+</td></tr>
+<tr><td align=right>84</td><td align=right>27</td><td align=right>3.111</td><td align=left>Blitz, Tandem and Correspondence Chess (VI/84, 86, 88)
+</td></tr>
+<tr><td align=right>90</td><td align=right>30</td><td align=right>3.000</td><td align=left>Turnstile City &amp; Maze (V/44, 46)</td></tr>
+
+<tr><td align=right>81</td><td align=right>28</td><td align=right>2.893</td><td align=left>Alain's Games (I/33, II/12, II/23, IV/63)
+</td></tr>
+<tr><td align=right>85</td><td align=right>30</td><td align=right>2.833</td><td align=left>Space Tubes (I/87, 89)
+</td></tr>
+<tr><td align=right>84</td><td align=right>30</td><td align=right>2.800</td><td align=left>Laser Spiral &amp; Inverted Laser Spiral (II/74, 78)
+</td></tr>
+
+<tr><td align=right>86</td><td align=right>32</td><td align=right>2.688</td><td align=left>Pentominoes (II/81, 83, 85, 87, 89)
+</td></tr>
+<tr><td align=right>76</td><td align=right>30</td><td align=right>2.533</td><td align=left>Alien Glyphs (II/32, 35, 38)
+</td></tr>
+<tr><td align=right>67</td><td align=right>30</td><td align=right>2.233</td><td align=left>Nightmares (IV/83, 85, 87)
+</td></tr>
+</table></p>
+<h3>Best Design</h3>
+
+<p>A level not only impresses with puzzles and challenges, but sometimes with pure beauty to the eye, with elegance and originality.</p>
+<p>In total 33 votes plus 27 empty votes.</p>
+<p><table border=1>
+<tr><th align=right>Points</th><th align=right>Votes</th>
+<th align=right><b>Average</b></th>
+<th align=left></th></tr>
+<tr><td align=right>130</td><td align=right>31</td><td align=right>4.194</td><td align=left>The Aztec Temple (VI/100)
+</td></tr>
+
+<tr><td align=right>114</td><td align=right>30</td><td align=right>3.800</td><td align=left>Mountain Climbing (VII/22)
+</td></tr>
+<tr><td align=right>103</td><td align=right>28</td><td align=right>3.679</td><td align=left>Solar System (II/39)</td></tr>
+<tr><td align=right>106</td><td align=right>30</td><td align=right>3.533</td><td align=left>Robin's Wood (II/41)
+</td></tr>
+<tr><td align=right>102</td><td align=right>29</td><td align=right>3.517</td><td align=left>Diving (VII/2)
+
+</td></tr>
+<tr><td align=right>102</td><td align=right>29</td><td align=right>3.517</td><td align=left>Guitar (II/28)
+</td></tr>
+<tr><td align=right>86</td><td align=right>25</td><td align=right>3.440</td><td align=left>Elaborate (V/65)
+</td></tr>
+<tr><td align=right>87</td><td align=right>26</td><td align=right>3.346</td><td align=left>A Cooler Spot in Hell (VI/66)
+</td></tr>
+<tr><td align=right>96</td><td align=right>29</td><td align=right>3.310</td><td align=left>Tropical Island (V/35)
+
+</td></tr>
+<tr><td align=right>87</td><td align=right>27</td><td align=right>3.222</td><td align=left>Laser Splitting (VI/6)
+</td></tr>
+<tr><td align=right>93</td><td align=right>30</td><td align=right>3.100</td><td align=left>The Cage (V/26)
+</td></tr>
+<tr><td align=right>81</td><td align=right>27</td><td align=right>3.000</td><td align=left>Psycho Pushing (V/45)
+</td></tr>
+<tr><td align=right>86</td><td align=right>29</td><td align=right>2.966</td><td align=left>Happy New Year (IV/2)
+
+</td></tr>
+<tr><td align=right>75</td><td align=right>28</td><td align=right>2.679</td><td align=left>Print 23 (V/23)
+</td></tr>
+<tr><td align=right>65</td><td align=right>29</td><td align=right>2.241</td><td align=left>be quick or be dead (VI/54)
+</td></tr>
+</table></p>
+<h3>Funniest Level</h3>
+
+<p>Some levels stand out by their original, amusing or surprising gameplay, they present the light, gladly played entertainment in Enigma.</p>
+
+<p>In total 33 votes plus 22 empty votes.</p>
+<p><table border=1>
+<tr><th align=right>Points</th><th align=right>Votes</th>
+<th align=right><b>Average</b></th>
+<th align=left></th></tr>
+<tr><td align=right>106</td><td align=right>28</td><td align=right>3.786</td><td align=left>Mountain Climbing (VII/22)
+</td></tr>
+<tr><td align=right>106</td><td align=right>28</td><td align=right>3.786</td><td align=left>Advancing (VII/23)
+
+</td></tr>
+<tr><td align=right>110</td><td align=right>31</td><td align=right>3.548</td><td align=left>Diving (VII/2)
+</td></tr>
+<tr><td align=right>95</td><td align=right>27</td><td align=right>3.519</td><td align=left>What's the Problem? (IV/49)
+</td></tr>
+<tr><td align=right>99</td><td align=right>29</td><td align=right>3.414</td><td align=left>Enigris (V/92)
+</td></tr>
+<tr><td align=right>93</td><td align=right>28</td><td align=right>3.321</td><td align=left>Dustwalkers (II/17)
+
+</td></tr>
+<tr><td align=right>93</td><td align=right>29</td><td align=right>3.207</td><td align=left>Stay in the Spotlight (II/19)
+</td></tr>
+<tr><td align=right>88</td><td align=right>29</td><td align=right>3.034</td><td align=left>Enigmastermind (II/23)
+</td></tr>
+<tr><td align=right>73</td><td align=right>25</td><td align=right>2.920</td><td align=left>Frogger (V/71)
+</td></tr>
+<tr><td align=right>83</td><td align=right>29</td><td align=right>2.862</td><td align=left>Run Like Hell (IV/57)
+
+</td></tr>
+<tr><td align=right>84</td><td align=right>30</td><td align=right>2.800</td><td align=left>Welcome to the Machine (I/6)
+</td></tr>
+<tr><td align=right>80</td><td align=right>29</td><td align=right>2.759</td><td align=left>Snakes (I/5)
+</td></tr>
+<tr><td align=right>74</td><td align=right>29</td><td align=right>2.552</td><td align=left>April 1st (V/2)
+</td></tr>
+<tr><td align=right>70</td><td align=right>29</td><td align=right>2.414</td><td align=left>Sleeping Serpent (IV/59)
+
+</td></tr>
+<tr><td align=right>66</td><td align=right>30</td><td align=right>2.200</td><td align=left>Do Not Dive (I/21)</td></tr>
+</table></p>
+<h3>Best Yin-Yang Level</h3>
+
+<p>Yin-Yang levels always enjoy great popularity, in which two marbles have to be controlled and must cooperate to solve the puzzles.</p>
+<p>In total 31 votes plus 21 empty votes.</p>
+<p><table border=1>
+<tr><th align=right>Points</th><th align=right>Votes</th>
+
+<th align=right><b>Average</b></th>
+<th align=left></th></tr>
+<tr><td align=right>111</td><td align=right>29</td><td align=right>3.828</td><td align=left>Teamwork (III/18)
+</td></tr>
+<tr><td align=right>90</td><td align=right>24</td><td align=right>3.750</td><td align=left>Turnstiles for Two (VI/77)</td></tr>
+<tr><td align=right>102</td><td align=right>28</td><td align=right>3.643</td><td align=left>Manamana (III/57)
+
+</td></tr>
+<tr><td align=right>86</td><td align=right>26</td><td align=right>3.308</td><td align=left>Tandem Chess (VI/86)
+</td></tr>
+<tr><td align=right>83</td><td align=right>27</td><td align=right>3.074</td><td align=left>Spacestation (V/99)
+</td></tr>
+</table></p>
+<h3>In which version did you first see Enigma?</h3>
+<p>In total 39 votes plus 7 empty votes.</p>
+<p><table border=1>
+
+<tr><th align=right>Votes</th><th align=right><b>Percentage</b></th>
+<th align=left></th></tr>
+<tr><td align=right>17</td><td align=right>43.59</td><td align=left>0.8x
+</td></tr>
+<tr><td align=right>6</td><td align=right>15.38</td><td align=left>even earlier
+</td></tr>
+<tr><td align=right>6</td><td align=right>15.38</td><td align=left>0.9x
+</td></tr>
+<tr><td align=right>5</td><td align=right>12.82</td><td align=left>0.7x
+
+</td></tr>
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>1.01
+</td></tr>
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>1.00
+</td></tr>
+<tr><td align=right>1</td><td align=right>2.56</td><td align=left>No answer.</td></tr>
+</table></p>
+<h3>On which Operating Systems and computers do you play?</h3>
+
+<p>in alphabetical order ;-)</p>
+<p>In total 39 votes plus 7 empty votes.</p>
+<p><table border=1>
+<tr><th align=right>Votes</th><th align=right><b>Percentage</b></th>
+<th align=left></th></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>BSD-derivative
+</td></tr>
+<tr><td align=right>9</td><td align=right>23.08</td><td align=left>Linux Debian / Ubuntu
+</td></tr>
+
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>Linux Slackware
+</td></tr>
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>Linux SuSE
+</td></tr>
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>Linux, another
+</td></tr>
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>Mac OS X 10.3 (Panther)
+</td></tr>
+<tr><td align=right>1</td><td align=right>2.56</td><td align=left>Mac OS X 10.4 (Tiger)
+
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>Mac OS X 10.5 (Leopard)
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>Mac OS X, another
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>UNIX-derivate, another
+</td></tr>
+<tr><td align=right>6</td><td align=right>15.38</td><td align=left>Windows 95 / 98 / ME
+</td></tr>
+
+<tr><td align=right>27</td><td align=right>69.23</td><td align=left>Windows 2000 / XP
+</td></tr>
+<tr><td align=right>3</td><td align=right>7.69</td><td align=left>Windows Vista
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>Windows, another
+</td></tr>
+<tr><td align=right>1</td><td align=right>2.56</td><td align=left>another Operating System
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>... on a 64-bit machine
+
+</td></tr>
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>... on a dual- or multicore processor
+</td></tr>
+<tr><td align=right>1</td><td align=right>2.56</td><td align=left>... on a GP2X
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>... on another handheld</td></tr>
+</table></p>
+<h3>What do you think about the difficulty of the levels?</h3>
+
+<p>(multiple choice)</p>
+
+<p>In total 37 votes plus 8 empty votes.</p>
+<p><table border=1>
+<tr><th align=right>Votes</th><th align=right><b>Percentage</b></th>
+<th align=left></th></tr>
+<tr><td align=right>9</td><td align=right>24.32</td><td align=left>They should be easier in average.
+</td></tr>
+<tr><td align=right>3</td><td align=right>8.11</td><td align=left>They should be more difficult in average.
+
+</td></tr>
+<tr><td align=right>8</td><td align=right>21.62</td><td align=left>The difficulties should scatter less.
+</td></tr>
+<tr><td align=right>6</td><td align=right>16.22</td><td align=left>The difficulties should scatter more.
+</td></tr>
+<tr><td align=right>16</td><td align=right>43.24</td><td align=left>None of the above.</td></tr>
+</table></p>
+<h3>Which type of levels would you like to see more of?</h3>
+
+<p>(relative to the others)</p>
+
+<p>In total 37 votes plus 8 empty votes.</p>
+<p><table border=1>
+<tr><th align=right>Votes</th><th align=right><b>Percentage</b></th>
+<th align=left></th></tr>
+<tr><td align=right>20</td><td align=right>54.05</td><td align=left>small, quickly playable puzzle levels
+</td></tr>
+<tr><td align=right>5</td><td align=right>13.51</td><td align=left>levels, which need lots of dexterity
+
+</td></tr>
+<tr><td align=right>22</td><td align=right>59.46</td><td align=left>levels to explore new combinations and features of gaming objects
+</td></tr>
+<tr><td align=right>14</td><td align=right>37.84</td><td align=left>large adventure levels, in which you have to explore each room
+</td></tr>
+<tr><td align=right>5</td><td align=right>13.51</td><td align=left>large, difficult puzzle levels
+</td></tr>
+<tr><td align=right>12</td><td align=right>32.43</td><td align=left>other types
+</td></tr>
+
+<tr><td align=right>7</td><td align=right>18.92</td><td align=left>The current mix is perfect.</td></tr>
+</table></p>
+<h3>Please estimate, which percentage of all levels you seriously tried to solve.</h3>
+
+<p>(This includes solved levels of course.)</p>
+<p>In total 37 votes plus 8 empty votes.</p>
+<p><table border=1>
+<tr><th align=right>Votes</th><th align=right><b>Percentage</b></th>
+<th align=left></th></tr>
+
+<tr><td align=right>12</td><td align=right>32.43</td><td align=left>90% - 100%
+</td></tr>
+<tr><td align=right>10</td><td align=right>27.03</td><td align=left>50% - 70%
+</td></tr>
+<tr><td align=right>7</td><td align=right>18.92</td><td align=left>70% - 90%
+</td></tr>
+<tr><td align=right>3</td><td align=right>8.11</td><td align=left>30% - 50%
+</td></tr>
+<tr><td align=right>3</td><td align=right>8.11</td><td align=left>10% - 30%
+
+</td></tr>
+<tr><td align=right>1</td><td align=right>2.70</td><td align=left>No answer.</td></tr>
+<tr><td align=right>1</td><td align=right>2.70</td><td align=left>0% - 10%
+</td></tr>
+</table></p>
+<h3>How important are the following information channels about Enigma for you?</h3>
+
+<p>5 = very important, 1 = not important</p>
+<p>In total 34 votes plus 9 empty votes.</p>
+
+<p><table border=1>
+<tr><th align=right>Points</th><th align=right>Votes</th>
+<th align=right><b>Average</b></th>
+<th align=left></th></tr>
+<tr><td align=right>127</td><td align=right>31</td><td align=right>4.097</td><td align=left>mag-heut.net
+</td></tr>
+<tr><td align=right>138</td><td align=right>34</td><td align=right>4.059</td><td align=left>homepage
+</td></tr>
+
+<tr><td align=right>83</td><td align=right>29</td><td align=right>2.862</td><td align=left>developer mailing list
+</td></tr>
+<tr><td align=right>66</td><td align=right>24</td><td align=right>2.750</td><td align=left>private communication, &quot;word of mouth&quot;
+</td></tr>
+<tr><td align=right>24</td><td align=right>10</td><td align=right>2.400</td><td align=left>other</td></tr>
+
+<tr><td align=right>47</td><td align=right>22</td><td align=right>2.136</td><td align=left>announcement mailing list
+</td></tr>
+<tr><td align=right>38</td><td align=right>24</td><td align=right>1.583</td><td align=left>yahoo oxyd group
+</td></tr>
+</table></p>
+<h3>Which should be our priorities for the further development of Enigma?</h3>
+
+<p>Please sort the 10 working areas below into the priorities 1 (=high) to 10 (=low). Only one priority per area, please.</p>
+
+<p>In total 34 votes, including 9 partials (votes, in which not every topic was
+assigned a priority).</p>
+
+<p>Without invalid votes:</p>
+<p><table border=1>
+<tr><th align=right>Points</th>
+<th align=left></th></tr>
+<tr><td align=right>186</td><td align=left>many new levels
+</td></tr>
+<tr><td align=right>167</td><td align=left>bug-fixing
+</td></tr>
+<tr><td align=right>165</td><td align=left>many new objects
+</td></tr>
+
+<tr><td align=right>158</td><td align=left>level editor</td></tr>
+<tr><td align=right>139</td><td align=left>backstage infos and events like LotM
+</td></tr>
+<tr><td align=right>131</td><td align=left>netplay mode to play levels together
+</td></tr>
+<tr><td align=right>128</td><td align=left>save and continue of a level during exploration (not scoring)
+</td></tr>
+<tr><td align=right>128</td><td align=left>new graphics and sounds
+</td></tr>
+<tr><td align=right>92</td><td align=left>support and arranging of Enigma tournaments
+
+</td></tr>
+<tr><td align=right>81</td><td align=left>port to other platforms
+</td></tr>
+</table></p>
+<p><table border=1><tr>
+<th align=right>1</th>
+<th align=right>2</th>
+<th align=right>3</th>
+<th align=right>4</th>
+<th align=right>5</th>
+<th align=right>6</th>
+
+<th align=right>7</th>
+<th align=right>8</th>
+<th align=right>9</th>
+<th align=right>10</th>
+<th align=right>Sum</th><th align=right></th></tr>
+<tr>
+<td align=right>4</td>
+<td align=right>1</td>
+<td align=right>2</td>
+
+<td align=right>6</td>
+<td align=right>3</td>
+<td align=right>4</td>
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right>1</td>
+<td align=right>1</td>
+<td align=right>25</td>
+<td align=left>level editor</td></tr>
+
+<tr>
+<td align=right>7</td>
+<td align=right>6</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>1</td>
+<td align=right>1</td>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right></td>
+
+<td align=right>3</td>
+<td align=right>25</td>
+<td align=left>many new levels
+</td></tr>
+<tr>
+<td align=right>2</td>
+<td align=right>2</td>
+<td align=right>2</td>
+<td align=right>1</td>
+<td align=right>4</td>
+
+<td align=right>5</td>
+<td align=right>4</td>
+<td align=right>3</td>
+<td align=right>2</td>
+<td align=right></td>
+<td align=right>25</td>
+<td align=left>backstage infos and events like LotM
+</td></tr>
+<tr>
+<td align=right>3</td>
+<td align=right>4</td>
+
+<td align=right>4</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>2</td>
+<td align=right>3</td>
+<td align=right></td>
+<td align=right>3</td>
+<td align=right></td>
+<td align=right>25</td>
+<td align=left>many new objects
+
+</td></tr>
+<tr>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right>4</td>
+<td align=right>4</td>
+<td align=right>5</td>
+<td align=right>5</td>
+
+<td align=right>3</td>
+<td align=right>25</td>
+<td align=left>support and arranging of Enigma tournaments
+</td></tr>
+<tr>
+<td align=right>2</td>
+<td align=right>5</td>
+<td align=right>5</td>
+<td align=right>2</td>
+<td align=right>4</td>
+
+<td align=right>2</td>
+<td align=right>1</td>
+<td align=right>3</td>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right>25</td>
+<td align=left>bug-fixing
+</td></tr>
+<tr>
+<td align=right>1</td>
+<td align=right></td>
+
+<td align=right>3</td>
+<td align=right>5</td>
+<td align=right>3</td>
+<td align=right></td>
+<td align=right>8</td>
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right>2</td>
+<td align=right>25</td>
+
+<td align=left>save and continue of a level during exploration (not scoring)
+</td></tr>
+<tr>
+<td align=right>1</td>
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right></td>
+<td align=right>2</td>
+<td align=right>1</td>
+<td align=right></td>
+<td align=right>3</td>
+
+<td align=right>5</td>
+<td align=right>10</td>
+<td align=right>25</td>
+<td align=left>port to other platforms
+</td></tr>
+<tr>
+<td align=right>2</td>
+<td align=right>3</td>
+<td align=right>2</td>
+<td align=right>1</td>
+
+<td align=right>2</td>
+<td align=right>4</td>
+<td align=right>1</td>
+<td align=right>4</td>
+<td align=right>4</td>
+<td align=right>2</td>
+<td align=right>25</td>
+<td align=left>new graphics and sounds
+</td></tr>
+<tr>
+
+<td align=right>3</td>
+<td align=right>2</td>
+<td align=right>2</td>
+<td align=right>3</td>
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>3</td>
+
+<td align=right>3</td>
+<td align=right>25</td>
+<td align=left>netplay mode to play levels together
+</td></tr>
+</table></p>
+<p>With invalid votes:</p>
+<p><table border=1>
+<tr><th align=right>Points</th>
+<th align=left></th></tr>
+<tr><td align=right>224</td><td align=left>many new levels
+</td></tr>
+<tr><td align=right>223</td><td align=left>level editor</td></tr>
+
+<tr><td align=right>196</td><td align=left>netplay mode to play levels together
+</td></tr>
+<tr><td align=right>195</td><td align=left>many new objects
+</td></tr>
+<tr><td align=right>194</td><td align=left>bug-fixing
+</td></tr>
+<tr><td align=right>183</td><td align=left>save and continue of a level during exploration (not scoring)
+</td></tr>
+<tr><td align=right>168</td><td align=left>new graphics and sounds
+</td></tr>
+<tr><td align=right>161</td><td align=left>backstage infos and events like LotM
+
+</td></tr>
+<tr><td align=right>107</td><td align=left>support and arranging of Enigma tournaments
+</td></tr>
+<tr><td align=right>88</td><td align=left>port to other platforms
+</td></tr>
+</table></p>
+<p><table border=1><tr>
+<th align=right>1</th>
+<th align=right>2</th>
+<th align=right>3</th>
+<th align=right>4</th>
+
+<th align=right>5</th>
+<th align=right>6</th>
+<th align=right>7</th>
+<th align=right>8</th>
+<th align=right>9</th>
+<th align=right>10</th>
+<th align=right>Sum</th><th align=right></th></tr>
+<tr>
+<td align=right>6</td>
+
+<td align=right>5</td>
+<td align=right>2</td>
+<td align=right>6</td>
+<td align=right>3</td>
+<td align=right>5</td>
+<td align=right>2</td>
+<td align=right>2</td>
+<td align=right>1</td>
+<td align=right>1</td>
+
+<td align=right>33</td>
+<td align=left>level editor</td></tr>
+<tr>
+<td align=right>6</td>
+<td align=right>2</td>
+<td align=right>4</td>
+<td align=right>4</td>
+<td align=right>2</td>
+<td align=right>2</td>
+
+<td align=right>3</td>
+<td align=right>5</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>34</td>
+<td align=left>netplay mode to play levels together
+</td></tr>
+<tr>
+<td align=right>2</td>
+<td align=right>4</td>
+
+<td align=right>3</td>
+<td align=right>2</td>
+<td align=right>3</td>
+<td align=right>4</td>
+<td align=right>3</td>
+<td align=right>4</td>
+<td align=right>5</td>
+<td align=right>2</td>
+<td align=right>32</td>
+
+<td align=left>new graphics and sounds
+</td></tr>
+<tr>
+<td align=right>2</td>
+<td align=right>6</td>
+<td align=right>5</td>
+<td align=right>3</td>
+<td align=right>4</td>
+<td align=right>2</td>
+<td align=right>3</td>
+
+<td align=right>4</td>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right>30</td>
+<td align=left>bug-fixing
+</td></tr>
+<tr>
+<td align=right>1</td>
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right></td>
+
+<td align=right>2</td>
+<td align=right>1</td>
+<td align=right>1</td>
+<td align=right>3</td>
+<td align=right>6</td>
+<td align=right>11</td>
+<td align=right>28</td>
+<td align=left>port to other platforms
+</td></tr>
+<tr>
+
+<td align=right>3</td>
+<td align=right>4</td>
+<td align=right>5</td>
+<td align=right>5</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>1</td>
+<td align=right>3</td>
+
+<td align=right></td>
+<td align=right>30</td>
+<td align=left>many new objects
+</td></tr>
+<tr>
+<td align=right>3</td>
+<td align=right>1</td>
+<td align=right>5</td>
+<td align=right>6</td>
+<td align=right>3</td>
+<td align=right></td>
+
+<td align=right>8</td>
+<td align=right>1</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>33</td>
+<td align=left>save and continue of a level during exploration (not scoring)
+</td></tr>
+<tr>
+<td align=right>2</td>
+<td align=right>2</td>
+
+<td align=right>3</td>
+<td align=right>1</td>
+<td align=right>5</td>
+<td align=right>6</td>
+<td align=right>4</td>
+<td align=right>4</td>
+<td align=right>2</td>
+<td align=right></td>
+<td align=right>29</td>
+
+<td align=left>backstage infos and events like LotM
+</td></tr>
+<tr>
+<td align=right>8</td>
+<td align=right>6</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>4</td>
+<td align=right>3</td>
+<td align=right></td>
+<td align=right>1</td>
+
+<td align=right></td>
+<td align=right>3</td>
+<td align=right>31</td>
+<td align=left>many new levels
+</td></tr>
+<tr>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right>5</td>
+
+<td align=right>5</td>
+<td align=right>6</td>
+<td align=right>6</td>
+<td align=right>4</td>
+<td align=right>30</td>
+<td align=left>support and arranging of Enigma tournaments
+</td></tr>
+</table></p>
+
+<h3>Language ratio</h3>
+<p><ul>
+<li>English: 269</li>
+<li>German: 356</li>
+<li><b>Total: 625</b></li></ul></p>
+
+<h3>Date statistics</h3>
+
+<p>Please note that this table (in contrast to all preceding ones) additionally
+counts corrections to existing entries. The column &quot;Question X&quot;
+states how many users clicked on one of the submit-buttons in the corresponding
+questionnaire. &quot;Question 1&quot; was the question about the best
+onescreener, &quot;Question 9&quot; about the operating system.</p>
+
+<p><table border=1>
+<tr><th align=right><b>Date</b></th><th align=right><b>Entries</b></th><th align=right>Question 1</th><th align=right>Question 9</th></tr>
+<tr><td align=right>2007-11-20</td><td align=right>71</td>
+<td align=right>8</td>
+
+<td align=right>4</td></tr>
+<tr><td align=right>2007-11-21</td><td align=right>134</td>
+<td align=right>14</td>
+<td align=right>8</td></tr>
+<tr><td align=right>2007-11-22</td><td align=right>66</td>
+<td align=right>7</td>
+<td align=right>4</td></tr>
+<tr><td align=right>2007-11-23</td><td align=right>20</td>
+
+<td align=right>3</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-11-24</td><td align=right>5</td>
+<td align=right>1</td>
+<td align=right>0</td></tr>
+<tr><td align=right>2007-11-25</td><td align=right>54</td>
+<td align=right>1</td>
+<td align=right>3</td></tr>
+
+<tr><td align=right>2007-11-26</td><td align=right>27</td>
+<td align=right>3</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-11-27</td><td align=right>37</td>
+<td align=right>5</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-11-28</td><td align=right>20</td>
+
+<td align=right>2</td>
+<td align=right>1</td></tr>
+<tr><td align=right>2007-11-29</td><td align=right>3</td>
+<td align=right>1</td>
+<td align=right>0</td></tr>
+<tr><td align=right>2007-11-30</td><td align=right>32</td>
+<td align=right>4</td>
+<td align=right>2</td></tr>
+
+<tr><td align=right>2007-12-01</td><td align=right>36</td>
+<td align=right>3</td>
+<td align=right>3</td></tr>
+<tr><td align=right>2007-12-02</td><td align=right>42</td>
+<td align=right>3</td>
+<td align=right>3</td></tr>
+<tr><td align=right>2007-12-03</td><td align=right>26</td>
+
+<td align=right>3</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-12-04</td><td align=right>3</td>
+<td align=right>-</td>
+<td align=right>0</td></tr>
+<tr><td align=right>2007-12-05</td><td align=right>2</td>
+<td align=right>1</td>
+<td align=right>0</td></tr>
+
+<tr><td align=right>2007-12-06</td><td align=right>24</td>
+<td align=right>2</td>
+<td align=right>1</td></tr>
+<tr><td align=right>2007-12-07</td><td align=right>6</td>
+<td align=right>-</td>
+<td align=right>0</td></tr>
+<tr><td align=right>2007-12-08</td><td align=right>30</td>
+
+<td align=right>2</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-12-09</td><td align=right>25</td>
+<td align=right>2</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-12-10</td><td align=right>5</td>
+<td align=right>1</td>
+<td align=right>0</td></tr>
+
+<tr><td align=right>2007-12-11</td><td align=right>16</td>
+<td align=right>1</td>
+<td align=right>1</td></tr>
+<tr><td align=right>2007-12-12</td><td align=right>12</td>
+<td align=right>1</td>
+<td align=right>1</td></tr>
+<tr><td align=right>2007-12-13</td><td align=right>12</td>
+
+<td align=right>1</td>
+<td align=right>1</td></tr>
+<tr><td align=right>2007-12-14</td><td align=right>19</td>
+<td align=right>2</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-12-15</td><td align=right>1</td>
+<td align=right>-</td>
+<td align=right>0</td></tr>
+
+<tr><td align=right>2007-12-16</td><td align=right>1</td>
+<td align=right>1</td>
+<td align=right>0</td></tr>
+<tr><td align=right><b>Sum</b></td><td align=right>729</td>
+<td align=right>72</td>
+<td align=right>46</td></tr>
+</table></p>
+
+<p><a href="$$eoya_2007$$">Back to article.</a></p>

Added: homepage/input/articles/eoya_2007_statistics_de.html
===================================================================
--- homepage/input/articles/eoya_2007_statistics_de.html	2008-01-05 15:08:26 UTC (rev 971)
+++ homepage/input/articles/eoya_2007_statistics_de.html	2008-01-06 01:45:12 UTC (rev 972)
@@ -0,0 +1,870 @@
+
+<h2>Jahresendauszeichnungen 2007 - Pure Statistiken</h2>
+
+<p><a href="$$eoya_2007$$">Zur&uuml;ck zum Artikel.</a></p>
+
+<h3>Bester Onescreener</h3>
+
+<p>Level, die sich nur &uuml;ber einen Bildschirm erstrecken, haben es schwer, zum Level des Monats gew&auml;hlt zu werden. Und doch gibt es viele Perlen in dieser Kategorie, die es besonders verdienen, gefeiert zu werden.</p>
+
+<p>Sie k&ouml;nnen jedem Level zwischen 1 und 5 Punkten geben, 5 ist die beste Wertung. Stimmen Sie mit &quot;-&quot;, wenn Sie den Level nicht kennen oder nicht bewerten wollen.</p>
+
+<p>Insgesamt 34 Stimmen plus 37 leere Stimmen.</p>
+<p><table border=1>
+
+<tr><th align=right>Punkte</th><th align=right>Stimmen</th>
+<th align=right><b>Durchschnitt</b></th>
+<th align=left></th></tr>
+<tr><td align=right>109</td><td align=right>28</td><td align=right>3.893</td><td align=left>Doors Galore (IV/9)
+</td></tr>
+<tr><td align=right>104</td><td align=right>29</td><td align=right>3.586</td><td align=left>Plan Ahead (V/21)
+</td></tr>
+<tr><td align=right>77</td><td align=right>22</td><td align=right>3.500</td><td align=left>Industrial Puzzles (VI/98)
+
+</td></tr>
+<tr><td align=right>96</td><td align=right>28</td><td align=right>3.429</td><td align=left>Laser Path (V/4)
+</td></tr>
+<tr><td align=right>72</td><td align=right>21</td><td align=right>3.429</td><td align=left>Protected Exhibition (VII/16)</td></tr>
+<tr><td align=right>106</td><td align=right>31</td><td align=right>3.419</td><td align=left>Door Maze (II/46)
+</td></tr>
+<tr><td align=right>86</td><td align=right>27</td><td align=right>3.185</td><td align=left>Changing Positions (III/97)
+
+</td></tr>
+<tr><td align=right>85</td><td align=right>27</td><td align=right>3.148</td><td align=left>Rhapsody on Cracks (VI/13)
+</td></tr>
+<tr><td align=right>94</td><td align=right>30</td><td align=right>3.133</td><td align=left>Easy? (I/8)
+</td></tr>
+<tr><td align=right>79</td><td align=right>26</td><td align=right>3.038</td><td align=left>Switch-Switch (IV/11)
+</td></tr>
+<tr><td align=right>56</td><td align=right>20</td><td align=right>2.800</td><td align=left>Cold Meditation (VII/21)
+
+</td></tr>
+<tr><td align=right>84</td><td align=right>30</td><td align=right>2.800</td><td align=left>Coloured Doors (III/8)
+</td></tr>
+<tr><td align=right>78</td><td align=right>28</td><td align=right>2.786</td><td align=left>Alcatraz (VI/46)
+</td></tr>
+<tr><td align=right>75</td><td align=right>27</td><td align=right>2.778</td><td align=left>Laser Games (IV/86)
+</td></tr>
+<tr><td align=right>58</td><td align=right>23</td><td align=right>2.522</td><td align=left>Im-pull-se (VI/9)
+
+</td></tr>
+<tr><td align=right>64</td><td align=right>26</td><td align=right>2.462</td><td align=left>Island of Safety (V/34)
+</td></tr>
+</table></p>
+<h3>Beste Levelserie</h3>
+
+<p>Viele Levels bilden in Enigma Serien, die man durchaus als zusammengeh&ouml;rige Einheit betrachten sollte. Diese Serien bilden unsere n&auml;chste Kategorie.</p>
+
+<p>Insgesamt 32 Stimmen plus 30 leere Stimmen.</p>
+
+<p><table border=1>
+<tr><th align=right>Punkte</th><th align=right>Stimmen</th>
+<th align=right><b>Durchschnitt</b></th>
+<th align=left></th></tr>
+<tr><td align=right>127</td><td align=right>30</td><td align=right>4.233</td><td align=left>Gods of Enigma (V/67, 69)
+</td></tr>
+<tr><td align=right>121</td><td align=right>30</td><td align=right>4.033</td><td align=left>Little Puzzles &amp; Big Adventures (IV/99, 100)
+
+</td></tr>
+<tr><td align=right>100</td><td align=right>27</td><td align=right>3.704</td><td align=left>Seed Puzzles (IV/71, 74)
+</td></tr>
+<tr><td align=right>89</td><td align=right>27</td><td align=right>3.296</td><td align=left>Doors Galore &amp; Switch-Switch (IV/9, 11)
+</td></tr>
+<tr><td align=right>84</td><td align=right>27</td><td align=right>3.111</td><td align=left>Blitz, Tandem and Correspondence Chess (VI/84, 86, 88)
+
+</td></tr>
+<tr><td align=right>90</td><td align=right>30</td><td align=right>3.000</td><td align=left>Turnstile City &amp; Maze (V/44, 46)</td></tr>
+<tr><td align=right>81</td><td align=right>28</td><td align=right>2.893</td><td align=left>Alain's Games (I/33, II/12, II/23, IV/63)
+</td></tr>
+<tr><td align=right>85</td><td align=right>30</td><td align=right>2.833</td><td align=left>Space Tubes (I/87, 89)
+
+</td></tr>
+<tr><td align=right>84</td><td align=right>30</td><td align=right>2.800</td><td align=left>Laser Spiral &amp; Inverted Laser Spiral (II/74, 78)
+</td></tr>
+<tr><td align=right>86</td><td align=right>32</td><td align=right>2.688</td><td align=left>Pentominoes (II/81, 83, 85, 87, 89)
+</td></tr>
+<tr><td align=right>76</td><td align=right>30</td><td align=right>2.533</td><td align=left>Alien Glyphs (II/32, 35, 38)
+
+</td></tr>
+<tr><td align=right>67</td><td align=right>30</td><td align=right>2.233</td><td align=left>Nightmares (IV/83, 85, 87)
+</td></tr>
+</table></p>
+<h3>Bestes Design</h3>
+
+<p>Nicht allein mit R&auml;tseln und Herausforderungen mag ein Level zu beeindrucken, sondern manchmal auch mit blo&szlig;er Sch&ouml;nheit f&uuml;rs Auge, mit Eleganz und Originalit&auml;t.</p>
+
+<p>Insgesamt 33 Stimmen plus 27 leere Stimmen.</p>
+<p><table border=1>
+<tr><th align=right>Punkte</th><th align=right>Stimmen</th>
+<th align=right><b>Durchschnitt</b></th>
+<th align=left></th></tr>
+<tr><td align=right>130</td><td align=right>31</td><td align=right>4.194</td><td align=left>The Aztec Temple (VI/100)
+</td></tr>
+<tr><td align=right>114</td><td align=right>30</td><td align=right>3.800</td><td align=left>Mountain Climbing (VII/22)
+
+</td></tr>
+<tr><td align=right>103</td><td align=right>28</td><td align=right>3.679</td><td align=left>Solar System (II/39)</td></tr>
+<tr><td align=right>106</td><td align=right>30</td><td align=right>3.533</td><td align=left>Robin's Wood (II/41)
+</td></tr>
+<tr><td align=right>102</td><td align=right>29</td><td align=right>3.517</td><td align=left>Diving (VII/2)
+</td></tr>
+<tr><td align=right>102</td><td align=right>29</td><td align=right>3.517</td><td align=left>Guitar (II/28)
+
+</td></tr>
+<tr><td align=right>86</td><td align=right>25</td><td align=right>3.440</td><td align=left>Elaborate (V/65)
+</td></tr>
+<tr><td align=right>87</td><td align=right>26</td><td align=right>3.346</td><td align=left>A Cooler Spot in Hell (VI/66)
+</td></tr>
+<tr><td align=right>96</td><td align=right>29</td><td align=right>3.310</td><td align=left>Tropical Island (V/35)
+</td></tr>
+<tr><td align=right>87</td><td align=right>27</td><td align=right>3.222</td><td align=left>Laser Splitting (VI/6)
+
+</td></tr>
+<tr><td align=right>93</td><td align=right>30</td><td align=right>3.100</td><td align=left>The Cage (V/26)
+</td></tr>
+<tr><td align=right>81</td><td align=right>27</td><td align=right>3.000</td><td align=left>Psycho Pushing (V/45)
+</td></tr>
+<tr><td align=right>86</td><td align=right>29</td><td align=right>2.966</td><td align=left>Happy New Year (IV/2)
+</td></tr>
+<tr><td align=right>75</td><td align=right>28</td><td align=right>2.679</td><td align=left>Print 23 (V/23)
+
+</td></tr>
+<tr><td align=right>65</td><td align=right>29</td><td align=right>2.241</td><td align=left>be quick or be dead (VI/54)
+</td></tr>
+</table></p>
+<h3>Lustigster Level</h3>
+
+<p>Manche Levels stechen durch ihre originelle, am&uuml;sante oder &uuml;berraschende Art besonders hervor, sie bilden die eher leichte, gern gespielte Unterhaltung in Enigma.</p>
+<p>Insgesamt 33 Stimmen plus 22 leere Stimmen.</p>
+<p><table border=1>
+
+<tr><th align=right>Punkte</th><th align=right>Stimmen</th>
+<th align=right><b>Durchschnitt</b></th>
+<th align=left></th></tr>
+<tr><td align=right>106</td><td align=right>28</td><td align=right>3.786</td><td align=left>Mountain Climbing (VII/22)
+</td></tr>
+<tr><td align=right>106</td><td align=right>28</td><td align=right>3.786</td><td align=left>Advancing (VII/23)
+</td></tr>
+<tr><td align=right>110</td><td align=right>31</td><td align=right>3.548</td><td align=left>Diving (VII/2)
+
+</td></tr>
+<tr><td align=right>95</td><td align=right>27</td><td align=right>3.519</td><td align=left>What's the Problem? (IV/49)
+</td></tr>
+<tr><td align=right>99</td><td align=right>29</td><td align=right>3.414</td><td align=left>Enigris (V/92)
+</td></tr>
+<tr><td align=right>93</td><td align=right>28</td><td align=right>3.321</td><td align=left>Dustwalkers (II/17)
+</td></tr>
+<tr><td align=right>93</td><td align=right>29</td><td align=right>3.207</td><td align=left>Stay in the Spotlight (II/19)
+
+</td></tr>
+<tr><td align=right>88</td><td align=right>29</td><td align=right>3.034</td><td align=left>Enigmastermind (II/23)
+</td></tr>
+<tr><td align=right>73</td><td align=right>25</td><td align=right>2.920</td><td align=left>Frogger (V/71)
+</td></tr>
+<tr><td align=right>83</td><td align=right>29</td><td align=right>2.862</td><td align=left>Run Like Hell (IV/57)
+</td></tr>
+<tr><td align=right>84</td><td align=right>30</td><td align=right>2.800</td><td align=left>Welcome to the Machine (I/6)
+
+</td></tr>
+<tr><td align=right>80</td><td align=right>29</td><td align=right>2.759</td><td align=left>Snakes (I/5)
+</td></tr>
+<tr><td align=right>74</td><td align=right>29</td><td align=right>2.552</td><td align=left>April 1st (V/2)
+</td></tr>
+<tr><td align=right>70</td><td align=right>29</td><td align=right>2.414</td><td align=left>Sleeping Serpent (IV/59)
+</td></tr>
+<tr><td align=right>66</td><td align=right>30</td><td align=right>2.200</td><td align=left>Do Not Dive (I/21)</td></tr>
+
+</table></p>
+<h3>Bester Yin-Yang-Level</h3>
+
+<p>Besonderer Beliebtheit erfreuen sich die Yin-Yang-Levels, in denen zwei Murmeln gesteuert werden m&uuml;ssen, und kooperieren m&uuml;ssen, um die R&auml;tsel zu l&ouml;sen.</p>
+<p>Insgesamt 31 Stimmen plus 21 leere Stimmen.</p>
+<p><table border=1>
+<tr><th align=right>Punkte</th><th align=right>Stimmen</th>
+<th align=right><b>Durchschnitt</b></th>
+
+<th align=left></th></tr>
+<tr><td align=right>111</td><td align=right>29</td><td align=right>3.828</td><td align=left>Teamwork (III/18)
+</td></tr>
+<tr><td align=right>90</td><td align=right>24</td><td align=right>3.750</td><td align=left>Turnstiles for Two (VI/77)</td></tr>
+<tr><td align=right>102</td><td align=right>28</td><td align=right>3.643</td><td align=left>Manamana (III/57)
+</td></tr>
+<tr><td align=right>86</td><td align=right>26</td><td align=right>3.308</td><td align=left>Tandem Chess (VI/86)
+
+</td></tr>
+<tr><td align=right>83</td><td align=right>27</td><td align=right>3.074</td><td align=left>Spacestation (V/99)
+</td></tr>
+</table></p>
+<h3>In welcher Version haben Sie das erste Mal Enigma gesehen?</h3>
+<p>Insgesamt 39 Stimmen plus 7 leere Stimmen.</p>
+<p><table border=1>
+<tr><th align=right>Stimmen</th><th align=right><b>Anteil</b></th>
+<th align=left></th></tr>
+<tr><td align=right>17</td><td align=right>43.59</td><td align=left>0.8x
+
+</td></tr>
+<tr><td align=right>6</td><td align=right>15.38</td><td align=left>noch fr&uuml;her
+</td></tr>
+<tr><td align=right>6</td><td align=right>15.38</td><td align=left>0.9x
+</td></tr>
+<tr><td align=right>5</td><td align=right>12.82</td><td align=left>0.7x
+</td></tr>
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>1.01
+
+</td></tr>
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>1.00
+</td></tr>
+<tr><td align=right>1</td><td align=right>2.56</td><td align=left>Keine Antwort.</td></tr>
+</table></p>
+<h3>Unter welchen Betriebssystemen und Rechnern spielen Sie?</h3>
+
+<p>in alphabetischer Reihenfolge ;-)</p>
+<p>Insgesamt 39 Stimmen plus 7 leere Stimmen.</p>
+
+<p><table border=1>
+<tr><th align=right>Stimmen</th><th align=right><b>Anteil</b></th>
+<th align=left></th></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>BSD-Derivat
+</td></tr>
+<tr><td align=right>9</td><td align=right>23.08</td><td align=left>Linux Debian / Ubuntu
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>Linux Slackware
+</td></tr>
+
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>Linux SuSE
+</td></tr>
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>Linux, anderes
+</td></tr>
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>Mac OS X 10.3 (Panther)
+</td></tr>
+<tr><td align=right>1</td><td align=right>2.56</td><td align=left>Mac OS X 10.4 (Tiger)
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>Mac OS X 10.5 (Leopard)
+
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>Mac OS X, anderes
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>UNIX-Derivat, anderes
+</td></tr>
+<tr><td align=right>6</td><td align=right>15.38</td><td align=left>Windows 95 / 98 / ME
+</td></tr>
+<tr><td align=right>27</td><td align=right>69.23</td><td align=left>Windows 2000 / XP
+</td></tr>
+
+<tr><td align=right>3</td><td align=right>7.69</td><td align=left>Windows Vista
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>Windows, anderes
+</td></tr>
+<tr><td align=right>1</td><td align=right>2.56</td><td align=left>anderes Betriebssystem
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>... auf einem 64-Bit-Rechner
+</td></tr>
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>... auf einem Dualcore- oder Multicore-Prozessor
+
+</td></tr>
+<tr><td align=right>1</td><td align=right>2.56</td><td align=left>... auf einem GP2X
+</td></tr>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>... auf einem anderen Handheld</td></tr>
+</table></p>
+<h3>Wie finden Sie den Schwierigkeitsgrad der Level?</h3>
+
+<p>(Mehrfachauswahl m&ouml;glich)</p>
+<p>Insgesamt 37 Stimmen plus 8 leere Stimmen.</p>
+
+<p><table border=1>
+<tr><th align=right>Stimmen</th><th align=right><b>Anteil</b></th>
+<th align=left></th></tr>
+<tr><td align=right>9</td><td align=right>24.32</td><td align=left>Sie sollten im Schnitt einfacher sein.
+</td></tr>
+<tr><td align=right>3</td><td align=right>8.11</td><td align=left>Sie sollten im Schnitt schwieriger sein.
+</td></tr>
+<tr><td align=right>8</td><td align=right>21.62</td><td align=left>Die Schwierigkeit sollte nicht so stark streuen.
+</td></tr>
+
+<tr><td align=right>6</td><td align=right>16.22</td><td align=left>Die Schwierigkeit sollte st&auml;rker streuen.
+</td></tr>
+<tr><td align=right>16</td><td align=right>43.24</td><td align=left>Nichts von alledem.</td></tr>
+</table></p>
+<h3>Von welcher Art w&uuml;rden Sie sich gerne noch mehr Levels w&uuml;nschen?</h3>
+
+<p>(relativ zu den &uuml;brigen)</p>
+
+<p>Insgesamt 37 Stimmen plus 8 leere Stimmen.</p>
+<p><table border=1>
+<tr><th align=right>Stimmen</th><th align=right><b>Anteil</b></th>
+<th align=left></th></tr>
+<tr><td align=right>20</td><td align=right>54.05</td><td align=left>kleine, schnell spielbare Knobellevel
+</td></tr>
+<tr><td align=right>5</td><td align=right>13.51</td><td align=left>Level, die viel Geschicklichkeit verlangen
+</td></tr>
+<tr><td align=right>22</td><td align=right>59.46</td><td align=left>Level zum Erforschen neuer Kombinationen und Features von Spielobjekten
+
+</td></tr>
+<tr><td align=right>14</td><td align=right>37.84</td><td align=left>gro&szlig;e Adventurelevel, bei denen man erstmal alle R&auml;ume erforschen muss
+</td></tr>
+<tr><td align=right>5</td><td align=right>13.51</td><td align=left>gr&ouml;&szlig;ere, schwierige Knobellevel
+</td></tr>
+<tr><td align=right>12</td><td align=right>32.43</td><td align=left>andere Leveltypen
+</td></tr>
+<tr><td align=right>7</td><td align=right>18.92</td><td align=left>Der aktuelle Mix ist perfekt.</td></tr>
+
+</table></p>
+<h3>Sch&auml;tzen Sie bitte, welchen Anteil aller Levels Sie ernsthaft versucht haben, zu l&ouml;sen.</h3>
+
+<p>(Dies umfasst nat&uuml;rlich auch gel&ouml;ste Levels.)</p>
+<p>Insgesamt 37 Stimmen plus 8 leere Stimmen.</p>
+<p><table border=1>
+<tr><th align=right>Stimmen</th><th align=right><b>Anteil</b></th>
+<th align=left></th></tr>
+
+<tr><td align=right>12</td><td align=right>32.43</td><td align=left>90% - 100%
+</td></tr>
+<tr><td align=right>10</td><td align=right>27.03</td><td align=left>50% - 70%
+</td></tr>
+<tr><td align=right>7</td><td align=right>18.92</td><td align=left>70% - 90%
+</td></tr>
+<tr><td align=right>3</td><td align=right>8.11</td><td align=left>30% - 50%
+</td></tr>
+<tr><td align=right>3</td><td align=right>8.11</td><td align=left>10% - 30%
+
+</td></tr>
+<tr><td align=right>1</td><td align=right>2.70</td><td align=left>Keine Antwort.</td></tr>
+<tr><td align=right>1</td><td align=right>2.70</td><td align=left>0% - 10%
+</td></tr>
+</table></p>
+<h3>Wie wichtig sind Ihnen die folgenden Informationskan&auml;le f&uuml;r Enigma?</h3>
+
+<p>5 = sehr wichtig, 1 = unwichtig</p>
+
+<p>Insgesamt 34 Stimmen plus 9 leere Stimmen.</p>
+<p><table border=1>
+<tr><th align=right>Punkte</th><th align=right>Stimmen</th>
+<th align=right><b>Durchschnitt</b></th>
+<th align=left></th></tr>
+<tr><td align=right>127</td><td align=right>31</td><td align=right>4.097</td><td align=left>mag-heut.net
+</td></tr>
+<tr><td align=right>138</td><td align=right>34</td><td align=right>4.059</td><td align=left>Homepage
+
+</td></tr>
+<tr><td align=right>83</td><td align=right>29</td><td align=right>2.862</td><td align=left>Developer-Mailingliste
+</td></tr>
+<tr><td align=right>66</td><td align=right>24</td><td align=right>2.750</td><td align=left>private Kommunikation, &quot;Mundpropaganda&quot;
+</td></tr>
+<tr><td align=right>24</td><td align=right>10</td><td align=right>2.400</td><td align=left>Anderes</td></tr>
+
+<tr><td align=right>47</td><td align=right>22</td><td align=right>2.136</td><td align=left>Announcement-Mailingliste
+</td></tr>
+<tr><td align=right>38</td><td align=right>24</td><td align=right>1.583</td><td align=left>Yahoo Oxyd Gruppe
+</td></tr>
+</table></p>
+<h3>Welches sollten unsere Priorit&auml;ten f&uuml;r die weitere Entwicklung von Enigma sein?</h3>
+
+<p>Bitte sortieren Sie die 10 Arbeitsfelder unten in die Priorit&auml;ten 1 (=hoch) bis 10 (=niedrig) ein. Bitte nur eine Priorit&auml;t pro Arbeitsfeld.</p>
+
+<p>Insgesamt 34 Stimmen, einschlie&szlig;lich 9 Teilstimmen (Stimmen, in denen
+nicht jeder Bereich eine Priorit&auml;t zugeordnet bekam).</p>
+
+<p>Ohne Teilstimmen:</p>
+<p><table border=1>
+<tr><th align=right>Punkte</th>
+<th align=left></th></tr>
+<tr><td align=right>186</td><td align=left>viele neue Level
+</td></tr>
+<tr><td align=right>167</td><td align=left>Fehler-Beseitigung
+</td></tr>
+<tr><td align=right>165</td><td align=left>viele neue Objekte
+
+</td></tr>
+<tr><td align=right>158</td><td align=left>ein Leveleditor</td></tr>
+<tr><td align=right>139</td><td align=left>Backstage Infos und Events wie LotM
+</td></tr>
+<tr><td align=right>131</td><td align=left>ein Netzwerkmodus zum Spielen eines Levels zu zweit
+</td></tr>
+<tr><td align=right>128</td><td align=left>das Abspeichern und Fortsetzen eines Levels w&auml;hrend der Erforschungsphase (nicht beim Scoren)
+</td></tr>
+<tr><td align=right>128</td><td align=left>neue Graphiken und Sounds
+</td></tr>
+
+<tr><td align=right>92</td><td align=left>Unterst&uuml;tzung und Veranstaltung von Enigma Spielwettbewerben
+</td></tr>
+<tr><td align=right>81</td><td align=left>Portierung auf andere Plattformen
+</td></tr>
+</table></p>
+<p><table border=1><tr>
+<th align=right>1</th>
+<th align=right>2</th>
+<th align=right>3</th>
+<th align=right>4</th>
+
+<th align=right>5</th>
+<th align=right>6</th>
+<th align=right>7</th>
+<th align=right>8</th>
+<th align=right>9</th>
+<th align=right>10</th>
+<th align=right>Summe</th><th align=right></th></tr>
+<tr>
+<td align=right>4</td>
+
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right>6</td>
+<td align=right>3</td>
+<td align=right>4</td>
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right>1</td>
+<td align=right>1</td>
+
+<td align=right>25</td>
+<td align=left>ein Leveleditor</td></tr>
+<tr>
+<td align=right>7</td>
+<td align=right>6</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>1</td>
+<td align=right>1</td>
+
+<td align=right></td>
+<td align=right>1</td>
+<td align=right></td>
+<td align=right>3</td>
+<td align=right>25</td>
+<td align=left>viele neue Level
+</td></tr>
+<tr>
+<td align=right>2</td>
+<td align=right>2</td>
+<td align=right>2</td>
+
+<td align=right>1</td>
+<td align=right>4</td>
+<td align=right>5</td>
+<td align=right>4</td>
+<td align=right>3</td>
+<td align=right>2</td>
+<td align=right></td>
+<td align=right>25</td>
+<td align=left>Backstage Infos und Events wie LotM
+</td></tr>
+
+<tr>
+<td align=right>3</td>
+<td align=right>4</td>
+<td align=right>4</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>2</td>
+<td align=right>3</td>
+<td align=right></td>
+<td align=right>3</td>
+
+<td align=right></td>
+<td align=right>25</td>
+<td align=left>viele neue Objekte
+</td></tr>
+<tr>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right>4</td>
+<td align=right>4</td>
+
+<td align=right>5</td>
+<td align=right>5</td>
+<td align=right>3</td>
+<td align=right>25</td>
+<td align=left>Unterst&uuml;tzung und Veranstaltung von Enigma Spielwettbewerben
+</td></tr>
+<tr>
+<td align=right>2</td>
+<td align=right>5</td>
+<td align=right>5</td>
+
+<td align=right>2</td>
+<td align=right>4</td>
+<td align=right>2</td>
+<td align=right>1</td>
+<td align=right>3</td>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right>25</td>
+<td align=left>Fehler-Beseitigung
+</td></tr>
+
+<tr>
+<td align=right>1</td>
+<td align=right></td>
+<td align=right>3</td>
+<td align=right>5</td>
+<td align=right>3</td>
+<td align=right></td>
+<td align=right>8</td>
+<td align=right>1</td>
+<td align=right>2</td>
+
+<td align=right>2</td>
+<td align=right>25</td>
+<td align=left>das Abspeichern und Fortsetzen eines Levels w&auml;hrend der Erforschungsphase (nicht beim Scoren)
+</td></tr>
+<tr>
+<td align=right>1</td>
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right></td>
+<td align=right>2</td>
+
+<td align=right>1</td>
+<td align=right></td>
+<td align=right>3</td>
+<td align=right>5</td>
+<td align=right>10</td>
+<td align=right>25</td>
+<td align=left>Portierung auf andere Plattformen
+</td></tr>
+<tr>
+<td align=right>2</td>
+<td align=right>3</td>
+
+<td align=right>2</td>
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right>4</td>
+<td align=right>1</td>
+<td align=right>4</td>
+<td align=right>4</td>
+<td align=right>2</td>
+<td align=right>25</td>
+
+<td align=left>neue Graphiken und Sounds
+</td></tr>
+<tr>
+<td align=right>3</td>
+<td align=right>2</td>
+<td align=right>2</td>
+<td align=right>3</td>
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right>3</td>
+
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>25</td>
+<td align=left>ein Netzwerkmodus zum Spielen eines Levels zu zweit
+</td></tr>
+</table></p>
+<p>Mit Teilstimmen:</p>
+<p><table border=1>
+<tr><th align=right>Punkte</th>
+<th align=left></th></tr>
+
+<tr><td align=right>224</td><td align=left>viele neue Level
+</td></tr>
+<tr><td align=right>223</td><td align=left>ein Leveleditor</td></tr>
+<tr><td align=right>196</td><td align=left>ein Netzwerkmodus zum Spielen eines Levels zu zweit
+</td></tr>
+<tr><td align=right>195</td><td align=left>viele neue Objekte
+</td></tr>
+<tr><td align=right>194</td><td align=left>Fehler-Beseitigung
+</td></tr>
+<tr><td align=right>183</td><td align=left>das Abspeichern und Fortsetzen eines Levels w&auml;hrend der Erforschungsphase (nicht beim Scoren)
+
+</td></tr>
+<tr><td align=right>168</td><td align=left>neue Graphiken und Sounds
+</td></tr>
+<tr><td align=right>161</td><td align=left>Backstage Infos und Events wie LotM
+</td></tr>
+<tr><td align=right>107</td><td align=left>Unterst&uuml;tzung und Veranstaltung von Enigma Spielwettbewerben
+</td></tr>
+<tr><td align=right>88</td><td align=left>Portierung auf andere Plattformen
+</td></tr>
+</table></p>
+<p><table border=1><tr>
+<th align=right>1</th>
+
+<th align=right>2</th>
+<th align=right>3</th>
+<th align=right>4</th>
+<th align=right>5</th>
+<th align=right>6</th>
+<th align=right>7</th>
+<th align=right>8</th>
+<th align=right>9</th>
+<th align=right>10</th>
+
+<th align=right>Sum</th><th align=right></th></tr>
+<tr>
+<td align=right>6</td>
+<td align=right>5</td>
+<td align=right>2</td>
+<td align=right>6</td>
+<td align=right>3</td>
+<td align=right>5</td>
+<td align=right>2</td>
+
+<td align=right>2</td>
+<td align=right>1</td>
+<td align=right>1</td>
+<td align=right>33</td>
+<td align=left>ein Leveleditor</td></tr>
+<tr>
+<td align=right>6</td>
+<td align=right>2</td>
+<td align=right>4</td>
+
+<td align=right>4</td>
+<td align=right>2</td>
+<td align=right>2</td>
+<td align=right>3</td>
+<td align=right>5</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>34</td>
+<td align=left>ein Netzwerkmodus zum Spielen eines Levels zu zweit
+
+</td></tr>
+<tr>
+<td align=right>2</td>
+<td align=right>4</td>
+<td align=right>3</td>
+<td align=right>2</td>
+<td align=right>3</td>
+<td align=right>4</td>
+<td align=right>3</td>
+<td align=right>4</td>
+
+<td align=right>5</td>
+<td align=right>2</td>
+<td align=right>32</td>
+<td align=left>neue Graphiken und Sounds
+</td></tr>
+<tr>
+<td align=right>2</td>
+<td align=right>6</td>
+<td align=right>5</td>
+<td align=right>3</td>
+
+<td align=right>4</td>
+<td align=right>2</td>
+<td align=right>3</td>
+<td align=right>4</td>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right>30</td>
+<td align=left>Fehler-Beseitigung
+</td></tr>
+<tr>
+<td align=right>1</td>
+
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right></td>
+<td align=right>2</td>
+<td align=right>1</td>
+<td align=right>1</td>
+<td align=right>3</td>
+<td align=right>6</td>
+<td align=right>11</td>
+
+<td align=right>28</td>
+<td align=left>Portierung auf andere Plattformen
+</td></tr>
+<tr>
+<td align=right>3</td>
+<td align=right>4</td>
+<td align=right>5</td>
+<td align=right>5</td>
+<td align=right>3</td>
+<td align=right>3</td>
+
+<td align=right>3</td>
+<td align=right>1</td>
+<td align=right>3</td>
+<td align=right></td>
+<td align=right>30</td>
+<td align=left>viele neue Objekte
+</td></tr>
+<tr>
+<td align=right>3</td>
+<td align=right>1</td>
+<td align=right>5</td>
+
+<td align=right>6</td>
+<td align=right>3</td>
+<td align=right></td>
+<td align=right>8</td>
+<td align=right>1</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>33</td>
+<td align=left>das Abspeichern und Fortsetzen eines Levels w&auml;hrend der Erforschungsphase (nicht beim Scoren)
+
+</td></tr>
+<tr>
+<td align=right>2</td>
+<td align=right>2</td>
+<td align=right>3</td>
+<td align=right>1</td>
+<td align=right>5</td>
+<td align=right>6</td>
+<td align=right>4</td>
+<td align=right>4</td>
+
+<td align=right>2</td>
+<td align=right></td>
+<td align=right>29</td>
+<td align=left>Backstage Infos und Events wie LotM
+</td></tr>
+<tr>
+<td align=right>8</td>
+<td align=right>6</td>
+<td align=right>3</td>
+<td align=right>3</td>
+<td align=right>4</td>
+
+<td align=right>3</td>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right></td>
+<td align=right>3</td>
+<td align=right>31</td>
+<td align=left>viele neue Level
+</td></tr>
+<tr>
+<td align=right></td>
+<td align=right>1</td>
+<td align=right></td>
+
+<td align=right>1</td>
+<td align=right>2</td>
+<td align=right>5</td>
+<td align=right>5</td>
+<td align=right>6</td>
+<td align=right>6</td>
+<td align=right>4</td>
+<td align=right>30</td>
+<td align=left>Unterst&uuml;tzung und Veranstaltung von Enigma Spielwettbewerben
+
+</td></tr>
+</table></p>
+
+<h3>Sprachverh&auml;ltnis</h3>
+<p><ul>
+<li>Englisch: 269</li>
+<li>Deutsch: 356</li>
+<li><b>Insgesamt: 625</b></li></ul></p>
+
+<h3>Datums-Statistik</h3>
+
+<p>Bitte beachten Sie, dass diese Tabelle (im Gegensatz zu allen vorherigen)
+auch Eintragskorrekturen gesondert als Eintrag mitz&auml;hlt. Die Spalte
+&quot;Frage X&quot; gibt dabei an, wieviele Nutzer auf einen der
+Best&auml;tigungs-Kn&ouml;pfe im entsprechenden Fragebogen gedr&uuml;ckt haben.
+&quot;Frage 1&quot; ist die Frage nach dem besten Onescreener, &quot;Frage
+9&quot; die nach dem Betriebssystem.</p>
+
+<p><table border=1>
+<tr><th align=right><b>Datum</b></th><th align=right><b>Eintr&auml;ge</b></th><th align=right>Frage 1</th><th align=right>Frage 9</th></tr>
+
+<tr><td align=right>2007-11-20</td><td align=right>71</td>
+<td align=right>8</td>
+<td align=right>4</td></tr>
+<tr><td align=right>2007-11-21</td><td align=right>134</td>
+<td align=right>14</td>
+<td align=right>8</td></tr>
+<tr><td align=right>2007-11-22</td><td align=right>66</td>
+
+<td align=right>7</td>
+<td align=right>4</td></tr>
+<tr><td align=right>2007-11-23</td><td align=right>20</td>
+<td align=right>3</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-11-24</td><td align=right>5</td>
+<td align=right>1</td>
+<td align=right>0</td></tr>
+
+<tr><td align=right>2007-11-25</td><td align=right>54</td>
+<td align=right>1</td>
+<td align=right>3</td></tr>
+<tr><td align=right>2007-11-26</td><td align=right>27</td>
+<td align=right>3</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-11-27</td><td align=right>37</td>
+
+<td align=right>5</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-11-28</td><td align=right>20</td>
+<td align=right>2</td>
+<td align=right>1</td></tr>
+<tr><td align=right>2007-11-29</td><td align=right>3</td>
+<td align=right>1</td>
+<td align=right>0</td></tr>
+
+<tr><td align=right>2007-11-30</td><td align=right>32</td>
+<td align=right>4</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-12-01</td><td align=right>36</td>
+<td align=right>3</td>
+<td align=right>3</td></tr>
+<tr><td align=right>2007-12-02</td><td align=right>42</td>
+
+<td align=right>3</td>
+<td align=right>3</td></tr>
+<tr><td align=right>2007-12-03</td><td align=right>26</td>
+<td align=right>3</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-12-04</td><td align=right>3</td>
+<td align=right>-</td>
+<td align=right>0</td></tr>
+
+<tr><td align=right>2007-12-05</td><td align=right>2</td>
+<td align=right>1</td>
+<td align=right>0</td></tr>
+<tr><td align=right>2007-12-06</td><td align=right>24</td>
+<td align=right>2</td>
+<td align=right>1</td></tr>
+<tr><td align=right>2007-12-07</td><td align=right>6</td>
+
+<td align=right>-</td>
+<td align=right>0</td></tr>
+<tr><td align=right>2007-12-08</td><td align=right>30</td>
+<td align=right>2</td>
+<td align=right>2</td></tr>
+<tr><td align=right>2007-12-09</td><td align=right>25</td>
+<td align=right>2</td>
+<td align=right>2</td></tr>
+
+<tr><td align=right>2007-12-10</td><td align=right>5</td>
+<td align=right>1</td>
+<td align=right>0</td></tr>
+<tr><td align=right>2007-12-11</td><td align=right>16</td>
+<td align=right>1</td>
+<td align=right>1</td></tr>
+<tr><td align=right>2007-12-12</td><td align=right>12</td>
+
+<td align=right>1</td>
+<td align=right>1</td></tr>
+<tr><td align=right>2007-12-13</td><td align=right>12</td>
+<td align=right>1</td>
+<td align=right>1</td></tr>
+<tr><td align=right>2007-12-14</td><td align=right>19</td>
+<td align=right>2</td>
+<td align=right>2</td></tr>
+
+<tr><td align=right>2007-12-15</td><td align=right>1</td>
+<td align=right>-</td>
+<td align=right>0</td></tr>
+<tr><td align=right>2007-12-16</td><td align=right>1</td>
+<td align=right>1</td>
+<td align=right>0</td></tr>
+<tr><td align=right><b>Summe</b></td><td align=right>729</td>
+
+<td align=right>72</td>
+<td align=right>46</td></tr>
+</table></p>
+
+<p><a href="$$eoya_2007$$">Zur&uuml;ck zum Artikel.</a></p>

Modified: homepage/input/output-files.lua
===================================================================
--- homepage/input/output-files.lua	2008-01-05 15:08:26 UTC (rev 971)
+++ homepage/input/output-files.lua	2008-01-06 01:45:12 UTC (rev 972)
@@ -475,11 +475,11 @@
 
 html.eoya_2007_statistics = {
     outfile = "eoya_2007_statistics.html",
-    title = "End of Year Awards 2007 - Statistiken",
-    title_de = "Jahresendauszeichnungen 2007 - Statistiken",
+    title = "End of Year Awards 2007 - Pure Statistics",
+    title_de = "Jahresendauszeichnungen 2007 - Pure Statistiken",
     --ru-- title_ru = "End of Year Awards 2007",
     --es-- title_es = "End of Year Awards 2007",
     rightcolumn = {},
-    body = {} --{"articles/eoya_2007_statistics"}
+    body = {"articles/eoya_2007_statistics"}
 }
 



From ral at mail.berlios.de  Sun Jan  6 10:55:14 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 6 Jan 2008 10:55:14 +0100
Subject: [Enigma-game-svn] r973 - in trunk: data src src/stones
Message-ID: <200801060955.m069tE21029361@sheep.berlios.de>

Author: ral
Date: 2008-01-06 10:55:13 +0100 (Sun, 06 Jan 2008)
New Revision: 973

Modified:
   trunk/data/init.lua
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.cc
   trunk/src/stones/OxydStone.cc
   trunk/src/stones/Switch.cc
   trunk/src/stones/Switch.hh
Log:
Trunk 1.1: 
- fix black-/whitestone: no actor color check on signal messages
- fix oxydstone: eat up signals with 0 values
- switch: add attribute "instant" - action prior animation, default old API
- switch: special Oxyd signal(1) handling


Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-06 01:45:12 UTC (rev 972)
+++ trunk/data/init.lua	2008-01-06 09:55:13 UTC (rev 973)
@@ -45,9 +45,9 @@
 
 RenamingObjectsNew2Old = {
     st_fourswitch = "st-fourswitch",
-    st_switch = "st-switch",
-    st_switch_black = "st-switch_black",
-    st_switch_white = "st-switch_white"
+    st_switch_instant = "st-switch",
+    st_switch_black_instant = "st-switch_black",
+    st_switch_white_instant = "st-switch_white"
 }
 
 for k,v in pairs(RenamingObjectsNew2Old) do
@@ -143,9 +143,9 @@
 end
 
 MessageRenaming = {
-    st_switch__onoff = "toggle",
-    st_switch_black__onoff = "toggle",
-    st_switch_white__onoff = "toggle"
+    st_switch_instant__onoff = "toggle",
+    st_switch_black_instant__onoff = "toggle",
+    st_switch_white_instant__onoff = "toggle"
 }
 ----------------------
 -- old API 1.0      --

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-01-06 01:45:12 UTC (rev 972)
+++ trunk/src/ox_extra.cc	2008-01-06 09:55:13 UTC (rev 973)
@@ -162,7 +162,7 @@
     "st-plain_hole",     // OxydExtra stone 0x25
     "st-plain_move",     // OxydExtra stone 0x26
     "st-wood",           // OxydExtra stone 0x27
-    "st_switch",         // OxydExtra stone 0x28
+    "st_switch_instant", // OxydExtra stone 0x28
     UNUSED,              // OxydExtra stone 0x29
     UNUSED,              // OxydExtra stone 0x2a
     UNUSED,              // OxydExtra stone 0x2b

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-01-06 01:45:12 UTC (rev 972)
+++ trunk/src/ox_magnum.cc	2008-01-06 09:55:13 UTC (rev 973)
@@ -166,7 +166,7 @@
     "st-plain_hole",            // OxydMagnum stone 0x29
     "st-plain_move",            // OxydMagnum stone 0x2a
     "st-wood",                  // OxydMagnum stone 0x2b
-    "st_switch",                // OxydMagnum stone 0x2c
+    "st_switch_instant",        // OxydMagnum stone 0x2c
     "st-floppy",                // OxydMagnum stone 0x2d (in normal Oxyd Magnum Levels unused!)
     UNUSED,                     // OxydMagnum stone 0x2e
     "st_fourswitch",            // OxydMagnum stone 0x2f (Level 89 and 92)

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-01-06 01:45:12 UTC (rev 972)
+++ trunk/src/ox_oxyd1.cc	2008-01-06 09:55:13 UTC (rev 973)
@@ -196,9 +196,9 @@
     "st-plain_hole",            // Oxyd1 stone 0x29
     "st-plain_move",            // Oxyd1 stone 0x2a
     "st-wood",                  // Oxyd1 stone 0x2b
-    "st_switch",                // Oxyd1 stone 0x2c
-    "st_switch_black",          // Oxyd1 stone 0x2d
-    "st_switch_white",          // Oxyd1 stone 0x2e
+    "st_switch_instant",        // Oxyd1 stone 0x2c
+    "st_switch_black_instant",  // Oxyd1 stone 0x2d
+    "st_switch_white_instant",  // Oxyd1 stone 0x2e
     "st_fourswitch",            // Oxyd1 stone 0x2f
     "st-key",                   // Oxyd1 stone 0x30
     "st-floppy",                // Oxyd1 stone 0x31

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-01-06 01:45:12 UTC (rev 972)
+++ trunk/src/ox_peroxyd.cc	2008-01-06 09:55:13 UTC (rev 973)
@@ -234,9 +234,9 @@
     "st-bluegray_hole",         // PerOxyd stone 0x25
     "st-plain_move",            // PerOxyd stone 0x26
     "st-wood",                  // PerOxyd stone 0x27
-    "st_switch",                // PerOxyd stone 0x28
-    "st_switch_black",          // PerOxyd stone 0x29
-    "st_switch_white",          // PerOxyd stone 0x2a
+    "st_switch_instant",        // PerOxyd stone 0x28
+    "st_switch_black_instant",  // PerOxyd stone 0x29
+    "st_switch_white_instant",  // PerOxyd stone 0x2a
     "st_fourswitch",            // PerOxyd stone 0x2b
     "st-key",                   // PerOxyd stone 0x2c
     "st-floppy",                // PerOxyd stone 0x2d

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-01-06 01:45:12 UTC (rev 972)
+++ trunk/src/stones/OxydStone.cc	2008-01-06 09:55:13 UTC (rev 973)
@@ -867,8 +867,9 @@
             tryOpen();
             return Value();
         }
-        else if (m.message == "signal" && m.value != 0) {
-            tryOpen();
+        else if (m.message == "signal") {
+            if (m.value != 0)
+                tryOpen();
             return Value();
         }
         else if (m.message == "init") {

Modified: trunk/src/stones/Switch.cc
===================================================================
--- trunk/src/stones/Switch.cc	2008-01-06 01:45:12 UTC (rev 972)
+++ trunk/src/stones/Switch.cc	2008-01-06 09:55:13 UTC (rev 973)
@@ -20,11 +20,14 @@
 
 #include "stones/Switch.hh"
 //#include "main.hh"
+#include "server.hh"
 
 namespace enigma {
-    Switch::Switch(Value v) : Stone () {
-        if (v.getType() != Value::NIL)
-            set_attrib("color", v);
+    Switch::Switch(Value color, bool instant) : Stone () {
+        if (color.getType() != Value::NIL)
+            set_attrib("color", color);
+        if (instant)
+            set_attrib("instant", true);
         state = OFF;
     }
 
@@ -38,8 +41,23 @@
         Stone::set_attrib(key, val);
     }
     
+    Value Switch::message(const Message &m) {
+        if (m.message == "signal" && server::GameCompatibility == GAMET_OXYD1 
+                && m.value == 1) {  // other signal messages are handled in superclasses
+            if (state != ON)
+                setState(1);
+            else
+                performAction(true);  // Oxyd special
+            return Value();
+        }
+        return Stone::message(m);
+    }
+    
     int Switch::externalState() const {
-        return state % 2;   // 0 for OFF, TURNON, 1 for ON, TURNOFF
+        if (isInstant())
+            return state == ON || state == TURNON;
+        else
+            return state % 2;   // 0 for OFF, TURNON, 1 for ON, TURNOFF
     }
     
     void Switch::setState(int extState) {
@@ -48,12 +66,18 @@
                 sound_event ("switchon");
                 state += 2;  // OFF->TURNON, ON->TURNOFF
                 set_anim(ecl::strf("st-switch%s%s", colorName(), extState ? "-turnon" : "-turnoff"));
+                if (isInstant())
+                    performAction(externalState() == ON);   // immediate action
             } else if (state == TURNON && extState == OFF) {
                 state = TURNOFF;
                 get_model()->reverse();  // reverse anim
+                if (isInstant())
+                    performAction(false);   // immediate action
             } else if (state == TURNOFF && extState == ON) {
                 state = TURNON;
                 get_model()->reverse();  // reverse anim
+                if (isInstant())
+                    performAction(true);   // immediate action
             }
         } else  // object initialisation
             state = extState;
@@ -66,7 +90,8 @@
     void Switch::animcb() {
         state = TURNOFF - state;
         init_model();
-        performAction(state == ON);   // action after state is reached
+        if (!isInstant())
+            performAction(state == ON);   // action after state is reached
     }
     
     void Switch::actor_hit(const StoneContact &sc) {
@@ -96,16 +121,30 @@
         return "";
     }
     
-    StoneTraits Switch::traits[3] = {
+    bool Switch::isInstant() const {
+        return getDefaultedAttr("instant", false).to_bool();
+    }
+    
+    int Switch::traitsIdx() const {
+        return iColor() + (isInstant() ? 3 : 0);
+    }
+    
+    StoneTraits Switch::traits[6] = {
         {"st_switch", st_switch, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
         {"st_switch_black", st_switch, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
         {"st_switch_white", st_switch, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_switch_instant", st_switch, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_switch_instantblack", st_switch, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_switch_instantwhite", st_switch, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
     };
     
     BOOT_REGISTER_START
         BootRegister(new Switch(Value()), "st_switch");
         BootRegister(new Switch(Value(0)), "st_switch_black");
         BootRegister(new Switch(Value(1)), "st_switch_white");
+        BootRegister(new Switch(Value(), true), "st_switch_instant");
+        BootRegister(new Switch(Value(0), true), "st_switch_black_instant");
+        BootRegister(new Switch(Value(1), true), "st_switch_white_instant");
     BOOT_REGISTER_END
 
 } // namespace enigma

Modified: trunk/src/stones/Switch.hh
===================================================================
--- trunk/src/stones/Switch.hh	2008-01-06 01:45:12 UTC (rev 972)
+++ trunk/src/stones/Switch.hh	2008-01-06 09:55:13 UTC (rev 973)
@@ -39,15 +39,17 @@
      */
     class Switch : public Stone {
         CLONEOBJ(Switch);
-        DECL_TRAITS_ARRAY(3, iColor());
+        DECL_TRAITS_ARRAY(6, traitsIdx());
     private:
         enum iState { OFF, ON, TURNON, TURNOFF };  // sequence is essential!
     public:
-        Switch(Value v);
+        Switch(Value color, bool instant = false);
         
         // Object interface
         virtual void set_attrib(const string& key, const Value &val);
+        virtual Value message(const Message &m);
         
+        // StateObject interface
         virtual int externalState() const;
         virtual void setState(int extState);
 
@@ -64,6 +66,8 @@
     private:
         int iColor() const;
         const char* colorName() const;
+        bool isInstant() const;
+        int traitsIdx() const;
     };
 
 } // namespace enigma

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-01-06 01:45:12 UTC (rev 972)
+++ trunk/src/stones.cc	2008-01-06 09:55:13 UTC (rev 973)
@@ -889,10 +889,10 @@
                     if (m.message == "hit")
                         o = m.value;
                     else
-                        o= SendMessage(m.sender, "_hitactor");
+                        o = SendMessage(m.sender, "_hitactor");
                     
                     Actor *a = dynamic_cast<Actor *>(o);
-                    if (a && get_id(a) == ac_blackball) {
+                    if ((a && get_id(a) == ac_blackball) || (m.message == "signal")) {
                         if (p.y == sender->get_pos().y) {
                             SendMessage (GetStone (move (p, EAST)),  "signal", 1.0);
                             SendMessage (GetStone (move (p, WEST)),  "signal", 1.0);
@@ -931,7 +931,7 @@
                         o = SendMessage(m.sender, "_hitactor");
                         
                     Actor *a = dynamic_cast<Actor *>(o);
-                    if (a && get_id(a) == ac_whiteball) {
+                    if ((a && get_id(a) == ac_whiteball) || (m.message == "signal")) {
                         if (p.y == sender->get_pos().y) {
                             SendMessage (GetStone (move (p, EAST)),  "signal", 1.0);
                             SendMessage (GetStone (move (p, WEST)),  "signal", 1.0);



From raoul at mail.berlios.de  Sun Jan  6 14:22:20 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sun, 6 Jan 2008 14:22:20 +0100
Subject: [Enigma-game-svn] r974 - homepage/input/articles
Message-ID: <200801061322.m06DMKBv027731@sheep.berlios.de>

Author: raoul
Date: 2008-01-06 14:22:19 +0100 (Sun, 06 Jan 2008)
New Revision: 974

Modified:
   homepage/input/articles/eoya_2007.html
   homepage/input/articles/eoya_2007_ru.html
   homepage/input/articles/eoya_2007_statistics.html
   homepage/input/articles/eoya_2007_statistics_de.html
Log:
-> Validated statistics


Modified: homepage/input/articles/eoya_2007.html
===================================================================
--- homepage/input/articles/eoya_2007.html	2008-01-06 09:55:13 UTC (rev 973)
+++ homepage/input/articles/eoya_2007.html	2008-01-06 13:22:19 UTC (rev 974)
@@ -147,7 +147,7 @@
 therefore even more impressive!  And it appears unlikely that things
 will change: if the past six years are indicative of the future,
 Enigma aficionados will have to solve at least one level every two
-days just to keep up with the new ones&hellip;
+days just to keep up with the new ones &hellip;
 
 </div>
 
@@ -177,7 +177,7 @@
 all-time favourite level created by one of Enigma's master level
 designers.  It's sprawling maze filled with puzzles, suprises and
 dangers, and solving it should definitely be on your list of New
-Year's resolutions, if it isn't already&hellip;</div>
+Year's resolutions, if it isn't already &hellip;</div>
 
 
 <div class="quote">

Modified: homepage/input/articles/eoya_2007_ru.html
===================================================================
--- homepage/input/articles/eoya_2007_ru.html	2008-01-06 09:55:13 UTC (rev 973)
+++ homepage/input/articles/eoya_2007_ru.html	2008-01-06 13:22:19 UTC (rev 974)
@@ -12,7 +12,7 @@
 
 </p>
 
-<p>?????????? ??????????? (69%) ???? ??????? ?????????? Windows 2000 ??? XP, ????? ?????? ? ?????-???? Linux. ????? ?????????? ?????? Linux - Debian ? Ubuntu. ?????? ???????????? ???? ??????? ? ???, ??? ? ??? ???? ?????? ??????? ?????????? Windows 95/98 ??? ME (6 ?? 39), ? ?? Vista (3 ?? 39). 3 ?? 39 ??????? ?????????? Mac OS (&quot;Tiger&quot; 1 vs. &quot;Panther&quot; 2). ???? ????? ?????????? (?????? ? Windows) ????????? ?????? ???????????? ???????, ? ? ??? ??? ?????, ??? ??? ????? ???? ?? ??????? ... ???????, 2 ?? 39 ?????????? dualcore, ? 1 ?????????? gp2x.
+<p>?????????? ??????????? (69%) ???? ??????? ?????????? Windows 2000 ??? XP, ????? ?????? ? ?????-???? Linux. ????? ?????????? ?????? Linux - Debian ? Ubuntu. ?????? ???????????? ???? ??????? ? ???, ??? ? ??? ???? ?????? ??????? ?????????? Windows 95/98 ??? ME (6 ?? 39), ? ?? Vista (3 ?? 39). 3 ?? 39 ??????? ?????????? Mac OS (&quot;Tiger&quot; 1 vs. &quot;Panther&quot; 2). ???? ????? ?????????? (?????? ? Windows) ????????? ?????? ???????????? ???????, ? ? ??? ??? ?????, ??? ??? ????? ???? ?? ??????? &hellip; ???????, 2 ?? 39 ?????????? dualcore, ? 1 ?????????? gp2x.
 ?????????? ????????????? 95/98/ME ? Panther ???? ??? ??????, ??? ??? ????? ?????????????? ???????? Enigma, ????? ??? ?????????? ????????? ???????? ???? ?? ???????????, ??????? ??? ????????? ???, ? ??????? ??? ????? ????????? ????????? ??? ???? ?????? ? ????????? ????????.</p>
 
 <p>????? ??????? ?????????? ?????? ?? ?????? ? ????????? ???????. ?? ???????? 37 ??????? ?? ???? ?????? ? ????? ???????? (16) ????????, ??? ?? ?????????? ??? ? ???????. ??????, 9 ???????, ??? ?????? ?????? ???? ?????, ? ?? ?????, ??? 3 ?????? ????? ?? ??? ?????? ?????????. ?????? ? ???????? ????????? ??????????? ????? ??????? - 8 ?????, ????? ??????? ??? ??????, 6 ???????, ??? ?? ?????? ???? ??????.  </p>
@@ -86,7 +86,7 @@
 ??????? ????????? ?????? ??????? ?? ?????? ????????? ?????? 90% ???? ??????? ? ??? ??????????!
 ??????? ?????????????, ??? ???-???? ?????????: ???? ????????? ????????? ????? ??? ????????????? ?? ???????,
 ?? ???????????? Enigma ????? ????? ?????? ???? ?? ???? ??????? ?????? ??? ???, ?????? ????? ??????????
-??? ??????? ???????????...
+??? ??????? ???????????&hellip;
 
 </div>
 
@@ -112,7 +112,7 @@
 ??????? ?? &quot;??????? ???? 2007&quot; ??????? ?????? ?
 ??????????? ???????? ??????, ?????????? ????? ?? ????????-?????????? ??????? Enigma.
 ??? ??????????? ???????? ? ?????????????, ?????????? ? ??????????? ? ?? ??????? ????? 
-?????? ??????? ? ????? ?????? ????? ?? ????? ???, ???? ??? ??? ??? ???...</div>
+?????? ??????? ? ????? ?????? ????? ?? ????? ???, ???? ??? ??? ??? ???&hellip;</div>
 
 
 <div class="quote">
@@ -211,7 +211,7 @@
 
 <p>? ?????, ?? ????? ???? ????? ????????? ????????, ????? ?????? ?????? ?????? ??????? ??????, ????? ????? ??????? ???? 2007: ? &quot;Quadropolis&quot;, ? &quot;Temple of Gold&quot; ??????? &quot;The Aztec Temple&quot;, ? &quot;Houdini&quot;, &quot;Labyrinth of Puzzles&quot;, &quot;The Aztec Temple&quot; ? ???? &quot;Temple of Gold&quot; ???? ?? ?????? ???????? ?? ??? ?? ?????? - ???? ??????? ????? 9.10 ? 9.25! ?? ? ?????, ?? ???? ?? ??? ?? ???? ??????????? ? &quot;Island Labyrinth&quot;: 5 ?? ??? 8 ?????? - ????????? 10 ?????, ???? 9, ???? 8 ? ???? 7, ??? ???????? Jacob Scott ?????????? ????? ?????? ?????? ???? 2007!</p>
 
-<h3>?????????? ...</h3>
+<h3>?????????? &hellip;</h3>
 
 <p>?????? ????? ????? ????? ??????? ?????? ?????? ??????? ?????????? ??? ??, ? ???? ??????? ? ????? 2007: &quot;Island Labyrinth&quot;. ?? ?????? ?????????? ?????? ? ??? <a href="$$lotm_200703$$">?????</a>. ? ?????? ????? ????????????? ???? ??? ?????, ??????? ???????? ??? ? ?????? ???????? ?? ?????????? ????: ?????? ????? ??????? ????, ??? ???????? ???? ???????????; ? ??????: 
 Alejandro Lacava,

Modified: homepage/input/articles/eoya_2007_statistics.html
===================================================================
--- homepage/input/articles/eoya_2007_statistics.html	2008-01-06 09:55:13 UTC (rev 973)
+++ homepage/input/articles/eoya_2007_statistics.html	2008-01-06 13:22:19 UTC (rev 974)
@@ -10,7 +10,7 @@
 <p>You can give each level 1 up to 5 points, 5 is the best. Vote with &quot;-&quot;, if you don't know the level or don't want to judge it.</p>
 
 <p>In total 34 votes plus 37 empty votes.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Points</th><th align=right>Votes</th>
 
 <th align=right><b>Average</b></th>
@@ -50,13 +50,13 @@
 </td></tr>
 <tr><td align=right>64</td><td align=right>26</td><td align=right>2.462</td><td align=left>Island of Safety (V/34)
 </td></tr>
-</table></p>
+</table>
 <h3>Best Levelseries</h3>
 
 <p>Many levels give rise to series in Enigma, which absolutely can be seen as a whole. These series are our next category.</p>
 
 <p>In total 32 votes plus 30 empty votes.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Points</th><th align=right>Votes</th>
 
 <th align=right><b>Average</b></th>
@@ -87,12 +87,12 @@
 </td></tr>
 <tr><td align=right>67</td><td align=right>30</td><td align=right>2.233</td><td align=left>Nightmares (IV/83, 85, 87)
 </td></tr>
-</table></p>
+</table>
 <h3>Best Design</h3>
 
 <p>A level not only impresses with puzzles and challenges, but sometimes with pure beauty to the eye, with elegance and originality.</p>
 <p>In total 33 votes plus 27 empty votes.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Points</th><th align=right>Votes</th>
 <th align=right><b>Average</b></th>
 <th align=left></th></tr>
@@ -129,13 +129,13 @@
 </td></tr>
 <tr><td align=right>65</td><td align=right>29</td><td align=right>2.241</td><td align=left>be quick or be dead (VI/54)
 </td></tr>
-</table></p>
+</table>
 <h3>Funniest Level</h3>
 
 <p>Some levels stand out by their original, amusing or surprising gameplay, they present the light, gladly played entertainment in Enigma.</p>
 
 <p>In total 33 votes plus 22 empty votes.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Points</th><th align=right>Votes</th>
 <th align=right><b>Average</b></th>
 <th align=left></th></tr>
@@ -172,12 +172,12 @@
 
 </td></tr>
 <tr><td align=right>66</td><td align=right>30</td><td align=right>2.200</td><td align=left>Do Not Dive (I/21)</td></tr>
-</table></p>
+</table>
 <h3>Best Yin-Yang Level</h3>
 
 <p>Yin-Yang levels always enjoy great popularity, in which two marbles have to be controlled and must cooperate to solve the puzzles.</p>
 <p>In total 31 votes plus 21 empty votes.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Points</th><th align=right>Votes</th>
 
 <th align=right><b>Average</b></th>
@@ -192,10 +192,10 @@
 </td></tr>
 <tr><td align=right>83</td><td align=right>27</td><td align=right>3.074</td><td align=left>Spacestation (V/99)
 </td></tr>
-</table></p>
+</table>
 <h3>In which version did you first see Enigma?</h3>
 <p>In total 39 votes plus 7 empty votes.</p>
-<p><table border=1>
+<table border=1>
 
 <tr><th align=right>Votes</th><th align=right><b>Percentage</b></th>
 <th align=left></th></tr>
@@ -213,12 +213,12 @@
 <tr><td align=right>2</td><td align=right>5.13</td><td align=left>1.00
 </td></tr>
 <tr><td align=right>1</td><td align=right>2.56</td><td align=left>No answer.</td></tr>
-</table></p>
+</table>
 <h3>On which Operating Systems and computers do you play?</h3>
 
 <p>in alphabetical order ;-)</p>
 <p>In total 39 votes plus 7 empty votes.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Votes</th><th align=right><b>Percentage</b></th>
 <th align=left></th></tr>
 <tr><td align=right>0</td><td align=right>0.00</td><td align=left>BSD-derivative
@@ -254,21 +254,21 @@
 </td></tr>
 <tr><td align=right>1</td><td align=right>2.56</td><td align=left>another Operating System
 </td></tr>
-<tr><td align=right>0</td><td align=right>0.00</td><td align=left>... on a 64-bit machine
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>&hellip; on a 64-bit machine
 
 </td></tr>
-<tr><td align=right>2</td><td align=right>5.13</td><td align=left>... on a dual- or multicore processor
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>&hellip; on a dual- or multicore processor
 </td></tr>
-<tr><td align=right>1</td><td align=right>2.56</td><td align=left>... on a GP2X
+<tr><td align=right>1</td><td align=right>2.56</td><td align=left>&hellip; on a GP2X
 </td></tr>
-<tr><td align=right>0</td><td align=right>0.00</td><td align=left>... on another handheld</td></tr>
-</table></p>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>&hellip; on another handheld</td></tr>
+</table>
 <h3>What do you think about the difficulty of the levels?</h3>
 
 <p>(multiple choice)</p>
 
 <p>In total 37 votes plus 8 empty votes.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Votes</th><th align=right><b>Percentage</b></th>
 <th align=left></th></tr>
 <tr><td align=right>9</td><td align=right>24.32</td><td align=left>They should be easier in average.
@@ -281,13 +281,13 @@
 <tr><td align=right>6</td><td align=right>16.22</td><td align=left>The difficulties should scatter more.
 </td></tr>
 <tr><td align=right>16</td><td align=right>43.24</td><td align=left>None of the above.</td></tr>
-</table></p>
+</table>
 <h3>Which type of levels would you like to see more of?</h3>
 
 <p>(relative to the others)</p>
 
 <p>In total 37 votes plus 8 empty votes.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Votes</th><th align=right><b>Percentage</b></th>
 <th align=left></th></tr>
 <tr><td align=right>20</td><td align=right>54.05</td><td align=left>small, quickly playable puzzle levels
@@ -305,12 +305,12 @@
 </td></tr>
 
 <tr><td align=right>7</td><td align=right>18.92</td><td align=left>The current mix is perfect.</td></tr>
-</table></p>
+</table>
 <h3>Please estimate, which percentage of all levels you seriously tried to solve.</h3>
 
 <p>(This includes solved levels of course.)</p>
 <p>In total 37 votes plus 8 empty votes.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Votes</th><th align=right><b>Percentage</b></th>
 <th align=left></th></tr>
 
@@ -328,13 +328,13 @@
 <tr><td align=right>1</td><td align=right>2.70</td><td align=left>No answer.</td></tr>
 <tr><td align=right>1</td><td align=right>2.70</td><td align=left>0% - 10%
 </td></tr>
-</table></p>
+</table>
 <h3>How important are the following information channels about Enigma for you?</h3>
 
 <p>5 = very important, 1 = not important</p>
 <p>In total 34 votes plus 9 empty votes.</p>
 
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Points</th><th align=right>Votes</th>
 <th align=right><b>Average</b></th>
 <th align=left></th></tr>
@@ -353,7 +353,7 @@
 </td></tr>
 <tr><td align=right>38</td><td align=right>24</td><td align=right>1.583</td><td align=left>yahoo oxyd group
 </td></tr>
-</table></p>
+</table>
 <h3>Which should be our priorities for the further development of Enigma?</h3>
 
 <p>Please sort the 10 working areas below into the priorities 1 (=high) to 10 (=low). Only one priority per area, please.</p>
@@ -362,7 +362,7 @@
 assigned a priority).</p>
 
 <p>Without invalid votes:</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Points</th>
 <th align=left></th></tr>
 <tr><td align=right>186</td><td align=left>many new levels
@@ -386,8 +386,8 @@
 </td></tr>
 <tr><td align=right>81</td><td align=left>port to other platforms
 </td></tr>
-</table></p>
-<p><table border=1><tr>
+</table>
+<table border=1><tr>
 <th align=right>1</th>
 <th align=right>2</th>
 <th align=right>3</th>
@@ -553,9 +553,9 @@
 <td align=right>25</td>
 <td align=left>netplay mode to play levels together
 </td></tr>
-</table></p>
+</table>
 <p>With invalid votes:</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Points</th>
 <th align=left></th></tr>
 <tr><td align=right>224</td><td align=left>many new levels
@@ -579,8 +579,8 @@
 </td></tr>
 <tr><td align=right>88</td><td align=left>port to other platforms
 </td></tr>
-</table></p>
-<p><table border=1><tr>
+</table>
+<table border=1><tr>
 <th align=right>1</th>
 <th align=right>2</th>
 <th align=right>3</th>
@@ -746,13 +746,13 @@
 <td align=right>30</td>
 <td align=left>support and arranging of Enigma tournaments
 </td></tr>
-</table></p>
+</table>
 
 <h3>Language ratio</h3>
-<p><ul>
+<ul>
 <li>English: 269</li>
 <li>German: 356</li>
-<li><b>Total: 625</b></li></ul></p>
+<li><b>Total: 625</b></li></ul>
 
 <h3>Date statistics</h3>
 
@@ -762,7 +762,7 @@
 questionnaire. &quot;Question 1&quot; was the question about the best
 onescreener, &quot;Question 9&quot; about the operating system.</p>
 
-<p><table border=1>
+<table border=1>
 <tr><th align=right><b>Date</b></th><th align=right><b>Entries</b></th><th align=right>Question 1</th><th align=right>Question 9</th></tr>
 <tr><td align=right>2007-11-20</td><td align=right>71</td>
 <td align=right>8</td>
@@ -859,6 +859,6 @@
 <tr><td align=right><b>Sum</b></td><td align=right>729</td>
 <td align=right>72</td>
 <td align=right>46</td></tr>
-</table></p>
+</table>
 
 <p><a href="$$eoya_2007$$">Back to article.</a></p>

Modified: homepage/input/articles/eoya_2007_statistics_de.html
===================================================================
--- homepage/input/articles/eoya_2007_statistics_de.html	2008-01-06 09:55:13 UTC (rev 973)
+++ homepage/input/articles/eoya_2007_statistics_de.html	2008-01-06 13:22:19 UTC (rev 974)
@@ -10,7 +10,7 @@
 <p>Sie k&ouml;nnen jedem Level zwischen 1 und 5 Punkten geben, 5 ist die beste Wertung. Stimmen Sie mit &quot;-&quot;, wenn Sie den Level nicht kennen oder nicht bewerten wollen.</p>
 
 <p>Insgesamt 34 Stimmen plus 37 leere Stimmen.</p>
-<p><table border=1>
+<table border=1>
 
 <tr><th align=right>Punkte</th><th align=right>Stimmen</th>
 <th align=right><b>Durchschnitt</b></th>
@@ -50,14 +50,14 @@
 </td></tr>
 <tr><td align=right>64</td><td align=right>26</td><td align=right>2.462</td><td align=left>Island of Safety (V/34)
 </td></tr>
-</table></p>
+</table>
 <h3>Beste Levelserie</h3>
 
 <p>Viele Levels bilden in Enigma Serien, die man durchaus als zusammengeh&ouml;rige Einheit betrachten sollte. Diese Serien bilden unsere n&auml;chste Kategorie.</p>
 
 <p>Insgesamt 32 Stimmen plus 30 leere Stimmen.</p>
 
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Punkte</th><th align=right>Stimmen</th>
 <th align=right><b>Durchschnitt</b></th>
 <th align=left></th></tr>
@@ -88,13 +88,13 @@
 </td></tr>
 <tr><td align=right>67</td><td align=right>30</td><td align=right>2.233</td><td align=left>Nightmares (IV/83, 85, 87)
 </td></tr>
-</table></p>
+</table>
 <h3>Bestes Design</h3>
 
 <p>Nicht allein mit R&auml;tseln und Herausforderungen mag ein Level zu beeindrucken, sondern manchmal auch mit blo&szlig;er Sch&ouml;nheit f&uuml;rs Auge, mit Eleganz und Originalit&auml;t.</p>
 
 <p>Insgesamt 33 Stimmen plus 27 leere Stimmen.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Punkte</th><th align=right>Stimmen</th>
 <th align=right><b>Durchschnitt</b></th>
 <th align=left></th></tr>
@@ -131,12 +131,12 @@
 </td></tr>
 <tr><td align=right>65</td><td align=right>29</td><td align=right>2.241</td><td align=left>be quick or be dead (VI/54)
 </td></tr>
-</table></p>
+</table>
 <h3>Lustigster Level</h3>
 
 <p>Manche Levels stechen durch ihre originelle, am&uuml;sante oder &uuml;berraschende Art besonders hervor, sie bilden die eher leichte, gern gespielte Unterhaltung in Enigma.</p>
 <p>Insgesamt 33 Stimmen plus 22 leere Stimmen.</p>
-<p><table border=1>
+<table border=1>
 
 <tr><th align=right>Punkte</th><th align=right>Stimmen</th>
 <th align=right><b>Durchschnitt</b></th>
@@ -174,12 +174,12 @@
 </td></tr>
 <tr><td align=right>66</td><td align=right>30</td><td align=right>2.200</td><td align=left>Do Not Dive (I/21)</td></tr>
 
-</table></p>
+</table>
 <h3>Bester Yin-Yang-Level</h3>
 
 <p>Besonderer Beliebtheit erfreuen sich die Yin-Yang-Levels, in denen zwei Murmeln gesteuert werden m&uuml;ssen, und kooperieren m&uuml;ssen, um die R&auml;tsel zu l&ouml;sen.</p>
 <p>Insgesamt 31 Stimmen plus 21 leere Stimmen.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Punkte</th><th align=right>Stimmen</th>
 <th align=right><b>Durchschnitt</b></th>
 
@@ -194,10 +194,10 @@
 </td></tr>
 <tr><td align=right>83</td><td align=right>27</td><td align=right>3.074</td><td align=left>Spacestation (V/99)
 </td></tr>
-</table></p>
+</table>
 <h3>In welcher Version haben Sie das erste Mal Enigma gesehen?</h3>
 <p>Insgesamt 39 Stimmen plus 7 leere Stimmen.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Stimmen</th><th align=right><b>Anteil</b></th>
 <th align=left></th></tr>
 <tr><td align=right>17</td><td align=right>43.59</td><td align=left>0.8x
@@ -215,13 +215,13 @@
 <tr><td align=right>2</td><td align=right>5.13</td><td align=left>1.00
 </td></tr>
 <tr><td align=right>1</td><td align=right>2.56</td><td align=left>Keine Antwort.</td></tr>
-</table></p>
+</table>
 <h3>Unter welchen Betriebssystemen und Rechnern spielen Sie?</h3>
 
 <p>in alphabetischer Reihenfolge ;-)</p>
 <p>Insgesamt 39 Stimmen plus 7 leere Stimmen.</p>
 
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Stimmen</th><th align=right><b>Anteil</b></th>
 <th align=left></th></tr>
 <tr><td align=right>0</td><td align=right>0.00</td><td align=left>BSD-Derivat
@@ -257,21 +257,21 @@
 </td></tr>
 <tr><td align=right>1</td><td align=right>2.56</td><td align=left>anderes Betriebssystem
 </td></tr>
-<tr><td align=right>0</td><td align=right>0.00</td><td align=left>... auf einem 64-Bit-Rechner
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>&hellip; auf einem 64-Bit-Rechner
 </td></tr>
-<tr><td align=right>2</td><td align=right>5.13</td><td align=left>... auf einem Dualcore- oder Multicore-Prozessor
+<tr><td align=right>2</td><td align=right>5.13</td><td align=left>&hellip; auf einem Dualcore- oder Multicore-Prozessor
 
 </td></tr>
-<tr><td align=right>1</td><td align=right>2.56</td><td align=left>... auf einem GP2X
+<tr><td align=right>1</td><td align=right>2.56</td><td align=left>&hellip; auf einem GP2X
 </td></tr>
-<tr><td align=right>0</td><td align=right>0.00</td><td align=left>... auf einem anderen Handheld</td></tr>
-</table></p>
+<tr><td align=right>0</td><td align=right>0.00</td><td align=left>&hellip; auf einem anderen Handheld</td></tr>
+</table>
 <h3>Wie finden Sie den Schwierigkeitsgrad der Level?</h3>
 
 <p>(Mehrfachauswahl m&ouml;glich)</p>
 <p>Insgesamt 37 Stimmen plus 8 leere Stimmen.</p>
 
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Stimmen</th><th align=right><b>Anteil</b></th>
 <th align=left></th></tr>
 <tr><td align=right>9</td><td align=right>24.32</td><td align=left>Sie sollten im Schnitt einfacher sein.
@@ -284,13 +284,13 @@
 <tr><td align=right>6</td><td align=right>16.22</td><td align=left>Die Schwierigkeit sollte st&auml;rker streuen.
 </td></tr>
 <tr><td align=right>16</td><td align=right>43.24</td><td align=left>Nichts von alledem.</td></tr>
-</table></p>
+</table>
 <h3>Von welcher Art w&uuml;rden Sie sich gerne noch mehr Levels w&uuml;nschen?</h3>
 
 <p>(relativ zu den &uuml;brigen)</p>
 
 <p>Insgesamt 37 Stimmen plus 8 leere Stimmen.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Stimmen</th><th align=right><b>Anteil</b></th>
 <th align=left></th></tr>
 <tr><td align=right>20</td><td align=right>54.05</td><td align=left>kleine, schnell spielbare Knobellevel
@@ -308,12 +308,12 @@
 </td></tr>
 <tr><td align=right>7</td><td align=right>18.92</td><td align=left>Der aktuelle Mix ist perfekt.</td></tr>
 
-</table></p>
+</table>
 <h3>Sch&auml;tzen Sie bitte, welchen Anteil aller Levels Sie ernsthaft versucht haben, zu l&ouml;sen.</h3>
 
 <p>(Dies umfasst nat&uuml;rlich auch gel&ouml;ste Levels.)</p>
 <p>Insgesamt 37 Stimmen plus 8 leere Stimmen.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Stimmen</th><th align=right><b>Anteil</b></th>
 <th align=left></th></tr>
 
@@ -331,13 +331,13 @@
 <tr><td align=right>1</td><td align=right>2.70</td><td align=left>Keine Antwort.</td></tr>
 <tr><td align=right>1</td><td align=right>2.70</td><td align=left>0% - 10%
 </td></tr>
-</table></p>
+</table>
 <h3>Wie wichtig sind Ihnen die folgenden Informationskan&auml;le f&uuml;r Enigma?</h3>
 
 <p>5 = sehr wichtig, 1 = unwichtig</p>
 
 <p>Insgesamt 34 Stimmen plus 9 leere Stimmen.</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Punkte</th><th align=right>Stimmen</th>
 <th align=right><b>Durchschnitt</b></th>
 <th align=left></th></tr>
@@ -356,7 +356,7 @@
 </td></tr>
 <tr><td align=right>38</td><td align=right>24</td><td align=right>1.583</td><td align=left>Yahoo Oxyd Gruppe
 </td></tr>
-</table></p>
+</table>
 <h3>Welches sollten unsere Priorit&auml;ten f&uuml;r die weitere Entwicklung von Enigma sein?</h3>
 
 <p>Bitte sortieren Sie die 10 Arbeitsfelder unten in die Priorit&auml;ten 1 (=hoch) bis 10 (=niedrig) ein. Bitte nur eine Priorit&auml;t pro Arbeitsfeld.</p>
@@ -365,7 +365,7 @@
 nicht jeder Bereich eine Priorit&auml;t zugeordnet bekam).</p>
 
 <p>Ohne Teilstimmen:</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Punkte</th>
 <th align=left></th></tr>
 <tr><td align=right>186</td><td align=left>viele neue Level
@@ -389,8 +389,8 @@
 </td></tr>
 <tr><td align=right>81</td><td align=left>Portierung auf andere Plattformen
 </td></tr>
-</table></p>
-<p><table border=1><tr>
+</table>
+<table border=1><tr>
 <th align=right>1</th>
 <th align=right>2</th>
 <th align=right>3</th>
@@ -556,9 +556,9 @@
 <td align=right>25</td>
 <td align=left>ein Netzwerkmodus zum Spielen eines Levels zu zweit
 </td></tr>
-</table></p>
+</table>
 <p>Mit Teilstimmen:</p>
-<p><table border=1>
+<table border=1>
 <tr><th align=right>Punkte</th>
 <th align=left></th></tr>
 
@@ -582,8 +582,8 @@
 </td></tr>
 <tr><td align=right>88</td><td align=left>Portierung auf andere Plattformen
 </td></tr>
-</table></p>
-<p><table border=1><tr>
+</table>
+<table border=1><tr>
 <th align=right>1</th>
 
 <th align=right>2</th>
@@ -750,13 +750,13 @@
 <td align=left>Unterst&uuml;tzung und Veranstaltung von Enigma Spielwettbewerben
 
 </td></tr>
-</table></p>
+</table>
 
 <h3>Sprachverh&auml;ltnis</h3>
-<p><ul>
+<ul>
 <li>Englisch: 269</li>
 <li>Deutsch: 356</li>
-<li><b>Insgesamt: 625</b></li></ul></p>
+<li><b>Insgesamt: 625</b></li></ul>
 
 <h3>Datums-Statistik</h3>
 
@@ -767,7 +767,7 @@
 &quot;Frage 1&quot; ist die Frage nach dem besten Onescreener, &quot;Frage
 9&quot; die nach dem Betriebssystem.</p>
 
-<p><table border=1>
+<table border=1>
 <tr><th align=right><b>Datum</b></th><th align=right><b>Eintr&auml;ge</b></th><th align=right>Frage 1</th><th align=right>Frage 9</th></tr>
 
 <tr><td align=right>2007-11-20</td><td align=right>71</td>
@@ -865,6 +865,6 @@
 
 <td align=right>72</td>
 <td align=right>46</td></tr>
-</table></p>
+</table>
 
 <p><a href="$$eoya_2007$$">Zur&uuml;ck zum Artikel.</a></p>



From ral at mail.berlios.de  Sun Jan  6 17:28:01 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 6 Jan 2008 17:28:01 +0100
Subject: [Enigma-game-svn] r975 - in trunk: . data data/gfx16 src src/gui
Message-ID: <200801061628.m06GS1k0004608@sheep.berlios.de>

Author: ral
Date: 2008-01-06 17:27:59 +0100 (Sun, 06 Jan 2008)
New Revision: 975

Added:
   trunk/data/gfx16/
   trunk/data/gfx16/Makefile.am
   trunk/data/gfx16/inventory.jpg
   trunk/data/gfx16/menu_bg.jpg
   trunk/data/models-16.lua
Modified:
   trunk/configure.ac
   trunk/data/Makefile.am
   trunk/src/d_models.cc
   trunk/src/enigma.cc
   trunk/src/enigma.hh
   trunk/src/file.cc
   trunk/src/gui/ErrorMenu.cc
   trunk/src/gui/HelpMenu.cc
   trunk/src/gui/InfoMenu.cc
   trunk/src/gui/LPGroupConfig.cc
   trunk/src/gui/LevelInspector.cc
   trunk/src/gui/LevelMenu.cc
   trunk/src/gui/LevelPackConfig.cc
   trunk/src/gui/LevelPackMenu.cc
   trunk/src/gui/LevelWidget.cc
   trunk/src/gui/MainMenu.cc
   trunk/src/gui/OptionsMenu.cc
   trunk/src/gui/SearchMenu.cc
   trunk/src/gui/TextField.cc
   trunk/src/gui/TextField.hh
   trunk/src/gui/widgets.cc
   trunk/src/gui/widgets.hh
   trunk/src/main.cc
   trunk/src/video.cc
   trunk/src/video.hh
Log:
trunk 1.1:
- screen resolution 320x240 by Clarence Risher, devel mailing list
- added autotool support
- fixed VMInfo entry
- added auto scaling of 32x32 graphics to 16x16
- added 60x39 thumbs with own extension, own subdir
- fix --makepreviews to ensure difficult mode of levels
- add 60x39 thumb generation to --makepreviews
- fix widgets: dynamic font load instead of static as font size differs
    for gfx16
- fix font cache: clear fonts on video mode change
TODO:
- auto scale 60x39 thumbs from existing 120x78 on demand
- add manually scaled gfx image versions to gfx16
- check all object images, add manually scaled images to gfx16 for bad
  scaled ones
- font cache: cleanup - remove double caching



Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/configure.ac	2008-01-06 16:27:59 UTC (rev 975)
@@ -353,6 +353,7 @@
 AC_CONFIG_FILES([Makefile m4/Makefile  intl/Makefile 
            data/Makefile
            data/gfx/Makefile
+           data/gfx16/Makefile
            data/gfx32/Makefile
            data/gfx40/Makefile
            data/gfx48/Makefile

Modified: trunk/data/Makefile.am
===================================================================
--- trunk/data/Makefile.am	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/data/Makefile.am	2008-01-06 16:27:59 UTC (rev 975)
@@ -1,4 +1,4 @@
-SUBDIRS = gfx fonts schemas levels sound soundsets gfx32 gfx40 gfx48 
+SUBDIRS = gfx fonts schemas levels sound soundsets gfx16 gfx32 gfx40 gfx48 
 
 pkgdata_DATA = \
 	enigma_conf.lua \
@@ -6,6 +6,7 @@
 	models-2d.lua \
 	models-oxyd.lua \
 	models-editor.lua \
+	models-16.lua \
 	models-32.lua \
 	models-40.lua \
 	models-48.lua \


Property changes on: trunk/data/gfx16
___________________________________________________________________
Name: svn:ignore
   + Makefile Makefile.in


Added: trunk/data/gfx16/Makefile.am
===================================================================
--- trunk/data/gfx16/Makefile.am	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/data/gfx16/Makefile.am	2008-01-06 16:27:59 UTC (rev 975)
@@ -0,0 +1,4 @@
+pkgdatadir = $(datadir)/@PACKAGE@/gfx16
+pkgdata_DATA = $(wildcard $(srcdir)/*.png $(srcdir)/*.jpg)
+EXTRA_DIST = $(pkgdata_DATA)
+


Property changes on: trunk/data/gfx16/Makefile.am
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/gfx16/inventory.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx16/inventory.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx16/menu_bg.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx16/menu_bg.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/models-16.lua
===================================================================
--- trunk/data/models-16.lua	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/data/models-16.lua	2008-01-06 16:27:59 UTC (rev 975)
@@ -0,0 +1,11 @@
+TileSize = 16
+SpriteSize = 20
+ShadowSize = 21
+DefineFont ("timefont", "vera_sans.ttf", 18, "timefont", 180, 180, 180)
+DefineFont ("smallalternative", "DejaVuSansCondensed.ttf", 7, "menufont")
+DefineFont ("menufont", "DejaVuSansCondensed.ttf", 9, "menufont")
+DefineFont ("levelmenu", "DejaVuSansCondensed.ttf", 9, "levelmenu")
+DefineFont ("menufontsel", "DejaVuSansCondensed.ttf", 10, "menufont", 180, 180, 180)
+DefineFont ("statusbarfont", "DejaVuSansCondensed.ttf", 7, "dreamorp24")
+
+dofile(FindDataFile("models-2d.lua"))


Property changes on: trunk/data/models-16.lua
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:eol-style
   + native

Modified: trunk/src/d_models.cc
===================================================================
--- trunk/src/d_models.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/d_models.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -93,7 +93,6 @@
     };
 }
 
-
 /* -------------------- SurfaceCache -------------------- */
 
 Surface *SurfaceCache_Alpha::acquire(const std::string &name) 
@@ -109,6 +108,10 @@
         ecl::Surface * es_zoom = es->zoom(es->width()*2, es->height()*2);
         delete es;
         es = es_zoom;
+    } else if (es != NULL && vminfo->tt == video::VTS_16 && filename.find("gfx32") != std::string::npos) {
+        ecl::Surface * es_zoom = es->zoom(es->width()/2, es->height()/2);
+        delete es;
+        es = es_zoom;
     }
     return es;
 }
@@ -143,11 +146,14 @@
         ecl::Surface * es_zoom = es->zoom(es->width()*2, es->height()*2);
         delete es;
         es = es_zoom;
+    } else if (es != NULL && vminfo->tt == video::VTS_16 && filename.find("gfx32") != std::string::npos) {
+        ecl::Surface * es_zoom = es->zoom(es->width()/2, es->height()/2);
+        delete es;
+        es = es_zoom;
     }
     return es;
 }
 
-
 /* -------------------- ModelManager -------------------- */
 
 ModelManager::ModelManager()
@@ -189,7 +195,6 @@
 }
 
 
-
 /* -------------------- Variables -------------------- */
 
 namespace
@@ -202,7 +207,7 @@
     Anim2d             *anim_templ = 0;
 }
 
-
+
 /* -------------------- Functions -------------------- */
 
 void display::InitModels() 
@@ -367,13 +372,11 @@
 }
 
 
-
 /* -------------------- Model -------------------- */
 void Model::get_extension (ecl::Rect &r)
 {}
 
 
-
 /* -------------------- Image -------------------- */
 
 Image::Image(ecl::Surface *sfc)

Modified: trunk/src/enigma.cc
===================================================================
--- trunk/src/enigma.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/enigma.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -286,6 +286,11 @@
             else
                 m_fonts.insert (descr.name, descr);
         }
+        
+        void clear() {
+            PtrCache<Font>::clear();  // crazy double cache - TODO cleanup 
+            m_fonts.clear();
+        }
 
     private:
 
@@ -335,6 +340,10 @@
     return font_cache.get(name);
 }
 
+void ClearFontCache() {
+    font_cache.clear();
+}
+
 ecl::Surface *LoadImage(const char *name) 
 {
     string filename;

Modified: trunk/src/enigma.hh
===================================================================
--- trunk/src/enigma.hh	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/enigma.hh	2008-01-06 16:27:59 UTC (rev 975)
@@ -90,6 +90,7 @@
                      const char *bmf_name,
                      int r, int g, int b);
     ecl::Font *GetFont (const char *name);
+    void ClearFontCache();
 
     ecl::Surface *LoadImage (const char *name);
     ecl::Surface *GetImage (const char *name, const char *ext = ".png");

Modified: trunk/src/file.cc
===================================================================
--- trunk/src/file.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/file.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -343,6 +343,10 @@
             fname = string("gfx32/") + basename;
             if (findFile(fname, filename))
                 return true;
+        } else if (vminfo->tt == video::VTS_16) {
+            fname = string("gfx32/") + basename;
+            if (findFile(fname, filename))
+                return true;
         }
         fname = string ("gfx/") + basename;
         return findFile(fname, filename);

Modified: trunk/src/gui/ErrorMenu.cc
===================================================================
--- trunk/src/gui/ErrorMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/ErrorMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -32,7 +32,8 @@
             text (message), rejectQuit (false), laterQuit (false),
             quit (new gui::StaticTextButton(quitTitle, this)) {
         const video::VMInfo *vminfo = video::GetInfo();
-        add(quit, Rect(vminfo->width-170, vminfo->height-60, 150, 40));
+        const int vshrink = vminfo->width < 640 ? 1 : 0;
+        add(quit, Rect(vminfo->width-(vshrink?85:170), vminfo->height-(vshrink?30:60), vshrink?75:150, vshrink?42:40));
     }
     
     ErrorMenu::ErrorMenu(std::string message, std::string quitTitle, std::string rejectTitle) : 
@@ -40,8 +41,9 @@
             quit (new gui::StaticTextButton(quitTitle, this)),
             reject (new gui::StaticTextButton(rejectTitle, this)) {
         const video::VMInfo *vminfo = video::GetInfo();
-        add(quit, Rect(vminfo->width-170, vminfo->height-60, 150, 40));
-        add(reject, Rect(vminfo->width-340, vminfo->height-60, 150, 40));
+        const int vshrink = vminfo->width < 640 ? 1 : 0;
+        add(quit, Rect(vminfo->width-(vshrink?85:170), vminfo->height-(vshrink?30:60), vshrink?75:150, vshrink?42:40));
+        add(reject, Rect(vminfo->width-(vshrink?170:340), vminfo->height-(vshrink?30:60), vshrink?75:150, vshrink?42:40));
     }
     
     ErrorMenu::ErrorMenu(std::string message, std::string quitTitle, std::string rejectTitle,
@@ -51,9 +53,10 @@
             reject (new gui::StaticTextButton(rejectTitle, this)),
             later (new gui::StaticTextButton(laterTitle, this)) {
         const video::VMInfo *vminfo = video::GetInfo();
-        add(quit, Rect(vminfo->width-170, vminfo->height-60, 150, 40));
-        add(later, Rect(vminfo->width-340, vminfo->height-60, 150, 40));
-        add(reject, Rect(vminfo->width-510, vminfo->height-60, 150, 40));
+        const int vshrink = vminfo->width < 640 ? 1 : 0;
+        add(quit, Rect(vminfo->width-(vshrink?85:170), vminfo->height-(vshrink?30:60), vshrink?75:150, vshrink?42:40));
+        add(later, Rect(vminfo->width-(vshrink?170:340), vminfo->height-(vshrink?30:60), vshrink?75:150, vshrink?42:40));
+        add(reject, Rect(vminfo->width-(vshrink?255:510), vminfo->height-(vshrink?30:60), vshrink?75:150, vshrink?42:40));
     }
     
     bool ErrorMenu::isRejectQuit() {

Modified: trunk/src/gui/HelpMenu.cc
===================================================================
--- trunk/src/gui/HelpMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/HelpMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -35,8 +35,9 @@
         cfg         (xoffset_)
     {
         const video::VMInfo &vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width < 640 ? 1 : 0;
         
-        add(ok, Rect(vminfo.width-170,vminfo.height-60,150,40));
+        add(ok, Rect(vminfo.width-(vshrink?85:170),vminfo.height-(vshrink?30:60),vshrink?75:150,vshrink?20:40));
     }
     
     bool HelpMenu::on_event (const SDL_Event &e) 
@@ -58,17 +59,18 @@
     void HelpMenu::draw_background (ecl::GC &gc) 
     {
         const video::VMInfo &vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width < 640 ? 1 : 0;
 
         blit(gc, 0,0, enigma::GetImage("menu_bg", ".jpg"));
         Font *f = enigma::GetFont(cfg.fontname.c_str());
     
-        int y = cfg.y0 + (vminfo.height - 480)/2;
-        int x = (vminfo.width-640)/2;
+        int x = (vminfo.width-(vshrink?320:640))/2;
+        int y = (cfg.y0/(vshrink?2:1)) + (vminfo.height - (vshrink?240:480))/2;
         for (int i = 0; helptext[i]; i += 2) 
         {
-            f->render (gc, cfg.x0 + x, y, _(helptext[i]));    // translate
-            f->render (gc, cfg.x1 + x, y, _(helptext[i+1]));  // translate
-            y += cfg.yskip;
+            f->render (gc, cfg.x0/(vshrink?2:1) + x, y, _(helptext[i]));    // translate
+            f->render (gc, cfg.x1/(vshrink?2:1) + x, y, _(helptext[i+1]));  // translate
+            y += cfg.yskip/(vshrink?2:1);
         }
     }
     

Modified: trunk/src/gui/InfoMenu.cc
===================================================================
--- trunk/src/gui/InfoMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/InfoMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -28,24 +28,26 @@
     InfoMenu::InfoMenu(const char **infotext, int pages) : info (infotext),
             curPage (0), numPages (pages) {
         const video::VMInfo &vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width < 640 ? 1 : 0;
 
         but_ok = new StaticTextButton(N_("Ok"), this);
         pgup     = new ImageButton("ic-up", "ic-up1", this);
         pgdown   = new ImageButton("ic-down", "ic-down1", this);
 
-        add(but_ok, Rect(vminfo.width-120, vminfo.height-60, 100, 40));        
-        add(pgup, Rect(vminfo.width-30, vminfo.height/2, 20, 50));        
-        add(pgdown, Rect(vminfo.width-30, vminfo.height/2 +70, 20, 50));        
+        add(but_ok, Rect(vminfo.width-(vshrink?60:120), vminfo.height-(vshrink?30:60), vshrink?50:100, vshrink?20:40));        
+        add(pgup, Rect(vminfo.width-(vshrink?15:30), vminfo.height/2, vshrink?10:20, vshrink?25:50));        
+        add(pgdown, Rect(vminfo.width-(vshrink?15:30), vminfo.height/2 +(vshrink?35:70), vshrink?10:20, vshrink?25:50));        
     }
     
     void InfoMenu::draw_background(ecl::GC &gc) {
         const video::VMInfo &vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width < 640 ? 1 : 0;
         blit(gc, vminfo.mbg_offsetx, vminfo.mbg_offsety, enigma::GetImage("menu_bg", ".jpg"));
         
         Font *f = enigma::GetFont("menufont");
         int row = 0;
-        int yoff[] = {0, -20, -40, -40};
-        int ygap[] = {0, 4, 6, 6};
+        int yoff[] = {0, 0, -20, -40, -40};
+        int ygap[] = {0, 0, 4, 6, 6};
         for (int p=0; p<curPage; p++) {
             while (info[row])
                 row++;
@@ -54,8 +56,8 @@
         }
         for (int i = 0; info[row]; row++, i++) {
             const char *t = _(info[row]);
-            f->render (gc, 40 + (vminfo.width-640)/2, 
-                    20 + yoff[vminfo.tt] + (vminfo.height-480)/2 + i*(f->get_height() + ygap[vminfo.tt]), t);
+            f->render (gc, (vshrink?20:40) + (vminfo.width-(vshrink?320:640))/2, 
+                    (vshrink?10:20) + yoff[vminfo.tt] + (vminfo.height-(vshrink?240:480))/2 + i*(f->get_height() + ygap[vminfo.tt]), t);
         }
     }
     

Modified: trunk/src/gui/LPGroupConfig.cc
===================================================================
--- trunk/src/gui/LPGroupConfig.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/LPGroupConfig.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -33,6 +33,8 @@
 namespace enigma { namespace gui {
     LPGroupConfig::LPGroupConfig(std::string groupName) : oldGroupName (groupName) {
         const video::VMInfo &vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width < 640 ? 1 : 0;
+
         groups = lev::Index::getGroupNames();
         
         position = -1;
@@ -49,16 +51,16 @@
         }
 
         VList * titleVList = new VList;
-        titleVList->set_spacing(12);
+        titleVList->set_spacing(vshrink?6:12);
         titleVList->set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        titleVList->set_default_size(160, 35);
+        titleVList->set_default_size(vshrink?80:160, vshrink?17:35);
         Label * groupLabel = new Label(N_("Group:"), HALIGN_RIGHT);
         titleVList->add_back(groupLabel);
         
         VList * groupsVList = new VList;
-        groupsVList->set_spacing(12);
+        groupsVList->set_spacing(vshrink?6:12);
         groupsVList->set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        groupsVList->set_default_size(160, 35);
+        groupsVList->set_default_size(vshrink?80:160, vshrink?17:35);
         
         Label * positionLabel = new Label(N_("Position:"), HALIGN_LEFT);
         pre2Group = new UntranslatedLabel("");
@@ -77,21 +79,21 @@
         groupsVList->add_back(dummyLabel);
 
         VList * scrollVList = new VList;
-        scrollVList->set_spacing(12);
+        scrollVList->set_spacing(vshrink?6:12);
         scrollVList->set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        scrollVList->set_default_size(40, 35);
+        scrollVList->set_default_size(vshrink?20:40, vshrink?17:35);
 
         scrollUp = new ImageButton("ic-up", "ic-up1", this);
         scrollDown = new ImageButton("ic-down", "ic-down1", this);
         scrollVList->add_back(scrollUp);
         scrollVList->add_back(scrollDown);
 
-        this->add(titleVList, Rect(vminfo.width/2 - 290, 0, 160, vminfo.height-100));
-        this->add(groupsVList, Rect(vminfo.width/2 - 80, 0, 160, vminfo.height-100));
-        this->add(scrollVList, Rect(vminfo.width/2 + 130, 0, 40, vminfo.height-100));
+        this->add(titleVList, Rect(vminfo.width/2 - (vshrink?145:290), 0, (vshrink?80:160), vminfo.height-(vshrink?50:100)));
+        this->add(groupsVList, Rect(vminfo.width/2 - (vshrink?40:80), 0, (vshrink?80:160), vminfo.height-(vshrink?50:100)));
+        this->add(scrollVList, Rect(vminfo.width/2 + (vshrink?65:130), 0, (vshrink?20:40), vminfo.height-(vshrink?50:100)));
 
         errorLabel = new Label("", HALIGN_CENTER);
-        this->add(errorLabel, Rect(10, vminfo.height-100, vminfo.width-20, 35));
+        this->add(errorLabel, Rect((vshrink?5:10), vminfo.height-(vshrink?50:100), vminfo.width-(vshrink?10:20), (vshrink?17:35)));
         
         // Create buttons - positioning identical to Levelmenu
         but_newPack = new StaticTextButton(N_("New Pack"), this);
@@ -100,14 +102,14 @@
         but_ok = new StaticTextButton(N_("Ok"), this);
         
         HList * commandHList = new HList;
-        commandHList->set_spacing(10);
+        commandHList->set_spacing(vshrink?5:10);
         commandHList->set_alignment(HALIGN_CENTER, VALIGN_TOP);
-        commandHList->set_default_size(140, 35);
+        commandHList->set_default_size(vshrink?70:140, vshrink?17:35);
         commandHList->add_back(but_newPack);
         commandHList->add_back(but_delete);
         commandHList->add_back(but_ignore);
         commandHList->add_back(but_ok);
-        this->add(commandHList, Rect(10, vminfo.height-50, vminfo.width-20, 35));
+        this->add(commandHList, Rect(vshrink?5:10, vminfo.height-(vshrink?25:50), vminfo.width-(vshrink?10:20), vshrink?17:35));
         
         updateGroupList();
     }

Modified: trunk/src/gui/LevelInspector.cc
===================================================================
--- trunk/src/gui/LevelInspector.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/LevelInspector.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -181,15 +181,17 @@
         bool didGenerate;  // dummy
         previewImage = LevelPreviewCache::instance()->getPreview(aLevel, true, didGenerate);
         const video::VMInfo *vminfo = video::GetInfo();
-        vspacing = vminfo->height < 500 ? 2 :(vminfo->height < 650 ? 3 : 4);
-        vspacing2 = vminfo->height < 500 ? 16 :(vminfo->height < 650 ? 14 : 16);
-        vmargin = vminfo->height < 500 ? 10 :(vminfo->height < 650 ?  20 : 30);
-        hmargin = vminfo->width < 660 ? 10 : (vminfo->width < 900 ? 20 : 30);
+        const int vshrink = vminfo->width < 640 ? 1 : 0;
+        vspacing = vminfo->height < 400 ? 1 :(vminfo->height < 500 ? 2 :(vminfo->height < 650 ? 3 : 4));
+        vspacing2 = vminfo->height < 400 ? 8 :(vminfo->height < 500 ? 16 :(vminfo->height < 650 ? 14 : 16));
+        vmargin = vminfo->height < 400 ? 5 :(vminfo->height < 500 ? 10 :(vminfo->height < 650 ?  20 : 30));
+        hmargin = vminfo->width < 640 ? 5 : (vminfo->width < 660 ? 10 : (vminfo->width < 900 ? 20 : 30));
         bool highres = vminfo->height > 650 ? true : false;
         bool lowres = vminfo->height < 600 ? true : false;
+        bool lowlowres = vminfo->height < 400 ? true : false;
     
-        add(back, Rect(vminfo->width-130-2*hmargin,vminfo->height-50,130,35));
-        add(screenshot, Rect(vminfo->width-260-3*hmargin,vminfo->height-50,130,35));
+        add(back, Rect(vminfo->width-(vshrink?65:130)-2*hmargin,vminfo->height-(vshrink?25:50),vshrink?65:130,vshrink?17:35));
+        add(screenshot, Rect(vminfo->width-(vshrink?130:260)-3*hmargin,vminfo->height-(vshrink?25:50),vshrink?65:130,vshrink?17:35));
     
         try {
             aLevel->loadMetadata(true);
@@ -200,9 +202,9 @@
                                    + aLevel->getNormLevelPath() + "'\n"
                                    + err.what();
             ecl::split_copy (errmsg, '\n', back_inserter(lines));
-            int x     = 60;
-            int y     = 60;
-            int yskip = 25;
+            int x     = vshrink?30:60;
+            int y     = vshrink?30:60;
+            int yskip = vshrink?12:25;
             for (unsigned i=0; i<lines.size(); ++i) {
                 add(new Label(lines[i], HALIGN_LEFT), Rect(x, y, vminfo->width-80,yskip));
                 y += yskip;
@@ -223,15 +225,15 @@
         for (std::string::size_type slpos = levelPathString.find('\\');
                 slpos != std::string::npos; slpos = levelPathString.find('\\')) 
             levelPathString.replace(slpos, 1, 1, '/');
-        BuildVList authorT(this, Rect(hmargin,vmargin,110,25), vspacing);
+        BuildVList authorT(this, Rect(hmargin,vmargin,vshrink?55:110,vshrink?12:25), vspacing);
         authorT.add(new Label(N_("Level: "), HALIGN_RIGHT));
         authorT.add(new Label((""), HALIGN_RIGHT)); // subtitle
         authorT.add(new Label(N_("Author: "), HALIGN_RIGHT));
         authorT.add(new Label(N_("Contact: "), HALIGN_RIGHT));
         authorT.add(new Label(N_("Homepage: "), HALIGN_RIGHT));
         
-        BuildVList author(this, Rect(hmargin+110+10,vmargin,
-                vminfo->width-(hmargin+110+10)-10-(vminfo->thumbw+10)-hmargin,25), vspacing);
+        BuildVList author(this, Rect(hmargin+(vshrink?55+5:110+10),vmargin,
+                vminfo->width-(hmargin+(vshrink?55+5:110+10))-(vshrink?5:10)-(vminfo->thumbw+(vshrink?5:10))-hmargin,vshrink?12:25), vspacing);
         tmp = levelProxy->getTitle();
         tmp2 = levelProxy->getLocalizedString("title");
         if (tmp != tmp2)
@@ -243,14 +245,14 @@
         author.add(new Label(tmp, HALIGN_LEFT)); // subtitle
         author.add(new Label(levelProxy->getAuthor(), HALIGN_LEFT));
         
-        BuildVList address(this, Rect(hmargin+110+10,vmargin+3*(25+vspacing),
-                vminfo->width-(hmargin+110+10)-hmargin,25), vspacing);
+        BuildVList address(this, Rect(hmargin+(vshrink?55+5:110+10),vmargin+3*((vshrink?12:25)+vspacing),
+                vminfo->width-(hmargin+(vshrink?55+5:110+10))-hmargin,vshrink?12:25), vspacing);
         address.add(new Label(levelProxy->getContact(), HALIGN_LEFT));
         address.add(new Label(levelProxy->getHomepage(), HALIGN_LEFT));
         
-        BuildVList ratingPubT(this, Rect(hmargin+65,vmargin+5*25+4*vspacing+vspacing2, 130,25), 2);
+        BuildVList ratingPubT(this, Rect(hmargin+(vshrink?32:65),vmargin+5*(vshrink?12:25)+4*vspacing+vspacing2,vshrink?65:130,vshrink?12:25), vshrink?1:2);
         ratingPubT.add(new Label(N_("Public Ratings"), HALIGN_CENTER));
-        BuildVList ratingPubST(this, Rect(hmargin,vmargin+6*25+5*vspacing+vspacing2, 130,25), 2);
+        BuildVList ratingPubST(this, Rect(hmargin,vmargin+6*(vshrink?12:25)+5*vspacing+vspacing2,vshrink?65:130,vshrink?12:25), vshrink?1:2);
         ratingPubST.add(new Label(N_("Intelligence: "), HALIGN_RIGHT));
         ratingPubST.add(new Label(N_("Dexterity: "), HALIGN_RIGHT));
         ratingPubST.add(new Label(N_("Patience: "), HALIGN_RIGHT));
@@ -259,7 +261,7 @@
         if (!lowres) ratingPubST.add(new Label(N_("Difficulty: "), HALIGN_RIGHT));
 
         
-        BuildVList ratingPub(this, Rect(hmargin+130+15,vmargin+6*25+5*vspacing+vspacing2, 30,25), 2);
+        BuildVList ratingPub(this, Rect(hmargin+(vshrink?65+7:130+15),vmargin+6*(vshrink?12:25)+5*vspacing+vspacing2,vshrink?15:30,vshrink?12:25),vshrink?1:2);
         if (WizardMode) {
             ratingPub.add(new IntelligenceButton(aLevel));
             ratingPub.add(new DexterityButton(aLevel));
@@ -276,10 +278,10 @@
             if (!lowres) ratingPub.add(new MonospacedLabel(ratingToString(theRatingMgr->getDifficulty(aLevel)).c_str(),'8', " 0123456789", HALIGN_CENTER));
         }
         
-        BuildVList scoresT(this, Rect(vminfo->width/2-100-20,vmargin+5*25+4*vspacing+vspacing2,100,25), 2);
+        BuildVList scoresT(this, Rect(vminfo->width/2-(vshrink?50+10:100+20),vmargin+5*(vshrink?12:25)+4*vspacing+vspacing2,vshrink?50:100,vshrink?12:25), vshrink?1:2);
         scoresT.add(new Label(N_("Scores"), HALIGN_RIGHT));
 
-        BuildVList scoresST(this, Rect(vminfo->width/2-100-20,vmargin+6*25+5*vspacing+vspacing2,100,25), 2);
+        BuildVList scoresST(this, Rect(vminfo->width/2-(vshrink?50+10:100+20),vmargin+6*(vshrink?12:25)+5*vspacing+vspacing2,vshrink?50:100,vshrink?12:25), vshrink?1:2);
         scoresST.add(new Label(N_("You: "), HALIGN_RIGHT));
         scoresST.add(new Label(N_("World: "), HALIGN_RIGHT));
 // TRANSLATORS: PAR = professional average rate - an expression used by golfers
@@ -288,8 +290,8 @@
         scoresST.add(new Label(N_("Solved %: "), HALIGN_RIGHT));
         if (!lowres) scoresST.add(new Label(N_("Solved #: "), HALIGN_RIGHT));
     
-        BuildVList scores(this, Rect(vminfo->width/2-15+(withEasy?0:20),
-                vmargin+6*25+5*vspacing+vspacing2,(withEasy?117:54),25), 2);
+        BuildVList scores(this, Rect(vminfo->width/2-(vshrink?7-(withEasy?0:10):15-(withEasy?0:20)),
+                vmargin+6*(vshrink?12:25)+5*vspacing+vspacing2,vshrink?(withEasy?53:27):(withEasy?117:54),vshrink?12:25), vshrink?1:2);
         scores.add(new MonospacedLabel(scoreToString(theScoreMgr->getBestUserScore(aLevel, DIFFICULTY_EASY),
             theScoreMgr->getBestUserScore(aLevel, DIFFICULTY_HARD),aLevel,true).c_str(),'8', " 0123456789", HALIGN_CENTER));
         scores.add(new MonospacedLabel(scoreToString(theRatingMgr->getBestScoreEasy(aLevel),
@@ -307,9 +309,9 @@
             (ecl::strf("%5d", theRatingMgr->getNumSolvedDifficult(aLevel)) + " ").c_str(),
             '8', " 0123456789", HALIGN_CENTER));        
         
-        BuildVList versionT(this, Rect(vminfo->width-100/2-90-2*hmargin,vmargin+5*25+4*vspacing+vspacing2,100,25), 2);
+        BuildVList versionT(this, Rect(vminfo->width-(vshrink?50/2+45:100/2+90)-2*hmargin,vmargin+5*(vshrink?12:25)+4*vspacing+vspacing2,vshrink?50:100,vshrink?12:25), vshrink?1:2);
         versionT.add(new Label(N_("Version"), HALIGN_CENTER));
-        BuildVList versionST(this, Rect(vminfo->width-110-90-2*hmargin,vmargin+6*25+5*vspacing+vspacing2,110,25), 2);
+        BuildVList versionST(this, Rect(vminfo->width-(vshrink?55+45:110+90)-2*hmargin,vmargin+6*(vshrink?12:25)+5*vspacing+vspacing2,vshrink?55:110,vshrink?12:25), vshrink?1:2);
         if (!lowres || aLevel->getLevelStatus() == lev::STATUS_RELEASED)
             versionST.add(new Label(N_("Score: "), HALIGN_RIGHT));
         else
@@ -321,7 +323,7 @@
         versionST.add(new Label(N_("Control: "), HALIGN_RIGHT));
         versionST.add(new Label(N_("Target: "), HALIGN_RIGHT));
 
-        BuildVList version(this, Rect(vminfo->width-80-2*hmargin,vmargin+6*25+5*vspacing+vspacing2,80+2*hmargin,25), 2);
+        BuildVList version(this, Rect(vminfo->width-(vshrink?40:80)-2*hmargin,vmargin+6*(vshrink?12:25)+5*vspacing+vspacing2,(vshrink?40:80)+2*hmargin,vshrink?12:25), vshrink?1:2);
         if (!lowres || aLevel->getLevelStatus() == lev::STATUS_RELEASED)
             version.add(new MonospacedLabel(ecl::strf("%6d", aLevel->getScoreVersion()).c_str(),
                     '8', " 0123456789", HALIGN_LEFT));
@@ -379,13 +381,13 @@
         int annotationLines = 0; 
         int compatibilityLines = 0; 
         int idLines = 0; 
-        int vnext = vmargin+ (lowres?11:12)*25+(lowres?9:10)*vspacing+2*vspacing2;
-        int textwidth = vminfo->width-3*hmargin-110-10;
+        int vnext = vmargin+(lowres?11:12)*(vshrink?12:25)+(lowlowres?5:lowres?9:10)*vspacing+2*vspacing2;
+        int textwidth = vminfo->width-3*hmargin-(vshrink?55+5:110+10);
         dispatchBottomLines(bestScoreHolderLines, creditsLines, dedicationLines,
                 levelPathLines, annotationLines, compatibilityLines, idLines,
-                (vminfo->height-vnext-vmargin-25-vspacing2)/27, textwidth);
+                (vminfo->height-vnext-vmargin-(vshrink?12:25)-vspacing2)/(vshrink?13:27), textwidth);
         if (bestScoreHolderLines == 1) {
-            add(new Label(N_("World Record Holders: "), HALIGN_RIGHT),Rect(hmargin,vnext,200,25));
+            add(new Label(N_("World Record Holders: "), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?100:200,vshrink?12:25));
             std::string holders;
             if (withEasy) {
                 holders = theRatingMgr->getBestScoreEasyHolder(aLevel);
@@ -398,7 +400,7 @@
             else
                 holders += theRatingMgr->getBestScoreDifficultHolder(aLevel);
             Label *wrLabel = new Label(holders, HALIGN_LEFT);
-            add(wrLabel, Rect(hmargin+200+10,vnext,textwidth-90,25));
+            add(wrLabel, Rect(hmargin+(vshrink?100+5:200+10),vnext,textwidth-(vshrink?45:90),vshrink?12:25));
             if (!wrLabel->text_fits()) {
                 int cutEasy = 0;
                 int cutDiff = 0;
@@ -443,49 +445,49 @@
                     }
                 }
             }
-            vnext += 25 + vspacing;
+            vnext += (vshrink?12:25) + vspacing;
         }
         if (creditsLines >= 1) {
-            add(new Label(N_("Credits: "), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
+            add(new Label(N_("Credits: "), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
             std::string creditsString = levelProxy->getCredits(true);
             for (int i = 0; i< creditsLines; i++) {
                 std::string::size_type breakPos = breakString(menufont, creditsString, 
                         " ", textwidth);
-                add(new Label(creditsString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+110+10,vnext,textwidth,25));
+                add(new Label(creditsString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+(vshrink?55+5:110+10),vnext,textwidth,vshrink?12:25));
                 creditsString = creditsString.substr(breakPos);
-                vnext += (25 + vspacing);
+                vnext += ((vshrink?12:25) + vspacing);
             }
         }
         if (dedicationLines >= 1) {
-            add(new Label(N_("Dedication: "), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
+            add(new Label(N_("Dedication: "), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
             std::string dedicationString = levelProxy->getDedication(true);
             for (int i = 0; i< dedicationLines; i++) {
                 std::string::size_type breakPos = breakString( menufont, dedicationString, 
                         " ", textwidth);
-                add(new Label(dedicationString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+110+10,vnext,textwidth,25));
+                add(new Label(dedicationString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+(vshrink?55+5:110+10),vnext,textwidth,vshrink?12:25));
                 dedicationString = dedicationString.substr(breakPos);
-                vnext += (25 + vspacing);
+                vnext += ((vshrink?12:25) + vspacing);
             }
         }
         if (levelPathLines >= 1) {
-            add(new Label(N_("Level Path: "), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
+            add(new Label(N_("Level Path: "), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
             std::string workString = levelPathString;
             for (int i = 0; i< levelPathLines - 1; i++) {
                 std::string::size_type breakPos = breakString(menufont, workString, 
                         "/", textwidth);
-                add(new Label(workString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+110+10,vnext,textwidth,25));
+                add(new Label(workString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+(vshrink?55+5:110+10),vnext,textwidth,vshrink?12:25));
                 workString = workString.substr(breakPos);
-                vnext += (25 + vspacing);
+                vnext += ((vshrink?12:25) + vspacing);
             }
             // show as much as possible from last line
             if (menufont->get_width(workString.c_str()) > textwidth) {
                 // show the filename at the end - skip leading parts if necessary
-                add(new Label(workString, HALIGN_RIGHT), Rect(hmargin+110+10,vnext,textwidth,25));
+                add(new Label(workString, HALIGN_RIGHT), Rect(hmargin+(vshrink?55+5:110+10),vnext,textwidth,vshrink?12:25));
             } else {
                 // display up to the last character
-                add(new Label(workString, HALIGN_LEFT), Rect(hmargin+110+10,vnext,textwidth,25));
+                add(new Label(workString, HALIGN_LEFT), Rect(hmargin+(vshrink?55+5:110+10),vnext,textwidth,vshrink?12:25));
             }
-            vnext += (25 + vspacing);
+            vnext += ((vshrink?12:25) + vspacing);
         }
         if (idLines >= 1) {
             add(new Label(N_("Id: "), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
@@ -493,23 +495,23 @@
             vnext += (25 + vspacing)*idLines;
         }
         if (compatibilityLines >= 1) {
-            add(new Label(N_("Compatibility: "), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
+            add(new Label(N_("Compatibility: "), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
             std::string compString = ecl::strf("Enigma v%.2f  /  ", levelProxy->getEnigmaCompatibility()) +
                     GetGameTypeName(levelProxy->getEngineCompatibility());
-            add(new Label(compString , HALIGN_LEFT),Rect(hmargin+110+10, vnext, textwidth, 25));
-            vnext += (25 + vspacing)*compatibilityLines;
+            add(new Label(compString , HALIGN_LEFT),Rect(hmargin+(vshrink?55+5:110+10), vnext, textwidth, vshrink?12:25));
+            vnext += ((vshrink?12:25) + vspacing)*compatibilityLines;
         }
         annotation->set_text(app.state->getAnnotation(levelProxy->getId())); // field needs to initialized for saves
         if (annotationLines >= 1) {
-            add(new Label(N_("Annotation: "), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
-            add(annotation, Rect(hmargin+110+10, vnext, textwidth, 25));
-            vnext += (25 + vspacing)*annotationLines;
+            add(new Label(N_("Annotation: "), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
+            add(annotation, Rect(hmargin+(vshrink?55+5:110+10), vnext, textwidth, vshrink?12:25));
+            vnext += ((vshrink?12:25) + vspacing)*annotationLines;
         }
         vnext += vspacing2 - vspacing;
-        add(new Label(N_("Rating: "), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
-        add(new RatingButton(aLevel),Rect(hmargin+110+10,vnext,40,25));
-        add(new Label(N_("Average: "), HALIGN_RIGHT),Rect(hmargin+110+10+40+20,vnext,105,25));
-        add(new Label(theRatingMgr->getAverageRating(aLevel), HALIGN_RIGHT),Rect(hmargin+110+10+40+18+105+6,vnext,31,25));
+        add(new Label(N_("Rating: "), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
+        add(new RatingButton(aLevel),Rect(hmargin+(vshrink?55+5:110+10),vnext,vshrink?20:40,vshrink?12:25));
+        add(new Label(N_("Average: "), HALIGN_RIGHT),Rect(hmargin+(vshrink?55+5+20+10:110+10+40+20),vnext,vshrink?52:105,vshrink?12:25));
+        add(new Label(theRatingMgr->getAverageRating(aLevel), HALIGN_RIGHT),Rect(hmargin+(vshrink?55+5+20+9+52+3:110+10+40+18+105+6),vnext,vshrink?15:31,vshrink?12:25));
     }
     
     LevelInspector::~LevelInspector () {
@@ -571,6 +573,7 @@
     
     void LevelInspector::draw_background(ecl::GC &gc) {
         const video::VMInfo *vminfo = video::GetInfo();
+        const int vshrink = vminfo->width < 640 ? 1 : 0;
         video::SetCaption((std::string("Enigma - Level ") + 
             (isDeveloperMode ? "Developer " : "") + "Inspector").c_str());
         blit(gc, vminfo->mbg_offsetx, vminfo->mbg_offsety, enigma::GetImage("menu_bg", ".jpg"));
@@ -578,16 +581,16 @@
         Surface *img_hard = enigma::GetImage("completed");
         if (withEasy) {
             Surface *img_easy = enigma::GetImage("completed-easy");
-            blit (gc, vminfo->width/2-4, vmargin+5*25+4*vspacing+vspacing2, img_easy);
-            blit (gc, vminfo->width/2-4+63, vmargin+5*25+4*vspacing+vspacing2, img_hard);
+            blit (gc, vminfo->width/2-(vshrink?2:4), vmargin+5*(vshrink?12:25)+4*vspacing+vspacing2, img_easy);
+            blit (gc, vminfo->width/2-(vshrink?2-31:4-63), vmargin+5*(vshrink?12:25)+4*vspacing+vspacing2, img_hard);
         } else {
-            blit (gc, vminfo->width/2-4+20, vmargin+5*25+4*vspacing+vspacing2, img_hard);
+            blit (gc, vminfo->width/2-(vshrink?2-10:4-20), vmargin+5*(vshrink?12:25)+4*vspacing+vspacing2, img_hard);
         }
         Surface *img_changed = enigma::GetImage("changed");
         ratingInherited = lev::ScoreManager::instance()->isRatingInherited(levelProxy);
         if (ratingInherited) {
-            int numLines = vminfo->height < 500 ? 14 :(vminfo->height < 650 ? 18 : 19);
-            blit (gc, hmargin+110+10+40, vmargin + numLines*25 +
+            int numLines = vminfo->height < 400 ? 10 :(vminfo->height < 500 ? 14 :(vminfo->height < 650 ? 18 : 19));
+            blit (gc, hmargin+(vshrink?55+5+20:110+10+40), vmargin + numLines*(vshrink?12:25) +
                     (numLines-3)*vspacing + 3*vspacing2, img_changed);        
         }
     }

Modified: trunk/src/gui/LevelMenu.cc
===================================================================
--- trunk/src/gui/LevelMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/LevelMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -58,6 +58,12 @@
             int hsize_nav, hmargin_nav, vsize_nav, vgap_info_nav, vgap_nav_nav, vgap_nav1_nav2;
             int hsize_button_small, hsize_button_large, hgap_button, vsize_button, vmargin_bottom;
         } param[] = {
+            {  // VTS_16 (320x240)
+                2, 5, 10, 14,
+                5, 5, 5, 5,
+                10, 5, 25, 10, 5, 45,
+                45, 70, 5, 17, 7
+            },
             {  // VTS_32 (640x480)
                 5, 10, 20, 28,
                 10, 10, 10, 10,
@@ -85,6 +91,7 @@
         };
 
         const video::VMInfo &vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width < 640 ? 1 : 0;
         video::VideoModes vm = vminfo.videomode;
         video::VideoTileType vtt = vminfo.tt;
         
@@ -114,7 +121,7 @@
         hlr->add_back (but_back);
         
         hl = new HList;
-        hl->set_spacing (10);
+        hl->set_spacing (vshrink?5:10);
         hl->set_alignment (HALIGN_CENTER, VALIGN_TOP);
         hl->set_default_size (2*param[vtt].hsize_button_large + param[vtt].hgap_button, param[vtt].vsize_button);
         hl->add_back (hll);

Modified: trunk/src/gui/LevelPackConfig.cc
===================================================================
--- trunk/src/gui/LevelPackConfig.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/LevelPackConfig.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -85,6 +85,7 @@
             bool forceGroupReasign) : isReasignOnly (forceGroupReasign), 
             undo_quit (false), didEditMetaData (false), titleTF (NULL) {
         const video::VMInfo &vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width < 640 ? 1 : 0;
         
         if (indexName.empty())
             // new levelpack
@@ -148,9 +149,9 @@
         }
 
         VList * titleLeftVList = new VList;
-        titleLeftVList->set_spacing(11);
+        titleLeftVList->set_spacing(vshrink?5:11);
         titleLeftVList->set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        titleLeftVList->set_default_size(140, 35);
+        titleLeftVList->set_default_size(vshrink?70:140, vshrink?17:35);
         Label * titleLabel = new Label(N_("Levelpack:"), HALIGN_RIGHT);
         Label * ownerLabel = new Label(N_("Owner:"), HALIGN_RIGHT);
         Label * groupLabel = new Label(N_("Group:"), HALIGN_RIGHT);
@@ -170,9 +171,9 @@
         }
         
         valueLeftVList = new VList;
-        valueLeftVList->set_spacing(11);
+        valueLeftVList->set_spacing(vshrink?5:11);
         valueLeftVList->set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        valueLeftVList->set_default_size(160, 35);
+        valueLeftVList->set_default_size(vshrink?80:160, vshrink?17:35);
 
         titleValueLabel = new UntranslatedLabel(indexName, HALIGN_CENTER);
         ownerValueLabel = new UntranslatedLabel(isPersistent ? persIndex->getOwner() : "System");
@@ -197,9 +198,9 @@
         }
 
         VList * scrollVList = new VList;
-        scrollVList->set_spacing(12);
+        scrollVList->set_spacing(vshrink?6:12);
         scrollVList->set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        scrollVList->set_default_size(30, 35);
+        scrollVList->set_default_size(vshrink?15:30, vshrink?17:35);
 
         scrollUp = new ImageButton("ic-up", "ic-up1", this);
         scrollDown = new ImageButton("ic-down", "ic-down1", this);
@@ -207,9 +208,9 @@
         scrollVList->add_back(scrollDown);
 
         VList * metaVList = new VList;
-        metaVList->set_spacing(12);
+        metaVList->set_spacing(vshrink?6:12);
         metaVList->set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        metaVList->set_default_size(140, 35);
+        metaVList->set_default_size(vshrink?70:140, vshrink?17:35);
         
         if (isEditable)
             but_metadata = new StaticTextButton(N_("Edit Metadata"), this);
@@ -242,9 +243,9 @@
         }
 
         valueMetaVList = new VList;
-        valueMetaVList->set_spacing(12);
+        valueMetaVList->set_spacing(vshrink?6:12);
         valueMetaVList->set_alignment(HALIGN_CENTER, VALIGN_CENTER);
-        valueMetaVList->set_default_size(75, 35);
+        valueMetaVList->set_default_size(vshrink?37:75, vshrink?17:35);
         Widget * levelmodeWidget;
         if (indexName.empty()){
             levelmode = new LevelmodeButton(false);
@@ -279,19 +280,32 @@
         }
         
 
-        if (isReasignOnly) {        
-            this->add(titleLeftVList, Rect(vminfo.width/2 - 270, 15, 140, vminfo.height-97));
-            this->add(valueLeftVList, Rect(vminfo.width/2 - 80, 15, 160, vminfo.height-97));
+        if (vshrink) {
+            if (isReasignOnly) {        
+                this->add(titleLeftVList, Rect(vminfo.width/2 - 135, 7, 70, vminfo.height-48));
+                this->add(valueLeftVList, Rect(vminfo.width/2 - 40, 7, 80, vminfo.height-48));
+            } else {
+                this->add(titleLeftVList, Rect(vminfo.width/2 - 150, 7, 70, vminfo.height-48));
+                this->add(valueLeftVList, Rect(vminfo.width/2 - 70, 7, 80, vminfo.height-48));
+                this->add(scrollVList, Rect(vminfo.width/2 + 15, 7+3*(17+6) + (vminfo.height-240)/2, 15, 5*17+4*6));
+                this->add(metaVList, Rect(vminfo.width/2 + 40, 7, 70, vminfo.height-48));
+                this->add(valueMetaVList, Rect(vminfo.width/2 + 117, 7, 37, vminfo.height-48));
+            }
         } else {
-            this->add(titleLeftVList, Rect(vminfo.width/2 - 300, 15, 140, vminfo.height-97));
-            this->add(valueLeftVList, Rect(vminfo.width/2 - 140, 15, 160, vminfo.height-97));
-            this->add(scrollVList, Rect(vminfo.width/2 + 30, 15+3*(35+12) + (vminfo.height-480)/2, 30, 5*35+4*12));
-            this->add(metaVList, Rect(vminfo.width/2 + 80, 15, 140, vminfo.height-97));
-            this->add(valueMetaVList, Rect(vminfo.width/2 + 235, 15, 75, vminfo.height-97));
+            if (isReasignOnly) {        
+                this->add(titleLeftVList, Rect(vminfo.width/2 - 270, 15, 140, vminfo.height-97));
+                this->add(valueLeftVList, Rect(vminfo.width/2 - 80, 15, 160, vminfo.height-97));
+            } else {
+                this->add(titleLeftVList, Rect(vminfo.width/2 - 300, 15, 140, vminfo.height-97));
+                this->add(valueLeftVList, Rect(vminfo.width/2 - 140, 15, 160, vminfo.height-97));
+                this->add(scrollVList, Rect(vminfo.width/2 + 30, 15+3*(35+12) + (vminfo.height-480)/2, 30, 5*35+4*12));
+                this->add(metaVList, Rect(vminfo.width/2 + 80, 15, 140, vminfo.height-97));
+                this->add(valueMetaVList, Rect(vminfo.width/2 + 235, 15, 75, vminfo.height-97));
+            }
         }
     
         errorLabel = new Label("", HALIGN_CENTER);
-        this->add(errorLabel, Rect(10, vminfo.height-97, vminfo.width-20, 35));
+        this->add(errorLabel, Rect(vshrink?5:10, vminfo.height-(vshrink?48:97), vminfo.width-(vshrink?10:20), vshrink?17:35));
         
         if (isReasignOnly) 
             errorLabel->set_text(N_("Please reasign levelpack to another group for group deletion"));
@@ -307,9 +321,9 @@
         but_back = new StaticTextButton(N_("Ok"), this);
         
         HList * commandHList = new HList;
-        commandHList->set_spacing(10);
+        commandHList->set_spacing(vshrink?5:10);
         commandHList->set_alignment(HALIGN_CENTER, VALIGN_TOP);
-        commandHList->set_default_size(140, 35);
+        commandHList->set_default_size(vshrink?70:140, vshrink?17:35);
         if (isReasignOnly) {
             commandHList->add_back(new Label());
             commandHList->add_back(new Label());
@@ -319,7 +333,7 @@
         }
         commandHList->add_back(but_ignore);
         commandHList->add_back(but_back);
-        this->add(commandHList, Rect(10, vminfo.height-50, vminfo.width-20, 35));
+        this->add(commandHList, Rect(vshrink?5:10, vminfo.height-(vshrink?25:50), vminfo.width-(vshrink?10:20), vshrink?17:35));
         
         updateLocationList();
         if (indexName.empty())

Modified: trunk/src/gui/LevelPackMenu.cc
===================================================================
--- trunk/src/gui/LevelPackMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/LevelPackMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -54,6 +54,7 @@
             scrollLeft (NULL), scrollRight (NULL), scrollUp (NULL),
             scrollDown (NULL), isLevelMenuSubmenu (false) {
         const video::VMInfo &vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width < 640 ? 1 : 0;
         vm = vminfo.videomode;
         vtt = vminfo.tt;
         vh = vminfo.area.x;
@@ -66,14 +67,14 @@
         but_main = new StaticTextButton(N_("Main Menu"), this);
         
         commandHList = new HList;
-        commandHList->set_spacing(10);
+        commandHList->set_spacing(vshrink ? 5 : 10);
         commandHList->set_alignment(HALIGN_CENTER, VALIGN_TOP);
-        commandHList->set_default_size(140, 35);
+        commandHList->set_default_size(vshrink ? 70 : 140, vshrink ? 17 : 35);
         commandHList->add_back(but_new);
         commandHList->add_back(but_search);
         commandHList->add_back(but_level);
         commandHList->add_back(but_main);
-        this->add(commandHList, Rect(10, vminfo.height-50, vminfo.width-20, 35));
+        this->add(commandHList, Rect(vshrink ? 5 : 10, vminfo.height-(vshrink ? 25 : 50), vminfo.width-(vshrink ? 10 : 20), vminfo.height < 320 ? 17 : 35));
         
     }
     
@@ -83,6 +84,11 @@
             int vmargin, vrow_row;
             int hmargin, hgroup_pack, hscrollbutton, hscroll_pack, hpack_pack;
         } param[] = {
+            {  // VTS_16 (320x240)
+                2, 9,
+                7, 5,
+                10, 18, 11, 5, 10
+            },
             {  // VTS_32 (640x480)
                 2, 9,
                 15, 10,
@@ -180,7 +186,7 @@
         groupsVList = new VList; 
         groupsVList->set_spacing(param[vtt].vrow_row);
         groupsVList->set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        groupsVList->set_default_size(160, 35);
+        groupsVList->set_default_size(vtt==0 ? 80 : 160, vtt==0 ? 17 : 35);
         
         for (int i = 0; i < usedGroupRows; i++) {
             if (i == 0 && needUpScroll) {
@@ -198,7 +204,7 @@
         }
 
         this->add(groupsVList, Rect(param[vtt].hmargin + vh, param[vtt].vmargin + vv, 
-                160, param[vtt].rows * 35 + 
+                vtt==0 ? 80 : 160, param[vtt].rows * (vtt==0 ? 17 : 35) + 
                 (param[vtt].rows - 1) * param[vtt].vrow_row));
         
         lastGroupName = curGroupName;
@@ -251,7 +257,7 @@
         packsHList = new HList; 
         packsHList->set_spacing(param[vtt].hpack_pack);
         packsHList->set_alignment(HALIGN_CENTER, VALIGN_TOP);
-        packsHList->set_default_size(160, param[vtt].rows*35 + 
+        packsHList->set_default_size(vtt==0 ? 80 : 160, param[vtt].rows*(vtt==0 ? 17 : 35) + 
                 (param[vtt].rows - 1) * param[vtt].vrow_row);
         
         for (int col = 0; col < param[vtt].packcolumns; col++) {
@@ -260,7 +266,7 @@
                 pl->set_spacing (param[vtt].vrow_row);
                 // first column is centered - if it is full it is like top alignment:
                 pl->set_alignment (HALIGN_LEFT, col == 0 ? VALIGN_CENTER : VALIGN_TOP);
-                pl->set_default_size (160, 35);
+                pl->set_default_size (vtt==0 ? 80 : 160, vtt==0 ? 17 : 35);
                 for (int row = 0; row < param[vtt].rows; row++) {
                     if (nextPack < packCount) {
                         lev::Index *ind = (*group)[nextPack];
@@ -276,29 +282,29 @@
                 break;
         }
 
-        this->add(packsHList, Rect(param[vtt].hmargin + vh + 160 + param[vtt].hgroup_pack +
+        this->add(packsHList, Rect(param[vtt].hmargin + vh + (vtt==0 ? 80 : 160) + param[vtt].hgroup_pack +
                 param[vtt].hscrollbutton + param[vtt].hscroll_pack, 
                 param[vtt].vmargin + vv, 
-                param[vtt].packcolumns * 160 + (param[vtt].packcolumns - 1) * 
+                param[vtt].packcolumns * (vtt==0 ? 80 : 160) + (param[vtt].packcolumns - 1) * 
                 param[vtt].hpack_pack, 
-                param[vtt].rows * 35 + 
+                param[vtt].rows * (vtt==0 ? 17 : 35) + 
                 (param[vtt].rows - 1) * param[vtt].vrow_row));
         
         if (needLeftScroll) {
             scrollLeft = new ImageButton("ic-left", "ic-left1", this);
-            this->add(scrollLeft, Rect(param[vtt].hmargin + vh + 160 + param[vtt].hgroup_pack,
-                    param[vtt].vmargin + vv + param[vtt].rows / 2 * (35 + param[vtt].vrow_row),
-                    param[vtt].hscrollbutton, 35));
+            this->add(scrollLeft, Rect(param[vtt].hmargin + vh + (vtt==0 ? 80 : 160) + param[vtt].hgroup_pack,
+                    param[vtt].vmargin + vv + param[vtt].rows / 2 * ((vtt==0 ? 17 : 35) + param[vtt].vrow_row),
+                    param[vtt].hscrollbutton, (vtt==0 ? 17 : 35)));
         }
                 
         if (needRightScroll) {
             scrollRight = new ImageButton("ic-right", "ic-right1", this);
-            this->add(scrollRight, Rect(param[vtt].hmargin + vh + 160 + param[vtt].hgroup_pack +
+            this->add(scrollRight, Rect(param[vtt].hmargin + vh + (vtt==0 ? 80 : 160) + param[vtt].hgroup_pack +
                     param[vtt].hscrollbutton + 2 * param[vtt].hscroll_pack +
-                    param[vtt].packcolumns * 160 + (param[vtt].packcolumns - 1) * 
+                    param[vtt].packcolumns * (vtt==0 ? 80 : 160) + (param[vtt].packcolumns - 1) * 
                     param[vtt].hpack_pack,
-                    param[vtt].vmargin + vv+ param[vtt].rows / 2 * (35 + param[vtt].vrow_row),
-                    param[vtt].hscrollbutton, 35));
+                    param[vtt].vmargin + vv+ param[vtt].rows / 2 * ((vtt==0 ? 17 : 35) + param[vtt].vrow_row),
+                    param[vtt].hscrollbutton, (vtt==0 ? 17 : 35)));
         }
     }
     

Modified: trunk/src/gui/LevelWidget.cc
===================================================================
--- trunk/src/gui/LevelWidget.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/LevelWidget.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -46,9 +46,10 @@
             listener(0), isInvalidateUptodate (true), lastUpdate (0)
     {
         const video::VMInfo &vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width < 640 ? 1 : 0;
     
-        buttonw = vminfo.thumbw + 27;  // min should be +30 for all modes but 640x480
-        buttonh = vminfo.thumbh + 28;
+        buttonw = vminfo.thumbw + (vshrink?13:27);  // min should be +30 for all modes but 640x480
+        buttonh = vminfo.thumbh + (vshrink?14:28);
         curIndex = lev::Index::getCurrentIndex();
         iselected = curIndex->getCurrentPosition();
         ifirst = curIndex->getScreenFirstPosition();

Modified: trunk/src/gui/MainMenu.cc
===================================================================
--- trunk/src/gui/MainMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/MainMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -49,6 +49,7 @@
     void ChangeVideoMode()
     {
         enigma::WorldPrepareLevel();      // make sure no references to models remain
+        enigma::ClearFontCache();
         video::ChangeVideoMode();
         LevelPreviewCache::instance()->clear();
         enigma::ClearImageCache();
@@ -210,9 +211,9 @@
     void MainMenu::build_menu() 
     {
         const video::VMInfo *vminfo = video::GetInfo();
-    
-        int y[] = {150, 170, 200, 200};
-        BuildVList b(this, Rect((vminfo->width - 150)/2, y[vminfo->tt], 150, 40), 5);
+        const int vshrink = vminfo->width < 640 ? 1 : 0;
+        int y[] = {75, 150, 170, 200, 200};
+        BuildVList b(this, Rect((vminfo->width - 150)/2, y[vminfo->tt], 150, vshrink?20:40), 5);
         m_startgame = b.add(new StaticTextButton(N_("Start Game"), this));
         m_levelpack = b.add(new StaticTextButton(N_("Level Pack"), this));
 #ifdef ENABLE_EXPERIMENTAL
@@ -236,7 +237,7 @@
         Font *f = enigma::GetFont("levelmenu");
         Surface * logo(enigma::GetImage("enigma_logo3"));
         int x0=(vminfo->width - logo->width())/2;
-        int y0[] = {30, 40, 50, 60};
+        int y0[] = {0, 30, 40, 50, 60};
         blit(gc, x0, y0[vminfo->tt], logo);
         f->render (gc, 5, vminfo->height - 20, app.getVersionInfo().c_str());
     }

Modified: trunk/src/gui/OptionsMenu.cc
===================================================================
--- trunk/src/gui/OptionsMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/OptionsMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -326,13 +326,14 @@
       background(background_),
       previous_caption(video::GetCaption())
     {
-        const int spacing     = 5;
-        const int big_spacing = 60;
-        const int label_width = 180;
-        const int but_width   = 100;
-        const int but_height  = 30;
         const video::VMInfo *vminfo = video::GetInfo();
-        int hmargin = vminfo->width < 660 ? 10 : (vminfo->width < 900 ? 20 : 80);
+        const int vshrink = vminfo->width < 640 ? 1 : 0;
+        const int spacing     = vshrink ? 2 : 5;
+        const int big_spacing = vshrink ? 30 : 60;
+        const int label_width = vshrink ? 90 : 180;
+        const int but_width   = vshrink ? 50 : 100;
+        const int but_height  = vshrink ? 15 : 30;
+        int hmargin = vshrink ? 5 : (vminfo->width < 660 ? 10 : (vminfo->width < 900 ? 20 : 80));
         int midspacing = vminfo->width - 2*hmargin - 2*but_width - 2*label_width;
     
         BuildVList leftlabels (this, Rect(-label_width, 0, label_width, but_height), spacing);

Modified: trunk/src/gui/SearchMenu.cc
===================================================================
--- trunk/src/gui/SearchMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/SearchMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -35,6 +35,7 @@
 
      SearchMenu::SearchMenu() : didSearch (false) {
         const video::VMInfo &vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width < 640 ? 1 : 0;
         ecl::Font *menufont = enigma::GetFont("menufont");
         
         Label * shallowTitle = new Label(N_("Shallow Search:"), HALIGN_LEFT);
@@ -42,15 +43,15 @@
         std::string helpText = _("case independent search in title, author, filename");
         std::string workString = helpText;
         std::string::size_type breakPos = breakString(menufont, workString, 
-                    " ", 380);
+                    " ", vshrink?190:380);
         Label * shallowHelp1 = new UntranslatedLabel(workString.substr(0,breakPos), HALIGN_LEFT);
         Label * shallowHelp2 = new UntranslatedLabel(workString.substr(breakPos), HALIGN_LEFT);
         shallowSearch = new TextField("", this);
         
-        this->add(shallowTitle, Rect(vminfo.width/2 - 190, vminfo.height/2 - 100, 380, 35));
-        this->add(shallowHelp1, Rect(vminfo.width/2 - 190, vminfo.height/2 - 40, 380, 25));
-        this->add(shallowHelp2, Rect(vminfo.width/2 - 190, vminfo.height/2 - 10, 380, 25));
-        this->add(shallowSearch, Rect(vminfo.width/2 - 190, vminfo.height/2 + 55, 380, 35));
+        this->add(shallowTitle, Rect(vminfo.width/2 - (vshrink?95:190), vminfo.height/2 - (vshrink?50:100), vshrink?190:380, vshrink?17:35));
+        this->add(shallowHelp1, Rect(vminfo.width/2 - (vshrink?95:190), vminfo.height/2 - (vshrink?20:40), vshrink?190:380, vshrink?12:25));
+        this->add(shallowHelp2, Rect(vminfo.width/2 - (vshrink?95:190), vminfo.height/2 - (vshrink?5:10), vshrink?190:380, vshrink?12:25));
+        this->add(shallowSearch, Rect(vminfo.width/2 - (vshrink?95:190), vminfo.height/2 + (vshrink?27:55), vshrink?190:380, vshrink?17:35));
        
         // Create buttons - positioning identical to Levelmenu
         Label * dummy1 = new Label();
@@ -61,12 +62,12 @@
         HList * commandHList = new HList;
         commandHList->set_spacing(10);
         commandHList->set_alignment(HALIGN_CENTER, VALIGN_TOP);
-        commandHList->set_default_size(140, 35);
+        commandHList->set_default_size(vshrink?70:140, vshrink?17:35);
         commandHList->add_back(dummy1);
         commandHList->add_back(dummy2);
         commandHList->add_back(but_ignore);
         commandHList->add_back(but_search);
-        this->add(commandHList, Rect(10, vminfo.height-50, vminfo.width-20, 35));
+        this->add(commandHList, Rect(vshrink?5:10, vminfo.height-(vshrink?25:50), vminfo.width-(vshrink?10:20), vshrink?17:35));
         
         set_key_focus(shallowSearch);
     }

Modified: trunk/src/gui/TextField.cc
===================================================================
--- trunk/src/gui/TextField.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/TextField.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -37,14 +37,11 @@
 
 #define SCREEN ecl::Screen::get_instance()
 
-ecl::Font *TextField::menufont = 0;
-
 TextField::TextField(const std::string &t, ActionListener *al) : cursorTime(0),
         showCursor(true), isLastActionReturn (false), invalidChars(""),
         isLimitedToValidChars(false), maxChars(-1) {
-    if (menufont == 0) {
-        menufont = enigma::GetFont("menufont");
-    }
+    menufont = enigma::GetFont("menufont");
+    
     set_listener(al);
     textPreCursor = t;
     ecl::utf8CharSizes(textPreCursor, charSizesPreCursor);

Modified: trunk/src/gui/TextField.hh
===================================================================
--- trunk/src/gui/TextField.hh	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/TextField.hh	2008-01-06 16:27:59 UTC (rev 975)
@@ -91,7 +91,7 @@
         std::string invalidChars;
         int maxChars;
         bool isLastActionReturn;
-        static ecl::Font *menufont;
+        ecl::Font *menufont;
     };
 }} // namespace enigma::gui
 #endif

Modified: trunk/src/gui/widgets.cc
===================================================================
--- trunk/src/gui/widgets.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/widgets.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -767,14 +767,9 @@
 
 /* -------------------- TextButton -------------------- */
 
-ecl::Font *TextButton::menufont = 0;
-ecl::Font *TextButton::menufont_pressed = 0;
-
 TextButton::TextButton(ActionListener *al) {
-    if (menufont == 0) {
-        menufont = enigma::GetFont("menufont");
-        menufont_pressed = enigma::GetFont("menufontsel");
-    }
+    menufont = enigma::GetFont("menufont");
+    menufont_pressed = enigma::GetFont("menufontsel");
     set_listener(al);
 }
 

Modified: trunk/src/gui/widgets.hh
===================================================================
--- trunk/src/gui/widgets.hh	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/widgets.hh	2008-01-06 16:27:59 UTC (rev 975)
@@ -375,7 +375,8 @@
         void draw(ecl::GC &gc, const ecl::Rect &r);
 
         // Variables.
-        static ecl::Font *menufont, *menufont_pressed;
+        ecl::Font *menufont;
+        ecl::Font *menufont_pressed;
     };
 
 /* -------------------- StaticTextButton -------------------- */

Modified: trunk/src/main.cc
===================================================================
--- trunk/src/main.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/main.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -382,6 +382,7 @@
     
     //
     if (isMakePreviews) {
+        app.state->setProperty("Difficulty", DIFFICULTY_HARD); // will not be saved
         std::set<lev::Proxy *> proxies = lev::Proxy::getProxies();
         int size = proxies.size();
         std::set<lev::Proxy *>::iterator it;
@@ -402,15 +403,21 @@
         scr->flush_updates();
         
         int i = 0;
-        for (int m=0; m<2; m++) {
+        for (int m=0; m<3; m++) {
+            switch (m) {
+                case 0 : video::SetThumbInfo(120, 78, ""); break;
+                case 1 : video::SetThumbInfo(160, 104, "-160x104"); break;
+                case 2 : video::SetThumbInfo(60, 39, "-60x39"); break;
+            }        
             for (it = proxies.begin(); it != proxies.end(); it++, i++) {
+                Log << "Make preview " << (*it)->getId() << "\n";
                 gui::LevelPreviewCache::makeSystemPreview(*it, systemAppDataPath);
                 vline(gc, 170 + i*150 / size, 280, 20);
                 scr->update_all ();
                 scr->flush_updates();
             }
-            video::SetThumbInfo(160, 104, "-160x104");
         }
+        Log << "Maske preview finished succesfully\n";
         return;
     }
     

Modified: trunk/src/video.cc
===================================================================
--- trunk/src/video.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/video.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -499,6 +499,23 @@
             Rect (504, 873, 947, 53),        // text area //TODO
             false, true,                     // available window, fullscreen
             "-0-","-9-0-"                    // fallback modes window, fullscreen
+        },
+        { 
+            VM_320x240, 320, 240,            // id, w, h
+            16, VTS_16,                      // tilesize, tiletype
+            "320x240", "CGA", "4:3",         // name, fsname, fs only
+            "models-16.lua", "gfx16/",       // initscript, dir
+            Rect (0, 0, 320, 240),           // display area
+            0, 0,                            // menu background image offsets 
+            60, 39, "-60x39",                // thumbnail size/extension
+            Rect (0, 0, 320, 208),           // game area
+            Rect (0, 208, 320, 32),          // statusbar area
+            Rect (5, 212, 587, 21),          // time area
+            Rect (50, 212, 15, 21),          // moves area
+            Rect (76, 216, 245, 26),         // inventory area
+            Rect (75, 217, 237, 17),         // text area
+            true, true,                      // available window, fullscreen
+            "-10-0-","-0-"                   // fallback modes window, fullscreen
         }
     };
 

Modified: trunk/src/video.hh
===================================================================
--- trunk/src/video.hh	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/video.hh	2008-01-06 16:27:59 UTC (rev 975)
@@ -41,14 +41,16 @@
         VM_1440x960  = 7,   ///< 64 bit embedded -  3:2  - none
         VM_1280x1024 = 8,   ///< 64 bit embedded -  5:4  - SXGA
         VM_1680x1050 = 9,   ///< 64 bit embedded - 16:10 - WSXGA+
+        VM_320x240   = 10,  ///< 16 bit basic    -  4:3  - CGA
         VM_COUNT
     };
     
     enum VideoTileType {    // Tile size in pixels
-        VTS_32 = 0,
-        VTS_40 = 1,
-        VTS_48 = 2,
-        VTS_64 = 3
+        VTS_16 = 0,
+        VTS_32 = 1,
+        VTS_40 = 2,
+        VTS_48 = 3,
+        VTS_64 = 4,
     };
 
     struct VMInfo {



From raoulb at bluewin.ch  Mon Jan  7 00:29:18 2008
From: raoulb at bluewin.ch (Raoul)
Date: Mon, 7 Jan 2008 00:29:18 +0100
Subject: [Enigma-game-svn] Commit 976
Message-ID: <20080107002918.447c2167@bluewin.ch>

-> 20 new levels! This gives a total of 63 new levels since Enigma 1.01
-> Bugfixes for "Temple of Gold", "Chess and Boxes", "Correspondence chess", "Seed puzzle 2"
-> Fixed all wrong "(C)" singns in utf-8


From andreasl at mail.berlios.de  Mon Jan  7 01:04:33 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Mon, 7 Jan 2008 01:04:33 +0100
Subject: [Enigma-game-svn] r977 - homepage/input/articles
Message-ID: <200801070004.m0704XgW006603@sheep.berlios.de>

Author: andreasl
Date: 2008-01-07 01:04:32 +0100 (Mon, 07 Jan 2008)
New Revision: 977

Modified:
   homepage/input/articles/eoya_2007_ru.html
Log:
Homepage:
 - Replaced last <nobr>-tag in Russian EoYA-article
   by use of "longline", to reduce column width.


Modified: homepage/input/articles/eoya_2007_ru.html
===================================================================
--- homepage/input/articles/eoya_2007_ru.html	2008-01-06 23:26:33 UTC (rev 976)
+++ homepage/input/articles/eoya_2007_ru.html	2008-01-07 00:04:32 UTC (rev 977)
@@ -52,8 +52,12 @@
 ??????? ???? 2001</div>
 </div>
 
+<p>
+  <img class="leftimage" src="$$imagedir$$/articles/longline.png" alt="" border="0">
+</p>
+
 <div class="quote">
-<nobr>??? ?????????, ?????????????? ??????????? ????????, ??? ???????? ???? ????? ??????? ??????:</nobr>
+??? ?????????, ?????????????? ??????????? ????????, ??? ???????? ???? ????? ??????? ??????:
 
 <pre>(o2-create-world &quot;Test Level&quot; 40 40)
 



From ral at mail.berlios.de  Thu Jan 10 00:31:12 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 10 Jan 2008 00:31:12 +0100
Subject: [Enigma-game-svn] r978 - in trunk: data src src/stones
Message-ID: <200801092331.m09NVCUI002323@sheep.berlios.de>

Author: ral
Date: 2008-01-10 00:31:09 +0100 (Thu, 10 Jan 2008)
New Revision: 978

Added:
   trunk/src/stones/BoulderStone.cc
   trunk/src/stones/BoulderStone.hh
Modified:
   trunk/data/init.lua
   trunk/src/Makefile.am
   trunk/src/items.cc
   trunk/src/laser.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.cc
   trunk/src/stones.hh
   trunk/src/stones/FourSwitch.cc
   trunk/src/stones/OxydStone.cc
   trunk/src/stones/Switch.hh
   trunk/src/stones_complex.cc
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: Reengineering Bolder
- renaming "st-bolder" to "st_boulder"
- abolishing inconsistent message "trigger" by mapping to existing
  alternative messages for old API
- new internal message "_trigger" just sent by boulder: 
  - value true (rising edge): just arrived on neighbour grid - make place or act
  - value false (falling edge): relax
- mirror and fourswitch just act on rising edge - they turn just once
- impulsestones do not push back the boulder that triggered them
- boulder reverses dir on laser light from back and front once
- boulder starts faster after init - with blocker items in front and
  beneath boulder all initial constellations can be set up that occur in
  runtime, too.
- rotator impulses on a blocked boulder will not generate trigger messages
  if the boulder does not change direction.
- boulder with two rotators aside will trigger a blocker stone independent
  of rotator sequence (boulder could be trapped in 1.01)
- fix r973 black/whitestone: force actor check on signals from items
Note:
- compatibility of existing levels need to be checked
- some triggered objects may be changed from rising to falling edge


Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/data/init.lua	2008-01-09 23:31:09 UTC (rev 978)
@@ -44,6 +44,11 @@
 }
 
 RenamingObjectsNew2Old = {
+    st_boulder = "st-bolder",
+    st_boulder_n = "st-bolder-n",
+    st_boulder_e = "st-bolder-e",
+    st_boulder_s = "st-bolder-s",
+    st_boulder_w = "st-bolder-w",
     st_fourswitch = "st-fourswitch",
     st_switch_instant = "st-switch",
     st_switch_black_instant = "st-switch_black",
@@ -143,9 +148,37 @@
 end
 
 MessageRenaming = {
+    ["it-blocker__trigger"] = "toggle",
+    ["it-burnable__trigger"] = "ignite",
+    ["it-burnable_ignited__trigger"] = "ignite",
+    ["it-burnable_burning__trigger"] = "ignite",
+    ["it-burnable_fireproof__trigger"] = "ignite",
+    ["it-burnable_ash__trigger"] = "ignite",
+    ["it-burnable_oil__trigger"] = "ignite",
+    ["it-hill__trigger"] = "flip",
+    ["it-hollow__trigger"] = "flip",
+    ["it-tinyhill__trigger"] = "flip",
+    ["it-tinyhollow__trigger"] = "flip",
+    ["it-vortex-open__trigger"] = "toggle",
+    ["it-vortex-closed__trigger"] = "toggle",
+    ["st-blocker__trigger"] = "toggle",
+    ["st-blocker-growing__trigger"] = "toggle",
+    st_boulder__direction = "orientate",
+    ["st-fart__trigger"] = "toggle",
+    st_fourswitch__trigger = "toggle",
+    ["st-stoneimpulse__trigger"] = "signal",
+    ["st-stoneimpulse-hollow__trigger"] = "signal",
+    ["st-stoneimpulse_movable__trigger"] = "signal",
+    ["st-lightpassenger__trigger"] = "toggle",
+    ["st-lightpassenger__onoff"] = "toggle",
+    ["st-mirror__trigger"] = "turn",
+    ["st-oxyd__trigger"] = "toggle",
+    ["st-plain__trigger"] = "signal",
+    ["st-plain_hole__trigger"] = "signal",
     st_switch_instant__onoff = "toggle",
     st_switch_black_instant__onoff = "toggle",
-    st_switch_white_instant__onoff = "toggle"
+    st_switch_white_instant__onoff = "toggle",
+    ["st-volcano__trigger"] = "toggle"
 }
 ----------------------
 -- old API 1.0      --

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/Makefile.am	2008-01-09 23:31:09 UTC (rev 978)
@@ -188,6 +188,8 @@
 	lev/ScoreManager.hh	\
 	lev/VolatileIndex.cc	\
 	lev/VolatileIndex.hh	\
+	stones/BoulderStone.cc	\
+	stones/BoulderStone.hh	\
 	stones/ConnectiveStone.cc	\
 	stones/ConnectiveStone.hh	\
 	stones/FourSwitch.cc	\

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/items.cc	2008-01-09 23:31:09 UTC (rev 978)
@@ -738,7 +738,7 @@
 
 Value HillHollow::message(const Message &m)
 {
-    if (m.message == "trigger") {
+    if (m.message == "flip") {
         Type flippedkind[] = {HOLLOW,HILL, TINYHOLLOW,TINYHILL};
         transmute(flippedkind[m_type]);
         return Value();
@@ -1936,7 +1936,7 @@
         else
             close();
         return Value();
-    } else if (m.message == "openclose" || m.message == "trigger") {
+    } else if (m.message == "openclose" || m.message == "toggle") {
         openclose();
         return Value();
     } else if (m.message == "open") {
@@ -2509,7 +2509,7 @@
         kill();   // The brush cleans the floor
         return Value();
     } else if (Floor *fl = GetFloor(get_pos())) {
-        if (m.message == "trigger" || m.message == "ignite" || m.message == "expl")
+        if (m.message == "ignite" || m.message == "expl")
             return SendMessage(fl, "ignite");
     }
     return Item::message(m);
@@ -2655,7 +2655,7 @@
 
 namespace
 {
-    /*! If a 'BolderStone' moves over a 'Blocker' the 'Blocker' starts
+    /*! If a 'BoulderStone' moves over a 'Blocker' the 'Blocker' starts
       growing and replaces itself by a BlockerStone. */
     class Blocker : public Item, public TimeHandler {
         CLONEOBJ(Blocker);
@@ -2741,7 +2741,16 @@
 
 Value Blocker::message(const Message &m)
 {
-    if (m.message == "trigger" || m.message == "openclose") {
+    if (m.message == "init") { 
+        if (Stone *st = GetStone(get_pos())) {
+            if (st->is_kind("st_boulder"))
+                if (state == IDLE)
+                    change_state(COVERED);
+                else if (state == SHRINKED)
+                    change_state(BOLDERED);
+        }
+        return Item::message(m);
+    } else if (m.message == "toggle" || m.message == "openclose") {
         switch (state) {
             case IDLE:
             case SHRINKED:
@@ -2782,7 +2791,7 @@
 
             if (state == IDLE) {
                 if (Stone *st = GetStone(get_pos())) {
-                    if (st->is_kind("st-bolder"))
+                    if (st->is_kind("st_boulder"))
                         change_state(BOLDERED); // occurs in Per.Oxyd #84
                     else
                         change_state(COVERED);
@@ -2792,13 +2801,15 @@
                 }
             }
         }
+        return Value();
     }
+    return Item::message(m);
 }
 
 void Blocker::stone_change(Stone *st)
 {
     if (st) {
-        if (st->is_kind("st-bolder")) { // bolder arrived
+        if (st->is_kind("st_boulder")) { // bolder arrived
             switch (state) {
             case IDLE:
                 change_state(COVERED);

Modified: trunk/src/laser.cc
===================================================================
--- trunk/src/laser.cc	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/laser.cc	2008-01-09 23:31:09 UTC (rev 978)
@@ -503,7 +503,7 @@
     set_attrib("transparent", transparent);
     set_attrib("movable", movable);
     set_attrib("orientation", Value(1));
-    traits.name = "INVALID";
+    traits.name = "st-mirror";
     traits.id = st_INVALID;
     traits.flags = stf_none;
     traits.material = material_stone;
@@ -520,7 +520,7 @@
 }
 
 Value MirrorStone::message(const Message &m) {
-    if (m.message == "trigger" || m.message == "turn") {
+    if ((m.message == "_trigger" && m.value.to_bool()) || m.message == "turn") {
         rotate_right();
         return Value();
     }

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/ox_peroxyd.cc	2008-01-09 23:31:09 UTC (rev 978)
@@ -325,10 +325,10 @@
     "st-chargeplus",            // PerOxyd stone 0x80
     "st-chargeminus",           // PerOxyd stone 0x81
     "st-chargezero",            // PerOxyd stone 0x82
-    "st-bolder-n",              // PerOxyd stone 0x83
-    "st-bolder-s",              // PerOxyd stone 0x84
-    "st-bolder-w",              // PerOxyd stone 0x85
-    "st-bolder-e",              // PerOxyd stone 0x86
+    "st_boulder_n",             // PerOxyd stone 0x83
+    "st_boulder_s",             // PerOxyd stone 0x84
+    "st_boulder_w",             // PerOxyd stone 0x85
+    "st_boulder_e",             // PerOxyd stone 0x86
     "st-rock5",                 // PerOxyd stone 0x87
     UNUSED,                     // PerOxyd stone 0x88
     UNUSED,                     // PerOxyd stone 0x89

Added: trunk/src/stones/BoulderStone.cc
===================================================================
--- trunk/src/stones/BoulderStone.cc	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/stones/BoulderStone.cc	2008-01-09 23:31:09 UTC (rev 978)
@@ -0,0 +1,180 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/BoulderStone.hh"
+#include "player.hh"
+#include "world.hh"
+//#include "main.hh"
+
+namespace enigma {
+    BoulderStone::BoulderStone(Direction dir) {
+        state = INIT;
+        // do not use set_dir, because this will set the state to ACTIVE
+        Object::set_attrib("direction", dir);
+    }
+    
+    void BoulderStone::set_attrib(const string& key, const Value &val) {
+        if (key == "direction") {
+            if (isDisplayable())
+                setDir(to_direction(val));
+            else
+                Object::set_attrib(key, val);
+            return;
+        }
+        PhotoStone::set_attrib(key, val);
+    }
+
+    Value BoulderStone::message(const Message &m) {
+        if (m.message == "orientate" && state != FALLING && isDisplayable()) {
+            setDir(to_direction(m.value));
+            return Value();
+        }
+        return PhotoStone::message(m);
+    }
+
+    int BoulderStone::externalState() const {
+        return 0;   // no external states
+    }
+    
+    void BoulderStone::setState(int extState) {
+        // no external states
+    }
+    
+    void BoulderStone::on_creation(GridPos p) {
+        PhotoStone::on_creation(p);
+        photo_activate();
+    }
+    void BoulderStone::on_removal(GridPos p) {
+        photo_deactivate();
+        PhotoStone::on_removal(p);
+    }
+    
+    void BoulderStone::init_model() {
+        std::string mname  = "st-bolder" + to_suffix(getDir());
+        if (state == FALLING)
+            mname += "-fall-anim";
+        set_anim(mname);
+    }
+
+    void BoulderStone::animcb() {
+        display::Model *m = get_model();
+        Direction dir = getDir();
+        switch (state) {
+            case FALLING:
+                KillStone(get_pos());
+                break;
+            case INIT:
+                state = IDLE;
+                if (!haveObstacle(dir)) {
+                    move_stone(dir);  // makes object ACTIVE
+                    init_model();
+                } else
+                    m->restart();  // same pos and dir
+                break;
+            case IDLE:
+                if (!haveObstacle(dir)) {
+                    state = ACTIVE;
+                }
+                m->restart();  // same dir
+                break;
+            case ACTIVE:
+                triggerObstacle(dir, false);
+                if (!move_stone(dir)) {
+                    state = IDLE;
+                }
+                init_model();
+                break;
+        }
+    }
+
+    void BoulderStone::actor_hit(const StoneContact &sc) {
+        if (state == FALLING)
+            return;
+
+        if (player::WieldedItemIs (sc.actor, "it-magicwand")) {
+            setDir(reverse(getDir()));
+        }
+    }
+
+    void BoulderStone::on_floor_change() {
+        Floor *fl = GetFloor(get_pos());
+        if (fl->is_kind("fl-abyss")) {
+            state = FALLING;
+            init_model();
+        }
+    }
+    
+    void BoulderStone::on_move() {
+        state = ACTIVE;
+        triggerObstacle(getDir(), true);
+        Stone::on_move();
+    }
+    
+    void BoulderStone::on_impulse(const Impulse& impulse) {
+        if (state == FALLING)
+            return;
+
+        if (impulse.sender && impulse.sender->is_kind("st-rotator")) {
+            setDir(impulse.dir);  // activate
+        }
+        move_stone(impulse.dir);  // due to rotator and impulsestone
+    }
+
+    void BoulderStone::notify_laseron() {
+        setDir(reverse(getDir()));
+    }
+    
+    void BoulderStone::notify_laseroff() {
+    }
+
+    Direction BoulderStone::getDir() const {
+        return to_direction(getAttr("direction"));
+    }
+    
+    void BoulderStone::setDir(Direction d) {
+        if (d != getDir() && (state != FALLING)) {
+            Object::set_attrib("direction", d);
+            state = ACTIVE;   // if turned by it-magicwand -> allow triggering
+            triggerObstacle(getDir(), true);
+            init_model();
+        }
+    }
+
+    bool BoulderStone::haveObstacle(Direction dir) {
+        return GetStone(move(get_pos(), dir)) != NULL;
+    }
+
+    void BoulderStone::triggerObstacle(Direction dir, bool isRaising) {
+        if (Stone *st = GetStone(move(get_pos(), dir))) {
+            SendMessage(st, "_trigger", isRaising, this);
+        }
+    }
+
+    DEF_TRAITSM(BoulderStone, "st_boulder", st_boulder, MOVABLE_IRREGULAR); // it-blocker requires all boulders to identify as st_boulder
+    
+    BOOT_REGISTER_START
+        BootRegister(new BoulderStone(), "st_boulder");
+        BootRegister(new BoulderStone(NORTH), "st_boulder_n");
+        BootRegister(new BoulderStone(EAST), "st_boulder_e");
+        BootRegister(new BoulderStone(SOUTH), "st_boulder_s");
+        BootRegister(new BoulderStone(WEST), "st_boulder_w");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/BoulderStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/BoulderStone.hh
===================================================================
--- trunk/src/stones/BoulderStone.hh	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/stones/BoulderStone.hh	2008-01-09 23:31:09 UTC (rev 978)
@@ -0,0 +1,82 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef BOULDERSTONE_HH
+#define BOULDERSTONE_HH
+
+#include "stones.hh"
+#include "laser.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class BoulderStone : public PhotoStone {
+        CLONEOBJ(BoulderStone);
+        DECL_TRAITS;
+    private:
+        enum iState {
+            INIT,       ///< 
+            ACTIVE,     ///< may send trigger into direction
+            IDLE,       ///< already sent trigger w/o success
+            FALLING     ///< falling into abyss
+        };
+    public:
+        BoulderStone(Direction dir = NORTH);
+        
+        // Object interface
+        virtual void set_attrib(const string& key, const Value &val);
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual int externalState() const;
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void on_creation(GridPos);
+        virtual void on_removal(GridPos p);
+        virtual void init_model();
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+        virtual void on_floor_change();
+        virtual void on_move();
+        virtual void on_impulse(const Impulse& impulse);
+//        virtual const char *collision_sound();
+
+        // PhotoStone interface
+        virtual void notify_laseron();
+        virtual void notify_laseroff();
+        
+    private:
+        Direction getDir() const;
+        void setDir(Direction d);
+        bool haveObstacle(Direction dir);
+        void triggerObstacle(Direction dir, bool isRaising);
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/BoulderStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones/FourSwitch.cc
===================================================================
--- trunk/src/stones/FourSwitch.cc	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/stones/FourSwitch.cc	2008-01-09 23:31:09 UTC (rev 978)
@@ -28,7 +28,7 @@
     }
     
     Value FourSwitch::message(const Message &m) {
-        if (m.message == "signal" || m.message == "trigger") {
+        if (m.message == "signal" || m.message == "_trigger") {
             if ((((int)(m.value)) % 2 == 1) || (server::GameCompatibility == enigma::GAMET_ENIGMA
                     && (server::EnigmaCompatibility < 1.10))) // Enigma 1.00 did turn on 0, too
                 turn();

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/stones/OxydStone.cc	2008-01-09 23:31:09 UTC (rev 978)
@@ -863,7 +863,7 @@
             shuffleColors();
             return Value();
         }
-        else if (m.message == "trigger" || m.message == "spitter") {
+        else if (m.message == "_trigger" || m.message == "toggle"|| m.message == "spitter") {
             tryOpen();
             return Value();
         }

Modified: trunk/src/stones/Switch.hh
===================================================================
--- trunk/src/stones/Switch.hh	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/stones/Switch.hh	2008-01-09 23:31:09 UTC (rev 978)
@@ -33,9 +33,13 @@
      * The switch starts per default in state OFF.<p>
      * Switches can be recolored by setting the "color" attribute. They can
      * send inverse action values by setting the "inverse" attribute.<p>
-     * Note that the state changes not directly on messages and attribute settings.
-     * The actions will be performed after the turning animation finished. This
-     * is a small derivation from the inconsistent 1.00 behaviour.
+     * Note that the state changes per default not directly on messages and 
+     * attribute settings. The actions will be performed after the turning 
+     * animation finished. This is a small derivation from the inconsistent
+     * 1.00 behaviour. Authors that need a switch that performs its action instantly
+     * can set the attribute "instant" to true. But the usage of other switches
+     * like "st_fourswitch", "st_floppy", "st_key" that provide an instant acton
+     * per default should be preferred.
      */
     class Switch : public Stone {
         CLONEOBJ(Switch);

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/stones.cc	2008-01-09 23:31:09 UTC (rev 978)
@@ -667,7 +667,7 @@
         const char *collision_sound() {return "stone";}
 
         virtual Value message(const Message &m) {
-            if (m.message == "trigger" || m.message == "signal") {
+            if (m.message == "_trigger" || m.message == "signal") {
                 ReplaceStone(get_pos(), MakeStone("st-plain_hole"));
                 return Value();
             }
@@ -698,7 +698,7 @@
         DECL_TRAITS;
 
         virtual Value message(const Message &m) {
-            if (m.message == "trigger" || m.message == "signal") {
+            if (m.message == "_trigger" || m.message == "signal") {
                 ReplaceStone(get_pos(), MakeStone("st-plain"));
                 return Value();
             }
@@ -892,7 +892,8 @@
                         o = SendMessage(m.sender, "_hitactor");
                     
                     Actor *a = dynamic_cast<Actor *>(o);
-                    if ((a && get_id(a) == ac_blackball) || (m.message == "signal")) {
+                    if ((a && get_id(a) == ac_blackball) || 
+                            (m.sender->getObjectType() != Object::ITEM && m.message == "signal")) {
                         if (p.y == sender->get_pos().y) {
                             SendMessage (GetStone (move (p, EAST)),  "signal", 1.0);
                             SendMessage (GetStone (move (p, WEST)),  "signal", 1.0);
@@ -931,7 +932,8 @@
                         o = SendMessage(m.sender, "_hitactor");
                         
                     Actor *a = dynamic_cast<Actor *>(o);
-                    if ((a && get_id(a) == ac_whiteball) || (m.message == "signal")) {
+                    if ((a && get_id(a) == ac_whiteball) ||
+                             (m.sender->getObjectType() != Object::ITEM && m.message == "signal")) {
                         if (p.y == sender->get_pos().y) {
                             SendMessage (GetStone (move (p, EAST)),  "signal", 1.0);
                             SendMessage (GetStone (move (p, WEST)),  "signal", 1.0);

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/stones.hh	2008-01-09 23:31:09 UTC (rev 978)
@@ -38,7 +38,7 @@
         st_black3,
         st_black4,
         st_block,
-        st_bolder,
+        st_boulder,
         st_brake,
         st_break_acblack,
         st_break_acwhite,

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/stones_complex.cc	2008-01-09 23:31:09 UTC (rev 978)
@@ -460,159 +460,6 @@
 }
 
 
-/* -------------------- BolderStone -------------------- */
-
-/** \page st-bolder Bolder Stone
-
-The bolder stone will move in one direction until another stone will
-block.  When hit with a magic wand, the bolder stone reverse its
-direction. When hitting a blocking stone it can activate switches or
-oxyd stones.
-
-\subsection boldera Attributes
-
-- \c direction  \n NORTH, EAST, SOUTH, WEST
-
-*/
-namespace
-{
-    class BolderStone : public Stone {
-        CLONEOBJ(BolderStone);
-        DECL_TRAITS;
-    public:
-        BolderStone(Direction dir=NORTH)
-        : state(IDLE)
-        {
-            set_attrib("direction", dir);
-            // do not use set_dir, because this will set the state to ACTIVE
-        }
-
-    private:
-        enum State {
-            ACTIVE,             // may send trigger into direction
-            IDLE,               // already sent trigger w/o success
-            FALLING             // falling into abyss
-        } state;
-
-
-        Direction get_dir() const {
-            return to_direction(getAttr("direction"));
-        }
-        void set_dir(Direction d) {
-            if (d != get_dir())
-                state = ACTIVE; // if turned by it-magicwand -> allow triggering
-            set_attrib("direction", d);
-        }
-
-        void on_floor_change() {
-            Floor *fl = GetFloor(get_pos());
-            if (fl->is_kind("fl-abyss")) {
-                state = FALLING;
-                init_model();
-            }
-        }
-
-        bool have_obstacle (Direction dir) {
-            return GetStone(move(get_pos(), dir)) != 0;
-        }
-
-        void trigger_obstacle (Direction dir) {
-            if (Stone *st = GetStone(move(get_pos(), dir))) {
-                SendMessage(st, "trigger", Value(dir));
-            }
-        }
-
-        void on_move() {
-            state = ACTIVE;
-            trigger_obstacle(get_dir());
-            Stone::on_move();
-        }
-
-        // Stone interface.
-        void init_model() {
-            string mname  = "st-bolder" + to_suffix(get_dir());
-            if (state == FALLING)
-                mname += "-fall-anim";
-            set_anim(mname);
-        }
-
-        void animcb() {
-            display::Model *m = get_model();
-            Direction dir = get_dir();
-            switch (state) {
-            case FALLING:
-                KillStone(get_pos());
-//                init_model();
-                break;
-
-            case IDLE:
-                if (!have_obstacle(dir)) {
-                    state = ACTIVE;
-                }
-//                 if (Model *m = get_model())
-                m->restart();
-//                init_model();
-                break;
-
-            case ACTIVE:
-                trigger_obstacle(dir);
-                if (!move_stone(dir)) {
-                    state = IDLE;
-                }
-                init_model();
-                break;
-            }
-        }
-
-        void actor_hit(const StoneContact &sc) {
-            if (state == FALLING)
-                return;
-
-            if (player::WieldedItemIs (sc.actor, "it-magicwand")) {
-                set_dir(reverse(get_dir()));
-                init_model();
-            }
-        }
-
-        void on_laserhit(Direction) {
-            set_dir(reverse(get_dir()));
-            init_model();
-
-            // @@@ FIXME:  the direction should only be inverted on NEW laserbeam
-            // not on every light-recalc. Need to use PhotoCell!
-        }
-
-        void on_impulse (const Impulse& impulse) {
-            if (state == FALLING)
-                return;
-
-            if (impulse.sender && impulse.sender->is_kind("st-rotator")) {
-                set_dir(impulse.dir);  // activate
-            }
-            init_model();
-            // try to move, activate - trigger with guarantee
-            if (!move_stone(impulse.dir))
-                // the trigger of an activation occurs on animcb - in case of
-                // two rotators the trigger in one direction would be skipped
-                // without this explicit trigger statement!
-                // Furtheron enable stoneimpulse - bolder combi to emit single
-                // trigger messages
-                trigger_obstacle(impulse.dir);
-        }
-
-        virtual Value message(const Message &m) {
-            if (m.message == "direction" && state != FALLING) {
-                set_dir(to_direction(m.value));
-                init_model();
-                return Value();
-            }
-            return Stone::message(m);
-        }
-    };
-    DEF_TRAITSM(BolderStone, "st-bolder", st_bolder, MOVABLE_IRREGULAR);
-}
-
-
 /* -------------------- BlockerStone -------------------- */
 
 /** \page st-blocker Blocker Stone
@@ -692,7 +539,7 @@
         }
 
         virtual Value message(const Message &m) {
-            if (m.message == "trigger" || m.message == "openclose") {
+            if (m.message == "_trigger" || m.message == "toggle" || m.message == "openclose") {
                 if (state == SHRINKING) {
                     change_state(GROWING);
                 }
@@ -782,7 +629,7 @@
         }
 
         virtual Value message(const Message &m) {
-            if (m.message == "trigger") {
+            if (m.message == "_trigger" || m.message == "toggle") {
                 if (state == INACTIVE) {
                     state = ACTIVE;
                     init_model();
@@ -1924,12 +1771,13 @@
 {
     class StoneImpulse_Base : public Stone {
     protected:
-        StoneImpulse_Base() : state(IDLE), incoming(NODIR)
+        StoneImpulse_Base() : state(IDLE), incoming(NODIR), nobackfire (false)
         {}
 
         enum State { IDLE, PULSING, CLOSING };
         State     state;
         Direction incoming; // direction of incoming impulse (may be NODIR)
+        bool      nobackfire;
 
         void change_state(State st);
 
@@ -1943,11 +1791,14 @@
         virtual void notify_state(State st) = 0;
 
         virtual Value message(const Message &m) {
-            if (m.message == "trigger") {
-                incoming = (m.value.getType() == Value::DOUBLE)
-                    ? Direction( static_cast<int> (m.value.get_double()+0.1))
-                    : NODIR;
-
+            if (m.message == "_trigger" && m.value.to_bool()) {
+                incoming = NODIR;
+                if (m.sender != NULL)
+                    incoming = direction_fromto(dynamic_cast<GridObject *>(m.sender)->get_pos(), get_pos());
+                
+                if (state == IDLE && incoming != NODIR) {
+                    nobackfire = true;
+                }
                 change_state(PULSING);
                 return Value();
             }
@@ -2010,12 +1861,15 @@
 
             for (int d = int(incoming)+1; d <= int(incoming)+4; ++d) {
                 int D = d%4;
-                if (haveStone[D]) {
-                    send_impulse(targetpos[D], Direction(D));
+                if (!nobackfire || reverse(incoming) != D) {
+                    if (haveStone[D]) {
+                        send_impulse(targetpos[D], Direction(D));
+                    }
                 }
             }
 
             incoming = NODIR;   // forget impulse direction
+            nobackfire = false;
             break;
         }
     }
@@ -3125,7 +2979,7 @@
         }
 
         virtual Value message (const Message &m) {
-            if (m.message == "onoff") {
+            if (m.message == "toggle") {
                 set_on(state == INACTIVE);
                 return Value();
             } else if (m.message == "signal") {
@@ -3137,7 +2991,7 @@
             } else if (m.message == "off") {
                 set_on(false);
                 return Value();
-            } else if (m.message == "trigger") {
+            } else if (m.message == "_trigger") {
                 set_on(state == INACTIVE);
                 return Value();
             }
@@ -3212,11 +3066,6 @@
 
 void Init_complex()
 {
-    Register(new BolderStone);
-    Register("st-bolder-n", new BolderStone(NORTH));
-    Register("st-bolder-e", new BolderStone(EAST));
-    Register("st-bolder-s", new BolderStone(SOUTH));
-    Register("st-bolder-w", new BolderStone(WEST));
 
     Register(new BlockerStone(true));
     Register(new BlockerStone(false));
@@ -3253,7 +3102,6 @@
     Register("st-oneway_white-s", new OneWayStone_white(SOUTH));
     Register("st-oneway_white-w", new OneWayStone_white(WEST));
 
-//    Register(new OxydStone);
 
     Register (new PullStone);
 

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-01-07 00:04:32 UTC (rev 977)
+++ trunk/src/stones_simple.cc	2008-01-09 23:31:09 UTC (rev 978)
@@ -1317,7 +1317,6 @@
     }
 }
 
-
 /* -------------------- FartStone -------------------- */
 
 /** \page st-fart Fart Stone
@@ -1405,12 +1404,10 @@
 }
 Value FartStone::message(const Message &m) 
 {
-    if (m.message == "signal" && m.value != 0) {
+    if (m.message == "toggle" || (m.message == "signal" && m.value != 0) ||
+            (m.message == "_trigger" && m.value.to_bool())) {
         change_state(FARTING);
         return Value();
-    } else if (m.message == "trigger") {
-        change_state(FARTING);
-        return Value();
     } else if (m.message == "ignite" || m.message == "expl") { 
         change_state(BREAKING);
         return Value();



From ral at mail.berlios.de  Thu Jan 10 12:51:56 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 10 Jan 2008 12:51:56 +0100
Subject: [Enigma-game-svn] r979 - in trunk: data src
Message-ID: <200801101151.m0ABpupe030284@sheep.berlios.de>

Author: ral
Date: 2008-01-10 12:51:52 +0100 (Thu, 10 Jan 2008)
New Revision: 979

Modified:
   trunk/data/init.lua
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: Reengineering Bolder
- forgotten trigger message renaming for st-black/white[1-4] added
Note:
- r978 renamed message "direction" to "orientate" to avoid clash with
  attribute named "direction"


Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-09 23:31:09 UTC (rev 978)
+++ trunk/data/init.lua	2008-01-10 11:51:52 UTC (rev 979)
@@ -161,6 +161,10 @@
     ["it-tinyhollow__trigger"] = "flip",
     ["it-vortex-open__trigger"] = "toggle",
     ["it-vortex-closed__trigger"] = "toggle",
+    ["st-black1__trigger"] = "signal",
+    ["st-black2__trigger"] = "signal",
+    ["st-black3__trigger"] = "signal",
+    ["st-black4__trigger"] = "signal",
     ["st-blocker__trigger"] = "toggle",
     ["st-blocker-growing__trigger"] = "toggle",
     st_boulder__direction = "orientate",
@@ -178,7 +182,11 @@
     st_switch_instant__onoff = "toggle",
     st_switch_black_instant__onoff = "toggle",
     st_switch_white_instant__onoff = "toggle",
-    ["st-volcano__trigger"] = "toggle"
+    ["st-volcano__trigger"] = "toggle",
+    ["st-white1__trigger"] = "signal",
+    ["st-white2__trigger"] = "signal",
+    ["st-white3__trigger"] = "signal",
+    ["st-white4__trigger"] = "signal"
 }
 ----------------------
 -- old API 1.0      --

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-01-09 23:31:09 UTC (rev 978)
+++ trunk/src/stones_simple.cc	2008-01-10 11:51:52 UTC (rev 979)
@@ -1696,7 +1696,7 @@
         }
 
         virtual Value message(const Message &m) {
-            if (m.message == "signal" || m.message == "trigger") {
+            if (m.message == "signal" || m.message == "_trigger") {
                 // toggle between black and white stone
                 m_type = (m_type + 4) % 8;
                 init_model();



From ral at mail.berlios.de  Fri Jan 11 00:52:03 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 11 Jan 2008 00:52:03 +0100
Subject: [Enigma-game-svn] r980 - in trunk: data src src/stones
Message-ID: <200801102352.m0ANq345012984@sheep.berlios.de>

Author: ral
Date: 2008-01-11 00:51:58 +0100 (Fri, 11 Jan 2008)
New Revision: 980

Added:
   trunk/src/stones/BlockerStone.cc
   trunk/src/stones/BlockerStone.hh
Modified:
   trunk/data/init.lua
   trunk/src/Makefile.am
   trunk/src/items.cc
   trunk/src/lua.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones_complex.cc
   trunk/src/video.cc
   trunk/src/world.cc
Log:
Trunk 1.1: Reengineering Blocker
- renaming st-blocker to st_blocker, st-blocker-growing to st_blocker_new
- blocker as StateObject: make use of state default support
- add old to new API message renaming on lua SendMessage
- fix old lua send message to check value existance prior access
- switch 320x240 fullscreen active
Note:
- blocker identity transfer between stone and item not yet complete


Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-10 11:51:52 UTC (rev 979)
+++ trunk/data/init.lua	2008-01-10 23:51:58 UTC (rev 980)
@@ -44,6 +44,8 @@
 }
 
 RenamingObjectsNew2Old = {
+    st_blocker = "st-blocker",
+    st_blocker_new = "st-blocker-growing",
     st_boulder = "st-bolder",
     st_boulder_n = "st-bolder-n",
     st_boulder_e = "st-bolder-e",
@@ -165,8 +167,10 @@
     ["st-black2__trigger"] = "signal",
     ["st-black3__trigger"] = "signal",
     ["st-black4__trigger"] = "signal",
-    ["st-blocker__trigger"] = "toggle",
-    ["st-blocker-growing__trigger"] = "toggle",
+    st_blocker__openclose = "toggle",
+    st_blocker__trigger = "toggle",
+    st_blocker_new__openclose = "toggle",
+    st_blocker_new__trigger = "toggle",
     st_boulder__direction = "orientate",
     ["st-fart__trigger"] = "toggle",
     st_fourswitch__trigger = "toggle",

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-01-10 11:51:52 UTC (rev 979)
+++ trunk/src/Makefile.am	2008-01-10 23:51:58 UTC (rev 980)
@@ -188,6 +188,8 @@
 	lev/ScoreManager.hh	\
 	lev/VolatileIndex.cc	\
 	lev/VolatileIndex.hh	\
+	stones/BlockerStone.cc	\
+	stones/BlockerStone.hh	\
 	stones/BoulderStone.cc	\
 	stones/BoulderStone.hh	\
 	stones/ConnectiveStone.cc	\

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-01-10 11:51:52 UTC (rev 979)
+++ trunk/src/items.cc	2008-01-10 23:51:58 UTC (rev 980)
@@ -2725,7 +2725,7 @@
 
 void Blocker::grow()
 {
-    Stone *st = MakeStone("st-blocker-growing");
+    Stone *st = MakeStone("st_blocker_new");
     SetStone(get_pos(), st);
     TransferObjectName(this, st);
     kill();

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-01-10 11:51:52 UTC (rev 979)
+++ trunk/src/lua.cc	2008-01-10 23:51:58 UTC (rev 980)
@@ -564,12 +564,16 @@
 {
     Object     *obj = to_object(L, 1);
     const char *msg = lua_tostring(L, 2);
-    Value v;
+    Value result;  // nil
+    Value v;  // nil
+    if (lua_gettop(L) >= 3)
+        v = to_value(L, 3);
     if (!msg)
         throwLuaError(L,"Illegal message");
     else if (obj) {
+        std::string new_msg = lua::NewMessageName(L, obj, msg);
         try {
-            v = SendMessage (obj, msg, to_value(L, 3));
+            result = SendMessage (obj, new_msg, v);
         }
         catch (const XLevelRuntime &e) {
             throwLuaError (L, e.what());
@@ -578,7 +582,7 @@
             throwLuaError (L, "uncaught exception");
         }
     }
-    push_value(L, v);
+    push_value(L, result);
     return 0;
 }
 

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-01-10 11:51:52 UTC (rev 979)
+++ trunk/src/ox_peroxyd.cc	2008-01-10 23:51:58 UTC (rev 980)
@@ -347,7 +347,7 @@
     "st-rubberband",            // PerOxyd stone 0x96
     "st-scissors",              // PerOxyd stone 0x97
     "st-grate3",                // PerOxyd stone 0x98
-    "st-blocker",               // PerOxyd stone 0x99
+    "st_blocker",               // PerOxyd stone 0x99
     "st-grate1",                // PerOxyd stone 0x9a
     "st-metal_hole",            // PerOxyd stone 0x9b
     "st-stone1",                // PerOxyd stone 0x9c

Added: trunk/src/stones/BlockerStone.cc
===================================================================
--- trunk/src/stones/BlockerStone.cc	2008-01-10 11:51:52 UTC (rev 979)
+++ trunk/src/stones/BlockerStone.cc	2008-01-10 23:51:58 UTC (rev 980)
@@ -0,0 +1,140 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/BlockerStone.hh"
+#include "errors.hh"
+#include "server.hh"
+//#include "main.hh"
+
+namespace enigma {
+    
+    BlockerStone::BlockerStone(bool solid) : Stone (solid ? "st_blocker" : "st_blocker_new") {
+        state = solid ? SOLID : GROWING; 
+    }
+
+    Value BlockerStone::message(const Message &m) {
+        if (m.message == "_trigger") {
+            setIState(SHRINKING);    // same as "open" -- no toggle to avoid race condition of boulders
+            return Value();
+        }
+        return Stone::message(m);
+    }
+    
+    void BlockerStone::toggleState() {
+        if (state == SHRINKING) {  // revert shrinking for door like behaviour
+            setIState(GROWING);
+        }
+        else {
+            setIState(SHRINKING);
+        }
+    }
+    
+    int BlockerStone::externalState() const {
+        return 0;   // always closed -- it_blocker is open
+    }
+    
+    void BlockerStone::setState(int extState) {
+        if (extState == 1) {    // -> open (shrink)
+            setIState(SHRINKING);
+        }
+        else {          // value == 0 -> close (grow)
+            if (state == SHRINKING)
+                setIState(GROWING);
+        }
+    }
+    
+    void BlockerStone::init_model() {
+        switch (state) {
+            case SOLID:
+                set_model("st-blocker");
+                break;
+            case SHRINKING:
+                set_anim("st-blocker-shrinking");
+                break;
+            case GROWING:
+                set_anim("st-blocker-growing");
+                break;
+        }
+    }
+
+    void BlockerStone::animcb() {
+        switch (state) {
+            case SHRINKING: {
+                Item *it = MakeItem("it-blocker-new");
+                SetItem(get_pos(), it);
+                TransferObjectName(this, it);   // TODO transfer user attr., target, action
+                KillStone(get_pos());
+                break;
+            }
+            case GROWING:
+                setIState(SOLID);
+                break;
+            default :
+                ASSERT(false, XLevelRuntime, "BlockerStone: animcb called with inconsistent state");
+                break;
+        }
+    }
+    
+    StoneResponse BlockerStone::collision_response(const StoneContact &sc) {
+        return (server::GameCompatibility == GAMET_PEROXYD && state == GROWING || state == SHRINKING)
+                ? STONE_PASS : STONE_REBOUND;
+    }
+
+    void BlockerStone::actor_contact(Actor *a) {
+        if ((state == GROWING && server::GameCompatibility != GAMET_PEROXYD) ||
+                (state == SOLID && server::GameCompatibility == GAMET_PEROXYD)) {
+            SendMessage(a, "shatter");
+        }
+    }
+    void BlockerStone::actor_inside(Actor *a) {
+        if ((state == GROWING && server::GameCompatibility != GAMET_PEROXYD) ||
+                (state == SOLID && server::GameCompatibility == GAMET_PEROXYD)) {
+            SendMessage(a, "shatter");
+        }
+    }
+    
+    void BlockerStone::setIState(iState newState) {
+        if (state != newState) {
+            if (state == GROWING && newState == SHRINKING) {
+                state = SHRINKING;
+                get_model()->reverse();
+            }
+            else if (state == SHRINKING && newState == GROWING) {
+                state = GROWING;
+                get_model()->reverse();
+            }
+            else {
+                state = newState;
+                init_model();
+                if (newState == SOLID) {
+                    Object::set_attrib("kind", "st_blocker");
+                }
+            }
+        }
+    }
+    
+    DEF_TRAITSM(BlockerStone, "INVALID", st_INVALID, MOVABLE_BREAKABLE);
+    
+    BOOT_REGISTER_START
+        BootRegister(new BlockerStone(true), "st_blocker");
+        BootRegister(new BlockerStone(false), "st_blocker_new");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/BlockerStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/BlockerStone.hh
===================================================================
--- trunk/src/stones/BlockerStone.hh	2008-01-10 11:51:52 UTC (rev 979)
+++ trunk/src/stones/BlockerStone.hh	2008-01-10 23:51:58 UTC (rev 980)
@@ -0,0 +1,72 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef BLOCKERSTONE_HH
+#define BLOCKERSTONE_HH
+
+#include "stones.hh"
+#include "laser.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class BlockerStone : public Stone {
+        CLONEOBJ(BlockerStone);
+        DECL_TRAITS;
+    private:
+        enum iState {
+            SOLID,       ///<  
+            SHRINKING,   ///< 
+            GROWING      ///< 
+        };
+    public:
+        BlockerStone(bool solid);
+        
+        // Object interface
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual void toggleState();
+        virtual int externalState() const;
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual StoneResponse collision_response(const StoneContact &sc);
+//        virtual void actor_hit(const StoneContact &sc);
+        virtual void actor_contact (Actor * a);
+        virtual void actor_inside (Actor * a);
+//        virtual const char *collision_sound();
+        
+    private:
+        void setIState(iState newState);
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/BlockerStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2008-01-10 11:51:52 UTC (rev 979)
+++ trunk/src/stones_complex.cc	2008-01-10 23:51:58 UTC (rev 980)
@@ -28,6 +28,7 @@
 #include "stones/ConnectiveStone.hh"
 #include "actors.hh"
 #include "main.hh"
+#include "Value.hh"
 
 #include "ecl_util.hh"
 
@@ -460,135 +461,6 @@
 }
 
 
-/* -------------------- BlockerStone -------------------- */
-
-/** \page st-blocker Blocker Stone
-
-The BlockerStone acts like a normal stone until it is hit by a
-BolderStone. Then it shrinks and morphs into a 'Blocker' item.
-
-*/
-
-namespace
-{
-    class BlockerStone : public Stone {
-        CLONEOBJ(BlockerStone);
-        DECL_TRAITS;
-    public:
-        BlockerStone(bool solid)
-        : Stone(solid ? "st-blocker" : "st-blocker-growing"), 
-          state(solid ? SOLID : GROWING)
-        {}
-
-    private:
-        enum State { SOLID, SHRINKING, GROWING } state;
-
-        void init_model() {
-            switch (state) {
-            case SOLID:
-                set_model("st-blocker");
-                break;
-
-            case SHRINKING:
-                set_anim("st-blocker-shrinking");
-                break;
-
-            case GROWING:
-                set_anim("st-blocker-growing");
-                break;
-            }
-        }
-
-        void change_state(State newState) {
-            if (state != newState) {
-                if (state == GROWING && newState == SHRINKING) {
-                    state = SHRINKING;
-                    get_model()->reverse();
-                }
-                else if (state == SHRINKING && newState == GROWING) {
-                    state = GROWING;
-                    get_model()->reverse();
-                }
-                else {
-                    state = newState;
-                    init_model();
-                    if (newState == SOLID) {
-                        set_attrib("kind", "st-blocker");
-                    }
-                }
-            }
-        }
-
-        void animcb() {
-            switch (state) {
-            case SHRINKING: {
-                Item *it = MakeItem("it-blocker-new");
-                SetItem(get_pos(), it);
-                TransferObjectName(this, it);
-                KillStone(get_pos());
-                break;
-            }
-            case GROWING:
-                change_state(SOLID);
-                break;
-            default :
-                ASSERT(0, XLevelRuntime,
-                    "BlockerStone: animcb called with inconsistent state");
-                break;
-            }
-        }
-
-        virtual Value message(const Message &m) {
-            if (m.message == "_trigger" || m.message == "toggle" || m.message == "openclose") {
-                if (state == SHRINKING) {
-                    change_state(GROWING);
-                }
-                else {
-                    change_state(SHRINKING);
-                }
-                return Value();
-            }
-            else if (m.message == "signal") {
-                int value = m.value;
-//                 warning("received signal (value=%i)", value);
-                if (value) {    // value == 1 -> shrink
-                    if (state != SHRINKING)
-                        change_state(SHRINKING);
-                }
-                else {          // value == 0 -> grow
-                    if (state == SHRINKING)
-                        change_state(GROWING);
-                }
-                return Value();
-            }
-            else if (m.message == "open") { // aka "shrink"
-                if (state != SHRINKING)
-                    change_state(SHRINKING);
-                return Value();
-            }
-            else if (m.message == "close") { // aka "grow"
-                if (state == SHRINKING)
-                    change_state(GROWING);
-                return Value();
-            }
-            return Stone::message(m);
-        }
-
-        void actor_contact(Actor *a) {
-            if (state == GROWING) {
-                SendMessage(a, "shatter");
-            }
-        }
-        void actor_inside(Actor *a) {
-            if (state == GROWING) {
-                SendMessage(a, "shatter");
-            }
-        }
-    };
-    DEF_TRAITSM(BlockerStone, "INVALID", st_INVALID, MOVABLE_BREAKABLE);
-}
-
-
 /* -------------------- Volcano -------------------- */
 namespace
 {
@@ -1802,7 +1674,8 @@
                 change_state(PULSING);
                 return Value();
             }
-            else if (m.message == "signal" && to_double(m.value) != 0) {
+            else if (m.message == "signal" && (to_double(m.value) != 0 || 
+                    (server::EnigmaCompatibility < 1.10 && m.value.getType() == Value::NIL))) { // hack for old trigger without value
                 incoming = NODIR;
                 change_state (PULSING);
                 return Value();
@@ -3066,10 +2939,6 @@
 
 void Init_complex()
 {
-
-    Register(new BlockerStone(true));
-    Register(new BlockerStone(false));
-
     Register(new Door);
     Register("st-door-h", new Door("h"));
     Register("st-door-v", new Door("v"));

Modified: trunk/src/video.cc
===================================================================
--- trunk/src/video.cc	2008-01-10 11:51:52 UTC (rev 979)
+++ trunk/src/video.cc	2008-01-10 23:51:58 UTC (rev 980)
@@ -515,7 +515,7 @@
             Rect (76, 216, 245, 26),         // inventory area
             Rect (75, 217, 237, 17),         // text area
             true, true,                      // available window, fullscreen
-            "-10-0-","-0-"                   // fallback modes window, fullscreen
+            "-10-0-","-10-0-"                // fallback modes window, fullscreen
         }
     };
 

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-01-10 11:51:52 UTC (rev 979)
+++ trunk/src/world.cc	2008-01-10 23:51:58 UTC (rev 980)
@@ -1823,7 +1823,7 @@
     
     Value dstValue(dst);
     
-    if (dst->is_kind("st-blocker") || dst->is_kind("st-blocker-growing") ||
+    if (dst->is_kind("st_blocker") || dst->is_kind("st_blocker_new") ||
             dst->is_kind("it-blocker")) {
         if (!dst->getAttr("name"))
             NameObject(dst, ecl::strf("$!oxyd!blocker%d", dst->getId()));



From ral at mail.berlios.de  Sun Jan 13 14:19:31 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 13 Jan 2008 14:19:31 +0100
Subject: [Enigma-game-svn] r981 - in trunk: data src src/stones
Message-ID: <200801131319.m0DDJVQZ030646@sheep.berlios.de>

Author: ral
Date: 2008-01-13 14:19:30 +0100 (Sun, 13 Jan 2008)
New Revision: 981

Modified:
   trunk/data/init.lua
   trunk/src/Object.cc
   trunk/src/Object.hh
   trunk/src/items.cc
   trunk/src/stones/BlockerStone.cc
   trunk/src/stones/BlockerStone.hh
   trunk/src/stones/BoulderStone.hh
   trunk/src/stones/Switch.hh
   trunk/src/stones_simple.cc
   trunk/src/world.cc
   trunk/src/world.hh
Log:
Trunk 1.1: Reengineering Blocker
- renaming it-blocker to it_blocker, it-blocker-new to it_blocker_new
- blocker as StateObject: make use of state default support
- add Object method "transferIdentity(Object *target)" that transfers name,
    targets, actions and all user attributes set to this object
- blocker identity transfer between stone and item


Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-10 23:51:58 UTC (rev 980)
+++ trunk/data/init.lua	2008-01-13 13:19:30 UTC (rev 981)
@@ -44,6 +44,8 @@
 }
 
 RenamingObjectsNew2Old = {
+    it_blocker = "it-blocker",
+    it_blocker_new = "it-blocker-new",
     st_blocker = "st-blocker",
     st_blocker_new = "st-blocker-growing",
     st_boulder = "st-bolder",
@@ -150,7 +152,8 @@
 end
 
 MessageRenaming = {
-    ["it-blocker__trigger"] = "toggle",
+    it_blocker__trigger = "toggle",
+    it_blocker__openclose = "toggle",
     ["it-burnable__trigger"] = "ignite",
     ["it-burnable_ignited__trigger"] = "ignite",
     ["it-burnable_burning__trigger"] = "ignite",

Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2008-01-10 23:51:58 UTC (rev 980)
+++ trunk/src/Object.cc	2008-01-13 13:19:30 UTC (rev 981)
@@ -174,6 +174,34 @@
         return Value(Value::DEFAULT);
     }
     
+    void Object::transferName(Object *target) {
+        if (target == NULL)
+            return;
+        if (Value v = getAttr("name")) {
+            std::string name(v);
+            UnnameObject(this);
+            if (Value v = target->getAttr("name")) {
+                target->warning("name '%s' overwritten by '%s'",
+                                v.to_string().c_str(), name.c_str());
+                UnnameObject(target);
+            }
+            NameObject(target, name);
+        }
+    }
+    
+    void Object::transferIdentity(Object *target) {
+        if (target == NULL)
+            return;
+        transferName(target);
+        for (AttribMap::iterator it = attribs.begin(); it != attribs.end(); ++it) {
+            // copy user attributes starting with "_" and
+            // target and actions including their stated versions
+            if ( it->first.find("_") == 0 || it->first.find("target") == 0
+                    || it->first.find("action") == 0)
+                target->set_attrib(it->first, it->second);
+        }
+    }
+    
     void Object::performAction(const Value& val) {
         Value messageValue = val;
         if (getDefaultedAttr("inverse", false).to_bool())

Modified: trunk/src/Object.hh
===================================================================
--- trunk/src/Object.hh	2008-01-10 23:51:58 UTC (rev 980)
+++ trunk/src/Object.hh	2008-01-13 13:19:30 UTC (rev 981)
@@ -148,6 +148,8 @@
 
         virtual void warning(const char *format, ...) const;
         virtual ObjectType getObjectType() const;
+        void transferName(Object *target);
+        virtual void transferIdentity(Object *target);
 
     protected:
         virtual Value getDefaultValue(const string &key) const;

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-01-10 23:51:58 UTC (rev 980)
+++ trunk/src/items.cc	2008-01-13 13:19:30 UTC (rev 981)
@@ -97,7 +97,7 @@
 void Item::replace(ItemID id)
 {
     Item *newitem = MakeItem (id);
-    TransferObjectName (this, newitem);
+    transferName(newitem);          // TODO check where transfer of identity is better
     setup_successor(newitem);           // hook for subclasses
     SetItem (get_pos(), newitem);
 }
@@ -946,6 +946,8 @@
 /* -------------------- Brake -------------------- */
 
 // Brake is only used to hold st-brake while it is in an inventory
+
+// TODO transfer identity !!
 namespace
 {
     class Brake : public Item {
@@ -1433,7 +1435,7 @@
                }
            }
            Stone *st = MakeStone (get_stone_name());
-           TransferObjectName (this, st);
+           transferName(st);
            SetStone (p, st);
            kill();
         }
@@ -2653,196 +2655,204 @@
 
 /* -------------------- Blocker item -------------------- */
 
-namespace
-{
-    /*! If a 'BoulderStone' moves over a 'Blocker' the 'Blocker' starts
-      growing and replaces itself by a BlockerStone. */
-    class Blocker : public Item, public TimeHandler {
-        CLONEOBJ(Blocker);
+
+    /**
+     * A door like object that can be opened and closed by a BoulderStone. This item
+     * represents the open state of the door. The closed state is represented by a
+     * BlockerStone.<p>
+     * If a BoulderStone moves over a BlockerItem the BlockerItem starts growing and
+     * replaces itself by a BlockerStone. But other Stones can be pushed over a
+     * BlockerItem without causing its transformation. <p>
+     * It fully supports the door messages "open", "close", "toggle", "signal" and
+     * attribute "state". If the item is blocked by a stone the messages will not
+     * cause an instant growing. But the message will be remembered in the internal
+     * state and the item acts as soon as the stone moves away.<p>
+     * An initial BlockerItem with a BoulderStone on top will grow as soon as it moves
+     * away. An initial it_blocker_new with a BloulderStone on top will not grow when
+     * the stone moves away.<p>
+     * Note that this is the only door object that allows a stone to be pushed through.
+     * A BlockerItem can be killed by a BrakeItem being dropped.
+     */
+    class BlockerItem : public Item, public TimeHandler {
+        CLONEOBJ(BlockerItem);
         DECL_TRAITS;
+    private:
+        enum iState {
+            IDLE,       ///< neutral state
+            NEW,        ///< a new BlockerItem that replaced a recently shrinked BlockerStone -
+                        ///< a BoulderStone is awaited, but it has to arrive in time 
+            LOCKED,     ///< a stone covers the BlockerItem and locked it, so it will not grow
+                        ///< when the stone moves away. This is the state that a BoulderStone causes
+                        ///< on its first visit immediatly after shrinking the BlockerStone
+            UNLOCKED    ///< a stone covers the BlockerItem and unlocked it, so it will grow
+                        ///< when the stone moves away. This is the state that a BoulderStone causes
+                        ///< on its second visit when moving onto an idle BlockerItem. The blocker
+                        ///< will grow when the stones moves away
+        };
 
-        enum State {
-            IDLE,               // nothing special
-            SHRINKED,           // recently shrinked by a BolderStone (which has not arrived yet)
-            BOLDERED,           // BolderStone has arrived (the one that made me shrink)
-            COVERED             // BolderStone will make me grow (but is on top of me)
-            // Note: BOLDERED and COVERED are used for all kinds of stones
-            // (e.g. when a stone is on top and the Blocker receives a "close" message)
-        } state;
+    public:
+        BlockerItem(bool shrinked_recently);
+        ~BlockerItem();
 
-        static const char * const stateName[];
-
-        void change_state(State new_state);
-        void on_creation (GridPos p);
-        void on_removal (GridPos p);
+        // Object interface
         virtual Value message(const Message &m);
-        void stone_change(Stone *st);
-        void grow();
-        void alarm();
-    public:
-        Blocker(bool shrinked_recently);
-        ~Blocker();
-    };
-    DEF_TRAITSF(Blocker, "it-blocker", it_blocker, itf_static);
-};
 
-const char * const Blocker::stateName[] = { "IDLE", "SHRINKED", "BOLDERED", "COVERED" };
+        // StateObject interface
+        virtual void toggleState();
+        virtual int externalState() const;
+        virtual void setState(int extState);
 
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+        virtual void on_removal(GridPos p);
+        virtual void init_model();
 
-Blocker::Blocker(bool shrinked_recently)
-: state(shrinked_recently ? SHRINKED : IDLE)
-{}
+        // Item interface
+        virtual void stone_change(Stone *st);
 
-Blocker::~Blocker() {
-    GameTimer.remove_alarm (this);
-}
+        // TimeHandler interface
+        virtual void alarm();
+    
+    private:
+        void setIState(iState newState);
+        void grow();
+    };
+    
+    DEF_TRAITSF(BlockerItem, "it_blocker", it_blocker, itf_static);
 
-void Blocker::on_creation (GridPos p)
-{
-    if (state == SHRINKED) {
-        GameTimer.set_alarm(this, 0.5, false);
-    }
-    Item::on_creation(p);
-}
 
-void Blocker::on_removal(GridPos p)
-{
-    change_state(IDLE);
-    Item::on_removal(p);
-}
-
-void Blocker::change_state(State new_state)
-{
-    if (state != new_state) {
-        if (state == SHRINKED)
-            GameTimer.remove_alarm(this);
-        else if (new_state == SHRINKED)
-            GameTimer.set_alarm(this, 0.5, false);
-        state = new_state;
+    BlockerItem::BlockerItem(bool shrinked_recently) {
+        state = shrinked_recently ? NEW : IDLE;
     }
-}
 
-
-void Blocker::grow()
-{
-    Stone *st = MakeStone("st_blocker_new");
-    SetStone(get_pos(), st);
-    TransferObjectName(this, st);
-    kill();
-}
-
-void Blocker::alarm()
-{
-    if (state == SHRINKED) { // BolderStone did not arrive in time
-        change_state(IDLE);
+    BlockerItem::~BlockerItem() {
+        GameTimer.remove_alarm (this);
     }
-}
 
-
-Value Blocker::message(const Message &m)
-{
-    if (m.message == "init") { 
-        if (Stone *st = GetStone(get_pos())) {
-            if (st->is_kind("st_boulder"))
-                if (state == IDLE)
-                    change_state(COVERED);
-                else if (state == SHRINKED)
-                    change_state(BOLDERED);
+    Value BlockerItem::message(const Message &m) {
+        if (m.message == "init") { 
+            if (Stone *st = GetStone(get_pos())) {
+                if (st->is_kind("st_boulder"))
+                    if (state == IDLE && server::GameCompatibility != GAMET_PEROXYD)
+                        setIState(UNLOCKED);
+                    else if (state == NEW || server::GameCompatibility != GAMET_PEROXYD)
+                        setIState(LOCKED);
+            }
+            return Item::message(m);    // pass on init message
         }
         return Item::message(m);
-    } else if (m.message == "toggle" || m.message == "openclose") {
-        switch (state) {
-            case IDLE:
-            case SHRINKED:
-                grow(); // if no stone on top -> grow
-                break;
+    }
     
-                // if stone on top -> toggle state (has no effect until stone leaves)
-            case BOLDERED:
-                change_state(COVERED);
-                break;
-            case COVERED:
-                change_state(BOLDERED);
-                break;
+    void BlockerItem::toggleState() {
+        if (state == UNLOCKED) {  // revoke pending grow/close
+            setIState(LOCKED);
         }
-        return Value();
-    } else {
-        int open = -1;
-
-        if (m.message == "signal") {
-            open = m.value;
+        else {
+            setState(0);  // close
         }
-        else if (m.message == "open")
-            open = 1;
-        else if (m.message == "close")
-            open = 0;
-        else
-            return Item::message(m);
-
-        if (open == 1)  { // shrink
-            if (state == COVERED)
-                change_state(BOLDERED);
+    }
+    
+    int BlockerItem::externalState() const {
+        return 1;   // always open -- st_blocker is closed
+    }
+    
+    void BlockerItem::setState(int extState) {
+        if (extState == 1) {         // open (shrink)
+            if (state == UNLOCKED)   //   revoke pending grow/close
+                setIState(LOCKED);
         }
-        else if (open != -1) { // grow
-            if (state == BOLDERED)
-                change_state(COVERED);
-            else if (state == SHRINKED)
-                change_state(IDLE); // remove alarm
+        else {                       // close (grow)
+            switch (state) {
+                case LOCKED:
+                    setIState(UNLOCKED);  // close when stone is removed
+                    break;
+                case UNLOCKED:
+                    break;                // will close anyway when stone is removed
+                case IDLE:
+                case NEW:
+                    grow();                    
+                    break;
+            }
+        }
+    }
+    
+    void BlockerItem::on_creation(GridPos p) {
+        if (state == NEW) {
+            GameTimer.set_alarm(this, 0.5, false);
+        }
+        Item::on_creation(p);
+    }
 
-            if (state == IDLE) {
-                if (Stone *st = GetStone(get_pos())) {
-                    if (st->is_kind("st_boulder"))
-                        change_state(BOLDERED); // occurs in Per.Oxyd #84
-                    else
-                        change_state(COVERED);
+    void BlockerItem::on_removal(GridPos p) {
+        setIState(IDLE);
+        Item::on_removal(p);
+    }
+
+    void BlockerItem::init_model() {
+        set_model("it-blocker");
+    }
+    
+    void BlockerItem::stone_change(Stone *st) {
+        if (st != NULL) {
+            if (st->is_kind("st_boulder")) { // boulder arrived
+                switch (state) {
+                    case IDLE:
+                        setIState(UNLOCKED);  // will grow when boulder moves away
+                        break;
+                    case NEW:
+                        setIState(LOCKED);    // will not grow when boulder moves away
+                        break;
+                    case UNLOCKED:
+                    case LOCKED:
+                        // two BoulderStones running directly next to each other
+                        // let second pass as well (correct? siegfried says yes)
+                        // note: all stone moves are handled in a timestep before
+                        //   the world informs the items about stone changes
+                        break;
                 }
-                else {
+            }
+            else { // any other stone
+                setIState(LOCKED);
+            }
+        }
+        else {              // stone disappeared
+            switch (state) {
+                case LOCKED:
+                    setIState(IDLE);
+                    break;
+                case UNLOCKED:
                     grow();
-                }
+                    break;
+                case IDLE:
+                case NEW:
+                    // no action
+                    break;
             }
         }
-        return Value();
     }
-    return Item::message(m);
-}
 
-void Blocker::stone_change(Stone *st)
-{
-    if (st) {
-        if (st->is_kind("st_boulder")) { // bolder arrived
-            switch (state) {
-            case IDLE:
-                change_state(COVERED);
-                break;
-            case SHRINKED:
-                change_state(BOLDERED);
-                break;
-            case COVERED:
-            case BOLDERED:
-                // two BolderStones running directly next to each other
-                // let second pass as well (correct? siegfried says yes)
-                break;
-            }
+    void BlockerItem::alarm() {
+        if (state == NEW) { // BoulderStone did not arrive in time
+            setIState(IDLE);
         }
-        else { // any other stone
-            change_state(BOLDERED);
-        }
     }
-    else {              // stone disappeared
-        switch (state) {
-        case BOLDERED:
-            change_state(IDLE);
-            break;
-        case COVERED:
-            grow();
-            break;
-        case IDLE:
-        case SHRINKED:
-            // no action
-            break;
+
+    void BlockerItem::setIState(iState newState) {
+        if (state != newState) {
+            if (state == NEW)
+                GameTimer.remove_alarm(this);
+            else if (newState == NEW)
+                GameTimer.set_alarm(this, 0.5, false);
+            state = newState;
         }
     }
-}
+    
+    void BlockerItem::grow() {
+        Stone *st = MakeStone("st_blocker_new");
+        SetStone(get_pos(), st);
+        transferIdentity(st);
+        kill();
+    }
 
 
 /* -------------------- Ring -------------------- */
@@ -3677,8 +3687,8 @@
     RegisterItem (new Banana);
     RegisterItem (new BlackBomb);
     RegisterItem (new BlackBombBurning);
-    Register ("it-blocker-new", new Blocker(true));
-    RegisterItem (new Blocker(false));
+    Register ("it_blocker_new", new BlockerItem(true));
+    RegisterItem (new BlockerItem(false));
     RegisterItem (new Booze);
     RegisterItem (new Brake);
     RegisterItem (new BrokenBooze);

Modified: trunk/src/stones/BlockerStone.cc
===================================================================
--- trunk/src/stones/BlockerStone.cc	2008-01-10 23:51:58 UTC (rev 980)
+++ trunk/src/stones/BlockerStone.cc	2008-01-13 13:19:30 UTC (rev 981)
@@ -77,9 +77,9 @@
     void BlockerStone::animcb() {
         switch (state) {
             case SHRINKING: {
-                Item *it = MakeItem("it-blocker-new");
+                Item *it = MakeItem("it_blocker_new");
                 SetItem(get_pos(), it);
-                TransferObjectName(this, it);   // TODO transfer user attr., target, action
+                transferIdentity(it);
                 KillStone(get_pos());
                 break;
             }

Modified: trunk/src/stones/BlockerStone.hh
===================================================================
--- trunk/src/stones/BlockerStone.hh	2008-01-10 23:51:58 UTC (rev 980)
+++ trunk/src/stones/BlockerStone.hh	2008-01-13 13:19:30 UTC (rev 981)
@@ -28,7 +28,13 @@
 namespace enigma {
 
     /** 
+     * A door like object that can be opened and closed by a BoulderStone. This
+     * stone represents the closed state of the door. The open state is represented
+     * by a BlockerItem.
      * 
+     * TODO autonaming for keeping identity in groups
+     * TODO performAction on opening (as notification of boulder triggering)
+     * TODO animation slowed down by a major factor for PerOxyd compatibility
      */
     class BlockerStone : public Stone {
         CLONEOBJ(BlockerStone);

Modified: trunk/src/stones/BoulderStone.hh
===================================================================
--- trunk/src/stones/BoulderStone.hh	2008-01-10 23:51:58 UTC (rev 980)
+++ trunk/src/stones/BoulderStone.hh	2008-01-13 13:19:30 UTC (rev 981)
@@ -52,7 +52,7 @@
         virtual void setState(int extState);
 
         // GridObject interface
-        virtual void on_creation(GridPos);
+        virtual void on_creation(GridPos p);
         virtual void on_removal(GridPos p);
         virtual void init_model();
         

Modified: trunk/src/stones/Switch.hh
===================================================================
--- trunk/src/stones/Switch.hh	2008-01-10 23:51:58 UTC (rev 980)
+++ trunk/src/stones/Switch.hh	2008-01-13 13:19:30 UTC (rev 981)
@@ -26,7 +26,7 @@
 namespace enigma {
 
     /** 
-     * A standard colored 2 state on/off switch that can be toggled only actors
+     * A standard colored 2 state on/off switch that can be toggled only by actors
      * of a compatible color. It is a StateObject with 4 internal states as the
      * state changes are animated. The external states are mapped. The messages
      * "toggle", "signal", "on", "off" and get/set of the state are fully supported.

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-01-10 23:51:58 UTC (rev 980)
+++ trunk/src/stones_simple.cc	2008-01-13 13:19:30 UTC (rev 981)
@@ -1994,7 +1994,7 @@
             Stone::on_creation(p);
 
             Item    *it = GetItem(p);
-            if (it && it->is_kind("it-blocker")) {
+            if (it && it->is_kind("it_blocker")) {
                 KillItem(p);
 //                sound_event ("explosion1");
             }

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-01-10 23:51:58 UTC (rev 980)
+++ trunk/src/world.cc	2008-01-13 13:19:30 UTC (rev 981)
@@ -1627,20 +1627,6 @@
     level->unname(obj);
 }
 
-void TransferObjectName (Object *source, Object *target)
-{
-    if (Value v = source->getAttr("name")) {
-        string name(v);
-        UnnameObject(source);
-        if (Value v = target->getAttr("name")) {
-            target->warning("name '%s' overwritten by '%s'",
-                            v.to_string().c_str(), name.c_str());
-            UnnameObject(target);
-        }
-        NameObject(target, name);
-    }
-}
-
 Object * GetNamedObject (const std::string &name)
 {
     return level->get_named (name);
@@ -2059,7 +2045,7 @@
 void ReplaceStone (GridPos p, Stone* st) {
     Stone *old = level->st_layer.get(p);
     if (old) {
-        TransferObjectName(old, st);
+        old->transferName(st);
         level->st_layer.kill(p);
     }
     SetStone(p, st);

Modified: trunk/src/world.hh
===================================================================
--- trunk/src/world.hh	2008-01-10 23:51:58 UTC (rev 980)
+++ trunk/src/world.hh	2008-01-13 13:19:30 UTC (rev 981)
@@ -174,7 +174,6 @@
 
     void    NameObject (Object *obj, const string &name);
     void    UnnameObject (Object *obj);
-    void    TransferObjectName(Object *source, Object *target);
     Object *GetNamedObject (const string &name);
     std::list<Object *> GetNamedGroup(const std::string &templ);
 



From ral at mail.berlios.de  Sun Jan 13 21:42:44 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 13 Jan 2008 21:42:44 +0100
Subject: [Enigma-game-svn] r982 - trunk/doc/reference
Message-ID: <200801132042.m0DKgiXv015279@sheep.berlios.de>

Author: ral
Date: 2008-01-13 21:42:43 +0100 (Sun, 13 Jan 2008)
New Revision: 982

Modified:
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk: Refernce Manual
- adding chapters for new API


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-01-13 13:19:30 UTC (rev 981)
+++ trunk/doc/reference/enigma-ref.texi	2008-01-13 20:42:43 UTC (rev 982)
@@ -3,7 +3,7 @@
 @settitle Enigma Reference Manual
 @titlepage
 @title Enigma Reference Manual
- at subtitle for version 1.00
+ at subtitle for version 1.10
 @author Daniel Heck
 @author Petr Machata
 @author Ralf Westram
@@ -18,7 +18,7 @@
 @top
 
 This manual describes the internals of
- at uref{http://www.nongnu.org/enigma/,Enigma} version 1.00, in particular how to
+ at uref{http://www.nongnu.org/enigma/,Enigma} version 1.10, in particular how to
 build new levels using Lua and how to interact with the game engine.
 @end ifnottex
 
@@ -26,9 +26,18 @@
 * Running Enigma::              Running Enigma
 * Levelpack Basics::            Addition and managing of levels in packs 
 * Level Basics::                Introduction to level description
-* Objects::                     Description of all objects in Enigma
-* Variables::                   Lua variables that influence the game
-* Functions::                   Predefined functions
+* Enigma Paradigm::             Principles of world, objects and messages
+* Lua API::                     Describing a level with all its objects and interactions
+* Common Attributes and Messages::  What all objects support
+* Floor Objects::               
+* Item Objects::
+* Stone Objects::
+* Actor Objects::
+* Other Objects::               Rubberbands, etc.
+* Advanced Features::           Fire, ...
+* Old API - Objects::           Description of all objects in Enigma
+* Old API - Variables::         Lua variables that influence the game
+* Old API - Functions::               Predefined functions
 * Function Index::
 * Concept Index::
 @end menu
@@ -1194,7 +1203,7 @@
 unused level file copies from the @samp{auto} folder.
 
 
- at node  Level Basics, Objects, Levelpack Basics, Top
+ at node  Level Basics, Enigma Paradigm, Levelpack Basics, Top
 @chapter Level Basics
 
 Now that you have played some levels of Enigma, you may have noticed that Enigma is quite a
@@ -2625,9 +2634,36 @@
 naming scheme, and every new library should follow it from the beginning.
 
 
- at node Objects, Variables, Level Basics, Top
- at chapter Objects
+ at node Enigma Paradigm, Lua API, Level Basics, Top
+ at chapter Enigma Paradigm
 
+ at node Lua API, Common Attributes and Messages, Enigma Paradigm, Top
+ at chapter Lua API
+
+ at node Common Attributes and Messages, Floor Objects, Lua API, Top
+ at chapter Common Attributes and Messages
+
+ at node Floor Objects, Item Objects, Common Attributes and Messages, Top
+ at chapter Floor Objects
+
+ at node Item Objects, Stone Objects, Floor Objects, Top
+ at chapter Item Objects
+
+ at node Stone Objects, Actor Objects, Item Objects, Top
+ at chapter Stone Objects
+
+ at node Actor Objects, Other Objects, Stone Objects, Top
+ at chapter Actor Objects
+
+ at node Other Objects, Advanced Features, Actor Objects, Top
+ at chapter Other Objects
+
+ at node Advanced Features, Old API - Objects, Other Objects, Top
+ at chapter Advanced Features
+
+ at node Old API - Objects, Old API - Variables, Advanced Features, Top
+ at chapter Old API - Objects
+
 @menu
 * Floors::                      
 * Items::                       
@@ -2639,7 +2675,7 @@
 * Differences between Compatibility Modes::
 @end menu
 
- at node Floors, Items, Objects, Objects
+ at node Floors, Items, Old API - Objects, Old API - Objects
 @section Floors
 
 @menu
@@ -2850,7 +2886,7 @@
 
 Adds a horizontal, vertical or diagonal force to actors on it.  The
 strength of the force is determined by @code{enigma.SlopeForce} (see
- at ref{Variables}) or the attribute @code{force}.  It is additive to the
+ at ref{Old API - Variables}) or the attribute @code{force}.  It is additive to the
 force determined by the @code{force_[x/y]}-attributes (see @ref{Common
 Floor Attributes}).
 
@@ -2889,7 +2925,7 @@
 
 Ice has very low friction and mousefactor, such that it's difficult to
 move on it.  You can use @ref{it-pin} and @code{enigma.IceFriction}
-(see @ref{Variables}) to ease the friction.
+(see @ref{Old API - Variables}) to ease the friction.
 
 @strong{Variants}
 
@@ -2944,7 +2980,7 @@
 @code{fl-stwood}.
 
 Once in the swamp, marbles constantly sink with the speed
-given by @code{enigma.SwampSinkSpeed} (see @ref{Variables}),
+given by @code{enigma.SwampSinkSpeed} (see @ref{Old API - Variables}),
 and may rise again when moving fast enough (compare with
 @ref{fl-water} and @ref{fl-abyss}).
 
@@ -2974,7 +3010,7 @@
 @code{fl-stwood}. 
 
 Once in the water, marbles constantly sink with the speed
-given by @code{enigma.WaterSinkSpeed} (see @ref{Variables}).
+given by @code{enigma.WaterSinkSpeed} (see @ref{Old API - Variables}).
 In contrast to @ref{fl-swamp}, they can't rise again, as
 long as they're in the water.
 
@@ -2984,7 +3020,7 @@
 
 @c ================== Items ====================
 
- at node Items, Stones, Floors, Objects
+ at node Items, Stones, Floors, Old API - Objects
 @section Items
 
 @menu
@@ -3220,7 +3256,7 @@
 @code{it-hill} and @code{it-hollow} create small hills and hollows in
 the floor, @code{it-tinyhill} and @code{it-tinyhollow} are smaller
 versions.  The strength of the slope is given by
- at code{enigma.HoleForce} (see @ref{Variables}).
+ at code{enigma.HoleForce} (see @ref{Old API - Variables}).
 
 When a stone is pushed over them or an @ref{it-spade} is used on them,
 they decrease their size: @code{it-hill} and @code{it-hollow} become
@@ -3546,7 +3582,7 @@
 crack grows when an actor enters. When the crack grows, it spreads to
 neighboring unoccupied tiles.  If you want to suppress this, set
 @code{enigma.Brittleness} to 0.0 and the @code{brittleness}-attribute
-of the cracks to 0.5 (or whatever you like, also see @ref{Variables}).
+of the cracks to 0.5 (or whatever you like, also see @ref{Old API - Variables}).
 
 @strong{Attributes}
 
@@ -4368,7 +4404,7 @@
 
 @c ===================  Stones  =======================
 
- at node Stones, Actors, Items, Objects
+ at node Stones, Actors, Items, Old API - Objects
 @section Stones
 
 @menu
@@ -4773,7 +4809,7 @@
 
 These stones apply an impulse to actors that touch them.  The amount
 of force applied can be controlled by setting
- at code{enigma.BumperForce} (see @ref{Variables}) accordingly (the
+ at code{enigma.BumperForce} (see @ref{Old API - Variables}) accordingly (the
 default is 200). Alternatively, the @code{force} attribute can be used
 to set this factor for @emph{individual} bumper stones.
 
@@ -5012,7 +5048,7 @@
 is confined to be between -1.0 and +1.0.  Actors with charges are
 drawn together or pushed apart respectively, by a force given by
 multiplication of their charges and the factor
- at code{enigma.ElectricForce} (see @ref{Variables}) and divided by their
+ at code{enigma.ElectricForce} (see @ref{Old API - Variables}) and divided by their
 relative distance.
 
 @strong{Attributes}
@@ -6384,7 +6420,7 @@
 
 
 @c ----------------------------------------------------------------------
- at node Actors, General object attributes, Stones, Objects
+ at node Actors, General object attributes, Stones, Old API - Objects
 @section Actors
 
 @menu
@@ -6441,7 +6477,7 @@
 actors of its kind controlled by the player need to be larger than the number
 of actors with value 1. For example, marking 3 out of 5 small whiteballs with 1 means
 that the player is dead if 3 small whiteballs are no longer alive. See 
- at ref{Variables} @samp{enigma.ConserveLevel} for more details about restart of levels.
+ at ref{Old API - Variables} @samp{enigma.ConserveLevel} for more details about restart of levels.
 
 @item @b{essential_id} values: string; default: model name of actor
 Since a player may control actors of different kinds at the same time, the 
@@ -6630,7 +6666,7 @@
 
 
 @c ----------------------------------------------------------------------
- at node General object attributes, The 1.0-Fire System, Actors, Objects
+ at node General object attributes, The 1.0-Fire System, Actors, Old API - Objects
 @section General object attributes
 
 @table @code
@@ -6640,7 +6676,7 @@
 @end table
 
 @c ----------------------------------------------------------------------
- at node The 1.0-Fire System, Freeze Checking, General object attributes, Objects
+ at node The 1.0-Fire System, Freeze Checking, General object attributes, Old API - Objects
 @section The 1.0-Fire System
 
 The 1.0-version of Enigma introduces a new fire system, making use of
@@ -6829,7 +6865,7 @@
 
 
 @c ----------------------------------------------------------------------
- at node Freeze Checking, Differences between Compatibility Modes, The 1.0-Fire System, Objects
+ at node Freeze Checking, Differences between Compatibility Modes, The 1.0-Fire System, Old API - Objects
 @section Freeze Checking
 
 With Enigma 1.1 and above, you can use a special feature to support Sokoban
@@ -6913,7 +6949,7 @@
 
 
 @c ----------------------------------------------------------------------
- at node Differences between Compatibility Modes,  , Freeze Checking, Objects
+ at node Differences between Compatibility Modes,  , Freeze Checking, Old API - Objects
 @section Differences between Compatibility Modes
 
 Although Enigma was inspired by the original Oxyd-series, there are
@@ -6985,8 +7021,8 @@
 
 
 @c ======================================================================
- at node Variables, Functions, Objects, Top
- at chapter Variables
+ at node Old API - Variables, Old API - Functions, Old API - Objects, Top
+ at chapter Old API - Variables
 
 This chapter describes a few variables that you can change from
 level descriptions to alter the behavior of the game engine or set
@@ -7113,8 +7149,8 @@
 @end defvar
 
 
- at node Functions, Function Index, Variables, Top
- at chapter Functions
+ at node Old API - Functions, Function Index, Old API - Variables, Top
+ at chapter Old API - Functions
 
 @menu
 * AddRubberBand::               Creating rubber bands
@@ -7152,7 +7188,7 @@
 @end menu
 
 @c ......................................................................
- at node AddRubberBand, CreateWorld, Functions, Functions
+ at node AddRubberBand, CreateWorld, Old API - Functions, Old API - Functions
 @section AddRubberBand
 
 @defun AddRubberBand (actor, object, strength, length)
@@ -7180,7 +7216,7 @@
 @end example
 
 @c ......................................................................
- at node CreateWorld, display.SetFollowMode, AddRubberBand, Functions
+ at node CreateWorld, display.SetFollowMode, AddRubberBand, Old API - Functions
 @section CreateWorld
 
 @defun CreateWorld (width, heigth)
@@ -7201,7 +7237,7 @@
 @end defun
 
 @c ......................................................................
- at node display.SetFollowMode, draw_border, CreateWorld, Functions
+ at node display.SetFollowMode, draw_border, CreateWorld, Old API - Functions
 @section display.SetFollowMode
 
 @defun display.SetFollowMode (mode)
@@ -7226,7 +7262,7 @@
 @end defun
 
 @c ......................................................................
- at node  draw_border, draw_checkerboard_floor, display.SetFollowMode, Functions
+ at node  draw_border, draw_checkerboard_floor, display.SetFollowMode, Old API - Functions
 @section draw_border
 
 @defun draw_border (stonename, x,y, w,h)
@@ -7253,7 +7289,7 @@
 @end example
 
 @c ......................................................................
- at node  draw_checkerboard_floor, draw_floor, draw_border, Functions
+ at node  draw_checkerboard_floor, draw_floor, draw_border, Old API - Functions
 @section draw_checkerboard_floor
 
 @defun draw_checkerboard_floor (name1, name2, x, y, w, h, attribs)
@@ -7287,7 +7323,7 @@
 @end example
 
 @c ......................................................................
- at node  draw_floor, draw_items, draw_checkerboard_floor, Functions
+ at node  draw_floor, draw_items, draw_checkerboard_floor, Old API - Functions
 @section draw_floor
 
 @defun draw_floor (floorname, location, increment, count , attribs)
@@ -7330,7 +7366,7 @@
 
 
 @c ......................................................................
- at node  draw_items, draw_stones, draw_floor, Functions
+ at node  draw_items, draw_stones, draw_floor, Old API - Functions
 @section draw_items
 
 @defun draw_items (itemname, location, increment, count [, attribs])
@@ -7367,7 +7403,7 @@
 @end example
 
 @c ......................................................................
- at node  draw_stones, enigma.AddConstantForce, draw_items, Functions
+ at node  draw_stones, enigma.AddConstantForce, draw_items, Old API - Functions
 @section draw_stones
 
 @defun draw_stones (stonename, location, increment, count [, attribs])
@@ -7412,7 +7448,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.AddConstantForce, enigma.GetAttrib, draw_stones, Functions
+ at node enigma.AddConstantForce, enigma.GetAttrib, draw_stones, Old API - Functions
 @section enigma.AddConstantForce
 
 @defun enigma.AddConstantForce (gravity_x, gravity_y)
@@ -7429,7 +7465,7 @@
 @end defun
 
 @c ......................................................................
- at node enigma.GetAttrib, enigma.GetNamedObject, enigma.AddConstantForce, Functions
+ at node enigma.GetAttrib, enigma.GetNamedObject, enigma.AddConstantForce, Old API - Functions
 @section enigma.GetAttrib
 
 @defun GetAttrib (object, attribname)
@@ -7451,7 +7487,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.GetNamedObject, enigma.GetKind, enigma.GetAttrib, Functions
+ at node enigma.GetNamedObject, enigma.GetKind, enigma.GetAttrib, Old API - Functions
 @section enigma.GetNamedObject
 
 @defun enigma.GetNamedObject (objname)
@@ -7471,7 +7507,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.GetKind, enigma.KillFloor, enigma.GetNamedObject, Functions
+ at node enigma.GetKind, enigma.KillFloor, enigma.GetNamedObject, Old API - Functions
 @section enigma.GetKind
 
 @defun enigma.GetKind(object)
@@ -7491,7 +7527,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.KillFloor, enigma.KillItem, enigma.GetKind, Functions
+ at node enigma.KillFloor, enigma.KillItem, enigma.GetKind, Old API - Functions
 @section enigma.KillFloor
 
 @defun enigma.KillFloor (x, y)
@@ -7506,7 +7542,7 @@
 @end defun
 
 @c ......................................................................
- at node enigma.KillItem, enigma.KillStone, enigma.KillFloor, Functions
+ at node enigma.KillItem, enigma.KillStone, enigma.KillFloor, Old API - Functions
 @section enigma.KillItem
 
 @defun enigma.KillItem (x, y)
@@ -7521,7 +7557,7 @@
 @end defun
 
 @c ......................................................................
- at node enigma.KillStone, enigma.LoadLib, enigma.KillItem, Functions
+ at node enigma.KillStone, enigma.LoadLib, enigma.KillItem, Old API - Functions
 @section enigma.KillStone
 
 @defun enigma.KillStone (x, y)
@@ -7536,7 +7572,7 @@
 @end defun
 
 @c ......................................................................
- at node enigma.LoadLib, enigma.NameObject, enigma.KillStone, Functions
+ at node enigma.LoadLib, enigma.NameObject, enigma.KillStone, Old API - Functions
 @section enigma.LoadLib
 
 @defun enigma.LoadLib (libraryId)
@@ -7548,7 +7584,7 @@
 @end defun
 
 @c ......................................................................
- at node enigma.NameObject, enigma.SetAttrib, enigma.LoadLib, Functions
+ at node enigma.NameObject, enigma.SetAttrib, enigma.LoadLib, Old API - Functions
 @section enigma.NameObject
 
 @defun enigma.NameObject (object, value)
@@ -7561,7 +7597,7 @@
 @end defun
 
 @c ......................................................................
- at node enigma.SetAttrib, enigma.SetAttribs, enigma.NameObject, Functions
+ at node enigma.SetAttrib, enigma.SetAttribs, enigma.NameObject, Old API - Functions
 @section enigma.SetAttrib
 
 @defun enigma.SetAttrib (object, attribname, value)
@@ -7594,7 +7630,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.SetAttribs, enigma.SetDefaultAttribs, enigma.SetAttrib, Functions
+ at node enigma.SetAttribs, enigma.SetDefaultAttribs, enigma.SetAttrib, Old API - Functions
 @section enigma.SetAttribs
 
 @defun enigma.set_attribs (object, attribs)
@@ -7622,7 +7658,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.SetDefaultAttribs, enigma.SetCompatibility, enigma.SetAttribs, Functions
+ at node enigma.SetDefaultAttribs, enigma.SetCompatibility, enigma.SetAttribs, Old API - Functions
 @section enigma.SetDefaultAttribs
 
 @defun enigma.SetDefaultAttribs (objectname, attribs)
@@ -7659,7 +7695,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.SetCompatibility, fill_floor, enigma.SetDefaultAttribs, Functions
+ at node enigma.SetCompatibility, fill_floor, enigma.SetDefaultAttribs, Old API - Functions
 @section enigma.SetCompatibility
 
 @defun enigma.SetCompatibility (compatibility)
@@ -7689,7 +7725,7 @@
 @end defun
 
 @c ......................................................................
- at node fill_floor, fill_items, enigma.SetCompatibility, Functions
+ at node fill_floor, fill_items, enigma.SetCompatibility, Old API - Functions
 @section fill_floor
 
 @defun fill_floor (floorname)
@@ -7722,7 +7758,7 @@
 @end example
 
 @c ......................................................................
- at node fill_items, fill_stones, fill_floor, Functions
+ at node fill_items, fill_stones, fill_floor, Old API - Functions
 @section fill_items
 
 @defun fill_items (itemname, x, y, w, h)
@@ -7754,7 +7790,7 @@
 @end example
 
 @c ......................................................................
- at node fill_stones, MakeObject, fill_items, Functions
+ at node fill_stones, MakeObject, fill_items, Old API - Functions
 @section fill_stones
 
 @defun fill_stones (stonename, x, y, w, h)
@@ -7785,7 +7821,7 @@
 @end example
 
 @c ......................................................................
- at node  MakeObject, SendMessage, fill_stones, Functions
+ at node  MakeObject, SendMessage, fill_stones, Old API - Functions
 @section MakeObject
 
 @defun MakeObject (objname, attribs)
@@ -7816,7 +7852,7 @@
 @end example
 
 @c ......................................................................
- at node SendMessage, set_floor, MakeObject, Functions
+ at node SendMessage, set_floor, MakeObject, Old API - Functions
 @section SendMessage
 
 @defun SendMessage (object, message, data)
@@ -7829,7 +7865,7 @@
 reference as returned by @ref{enigma.GetNamedObject}.
 @item message
 The message itself (e.g. ``signal'') You can see which messages are
-understood in the documentation of the particular @ref{Objects}.
+understood in the documentation of the particular @ref{Old API - Objects}.
 @item data
 Some specific messages expect some additional data (e.g., message
 ``direction'' expects a direction like SOUTH or WEST).
@@ -7852,7 +7888,7 @@
 @end example
 
 @c ......................................................................
- at node set_floor, set_item, SendMessage, Functions
+ at node set_floor, set_item, SendMessage, Old API - Functions
 @section set_floor
 
 @defun set_floor (floorname, x, y, attribs)
@@ -7888,7 +7924,7 @@
 @end example
 
 @c ......................................................................
- at node set_item, set_stone, set_floor, Functions
+ at node set_item, set_stone, set_floor, Old API - Functions
 @section set_item
 
 @defun set_item (itemname, x, y, attribs)
@@ -7926,7 +7962,7 @@
 @end example
 
 @c ......................................................................
- at node set_stone, set_stones, set_item, Functions
+ at node set_stone, set_stones, set_item, Old API - Functions
 @section set_stone
 
 @defun set_stone (stonename, x, y, attribs)
@@ -7959,7 +7995,7 @@
 @end example
 
 @c ......................................................................
- at node set_stones, Function Index, set_stone, Functions
+ at node set_stones, Function Index, set_stone, Old API - Functions
 @section set_stones
 
 @defun set_stones (stonename, positions, attribs)
@@ -7997,7 +8033,7 @@
 
 @c ......................................................................
 
- at node Function Index, Concept Index, Functions, Top
+ at node Function Index, Concept Index, Old API - Functions, Top
 @unnumbered Function Index
 
 @syncodeindex vr tp



From raoul at mail.berlios.de  Mon Jan 14 00:09:03 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Mon, 14 Jan 2008 00:09:03 +0100
Subject: [Enigma-game-svn] r983 - in trunk: data src src/stones
Message-ID: <200801132309.m0DN93tG027056@sheep.berlios.de>

Author: raoul
Date: 2008-01-14 00:09:02 +0100 (Mon, 14 Jan 2008)
New Revision: 983

Added:
   trunk/src/stones/FloppySwitch.cc
   trunk/src/stones/FloppySwitch.hh
Modified:
   trunk/data/init.lua
   trunk/src/Makefile.am
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/st_switches.cc
   trunk/src/stones.hh
Log:
Trunk 1.1: Reengineering Floppyswitch
- renaming st-floppy to st_floppy



Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-13 20:42:43 UTC (rev 982)
+++ trunk/data/init.lua	2008-01-13 23:09:02 UTC (rev 983)
@@ -53,6 +53,7 @@
     st_boulder_e = "st-bolder-e",
     st_boulder_s = "st-bolder-s",
     st_boulder_w = "st-bolder-w",
+    st_floppy = "st-floppy",
     st_fourswitch = "st-fourswitch",
     st_switch_instant = "st-switch",
     st_switch_black_instant = "st-switch_black",
@@ -177,6 +178,7 @@
     st_boulder__direction = "orientate",
     ["st-fart__trigger"] = "toggle",
     st_fourswitch__trigger = "toggle",
+    st_floppy__onoff = "toggle",
     ["st-stoneimpulse__trigger"] = "signal",
     ["st-stoneimpulse-hollow__trigger"] = "signal",
     ["st-stoneimpulse_movable__trigger"] = "signal",

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-01-13 20:42:43 UTC (rev 982)
+++ trunk/src/Makefile.am	2008-01-13 23:09:02 UTC (rev 983)
@@ -194,6 +194,8 @@
 	stones/BoulderStone.hh	\
 	stones/ConnectiveStone.cc	\
 	stones/ConnectiveStone.hh	\
+	stones/FloppySwitch.hh   \
+	stones/FloppySwitch.cc   \
 	stones/FourSwitch.cc	\
 	stones/FourSwitch.hh	\
 	stones/OxydStone.cc	\

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-01-13 20:42:43 UTC (rev 982)
+++ trunk/src/ox_extra.cc	2008-01-13 23:09:02 UTC (rev 983)
@@ -167,7 +167,7 @@
     UNUSED,              // OxydExtra stone 0x2a
     UNUSED,              // OxydExtra stone 0x2b
     UNUSED,              // OxydExtra stone 0x2c
-    "st-floppy",         // OxydExtra stone 0x2d
+    "st_floppy",         // OxydExtra stone 0x2d
     UNUSED,              // OxydExtra stone 0x2e
     "st-death",          // OxydExtra stone 0x2f
     "st-death_invisible", // OxydExtra stone 0x30

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-01-13 20:42:43 UTC (rev 982)
+++ trunk/src/ox_magnum.cc	2008-01-13 23:09:02 UTC (rev 983)
@@ -167,7 +167,7 @@
     "st-plain_move",            // OxydMagnum stone 0x2a
     "st-wood",                  // OxydMagnum stone 0x2b
     "st_switch_instant",        // OxydMagnum stone 0x2c
-    "st-floppy",                // OxydMagnum stone 0x2d (in normal Oxyd Magnum Levels unused!)
+    "st_floppy",                // OxydMagnum stone 0x2d (in normal Oxyd Magnum Levels unused!)
     UNUSED,                     // OxydMagnum stone 0x2e
     "st_fourswitch",            // OxydMagnum stone 0x2f (Level 89 and 92)
     "st-key",                   // OxydMagnum stone 0x30

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-01-13 20:42:43 UTC (rev 982)
+++ trunk/src/ox_oxyd1.cc	2008-01-13 23:09:02 UTC (rev 983)
@@ -201,7 +201,7 @@
     "st_switch_white_instant",  // Oxyd1 stone 0x2e
     "st_fourswitch",            // Oxyd1 stone 0x2f
     "st-key",                   // Oxyd1 stone 0x30
-    "st-floppy",                // Oxyd1 stone 0x31
+    "st_floppy",                // Oxyd1 stone 0x31
     "st-knight",                // Oxyd1 stone 0x32
     0,                          // Oxyd1 stone 0x33 oscillator (properties set in oxyd.cc)
     "st-death",                 // Oxyd1 stone 0x34

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-01-13 20:42:43 UTC (rev 982)
+++ trunk/src/ox_peroxyd.cc	2008-01-13 23:09:02 UTC (rev 983)
@@ -239,7 +239,7 @@
     "st_switch_white_instant",  // PerOxyd stone 0x2a
     "st_fourswitch",            // PerOxyd stone 0x2b
     "st-key",                   // PerOxyd stone 0x2c
-    "st-floppy",                // PerOxyd stone 0x2d
+    "st_floppy",                // PerOxyd stone 0x2d
     "",                         // PerOxyd stone 0x2e (?)
     "st-death",                 // PerOxyd stone 0x2f
     "st-death_invisible",       // PerOxyd stone 0x30

Modified: trunk/src/st_switches.cc
===================================================================
--- trunk/src/st_switches.cc	2008-01-13 20:42:43 UTC (rev 982)
+++ trunk/src/st_switches.cc	2008-01-13 23:09:02 UTC (rev 983)
@@ -426,57 +426,13 @@
 void TimeSwitch::notify_laseroff() {}
 
 
-/* -------------------- Floppy switch -------------------- */
 
-// Attributes:
-//
-// :on              1 or 0
-// :target,action   as usual
-namespace
-{
-    class FloppyStone : public OnOffStone {
-        CLONEOBJ(FloppyStone);
-    public:
-        FloppyStone() : OnOffStone("st-floppy") {}
-    private:
-        // Stone interface
-        void init_model();
-        void actor_hit(const StoneContact &sc);
-        const char *collision_sound() { return "metal"; }
-    };
-}
 
-void FloppyStone::init_model() 
-{
-    set_model(is_on() ? "st-floppy1" : "st-floppy0");
-}
-
-void FloppyStone::actor_hit (const StoneContact &sc)
-{
-    if (enigma::Inventory *inv = player::GetInventory(sc.actor)) {
-        if (is_on()) {
-            if (!inv->is_full()) {
-                inv->add_item (MakeItem("it-floppy"));
-                set_on(false);
-                performAction(is_on());
-            }
-        }
-        else if (player::WieldedItemIs (sc.actor, "it-floppy")) {
-            DisposeObject (inv->yield_first());
-            set_on(true);
-            performAction(is_on());
-        }
-        player::RedrawInventory (inv);
-    }
-}
-
-
 /* -------------------- Functions -------------------- */
 
 void InitSwitches()
 {
     Register (new CoinSlot);
-    Register (new FloppyStone);
     Register (new KeyStone);
     Register (new KeyStone_a);
     Register (new KeyStone_b);

Added: trunk/src/stones/FloppySwitch.cc
===================================================================
--- trunk/src/stones/FloppySwitch.cc	2008-01-13 20:42:43 UTC (rev 982)
+++ trunk/src/stones/FloppySwitch.cc	2008-01-13 23:09:02 UTC (rev 983)
@@ -0,0 +1,72 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2007 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/FloppySwitch.hh"
+#include "server.hh"
+#include "Inventory.hh"
+#include "player.hh"
+
+namespace enigma {
+    FloppySwitch::FloppySwitch() : Stone () {
+    }
+
+    void FloppySwitch::setState(int extState) {
+        if (isDisplayable()) {
+            if (extState != state) {
+                sound_event ("switchon");
+                state = ON - state;
+                init_model();
+                performAction(state == ON);
+            }
+        } else
+            state = extState;
+    }
+
+    void FloppySwitch::init_model() {
+        set_model(ecl::strf("st-floppy%s", state == ON ? "1" : "0"));
+    }
+
+    void FloppySwitch::actor_hit(const StoneContact &sc) {
+        if (enigma::Inventory *inv = player::GetInventory(sc.actor)) {
+            if (state == ON) {
+                if (!inv->is_full()) {
+                    inv->add_item (MakeItem("it-floppy"));
+                    setState(OFF);
+                }
+            }
+            else if (player::WieldedItemIs (sc.actor, "it-floppy")) {
+                DisposeObject(inv->yield_first());
+                setState(ON);
+            }
+            player::RedrawInventory (inv);
+        }
+    }
+
+    const char *FloppySwitch::collision_sound() {
+         return "metal";
+    }
+
+    DEF_TRAITS(FloppySwitch, "st_floppy", st_floppy);
+
+    BOOT_REGISTER_START
+        BootRegister(new FloppySwitch(), "st_floppy");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/FloppySwitch.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/FloppySwitch.hh
===================================================================
--- trunk/src/stones/FloppySwitch.hh	2008-01-13 20:42:43 UTC (rev 982)
+++ trunk/src/stones/FloppySwitch.hh	2008-01-13 23:09:02 UTC (rev 983)
@@ -0,0 +1,57 @@
+/*
+ * Copyright (C) 2007 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef FLOPPYSWITCH_HH
+#define FLOPPYSWITCH_HH
+
+#include "stones.hh"
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * A simple 2 state on/off switch that can be toggled only by inserting
+     * a floppy disk. It is a StateObject with 2 internal states as the
+     * state changes are not (yet) animated. The messages
+     * "toggle", "signal", "on", "off" and get/set of the state are fully supported.
+     * The floppyswitch starts per default in state OFF.<p>
+     * Floppyswitches can send inverse action values by setting the "inverse"
+     * attribute.
+     */
+    class FloppySwitch : public Stone {
+        CLONEOBJ(FloppySwitch);
+        DECL_TRAITS;
+    private:
+        enum iState { OFF, ON };
+    public:
+        FloppySwitch();
+
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+        virtual const char *collision_sound();
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/FloppySwitch.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-01-13 20:42:43 UTC (rev 982)
+++ trunk/src/stones.hh	2008-01-13 23:09:02 UTC (rev 983)
@@ -57,6 +57,7 @@
         st_fart,
         st_firebreak,
         st_firebreak_move,
+        st_floppy,
         st_fourswitch,
         st_greenbrown_growing,
         st_knight,



From ral at mail.berlios.de  Mon Jan 14 23:28:55 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 14 Jan 2008 23:28:55 +0100
Subject: [Enigma-game-svn] r984 - in trunk: data src
Message-ID: <200801142228.m0EMStrm019499@sheep.berlios.de>

Author: ral
Date: 2008-01-14 23:28:54 +0100 (Mon, 14 Jan 2008)
New Revision: 984

Modified:
   trunk/data/init.lua
   trunk/src/actors.cc
   trunk/src/enigma.hh
   trunk/src/player.cc
   trunk/src/stones_complex.cc
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: 
- eliminate actor attributes "blackball", "whiteball"
- add enum color in enigma.hh
- fix old API access to attribute "on" for st_switch_white, st_floppy


Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-13 23:09:02 UTC (rev 983)
+++ trunk/data/init.lua	2008-01-14 22:28:54 UTC (rev 984)
@@ -93,7 +93,8 @@
 	 end
      end
      if (_obj_name == "st-switch") or (_obj_name == "st-switch_black")
-             or (_obj_name == "st-switch_black") then
+             or (_obj_name == "st-switch_white") 
+             or (_obj_name == "st-floppy") then
          if key == "on" then
 	     _key = "state"   -- new attr name
 	 end
@@ -124,14 +125,24 @@
      local _obj_name = enigma.GetKind(obj)
 
      if (_obj_name == "st-switch") or (_obj_name == "st-switch_black")
-             or (_obj_name == "st-switch_black") then
+             or (_obj_name == "st-switch_white") 
+             or (_obj_name == "st-floppy") then
          if key == "on" then
 	     _key = "state"
 	 end
      end
+     if key == "blackball" or key == "whiteball" then
+         _key = "color"
+     end
 
      local val = enigma._GetAttrib(obj, _key)
      
+     if key == "blackball" then
+        if val == 0 then val = 1 else val = 0 end
+     end
+     if key == "whiteball" then
+        if val == 1 then val = 1 else val = 0 end
+     end
      if _obj_name == "st-oxyd" then
          if key == "color" then
 	     val = "" .. val   -- convert to string

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2008-01-13 23:09:02 UTC (rev 983)
+++ trunk/src/actors.cc	2008-01-14 22:28:54 UTC (rev 984)
@@ -1183,7 +1183,6 @@
         {
             set_attrib("mouseforce", Value(1.0));
             set_attrib("color", Value(0.0));
-            set_attrib("blackball", Value(true));
             set_attrib("player", Value(0.0));
             set_attrib("controllers", Value(1.0));
         }
@@ -1197,7 +1196,6 @@
         {
             set_attrib("mouseforce", Value(1.0));
             set_attrib("color", Value(1.0));
-            set_attrib("whiteball", Value(true));
             set_attrib("player", Value(1.0));
             set_attrib("controllers", Value(2.0));
         }
@@ -1211,7 +1209,6 @@
         {
             set_attrib("mouseforce", Value(1.0));
             set_attrib("color", Value(1.0));
-            set_attrib("whiteball", Value(true));
             set_attrib("controllers", Value(3.0));
             maxSinkDepth = 4;
         }
@@ -1226,7 +1223,6 @@
         {
             set_attrib("mouseforce", Value(2.0));
             set_attrib("color", Value(1.0));
-            set_attrib("whiteball", Value(true));
             set_attrib("controllers", Value(3.0));
         }
         bool is_dead() const { return false; }

Modified: trunk/src/enigma.hh
===================================================================
--- trunk/src/enigma.hh	2008-01-13 23:09:02 UTC (rev 983)
+++ trunk/src/enigma.hh	2008-01-14 22:28:54 UTC (rev 984)
@@ -39,6 +39,11 @@
 
 namespace enigma { 
     
+    enum Color {
+        BLACK = 0,
+        WHITE = 1
+    };
+    
 /* -------------------- Various types -------------------- */
 
     enum Difficulty {

Modified: trunk/src/player.cc
===================================================================
--- trunk/src/player.cc	2008-01-13 23:09:02 UTC (rev 983)
+++ trunk/src/player.cc	2008-01-14 22:28:54 UTC (rev 984)
@@ -294,8 +294,10 @@
         vector<Actor *> &al = players[i].actors;
 
         for (unsigned j=0; j<al.size(); ++j) {
-            if (al[j]->getAttr(black ? "blackball" : "whiteball"))
-                al[j]->set_respawnpos(center);
+            if (Value color = al[j]->getAttr("color")) {
+                if (color == (black ? BLACK : WHITE))
+                    al[j]->set_respawnpos(center);
+            }
         }
     }
 }
@@ -306,8 +308,10 @@
         vector<Actor *> &al = players[i].actors;
 
         for (unsigned j=0; j<al.size(); ++j) {
-            if (al[j]->getAttr(black ? "blackball" : "whiteball"))
-                al[j]->remove_respawnpos();
+            if (Value color = al[j]->getAttr("color")) {
+                if (color == (black ? BLACK : WHITE))
+                    al[j]->remove_respawnpos();
+            }
         }
     }
 }

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2008-01-13 23:09:02 UTC (rev 983)
+++ trunk/src/stones_complex.cc	2008-01-14 22:28:54 UTC (rev 984)
@@ -387,7 +387,8 @@
         CLONEOBJ(OneWayStone_black);
         DECL_TRAITS;
         virtual bool actor_may_pass (Actor *a) {
-            return a->getAttr("blackball") != 0;
+            Value accolor = a->getAttr("color");
+            return accolor && accolor == BLACK;
         }
         void actor_hit (const StoneContact&) {
             // do nothing if hit by actor
@@ -403,7 +404,8 @@
         CLONEOBJ(OneWayStone_white);
         DECL_TRAITS;
         virtual bool actor_may_pass (Actor *a) {
-            return a->getAttr("whiteball") != 0;
+            Value accolor = a->getAttr("color");
+            return accolor && accolor == WHITE;
         }
         void actor_hit (const StoneContact&) {
             // do nothing if hit by actor
@@ -2559,12 +2561,12 @@
     }
 
     void ChessStone::actor_hit(const StoneContact &sc) {
+         Value accolor = sc.actor->getAttr("color");
          if (player::WieldedItemIs (sc.actor, "it-magicwand")) {
              sound_event ("stonepaint");
              set_color(1 - (int)getAttr("color"));
              // If not IDLE, color will be set next time IDLE is set.
-         } else if ((sc.actor->getAttr("blackball") && getAttr("color") == 0)
-                    || (sc.actor->getAttr("whiteball") && getAttr("color") == 1)) {
+         } else if (accolor && getAttr("color") == accolor) {
             V2 v = sc.actor->get_vel();
             Direction dir1 = get_push_direction(sc);
             if(dir1 == NODIR)  return;

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-01-13 23:09:02 UTC (rev 983)
+++ trunk/src/stones_simple.cc	2008-01-14 22:28:54 UTC (rev 984)
@@ -751,7 +751,8 @@
         {}
     private:
         bool may_be_broken_by(Actor *a) const {
-            return (a->getAttr("whiteball") != 0) &&
+            Value color = a->getAttr("color");
+            return color && color == WHITE &&
                 player::WieldedItemIs (a, "it-hammer");
         }
     };
@@ -784,14 +785,14 @@
         {}
     private:
         bool may_be_broken_by(Actor *a) const {
-            return (a->getAttr("blackball") != 0) &&
+            Value color = a->getAttr("color");
+            return color && color == BLACK &&
                 player::WieldedItemIs (a, "it-hammer");
         }
     };
     DEF_TRAITSM(Break_acblack, "st-break_acblack", st_break_acblack, MOVABLE_BREAKABLE);
 }
 
-
 /* -------------------- BrickMagic -------------------- */
 
 /** \page st-brick_magic Magic Brick Stone
@@ -824,7 +825,6 @@
     };
 }
 
-
 /* -------------------- Stonebrush -------------------- */
 
 /** \page st-stonebrush Brush Stone
@@ -1685,12 +1685,13 @@
         {}
 
         StoneResponse collision_response(const StoneContact &sc) {
+            Value accolor = sc.actor->getAttr("color"); 
             if (m_type < 4) {
-                return (sc.actor->getAttr("blackball") != 0) ? 
+                return (accolor && accolor == BLACK) ? 
                     STONE_PASS : STONE_REBOUND;
             }
             else {
-                return (sc.actor->getAttr("whiteball") != 0) ? 
+                return (accolor && accolor == WHITE) ? 
                     STONE_PASS : STONE_REBOUND;
             }
         }
@@ -1757,8 +1758,9 @@
 
     private:
         void actor_hit(const StoneContact &sc) {
-            if      (sc.actor->getAttr("blackball") != 0) turn_white();
-            else if (sc.actor->getAttr("whiteball") != 0) turn_black();
+            Value color = sc.actor->getAttr("color");
+            if      (color && color == BLACK) turn_white();
+            else if (color && color == WHITE) turn_black();
         }
     };
 
@@ -1768,8 +1770,9 @@
         YinYangStone2() : YinYangStone("st-yinyang2") {}
     private:
         void actor_hit(const StoneContact &sc) {
-            if      (sc.actor->getAttr("blackball") != 0) turn_black();
-            else if (sc.actor->getAttr("whiteball") != 0) turn_white();
+            Value color = sc.actor->getAttr("color");
+            if      (color && color == BLACK) turn_black();
+            else if (color && color == WHITE) turn_white();
         }
     };
 
@@ -1785,9 +1788,10 @@
             if (player::WieldedItemIs (sc.actor, "it-magicwand") ||
                 player::WieldedItemIs (sc.actor, "it-brush"))
             {
-                if      (sc.actor->getAttr("blackball") != 0) 
+                Value color = sc.actor->getAttr("color");
+                if      (color && color == BLACK) 
                     turn_white("st-white4");
-                else if (sc.actor->getAttr("whiteball") != 0) 
+                else if (color && color == WHITE) 
                     turn_black("st-black4");
             }
         }



From ral at mail.berlios.de  Wed Jan 16 00:57:26 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 16 Jan 2008 00:57:26 +0100
Subject: [Enigma-game-svn] r985 - in trunk: data src
Message-ID: <200801152357.m0FNvQHX012107@sheep.berlios.de>

Author: ral
Date: 2008-01-16 00:57:24 +0100 (Wed, 16 Jan 2008)
New Revision: 985

Modified:
   trunk/data/init.lua
   trunk/src/Object.cc
   trunk/src/Object.hh
   trunk/src/actors.cc
   trunk/src/items.cc
Log:
Trunk 1.1: Reengineering
- replaced actor horse attributes "target1" to "target4" by dull
  destination attribut support:
  - arbitrary number of destinations given as object group or token list
Note:
- old API horst target1-4 will only work in compatibility mode if floor
  is set prior to horse actor
  (this is not the case in Nat's lib - level "Bodyguard" needs to be
  rewritten)


Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-14 22:28:54 UTC (rev 984)
+++ trunk/data/init.lua	2008-01-15 23:57:24 UTC (rev 985)
@@ -117,6 +117,25 @@
          end
          _key = "destination"
      end
+     if key == "target1" or key == "target2" or key == "target3" or key == "target4" then
+        local i = 0 + string.sub(key, -1)  -- the target number
+        local d = enigma._GetAttrib(obj, "destination")
+        if (d == nil) or (type(d) ~= "table") then
+            d = {}
+        end
+        local c = {}
+        for str in string.gmatch(val, "%d+") do
+            table.insert(c, 0 + str)
+        end
+        d[i] = enigma.GetFloor(c[1], c[2]) -- requires floor to be set first (invalid for Nat method - level Bodyguard)
+        for j = 1, i do
+           if d[j] == nil then
+              d[j] = d[i]
+           end
+        end
+        _key = "destination"
+        _val = d
+     end
      enigma._SetAttrib(obj, _key, _val)
 end
 

Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2008-01-14 22:28:54 UTC (rev 984)
+++ trunk/src/Object.cc	2008-01-15 23:57:24 UTC (rev 985)
@@ -1,6 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004,2005 Daniel Heck
- * Copyright (C) 2007 Ronald Lamprecht
+ * Copyright (C) 2007, 2008 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -274,14 +274,43 @@
     /* Like variant above, but the _result_ of the impulse is delayed.
      */
     
-    void
-    Object::send_impulse(const GridPos& dest, Direction dir, double delay)
+    void Object::send_impulse(const GridPos& dest, Direction dir, double delay)
     {
         if (Stone *st = GetStone(dest)) {
             addDelayedImpulse(Impulse(this, dest, dir), delay, st);
         }
     }
     
+    bool Object::getDestinationByIndex(int idx, ecl::V2 &dstpos) const {
+        int i = 0;  // counter for destination candidates
+        Value dest = getAttr("destination");
+        if (dest.getType() == Value::POSITION && idx == 0) {
+            // arbitrary precision position as destination
+            dstpos = dest;
+            return true;
+        } else {
+            // evaluate destination objects in sequence up to "idx"
+            TokenList tl = dest;  // convert any object type value to a tokenlist 
+            for (TokenList::iterator tit = tl.begin(); tit != tl.end(); ++tit) {
+                ObjectList ol = *tit;  // convert next token to an objectlist
+                for (ObjectList::iterator oit = ol.begin(); oit != ol.end(); ++oit) {
+                    GridObject *go = dynamic_cast<GridObject *>(*oit);  // get the object
+                    if (go != NULL) {   // no actors as destination!
+                        GridPos p = go->get_pos();
+                        if (IsInsideLevel(p)) {   // no objects in inventory,...
+                            if (i == idx) {
+                                dstpos = p.center();
+                                return true;
+                            } else
+                                i++;
+                        }
+                    }
+                }
+            }
+        }
+        return false;
+    }
+    
     void Object::warning(const char *format, ...) const {
         va_list arg_ptr;
     

Modified: trunk/src/Object.hh
===================================================================
--- trunk/src/Object.hh	2008-01-14 22:28:54 UTC (rev 984)
+++ trunk/src/Object.hh	2008-01-15 23:57:24 UTC (rev 985)
@@ -1,6 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2007 Ronald Lamprecht
+ * Copyright (C) 2007,2008 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -22,6 +22,7 @@
 
 #include "display.hh"
 #include "ecl_alist.hh"
+#include "ecl_math.hh"
 #include "Value.hh"
 #include <map>
 
@@ -162,6 +163,20 @@
         
         virtual Value invertActionValue(const Value &val) const;
         
+        /**
+         * Evaluate multiple destinations described by tokenized destination
+         * attribute where every token may be a group by itself. All valid
+         * destinations are indexed in the sequence of tokens and group positions.
+         * The position at the given index is returned as the destination position.
+         * If the caller did index beyond the last valid position this convenience
+         * method returns false, otherwise true to mark a valid position. 
+         * Objects with destinations like Vortex and Horse make use of this method.
+         * @arg idx      requested index of destination starting with 0
+         * @arg destpos  return value for position that is centered to a grid
+         * @return       validity of position at given index
+         */
+        bool getDestinationByIndex(int idx, ecl::V2 &dstpos) const;
+        
     private:
         friend void InitWorld();   // for bootFinished() access
         

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2008-01-14 22:28:54 UTC (rev 984)
+++ trunk/src/actors.cc	2008-01-15 23:57:24 UTC (rev 985)
@@ -1,6 +1,7 @@
 /*
  * Copyright (C) 2002,2003,2004,2005 Daniel Heck
- *
+ * Copyright (C) 2008 Ronald Lamprecht
+ * 
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
  * as published by the Free Software Foundation; either version 2
@@ -472,7 +473,6 @@
 
         // Private methods
         void update_target ();
-        bool try_target (int idx);
 
         // Variables
         int m_targetidx;
@@ -507,36 +507,20 @@
     }
 }
 
-bool Horse::try_target (int idx) {
-    if (idx <= 0 || idx > 4)
-        return false;
-
-    const char *attrs[] = {
-        "target1", "target2", "target3", "target4",
-    };
-    string targetstr;
-    GridLoc loc;
-
-    if (Value v = getAttr(attrs[idx-1]))
-        targetstr = v.get_string();
-    else
-        return false;
-    
-    to_gridloc(targetstr.c_str(), loc);
-    m_target = loc.pos.center();
-    m_targetidx = idx;
-    return true;
-}
-
 void Horse::update_target () {
-
+    V2 newPos;
     if (m_targetidx == -1) {
         // no target defined so far
-        try_target(1);
+        if (getDestinationByIndex(0, newPos)) {
+            m_target = newPos;
+            m_targetidx = 0;
+        }
     } 
     else if (length(m_target - get_pos()) < 0.2) {
         // target reached or? try next one
-        if (!try_target (m_targetidx + 1))
+        if (getDestinationByIndex(++m_targetidx, newPos)) {
+            m_target = newPos;
+        } else
             m_targetidx = -1;     // failed -> start anew
     } 
 }

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-01-14 22:28:54 UTC (rev 984)
+++ trunk/src/items.cc	2008-01-15 23:57:24 UTC (rev 985)
@@ -1861,7 +1861,6 @@
         void prepare_for_warp (Actor *actor);
         void emit_actor(Vortex *destVortex);
 
-        bool get_target_by_index (int idx, V2 &target);
         void perform_warp();    // warp swallowed actor(s)
         void warp_to(const V2 &target);
 
@@ -2012,35 +2011,6 @@
         open();
 }
 
-bool Vortex::get_target_by_index (int idx, V2 &targetpos) {
-    int i = 0;  // counter for destination candidates
-    Value dest = getAttr("destination");
-    if (dest.getType() == Value::POSITION && idx == 0) {
-        // arbitrary precision position as destination
-        targetpos = dest;
-        return true;
-    } else {
-        // evaluate destination objects in sequence up to "idx"
-        TokenList tl = dest;  // convert any object type value to a tokenlist 
-        for (TokenList::iterator tit = tl.begin(); tit != tl.end(); ++tit) {
-            ObjectList ol = *tit;  // convert next token to an objectlist
-            for (ObjectList::iterator oit = ol.begin(); oit != ol.end(); ++oit, i++) {
-                if (i == idx) {
-                    GridObject *go = dynamic_cast<GridObject *>(*oit);  // get the object
-                    if (go != NULL) {   // no actors as destination!
-                        GridPos p = go->get_pos();
-                        if (IsInsideLevel(p)) {   // no objects in inventory,...
-                            targetpos = p.center();
-                            return true;
-                        }
-                    }
-                }
-            }
-        }
-    }
-    return false;
-}
-
 void Vortex::alarm() {
     if (state == WARPING) {
         perform_warp();
@@ -2106,7 +2076,7 @@
 
     // is another target position defined?
     int dest_idx = getAttr("$dest_idx");
-    if (get_target_by_index(dest_idx, v_target)) {
+    if (Object::getDestinationByIndex(dest_idx, v_target)) {
         GridPos  p_target(v_target);
 
         Vortex *v = dynamic_cast<Vortex*>(GetItem(p_target));



From ral at mail.berlios.de  Wed Jan 16 20:58:07 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 16 Jan 2008 20:58:07 +0100
Subject: [Enigma-game-svn] r986 - in trunk: data src src/stones
Message-ID: <200801161958.m0GJw7oA018800@sheep.berlios.de>

Author: ral
Date: 2008-01-16 20:58:05 +0100 (Wed, 16 Jan 2008)
New Revision: 986

Modified:
   trunk/data/init.lua
   trunk/src/actors.cc
   trunk/src/floors.cc
   trunk/src/game.cc
   trunk/src/items.cc
   trunk/src/server.cc
   trunk/src/stones/OxydStone.cc
   trunk/src/stones_complex.cc
   trunk/src/stones_simple.cc
   trunk/src/world.cc
Log:
Trunk 1.1: Reengineering
- rename system message "init" to "_init"
- add message "toggle" for doors
- deny level load on problems with old API horse targets
- catch errors on prepare level load of init.lua, compat.lua, security.lua


Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-15 23:57:24 UTC (rev 985)
+++ trunk/data/init.lua	2008-01-16 19:58:05 UTC (rev 986)
@@ -128,6 +128,9 @@
             table.insert(c, 0 + str)
         end
         d[i] = enigma.GetFloor(c[1], c[2]) -- requires floor to be set first (invalid for Nat method - level Bodyguard)
+        if d[i] == nil then
+             error("Actor Horse without floor error")
+        end
         for j = 1, i do
            if d[j] == nil then
               d[j] = d[i]

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2008-01-15 23:57:24 UTC (rev 985)
+++ trunk/src/actors.cc	2008-01-16 19:58:05 UTC (rev 986)
@@ -265,7 +265,7 @@
 }
 
 Value Actor::message(const Message &m) {
-    if (m.message == "init") {
+    if (m.message == "_init") {
         startingpos = get_pos();
         return Value();
     }
@@ -809,7 +809,7 @@
             break;
         case APPEARING:
             // ugly hack
-            if (m.message == "init") {
+            if (m.message == "_init") {
                 Actor::message (m);
                 handled = true;
             } else if (m.message == "shatter") {

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2008-01-15 23:57:24 UTC (rev 985)
+++ trunk/src/floors.cc	2008-01-16 19:58:05 UTC (rev 986)
@@ -57,13 +57,13 @@
 }
 
 Value Floor::message(const Message &m) {
-    // "init"     : Start burning, if "initfire" is set.
+    // "_init"     : Start burning, if "initfire" is set.
     // "heat"     : Heat the item, heat-transform floor
     //                 or maybe set fire to it (if burnable).
     // "setfire"  : Just try to make fire (if burnable).
     // "forcefire": Force fire, even on unburnable floor.
     // "stopfire" : Stop fire, put ash but don't transform floor.
-    if (m.message == "init" && has_firetype(flft_initfire))
+    if (m.message == "_init" && has_firetype(flft_initfire))
         return force_fire();
     if (m.message == "heat")
         return try_heating(NODIR, flhf_message);
@@ -157,7 +157,7 @@
  *    - "expl" or "ignite" message if the "ignitable"-attribute is set
  *        - thereby by it-dynamite or it-*bomb + "ignitable"
  *    - fire in the neighborhood (see below)
- *    - on initialisation ("init"-message) when "initfire"-attribute is set
+ *    - on initialisation ("_init"-message) when "initfire"-attribute is set
  *  On the floor itself it does
  *    - inform stones on it -> e.g. kill st-wood, st-hay
  *    - keep on burning by chance or if eternal-attribute set

Modified: trunk/src/game.cc
===================================================================
--- trunk/src/game.cc	2008-01-15 23:57:24 UTC (rev 985)
+++ trunk/src/game.cc	2008-01-16 19:58:05 UTC (rev 986)
@@ -33,7 +33,6 @@
 using namespace enigma;
 using namespace std;
 
-
 /* -------------------- Global variables -------------------- */
 
 namespace
@@ -41,7 +40,6 @@
     Uint32      last_tick_time;
 }
 
-
 /* -------------------- Level previews -------------------- */
 
 bool game::DrawLevelPreview (ecl::GC &gc, lev::Proxy *levelProxy)
@@ -65,13 +63,11 @@
 }
 
 
-
 /* -------------------- Functions -------------------- */
 
 void game::StartGame ()
 {
     lev::Index *ind = lev::Index::getCurrentIndex();
-    server::InitNewGame();
 
     video::HideMouse();
     sdl::TempInputGrab grab(enigma::Nograb ? SDL_GRAB_OFF : SDL_GRAB_ON);

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-01-15 23:57:24 UTC (rev 985)
+++ trunk/src/items.cc	2008-01-16 19:58:05 UTC (rev 986)
@@ -1341,7 +1341,7 @@
             if (m.message == "signal") {
                 performAction(m.value.to_bool());  // convert 1/0 values to true/false
                 return Value();                
-            } else if (m.message == "init") {
+            } else if (m.message == "_init") {
                 update_state();                
                 return Value();
             }
@@ -2700,7 +2700,7 @@
     }
 
     Value BlockerItem::message(const Message &m) {
-        if (m.message == "init") { 
+        if (m.message == "_init") { 
             if (Stone *st = GetStone(get_pos())) {
                 if (st->is_kind("st_boulder"))
                     if (state == IDLE && server::GameCompatibility != GAMET_PEROXYD)
@@ -3014,7 +3014,7 @@
 
 Value EasyKillStone::message(const Message &m)
 {
-    if (m.message == "init") {
+    if (m.message == "_init") {
         // does not work in on_creation() because items are created
         // before stones are created.
         if (server::GetDifficulty() == DIFFICULTY_EASY) {
@@ -3043,7 +3043,7 @@
         DECL_TRAITS;
 
         virtual Value message(const Message &m) {
-            if (m.message == "init") {
+            if (m.message == "_init") {
                 // does not work in on_creation() because items are created
                 // before stones are created.
                 if (server::GetDifficulty() == DIFFICULTY_HARD)
@@ -3068,7 +3068,7 @@
         DECL_TRAITS;
 
         virtual Value message (const Message &m) {
-            if (m.message == "init") {
+            if (m.message == "_init") {
                 if (server::SingleComputerGame)
                     KillStone (get_pos());
                 kill();
@@ -3087,7 +3087,7 @@
         DECL_TRAITS;
 
         virtual Value message (const Message &m) {
-            if (m.message == "init") {
+            if (m.message == "_init") {
                 if (!server::SingleComputerGame)
                     KillStone (get_pos());
                 kill();

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2008-01-15 23:57:24 UTC (rev 985)
+++ trunk/src/server.cc	2008-01-16 19:58:05 UTC (rev 986)
@@ -124,9 +124,9 @@
 
 void load_level(lev::Proxy *levelProxy, bool isRestart)
 {
-    server::PrepareLevel();
+    try {
+        server::PrepareLevel();
 
-    try {
         // clear inventory before level load and give us 2 extralives
         player::NewGame(isRestart);
 

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-01-15 23:57:24 UTC (rev 985)
+++ trunk/src/stones/OxydStone.cc	2008-01-16 19:58:05 UTC (rev 986)
@@ -872,7 +872,7 @@
                 tryOpen();
             return Value();
         }
-        else if (m.message == "init") {
+        else if (m.message == "_init") {
             initColors();
             return Value();
         }

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2008-01-15 23:57:24 UTC (rev 985)
+++ trunk/src/stones_complex.cc	2008-01-16 19:58:05 UTC (rev 986)
@@ -1307,7 +1307,7 @@
         newstate = OPENING;
     } else if (m.message == "close") {
         newstate = CLOSING;
-    } else if (m.message == "openclose") {
+    } else if (m.message == "openclose" || m.message == "toggle") {
         newstate = (state==OPEN || state==OPENING) ? CLOSING : OPENING;
     } else if (m.message == "signal") {
         newstate = m.value.to_bool() ? OPENING : CLOSING;
@@ -1506,7 +1506,7 @@
         void notify_item();
 
         virtual Value message(const Message &m) {
-            if (m.message == "init") { // request from ShogunDot (if set _after_ ShogunStone)
+            if (m.message == "_init") { // request from ShogunDot (if set _after_ ShogunStone)
                 notify_item();
                 return Value();
             }

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-01-15 23:57:24 UTC (rev 985)
+++ trunk/src/stones_simple.cc	2008-01-16 19:58:05 UTC (rev 986)
@@ -269,7 +269,7 @@
         DECL_TRAITS;
 
         virtual Value message(const Message &m) {
-            if (m.message == "init") {
+            if (m.message == "_init") {
                 if (server::GetDifficulty() == DIFFICULTY_EASY) {
                     SetFloor (get_pos(), MakeFloor ("fl-normal"));
                 } else {
@@ -1581,7 +1581,7 @@
                 // Oxyd* usage of ActorImpulseStone as a signal multiplier
                 ObjectList ol = getAttr("$!oxyd!destinations");
                 
-                if (m.message == "init" && ol.size() > 0) {
+                if (m.message == "_init" && ol.size() > 0) {
                     signalidx = 0;
                     SendMessage(ol.front(), "signal", 1);
                     return Value();

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-01-15 23:57:24 UTC (rev 985)
+++ trunk/src/world.cc	2008-01-16 19:58:05 UTC (rev 986)
@@ -1576,7 +1576,7 @@
     {
         Actor *a = *i;
         a->on_creation(a->get_actorinfo()->pos);
-        SendMessage(a, "init", Value());
+        SendMessage(a, "_init", Value());
 
         if (Value v = a->getAttr("player")) {
             int iplayer = v;
@@ -1592,7 +1592,7 @@
     if (!seen_player0) 
         throw XLevelLoading("Error: No player 0 defined!");
 
-    BroadcastMessage("init", Value(),
+    BroadcastMessage("_init", Value(),
         GridLayerBits(GRID_ITEMS_BIT | GRID_STONES_BIT | GRID_FLOOR_BIT));
 
     server::InitMoveCounter();



From ral at mail.berlios.de  Wed Jan 16 21:52:30 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 16 Jan 2008 21:52:30 +0100
Subject: [Enigma-game-svn] r987 - in trunk: . doc src
Message-ID: <200801162052.m0GKqU5A022528@sheep.berlios.de>

Author: ral
Date: 2008-01-16 21:52:30 +0100 (Wed, 16 Jan 2008)
New Revision: 987

Added:
   trunk/doc/doxygen.config
Removed:
   trunk/src/enigma.doxygen
   trunk/src/enigma.doxygen.fulldoc
Modified:
   trunk/Makefile.am
   trunk/doc/Makefile.am
   trunk/src/Makefile.am
Log:
trunk 1.1:
- doxygen config file moved to doc/doxygen.config
- doxygen output to doc/enginecode
- make target "doxygen" added



Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2008-01-16 19:58:05 UTC (rev 986)
+++ trunk/Makefile.am	2008-01-16 20:52:30 UTC (rev 987)
@@ -32,3 +32,6 @@
 	cd doc/reference/images && $(MAKE) pdf
 	cd doc/reference && $(MAKE) pdf
 
+doxygen:
+	cd doc && $(MAKE) doxygen
+

Modified: trunk/doc/Makefile.am
===================================================================
--- trunk/doc/Makefile.am	2008-01-16 19:58:05 UTC (rev 986)
+++ trunk/doc/Makefile.am	2008-01-16 20:52:30 UTC (rev 987)
@@ -9,4 +9,8 @@
 doc_DATA = gpl.txt lgpl.txt
 
 EXTRA_DIST = gpl.txt lgpl.txt enigma.6 HACKING README.mingw32 REQUIREMENTS README.macosx\
-	$(index_DATA)
+	doxygen.config $(index_DATA)
+
+doxygen:
+	doxygen doxygen.config
+

Copied: trunk/doc/doxygen.config (from rev 986, trunk/src/enigma.doxygen.fulldoc)
===================================================================
--- trunk/src/enigma.doxygen.fulldoc	2008-01-16 19:58:05 UTC (rev 986)
+++ trunk/doc/doxygen.config	2008-01-16 20:52:30 UTC (rev 987)
@@ -0,0 +1,191 @@
+# Doxyfile 1.2.13-20020210
+
+#---------------------------------------------------------------------------
+# General configuration options
+#---------------------------------------------------------------------------
+PROJECT_NAME           = Enigma
+PROJECT_NUMBER         = 
+OUTPUT_DIRECTORY       = enginecode
+OUTPUT_LANGUAGE        = English
+EXTRACT_ALL            = YES
+EXTRACT_PRIVATE        = YES
+EXTRACT_STATIC         = YES
+EXTRACT_LOCAL_CLASSES  = YES
+HIDE_UNDOC_MEMBERS     = NO
+HIDE_UNDOC_CLASSES     = NO
+BRIEF_MEMBER_DESC      = YES
+REPEAT_BRIEF           = YES
+ALWAYS_DETAILED_SEC    = NO
+INLINE_INHERITED_MEMB  = NO
+FULL_PATH_NAMES        = NO
+STRIP_FROM_PATH        = 
+INTERNAL_DOCS          = YES
+STRIP_CODE_COMMENTS    = NO
+CASE_SENSE_NAMES       = YES
+SHORT_NAMES            = NO
+HIDE_SCOPE_NAMES       = NO
+VERBATIM_HEADERS       = YES
+SHOW_INCLUDE_FILES     = YES
+JAVADOC_AUTOBRIEF      = YES
+MULTILINE_CPP_IS_BRIEF = NO
+DETAILS_AT_TOP         = NO
+INHERIT_DOCS           = YES
+INLINE_INFO            = YES
+SORT_MEMBER_DOCS       = YES
+DISTRIBUTE_GROUP_DOC   = NO
+TAB_SIZE               = 8
+GENERATE_TODOLIST      = YES
+GENERATE_TESTLIST      = YES
+GENERATE_BUGLIST       = YES
+ALIASES                = 
+ENABLED_SECTIONS       = 
+MAX_INITIALIZER_LINES  = 30
+OPTIMIZE_OUTPUT_FOR_C  = NO
+OPTIMIZE_OUTPUT_JAVA   = NO
+SHOW_USED_FILES        = YES
+#---------------------------------------------------------------------------
+# configuration options related to warning and progress messages
+#---------------------------------------------------------------------------
+QUIET                  = NO
+WARNINGS               = YES
+WARN_IF_UNDOCUMENTED   = YES
+WARN_FORMAT            = "$file:$line: $text"
+WARN_LOGFILE           = 
+#---------------------------------------------------------------------------
+# configuration options related to the input files
+#---------------------------------------------------------------------------
+INPUT                  = ../src \
+                         ../lib-src/enigma-core/ \
+                         ../lib-src/oxydlib/
+FILE_PATTERNS          = *.cc \
+                         *.hh
+RECURSIVE              = YES
+EXCLUDE                = 
+EXCLUDE_SYMLINKS       = NO
+EXCLUDE_PATTERNS       = 
+EXAMPLE_PATH           = 
+EXAMPLE_PATTERNS       = 
+EXAMPLE_RECURSIVE      = NO
+IMAGE_PATH             = gfx
+INPUT_FILTER           = 
+FILTER_SOURCE_FILES    = NO
+#---------------------------------------------------------------------------
+# configuration options related to source browsing
+#---------------------------------------------------------------------------
+SOURCE_BROWSER         = YES
+INLINE_SOURCES         = NO
+REFERENCED_BY_RELATION = YES
+REFERENCES_RELATION    = YES
+#---------------------------------------------------------------------------
+# configuration options related to the alphabetical class index
+#---------------------------------------------------------------------------
+ALPHABETICAL_INDEX     = NO
+COLS_IN_ALPHA_INDEX    = 5
+IGNORE_PREFIX          = 
+#---------------------------------------------------------------------------
+# configuration options related to the HTML output
+#---------------------------------------------------------------------------
+GENERATE_HTML          = YES
+HTML_OUTPUT            = html
+HTML_FILE_EXTENSION    = .html
+HTML_HEADER            = 
+HTML_FOOTER            = 
+HTML_STYLESHEET        = 
+HTML_ALIGN_MEMBERS     = YES
+GENERATE_HTMLHELP      = NO
+CHM_FILE               = 
+HHC_LOCATION           = 
+GENERATE_CHI           = NO
+BINARY_TOC             = NO
+TOC_EXPAND             = NO
+DISABLE_INDEX          = NO
+ENUM_VALUES_PER_LINE   = 4
+GENERATE_TREEVIEW      = NO
+TREEVIEW_WIDTH         = 250
+#---------------------------------------------------------------------------
+# configuration options related to the LaTeX output
+#---------------------------------------------------------------------------
+GENERATE_LATEX         = NO
+LATEX_OUTPUT           = latex
+LATEX_CMD_NAME         = latex
+MAKEINDEX_CMD_NAME     = makeindex
+COMPACT_LATEX          = NO
+PAPER_TYPE             = a4wide
+EXTRA_PACKAGES         = 
+LATEX_HEADER           = 
+PDF_HYPERLINKS         = NO
+USE_PDFLATEX           = NO
+LATEX_BATCHMODE        = NO
+#---------------------------------------------------------------------------
+# configuration options related to the RTF output
+#---------------------------------------------------------------------------
+GENERATE_RTF           = NO
+RTF_OUTPUT             = rtf
+COMPACT_RTF            = NO
+RTF_HYPERLINKS         = NO
+RTF_STYLESHEET_FILE    = 
+RTF_EXTENSIONS_FILE    = 
+#---------------------------------------------------------------------------
+# configuration options related to the man page output
+#---------------------------------------------------------------------------
+GENERATE_MAN           = NO
+MAN_OUTPUT             = man
+MAN_EXTENSION          = .3
+MAN_LINKS              = NO
+#---------------------------------------------------------------------------
+# configuration options related to the XML output
+#---------------------------------------------------------------------------
+GENERATE_XML           = NO
+#---------------------------------------------------------------------------
+# configuration options for the AutoGen Definitions output
+#---------------------------------------------------------------------------
+GENERATE_AUTOGEN_DEF   = NO
+#---------------------------------------------------------------------------
+# Configuration options related to the preprocessor   
+#---------------------------------------------------------------------------
+ENABLE_PREPROCESSING   = YES
+MACRO_EXPANSION        = NO
+EXPAND_ONLY_PREDEF     = NO
+SEARCH_INCLUDES        = YES
+INCLUDE_PATH           = 
+INCLUDE_FILE_PATTERNS  = 
+PREDEFINED             = 
+EXPAND_AS_DEFINED      = 
+SKIP_FUNCTION_MACROS   = YES
+#---------------------------------------------------------------------------
+# Configuration::addtions related to external references   
+#---------------------------------------------------------------------------
+TAGFILES               = 
+GENERATE_TAGFILE       = 
+ALLEXTERNALS           = NO
+EXTERNAL_GROUPS        = YES
+PERL_PATH              = /usr/bin/perl
+#---------------------------------------------------------------------------
+# Configuration options related to the dot tool   
+#---------------------------------------------------------------------------
+CLASS_DIAGRAMS         = YES
+HIDE_UNDOC_RELATIONS   = YES
+HAVE_DOT               = YES
+CLASS_GRAPH            = YES
+COLLABORATION_GRAPH    = YES
+TEMPLATE_RELATIONS     = YES
+INCLUDE_GRAPH          = YES
+INCLUDED_BY_GRAPH      = YES
+GRAPHICAL_HIERARCHY    = YES
+DOT_IMAGE_FORMAT       = png
+DOT_PATH               = 
+DOTFILE_DIRS           = 
+MAX_DOT_GRAPH_WIDTH    = 1024
+MAX_DOT_GRAPH_HEIGHT   = 1024
+GENERATE_LEGEND        = YES
+DOT_CLEANUP            = YES
+#---------------------------------------------------------------------------
+# Configuration::addtions related to the search engine   
+#---------------------------------------------------------------------------
+SEARCHENGINE           = NO
+CGI_NAME               = search.cgi
+CGI_URL                = 
+DOC_URL                = 
+DOC_ABSPATH            = 
+BIN_ABSPATH            = /usr/local/bin/
+EXT_DOC_PATHS          = 

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-01-16 19:58:05 UTC (rev 986)
+++ trunk/src/Makefile.am	2008-01-16 20:52:30 UTC (rev 987)
@@ -6,8 +6,7 @@
 
 EXTRA_DIST = \
 	enigma.ico \
-	enigma.rc \
-	enigma.doxygen
+	enigma.rc
 
 
 CXXFLAGS = @CXXFLAGS@\

Deleted: trunk/src/enigma.doxygen
===================================================================
--- trunk/src/enigma.doxygen	2008-01-16 19:58:05 UTC (rev 986)
+++ trunk/src/enigma.doxygen	2008-01-16 20:52:30 UTC (rev 987)
@@ -1,946 +0,0 @@
-# Doxyfile 1.2.16
-
-# This file describes the settings to be used by the documentation system
-# doxygen (www.doxygen.org) for a project
-#
-# All text after a hash (#) is considered a comment and will be ignored
-# The format is:
-#       TAG = value [value, ...]
-# For lists items can also be appended using:
-#       TAG += value [value, ...]
-# Values that contain spaces should be placed between quotes (" ")
-
-#---------------------------------------------------------------------------
-# General configuration options
-#---------------------------------------------------------------------------
-
-# The PROJECT_NAME tag is a single word (or a sequence of words surrounded 
-# by quotes) that should identify the project.
-
-PROJECT_NAME           = 
-
-# The PROJECT_NUMBER tag can be used to enter a project or revision number. 
-# This could be handy for archiving the generated documentation or 
-# if some version control system is used.
-
-PROJECT_NUMBER         = 
-
-# The OUTPUT_DIRECTORY tag is used to specify the (relative or absolute) 
-# base path where the generated documentation will be put. 
-# If a relative path is entered, it will be relative to the location 
-# where doxygen was started. If left blank the current directory will be used.
-
-OUTPUT_DIRECTORY       = doc
-
-# The OUTPUT_LANGUAGE tag is used to specify the language in which all 
-# documentation generated by doxygen is written. Doxygen will use this 
-# information to generate all constant output in the proper language. 
-# The default language is English, other supported languages are: 
-# Brazilian, Chinese, Chinese-Traditional, Croatian, Czech, Danish, Dutch, 
-# Finnish, French, German, Greek, Hungarian, Italian, Japanese, Korean, 
-# Norwegian, Polish, Portuguese, Romanian, Russian, Slovak, Slovene, 
-# Spanish, Swedish and Ukrainian.
-
-OUTPUT_LANGUAGE        = English
-
-# If the EXTRACT_ALL tag is set to YES doxygen will assume all entities in 
-# documentation are documented, even if no documentation was available. 
-# Private class members and static file members will be hidden unless 
-# the EXTRACT_PRIVATE and EXTRACT_STATIC tags are set to YES
-
-EXTRACT_ALL            = NO
-
-# If the EXTRACT_PRIVATE tag is set to YES all private members of a class 
-# will be included in the documentation.
-
-EXTRACT_PRIVATE        = NO
-
-# If the EXTRACT_STATIC tag is set to YES all static members of a file 
-# will be included in the documentation.
-
-EXTRACT_STATIC         = NO
-
-# If the EXTRACT_LOCAL_CLASSES tag is set to YES classes (and structs) 
-# defined locally in source files will be included in the documentation. 
-# If set to NO only classes defined in header files are included.
-
-EXTRACT_LOCAL_CLASSES  = YES
-
-# If the HIDE_UNDOC_MEMBERS tag is set to YES, Doxygen will hide all 
-# undocumented members of documented classes, files or namespaces. 
-# If set to NO (the default) these members will be included in the 
-# various overviews, but no documentation section is generated. 
-# This option has no effect if EXTRACT_ALL is enabled.
-
-HIDE_UNDOC_MEMBERS     = YES
-
-# If the HIDE_UNDOC_CLASSES tag is set to YES, Doxygen will hide all 
-# undocumented classes that are normally visible in the class hierarchy. 
-# If set to NO (the default) these class will be included in the various 
-# overviews. This option has no effect if EXTRACT_ALL is enabled.
-
-HIDE_UNDOC_CLASSES     = NO
-
-# If the BRIEF_MEMBER_DESC tag is set to YES (the default) Doxygen will 
-# include brief member descriptions after the members that are listed in 
-# the file and class documentation (similar to JavaDoc). 
-# Set to NO to disable this.
-
-BRIEF_MEMBER_DESC      = YES
-
-# If the REPEAT_BRIEF tag is set to YES (the default) Doxygen will prepend 
-# the brief description of a member or function before the detailed description. 
-# Note: if both HIDE_UNDOC_MEMBERS and BRIEF_MEMBER_DESC are set to NO, the 
-# brief descriptions will be completely suppressed.
-
-REPEAT_BRIEF           = YES
-
-# If the ALWAYS_DETAILED_SEC and REPEAT_BRIEF tags are both set to YES then 
-# Doxygen will generate a detailed section even if there is only a brief 
-# description.
-
-ALWAYS_DETAILED_SEC    = NO
-
-# If the INLINE_INHERITED_MEMB tag is set to YES, doxygen will show all inherited 
-# members of a class in the documentation of that class as if those members were 
-# ordinary class members. Constructors, destructors and assignment operators of 
-# the base classes will not be shown.
-
-INLINE_INHERITED_MEMB  = NO
-
-# If the FULL_PATH_NAMES tag is set to YES then Doxygen will prepend the full 
-# path before files name in the file list and in the header files. If set 
-# to NO the shortest path that makes the file name unique will be used.
-
-FULL_PATH_NAMES        = NO
-
-# If the FULL_PATH_NAMES tag is set to YES then the STRIP_FROM_PATH tag 
-# can be used to strip a user defined part of the path. Stripping is 
-# only done if one of the specified strings matches the left-hand part of 
-# the path. It is allowed to use relative paths in the argument list.
-
-STRIP_FROM_PATH        = 
-
-# The INTERNAL_DOCS tag determines if documentation 
-# that is typed after a \internal command is included. If the tag is set 
-# to NO (the default) then the documentation will be excluded. 
-# Set it to YES to include the internal documentation.
-
-INTERNAL_DOCS          = NO
-
-# Setting the STRIP_CODE_COMMENTS tag to YES (the default) will instruct 
-# doxygen to hide any special comment blocks from generated source code 
-# fragments. Normal C and C++ comments will always remain visible.
-
-STRIP_CODE_COMMENTS    = YES
-
-# If the CASE_SENSE_NAMES tag is set to NO then Doxygen will only generate 
-# file names in lower case letters. If set to YES upper case letters are also 
-# allowed. This is useful if you have classes or files whose names only differ 
-# in case and if your file system supports case sensitive file names. Windows 
-# users are adviced to set this option to NO.
-
-CASE_SENSE_NAMES       = YES
-
-# If the SHORT_NAMES tag is set to YES, doxygen will generate much shorter 
-# (but less readable) file names. This can be useful is your file systems 
-# doesn't support long names like on DOS, Mac, or CD-ROM.
-
-SHORT_NAMES            = NO
-
-# If the HIDE_SCOPE_NAMES tag is set to NO (the default) then Doxygen 
-# will show members with their full class and namespace scopes in the 
-# documentation. If set to YES the scope will be hidden.
-
-HIDE_SCOPE_NAMES       = NO
-
-# If the VERBATIM_HEADERS tag is set to YES (the default) then Doxygen 
-# will generate a verbatim copy of the header file for each class for 
-# which an include is specified. Set to NO to disable this.
-
-VERBATIM_HEADERS       = YES
-
-# If the SHOW_INCLUDE_FILES tag is set to YES (the default) then Doxygen 
-# will put list of the files that are included by a file in the documentation 
-# of that file.
-
-SHOW_INCLUDE_FILES     = YES
-
-# If the JAVADOC_AUTOBRIEF tag is set to YES then Doxygen 
-# will interpret the first line (until the first dot) of a JavaDoc-style 
-# comment as the brief description. If set to NO, the JavaDoc 
-# comments  will behave just like the Qt-style comments (thus requiring an 
-# explict @brief command for a brief description.
-
-JAVADOC_AUTOBRIEF      = NO
-
-# If the DETAILS_AT_TOP tag is set to YES then Doxygen 
-# will output the detailed description near the top, like JavaDoc.
-# If set to NO, the detailed description appears after the member 
-# documentation.
-
-DETAILS_AT_TOP         = NO
-
-# If the INHERIT_DOCS tag is set to YES (the default) then an undocumented 
-# member inherits the documentation from any documented member that it 
-# reimplements.
-
-INHERIT_DOCS           = YES
-
-# If the INLINE_INFO tag is set to YES (the default) then a tag [inline] 
-# is inserted in the documentation for inline members.
-
-INLINE_INFO            = YES
-
-# If the SORT_MEMBER_DOCS tag is set to YES (the default) then doxygen 
-# will sort the (detailed) documentation of file and class members 
-# alphabetically by member name. If set to NO the members will appear in 
-# declaration order.
-
-SORT_MEMBER_DOCS       = YES
-
-# If member grouping is used in the documentation and the DISTRIBUTE_GROUP_DOC 
-# tag is set to YES, then doxygen will reuse the documentation of the first 
-# member in the group (if any) for the other members of the group. By default 
-# all members of a group must be documented explicitly.
-
-DISTRIBUTE_GROUP_DOC   = NO
-
-# The TAB_SIZE tag can be used to set the number of spaces in a tab. 
-# Doxygen uses this value to replace tabs by spaces in code fragments.
-
-TAB_SIZE               = 8
-
-# The GENERATE_TODOLIST tag can be used to enable (YES) or 
-# disable (NO) the todo list. This list is created by putting \todo 
-# commands in the documentation.
-
-GENERATE_TODOLIST      = YES
-
-# The GENERATE_TESTLIST tag can be used to enable (YES) or 
-# disable (NO) the test list. This list is created by putting \test 
-# commands in the documentation.
-
-GENERATE_TESTLIST      = YES
-
-# The GENERATE_BUGLIST tag can be used to enable (YES) or 
-# disable (NO) the bug list. This list is created by putting \bug 
-# commands in the documentation.
-
-GENERATE_BUGLIST       = YES
-
-# This tag can be used to specify a number of aliases that acts 
-# as commands in the documentation. An alias has the form "name=value". 
-# For example adding "sideeffect=\par Side Effects:\n" will allow you to 
-# put the command \sideeffect (or @sideeffect) in the documentation, which 
-# will result in a user defined paragraph with heading "Side Effects:". 
-# You can put \n's in the value part of an alias to insert newlines.
-
-ALIASES                = 
-
-# The ENABLED_SECTIONS tag can be used to enable conditional 
-# documentation sections, marked by \if sectionname ... \endif.
-
-ENABLED_SECTIONS       = 
-
-# The MAX_INITIALIZER_LINES tag determines the maximum number of lines 
-# the initial value of a variable or define consist of for it to appear in 
-# the documentation. If the initializer consists of more lines than specified 
-# here it will be hidden. Use a value of 0 to hide initializers completely. 
-# The appearance of the initializer of individual variables and defines in the 
-# documentation can be controlled using \showinitializer or \hideinitializer 
-# command in the documentation regardless of this setting.
-
-MAX_INITIALIZER_LINES  = 30
-
-# Set the OPTIMIZE_OUTPUT_FOR_C tag to YES if your project consists of C sources 
-# only. Doxygen will then generate output that is more tailored for C. 
-# For instance some of the names that are used will be different. The list 
-# of all members will be omitted, etc.
-
-OPTIMIZE_OUTPUT_FOR_C  = NO
-
-# Set the OPTIMIZE_OUTPUT_JAVA tag to YES if your project consists of Java sources 
-# only. Doxygen will then generate output that is more tailored for Java. 
-# For instance namespaces will be presented as packages, qualified scopes 
-# will look different, etc.
-
-OPTIMIZE_OUTPUT_JAVA   = NO
-
-# Set the SHOW_USED_FILES tag to NO to disable the list of files generated 
-# at the bottom of the documentation of classes and structs. If set to YES the 
-# list will mention the files that were used to generate the documentation.
-
-SHOW_USED_FILES        = YES
-
-#---------------------------------------------------------------------------
-# configuration options related to warning and progress messages
-#---------------------------------------------------------------------------
-
-# The QUIET tag can be used to turn on/off the messages that are generated 
-# by doxygen. Possible values are YES and NO. If left blank NO is used.
-
-QUIET                  = NO
-
-# The WARNINGS tag can be used to turn on/off the warning messages that are 
-# generated by doxygen. Possible values are YES and NO. If left blank 
-# NO is used.
-
-WARNINGS               = YES
-
-# If WARN_IF_UNDOCUMENTED is set to YES, then doxygen will generate warnings 
-# for undocumented members. If EXTRACT_ALL is set to YES then this flag will 
-# automatically be disabled.
-
-WARN_IF_UNDOCUMENTED   = YES
-
-# The WARN_FORMAT tag determines the format of the warning messages that 
-# doxygen can produce. The string should contain the $file, $line, and $text 
-# tags, which will be replaced by the file and line number from which the 
-# warning originated and the warning text.
-
-WARN_FORMAT            = "$file:$line: $text"
-
-# The WARN_LOGFILE tag can be used to specify a file to which warning 
-# and error messages should be written. If left blank the output is written 
-# to stderr.
-
-WARN_LOGFILE           = 
-
-#---------------------------------------------------------------------------
-# configuration options related to the input files
-#---------------------------------------------------------------------------
-
-# The INPUT tag can be used to specify the files and/or directories that contain 
-# documented source files. You may enter file names like "myfile.cpp" or 
-# directories like "/usr/src/myproject". Separate the files or directories 
-# with spaces.
-
-INPUT                  = enigma.cc world.hh objects.cc actors.cc laser.cc items.cc
-
-# If the value of the INPUT tag contains directories, you can use the 
-# FILE_PATTERNS tag to specify one or more wildcard pattern (like *.cpp 
-# and *.h) to filter out the source-files in the directories. If left 
-# blank the following patterns are tested: 
-# *.c *.cc *.cxx *.cpp *.c++ *.java *.ii *.ixx *.ipp *.i++ *.inl *.h *.hh *.hxx *.hpp 
-# *.h++ *.idl *.odl
-
-FILE_PATTERNS          = 
-
-# The RECURSIVE tag can be used to turn specify whether or not subdirectories 
-# should be searched for input files as well. Possible values are YES and NO. 
-# If left blank NO is used.
-
-RECURSIVE              = NO
-
-# The EXCLUDE tag can be used to specify files and/or directories that should 
-# excluded from the INPUT source files. This way you can easily exclude a 
-# subdirectory from a directory tree whose root is specified with the INPUT tag.
-
-EXCLUDE                = 
-
-# The EXCLUDE_SYMLINKS tag can be used select whether or not files or directories 
-# that are symbolic links (a Unix filesystem feature) are excluded from the input.
-
-EXCLUDE_SYMLINKS       = NO
-
-# If the value of the INPUT tag contains directories, you can use the 
-# EXCLUDE_PATTERNS tag to specify one or more wildcard patterns to exclude 
-# certain files from those directories.
-
-EXCLUDE_PATTERNS       = 
-
-# The EXAMPLE_PATH tag can be used to specify one or more files or 
-# directories that contain example code fragments that are included (see 
-# the \include command).
-
-EXAMPLE_PATH           = 
-
-# If the value of the EXAMPLE_PATH tag contains directories, you can use the 
-# EXAMPLE_PATTERNS tag to specify one or more wildcard pattern (like *.cpp 
-# and *.h) to filter out the source-files in the directories. If left 
-# blank all files are included.
-
-EXAMPLE_PATTERNS       = 
-
-# If the EXAMPLE_RECURSIVE tag is set to YES then subdirectories will be 
-# searched for input files to be used with the \include or \dontinclude 
-# commands irrespective of the value of the RECURSIVE tag. 
-# Possible values are YES and NO. If left blank NO is used.
-
-EXAMPLE_RECURSIVE      = NO
-
-# The IMAGE_PATH tag can be used to specify one or more files or 
-# directories that contain image that are included in the documentation (see 
-# the \image command).
-
-IMAGE_PATH             = gfx
-
-# The INPUT_FILTER tag can be used to specify a program that doxygen should 
-# invoke to filter for each input file. Doxygen will invoke the filter program 
-# by executing (via popen()) the command <filter> <input-file>, where <filter> 
-# is the value of the INPUT_FILTER tag, and <input-file> is the name of an 
-# input file. Doxygen will then use the output that the filter program writes 
-# to standard output.
-
-INPUT_FILTER           = 
-
-# If the FILTER_SOURCE_FILES tag is set to YES, the input filter (if set using 
-# INPUT_FILTER) will be used to filter the input files when producing source 
-# files to browse.
-
-FILTER_SOURCE_FILES    = NO
-
-#---------------------------------------------------------------------------
-# configuration options related to source browsing
-#---------------------------------------------------------------------------
-
-# If the SOURCE_BROWSER tag is set to YES then a list of source files will 
-# be generated. Documented entities will be cross-referenced with these sources.
-
-SOURCE_BROWSER         = NO
-
-# Setting the INLINE_SOURCES tag to YES will include the body 
-# of functions and classes directly in the documentation.
-
-INLINE_SOURCES         = NO
-
-# If the REFERENCED_BY_RELATION tag is set to YES (the default) 
-# then for each documented function all documented 
-# functions referencing it will be listed.
-
-REFERENCED_BY_RELATION = YES
-
-# If the REFERENCES_RELATION tag is set to YES (the default) 
-# then for each documented function all documented entities 
-# called/used by that function will be listed.
-
-REFERENCES_RELATION    = YES
-
-#---------------------------------------------------------------------------
-# configuration options related to the alphabetical class index
-#---------------------------------------------------------------------------
-
-# If the ALPHABETICAL_INDEX tag is set to YES, an alphabetical index 
-# of all compounds will be generated. Enable this if the project 
-# contains a lot of classes, structs, unions or interfaces.
-
-ALPHABETICAL_INDEX     = NO
-
-# If the alphabetical index is enabled (see ALPHABETICAL_INDEX) then 
-# the COLS_IN_ALPHA_INDEX tag can be used to specify the number of columns 
-# in which this list will be split (can be a number in the range [1..20])
-
-COLS_IN_ALPHA_INDEX    = 5
-
-# In case all classes in a project start with a common prefix, all 
-# classes will be put under the same header in the alphabetical index. 
-# The IGNORE_PREFIX tag can be used to specify one or more prefixes that 
-# should be ignored while generating the index headers.
-
-IGNORE_PREFIX          = 
-
-#---------------------------------------------------------------------------
-# configuration options related to the HTML output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_HTML tag is set to YES (the default) Doxygen will 
-# generate HTML output.
-
-GENERATE_HTML          = YES
-
-# The HTML_OUTPUT tag is used to specify where the HTML docs will be put. 
-# If a relative path is entered the value of OUTPUT_DIRECTORY will be 
-# put in front of it. If left blank `html' will be used as the default path.
-
-HTML_OUTPUT            = html
-
-# The HTML_FILE_EXTENSION tag can be used to specify the file extension for 
-# each generated HTML page (for example: .htm,.php,.asp). If it is left blank 
-# doxygen will generate files with .html extension.
-
-HTML_FILE_EXTENSION    = .html
-
-# The HTML_HEADER tag can be used to specify a personal HTML header for 
-# each generated HTML page. If it is left blank doxygen will generate a 
-# standard header.
-
-HTML_HEADER            = 
-
-# The HTML_FOOTER tag can be used to specify a personal HTML footer for 
-# each generated HTML page. If it is left blank doxygen will generate a 
-# standard footer.
-
-HTML_FOOTER            = 
-
-# The HTML_STYLESHEET tag can be used to specify a user defined cascading 
-# style sheet that is used by each HTML page. It can be used to 
-# fine-tune the look of the HTML output. If the tag is left blank doxygen 
-# will generate a default style sheet
-
-HTML_STYLESHEET        = 
-
-# If the HTML_ALIGN_MEMBERS tag is set to YES, the members of classes, 
-# files or namespaces will be aligned in HTML using tables. If set to 
-# NO a bullet list will be used.
-
-HTML_ALIGN_MEMBERS     = YES
-
-# If the GENERATE_HTMLHELP tag is set to YES, additional index files 
-# will be generated that can be used as input for tools like the 
-# Microsoft HTML help workshop to generate a compressed HTML help file (.chm) 
-# of the generated HTML documentation.
-
-GENERATE_HTMLHELP      = NO
-
-# If the GENERATE_HTMLHELP tag is set to YES, the GENERATE_CHI flag 
-# controls if a separate .chi index file is generated (YES) or that 
-# it should be included in the master .chm file (NO).
-
-GENERATE_CHI           = NO
-
-# If the GENERATE_HTMLHELP tag is set to YES, the BINARY_TOC flag 
-# controls whether a binary table of contents is generated (YES) or a 
-# normal table of contents (NO) in the .chm file.
-
-BINARY_TOC             = NO
-
-# The TOC_EXPAND flag can be set to YES to add extra items for group members 
-# to the contents of the Html help documentation and to the tree view.
-
-TOC_EXPAND             = NO
-
-# The DISABLE_INDEX tag can be used to turn on/off the condensed index at 
-# top of each HTML page. The value NO (the default) enables the index and 
-# the value YES disables it.
-
-DISABLE_INDEX          = NO
-
-# This tag can be used to set the number of enum values (range [1..20]) 
-# that doxygen will group on one line in the generated HTML documentation.
-
-ENUM_VALUES_PER_LINE   = 4
-
-# If the GENERATE_TREEVIEW tag is set to YES, a side panel will be
-# generated containing a tree-like index structure (just like the one that 
-# is generated for HTML Help). For this to work a browser that supports 
-# JavaScript and frames is required (for instance Mozilla, Netscape 4.0+, 
-# or Internet explorer 4.0+). Note that for large projects the tree generation 
-# can take a very long time. In such cases it is better to disable this feature. 
-# Windows users are probably better off using the HTML help feature.
-
-GENERATE_TREEVIEW      = NO
-
-# If the treeview is enabled (see GENERATE_TREEVIEW) then this tag can be 
-# used to set the initial width (in pixels) of the frame in which the tree 
-# is shown.
-
-TREEVIEW_WIDTH         = 250
-
-#---------------------------------------------------------------------------
-# configuration options related to the LaTeX output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_LATEX tag is set to YES (the default) Doxygen will 
-# generate Latex output.
-
-GENERATE_LATEX         = YES
-
-# The LATEX_OUTPUT tag is used to specify where the LaTeX docs will be put. 
-# If a relative path is entered the value of OUTPUT_DIRECTORY will be 
-# put in front of it. If left blank `latex' will be used as the default path.
-
-LATEX_OUTPUT           = latex
-
-# The LATEX_CMD_NAME tag can be used to specify the LaTeX command name to be invoked. If left blank `latex' will be used as the default command name.
-
-LATEX_CMD_NAME         = latex
-
-# The MAKEINDEX_CMD_NAME tag can be used to specify the command name to 
-# generate index for LaTeX. If left blank `makeindex' will be used as the 
-# default command name.
-
-MAKEINDEX_CMD_NAME     = makeindex
-
-# If the COMPACT_LATEX tag is set to YES Doxygen generates more compact 
-# LaTeX documents. This may be useful for small projects and may help to 
-# save some trees in general.
-
-COMPACT_LATEX          = NO
-
-# The PAPER_TYPE tag can be used to set the paper type that is used 
-# by the printer. Possible values are: a4, a4wide, letter, legal and 
-# executive. If left blank a4wide will be used.
-
-PAPER_TYPE             = a4wide
-
-# The EXTRA_PACKAGES tag can be to specify one or more names of LaTeX 
-# packages that should be included in the LaTeX output.
-
-EXTRA_PACKAGES         = 
-
-# The LATEX_HEADER tag can be used to specify a personal LaTeX header for 
-# the generated latex document. The header should contain everything until 
-# the first chapter. If it is left blank doxygen will generate a 
-# standard header. Notice: only use this tag if you know what you are doing!
-
-LATEX_HEADER           = 
-
-# If the PDF_HYPERLINKS tag is set to YES, the LaTeX that is generated 
-# is prepared for conversion to pdf (using ps2pdf). The pdf file will 
-# contain links (just like the HTML output) instead of page references 
-# This makes the output suitable for online browsing using a pdf viewer.
-
-PDF_HYPERLINKS         = NO
-
-# If the USE_PDFLATEX tag is set to YES, pdflatex will be used instead of 
-# plain latex in the generated Makefile. Set this option to YES to get a 
-# higher quality PDF documentation.
-
-USE_PDFLATEX           = NO
-
-# If the LATEX_BATCHMODE tag is set to YES, doxygen will add the \\batchmode. 
-# command to the generated LaTeX files. This will instruct LaTeX to keep 
-# running if errors occur, instead of asking the user for help. 
-# This option is also used when generating formulas in HTML.
-
-LATEX_BATCHMODE        = NO
-
-#---------------------------------------------------------------------------
-# configuration options related to the RTF output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_RTF tag is set to YES Doxygen will generate RTF output 
-# The RTF output is optimised for Word 97 and may not look very pretty with 
-# other RTF readers or editors.
-
-GENERATE_RTF           = NO
-
-# The RTF_OUTPUT tag is used to specify where the RTF docs will be put. 
-# If a relative path is entered the value of OUTPUT_DIRECTORY will be 
-# put in front of it. If left blank `rtf' will be used as the default path.
-
-RTF_OUTPUT             = rtf
-
-# If the COMPACT_RTF tag is set to YES Doxygen generates more compact 
-# RTF documents. This may be useful for small projects and may help to 
-# save some trees in general.
-
-COMPACT_RTF            = NO
-
-# If the RTF_HYPERLINKS tag is set to YES, the RTF that is generated 
-# will contain hyperlink fields. The RTF file will 
-# contain links (just like the HTML output) instead of page references. 
-# This makes the output suitable for online browsing using WORD or other 
-# programs which support those fields. 
-# Note: wordpad (write) and others do not support links.
-
-RTF_HYPERLINKS         = NO
-
-# Load stylesheet definitions from file. Syntax is similar to doxygen's 
-# config file, i.e. a series of assigments. You only have to provide 
-# replacements, missing definitions are set to their default value.
-
-RTF_STYLESHEET_FILE    = 
-
-# Set optional variables used in the generation of an rtf document. 
-# Syntax is similar to doxygen's config file.
-
-RTF_EXTENSIONS_FILE    = 
-
-#---------------------------------------------------------------------------
-# configuration options related to the man page output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_MAN tag is set to YES (the default) Doxygen will 
-# generate man pages
-
-GENERATE_MAN           = NO
-
-# The MAN_OUTPUT tag is used to specify where the man pages will be put. 
-# If a relative path is entered the value of OUTPUT_DIRECTORY will be 
-# put in front of it. If left blank `man' will be used as the default path.
-
-MAN_OUTPUT             = man
-
-# The MAN_EXTENSION tag determines the extension that is added to 
-# the generated man pages (default is the subroutine's section .3)
-
-MAN_EXTENSION          = .3
-
-# If the MAN_LINKS tag is set to YES and Doxygen generates man output, 
-# then it will generate one additional man file for each entity 
-# documented in the real man page(s). These additional files 
-# only source the real man page, but without them the man command 
-# would be unable to find the correct page. The default is NO.
-
-MAN_LINKS              = NO
-
-#---------------------------------------------------------------------------
-# configuration options related to the XML output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_XML tag is set to YES Doxygen will 
-# generate an XML file that captures the structure of 
-# the code including all documentation. Note that this 
-# feature is still experimental and incomplete at the 
-# moment.
-
-GENERATE_XML           = NO
-
-#---------------------------------------------------------------------------
-# configuration options for the AutoGen Definitions output
-#---------------------------------------------------------------------------
-
-# If the GENERATE_AUTOGEN_DEF tag is set to YES Doxygen will 
-# generate an AutoGen Definitions (see autogen.sf.net) file 
-# that captures the structure of the code including all 
-# documentation. Note that this feature is still experimental 
-# and incomplete at the moment.
-
-GENERATE_AUTOGEN_DEF   = NO
-
-#---------------------------------------------------------------------------
-# Configuration options related to the preprocessor   
-#---------------------------------------------------------------------------
-
-# If the ENABLE_PREPROCESSING tag is set to YES (the default) Doxygen will 
-# evaluate all C-preprocessor directives found in the sources and include 
-# files.
-
-ENABLE_PREPROCESSING   = YES
-
-# If the MACRO_EXPANSION tag is set to YES Doxygen will expand all macro 
-# names in the source code. If set to NO (the default) only conditional 
-# compilation will be performed. Macro expansion can be done in a controlled 
-# way by setting EXPAND_ONLY_PREDEF to YES.
-
-MACRO_EXPANSION        = NO
-
-# If the EXPAND_ONLY_PREDEF and MACRO_EXPANSION tags are both set to YES 
-# then the macro expansion is limited to the macros specified with the 
-# PREDEFINED and EXPAND_AS_PREDEFINED tags.
-
-EXPAND_ONLY_PREDEF     = NO
-
-# If the SEARCH_INCLUDES tag is set to YES (the default) the includes files 
-# in the INCLUDE_PATH (see below) will be search if a #include is found.
-
-SEARCH_INCLUDES        = YES
-
-# The INCLUDE_PATH tag can be used to specify one or more directories that 
-# contain include files that are not input files but should be processed by 
-# the preprocessor.
-
-INCLUDE_PATH           = 
-
-# You can use the INCLUDE_FILE_PATTERNS tag to specify one or more wildcard 
-# patterns (like *.h and *.hpp) to filter out the header-files in the 
-# directories. If left blank, the patterns specified with FILE_PATTERNS will 
-# be used.
-
-INCLUDE_FILE_PATTERNS  = 
-
-# The PREDEFINED tag can be used to specify one or more macro names that 
-# are defined before the preprocessor is started (similar to the -D option of 
-# gcc). The argument of the tag is a list of macros of the form: name 
-# or name=definition (no spaces). If the definition and the = are 
-# omitted =1 is assumed.
-
-PREDEFINED             = 
-
-# If the MACRO_EXPANSION and EXPAND_PREDEF_ONLY tags are set to YES then 
-# this tag can be used to specify a list of macro names that should be expanded. 
-# The macro definition that is found in the sources will be used. 
-# Use the PREDEFINED tag if you want to use a different macro definition.
-
-EXPAND_AS_DEFINED      = 
-
-# If the SKIP_FUNCTION_MACROS tag is set to YES (the default) then 
-# doxygen's preprocessor will remove all function-like macros that are alone 
-# on a line and do not end with a semicolon. Such function macros are typically 
-# used for boiler-plate code, and will confuse the parser if not removed.
-
-SKIP_FUNCTION_MACROS   = YES
-
-#---------------------------------------------------------------------------
-# Configuration::addtions related to external references   
-#---------------------------------------------------------------------------
-
-# The TAGFILES tag can be used to specify one or more tagfiles.
-
-TAGFILES               = 
-
-# When a file name is specified after GENERATE_TAGFILE, doxygen will create 
-# a tag file that is based on the input files it reads.
-
-GENERATE_TAGFILE       = 
-
-# If the ALLEXTERNALS tag is set to YES all external classes will be listed 
-# in the class index. If set to NO only the inherited external classes 
-# will be listed.
-
-ALLEXTERNALS           = NO
-
-# If the EXTERNAL_GROUPS tag is set to YES all external groups will be listed 
-# in the modules index. If set to NO, only the current project's groups will 
-# be listed.
-
-EXTERNAL_GROUPS        = YES
-
-# The PERL_PATH should be the absolute path and name of the perl script 
-# interpreter (i.e. the result of `which perl').
-
-PERL_PATH              = /usr/bin/perl
-
-#---------------------------------------------------------------------------
-# Configuration options related to the dot tool   
-#---------------------------------------------------------------------------
-
-# If the CLASS_DIAGRAMS tag is set to YES (the default) Doxygen will 
-# generate a inheritance diagram (in Html, RTF and LaTeX) for classes with base or 
-# super classes. Setting the tag to NO turns the diagrams off. Note that this 
-# option is superceded by the HAVE_DOT option below. This is only a fallback. It is 
-# recommended to install and use dot, since it yield more powerful graphs.
-
-CLASS_DIAGRAMS         = YES
-
-# If set to YES, the inheritance and collaboration graphs will hide 
-# inheritance and usage relations if the target is undocumented 
-# or is not a class.
-
-HIDE_UNDOC_RELATIONS   = YES
-
-# If you set the HAVE_DOT tag to YES then doxygen will assume the dot tool is 
-# available from the path. This tool is part of Graphviz, a graph visualization 
-# toolkit from AT&T and Lucent Bell Labs. The other options in this section 
-# have no effect if this option is set to NO (the default)
-
-HAVE_DOT               = NO
-
-# If the CLASS_GRAPH and HAVE_DOT tags are set to YES then doxygen 
-# will generate a graph for each documented class showing the direct and 
-# indirect inheritance relations. Setting this tag to YES will force the 
-# the CLASS_DIAGRAMS tag to NO.
-
-CLASS_GRAPH            = YES
-
-# If the COLLABORATION_GRAPH and HAVE_DOT tags are set to YES then doxygen 
-# will generate a graph for each documented class showing the direct and 
-# indirect implementation dependencies (inheritance, containment, and 
-# class references variables) of the class with other documented classes.
-
-COLLABORATION_GRAPH    = YES
-
-# If set to YES, the inheritance and collaboration graphs will show the 
-# relations between templates and their instances.
-
-TEMPLATE_RELATIONS     = YES
-
-# If the ENABLE_PREPROCESSING, SEARCH_INCLUDES, INCLUDE_GRAPH, and HAVE_DOT 
-# tags are set to YES then doxygen will generate a graph for each documented 
-# file showing the direct and indirect include dependencies of the file with 
-# other documented files.
-
-INCLUDE_GRAPH          = YES
-
-# If the ENABLE_PREPROCESSING, SEARCH_INCLUDES, INCLUDED_BY_GRAPH, and 
-# HAVE_DOT tags are set to YES then doxygen will generate a graph for each 
-# documented header file showing the documented files that directly or 
-# indirectly include this file.
-
-INCLUDED_BY_GRAPH      = YES
-
-# If the GRAPHICAL_HIERARCHY and HAVE_DOT tags are set to YES then doxygen 
-# will graphical hierarchy of all classes instead of a textual one.
-
-GRAPHICAL_HIERARCHY    = YES
-
-# The DOT_IMAGE_FORMAT tag can be used to set the image format of the images 
-# generated by dot. Possible values are png, jpg, or gif
-# If left blank png will be used.
-
-DOT_IMAGE_FORMAT       = png
-
-# The tag DOT_PATH can be used to specify the path where the dot tool can be 
-# found. If left blank, it is assumed the dot tool can be found on the path.
-
-DOT_PATH               = 
-
-# The DOTFILE_DIRS tag can be used to specify one or more directories that 
-# contain dot files that are included in the documentation (see the 
-# \dotfile command).
-
-DOTFILE_DIRS           = 
-
-# The MAX_DOT_GRAPH_WIDTH tag can be used to set the maximum allowed width 
-# (in pixels) of the graphs generated by dot. If a graph becomes larger than 
-# this value, doxygen will try to truncate the graph, so that it fits within 
-# the specified constraint. Beware that most browsers cannot cope with very 
-# large images.
-
-MAX_DOT_GRAPH_WIDTH    = 1024
-
-# The MAX_DOT_GRAPH_HEIGHT tag can be used to set the maximum allows height 
-# (in pixels) of the graphs generated by dot. If a graph becomes larger than 
-# this value, doxygen will try to truncate the graph, so that it fits within 
-# the specified constraint. Beware that most browsers cannot cope with very 
-# large images.
-
-MAX_DOT_GRAPH_HEIGHT   = 1024
-
-# If the GENERATE_LEGEND tag is set to YES (the default) Doxygen will 
-# generate a legend page explaining the meaning of the various boxes and 
-# arrows in the dot generated graphs.
-
-GENERATE_LEGEND        = YES
-
-# If the DOT_CLEANUP tag is set to YES (the default) Doxygen will 
-# remove the intermedate dot files that are used to generate 
-# the various graphs.
-
-DOT_CLEANUP            = YES
-
-#---------------------------------------------------------------------------
-# Configuration::addtions related to the search engine   
-#---------------------------------------------------------------------------
-
-# The SEARCHENGINE tag specifies whether or not a search engine should be 
-# used. If set to NO the values of all tags below this one will be ignored.
-
-SEARCHENGINE           = NO
-
-# The CGI_NAME tag should be the name of the CGI script that 
-# starts the search engine (doxysearch) with the correct parameters. 
-# A script with this name will be generated by doxygen.
-
-CGI_NAME               = search.cgi
-
-# The CGI_URL tag should be the absolute URL to the directory where the 
-# cgi binaries are located. See the documentation of your http daemon for 
-# details.
-
-CGI_URL                = 
-
-# The DOC_URL tag should be the absolute URL to the directory where the 
-# documentation is located. If left blank the absolute path to the 
-# documentation, with file:// prepended to it, will be used.
-
-DOC_URL                = 
-
-# The DOC_ABSPATH tag should be the absolute path to the directory where the 
-# documentation is located. If left blank the directory on the local machine 
-# will be used.
-
-DOC_ABSPATH            = 
-
-# The BIN_ABSPATH tag must point to the directory where the doxysearch binary 
-# is installed.
-
-BIN_ABSPATH            = /usr/local/bin/
-
-# The EXT_DOC_PATHS tag can be used to specify one or more paths to 
-# documentation generated for other projects. This allows doxysearch to search 
-# the documentation for these projects as well.
-
-EXT_DOC_PATHS          = 

Deleted: trunk/src/enigma.doxygen.fulldoc
===================================================================
--- trunk/src/enigma.doxygen.fulldoc	2008-01-16 19:58:05 UTC (rev 986)
+++ trunk/src/enigma.doxygen.fulldoc	2008-01-16 20:52:30 UTC (rev 987)
@@ -1,191 +0,0 @@
-# Doxyfile 1.2.13-20020210
-
-#---------------------------------------------------------------------------
-# General configuration options
-#---------------------------------------------------------------------------
-PROJECT_NAME           = Enigma
-PROJECT_NUMBER         = 
-OUTPUT_DIRECTORY       = doc_full
-OUTPUT_LANGUAGE        = English
-EXTRACT_ALL            = YES
-EXTRACT_PRIVATE        = YES
-EXTRACT_STATIC         = YES
-EXTRACT_LOCAL_CLASSES  = YES
-HIDE_UNDOC_MEMBERS     = NO
-HIDE_UNDOC_CLASSES     = NO
-BRIEF_MEMBER_DESC      = YES
-REPEAT_BRIEF           = YES
-ALWAYS_DETAILED_SEC    = NO
-INLINE_INHERITED_MEMB  = NO
-FULL_PATH_NAMES        = NO
-STRIP_FROM_PATH        = 
-INTERNAL_DOCS          = YES
-STRIP_CODE_COMMENTS    = NO
-CASE_SENSE_NAMES       = YES
-SHORT_NAMES            = NO
-HIDE_SCOPE_NAMES       = NO
-VERBATIM_HEADERS       = YES
-SHOW_INCLUDE_FILES     = YES
-JAVADOC_AUTOBRIEF      = YES
-MULTILINE_CPP_IS_BRIEF = NO
-DETAILS_AT_TOP         = NO
-INHERIT_DOCS           = YES
-INLINE_INFO            = YES
-SORT_MEMBER_DOCS       = YES
-DISTRIBUTE_GROUP_DOC   = NO
-TAB_SIZE               = 8
-GENERATE_TODOLIST      = YES
-GENERATE_TESTLIST      = YES
-GENERATE_BUGLIST       = YES
-ALIASES                = 
-ENABLED_SECTIONS       = 
-MAX_INITIALIZER_LINES  = 30
-OPTIMIZE_OUTPUT_FOR_C  = NO
-OPTIMIZE_OUTPUT_JAVA   = NO
-SHOW_USED_FILES        = YES
-#---------------------------------------------------------------------------
-# configuration options related to warning and progress messages
-#---------------------------------------------------------------------------
-QUIET                  = NO
-WARNINGS               = YES
-WARN_IF_UNDOCUMENTED   = YES
-WARN_FORMAT            = "$file:$line: $text"
-WARN_LOGFILE           = 
-#---------------------------------------------------------------------------
-# configuration options related to the input files
-#---------------------------------------------------------------------------
-INPUT                  = ./ \
-                         ../lib-src/enigma-core/ \
-                         ../lib-src/oxydlib/
-FILE_PATTERNS          = *.cc \
-                         *.hh
-RECURSIVE              = YES
-EXCLUDE                = 
-EXCLUDE_SYMLINKS       = NO
-EXCLUDE_PATTERNS       = 
-EXAMPLE_PATH           = 
-EXAMPLE_PATTERNS       = 
-EXAMPLE_RECURSIVE      = NO
-IMAGE_PATH             = gfx
-INPUT_FILTER           = 
-FILTER_SOURCE_FILES    = NO
-#---------------------------------------------------------------------------
-# configuration options related to source browsing
-#---------------------------------------------------------------------------
-SOURCE_BROWSER         = YES
-INLINE_SOURCES         = NO
-REFERENCED_BY_RELATION = YES
-REFERENCES_RELATION    = YES
-#---------------------------------------------------------------------------
-# configuration options related to the alphabetical class index
-#---------------------------------------------------------------------------
-ALPHABETICAL_INDEX     = NO
-COLS_IN_ALPHA_INDEX    = 5
-IGNORE_PREFIX          = 
-#---------------------------------------------------------------------------
-# configuration options related to the HTML output
-#---------------------------------------------------------------------------
-GENERATE_HTML          = YES
-HTML_OUTPUT            = html
-HTML_FILE_EXTENSION    = .html
-HTML_HEADER            = 
-HTML_FOOTER            = 
-HTML_STYLESHEET        = 
-HTML_ALIGN_MEMBERS     = YES
-GENERATE_HTMLHELP      = NO
-CHM_FILE               = 
-HHC_LOCATION           = 
-GENERATE_CHI           = NO
-BINARY_TOC             = NO
-TOC_EXPAND             = NO
-DISABLE_INDEX          = NO
-ENUM_VALUES_PER_LINE   = 4
-GENERATE_TREEVIEW      = NO
-TREEVIEW_WIDTH         = 250
-#---------------------------------------------------------------------------
-# configuration options related to the LaTeX output
-#---------------------------------------------------------------------------
-GENERATE_LATEX         = NO
-LATEX_OUTPUT           = latex
-LATEX_CMD_NAME         = latex
-MAKEINDEX_CMD_NAME     = makeindex
-COMPACT_LATEX          = NO
-PAPER_TYPE             = a4wide
-EXTRA_PACKAGES         = 
-LATEX_HEADER           = 
-PDF_HYPERLINKS         = NO
-USE_PDFLATEX           = NO
-LATEX_BATCHMODE        = NO
-#---------------------------------------------------------------------------
-# configuration options related to the RTF output
-#---------------------------------------------------------------------------
-GENERATE_RTF           = NO
-RTF_OUTPUT             = rtf
-COMPACT_RTF            = NO
-RTF_HYPERLINKS         = NO
-RTF_STYLESHEET_FILE    = 
-RTF_EXTENSIONS_FILE    = 
-#---------------------------------------------------------------------------
-# configuration options related to the man page output
-#---------------------------------------------------------------------------
-GENERATE_MAN           = NO
-MAN_OUTPUT             = man
-MAN_EXTENSION          = .3
-MAN_LINKS              = NO
-#---------------------------------------------------------------------------
-# configuration options related to the XML output
-#---------------------------------------------------------------------------
-GENERATE_XML           = NO
-#---------------------------------------------------------------------------
-# configuration options for the AutoGen Definitions output
-#---------------------------------------------------------------------------
-GENERATE_AUTOGEN_DEF   = NO
-#---------------------------------------------------------------------------
-# Configuration options related to the preprocessor   
-#---------------------------------------------------------------------------
-ENABLE_PREPROCESSING   = YES
-MACRO_EXPANSION        = NO
-EXPAND_ONLY_PREDEF     = NO
-SEARCH_INCLUDES        = YES
-INCLUDE_PATH           = 
-INCLUDE_FILE_PATTERNS  = 
-PREDEFINED             = 
-EXPAND_AS_DEFINED      = 
-SKIP_FUNCTION_MACROS   = YES
-#---------------------------------------------------------------------------
-# Configuration::addtions related to external references   
-#---------------------------------------------------------------------------
-TAGFILES               = 
-GENERATE_TAGFILE       = 
-ALLEXTERNALS           = NO
-EXTERNAL_GROUPS        = YES
-PERL_PATH              = /usr/bin/perl
-#---------------------------------------------------------------------------
-# Configuration options related to the dot tool   
-#---------------------------------------------------------------------------
-CLASS_DIAGRAMS         = YES
-HIDE_UNDOC_RELATIONS   = YES
-HAVE_DOT               = YES
-CLASS_GRAPH            = YES
-COLLABORATION_GRAPH    = YES
-TEMPLATE_RELATIONS     = YES
-INCLUDE_GRAPH          = YES
-INCLUDED_BY_GRAPH      = YES
-GRAPHICAL_HIERARCHY    = YES
-DOT_IMAGE_FORMAT       = png
-DOT_PATH               = 
-DOTFILE_DIRS           = 
-MAX_DOT_GRAPH_WIDTH    = 1024
-MAX_DOT_GRAPH_HEIGHT   = 1024
-GENERATE_LEGEND        = YES
-DOT_CLEANUP            = YES
-#---------------------------------------------------------------------------
-# Configuration::addtions related to the search engine   
-#---------------------------------------------------------------------------
-SEARCHENGINE           = NO
-CGI_NAME               = search.cgi
-CGI_URL                = 
-DOC_URL                = 
-DOC_ABSPATH            = 
-BIN_ABSPATH            = /usr/local/bin/
-EXT_DOC_PATHS          = 



From andreasl at mail.berlios.de  Sat Jan 19 00:48:35 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Sat, 19 Jan 2008 00:48:35 +0100
Subject: [Enigma-game-svn] r988 - trunk/data/levels/lib
Message-ID: <200801182348.m0INmZME025111@sheep.berlios.de>

Author: andreasl
Date: 2008-01-19 00:48:34 +0100 (Sat, 19 Jan 2008)
New Revision: 988

Added:
   trunk/data/levels/lib/libluatools.xml
Modified:
   trunk/data/levels/lib/libsoko-designlist.xml
   trunk/data/levels/lib/libsoko-endphase.xml
   trunk/data/levels/lib/libsoko.xml
Log:
Trunk:
 - New library libluatools: Extracted and improved some
   functions from libsoko, as they are of general
   applicability:
    - deep_copy (incl. metatables)
    - combine_tables (now with vararg-syntax)
    - shuffle_table (now with standard algorithm)
    - manhattan_distance (both types of positions as input possible)
    - conditional (replacement for the "x?y:z"-operator)
 - Fixes to libsoko:
    - Used deep_copy for some level-structures.
    - Prepared knocking for transition to new API
       (1.0-knocking doesn't work in trunk currently).
    - All oxyds are being set with set_oxyd now.
    - Open/close-messages are only send when the target has
       correct _sokoarea-number.
    - Deactivated debug-messages.
    - Added maxdesignnumber as argument for create_sokoball.
    - Some general beautifications.


   
   
   

Added: trunk/data/levels/lib/libluatools.xml
===================================================================
--- trunk/data/levels/lib/libluatools.xml	2008-01-16 20:52:30 UTC (rev 987)
+++ trunk/data/levels/lib/libluatools.xml	2008-01-18 23:48:34 UTC (rev 988)
@@ -0,0 +1,128 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="library">
+      <el:identity el:title="" el:id="lib/libluatools"/>
+      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:author  el:name="Enigma Team" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2007 Enigma Team</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.00">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="false" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+---------------------------------------------------------------------
+-- libluatools holds some general utilities for working with Lua.
+-- It includes functions for deep-copying tables, combining tables,
+-- and shuffling tables, a function to calculate Manhattan
+-- distances and a wrapper for Lua's modulo-function, which has
+-- been renamed from math.mod to math.fmod.
+---------------------------------------------------------------------
+
+luatools = {}
+
+---------------------------------------------------------------------
+--  TABLE  HANDLING
+---------------------------------------------------------------------
+
+-- deep_copy returns a copy of SOURCE, where table entries are
+-- not copied as memory references, but complete ("deep copy").
+-- Metatables are transfered, but not deep-copied.
+function luatools.deep_copy(source)
+ if type(source) ~= "table" then
+   return source
+ end
+ local dest = {}
+ for k, v in pairs(source) do
+   if type(source[k]) == "table" then
+     dest[k] = luatools.deep_copy(source[k])
+   else
+     dest[k] = source[k]
+   end
+ end
+ setmetatable(dest, getmetatable(source))
+ return dest
+end 
+
+-- combine_tables returns a table consisting of all entries of the
+-- entries of OVER_TABLE: OVER_TABLE is a table of tables, say
+-- {T1, T2, T3, ...}. The result of combine_tables will be a new
+-- table with all entries of T1, T2, T3 etc., with the first table
+-- having highest priority etc.
+function luatools.combine_tables(arg1, ...)
+  local args = {arg1, ...}
+  if table.getn(args) == 1 then
+    args = arg1
+  end
+  if type(args) ~= "table" then
+    error("combine_tables: None or only one argument, and it's not a table!")
+  end
+  local result = {}
+  for j,t in pairs(args) do
+    if type(t) ~= "table" then
+      error("combine_tables: Main table does not consist of tables alone!")
+    end
+    for k,v in pairs(t) do
+      result[k] = result[k] or luatools.deep_copy(v)
+    end
+  end
+  return result
+end
+
+-- shuffle_table resorts the table T randomly. Note that only those entries
+-- of T can be sorted, that are indexed with integers from 1 to table.getn(T).
+function luatools.shuffle_table(t)
+  for n = table.getn(t), 1, -1 do
+    local m = math.random(n)
+    t[n], t[m] = t[m], t[n]
+  end
+end
+
+---------------------------------------------------------------------
+--  ADVANCED  POSITION  HANDLING  AND  CALCULATIONS
+---------------------------------------------------------------------
+
+-- manhattan_distance calculates the Manhattan-distance between
+-- (X1,Y1) and (X2, Y2), which is |X1 - X2| + |Y1 - Y2|.
+-- If X2 and Y2 are nil, X1 and Y1 are assumed to be positions
+-- instead of coordinates.
+function luatools.manhattan_distance(x1, y1, x2, y2)
+  if x1 and y1 and x2 and y2 then
+    -- x1, y1, x2, y2 are coordinates
+    return math.abs(x1 - x2) + math.abs(y1 - y2)
+  end
+  if x1 and y1 then
+    -- x1 and y1 are positions
+    return math.abs(x1.x - y1.x) + math.abs(x1.y - y1.y)
+  end
+  error("manhattan_distance: Too less arguments.")  
+end
+
+---------------------------------------------------------------------
+--  MATHEMATICAL  FUNCTIONS
+---------------------------------------------------------------------
+
+-- As Lua uses different names for the modulo-function in its
+-- versions, it's sometimes better to wrap them.
+luatools.mod = math.fmod or math.mod
+
+-- A wrapper of if to resemble the ternary ?:-function
+function luatools.conditional(condition, iftrue, iffalse)
+  if condition then
+    return iftrue
+  else
+    return iffalse
+  end
+end
+
+    ]]></el:luamain>
+    <el:i18n>
+    </el:i18n>
+  </el:protected>
+</el:level>
+

Modified: trunk/data/levels/lib/libsoko-designlist.xml
===================================================================
--- trunk/data/levels/lib/libsoko-designlist.xml	2008-01-16 20:52:30 UTC (rev 987)
+++ trunk/data/levels/lib/libsoko-designlist.xml	2008-01-18 23:48:34 UTC (rev 988)
@@ -4,7 +4,7 @@
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libsoko-designlist"/>
       <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
-      <el:author  el:name="Enigma Team" el:email="" el:homepage=""/>
+      <el:author el:name="Enigma Team" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
       <el:compatibility el:enigma="1.00">

Modified: trunk/data/levels/lib/libsoko-endphase.xml
===================================================================
--- trunk/data/levels/lib/libsoko-endphase.xml	2008-01-16 20:52:30 UTC (rev 987)
+++ trunk/data/levels/lib/libsoko-endphase.xml	2008-01-18 23:48:34 UTC (rev 988)
@@ -4,7 +4,7 @@
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libsoko-endphase"/>
       <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
-      <el:author  el:name="Enigma Team" el:email="" el:homepage=""/>
+      <el:author el:name="Enigma Team" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
       <el:compatibility el:enigma="1.00">
@@ -74,8 +74,8 @@
   -- ensure a correctly set endphase-attribute
   local endp = sokoarea[nr].design.endp
   if not endp then
-    endp = default_design.endp
-    sokoarea[nr].design.endp = endp
+    sokoarea[nr].design.endp = luatools.deep_copy(default_design.endp)
+    endp = sokoarea[nr].design.endp
   end
   if type(endp) ~= "table" then
     myerror("This design's endphase is given as "..type(endp)
@@ -83,8 +83,8 @@
   end
   local alg = endp.alg
   if alg == nil then
-    alg = default_design.endp.alg
-    sokoarea[nr].design.endp.alg = alg
+    sokoarea[nr].design.endp.alg = luatools.deep_copy(default_design.endp.alg)
+    alg = endp.alg
   end
   if type(alg) ~= "string" then
     myerror("This design's endphase algorithm is given as "..type(alg)
@@ -118,7 +118,7 @@
     endphase_set_outside_oxyds(nr, param)
   elseif (alg == "knock") then
     endphase_set_block_oxyds(nr, sokoarea[nr].design.door, 3)
-    endphase_set_knock_items(nr, param)
+    endphase_set_knocking(nr, param)
   -- "Jumpyoxyds" deactivated for once
   --elseif (alg == "jumpyoxyds") then
   --  endphase_set_block_oxyds(nr, "jumpy")
@@ -131,7 +131,7 @@
 function endphase(sokoarea_number)
   -- Correct structure of endp-attribute has been checked
   -- by prepare_endphase, we trust it blindly.
-  local endp = sokoarea[sokoarea_number].design.endp
+  local endp = luatools.deep_copy(sokoarea[sokoarea_number].design.endp)
   local alg = endp.alg
   local param = ""
   local px, py = enigma.GetPos(enigma.GetNamedObject("marble_"..sokoarea_number.."_1"))
@@ -150,7 +150,7 @@
 
   -- redraw level and give items
   endphase_redraw_level_array(sokoarea_number)
-  local give = endp.give
+  local give = luatools.deep_copy(endp.give)
   if type(give) == "string" then
     give = {give}
   end
@@ -210,7 +210,7 @@
 
 function endphase_redraw_level_array(sokoarea_number)
   local nr = sokoarea_number or 1
-  local endp = sokoarea[nr].design.endp
+  local endp = luatools.deep_copy(sokoarea[nr].design.endp)
   local dx = sokoarea[nr].offset.x
   local dy = sokoarea[nr].offset.y
 
@@ -278,17 +278,17 @@
     y = y - 2
   end
   for j = 0, 2 do
-    oxyd(x+j, y-1, flavor, 2*j)
-    oxyd(x-1, y+j, flavor, 2*j)
-    oxyd(x+j, y+3, flavor, 2*j+1)
-    oxyd(x+3, y+j, flavor, 2*j+1)
+    set_oxyd(sokoarea_number, {lx = x+j, ly = y-1}, flavor, 2*j)
+    set_oxyd(sokoarea_number, {lx = x-1, ly = y+j}, flavor, 2*j)
+    set_oxyd(sokoarea_number, {lx = x+j, ly = y+3}, flavor, 2*j+1)
+    set_oxyd(sokoarea_number, {lx = x+3, ly = y+j}, flavor, 2*j+1)
     for k = 0, 2 do
       kill_stone(x+j, y+k)
       kill_item(x+j, y+k)
       set_element(x+j, y+k, sokoarea_number, "inf")
     end
   end
-  set_stone("st-fart", x+1, y+1)
+  set_stone("st-fart", x+1, y+1, {_sokoarea = sokoarea_number})
   oxyd_shuffle()
 end
 
@@ -305,8 +305,10 @@
   local my = sokoarea[nr].array_height
   local flavor = sokoarea[nr].design.oxyd or "b"
 
-  for p, v in pairs(combine_tables({sokoarea[nr].list_outside,
-                                    sokoarea[nr].list_wall_two})) do
+  -- Select all places outside or in the walls, unreachable
+  -- for the marble.
+  for p, v in pairs(luatools.combine_tables(sokoarea[nr].list_outside,
+                sokoarea[nr].list_wall_two)) do
     if (mod(v.lx, 2) == 0) and (mod(v.ly, 2) == 0) then
       table.insert(places, v)
     end
@@ -335,11 +337,11 @@
     end    
   end
 
-  shuffle_table(places)
+  luatools.shuffle_table(places)
 
   for j = 1, number_pairs do
-    set_oxyd(sokoarea_number, places[2*j-1], flavor, j - 1)
-    set_oxyd(sokoarea_number, places[2*j], flavor, j - 1)
+    set_oxyd(sokoarea_number, luatools.deep_copy(places[2*j-1]), flavor, j - 1)
+    set_oxyd(sokoarea_number, luatools.deep_copy(places[2*j]), flavor, j - 1)
   end
   oxyd_shuffle()
 end
@@ -360,10 +362,10 @@
       -- and no other oxyd or blocker is near the new oxyd or its
       -- blocker.
       for j, w in pairs(oxyds) do
-        if    (manhattan_distance(w.blocker.lx, w.blocker.ly, x, y) <= 1)
-           or (manhattan_distance(w.lx, w.ly, x, y) <= 1)
-           or (manhattan_distance(w.blocker.lx, w.blocker.ly, x-dx, y-dy) <= 1)
-           or (manhattan_distance(w.lx, w.ly, x-dx, y-dy) <= 1) then
+        if    (luatools.manhattan_distance(w.blocker.lx, w.blocker.ly, x, y) <= 1)
+           or (luatools.manhattan_distance(w.lx, w.ly, x, y) <= 1)
+           or (luatools.manhattan_distance(w.blocker.lx, w.blocker.ly, x-dx, y-dy) <= 1)
+           or (luatools.manhattan_distance(w.lx, w.ly, x-dx, y-dy) <= 1) then
           return false
         end
       end
@@ -400,11 +402,11 @@
     end    
   end
 
-  shuffle_table(oxyds)
+  luatools.shuffle_table(oxyds)
 
   -- set oxyds and blockers
   local function set_block(w)
-    local myblocker = blocker
+    local myblocker = luatools.deep_copy(blocker)
     -- if there's an entry "st-door", choose between st-door-h and st-door-v.
     if type(myblocker) == "string" then
       myblocker = {myblocker}
@@ -421,11 +423,11 @@
     -- now set in-floor and blocker, and add to list_blocker.
     set_element(w.lx, w.ly, nr, "inf")
     set_element(w.lx, w.ly, nr, "", myblocker)
-    sokoarea[nr].list_blocker[(w.lx).."/"..(w.ly)] = w
+    sokoarea[nr].list_blocker[(w.lx).."/"..(w.ly)] = luatools.deep_copy(w)
   end
   for j = 1, number_pairs do   -- Testlevel: 14
-    set_oxyd(nr, oxyds[2*j-1], flavor, j - 1)
-    set_oxyd(nr, oxyds[2*j], flavor, j - 1)
+    set_oxyd(nr, luatools.deep_copy(oxyds[2*j-1]), flavor, j - 1)
+    set_oxyd(nr, luatools.deep_copy(oxyds[2*j]), flavor, j - 1)
     set_block(oxyds[2*j-1].blocker)
     set_block(oxyds[2*j].blocker)
   end
@@ -438,7 +440,7 @@
   for p, v in pairs(sokoarea[nr].list_goal) do
     table.insert(goal_table, v)
   end
-  shuffle_table(goal_table)
+  luatools.shuffle_table(goal_table)
   for j = 2, math.min(table.getn(goal_table), table.getn(oxyds)) do
     sokoarea[nr].goal_to_blocker[goal_table[j].goal_number] = oxyds[j].blocker
   end
@@ -455,7 +457,7 @@
     table.insert(places, v)
   end
 
-  shuffle_table(places)
+  luatools.shuffle_table(places)
   
   -- choose number of oxyds
   local max = table.getn(places)
@@ -504,7 +506,7 @@
     end
   end
 
-  shuffle_table(places)
+  luatools.shuffle_table(places)
 
   -- choose number of magnets
   local number_magnets = math.floor(table.getn(places)/6)
@@ -525,83 +527,90 @@
     table.insert(places, v)
   end
 
-  shuffle_table(places)
+  luatools.shuffle_table(places)
 
   -- choose number of fourswitchs/oxyds
   local max = table.getn(places)
   local number_pairs = 1
   if max < 2 then
     -- use circle instead
-    endphase_circle(sokoarea)
+    endphase_circle(sokoarea_number)
     return
   elseif max <  6  then  number_pairs = 2
   elseif max < 10  then  number_pairs = 3
   else                   number_pairs = 4 end
-
-  function endphase_call_fourswitch(onoff, sender)
-    local j = enigma.GetAttrib(sender, "_number")
-
-    -- When fourswitch is knocked, count it.
-    places[j].current = places[j].current + 1
-    if places[j].current == 5 then
-      places[j].current = 1
-    end
-    
-    -- When count is correct, make it "st-likeoxyda-open".
-    if places[j].current == places[j].solve then
-      places[j].correct = true
-      set_stone("st-likeoxyda-open", places[j].lx, places[j].ly,
-          {_number=0})
-    end
-
-    -- Now the difficult part: If it's the first fourswitch (the one
-    -- fourswitch that doesn't change any other), check all fourswitchs
-    -- and replace them by oxyds if all are correct. Else, recreate the
-    -- next fourswitch in hierarchy, set it to the old number, then
-    -- set the callback function and call it once by triggering another
-    -- time (making it show the new number). This means: Recursion!
-    if j ~= 1 then
-      -- Trigger all lower fourswitchs
-      local x = places[j-1].lx
-      local y = places[j-1].ly
-      if places[j-1].correct then
-        -- reset the fourswitch
-        mystone = set_stone("st-fourswitch", x, y, {_number = j - 1})
-        for k = 1, places[j-1].current do
-          SendMessage(mystone, "trigger")
-        end
-        enigma.SetAttrib(mystone, "action", "callback")
-        enigma.SetAttrib(mystone, "target", "endphase_call_fourswitch")
-        places[j-1].correct = false
-      end
-      SendMessage(enigma.GetStone(x, y), "trigger")
-    else
-      -- Check all fourswitchs
-      local correct = true
-      for k = 1, 2*number_pairs do
-        correct = correct and places[k].correct
-      end
-      if correct then
-        -- replace fourswitchs by oxyds
-        for k = 1, number_pairs do
-          set_oxyd(sokoarea_number, places[2*k-1], flavor, k - 1)
-          set_oxyd(sokoarea_number, places[2*k], flavor, k - 1)
-        end
-        oxyd_shuffle()
-      end
-    end  
-  end
   
   -- set fourswitchs
   for j = 1, 2*number_pairs do
     set_stone("st-fourswitch", places[j].lx, places[j].ly,
-        {action="callback", target="endphase_call_fourswitch", _number=j})
+        {action="callback", target="endphase_call_fourswitch", _number=j,
+         _sokoarea = sokoarea_number})
     places[j].current = 4
     places[j].solve = random(1,4)
     places[j].correct = false
   end
+  places.number_pairs = number_pairs
+  sokoarea[sokoarea_number].places = luatools.deep_copy(places)
 end
 
+function endphase_call_fourswitch(onoff, sender)
+  local j = enigma.GetAttrib(sender, "_number")
+  local nr = enigma.GetAttrib(sender, "_sokoarea")
+  local places = sokoarea[nr].places
+
+  -- When fourswitch is knocked, count it.
+  places[j].current = places[j].current + 1
+  if places[j].current == 5 then
+    places[j].current = 1
+  end
+  
+  -- When count is correct, make it "st-likeoxyda-open".
+  if places[j].current == places[j].solve then
+    places[j].correct = true
+    set_stone("st-likeoxyda-open", places[j].lx, places[j].ly,
+        {_number = 0, _sokoarea = sokoarea_number})
+  end
+
+  -- Now the difficult part: If it's the first fourswitch (the one
+  -- fourswitch that doesn't change any other), check all fourswitchs
+  -- and replace them by oxyds if all are correct. Else, recreate the
+  -- next fourswitch in hierarchy, set it to the old number, then
+  -- set the callback function and call it once by triggering another
+  -- time (making it show the new number). This means: Recursion!
+  if j ~= 1 then
+    -- Trigger all lower fourswitchs
+    local x = places[j-1].lx
+    local y = places[j-1].ly
+    if places[j-1].correct then
+      -- reset the fourswitch
+      mystone = set_stone("st-fourswitch", x, y,
+        {_number = j - 1, _sokoarea = sokoarea_number})
+      for k = 1, places[j-1].current do
+        SendMessage(mystone, "trigger")
+      end
+      enigma.SetAttrib(mystone, "action", "callback")
+      enigma.SetAttrib(mystone, "target", "endphase_call_fourswitch")
+      places[j-1].correct = false
+    end
+    SendMessage(enigma.GetStone(x, y), "trigger")
+  else
+    -- Check all fourswitchs
+    local correct = true
+    for k = 1, 2*places.number_pairs do
+      correct = correct and places[k].correct
+    end
+    if correct then
+      -- replace fourswitchs by oxyds
+      for k = 1, places.number_pairs do
+        set_oxyd(sokoarea_number, places[2*k-1], flavor, k - 1)
+        set_oxyd(sokoarea_number, places[2*k], flavor, k - 1)
+      end
+      oxyd_shuffle()
+    end
+  end  
+end
+
+
 function endphase_allcrack(sokoarea_number)
   for p, v in pairs(sokoarea[sokoarea_number].list_way) do
     if not enigma.GetItem(v.lx, v.ly) then
@@ -649,33 +658,22 @@
     local st = enigma.GetStone(x, y)
     local it = enigma.GetItem(x, y)
     local fl = enigma.GetFloor(x, y)
-    if open then
-      if st then
-        SendMessage(st, "open")
-      end
-      if it then
-        SendMessage(it, "open")
-      end
-      if fl then
-        SendMessage(fl, "close")
-      end
-    else
-      if st then
-        SendMessage(st, "close")
-      end
-      if it then
-        SendMessage(it, "close")
-      end
-      if fl then
-        SendMessage(fl, "open")
-      end
-    end      
+    if st and enigma.GetAttrib(st, "_sokoarea") then
+      SendMessage(st, luatools.conditional(open, "open", "close"))
+    end
+    if it and enigma.GetAttrib(it, "_sokoarea") then
+      SendMessage(it, luatools.conditional(open, "open", "close"))
+    end
+    if fl then
+      SendMessage(fl, luatools.conditional(open, "close", "open"))
+    end
   end  
 end
 
 function endphase_vortex(sokoarea_number)
   local nr = sokoarea_number or 1
-  local list_way = combine_tables({sokoarea[nr].list_way, sokoarea[nr].list_blocker})
+  local list_way = 
+    luatools.combine_tables(sokoarea[nr].list_way, sokoarea[nr].list_blocker)
   local components = 0
   local component = {}
 
@@ -700,7 +698,6 @@
     end
   end
   for p, v in pairs(list_way) do
-    --mydebug(v.lx.."/"..v.ly..": "..(list_way[p].component or "nil"))
     if (not list_way[p].component) and (not sokoarea[nr].list_goal[p]) then
       components = components + 1
       component[components] = {}
@@ -723,7 +720,7 @@
   for j = 1, components do
     sequence[j] = {nr = j}
   end
-  shuffle_table(sequence)
+  luatools.shuffle_table(sequence)
   local connect = {}
   for j = 1, components - 1 do
     connect[sequence[j].nr] = sequence[j+1].nr
@@ -742,7 +739,7 @@
   end  
 end
 
-function endphase_set_knock_items(sokoarea_number, param)
+function endphase_set_knocking(sokoarea_number, param)
   local flavor = sokoarea[sokoarea_number].design.oxyd or "b"
   local places = {}
   local itemkind = param
@@ -755,46 +752,52 @@
     table.insert(places, v)
   end
 
-  shuffle_table(places)
+  luatools.shuffle_table(places)
   
-  function endphase_call_knock_item(onoff, sender)
-    local j = enigma.GetAttrib(sender, "_number")
-    local nr = enigma.GetAttrib(sender, "_sokoarea")
-    if (not nr) or (not j) then
-      myerror("libsoko: Knock item has no number or no sokoarea.")
+  -- set items (for Enigma 1.0), set attributes of door (>= 1.1)
+  for j, v in pairs(places) do
+    set_item(itemkind, v.lx, v.ly, {action="callback",
+        target="endphase_call_knocking", _number=j, _sokoarea=sokoarea_number})
+    local st = enigma.GetStone(v.lx, v.ly)
+    if st then
+      enigma.SetAttrib(st, "action", "callback")
+      enigma.SetAttrib(st, "target", "endphase_call_knocking")
     end
-    mydebug("Knocked on "..j.."/"..sokoarea[nr].number_oxyds)
-    -- Deactivate the first door until endphase has started.
-    if (j == 1) and (not sokoarea[nr].endphase_started) then
-      return
-    end
-    -- Close the next door in the circle ...
-    j = j + 1
-    if j > sokoarea[nr].number_oxyds then
-      j = 1
-    end
-    local mydoor = enigma.GetStone(places[j].lx, places[j].ly)
-    if mydoor then
-      SendMessage(mydoor, "close")
-    end
-    -- ... and open the door after next.
-    j = j + 1
-    if j > sokoarea[nr].number_oxyds then
-      j = 1
-    end
-    mydoor = enigma.GetStone(places[j].lx, places[j].ly)
-    if mydoor then
-      SendMessage(mydoor, "open")
-    end
   end
+end
 
-  -- set items
-  for j, v in pairs(places) do
-    set_item(itemkind, v.lx, v.ly, {action="callback",
-        target="endphase_call_knock_item", _number=j, _sokoarea=sokoarea_number})
+function endphase_call_knocking(onoff, sender)
+  local j = enigma.GetAttrib(sender, "_number")
+  local nr = enigma.GetAttrib(sender, "_sokoarea")
+  if (not nr) or (not j) then
+    myerror("libsoko: Knocking's source has no number or no sokoarea.")
   end
+  mydebug("Knocked on "..j.."/"..sokoarea[nr].number_oxyds)
+  -- Deactivate the first door until endphase has started.
+  if (j == 1) and (not sokoarea[nr].endphase_started) then
+    return
+  end
+  -- Close the next door in the circle ...
+  j = j + 1
+  if j > sokoarea[nr].number_oxyds then
+    j = 1
+  end
+  local mydoor = enigma.GetStone(places[j].lx, places[j].ly)
+  if mydoor then
+    SendMessage(mydoor, "close")
+  end
+  -- ... and open the door after next.
+  j = j + 1
+  if j > sokoarea[nr].number_oxyds then
+    j = 1
+  end
+  mydoor = enigma.GetStone(places[j].lx, places[j].ly)
+  if mydoor then
+    SendMessage(mydoor, "open")
+  end
 end
 
+
     ]]></el:luamain>
     <el:i18n>
     </el:i18n>

Modified: trunk/data/levels/lib/libsoko.xml
===================================================================
--- trunk/data/levels/lib/libsoko.xml	2008-01-16 20:52:30 UTC (rev 987)
+++ trunk/data/levels/lib/libsoko.xml	2008-01-18 23:48:34 UTC (rev 988)
@@ -4,10 +4,11 @@
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libsoko"/>
       <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
-      <el:author  el:name="Enigma Team" el:email="" el:homepage=""/>
+      <el:author el:name="Enigma Team" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
       <el:compatibility el:enigma="1.00">
+        <el:dependency el:path="lib/libluatools" el:id="lib/libluatools" el:release="1" el:preload="true"/>
         <el:dependency el:path="lib/libsoko-designlist" el:id="lib/libsoko-designlist" el:release="1" el:preload="true"/>
         <el:dependency el:path="lib/libsoko-endphase" el:id="lib/libsoko-endphase" el:release="1" el:preload="true"/>
       </el:compatibility>
@@ -81,7 +82,7 @@
 ------------------------------------------------------------------------
 
 function mydebug(st)
-  print(st)
+  --print(st)
 end
 function mywarning(st)
   print(st)
@@ -105,42 +106,6 @@
 function char_is_outf(ch)   return string.find(ch, "[ ]")       == 1  end
 function char_is_inf(ch)    return not char_is_outf(ch)               end
 
--- combine_tables returns a table consisting of all entries of the
--- entries of OVER_TABLE: OVER_TABLE is a table of tables, say
--- {T1, T2, T3, ...}. The result of combine_tables will be a new
--- table with all entries of T1, T2, T3 etc., with the first table
--- having highest priority etc.
-function combine_tables(over_table)
-  if type(over_table) ~= "table" then
-    myerror("libsoko.combine_tables: Argument is no table!")
-  end
-  local result = {}
-  for j,t in pairs(over_table) do
-    if type(t) ~= "table" then
-      myerror("libsoko.combine_tables: Argument does not consist of tables alone!")
-    end
-    for k,v in pairs(t) do
-      result[k] = result[k] or v
-    end
-  end
-  return result
-end
-
--- shuffle_table resorts the table T randomly. Note that T has to be
--- indexed with integers from 1 to table.getn(T). Type is not checked.
-function shuffle_table(t)
-  for p, v in pairs(t) do
-    t[p].sort_field = math.random()
-  end
-  table.sort(t, function (a, b) return a.sort_field < b.sort_field end)
-end
-
--- manhattan_distance calculates the Manhattan-distance between
--- (X1,Y1) and (X2, Y2), which is |X1 - X2| + |Y1 - Y2|
-function manhattan_distance(x1, y1, x2, y2)
-  return math.abs(x1 - x2) + math.abs(y1 - y2)
-end
-
 -- choose_among_multiples selects a number between 1 and COUNT
 -- based on the coordinates X and Y and the algorithm's name ALG.
 function choose_among_multiples(x, y, count, alg)
@@ -158,7 +123,6 @@
 -- check_chess returns a boolean whether a chess stone is used
 -- in the sokoarea SOKOAREA_NUMBER.
 function check_chess(sokoarea_number)
-  mydebug(sokoarea[1].level_array[3][3])
   for y = 1, sokoarea[sokoarea_number].array_height do
     for x = 1, sokoarea[sokoarea_number].array_width do
       local ch = sokoarea[sokoarea_number].level_array[y][x]
@@ -173,7 +137,7 @@
 -- set_oxyd sets an oxyd with given flavor and color and adds
 -- the neccessary entry to list_oxyd.
 function set_oxyd(sokoarea_number, list_entry, flavor, color)
-  local entry = list_entry
+  local entry = luatools.deep_copy(list_entry)
   entry.flavor = flavor
   entry.color = color
   oxyd(entry.lx, entry.ly, flavor, color)
@@ -406,7 +370,7 @@
       if stkind == "st-none" then
         kill_stone(x, y)
       else
-        created_objects.st = set_stone(stkind, x, y)
+        created_objects.st = set_stone(stkind, x, y, {_sokoarea = sokoarea_number})
       end
     end
   end
@@ -856,20 +820,20 @@
 --  - a number specifying the number of the design in the design list
 --  - "nil" plus a level_array from which a design from the design
 --    list will be chosen.
-function design_from_description(design_description, level_array)
+function design_from_description(design_description, level_array, maxdesignnumber)
   -- choose design
   local design = {}
   if type(design_description) == "number" then
-    design = design_list[design_description]
+    design = luatools.deep_copy(design_list[design_description])
   elseif type(design_description) == "table" then
-    design = design_description
+    design = luatools.deep_copy(design_description)
   elseif (type(design_description) == "nil") and (type(level_array) == "table") then
-    design = design_from_level(level_array)
+    design = luatools.deep_copy(design_from_level(level_array, maxdesignnumber))
   else
     myerror("Can't make sense of design type "..type(design)..".")
   end
   -- fill chosen design with default values where neccessary
-  design = combine_tables({design, default_design})
+  design = luatools.combine_tables({design, default_design})
   -- No stone set for outf, not even "st-none"?
   -- Use the default outf-stone instead, and remove it on endphase.
   if type(design.outf) ~= "table" then
@@ -906,11 +870,12 @@
 -- design entries. A missing entry will be interpreted as the entry
 -- from default_design. If the DESIGN variable is omitted, a check-
 -- number is created from LEVEL which uniquely* determines a design
--- from the design list. *Uniquely means: The design might change
--- when the design list is enlarged.
+-- from the design list, with MAXDESIGNNUMBER as highest possible
+-- design number. *Uniquely means: The design might change when the
+-- design list is enlarged.
 -- Returns width and height of new level.
 --
-function create_sokoball(level, sublevel, design)
+function create_sokoball(level, sublevel, design, maxdesignnumber)
   -- check that this is the first sokoarea, and initialise it.
   if type(sokoarea) ~= "table" then
     myerror("No sense in sokoarea of type "..type(sokoarea)..".")
@@ -928,7 +893,6 @@
   --                 level_array[y-coordinate][x-coordinate]
   sokoarea[1].array_width = table.getn(sokoarea[1].level_array[1])
   sokoarea[1].array_height = table.getn(sokoarea[1].level_array)
-  mydebug(sokoarea[1].array_height.." : "..sokoarea[1].array_width)
   sokoarea[1].uses_chess = check_chess(1)
   local levelw = math.max(sokoarea[1].array_width, 20)
   local levelh = math.max(sokoarea[1].array_height, 13)
@@ -948,7 +912,8 @@
   sokoarea[1].offset = {x = dx, y = dy}
 
   -- calculate design
-  sokoarea[1].design = design_from_description(design, sokoarea[1].level_array)
+  sokoarea[1].design =
+    design_from_description(design, sokoarea[1].level_array, maxdesignnumber)
 
   -- create special position lists
   create_lists(nr)
@@ -978,10 +943,11 @@
 -- from scratch, but not the world and doesn't add another
 -- actor.
 --
-function recreate_sokoball(design, sokoarea_number)
-  local nr = sokoarea_number or 1  
+function recreate_sokoball(design, maxdesignnumber, sokoarea_number)
+  local nr = sokoarea_number or 1
+
   sokoarea[nr].design =
-      design_from_description(design, sokoarea[nr].level_array)
+      design_from_description(design, sokoarea[nr].level_array, maxdesignnumber)
 
   if sokoarea[nr].level_width and sokoarea[nr].level_height then
     for x = 0, sokoarea[nr].level_width - 1 do
@@ -1012,7 +978,15 @@
   sokoarea[nr].list_oxyd = {}
   sokoarea[nr].list_blocker = {}
   sokoarea[nr].number_oxyds = 0
-    
+  sokoarea[nr].goal_to_blocker = {}
+  sokoarea[nr].endphase_hook = endphase
+
+  --sokoarea[nr].list_outside = {}
+  --sokoarea[nr].list_wall = {}
+  --sokoarea[nr].list_way = {}
+  --sokoarea[nr].list_wall_one = {}
+  --sokoarea[nr].list_wall_two = {}
+
   draw_level_array(nr, true, false)
 
   -- prepare oxyds for end phase



From ral at mail.berlios.de  Sat Jan 19 22:03:10 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 19 Jan 2008 22:03:10 +0100
Subject: [Enigma-game-svn] r989 - in trunk/src: . stones
Message-ID: <200801192103.m0JL3A5Z030715@sheep.berlios.de>

Author: ral
Date: 2008-01-19 22:03:09 +0100 (Sat, 19 Jan 2008)
New Revision: 989

Modified:
   trunk/src/Object.cc
   trunk/src/Value.cc
   trunk/src/Value.hh
   trunk/src/items.cc
   trunk/src/lua.cc
   trunk/src/stones/BlockerStone.cc
   trunk/src/stones/BlockerStone.hh
   trunk/src/stones/FourSwitch.cc
   trunk/src/stones/OxydStone.cc
   trunk/src/world.cc
Log:
Trunk 1.1: Reengineering
- Value: prefer existing object name to id as reference for OBJECTs
- Value: fix a few forgotten special handlings for other types
- Fourswitch/Boulder react on second/falling _trigger instead of first
- Blocker: add "autoclose" attribute and feature - close on passing actors
- Blocker: add target/action, perform action on state change - react on
     passing bloulder
- Blocker: autoname all instances with internal names to avoid problems
     with lost id references due to it/st transformations.
- name Attribute: the key "name" can be omitted in object definitions like
  ti["x"] = {"st_boulder", orientation=SOUTH, "myboulder"}


Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2008-01-18 23:48:34 UTC (rev 988)
+++ trunk/src/Object.cc	2008-01-19 21:03:09 UTC (rev 989)
@@ -180,9 +180,10 @@
         if (Value v = getAttr("name")) {
             std::string name(v);
             UnnameObject(this);
-            if (Value v = target->getAttr("name")) {
-                target->warning("name '%s' overwritten by '%s'",
-                                v.to_string().c_str(), name.c_str());
+            if (Value old = target->getAttr("name")) {
+                std::string oldname(old);
+                if ( oldname.size() > 0 && oldname[0] != '$' && name.size() > 0 && name[0] != '$' )
+                    target->warning("name '%s' overwritten by '%s'", oldname.c_str(), name.c_str());
                 UnnameObject(target);
             }
             NameObject(target, name);
@@ -197,8 +198,10 @@
             // copy user attributes starting with "_" and
             // target and actions including their stated versions
             if ( it->first.find("_") == 0 || it->first.find("target") == 0
-                    || it->first.find("action") == 0)
+                    || it->first.find("action") == 0) {
                 target->set_attrib(it->first, it->second);
+//                Log << "Identity transfer key " << it->first << " - value " << it->second.to_string() << "\n";
+            }
         }
     }
     

Modified: trunk/src/Value.cc
===================================================================
--- trunk/src/Value.cc	2008-01-18 23:48:34 UTC (rev 988)
+++ trunk/src/Value.cc	2008-01-19 21:03:09 UTC (rev 989)
@@ -58,9 +58,15 @@
     }
     
     Value::Value(Object *obj) : type (OBJECT) {
-         if (obj != NULL)
-             val.dval[0] = obj->getId();
-         else
+        if (obj != NULL) {
+            Value v = obj->getAttr("name");
+            if (v && v.type == STRING && strcmp(v.val.str, "") != 0) {
+                val.str = new char[strlen(v.val.str)+1];
+                strcpy(val.str, v.val.str);
+                type = NAMEDOBJECT;
+            } else
+                val.dval[0] = obj->getId();
+        } else
              val.dval[0] = 0;
     }
     
@@ -82,7 +88,7 @@
         }
         val.str =  new char[descriptor.size() + 1];
         strcpy(val.str, descriptor.c_str());
-    //    Log << "Value ObjectList '" << descriptor << "'\n";
+//        Log << "Value ObjectList '" << descriptor << "'\n";
     }
     
     Value::Value(TokenList aList) : type (TOKENS) {
@@ -91,6 +97,7 @@
         for (it = aList.begin(); it != aList.end(); ++it) {
             switch ((*it).type) {
                 case STRING :
+                case NAMEDOBJECT :
                     ASSERT((*it).val.str[0] != 0, XLevelRuntime, "TokenList: illegal empty string value");                
                     descriptor.append((*it).val.str);
                     break;
@@ -110,7 +117,7 @@
         val.str =  new char[descriptor.size() + 1];
         strcpy(val.str, descriptor.c_str());
      
-    //    Log << "Value TokenList '" << descriptor << "'\n";
+//        Log << "Value TokenList '" << descriptor << "'\n";
     }
     
     Value::Value(ecl::V2 pos) : type (POSITION) {
@@ -143,6 +150,10 @@
             case OBJECT :
                 val.dval[0] = (double) NULL;
                 break;
+            case NAMEDOBJECT:
+                ASSERT(false, XLevelRuntime, "Value: illegal type usage");
+                break;
+            default:;
         }
     }
     
@@ -170,6 +181,14 @@
                     assign(other.val.str);
                     type = GROUP;
                     break;
+                case TOKENS:
+                    assign(other.val.str);
+                    type = TOKENS;
+                    break;
+                case NAMEDOBJECT:
+                    assign(other.val.str);
+                    type = NAMEDOBJECT;
+                    break;
                 default:
                     clear();
                     type = other.type;
@@ -191,6 +210,7 @@
                 case STRING :
                 case GROUP :
                 case TOKENS :
+                case NAMEDOBJECT :
                     return strcmp(val.str, other.val.str) == 0;
                 case POSITION :
                     return (val.dval[0] == other.val.dval[0]) && (val.dval[1] == other.val.dval[1]);
@@ -254,6 +274,7 @@
         switch (type) {
             case OBJECT:
                 return Object::getObject(round_nearest<int>(val.dval[0]));
+            case NAMEDOBJECT:
             case STRING:
                 return GetNamedObject(val.str);            
             default: 
@@ -271,6 +292,7 @@
                     break;
                 }
                 // else it is a single object name - fall through
+            case NAMEDOBJECT:
             case OBJECT:
                 result.push_back(*this);
                 break;
@@ -295,6 +317,7 @@
         TokenList result;
         switch (type) {
             case OBJECT:
+            case NAMEDOBJECT:
             case STRING:
             case GROUP:
                 result.push_back(*this);
@@ -375,7 +398,9 @@
     void Value::clear() {
         switch (type) {
             case STRING:
+            case NAMEDOBJECT:
             case GROUP:
+            case TOKENS:
                delete[] val.str;
                break;
         }
@@ -383,7 +408,13 @@
     }
     
     Value::Type Value::getType() const {
-        return type;
+        switch (type) {
+            case NAMEDOBJECT :
+                return OBJECT;
+                break;
+            default:
+                return type;
+        }
     }
     
     double Value::get_double() const throw(){

Modified: trunk/src/Value.hh
===================================================================
--- trunk/src/Value.hh	2008-01-18 23:48:34 UTC (rev 988)
+++ trunk/src/Value.hh	2008-01-19 21:03:09 UTC (rev 989)
@@ -93,7 +93,8 @@
                       ///< identifier.
             GROUP,    ///< Value is a group of objects.
             POSITION, ///< Value is a position
-            TOKENS    ///< Value is a list of token values
+            TOKENS,   ///< Value is a list of token values
+            NAMEDOBJECT  ///< internal Value type for named objects - public type is OBJECT
         };
 
         Value();                       ///< Constructor for NIL value that 

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-01-18 23:48:34 UTC (rev 988)
+++ trunk/src/items.cc	2008-01-19 21:03:09 UTC (rev 989)
@@ -2644,7 +2644,6 @@
      * A BlockerItem can be killed by a BrakeItem being dropped.
      */
     class BlockerItem : public Item, public TimeHandler {
-        CLONEOBJ(BlockerItem);
         DECL_TRAITS;
     private:
         enum iState {
@@ -2665,6 +2664,8 @@
         ~BlockerItem();
 
         // Object interface
+        virtual BlockerItem *clone();
+        virtual void dispose();
         virtual Value message(const Message &m);
 
         // StateObject interface
@@ -2676,6 +2677,7 @@
         virtual void on_creation(GridPos p);
         virtual void on_removal(GridPos p);
         virtual void init_model();
+        virtual void actor_leave(Actor *a);
 
         // Item interface
         virtual void stone_change(Stone *st);
@@ -2699,6 +2701,16 @@
         GameTimer.remove_alarm (this);
     }
 
+    BlockerItem * BlockerItem::clone() {
+        BlockerItem * dup = new BlockerItem(*this);
+        NameObject(dup, "$BlockerItem#");  // auto name object to avoid problems with object values
+        return dup;
+    }
+    
+    void BlockerItem::dispose() {
+        delete this;
+    }
+
     Value BlockerItem::message(const Message &m) {
         if (m.message == "_init") { 
             if (Stone *st = GetStone(get_pos())) {
@@ -2709,6 +2721,9 @@
                         setIState(LOCKED);
             }
             return Item::message(m);    // pass on init message
+        } else if (m.message =="_performaction") {
+            performAction(true);
+            return Value();
         }
         return Item::message(m);
     }
@@ -2762,6 +2777,14 @@
         set_model("it-blocker");
     }
     
+    void BlockerItem::actor_leave(Actor *a) {
+        if (Value v = getAttr("autoclose")) {
+            if (v.to_bool()) {
+                setState(0);     // close
+            }
+        }
+    }
+    
     void BlockerItem::stone_change(Stone *st) {
         if (st != NULL) {
             if (st->is_kind("st_boulder")) { // boulder arrived
@@ -2821,6 +2844,9 @@
         Stone *st = MakeStone("st_blocker_new");
         SetStone(get_pos(), st);
         transferIdentity(st);
+        if (Value v = getAttr("autoclose"))
+            st->set_attrib("autoclose", v); 
+        SendMessage(st, "_performaction");
         kill();
     }
 

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-01-18 23:48:34 UTC (rev 988)
+++ trunk/src/lua.cc	2008-01-19 21:03:09 UTC (rev 989)
@@ -1080,6 +1080,9 @@
             } else {
                 obj->set_attrib(key, to_value(L, -2));
             }
+         } else if (lua_tointeger(L, -1) == 2) {  // second entry without a string key is taken as name
+             if (lua_isstring(L, -2))
+                 NameObject(obj, lua_tostring(L, -2));
          }
          lua_pop(L, 2);  // remove copy key + value, leave original key for loop
     }    
@@ -1088,6 +1091,12 @@
 static int setAttributes(lua_State *L) {
     // 
     Object *obj = to_object(L, 1);
+    lua_rawgeti(L, -1, 1);  // check if any unnamed attribute exists
+    if (!lua_isnil(L, -1)) {
+        throwLuaError(L, "Set attribute: encountered attribute without key name");
+        return 0;
+    }
+    lua_pop(L, 1);  // remove unnamed attribute or nil
     setObjectAttributes(obj, L);
     return 0;
 }
@@ -1684,13 +1693,13 @@
         name = name.substr(1);
     }
     
-    if (name == "fl-nil") {
+    if (name == "fl_nil") {
         KillFloor(GridPos(xi, yi));
         return 0;
-    } else if (name == "st-nil") {
+    } else if (name == "st_nil") {
         KillStone(GridPos(xi, yi));
         return 0;
-    } else if (name == "it-nil") {
+    } else if (name == "it_nil") {
         KillItem(GridPos(xi, yi));
         return 0;
     }

Modified: trunk/src/stones/BlockerStone.cc
===================================================================
--- trunk/src/stones/BlockerStone.cc	2008-01-18 23:48:34 UTC (rev 988)
+++ trunk/src/stones/BlockerStone.cc	2008-01-19 21:03:09 UTC (rev 989)
@@ -29,10 +29,23 @@
         state = solid ? SOLID : GROWING; 
     }
 
+    BlockerStone * BlockerStone::clone() {
+        BlockerStone * dup = new BlockerStone(*this);
+        NameObject(dup, "$BlockerStone#");  // auto name object to avoid problems with object values
+        return dup;
+    }
+    
+    void BlockerStone::dispose() {
+        delete this;
+    }
+
     Value BlockerStone::message(const Message &m) {
         if (m.message == "_trigger") {
             setIState(SHRINKING);    // same as "open" -- no toggle to avoid race condition of boulders
             return Value();
+        } else if (m.message =="_performaction") {
+            performAction(false);
+            return Value();
         }
         return Stone::message(m);
     }
@@ -80,6 +93,9 @@
                 Item *it = MakeItem("it_blocker_new");
                 SetItem(get_pos(), it);
                 transferIdentity(it);
+                if (Value v = getAttr("autoclose"))
+                    it->set_attrib("autoclose", v); 
+                SendMessage(it, "_performaction");
                 KillStone(get_pos());
                 break;
             }
@@ -98,8 +114,9 @@
     }
 
     void BlockerStone::actor_contact(Actor *a) {
-        if ((state == GROWING && server::GameCompatibility != GAMET_PEROXYD) ||
-                (state == SOLID && server::GameCompatibility == GAMET_PEROXYD)) {
+        if (!(getDefaultedAttr("autoclose", false).to_bool()) && (
+                (state == GROWING && server::GameCompatibility != GAMET_PEROXYD) ||
+                (state == SOLID && server::GameCompatibility == GAMET_PEROXYD))) {
             SendMessage(a, "shatter");
         }
     }

Modified: trunk/src/stones/BlockerStone.hh
===================================================================
--- trunk/src/stones/BlockerStone.hh	2008-01-18 23:48:34 UTC (rev 988)
+++ trunk/src/stones/BlockerStone.hh	2008-01-19 21:03:09 UTC (rev 989)
@@ -37,7 +37,6 @@
      * TODO animation slowed down by a major factor for PerOxyd compatibility
      */
     class BlockerStone : public Stone {
-        CLONEOBJ(BlockerStone);
         DECL_TRAITS;
     private:
         enum iState {
@@ -49,6 +48,8 @@
         BlockerStone(bool solid);
         
         // Object interface
+        virtual BlockerStone *clone();
+        virtual void dispose();
         virtual Value message(const Message &m);
         
         // StateObject interface
@@ -64,10 +65,8 @@
         
         // Stone interface
         virtual StoneResponse collision_response(const StoneContact &sc);
-//        virtual void actor_hit(const StoneContact &sc);
-        virtual void actor_contact (Actor * a);
-        virtual void actor_inside (Actor * a);
-//        virtual const char *collision_sound();
+        virtual void actor_contact(Actor * a);
+        virtual void actor_inside(Actor * a);
         
     private:
         void setIState(iState newState);

Modified: trunk/src/stones/FourSwitch.cc
===================================================================
--- trunk/src/stones/FourSwitch.cc	2008-01-18 23:48:34 UTC (rev 988)
+++ trunk/src/stones/FourSwitch.cc	2008-01-19 21:03:09 UTC (rev 989)
@@ -28,11 +28,15 @@
     }
     
     Value FourSwitch::message(const Message &m) {
-        if (m.message == "signal" || m.message == "_trigger") {
+        if (m.message == "signal") {
             if ((((int)(m.value)) % 2 == 1) || (server::GameCompatibility == enigma::GAMET_ENIGMA
                     && (server::EnigmaCompatibility < 1.10))) // Enigma 1.00 did turn on 0, too
                 turn();
             return Value();
+        } else if (m.message == "_trigger") {
+            if (m.value.to_bool() == false)
+                turn();
+            return Value();
         }
         return Stone::message(m);
     }

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-01-18 23:48:34 UTC (rev 988)
+++ trunk/src/stones/OxydStone.cc	2008-01-19 21:03:09 UTC (rev 989)
@@ -863,7 +863,7 @@
             shuffleColors();
             return Value();
         }
-        else if (m.message == "_trigger" || m.message == "toggle"|| m.message == "spitter") {
+        else if ((m.message == "_trigger"  && m.value.to_bool())|| m.message == "toggle"|| m.message == "spitter") {
             tryOpen();
             return Value();
         }

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-01-18 23:48:34 UTC (rev 988)
+++ trunk/src/world.cc	2008-01-19 21:03:09 UTC (rev 989)
@@ -364,7 +364,7 @@
     ASSERT(obj, XLevelRuntime, "unname: no object given");
     if (Value v = obj->getAttr("name")) {
         m_objnames.remove(v.to_string());
-        obj->set_attrib("name", "");
+        obj->set_attrib("name", "");   // TODO alist.hh add delete op
     }
 }
 
@@ -1612,11 +1612,11 @@
 
 void NameObject(Object *obj, const std::string &name)
 {
-    string old_name;
+    string oldname;
     if (Value v = obj->getAttr("name")) {
-        old_name = v.to_string();
-        obj->warning("name '%s' overwritten by '%s'",
-                     old_name.c_str(), name.c_str());
+        oldname = v.to_string();
+        if ( oldname.size() > 0 && oldname[0] != '$' && name.size() > 0 && name[0] != '$' )
+            obj->warning("name '%s' overwritten by '%s'", oldname.c_str(), name.c_str());
         UnnameObject(obj);
     }
     level->name_object (obj, name);



From ral at mail.berlios.de  Sun Jan 20 00:24:27 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 20 Jan 2008 00:24:27 +0100
Subject: [Enigma-game-svn] r990 - / team_levelpacks
	team_levelpacks/team_test_new_api
Message-ID: <200801192324.m0JNORAl011750@sheep.berlios.de>

Author: ral
Date: 2008-01-20 00:24:26 +0100 (Sun, 20 Jan 2008)
New Revision: 990

Added:
   team_levelpacks/
   team_levelpacks/team_test_new_api/
   team_levelpacks/team_test_new_api/ralT026_1.xml
   team_levelpacks/team_test_new_api/ralT027_1.xml
Log:
Add team development test levelpack svn directories

Added: team_levelpacks/team_test_new_api/ralT026_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT026_1.xml	2008-01-19 21:03:09 UTC (rev 989)
+++ team_levelpacks/team_test_new_api/ralT026_1.xml	2008-01-19 23:24:26 UTC (rev 990)
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Horse new API" el:subtitle="" el:id="20080116ral551"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 46 $" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2006 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["1"] = {"fl-rock", name="d1"}
+ti["2"] = {"fl-rock", name="d2"}
+ti["3"] = {"fl-rock", name="d3"}
+ti["4"] = {"fl-rock", name="d4"}
+ti["5"] = {"fl-rock", name="d5"}
+ti["6"] = {"fl-rock", name="d6"}
+ti["h"] = ti[" "] .. {"ac-horse", name="horse", destination={"d1","d2","d3","d4","d5","d6"}}
+ti["i"] = {"fl-rock", name="i1"}
+ti["j"] = {"fl-rock", name="i2"}
+ti["k"] = {"fl-rock", name="i3"}
+ti["l"] = {"fl-rock", name="i4"}
+ti["s"] = ti[" "] .. {"st_switch", target="innercircle"}
+
+
+ti["a"] = ti[" "] .. {"#ac-blackball"}
+
+w, h = wo(ti, " ", {
+"                    ",
+"                    ",
+"     6        1     ",
+"                    ",
+"       i    l       ",
+"                    ",
+" 5       sh      2  ",
+"         a          ",
+"                    ",
+"       j    k       ",
+"                    ",
+"     4        3     ",
+"                    "
+})
+
+function innercircle(value, sender)
+    -- demo mixture string tokens with a group
+    circle = grp(no["i1"],no["i2"],no["i3"],no["i4"])
+    horse = no["horse"]
+    dest = horse["destination"]
+    if value then
+        table.insert(dest, circle)
+    else
+        dest[#dest]=nil
+    end
+    horse["destination"] = dest
+end
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT026_1.xml
___________________________________________________________________
Name: svn:executable
   + 
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralT027_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT027_1.xml	2008-01-19 21:03:09 UTC (rev 989)
+++ team_levelpacks/team_test_new_api/ralT027_1.xml	2008-01-19 23:24:26 UTC (rev 990)
@@ -0,0 +1,71 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Blocker new API" el:subtitle="" el:id="20080118ral328"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 46 $" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2006 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["b"] = ti[" "] .. {"it_blocker"}
+ti["n"] = ti[" "] .. {"it_blocker_new"}
+ti["B"] = ti[" "] .. {"st_blocker"}
+ti["N"] = ti[" "] .. {"st_blocker_new"}
+
+ti["W"] = ti[" "] .. {"st_boulder_w"}
+ti["w"] = ti["n"] .. {"st_boulder_w"}
+ti["v"] = ti["b"] .. {"st_boulder_w"}
+ti["E"] = ti[" "] .. {"st_boulder_e"}
+
+ti["a"] = ti[" "] .. {"it_blocker", autoclose=true}
+ti["A"] = ti[" "] .. {"st_blocker", target="laser", action="onoff"}
+ti["L"] = ti[" "] .. {"st-laser-s", "laser"}
+
+ti["S"] = ti[" "] .. {"st_switch", target="blocker"}
+ti["s"] = ti[" "] .. {"it_blocker", "blocker"}
+ti["H"] = ti[" "] .. {"st-wood"}
+
+
+
+ti["1"] = (ti[" "] .. {"#ac-blackball"}) .. {"it-magicwand"}
+
+w, h = wo(ti, " ", {
+"                    ",
+"    BBBBnwbbbbb     ",
+"    bbbbbvNBBBB     ",
+"                    ",
+"                    ",
+"                    ",
+"        Ss         E",
+"         H          ",
+"           1        ",
+"                    ",
+"                    ",
+"L                   ",
+"     A       a     E"
+})
+
+
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT027_1.xml
___________________________________________________________________
Name: svn:executable
   + 
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Sun Jan 20 00:28:53 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 20 Jan 2008 00:28:53 +0100
Subject: [Enigma-game-svn] r991 - trunk/src/lev
Message-ID: <200801192328.m0JNSr1p012909@sheep.berlios.de>

Author: ral
Date: 2008-01-20 00:28:52 +0100 (Sun, 20 Jan 2008)
New Revision: 991

Modified:
   trunk/src/lev/PersistentIndex.cc
Log:
Trunk 1.1: 
- first hardcoded support for team development levelpack "test_new_api"


Modified: trunk/src/lev/PersistentIndex.cc
===================================================================
--- trunk/src/lev/PersistentIndex.cc	2008-01-19 23:24:26 UTC (rev 990)
+++ trunk/src/lev/PersistentIndex.cc	2008-01-19 23:28:52 UTC (rev 991)
@@ -216,6 +216,36 @@
         delete dirIter;
         Index::registerIndex(autoIndex);
         
+        // register team auto not yet registered new files
+        PersistentIndex * teamautoIndex = NULL;
+        dirIter = DirIter::instance(app.userPath + "/levels/team_test_new_api");
+        while (dirIter->get_next(dirEntry)) { 
+            if( !dirEntry.is_dir) {
+                if (dirEntry.name.size() > 4 && (
+                        (dirEntry.name.rfind(".xml") == dirEntry.name.size() - 4) ||
+                        (dirEntry.name.rfind(".lua") == dirEntry.name.size() - 4))) {
+                    if (teamautoIndex == NULL) {
+                        teamautoIndex = new PersistentIndex("team_test_new_api", false, 
+                                75000, "test_new_api");
+                        teamautoIndex->isEditable = false;
+                    }
+                    Proxy * newProxy = Proxy::autoRegisterLevel("team_test_new_api", 
+                            dirEntry.name.substr(0, dirEntry.name.size() - 4));
+                    if (newProxy != NULL) {
+                        // first check that the proxy is not in the index
+                        //  - may occur if the level is stored as .xml and .lua in the folder
+                        if (!teamautoIndex->containsProxy(newProxy)) {
+                            // it is new, add it
+                            teamautoIndex->appendProxy(newProxy);
+                        }
+                    }
+                }
+            }
+        }
+        delete dirIter;
+        if (teamautoIndex != NULL)
+            Index::registerIndex(teamautoIndex);
+        
         // check if history is available - else generate a new index
         Index * foundHistory = Index::findIndex("History");
         if ( foundHistory != NULL) {



From ral at mail.berlios.de  Sun Jan 20 12:51:34 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 20 Jan 2008 12:51:34 +0100
Subject: [Enigma-game-svn] r992 - team_levelpacks/team_test_new_api
Message-ID: <200801201151.m0KBpYQs004269@sheep.berlios.de>

Author: ral
Date: 2008-01-20 12:51:33 +0100 (Sun, 20 Jan 2008)
New Revision: 992

Added:
   team_levelpacks/team_test_new_api/ralT014_1.xml
   team_levelpacks/team_test_new_api/ralT016_1.xml
   team_levelpacks/team_test_new_api/ralT017_1.xml
   team_levelpacks/team_test_new_api/ralT018_1.xml
   team_levelpacks/team_test_new_api/ralT019_1.xml
   team_levelpacks/team_test_new_api/ralT021_1.xml
   team_levelpacks/team_test_new_api/ralT025_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT026_1.xml
   team_levelpacks/team_test_new_api/ralT027_1.xml
Log:
Test Levels:
- added some more new API test levels
- fixed svn property: added keyword Revision

Added: team_levelpacks/team_test_new_api/ralT014_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT014_1.xml	2008-01-19 23:28:52 UTC (rev 991)
+++ team_levelpacks/team_test_new_api/ralT014_1.xml	2008-01-20 11:51:33 UTC (rev 992)
@@ -0,0 +1,129 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test New API" el:subtitle="" el:id="200709021ral604"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2007 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+wo["ConserveLevel"] = true
+wo["ShowMoves"] = false
+
+
+ti[" "] = {"fl-sahara"}
+ti["."] = ti({"fl-rough-blue", checkerboard=0}) .. {"fl-rough-red", checkerboard=1}
+ti["c"] = ti[" "] .. {"it-cherry", name="cherry#"}
+ti["5"] = ti[" "] .. {"it-coin2", name="money", target={"otto", "emil*"}}
+ti["S"] = ti[" "] .. {"st-coinslot"}
+ti["m"] = ti[" "] .. {"#ac-blackball"}
+ti["x"] = {"fl-rough-blue"} .. {"it-banana"} .. ti({"ac-bug", 0.7})
+ti["y"] = (ti({"fl-rough-blue"}) .. {"it-banana"}) .. {"ac-bug", name="buggy"}
+ti["s"] = ti[" "] .. {"st_switch", action="callback", target="doit"}
+ti["b"] = ti[" "] .. {"st_blocker", name="blocker"}
+ti["d"] = ti[" "] .. {"st-door_b", name="door#"}
+ti["h"] = ti[" "] .. {"st-chess_black", name="chess#"}
+ti["o"] = ti[" "] .. {"st-oxyd"}
+ti["B"] = ti[" "] .. {"it-bag"}
+ti["T"] = ti[" "] .. {"st-thief"}
+ti["t"] = {"fl-thief"}
+
+w, h = wo(ti, " ", {
+"                    ",
+"         ",                  -- oops a line too short
+"  m          5    BB",
+"                    ",
+"  c          S    d ",
+"  c     x         d ",
+"  c         h     d ",
+"  c         h     d ",
+"t           h       ",
+"   y                ",
+"T          s ..  b  ",
+"             ....   ",
+"o o o      ........."
+})
+
+wo[{w-2, h-2}] = {"it-magicwand"}
+p1 = po(12.3, 3.2)
+p2 = p1:grid()
+wo[p2] = {"ac-bug"}
+
+no["money"]:set({value=12})
+no["money"]["action"] = {"anna#*","x",no["cherry#*"],no["blocker"]}
+
+tokens = no["money"]["action"]
+
+if (tokens[4] == no["blocker"]) then
+    wo[{1, 1}] = {"it-magicwand"}
+end
+--tokens[3]:kill()
+wo[tokens[3]] = {"fl-rough-blue"}
+
+blocker_pos = po(no["blocker"])
+
+
+-- wo:shuffleOxyd()
+
+function doit(value, sender)
+    obj = no["cherry#3"]
+--    obj:kill()
+    wo[obj] = {"it_nil"}
+
+    mygrp = no["cherry#*"]
+    obj = mygrp[#mygrp - 1]
+    if (-obj) then
+        wo[obj] = {"it-banana"}
+    end
+
+    
+    door_grp = no["door#*"]
+    chess_grp = no["chess#*"]
+    if -obj then
+    end
+    join = door_grp + chess_grp
+--    join:kill()
+    
+    if value then
+        st(blocker_pos):message("open")
+        not_all_doors = door_grp - no["door#2"]
+        for obj in not_all_doors do
+            obj:open()
+        end
+--        not_all_doors:open()
+        no.buggy["opendoors"] = not_all_doors + no["money"] + fl(3,4)
+        no.buggy["mypos"] = po(no.money)
+        chess_grp["color"] = 1
+        wo[mygrp] = {"st-wood"}
+    else
+        it(blocker_pos):close()
+        --door_grp:message("close")
+        crazy_group = no.buggy["opendoors"]
+        --crazy_group:kill()
+        crazy_group:close()
+        wo[no.buggy["mypos"]] = {"it-hollow"}
+        chess_grp2 = grp({no.money, no["chess#1"], no.money})
+        chess_special = chess_grp * chess_grp2
+        chess_special:kill()
+    end
+    
+end
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT014_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralT016_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT016_1.xml	2008-01-19 23:28:52 UTC (rev 991)
+++ team_levelpacks/team_test_new_api/ralT016_1.xml	2008-01-20 11:51:33 UTC (rev 992)
@@ -0,0 +1,81 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Mess-Trigger" el:subtitle="" el:id="20071010ral498"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2006 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+wo["ShowMoves"] = false
+wo["SwampSinkSpeed"] = 2
+
+ti[" "] = {"fl-sahara"}
+ti["."] = {"fl-abyss"}
+ti["#"] = ti[" "] .. {"st-rock1"}
+ti["l"] = ti[" "] .. {"st-lightpassenger_off"}
+ti["B"] = ti[" "] .. {"st_boulder_n"}
+ti["W"] = ti[" "] .. {"st-white1"}
+ti["P"] = ti[" "] .. {"st-plain"}
+ti["p"] = ti[" "] .. {"st-polarswitch"}
+ti["E"] = ti[" "] .. {"st-laser-e", on=1}
+ti["e"] = ti[" "] .. {"st-laser-n", on=1}
+ti["m"] = ti[" "] .. {"st-pmirror", movable=1, transparent=true, orientation=2}
+ti["w"] = ti[" "] .. {"it-magicwand"}
+ti["V"] = ti[" "] .. {"st-volcano_inactive"}
+ti["I"] = ti[" "] .. {"st-stoneimpulse"}
+ti["i"] = ti[" "] .. {"st-stoneimpulse_movable"}
+ti["L"] = ti[" "] .. {"st-rotator-left"}
+ti["R"] = ti[" "] .. {"st-rotator-right"}
+ti["b"] = ti[" "] .. {"st_blocker"}
+ti["H"] = ti[" "] .. {"st-wood"}
+ti["A"] = ti[" "] .. {"st_blocker"}
+ti["a"] = ti[" "] .. {"it_blocker"}
+ti["c"] = ti[" "] .. {"it_blocker_new"}
+ti["C"] = ti[" "] .. {"st_boulder_w"}
+ti["D"] = ti["a"] .. {"st_boulder_w"}
+ti["F"] = ti["c"] .. {"st_boulder_w"}
+ti["G"] = ti[" "] .. {"st_boulder_e"}
+
+
+ti["X"] = ti[" "] .. {"st-oxyd"}
+ti["1"] = ti[" "] .. {"#ac-blackball"}
+
+w, h = wo(ti, " ", {
+"###X##########X#####",
+"#   AC   IC        #",
+"X  AaD             X",
+"#  AcF WPP       ###",
+"E  p        L    I  ",
+"#          L b   III",
+"#RW  i    l      I  ",
+"W .  m1 B        I  ",
+"#   W w   H      I  ",
+"#  W   H         I  ",
+"#BBBB  B  B B B GI  ",
+"#       p        ####",
+"########e#####V######"
+})
+
+-- function door(value, sender)
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT016_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralT017_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT017_1.xml	2008-01-19 23:28:52 UTC (rev 991)
+++ team_levelpacks/team_test_new_api/ralT017_1.xml	2008-01-20 11:51:33 UTC (rev 992)
@@ -0,0 +1,68 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Oxyd Shuffle" el:subtitle="" el:id="20071104ral921"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2007 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["#"] = ti[" "] .. {"st-rock1"}
+
+ti["O"] = ti[" "] .. {"st-oxyd", name="o#", color=1, noshuffle=false}
+ti["P"] = ti[" "] .. {"st-oxyd", name="p#"}
+ti["Q"] = ti[" "] .. {"st-oxyd", name="q1", color=5, noshuffle=false}
+ti["q"] = ti[" "] .. {"st-oxyd", name="q2", color=7, noshuffle=true}
+ti["1"] = ti[" "] .. {"#ac-blackball"}
+
+w, h = wo(ti, " ", {
+"   O          O     ",
+"                    ",
+"P                  P",
+"                    ",
+"                    ",
+"Q                  q",
+"                    ",
+"      1             ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    "
+})
+
+--wo:shuffleOxyd({no["o#*"], max=0}, {no["o#*"], no["p#*"], max=0})
+--wo:shuffleOxyd({no["o#*"], max=0}, {no["o#*"], no["p#*"] + no["o#2"], max=0})
+
+--wo:shuffleOxyd({no["o#*"], max=0}, {no["o#*"], no["o#1"], max=0})
+--wo:shuffleOxyd({no["o#*"], max=0}, {grp(no["o#2"]), grp(no["p#1"]), max=0}, {no["p#*"], max=0}, {grp(no["p#2"]), grp(no["q1"]), max=0}, {grp(no["q2"]), grp(no["q1"]), max=0})
+--wo:shuffleOxyd({no["o#*"], max=0}, {"o#2", "p#1", max=0}, {no["p#*"], max=0}, {grp(no["p#2"]), grp(no["q1"]), max=0}, {grp(no["q2"]), grp(no["q1"]), max=0})
+--wo:shuffleOxyd({no["o#*"] + no["p#*"] + no["q*"], linear = true, log="solution"})
+wo:shuffleOxyd({no["o#*"] + no["p#*"] + no["q*"], circular = true, log="all"})
+--wo:shuffleOxyd({"q1", "q2", max=2, log="count"})
+
+--wo:shuffleOxyd({"o#1", grp(no["q1"], no["q2"]), max=0, log="solution"}, {"o#2", grp(no["p#2"],no["q1"],no["q2"]), max=0}, {"p#1", grp(no["p#2"],no["q1"],no["q2"]), max=0})
+-- function door(value, sender)
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT017_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralT018_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT018_1.xml	2008-01-19 23:28:52 UTC (rev 991)
+++ team_levelpacks/team_test_new_api/ralT018_1.xml	2008-01-20 11:51:33 UTC (rev 992)
@@ -0,0 +1,70 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Oxyd Shuffle 2" el:subtitle="" el:id="20071108ral711"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="test"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2007 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+wo["AllowSingleOxyds"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["#"] = ti[" "] .. {"st-rock1"}
+
+ti["O"] = ti[" "] .. {"st-oxyd", name="o#", flavor="d"}
+ti["P"] = ti[" "] .. {"st-oxyd", name="p#"}
+ti["Q"] = ti[" "] .. {"st-oxyd", name="q1", color=5}
+--ti["S"] = ti[" "] .. {"st_switch", action="shuffle", target="o#1"}
+ti["S"] = ti[" "] .. {"st_switch", action="callback", target="newflavor"}
+ti["1"] = ti[" "] .. {"#ac-blackball"}
+ti["B"] = ti[" "] .. {"st-oxyd", color=-4, flavor="d", noshuffle=false}
+ti["F"] = ti[" "] .. {"st-oxyd", color=-3, flavor="a", noshuffle=false}
+ti["K"] = ti[" "] .. {"st-oxyd", color=-2, flavor="c", noshuffle=false}
+
+
+w, h = wo(ti, " ", {
+"B  OOOOOOOOPPPPPPK F",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"      1             ",
+"                    ",
+"                    ",
+"       S            ",
+"                    ",
+"                    "
+})
+
+--wo:shuffleOxyd()
+--wo:shuffleOxyd({"o#1", "o#2", max=2, log="count"})
+--wo:shuffleOxyd({no["o#*"], min=3, log="solution"})
+wo:shuffleOxyd({no["o#*"], no["p#*"], min=3, log="solution"})
+function newflavor(value, sender)
+    no["o#1"]["flavor"] = "b"
+--    no["o#1"]:kill()
+end
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT018_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralT019_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT019_1.xml	2008-01-19 23:28:52 UTC (rev 991)
+++ team_levelpacks/team_test_new_api/ralT019_1.xml	2008-01-20 11:51:33 UTC (rev 992)
@@ -0,0 +1,63 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Oxyd Shuffle 3" el:subtitle="" el:id="20071108ral459"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2007 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["#"] = ti[" "] .. {"st-rock1"}
+
+ti["O"] = ti[" "] .. {"st-oxyd", name="o#"}
+ti["P"] = ti[" "] .. {"st-oxyd", name="p#"}
+ti["Q"] = ti[" "] .. {"st-oxyd", name="q#"}
+ti["R"] = ti[" "] .. {"st-oxyd", name="r#"}
+ti["S"] = ti[" "] .. {"st-oxyd", name="s#"}
+ti["T"] = ti[" "] .. {"st-oxyd", name="t#"}
+ti["1"] = ti[" "] .. {"#ac-blackball"}
+
+w, h = wo(ti, " ", {
+"S  OOO              ",
+"                    ",
+"         QQQQ  RRRR ",
+"                    ",
+"T  PPP              ",
+"                    ",
+"                    ",
+"      1             ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    "
+})
+
+wo:shuffleOxyd({no["o#*"] + no["s#1"], no["p#*"] + no["t#1"], min=2, log="solution"},
+        {no["o#*"] + no["p#*"], no["r#*"], min=3})
+--wo:shuffleOxyd({no["o#*"] + no["s#1"], no["p#*"] + no["t#1"], min=2, log="count"},
+--        {no["o#*"] + no["p#*"], no["r#*"], min=3})
+-- function door(value, sender)
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT019_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralT021_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT021_1.xml	2008-01-19 23:28:52 UTC (rev 991)
+++ team_levelpacks/team_test_new_api/ralT021_1.xml	2008-01-20 11:51:33 UTC (rev 992)
@@ -0,0 +1,64 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Vortex" el:subtitle="" el:id="20071219ral361"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2006 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["#"] = ti[" "] .. {"st-rock1"}
+
+ti["A"] = ti[" "] .. {"it-vortex-open", name="v1", destination="v2", scissor=true}
+ti["B"] = ti[" "] .. {"it-vortex-open", name="v2", destination="v3"}
+ti["C"] = ti[" "] .. {"it-vortex-open", name="v3", destination={"v1","v2","v4"}}
+ti["D"] = ti[" "] .. {"it-vortex-open", name="v4", destination=po(3.1,7.7)}
+ti["R"] = ti[" "] .. {"st-rubberband"}
+ti["W"] = ti[" "] .. {"st-wood"}
+ti["S"] = ti[" "] .. {"st_switch", target="autoclose"}
+
+ti["1"] = ti[" "] .. {"#ac-blackball"}
+
+w, h = wo(ti, " ", {
+"   R                ",
+"                    ",
+"                    ",
+"   A  B  C  D       ",
+"                    ",
+"  W       W    W    ",
+"                    ",
+"      1             ",
+"   S                ",
+"                    ",
+"                    ",
+"                    ",
+"                    "
+})
+
+
+function autoclose(value, sender)
+    no["v1"]:set({autoclose=value})
+end
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT021_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralT025_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT025_1.xml	2008-01-19 23:28:52 UTC (rev 991)
+++ team_levelpacks/team_test_new_api/ralT025_1.xml	2008-01-20 11:51:33 UTC (rev 992)
@@ -0,0 +1,83 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test FourSwitch new API" el:subtitle="" el:id="20080102ral142"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2006 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["#"] = ti[" "] .. {"st-rock1"}
+ti["y"] = ti[" "] .. {"it-magicwand"}
+
+ti["s"] = ti[" "] .. {"st_switch", name="swo#", state=1}
+ti["S"] = ti[" "] .. {"st_switch", name="sw#"}
+ti["T"] = ti[" "] .. {"st_switch", name="swt#"}
+ti["D"] = ti[" "] .. {"st-door-v", name="do#"}
+ti["R"] = ti[" "] .. {"st_boulder_n", name="boulder"}
+ti["L"] = ti[" "] .. {"st-laserswitch", target="door1", action="signal"}
+
+ti["f"] = ti[" "] .. {"st_fourswitch", target="swo#1", action="signal"}
+ti["F"] = ti[" "] .. {"st_fourswitch", target="sw#1", action="signal", inverse=true}
+ti["g"] = ti[" "] .. {"st_fourswitch", name="fourstate", target_3="swt#1", target_2="swt#2", target_1="swt#3", target_0="swt#4", action="signal"}
+ti["G"] = ti[" "] .. {"st_fourswitch", target="boulder", action="orientate"}
+
+ti["h"] = ti[" "] .. {"st_fourswitch", name="f#"}
+ti["u"] = ti[" "] .. {"st_switch", target="f#1", action="signal"}
+ti["U"] = ti[" "] .. {"st_switch", target="f#2", action="toggle"}
+
+-- the bolder on fourswitch trigger will work after the reengineering of boulder
+ti["B"] = ti[" "] .. {"st_boulder_w"}
+ti["W"] = ti[" "] .. {"st-wood"}
+
+
+-- 4 switches to set state of fourswitch that switches 4 others
+ti["t"] = ti[" "] .. {"st_switch", target="setstate"}
+
+ti["H"] = ti[" "] .. {"st_fourswitch", counterclock=true, name="anticlock"}
+
+
+ti["1"] = ti[" "] .. {"#ac-blackball"}
+
+w, h = wo(ti, " ", {
+"            f  s    ",
+"            F  S    ",
+"        t   g  T    ",
+"H       t      T    ",
+"        t      T    ",
+"        t      T    ",
+"            G  R    ",
+"        1           ",
+"        y           ",
+"h u                 ",
+"h U                 ",
+"h    WB             ",
+"                    "
+})
+
+function setstate(value, sender)
+    no["fourstate"]["state"] = sender.y - 2
+end
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT025_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Modified: team_levelpacks/team_test_new_api/ralT026_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT026_1.xml	2008-01-19 23:28:52 UTC (rev 991)
+++ team_levelpacks/team_test_new_api/ralT026_1.xml	2008-01-20 11:51:33 UTC (rev 992)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Test Horse new API" el:subtitle="" el:id="20080116ral551"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 46 $" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2006 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>


Property changes on: team_levelpacks/team_test_new_api/ralT026_1.xml
___________________________________________________________________
Name: svn:executable
   - 
Name: svn:keywords
   + Revision

Modified: team_levelpacks/team_test_new_api/ralT027_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT027_1.xml	2008-01-19 23:28:52 UTC (rev 991)
+++ team_levelpacks/team_test_new_api/ralT027_1.xml	2008-01-20 11:51:33 UTC (rev 992)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Test Blocker new API" el:subtitle="" el:id="20080118ral328"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 46 $" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2006 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>


Property changes on: team_levelpacks/team_test_new_api/ralT027_1.xml
___________________________________________________________________
Name: svn:executable
   - 
Name: svn:keywords
   + Revision



From andreasl at mail.berlios.de  Sun Jan 20 15:00:45 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Sun, 20 Jan 2008 15:00:45 +0100
Subject: [Enigma-game-svn] r993 - trunk/data/levels/lib
Message-ID: <200801201400.m0KE0j7V031573@sheep.berlios.de>

Author: andreasl
Date: 2008-01-20 15:00:44 +0100 (Sun, 20 Jan 2008)
New Revision: 993

Modified:
   trunk/data/levels/lib/libluatools.xml
   trunk/data/levels/lib/libsoko-endphase.xml
Log:
Trunk 1.1:
 - libsoko:
    - Fixed endphase "knock"
 - libluatools:
    - Renamed luatools.conditional -> luatools.cond
    - Added warning comment to luatools.cond:
       Be aware that all arguments are evaluated!
    - Disabled the cases table.getn(t) < 2 in
       luatools.shuffle_table, and optimized for-loop.


Modified: trunk/data/levels/lib/libluatools.xml
===================================================================
--- trunk/data/levels/lib/libluatools.xml	2008-01-20 11:51:33 UTC (rev 992)
+++ trunk/data/levels/lib/libluatools.xml	2008-01-20 14:00:44 UTC (rev 993)
@@ -76,8 +76,12 @@
 
 -- shuffle_table resorts the table T randomly. Note that only those entries
 -- of T can be sorted, that are indexed with integers from 1 to table.getn(T).
+-- No return value, the table itself is shuffled.
 function luatools.shuffle_table(t)
-  for n = table.getn(t), 1, -1 do
+  if table.getn(t) < 2 then
+    return
+  end
+  for n = table.getn(t), 2, -1 do
     local m = math.random(n)
     t[n], t[m] = t[m], t[n]
   end
@@ -111,8 +115,12 @@
 -- versions, it's sometimes better to wrap them.
 luatools.mod = math.fmod or math.mod
 
--- A wrapper of if to resemble the ternary ?:-function
-function luatools.conditional(condition, iftrue, iffalse)
+-- A wrapper of "if" to resemble the ternary ?:-function.
+-- Note that this function evaluates both IFTRUE as well as IFFALSE, e.g.
+--   luatools.cond(t == 0, 1/t, error("Division by zero"))
+-- will evaluate the error-function and thus hold for any T.
+-- Hence: Make sure there are no sideeffects in IFTRUE and IFFALSE!
+function luatools.cond(condition, iftrue, iffalse)
   if condition then
     return iftrue
   else

Modified: trunk/data/levels/lib/libsoko-endphase.xml
===================================================================
--- trunk/data/levels/lib/libsoko-endphase.xml	2008-01-20 11:51:33 UTC (rev 992)
+++ trunk/data/levels/lib/libsoko-endphase.xml	2008-01-20 14:00:44 UTC (rev 993)
@@ -659,13 +659,13 @@
     local it = enigma.GetItem(x, y)
     local fl = enigma.GetFloor(x, y)
     if st and enigma.GetAttrib(st, "_sokoarea") then
-      SendMessage(st, luatools.conditional(open, "open", "close"))
+      SendMessage(st, luatools.cond(open, "open", "close"))
     end
     if it and enigma.GetAttrib(it, "_sokoarea") then
-      SendMessage(it, luatools.conditional(open, "open", "close"))
+      SendMessage(it, luatools.cond(open, "open", "close"))
     end
     if fl then
-      SendMessage(fl, luatools.conditional(open, "close", "open"))
+      SendMessage(fl, luatools.cond(open, "close", "open"))
     end
   end  
 end
@@ -740,15 +740,16 @@
 end
 
 function endphase_set_knocking(sokoarea_number, param)
-  local flavor = sokoarea[sokoarea_number].design.oxyd or "b"
+  local nr = sokoarea_number
+  local flavor = sokoarea[nr].design.oxyd or "b"
   local places = {}
   local itemkind = param
   if (itemkind == nil) or (itemkind == "") then
-    itemkind = "it-burnable"
+    itemkind = "it-sensor"
   end
 
   -- add all blockers
-  for p, v in pairs(sokoarea[sokoarea_number].list_blocker) do
+  for p, v in pairs(sokoarea[nr].list_blocker) do
     table.insert(places, v)
   end
 
@@ -757,11 +758,21 @@
   -- set items (for Enigma 1.0), set attributes of door (>= 1.1)
   for j, v in pairs(places) do
     set_item(itemkind, v.lx, v.ly, {action="callback",
-        target="endphase_call_knocking", _number=j, _sokoarea=sokoarea_number})
+        target="endphase_call_knocking", _number=j, _sokoarea=nr})
     local st = enigma.GetStone(v.lx, v.ly)
     if st then
       enigma.SetAttrib(st, "action", "callback")
       enigma.SetAttrib(st, "target", "endphase_call_knocking")
+      local closepos = places[luatools.mod(j, table.getn(places)) + 1]
+      local openpos = places[luatools.mod(j+1, table.getn(places)) + 1]
+      enigma.SetAttrib(st, "_close_x", closepos.lx)
+      enigma.SetAttrib(st, "_close_y", closepos.ly)
+      enigma.SetAttrib(st, "_open_x", openpos.lx)
+      enigma.SetAttrib(st, "_open_y", openpos.ly)
+      --enigma.SetAttrib(st, "_close",
+      --  luatools.deep_copy(places[luatools.mod(j+1, table.getn(places)) + 1]))
+      --enigma.SetAttrib(st, "_open",
+      --  luatools.deep_copy(places[luatools.mod(j+2, table.getn(places)) + 1]))
     end
   end
 end
@@ -772,32 +783,38 @@
   if (not nr) or (not j) then
     myerror("libsoko: Knocking's source has no number or no sokoarea.")
   end
+  -- Check that it-sensor did not send its message because of
+  -- the marble standing on it:
+  local x, y = enigma.GetPos(sender)
+  local mx, my = enigma.GetPos(enigma.GetNamedObject("marble_"..nr.."_1"))
+  if (x == mx) and (y == my) then
+    return
+  end
   mydebug("Knocked on "..j.."/"..sokoarea[nr].number_oxyds)
   -- Deactivate the first door until endphase has started.
   if (j == 1) and (not sokoarea[nr].endphase_started) then
+    mydebug("Door deactivated until endphase.")
     return
   end
-  -- Close the next door in the circle ...
-  j = j + 1
-  if j > sokoarea[nr].number_oxyds then
-    j = 1
+  -- Get the door (possibly it already is sender), and open or close
+  -- the neccessary doors given as attributes.
+  local mydoor = enigma.GetStone(x, y)
+  if enigma.GetAttrib(mydoor, "_sokoarea") == nr then
+    local close_x = enigma.GetAttrib(mydoor, "_close_x")
+    local close_y = enigma.GetAttrib(mydoor, "_close_y")
+    local open_x = enigma.GetAttrib(mydoor, "_open_x")
+    local open_y = enigma.GetAttrib(mydoor, "_open_y")
+    local closedoor = enigma.GetStone(close_x, close_y)
+    local opendoor = enigma.GetStone(open_x, open_y)
+    if closedoor then
+      SendMessage(closedoor, "close")
+    end
+    if opendoor then
+      SendMessage(opendoor, "open")
+    end
   end
-  local mydoor = enigma.GetStone(places[j].lx, places[j].ly)
-  if mydoor then
-    SendMessage(mydoor, "close")
-  end
-  -- ... and open the door after next.
-  j = j + 1
-  if j > sokoarea[nr].number_oxyds then
-    j = 1
-  end
-  mydoor = enigma.GetStone(places[j].lx, places[j].ly)
-  if mydoor then
-    SendMessage(mydoor, "open")
-  end
 end
 
-
     ]]></el:luamain>
     <el:i18n>
     </el:i18n>



From ral at mail.berlios.de  Mon Jan 21 00:44:16 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 21 Jan 2008 00:44:16 +0100
Subject: [Enigma-game-svn] r994 - in trunk: data/gfx16 doc doc/reference
Message-ID: <200801202344.m0KNiGIk014283@sheep.berlios.de>

Author: ral
Date: 2008-01-21 00:44:15 +0100 (Mon, 21 Jan 2008)
New Revision: 994

Modified:
   trunk/data/gfx16/
   trunk/doc/
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk:
- svn ignore fixes for 2 dirs
- Refman new formatting for object description
- Refman new indices for objects, attributes, messages 
- Refman new API doc for boulder, blocker, fourswitch



Property changes on: trunk/data/gfx16
___________________________________________________________________
Name: svn:ignore
   - Makefile Makefile.in

   + Makefile
Makefile.in



Property changes on: trunk/doc
___________________________________________________________________
Name: svn:ignore
   - Makefile
Makefile.in

   + Makefile
Makefile.in
eniginecode


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-01-20 14:00:44 UTC (rev 993)
+++ trunk/doc/reference/enigma-ref.texi	2008-01-20 23:44:15 UTC (rev 994)
@@ -11,6 +11,10 @@
 @author Andreas Lochmann
 @end titlepage
 
+ at defindex ob
+ at defindex at
+ at defindex ms
+
 @contents
 
 @ifnottex
@@ -38,6 +42,9 @@
 * Old API - Objects::           Description of all objects in Enigma
 * Old API - Variables::         Lua variables that influence the game
 * Old API - Functions::               Predefined functions
+* Object Index::
+* Attribute Index::
+* Message Index::
 * Function Index::
 * Concept Index::
 @end menu
@@ -2640,18 +2647,406 @@
 @node Lua API, Common Attributes and Messages, Enigma Paradigm, Top
 @chapter Lua API
 
+ at c ===================  Commons  =======================
 @node Common Attributes and Messages, Floor Objects, Lua API, Top
 @chapter Common Attributes and Messages
 
+ at menu
+* Common Attributes:: 
+* Common Messages::   
+ at end menu
+
+ at node Common Attributes, Common Messages, Common Attributes and Messages, Common Attributes and Messages
+ at section Common Attributes
+
+ at menu
+* name:: 
+* state:: 
+* target::
+* action::
+* inverse::
+* destination::
+ at end menu
+
+ at node name, state, Common Attributes, Common Attributes
+ at subsection name
+
+ at node state, target, name, Common Attributes
+ at subsection state
+
+ at node target, action, state, Common Attributes
+ at subsection target
+
+ at node action, inverse, target, Common Attributes
+ at subsection action
+
+ at node inverse, destination, action, Common Attributes
+ at subsection inverse
+
+ at node destination, Common Messages, inverse, Common Attributes
+ at subsection destination
+
+
+ at node Common Messages, Floor Objects, Common Attributes, Common Attributes and Messages
+ at section Common Messages
+
+ at menu
+* toggle:: 
+* signal::
+* on::
+* off::
+* open::
+* close::
+ at end menu
+
+ at node toggle, signal, Common Messages, Common Messages
+ at subsection toggle
+
+ at node signal, on, toggle, Common Messages
+ at subsection signal
+
+ at node on, off, signal, Common Messages
+ at subsection on
+
+ at node off, open, on, Common Messages
+ at subsection off
+
+ at node open, close, off, Common Messages
+ at subsection open
+
+ at node close, Floor Objects, open, Common Messages
+ at subsection close
+
+ at c ===================  Floors  =======================
+
 @node Floor Objects, Item Objects, Common Attributes and Messages, Top
 @chapter Floor Objects
+ at c ===================  Items  =======================
 
 @node Item Objects, Stone Objects, Floor Objects, Top
 @chapter Item Objects
 
+ at menu
+* Standard Items:: 
+ at end menu
+
+ at node Standard Items, Stone Objects, Item Objects, Item Objects
+ at section Standard Items
+
+ at menu
+* it_blocker::         Shrinked Blocker Stone
+ at end menu
+
+
+ at c ----------------- Blocker Item -------------------- 
+ at node it_blocker, Stone Objects, Standard Items, Standard Items
+ at subsection it_blocker
+ at obindex it_blocker
+
+A door like object that grows to @ref{st_blocker} when a @ref{st_boulder}
+passes. When the boulder did shrink and pass the blocker again it stays in its
+item like open state until it is passed again by a boulder which causes it to 
+grow again to a blocker stone.
+
+It fully supports the messages of any door like object and can be opened and
+closed by any switch like object. Note that due to the transformation between
+stone and item during opening and closing you should name the blocker
+(@pxref{name}) and address the blocker by this name. The complete identity
+with all attributes including any user attributes will be transfered between
+stone and item. E.g. @code{{it_switch, target="myblocker", action="toggle"}}
+will open and close a given blocker multiple times.
+
+Note that the blocker is the only door object that allows a stone to be pushed
+through. Just bloulders cause the growing. Any other stone keeps the open state.
+
+Another unique door feature is the closing of an blocker item caused by a 
+passing actor if the autoclose attribute is set to true.
+
+Note that a dropped @ref{it_brake} destroys this item.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{state}, @ @ @i{values}: @code{0}, @code{1}; @ @ @i{default}: @code{1} @ @ @xref{state}
+Use CLOSED and OPEN macros as values. The item represents the open state
+and will always return state 1. But you can set its state what is equivalent
+to sending an open message in case of value 1 and an close message in case of
+value 0..
+
+ at atindex autoclose
+ at item @b{autoclose} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+A true value causes any actor passing this item to close and grow the blocker.
+
+ at end table
+
+ at item @b{Messages:}
+
+ at table @asis
+ at item @b{signal} @ @ @xref{signal}
+A signal of value 1 sends an open message, a signal of value 0 sends a close
+message.
+ at item @b{toggle} @ @ @xref{toggle}
+A toggle causes an close message.
+ at item @b{close} @ @ @xref{close}
+A close message take immediate effect if the item is not covered by a stone.
+The item transforms to a new growing @ref{st_blocker}. If it is covered by a
+stone of whatever kind it will be marked as unlocked. The closing process starts
+when the stone moves away.
+ at item @b{open} @ @ @xref{open}
+As the item is open this message takes only effect if it is currently covered
+by a stone and marked as unlocked. That means it should grow as soon as the
+stone moves away what happens when a @ref{st_boulder} passes an idle blocker
+item. In this case an open messages locks the blocker again to avoid a growing
+when the stone moves away.
+ at end table
+
+ at item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
+Sends an action at the moment the blocker reaches the open state. That means
+an @ref{st_blocker} did open and did generate this blocker item as its
+successor. The value will be @code{true} to express the open state.
+
+ at item @b{Variants:}
+ at table @asis
+ at item @b{it_blocker}
+A standard blocker item.
+ at item @b{it_blocker_new}
+A blocker that just finished shrinking. Mainly used internally as the direct
+successor of an @ref{st_blocker}. But it may be useful to generate an initial
+snapshot of a moving boulder over a blocker line, too. See example levels.
+ at end table
+
+ at end table
+
+
+
+ at c ===================  Stones  =======================
 @node Stone Objects, Actor Objects, Item Objects, Top
 @chapter Stone Objects
 
+ at menu
+* Simple Stones:: 
+* Transparent Stones::
+* Breakable Stones::
+* Special Stones::
+ at end menu
+
+
+ at node Simple Stones, Transparent Stones, Stone Objects, Stone Objects
+ at section Simple Stones
+
+ at node Transparent Stones, Breakable Stones, Simple Stones, Stone Objects
+ at section Transparent Stones
+ at node Breakable Stones, Special Stones, Glasstones, Stone Objects
+ at section Breakable Stones
+ at node Special Stones, Actor Objects, Breakable Stones, Stone Objects
+ at section Special Stones
+
+ at menu
+* st_blocker::         Shrinkable Blocker
+* st_boulder::         Moving Arrow Boulder
+* st_fourswitch::      Four Direction Switch
+ at end menu
+
+
+ at c ----------------- Blocker Stone -------------------- 
+ at node st_blocker, st_boulder, Special Stones, Special Stones
+ at subsection st_blocker
+ at obindex st_blocker
+
+A door like object that shrinks to @ref{it_blocker} when hit by a
+ at ref{st_boulder}. When the boulder did pass the blocker stays in its item like
+open state until it is passed again by a boulder which causes it to grow again
+to a blocker stone.
+
+It fully supports the messages of any door like object and can be opened and
+closed by any switch like object. Note that due to the transformation between
+stone and item during opening and closing you should name the blocker
+(@pxref{name}) and address the blocker by this name. The complete identity
+with all attributes including any user attributes will be transfered between
+stone and item. E.g. @code{{st_switch, target="myblocker", action="toggle"}}
+will open and close a given blocker multiple times.
+
+Note that the blocker is the only door object that allows a stone to be pushed
+through. Just bloulders cause the growing. Any other stone keeps the open state.
+
+Be aware that the @ref{it_brake} destroys an @ref{it_blocker}.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{state}, @ @ @i{values}: @code{0}, @code{1}; @ @ @i{default}: @code{0} @ @ @xref{state}
+Use CLOSED and OPEN macros as values. The stone represents the closed state
+and will always return state 0. But you can set its state what is equivalent
+to sending an open message in case of value 1 and an close message in case of
+value 0..
+
+ at atindex autoclose
+ at item @b{autoclose} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+This attribute is irrelevant to the blocker stone itself. But is is transfered
+to the @ref{it_blocker} when the blocker opens.
+
+ at end table
+
+ at item @b{Messages:}
+
+ at table @asis
+ at item @b{signal} @ @ @xref{signal}
+A signal of value 1 sends an open message, a signal of value 0 sends a close
+message.
+ at item @b{toggle} @ @ @xref{toggle}
+A toggle causes an open unless the the blocker stone is in the shrinking process.
+In this case it causes a close message.
+ at item @b{open} @ @ @xref{open}
+Starts an opening by shrinking the blocker. Note that during the shrinking
+process the blocker still reports to be closed. The shrinking process can
+be reverted by a close message.
+ at item @b{close} @ @ @xref{close}
+A close message take only effect on blocker stone that is in the shrinking
+process. The shrinking is stopped immediatly and reverted to grow the blocker
+again to full size.
+ at end table
+
+ at item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
+Sends an action at the moment the blocker reaches the closing state. That means
+an @ref{it_blocker} did close and did generate this blocker stone as its
+successor. The value will be @code{false} to express the closing state.
+
+ at item @b{Variants:}
+ at table @asis
+ at item @b{st_blocker}
+A standard blocker stone.
+ at item @b{st_blocker_new}
+A blocker that just starts growing. Mainly used internally as the direct
+successor of an @ref{it_blocker}. But it may be useful to generate an initial
+snapshot of a moving boulder over a blocker line, too. See example levels.
+ at end table
+
+ at end table
+
+ at c ----------------- Boulder Stone -------------------- 
+ at node st_boulder, st_fourswitch, st_blocker, Special Stones
+ at subsection st_boulder
+ at obindex st_boulder
+
+This solid stone moves into the direction shown by the arrow on its picture.
+A marble blocking its way is shattered. When a stone blocks its way, it triggers
+it by a sequence of two internal messages. Some stones give way like 
+ at ref{st_blocker}, others change their state like @ref{st_oxyd}, 
+ at ref{st_stoneimpulse}, @ref{st_fart}, @ref{st_mirror}, @ref{st_fourswitch},
+ at ref{st_volcano}. A third categorie switches temporary in another state on the
+first message sent when the boulder reaches a grid and switch back on the
+second message sent when the boulder gives up like @ref{st_[black/white]},
+ at ref{st_plain}, @ref{st_lightpassenger}.
+
+Items getting beneath a moving boulder may react like on any other stone move
+on top of them. Additionally @ref{it_blocker} will be released to grow again
+to a blocking stone.
+
+Boulder stones fall into @ref{fl_abyss}, but cross @ref{fl_water}
+unchanged.  
+
+ at ref{it_magicwand} and lasers reverse its direction. @ref{st_rotator} changes
+its direction according to the rotators direction. @ref{st_stoneimpulse} pushes
+a boulder away.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at atindex orientation
+ at item @b{orientation}, @ @ @i{values}: @code{NORTH}, @code{EAST}, @code{SOUTH}, @code{WEST}; @ @ @i{default}: @code{NORTH}
+The orientation of the boulder that is shown by its arrow. It determines the
+direction that the boulder will take on its next move.
+ at end table
+
+ at item @b{Messages:}
+
+ at table @asis
+ at msindex orientate
+ at item @b{orientate}, @ @ @i{value type}: direction
+Change the orientation to the given direction value. The @ref{st_fourswitch}
+provides a compatible action which allows you to set a boulder as
+target and this message as action.
+ at end table
+
+ at item @b{Action:}
+none
+
+ at item @b{Variants:}
+
+ at table @asis
+ at item @b{st_boulder}
+ at item @b{st_boulder_n}: orientation = @code{NORTH}
+ at item @b{st_boulder_e}: orientation = @code{EAST}
+ at item @b{st_boulder_s}: orientation = @code{SOUTH}
+ at item @b{st_boulder_w}: orientation = @code{WEST}
+ at end table
+
+ at end table
+
+ at c ----------------- Fourswitch Stone -------------------- 
+ at node st_fourswitch, Actor Objects, st_boulder, Special Stones
+ at subsection st_fourswitch
+ at obindex st_fourswitch
+
+A switch that points to one of the four directions turning on every switching
+event. The most common event is an actor hitting this stone. But @ref{st_boulder}
+will trigger this switch, too. Of course other objects can send messages on
+actions to make this switch turning.
+
+When turning its pointer on a switching event it performs the action given by
+the @code{action/target}-pair. This can be either a common pair or a 
+state/direction dependent pair allowing you to issue different messages
+dependent on the pointing direction.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at atindex state
+ at item @b{state}, @ @ @i{values}: @code{NORTH}, @code{EAST}, @code{SOUTH}, @code{WEST}; @ @ @i{default}: @code{NORTH} @ @ @xref{state}
+ at item @b{counterclockwise} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+The standard turning direction is clockwise. Use this attribute to revert the
+direction.
+ at item @b{inverse} @ @ @xref{inverse}
+Note that the action value is inverted in its boolean interpretation. This means
+that an inverted action value is @emph{not} the reverse direction and should not
+be used as a direction value at all.
+ at end table
+
+ at item @b{Messages:}
+
+ at table @asis
+ at item @b{signal} @ @ @xref{signal}
+Note that the fourswitch reacts just on value @code{1}. Values of @code{0} are
+simply ignored. Use message toggle if you need turns on any message value.
+ at item @b{toggle} @ @ @xref{toggle}
+Note that a toggle turns the fourswitch independent of a message value.
+ at end table
+
+ at item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
+Performs an action on each turn. If just a pair of global @code{target/action}
+attributes are given, the action message is sent to the target with a 
+direction value of the new orientation. This values suits any message of the
+target that expects a direction value, and the @ref{signal} message, that 
+translates the direction to a 1 for @code{NORTH, SOUTH} and a 0 for 
+ at code{EAST, WEST}.
+
+If state dependent target/action pairs are given instead, namely
+ at code{target_0/action_0} for the state @code{WEST},... , @code{target_3/action_3} 
+for the state @code{NORTH}, two actions will be perfomed: first for the state 
+representing the old orientation the given action messages will be sent with
+a value of 0, then for the state representing the new orientation the given
+action messages will be sent with a value of 1. This allows you to switch on
+and off alternative sources by a fourswitch.
+ at end table
+
+
+
+ at c ===================  Actors  =======================
+
 @node Actor Objects, Other Objects, Stone Objects, Top
 @chapter Actor Objects
 
@@ -3494,7 +3889,7 @@
 
 This item can be used to make some invisible stones visible
 (@code{st-actorimpulse_invisible} (see @ref{st-actorimpulse}),
- at code{st-break_invisible} (see @ref{Breakable Stones}),
+ at code{st-break_invisible} (see @ref{Breakable-Stones}),
 @code{st-stonebrush} (see @ref{st-invisible}), and to remove debris
 from the level: (@ref{it-cross}, @ref{it-squashed},
 @ref{it-booze-broken}, @code{it-glasses-broken} (see
@@ -4410,7 +4805,7 @@
 @menu
 * Stone List::                  A complete list of all stones
 * Glassstones::                 A summary of all kinds of glassy stones
-* Breakable Stones::            A summary of all breakable stones
+* Breakable-Stones::            A summary of all breakable stones
 * Oxyd Compatibility Stones::   Special stones for Oxyd compatibility and debugging
 * st-actorimpulse::             Bumper Stones
 * st-big[brick/bluesand]::      Big Stones
@@ -4475,7 +4870,7 @@
 
 For the common stone attribute @code{freeze_check}, see @ref{Freeze Checking}.
 
- at node Stone List, Breakable Stones, Stones, Stones
+ at node Stone List, Breakable-Stones, Stones, Stones
 @subsection Stone List
 
 @strong{Simple stones}
@@ -4696,7 +5091,7 @@
 st-yinyang@{1..3@}
 @end example
 
- at node Glassstones, Breakable Stones, Stone List, Stones
+ at node Glassstones, Breakable-Stones, Stone List, Stones
 @subsection Glassstones
 
 There are a few kinds of glassstones, all similar, but with different details.
@@ -4730,8 +5125,8 @@
 such a frame and cannot be moved by an invisible actor.
 
 
- at node Breakable Stones, Oxyd Compatibility Stones, Glassstones, Stones
- at subsection Breakable Stones
+ at node Breakable-Stones, Oxyd Compatibility Stones, Glassstones, Stones
+ at subsection Breakable-Stones
 
 A list of all breakable stones and what may break them. Messages are
 given in quotation marks. ``pyro'' is short for dynamite, bombs,
@@ -4790,7 +5185,7 @@
 can be transformed into and out of @code{st-firebreak[_move]}.
 
 
- at node Oxyd Compatibility Stones, st-actorimpulse, Breakable Stones, Stones
+ at node Oxyd Compatibility Stones, st-actorimpulse, Breakable-Stones, Stones
 @subsection Oxyd Compatibility Stones
 
 @code{st-magic} disappears when hit hard enough.
@@ -4985,7 +5380,7 @@
 When hit, @code{st-bombs} adds an @ref{it-blackbomb} to the
 inventory.  It can be destroyed with explosions from
 @ref{it-blackbomb}, @ref{it-whitebomb} and other bombstones (see
- at ref{Breakable Stones}).  When exploding, it ignites items below it. It
+ at ref{Breakable-Stones}).  When exploding, it ignites items below it. It
 also ignites @ref{it-dynamite} beneath it, but not @code{it-blackbomb}
 or @code{it-whitebomb}.
 
@@ -5298,7 +5693,7 @@
 The fart stone has the unpleasant habit of ``blowing off'' when
 triggered (by actor hit or signal) and will close all Oxyd stones.
 It can be destroyed with lasers and @ref{it-hammer}, see also
- at ref{Breakable Stones}.
+ at ref{Breakable-Stones}.
 
 @strong{Messages}
 
@@ -5788,12 +6183,12 @@
 
 The solid version additionally becomes @code{st-plain_cracked} when hit
 by a laser beam and can then be destroyed with an @ref{it-hammer} or
-explosions (see @ref{Breakable Stones}).  The hollow version is
+explosions (see @ref{Breakable-Stones}).  The hollow version is
 transparent to lasers.  Note that @code{st-plain_cracked} doesn't
 become transparent or hollow by messages.
 
 @code{st-plain_move} is a movable and breakable stone (see
- at ref{Breakable Stones}) that looks identical to @code{st-plain}. It
+ at ref{Breakable-Stones}) that looks identical to @code{st-plain}. It
 falls into @ref{fl-abyss}, @ref{fl-water} and @ref{fl-swamp}, but only
 when moved. @code{st-plain_move} and @code{st-plain} can be
 transformed into @ref{st-firebreak[_move]} with @ref{it-pencil}, and
@@ -5824,7 +6219,7 @@
 of them has the ability to trigger between solid and hollow:
 @code{st-plain_move}, @code{st-plain_breaking},
 @code{st-plain_falling}, @code{st-plain_break} and
- at code{st-plain-cracked}.  See @ref{Breakable Stones} for them, and
+ at code{st-plain-cracked}.  See @ref{Breakable-Stones} for them, and
 @ref{st-door} for stones with similar functions like @code{st-plain}.
 
 
@@ -6122,7 +6517,7 @@
 @code{st-knight}, @code{st-thief}, @code{st-plain_break},
 @code{st-plain_breaking}, or another @code{st-surprise}
 (see @ref{st-grate}, @ref{st-death}, @ref{Oxyd Compatibility Stones},
- at ref{st-knight}, @ref{st-thief}, and @ref{Breakable Stones}). The corresponding
+ at ref{st-knight}, @ref{st-thief}, and @ref{Breakable-Stones}). The corresponding
 item is @ref{it-surprise}.
 
 
@@ -6325,7 +6720,7 @@
 other stones.  Other items are destroyed by this.
 
 While active (not while growing or while inactive), a volcano
-stone can be broken with @ref{it-hammer} (see @ref{Breakable Stones}).
+stone can be broken with @ref{it-hammer} (see @ref{Breakable-Stones}).
 
 @strong{Messages}
 
@@ -6513,7 +6908,7 @@
 @subsection ac-bug
 
 A small, passive marble.  It can be used to break @code{st-bug} (see
- at ref{Breakable Stones}), to pass @code{st-grate3} (see @ref{st-grate})
+ at ref{Breakable-Stones}), to pass @code{st-grate3} (see @ref{st-grate})
 to open oxyds, etc.  It can't shatter or die.
 
 @c @strong{Attributes}
@@ -7149,7 +7544,7 @@
 @end defvar
 
 
- at node Old API - Functions, Function Index, Old API - Variables, Top
+ at node Old API - Functions, Object Index, Old API - Variables, Top
 @chapter Old API - Functions
 
 @menu
@@ -7995,7 +8390,7 @@
 @end example
 
 @c ......................................................................
- at node set_stones, Function Index, set_stone, Old API - Functions
+ at node set_stones, Object Index, set_stone, Old API - Functions
 @section set_stones
 
 @defun set_stones (stonename, positions, attribs)
@@ -8033,7 +8428,22 @@
 
 @c ......................................................................
 
- at node Function Index, Concept Index, Old API - Functions, Top
+ at node Object Index, Attribute Index, Old API - Functions, Top
+ at unnumbered Object Index
+
+ at printindex ob
+
+ at node Attribute Index, Message Index, Object Index, Top
+ at unnumbered Attribute Index
+
+ at printindex at
+
+ at node Message Index, Function Index, Attribute Index, Top
+ at unnumbered Message Index
+
+ at printindex ms
+
+ at node Function Index, Concept Index, Message Index, Top
 @unnumbered Function Index
 
 @syncodeindex vr tp



From andreasl at mail.berlios.de  Mon Jan 21 01:37:14 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Mon, 21 Jan 2008 01:37:14 +0100
Subject: [Enigma-game-svn] r995 - / feature_branches
Message-ID: <200801210037.m0L0bEFC008423@sheep.berlios.de>

Author: andreasl
Date: 2008-01-21 01:37:13 +0100 (Mon, 21 Jan 2008)
New Revision: 995

Added:
   feature_branches/
   feature_branches/hp_lotm/
Log:
Created directory for feature branchs.
Created LotM-branch of homepage as feature branch.


Copied: feature_branches/hp_lotm (from rev 994, homepage)



From andreasl at mail.berlios.de  Mon Jan 21 01:57:38 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Mon, 21 Jan 2008 01:57:38 +0100
Subject: [Enigma-game-svn] r996 - in feature_branches/hp_lotm: images/lotm
	input input/articles input/lotm
Message-ID: <200801210057.m0L0vcsb010669@sheep.berlios.de>

Author: andreasl
Date: 2008-01-21 01:57:25 +0100 (Mon, 21 Jan 2008)
New Revision: 996

Added:
   feature_branches/hp_lotm/images/lotm/lotm_200802.png
   feature_branches/hp_lotm/images/lotm/lotm_200802_a.png
   feature_branches/hp_lotm/images/lotm/lotm_200802_b.png
   feature_branches/hp_lotm/images/lotm/lotm_200802_c.png
   feature_branches/hp_lotm/images/lotm/lotm_200802_d.png
   feature_branches/hp_lotm/input/lotm/lotm_200802.html
Modified:
   feature_branches/hp_lotm/input/articles/eoya_2007.html
   feature_branches/hp_lotm/input/articles/eoya_2007_de.html
   feature_branches/hp_lotm/input/articles/eoya_2007_ru.html
   feature_branches/hp_lotm/input/infobox.html
   feature_branches/hp_lotm/input/infobox_de.html
   feature_branches/hp_lotm/input/infobox_ru.html
   feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua
   feature_branches/hp_lotm/input/lotm/lotm_core.html
   feature_branches/hp_lotm/input/lotm/lotm_core_de.html
   feature_branches/hp_lotm/input/lotm/lotm_core_ru.html
Log:
LotM:
 - Preparations for LotM 2008/02:
    Archive data, infobox, English article stub with records, level images.
 - EoYA 2007:
    - Added EoYA-icon to the EoYA-article.
    - Added link to EoYA-article to lotm_core-page.
Todo:
 - Test EoYA-article format on MS IE.


Added: feature_branches/hp_lotm/images/lotm/lotm_200802.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200802.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200802_a.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200802_a.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200802_b.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200802_b.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200802_c.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200802_c.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200802_d.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200802_d.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: feature_branches/hp_lotm/input/articles/eoya_2007.html
===================================================================
--- feature_branches/hp_lotm/input/articles/eoya_2007.html	2008-01-21 00:37:13 UTC (rev 995)
+++ feature_branches/hp_lotm/input/articles/eoya_2007.html	2008-01-21 00:57:25 UTC (rev 996)
@@ -1,12 +1,19 @@
 <div class="lotm">
+
+<table border="0">
+<tr><td>
 <h2>End of Year Awards 2007</h2>
-
 <p>During the past month, we asked our dear readers to vote for the best levels
 Enigma has to offer, in five categories, and to answer some questions of a
 general nature. Many thanks to all those who took the time (and it was a long
 questionnaire after all) and gave us the answers we were longing for. Instead of
 a Level-of-the-Month-January article, we now present the results of this
 poll.</p>
+</td><td>
+<p><img class="leftimage" src="$$imagedir$$/articles/eoya_2007.png"
+alt="EoYA 2007" border="0"></p>
+</td></tr>
+</table>
 
 <h3>Results of the general questions</h3>
 

Modified: feature_branches/hp_lotm/input/articles/eoya_2007_de.html
===================================================================
--- feature_branches/hp_lotm/input/articles/eoya_2007_de.html	2008-01-21 00:37:13 UTC (rev 995)
+++ feature_branches/hp_lotm/input/articles/eoya_2007_de.html	2008-01-21 00:57:25 UTC (rev 996)
@@ -1,4 +1,7 @@
 <div class="lotm">
+
+<table border="0">
+<tr><td>
 <h2>Jahresendauszeichnungen 2007</h2>
 
 <p>W&auml;hrend des vergangenen Monats haben wir unsere lieben Leser gebeten,
@@ -8,6 +11,11 @@
 ein ziemlich langer Fragebogen) und uns die Antworten gaben, nach denen wir
 suchten. Anstelle eines Level-des-Monats-Januar-Artikel, pr&auml;sentieren wir
 nun die Ergebnisse dieser Umfrage. </p>
+</td><td>
+<p><img class="leftimage" src="$$imagedir$$/articles/eoya_2007.png"
+alt="EoYA 2007" border="0"></p>
+</td></tr>
+</table>
 
 <h3>Ergebnisse der allgemeinen Fragen</h3>
 

Modified: feature_branches/hp_lotm/input/articles/eoya_2007_ru.html
===================================================================
--- feature_branches/hp_lotm/input/articles/eoya_2007_ru.html	2008-01-21 00:37:13 UTC (rev 995)
+++ feature_branches/hp_lotm/input/articles/eoya_2007_ru.html	2008-01-21 00:57:25 UTC (rev 996)
@@ -1,7 +1,15 @@
 <div class="lotm">
+
+<table border="0">
+<tr><td>
 <h2>??????? ????? ???? 2007</h2>
 
 <p>?? ?????????? ?????????? ?????? ?? ??????? ????? ????????? ????????? ????????????? ?? ?????? ?? ???????????? ??????? Enigma, ? ???? ??????????, ? ???????? ?? ????????? ????? ????????. ??????? ??????? ???? ???, ??? ?????? ????? (? ??? ? ????? ??? ??????? ?????) ? ??? ??? ????????? ??????. ?????? ??????, ??????????? ?????????? ?????? ??????, ?????? ?? ?????????? ?????????? ????? ??????.</p>
+</td><td>
+<p><img class="leftimage" src="$$imagedir$$/articles/eoya_2007.png"
+alt="EoYA 2007" border="0"></p>
+</td></tr>
+</table>
 
 <h3>?????????? ????? ????????</h3>
 

Modified: feature_branches/hp_lotm/input/infobox.html
===================================================================
--- feature_branches/hp_lotm/input/infobox.html	2008-01-21 00:37:13 UTC (rev 995)
+++ feature_branches/hp_lotm/input/infobox.html	2008-01-21 00:57:25 UTC (rev 996)
@@ -4,12 +4,12 @@
          The Enigma Team wishes everyone a Happy New Year!
          Let's hope for many new levels in 2008&mdash;some are
          already in the starting blocks &hellip;
-         <!--<h3>Level of the Month</h3>
+         <h3>Level of the Month</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
-         </div>  -->
+         </div>
          <h3>End-of-Year Awards</h3>
          <a href="$$eoya_2007$$"><img src="images/articles/eoya_2007.png"
          alt="Which might be the Level of the Year?" border="0"></a>

Modified: feature_branches/hp_lotm/input/infobox_de.html
===================================================================
--- feature_branches/hp_lotm/input/infobox_de.html	2008-01-21 00:37:13 UTC (rev 995)
+++ feature_branches/hp_lotm/input/infobox_de.html	2008-01-21 00:57:25 UTC (rev 996)
@@ -4,12 +4,12 @@
          Das Enigma-Team w&uuml;nscht allen ein frohes neues Jahr!
          Lasst uns auf viele neue Levels in 2008 hoffen - einige
          stehen bereits in den Startbl&ouml;cken &hellip;
-         <!--<h3>Level des Monats</h3>
+         <h3>Level des Monats</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
-         </div>-->
+         </div>
          <h3>Jahresend-<br>auszeichnungen</h3>
          <a href="$$eoya_2007$$"><img src="images/articles/eoya_2007.png"
          alt="Welches mag der Level des Jahres sein?" border="0"></a>

Modified: feature_branches/hp_lotm/input/infobox_ru.html
===================================================================
--- feature_branches/hp_lotm/input/infobox_ru.html	2008-01-21 00:37:13 UTC (rev 995)
+++ feature_branches/hp_lotm/input/infobox_ru.html	2008-01-21 00:57:25 UTC (rev 996)
@@ -3,12 +3,12 @@
          <h3>??????????? IV/2!</h3>
          ??????? Enigma ?????? ??????? ??????????? ?????? ????!
          ?? ???? ????? ????? ??????? ? 2008&mdash;????????? ??? ? ?????????? &hellip;
-         <!--<h3>Level of the Month</h3>
+         <h3>Level of the Month</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
-         </div>  -->
+         </div>
          <h3>??????? ????? ????</h3>
          <a href="$$eoya_2007$$"><img src="images/articles/eoya_2007.png"
          alt="????? ????? ???? ??????? ?????" border="0"></a>

Added: feature_branches/hp_lotm/input/lotm/lotm_200802.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200802.html	2008-01-21 00:37:13 UTC (rev 995)
+++ feature_branches/hp_lotm/input/lotm/lotm_200802.html	2008-01-21 00:57:25 UTC (rev 996)
@@ -0,0 +1,66 @@
+<div class="lotm">
+$$lotm_header$$
+<h3 class="lotm">
+<span class="date">February 2008: </span>
+&quot;Puzzle Puzzles&quot;, by Raoul Bourquin
+</h3>
+
+<p>It starts a little bit like &quot;Sierpinsky&quot;, our Level of the Month
+February 2008&mdash;curling its way through the first two screens, our dear
+black marble might think of yet another dexterity challenge. But as it
+approaches the third, and then the fourth screen, the level unfolds like a
+Julia set we were pilgrimaging, and ahead of us lies a landscape filled with
+puzzles, convoluted more than any fractal could be. Welcome to &quot;Puzzle
+Puzzles&quot;!</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200802_a.png" alt="Level of the month" border="0">
+<div class="imagetitle">Enigma VI # 55 - Puzzle Puzzles</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Some records of December 2007</caption>
+<colgroup>
+   <col width="80">
+   <col width="160">
+</colgroup>
+    <tr><td class="num">6:11</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">8:21</td>
+        <td class="left">Raoul</td></tr>
+    <tr><td class="num">12:17</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">16:16</td>
+        <td class="left">Tarim</td></tr>
+    <tr><td class="num">16:26</td>
+        <td class="left">ryujun</td></tr>
+</table>
+
+<p></p>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Easy Mode</caption>
+<colgroup>
+   <col width="80">
+   <col width="160">
+</colgroup>
+    <tr><td class="num">6:53</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">10:16</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">10:21</td>
+        <td class="left">Raoul</td></tr>
+    <tr><td class="num">13:02</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">13:58</td>
+        <td class="left">Taztunes</td></tr>
+</table>
+
+<p>libpuzzle</p>
+
+<h4>Headline</h4>
+
+<p>Best greets,<br>
+<i>Andreas &amp; Harry</i></p>
+
+</div>

Modified: feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua	2008-01-21 00:37:13 UTC (rev 995)
+++ feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua	2008-01-21 00:57:25 UTC (rev 996)
@@ -94,20 +94,29 @@
   position_num   = "7024"
 }
 
+lotm_archive_data[11] = {
+  date           = { month = 2, year = 2008 },
+  chronological  = 11,
+  name           = "Puzzle Puzzles",
+  author         = "Raoul Bourquin",
+  position       = "VI/55",
+  position_num   = "6055"
+}
 
 -- LotM variable data
 -- format: Level Title, current_rating, current_votes, additional text
 
 lotm_rating(    "Island Labyrinth",  9.25,   8,  "")
 lotm_rating(  "Pneumatic Delivery",  7.86,  14,  "")
-lotm_rating(    "The Aztec Temple",  9.10,  10,  "(3 down)")
-lotm_rating("Labyrinth of Puzzles",  8.92,  13,  "(1 down)")
+lotm_rating(    "The Aztec Temple",  9.10,  10,  "")
+lotm_rating("Labyrinth of Puzzles",  8.92,  13,  "")
 lotm_rating(           "Elaborate",  8.63,   8,  "")
-lotm_rating(             "Houdini",  9.18,  10,  "(3 up)")
+lotm_rating(             "Houdini",  9.18,  10,  "")
 lotm_rating(           "Tool Time",  8.60,  20,  "")
-lotm_rating(         "Quadropolis",  9.20,  10,  "(1 up)")
+lotm_rating(         "Quadropolis",  9.20,  10,  "")
 lotm_rating(      "Big Adventures",  8.43,  21,  "")
 lotm_rating(      "Temple of Gold",  9.17,   6,  "")
+lotm_rating(      "Puzzle Puzzles",  8.40,   5,  "<b>(newcomer)</b>")
 
 -- Don't forget to adjust the archive dates:
 

Modified: feature_branches/hp_lotm/input/lotm/lotm_core.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_core.html	2008-01-21 00:37:13 UTC (rev 995)
+++ feature_branches/hp_lotm/input/lotm/lotm_core.html	2008-01-21 00:57:25 UTC (rev 996)
@@ -32,6 +32,9 @@
 $$parse_lotm$$
   </table>
 
+  <p>You may find the article about the <b>End-of-Year-Awards 2007</b>
+  <a href="$$eoya_2007$$">here</a>.</p>
+  
   <div class="lotmhistory">
     <a href="$$imagedir$$/lotm/lotm-history.png">
     <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">

Modified: feature_branches/hp_lotm/input/lotm/lotm_core_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_core_de.html	2008-01-21 00:37:13 UTC (rev 995)
+++ feature_branches/hp_lotm/input/lotm/lotm_core_de.html	2008-01-21 00:57:25 UTC (rev 996)
@@ -34,6 +34,9 @@
 $$parse_lotm$$
   </table>
 
+  <p>Sie finden den Artikel zu den <b>Jahresendauszeichnungen 2007</b>
+  <a href="$$eoya_2007$$">hier</a>.</p>
+
   <div class="lotmhistory">
     <a href="$$imagedir$$/lotm/lotm-history.png">
     <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">

Modified: feature_branches/hp_lotm/input/lotm/lotm_core_ru.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_core_ru.html	2008-01-21 00:37:13 UTC (rev 995)
+++ feature_branches/hp_lotm/input/lotm/lotm_core_ru.html	2008-01-21 00:57:25 UTC (rev 996)
@@ -29,6 +29,9 @@
 $$parse_lotm$$
   </table>
 
+  <p>You may find the article about the <b>End-of-Year-Awards 2007</b>
+  <a href="$$eoya_2007$$">here</a>.</p>
+  
   <div class="lotmhistory">
     <a href="$$imagedir$$/lotm/lotm-history.png">
     <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">



From raoul at mail.berlios.de  Mon Jan 21 23:54:53 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Mon, 21 Jan 2008 23:54:53 +0100
Subject: [Enigma-game-svn] r997 - in trunk: data src src/stones
Message-ID: <200801212254.m0LMsrbx022154@sheep.berlios.de>

Author: raoul
Date: 2008-01-21 23:54:52 +0100 (Mon, 21 Jan 2008)
New Revision: 997

Added:
   trunk/src/stones/KeySwitch.cc
   trunk/src/stones/KeySwitch.hh
Modified:
   trunk/data/init.lua
   trunk/src/Makefile.am
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/st_switches.cc
   trunk/src/stones.hh
   trunk/src/world.cc
Log:
Trunk 1.1: Reengineering

-> KeySwitch finished



Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-21 00:57:25 UTC (rev 996)
+++ trunk/data/init.lua	2008-01-21 22:54:52 UTC (rev 997)
@@ -65,6 +65,25 @@
 end
 
 function enigma.MakeObject(name)
+    if name == "st-key" then
+        local obj = enigma._MakeObject("st_key")
+        -- Old API keycode default was 0 for st-key, but 1 for it-key!
+        enigma._SetAttrib(obj, "keycode", 0)
+        return obj
+    elseif name == "st-key_a" then
+        local obj = enigma._MakeObject("st_key")
+        enigma._SetAttrib(obj, "keycode", 1)
+        return obj
+    elseif name == "st-key_b" then
+        local obj = enigma._MakeObject("st_key")
+        enigma._SetAttrib(obj, "keycode", 2)
+        return obj
+    elseif name == "st-key_c" then
+        local obj = enigma._MakeObject("st_key")
+        enigma._SetAttrib(obj, "keycode", 3)
+        return obj
+    end
+
     newname = RenamingObjectsOld2New[name]
     if newname ~= nil then
         return enigma._MakeObject(newname)
@@ -76,6 +95,21 @@
 function enigma.GetKind(obj)
     local _newname = enigma._GetKind(obj)
     local _oldname = RenamingObjectsNew2Old[_newname]
+
+    if _newname == "st_key" then
+        local code = enigma._GetAttrib(obj, "keycode")
+        if code == 0 then
+            return "st-key"
+        elseif code == 1 then
+            return "st-key_a"
+        elseif code == 2 then
+            return "st-key_b"
+        elseif code == 3 then
+            return "st-key_c"
+        else -- arbitrary keycodes
+            return "st-key"
+        end
+    end
     if _oldname ~= nil then
         return _oldname
     else
@@ -87,6 +121,7 @@
      local _val = val
      local _key = key
      local _obj_name = enigma.GetKind(obj)
+
      if _obj_name == "st-oxyd" then
          if key == "color" then
 	     _val = 0 + val   -- convert to int
@@ -123,7 +158,9 @@
         if (d == nil) or (type(d) ~= "table") then
             d = {}
         end
+
         local c = {}
+
         for str in string.gmatch(val, "%d+") do
             table.insert(c, 0 + str)
         end
@@ -145,20 +182,17 @@
 function enigma.GetAttrib(obj, key)
      local _key = key
      local _obj_name = enigma.GetKind(obj)
-
      if (_obj_name == "st-switch") or (_obj_name == "st-switch_black")
              or (_obj_name == "st-switch_white") 
              or (_obj_name == "st-floppy") then
          if key == "on" then
 	     _key = "state"
-	 end
+	     end
      end
      if key == "blackball" or key == "whiteball" then
          _key = "color"
      end
-
      local val = enigma._GetAttrib(obj, _key)
-     
      if key == "blackball" then
         if val == 0 then val = 1 else val = 0 end
      end
@@ -212,6 +246,7 @@
     ["st-fart__trigger"] = "toggle",
     st_fourswitch__trigger = "toggle",
     st_floppy__onoff = "toggle",
+    st_key__onoff = "toggle",
     ["st-stoneimpulse__trigger"] = "signal",
     ["st-stoneimpulse-hollow__trigger"] = "signal",
     ["st-stoneimpulse_movable__trigger"] = "signal",

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-01-21 00:57:25 UTC (rev 996)
+++ trunk/src/Makefile.am	2008-01-21 22:54:52 UTC (rev 997)
@@ -197,6 +197,8 @@
 	stones/FloppySwitch.cc   \
 	stones/FourSwitch.cc	\
 	stones/FourSwitch.hh	\
+	stones/KeySwitch.cc	\
+	stones/KeySwitch.hh	\
 	stones/OxydStone.cc	\
 	stones/OxydStone.hh	\
 	stones/Switch.cc	\

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-01-21 00:57:25 UTC (rev 996)
+++ trunk/src/ox_magnum.cc	2008-01-21 22:54:52 UTC (rev 997)
@@ -170,7 +170,7 @@
     "st_floppy",                // OxydMagnum stone 0x2d (in normal Oxyd Magnum Levels unused!)
     UNUSED,                     // OxydMagnum stone 0x2e
     "st_fourswitch",            // OxydMagnum stone 0x2f (Level 89 and 92)
-    "st-key",                   // OxydMagnum stone 0x30
+    "st_key",                   // OxydMagnum stone 0x30
     "st-floppy",                // OxydMagnum stone 0x31
     "st-knight",                // OxydMagnum stone 0x32
     "st_fourswitch",            // OxydMagnum stone 0x33 (Level 51 and 100)

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-01-21 00:57:25 UTC (rev 996)
+++ trunk/src/ox_oxyd1.cc	2008-01-21 22:54:52 UTC (rev 997)
@@ -200,7 +200,7 @@
     "st_switch_black_instant",  // Oxyd1 stone 0x2d
     "st_switch_white_instant",  // Oxyd1 stone 0x2e
     "st_fourswitch",            // Oxyd1 stone 0x2f
-    "st-key",                   // Oxyd1 stone 0x30
+    "st_key",                   // Oxyd1 stone 0x30
     "st_floppy",                // Oxyd1 stone 0x31
     "st-knight",                // Oxyd1 stone 0x32
     0,                          // Oxyd1 stone 0x33 oscillator (properties set in oxyd.cc)

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-01-21 00:57:25 UTC (rev 996)
+++ trunk/src/ox_peroxyd.cc	2008-01-21 22:54:52 UTC (rev 997)
@@ -238,7 +238,7 @@
     "st_switch_black_instant",  // PerOxyd stone 0x29
     "st_switch_white_instant",  // PerOxyd stone 0x2a
     "st_fourswitch",            // PerOxyd stone 0x2b
-    "st-key",                   // PerOxyd stone 0x2c
+    "st_key",                   // PerOxyd stone 0x2c
     "st_floppy",                // PerOxyd stone 0x2d
     "",                         // PerOxyd stone 0x2e (?)
     "st-death",                 // PerOxyd stone 0x2f

Modified: trunk/src/st_switches.cc
===================================================================
--- trunk/src/st_switches.cc	2008-01-21 00:57:25 UTC (rev 996)
+++ trunk/src/st_switches.cc	2008-01-21 22:54:52 UTC (rev 997)
@@ -129,107 +129,6 @@
     }
 }
 
-
-/* -------------------- Key switches -------------------- */
-
-// Attributes:
-//
-// :keycode         a numerical code; only keys with the same code
-//                  can activate this switch
-// :on              1 or 0
-// :target,action   as usual
-
-/** \page st-key Key Switch Stone
-
-This stone acts as a lock and can only be activated by
-using a key item. You can use keycodes to let keys only
-open specific key stones.
-
-\subsection keye Example
-\verbatim
-set_stone( "st-key_b", 14,77, {action="openclose", target="door2"})
-set_item("it-key_b", 12,7)
-\endverbatim
-
-\image html st-key0.png
-*/
-namespace
-{
-    class KeyStone : public OnOffStone {
-        CLONEOBJ(KeyStone);
-
-        void init_model() {set_model(is_on() ? "st-key1" : "st-key0");}
-        void actor_hit(const StoneContact &sc);
-        const char *collision_sound() { return "metal"; }
-        bool check_matching_key (enigma::Inventory *inv);
-    public:
-        KeyStone(const char *kind="st-key", int keycode=0) 
-        : OnOffStone(kind) 
-        {
-            set_attrib("keycode", keycode);
-        }
-    };
-
-    class KeyStone_a : public KeyStone {
-        CLONEOBJ(KeyStone_a);
-    public:
-        KeyStone_a() : KeyStone("st-key_a", 1) {}
-    };
-    class KeyStone_b : public KeyStone {
-        CLONEOBJ(KeyStone_b);
-    public:
-        KeyStone_b() : KeyStone("st-key_b", 2) {}
-    };
-    class KeyStone_c : public KeyStone {
-        CLONEOBJ(KeyStone_c);
-    public:
-        KeyStone_c() : KeyStone("st-key_c", 3) {}
-    };
-}
-
-bool KeyStone::check_matching_key (enigma::Inventory *inv)
-{
-    Item *it = inv->get_item(0);
-    return (it
-            && it->is_kind("it-key*")
-            && it->getAttr("keycode") == getAttr("keycode"));
-}
-
-void KeyStone::actor_hit(const StoneContact &sc)
-{
-    enigma::Inventory *inv = player::GetInventory(sc.actor);
-    if (!inv)
-        return;
-
-    bool toggle = false;
-
-    if (server::GameCompatibility == enigma::GAMET_ENIGMA) {
-        if (is_on()) {
-            if (!inv->is_full()) {
-                Item *key = MakeItem("it-key");
-                key->set_attrib ("keycode", getAttr("keycode"));
-                inv->add_item(key);
-                toggle = true;
-            }
-        }
-        else if (check_matching_key (inv)) {
-            DisposeObject (inv->yield_first());
-            toggle = true;
-        }
-        player::RedrawInventory (inv);
-    }
-    else {
-        if (check_matching_key (inv))
-            toggle = true;
-    }
-
-    if (toggle) {
-        set_on (!is_on());
-        performAction(is_on());
-    }
-}
-
-
 /* -------------------- Laser / Time switches -------------------- */
 
 namespace
@@ -433,10 +332,6 @@
 void InitSwitches()
 {
     Register (new CoinSlot);
-    Register (new KeyStone);
-    Register (new KeyStone_a);
-    Register (new KeyStone_b);
-    Register (new KeyStone_c);
     Register (new LaserSwitch);
     Register (new LaserTimeSwitch);
     Register (new TimeSwitch);

Added: trunk/src/stones/KeySwitch.cc
===================================================================
--- trunk/src/stones/KeySwitch.cc	2008-01-21 00:57:25 UTC (rev 996)
+++ trunk/src/stones/KeySwitch.cc	2008-01-21 22:54:52 UTC (rev 997)
@@ -0,0 +1,101 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2007 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/KeySwitch.hh"
+#include "server.hh"
+#include "Inventory.hh"
+#include "player.hh"
+
+namespace enigma {
+    KeySwitch::KeySwitch() : Stone () {
+        set_attrib("keycode", Value(1));
+    }
+
+    void KeySwitch::setState(int extState) {
+        if (isDisplayable()) {
+            if (state == OFF && extState != state) {
+                sound_event ("switchon");
+                state = ON;
+                init_model();
+                performAction(state);
+            } else if (state == ON && extState != state) {
+                sound_event ("switchon");
+                state = OFF;
+                init_model();
+                performAction(state);
+            }
+        } else
+            state = extState;
+    }
+
+    void KeySwitch::init_model() {
+        set_model(ecl::strf("st-key%s", state == ON ? "1" : "0"));
+    }
+
+    void KeySwitch::actor_hit(const StoneContact &sc) {
+        enigma::Inventory *inv = player::GetInventory(sc.actor);
+        if (!inv)
+            return;
+
+        bool toggle = false;
+
+        if (server::GameCompatibility == enigma::GAMET_ENIGMA) {
+            if (state == ON) {
+                if (!inv->is_full()) {
+                    Item *key = MakeItem("it-key");
+                    key->set_attrib ("keycode", getAttr("keycode"));
+                    inv->add_item(key);
+                    toggle = true;
+                }
+            }
+            else if (check_matching_key(inv)) {
+                DisposeObject(inv->yield_first());
+                toggle = true;
+            }
+            player::RedrawInventory (inv);
+        }
+        else {
+            if (check_matching_key(inv))
+                toggle = true;
+        }
+
+        if (toggle)
+            setState(ON - state);
+    }
+
+    const char *KeySwitch::collision_sound() {
+         return "metal";
+    }
+
+    bool KeySwitch::check_matching_key(enigma::Inventory *inv)
+    {
+        Item *it = inv->get_item(0);
+        return (it
+             && it->is_kind("it-key*")
+             && it->getAttr("keycode") == getAttr("keycode"));
+    }
+
+    DEF_TRAITS(KeySwitch, "st_key", st_key);
+
+    BOOT_REGISTER_START
+        BootRegister(new KeySwitch(), "st_key");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/KeySwitch.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/KeySwitch.hh
===================================================================
--- trunk/src/stones/KeySwitch.hh	2008-01-21 00:57:25 UTC (rev 996)
+++ trunk/src/stones/KeySwitch.hh	2008-01-21 22:54:52 UTC (rev 997)
@@ -0,0 +1,62 @@
+/*
+ * Copyright (C) 2007 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef KEYSWITCH_HH
+#define KEYSWITCH_HH
+
+#include "stones.hh"
+#include "stones_internal.hh"
+#include "Inventory.hh"
+
+namespace enigma {
+
+    /** 
+     * This stone acts as a lock and can only be activated by
+     * using a key item. You can use keycodes to let keys only
+     * open specific key stones.<p>
+     * It is a StateObject with 2 internal states as the
+     * state changes are not animated. The messages
+     * "toggle", "signal", "on", "off" and get/set of the state are fully supported.
+     * The keyswitch starts per default in state OFF.<p>
+     * They can
+     * send inverse action values by setting the "inverse" attribute.
+     */
+    class KeySwitch : public Stone {
+        CLONEOBJ(KeySwitch);
+        DECL_TRAITS;
+    private:
+        enum iState { OFF, ON };
+    public:
+        KeySwitch();
+
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+        virtual const char *collision_sound();
+    private:
+        bool check_matching_key(enigma::Inventory *inv);
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/KeySwitch.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-01-21 00:57:25 UTC (rev 996)
+++ trunk/src/stones.hh	2008-01-21 22:54:52 UTC (rev 997)
@@ -60,6 +60,7 @@
         st_floppy,
         st_fourswitch,
         st_greenbrown_growing,
+        st_key,
         st_knight,
         st_laserbreak,
         st_magic,

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-01-21 00:57:25 UTC (rev 996)
+++ trunk/src/world.cc	2008-01-21 22:54:52 UTC (rev 997)
@@ -1850,7 +1850,7 @@
     // activate which key hole
     if (src->getObjectType() == Object::ITEM) {
         ItemID src_id = get_id(dynamic_cast<Item *>(src));
-        if (src_id >= it_key_a && src_id <= it_key_c && dst->is_kind("st-key")) {
+        if (src_id >= it_key_a && src_id <= it_key_c && dst->is_kind("st_key")) {
             dst->set_attrib("keycode", src->getAttr("keycode"));
             return;
         }



From raoul at mail.berlios.de  Tue Jan 22 00:00:39 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Tue, 22 Jan 2008 00:00:39 +0100
Subject: [Enigma-game-svn] r998 - team_levelpacks/team_test_new_api
Message-ID: <200801212300.m0LN0dcw022807@sheep.berlios.de>

Author: raoul
Date: 2008-01-22 00:00:39 +0100 (Tue, 22 Jan 2008)
New Revision: 998

Added:
   team_levelpacks/team_test_new_api/raoulT01_1.xml
   team_levelpacks/team_test_new_api/raoulT02_1.xml
Log:
-> Testlevels: new API FloppySwitch and KeySwitch


Added: team_levelpacks/team_test_new_api/raoulT01_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT01_1.xml	2008-01-21 22:54:52 UTC (rev 997)
+++ team_levelpacks/team_test_new_api/raoulT01_1.xml	2008-01-21 23:00:39 UTC (rev 998)
@@ -0,0 +1,74 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test FloppySwitch new API" el:subtitle="" el:id="testfloppyswitch_raoul"/>
+      <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
+      <el:author  el:name="Raoul Bourquin" el:email="raoul at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Raoul Bourquin</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+
+ti["0"] = ti[" "] .. {"#ac-blackball"}
+
+ti["5"] = ti[" "] .. {"st_switch", target="stfl1", action="signal"}
+ti["6"] = ti[" "] .. {"st_switch", target="stfl1", action="on"}
+ti["7"] = ti[" "] .. {"st_switch", target="stfl1", action="off"}
+ti["8"] = ti[" "] .. {"st_switch", target="stfl1", action="toggle"}
+
+ti["A"] = ti[" "] .. {"st_switch", name="da1"}
+ti["B"] = ti[" "] .. {"st_switch", name="da2"}
+ti["C"] = ti[" "] .. {"st_switch", name="da3"}
+ti["D"] = ti[" "] .. {"st_switch", name="da4"}
+ti["W"] = ti[" "] .. {"st_switch", name="da5"}
+ti["X"] = ti[" "] .. {"st_switch", name="da6"}
+ti["Y"] = ti[" "] .. {"st_switch", name="da7"}
+ti["Z"] = ti[" "] .. {"st_switch", name="da8"}
+
+ti["F"] = ti[" "] .. {"st_floppy", name="stfl1", target="da1", action="toggle"}
+ti["G"] = ti[" "] .. {"st_floppy", name="stfl2", target="da2", action="signal"}
+ti["H"] = ti[" "] .. {"st_floppy", name="stfl3", target="da3", action="on"}
+ti["I"] = ti[" "] .. {"st_floppy", name="stfl4", target="da4", action="off"}
+
+ti["J"] = ti[" "] .. {"st_floppy", name="stfl5", target="da5", action="toggle", inverse=true}
+ti["K"] = ti[" "] .. {"st_floppy", name="stfl6", target="da6", action="signal", inverse=true}
+ti["L"] = ti[" "] .. {"st_floppy", name="stfl7", target="da7", action="on", inverse=true}
+ti["M"] = ti[" "] .. {"st_floppy", name="stfl8", target="da8", action="off", inverse=true}
+
+ti["f"] = ti[" "] .. {"it-floppy"}
+
+w, h = wo(ti, " ", {
+"0  f   F      A    5",
+"   f   G      B    6",
+"   f   H      C    7",
+"   f   I      D    8",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"   f   J      W     ",
+"   f   K      X     ",
+"   f   L      Y     ",
+"   f   M      Z     "
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+     <el:string el:key="title">
+       <el:english el:translate="false"/>
+     </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/raoulT01_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/raoulT02_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT02_1.xml	2008-01-21 22:54:52 UTC (rev 997)
+++ team_levelpacks/team_test_new_api/raoulT02_1.xml	2008-01-21 23:00:39 UTC (rev 998)
@@ -0,0 +1,81 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test KeySwitch new API" el:subtitle="" el:id="testkeyswitch_raoul"/>
+      <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
+      <el:author  el:name="Raoul Bourquin" el:email="raoul at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Raoul Bourquin</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+
+ti["0"] = ti[" "] .. {"#ac-blackball"}
+
+ti["A"] = ti[" "] .. {"st_switch", name="da1", target="la5", action="onoff"}
+ti["B"] = ti[" "] .. {"st_switch", name="da2", target="la6", action="onoff"}
+ti["C"] = ti[" "] .. {"st_switch", name="da3", target="la7", action="onoff"}
+ti["D"] = ti[" "] .. {"st_switch", name="da4", target="la8", action="onoff"}
+
+ti["F"] = ti[" "] .. {"st_key", name="stk1", target="da1", action="toggle"}
+ti["G"] = ti[" "] .. {"st_key", name="stk2", target="da2", action="signal"}
+ti["H"] = ti[" "] .. {"st_key", name="stk3", target="da3", action="on"}
+ti["I"] = ti[" "] .. {"st_key", name="stk4", target="da4", action="off"}
+
+ti["1"] = ti[" "] .. {"st_key", keycode=1}
+ti["2"] = ti[" "] .. {"st_key", keycode=2}
+ti["3"] = ti[" "] .. {"st_key", keycode=3}
+ti["4"] = ti[" "] .. {"st_key", keycode=4}
+ti["5"] = ti[" "] .. {"st_key", keycode=5}
+
+ti["W"] = ti[" "] .. {"st-laser-e", name="la5"}
+ti["X"] = ti[" "] .. {"st-laser-e", name="la6"}
+ti["Y"] = ti[" "] .. {"st-laser-e", name="la7"}
+ti["Z"] = ti[" "] .. {"st-laser-e", name="la8"}
+
+ti["J"] = ti[" "] .. {"st_key", name="la5", target="da5", action="toggle", inverse=true}
+ti["K"] = ti[" "] .. {"st_key", name="la6", target="da6", action="signal", inverse=true}
+ti["L"] = ti[" "] .. {"st_key", name="la7", target="da7", action="on", inverse=true}
+ti["M"] = ti[" "] .. {"st_key", name="la8", target="da8", action="off", inverse=true}
+
+ti["a"] = ti[" "] .. {"it-key"}
+ti["b"] = ti[" "] .. {"it-key", keycode=1}
+ti["c"] = ti[" "] .. {"it-key", keycode=2}
+ti["d"] = ti[" "] .. {"it-key", keycode=3}
+ti["e"] = ti[" "] .. {"it-key", keycode=4}
+ti["f"] = ti[" "] .. {"it-key", keycode=5}
+
+w, h = wo(ti, " ", {
+"0  a   F      A     ",
+"   a   G      B     ",
+"   a   H      C     ",
+"   a   I      D     ",
+"                    ",
+"                    ",
+"   bcdef    12345   ",
+"                    ",
+"                    ",
+"   a   J      W     ",
+"   a   K      X     ",
+"   a   L      Y     ",
+"   a   M      Z     "
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+     <el:string el:key="title">
+       <el:english el:translate="false"/>
+     </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/raoulT02_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native



From andreasl at mail.berlios.de  Tue Jan 22 02:17:20 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Tue, 22 Jan 2008 02:17:20 +0100
Subject: [Enigma-game-svn] r999 - trunk/doc/reference
Message-ID: <200801220117.m0M1HKbn031389@sheep.berlios.de>

Author: andreasl
Date: 2008-01-22 02:17:17 +0100 (Tue, 22 Jan 2008)
New Revision: 999

Modified:
   trunk/doc/reference/enigma-ref.texi
Log:
Reference Manual:
 - removed superfluous arguments in @node-lines
 - masked curly braces in two occurences


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-01-21 23:00:39 UTC (rev 998)
+++ trunk/doc/reference/enigma-ref.texi	2008-01-22 01:17:17 UTC (rev 999)
@@ -18,7 +18,7 @@
 @contents
 
 @ifnottex
- at node Top, Running Enigma, (dir), (dir)
+ at node Top
 @top
 
 This manual describes the internals of
@@ -49,7 +49,7 @@
 * Concept Index::
 @end menu
 
- at node  Running Enigma, Level Basics, Top, Top
+ at node  Running Enigma
 @chapter Running Enigma
 
 Hopefully, after successfully installing and playing some first levels, you may be interested in
@@ -69,7 +69,7 @@
 * User Sound Sets::            How to create and install sound themes
 @end menu
 
- at node Locating Resources, Startup Switches, Running Enigma, Running Enigma
+ at node Locating Resources
 @section Locating Resources
 
 For reasons of backup, system changes, special configurations, level additions and hopefully
@@ -160,7 +160,7 @@
 in zipped and unzipped form, the plain file stored in a directory wins, since Enigma 
 assumes it to to be an update to the zip.
 
- at node Startup Switches, User Options, Locating Resources, Running Enigma
+ at node Startup Switches
 @section Startup Switches
 
 Besides starting Enigma by clicking on an installation-provided icon or start menu entry, you
@@ -251,7 +251,7 @@
 You will find these levels in a levelpack called @samp{Startup Levels}, which is
 only visible by default if you supplied levels on the commandline.
 
- at node User Options, Level Info, Startup Switches, Running Enigma
+ at node User Options
 @section User Options
 
 @table @asis
@@ -290,7 +290,7 @@
 
 @end table
 
- at node Level Info, Handicap and PAR, User Options, Running Enigma
+ at node Level Info
 @section Level Info
 
 @cindex levelinspector
@@ -311,7 +311,7 @@
 * Screenshots::
 @end menu
 
- at node Public Ratings, Scores, Level Info, Level Info
+ at node Public Ratings
 @subsection Public Ratings
 
 Most levels are rated within five different categories:
@@ -581,7 +581,7 @@
 appear in this combination, such as 2 or 99. Other combinations lead to full but narrow, or to
 broad but noncontinuous spectra.
 
- at node Scores, Versions, Public Ratings, Level Info
+ at node Scores
 @subsection Scores
 
 The score columns show your and some comparison values for the difficult and
@@ -612,7 +612,7 @@
 afterwards, are not taken into account. A low percentage is a hint that a level
 is not easy to solve.
 
- at node Versions, Private Annotations and Ratings, Scores, Level Info
+ at node Versions
 @subsection Versions
 
 The version column shows detailed information about the level. Read the chapter Level
@@ -626,7 +626,7 @@
 incompatible level update that requires a new solution with different, incomparable score
 values. The author will increase the score version number in such a case.
 
- at node Private Annotations and Ratings, Screenshots, Versions, Level Info
+ at node Private Annotations and Ratings
 @subsection Private Annotations and Ratings
 
 This textfield allows you to enter an annotation for a level that you can review
@@ -648,7 +648,7 @@
 suggestions by users. If you do not re-rate a new version of a level, Enigma inherits your rating
 from a previous version.
 
- at node Screenshots, , Private Annotations and Ratings, Level Info
+ at node Screenshots
 @subsection Screenshots
 
 While playing a level, you can make screenshots by pressing @key{F10}. You can make
@@ -664,7 +664,7 @@
 This may be a useful hint as to where to search the other screenshot files on your
 @samp{user image path} (@pxref{Locating Resources}).
 
- at node Handicap and PAR, User Sound Sets, Level Info, Running Enigma
+ at node Handicap and PAR
 @section Handicap and PAR
 
 As PAR (@pxref{Scores}) describes the difficulty of a level, the handicap @samp{hcp}
@@ -715,7 +715,7 @@
 Handicaps are stated with one digit behind the decimal point.
 
 
- at node User Sound Sets, , Handicap and PAR, Running Enigma
+ at node User Sound Sets
 @section User Sound Sets
 
 (The following information accounts only for Enigma 1.01 and above.)
@@ -853,7 +853,7 @@
 deactivate just one of them. 
 
 
- at node  Levelpack Basics, Level Basics, Running Enigma, Top
+ at node  Levelpack Basics
 @chapter Levelpack Basics
 
 Knowing the basics of running Enigma, you may wonder how levels are organized in
@@ -926,7 +926,7 @@
 * Composing Levelpacks::
 @end menu
 
- at node Getting Started with Levelpacks, Converting 0.92 Levelpacks, Levelpack Basics, Levelpack Basics
+ at node Getting Started with Levelpacks
 @section Getting Started with Levelpacks
 
 One of the outstanding features of Enigma is its extensibility by new levels.
@@ -978,7 +978,7 @@
 want to proceed directly to chapter @ref{Level Basics}. The rest of this chapter
 explains how to arrange and sort existing levels in your own levelpacks.
 
- at node Converting 0.92 Levelpacks, Zip Levelpacks, Getting Started with Levelpacks, Levelpack Basics
+ at node Converting 0.92 Levelpacks
 @section Converting 0.92 Levelpacks
 
 With the changes of the levelpack index format, converting old levelpacks is necessary. Although
@@ -1027,7 +1027,7 @@
 After converting your levelpacks, we strongly recommend that you update your own
 levels to the new XML format, as described in @ref{Level Basics}.
 
- at node Zip Levelpacks, Grouping and Sorting Levelpacks, Converting 0.92 Levelpacks, Levelpack Basics
+ at node Zip Levelpacks
 @section Zip Levelpacks
 
 Besides the classic levelpack format of a subdirectory of @samp{levels} with
@@ -1048,7 +1048,7 @@
 archive. Thus, Enigma stores updates of single files in subdirectories in parallel
 to existing zip archives.
 
- at node Grouping and Sorting Levelpacks, Creating New Levelpacks, Zip Levelpacks, Levelpack Basics
+ at node Grouping and Sorting Levelpacks
 @section Grouping and Sorting Levelpacks
 
 As the number of levelpacks increased, it became necessary to sort and group the
@@ -1097,7 +1097,7 @@
 levelpack itself. It is a hint for you and allows you to reassign a levelpack
 to the default group even if meanwhile you have deleted the group.
 
- at node Creating New Levelpacks, Modifying and Deleting Levelpacks, Grouping and Sorting Levelpacks, Levelpack Basics
+ at node Creating New Levelpacks
 @section Creating New Levelpacks
 
 To create a new levelpack, you simply select the group to which you want to add
@@ -1140,7 +1140,7 @@
 @samp{Compose Pack}. Enigma will create the levelpack, and you can use the composer to fill
 it with levels.
 
- at node Modifying and Deleting Levelpacks, Composing Levelpacks, Creating New Levelpacks, Levelpack Basics
+ at node Modifying and Deleting Levelpacks
 @section Modifying and Deleting Levelpacks
 
 To modify a levelpack, right or ctrl click on its button in the levelpack menu.
@@ -1164,7 +1164,7 @@
 delete the index XML file on the @samp{levels/cross} subdirectory of your
 @samp{userpath}.
 
- at node Composing Levelpacks, , Modifying and Deleting Levelpacks, Levelpack Basics
+ at node Composing Levelpacks
 @section Composing Levelpacks
 
 You can change the levels of a levelpack by using the levelpack composer. You call it
@@ -1210,7 +1210,7 @@
 unused level file copies from the @samp{auto} folder.
 
 
- at node  Level Basics, Enigma Paradigm, Levelpack Basics, Top
+ at node  Level Basics
 @chapter Level Basics
 
 Now that you have played some levels of Enigma, you may have noticed that Enigma is quite a
@@ -1340,7 +1340,7 @@
 * Libraries::
 @end menu
 
- at node Getting Started with Levels, XML Level structure, Level Basics, Level Basics
+ at node Getting Started with Levels
 @section Getting Started with Levels
 
 A Simple Level
@@ -1445,7 +1445,7 @@
 
 
 
- at node XML Level structure, Info metadata, Getting Started with Levels, Level Basics
+ at node XML Level structure
 @section XML Level structure
 
 Let us start with a complete overview of all existing top XML element nodes. The
@@ -1603,7 +1603,7 @@
 
 @end table
 
- at node Info metadata, LUA code, XML Level structure, Level Basics
+ at node Info metadata
 @section Info metadata
 
 The Info node contains all author-supplied metadata for the level. This is the
@@ -1707,7 +1707,7 @@
 @end menu
 
 
- at node <identity>, <version>, Info metadata, Info metadata
+ at node <identity>
 @subsection <identity>
 
 The @samp{@b{identity}} element is required, since it provides the information for human
@@ -1760,7 +1760,7 @@
 
 The element itself is empty - no content is allowed.
 
- at node <version>, <author>, <identity>, Info metadata
+ at node <version>
 @subsection <version>
 
 This element provides the versioning information for the system.
@@ -1844,7 +1844,7 @@
 
 The element itself is empty - no content is allowed.
 
- at node <author>, <copyright>, <version>, Info metadata
+ at node <author>
 @subsection <author>
 
 The information about the author him/herself. Enigma requires the author element itself, but
@@ -1880,7 +1880,7 @@
 
 The element itself is empty; no content is allowed.
 
- at node <copyright>, <license>, <author>, Info metadata
+ at node <copyright>
 @subsection <copyright>
 
 The standardized location for the author's copyright message:
@@ -1896,7 +1896,7 @@
 
 The author's copyright notice.
 
- at node <license>, <compatibility>, <copyright>, Info metadata
+ at node <license>
 @subsection <license>
 
 Of course, every author is free to choose the license conditions for his/her levels.
@@ -1928,7 +1928,7 @@
 You may add a complete license text as the contents of this element. Please
 use the type attribute to identify the level.
 
- at node <compatibility>, <modes>, <license>, Info metadata
+ at node <compatibility>
 @subsection <compatibility>
 
 @example
@@ -2063,7 +2063,7 @@
 
 none
 
- at node <modes>, <comments>, <compatibility>, Info metadata
+ at node <modes>
 @subsection <modes>
 
 The modes element allows the author to declare the supported and the default
@@ -2120,7 +2120,7 @@
 
 none
 
- at node <comments>, <score>, <modes>, Info metadata
+ at node <comments>
 @subsection <comments>
 
 The optional comments node allows the author to add a few comments and to determine how
@@ -2196,7 +2196,7 @@
 
 @end table
 
- at node <score>, , <comments>, Info metadata
+ at node <score>
 @subsection <score>
 
 In this node, the author should provide his own scoring values as hints and
@@ -2226,7 +2226,7 @@
 
 @b{Contents:}
 
- at node LUA code, Internationalization (i18n), Info metadata, Level Basics
+ at node LUA code
 @section LUA code
 
 This element takes any Lua code as a single chunk with nearly no limitations:
@@ -2275,7 +2275,7 @@
 limited to pure US-ASCII. The benefit is that you can use Umlauts and
 other non-ASCII characters within it-document hints.
 
- at node Internationalization (i18n), Usage, LUA code, Level Basics
+ at node Internationalization (i18n)
 @section Internationalization (i18n)
 
 The internationalization of levels is a driving force behind the level
@@ -2406,7 +2406,7 @@
 contains at least one mistake, the translator will correct it, as shown in the @samp{msgstr}
 string.
 
- at node Usage, Update and Upgrade, Internationalization (i18n), Level Basics
+ at node Usage
 @section Usage
 
 After all the theory, let's look at how to deal with the XML levelformat in
@@ -2500,7 +2500,7 @@
 @url{http://www.freexmleditor.com/, Exchanger XML Lite}. Such editors will provide
 you with selections of all possible elements and attributes at each position.
 
- at node Update and Upgrade, Libraries , Usage, Level Basics
+ at node Update and Upgrade
 @section Update and Upgrade
 
 Enigma is able to load new level versions since we provide all necessary 
@@ -2553,7 +2553,7 @@
 use this element for the same purpose, with the same syntax, without modifying the author's
 protected section.
 
- at node Libraries, , Update and Upgrade, Level Basics
+ at node Libraries
 @section Libraries
 
 Libraries are collections of Lua functions for reuse in many levels. To use a library, you must
@@ -2574,7 +2574,7 @@
 * Maintaining a Library::
 @end menu
 
- at node Writing a Library, Maintaining a Library, Libraries, Libraries
+ at node Writing a Library
 @subsection Writing a Library
 
 Library files are nearly identical to level files. The main difference is the
@@ -2615,7 +2615,7 @@
 </@i{el}:@b{level}>
 @end example
 
- at node Maintaining a Library, , Writing a Library, Libraries
+ at node Maintaining a Library
 @subsection Maintaining a Library
 
 Libraries may exist in different releases and revisions. Library versions that differ simply  in the
@@ -2641,14 +2641,14 @@
 naming scheme, and every new library should follow it from the beginning.
 
 
- at node Enigma Paradigm, Lua API, Level Basics, Top
+ at node Enigma Paradigm
 @chapter Enigma Paradigm
 
- at node Lua API, Common Attributes and Messages, Enigma Paradigm, Top
+ at node Lua API
 @chapter Lua API
 
 @c ===================  Commons  =======================
- at node Common Attributes and Messages, Floor Objects, Lua API, Top
+ at node Common Attributes and Messages
 @chapter Common Attributes and Messages
 
 @menu
@@ -2656,7 +2656,7 @@
 * Common Messages::   
 @end menu
 
- at node Common Attributes, Common Messages, Common Attributes and Messages, Common Attributes and Messages
+ at node Common Attributes
 @section Common Attributes
 
 @menu
@@ -2668,26 +2668,26 @@
 * destination::
 @end menu
 
- at node name, state, Common Attributes, Common Attributes
+ at node name
 @subsection name
 
- at node state, target, name, Common Attributes
+ at node state
 @subsection state
 
- at node target, action, state, Common Attributes
+ at node target
 @subsection target
 
- at node action, inverse, target, Common Attributes
+ at node action
 @subsection action
 
- at node inverse, destination, action, Common Attributes
+ at node inverse
 @subsection inverse
 
- at node destination, Common Messages, inverse, Common Attributes
+ at node destination
 @subsection destination
 
 
- at node Common Messages, Floor Objects, Common Attributes, Common Attributes and Messages
+ at node Common Messages
 @section Common Messages
 
 @menu
@@ -2699,38 +2699,38 @@
 * close::
 @end menu
 
- at node toggle, signal, Common Messages, Common Messages
+ at node toggle
 @subsection toggle
 
- at node signal, on, toggle, Common Messages
+ at node signal
 @subsection signal
 
- at node on, off, signal, Common Messages
+ at node on
 @subsection on
 
- at node off, open, on, Common Messages
+ at node off
 @subsection off
 
- at node open, close, off, Common Messages
+ at node open
 @subsection open
 
- at node close, Floor Objects, open, Common Messages
+ at node close
 @subsection close
 
 @c ===================  Floors  =======================
 
- at node Floor Objects, Item Objects, Common Attributes and Messages, Top
+ at node Floor Objects
 @chapter Floor Objects
 @c ===================  Items  =======================
 
- at node Item Objects, Stone Objects, Floor Objects, Top
+ at node Item Objects
 @chapter Item Objects
 
 @menu
 * Standard Items:: 
 @end menu
 
- at node Standard Items, Stone Objects, Item Objects, Item Objects
+ at node Standard Items
 @section Standard Items
 
 @menu
@@ -2739,7 +2739,7 @@
 
 
 @c ----------------- Blocker Item -------------------- 
- at node it_blocker, Stone Objects, Standard Items, Standard Items
+ at node it_blocker
 @subsection it_blocker
 @obindex it_blocker
 
@@ -2753,7 +2753,7 @@
 stone and item during opening and closing you should name the blocker
 (@pxref{name}) and address the blocker by this name. The complete identity
 with all attributes including any user attributes will be transfered between
-stone and item. E.g. @code{{it_switch, target="myblocker", action="toggle"}}
+stone and item. E.g. @code{@{it_switch, target="myblocker", action="toggle"@}}
 will open and close a given blocker multiple times.
 
 Note that the blocker is the only door object that allows a stone to be pushed
@@ -2821,7 +2821,7 @@
 
 
 @c ===================  Stones  =======================
- at node Stone Objects, Actor Objects, Item Objects, Top
+ at node Stone Objects
 @chapter Stone Objects
 
 @menu
@@ -2832,14 +2832,14 @@
 @end menu
 
 
- at node Simple Stones, Transparent Stones, Stone Objects, Stone Objects
+ at node Simple Stones
 @section Simple Stones
 
- at node Transparent Stones, Breakable Stones, Simple Stones, Stone Objects
+ at node Transparent Stones
 @section Transparent Stones
- at node Breakable Stones, Special Stones, Glasstones, Stone Objects
+ at node Breakable Stones
 @section Breakable Stones
- at node Special Stones, Actor Objects, Breakable Stones, Stone Objects
+ at node Special Stones
 @section Special Stones
 
 @menu
@@ -2850,7 +2850,7 @@
 
 
 @c ----------------- Blocker Stone -------------------- 
- at node st_blocker, st_boulder, Special Stones, Special Stones
+ at node st_blocker
 @subsection st_blocker
 @obindex st_blocker
 
@@ -2864,7 +2864,7 @@
 stone and item during opening and closing you should name the blocker
 (@pxref{name}) and address the blocker by this name. The complete identity
 with all attributes including any user attributes will be transfered between
-stone and item. E.g. @code{{st_switch, target="myblocker", action="toggle"}}
+stone and item. E.g. @code{@{st_switch, target="myblocker", action="toggle"@}}
 will open and close a given blocker multiple times.
 
 Note that the blocker is the only door object that allows a stone to be pushed
@@ -2926,7 +2926,7 @@
 @end table
 
 @c ----------------- Boulder Stone -------------------- 
- at node st_boulder, st_fourswitch, st_blocker, Special Stones
+ at node st_boulder
 @subsection st_boulder
 @obindex st_boulder
 
@@ -2987,7 +2987,7 @@
 @end table
 
 @c ----------------- Fourswitch Stone -------------------- 
- at node st_fourswitch, Actor Objects, st_boulder, Special Stones
+ at node st_fourswitch
 @subsection st_fourswitch
 @obindex st_fourswitch
 
@@ -3047,16 +3047,16 @@
 
 @c ===================  Actors  =======================
 
- at node Actor Objects, Other Objects, Stone Objects, Top
+ at node Actor Objects
 @chapter Actor Objects
 
- at node Other Objects, Advanced Features, Actor Objects, Top
+ at node Other Objects
 @chapter Other Objects
 
- at node Advanced Features, Old API - Objects, Other Objects, Top
+ at node Advanced Features
 @chapter Advanced Features
 
- at node Old API - Objects, Old API - Variables, Advanced Features, Top
+ at node Old API - Objects
 @chapter Old API - Objects
 
 @menu
@@ -3070,7 +3070,7 @@
 * Differences between Compatibility Modes::
 @end menu
 
- at node Floors, Items, Old API - Objects, Old API - Objects
+ at node Floors
 @section Floors
 
 @menu
@@ -3093,7 +3093,7 @@
 @end menu
 
 
- at node Common Floor Attributes, Special floor tiles, Floors, Floors
+ at node Common Floor Attributes
 @subsection Common Floor Attributes
 
 Standard attributes:
@@ -3130,7 +3130,7 @@
 @end table
 
 
- at node Special floor tiles, Regular floor tiles, Common Floor Attributes, Floors
+ at node Special floor tiles
 @subsection Special floor tiles
 
 @example
@@ -3153,7 +3153,7 @@
 @end example
 
 
- at node Regular floor tiles, fl-abyss, Special floor tiles, Floors
+ at node Regular floor tiles
 @subsection Regular floor tiles
 
 @example
@@ -3213,7 +3213,7 @@
 @end example
 
 
- at node fl-abyss, fl-ac[black/white], Regular floor tiles, Floors
+ at node fl-abyss
 @subsection fl-abyss
 
 Kills marbles that roll onto it, unless they're protected by an
@@ -3223,7 +3223,7 @@
 @ref{fl-water} and @ref{fl-swamp}.
 
 
- at node fl-ac[black/white], fl-bridge, fl-abyss, Floors
+ at node fl-ac[black/white]
 @subsection fl-ac[black/white]
 
 Marbles on this floor are controlled by player 0 only (who has
@@ -3232,7 +3232,7 @@
 interacting with these floors.
 
 
- at node fl-bridge, fl-dummy, fl-ac[black/white], Floors
+ at node fl-bridge
 @subsection fl-bridge
 
 @code{fl-bridge} can be open (marbles fall into it) or closed (marbles
@@ -3268,7 +3268,7 @@
 @end table
 
 
- at node fl-dummy, fl-gradient, fl-bridge, Floors
+ at node fl-dummy
 @subsection fl-dummy
 
 Prints its Oxyd code when entered.  Used for maintenance purposes.
@@ -3276,7 +3276,7 @@
 @code{it-dummy} (@ref{System and Debug Items}).
 
 
- at node fl-gradient, fl-ice, fl-dummy, Floors
+ at node fl-gradient
 @subsection fl-gradient
 
 Adds a horizontal, vertical or diagonal force to actors on it.  The
@@ -3315,7 +3315,7 @@
 for tubes etc.).
 
 
- at node fl-ice, fl-inverse, fl-gradient, Floors
+ at node fl-ice
 @subsection fl-ice
 
 Ice has very low friction and mousefactor, such that it's difficult to
@@ -3328,7 +3328,7 @@
 @item fl-ice
 @end table
 
- at node fl-inverse, fl-nomouse, fl-ice, Floors
+ at node fl-inverse
 @subsection fl-inverse
 
 Inverses the mouse movements (negative @code{mouseforce}).
@@ -3341,14 +3341,14 @@
 @end table
 
 
- at node fl-nomouse, fl-space, fl-inverse, Floors
+ at node fl-nomouse
 @subsection fl-nomouse
 
 This floor prevents a player from controlling the marble
 (@code{mouseforce = 0}).
 
 
- at node fl-space, fl-space-force, fl-nomouse, Floors
+ at node fl-space
 @subsection fl-space
 
 This floor prevents a player from controlling the marble
@@ -3356,7 +3356,7 @@
 also is no friction, so that marbles seldom get stuck on space.
 
 
- at node fl-space-force, fl-swamp, fl-space, Floors
+ at node fl-space-force
 @subsection fl-space-force
 
 This floor has (like @ref{fl-space}) no friction and no mouseforce,
@@ -3367,7 +3367,7 @@
 @code{force_y}-attribute of @code{fl-space-force}.
 
 
- at node fl-swamp, fl-thief, fl-space-force, Floors
+ at node fl-swamp
 @subsection fl-swamp
 
 Kills marbles that roll onto it, unless they're protected by an
@@ -3383,7 +3383,7 @@
 @ref{it-spring[1/2/board]}.
 
 
- at node fl-thief, fl-water, fl-swamp, Floors
+ at node fl-thief
 @subsection fl-thief
 
 This floor steals one item from the player's inventory. It looks like
@@ -3397,7 +3397,7 @@
 static item, no @code{it-bag} is produced). 
 
 
- at node fl-water, , fl-thief, Floors
+ at node fl-water
 @subsection fl-water
 
 Kills marbles that roll onto it, unless they're protected by an
@@ -3415,7 +3415,7 @@
 
 @c ================== Items ====================
 
- at node Items, Stones, Floors, Old API - Objects
+ at node Items
 @section Items
 
 @menu
@@ -4799,7 +4799,7 @@
 
 @c ===================  Stones  =======================
 
- at node Stones, Actors, Items, Old API - Objects
+ at node Stones
 @section Stones
 
 @menu
@@ -4870,7 +4870,7 @@
 
 For the common stone attribute @code{freeze_check}, see @ref{Freeze Checking}.
 
- at node Stone List, Breakable-Stones, Stones, Stones
+ at node Stone List
 @subsection Stone List
 
 @strong{Simple stones}
@@ -5091,7 +5091,7 @@
 st-yinyang@{1..3@}
 @end example
 
- at node Glassstones, Breakable-Stones, Stone List, Stones
+ at node Glassstones
 @subsection Glassstones
 
 There are a few kinds of glassstones, all similar, but with different details.
@@ -5125,7 +5125,7 @@
 such a frame and cannot be moved by an invisible actor.
 
 
- at node Breakable-Stones, Oxyd Compatibility Stones, Glassstones, Stones
+ at node Breakable-Stones
 @subsection Breakable-Stones
 
 A list of all breakable stones and what may break them. Messages are
@@ -5185,7 +5185,7 @@
 can be transformed into and out of @code{st-firebreak[_move]}.
 
 
- at node Oxyd Compatibility Stones, st-actorimpulse, Breakable-Stones, Stones
+ at node Oxyd Compatibility Stones
 @subsection Oxyd Compatibility Stones
 
 @code{st-magic} disappears when hit hard enough.
@@ -5199,7 +5199,7 @@
 unknown.
 
 
- at node st-actorimpulse, st-big[brick/bluesand], Oxyd Compatibility Stones, Stones
+ at node st-actorimpulse
 @subsection st-actorimpulse: Bumper Stones
 
 These stones apply an impulse to actors that touch them.  The amount
@@ -5225,7 +5225,7 @@
 The invisible variant, @code{st-actorimpulse_invisible} can be
 ``painted'' with an @ref{it-brush}.
 
- at node st-big[brick/bluesand], st-[black/white], st-actorimpulse, Stones
+ at node st-big[brick/bluesand]
 @subsection st-big[brick/bluesand]: Big Stones
 
 These stones are used to construct big clusters of stones that
@@ -5264,7 +5264,7 @@
 See @ref{st-puzzle} for another kind of cluster-building stones.
 
 
- at node st-[black/white], st-[black/white]balls, st-big[brick/bluesand], Stones
+ at node st-[black/white]
 @subsection st-[black/white]: Black and white stones
 
 These stones only let black, or respectively, white marbles, pass.
@@ -5280,7 +5280,7 @@
 pass.
 
 
- at node st-[black/white]balls, st-block, st-[black/white], Stones
+ at node st-[black/white]balls
 @subsection st-[black/white]balls: Blackballs and Whiteballs Stones
 
 Mainly used as decorative, this stone also has a special function: When
@@ -5301,14 +5301,14 @@
 collision causing this event.
 
 
- at node st-block, st-blocker, st-[black/white]balls, Stones
+ at node st-block
 @subsection st-block: Solid Block
 
 This stone is movable and sinks on @ref{fl-abyss}, @ref{fl-water} and
 @ref{fl-swamp}.
 
 
- at node st-blocker, st-bolder, st-block, Stones
+ at node st-blocker
 @subsection st-blocker: Shrinkable Blocker Stone
 
 This stone shrinks to @ref{it-blocker} when hit by an
@@ -5335,7 +5335,7 @@
 @end table
 
 
- at node st-bolder, st-bombs, st-blocker, Stones
+ at node st-bolder
 @subsection st-bolder: Bolder (or Arrow) Stone
 
 This stone runs in the direction given by the arrow on its picture.
@@ -5374,7 +5374,7 @@
 @end table
 
 
- at node st-bombs, st-brake, st-bolder, Stones
+ at node st-bombs
 @subsection st-bombs: Bombstones
 
 When hit, @code{st-bombs} adds an @ref{it-blackbomb} to the
@@ -5404,7 +5404,7 @@
 @c @end table
 
 
- at node st-brake, st-brick_magic, st-bombs, Stones
+ at node st-brake
 @subsection st-brake: Brake
 
 This stone can be picked up as item @ref{it-brake}.  It can be used to
@@ -5420,14 +5420,14 @@
 @end table
 
 
- at node st-brick_magic, st-chameleon, st-brake, Stones
+ at node st-brick_magic
 @subsection st-brick_magic: Magic Brick Stone
 
 At first sight identical with @code{st-brick}, this stone becomes
 transparent when hit with an @ref{it-magicwand}.
 
 
- at node st-chameleon, st-charge, st-brick_magic, Stones
+ at node st-chameleon
 @subsection st-chameleon: Chameleon Stone
 
 This stone takes on the look of the floor beneath it.  Actors can
@@ -5435,7 +5435,7 @@
 them.  For solid, yet invisible stone-types see @ref{st-invisible}.
 
 
- at node st-charge, st-chess_[black/white], st-chameleon, Stones
+ at node st-charge
 @subsection st-charge: Charge Stones
 
 When hit, the marble is provided with a constant electrostatic charge,
@@ -5464,7 +5464,7 @@
 @end table
 
 
- at node st-chess_[black/white], st-coffee, st-charge, Stones
+ at node st-chess_[black/white]
 @subsection st-chess_[black/white]: Chess (Knight) Stone
 
 When hit, a chess stone makes a knight move: two steps in direction of
@@ -5518,7 +5518,7 @@
 @end table
 
 
- at node st-coffee, st-coinslot, st-chess_[black/white], Stones
+ at node st-coffee
 @subsection st-coffee
 
 This stone is non-transparent at first and becomes transparent and
@@ -5526,7 +5526,7 @@
 similar stone.
 
 
- at node st-coinslot, st-death, st-coffee, Stones
+ at node st-coinslot
 @subsection st-coinslot
 
 A switch that can be activated with coins (see @ref{it-coin}). The
@@ -5551,7 +5551,7 @@
 @end table
 
 
- at node st-death, st-disco, st-coinslot, Stones
+ at node st-death
 @subsection st-death: Skull Stones
 
 Simply kills all marbles that touch it (except when protected by an
@@ -5568,7 +5568,7 @@
 @end table
 
 
- at node st-disco, st-door, st-death, Stones
+ at node st-disco
 @subsection st-disco: Disco Stones
 
 A passable stone, which darkens everything that is underneath the
@@ -5598,7 +5598,7 @@
 @end table
 
 
- at node st-door, st-easymode, st-disco, Stones
+ at node st-door
 @subsection st-door: Doors
 
 Doors are designed to let actors pass or not, depending on their
@@ -5659,7 +5659,7 @@
 just design; they don't behave the same way.
 
 
- at node st-easymode, st-explosion, st-disco, Stones
+ at node st-easymode
 @subsection st-easymode: Easy Mode Stone
 
 In easy game mode, this stone converts the floor at its position to
@@ -5672,14 +5672,14 @@
 easier in easy game mode.
 
 
- at node st-explosion, st-fakeoxyda, st-easymode, Stones
+ at node st-explosion
 @subsection st-explosion: Explosion Stone
 
 This stone mimics an explosion when set, and destroys itself
 afterwards.  Actors that contact it are shattered.
 
 
- at node st-fakeoxyda, st-fart, st-explosion, Stones
+ at node st-fakeoxyda
 @subsection st-fakeoxyda: Movable Fake Oxyd Stone
 
 This stone looks like an @ref{st-oxyd} of flavor @code{a}, yet it
@@ -5687,7 +5687,7 @@
 hit. See @ref{st-coffee} for a similar stone.
 
 
- at node st-fart, st-firebreak[_move], st-fakeoxyda, Stones
+ at node st-fart
 @subsection st-fart: Fart Stone
 
 The fart stone has the unpleasant habit of ``blowing off'' when
@@ -5703,7 +5703,7 @@
 @end table
 
 
- at node st-firebreak[_move], st-flash, st-fart, Stones
+ at node st-firebreak[_move]
 @subsection st-firebreak[_move]: Firebreakable Stones
 
 @code{st-firebreak} gets destroyed when there is fire near it (see
@@ -5735,7 +5735,7 @@
 @end table
 
 
- at node st-flash, st-floppy, st-firebreak[_move], Stones
+ at node st-flash
 @subsection st-flash: Flash Stone
 
 When the flash stone is hit by the black marble, an impulse will
@@ -5751,7 +5751,7 @@
 define a matrix to be applied to the force (default @code{((1,0),(0,1))})
 @end table
 
- at node st-floppy, st-fourswitch, st-flash, Stones
+ at node st-floppy
 @subsection st-floppy: Floppy Switch
 
 A switch that is activated by inserting a floppy disk (see @ref{it-floppy}).
@@ -5766,7 +5766,7 @@
 @end table
 
 
- at node st-fourswitch, st-grate, st-floppy, Stones
+ at node st-fourswitch
 @subsection st-fourswitch: Fourswitch
 
 When hit, this stone visually turns its pointer and performs the
@@ -5793,7 +5793,7 @@
 yourself: The stone always starts with direction @code{NORTH}.
 
 
- at node st-grate, st-invisible, st-fourswitch, Stones
+ at node st-grate
 @subsection st-grate: Grates
 
 Floating grates, mainly decorative.  @code{st-grate1} and
@@ -5814,7 +5814,7 @@
 @end table
 
 
- at node st-invisible, st-key, st-grate, Stones
+ at node st-invisible
 @subsection st-invisible: Invisible Stones
 
 @code{st-invisible} is invisible and non-transparent for lasers, and
@@ -5837,7 +5837,7 @@
 @end table
 
 
- at node st-key, st-knight, st-invisible, Stones
+ at node st-key
 @subsection st-key: Key (or Lock) Stone
 
 When the right @ref{it-key} is used on this stone, it performs the
@@ -5876,7 +5876,7 @@
 instead.
 
 
- at node st-knight, st-laser, st-key, Stones
+ at node st-knight
 @subsection st-knight: Knight Stone
 
 Also called ``black knight stone'', this stone destroys all marbles
@@ -5886,7 +5886,7 @@
 and can be passed thereafter, even without a sword.
 
 
- at node st-laser, st-laserswitch, st-knight, Stones
+ at node st-laser
 @subsection st-laser: Laser Stone
 
 @code{st-laser} emits a laser beam in a specified direction while
@@ -5923,7 +5923,7 @@
 For redirecting and forking laser beams, see @ref{st-mirror}.
 
 
- at node st-laserswitch, st-lasertimeswitch, st-laser, Stones
+ at node st-laserswitch
 @subsection st-laserswitch: Laser Switch
 
 This switch is @code{on} while hit by a laserbeam
@@ -5942,13 +5942,13 @@
 @end table
 
 
- at node st-lasertimeswitch, st-lightpassenger, st-laserswitch, Stones
+ at node st-lasertimeswitch
 @subsection st-lasertimeswitch: Laser Time Switch
 
 This switch is a mix between @ref{st-laserswitch} and @ref{st-timeswitch}.
 
 
- at node st-lightpassenger, st-mail, st-lasertimeswitch, Stones
+ at node st-lightpassenger
 @subsection st-lightpassenger: Light Passenger
 
 The light passenger skates on a laser beam, and may push up to one
@@ -6021,7 +6021,7 @@
 @end table
 
 
- at node st-mail, st-mirror, st-lightpassenger, Stones
+ at node st-mail
 @subsection st-mail: Mail Stones
 
 When hit, these stones take the first item out of the player's
@@ -6039,7 +6039,7 @@
 @end table
 
 
- at node st-mirror, st-oneway, st-mail, Stones
+ at node st-mirror
 @subsection st-mirror: Mirror Stones
 
 These stones redirect and fork laser beams. They can be movable or
@@ -6081,7 +6081,7 @@
 non-movable.
 
 
- at node st-oneway, st-oxyd, st-mirror, Stones
+ at node st-oneway
 @subsection st-oneway: One-way Stones
 
 The marble can be pass this stone  in only one direction. (Or to
@@ -6134,7 +6134,7 @@
 @end table
 
 
- at node st-oxyd, st-plain, st-oneway, Stones
+ at node st-oxyd
 @subsection st-oxyd: Oxyd Stones
 
 Oxyd stones are characterized by two attributes: Their flavor and
@@ -6175,7 +6175,7 @@
 @end table
 
 
- at node st-plain, st-polarswitch, st-oxyd, Stones
+ at node st-plain
 @subsection st-plain: Plain Stones
 
 @code{st-plain} and @code{st-plain_hole} trigger between solid and
@@ -6223,7 +6223,7 @@
 @ref{st-door} for stones with similar functions like @code{st-plain}.
 
 
- at node st-polarswitch, st-pull, st-plain, Stones
+ at node st-polarswitch
 @subsection st-polarswitch: Light Switch
 
 When hit, this stone changes transparency for laser
@@ -6249,7 +6249,7 @@
 @end table
 
 
- at node st-pull, st-puzzle, st-polarswitch, Stones
+ at node st-pull
 @subsection st-pull: Pull Stone
 
 When pushed, this stone acts like pulled, regardless of the source of
@@ -6273,7 +6273,7 @@
 For a stone with similar function and restrictions, see @ref{st-swap}.
  
 
- at node st-puzzle, st-rotator, st-pull, Stones
+ at node st-puzzle
 @subsection st-puzzle: Puzzle Stones
 
 Puzzle stones can construct large clusters of stones, that move
@@ -6369,7 +6369,7 @@
 stones.
 
 
- at node st-rotator, st-rubberband, st-puzzle, Stones
+ at node st-rotator
 @subsection st-rotator: Rotator Stone
 
 Rotator stones come in four flavors: Clockwise or counterclockwise
@@ -6389,7 +6389,7 @@
 @end table
 
 
- at node st-rubberband, st-scissors, st-rotator, Stones
+ at node st-rubberband
 @subsection st-rubberband: Rubberband Stone
 
 If hit by a marble, this stone first removes existing connections with
@@ -6414,7 +6414,7 @@
 @end table
 
 
- at node st-scissors, st-shogun-<sml>, st-rubberband, Stones
+ at node st-scissors
 @subsection st-scissors: Scissors Stone
 
 This stone cuts all rubber bands attached to an actor that touches it.
@@ -6429,7 +6429,7 @@
 @end table
 
 
- at node st-shogun-<sml>, st-spitter, st-scissors, Stones
+ at node st-shogun-<sml>
 @subsection st-shogun-<sml>: Shogun Stones
 
 These stones come in three basic variants: small (@code{s}), medium
@@ -6459,7 +6459,7 @@
 @end table
 
 
- at node st-spitter, st-stoneimpulse, st-shogun-<sml>, Stones
+ at node st-spitter
 @subsection st-spitter: Spitter Stone
 
 When hit, an @ref{it-extralife} from the inventory of the hitting
@@ -6479,7 +6479,7 @@
 @end table
 
 
- at node st-stoneimpulse, st-surprise, st-spitter, Stones
+ at node st-stoneimpulse
 @subsection st-stoneimpulse: Impulse Stones
 
 These stones send impulses to their neighbors when they receive such
@@ -6509,7 +6509,7 @@
 @end table
 
 
- at node st-surprise, st-swap, st-stoneimpulse, Stones
+ at node st-surprise
 @subsection st-surprise: Surprise Stone
 
 When hit, this stone randomly transforms into one of @code{st-grate1},
@@ -6521,7 +6521,7 @@
 item is @ref{it-surprise}.
 
 
- at node st-swap, st-switch, st-surprise, Stones
+ at node st-swap
 @subsection st-swap: Swap Stone
 
 This stone can exchange its position with other neighboring stones
@@ -6541,7 +6541,7 @@
 For a stone with similar function and restrictions, see @ref{st-pull}.
 
 
- at node st-switch, st-thief, st-swap, Stones
+ at node st-switch
 @subsection st-switch: Switches
 
 A simple switch. 
@@ -6567,7 +6567,7 @@
 @end table
 
 
- at node st-thief, st-timer, st-switch, Stones
+ at node st-thief
 @subsection st-thief: Thief Stone
 
 Takes one item from inventory shortly after hit by a player's marble.
@@ -6591,7 +6591,7 @@
 @end table
 
 
- at node st-timer, st-timeswitch, st-thief, Stones
+ at node st-timer
 @subsection st-timer: Timer Stone
 
 This stone can be used to trigger periodic events or to trigger one
@@ -6635,7 +6635,7 @@
 @end example
 
 
- at node st-timeswitch, st-turnstile, st-timer, Stones
+ at node st-timeswitch
 @subsection st-timeswitch: Time Switch
 
 When this switch is touched by an actor, it switches @code{on}
@@ -6655,7 +6655,7 @@
 @end table
 
 
- at node st-turnstile, st-volcano, st-timeswitch, Stones
+ at node st-turnstile
 @subsection st-turnstile: Turnstiles
 
 A turnstile consists of the pivot (@code{st-turnstile} or
@@ -6706,7 +6706,7 @@
 @end table
 
 
- at node st-volcano, st-window, st-turnstile, Stones
+ at node st-volcano
 @subsection st-volcano: Volcano
 
 This stone duplicates itself and spreads out very fast.  During one
@@ -6742,13 +6742,13 @@
 See also @ref{it-seed}.
 
 
- at node st-window, st-wood, st-volcano, Stones
+ at node st-window
 @subsection st-window: Breakable Stone
 
 Hit this window hard with your marble to blast it into smithereens.
 
 
- at node st-wood, st-yinyang, st-window, Stones
+ at node st-wood
 @subsection st-wood: Wooden Stone
 
 This stone is movable.  If moved into @ref{fl-abyss}, @ref{fl-water} or
@@ -6788,7 +6788,7 @@
 @end table
 
 
- at node st-yinyang,  , st-wood, Stones
+ at node st-yinyang
 @subsection st-yinyang: Yin-Yang Stones
 
 Yin-Yang stones change into @code{st-white1} or @code{st-black1}
@@ -6815,7 +6815,7 @@
 
 
 @c ----------------------------------------------------------------------
- at node Actors, General object attributes, Stones, Old API - Objects
+ at node Actors
 @section Actors
 
 @menu
@@ -7061,7 +7061,7 @@
 
 
 @c ----------------------------------------------------------------------
- at node General object attributes, The 1.0-Fire System, Actors, Old API - Objects
+ at node General object attributes
 @section General object attributes
 
 @table @code
@@ -7071,7 +7071,7 @@
 @end table
 
 @c ----------------------------------------------------------------------
- at node The 1.0-Fire System, Freeze Checking, General object attributes, Old API - Objects
+ at node The 1.0-Fire System
 @section The 1.0-Fire System
 
 The 1.0-version of Enigma introduces a new fire system, making use of
@@ -7260,7 +7260,7 @@
 
 
 @c ----------------------------------------------------------------------
- at node Freeze Checking, Differences between Compatibility Modes, The 1.0-Fire System, Old API - Objects
+ at node Freeze Checking
 @section Freeze Checking
 
 With Enigma 1.1 and above, you can use a special feature to support Sokoban
@@ -7344,7 +7344,7 @@
 
 
 @c ----------------------------------------------------------------------
- at node Differences between Compatibility Modes,  , Freeze Checking, Old API - Objects
+ at node Differences between Compatibility Modes
 @section Differences between Compatibility Modes
 
 Although Enigma was inspired by the original Oxyd-series, there are
@@ -7416,7 +7416,7 @@
 
 
 @c ======================================================================
- at node Old API - Variables, Old API - Functions, Old API - Objects, Top
+ at node Old API - Variables
 @chapter Old API - Variables
 
 This chapter describes a few variables that you can change from
@@ -7544,7 +7544,7 @@
 @end defvar
 
 
- at node Old API - Functions, Object Index, Old API - Variables, Top
+ at node Old API - Functions
 @chapter Old API - Functions
 
 @menu
@@ -7583,7 +7583,7 @@
 @end menu
 
 @c ......................................................................
- at node AddRubberBand, CreateWorld, Old API - Functions, Old API - Functions
+ at node AddRubberBand
 @section AddRubberBand
 
 @defun AddRubberBand (actor, object, strength, length)
@@ -7611,7 +7611,7 @@
 @end example
 
 @c ......................................................................
- at node CreateWorld, display.SetFollowMode, AddRubberBand, Old API - Functions
+ at node CreateWorld
 @section CreateWorld
 
 @defun CreateWorld (width, heigth)
@@ -7632,7 +7632,7 @@
 @end defun
 
 @c ......................................................................
- at node display.SetFollowMode, draw_border, CreateWorld, Old API - Functions
+ at node display.SetFollowMode
 @section display.SetFollowMode
 
 @defun display.SetFollowMode (mode)
@@ -7657,7 +7657,7 @@
 @end defun
 
 @c ......................................................................
- at node  draw_border, draw_checkerboard_floor, display.SetFollowMode, Old API - Functions
+ at node  draw_border
 @section draw_border
 
 @defun draw_border (stonename, x,y, w,h)
@@ -7684,7 +7684,7 @@
 @end example
 
 @c ......................................................................
- at node  draw_checkerboard_floor, draw_floor, draw_border, Old API - Functions
+ at node  draw_checkerboard_floor
 @section draw_checkerboard_floor
 
 @defun draw_checkerboard_floor (name1, name2, x, y, w, h, attribs)
@@ -7718,7 +7718,7 @@
 @end example
 
 @c ......................................................................
- at node  draw_floor, draw_items, draw_checkerboard_floor, Old API - Functions
+ at node  draw_floor
 @section draw_floor
 
 @defun draw_floor (floorname, location, increment, count , attribs)
@@ -7761,7 +7761,7 @@
 
 
 @c ......................................................................
- at node  draw_items, draw_stones, draw_floor, Old API - Functions
+ at node  draw_items
 @section draw_items
 
 @defun draw_items (itemname, location, increment, count [, attribs])
@@ -7798,7 +7798,7 @@
 @end example
 
 @c ......................................................................
- at node  draw_stones, enigma.AddConstantForce, draw_items, Old API - Functions
+ at node  draw_stones
 @section draw_stones
 
 @defun draw_stones (stonename, location, increment, count [, attribs])
@@ -7843,7 +7843,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.AddConstantForce, enigma.GetAttrib, draw_stones, Old API - Functions
+ at node enigma.AddConstantForce
 @section enigma.AddConstantForce
 
 @defun enigma.AddConstantForce (gravity_x, gravity_y)
@@ -7860,7 +7860,7 @@
 @end defun
 
 @c ......................................................................
- at node enigma.GetAttrib, enigma.GetNamedObject, enigma.AddConstantForce, Old API - Functions
+ at node enigma.GetAttrib
 @section enigma.GetAttrib
 
 @defun GetAttrib (object, attribname)
@@ -7882,7 +7882,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.GetNamedObject, enigma.GetKind, enigma.GetAttrib, Old API - Functions
+ at node enigma.GetNamedObject
 @section enigma.GetNamedObject
 
 @defun enigma.GetNamedObject (objname)
@@ -7902,7 +7902,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.GetKind, enigma.KillFloor, enigma.GetNamedObject, Old API - Functions
+ at node enigma.GetKind
 @section enigma.GetKind
 
 @defun enigma.GetKind(object)
@@ -7922,7 +7922,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.KillFloor, enigma.KillItem, enigma.GetKind, Old API - Functions
+ at node enigma.KillFloor
 @section enigma.KillFloor
 
 @defun enigma.KillFloor (x, y)
@@ -7937,7 +7937,7 @@
 @end defun
 
 @c ......................................................................
- at node enigma.KillItem, enigma.KillStone, enigma.KillFloor, Old API - Functions
+ at node enigma.KillItem
 @section enigma.KillItem
 
 @defun enigma.KillItem (x, y)
@@ -7952,7 +7952,7 @@
 @end defun
 
 @c ......................................................................
- at node enigma.KillStone, enigma.LoadLib, enigma.KillItem, Old API - Functions
+ at node enigma.KillStone
 @section enigma.KillStone
 
 @defun enigma.KillStone (x, y)
@@ -7967,7 +7967,7 @@
 @end defun
 
 @c ......................................................................
- at node enigma.LoadLib, enigma.NameObject, enigma.KillStone, Old API - Functions
+ at node enigma.LoadLib
 @section enigma.LoadLib
 
 @defun enigma.LoadLib (libraryId)
@@ -7979,7 +7979,7 @@
 @end defun
 
 @c ......................................................................
- at node enigma.NameObject, enigma.SetAttrib, enigma.LoadLib, Old API - Functions
+ at node enigma.NameObject
 @section enigma.NameObject
 
 @defun enigma.NameObject (object, value)
@@ -7992,7 +7992,7 @@
 @end defun
 
 @c ......................................................................
- at node enigma.SetAttrib, enigma.SetAttribs, enigma.NameObject, Old API - Functions
+ at node enigma.SetAttrib
 @section enigma.SetAttrib
 
 @defun enigma.SetAttrib (object, attribname, value)
@@ -8025,7 +8025,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.SetAttribs, enigma.SetDefaultAttribs, enigma.SetAttrib, Old API - Functions
+ at node enigma.SetAttribs
 @section enigma.SetAttribs
 
 @defun enigma.set_attribs (object, attribs)
@@ -8053,7 +8053,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.SetDefaultAttribs, enigma.SetCompatibility, enigma.SetAttribs, Old API - Functions
+ at node enigma.SetDefaultAttribs
 @section enigma.SetDefaultAttribs
 
 @defun enigma.SetDefaultAttribs (objectname, attribs)
@@ -8090,7 +8090,7 @@
 @end example
 
 @c ......................................................................
- at node enigma.SetCompatibility, fill_floor, enigma.SetDefaultAttribs, Old API - Functions
+ at node enigma.SetCompatibility
 @section enigma.SetCompatibility
 
 @defun enigma.SetCompatibility (compatibility)
@@ -8120,7 +8120,7 @@
 @end defun
 
 @c ......................................................................
- at node fill_floor, fill_items, enigma.SetCompatibility, Old API - Functions
+ at node fill_floor
 @section fill_floor
 
 @defun fill_floor (floorname)
@@ -8153,7 +8153,7 @@
 @end example
 
 @c ......................................................................
- at node fill_items, fill_stones, fill_floor, Old API - Functions
+ at node fill_items
 @section fill_items
 
 @defun fill_items (itemname, x, y, w, h)
@@ -8185,7 +8185,7 @@
 @end example
 
 @c ......................................................................
- at node fill_stones, MakeObject, fill_items, Old API - Functions
+ at node fill_stones
 @section fill_stones
 
 @defun fill_stones (stonename, x, y, w, h)
@@ -8216,7 +8216,7 @@
 @end example
 
 @c ......................................................................
- at node  MakeObject, SendMessage, fill_stones, Old API - Functions
+ at node  MakeObject
 @section MakeObject
 
 @defun MakeObject (objname, attribs)
@@ -8247,7 +8247,7 @@
 @end example
 
 @c ......................................................................
- at node SendMessage, set_floor, MakeObject, Old API - Functions
+ at node SendMessage
 @section SendMessage
 
 @defun SendMessage (object, message, data)
@@ -8283,7 +8283,7 @@
 @end example
 
 @c ......................................................................
- at node set_floor, set_item, SendMessage, Old API - Functions
+ at node set_floor
 @section set_floor
 
 @defun set_floor (floorname, x, y, attribs)
@@ -8319,7 +8319,7 @@
 @end example
 
 @c ......................................................................
- at node set_item, set_stone, set_floor, Old API - Functions
+ at node set_item
 @section set_item
 
 @defun set_item (itemname, x, y, attribs)
@@ -8357,7 +8357,7 @@
 @end example
 
 @c ......................................................................
- at node set_stone, set_stones, set_item, Old API - Functions
+ at node set_stone
 @section set_stone
 
 @defun set_stone (stonename, x, y, attribs)
@@ -8390,7 +8390,7 @@
 @end example
 
 @c ......................................................................
- at node set_stones, Object Index, set_stone, Old API - Functions
+ at node set_stones
 @section set_stones
 
 @defun set_stones (stonename, positions, attribs)
@@ -8428,22 +8428,22 @@
 
 @c ......................................................................
 
- at node Object Index, Attribute Index, Old API - Functions, Top
+ at node Object Index
 @unnumbered Object Index
 
 @printindex ob
 
- at node Attribute Index, Message Index, Object Index, Top
+ at node Attribute Index
 @unnumbered Attribute Index
 
 @printindex at
 
- at node Message Index, Function Index, Attribute Index, Top
+ at node Message Index
 @unnumbered Message Index
 
 @printindex ms
 
- at node Function Index, Concept Index, Message Index, Top
+ at node Function Index
 @unnumbered Function Index
 
 @syncodeindex vr tp
@@ -8451,7 +8451,7 @@
 
 @printindex tp
 
- at node Concept Index,  , Function Index, Top
+ at node Concept Index
 @unnumbered Concept Index
 
 @printindex cp



From ral at mail.berlios.de  Wed Jan 23 22:31:40 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 23 Jan 2008 22:31:40 +0100
Subject: [Enigma-game-svn] r1000 - in trunk: data src src/stones
Message-ID: <200801232131.m0NLVebI026804@sheep.berlios.de>

Author: ral
Date: 2008-01-23 22:31:39 +0100 (Wed, 23 Jan 2008)
New Revision: 1000

Modified:
   trunk/data/init.lua
   trunk/src/actors.cc
   trunk/src/floors.cc
   trunk/src/items.cc
   trunk/src/oxyd.cc
   trunk/src/stones.cc
   trunk/src/stones/OxydStone.cc
   trunk/src/stones/OxydStone.hh
   trunk/src/stones_simple.cc
   trunk/src/world.cc
Log:
Trunk 1.1: Reengineering
- renamed internal message "expl" to "_explosion"
- renamed internal message "bombstone" to "_bombstone"
- renamed internal message "spitter" to "_spitter"
- attribute "inverse" switched from 0/1 value to bool 
- renamed "st-oxyd" to "st_oxyd"
- renamed OxydStone attribut "color" to "oxydcolor"
- OxydStone support and usage of StateObject: state, open, close, toggle
- OxydStone add performAction on state change close vs. open


Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-22 01:17:17 UTC (rev 999)
+++ trunk/data/init.lua	2008-01-23 21:31:39 UTC (rev 1000)
@@ -39,6 +39,7 @@
 enigma._GetKind = enigma.GetKind
 enigma._SetAttrib = enigma.SetAttrib
 enigma._GetAttrib = enigma.GetAttrib
+enigma._GetObjectTemplate = enigma.GetObjectTemplate
 
 RenamingObjectsOld2New = {
 }
@@ -55,6 +56,7 @@
     st_boulder_w = "st-bolder-w",
     st_floppy = "st-floppy",
     st_fourswitch = "st-fourswitch",
+    st_oxyd = "st-oxyd",
     st_switch_instant = "st-switch",
     st_switch_black_instant = "st-switch_black",
     st_switch_white_instant = "st-switch_white"
@@ -125,6 +127,7 @@
      if _obj_name == "st-oxyd" then
          if key == "color" then
 	     _val = 0 + val   -- convert to int
+             _key = "oxydcolor"
 	 end
      end
      if (_obj_name == "st-switch") or (_obj_name == "st-switch_black")
@@ -192,7 +195,12 @@
      if key == "blackball" or key == "whiteball" then
          _key = "color"
      end
+     if _obj_name == "st-oxyd" then
+         _key = "oxydcolor"
+     end
+
      local val = enigma._GetAttrib(obj, _key)
+     
      if key == "blackball" then
         if val == 0 then val = 1 else val = 0 end
      end
@@ -216,9 +224,23 @@
              val = d.y
          end
      end
+     if key == "invisible" then
+         if val == false then val = 0 else val = 1 end
+     end
      return val
 end
 
+function enigma.GetObjectTemplate(kind)
+    local _kind = RenamingObjectsOld2New[kind]
+    if _kind == nil then
+        _kind = kind
+    end
+    if kind == "st-key" or kind == "st-key_a" or kind == "st-key_b" or kind == "st-key_c" then
+        _kind = "st_key"
+    end
+    return enigma._GetObjectTemplate(_kind)
+end
+
 MessageRenaming = {
     it_blocker__trigger = "toggle",
     it_blocker__openclose = "toggle",

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2008-01-22 01:17:17 UTC (rev 999)
+++ trunk/src/actors.cc	2008-01-23 21:31:39 UTC (rev 1000)
@@ -565,7 +565,7 @@
     const GridPos &p = get_gridpos();
 
     if (Stone *st = GetStone (p)) {
-        SendMessage (st, "spitter");
+        SendMessage (st, "_spitter");
     }
     else if (Item *it = GetItem(p)) {
         if (!has_flags(it, itf_indestructible))

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2008-01-22 01:17:17 UTC (rev 999)
+++ trunk/src/floors.cc	2008-01-23 21:31:39 UTC (rev 1000)
@@ -67,7 +67,7 @@
         return force_fire();
     if (m.message == "heat")
         return try_heating(NODIR, flhf_message);
-    if ((m.message == "ignite" || m.message == "expl") && has_firetype(flft_ignitable))
+    if ((m.message == "ignite" || m.message == "_explosion") && has_firetype(flft_ignitable))
         return try_ignite(NODIR, flhf_message);
     if (m.message == "setfire")
         return try_ignite(NODIR, flhf_message);
@@ -154,7 +154,7 @@
  *    - it-burnable or it-burnable_oil is on it
  *  Fire on a burnable floor can be ignited by:
  *    - "setfire"-message
- *    - "expl" or "ignite" message if the "ignitable"-attribute is set
+ *    - "_explosion" or "ignite" message if the "ignitable"-attribute is set
  *        - thereby by it-dynamite or it-*bomb + "ignitable"
  *    - fire in the neighborhood (see below)
  *    - on initialisation ("_init"-message) when "initfire"-attribute is set

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-01-22 01:17:17 UTC (rev 999)
+++ trunk/src/items.cc	2008-01-23 21:31:39 UTC (rev 1000)
@@ -991,7 +991,7 @@
         {}
 
     private:
-        void init_model() {set_anim("expl");}
+        void init_model() {set_anim("_explosion");}
         bool actor_hit(Actor *actor) {
             SendMessage(actor, "shatter");
             return false;
@@ -1083,7 +1083,7 @@
             if (m.message == "ignite") {
                 // dynamite does not blow up Documents in Oxyd1
                 explode = server::GameCompatibility != GAMET_OXYD1;
-            } else if (m.message == "expl" || m.message == "bombstone") {
+            } else if (m.message == "_explosion" || m.message == "_bombstone") {
                 explode = true;
             } else {
                 return Item::message(m);
@@ -1144,7 +1144,7 @@
         }
 
         virtual Value message(const Message &m) {
-            if (m.message == "ignite" || m.message == "expl" || m.message == "bombstone") {
+            if (m.message == "ignite" || m.message == "_explosion" || m.message == "_bombstone") {
                 change_state(BURNING);
                 return Value();
             } else if (m.message == "explode") { // currently unused in c++ code
@@ -1187,7 +1187,7 @@
 
     protected:
         virtual Value message(const Message &m) {
-            if (m.message == "ignite"  || m.message == "expl") {
+            if (m.message == "ignite"  || m.message == "_explosion") {
                 burn();
                 return Value();
             } else if (m.message == "explode" ) {
@@ -1357,12 +1357,12 @@
 {
     m_pressedp = false;
     m_actorcount = 0;
-    set_attrib("invisible", 0.0);
+    set_attrib("invisible", false);
 }
 
 void Trigger::init_model()
 {
-    if (getAttr("invisible") != 0)
+    if (getAttr("invisible").to_bool())
         set_model("invisible");
     else if (m_pressedp)
         set_model("it-trigger1");
@@ -2187,7 +2187,7 @@
 
         Pipe(int stype) : subtype(stype) {}
         virtual Value message(const Message &m) {
-            if (m.message == "expl") {
+            if (m.message == "_explosion") {
                 replace (it_explosion1);
                 return Value();
             }
@@ -2481,7 +2481,7 @@
         kill();   // The brush cleans the floor
         return Value();
     } else if (Floor *fl = GetFloor(get_pos())) {
-        if (m.message == "ignite" || m.message == "expl")
+        if (m.message == "ignite" || m.message == "_explosion")
             return SendMessage(fl, "ignite");
     }
     return Item::message(m);

Modified: trunk/src/oxyd.cc
===================================================================
--- trunk/src/oxyd.cc	2008-01-22 01:17:17 UTC (rev 999)
+++ trunk/src/oxyd.cc	2008-01-23 21:31:39 UTC (rev 1000)
@@ -305,8 +305,8 @@
         char color[2] = "0";
         color[0] += (type-1) / 2; 
 
-        st = MakeStone("st-oxyd");
-        st->set_attrib("color", color);
+        st = MakeStone("st_oxyd");
+        st->set_attrib("oxydcolor", color);
         st->set_attrib("flavor", config.oxyd_flavor);
     }
     else if (type == config.id_timer) {
@@ -448,7 +448,7 @@
         }
     }
 
-    SendMessage(GetObjectTemplate("st-oxyd"), "shuffle");
+    SendMessage(GetObjectTemplate("st_oxyd"), "shuffle");
 }
 
 void OxydLoader::scramble_puzzles ()

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-01-22 01:17:17 UTC (rev 999)
+++ trunk/src/stones/OxydStone.cc	2008-01-23 21:31:39 UTC (rev 1000)
@@ -123,7 +123,7 @@
         size_t  isize = levelOxyds.size();
         // count color usage
         for (size_t i=0; i<isize; ++i) {
-            int color = levelOxyds[i]->getAttr("color");
+            int color = levelOxyds[i]->getAttr("oxydcolor");
             bool declineShuffle = to_bool(levelOxyds[i]->getAttr("noshuffle"));
             if (color >= 0 && color < numColors) {
                 colorsUsageCount[color]++;
@@ -151,7 +151,7 @@
         for (int i = 0; i < numColors; i++) {
             if (colorsUsageCount[i] % 2 == 1) {
                 if (autocoloredOxyds.size() > 0) {
-                    autocoloredOxyds.back()->set_attrib("color", i);
+                    autocoloredOxyds.back()->set_attrib("oxydcolor", i);
                     autocoloredOxyds.pop_back();
                     colorsUsageCount[i]++;
                 } else if (onlyPairs) {
@@ -176,7 +176,7 @@
             if (colorsUsageCount[c] <= 2*(dc/2/numColors) + 1) {
                 lastColor = c;
                 lastObject = autocoloredOxyds.back();
-                lastObject->set_attrib("color", c);
+                lastObject->set_attrib("oxydcolor", c);
                 autocoloredOxyds.pop_back();
                 colorsUsageCount[c]++;
             }
@@ -184,7 +184,7 @@
         }
         // substitute odd oxyd with a fake one
         if (!onlyPairs && lastObject != NULL) {
-            lastObject->set_attrib("color", FAKE);
+            lastObject->set_attrib("oxydcolor", FAKE);
             colorsUsageCount[lastColor]--;
             shuffledFakeCount++;
         } else {
@@ -218,7 +218,7 @@
         size_t  isize = levelOxyds.size();
         for (size_t i=0; i<isize; ++i) {
             OxydStone *candidate = levelOxyds[i];
-            if (candidate->iState == CLOSED && !to_bool(candidate->getAttr("noshuffle"))) {
+            if (candidate->state == CLOSED && !to_bool(candidate->getAttr("noshuffle"))) {
                 closedOxyds.push_back(i);
             }
         }
@@ -232,10 +232,10 @@
                 OxydStone *o1 = levelOxyds[closedOxyds[i]];
                 OxydStone *o2 = levelOxyds[closedOxyds[a]];
     
-                Value icolor = o1->getAttr("color"); 
+                Value icolor = o1->getAttr("oxydcolor"); 
     
-                o1->set_attrib("color", o2->getAttr("color"));
-                o2->set_attrib("color", icolor);
+                o1->set_attrib("oxydcolor", o2->getAttr("oxydcolor"));
+                o2->set_attrib("oxydcolor", icolor);
             }
         }
     }
@@ -263,7 +263,7 @@
             uint32_t noshufflePseudoMask = 0; 
             for (int i = 0; i < numOxyds; i++) {
                 OxydStone *candidate = levelOxyds[i];
-                if ((int)candidate->getAttr("color") < AUTO && 
+                if ((int)candidate->getAttr("oxydcolor") < AUTO && 
                         to_bool(candidate->getAttr("noshuffle")))
                     noshufflePseudoMask |= 1 << i;
             }
@@ -308,7 +308,7 @@
         uint32_t notClosedPseudoMask = 0; 
         for (int i = 0; i < numOxyds; i++) {
             OxydStone *candidate = levelOxyds[i];
-            if ((int)candidate->getAttr("color") < AUTO && candidate->iState != CLOSED)
+            if ((int)candidate->getAttr("oxydcolor") < AUTO && candidate->state != CLOSED)
                 notClosedPseudoMask |= 1 << i;
         }
         second.freeOxydsMask &= ~notClosedPseudoMask;
@@ -353,10 +353,10 @@
             if (top.selOxyd2Mask != 0) {
                 OxydStone *o1 = levelOxyds[oxydId(top.selOxyd1Mask)];
                 OxydStone *o2 = levelOxyds[oxydId(top.selOxyd2Mask)];
-                if ((to_bool(o1->getAttr("noshuffle")) || o1->iState != CLOSED) &&
-                        (to_bool(o2->getAttr("noshuffle")) || o2->iState != CLOSED) &&
-                        (int)(o1->getAttr("color")) >= 0 &&  (int)(o2->getAttr("color")) >= 0 &&
-                        o1->getAttr("color") != o2->getAttr("color")) {
+                if ((to_bool(o1->getAttr("noshuffle")) || o1->state != CLOSED) &&
+                        (to_bool(o2->getAttr("noshuffle")) || o2->state != CLOSED) &&
+                        (int)(o1->getAttr("oxydcolor")) >= 0 &&  (int)(o2->getAttr("oxydcolor")) >= 0 &&
+                        o1->getAttr("oxydcolor") != o2->getAttr("oxydcolor")) {
                     logBadFrameCount++;
                     return 0;
                 }
@@ -520,10 +520,10 @@
 
         // opened oxyd pairs first
         for (;next.openedOxydIndex < numOxyds; next.openedOxydIndex++) {
-            if (levelOxyds[next.openedOxydIndex]->iState == OPEN_PAIR) {
-                int c = levelOxyds[next.openedOxydIndex]->getAttr("color");
+            if (levelOxyds[next.openedOxydIndex]->state == OPEN_PAIR) {
+                int c = levelOxyds[next.openedOxydIndex]->getAttr("oxydcolor");
                 for (int i = next.openedOxydIndex+1; i < numOxyds; i++) {
-                    if (levelOxyds[i]->getAttr("color") == c) {
+                    if (levelOxyds[i]->getAttr("oxydcolor") == c) {
                         next.selOxyd1Mask = 1 << next.openedOxydIndex;
                         next.selOxyd2Mask = 1 << i;
                         next.openedOxydIndex++;
@@ -540,15 +540,15 @@
         // it is essential to select known pairs first
         for (;next.fixedcolorOxydIndex < numOxyds; next.fixedcolorOxydIndex++) {
             OxydStone *candidate1 = levelOxyds[next.fixedcolorOxydIndex];
-            int color1 = candidate1->getAttr("color");
-            if ((int)candidate1->getAttr("color") > AUTO && (
-                    to_bool(candidate1->getAttr("noshuffle")) || candidate1->iState == OPENING ||
-                    candidate1->iState == CLOSING || candidate1->iState == OPEN_SINGLE )) {
+            int color1 = candidate1->getAttr("oxydcolor");
+            if ((int)candidate1->getAttr("oxydcolor") > AUTO && (
+                    to_bool(candidate1->getAttr("noshuffle")) || candidate1->state == OPENING ||
+                    candidate1->state == CLOSING || candidate1->state == OPEN_SINGLE )) {
                 for (int i = next.fixedcolorOxydIndex+1; i < numOxyds; i++) {
                     OxydStone *candidate2 = levelOxyds[i];
-                    if (candidate2->getAttr("color") == color1 && (
-                            to_bool(candidate2->getAttr("noshuffle")) || candidate2->iState == OPENING ||
-                            candidate2->iState == CLOSING || candidate2->iState == OPEN_SINGLE)) {
+                    if (candidate2->getAttr("oxydcolor") == color1 && (
+                            to_bool(candidate2->getAttr("noshuffle")) || candidate2->state == OPENING ||
+                            candidate2->state == CLOSING || candidate2->state == OPEN_SINGLE)) {
                         next.selOxyd1Mask = 1 << next.fixedcolorOxydIndex;
                         next.selOxyd2Mask = 1 << i;
                         if ((next.selOxyd2Mask & next.oxydsCandidatesMask[next.fixedcolorOxydIndex]) == 0)
@@ -638,9 +638,9 @@
         // check that minFreeOxydId is not a noshuffle standard oxyd that can not
         // be recolored to a pseudo!
         OxydStone *pseudocandidate = levelOxyds[minFreeOxydId];
-        if (next.freePseudoCount > 0 && ((int)pseudocandidate->getAttr("color") < AUTO || 
+        if (next.freePseudoCount > 0 && ((int)pseudocandidate->getAttr("oxydcolor") < AUTO || 
                 (!(to_bool(pseudocandidate->getAttr("noshuffle"))) &&
-                pseudocandidate->iState == CLOSED))) {
+                pseudocandidate->state == CLOSED))) {
             next.selOxyd1Mask = 1 << minFreeOxydId;
             next.selOxyd2Mask = 0;
             shuffleStack.push_back(next);    // add copy of next frame
@@ -676,13 +676,13 @@
                     int i = IntegerRand(1, remainFakeCount + remainFartCount + remainBoldCount);  // use enigma's internal rand!
                     if (i <= remainFakeCount) {
                         remainFakeCount--;
-                        oxyd->set_attrib("color", FAKE);
+                        oxyd->set_attrib("oxydcolor", FAKE);
                     } else if ( i <= remainFakeCount + remainFartCount) {
                         remainFartCount--;
-                        oxyd->set_attrib("color", FART);
+                        oxyd->set_attrib("oxydcolor", FART);
                     } else {
                         remainBoldCount--;
-                        oxyd->set_attrib("color", BOLD);
+                        oxyd->set_attrib("oxydcolor", BOLD);
                     }
                     (*itr).isColored = true;
                 } else {
@@ -690,23 +690,23 @@
                     OxydStone *oxyd1 = levelOxyds[oxydId((*itr).selOxyd1Mask)];
                     OxydStone *oxyd2 = levelOxyds[oxydId((*itr).selOxyd2Mask)];
                     int c = AUTO;
-                    if (oxyd1->iState == OPEN_PAIR) {
+                    if (oxyd1->state == OPEN_PAIR) {
                         // a pair of opened oxyds - we need not to recolor
                         // but we need to register the used color
-                        c = oxyd1->getAttr("color");
+                        c = oxyd1->getAttr("oxydcolor");
                         colorsRemainCount[c] -= 2;                        
                         (*itr).isColored = true;
                     }
-                    else if (to_bool(oxyd1->getAttr("noshuffle")) || oxyd1->iState != CLOSED) {
+                    else if (to_bool(oxyd1->getAttr("noshuffle")) || oxyd1->state != CLOSED) {
                         // a standard oxyd (pseudo is impossible) that requires a color
-                        c = oxyd1->getAttr("color");
-                        oxyd2->set_attrib("color", c);
+                        c = oxyd1->getAttr("oxydcolor");
+                        oxyd2->set_attrib("oxydcolor", c);
                         colorsRemainCount[c] -= 2;
                         (*itr).isColored = true;
                     }
-                    else if (to_bool(oxyd2->getAttr("noshuffle")) || oxyd2->iState != CLOSED) {
-                        c = oxyd2->getAttr("color");
-                        oxyd1->set_attrib("color", c);
+                    else if (to_bool(oxyd2->getAttr("noshuffle")) || oxyd2->state != CLOSED) {
+                        c = oxyd2->getAttr("oxydcolor");
+                        oxyd1->set_attrib("oxydcolor", c);
                         colorsRemainCount[c] -= 2;
                         (*itr).isColored = true;
                     }
@@ -733,8 +733,8 @@
         int ci = 0;
         for (std::list<ShuffleFrame>::iterator itr = shuffleStack.begin(); itr != shuffleStack.end(); ++itr) {
             if (!(*itr).isColored && (*itr).selOxyd1Mask != 0) {
-                levelOxyds[oxydId((*itr).selOxyd1Mask)]->set_attrib("color", colorPairs[ci]);
-                levelOxyds[oxydId((*itr).selOxyd2Mask)]->set_attrib("color", colorPairs[ci]);
+                levelOxyds[oxydId((*itr).selOxyd1Mask)]->set_attrib("oxydcolor", colorPairs[ci]);
+                levelOxyds[oxydId((*itr).selOxyd2Mask)]->set_attrib("oxydcolor", colorPairs[ci]);
                 ci++;
             }
         }
@@ -836,9 +836,9 @@
     
     // Instance Methods
     
-    OxydStone::OxydStone() : PhotoStone("st-oxyd"), iState (CLOSED) {
+    OxydStone::OxydStone() : PhotoStone("st_oxyd") {
         set_attrib("flavor", "b");
-        set_attrib("color", AUTO);
+        set_attrib("oxydcolor", AUTO);
     }
     
     OxydStone * OxydStone::clone() { 
@@ -856,22 +856,18 @@
     
     Value OxydStone::message(const Message &m) {
         if (m.message == "closeall") {
-            closeAllStandardOxyds();
+            if (isDisplayable())
+                closeAllStandardOxyds();
             return Value();
         }
         else if (m.message == "shuffle") {
             shuffleColors();
             return Value();
         }
-        else if ((m.message == "_trigger"  && m.value.to_bool())|| m.message == "toggle"|| m.message == "spitter") {
-            tryOpen();
+        else if ((m.message == "_trigger"  && m.value.to_bool()) || m.message == "_spitter") {
+            tryOpen();   // just internal messages on displayable oxyds
             return Value();
         }
-        else if (m.message == "signal") {
-            if (m.value != 0)
-                tryOpen();
-            return Value();
-        }
         else if (m.message == "_init") {
             initColors();
             return Value();
@@ -880,23 +876,60 @@
     }
     
     void OxydStone::set_attrib(const string& key, const Value &val) {
-        if (key == "color") 
-            ASSERT(iState == CLOSED, XLevelRuntime, "OxydStone error - recoloring of an not closed stone");
+        if (key == "oxydcolor") 
+            ASSERT(state == CLOSED, XLevelRuntime, "OxydStone error - recoloring of an not closed stone");
         else if (key == "flavor") {
-            ASSERT(iState == CLOSED, XLevelRuntime, "OxydStone error - reflavoring of an not closed stone");
+            ASSERT(state == CLOSED, XLevelRuntime, "OxydStone error - reflavoring of an not closed stone");
         }
         
-        Object::set_attrib(key, val);   // do value checking
+        PhotoStone::set_attrib(key, val);   // do value checking
         
         if (key == "flavor" && IsInsideLevel(get_pos()))
             set_model(string("st-oxyd")+(std::string)val);
     }
+        
+    int OxydStone::maxState() {
+        return 2;
+    }
     
-    Value OxydStone::getAttr(const string &key) const {
-        // TODO "state" 0=CLOSE || CLOSING; 1 = other iState values
-        return PhotoStone::getAttr(key);
+    void OxydStone::toggleState() {
+        switch (state) {
+            case OPEN_PAIR :
+                return;         // not possible
+            case OPEN_SINGLE :
+            case OPENING :
+                setState(0);    // start closing
+                return;
+            default:
+                setState(1);    // try to open
+                return;
+        }        
     }
     
+    int OxydStone::externalState() const {
+        switch (state) {
+            case OPEN_SINGLE :
+            case OPENING :
+                return 1;
+            case OPEN_PAIR :
+                return 2;
+            default:
+                return 0;
+        }
+    }
+    
+    void OxydStone::setState(int extState) {
+        ASSERT(extState <= 1, XLevelRuntime, "OxydStone error - attempt to set state OPEN_PAIR");
+        if (isDisplayable()) {
+            if (state == OPEN_PAIR)
+                return;      // ignore - no change possible
+            else if (extState == 1)
+                tryOpen();
+            else if (getAttr("oxydcolor") >= AUTO)  // just close standard oxyds
+                set_iState(CLOSING);
+        }
+    }
+    
     void OxydStone::actor_hit(const StoneContact &/*sc*/) {
         tryOpen();
     }
@@ -906,13 +939,13 @@
     }
     
     void OxydStone::animcb() {
-        if (iState == CLOSING)
+        if (state == CLOSING)
             set_iState(CLOSED);
-        else if (iState == OPENING)
+        else if (state == OPENING)
             set_iState(OPEN_SINGLE);
-        else if (iState == OPEN_PAIR)     // end of opening anim for second oxyd in a pair
+        else if (state == OPEN_PAIR)     // end of opening anim for second oxyd in a pair
             set_iState(OPEN_PAIR);      // set the right model
-        else if (iState == OPEN_SINGLE)   // pseudo animation
+        else if (state == OPEN_SINGLE)   // pseudo animation
             set_iState(CLOSING);
     }
     
@@ -935,20 +968,20 @@
         
         // check for a blocking pseudo
         for (InstanceVector::iterator itr = levelOxyds.begin(); itr != levelOxyds.end(); ++itr) {
-            if ((*itr)->iState != CLOSED && (int)((*itr)->getAttr("color")) < AUTO) {
+            if ((*itr)->state != CLOSED && (int)((*itr)->getAttr("oxydcolor")) < AUTO) {
                 // a pseudo is blocking any opening of other oxyds
                 // this is necessary as the bold reshuffle can take place only after
                 // finishing its closing animation!
                 return;
             }
-            if ((*itr)->iState == OPEN_SINGLE || (*itr)->iState == OPENING) {
+            if ((*itr)->state == OPEN_SINGLE || (*itr)->state == OPENING) {
                 // remember a standard colored pair candidate
                 isSingleOpened = true;
                 pairCandidate = *itr;
             }
         }
         
-        Value mycolor = getAttr("color");    
+        Value mycolor = getAttr("oxydcolor");    
         if ((int)mycolor < AUTO) {
             // pseudo open
             if (isSingleOpened) {
@@ -959,7 +992,7 @@
             if ((int)mycolor <= FART)
                 set_iState(OPENING);
         }
-        else if (iState == CLOSED || iState == CLOSING) {
+        else if (state == CLOSED || state == CLOSING) {
             // standard colored oxyd open
             
             if (isSingleOpened) {
@@ -970,14 +1003,14 @@
                     // open both stones. Close one of them otherwise.
                     // (This is the Oxyd behaviour; it doesn't work with
                     // some Enigma levels.)
-                    can_open = (mycolor == pairCandidate->getAttr("color") && pairCandidate->iState==OPEN_SINGLE);
+                    can_open = (mycolor == pairCandidate->getAttr("oxydcolor") && pairCandidate->state==OPEN_SINGLE);
                 }
                 else 
-                    can_open = (mycolor == pairCandidate->getAttr("color"));
+                    can_open = (mycolor == pairCandidate->getAttr("oxydcolor"));
     
                 if (can_open) {
+                    pairCandidate->set_iState(OPEN_PAIR);
                     set_iState(OPEN_PAIR);
-                    pairCandidate->set_iState(OPEN_PAIR);
                 } else {
                     pairCandidate->set_iState(CLOSING);
                     set_iState(OPENING);
@@ -992,35 +1025,37 @@
     
     void OxydStone::closeAllStandardOxyds() {
         for (unsigned i=0; i<levelOxyds.size(); ++i)
-            if ((int)(levelOxyds[i]->getAttr("color")) >= AUTO)
+            if ((int)(levelOxyds[i]->getAttr("oxydcolor")) >= AUTO)
                 levelOxyds[i]->set_iState(CLOSING);
     }
     
-    void OxydStone::set_iState(State newState) {
+    void OxydStone::set_iState(iState newState) {
         string flavor(getDefaultedAttr("flavor","a"));
-        string color(getDefaultedAttr("color", 0));
+        string color(getDefaultedAttr("oxydcolor", 0));
     
         string basemodelname = string("st-oxyd") + flavor;
         string modelname = basemodelname + color;
     
-        State oldState = iState;
-        iState = newState;
+        iState oldState = (iState)state;
+        int oldExtState = externalState();
+        
+        state = newState;
     
         switch (newState) {
             case CLOSED:
-                if ((int)getAttr("color") == BOLD)
+                if ((int)getAttr("oxydcolor") == BOLD)
                     shuffleColors();    // shuffle all closed oxyds including itself
                     
                 set_model(string("st-oxyd")+flavor);
                 break;
         
             case OPEN_SINGLE:
-                if ((int)getAttr("color") <= FART) {
+                if ((int)getAttr("oxydcolor") <= FART) {
                     set_anim(basemodelname + "-pseudo" + color);
-                    if ((int)getAttr("color") == FART) {
+                    if ((int)getAttr("oxydcolor") == FART) {
                         closeAllStandardOxyds();
                         sound_event("fart");
-                    } else if ((int)getAttr("color") == BOLD) {
+                    } else if ((int)getAttr("oxydcolor") == BOLD) {
                         sound_event("shuffle");
                     }
                 } else
@@ -1053,7 +1088,7 @@
         
             case CLOSING:
                 if (oldState == CLOSED || oldState==CLOSING) {
-                    iState = oldState;
+                    state = oldState;
                     return;
                 }
         
@@ -1065,6 +1100,8 @@
                 }
                 break;
         }
+        if (oldExtState != externalState() && (oldExtState != 1 || externalState() != 2))
+            performAction(externalState() != 0);
     }
     
 

Modified: trunk/src/stones/OxydStone.hh
===================================================================
--- trunk/src/stones/OxydStone.hh	2008-01-22 01:17:17 UTC (rev 999)
+++ trunk/src/stones/OxydStone.hh	2008-01-23 21:31:39 UTC (rev 1000)
@@ -85,8 +85,13 @@
         virtual void dispose();
         virtual Value message(const Message &m);
         virtual void set_attrib(const string& key, const Value &val);
-        virtual Value getAttr(const string &key) const;
 
+        // StateObject interface
+        virtual int maxState();
+        virtual void toggleState();
+        virtual int externalState() const;
+        virtual void setState(int extState);
+
         // Stone interface
         virtual void actor_hit(const StoneContact &sc);
         virtual const char *collision_sound() { return "stone"; }
@@ -105,7 +110,7 @@
         void on_removal (GridPos p);
             
     private:
-        enum State { CLOSED, OPEN_PAIR, OPENING, CLOSING, OPEN_SINGLE };
+        enum iState { CLOSED, OPEN_PAIR, OPENING, CLOSING, OPEN_SINGLE };
         
         typedef std::vector<OxydStone *> InstanceVector;
         
@@ -175,15 +180,14 @@
         static void log_shuffle_stack();
         
         static bool not_open(OxydStone *a) {
-            return !(a->iState == OPEN_PAIR || (int)a->getAttr("color") < AUTO);
+            return !(a->state == OPEN_PAIR || (int)a->getAttr("oxydcolor") < AUTO);
         }
 
-        State iState;
 
         // Private methods
         void tryOpen();
         void closeAllStandardOxyds();
-        void set_iState(State newState);
+        void set_iState(iState newState);
     };
 } // namespace enigma
 

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-01-22 01:17:17 UTC (rev 999)
+++ trunk/src/stones.cc	2008-01-23 21:31:39 UTC (rev 1000)
@@ -747,7 +747,7 @@
             break_me();
         }
         virtual Value message(const Message &m) {
-            if (m.message =="ignite" || m.message == "expl" || m.message == "bombstone") {
+            if (m.message =="ignite" || m.message == "_explosion" || m.message == "_bombstone") {
                 break_me();
                 return Value();
             }
@@ -788,7 +788,7 @@
         }
 
         virtual Value message(const Message &m) {
-            if (m.message =="ignite" || m.message == "expl" || m.message == "bombstone") {
+            if (m.message =="ignite" || m.message == "_explosion" || m.message == "_bombstone") {
                 break_me();
                 return Value();
             }
@@ -830,7 +830,7 @@
             ReplaceStone(get_pos(), MakeStone ("st-plain_breaking"));
         }
         virtual Value message(const Message &m) {
-            if (m.message =="ignite" || m.message == "expl" || m.message == "bombstone") {
+            if (m.message =="ignite" || m.message == "_explosion" || m.message == "_bombstone") {
                 break_me();
                 return Value();
             }

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-01-22 01:17:17 UTC (rev 999)
+++ trunk/src/stones_simple.cc	2008-01-23 21:31:39 UTC (rev 1000)
@@ -556,7 +556,7 @@
         }
         
         virtual Value message(const Message &m) {
-            if (m.message =="ignite" || m.message == "expl" || m.message == "bombstone") {
+            if (m.message =="ignite" || m.message == "_explosion" || m.message == "_bombstone") {
                 break_me();
                 return Value();
             }
@@ -1258,7 +1258,7 @@
             set_attrib("interval", 1.0);
             set_attrib("loop", true);
             set_attrib("on", 1.0);
-            set_attrib("invisible", 0.0);
+            set_attrib("invisible", false);
 
             // set_on(true);   DOESN'T WORK! calls init_model()
         }
@@ -1276,7 +1276,7 @@
         }
 
         void init_model() {
-            if (getAttr("invisible") == 1) {
+            if (getAttr("invisible").to_bool()) {
                 set_model("invisible");
             }
             else {
@@ -1408,7 +1408,7 @@
             (m.message == "_trigger" && m.value.to_bool())) {
         change_state(FARTING);
         return Value();
-    } else if (m.message == "ignite" || m.message == "expl") { 
+    } else if (m.message == "ignite" || m.message == "_explosion") { 
         change_state(BREAKING);
         return Value();
     }
@@ -1847,7 +1847,7 @@
 
 Value BombStone::message(const Message &m) 
 {
-    if (m.message =="expl" || m.message =="bombstone") {
+    if (m.message =="_explosion" || m.message =="_bombstone") {
         change_state(BREAK);
         return Value();
     }
@@ -2029,7 +2029,7 @@
         }
 
         virtual Value message(const Message &m) {
-            if (m.message == "expl") {
+            if (m.message == "_explosion") {
                 explode();
                 return Value();
             }

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-01-22 01:17:17 UTC (rev 999)
+++ trunk/src/world.cc	2008-01-23 21:31:39 UTC (rev 1000)
@@ -1916,17 +1916,17 @@
     void explosion (GridPos p, ItemID explosion_item)
     {
         if (Stone *stone = GetStone(p))
-            SendMessage(stone, "expl");
+            SendMessage(stone, "_explosion");
         if (Item  *item  = GetItem(p)) {
             if (has_flags(item, itf_indestructible))
-                SendMessage(item, "expl");
+                SendMessage(item, "_explosion");
             else
                 SetItem(p, explosion_item);
         }
         else
             SetItem(p, explosion_item);
         if (Floor *floor = GetFloor(p))
-            SendMessage(floor, "expl");
+            SendMessage(floor, "_explosion");
     }
 }
 
@@ -1967,9 +1967,9 @@
 
         case EXPLOSION_BOMBSTONE:
             if (direct_neighbor) {
-                if (stone) SendMessage(stone, "bombstone");
-                if (item) SendMessage(item, "bombstone");
-                if (floor) SendMessage(floor, "bombstone");
+                if (stone) SendMessage(stone, "_bombstone");
+                if (item) SendMessage(item, "_bombstone");
+                if (floor) SendMessage(floor, "_bombstone");
             }
             break;
 



From ral at mail.berlios.de  Wed Jan 23 22:43:14 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 23 Jan 2008 22:43:14 +0100
Subject: [Enigma-game-svn] r1001 - team_levelpacks/team_test_new_api
Message-ID: <200801232143.m0NLhEr1027534@sheep.berlios.de>

Author: ral
Date: 2008-01-23 22:43:14 +0100 (Wed, 23 Jan 2008)
New Revision: 1001

Added:
   team_levelpacks/team_test_new_api/ralT028_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT014_1.xml
   team_levelpacks/team_test_new_api/ralT016_1.xml
   team_levelpacks/team_test_new_api/ralT017_1.xml
   team_levelpacks/team_test_new_api/ralT018_1.xml
   team_levelpacks/team_test_new_api/ralT019_1.xml
Log:
Team Test Levels:
- renamings for r1000
- testlevel for st_oxyd

Modified: team_levelpacks/team_test_new_api/ralT014_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT014_1.xml	2008-01-23 21:31:39 UTC (rev 1000)
+++ team_levelpacks/team_test_new_api/ralT014_1.xml	2008-01-23 21:43:14 UTC (rev 1001)
@@ -32,7 +32,7 @@
 ti["b"] = ti[" "] .. {"st_blocker", name="blocker"}
 ti["d"] = ti[" "] .. {"st-door_b", name="door#"}
 ti["h"] = ti[" "] .. {"st-chess_black", name="chess#"}
-ti["o"] = ti[" "] .. {"st-oxyd"}
+ti["o"] = ti[" "] .. {"st_oxyd"}
 ti["B"] = ti[" "] .. {"it-bag"}
 ti["T"] = ti[" "] .. {"st-thief"}
 ti["t"] = {"fl-thief"}

Modified: team_levelpacks/team_test_new_api/ralT016_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT016_1.xml	2008-01-23 21:31:39 UTC (rev 1000)
+++ team_levelpacks/team_test_new_api/ralT016_1.xml	2008-01-23 21:43:14 UTC (rev 1001)
@@ -49,7 +49,7 @@
 ti["G"] = ti[" "] .. {"st_boulder_e"}
 
 
-ti["X"] = ti[" "] .. {"st-oxyd"}
+ti["X"] = ti[" "] .. {"st_oxyd"}
 ti["1"] = ti[" "] .. {"#ac-blackball"}
 
 w, h = wo(ti, " ", {

Modified: team_levelpacks/team_test_new_api/ralT017_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT017_1.xml	2008-01-23 21:31:39 UTC (rev 1000)
+++ team_levelpacks/team_test_new_api/ralT017_1.xml	2008-01-23 21:43:14 UTC (rev 1001)
@@ -22,10 +22,10 @@
 ti[" "] = {"fl-sahara"}
 ti["#"] = ti[" "] .. {"st-rock1"}
 
-ti["O"] = ti[" "] .. {"st-oxyd", name="o#", color=1, noshuffle=false}
-ti["P"] = ti[" "] .. {"st-oxyd", name="p#"}
-ti["Q"] = ti[" "] .. {"st-oxyd", name="q1", color=5, noshuffle=false}
-ti["q"] = ti[" "] .. {"st-oxyd", name="q2", color=7, noshuffle=true}
+ti["O"] = ti[" "] .. {"st_oxyd", name="o#", oxydcolor=1, noshuffle=false}
+ti["P"] = ti[" "] .. {"st_oxyd", name="p#"}
+ti["Q"] = ti[" "] .. {"st_oxyd", name="q1", oxydcolor=5, noshuffle=false}
+ti["q"] = ti[" "] .. {"st_oxyd", name="q2", oxydcolor=7, noshuffle=true}
 ti["1"] = ti[" "] .. {"#ac-blackball"}
 
 w, h = wo(ti, " ", {

Modified: team_levelpacks/team_test_new_api/ralT018_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT018_1.xml	2008-01-23 21:31:39 UTC (rev 1000)
+++ team_levelpacks/team_test_new_api/ralT018_1.xml	2008-01-23 21:43:14 UTC (rev 1001)
@@ -23,15 +23,15 @@
 ti[" "] = {"fl-sahara"}
 ti["#"] = ti[" "] .. {"st-rock1"}
 
-ti["O"] = ti[" "] .. {"st-oxyd", name="o#", flavor="d"}
-ti["P"] = ti[" "] .. {"st-oxyd", name="p#"}
-ti["Q"] = ti[" "] .. {"st-oxyd", name="q1", color=5}
+ti["O"] = ti[" "] .. {"st_oxyd", name="o#", flavor="d"}
+ti["P"] = ti[" "] .. {"st_oxyd", name="p#"}
+ti["Q"] = ti[" "] .. {"st_oxyd", name="q1", oxydcolor=5}
 --ti["S"] = ti[" "] .. {"st_switch", action="shuffle", target="o#1"}
 ti["S"] = ti[" "] .. {"st_switch", action="callback", target="newflavor"}
 ti["1"] = ti[" "] .. {"#ac-blackball"}
-ti["B"] = ti[" "] .. {"st-oxyd", color=-4, flavor="d", noshuffle=false}
-ti["F"] = ti[" "] .. {"st-oxyd", color=-3, flavor="a", noshuffle=false}
-ti["K"] = ti[" "] .. {"st-oxyd", color=-2, flavor="c", noshuffle=false}
+ti["B"] = ti[" "] .. {"st_oxyd", oxydcolor=-4, flavor="d", noshuffle=false}
+ti["F"] = ti[" "] .. {"st_oxyd", oxydcolor=-3, flavor="a", noshuffle=false}
+ti["K"] = ti[" "] .. {"st_oxyd", oxydcolor=-2, flavor="c", noshuffle=false}
 
 
 w, h = wo(ti, " ", {

Modified: team_levelpacks/team_test_new_api/ralT019_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT019_1.xml	2008-01-23 21:31:39 UTC (rev 1000)
+++ team_levelpacks/team_test_new_api/ralT019_1.xml	2008-01-23 21:43:14 UTC (rev 1001)
@@ -22,12 +22,12 @@
 ti[" "] = {"fl-sahara"}
 ti["#"] = ti[" "] .. {"st-rock1"}
 
-ti["O"] = ti[" "] .. {"st-oxyd", name="o#"}
-ti["P"] = ti[" "] .. {"st-oxyd", name="p#"}
-ti["Q"] = ti[" "] .. {"st-oxyd", name="q#"}
-ti["R"] = ti[" "] .. {"st-oxyd", name="r#"}
-ti["S"] = ti[" "] .. {"st-oxyd", name="s#"}
-ti["T"] = ti[" "] .. {"st-oxyd", name="t#"}
+ti["O"] = ti[" "] .. {"st_oxyd", name="o#"}
+ti["P"] = ti[" "] .. {"st_oxyd", name="p#"}
+ti["Q"] = ti[" "] .. {"st_oxyd", name="q#"}
+ti["R"] = ti[" "] .. {"st_oxyd", name="r#"}
+ti["S"] = ti[" "] .. {"st_oxyd", name="s#"}
+ti["T"] = ti[" "] .. {"st_oxyd", name="t#"}
 ti["1"] = ti[" "] .. {"#ac-blackball"}
 
 w, h = wo(ti, " ", {

Added: team_levelpacks/team_test_new_api/ralT028_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT028_1.xml	2008-01-23 21:31:39 UTC (rev 1000)
+++ team_levelpacks/team_test_new_api/ralT028_1.xml	2008-01-23 21:43:14 UTC (rev 1001)
@@ -0,0 +1,86 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Oxyd new API" el:subtitle="" el:id="20080123ral771"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2007 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["#"] = ti[" "] .. {"st-rock1"}
+
+ti["O"] = ti[" "] .. {"st_oxyd", "o#", target="enlighten"}
+ti["F"] = ti[" "] .. {"st_oxyd", oxydcolor=-3, noshuffle=true}
+ti["B"] = ti[" "] .. {"st_oxyd", "bold", oxydcolor=-4, noshuffle=true}
+ti["S"] = ti[" "] .. {"st_switch", target="o#1"}
+ti["T"] = ti[" "] .. {"st_switch", target="o#2", action="open"}
+ti["U"] = ti[" "] .. {"st_switch", target="o#2", action="close"}
+ti["V"] = ti[" "] .. {"st_switch", target="o#3", action="signal"}
+ti["W"] = ti[" "] .. {"st_switch", target="statetest"}
+ti["C"] = ti[" "] .. {"st_switch", target="bold", action="signal"}
+ti["L"] = ti[" "] .. {"st-laser-n", "Laser#"}
+ti["l"] = ti[" "] .. {"st-laser-n", "laser#"}
+ti["b"] = ti[" "] .. {"st_boulder_s"}
+ti["X"] = ti[" "] .. {"st_switch", target="o#1", action="shuffle"}
+ti["Y"] = ti[" "] .. {"st_switch", target="o#1", action="closeall"}
+ti["1"] = (ti[" "] .. {"it-magicwand"}) .. {"#ac-blackball"}
+
+w, h = wo(ti, " ", {
+"                    ",
+"  Ll Ll Ll Ll Ll Ll ",
+"                    ",
+"  O  O  O  O  O  O  ",
+"                    ",
+"  S  TU V  W        ",
+"                    ",
+"      1             ",
+"                    ",
+"                    ",
+"                    ",
+"    F      C B      ",
+"      Y  X       b  "
+})
+
+wo:shuffleOxyd()
+
+function statetest(value)
+    local newstate = 0
+    if value then newstate = 1 end
+    (no["o#4"])["state"] = newstate
+end
+
+function enlighten(value, sender)
+    -- the single opened oxyd
+    no["Laser" .. string.sub(sender["name"],2)]:onoff()
+    
+    -- all pair opened oxyds with the second laser
+    for i=1,6 do
+        if no["o#"..i]["state"] == 2 then
+            no["laser#"..i]["on"] = 1   -- laser not yet new API!
+        else
+            no["laser#"..i]:off()
+        end
+    end
+end
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT028_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Fri Jan 25 00:21:45 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 25 Jan 2008 00:21:45 +0100
Subject: [Enigma-game-svn] r1002 - in trunk: data src src/stones
Message-ID: <200801242321.m0ONLjA2003105@sheep.berlios.de>

Author: ral
Date: 2008-01-25 00:21:44 +0100 (Fri, 25 Jan 2008)
New Revision: 1002

Added:
   trunk/src/stones/ClusterStone.cc
   trunk/src/stones/ClusterStone.hh
Modified:
   trunk/data/models-2d.lua
   trunk/src/GridObject.cc
   trunk/src/GridObject.hh
   trunk/src/Makefile.am
   trunk/src/items.cc
   trunk/src/stones/ConnectiveStone.hh
   trunk/src/stones/Switch.cc
   trunk/src/world.cc
Log:
Trunk 1.1: Reengineering Connective Stones
- fix st_switch state value on instant case
- fix r1000 it-explosion renamed animation error
- world object naming: allow a replacement object with identical name as
  predecessor.
- GridObject as basis for connective object: 
  - support for attribut handling of "connections", "faces", "$connections"
  - model handling of connective objects
- ClusterStone as common C++ class for simple stones that support clustering
  - "st_panel", "st_brick", "st_bluesand"
  - auto clustering by common "cluster" attribute according to 4-color theorem
  - dynamic reclustering on change of connections, removed or added
    ClusterStones.
ToDo:
- map old Big* stones to new ones and remove old code


Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-01-23 21:43:14 UTC (rev 1001)
+++ trunk/data/models-2d.lua	2008-01-24 23:21:44 UTC (rev 1002)
@@ -758,6 +758,27 @@
     DefSolidStone("st-wood_001", "st-bigpanelx1")
 end
 
+-- st_bluesand --
+do
+    DefSubimages("st-bigbluesand", {modelname="st_bluesandx",w=4,h=4})
+    for i=0,15 do DefSolidStone("st_bluesand"..i, "st_bluesandx"..(i+1)) end
+    DefSolidStone("st_bluesand", "st_bluesandx1")
+end
+
+-- st_brick --
+do
+    DefSubimages("st-bigbrick", {modelname="st_brickx",w=4,h=4})
+    for i=0,15 do DefSolidStone("st_brick"..i, "st_brickx"..(i+1)) end
+    DefSolidStone("st_brick", "st_brickx1")
+end
+
+-- st_panel --
+do
+    DefSubimages("st-bigpanel", {modelname="st_panelx",w=4,h=4})
+    for i=0,15 do DefSolidStone("st_panel"..i, "st_panelx"..(i+1)) end
+    DefSolidStone("st_panel", "st_panelx1")
+end
+
 -- st-bolder --
 do
     local img=DefSubimages("st-bolder", {w=4,h=3})

Modified: trunk/src/GridObject.cc
===================================================================
--- trunk/src/GridObject.cc	2008-01-23 21:43:14 UTC (rev 1001)
+++ trunk/src/GridObject.cc	2008-01-24 23:21:44 UTC (rev 1002)
@@ -108,9 +108,65 @@
         va_end(arg_ptr);
     }
     
+    void GridObject::set_attrib(const string& key, const Value &val) {
+        if (key == "connections" || key == "faces") {
+            int d = NODIRBIT;
+            std::string vs(val);
+            if (vs.find('n') != std::string::npos) d |= NORTHBIT;
+            if (vs.find('e') != std::string::npos) d |= EASTBIT;
+            if (vs.find('s') != std::string::npos) d |= SOUTHBIT;
+            if (vs.find('w') != std::string::npos) d |= WESTBIT;
+            if (key == "faces") d ^= ALL_DIRECTIONS;
+            Object::set_attrib("$connections", d);
+            if (isDisplayable())
+                init_model();
+        } else if (key == "$connections") {
+            Object::set_attrib("$connections", val);
+            if (isDisplayable())
+                init_model();
+        } else
+            Object::set_attrib(key, val);
+    }
+    
+    Value GridObject::getAttr(const string &key) const {
+        if (key == "connections" || (key == "faces")) {
+            std::string result;
+            DirectionBits db = (key == "connections") ? getConnections() :getFaces();
+            if (db & NORTHBIT) result += "n";
+            if (db & EASTBIT)  result += "e";
+            if (db & SOUTHBIT) result += "s";
+            if (db & WESTBIT)  result += "w";
+            return result;
+        } else
+            return StateObject::getAttr(key);
+    }
+    
     void GridObject::setState(int extState) {
         StateObject::setState(extState);
         init_model();
     }
     
+    std::string GridObject::getModelName() const {
+        return get_kind();
+    }
+    
+    void GridObject::init_model() {
+        DirectionBits c = getConnections();
+        if (c != NODIRBIT)
+            set_model(getModelName() + ecl::strf("%d", c));
+        else
+            set_model(getModelName());
+    }
+
+    DirectionBits GridObject::getConnections() const {
+        if (Value v = getAttr("$connections"))
+            return DirectionBits((int)v);
+        else
+            return NODIRBIT;
+    }
+    
+    DirectionBits GridObject::getFaces() const {
+        return DirectionBits(ALL_DIRECTIONS ^ getConnections());
+    }
+    
 } // namespace enigma

Modified: trunk/src/GridObject.hh
===================================================================
--- trunk/src/GridObject.hh	2008-01-23 21:43:14 UTC (rev 1001)
+++ trunk/src/GridObject.hh	2008-01-24 23:21:44 UTC (rev 1002)
@@ -44,6 +44,14 @@
         GridObject() : pos (GridPos(-1, -1)) {}
         GridObject(const char * kind) : StateObject(kind), pos (GridPos(-1, -1)) {}
 
+        // Object interface
+        virtual void set_attrib(const string& key, const Value &val);
+        virtual Value getAttr(const string &key) const;
+
+        // StateObject interface
+        virtual void setState(int extState);
+
+
         void creation(GridPos p) {
             pos = p;
             on_creation (p);
@@ -89,27 +97,28 @@
         bool sound_event (const char *name, double vol = 1.0);
         display::Model *set_anim (const std::string &mname);
 
+        DirectionBits getConnections() const;
+        DirectionBits getFaces() const;
+
     protected:
         // GridObject interface
+        virtual std::string getModelName() const;
         virtual void set_model (const std::string &mname) = 0;
         virtual display::Model *get_model () = 0;
         virtual void kill_model (GridPos p) = 0;
 
-        virtual void init_model() {
-            set_model(get_kind());
-        }
+        virtual void init_model();
 
-        virtual void on_creation (GridPos) {
+        virtual void on_creation(GridPos p) {
             init_model();
         }
 
-        virtual void on_removal (GridPos p) {
+        virtual void on_removal(GridPos p) {
             kill_model (p);
         }
+        
+        
 
-        // StateObject interface
-        virtual void setState(int extState);
-
     private:
         // ModelCallback interface.
         void animcb() {}

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-01-23 21:43:14 UTC (rev 1001)
+++ trunk/src/Makefile.am	2008-01-24 23:21:44 UTC (rev 1002)
@@ -191,6 +191,8 @@
 	stones/BlockerStone.hh	\
 	stones/BoulderStone.cc	\
 	stones/BoulderStone.hh	\
+	stones/ClusterStone.cc	\
+	sotnes/ClusterStone.hh	\
 	stones/ConnectiveStone.cc	\
 	stones/ConnectiveStone.hh	\
 	stones/FloppySwitch.hh   \

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-01-23 21:43:14 UTC (rev 1001)
+++ trunk/src/items.cc	2008-01-24 23:21:44 UTC (rev 1002)
@@ -991,7 +991,7 @@
         {}
 
     private:
-        void init_model() {set_anim("_explosion");}
+        void init_model() {set_anim("expl");}
         bool actor_hit(Actor *actor) {
             SendMessage(actor, "shatter");
             return false;

Added: trunk/src/stones/ClusterStone.cc
===================================================================
--- trunk/src/stones/ClusterStone.cc	2008-01-23 21:43:14 UTC (rev 1001)
+++ trunk/src/stones/ClusterStone.cc	2008-01-24 23:21:44 UTC (rev 1002)
@@ -0,0 +1,149 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/ClusterStone.hh"
+//#include "main.hh"
+
+namespace enigma {
+    ClusterStone::ClusterStone(std::string classname, std::string connections) : Stone(classname.c_str()) {
+        set_attrib("connections", connections);
+    }
+    
+    void ClusterStone::set_attrib(const string& key, const Value &val) {
+        if (key == "connections") {
+            Stone::set_attrib(key, val);
+            if (isDisplayable()) {
+                autoLeaveCluster();
+                autoJoinCluster();
+            }
+            return;
+        }
+        Stone::set_attrib(key, val);
+    }
+
+    void ClusterStone::on_creation(GridPos p) {
+        autoJoinCluster();
+        Stone::on_creation(p);
+    }
+    
+    void ClusterStone::on_removal(GridPos p) {
+        autoLeaveCluster();
+        Stone::on_removal(p);
+    }
+
+    bool ClusterStone::is_removable() const {
+        return getFaces() == ALL_DIRECTIONS;
+    }
+    
+    void ClusterStone::autoJoinCluster() {
+        GridPos p = get_pos();
+        Value myCluster = getAttr("cluster");
+        for (int i = WEST; i <= NORTH; i++) {
+            Direction d = (Direction) i;
+            Stone *neighbour = GetStone(move(p, d));
+            if (neighbour != NULL && std::string(neighbour->get_kind()) == get_kind()) {
+                Value neighbourCluster = neighbour->getAttr("cluster");
+                if (myCluster) {
+                    if (myCluster == neighbourCluster) {
+                        set_attrib("$connections", getConnections() | to_bits(d));
+                        neighbour->set_attrib("$connections", neighbour->getConnections() | to_bits(reverse(d)));
+                    } else if (!neighbourCluster && neighbour->getConnections() & to_bits(reverse(d))) {
+                        set_attrib("$connections", getConnections() | to_bits(d));
+                    } else {
+                        set_attrib("$connections", getConnections() & (ALL_DIRECTIONS ^ to_bits(d))); // clear connection
+                    }
+                } else if (neighbourCluster)  {// I have fixed connections -> adapt neighbour
+                    if (getConnections() & to_bits(d))
+                        neighbour->set_attrib("$connections", neighbour->getConnections() | to_bits(reverse(d)));
+                    else
+                        neighbour->set_attrib("$connections", neighbour->getConnections() & (ALL_DIRECTIONS ^ to_bits(reverse(d))));
+                }
+            } else if (myCluster) { // no neighbour -> no connection
+                set_attrib("$connections", getConnections() & (ALL_DIRECTIONS ^ to_bits(d))); // clear connection                
+            }
+        }
+    }
+    
+    void ClusterStone::autoLeaveCluster() {
+        GridPos p = get_pos();
+        for (int i = WEST; i <= NORTH; i++) {
+            Direction d = (Direction) i;
+            Stone *neighbour = GetStone(move(p, d));
+            if (neighbour != NULL && std::string(neighbour->get_kind()) == get_kind() 
+                    && neighbour->getAttr("cluster")) {
+                neighbour->set_attrib("$connections", neighbour->getConnections() & (ALL_DIRECTIONS ^ to_bits(reverse(d))));
+            }
+        }
+    }
+    
+    BOOT_REGISTER_START
+        BootRegister(new ClusterStone("st_panel", ""), "st_panel");
+        BootRegister(new ClusterStone("st_panel", "w"), "st_panel_w");
+        BootRegister(new ClusterStone("st_panel", "s"), "st_panel_s");
+        BootRegister(new ClusterStone("st_panel", "sw"), "st_panel_sw");
+        BootRegister(new ClusterStone("st_panel", "e"), "st_panel_e");
+        BootRegister(new ClusterStone("st_panel", "ew"), "st_panel_ew");
+        BootRegister(new ClusterStone("st_panel", "es"), "st_panel_es");
+        BootRegister(new ClusterStone("st_panel", "esw"), "st_panel_esw");
+        BootRegister(new ClusterStone("st_panel", "n"), "st_panel_n");
+        BootRegister(new ClusterStone("st_panel", "nw"), "st_panel_nw");
+        BootRegister(new ClusterStone("st_panel", "ns"), "st_panel_ns");
+        BootRegister(new ClusterStone("st_panel", "nsw"), "st_panel_nsw");
+        BootRegister(new ClusterStone("st_panel", "ne"), "st_panel_ne");
+        BootRegister(new ClusterStone("st_panel", "new"), "st_panel_new");
+        BootRegister(new ClusterStone("st_panel", "nes"), "st_panel_nes");
+        BootRegister(new ClusterStone("st_panel", "nesw"), "st_panel_nesw");
+
+        BootRegister(new ClusterStone("st_brick", ""), "st_brick");
+        BootRegister(new ClusterStone("st_brick", "w"), "st_brick_w");
+        BootRegister(new ClusterStone("st_brick", "s"), "st_brick_s");
+        BootRegister(new ClusterStone("st_brick", "sw"), "st_brick_sw");
+        BootRegister(new ClusterStone("st_brick", "e"), "st_brick_e");
+        BootRegister(new ClusterStone("st_brick", "ew"), "st_brick_ew");
+        BootRegister(new ClusterStone("st_brick", "es"), "st_brick_es");
+        BootRegister(new ClusterStone("st_brick", "esw"), "st_brick_esw");
+        BootRegister(new ClusterStone("st_brick", "n"), "st_brick_n");
+        BootRegister(new ClusterStone("st_brick", "nw"), "st_brick_nw");
+        BootRegister(new ClusterStone("st_brick", "ns"), "st_brick_ns");
+        BootRegister(new ClusterStone("st_brick", "nsw"), "st_brick_nsw");
+        BootRegister(new ClusterStone("st_brick", "ne"), "st_brick_ne");
+        BootRegister(new ClusterStone("st_brick", "new"), "st_brick_new");
+        BootRegister(new ClusterStone("st_brick", "nes"), "st_brick_nes");
+        BootRegister(new ClusterStone("st_brick", "nesw"), "st_brick_nesw");
+        
+        BootRegister(new ClusterStone("st_bluesand", ""), "st_bluesand");
+        BootRegister(new ClusterStone("st_bluesand", "w"), "st_bluesand_w");
+        BootRegister(new ClusterStone("st_bluesand", "s"), "st_bluesand_s");
+        BootRegister(new ClusterStone("st_bluesand", "sw"), "st_bluesand_sw");
+        BootRegister(new ClusterStone("st_bluesand", "e"), "st_bluesand_e");
+        BootRegister(new ClusterStone("st_bluesand", "ew"), "st_bluesand_ew");
+        BootRegister(new ClusterStone("st_bluesand", "es"), "st_bluesand_es");
+        BootRegister(new ClusterStone("st_bluesand", "esw"), "st_bluesand_esw");
+        BootRegister(new ClusterStone("st_bluesand", "n"), "st_bluesand_n");
+        BootRegister(new ClusterStone("st_bluesand", "nw"), "st_bluesand_nw");
+        BootRegister(new ClusterStone("st_bluesand", "ns"), "st_bluesand_ns");
+        BootRegister(new ClusterStone("st_bluesand", "nsw"), "st_bluesand_nsw");
+        BootRegister(new ClusterStone("st_bluesand", "ne"), "st_bluesand_ne");
+        BootRegister(new ClusterStone("st_bluesand", "new"), "st_bluesand_new");
+        BootRegister(new ClusterStone("st_bluesand", "nes"), "st_bluesand_nes");
+        BootRegister(new ClusterStone("st_bluesand", "nesw"), "st_bluesand_nesw");
+
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/ClusterStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/ClusterStone.hh
===================================================================
--- trunk/src/stones/ClusterStone.hh	2008-01-23 21:43:14 UTC (rev 1001)
+++ trunk/src/stones/ClusterStone.hh	2008-01-24 23:21:44 UTC (rev 1002)
@@ -0,0 +1,53 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef CLUSTERSTONE_HH
+#define CLUSTERSTONE_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class ClusterStone : public Stone {
+        CLONEOBJ(ClusterStone);
+    public:
+        ClusterStone(std::string classname, std::string connections);
+        
+        // Object interface
+        virtual void set_attrib(const string& key, const Value &val);
+
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+        virtual void on_removal(GridPos p);
+                
+        // Stone interface
+        virtual bool is_removable() const;
+        
+    private:
+        void autoJoinCluster();
+        void autoLeaveCluster();
+    };
+
+} // namespace enigma
+
+#endif /*CLUSTERSTONE_HH_*/


Property changes on: trunk/src/stones/ClusterStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones/ConnectiveStone.hh
===================================================================
--- trunk/src/stones/ConnectiveStone.hh	2008-01-23 21:43:14 UTC (rev 1001)
+++ trunk/src/stones/ConnectiveStone.hh	2008-01-24 23:21:44 UTC (rev 1002)
@@ -45,6 +45,22 @@
                 return NODIRBIT;
         }
 
+        // temp. workarounds until this class gets eliminated
+        virtual void set_attrib(const string& key, const Value &val) {
+            if (key == "connections")
+                Object::set_attrib(key, val);  // bypass GridObject
+            else
+                Stone::set_attrib(key, val);
+        }
+        
+        virtual Value getAttr(const string &key) const {
+            if (key == "connections")
+                return Object::getAttr(key);
+            else
+                return Stone::getAttr(key);
+        }
+
+
     protected:
         virtual void init_model() {
             set_model(get_kind()+ecl::strf("%d", get_modelno()));

Modified: trunk/src/stones/Switch.cc
===================================================================
--- trunk/src/stones/Switch.cc	2008-01-23 21:43:14 UTC (rev 1001)
+++ trunk/src/stones/Switch.cc	2008-01-24 23:21:44 UTC (rev 1002)
@@ -55,7 +55,7 @@
     
     int Switch::externalState() const {
         if (isInstant())
-            return state == ON || state == TURNON;
+            return (state == ON || state == TURNON) ? 1 : 0;
         else
             return state % 2;   // 0 for OFF, TURNON, 1 for ON, TURNOFF
     }

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-01-23 21:43:14 UTC (rev 1001)
+++ trunk/src/world.cc	2008-01-24 23:21:44 UTC (rev 1002)
@@ -348,6 +348,10 @@
 
 void World::name_object(Object *obj, const std::string &name)
 {
+    Object *old = get_named(name);
+    if (old != NULL)
+        unname(old);
+    
     std::string unique_name = name;
     if (server::EnigmaCompatibility >= 1.10 && name.size() > 0 && name[name.size() - 1] == '#') {
         // auto name object with a unique name



From ral at mail.berlios.de  Fri Jan 25 00:27:08 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 25 Jan 2008 00:27:08 +0100
Subject: [Enigma-game-svn] r1003 - team_levelpacks/team_test_new_api
Message-ID: <200801242327.m0ONR8SO003400@sheep.berlios.de>

Author: ral
Date: 2008-01-25 00:27:08 +0100 (Fri, 25 Jan 2008)
New Revision: 1003

Added:
   team_levelpacks/team_test_new_api/ralT029_1.xml
Log:
Testlevel new API:
- ClusterStone

Added: team_levelpacks/team_test_new_api/ralT029_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT029_1.xml	2008-01-24 23:21:44 UTC (rev 1002)
+++ team_levelpacks/team_test_new_api/ralT029_1.xml	2008-01-24 23:27:08 UTC (rev 1003)
@@ -0,0 +1,86 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Cluster new API" el:subtitle="" el:id="20080124ral491"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2007 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["#"] = ti[" "] .. {"st-rock1"}
+
+ti["1"] = ti[" "] .. {"st_panel", cluster=1}
+ti["2"] = ti[" "] .. {"st_panel", cluster=2}
+ti["3"] = ti[" "] .. {"st_panel", cluster=3}
+
+ti["5"] = ti[" "] .. {"st_bluesand", cluster=5}
+ti["6"] = ti[" "] .. {"st_bluesand", cluster=6}
+
+ti["8"] = ti[" "] .. {"st_brick", cluster=8}
+ti["9"] = ti[" "] .. {"st_brick", cluster=9}
+
+ti["P"] = ti[" "] .. {"st_panel"}
+ti["Q"] = ti[" "] .. {"st_panel_n"}
+ti["R"] = ti[" "] .. {"st_panel", faces="ne"}
+ti["S"] = ti[" "] .. {"st_panel", faces=""}
+ti["|"] = ti[" "] .. {"st_panel", connections="sn"}
+ti["s"] = ti[" "] .. {"st-swap"}
+
+ti["x"] = ti[" "] .. {"st_panel", "dynamic", connections=""}
+ti["a"] = ti[" "] .. {"st_switch", "north", target="change"}
+ti["b"] = ti[" "] .. {"st_switch", "east", target="change"}
+ti["c"] = ti[" "] .. {"st_switch", "south", target="change"}
+ti["d"] = ti[" "] .. {"st_switch", "west", target="change"}
+
+ti["A"] = (ti[" "] .. {"it-brake"}) .. {"#ac-blackball"}
+
+w, h = wo(ti, " ", {
+"1111233         5555",
+"11 22            566",
+"1                 66",
+"                    ",
+"    P Q R S         ",
+"    s               ",
+"       A       a    ",
+"              d b   ",
+" 8             c    ",
+"889          11111  ",
+"8999  222    11x21  ",
+"889   1|1     1221  ",
+"999   111     1111  "
+})
+
+
+function change(value, sender)
+    local newcon = ""
+    if no["north"].state == 1 then newcon = newcon .."n" end
+    if no["east"]["state"] == 1 then newcon = newcon .."e" end
+    if no["south"].state == 1 then newcon = newcon .."s" end
+    if no["west"].state  == 1 then newcon = newcon .."w" end
+    no["dynamic"]["connections"] = newcon
+    
+    -- another variation by replacing - a brutal engine test
+--    wo[no["dynamic"]] = {"st_panel", connections = newcon, "dynamic"}
+end
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT029_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From andreasl at mail.berlios.de  Fri Jan 25 01:34:56 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Fri, 25 Jan 2008 01:34:56 +0100
Subject: [Enigma-game-svn] r1004 - team_levelpacks/team_test_new_api
Message-ID: <200801250034.m0P0Yumx013141@sheep.berlios.de>

Author: andreasl
Date: 2008-01-25 01:34:55 +0100 (Fri, 25 Jan 2008)
New Revision: 1004

Modified:
   team_levelpacks/team_test_new_api/ralT029_1.xml
Log:
Demonstrating swap-bug on cluster stones.

Modified: team_levelpacks/team_test_new_api/ralT029_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT029_1.xml	2008-01-24 23:27:08 UTC (rev 1003)
+++ team_levelpacks/team_test_new_api/ralT029_1.xml	2008-01-25 00:34:55 UTC (rev 1004)
@@ -36,6 +36,7 @@
 ti["Q"] = ti[" "] .. {"st_panel_n"}
 ti["R"] = ti[" "] .. {"st_panel", faces="ne"}
 ti["S"] = ti[" "] .. {"st_panel", faces=""}
+ti["T"] = ti[" "] .. {"st_panel", cluster=2}
 ti["|"] = ti[" "] .. {"st_panel", connections="sn"}
 ti["s"] = ti[" "] .. {"st-swap"}
 
@@ -47,13 +48,15 @@
 
 ti["A"] = (ti[" "] .. {"it-brake"}) .. {"#ac-blackball"}
 
+ti["D"] = ti[" "] .. {"st_switch", target="deletion"}
+
 w, h = wo(ti, " ", {
 "1111233         5555",
 "11 22            566",
-"1                 66",
+"1   sT            66",
 "                    ",
 "    P Q R S         ",
-"    s               ",
+"D   s               ",
 "       A       a    ",
 "              d b   ",
 " 8             c    ",
@@ -75,6 +78,12 @@
     -- another variation by replacing - a brutal engine test
 --    wo[no["dynamic"]] = {"st_panel", connections = newcon, "dynamic"}
 end
+
+function deletion(value, sender)
+    wo[{1,1}] = {"st_nil"}
+    wo[{0,3}] = {"st_panel", cluster=1}
+end
+  
   ]]></el:luamain>
     <el:i18n>
 	 <el:string el:key="title">



From andreasl at mail.berlios.de  Sat Jan 26 00:13:14 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Sat, 26 Jan 2008 00:13:14 +0100
Subject: [Enigma-game-svn] r1005 - feature_branches/hp_lotm/input/lotm
Message-ID: <200801252313.m0PNDEnt011987@sheep.berlios.de>

Author: andreasl
Date: 2008-01-26 00:13:13 +0100 (Sat, 26 Jan 2008)
New Revision: 1005

Added:
   feature_branches/hp_lotm/input/lotm/lotm_200802_de.html
Modified:
   feature_branches/hp_lotm/input/lotm/lotm_200711.html
   feature_branches/hp_lotm/input/lotm/lotm_200711_de.html
   feature_branches/hp_lotm/input/lotm/lotm_200712.html
   feature_branches/hp_lotm/input/lotm/lotm_200712_de.html
   feature_branches/hp_lotm/input/lotm/lotm_200802.html
Log:
LotM:
 - Additions, German stub for LotM 02/2008.
 - Some typos in other LotM.
Note:
 - Umlauts in German stub are broken.


Modified: feature_branches/hp_lotm/input/lotm/lotm_200711.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200711.html	2008-01-25 00:34:55 UTC (rev 1004)
+++ feature_branches/hp_lotm/input/lotm/lotm_200711.html	2008-01-25 23:13:13 UTC (rev 1005)
@@ -3,7 +3,7 @@
 
 <h3 class="lotm">
 <span class="date">November 2007: </span>
-&quot;Big Adventures&quot;, by Jon 'WB' Sneyers
+&quot;Big Adventures&quot; by Jon 'WB' Sneyers
 </h3>
 
 <p>&quot;Greetings, adventurer! The road ahead is long and dangerous, so be

Modified: feature_branches/hp_lotm/input/lotm/lotm_200711_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200711_de.html	2008-01-25 00:34:55 UTC (rev 1004)
+++ feature_branches/hp_lotm/input/lotm/lotm_200711_de.html	2008-01-25 23:13:13 UTC (rev 1005)
@@ -3,7 +3,7 @@
 
 <h3 class="lotm">
 <span class="date">November 2007: </span>
-&quot;Big Adventures&quot;, von Jon 'WB' Sneyers
+&quot;Big Adventures&quot; von Jon 'WB' Sneyers
 </h3>
 
 <p>&quot;Willkommen, Abenteurer! Der Weg ist lang und gef&auml;hrlich, sei

Modified: feature_branches/hp_lotm/input/lotm/lotm_200712.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200712.html	2008-01-25 00:34:55 UTC (rev 1004)
+++ feature_branches/hp_lotm/input/lotm/lotm_200712.html	2008-01-25 23:13:13 UTC (rev 1005)
@@ -2,7 +2,7 @@
 $$lotm_header$$
 <h3 class="lotm">
 <span class="date">December 2007: </span>
-&quot;Temple of Gold&quot;, by Jacob Scott &amp; Ronald Lamprecht
+&quot;Temple of Gold&quot; by Jacob Scott &amp; Ronald Lamprecht
 </h3>
 
 <div class="lotmpic">

Modified: feature_branches/hp_lotm/input/lotm/lotm_200712_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200712_de.html	2008-01-25 00:34:55 UTC (rev 1004)
+++ feature_branches/hp_lotm/input/lotm/lotm_200712_de.html	2008-01-25 23:13:13 UTC (rev 1005)
@@ -3,7 +3,7 @@
 
 <h3 class="lotm">
 <span class="date">Dezember 2007: </span>
-&quot;Temple of Gold&quot;, von Jacob Scott und Ronald Lamprecht
+&quot;Temple of Gold&quot; von Jacob Scott und Ronald Lamprecht
 </h3>
 
 <div class="lotmpic">

Modified: feature_branches/hp_lotm/input/lotm/lotm_200802.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200802.html	2008-01-25 00:34:55 UTC (rev 1004)
+++ feature_branches/hp_lotm/input/lotm/lotm_200802.html	2008-01-25 23:13:13 UTC (rev 1005)
@@ -2,7 +2,7 @@
 $$lotm_header$$
 <h3 class="lotm">
 <span class="date">February 2008: </span>
-&quot;Puzzle Puzzles&quot;, by Raoul Bourquin
+&quot;Puzzle Puzzles&quot; by Raoul Bourquin
 </h3>
 
 <p>It starts a little bit like &quot;Sierpinsky&quot;, our Level of the Month
@@ -60,7 +60,56 @@
 
 <h4>Headline</h4>
 
+<p>
+You can see much about Raoul developing his mastery of level design: Starting
+with the relatively uninteresting &quot;Life's Cross&quot; as first released
+level, working through various meditations and &quot;Eternal circulation&quot;,
+his levels became more and more complex and subtle. His early creations were
+onescreeners or near-to onescreeners, and this tradition (until now) culminates
+in the incredible &quot;Industrial Puzzles&quot;. I think &quot;Space
+Station&quot; was his first larger level, and with &quot;Puzzle Puzzles&quot; he
+now reached his first Level of the Month.
+</p>
+
+<h4>&quot;'Puzzle Puzzles' still fascinates me&quot;</h4>
+
+<div class="quote">
+Indeed, &quot;Puzzle Puzzles&quot; is such a strange mix of difficult and
+easy, that I just sit there, astonished, and ask myself, why I have
+difficulties with such a simple and easy to see through level. Then, there are
+days, when I don't understand anything at all, and ask myself, how this level
+achieved &quot;only&quot; 84 points in the total difficulty rating.
+</div>
+
+<div class="quote">
+However, &quot;Puzzle Puzzles&quot; still fascinates me, not that much as
+&quot;Houdini&quot; does, but yet I tried more than a dozen times, to get
+wise on those puzzles of Raoul's &quot;Puzzle Puzzles&quot;.
+</div>
+
+<div class="quote">
+I think, it's caused by the design. This mixture of fl-water and the bright
+sand-like floor has something charismatic, and can definitely keep up with the
+designs of &quot;Island Labyrinth&quot; and &quot;Temple of Gold&quot;. The
+level starts promising. This passage, as it winds through the ocean in
+serpentines, reminds me of the beginning of some fantasy-adventure-movie.
+Whether &quot;Puzzle Puzzles&quot; will fulfill its promises? - I don't know.
+But thousands of Enigma fans can't err: Welcome LotM 2/2008. ;-)
+</div>
+
+<div class="author">Daydreamer</div>
+
+<p>
+Yes, the design of &quot;Puzzle Puzzles&quot; is as Raoul as possible: Most of
+his levels are in some way connected to water, but this time he combined it with
+bright white floors, with glass and light blue stones. Open, and flooded by
+light, only broken by two darkish platforms, reminding us of his other prefered
+combination of dark materials and abyss.
+</p>
+
+
 <p>Best greets,<br>
 <i>Andreas &amp; Harry</i></p>
 
 </div>
+

Added: feature_branches/hp_lotm/input/lotm/lotm_200802_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200802_de.html	2008-01-25 00:34:55 UTC (rev 1004)
+++ feature_branches/hp_lotm/input/lotm/lotm_200802_de.html	2008-01-25 23:13:13 UTC (rev 1005)
@@ -0,0 +1,120 @@
+<div class="lotm">
+$$lotm_header$$
+<h3 class="lotm">
+<span class="date">Februar 2008: </span>
+&quot;Puzzle Puzzles&quot; von Raoul Bourquin
+</h3>
+
+<p>It starts a little bit like &quot;Sierpinsky&quot;, our Level of the Month
+February 2008&mdash;curling its way through the first two screens, our dear
+black marble might think of yet another dexterity challenge. But as it
+approaches the third, and then the fourth screen, the level unfolds like a
+Julia set we were pilgrimaging, and ahead of us lies a landscape filled with
+puzzles, convoluted more than any fractal could be. Welcome to &quot;Puzzle
+Puzzles&quot;!</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200802_a.png" alt="Level des Monats" border="0">
+<div class="imagetitle">Enigma VI # 55 - Puzzle Puzzles</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Einige Rekorde vom Dezember 2007</caption>
+<colgroup>
+   <col width="80">
+   <col width="160">
+</colgroup>
+    <tr><td class="num">6:11</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">8:21</td>
+        <td class="left">Raoul</td></tr>
+    <tr><td class="num">12:17</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">16:16</td>
+        <td class="left">Tarim</td></tr>
+    <tr><td class="num">16:26</td>
+        <td class="left">ryujun</td></tr>
+</table>
+
+<p></p>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Einfacher Modus</caption>
+<colgroup>
+   <col width="80">
+   <col width="160">
+</colgroup>
+    <tr><td class="num">6:53</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">10:16</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">10:21</td>
+        <td class="left">Raoul</td></tr>
+    <tr><td class="num">13:02</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">13:58</td>
+        <td class="left">Taztunes</td></tr>
+</table>
+
+<p>libpuzzle</p>
+
+<h4>Headline</h4>
+
+<p>
+You can see much about Raoul developing his mastery of level design: Starting
+with the relatively uninteresting &quot;Life's Cross&quot; as first released
+level, working through various meditations and &quot;Eternal circulation&quot;,
+his levels became more and more complex and subtle. His early creations were
+onescreeners or near-to onescreeners, and this tradition (until now) culminates
+in the incredible &quot;Industrial Puzzles&quot;. I think &quot;Space
+Station&quot; was his first larger level, and with &quot;Puzzle Puzzles&quot; he
+now reached his first Level of the Month.
+</p>
+
+
+<h4>&quot;'Puzzle Puzzles' ?bt schon eine gewisse Faszination auf mich
+aus&quot;</h4>
+
+<div class="quote">
+Doch, &quot;Puzzle Puzzles&quot; ist wirklich eine so seltsame Mischung aus
+schwierig und leicht, dass ich oft verwundert dasitze und mich frage, warum ich
+mich denn mit einem so einfachen und leicht zu durchschauenden Level so schwer
+tue, dann wieder gibt es die Tage, wo ich ?berhaupt nichts mehr kapiere, und ich
+mich frage, warum der Level &quot;nur&quot; mit 84 Punkten in der
+Gesamtschwierigkeitsskala eingestuft wird.
+</div>
+
+<div class="quote">
+Trotzdem, &quot;Puzzle Puzzles&quot; ?bt schon eine gewisse Faszination auf mich
+aus, zwar nicht so stark wie beispielsweise &quot;Houdini&quot;, aber dennoch
+hab' ich mehr als ein Dutzend mal versucht, den R?tseln von Raouls &quot;Puzzle
+Puzzles&quot; auf die Schliche zu kommen.
+</div>
+
+<div class="quote">
+Ich glaube es liegt am Design. Diese Mischung aus fl-water und diesem
+hellen Sand-Boden hat etwas Charismatisches, das durchaus mit dem Design
+von &quot;Island Labyrinth&quot; und &quot;Temple of Gold&quot; mithalten kann.
+Der Level beginnt vielversprechend. Dieser sich in Serpentinen durch das Meer
+windende Weg erinnert an den Beginn eines Fantasy-Adventure-Movies. Ob
+&quot;Puzzle Puzzles&quot; h?lt, was es verspricht? - Ich wei? es nicht. Aber
+Tausende von Enigma-Fans k?nnen nicht irren: Willkommen LotM 2/2008. ;-) </p>
+</div>
+
+<div class="author">Daydreamer</div>
+
+<p>
+Ja, das Design von &quot;Puzzle Puzzles&quot; ist so Raoul wie nur denkbar: Die
+meisten seiner Level haben in irgendeiner Weise etwas mit Wasser zu tun, aber
+dieses Mal hat er es mit hellem wei?en Boden kombiniert, mit Glas und
+hellblauen Steinen. Offen, und von Licht durchflutet, nur gebrochen durch zwei
+dunkle Plattformen, die uns an seine andere bevorzugte Kombination von dunklen
+Materialien und Abyss erinnern.
+</p>
+
+
+<p>Best greets,<br>
+<i>Andreas &amp; Harry</i></p>
+
+</div>
+



From ral at mail.berlios.de  Sat Jan 26 00:30:54 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 26 Jan 2008 00:30:54 +0100
Subject: [Enigma-game-svn] r1006 - in trunk: data src src/stones
Message-ID: <200801252330.m0PNUsch015743@sheep.berlios.de>

Author: ral
Date: 2008-01-26 00:30:53 +0100 (Sat, 26 Jan 2008)
New Revision: 1006

Modified:
   trunk/data/init.lua
   trunk/data/models-2d.lua
   trunk/src/GridObject.cc
   trunk/src/GridObject.hh
   trunk/src/lua.cc
   trunk/src/stones.cc
   trunk/src/stones/ClusterStone.cc
   trunk/src/stones/OxydStone.cc
   trunk/src/stones/OxydStone.hh
   trunk/src/stones/WindowStone.cc
   trunk/src/stones/WindowStone.hh
   trunk/src/world.cc
Log:
Trunk 1.1: Reengineering Connective Stones
- fix r1002 attribute state set problems due to GridObject 
- ClusterStone add autoclustering for changes on cluster, faces attributes
- OxydStone add kinds "st_oxyd_a"..."st_oxyd_d" for flavored types
- WindowStone reengineering:
  - GridObject connection support instead of ConnectiveStone
  - renaming to "st_window_[nesw]" with faces as dirs
  - slightly lowered impuls that is necessary to break a window
Note:
- WindowStone features are not yet fixed


Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-25 23:13:13 UTC (rev 1005)
+++ trunk/data/init.lua	2008-01-25 23:30:53 UTC (rev 1006)
@@ -59,7 +59,8 @@
     st_oxyd = "st-oxyd",
     st_switch_instant = "st-switch",
     st_switch_black_instant = "st-switch_black",
-    st_switch_white_instant = "st-switch_white"
+    st_switch_white_instant = "st-switch_white",
+    st_window = "st-window"
 }
 
 for k,v in pairs(RenamingObjectsNew2Old) do

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-01-25 23:13:13 UTC (rev 1005)
+++ trunk/data/models-2d.lua	2008-01-25 23:30:53 UTC (rev 1006)
@@ -1200,11 +1200,11 @@
 
     for i = 2, 16 do
         DefMultipleComposite("sh-window"..i, shadowlist[i])
-        DefShModel("st-window"..i, "fg-window"..i, "sh-window"..i)
+        DefShModel("st_window"..(16-i), "fg-window"..i, "sh-window"..i)
     end
 
     -- 4 sided window stone:
-    DefAlias("st-window","st-window16")
+    DefAlias("st_window","st_window0")
 
     -- Breaking animimation:
     local breaking_window_names = {}
@@ -1218,8 +1218,8 @@
         end
         local frames = BuildFrames(breaking_window_names[i], 130)
         -- TODO: finish anim names used:
-        DefAnim("st-window"..i.."-anim", frames)
-        DefAnim("st-window-anim", frames)
+        DefAnim("st_window"..i.."_anim", frames)
+        DefAnim("st_window_anim", frames)
     end
 end
 

Modified: trunk/src/GridObject.cc
===================================================================
--- trunk/src/GridObject.cc	2008-01-25 23:13:13 UTC (rev 1005)
+++ trunk/src/GridObject.cc	2008-01-25 23:30:53 UTC (rev 1006)
@@ -81,6 +81,10 @@
             return pos;
     }
     
+    bool GridObject::isDisplayable() {
+        return pos.x >= 0;
+    }
+    
     display::Model *GridObject::set_anim (const std::string &mname) 
     {
         set_model (mname);
@@ -125,7 +129,7 @@
             if (isDisplayable())
                 init_model();
         } else
-            Object::set_attrib(key, val);
+            StateObject::set_attrib(key, val);
     }
     
     Value GridObject::getAttr(const string &key) const {

Modified: trunk/src/GridObject.hh
===================================================================
--- trunk/src/GridObject.hh	2008-01-25 23:13:13 UTC (rev 1005)
+++ trunk/src/GridObject.hh	2008-01-25 23:30:53 UTC (rev 1006)
@@ -83,7 +83,15 @@
          */
         GridPos getOwnerPos();
         
-        virtual bool isDisplayable() {return pos.x >= 0;}
+        /**
+         * Verify that the GridObject is part of the world's grid and display 
+         * models can be set and killed without restriction. Especially attribute
+         * changes and messages need to check carefully if just the objects ivars
+         * and attributes may be changed or if the display can and has to be 
+         * updated, too.
+         * @return   true if display access is possible, false otherwise
+         */
+        bool isDisplayable();
 
         // GridObject interface
         virtual void on_laserhit (Direction) {}
@@ -115,9 +123,7 @@
 
         virtual void on_removal(GridPos p) {
             kill_model (p);
-        }
-        
-        
+        }     
 
     private:
         // ModelCallback interface.

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-01-25 23:13:13 UTC (rev 1005)
+++ trunk/src/lua.cc	2008-01-25 23:30:53 UTC (rev 1006)
@@ -1669,7 +1669,7 @@
         }
         return 1;
     } else {
-        throwLuaError(L, "Named object access without giving a name");
+        throwLuaError(L, "World read access without giving an attribute name");
         return 0;
     }
 }

Modified: trunk/src/stones/ClusterStone.cc
===================================================================
--- trunk/src/stones/ClusterStone.cc	2008-01-25 23:13:13 UTC (rev 1005)
+++ trunk/src/stones/ClusterStone.cc	2008-01-25 23:30:53 UTC (rev 1006)
@@ -26,7 +26,7 @@
     }
     
     void ClusterStone::set_attrib(const string& key, const Value &val) {
-        if (key == "connections") {
+        if (key == "connections" || key == "faces" || key == "cluster") {
             Stone::set_attrib(key, val);
             if (isDisplayable()) {
                 autoLeaveCluster();

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-01-25 23:13:13 UTC (rev 1005)
+++ trunk/src/stones/OxydStone.cc	2008-01-25 23:30:53 UTC (rev 1006)
@@ -836,8 +836,8 @@
     
     // Instance Methods
     
-    OxydStone::OxydStone() : PhotoStone("st_oxyd") {
-        set_attrib("flavor", "b");
+    OxydStone::OxydStone(std::string flavor) : PhotoStone("st_oxyd") {
+        set_attrib("flavor", flavor);
         set_attrib("oxydcolor", AUTO);
     }
     
@@ -1106,7 +1106,11 @@
     
 
     BOOT_REGISTER_START
-        BootRegister(new OxydStone);
+        BootRegister(new OxydStone(), "st_oxyd");
+        BootRegister(new OxydStone("a"), "st_oxyd_a");
+        BootRegister(new OxydStone("b"), "st_oxyd_b");
+        BootRegister(new OxydStone("c"), "st_oxyd_c");
+        BootRegister(new OxydStone("d"), "st_oxyd_d");
     BOOT_REGISTER_END
 
 } // namespace enigma

Modified: trunk/src/stones/OxydStone.hh
===================================================================
--- trunk/src/stones/OxydStone.hh	2008-01-25 23:13:13 UTC (rev 1005)
+++ trunk/src/stones/OxydStone.hh	2008-01-25 23:30:53 UTC (rev 1006)
@@ -78,7 +78,7 @@
         static void addShuffleRule(RuleType type, unsigned short limit, Value group1, Value group2 = Value());
         static void shuffleColors(LogType logFlag = NOTHING);
         
-        OxydStone();
+        OxydStone(std::string flavor = "b");
         
         // Object interface
         virtual OxydStone * clone();

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-01-25 23:13:13 UTC (rev 1005)
+++ trunk/src/stones/WindowStone.cc	2008-01-25 23:30:53 UTC (rev 1006)
@@ -1,6 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2007 Ronald Lamprecht
+ * Copyright (C) 2007, 2008 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -19,12 +19,31 @@
  */
 
 #include "stones/WindowStone.hh"
+//#include "main.hh"
 #include "server.hh"
 #include "world.hh"
 
 namespace enigma {
-    DEF_TRAITSM(WindowStone, "st-window", st_window, MOVABLE_BREAKABLE);
-
+    WindowStone::WindowStone(std::string faces) : Stone(), breakingFaces(NODIRBIT) {
+        set_attrib("faces", faces);
+    }
+    
+    Value WindowStone::message(const Message &m) {
+        if (m.message == "inner_pull" ) {
+            return Value(tryInnerPull(to_direction(m.value)));
+        }
+        return Stone::message(m);
+    }
+    
+    void WindowStone::animcb() {
+        if (state == FINALBREAK)
+            KillStone(get_pos());
+        else {
+            state = IDLE;
+            init_model();
+        }
+    }
+    
     void WindowStone::actor_hit(const StoneContact &sc) {
         Actor *a = sc.actor;
         // TODO do we want to allow breaks while breaking?
@@ -34,16 +53,15 @@
                 SendMessage(a, "shatter");
             }
 
-            else if (impulse > 25) {
-                breakingFaces = sc.faces;
-                set_attrib("connections", (get_connections() & ~breakingFaces) +1);
+            else if (impulse > 20) {
+                DirectionBits remainigFaces = (DirectionBits)(getFaces() & ~sc.faces);  // remove breaking face
+                Object::set_attrib("$connections", ALL_DIRECTIONS ^ remainigFaces);     // avoid init of model
                 sound_event ("shatter");
-                state = BREAK;
-                set_anim("st-window-anim");  // TODO anim with remaining unbroken faces
+                state = (remainigFaces == NODIRBIT) ? FINALBREAK : BREAK;
+                set_anim("st_window_anim");  // TODO anim with remaining unbroken faces
             }
             
             else if (player::WieldedItemIs (sc.actor, "it-wrench")) {
-                DirectionBits faces = get_connections();
                 if (sc.faces == WESTBIT && sc.normal[0] < 0){
                     tryInnerPull(EAST);
                 } else if (sc.faces == EASTBIT && sc.normal[0] > 0) {
@@ -57,23 +75,13 @@
         }
     }
     
-    void WindowStone::animcb() {
-        DirectionBits faces = get_connections();
-        DirectionBits newFaces = DirectionBits(faces & ~breakingFaces);
-        if (newFaces == NODIRBIT)
-            KillStone(get_pos());
-        else {
-            ReplaceStone(get_pos(), new WindowStone(newFaces+1));
-        }
-    }
-    
     bool WindowStone::is_sticky(const Actor *a) const  {
         return false;
     }
     
     StoneResponse WindowStone::collision_response(const StoneContact &sc) {
         const double face_width = 3.0/32.0; 
-        DirectionBits faces = get_connections();
+        DirectionBits faces = getFaces();
 
         if (((sc.contact_point[0] <= get_pos().x + face_width) && faces&WESTBIT) ||
                 ((sc.contact_point[0] >= get_pos().x + 1 - face_width) && faces&EASTBIT) ||
@@ -85,43 +93,41 @@
         }
     }
     
-    Value WindowStone::message(const Message &m) {
-        if (m.message == "inner_pull" ) {
-            return Value(tryInnerPull(to_direction(m.value)));
-        }
-        return ConnectiveStone::message(m);
-    }
-    
     bool WindowStone::tryInnerPull(Direction dir) {
-        DirectionBits faces = get_connections();
+        DirectionBits faces = getFaces();
         if (!has_dir(faces, dir) && has_dir(faces, reverse(dir))){
             Stone *stone = GetStone(move(get_pos(), dir));
             if (!stone || ((stone->get_traits().id == st_window) &&  
-                    !has_dir(dynamic_cast<ConnectiveStone *>(stone)->get_connections(), reverse(dir)))) {
-                ReplaceStone(get_pos(), new WindowStone((faces&(~to_bits(reverse(dir)))|to_bits(dir))+1));
+                    !has_dir(stone->getFaces(), reverse(dir)))) {
+                DirectionBits remainigFaces = (DirectionBits)((faces & ~to_bits(reverse(dir)))
+                        |to_bits(dir));  // move face
+                Object::set_attrib("$connections", ALL_DIRECTIONS ^ remainigFaces);     // avoid init of model
+                init_model();
                 return true;
             }
         }
         return has_dir(faces, dir);
     }
+    
+    DEF_TRAITSM(WindowStone, "st_window", st_window, MOVABLE_BREAKABLE);
 
     BOOT_REGISTER_START
-        BootRegister(new WindowStone(3), "st-window");    // compatibility window with south face only
-        BootRegister(new WindowStone(2), "st-window-w");
-        BootRegister(new WindowStone(3), "st-window-s");
-        BootRegister(new WindowStone(4), "st-window-sw");
-        BootRegister(new WindowStone(5), "st-window-e");
-        BootRegister(new WindowStone(6), "st-window-ew");
-        BootRegister(new WindowStone(7), "st-window-es");
-        BootRegister(new WindowStone(8), "st-window-esw");
-        BootRegister(new WindowStone(9), "st-window-n");
-        BootRegister(new WindowStone(10), "st-window-nw");
-        BootRegister(new WindowStone(11), "st-window-ns");
-        BootRegister(new WindowStone(12), "st-window-nsw");
-        BootRegister(new WindowStone(13), "st-window-ne");
-        BootRegister(new WindowStone(14), "st-window-new");
-        BootRegister(new WindowStone(15), "st-window-nes");
-        BootRegister(new WindowStone(16), "st-window-nesw");
+        BootRegister(new WindowStone("s"), "st_window");    // compatibility window with south face only
+        BootRegister(new WindowStone("w"), "st_window_w");
+        BootRegister(new WindowStone("s"), "st_window_s");
+        BootRegister(new WindowStone("sw"), "st_window_sw");
+        BootRegister(new WindowStone("e"), "st_window_e");
+        BootRegister(new WindowStone("ew"), "st_window_ew");
+        BootRegister(new WindowStone("es"), "st_window_es");
+        BootRegister(new WindowStone("esw"), "st_window_esw");
+        BootRegister(new WindowStone("n"), "st_window_n");
+        BootRegister(new WindowStone("nw"), "st_window_nw");
+        BootRegister(new WindowStone("ns"), "st_window_ns");
+        BootRegister(new WindowStone("nsw"), "st_window_nsw");
+        BootRegister(new WindowStone("ne"), "st_window_ne");
+        BootRegister(new WindowStone("new"), "st_window_new");
+        BootRegister(new WindowStone("nes"), "st_window_nes");
+        BootRegister(new WindowStone("nesw"), "st_window_nesw");
     BOOT_REGISTER_END
 
 } // namespace enigma

Modified: trunk/src/stones/WindowStone.hh
===================================================================
--- trunk/src/stones/WindowStone.hh	2008-01-25 23:13:13 UTC (rev 1005)
+++ trunk/src/stones/WindowStone.hh	2008-01-25 23:30:53 UTC (rev 1006)
@@ -30,34 +30,39 @@
 
 /* -------------------- Window -------------------- */
 
-/** \page st-window Breakable Stone
+/** \page st_window Breakable Stone
 
 Hit this window heavily with your marble to blast it into smithereens.
 
-\image html st-window.png
+\image html st_window.png
 */
 
 namespace enigma {
     
-    class WindowStone : public ConnectiveStone {
+    class WindowStone : public Stone {
         CLONEOBJ(WindowStone);
         DECL_TRAITS;
+    private:
+        enum iState { IDLE, BREAK, FINALBREAK };
+        
+    public:
+        WindowStone(std::string faces);
+        
+        // Object interface
+        virtual Value message(const Message &m);
+
+        // ModelCallback interface
+        void animcb();
+
+        // Stone interface
+        void actor_hit(const StoneContact &sc);
+        StoneResponse collision_response(const StoneContact &sc);
         const char *collision_sound() {return "glass";}
-
         bool is_transparent (Direction) const { return true; }
         bool is_floating() const { return state != IDLE; }
-        enum State { IDLE, BREAK } state;
+        virtual bool is_sticky(const Actor *a) const;
 
-        void actor_hit(const StoneContact &sc);
-        void animcb();
 
-    public:
-        WindowStone(int connections) : ConnectiveStone(connections),
-                state(IDLE), breakingFaces(NODIRBIT) {
-        }
-        virtual bool is_sticky(const Actor *a) const;
-        StoneResponse collision_response(const StoneContact &sc);
-        virtual Value message(const Message &m);
     private:
         DirectionBits breakingFaces;
         bool tryInnerPull(Direction dir);

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-01-25 23:13:13 UTC (rev 1005)
+++ trunk/src/stones.cc	2008-01-25 23:30:53 UTC (rev 1006)
@@ -99,7 +99,7 @@
 - \ref st-bolder
 - \ref st-puzzle
 - \ref st-stone_break
-- \ref st-window
+- \ref st_window
 - \ref st-break_acwhite
 - \ref st-break_acblack
 - \ref st-oneway

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-01-25 23:13:13 UTC (rev 1005)
+++ trunk/src/world.cc	2008-01-25 23:30:53 UTC (rev 1006)
@@ -27,7 +27,6 @@
 #include "client.hh"
 #include "main.hh"
 #include "stones_internal.hh"
-#include "stones/ConnectiveStone.hh"
 #include "WorldProxy.hh"
 
 #include <iostream>
@@ -631,7 +630,7 @@
     bool isWindow = stone->get_traits().id == st_window;
     DirectionBits wsides;
     if (isWindow) {
-        wsides = dynamic_cast<ConnectiveStone *>(stone)->get_connections();
+        wsides = stone->getFaces();
     }
     
     const ActorInfo &ai = *a->get_actorinfo();
@@ -679,9 +678,9 @@
             else if ( ycorner && xoff_neighbour) face = SOUTHBIT;
             
             // the faces that the neighbour window owns
-            ConnectiveStone * neighbour = dynamic_cast<ConnectiveStone *>
-                    (GetStone(GridPos(x+xoff_neighbour, y+yoff_neighbour)));
-            DirectionBits face_neighbour = (neighbour) ? neighbour->get_connections() : NODIRBIT;
+            Stone * neighbour = GetStone(GridPos(x+xoff_neighbour, y+yoff_neighbour));
+            DirectionBits face_neighbour = (neighbour != NULL && neighbour->get_traits().id == st_window) 
+                    ? neighbour->getFaces() : NODIRBIT;
             
             
             if ((winFacesActorStone&face) && !(face_neighbour&face)) {
@@ -945,8 +944,9 @@
     
     // info about a Window stone on the Gridpos of the actor that may cause
     // contacts within the grid
-    ConnectiveStone * actorWinStone = dynamic_cast<ConnectiveStone *>(GetStone(g));
-    DirectionBits winFacesActorStone = (actorWinStone) ? actorWinStone->get_connections() : NODIRBIT;
+    Stone * actorWinStone = GetStone(g);
+    DirectionBits winFacesActorStone = (actorWinStone != NULL && actorWinStone->get_traits().id == st_window)
+            ? actorWinStone->getFaces() : NODIRBIT;
     
     // distinguish 9 squares within gridpos that may cause contacts
     // low cost reduction of cases that need to be examined in detail:



From ral at mail.berlios.de  Sat Jan 26 00:46:22 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 26 Jan 2008 00:46:22 +0100
Subject: [Enigma-game-svn] r1007 - team_levelpacks/team_test_new_api
Message-ID: <200801252346.m0PNkM4H014861@sheep.berlios.de>

Author: ral
Date: 2008-01-26 00:46:22 +0100 (Sat, 26 Jan 2008)
New Revision: 1007

Added:
   team_levelpacks/team_test_new_api/raoulT03_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT028_1.xml
   team_levelpacks/team_test_new_api/ralT029_1.xml
   team_levelpacks/team_test_new_api/raoulT01_1.xml
   team_levelpacks/team_test_new_api/raoulT02_1.xml
Log:
Test Levels new API:
- add Window test level
- ClusterStone test reclustering

Modified: team_levelpacks/team_test_new_api/ralT028_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT028_1.xml	2008-01-25 23:30:53 UTC (rev 1006)
+++ team_levelpacks/team_test_new_api/ralT028_1.xml	2008-01-25 23:46:22 UTC (rev 1007)
@@ -23,6 +23,7 @@
 ti["#"] = ti[" "] .. {"st-rock1"}
 
 ti["O"] = ti[" "] .. {"st_oxyd", "o#", target="enlighten"}
+ti["D"] = ti[" "] .. {"st_oxyd_d", "o#", target="enlighten"}
 ti["F"] = ti[" "] .. {"st_oxyd", oxydcolor=-3, noshuffle=true}
 ti["B"] = ti[" "] .. {"st_oxyd", "bold", oxydcolor=-4, noshuffle=true}
 ti["S"] = ti[" "] .. {"st_switch", target="o#1"}
@@ -42,7 +43,7 @@
 "                    ",
 "  Ll Ll Ll Ll Ll Ll ",
 "                    ",
-"  O  O  O  O  O  O  ",
+"  O  O  O  O  D  O  ",
 "                    ",
 "  S  TU V  W        ",
 "                    ",
@@ -59,7 +60,7 @@
 function statetest(value)
     local newstate = 0
     if value then newstate = 1 end
-    (no["o#4"])["state"] = newstate
+    no["o#4"]["state"] = newstate
 end
 
 function enlighten(value, sender)

Modified: team_levelpacks/team_test_new_api/ralT029_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT029_1.xml	2008-01-25 23:30:53 UTC (rev 1006)
+++ team_levelpacks/team_test_new_api/ralT029_1.xml	2008-01-25 23:46:22 UTC (rev 1007)
@@ -21,6 +21,7 @@
 
 ti[" "] = {"fl-sahara"}
 ti["#"] = ti[" "] .. {"st-rock1"}
+ti["."] = ti({"fl-rough-blue"}) .. {"st-chameleon"}
 
 ti["1"] = ti[" "] .. {"st_panel", cluster=1}
 ti["2"] = ti[" "] .. {"st_panel", cluster=2}
@@ -49,14 +50,15 @@
 ti["A"] = (ti[" "] .. {"it-brake"}) .. {"#ac-blackball"}
 
 ti["D"] = ti[" "] .. {"st_switch", target="deletion"}
+ti["E"] = ti[" "] .. {"st_switch", target="recluster"}
 
 w, h = wo(ti, " ", {
 "1111233         5555",
 "11 22            566",
 "1   sT            66",
 "                    ",
-"    P Q R S         ",
-"D   s               ",
+"    P Q R S        E",
+"D  .s               ",
 "       A       a    ",
 "              d b   ",
 " 8             c    ",
@@ -83,6 +85,12 @@
     wo[{1,1}] = {"st_nil"}
     wo[{0,3}] = {"st_panel", cluster=1}
 end
+
+function recluster(value, sender)
+    local newcluster = 6
+    if value then newcluster = 5 end
+    wo:st(sender - {1, 3})["cluster"] = newcluster
+end
   
   ]]></el:luamain>
     <el:i18n>

Modified: team_levelpacks/team_test_new_api/raoulT01_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT01_1.xml	2008-01-25 23:30:53 UTC (rev 1006)
+++ team_levelpacks/team_test_new_api/raoulT01_1.xml	2008-01-25 23:46:22 UTC (rev 1007)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Test FloppySwitch new API" el:subtitle="" el:id="testfloppyswitch_raoul"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
       <el:author  el:name="Raoul Bourquin" el:email="raoul at users.berlios.de"/>
       <el:copyright>Copyright ? 2008 Raoul Bourquin</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>


Property changes on: team_levelpacks/team_test_new_api/raoulT01_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision

Modified: team_levelpacks/team_test_new_api/raoulT02_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT02_1.xml	2008-01-25 23:30:53 UTC (rev 1006)
+++ team_levelpacks/team_test_new_api/raoulT02_1.xml	2008-01-25 23:46:22 UTC (rev 1007)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Test KeySwitch new API" el:subtitle="" el:id="testkeyswitch_raoul"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
       <el:author  el:name="Raoul Bourquin" el:email="raoul at users.berlios.de"/>
       <el:copyright>Copyright ? 2008 Raoul Bourquin</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>


Property changes on: team_levelpacks/team_test_new_api/raoulT02_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision

Added: team_levelpacks/team_test_new_api/raoulT03_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-01-25 23:30:53 UTC (rev 1006)
+++ team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-01-25 23:46:22 UTC (rev 1007)
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Windowstone new API" el:subtitle="" el:id="testwindow_raoul"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Raoul Bourquin" el:email="raoul at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Raoul Bourquin</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["."] = {"fl-space"}
+
+ti["0"] = ti[" "] .. {"#ac-blackball"}
+
+ti["#"] = ti[" "] .. {"st-glass"}
+ti["+"] = ti[" "] .. {"st_window_nesw"}
+ti["a"] = ti[" "] .. {"st_window_nes"}
+ti["b"] = ti[" "] .. {"st_window_esw"}
+ti["c"] = ti[" "] .. {"st_window_nsw"}
+ti["d"] = ti[" "] .. {"st_window_new"}
+ti["A"] = ti[" "] .. {"st_window_n"}
+ti["B"] = ti[" "] .. {"st_window_e"}
+ti["C"] = ti[" "] .. {"st_window_s"}
+ti["D"] = ti[" "] .. {"st_window_w"}
+ti["1"] = ti[" "] .. {"st_window_sw"}
+ti["2"] = ti[" "] .. {"st_window_nw"}
+ti["3"] = ti[" "] .. {"st_window_ne"}
+ti["4"] = ti[" "] .. {"st_window_es"}
+ti["h"] = ti[" "] .. {"st_window_ns"}
+ti["v"] = ti[" "] .. {"st_window_ew"}
+
+ti["V"] = ti["."] .. {"st_window", faces="we"}
+ti["*"] = ti["."] .. {"st_window", faces="esw"}
+
+ti["w"] = ti[" "] .. {"it-wrench"}
+ti["I"] = ti[" "] .. {"st-stoneimpulse"}
+ti["W"] = ti[" "] .. {"it-puller-w"}
+ti["E"] = ti[" "] .. {"it-puller-e"}
+ti["F"] = ti[" "] .. {"st_fourswitch", target="pullwindow", action="inner_pull"}
+ti["G"] = ti[" "] .. {"st_window", faces="ws", "pullwindow"}
+
+w, h = wo(ti, " ", {
+"###23 232323##14####",
+"#  14  1414   23   #",
+"#               BD #",
+"BAD B   a b c d BD #",
+" BCCB   a b c d BDv#",
+"  B     a b c d   v#",
+"#               G v#",
+"# 2AAAA3 B + D FV v#",
+"#IDWE0wB B   D  V v#",
+"# 1CCCC4 B + D  V v#",
+"#I              V v#",
+"# hhhhhhhhhhhh  V  #",
+"################*###"
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+     <el:string el:key="title">
+       <el:english el:translate="false"/>
+     </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/raoulT03_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From andreasl at mail.berlios.de  Sat Jan 26 14:10:48 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Sat, 26 Jan 2008 14:10:48 +0100
Subject: [Enigma-game-svn] r1008 - feature_branches/hp_lotm/input/lotm
Message-ID: <200801261310.m0QDAmIv031899@sheep.berlios.de>

Author: andreasl
Date: 2008-01-26 14:10:48 +0100 (Sat, 26 Jan 2008)
New Revision: 1008

Modified:
   feature_branches/hp_lotm/input/lotm/lotm_200802.html
   feature_branches/hp_lotm/input/lotm/lotm_200802_de.html
Log:
LotM:
 - 200802 German + English: Add Raoul's comment.


Modified: feature_branches/hp_lotm/input/lotm/lotm_200802.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200802.html	2008-01-25 23:46:22 UTC (rev 1007)
+++ feature_branches/hp_lotm/input/lotm/lotm_200802.html	2008-01-26 13:10:48 UTC (rev 1008)
@@ -108,6 +108,96 @@
 </p>
 
 
+<h4>&quot;I intended the start to be particularly difficult&quot;</h4>
+
+<div class="quote">
+I want to talk a little bit about the history of origins of the (from a
+mathematical standpoint) second most difficult level in the world of Enigma.
+</div>
+
+<div class="quote">
+First of all, a warning: This description contains lots of hints for the level
+and its puzzles. When I see, what small number of players solved the level till
+now, I think, it's not too bad to include some additional hints here.
+</div>
+
+<div class="quote">
+The first parts of this level were the &quot;Z&quot;- and the
+&quot;W&quot;-puzzles. I was working on a late evening, trying to implement my
+idea, which started as a composition of Sokoban and puzzle stones.
+</div>
+
+<div class="quote">
+At the core of this idea were a kind of passages, small, closed if possible,
+rooms, in which a bulky puzzle piece didn't block the course of the marble, but
+of another stone. The goal should be, to push some stone, for example a simple
+wood stone, through such a passage, and place it on some well-defined
+destination.
+</div>
+
+<div class="quote">
+Thus I have started several attempts to build as difficult as possible such
+passages. The result are the two, just under 8x8 tiles large components, around
+which the whole level &quot;Puzzle Puzzles&quot; is centered.
+</div>
+
+<div class="quote">
+Now we have some obstacle course for our stone. What was still missing, was a
+start and a goal. The stone had to come from somewhere and to be brought
+somewhere, to solve the level.
+</div>
+
+<div class="quote">
+I intended the start to be particularly difficult, even to be the most
+difficult element of the level. Hence, I utterly immured the &quot;VIM&quot;
+(very important stone). The gamer is supposed to exert himself to free it.
+</div>
+
+<div class="quote">
+For the goal I soon had the idea, how to hide the seldom oxyd stones in an
+inaccessible cave. The entrance was blocked by a special lock.
+</div>
+
+<div class="quote">
+Now I was looking for an idea to shape this lock in a more interesting way.
+Because, in the first version of this level, the cave was accessible as soon as
+one had the &quot;key&quot; in place.
+</div>
+
+<div class="quote">
+I remembered a special property of the door material in use, and a pattern,
+which I've once seen in an oxyd level, but not yet in Enigma. This was how the
+laser entered the game, or the level. Here as well I aimed to not only place
+the laser for the final puzzle, maybe even with the switch besides, but to
+cleverly weave the ray into the level. After adding some holes to other puzzle
+stones, another riddle was added and now the ray has to be laboriously guided
+through the whole level &hellip;
+</div>
+
+<div class="quote">
+As of now, the whole lower left part was still empty. But, as I considered the
+puzzles to be complete, and didn't came up with another reasonable idea to
+build some, I decided to create a simple, nearly meditative path, which wasn't
+a portent to what might follow. For all explorers, this is the last moment of
+tranquility, and the best place to limber up the mouse.
+</div>
+
+<div class="quote">
+When the level was completed to this point, the strenuous part only begun. I
+presented the level to a small circle of brave adventurers. For some, this
+level wasn't difficult enough, and the VIM to easy to reach. Until Ronald came
+up with the idea of the cherry island. Another ingenious riddle, which demands
+some skills in recycling already used objects as well.
+</div>
+
+<div class="quote">
+After obstructing many more small and large shortcuts, the level was still in
+time for the oncoming Enigma release 1.0.
+</div>
+
+<div class="author">Raoul Bourquin</div>
+
+
 <p>Best greets,<br>
 <i>Andreas &amp; Harry</i></p>
 

Modified: feature_branches/hp_lotm/input/lotm/lotm_200802_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200802_de.html	2008-01-25 23:46:22 UTC (rev 1007)
+++ feature_branches/hp_lotm/input/lotm/lotm_200802_de.html	2008-01-26 13:10:48 UTC (rev 1008)
@@ -113,7 +113,106 @@
 </p>
 
 
-<p>Best greets,<br>
+<h4>&quot;Den Start wollte ich m?glichst schwer machen&quot;</h4>
+
+<div class="quote">
+Ich will hier etwas ?ber die Entstehungsgeschichte des (rein 
+mathematisch betrachtet) zweitschwersten Levels aus der Enigmawelt 
+erz?hlen.
+</div>
+
+<div class="quote">
+Vorab als Warnung: Diese Beschreibung enth?lt etliche Hinweise auf
+das Level und seine Puzzles. Wenn ich sehe, wie wenig Spieler das
+Level bisher gel?st haben, wie schwer es offenbar ist, dann denke ich,
+ist es nicht zu schlimm, wenn es hier einige zus?tzliche Hinweise hat.
+</div>
+
+<div class="quote">
+Die ersten Teile dieses Levels waren das &quot;Z&quot;- und das
+&quot;W&quot;-Puzzle. Ich arbeitete an einem sp?ten Abend daran, eine Idee
+umzusetzten, die als Mixtur aus Sokoban und Puzzlesteinen begonnen hatte.
+</div>
+
+<div class="quote">
+Kern der Sache waren eine Art Durchg?nge, also kleine, m?glichst  geschlossene
+R?ume, in denen ein unhandliches Puzzlest?ck nicht den Weg  der Kugel, sondern
+den Weg eines anderen Steines verstellt. Das Ziel sollte sein, einen Stein,
+beispielsweise einen simplen Holzstein, durch einen solchen Durchgang zu
+bekommen und an einem wohldefinierten Zielort zu plazieren.
+</div>
+
+<div class="quote">
+So hatte ich also verschiedene Versuche unternommen, m?glichst schwere solcher
+Durchg?nge zu bauen. Das Resultat sind diese beiden, knapp 8x8 Felder gro?en
+Bestandteile, um die herum dann das ganze Level &quot;Puzzle Puzzles&quot;
+gewachsen war.
+</div>
+
+<div class="quote">
+Nun haben wir also einen Hindernisslauf f?r einen Stein. Was als n?chstes noch
+fehlte, waren ein Start und vor allem ein Ziel. Der Stein muss irgendwoher
+kommen und irgendwohin gebracht werden, damit das Level gel?st werden kann.
+</div>
+
+<div class="quote">
+Den Start wollte ich m?glichst schwer machen, er sollte sogar das schwerste
+Element im Level sein. So mauerte ich den &quot;VIM&quot; (very important
+stone) schlichtweg ein. Der Spieler soll sich schon etwas bem?hen, ihn frei zu
+bekommen.
+</div>
+
+<div class="quote">
+F?r das Ziel kam mir dann bald die Idee, wie ich die seltenen Oxydsteine in
+einer unzug?nglichen H?hle verstecken k?nnte. Der Eingang ist mit einem
+Spezialschloss versperrt.
+</div>
+
+<div class="quote">
+Nun suchte ich nach einer Idee, wie man dieses Schloss interessanter 
+gestalten k?nnte. Denn sobald man den &quot;Schl?ssel&quot; am Ort hatte, war
+die H?hle in der ersten Version des Levels bereits zug?nglich.
+</div>
+
+<div class="quote">
+Ich erinnerte mich an die speziellen Eigenschaften des verwendeten 
+T?rmaterials und an ein Pattern, das ich mal in einem Oxydlevel gesehen 
+hatte, und das in Enigma bisher kaum verwendet wird.
+So kam der Laser in Spiel, oder ins Level. Auch hier bem?hte ich mich 
+nun, den Laser nicht nur f?r das Schlussr?tsel hinzustellen, und den
+Anschalter wom?glich gleich daneben, sondern den Strahl geschickt ins 
+Level einzuflechten. Nachdem ich verschiedene andere Puzzlesteine mit 
+L?chern versehen hatte, kam ein weiteres R?tsel dazu und der Strahl muss 
+aufwendig durchs ganze Level geleitet werden &hellip;
+</div>
+
+<div class="quote">
+Nun war noch der ganze linke untere Teil leer. Da ich die Puzzles aber 
+als fertig betrachtete, und auch keine vern?nftige Idee mehr hatte,
+weitere einzubauen, entschloss ich mich f?r den simplen, fast schon 
+meditativen Pfad, der einen nicht ahnen l?sst, was alles kommen wird.
+Hier ist f?r alle Erkunder der letzte Moment der Ruhe und der beste Ort, 
+schon mal die Maus fit zu machen.
+</div>
+
+<div class="quote">
+Als das Level nun so weit fertig war, kam erst der m?hsame Teil.
+Ich stellte also das Level einem kleinen Kreis von mutigen
+Abenteurern vor. F?r gewisse war das Level nicht schwer genug und
+der VIM viel zu einfach zu bekommen. Bis Ronald die Kirscheninsel 
+vorschlug. Ein geniales, weiteres R?tsel, das auch gewisse
+F?higkeiten beim recyclen von verwendeten Objekten erfordert.
+</div>
+
+<div class="quote">
+Nachdem noch viele kleinere und gr??ere Abk?rzungen versperrt
+worden waren, war das Level gerade noch rechtzeitig f?r das nahende
+grosse Enigmarelease 1.0 fertig geworden.
+</div>
+
+<div class="author">Raoul Bourquin</div>
+
+<p>Sch?ne Gr??e,<br>
 <i>Andreas &amp; Harry</i></p>
 
 </div>



From raoul at mail.berlios.de  Sat Jan 26 16:48:15 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sat, 26 Jan 2008 16:48:15 +0100
Subject: [Enigma-game-svn] r1009 - team_levelpacks/team_test_new_api
Message-ID: <200801261548.m0QFmFjU013281@sheep.berlios.de>

Author: raoul
Date: 2008-01-26 16:48:15 +0100 (Sat, 26 Jan 2008)
New Revision: 1009

Added:
   team_levelpacks/team_test_new_api/raoulT04_1.xml
Log:
-> CoinSwitch testlevel


Added: team_levelpacks/team_test_new_api/raoulT04_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT04_1.xml	2008-01-26 13:10:48 UTC (rev 1008)
+++ team_levelpacks/team_test_new_api/raoulT04_1.xml	2008-01-26 15:48:15 UTC (rev 1009)
@@ -0,0 +1,67 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Coinslot new API" el:subtitle="" el:id="testcoinswitch_raoul"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 1007 $" el:status="experimental"/>
+      <el:author  el:name="Raoul Bourquin" el:email="raoul at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Raoul Bourquin</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+
+ti["0"] = ti[" "] .. {"#ac-blackball"}
+
+ti["A"] = ti[" "] .. {"st_coinslot", name="cs1", target="la1", action="onoff"}
+ti["B"] = ti[" "] .. {"st_coinslot", name="cs2", target="la2", action="signal"}
+ti["C"] = ti[" "] .. {"st_coinslot", name="cs3", target="la3", action="on"}
+ti["D"] = ti[" "] .. {"st_coinslot", name="cs4", target="la4", action="off"}
+
+ti["L"] = ti[" "] .. {"st-laser-e", name="la1"}
+ti["M"] = ti[" "] .. {"st-laser-e", name="la2"}
+ti["N"] = ti[" "] .. {"st-laser-e", name="la3"}
+ti["O"] = ti[" "] .. {"st-laser-e", name="la4"}
+
+ti["R"] = ti[" "] .. {"st_switch", name="la1", target="la1", action="onoff"}
+ti["S"] = ti[" "] .. {"st_switch", name="la2", target="la2", action="onoff"}
+ti["T"] = ti[" "] .. {"st_switch", name="la3", target="la3", action="onoff"}
+ti["U"] = ti[" "] .. {"st_switch", name="la4", target="la4", action="onoff"}
+
+ti["X"] = ti[" "] .. {"it-coin1"}
+ti["Y"] = ti[" "] .. {"it-coin2"}
+ti["Z"] = ti[" "] .. {"it-coin4"}
+
+w, h = wo(ti, " ", {
+"0      A     RL     ",
+"       B     SM     ",
+"       C     TN     ",
+"       D     UO     ",
+"                    ",
+"XXXXXXXXXX          ",
+"     YYYYYYYYYY     ",
+"          ZZZZZZZZZZ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    "
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+     <el:string el:key="title">
+       <el:english el:translate="false"/>
+     </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/raoulT04_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Sat Jan 26 23:12:46 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 26 Jan 2008 23:12:46 +0100
Subject: [Enigma-game-svn] r1010 - in trunk/src: . stones
Message-ID: <200801262212.m0QMCkPR032403@sheep.berlios.de>

Author: ral
Date: 2008-01-26 23:12:45 +0100 (Sat, 26 Jan 2008)
New Revision: 1010

Modified:
   trunk/src/enigma.hh
   trunk/src/lua.cc
   trunk/src/st_switches.cc
   trunk/src/stones.cc
   trunk/src/stones/ClusterStone.cc
   trunk/src/stones/ClusterStone.hh
   trunk/src/stones/OxydStone.cc
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: Fixes
- Lua stack error on st_nil, it_nil, fl_nil (crash fix, especially on group usage)
- FartStone did no more close oxyds (typo)
- YieldedGridStone: temporary fix known cases of false model placement
  send system message "_model_reanimated", react on ClusterStone,
  ChameleonStone, LaserTrigger
- SwapStone fix bug on kill of a coming swap stone - the gone swap stone
  remained with a half image in a dead state:
  revert swap in this case and reactivate "gone" swap stone.
- comment error on random support

Modified: trunk/src/enigma.hh
===================================================================
--- trunk/src/enigma.hh	2008-01-26 15:48:15 UTC (rev 1009)
+++ trunk/src/enigma.hh	2008-01-26 22:12:45 UTC (rev 1010)
@@ -205,7 +205,7 @@
 /* -------------------- Random Numbers -------------------- */
 
 /**
- * Maximum random number 2^16-1 that is valid for all operating systems
+ * Maximum random number 2^31-1 that is valid for all operating systems
  * and processor types. 
  */
 #define ENIGMA_RAND_MAX  2147483647

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-01-26 15:48:15 UTC (rev 1009)
+++ trunk/src/lua.cc	2008-01-26 22:12:45 UTC (rev 1010)
@@ -1695,12 +1695,15 @@
     
     if (name == "fl_nil") {
         KillFloor(GridPos(xi, yi));
+        lua_pop(L, 1);   // object type
         return 0;
     } else if (name == "st_nil") {
         KillStone(GridPos(xi, yi));
+        lua_pop(L, 1);   // object type
         return 0;
     } else if (name == "it_nil") {
         KillItem(GridPos(xi, yi));
+        lua_pop(L, 1);   // object type
         return 0;
     }
     

Modified: trunk/src/st_switches.cc
===================================================================
--- trunk/src/st_switches.cc	2008-01-26 15:48:15 UTC (rev 1009)
+++ trunk/src/st_switches.cc	2008-01-26 22:12:45 UTC (rev 1010)
@@ -169,6 +169,7 @@
         CLONEOBJ(LaserSwitch);
     public:
         LaserSwitch();
+        virtual Value message(const Message &m);
     private:
         // LaserTimeSwitchBase interface
         const char *get_active_model() const;
@@ -273,6 +274,13 @@
 : LaserTimeSwitchBase("st-laserswitch")
 {}
 
+Value LaserSwitch::message(const Message &m) {
+    if (m.message == "_model_reanimated") {
+        RecalcLight(); // we may be swapped out of a laser beam
+    }
+    return LaserTimeSwitchBase::message(m);
+}
+
 const char *LaserSwitch::get_active_model() const { 
     return "st-laserswitch1"; 
 }

Modified: trunk/src/stones/ClusterStone.cc
===================================================================
--- trunk/src/stones/ClusterStone.cc	2008-01-26 15:48:15 UTC (rev 1009)
+++ trunk/src/stones/ClusterStone.cc	2008-01-26 22:12:45 UTC (rev 1010)
@@ -36,6 +36,13 @@
         }
         Stone::set_attrib(key, val);
     }
+    
+    Value ClusterStone::message(const Message &m) {
+        if (m.message == "_model_reanimated") {
+            init_model();
+        }
+        return Stone::message(m);
+    }
 
     void ClusterStone::on_creation(GridPos p) {
         autoJoinCluster();

Modified: trunk/src/stones/ClusterStone.hh
===================================================================
--- trunk/src/stones/ClusterStone.hh	2008-01-26 15:48:15 UTC (rev 1009)
+++ trunk/src/stones/ClusterStone.hh	2008-01-26 22:12:45 UTC (rev 1010)
@@ -35,7 +35,7 @@
         
         // Object interface
         virtual void set_attrib(const string& key, const Value &val);
-
+        virtual Value message(const Message &m);
         // GridObject interface
         virtual void on_creation(GridPos p);
         virtual void on_removal(GridPos p);

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-01-26 15:48:15 UTC (rev 1009)
+++ trunk/src/stones/OxydStone.cc	2008-01-26 22:12:45 UTC (rev 1010)
@@ -856,8 +856,7 @@
     
     Value OxydStone::message(const Message &m) {
         if (m.message == "closeall") {
-            if (isDisplayable())
-                closeAllStandardOxyds();
+            closeAllStandardOxyds();
             return Value();
         }
         else if (m.message == "shuffle") {

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-01-26 15:48:15 UTC (rev 1009)
+++ trunk/src/stones.cc	2008-01-26 22:12:45 UTC (rev 1010)
@@ -469,7 +469,9 @@
 {
     SetStone(pos, stone);
     display::SetModel(GridLoc(GRID_STONES, stone->get_pos()), model);
-    stone->on_move();
+    stone->on_move();    // continue animations -- this is buggy if the stone has another
+                         // model on the new position like st-chameleon
+    SendMessage(stone, "_model_reanimated");  // temp fix: reset bad models
     stone = 0;
     model = 0;
 }

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-01-26 15:48:15 UTC (rev 1009)
+++ trunk/src/stones_simple.cc	2008-01-26 22:12:45 UTC (rev 1010)
@@ -346,6 +346,13 @@
         CLONEOBJ(ChameleonStone);
         DECL_TRAITS;
 
+        Value message(const Message &m) {
+            if (m.message == "_model_reanimated") {
+                init_model();
+            }
+            return Stone::message(m);
+        }
+        
         void init_model() {
             string modelname = "fl-gray";
             if (Floor *fl = GetFloor(get_pos()))
@@ -428,6 +435,12 @@
 void SwapStone::on_removal(GridPos p) {
     if (state == COME) {
         GameTimer.remove_alarm(this);
+        GridPos oldPos = move(get_pos(), reverse(move_dir));
+        SwapStone *other = dynamic_cast<SwapStone *>(GetStone(oldPos));
+        if (other != NULL) {
+            other->state = IDLE;
+            other->init_model();
+        }
     }
     GridObject::on_removal(p);
 }
@@ -1371,7 +1384,7 @@
     case FARTING:
     case BREAKING:
         if (state == IDLE) {
-            Object *ox = GetObjectTemplate("st-oxyd");
+            Object *ox = GetObjectTemplate("st_oxyd");
             SendMessage(ox, "closeall");
             sound_event("fart");
             if (newstate == BREAKING) {



From ral at mail.berlios.de  Sat Jan 26 23:39:46 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 26 Jan 2008 23:39:46 +0100
Subject: [Enigma-game-svn] r1011 - team_levelpacks/team_test_new_api
Message-ID: <200801262239.m0QMdkRp001597@sheep.berlios.de>

Author: ral
Date: 2008-01-26 23:39:46 +0100 (Sat, 26 Jan 2008)
New Revision: 1011

Added:
   team_levelpacks/team_test_new_api/ralT030_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT028_1.xml
   team_levelpacks/team_test_new_api/ralT029_1.xml
Log:
Test Levels new API:
- swap bugs test level


Modified: team_levelpacks/team_test_new_api/ralT028_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT028_1.xml	2008-01-26 22:12:45 UTC (rev 1010)
+++ team_levelpacks/team_test_new_api/ralT028_1.xml	2008-01-26 22:39:46 UTC (rev 1011)
@@ -35,10 +35,14 @@
 ti["L"] = ti[" "] .. {"st-laser-n", "Laser#"}
 ti["l"] = ti[" "] .. {"st-laser-n", "laser#"}
 ti["b"] = ti[" "] .. {"st_boulder_s"}
+ti["s"] = ti[" "] .. {"st-swap"}
 ti["X"] = ti[" "] .. {"st_switch", target="o#1", action="shuffle"}
 ti["Y"] = ti[" "] .. {"st_switch", target="o#1", action="closeall"}
 ti["1"] = (ti[" "] .. {"it-magicwand"}) .. {"#ac-blackball"}
 
+ti["w"] = ti[" "] .. {"st_switch", target="Laser#7", action="onoff"}
+ti["f"] = ti[" "] .. {"st-fart"}
+
 w, h = wo(ti, " ", {
 "                    ",
 "  Ll Ll Ll Ll Ll Ll ",
@@ -48,11 +52,11 @@
 "  S  TU V  W        ",
 "                    ",
 "      1             ",
+"f                   ",
 "                    ",
 "                    ",
-"                    ",
-"    F      C B      ",
-"      Y  X       b  "
+"  F      C Bs       ",
+"    Y  X     wL  b  "
 })
 
 wo:shuffleOxyd()

Modified: team_levelpacks/team_test_new_api/ralT029_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT029_1.xml	2008-01-26 22:12:45 UTC (rev 1010)
+++ team_levelpacks/team_test_new_api/ralT029_1.xml	2008-01-26 22:39:46 UTC (rev 1011)
@@ -21,7 +21,6 @@
 
 ti[" "] = {"fl-sahara"}
 ti["#"] = ti[" "] .. {"st-rock1"}
-ti["."] = ti({"fl-rough-blue"}) .. {"st-chameleon"}
 
 ti["1"] = ti[" "] .. {"st_panel", cluster=1}
 ti["2"] = ti[" "] .. {"st_panel", cluster=2}
@@ -58,7 +57,7 @@
 "1   sT            66",
 "                    ",
 "    P Q R S        E",
-"D  .s               ",
+"D   s               ",
 "       A       a    ",
 "              d b   ",
 " 8             c    ",

Added: team_levelpacks/team_test_new_api/ralT030_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT030_1.xml	2008-01-26 22:12:45 UTC (rev 1010)
+++ team_levelpacks/team_test_new_api/ralT030_1.xml	2008-01-26 22:39:46 UTC (rev 1011)
@@ -0,0 +1,72 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Swap new API" el:subtitle="" el:id="20080126ral299"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2007 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["#"] = ti[" "] .. {"st-rock1"}
+ti["~"] = ti({"fl-rough-blue"}) .. {"st-chameleon"}
+
+ti["s"] = ti[" "] .. {"st-swap"}
+
+ti["2"] = ti[" "] .. {"st_panel", cluster=2}
+
+ti["P"] = ti[" "] .. {"st_panel"}
+ti["Q"] = ti[" "] .. {"st_panel_n"}
+ti["R"] = ti[" "] .. {"st_panel", faces="ne"}
+
+
+ti["A"] = (ti[" "] .. {"it-brake"}) .. {"#ac-blackball"}
+
+
+ti["w"] = ti[" "] .. {"st_switch", target="Laser", action="onoff"}
+ti["k"] = ti[" "] .. {"st-laserswitch"}
+ti["L"] = ti[" "] .. {"st-laser-n", "Laser"}
+
+ti["+"] = ti[" "] .. {"st-grate1"}
+ti["."] = ti[" "] .. {"it-seed"}
+
+
+w, h = wo(ti, " ", {
+"    2               ",
+"   22           sk  ",
+"    s2              ",
+"                wL  ",
+"    P Q             ",
+"   ~s               ",
+"       A            ",
+"                    ",
+"                    ",
+"  #+s.              ",
+"                    ",
+"                    ",
+"                    "
+})
+
+
+  
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT030_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From andreasl at mail.berlios.de  Mon Jan 28 00:59:30 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Mon, 28 Jan 2008 00:59:30 +0100
Subject: [Enigma-game-svn] r1012 - in feature_branches/hp_lotm: images/lotm
	input/lotm
Message-ID: <200801272359.m0RNxUCe006097@sheep.berlios.de>

Author: andreasl
Date: 2008-01-28 00:59:29 +0100 (Mon, 28 Jan 2008)
New Revision: 1012

Modified:
   feature_branches/hp_lotm/images/lotm/lotm-history.png
   feature_branches/hp_lotm/input/lotm/lotm_200802.html
   feature_branches/hp_lotm/input/lotm/lotm_200802_de.html
Log:
LotM:
 - Updated lotm-history.png
 - 200802 German + English: Ryujun's comment
Todo:
 - Maybe first steps for Russian translation?


Modified: feature_branches/hp_lotm/images/lotm/lotm-history.png
===================================================================
(Binary files differ)

Modified: feature_branches/hp_lotm/input/lotm/lotm_200802.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200802.html	2008-01-26 22:39:46 UTC (rev 1011)
+++ feature_branches/hp_lotm/input/lotm/lotm_200802.html	2008-01-27 23:59:29 UTC (rev 1012)
@@ -73,6 +73,11 @@
 
 <h4>&quot;'Puzzle Puzzles' still fascinates me&quot;</h4>
 
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200802_d.png" alt="Level of the month" border="0">
+<div class="imagetitle">The first obstacle &hellip;</div>
+</div>
+
 <div class="quote">
 Indeed, &quot;Puzzle Puzzles&quot; is such a strange mix of difficult and
 easy, that I just sit there, astonished, and ask myself, why I have
@@ -107,7 +112,57 @@
 combination of dark materials and abyss.
 </p>
 
+<h4>&quot;I had to become a civil engineer&quot;</h4>
 
+<div class="quote">
+&quot;Puzzle Puzzles&quot; is one of the levels that I was not able to solve for
+a long time and has a very high difficulty in its puzzles. The level which is
+made from seascape not room surrounded by walls is distinct in comparison with
+other levels chosen &quot;Level of the Month&quot;, and perhaps we will be able
+to look at the whole seascape easily. So when I played the level for the first
+time, the level didn't seem to have a lot of complex difficulties. Additionally,
+I may have thought that I could solve it easily. But it was wrong, and I felt
+conceited. It was very difficult for me to solve it.
+</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200802_b.png" alt="Level of the month" border="0">
+<div class="imagetitle">&hellip; and the second!
+<br>Better get that extra life.</div>
+</div>
+
+<div class="quote">
+I began with solving the easy mode first. I had to become a civil engineer to
+make a bridge across the sea to solve the level. But unexpectedly, it was
+difficult for me to fulfill these tasks, because of the X-shaped wire netting
+(st-grate1) and the slopes (fl-gradient) around the island with the puzzle
+stones and broken bottles (it-booze-broken).  And this wasn't all&mdash;the
+level provides more obstacles, for example, it was difficult for me to operate an
+invisible marble, as doing this needs dexterity, patience, and speed. So these
+have high ratings on the level, as well as intelligence and knowledge. I like
+such levels which require various high abilities very much.
+</div>
+
+<div class="quote">
+After solving easy mode, I was not able to solve difficult mode at once because
+the structures are quite different. So I needed much time to become a more
+excellent civil engineer. 'To become' is the most difficult, but is also the most
+enjoyable. And the X-shaped wire netting (st-grate1) is an important barricade,
+so if it wasn't there, I would have solved it earlier. Additionally, I was
+conscious excessively how to solve of easy mode, can you understand what this
+means?</div>
+
+<div class="quote">
+Last I admire Raoul Bourquin very much, and I think that people who
+make such a splendid level have an abundant creative ability, and
+without them, I could not spend happy times with Enigma, and expect
+new splendid levels in the future.
+</div>
+
+<div class="author">Ryujun</div>
+
+
+
 <h4>&quot;I intended the start to be particularly difficult&quot;</h4>
 
 <div class="quote">
@@ -135,6 +190,12 @@
 destination.
 </div>
 
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200802_c.png" alt="Level of the month" border="0">
+<div class="imagetitle">A cherry! What might it be good for? <br>
+I have to elaborate on that.</div>
+</div>
+
 <div class="quote">
 Thus I have started several attempts to build as difficult as possible such
 passages. The result are the two, just under 8x8 tiles large components, around

Modified: feature_branches/hp_lotm/input/lotm/lotm_200802_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200802_de.html	2008-01-26 22:39:46 UTC (rev 1011)
+++ feature_branches/hp_lotm/input/lotm/lotm_200802_de.html	2008-01-27 23:59:29 UTC (rev 1012)
@@ -75,6 +75,11 @@
 <h4>&quot;'Puzzle Puzzles' ?bt schon eine gewisse Faszination auf mich
 aus&quot;</h4>
 
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200802_d.png" alt="Level of the month" border="0">
+<div class="imagetitle">Das erste Hindernis &hellip;</div>
+</div>
+
 <div class="quote">
 Doch, &quot;Puzzle Puzzles&quot; ist wirklich eine so seltsame Mischung aus
 schwierig und leicht, dass ich oft verwundert dasitze und mich frage, warum ich
@@ -112,7 +117,60 @@
 Materialien und Abyss erinnern.
 </p>
 
+<h4>&quot;Ich musste ein Bauingenieur werden&quot;</h4>
 
+<div class="quote">
+&quot;Puzzle Puzzles&quot; ist eines derjenigen Level, die ich f?r lange Zeit
+nicht l?sen konnte, und auch in seinen R?tseln sehr schwer ist. Der Level, der
+in einer Meereslandschaft spielt, statt einem von W?nden umgebenen Raum,
+unterscheidet sich in ausgepr?gter Weise von anderen &quot;Leveln des
+Monats&quot;, und vielleicht werden wir in der Lage sein, einfacher auf die
+gesamte Landschaft zu blicken. Als ich nun den Level zum ersten Mal gespielt
+hatte, schien der Level nicht viele komplexe Schwierigkeiten aufzuwerfen. Dazu
+kam, habe ich vielleicht gedacht, ich k?nnte ihn auf einfache Weise l?sen. Aber
+ich lag falsch, und f?hlte mich eingebildet. Es war schwer f?r mich, den Level
+zu l?sen.
+</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200802_b.png" alt="Level of the month" border="0">
+<div class="imagetitle">&hellip; und das zweite!
+<br>Das Extraleben nicht vergessen.</div>
+</div>
+
+<div class="quote">
+Ich begann mit dem einfachen Modus. Ich musste ein Bauingenieur werden, um eine
+Br?cke ?ber den See zu bauen, und den Level zu l?sen. Aber unerwarteterweise
+fand ich es schwierig, diese Aufgaben zu erf?llen, aufgrund der X-f?rmigen
+Drahtgestelle (st-grate1) und Abh?nge (fl-gradient) um die Insel mit den
+Puzzlesteinen und zerbrochenen Flaschen (it-booze-broken). Und das war noch
+nicht mal alles - der Level bietet weitere Hindernisse, beispielsweise fand ich
+es schwierig, eine unsichtbare Murmel zu man?vrieren, den das ben?tigt
+Geschicklichkeit, Geduld und Schnelligkeit. Folglich haben diese auch hohe
+Schwierigkeits-Bewertungen f?r den Level, ebenso wie Intelligenz und Wissen.
+Ich mag solche Levels, die einem gleich mehrere F?higkeiten stark abverlangen.
+</div>
+
+<div class="quote">
+Nachdem ich den einfachen Modus gel?st hatte, war ich nicht sogleich in der
+Lage, den schweren Modus zu l?sen, da die Strukturen ziemlich verschieden sind.
+So brauchte ich viel Zeit, ein noch exzellenterer Bauingenieur zu werden. 'Zu
+werden' ist h?chst schwierig, aber auch h?chst unterhaltsam. Und die X-f?rmigen
+Drahtgestelle (st-grate1) sind ein wichtiges Hindernis, w?ren sie nicht da,
+h?tte ich es fr?her gel?st. Au?erdem, war ich conscious excessively how to solve
+of easy mode, can you understand what this means?
+</div>
+
+<div class="quote">
+Abschlie?end bewundere ich Raoul Bourquin sehr stark, und ich denke, dass
+Leute, die so pr?chtige Levels erschaffen, reichliche kreative F?higkeiten
+besitzen, und ohne diese, k?nnte ich nicht so gl?ckliche Zeiten mit Enigma
+verbringen, und neue gro?artige Levels in der Zukunft erwarten.
+</div>
+
+<div class="author">Ryujun</div>
+
+
 <h4>&quot;Den Start wollte ich m?glichst schwer machen&quot;</h4>
 
 <div class="quote">
@@ -142,6 +200,12 @@
 bekommen und an einem wohldefinierten Zielort zu plazieren.
 </div>
 
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200802_c.png" alt="Level of the month" border="0">
+<div class="imagetitle">Eine Kirsche! Wof?r mag die gut sein? <br>
+Das schaue ich mir n?her an!</div>
+</div>
+
 <div class="quote">
 So hatte ich also verschiedene Versuche unternommen, m?glichst schwere solcher
 Durchg?nge zu bauen. Das Resultat sind diese beiden, knapp 8x8 Felder gro?en



From ral at mail.berlios.de  Tue Jan 29 00:15:47 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 29 Jan 2008 00:15:47 +0100
Subject: [Enigma-game-svn] r1013 - in trunk: data src
Message-ID: <200801282315.m0SNFlHJ026324@sheep.berlios.de>

Author: ral
Date: 2008-01-29 00:15:46 +0100 (Tue, 29 Jan 2008)
New Revision: 1013

Modified:
   trunk/data/init.lua
   trunk/src/actors.cc
   trunk/src/items.cc
   trunk/src/lua.cc
   trunk/src/server.cc
   trunk/src/server.hh
   trunk/src/stones_complex.cc
   trunk/src/world.cc
Log:
Trunk 1.1: Reengineering Trigger
- renaming it-trigger to it_trigger
- it_trigger as StateObject: 
  - state O/1 as ON/OFF can be requested
  - all other messages and writes are disabled
- correct initialization of new triggers:
  - image and internal state due to the number of actors and stone
- jumping on and over triggers is allowed: flying marbles do not
  press the trigger any more. (Bug #8154)
- cannonballs do no longer press a trigger
Note:
- dead actors are still counted


Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-27 23:59:29 UTC (rev 1012)
+++ trunk/data/init.lua	2008-01-28 23:15:46 UTC (rev 1013)
@@ -47,6 +47,7 @@
 RenamingObjectsNew2Old = {
     it_blocker = "it-blocker",
     it_blocker_new = "it-blocker-new",
+    it_trigger = "it-trigger",
     st_blocker = "st-blocker",
     st_blocker_new = "st-blocker-growing",
     st_boulder = "st-bolder",

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2008-01-27 23:59:29 UTC (rev 1012)
+++ trunk/src/actors.cc	2008-01-28 23:15:46 UTC (rev 1013)
@@ -442,7 +442,7 @@
         DECL_TRAITS;
     public:
         Bug() : Actor(traits) {}
-        bool is_flying() const { return true; }
+        bool is_flying() const { return false; }
         bool is_dead() const { return false; }
         int get_id() const { return ac_bug; }
     };
@@ -466,7 +466,7 @@
         DECL_TRAITS;
  
         int get_id() const { return ac_horse; }
-        bool is_flying() const { return true; }
+        bool is_flying() const { return false; }
         bool is_dead() const { return false; }
 
         void think (double dtime);
@@ -619,7 +619,7 @@
         };
 
         void sink (double dtime);
-	void disable_shield();
+        void disable_shield();
         void change_state_noshield (State newstate);
         void change_state(State newstate);
 
@@ -642,7 +642,7 @@
         }
 
         bool is_dead() const;
-	bool is_movable() const;
+        bool is_movable() const;
         bool is_flying() const { return state == JUMPING; }
         bool is_on_floor() const;
         bool is_drunken() const { return m_drunk_rest_time>0; }
@@ -1015,6 +1015,13 @@
 
     string kind     = get_kind();
     State  oldstate = state;
+    
+    if (oldstate == JUMPING) {
+        // notify objects on grid about the landing - used by it_trigger
+        SendMessage(GetStone(get_gridpos()), "_jumping", false);
+        SendMessage(GetItem(get_gridpos()), "_jumping", false);
+        SendMessage(GetFloor(get_gridpos()), "_jumping", false);
+    }
 
     // Whatever happened to the ball, the sink depth
     // should be returned to zero.
@@ -1066,6 +1073,10 @@
     case JUMPING:
         sound_event ("jump");
         set_anim(kind+"-jump");
+        // notify objects on grid about the jumping - used by it_trigger
+        SendMessage(GetFloor(get_gridpos()), "_jumping", true);
+        SendMessage(GetItem(get_gridpos()), "_jumping", true);
+        SendMessage(GetStone(get_gridpos()), "_jumping", true);
         break;
     case APPEARING:
     case RISING_VORTEX:

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-01-27 23:59:29 UTC (rev 1012)
+++ trunk/src/items.cc	2008-01-28 23:15:46 UTC (rev 1013)
@@ -1316,80 +1316,149 @@
 
 
 /* -------------------- Trigger -------------------- */
-namespace
-{
+    /**
+     * A switch that is triggered by actors crossing it on the floor and stones
+     * being pushed onto it. The external state is read only - value 1 (ON) is
+     * reported if the trigger is pressed either by an actor or a stone, a value
+     * 0 (OFF) otherwise.<p>
+     * Note that due to the Enigma 1.10 standards no actions will be performed
+     * on initialisation or setting of a trigger, even if actors or a stone are
+     * positioned on the grid. But state and model are set according to the other
+     * objects.<p>
+     * The internal state stores the current number of actors and the presence
+     * of a stone. The stone is flagged as the least significant bit, the actor
+     * count is stored in the bits above, what is simply an addition of 2 times
+     * the actor count to the state. This coding simplifies requests and avoids
+     * usage of additional ivars for the complete logical state.
+     */
     class Trigger : public Item {
         CLONEOBJ(Trigger);
         DECL_TRAITS;
     public:
         Trigger();
+        
+        // Object interface
+        virtual Value message (const Message &m);
+        
+        // StateObject interface
+        virtual int externalState() const;
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+        virtual void init_model();
+        
+        // Item interface
+        virtual void actor_enter(Actor *a);
+        virtual void actor_leave(Actor *a);
+        virtual void stone_change(Stone *st);
     private:
-        // Variables
-        bool m_pressedp;
-        int m_actorcount;
-
         // Methods
-        void update_state();
+        int countActors();
+        void updateIState(int diffActors = 0, bool refuseAction = false);
 
-        // Item interface
-        void init_model();
-        void actor_enter(Actor *) { m_actorcount += 1; update_state(); }
-        void actor_leave(Actor *) { m_actorcount -= 1; update_state(); }
-        void stone_change(Stone *) { update_state(); }
+    };
 
-        virtual Value message (const Message &m) {
-            if (m.message == "signal") {
-                performAction(m.value.to_bool());  // convert 1/0 values to true/false
-                return Value();                
-            } else if (m.message == "_init") {
-                update_state();                
-                return Value();
-            }
-            return Item::message(m);
+    DEF_TRAITSF(Trigger, "it_trigger", it_trigger, itf_static | itf_indestructible);
+    
+    Trigger::Trigger() {
+        set_attrib("invisible", false);
+    }
+    
+    Value Trigger::message (const Message &m) {
+        if (m.message == "signal") {
+            performAction(m.value.to_bool());  // convert 1/0 values to true/false
+            return Value();                
+        } else if (m.message == "_init") {
+            // the state count at init is wrong as some actors on the grid may
+            // already have existed on_creation, but all are reported via
+            // actor_enter due to actors on_creation.
+            // Thus we need to reset and recount the actors:
+            state = 0;
+            
+            // old Enigma versions did issue performAction what is incompatible
+            updateIState(countActors(),
+                    server::EnigmaCompatibility >= 1.10 && server::GameCompatibility == GAMET_ENIGMA); 
+            return Value();
+        } else if (m.message == "_jumping" ) {
+            updateIState(m.value.to_bool() ? -1 : +1);
         }
-    };
-
-    DEF_TRAITSF(Trigger, "it-trigger", it_trigger,
-                itf_static | itf_indestructible);
-}
-
-Trigger::Trigger()
-{
-    m_pressedp = false;
-    m_actorcount = 0;
-    set_attrib("invisible", false);
-}
-
-void Trigger::init_model()
-{
-    if (getAttr("invisible").to_bool())
-        set_model("invisible");
-    else if (m_pressedp)
-        set_model("it-trigger1");
-    else
-        set_model("it-trigger");
-}
-
-void Trigger::update_state()
-{
-    Stone *st = GetStone(get_pos());
-    // Hack to make tunnel puzzle stones press triggers
-    bool stone_pressure = st && (!st->is_floating() || st->is_kind ("st-puzzle*"));
-    bool pressedp = stone_pressure || (m_actorcount > 0);
-
-    if (m_pressedp != pressedp) {
-        m_pressedp = pressedp;
-
+        return Item::message(m);
+    }
+        
+    int Trigger::externalState() const {
+        return state != 0 ? 1 : 0;
+    }
+    
+    void Trigger::setState(int extState) {
+        return;   // ignore any write attempts
+    }
+    
+    void Trigger::on_creation(GridPos p) {
+        state = 0;
+        updateIState(countActors(), !server::WorldInitialized);
         init_model();
-        if (m_pressedp) {
-            sound_event ("triggerdown");
-            performAction(true);
-        } else {
-            sound_event ("triggerup");
-            performAction(false);
+    }
+        
+    void Trigger::init_model() {
+        if (getAttr("invisible").to_bool())
+            set_model("invisible");
+        else if (state != 0)
+            set_model("it-trigger1");
+        else
+            set_model("it-trigger");
+    }
+    
+    void Trigger::actor_enter(Actor *a) {
+        if (!a->is_flying())
+            updateIState(+1, !server::WorldInitialized);
+    }
+    
+    void Trigger::actor_leave(Actor *a) {
+        if (!a->is_flying())
+            updateIState(-1, !server::WorldInitialized);
+    }
+    
+    void Trigger::stone_change(Stone *) {
+        updateIState(0);
+    }
+    
+    int Trigger::countActors() {
+        vector<Actor*> actors;
+        GetActorsInsideField (get_pos(), actors);
+        int count = 0;
+        for (vector<Actor*>::iterator it = actors.begin(); it != actors.end(); ++it)
+            if (!(*it)->is_flying()) count++;
+        return count;
+    }
+    
+    void Trigger::updateIState(int diffActors, bool refuseAction) {
+        int oldState = state;
+        
+        state += 2 * diffActors;
+        
+        Stone *st = GetStone(get_pos());
+        state &= ~1;  // delete stone pressure bit
+        if (st != NULL && (!st->is_floating() || st->is_kind("st-puzzle*"))) {
+            // Hack to make hollow puzzle stones press triggers
+            state |= 1;   // add stone pressure bit
         }
+                
+//        Log << "Trigger update old state " << oldState << " - new state " << state << "\n";
+    
+        if ((oldState == 0 && state != 0) || (oldState != 0 && state == 0)) {
+            init_model();
+            if (!refuseAction) {
+                if (state != 0) {
+                    sound_event ("triggerdown");
+                    performAction(true);
+                } else {
+                    sound_event ("triggerup");
+                    performAction(false);
+                }
+            }
+        }
     }
-}
 
 
 /* -------------------- Seed -------------------- */

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-01-27 23:59:29 UTC (rev 1012)
+++ trunk/src/lua.cc	2008-01-28 23:15:46 UTC (rev 1013)
@@ -1774,7 +1774,7 @@
 
 static int initWorld(lua_State *L) {
     // world, (ti|function), string, table
-    if (server::WorldInitialized) {
+    if (server::WorldSized) {
         throwLuaError(L, "World reinitialization not allowed");
         return 0;
     }

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2008-01-27 23:59:29 UTC (rev 1012)
+++ trunk/src/server.cc	2008-01-28 23:15:46 UTC (rev 1013)
@@ -87,6 +87,7 @@
 bool     server::SingleComputerGame;        // no Lua access
 bool     server::TwoPlayerGame;             // no Lua access
 GameType server::GameCompatibility;         // no Lua access
+bool     server::WorldSized;                // no Lua access
 bool     server::WorldInitialized;          // no Lua access
 double   server::Brittleness;
 double   server::BumperForce;
@@ -256,7 +257,7 @@
     move_counter = 0;
 
     enigma::WorldPrepareLevel();
-    server::WorldInitialized = false;
+    server::WorldSized = false;
 
     player::PrepareLevel();
 

Modified: trunk/src/server.hh
===================================================================
--- trunk/src/server.hh	2008-01-27 23:59:29 UTC (rev 1012)
+++ trunk/src/server.hh	2008-01-28 23:15:46 UTC (rev 1013)
@@ -70,7 +70,10 @@
     // Behave like Oxyd/Enigma version
     extern GameType GameCompatibility;
 
-    // Detect double initialization (resize) attempts
+    // Detect double world resize attempts
+    extern bool     WorldSized;
+    
+    // Guarantee a fully initialized world, init messages has been sent
     extern bool     WorldInitialized;
     
     // Single oxyds make a level unsolvable, but sometimes they are just fake,... 

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2008-01-27 23:59:29 UTC (rev 1012)
+++ trunk/src/stones_complex.cc	2008-01-28 23:15:46 UTC (rev 1013)
@@ -375,7 +375,10 @@
     private:
         CLONEOBJ(OneWayStone);
         DECL_TRAITS;
-        virtual bool actor_may_pass (Actor * /*a*/) { return true; }
+        virtual bool actor_may_pass (Actor *a) {
+            const ActorTraits &at = a->get_traits();
+            return at.id != ac_bug && at.id != ac_horse;
+        }
     };
     DEF_TRAITS(OneWayStone, "st-oneway", st_oneway);
 

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-01-27 23:59:29 UTC (rev 1012)
+++ trunk/src/world.cc	2008-01-28 23:15:46 UTC (rev 1013)
@@ -1557,7 +1557,7 @@
 {
     level.reset (new World(w,h));
     display::NewWorld(w, h);
-    server::WorldInitialized = true;
+    server::WorldSized = true;
 }
 
 void WorldPrepareLevel ()
@@ -1605,6 +1605,7 @@
     display::FocusReferencePoint();
 
     level->preparing_level = false;
+    server::WorldInitialized = true;
 
     return true;
 }



From ral at mail.berlios.de  Tue Jan 29 00:28:41 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 29 Jan 2008 00:28:41 +0100
Subject: [Enigma-game-svn] r1014 - team_levelpacks/team_test_new_api
Message-ID: <200801282328.m0SNSfiG027262@sheep.berlios.de>

Author: ral
Date: 2008-01-29 00:28:41 +0100 (Tue, 29 Jan 2008)
New Revision: 1014

Added:
   team_levelpacks/team_test_new_api/ralT031_1.xml
Log:
Test Level new API:
- it_trigger

Added: team_levelpacks/team_test_new_api/ralT031_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT031_1.xml	2008-01-28 23:15:46 UTC (rev 1013)
+++ team_levelpacks/team_test_new_api/ralT031_1.xml	2008-01-28 23:28:41 UTC (rev 1014)
@@ -0,0 +1,110 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Trigger new API" el:subtitle="" el:id="20080127ral564"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["."] = {"fl-water"}
+ti["~"] = {"fl-abyss"}
+ti["!"] = {"fl-wood", ignitable=true}
+ti["#"] = ti[" "] .. {"st-rock1"}
+
+ti["A"] = ti[" "] .. {"it_trigger", target="lasera", action="onoff", "triggerA"}
+ti["B"] = ti["~"] .. {"it_trigger", target={"laserb","laserbon"}, action={"onoff", "on"}}
+ti["C"] = ti["."] .. {"it_trigger", target={"laserc","lasercon"}, action={"onoff", "on"}}
+ti["O"] = ti["!"] .. {"it_trigger", target={"lasero","laseroon"}, action={"onoff", "on"}}
+
+ti["a"] = ti[" "] .. {"st-laser-s", "lasera"}
+ti["b"] = ti[" "] .. {"st-laser-s", "laserb"}
+ti["c"] = ti[" "] .. {"st-laser-s", "laserc"}
+ti["d"] = ti[" "] .. {"st-laser-s", "laserbon"}
+ti["e"] = ti[" "] .. {"st-laser-s", "lasercon"}
+ti["f"] = ti[" "] .. {"st-laser-s", "laserf"}
+ti["g"] = ti[" "] .. {"st-laser-s", "laserfon"}
+ti["h"] = ti[" "] .. {"st-laser-n", "laserh"}
+ti["i"] = ti[" "] .. {"st-laser-n", "laserhon"}
+ti["j"] = ti[" "] .. {"st-laser-n", "laserj"}
+ti["k"] = ti[" "] .. {"st-laser-n", "laserjon"}
+ti["l"] = ti[" "] .. {"st-laser-n", "laserl"}
+ti["n"] = ti[" "] .. {"st-laser-n", "laserlon"}
+ti["o"] = ti[" "] .. {"st-laser-n", "lasero"}
+ti["p"] = ti[" "] .. {"st-laser-n", "laseroon"}
+
+
+ti["W"] = ti[" "] .. {"st-wood"}
+ti["U"] = ti[" "] .. {"st-block"}
+ti["V"] = ti[" "] .. {"st-brownie"}
+ti["u"] = ti[" "] .. {"it-spring1"}
+ti["v"] = ti[" "] .. {"it-brake"}
+ti["Y"] = ti[" "] .. {"st-death"}
+ti["z"] = ti[" "] .. {"it-dynamite"}
+
+ti["M"] = ti[" "] .. {"st_switch", target="maketrigger"}
+ti["m"] = ti[" "] .. {"st_switch", target="makeactor"}
+ti["X"] = ti[" "] .. {"it-wormhole", destination="triggerA", range=1}
+
+ti["1"] = (ti[" "] .. {"#ac-blackball"}) .. {"it-ring"}
+ti["2"] = ti[" "] .. {"#ac-whiteball-small", player=nil, controllers=0}
+
+ti["3"] = (ti[" "]  .. {"#ac-whiteball-small", controllers=0})
+                .. {"it_trigger", target={"laserh","laserhon"}, action={"onoff", "on"}}
+ti["4"] = (ti[" "]  .. {"it_trigger", target={"laserj","laserjon"}, action={"onoff", "on"}})
+                .. {"#ac-whiteball-small", controllers=0}
+ti["5"] = (ti[" "]  .. {"it_trigger", target={"laserl","laserlon"}, action={"onoff", "on"}})
+                .. {"st-wood"}
+ti["6"] = (ti[" "]  .. {"it_trigger", "killtrigger", target="killstone"})
+
+
+w, h = wo(ti, " ", {
+"                    ",
+" op   ln   jk   hi  ",
+" O    5    4    3   ",
+" !   V              ",
+" !                  ",
+"     2 2 2      6W  ",
+"X                   ",
+"     1uvz  U    V   ",
+"     W     W    W   ",
+"M    A     B    C   ",
+"    Y      ~    .   ",
+"fg   am    bd   ce  ",
+"                    "
+})
+
+function maketrigger(value, sender)
+    wo[sender + {1,0}] = {"it_trigger", target={"laserf","laserfon"}, action={"onoff", "on"}}
+end
+  
+function makeactor(value, sender)
+    wo[no["triggerA"]] = {"#ac-whiteball-small", plazer=nil, controllers=0}
+end
+
+function killstone(value, sender)
+    wo[sender] = {"st_nil"}
+end
+  
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT031_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From raoul at mail.berlios.de  Wed Jan 30 01:49:34 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Wed, 30 Jan 2008 01:49:34 +0100
Subject: [Enigma-game-svn] r1015 - team_levelpacks/team_test_new_api
Message-ID: <200801300049.m0U0nY53032764@sheep.berlios.de>

Author: raoul
Date: 2008-01-30 01:49:34 +0100 (Wed, 30 Jan 2008)
New Revision: 1015

Modified:
   team_levelpacks/team_test_new_api/ralT014_1.xml
   team_levelpacks/team_test_new_api/raoulT04_1.xml
Log:
-> Modified coinslot testlevels


Modified: team_levelpacks/team_test_new_api/ralT014_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT014_1.xml	2008-01-28 23:28:41 UTC (rev 1014)
+++ team_levelpacks/team_test_new_api/ralT014_1.xml	2008-01-30 00:49:34 UTC (rev 1015)
@@ -24,7 +24,7 @@
 ti["."] = ti({"fl-rough-blue", checkerboard=0}) .. {"fl-rough-red", checkerboard=1}
 ti["c"] = ti[" "] .. {"it-cherry", name="cherry#"}
 ti["5"] = ti[" "] .. {"it-coin2", name="money", target={"otto", "emil*"}}
-ti["S"] = ti[" "] .. {"st-coinslot"}
+ti["S"] = ti[" "] .. {"st_coinslot"}
 ti["m"] = ti[" "] .. {"#ac-blackball"}
 ti["x"] = {"fl-rough-blue"} .. {"it-banana"} .. ti({"ac-bug", 0.7})
 ti["y"] = (ti({"fl-rough-blue"}) .. {"it-banana"}) .. {"ac-bug", name="buggy"}

Modified: team_levelpacks/team_test_new_api/raoulT04_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT04_1.xml	2008-01-28 23:28:41 UTC (rev 1014)
+++ team_levelpacks/team_test_new_api/raoulT04_1.xml	2008-01-30 00:49:34 UTC (rev 1015)
@@ -40,6 +40,18 @@
 ti["Y"] = ti[" "] .. {"it-coin2"}
 ti["Z"] = ti[" "] .. {"it-coin4"}
 
+ti["x"] = ti[" "] .. {"it-coin1", value=6}
+ti["y"] = ti[" "] .. {"it-coin2", value=6}
+ti["z"] = ti[" "] .. {"it-coin4", value=6}
+
+ti["l"] = ti[" "] .. {"st-laser-e", name="la5"}
+ti["m"] = ti[" "] .. {"st-laser-e", name="la6"}
+ti["n"] = ti[" "] .. {"st-laser-e", name="la7"}
+
+ti["E"] = ti[" "] .. {"st_coinslot", name="csx", target="la5", action="onoff"}
+ti["F"] = ti[" "] .. {"st_coinslot", name="csy", target="la6", action="onoff"}
+ti["G"] = ti[" "] .. {"st_coinslot", name="csz", target="la7", action="onoff"}
+
 w, h = wo(ti, " ", {
 "0      A     RL     ",
 "       B     SM     ",
@@ -50,9 +62,9 @@
 "     YYYYYYYYYY     ",
 "          ZZZZZZZZZZ",
 "                    ",
-"                    ",
-"                    ",
-"                    ",
+" xyz     El         ",
+" yzx     Fm         ",
+" zxy     Gn         ",
 "                    "
 })
 



From raoul at mail.berlios.de  Wed Jan 30 01:51:19 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Wed, 30 Jan 2008 01:51:19 +0100
Subject: [Enigma-game-svn] r1016 - in trunk: data src src/stones
Message-ID: <200801300051.m0U0pJIM000267@sheep.berlios.de>

Author: raoul
Date: 2008-01-30 01:51:18 +0100 (Wed, 30 Jan 2008)
New Revision: 1016

Added:
   trunk/src/stones/CoinSlot.cc
   trunk/src/stones/CoinSlot.hh
Modified:
   trunk/data/init.lua
   trunk/src/Makefile.am
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/st_switches.cc
   trunk/src/stones.hh
   trunk/src/stones/ClusterStone.cc
   trunk/src/stones/FloppySwitch.cc
   trunk/src/stones/FloppySwitch.hh
   trunk/src/stones/KeySwitch.cc
   trunk/src/stones/KeySwitch.hh
Log:
Trunk 1.1: Reengineering CoinSlot



Modified: trunk/data/init.lua
===================================================================
--- trunk/data/init.lua	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/data/init.lua	2008-01-30 00:51:18 UTC (rev 1016)
@@ -55,6 +55,7 @@
     st_boulder_e = "st-bolder-e",
     st_boulder_s = "st-bolder-s",
     st_boulder_w = "st-bolder-w",
+    st_coinslot = "st-coinslot",
     st_floppy = "st-floppy",
     st_fourswitch = "st-fourswitch",
     st_oxyd = "st-oxyd",

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/Makefile.am	2008-01-30 00:51:18 UTC (rev 1016)
@@ -192,11 +192,13 @@
 	stones/BoulderStone.cc	\
 	stones/BoulderStone.hh	\
 	stones/ClusterStone.cc	\
-	sotnes/ClusterStone.hh	\
+	stones/ClusterStone.hh	\
+	stones/CoinSlot.cc	\
+	stones/CoinSlot.hh	\
 	stones/ConnectiveStone.cc	\
 	stones/ConnectiveStone.hh	\
+	stones/FloppySwitch.cc   \
 	stones/FloppySwitch.hh   \
-	stones/FloppySwitch.cc   \
 	stones/FourSwitch.cc	\
 	stones/FourSwitch.hh	\
 	stones/KeySwitch.cc	\

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/ox_extra.cc	2008-01-30 00:51:18 UTC (rev 1016)
@@ -222,7 +222,7 @@
     UNUSED,              // OxydExtra stone 0x61
     UNUSED,              // OxydExtra stone 0x62
     UNUSED,              // OxydExtra stone 0x63
-    "st-coinslot",       // OxydExtra stone 0x64
+    "st_coinslot",       // OxydExtra stone 0x64
     "st-thief",          // OxydExtra stone 0x65
     "st-shogun-s",       // OxydExtra stone 0x66
     UNUSED,              // OxydExtra stone 0x67

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/ox_magnum.cc	2008-01-30 00:51:18 UTC (rev 1016)
@@ -228,7 +228,7 @@
     UNUSED,                     // OxydMagnum stone 0x67
     "st-bombs",                 // OxydMagnum stone 0x68 (common was 'st-shogun-l')
     "st-flash",                 // OxydMagnum stone 0x69
-    "st-coinslot",              // OxydMagnum stone 0x6a
+    "st_coinslot",              // OxydMagnum stone 0x6a
     "st-thief",                 // OxydMagnum stone 0x6b
     "st-shogun-s",              // OxydMagnum stone 0x6c
     "st-stoneimpulse",          // OxydMagnum stone 0x6d

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/ox_oxyd1.cc	2008-01-30 00:51:18 UTC (rev 1016)
@@ -258,7 +258,7 @@
     "st-disco-light",           // Oxyd1 stone 0x67
     "st-bombs",                 // Oxyd1 stone 0x68
     "st-flash",                 // Oxyd1 stone 0x69
-    "st-coinslot",              // Oxyd1 stone 0x6a
+    "st_coinslot",              // Oxyd1 stone 0x6a
     "st-thief",                 // Oxyd1 stone 0x6b
     "st-shogun-s",              // Oxyd1 stone 0x6c
     "st-stoneimpulse",          // Oxyd1 stone 0x6d

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/ox_peroxyd.cc	2008-01-30 00:51:18 UTC (rev 1016)
@@ -294,7 +294,7 @@
     "st-disco-medium",          // PerOxyd stone 0x61
     "st-bombs",                 // PerOxyd stone 0x62
     "st-flash",                 // PerOxyd stone 0x63
-    "st-coinslot",              // PerOxyd stone 0x64
+    "st_coinslot",              // PerOxyd stone 0x64
     "st-thief",                 // PerOxyd stone 0x65
     "st-shogun-s",              // PerOxyd stone 0x66
     "st-shogun-m",              // PerOxyd stone 0x67

Modified: trunk/src/st_switches.cc
===================================================================
--- trunk/src/st_switches.cc	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/st_switches.cc	2008-01-30 00:51:18 UTC (rev 1016)
@@ -23,7 +23,6 @@
 #include "player.hh"
 #include "server.hh"
 #include "Inventory.hh"
-
 #include "stones_internal.hh"
 
 using namespace std;
@@ -31,104 +30,6 @@
 namespace enigma {
 
 
-/* -------------------- Coin slot -------------------- */
-
-namespace
-{
-    class CoinSlot : public OnOffStone, public TimeHandler {
-        CLONEOBJ(CoinSlot);
-    public:
-        CoinSlot();
-        ~CoinSlot();
-
-    private:
-        // Variables.
-        enum State { ACTIVE, INACTIVE } state;
-        double remaining_time;
-
-        // GridObject interface
-        void init_model();
-        void animcb();
-
-        // TimeHandler interface
-        void tick(double dtime);
-
-        // Stone interface
-        void actor_hit(const StoneContact &sc);
-        const char *collision_sound() { return "metal"; }
-
-        // Private methods.
-        void change_state(State newstate);
-    };
-}
-
-CoinSlot::CoinSlot()
-: OnOffStone("st-coinslot"), state(INACTIVE), remaining_time(0)
-{
-}
-
-CoinSlot::~CoinSlot() {
-    GameTimer.remove_alarm (this);
-}
-
-
-void CoinSlot::init_model() {
-    set_model(state==ACTIVE ? "st-coinslot-active" : "st-coinslot");
-}
-
-
-void CoinSlot::change_state(State newstate) {
-    if (state == newstate) return;
-
-    switch (newstate) {
-    case ACTIVE:
-        performAction(true);
-        GameTimer.activate(this);
-        break;
-    case INACTIVE:
-        performAction(false);
-        GameTimer.deactivate(this);
-        sound_event ("coinslotoff");
-        break;
-    }
-    state = newstate;
-    init_model();
-}
-
-void CoinSlot::animcb() {
-    change_state(ACTIVE);
-    init_model();
-}
-
-void CoinSlot::tick(double dtime)
-{
-    ASSERT(remaining_time > 0, XLevelRuntime, "CoinSlot: tick called, but no remaining time");
-
-    remaining_time -= dtime;
-    if (remaining_time <= 0)
-        change_state(INACTIVE);
-}
-
-void CoinSlot::actor_hit(const StoneContact &sc)
-{
-    if (enigma::Inventory *inv = player::GetInventory(sc.actor)) {
-        if (Item *it = inv->get_item (0)) {
-            ItemID id = get_id(it);
-            if (id == it_coin1 || id == it_coin2 || id == it_coin4) {
-                sound_event ("coinsloton");
-                set_anim("st-coin2slot");
-
-                double coin_value = it->getAttr("value");
-                remaining_time += coin_value;
-
-                inv->yield_first();
-                player::RedrawInventory (inv);
-                delete it;
-            }
-        }
-    }
-}
-
 /* -------------------- Laser / Time switches -------------------- */
 
 namespace
@@ -332,14 +233,10 @@
 void TimeSwitch::notify_laseron()  {} // ignore laser
 void TimeSwitch::notify_laseroff() {}
 
-
-
-
 /* -------------------- Functions -------------------- */
 
 void InitSwitches()
 {
-    Register (new CoinSlot);
     Register (new LaserSwitch);
     Register (new LaserTimeSwitch);
     Register (new TimeSwitch);

Modified: trunk/src/stones/ClusterStone.cc
===================================================================
--- trunk/src/stones/ClusterStone.cc	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/stones/ClusterStone.cc	2008-01-30 00:51:18 UTC (rev 1016)
@@ -82,7 +82,7 @@
                         neighbour->set_attrib("$connections", neighbour->getConnections() & (ALL_DIRECTIONS ^ to_bits(reverse(d))));
                 }
             } else if (myCluster) { // no neighbour -> no connection
-                set_attrib("$connections", getConnections() & (ALL_DIRECTIONS ^ to_bits(d))); // clear connection                
+                set_attrib("$connections", getConnections() & (ALL_DIRECTIONS ^ to_bits(d))); // clear connection
             }
         }
     }

Added: trunk/src/stones/CoinSlot.cc
===================================================================
--- trunk/src/stones/CoinSlot.cc	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/stones/CoinSlot.cc	2008-01-30 00:51:18 UTC (rev 1016)
@@ -0,0 +1,127 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2007,2008 Ronald Lamprecht
+ * Copyright (C) 2008 Raoul Bourquin
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/CoinSlot.hh"
+#include "server.hh"
+#include "Inventory.hh"
+#include "player.hh"
+#include "errors.hh"
+
+namespace enigma {
+    CoinSlot::CoinSlot() : Stone () {
+        state = OFF;
+        remaining_time = 0;
+    }
+
+    CoinSlot::~CoinSlot() {
+        GameTimer.remove_alarm (this);
+    }
+
+    int CoinSlot::externalState() const {
+        return state % 2; // 0 for OFF, TURNON, 1 for ON
+    }
+
+    void CoinSlot::setState(int extState) {
+        if (isDisplayable()) {
+            if (extState == 0)
+                setIState(OFF);
+            else if (extState == 1)
+                setIState(ON);
+        } else
+            state = extState;
+    }
+
+    void CoinSlot::init_model() {
+        set_model(state==ON ? "st-coinslot-active" : "st-coinslot");
+    }
+
+    void CoinSlot::animcb() {
+        setIState(ON);
+    }
+
+    void CoinSlot::actor_hit(const StoneContact &sc) {
+        if (enigma::Inventory *inv = player::GetInventory(sc.actor)) {
+            if (Item *it = inv->get_item (0)) {
+                ItemID id = get_id(it);
+                if (id == it_coin1 || id == it_coin2 || id == it_coin4) {
+                    double coin_value = it->getAttr("value");
+                    remaining_time += coin_value;
+                    inv->yield_first();
+                    player::RedrawInventory (inv);
+                    delete it;
+                    setIState(TURNON);
+                }
+            }
+        }
+    }
+
+    const char *CoinSlot::collision_sound() {
+         return "metal";
+    }
+
+    void CoinSlot::tick(double dtime) {
+        ASSERT(remaining_time > 0, XLevelRuntime, "CoinSlot: tick called, but no remaining time");
+
+        remaining_time -= dtime;
+        if (remaining_time <= 0)
+            setIState(OFF);
+    }
+
+    void CoinSlot::setIState(iState newIState) {
+        if (newIState == ON) {
+            if (state == TURNON) {
+                state = ON;
+                performAction(state == ON);
+                GameTimer.activate(this);
+            }
+            else if (state == ON) {
+                // state is already ON, this was just a "coin-supply"
+                // Do nothing but change the model
+            }
+            init_model();
+        }
+        else if (newIState == TURNON) {
+            if (state == OFF) {
+                state = TURNON;
+            }
+            else if (state == ON) {
+                // state is already ON, this was just a "coin-supply"
+                // Do nothing but play the anim
+            }
+            sound_event ("coinsloton");
+            set_anim("st-coin2slot");
+        }
+        else if (newIState == OFF) {
+            state = OFF;
+            performAction(state == ON);
+            GameTimer.deactivate(this);
+            sound_event ("coinslotoff");
+            init_model();
+        }
+    }
+
+    DEF_TRAITS(CoinSlot, "st_coinslot", st_coinslot);
+
+    BOOT_REGISTER_START
+        BootRegister(new CoinSlot(), "st_coinslot");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/CoinSlot.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/CoinSlot.hh
===================================================================
--- trunk/src/stones/CoinSlot.hh	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/stones/CoinSlot.hh	2008-01-30 00:51:18 UTC (rev 1016)
@@ -0,0 +1,70 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2007,2008 Ronald Lamprecht
+ * Copyright (C) 2008 Raoul Bourquin
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef COINSLOT_HH
+#define COINSLOT_HH
+
+#include "stones.hh"
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * A simple 2 state timeswitch that can be toggled only by inserting coins
+     * Each coin adds a certain time the switch stays on. The messages
+     * "toggle", "signal", "on", "off" and get/set of the state are fully supported.
+     * The switch starts per default in state OFF.<p>
+     */
+    // TODO: Fix bug when throw in a coin just before the remaining time ends.
+    class CoinSlot : public Stone, public TimeHandler {
+        CLONEOBJ(CoinSlot);
+        DECL_TRAITS;
+    private:
+        enum iState { OFF, ON, TURNON };
+        double remaining_time;
+
+    public:
+        CoinSlot();
+        ~CoinSlot();
+
+        // StateObject interface
+        virtual int externalState() const;
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+
+        // ModelCallback interface
+        virtual void animcb();
+
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+        virtual const char *collision_sound();
+
+        // TimeHandler interface
+        virtual void tick(double dtime);
+
+    private:
+        void setIState(iState newIState);
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/CoinSlot.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones/FloppySwitch.cc
===================================================================
--- trunk/src/stones/FloppySwitch.cc	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/stones/FloppySwitch.cc	2008-01-30 00:51:18 UTC (rev 1016)
@@ -1,6 +1,7 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2007 Ronald Lamprecht
+ * Copyright (C) 2007,2008 Ronald Lamprecht
+ * Copyright (C) 2008 Raoul Bourquin
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License

Modified: trunk/src/stones/FloppySwitch.hh
===================================================================
--- trunk/src/stones/FloppySwitch.hh	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/stones/FloppySwitch.hh	2008-01-30 00:51:18 UTC (rev 1016)
@@ -1,5 +1,7 @@
 /*
- * Copyright (C) 2007 Ronald Lamprecht
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2007,2008 Ronald Lamprecht
+ * Copyright (C) 2008 Raoul Bourquin
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License

Modified: trunk/src/stones/KeySwitch.cc
===================================================================
--- trunk/src/stones/KeySwitch.cc	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/stones/KeySwitch.cc	2008-01-30 00:51:18 UTC (rev 1016)
@@ -1,6 +1,7 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2007 Ronald Lamprecht
+ * Copyright (C) 2007,2008 Ronald Lamprecht
+ * Copyright (C) 2008 Raoul Bourquin
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License

Modified: trunk/src/stones/KeySwitch.hh
===================================================================
--- trunk/src/stones/KeySwitch.hh	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/stones/KeySwitch.hh	2008-01-30 00:51:18 UTC (rev 1016)
@@ -1,5 +1,7 @@
 /*
- * Copyright (C) 2007 Ronald Lamprecht
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2007,2008 Ronald Lamprecht
+ * Copyright (C) 2008 Raoul Bourquin
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-01-30 00:49:34 UTC (rev 1015)
+++ trunk/src/stones.hh	2008-01-30 00:51:18 UTC (rev 1016)
@@ -49,6 +49,7 @@
         st_chameleon,
         st_chess,
         st_coffee,
+        st_coinslot,
         st_death,
         st_death_invisible,
         st_easymode,



