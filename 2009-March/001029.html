<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1599 - in trunk: data data/levels/enigma_i	data/levels/enigma_ii data/levels/enigma_iv	data/levels/enigma_vi data/levels/enigma_vii	data/levels/enigma_viii data/levels/lib doc/reference
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2009-March/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1599%20-%20in%20trunk%3A%20data%20data/levels/enigma_i%0A%09data/levels/enigma_ii%20data/levels/enigma_iv%0A%09data/levels/enigma_vi%20data/levels/enigma_vii%0A%09data/levels/enigma_viii%20data/levels/lib%20doc/reference&In-Reply-To=%3C200903271811.n2RIBGt2020897%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001028.html">
   <LINK REL="Next"  HREF="001030.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1599 - in trunk: data data/levels/enigma_i	data/levels/enigma_ii data/levels/enigma_iv	data/levels/enigma_vi data/levels/enigma_vii	data/levels/enigma_viii data/levels/lib doc/reference</H1>
    <B>andreasl at mail.berlios.de</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1599%20-%20in%20trunk%3A%20data%20data/levels/enigma_i%0A%09data/levels/enigma_ii%20data/levels/enigma_iv%0A%09data/levels/enigma_vi%20data/levels/enigma_vii%0A%09data/levels/enigma_viii%20data/levels/lib%20doc/reference&In-Reply-To=%3C200903271811.n2RIBGt2020897%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1599 - in trunk: data data/levels/enigma_i	data/levels/enigma_ii data/levels/enigma_iv	data/levels/enigma_vi data/levels/enigma_vii	data/levels/enigma_viii data/levels/lib doc/reference">andreasl at mail.berlios.de
       </A><BR>
    <I>Fri Mar 27 19:11:16 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001028.html">[Enigma-game-svn] r1598 - team_levelpacks/team_test_new_api
</A></li>
        <LI>Next message: <A HREF="001030.html">[Enigma-game-svn] r1600 - in trunk/src: . stones
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1029">[ date ]</a>
              <a href="thread.html#1029">[ thread ]</a>
              <a href="subject.html#1029">[ subject ]</a>
              <a href="author.html#1029">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: andreasl
Date: 2009-03-27 19:10:57 +0100 (Fri, 27 Mar 2009)
New Revision: 1599

Modified:
   trunk/data/api2init.lua
   trunk/data/levels/enigma_i/andreas14_2.xml
   trunk/data/levels/enigma_ii/andreas10_2.xml
   trunk/data/levels/enigma_iv/andreas03_2.xml
   trunk/data/levels/enigma_iv/duffy73_3.xml
   trunk/data/levels/enigma_vi/ral13_2.xml
   trunk/data/levels/enigma_vii/andreas46_3.xml
   trunk/data/levels/enigma_viii/andreas48_2.xml
   trunk/data/levels/enigma_viii/andreas55_2.xml
   trunk/data/levels/enigma_viii/ral21_2.xml
   trunk/data/levels/enigma_viii/ral30_1.xml
   trunk/data/levels/enigma_viii/ral32_1.xml
   trunk/data/levels/enigma_viii/ral33_1.xml
   trunk/data/levels/enigma_viii/ral37_1.xml
   trunk/data/levels/enigma_viii/ral42_1.xml
   trunk/data/levels/lib/liblua.xml
   trunk/data/levels/lib/libmath.xml
   trunk/data/levels/lib/libmaze_2.xml
   trunk/data/levels/lib/libsoko.xml
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk:
 - Replace lib.lua.cond by global function cond (in api2init).
 - Add a small section &quot;Basic functions&quot; to chapter &quot;Libraries&quot;.
   This section gives a short overview over those Lua functions and
   libraries, which can or can't be used in Enigma, or differ from
   their original versions. &quot;cond&quot; is described in the only
   subsection of the &quot;Basic functions&quot;-section.


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/api2init.lua	2009-03-27 18:10:57 UTC (rev 1599)
@@ -336,6 +336,23 @@
     end
 )
 
+------------------------------
+-- Global utility functions --
+------------------------------
+
+-- A wrapper of &quot;if&quot; to resemble the ternary ?:-function.
+-- Note that this function evaluates both IFTRUE as well as IFFALSE, e.g.
+--     cond(t == 0, 1/t, error(&quot;Division by zero&quot;))
+-- will evaluate the error-function and thus halt for any T.
+-- Hence: Make sure there are no sideeffects in IFTRUE and IFFALSE!
+function cond(condition, iftrue, iffalse)
+    if condition then
+        return iftrue
+    else
+        return iffalse
+    end
+end
+
 ---------------
 -- Libraries --
 ---------------

Modified: trunk/data/levels/enigma_i/andreas14_2.xml
===================================================================
--- trunk/data/levels/enigma_i/andreas14_2.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_i/andreas14_2.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -3,12 +3,11 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;level&quot;&gt;
       &lt;el:identity el:title=&quot;Laser Arena&quot; el:subtitle=&quot;&quot; el:id=&quot;andreas14&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;2&quot; el:revision=&quot;4&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;2&quot; el:revision=&quot;5&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author  el:name=&quot;Andreas Lochmann&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2006, 2009 Andreas Lochmann&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
       &lt;el:compatibility el:enigma=&quot;1.1&quot;&gt;
-       &lt;el:dependency el:path=&quot;lib/liblua&quot; el:id=&quot;lib/liblua&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:comments&gt;
@@ -20,7 +19,7 @@
 wo[&quot;ConserveLevel&quot;] = false
 wo[&quot;AllowSingleOxyds&quot;] = true
 
-number_lasers = lib.lua.cond(wo[&quot;IsDifficult&quot;], 5, 3)
+number_lasers = cond(wo[&quot;IsDifficult&quot;], 5, 3)
 
 ti[&quot; &quot;] = {&quot;fl_sand&quot;}
 ti[&quot;#&quot;] = {&quot;st_fake_oxyda&quot;}
@@ -66,16 +65,16 @@
 wo[border_north:sub(2)] = ti[&quot;O&quot;]
 wo[border_south[1]] = ti[&quot;O&quot;]
 if border_south[1].x == border_north[1].x then
-  wo[border_south[2]] = ti[&quot;O&quot;]
+    wo[border_south[2]] = ti[&quot;O&quot;]
 else
-  wo[po(border_north[1].x, border_south[1].y)] = ti[&quot;O&quot;]
+    wo[po(border_north[1].x, border_south[1].y)] = ti[&quot;O&quot;]
 end
 wo[border_west:sub(2)] = ti[&quot;O&quot;]
 wo[border_east[1]] = ti[&quot;O&quot;]
 if border_east[1].y == border_west[1].y then
-  wo[border_east[2]] = ti[&quot;O&quot;]
+    wo[border_east[2]] = ti[&quot;O&quot;]
 else
-  wo[po(border_east[1].x, border_west[1].y)] = ti[&quot;O&quot;]
+    wo[po(border_east[1].x, border_west[1].y)] = ti[&quot;O&quot;]
 end
 
 wo:shuffleOxyd()
@@ -88,20 +87,20 @@
 laser_pos = free_border - grp(fl(mx, 0), fl(mx, h-1), fl(0, my), fl(w-1, my))
 laser_pos = (laser_pos:shuffle()):sub(number_lasers)
 for i = 1, #laser_pos do
-  wo[laser_pos[i]] = ti[fl(laser_pos[i])._laser]
+    wo[laser_pos[i]] = ti[fl(laser_pos[i])._laser]
 end
 
 -- Move lasers on timer call:
 function timer_callback()
-  wo[laser_pos - oxyds] = ti[&quot;#&quot;]
-  local new_pos = grp()
-  for floor in laser_pos do
-    new_pos = new_pos + fl(floor + floor._dir)
-  end
-  laser_pos = new_pos
-  for floor in laser_pos - oxyds do
-    wo[floor] = ti[floor._laser]
-  end
+    wo[laser_pos - oxyds] = ti[&quot;#&quot;]
+    local new_pos = grp()
+    for floor in laser_pos do
+        new_pos = new_pos + fl(floor + floor._dir)
+    end
+    laser_pos = new_pos
+    for floor in laser_pos - oxyds do
+        wo[floor] = ti[floor._laser]
+    end
 end
 
     ]]&gt;&lt;/el:luamain&gt;

Modified: trunk/data/levels/enigma_ii/andreas10_2.xml
===================================================================
--- trunk/data/levels/enigma_ii/andreas10_2.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_ii/andreas10_2.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -3,12 +3,11 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;level&quot;&gt;
       &lt;el:identity el:title=&quot;Moure-Switches&quot; el:subtitle=&quot;&quot; el:id=&quot;andreas10&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;2&quot; el:revision=&quot;4&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;2&quot; el:revision=&quot;5&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author  el:name=&quot;Andreas Lochmann&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2005, 2009 Andreas Lochmann&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
       &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
-        &lt;el:dependency el:path=&quot;lib/liblua&quot; el:id=&quot;lib/liblua&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:comments&gt;
@@ -53,14 +52,14 @@
 mainoxyd = (no[&quot;oxyd#*&quot;])[1]
 
 if not wo[&quot;IsDifficult&quot;] then
-  wo[{3,6}] = {&quot;it_pin&quot;}
+    wo[{3,6}] = {&quot;it_pin&quot;}
 end
 
 -- First and second hint
 
 wo[{16,6}] = {&quot;it_document&quot;, text = &quot;text1&quot;}
 function timer_hint(is_on, sender)
-  wo[{16,6}] = {&quot;it_document&quot;, text = &quot;text2&quot;}
+    wo[{16,6}] = {&quot;it_document&quot;, text = &quot;text2&quot;}
 end
 
 -- Fourswitch callback
@@ -82,7 +81,7 @@
 -- Switch callback
 
 function switch_callback(is_on, sender)
-    wo[{sender.x, 12 - sender.y}] = ti[lib.lua.cond(sender.y == 5, &quot;H&quot;, &quot;G&quot;)]
+    wo[{sender.x, 12 - sender.y}] = ti[cond(sender.y == 5, &quot;H&quot;, &quot;G&quot;)]
     sender:kill()
     mainoxyd:closeall()
     mainoxyd:shuffle()

Modified: trunk/data/levels/enigma_iv/andreas03_2.xml
===================================================================
--- trunk/data/levels/enigma_iv/andreas03_2.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_iv/andreas03_2.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -3,12 +3,11 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;level&quot;&gt;
       &lt;el:identity el:title=&quot;How solid?&quot; el:subtitle=&quot;&quot; el:id=&quot;andreas03&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;2&quot; el:revision=&quot;3&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;2&quot; el:revision=&quot;4&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author  el:name=&quot;Andreas Lochmann&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2005, 2009 Andreas Lochmann&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
       &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
-        &lt;el:dependency el:path=&quot;lib/liblua&quot; el:id=&quot;lib/liblua&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:comments&gt;
@@ -38,8 +37,7 @@
 ti[&quot;@&quot;] = {&quot;#ac_marble&quot;, adhesion = 1}
 ti[&quot;O&quot;] = {&quot;st_oxyd&quot;, flavor = &quot;a&quot;, oxydcolor = OXYD_PURPLE}
 ti[&quot;D&quot;] = {&quot;it_document&quot;, text = &quot;text2&quot;}
-ti[&quot;T&quot;] = {&quot;st_timer&quot;, &quot;timer&quot;, target = &quot;callback_timer&quot;, state = OFF,
-           interval = lib.lua.cond(wo[&quot;IsDifficult&quot;], 1.0, 1.2)}
+ti[&quot;T&quot;] = {&quot;st_timer&quot;, &quot;timer&quot;, target = &quot;callback_timer&quot;, state = OFF, interval = cond(wo[&quot;IsDifficult&quot;], 1.0, 1.2)}
 ti[&quot;C&quot;] = {&quot;st_fourswitch&quot;, &quot;clock&quot;}
 ti[&quot;S&quot;] = {&quot;st_switch&quot;, target = &quot;counter&quot;, action = &quot;signal&quot;}
 

Modified: trunk/data/levels/enigma_iv/duffy73_3.xml
===================================================================
--- trunk/data/levels/enigma_iv/duffy73_3.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_iv/duffy73_3.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -3,12 +3,11 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;level&quot;&gt;
       &lt;el:identity el:title=&quot;Bizarro World&quot; el:subtitle=&quot;&quot; el:id=&quot;duffy73&quot;/&gt;
-      &lt;el:version el:score=&quot;2&quot; el:release=&quot;3&quot; el:revision=&quot;21&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;2&quot; el:release=&quot;3&quot; el:revision=&quot;22&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author  el:name=&quot;Jacob Scott&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2003 Jacob Scott&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
       &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
-        &lt;el:dependency el:path=&quot;lib/liblua&quot; el:id=&quot;lib/liblua&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:comments&gt;
@@ -213,7 +212,7 @@
 
 switch_count= 0
 function whiteswitch(value, sender)
-    switch_count = switch_count + lib.lua.cond(value, 1, -1)
+    switch_count = switch_count + cond(value, 1, -1)
     if switch_count == 4 then
         wo[no[&quot;whitegate&quot;]] = {&quot;st_greenbrown_hollow&quot;, &quot;whitegate&quot;}
     elseif switch_count == 3 then

Modified: trunk/data/levels/enigma_vi/ral13_2.xml
===================================================================
--- trunk/data/levels/enigma_vi/ral13_2.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_vi/ral13_2.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -8,7 +8,6 @@
       &lt;el:copyright&gt;Copyright &#169; 2006,2009 Ronald Lamprecht&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
       &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
-        &lt;el:dependency el:path=&quot;lib/liblua&quot; el:id=&quot;lib/liblua&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:comments&gt;
@@ -50,8 +49,8 @@
     &quot;####X##########X####&quot;
 })
 
-rb_length = lib.lua.cond(wo[&quot;IsDifficult&quot;], 3.5, 3.0)
-rb_max = lib.lua.cond(wo[&quot;IsDifficult&quot;], 4.5, 4.0)
+rb_length = cond(wo[&quot;IsDifficult&quot;], 3.5, 3.0)
+rb_max = cond(wo[&quot;IsDifficult&quot;], 4.5, 4.0)
 for horse in no[&quot;horse%*&quot;] do
     wo:add({&quot;ot_rubberband&quot;, anchor1=&quot;acBlack&quot;, anchor2=horse, strength=200, length=rb_length, threshold=1, max=rb_max})
 end

Modified: trunk/data/levels/enigma_vii/andreas46_3.xml
===================================================================
--- trunk/data/levels/enigma_vii/andreas46_3.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_vii/andreas46_3.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -3,13 +3,12 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;level&quot;&gt;
       &lt;el:identity el:title=&quot;Tinker, Tailor&quot; el:subtitle=&quot;&quot; el:id=&quot;andreas46&quot;/&gt;
-      &lt;el:version el:score=&quot;2&quot; el:release=&quot;4&quot; el:revision=&quot;11&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;2&quot; el:release=&quot;4&quot; el:revision=&quot;12&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author el:name=&quot;Andreas Lochmann&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2007 Andreas Lochmann&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
       &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
         &lt;el:dependency el:path=&quot;lib/libmath&quot; el:id=&quot;lib/libmath&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
-        &lt;el:dependency el:path=&quot;lib/liblua&quot; el:id=&quot;lib/liblua&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:score el:easy=&quot;2:18&quot; el:difficult=&quot;5:10&quot;/&gt;
@@ -74,7 +73,7 @@
 function connect(obj1, obj2, restrict)
   wo:add({&quot;ot_rubberband&quot;, anchor1 = obj1, anchor2 = obj2,
           strength = strength or maxstrength,
-          max = lib.lua.cond(restrict and wo[&quot;IsDifficult&quot;], 2.5, nil)})
+          max = cond(restrict and wo[&quot;IsDifficult&quot;], 2.5, nil)})
   -- Save partner of actor: When call_scissors is called, the
   -- rubberband will've already been removed, so [&quot;fellows&quot;]
   -- doesn't work anymore for the marble.

Modified: trunk/data/levels/enigma_viii/andreas48_2.xml
===================================================================
--- trunk/data/levels/enigma_viii/andreas48_2.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_viii/andreas48_2.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -3,7 +3,7 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;level&quot;&gt;
       &lt;el:identity el:title=&quot;Styles Change&quot; el:subtitle=&quot;But dynamite is forever&quot; el:id=&quot;andreas48&quot;/&gt;
-      &lt;el:version el:score=&quot;2&quot; el:release=&quot;2&quot; el:revision=&quot;18&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;2&quot; el:release=&quot;2&quot; el:revision=&quot;19&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author el:name=&quot;Andreas Lochmann&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2008 Andreas Lochmann&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
@@ -210,8 +210,8 @@
   for y = 0, height - 1 do
     for x = 0, width - 1 do
       local pos = 2*po({x, y}) + offset
-      local east = lib.lua.cond(maze:can_go_east(x,y), &quot;.&quot;, &quot;*&quot;)
-      local south = lib.lua.cond(maze:can_go_south(x,y), &quot;.&quot;, &quot;*&quot;)
+      local east = cond(maze:can_go_east(x,y), &quot;.&quot;, &quot;*&quot;)
+      local south = cond(maze:can_go_south(x,y), &quot;.&quot;, &quot;*&quot;)
       replace_key_in_map(j, &quot; &quot;, east,  pos + {1,0})
       replace_key_in_map(j, &quot; &quot;, south, pos + {0,1})
       replace_key_in_map(j, &quot; &quot;, &quot;#&quot;,   pos + {1,1})
@@ -371,8 +371,7 @@
 for y = 1, #maze_maps[6] do
   number_field[y] = &quot;&quot;
   for x = 1, string.len(maze_maps[6][y]) do
-    number_field[y] = number_field[y]
-      .. lib.lua.cond(math.floor(x/5)%2 == math.floor(y/5)%2, final_spot_1, final_spot_2)
+    number_field[y] = number_field[y] .. cond(math.floor(x/5)%2 == math.floor(y/5)%2, final_spot_1, final_spot_2)
   end
 end
 maze_maps[6] = maze_maps[6] * wo:newMap(&quot; &quot;, number_field)
@@ -435,8 +434,8 @@
 
 key_sum = 0
 function key_call(is_on, sender)
-  key_sum = key_sum + lib.lua.cond(is_on == ON, 1, -1)
-  no[&quot;keydoor5&quot;]:message(lib.lua.cond(key_sum == 2, &quot;open&quot;, &quot;close&quot;))
+  key_sum = key_sum + cond(is_on == ON, 1, -1)
+  no[&quot;keydoor5&quot;]:message(cond(key_sum == 2, &quot;open&quot;, &quot;close&quot;))
 end
 
  ]]&gt;&lt;/el:luamain&gt;

Modified: trunk/data/levels/enigma_viii/andreas55_2.xml
===================================================================
--- trunk/data/levels/enigma_viii/andreas55_2.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_viii/andreas55_2.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -3,12 +3,11 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;level&quot;&gt;
       &lt;el:identity el:title=&quot;Sokopal&quot; el:subtitle=&quot;&quot; el:id=&quot;andreas55&quot;/&gt;
-      &lt;el:version el:score=&quot;2&quot; el:release=&quot;2&quot; el:revision=&quot;6&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;2&quot; el:release=&quot;2&quot; el:revision=&quot;7&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author el:name=&quot;Andreas Lochmann, Ronald Lamprecht&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2008, 2009 Andreas Lochmann&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
       &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
-        &lt;el:dependency el:path=&quot;lib/liblua&quot; el:id=&quot;lib/liblua&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:score el:easy=&quot;22:50&quot; el:difficult=&quot;34:16&quot;/&gt;
@@ -76,7 +75,7 @@
 local spots = no[&quot;spot#*&quot;]:shuffle()
 
 -- Number of oxyds depends on difficulty:
-local numoxyds = lib.lua.cond(wo[&quot;IsDifficult&quot;], 40, 30)
+local numoxyds = cond(wo[&quot;IsDifficult&quot;], 40, 30)
 for j = 1, 5 do
   wo[spots:sub(1 + (j-1) * numoxyds, -numoxyds)] = ti[&quot;o&quot;..j]
 end

Modified: trunk/data/levels/enigma_viii/ral21_2.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral21_2.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_viii/ral21_2.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -382,7 +382,7 @@
         if key == &quot;o9&quot; then
             return ti[&quot;O&quot;..oxyd_colors[holy_idx]]
         elseif key == &quot;of&quot; then
-            local idx = lib.lua.cond(fake_idx == holy_idx, fake_idx + 1, fake_idx)
+            local idx = cond(fake_idx == holy_idx, fake_idx + 1, fake_idx)
             fake_idx = idx + 1
             return ti[&quot;O&quot;..oxyd_colors[idx]]
         elseif key:sub(1,1) == &quot;o&quot; then
@@ -390,7 +390,7 @@
             return ti[&quot;O&quot;..oxyd_colors[idx]]
         elseif key:sub(1,1) == &quot;r&quot; then
             local idx = 0 + key:sub(2,2)
-            return lib.lua.cond(idx == holy_idx, ti[&quot;R6&quot;], ti[&quot;R1&quot;])
+            return cond(idx == holy_idx, ti[&quot;R6&quot;], ti[&quot;R1&quot;])
         end
     else
         if key == &quot;o9&quot; then
@@ -580,7 +580,7 @@
 
 trigger_count = 0
 function volcano(value, sender)
-    trigger_count = trigger_count + lib.lua.cond(value, 1, -1)
+    trigger_count = trigger_count + cond(value, 1, -1)
     st(sender + {0, -1}):toggle()
     
     if (trigger_count == 6) then
@@ -624,8 +624,8 @@
 
 switch_count= 0
 function illumination(value, sender)
-    switch_count = switch_count + lib.lua.cond(value, 1, -1)
-    no[&quot;door5#*&quot;]:message(lib.lua.cond(switch_count == 4, &quot;open&quot;, &quot;close&quot;))
+    switch_count = switch_count + cond(value, 1, -1)
+    no[&quot;door5#*&quot;]:message(cond(switch_count == 4, &quot;open&quot;, &quot;close&quot;))
 end
 
 function open_grave(value, sender)

Modified: trunk/data/levels/enigma_viii/ral30_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral30_1.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_viii/ral30_1.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -99,8 +99,8 @@
                 wirename = &quot;wire&quot;..pearls[pearl]..&quot;_&quot;..pearls[pearl_right]
                 if pearl_right == pearls[(pearls[pearl] % #pearls) + 1] and not -no[wirename] then
                     wo:add({&quot;ot_wire&quot;, wirename, anchor1=pearl, anchor2=pearl_right})
-                    pearl[&quot;_wires&quot;] = lib.lua.cond(pearl[&quot;_wires&quot;] == 1, 2, 1)
-                    pearl_right[&quot;_wires&quot;] = lib.lua.cond(pearl_right[&quot;_wires&quot;] == 1, 2, 1)
+                    pearl[&quot;_wires&quot;] = cond(pearl[&quot;_wires&quot;] == 1, 2, 1)
+                    pearl_right[&quot;_wires&quot;] = cond(pearl_right[&quot;_wires&quot;] == 1, 2, 1)
                 end
                 wires = pearl[&quot;wires&quot;]
                 if pearl[&quot;_wires&quot;] == 2 then

Modified: trunk/data/levels/enigma_viii/ral32_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral32_1.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_viii/ral32_1.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -65,7 +65,7 @@
     sum = 0
     for i = 2, 15 do
         for j = 1, i do
-            sum = sum + lib.lua.cond(p[j] &gt; p[i], 1, 0)
+            sum = sum + cond(p[j] &gt; p[i], 1, 0)
         end
     end
     return sum % 2

Modified: trunk/data/levels/enigma_viii/ral33_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral33_1.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_viii/ral33_1.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -76,7 +76,7 @@
     sum = 0
     for i = 2, 15 do
         for j = 1, i do
-            sum = sum + lib.lua.cond(p[j] &gt; p[i], 1, 0)
+            sum = sum + cond(p[j] &gt; p[i], 1, 0)
         end
     end
     return sum % 2

Modified: trunk/data/levels/enigma_viii/ral37_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral37_1.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_viii/ral37_1.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -8,7 +8,6 @@
       &lt;el:copyright&gt;Copyright &#169; 2008 Ronald Lamprecht&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
       &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
-        &lt;el:dependency el:path=&quot;lib/liblua&quot; el:id=&quot;lib/liblua&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:score el:easy=&quot;17:51&quot; el:difficult=&quot;13:23&quot;/&gt;
@@ -16,7 +15,7 @@
     &lt;el:luamain&gt;&lt;![CDATA[
 
 wo[&quot;ConserveLevel&quot;] = true
-wo[&quot;MaxOxydColor&quot;] = lib.lua.cond(wo[&quot;IsDifficult&quot;], OXYD_BROWN, OXYD_ORANGE)
+wo[&quot;MaxOxydColor&quot;] = cond(wo[&quot;IsDifficult&quot;], OXYD_BROWN, OXYD_ORANGE)
 wo[&quot;AllowSingleOxyds&quot;] = true
 
 ti[&quot; &quot;] = {&quot;fl_wood_framed&quot;}

Modified: trunk/data/levels/enigma_viii/ral42_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral42_1.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/enigma_viii/ral42_1.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -8,7 +8,6 @@
       &lt;el:copyright&gt;Copyright &#169; 2008 Ronald Lamprecht&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
       &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
-        &lt;el:dependency el:path=&quot;lib/liblua&quot; el:id=&quot;lib/liblua&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:comments&gt;
@@ -60,7 +59,7 @@
 
 pressed = 0
 function check(value, sender)
-    pressed = pressed + lib.lua.cond(value, 1, -1)
+    pressed = pressed + cond(value, 1, -1)
     if pressed == 12 then
         no[&quot;d#*&quot;]:open()
     else

Modified: trunk/data/levels/lib/liblua.xml
===================================================================
--- trunk/data/levels/lib/liblua.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/lib/liblua.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -3,7 +3,7 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;library&quot;&gt;
       &lt;el:identity el:title=&quot;&quot; el:id=&quot;lib/liblua&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;5&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;6&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author  el:name=&quot;Enigma Team&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2007, 2008 Enigma Team&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
@@ -17,9 +17,10 @@
     &lt;el:luamain&gt;&lt;![CDATA[
 
 ---------------------------------------------------------------------
--- liblib.lua holds some general utilities for working with Lua.
--- It includes functions for deep-copying tables, combining tables,
--- and shuffling tables and a conditional function.
+-- liblua holds some general utilities for working with Lua.
+-- It includes functions for work with tables (deep-copy, combine,
+-- shuffle, print tables), a modulo wrapper and general debugging
+-- functions (currently only to_string).
 ---------------------------------------------------------------------
 --
 -- liblua provides the following functions:
@@ -27,8 +28,8 @@
 --   lib.lua.combine_tables(arg1, ...)
 --   lib.lua.shuffle(t)
 --   lib.lua.print_table(t, prefix, depth)
+--   lib.lua.to_string(thing)
 --   lib.lua.mod(value, modul)
---   lib.lua.cond(condition, iftrue, iffalse)
 --
 
 lib.lua = {}
@@ -141,7 +142,7 @@
     elseif type(value) == &quot;string&quot; then
       print((prefix or &quot;&quot;) .. &quot;|&quot; .. key_s .. &quot; = \&quot;&quot; .. value .. &quot;\&quot;&quot;)
     elseif type(value) == &quot;boolean&quot; then
-      print((prefix or &quot;&quot;) .. &quot;|&quot; .. key_s .. &quot; = &quot; .. lib.lua.cond(value, &quot;true&quot;, &quot;false&quot;))
+      print((prefix or &quot;&quot;) .. &quot;|&quot; .. key_s .. &quot; = &quot; .. cond(value, &quot;true&quot;, &quot;false&quot;))
     elseif type(value) == &quot;table&quot; then
       if (depth or 0) &lt; 5 then
         print((prefix or &quot;&quot;) .. &quot;|&quot; .. key_s .. &quot; = |&quot;)
@@ -184,7 +185,7 @@
   elseif (t == &quot;number&quot;) then
     result = &quot;number: &quot; .. thing
   elseif (t == &quot;boolean&quot;) then
-    result = &quot;boolean: &quot; .. lib.lua.cond(thing, &quot;true&quot;, &quot;false&quot;)
+    result = &quot;boolean: &quot; .. cond(thing, &quot;true&quot;, &quot;false&quot;)
   elseif (t == &quot;table&quot;) then
     result = &quot;table&quot;
     if thing.type then
@@ -251,19 +252,6 @@
   end
 end
 
--- A wrapper of &quot;if&quot; to resemble the ternary ?:-function.
--- Note that this function evaluates both IFTRUE as well as IFFALSE, e.g.
---   lib.lua.cond(t == 0, 1/t, error(&quot;Division by zero&quot;))
--- will evaluate the error-function and thus halt for any T.
--- Hence: Make sure there are no sideeffects in IFTRUE and IFFALSE!
-function lib.lua.cond(condition, iftrue, iffalse)
-  if condition then
-    return iftrue
-  else
-    return iffalse
-  end
-end
-
     ]]&gt;&lt;/el:luamain&gt;
     &lt;el:i18n&gt;
     &lt;/el:i18n&gt;

Modified: trunk/data/levels/lib/libmath.xml
===================================================================
--- trunk/data/levels/lib/libmath.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/lib/libmath.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -3,7 +3,7 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;library&quot;&gt;
       &lt;el:identity el:title=&quot;&quot; el:id=&quot;lib/libmath&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;4&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;5&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author  el:name=&quot;Enigma Team&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2007, 2008 Enigma Team&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
@@ -30,9 +30,9 @@
 --   lib.math.permutation(n)
 --   lib.math.cyclic_permutation(n)  
 --   lib.math.random_vector(number, ...)
--- Additional mathematically relevant functions are part of liblua:
+-- Additional mathematically relevant functions are part of liblua and api2init:
 --   lib.lua.mod(value, modul)
---   lib.lua.cond(condition, iftrue, iffalse)
+--   cond(condition, iftrue, iffalse)
 --
 -- libmath depends on liblua, as lib.math.combinations makes
 -- use of lib.lua.deep_copy.

Modified: trunk/data/levels/lib/libmaze_2.xml
===================================================================
--- trunk/data/levels/lib/libmaze_2.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/lib/libmaze_2.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -3,7 +3,7 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;library&quot;&gt;
       &lt;el:identity el:title=&quot;&quot; el:id=&quot;lib/libmaze&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;2&quot; el:revision=&quot;5&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;2&quot; el:revision=&quot;6&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author  el:name=&quot;Ronald Lamprecht&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2009 Ronald Lamprecht&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
@@ -155,8 +155,8 @@
                   local i,j = maze:decode(maze[cell])
                   local xo = i * (maze.kernel[1] + maze.spacing[1])
                   local yo = j * (maze.kernel[2] + maze.spacing[2])
-                  xo = xo + maze.offset_x[1] * lib.lua.cond(maze.offset_x[2], j%2, j)
-                  yo = yo + maze.offset_y[1] * lib.lua.cond(maze.offset_y[2], i%2, i)
+                  xo = xo + maze.offset_x[1] * cond(maze.offset_x[2], j%2, j)
+                  yo = yo + maze.offset_y[1] * cond(maze.offset_y[2], i%2, i)
                   return maze.anchor + {xo, yo}
               end
         }
@@ -289,8 +289,8 @@
         -- offsets not yet supported!
         for k,v in pairs(maze.area_positioncodes) do
             local x,y = maze:decode(v)
-            minx = lib.lua.cond(x &lt; minx, x, minx)
-            miny = lib.lua.cond(y &lt; miny, y, miny)
+            minx = cond(x &lt; minx, x, minx)
+            miny = cond(y &lt; miny, y, miny)
         end
         maze.anchor = po(minx, miny)
         local cellx = maze.kernel[1] + maze.spacing[1]

Modified: trunk/data/levels/lib/libsoko.xml
===================================================================
--- trunk/data/levels/lib/libsoko.xml	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/data/levels/lib/libsoko.xml	2009-03-27 18:10:57 UTC (rev 1599)
@@ -3,7 +3,7 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;library&quot;&gt;
       &lt;el:identity el:title=&quot;&quot; el:id=&quot;lib/libsoko&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;6&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;7&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author el:name=&quot;Enigma Team&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2007, 2008, 2009 Enigma Team&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
@@ -534,7 +534,7 @@
             elseif (type(v) == &quot;table&quot;) and string.find(v[1], &quot;ac_&quot;) then
                 wo[marbles] = v
             elseif v == &quot;rubberball&quot; then
-                local kind = lib.lua.cond(design.white, &quot;#ac_marble&quot;, &quot;#ac_marble_white&quot;)
+                local kind = cond(design.white, &quot;#ac_marble&quot;, &quot;#ac_marble_white&quot;)
                 for j = 1, #marbles do
                     wo[marbles[j]] = {kind, &quot;rubberball_&quot; .. j, controllers = CTRL_NONE}
                     wo:add({&quot;ot_rubberband&quot;, anchor1 = &quot;rubberball_&quot; .. j,
@@ -918,13 +918,13 @@
 -- POS, dependend on the boolean OPEN.
 function lib.soko.endphase_ralf_open_door(open, pos)
     if lib.soko.design.open_door then
-        wo[pos] =    lib.soko.resolver(lib.lua.cond(open, &quot;  &quot;, &quot;# &quot;), pos.x, pos.y)
-                  .. lib.soko.resolver(lib.lua.cond(open, &quot;d &quot;, &quot;D &quot;), pos.x, pos.y)
+        wo[pos] =    lib.soko.resolver(cond(open, &quot;  &quot;, &quot;# &quot;), pos.x, pos.y)
+                  .. lib.soko.resolver(cond(open, &quot;d &quot;, &quot;D &quot;), pos.x, pos.y)
     else
         -- use default &quot;open&quot;/&quot;close&quot;-messages instead
-        if -st(pos) then  st(pos):message(lib.lua.cond(open, &quot;open&quot;, &quot;close&quot;))  end
-        if -it(pos) then  it(pos):message(lib.lua.cond(open, &quot;open&quot;, &quot;close&quot;))  end
-        if -fl(pos) then  fl(pos):message(lib.lua.cond(open, &quot;close&quot;, &quot;open&quot;))  end
+        if -st(pos) then  st(pos):message(cond(open, &quot;open&quot;, &quot;close&quot;))  end
+        if -it(pos) then  it(pos):message(cond(open, &quot;open&quot;, &quot;close&quot;))  end
+        if -fl(pos) then  fl(pos):message(cond(open, &quot;close&quot;, &quot;open&quot;))  end
     end
 end
 

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-03-26 23:51:58 UTC (rev 1598)
+++ trunk/doc/reference/enigma-ref.texi	2009-03-27 18:10:57 UTC (rev 1599)
@@ -13755,13 +13755,111 @@
 described just there.
 
 @menu
-* liblua::       General methods for tables.
-* libmath::      Mathematical algorithms, like random permutations.
-* libmap::       Methods for API 2-maps.
-* libimport::    Methods for importing external level files.
-* libsoko::      A library to interpret Sokoban level files.
+* Basic Functions::  About basic lua functions and standard lua libraries.
+* liblua::           General methods for tables.
+* libmath::          Mathematical algorithms, like random permutations.
+* libmap::           Methods for API 2-maps.
+* libimport::        Methods for importing external level files.
+* libsoko::          A library to interpret Sokoban level files.
 @end menu
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Basic Functions
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> Basic Functions
+
+Enigma supports most Lua 5.0 and above statements, i.e. you can freely use
+tables and control structures in your level, as you would expect. However, some
+Lua functions have been deactivated for security reasons or to ensure
+upwards compatibility. These are @samp{dofile}, @samp{module}, @samp{require}
+and most or all functions of the standard libraries @samp{package}, @samp{io}
+and @samp{os}. You should use the @ref{&lt;compatibility&gt;}-tag to include external
+libraries instead of @samp{require}, @samp{dofile} or @samp{package}, and
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{print} for output to stdout instead of @samp{io}. The @samp{print}
+function is pretty useful for developing and debugging complex levels, but
+should not appear in the level's final version anymore.
+
+Of Lua's built-in mathematical functions you may use any of the following:
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{math.abs}, @samp{math.acos}, @samp{math.asin}, @samp{math.atan}, @samp{math.atan2},
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{math.ceil}, @samp{math.cos}, @samp{math.deg}, @samp{math.exp}, @samp{math.floor},
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{math.frexp}, @samp{math.ldexp}, @samp{math.log}, @samp{math.log10}, @samp{math.max},
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{math.min}, @samp{math.pow}, @samp{math.rad}, @samp{math.random}, @samp{math.sin},
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{math.sqrt}, @samp{math.tan}. As of Lua 5.1, the following functions are
+additionally available: @samp{math.cosh}, @samp{math.fmod}, @samp{math.huge},
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{math.modf}, @samp{math.pi}, @samp{math.sinh}, @samp{math.tanh}.
+
+All trigonometric functions use radians, you can use @samp{math.deg} and
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{math.rad} to convert between radians and degrees. For the differences
+between @samp{math.mod} and @samp{math.fmod} see @ref{lib.lua.mod}.
+
+While you have access to nearly all mathematical functions Lua defines, Enigma
+uses an own random generator, which you access via @samp{math.random} with the
+same syntax as Lua's random generator. To ensure stability in future versions
+of Enigma, @samp{math.randomseed} is disabled.
+
+Please read the online manuals of
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at uref</A>{<A HREF="http://www.lua.org/manual/5.0/,">http://www.lua.org/manual/5.0/,</A> Lua 5.0} and 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at uref</A>{<A HREF="http://www.lua.org/manual/5.1/,">http://www.lua.org/manual/5.1/,</A> Lua 5.1} for more detailled information.
+
+In addition to the usual Lua functions, Enigma provides the @ref{cond} function,
+which can be used to abbreviate simple if-then-else-constructions.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at menu</A>
+* cond::            A ternary operator, wrapper for if-then-else.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> menu
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- cond --------------------
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> cond
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> cond
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{cond} is a conditional assignment, a ternary operator very
+similar (but not equal to) the @samp{?:}-expression in C-like languages. Note
+however, that there are caveats, see details.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at table</A> @asis
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Syntax:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at b</A>{cond}(@i{condition}, @i{iftrue}, @i{iffalse})
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at table</A> @asis
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @i{condition}
+A boolean expression.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @i{iftrue}
+The expression to be returned if @samp{condition} is true.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @i{iffalse}
+The expression to be returned if @samp{condition} is false.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> table
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Syntax Samples:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+cond(wo[&quot;IsDifficult&quot;], @{&quot;st_death&quot;@}, ti[&quot;#&quot;])
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Details:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{cond} evaluates both expressions @samp{iftrue} and
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{iffalse}, regargless of @samp{condition}. Hence,
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+cond(t == 0, 1/t, error(&quot;Division by zero&quot;))
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+will always raise an error: All sideeffects will happen.
+Another example which will not work:
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+w,h = cond(wo[&quot;IsDifficult&quot;], wo(ti, &quot; &quot;, map1), wo(ti, &quot; &quot;, map2))
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Use this instead:
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+w,h = wo(ti, &quot; &quot;, cond(wo[&quot;IsDifficult&quot;], map1, map2))
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+However, in most cases @samp{cond} is used with static expressions for
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{iftrue} and @samp{iffalse} (e.g. strings or variables), when no
+sideeffects are possible.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Full Example:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> table
+
+
 @node liblua
 @section liblua
 
@@ -13777,7 +13875,6 @@
 
 @menu
 * lib.lua.combine_tables::  Collect entries of anonymous Lua-tables into a common table.
-* lib.lua.cond::            A wrapper for if.
 * lib.lua.deep_copy::       Complete copies of Lua-tables.
 * lib.lua.mod::             A modulo operation.
 * lib.lua.print_table::     Print tables for debug reasons.
@@ -13826,59 +13923,6 @@
 @end example
 @end table
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at c</A> ----------------- cond --------------------
-
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at node</A> lib.lua.cond
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at subsection</A> lib.lua.cond
-
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at samp</A>{lib.lua.cond} is a conditional assignment, a ternary operator very
-similar (but not equal to) the @samp{?:}-expression in C-like languages. Note
-however, that there are caveats, see details.
-
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at table</A> @asis
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @b{Syntax:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at b</A>{lib.lua.cond}(@i{condition}, @i{iftrue}, @i{iffalse})
-
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at table</A> @asis
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @i{condition}
-A boolean expression.
-
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @i{iftrue}
-The expression to be returned if @samp{condition} is true.
-
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @i{iffalse}
-The expression to be returned if @samp{condition} is false.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at end</A> table
-
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @b{Syntax Samples:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at example</A>
-lib.lua.cond(wo[&quot;IsDifficult&quot;], @{&quot;st_death&quot;@}, ti[&quot;#&quot;])
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at end</A> example
-
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @b{Details:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at samp</A>{lib.lua.cond} evaluates both expressions @samp{iftrue} and
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at samp</A>{iffalse}, regargless of @samp{condition}. Hence,
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at example</A>
-lib.lua.cond(t == 0, 1/t, error(&quot;Division by zero&quot;))
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at end</A> example
-will always raise an error: All sideeffects will happen.
-Another example which will not work:
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at example</A>
-w,h = lib.lua.cond(wo[&quot;IsDifficult&quot;], wo(ti, &quot; &quot;, map1), wo(ti, &quot; &quot;, map2))
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at end</A> example
-Use this instead:
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at example</A>
-w,h = wo(ti, &quot; &quot;, lib.lua.cond(wo[&quot;IsDifficult&quot;], map1, map2))
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at end</A> example
-However, in most cases @samp{lib.lua.cond} is used with static expressions for
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at samp</A>{iftrue} and @samp{iffalse} (e.g. strings or variables), when no
-sideeffects are possible.
-
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @b{Full Example:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at end</A> example
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at end</A> table
-
 @c ----------------- deep_copy --------------------
 
 @node lib.lua.deep_copy


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001028.html">[Enigma-game-svn] r1598 - team_levelpacks/team_test_new_api
</A></li>
	<LI>Next message: <A HREF="001030.html">[Enigma-game-svn] r1600 - in trunk/src: . stones
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1029">[ date ]</a>
              <a href="thread.html#1029">[ thread ]</a>
              <a href="subject.html#1029">[ subject ]</a>
              <a href="author.html#1029">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
