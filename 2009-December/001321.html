<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1892 - in trunk: doc doc/reference src/gui
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1892%20-%20in%20trunk%3A%20doc%20doc/reference%20src/gui&In-Reply-To=%3C200912012315.nB1NFRMF012448%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001320.html">
   <LINK REL="Next"  HREF="001322.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1892 - in trunk: doc doc/reference src/gui</H1>
    <B>ral at mail.berlios.de</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1892%20-%20in%20trunk%3A%20doc%20doc/reference%20src/gui&In-Reply-To=%3C200912012315.nB1NFRMF012448%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1892 - in trunk: doc doc/reference src/gui">ral at mail.berlios.de
       </A><BR>
    <I>Wed Dec  2 00:15:27 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001320.html">[Enigma-game-svn] r1891 - in trunk: attic/images-stones data/gfx16	data/gfx32 data/gfx40 data/gfx64
</A></li>
        <LI>Next message: <A HREF="001322.html">[Enigma-game-svn] r1893 - in trunk: doc/reference/images src	src/actors src/items
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1321">[ date ]</a>
              <a href="thread.html#1321">[ thread ]</a>
              <a href="subject.html#1321">[ subject ]</a>
              <a href="author.html#1321">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ral
Date: 2009-12-02 00:15:18 +0100 (Wed, 02 Dec 2009)
New Revision: 1892

Modified:
   trunk/doc/README.macosx
   trunk/doc/reference/enigma-ref.texi
   trunk/src/gui/LevelWidget.cc
Log:
Trunk 1.1:
- refman some typo fixes
- README.macosx update by Sidney
- fix r1889 spurious thumb border lines in high resolutions

Modified: trunk/doc/README.macosx
===================================================================
--- trunk/doc/README.macosx	2009-12-01 01:14:59 UTC (rev 1891)
+++ trunk/doc/README.macosx	2009-12-01 23:15:18 UTC (rev 1892)
@@ -1,274 +1,139 @@
-Building Enigma under MacOS X 10.5, 10.4 and 10.3.9
-
-Overview:
----------
-
-Due to which machines are available to Enigma developers, the latest
-version of Enigma has only been built under MacOS X 10.5. The
-instructions for building under older versions of MacOS X have been
-removed from this README as there can be no assurance that they would
-continue to work. Note that the Enigma Mac developers all have Apple's
-free Xcode development environment installed on their machines. Even
-though the build process is not run under Xcode, there may be some
-things that would not work if Xcode had never been installed.
-
-Enigma is built from the command line using make. There is a make
-target that will create a Mac OS application bundle in a compressed
-disk image file, enigma.dmg. That file can be copied to a Mac without
-any special runtime environment having to be installed, and the Enigma
-app simply dropped into a folder to be ready to run.
-
-You do need some other packages installed in order to build Enigma on
-your MacOS X system.
-
-Building under MacOS 10.5:
---------------------------
-
-The build process has only been tested using packages installed from
-MacPorts (formerly called DarwinPorts). It may well be possible to use
-the equivalent packages from Fink or by downloading and building the
-packages and all of their dependencies from the various project source
-sites, but that has not been tested. MacPorts seems to provide the
-easiest way to get a working build environment for Enigma.
-
-There are several problems preventing being able to build Enigma as a
-universal binary on a single machine, including the smpeg package
-build process using ar to unpack separately built library files to
-combine them, a misfeature in QuickTime endian support that breaks
-SDL_mixer when it is compiled for the ppc architecture on an Intel
-host, and Enigma's use of the -M compiler options in building the lua
-code. Instructions for creating a universal binary of Enigma by
-combining separate builds on Intel and PPC machines are included
-below.
-
-Step 1 Install SDL frameworks: Download the binary packages for Mac OS
-X from the SDL project web site for the current stable version of SDL
-(SDL 1.2 at the time of this writing), SDL_image, SDL_ttf, and
-SDL_mixer. The four URLs to find them are:
-
-<A HREF="http://www.libsdl.org/">http://www.libsdl.org/</A>
-<A HREF="http://www.libsdl.org/projects/SDL_image/">http://www.libsdl.org/projects/SDL_image/</A>
-<A HREF="http://www.libsdl.org/projects/SDL_ttf/">http://www.libsdl.org/projects/SDL_ttf/</A>
-<A HREF="http://www.libsdl.org/projects/SDL_mixer/">http://www.libsdl.org/projects/SDL_mixer/</A>
-
-Each download is a dmg file that when opened contains a Framework
-directory, e.g., SDL.framework. Copy each of those directories into
-/Library/Frameworks/ to install it.
-
-Step 2 Install MacPorts:
-
-Basic instruction for installing Macports is outside the scope of this
-README, but it is pretty much a matter of finding the MacPorts web
-site, downloading and running their install package, and then checking
-to make sure that you have a ~/.profile file that adds
-/opt/local/bin to your path. For more information see the
-documentation at the MacPorts web site.
-
-NOTE: Do not install any Macports packages after you install Macports
-until you have completed steps 2a through 2c below.
-
-NOTE: If you already use Macports, you may want to rename /opt/local
-to save your existing installation, re-install Macports in order
-to set up a build environment just for Enigma, set it up according to
-the instructions below, then save that by renaming the new /opt/local
-to somehing like /opt/local-enigma. It is likely that you want to do
-that if you are going to build on MacOS 10.5 for a 10.3.9+ or 10.4+
-target, as that requires Macports to be configured specially.
-
-NOTE: ImageMagick is required to build the documentation. There are
-difficulties installing ImageMagick using Macports customised for
-building Enigma on MacOS 10.5 for deployment on 10.3.9+ or 10.4. If
-you are building Enigma that way, download the ImageMagick binaries
-tar file from
-<A HREF="http://www.imagemagick.org/script/binary-releases.php#macosx">http://www.imagemagick.org/script/binary-releases.php#macosx</A>
-and install according to the directions there. Be sure to export
-MAGICK_HOME as described there,
-
-Step 2a Fix up an autconf problem:
-
-I don't know if this is the most correct way to fix a problem with
-some builds not seeing some MacPorts installed packages, but it does
-work. Create a file named /usr/share/aclocal/dirlist that contains
-just the one line
-
-/opt/local/share/aclocal
-
-Step 2b. (Optional) Set up deployment target if different from the OS
-version and architecture which you are building on
-
-Building on 10.5 Intel to deploy on 10.4 or 10.5 Intel, or 
-Building on 10.5 ppc to deploy on 10.3.9+ ppc
-
-Note: See the section below for using Intel and PPC 10.5 Macs,
-combining the results to get one Universal 10.3.9+ build.
-
-Before intalling any packages, edit
-/opt/local/etc/macports/macports.conf and change the following three
-options to the values shown. On the Intel machine, use
-
-universal_target        10.4
-universal_sysroot	/Developer/SDKs/MacOSX10.4u.sdk
-universal_archs		i386
-
-On the PPC machine use
-
-universal_target        10.3
-universal_sysroot	/Developer/SDKs/MacOSX10.3.9.sdk
-universal_archs		ppc
-
-Save the file, then edit
-/opt/local/etc/macports/variants.conf
-adding the line at the end of the file
-+universal
-
-Make sure you make this change before you sudo port install any specific
-packages. Note that these changes are not suitable for general
-installations of Macports and should be used only within a Macports
-installation that you intend to use for the Enigma build
-environment. You don't need to do this step and therefore don't need a
-special copy of Macports that is only for building Enigma if you are building to
-target only your own version of MacOS and your own architecture.
-
-Step 2c Deal with an idiosynchratic package
-
-The build environment for Enigma will require installing libtool in
-Macports. That package has a listed build dependency on automake which
-in turn has dependencies that bring in all of perl and other large
-packages. MacOS 10.5 has a sufficiently current automake, so the
-dependency can simply be removed before installing libtool. Edit the
-Portfile for libtool using the following command, substituting your
-favorite editor for nano if you don't want the default vim or whatever
-is specified in the EDITOR environment variable:
-
- sudo port edit --editor nano libtool
-
-and remove the line that specifies a build dependency on
-automake. This step is not necessary if you already have perl5
-installed in MacPorts, as it is just to let you avoid that
-installation. Then install it with the following option:
-
- sudo port install libtool -universal
-
-NOTE: If you ever do a port sync or port selfupgrade on this
-installation it will wipe out this change, so you would have to edit
-it again before doing a port upgrade to avoid downloading and
-installing automake and the large packages it requires.
-
-Step 2d. Fix the xercesc package
-
-Edit the portfile of the xercesc package using the command
-
- sudo port edit --editor nano xercesc
-
-and after the closing bracket of the darwin 8 section insert the
-following section if on an Intel Mac, or the second one if on a PPC
-
-platform universal {
-	configure.env-append    MACOSX_DEPLOYMENT_TARGET=10.4
-	build.env-append        MACOSX_DEPLOYMENT_TARGET=10.4
-	configure.pre_args-append	-c /usr/bin/gcc-4.0 -x /usr/bin/g++-4.0 \
-		-z -isysroot -z /Developer/SDKs/MacOSX10.4u.sdk -z -mmacosx-version-min=10.4 \
-		-l -isysroot -l /Developer/SDKs/MacOSX10.4u.sdk -l -mmacosx-version-min=10.4 \
-		-l -Wl,-syslibroot,/Developer/SDKs/MacOSX10.4u.sdk
-}
-
-
-platform universal {
-	configure.env-append    MACOSX_DEPLOYMENT_TARGET=10.3
-	build.env-append        MACOSX_DEPLOYMENT_TARGET=10.3
-	configure.pre_args-append	-c /usr/bin/gcc-4.0 -x /usr/bin/g++-4.0 \
-		-z -isysroot -z /Developer/SDKs/MacOSX10.3.9.sdk -z -mmacosx-version-min=10.3 \
-		-l -isysroot -l /Developer/SDKs/MacOSX10.3.9.sdk -l -mmacosx-version-min=10.3 \
-		-l -Wl,-syslibroot,/Developer/SDKs/MacOSX10.3.9.sdk
-}
-
-NOTE: If you ever do a port sync or port selfupgrade on this
-installation it will wipe out this change, so you would have to edit
-it again before doing a port upgrade to ensure it builds properly.
-
-Step 3. Install the remaining required Macports packages
-
- At a Terminal.app command line, run the commands
-
- sudo port install libiconv gettext libsdl libsdl_mixer libsdl_image libsdl_ttf xercesc
-
-Wait a long time for it to finish. If you want to see more output
-scroll by on your terminal to keep from being bored while waiting (and
-to know that the build is not hung), use
-the -d option, as in sudo port -d install etc.
-
-Step 4 Build Enigma:
-
-Important: The configure step requires you to be logged in with access
-to the window system, i.e., either at the Mac keyboard or using remote
-screen sharing, and in a Terminal.app comand line. It will hang trying
-to test the SDL library if you are using ssh to log in remotely with no
-GUI screen.
-
-At the Terminal.app command line, cd to the Enigma directory tree and
-type the correct set of commands below depending on what you are doing:
-
-a) simple case, building to target your own platform only:
-
- ./autogen.sh
- env CPPFLAGS=&quot;-I/opt/local/include&quot; LDFLAGS=&quot;-L/opt/local/lib&quot; ./configure
- make gmo 
- make
- make macapp
-
-b) building on a 10.5 Intel machine to target 10.4+ Intel
-
- export MACOSX_DEPLOYMENT_TARGET=10.4
- export SDK=/Developer/SDKs/MacOSX10.4u.sdk
- ./autogen.sh
- env CPPFLAGS=&quot;-I/opt/local/include -mmacosx-version-min=10.4 -isysroot ${SDK}&quot; LDFLAGS=&quot;-L/opt/local/lib -mmacosx-version-min=10.4 -isysroot ${SDK} -Wl,-syslibroot,${SDK}&quot; ./configure
- make gmo 
- make
- make macapp
-
-c) building on a 10.5 PPC machine to target 10.3.9+ PPC
-
- export MACOSX_DEPLOYMENT_TARGET=10.3
- export SDK=/Developer/SDKs/MacOSX10.3.9.sdk
- ./autogen.sh
- env CPPFLAGS=&quot;-I/opt/local/include -mmacosx-version-min=10.3 -isysroot ${SDK}&quot; LDFLAGS=&quot;-L/opt/local/lib -mmacosx-version-min=10.3 -isysroot ${SDK} -Wl,-syslibroot,${SDK}&quot; ./configure
- make gmo 
- make
- make macapp
-
-That's it! If it all works, there will be a copy of enigma.dmg in the
-etc/ subdirectory and a copy of Enigma.app in etc/macfiles/
-subdirectory.
-
-Step 5. (optional) Creating a universal binary with support for 10.3.9+
-
-To get a Universal binary, you must create separate builds on a PPC
-and an Intel Mac, then combine them to form one Universal
-build. Follow the instructions above to get a build for 10.4+ on the
-Intel machine and for 10.3.9+ on the PPC machine.
-
-On the PPC machine, go into the directory tree of the resulting
-Enigma.app, either using a terminal command line or in the finder
-using control-click Show Package Contents, and copy the file
-Enigma.app/Contents/MacOS/enigma to the Intel machine where you name
-the file enigma-ppc and place it in Enigma.app/Contents/MacOS/
-there. On the Intel machine rename the file
-Enigma.app/Contents/MacOS/enigma to enigma-intel. Now that you have
-the two versions of that file with suitable names, in a Terminal.app
-command line cd into the Enigma.app/Contents/MacOS/ directory and run
-the following command
-
- lipo -create enigma-intel enigma-ppc -output enigma
-
-Delete enigma-intel and enigma-ppc
-
-At this point, if you want, you can verify that the Enigma.app on the
-Intel machine runs fine on both the Intel and the PPC machines.
-
-To recreate the etc/enigma.dmg file with the new app, first delete or
-rename the etc/enigma.dmg file, then cd to the src/ directory and run
-the command
-
- make bundle-dmg
-
-----------------------------
+Building Enigma under MacOS X 106, 10.5, and 10.4
+
+Overview:
+---------
+
+Due to which machines are available to Enigma developers, the latest
+version of Enigma has only been built under MacOS X 10.6. The
+instructions for building should apply identically under 10.4 and 10.5.
+The latest SDL library package no longer supports earlier versions of
+Mac OS and so Enigma has dropped support for 10.3 or earlier.
+Note that even though the build process is not run under Xcode,
+it does require that Xcode, which includes a number of developer tools,
+has been installed on the build machine.
+
+Enigma is built from the command line using make. There is a make
+target that will create a Mac OS application bundle in a compressed
+disk image file, enigma.dmg. That file can be copied to a Mac without
+any special runtime environment having to be installed, and the Enigma
+app simply dropped into a folder to be ready to run. The following
+instructions allow you to build a universal binary that will run
+on both PowerPc and Intel Macs running MacOS 10.4 or later.
+
+You do need some other packages installed in order to build Enigma on
+your MacOS X system. Earlier versions of this README used packages
+installed from Macports. That is no longer necessary.
+
+Step 1: Install libjpeg and libpng downloaded from
+<A HREF="http://ethan.tira-thompson.org/Mac_OS_X_Ports.html">http://ethan.tira-thompson.org/Mac_OS_X_Ports.html</A>
+Download the combined package dmg file from that page, open it in
+Finder and double click on the mpkg installation file.
+
+Step 2: Download the xerces-c precompiled binaries for MacOS 10.4
+both Intel and PPC from <A HREF="http://xerces.apache.org/xerces-c/download.cgi">http://xerces.apache.org/xerces-c/download.cgi</A>
+Each of them will contain a lib/libxerces-c.a file. Use lipo to combine
+them into one universal binary file. For example, if you put the files into
+separate directories named ppc and x86 and wanted to create the universal
+binary in the current directory, the command line would look like 
+
+ lipo -create ppc/libxerces-c.a x86/libxerces-c.a -output libxerces-c.a
+
+Put the universal binary of libxerces-c.a in /usr/local/lib/
+
+Copy the include directory contents from the download to /usr/local/include/
+and the pkgconfig directory contents to /usr/local/lib/pkgconfig/
+You can use either the PPC or Intel version as they are the same.
+
+Step 3 Install SDL frameworks: Download the binary packages for Mac OS
+X from the SDL project web site for the current stable version of SDL
+(SDL 1.2 at the time of this writing. Enigma does not yet support SDL 1.3),
+SDL_image, SDL_ttf, and SDL_mixer. The four URLs to find them are:
+
+<A HREF="http://www.libsdl.org/">http://www.libsdl.org/</A>
+<A HREF="http://www.libsdl.org/projects/SDL_image/">http://www.libsdl.org/projects/SDL_image/</A>
+<A HREF="http://www.libsdl.org/projects/SDL_ttf/">http://www.libsdl.org/projects/SDL_ttf/</A>
+<A HREF="http://www.libsdl.org/projects/SDL_mixer/">http://www.libsdl.org/projects/SDL_mixer/</A>
+
+Each download is a dmg file that when opened contains a Framework
+directory, e.g., SDL.framework. Copy each of those directories into
+/Library/Frameworks/ to install it.
+
+Step 4. Install gettext in /usr/local as a universal binary
+ a) Download the latest source tarball of gettext from
+<A HREF="http://www.gnu.org/software/gettext/#TOCdownloading">http://www.gnu.org/software/gettext/#TOCdownloading</A>
+ b) Untar it into a convenient directory for building it.
+ c) Build it using the following shell script. If you name the file
+for example builduniversal.sh, make it executable and put it in 
+your path, you would cd to the root directory
+of the source tarball you unpacked and use the command lines
+
+  builduniversal.sh
+  make
+  sudo make install
+
+Here is the contents of builduniversal.sh:
+
+#!/bin/sh
+# build a package for universal 10.4+ if it is configured in standard way
+# does the configure and make but not the make install
+# You can add arguments to be passed to configure
+# You can pass in prefix values in CFLAGS, CXXFLAGS, LDFLAGS environment variables
+MACOSX_DEPLOYMENT_TARGET=10.4 \
+UNIFLAGS=&quot;-isysroot /Developer/SDKs/MacOSX10.4u.sdk -mmacosx-version-min=10.4 -arch i386 -arch ppc&quot; \
+CC=/usr/bin/gcc-4.0 \
+CXX=/usr/bin/g++-4.0 \
+CFLAGS=&quot;$CFLAGS $UNIFLAGS&quot; \
+CXXFLAGS=&quot;$CXXFLAGS $NIFLAGS&quot; \
+LDFLAGS=&quot;$LDFLAGS $UNIFLAGS  -Wl,-syslibroot,/Developer/SDKs/MacOSX10.4u.sdk&quot; \
+./configure --disable-dependency-tracking $*
+
+Step 5. Install SDL packages from source
+The build process requires the SDL libraries to be installed in /usr/local
+in addition to the frameworks you installed in step 3.
+ a) Download the source file tarballs from the same web pages you downloaded the frameworks.
+ b) Unpack the tarballs in some convenient directory for building them
+ c) Building SDL is a bit complicated to get a universal build. It comes with a
+   script for doing so build-scripts/fatbuild.sh, but the version included with
+   SDL-1.2.14 is buggy. You have to replace it with one downloaded from the
+   bug report about it: <A HREF="http://bugzilla.libsdl.org/attachment.cgi?id=453">http://bugzilla.libsdl.org/attachment.cgi?id=453</A>
+   Remember to chmod +x the file after you download it to make it executable.
+   It is an attachment to bug report <A HREF="http://bugzilla.libsdl.org/show_bug.cgi?id=867">http://bugzilla.libsdl.org/show_bug.cgi?id=867</A>
+   Once you have the proper fatbuild.sh in place to build SDL you run
+
+     build-scripts/fatbuild.sh
+     sudo build-scripts/fatbuild.sh install
+
+ d) Build SDL_image, SDL_mixer, and SDL_ttf using  builduniversal.sh and sudo make install
+    just like you did with gettext
+
+Step 6. Install ImageMagick (required to build the documentation)
+Download the ImageMagick binaries from
+<A HREF="http://www.imagemagick.org/script/binary-releases.php#macosx">http://www.imagemagick.org/script/binary-releases.php#macosx</A>
+and install according to the directions there.
+IMPORTANT: Be sure to export MAGICK_HOME as described there,
+
+Step 7 Build Enigma:
+
+Important: The configure step requires you to be logged in with access
+to the window system, i.e., either at the Mac keyboard or using remote
+screen sharing, and in a Terminal.app comand line. It will hang trying
+to test the SDL library if you are using ssh to log in remotely with no
+GUI screen.
+
+At the Terminal.app command line, set up your environment with the following
+
+export MACOSX_DEPLOYMENT_TARGET=10.4
+
+Then cd to the Enigma directory tree and
+run the following commands which make use of the builduniversal.sh
+script file that was listed in step 4.
+
+./autogen.sh
+CFLAGS=&quot;-I/usr/local/include&quot; CXXFLAGS=&quot;-I/usr/local/include&quot; LDFLAGS=&quot;-L/usr/local/lib&quot; builduniversal.sh
+make gmo
+make
+make macapp
+
+That's it! If it all works, there will be a copy of enigma.dmg in the
+etc/ subdirectory and a copy of Enigma.app in etc/macfiles/
+subdirectory.

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-12-01 01:14:59 UTC (rev 1891)
+++ trunk/doc/reference/enigma-ref.texi	2009-12-01 23:15:18 UTC (rev 1892)
@@ -3953,8 +3953,8 @@
 reason to dig into this language at the very beginning.
 
 With the second Lua API version, as of Enigma 1.10, we designed an optimized
-way of describing levels in a very short and readable manner. Thus we like to
-introduce you to this API by giving several examples from a basic level to most
+way of describing levels in a very short and readable manner. Thus we would like
+to introduce you to this API by giving several examples from a basic level to most
 thrilling dynamic real Enigma levels. You should be able to start your first
 experiments just after reading the first example with its explanations.
 
@@ -4005,7 +4005,7 @@
 @subsection Basic Example
 
 Let us view the source code. We did add a line count in the first two columns
-for reference purpose within this section. These line count number are not part
+for reference purpose within this section. These line count numbers are not part
 of the source code itself!
 
 @example
@@ -4232,9 +4232,9 @@
 Another object group is an @ref{st_turnstile} cluster with one arm disconnected.
 The first two definitions are straight forward. But in line 42 we precede the
 arm's definition by another tile reference. It is the abyss tile defined in
-line 19. By concatenation, the two dots @b{..}, of a tile and a object
-definition we can define a new that is composed of both objects. In this case
-we define a turnstile arm on top of an abyss floor.
+line 19. By concatenation, the two dots @b{..}, of a tile and an object
+definition we can define a new tile that is composed of both objects. In this
+case we define a turnstile arm on top of an abyss floor.
 
 You may be wondering why we did not define floors for the other stone and item
 tiles. We make use of the tile definition in line 18 that we will declare
@@ -4251,7 +4251,7 @@
 means for each grid position we try to set both floor types, but just one meets
 the checkerboard condition and will be set.
 
-Please notice that we did convert one one the floor object definitions to a tile
+Please notice that we did convert one the floor object definitions to a tile
 definition by the function call @samp{ti()}. This is necessary as Lua does not
 know how to concatenate two anonymous tables. One argument of the concatenation
 has to be a tile.
@@ -4275,8 +4275,8 @@
 We encourage every level author to provide an easy mode for the levels. This
 is an example how to define mode dependent tiles. Like in line 16 we access
 a world attribute. But this time it is a read access of @ref{IsDifficult}.
-In easy mode we want a @ref{it_strip} on top of water floor that allows the
-marble to pass and press the trigger. In difficult mode the there should be
+In easy mode we want an @ref{it_strip} on top of the water floor that allows the
+marble to pass and press the trigger. In difficult mode there should be
 no passage. Thus the special tile is identical to the water tile defined in
 line 20.
 
@@ -4304,7 +4304,7 @@
 floor. The third argument is the map as a table of strings, one for every line.
 
 The world initialization returns the width and height of our world which are
-calculated by the maps size.
+calculated by the map's size.
 
 @example
 70    @i{wo}:@b{shuffleOxyd}()
@@ -4384,7 +4384,7 @@
 on the targets. Here the author makes clever usage of multitargets and
 multiactions as described in @ref{Target - Action}. On every turn of a red
 turnstile all objects named @samp{red#*}, that are all our blockers on a red
-floor, will be send a message @samp{open}, whereas all blocks on a green floor,
+floor, will be sent a message @samp{open}, whereas all blocks on a green floor,
 the second target group, receives the second action message @samp{close}. It is
 essential to choose the @samp{open}, @samp{close} messages instead of
 @samp{toggle}, as more than one red turnstile may be turned in sequence, but
@@ -4488,7 +4488,7 @@
 @end example
 Anonymous tables with just two number values can be used in many cases directly as
 a position constant. In case of errors, e.g. when operators are not well defined
-like addition of two constants what result in an attempt of adding two Lua
+like addition of two constants, which results in an attempt of adding two Lua
 tables, use the function @samp{po()} to convert the constant.
 
 @item @b{Coordinate Access:}
@@ -4588,7 +4588,7 @@
 @var{obj}[&quot;@b{color}&quot;]  = nil       -- delete color attribute - no color
 @var{obj}[&quot;@b{length}&quot;] = @i{DEFAULT}   -- the default length, e.g. @samp{1}
 @end example
-Any object attribute can be reset to its default value, what is the attributes
+Any object attribute can be reset to its default value, which is the attribute's
 &quot;delete&quot; operation, by assigning it the Lua @samp{nil} or the Enigma
 @samp{DEFAULT} value.
 
@@ -8821,7 +8821,7 @@
 @node ignite
 @subsection ignite
 
-Sets fire to a floor if its burnable (@pxref{Fire Spreading}) or start an
+Sets fire to a floor if it is burnable (@pxref{Fire Spreading}) or start an
 explosion or shattering of items like @ref{it_dynamite}, @ref{it_bomb} or
 stones like @ref{st_ice}, @ref{st_dispenser} and many more.
 
@@ -8834,7 +8834,7 @@
 @node heat
 @subsection heat
 
-Sets fire to a floor if its burnable (@pxref{Fire Spreading}) or causes a
+Sets fire to a floor if it is burnable (@pxref{Fire Spreading}) or causes a
 @ref{Heat-Transformation} on a floor or other objects like @ref{st_ice} that
 starts melting. Some objects do react on a heat message like on an @ref{ignite}
 message by explosions or shattering.
@@ -8848,7 +8848,7 @@
 @node setfire
 @subsection setfire
 
-Sets fire to a floor if its burnable (@pxref{Fire Spreading}).
+Sets fire to a floor if it is burnable (@pxref{Fire Spreading}).
 
 @table @asis
 @item @b{Value:} @ @ -
@@ -9019,13 +9019,13 @@
 @item @samp{RANDOMDIR} = @code{-2}, by @ref{st_mirror}
 @item @samp{NODIR} = @code{-1}, by @ref{fl_slope}
 @item @samp{WEST} = @code{0}, by all objects with 4 orientations
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @samp{SOUTH} = @code{1}, by all actors with 4 orientations
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @samp{EAST} = @code{2}, by all actors with 4 orientations
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @samp{NORTH} = @code{3}, by all actors with 4 orientations
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @samp{SOUTH} = @code{1}, by all objects with 4 orientations
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @samp{EAST} = @code{2}, by all objects with 4 orientations
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @samp{NORTH} = @code{3}, by all objects with 4 orientations
 @item @samp{NORTHWEST} = @code{4}, by all objects with 8 orientations
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @samp{SOUTHWEST} = @code{5}, by all actors with 8 orientations
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @samp{SOUTHEAST} = @code{6}, by all actors with 8 orientations
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at item</A> @samp{NORTHEAST} = @code{7}, by all actors with 8 orientations
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @samp{SOUTHWEST} = @code{5}, by all objects with 8 orientations
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @samp{SOUTHEAST} = @code{6}, by all objects with 8 orientations
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @samp{NORTHEAST} = @code{7}, by all objects with 8 orientations
 @end itemize
 
 Just for @ref{st_mirror} another alternative orientation notation exists:

Modified: trunk/src/gui/LevelWidget.cc
===================================================================
--- trunk/src/gui/LevelWidget.cc	2009-12-01 01:14:59 UTC (rev 1891)
+++ trunk/src/gui/LevelWidget.cc	2009-12-01 23:15:18 UTC (rev 1892)
@@ -89,9 +89,8 @@
         curIndex-&gt;setScreenFirstPosition(ifirst);
     }
         
-    void LevelWidget::realize (const ecl::Rect &amp;area_)
-    {
-        Widget::realize (area_);
+    void LevelWidget::realize(const ecl::Rect &amp;area_) {
+        Widget::realize(area_);
         width = area_.w / buttonw;
         height = area_.h / buttonh;
     }
@@ -102,7 +101,7 @@
         }
     }
         
-    void LevelWidget::scroll_up (int nlines) 
+    void LevelWidget::scroll_up(int nlines) 
     {
         int newFirst = ifirst;
         int newSelected = iselected;
@@ -113,7 +112,7 @@
             if (newSelected &lt; newFirst)
                 newSelected += width;
         }
-        set_selected (newFirst, newSelected);
+        set_selected(newFirst, newSelected);
     }
     
     void LevelWidget::scroll_down(int nlines) 
@@ -133,11 +132,11 @@
                     newSelected -= width;
             }
         }
-        set_selected (newFirst, newSelected);
+        set_selected(newFirst, newSelected);
     }
     
     void LevelWidget::page_up() {
-        set_selected ((ifirst &gt;= width*height ? ifirst - width*height : 0), 
+        set_selected((ifirst &gt;= width*height ? ifirst - width*height : 0), 
                 (iselected &gt;= width*height ? iselected - width*height : 0));
         syncToIndexMgr();
     }
@@ -150,7 +149,7 @@
         // make sure last page is shown as a whole
         int first = std::min&lt;int&gt; (lastPageFirst, ifirst + width*height);
         //    set_selected (first, s-1);
-        set_selected (first, iselected + width*height);
+        set_selected(first, iselected + width*height);
         syncToIndexMgr();
     }
     
@@ -166,12 +165,12 @@
         syncToIndexMgr();
     }
     
-    void LevelWidget::set_current (int newsel)
+    void LevelWidget::set_current(int newsel)
     {
-        set_selected (ifirst, newsel);
+        set_selected(ifirst, newsel);
     }
     
-    void LevelWidget::set_selected (int newfirst, int newsel)
+    void LevelWidget::set_selected(int newfirst, int newsel)
     {
         int numlevels = curIndex-&gt;size();
         newsel = Clamp&lt;int&gt; (newsel, 0, numlevels-1);
@@ -182,7 +181,7 @@
         if (newsel &gt;= newfirst+width*height)
             newfirst = (newsel/width-height+1)*width;
     
-        newfirst = Clamp&lt;int&gt; (newfirst, 0, numlevels-1);
+        newfirst = ecl::Clamp&lt;int&gt;(newfirst, 0, numlevels-1);
         if (newfirst &lt; 0) newfirst = 0;
     
         size_t oldsel = iselected;
@@ -208,7 +207,7 @@
         }
     }
                 
-    bool LevelWidget::draw_level_preview (ecl::GC &amp;gc, int x, int y, int borderWidth,
+    bool LevelWidget::draw_level_preview(ecl::GC &amp;gc, int x, int y, int borderWidth,
             lev::Proxy *proxy, bool selected, bool isCross, bool locked,
             bool allowGeneration, bool &amp;didGenerate) { 
         // Draw button with level preview
@@ -220,8 +219,7 @@
         if (selected) {
             blit (gc, x - borderWidth, y - borderWidth, displayEditBorder ? img_editborder : img_border);
             blit (gc, x, y, img);
-        }
-        else {
+        } else {
             img-&gt;set_alpha (127);
             blit (gc, x, y, img);
             img-&gt;set_alpha(255);
@@ -287,8 +285,7 @@
         return true;
     }
     
-    void LevelWidget::draw (ecl::GC &amp;gc, const ecl::Rect &amp;r)
-    {
+    void LevelWidget::draw(ecl::GC &amp;gc, const ecl::Rect &amp;r) {
         const video::VMInfo &amp;vminfo = *video::GetInfo();
         const int imgw = vminfo.thumbw;       // Size of the preview images
         const int imgh = vminfo.thumbh;
@@ -300,10 +297,8 @@
         unsigned i=ifirst;          // level index
         bool allowGeneration = true;
     
-        for (int y=0; y&lt;height; y++)
-        {
-            for (int x=0; x&lt;width; x++, i++)
-            {
+        for (int y=0; y&lt;height; y++) {
+            for (int x=0; x&lt;width; x++, i++) {
                 if (i &gt;= curIndex-&gt;size())
                     goto done_painting;
     
@@ -322,8 +317,8 @@
                 }
                 // Draw level preview
                 lev::Proxy *levelProxy = curIndex-&gt;getProxy(i);
-                int imgx = xpos+(buttonw-imgw)/2;
-                int imgy = ypos + 4;
+                int imgx = xpos + (buttonw-imgw)/2;
+                int imgy = ypos + bwidth;
                 if (levelProxy != NULL) {
                     bool didGenerate;
                     bool didDraw = draw_level_preview(gc, imgx, imgy, bwidth, levelProxy, 
@@ -355,11 +350,11 @@
             }
         }
         done_painting:
-        m_areas.resize (i-ifirst); // Remove unused areas (if any) from the list
+        m_areas.resize(i-ifirst); // Remove unused areas (if any) from the list
         return;
     }
     
-    void LevelWidget::tick (double time) {
+    void LevelWidget::tick(double time) {
         if (!isInvalidateUptodate) {
             // invalidate just 1 button for redraw
             bool isFirst = true;
@@ -378,112 +373,108 @@
         }
     }
     
-    bool LevelWidget::on_event(const SDL_Event &amp;e) 
-    {
+    bool LevelWidget::on_event(const SDL_Event &amp;e) {
         bool handled = Widget::on_event(e);
     
         switch (e.type) {
-        case SDL_MOUSEMOTION:
-            if (get_area().contains(e.motion.x, e.motion.y)) {
-                int newsel=iselected;
-                for (unsigned i=0; i&lt;m_areas.size(); ++i)
-                    if (m_areas[i].contains(e.motion.x, e.motion.y))
-                    {
-                        newsel = ifirst+i;
-                        break;
-                    }
-                set_current(newsel);
-                handled = true;
-            }
-            break;
-        case SDL_MOUSEBUTTONDOWN:
-            if (get_area().contains(e.button.x, e.button.y))
-                handled = handle_mousedown (&amp;e);
-            break;
-        case SDL_KEYDOWN:
-            handled = handle_keydown (&amp;e);
-            break;
+            case SDL_MOUSEMOTION:
+                if (get_area().contains(e.motion.x, e.motion.y)) {
+                    int newsel=iselected;
+                    for (unsigned i=0; i&lt;m_areas.size(); ++i)
+                        if (m_areas[i].contains(e.motion.x, e.motion.y))
+                        {
+                            newsel = ifirst+i;
+                            break;
+                        }
+                    set_current(newsel);
+                    handled = true;
+                }
+                break;
+            case SDL_MOUSEBUTTONDOWN:
+                if (get_area().contains(e.button.x, e.button.y))
+                    handled = handle_mousedown (&amp;e);
+                break;
+            case SDL_KEYDOWN:
+                handled = handle_keydown (&amp;e);
+                break;
         }
         syncToIndexMgr();
         return handled;
     }
     
-    bool LevelWidget::handle_mousedown (const SDL_Event *e) 
-    {
+    bool LevelWidget::handle_mousedown(const SDL_Event *e) {
         switch (e-&gt;button.button) {
-        case SDL_BUTTON_LEFT:
-            for (unsigned i=0; i&lt;m_areas.size(); ++i)
-                if (m_areas[i].contains(e-&gt;button.x, e-&gt;button.y))
-                {
-                    sound::EmitSoundEvent (&quot;menuok&quot;);
-                    iselected = ifirst+i;
-                    syncToIndexMgr();
-                    if (SDL_GetModState() &amp; KMOD_CTRL &amp;&amp; !(SDL_GetModState() &amp; KMOD_SHIFT)) {
-                        // control key pressed - level inspector
+            case SDL_BUTTON_LEFT:
+                for (unsigned i=0; i&lt;m_areas.size(); ++i)
+                    if (m_areas[i].contains(e-&gt;button.x, e-&gt;button.y))
+                    {
+                        sound::EmitSoundEvent (&quot;menuok&quot;);
+                        iselected = ifirst+i;
+                        syncToIndexMgr();
+                        if (SDL_GetModState() &amp; KMOD_CTRL &amp;&amp; !(SDL_GetModState() &amp; KMOD_SHIFT)) {
+                            // control key pressed - level inspector
+                            LevelInspector m(curIndex-&gt;getProxy(iselected));
+                            m.manage();
+                            get_parent()-&gt;draw_all();
+                        } else {
+                            // no control key - start level
+                            trigger_action();
+                        }
+                        return true;
+                    }
+                break;
+            case SDL_BUTTON_RIGHT: 
+                for (unsigned i=0; i&lt;m_areas.size(); ++i)
+                    if (m_areas[i].contains(e-&gt;button.x, e-&gt;button.y))
+                    {
+                        sound::EmitSoundEvent (&quot;menuok&quot;);
+                        iselected = ifirst+i;
+                        syncToIndexMgr();
                         LevelInspector m(curIndex-&gt;getProxy(iselected));
                         m.manage();
                         get_parent()-&gt;draw_all();
-                    } else {
-                        // no control key - start level
-                        trigger_action();
+                        return true;
                     }
-                    return true;
-                }
-            break;
-        case SDL_BUTTON_RIGHT: 
-            for (unsigned i=0; i&lt;m_areas.size(); ++i)
-                if (m_areas[i].contains(e-&gt;button.x, e-&gt;button.y))
-                {
-                    sound::EmitSoundEvent (&quot;menuok&quot;);
-                    iselected = ifirst+i;
-                    syncToIndexMgr();
-                    LevelInspector m(curIndex-&gt;getProxy(iselected));
-                    m.manage();
-                    get_parent()-&gt;draw_all();
-                    return true;
-                }
-            break;
-        case 4: scroll_down(1); return true;
-        case 5: scroll_up(1); return true;
+                break;
+            case 4: scroll_down(1); return true;
+            case 5: scroll_up(1); return true;
         }
         return false;
     }
     
-    bool LevelWidget::handle_keydown (const SDL_Event *e)
-    {
+    bool LevelWidget::handle_keydown(const SDL_Event *e) {
         switch (e-&gt;key.keysym.sym) {
-    
-        case SDLK_t:
-            // Generate new level preview for current level
-            preview_cache-&gt;updatePreview(curIndex-&gt;getProxy(iselected));
-            invalidate();
-            break;
+            case SDLK_t:
+                // Generate new level preview for current level
+                preview_cache-&gt;updatePreview(curIndex-&gt;getProxy(iselected));
+                invalidate();
+                break;
+            
+            case SDLK_LEFT:  
+                if (!(SDL_GetModState() &amp; KMOD_ALT)) {
+                    set_current (iselected&gt;1 ? iselected-1 : 0); 
+                    break;
+                } else
+                    return false;
+            case SDLK_RIGHT:
+                if (!(SDL_GetModState() &amp; KMOD_ALT)) {
+                     set_current (iselected+1);
+                     break;
+                } else
+                    return false;
+            case SDLK_DOWN:  set_current (iselected+width); break;
+            case SDLK_UP:    set_current (iselected&gt;width ? iselected-width : 0); break;
+            case SDLK_PAGEDOWN: page_down(); break;
+            case SDLK_PAGEUP: page_up(); break;
+            case SDLK_HOME: start(); break;
+            case SDLK_END: end(); break;
         
-        case SDLK_LEFT:  
-            if (!(SDL_GetModState() &amp; KMOD_ALT)) {
-                set_current (iselected&gt;1 ? iselected-1 : 0); 
+            case SDLK_RETURN:
+                trigger_action();
                 break;
-            } else
-                return false;
-        case SDLK_RIGHT:
-            if (!(SDL_GetModState() &amp; KMOD_ALT)) {
-                 set_current (iselected+1);
-                 break;
-            } else
-                return false;
-        case SDLK_DOWN:  set_current (iselected+width); break;
-        case SDLK_UP:    set_current (iselected&gt;width ? iselected-width : 0); break;
-        case SDLK_PAGEDOWN: page_down(); break;
-        case SDLK_PAGEUP: page_up(); break;
-        case SDLK_HOME: start(); break;
-        case SDLK_END: end(); break;
-    
-        case SDLK_RETURN:
-            trigger_action();
-            break;
-    
-        default:
-            return false;           // key not handled
+        
+            default:
+                return false;           // key not handled
         }
         return true;
     }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001320.html">[Enigma-game-svn] r1891 - in trunk: attic/images-stones data/gfx16	data/gfx32 data/gfx40 data/gfx64
</A></li>
	<LI>Next message: <A HREF="001322.html">[Enigma-game-svn] r1893 - in trunk: doc/reference/images src	src/actors src/items
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1321">[ date ]</a>
              <a href="thread.html#1321">[ thread ]</a>
              <a href="subject.html#1321">[ subject ]</a>
              <a href="author.html#1321">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
