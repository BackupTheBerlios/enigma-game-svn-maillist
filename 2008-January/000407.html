<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r975 - in trunk: . data data/gfx16 src src/gui
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2008-January/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r975%20-%20in%20trunk%3A%20.%20data%20data/gfx16%20src%20src/gui&In-Reply-To=%3C200801061628.m06GS1k0004608%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000406.html">
   <LINK REL="Next"  HREF="000408.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r975 - in trunk: . data data/gfx16 src src/gui</H1>
    <B>ral at BerliOS</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r975%20-%20in%20trunk%3A%20.%20data%20data/gfx16%20src%20src/gui&In-Reply-To=%3C200801061628.m06GS1k0004608%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r975 - in trunk: . data data/gfx16 src src/gui">ral at mail.berlios.de
       </A><BR>
    <I>Sun Jan  6 17:28:01 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000406.html">[Enigma-game-svn] r974 - homepage/input/articles
</A></li>
        <LI>Next message: <A HREF="000408.html">[Enigma-game-svn] Commit 976
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#407">[ date ]</a>
              <a href="thread.html#407">[ thread ]</a>
              <a href="subject.html#407">[ subject ]</a>
              <a href="author.html#407">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ral
Date: 2008-01-06 17:27:59 +0100 (Sun, 06 Jan 2008)
New Revision: 975

Added:
   trunk/data/gfx16/
   trunk/data/gfx16/Makefile.am
   trunk/data/gfx16/inventory.jpg
   trunk/data/gfx16/menu_bg.jpg
   trunk/data/models-16.lua
Modified:
   trunk/configure.ac
   trunk/data/Makefile.am
   trunk/src/d_models.cc
   trunk/src/enigma.cc
   trunk/src/enigma.hh
   trunk/src/file.cc
   trunk/src/gui/ErrorMenu.cc
   trunk/src/gui/HelpMenu.cc
   trunk/src/gui/InfoMenu.cc
   trunk/src/gui/LPGroupConfig.cc
   trunk/src/gui/LevelInspector.cc
   trunk/src/gui/LevelMenu.cc
   trunk/src/gui/LevelPackConfig.cc
   trunk/src/gui/LevelPackMenu.cc
   trunk/src/gui/LevelWidget.cc
   trunk/src/gui/MainMenu.cc
   trunk/src/gui/OptionsMenu.cc
   trunk/src/gui/SearchMenu.cc
   trunk/src/gui/TextField.cc
   trunk/src/gui/TextField.hh
   trunk/src/gui/widgets.cc
   trunk/src/gui/widgets.hh
   trunk/src/main.cc
   trunk/src/video.cc
   trunk/src/video.hh
Log:
trunk 1.1:
- screen resolution 320x240 by Clarence Risher, devel mailing list
- added autotool support
- fixed VMInfo entry
- added auto scaling of 32x32 graphics to 16x16
- added 60x39 thumbs with own extension, own subdir
- fix --makepreviews to ensure difficult mode of levels
- add 60x39 thumb generation to --makepreviews
- fix widgets: dynamic font load instead of static as font size differs
    for gfx16
- fix font cache: clear fonts on video mode change
TODO:
- auto scale 60x39 thumbs from existing 120x78 on demand
- add manually scaled gfx image versions to gfx16
- check all object images, add manually scaled images to gfx16 for bad
  scaled ones
- font cache: cleanup - remove double caching



Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/configure.ac	2008-01-06 16:27:59 UTC (rev 975)
@@ -353,6 +353,7 @@
 AC_CONFIG_FILES([Makefile m4/Makefile  intl/Makefile 
            data/Makefile
            data/gfx/Makefile
+           data/gfx16/Makefile
            data/gfx32/Makefile
            data/gfx40/Makefile
            data/gfx48/Makefile

Modified: trunk/data/Makefile.am
===================================================================
--- trunk/data/Makefile.am	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/data/Makefile.am	2008-01-06 16:27:59 UTC (rev 975)
@@ -1,4 +1,4 @@
-SUBDIRS = gfx fonts schemas levels sound soundsets gfx32 gfx40 gfx48 
+SUBDIRS = gfx fonts schemas levels sound soundsets gfx16 gfx32 gfx40 gfx48 
 
 pkgdata_DATA = \
 	enigma_conf.lua \
@@ -6,6 +6,7 @@
 	models-2d.lua \
 	models-oxyd.lua \
 	models-editor.lua \
+	models-16.lua \
 	models-32.lua \
 	models-40.lua \
 	models-48.lua \


Property changes on: trunk/data/gfx16
___________________________________________________________________
Name: svn:ignore
   + Makefile Makefile.in


Added: trunk/data/gfx16/Makefile.am
===================================================================
--- trunk/data/gfx16/Makefile.am	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/data/gfx16/Makefile.am	2008-01-06 16:27:59 UTC (rev 975)
@@ -0,0 +1,4 @@
+pkgdatadir = $(datadir)/@PACKAGE@/gfx16
+pkgdata_DATA = $(wildcard $(srcdir)/*.png $(srcdir)/*.jpg)
+EXTRA_DIST = $(pkgdata_DATA)
+


Property changes on: trunk/data/gfx16/Makefile.am
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/gfx16/inventory.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx16/inventory.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx16/menu_bg.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx16/menu_bg.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/models-16.lua
===================================================================
--- trunk/data/models-16.lua	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/data/models-16.lua	2008-01-06 16:27:59 UTC (rev 975)
@@ -0,0 +1,11 @@
+TileSize = 16
+SpriteSize = 20
+ShadowSize = 21
+DefineFont (&quot;timefont&quot;, &quot;vera_sans.ttf&quot;, 18, &quot;timefont&quot;, 180, 180, 180)
+DefineFont (&quot;smallalternative&quot;, &quot;DejaVuSansCondensed.ttf&quot;, 7, &quot;menufont&quot;)
+DefineFont (&quot;menufont&quot;, &quot;DejaVuSansCondensed.ttf&quot;, 9, &quot;menufont&quot;)
+DefineFont (&quot;levelmenu&quot;, &quot;DejaVuSansCondensed.ttf&quot;, 9, &quot;levelmenu&quot;)
+DefineFont (&quot;menufontsel&quot;, &quot;DejaVuSansCondensed.ttf&quot;, 10, &quot;menufont&quot;, 180, 180, 180)
+DefineFont (&quot;statusbarfont&quot;, &quot;DejaVuSansCondensed.ttf&quot;, 7, &quot;dreamorp24&quot;)
+
+dofile(FindDataFile(&quot;models-2d.lua&quot;))


Property changes on: trunk/data/models-16.lua
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:eol-style
   + native

Modified: trunk/src/d_models.cc
===================================================================
--- trunk/src/d_models.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/d_models.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -93,7 +93,6 @@
     };
 }
 
-
 /* -------------------- SurfaceCache -------------------- */
 
 Surface *SurfaceCache_Alpha::acquire(const std::string &amp;name) 
@@ -109,6 +108,10 @@
         ecl::Surface * es_zoom = es-&gt;zoom(es-&gt;width()*2, es-&gt;height()*2);
         delete es;
         es = es_zoom;
+    } else if (es != NULL &amp;&amp; vminfo-&gt;tt == video::VTS_16 &amp;&amp; filename.find(&quot;gfx32&quot;) != std::string::npos) {
+        ecl::Surface * es_zoom = es-&gt;zoom(es-&gt;width()/2, es-&gt;height()/2);
+        delete es;
+        es = es_zoom;
     }
     return es;
 }
@@ -143,11 +146,14 @@
         ecl::Surface * es_zoom = es-&gt;zoom(es-&gt;width()*2, es-&gt;height()*2);
         delete es;
         es = es_zoom;
+    } else if (es != NULL &amp;&amp; vminfo-&gt;tt == video::VTS_16 &amp;&amp; filename.find(&quot;gfx32&quot;) != std::string::npos) {
+        ecl::Surface * es_zoom = es-&gt;zoom(es-&gt;width()/2, es-&gt;height()/2);
+        delete es;
+        es = es_zoom;
     }
     return es;
 }
 
-
 /* -------------------- ModelManager -------------------- */
 
 ModelManager::ModelManager()
@@ -189,7 +195,6 @@
 }
 
 
-
 /* -------------------- Variables -------------------- */
 
 namespace
@@ -202,7 +207,7 @@
     Anim2d             *anim_templ = 0;
 }
 
-
+
 /* -------------------- Functions -------------------- */
 
 void display::InitModels() 
@@ -367,13 +372,11 @@
 }
 
 
-
 /* -------------------- Model -------------------- */
 void Model::get_extension (ecl::Rect &amp;r)
 {}
 
 
-
 /* -------------------- Image -------------------- */
 
 Image::Image(ecl::Surface *sfc)

Modified: trunk/src/enigma.cc
===================================================================
--- trunk/src/enigma.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/enigma.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -286,6 +286,11 @@
             else
                 m_fonts.insert (descr.name, descr);
         }
+        
+        void clear() {
+            PtrCache&lt;Font&gt;::clear();  // crazy double cache - TODO cleanup 
+            m_fonts.clear();
+        }
 
     private:
 
@@ -335,6 +340,10 @@
     return font_cache.get(name);
 }
 
+void ClearFontCache() {
+    font_cache.clear();
+}
+
 ecl::Surface *LoadImage(const char *name) 
 {
     string filename;

Modified: trunk/src/enigma.hh
===================================================================
--- trunk/src/enigma.hh	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/enigma.hh	2008-01-06 16:27:59 UTC (rev 975)
@@ -90,6 +90,7 @@
                      const char *bmf_name,
                      int r, int g, int b);
     ecl::Font *GetFont (const char *name);
+    void ClearFontCache();
 
     ecl::Surface *LoadImage (const char *name);
     ecl::Surface *GetImage (const char *name, const char *ext = &quot;.png&quot;);

Modified: trunk/src/file.cc
===================================================================
--- trunk/src/file.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/file.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -343,6 +343,10 @@
             fname = string(&quot;gfx32/&quot;) + basename;
             if (findFile(fname, filename))
                 return true;
+        } else if (vminfo-&gt;tt == video::VTS_16) {
+            fname = string(&quot;gfx32/&quot;) + basename;
+            if (findFile(fname, filename))
+                return true;
         }
         fname = string (&quot;gfx/&quot;) + basename;
         return findFile(fname, filename);

Modified: trunk/src/gui/ErrorMenu.cc
===================================================================
--- trunk/src/gui/ErrorMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/ErrorMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -32,7 +32,8 @@
             text (message), rejectQuit (false), laterQuit (false),
             quit (new gui::StaticTextButton(quitTitle, this)) {
         const video::VMInfo *vminfo = video::GetInfo();
-        add(quit, Rect(vminfo-&gt;width-170, vminfo-&gt;height-60, 150, 40));
+        const int vshrink = vminfo-&gt;width &lt; 640 ? 1 : 0;
+        add(quit, Rect(vminfo-&gt;width-(vshrink?85:170), vminfo-&gt;height-(vshrink?30:60), vshrink?75:150, vshrink?42:40));
     }
     
     ErrorMenu::ErrorMenu(std::string message, std::string quitTitle, std::string rejectTitle) : 
@@ -40,8 +41,9 @@
             quit (new gui::StaticTextButton(quitTitle, this)),
             reject (new gui::StaticTextButton(rejectTitle, this)) {
         const video::VMInfo *vminfo = video::GetInfo();
-        add(quit, Rect(vminfo-&gt;width-170, vminfo-&gt;height-60, 150, 40));
-        add(reject, Rect(vminfo-&gt;width-340, vminfo-&gt;height-60, 150, 40));
+        const int vshrink = vminfo-&gt;width &lt; 640 ? 1 : 0;
+        add(quit, Rect(vminfo-&gt;width-(vshrink?85:170), vminfo-&gt;height-(vshrink?30:60), vshrink?75:150, vshrink?42:40));
+        add(reject, Rect(vminfo-&gt;width-(vshrink?170:340), vminfo-&gt;height-(vshrink?30:60), vshrink?75:150, vshrink?42:40));
     }
     
     ErrorMenu::ErrorMenu(std::string message, std::string quitTitle, std::string rejectTitle,
@@ -51,9 +53,10 @@
             reject (new gui::StaticTextButton(rejectTitle, this)),
             later (new gui::StaticTextButton(laterTitle, this)) {
         const video::VMInfo *vminfo = video::GetInfo();
-        add(quit, Rect(vminfo-&gt;width-170, vminfo-&gt;height-60, 150, 40));
-        add(later, Rect(vminfo-&gt;width-340, vminfo-&gt;height-60, 150, 40));
-        add(reject, Rect(vminfo-&gt;width-510, vminfo-&gt;height-60, 150, 40));
+        const int vshrink = vminfo-&gt;width &lt; 640 ? 1 : 0;
+        add(quit, Rect(vminfo-&gt;width-(vshrink?85:170), vminfo-&gt;height-(vshrink?30:60), vshrink?75:150, vshrink?42:40));
+        add(later, Rect(vminfo-&gt;width-(vshrink?170:340), vminfo-&gt;height-(vshrink?30:60), vshrink?75:150, vshrink?42:40));
+        add(reject, Rect(vminfo-&gt;width-(vshrink?255:510), vminfo-&gt;height-(vshrink?30:60), vshrink?75:150, vshrink?42:40));
     }
     
     bool ErrorMenu::isRejectQuit() {

Modified: trunk/src/gui/HelpMenu.cc
===================================================================
--- trunk/src/gui/HelpMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/HelpMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -35,8 +35,9 @@
         cfg         (xoffset_)
     {
         const video::VMInfo &amp;vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width &lt; 640 ? 1 : 0;
         
-        add(ok, Rect(vminfo.width-170,vminfo.height-60,150,40));
+        add(ok, Rect(vminfo.width-(vshrink?85:170),vminfo.height-(vshrink?30:60),vshrink?75:150,vshrink?20:40));
     }
     
     bool HelpMenu::on_event (const SDL_Event &amp;e) 
@@ -58,17 +59,18 @@
     void HelpMenu::draw_background (ecl::GC &amp;gc) 
     {
         const video::VMInfo &amp;vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width &lt; 640 ? 1 : 0;
 
         blit(gc, 0,0, enigma::GetImage(&quot;menu_bg&quot;, &quot;.jpg&quot;));
         Font *f = enigma::GetFont(cfg.fontname.c_str());
     
-        int y = cfg.y0 + (vminfo.height - 480)/2;
-        int x = (vminfo.width-640)/2;
+        int x = (vminfo.width-(vshrink?320:640))/2;
+        int y = (cfg.y0/(vshrink?2:1)) + (vminfo.height - (vshrink?240:480))/2;
         for (int i = 0; helptext[i]; i += 2) 
         {
-            f-&gt;render (gc, cfg.x0 + x, y, _(helptext[i]));    // translate
-            f-&gt;render (gc, cfg.x1 + x, y, _(helptext[i+1]));  // translate
-            y += cfg.yskip;
+            f-&gt;render (gc, cfg.x0/(vshrink?2:1) + x, y, _(helptext[i]));    // translate
+            f-&gt;render (gc, cfg.x1/(vshrink?2:1) + x, y, _(helptext[i+1]));  // translate
+            y += cfg.yskip/(vshrink?2:1);
         }
     }
     

Modified: trunk/src/gui/InfoMenu.cc
===================================================================
--- trunk/src/gui/InfoMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/InfoMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -28,24 +28,26 @@
     InfoMenu::InfoMenu(const char **infotext, int pages) : info (infotext),
             curPage (0), numPages (pages) {
         const video::VMInfo &amp;vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width &lt; 640 ? 1 : 0;
 
         but_ok = new StaticTextButton(N_(&quot;Ok&quot;), this);
         pgup     = new ImageButton(&quot;ic-up&quot;, &quot;ic-up1&quot;, this);
         pgdown   = new ImageButton(&quot;ic-down&quot;, &quot;ic-down1&quot;, this);
 
-        add(but_ok, Rect(vminfo.width-120, vminfo.height-60, 100, 40));        
-        add(pgup, Rect(vminfo.width-30, vminfo.height/2, 20, 50));        
-        add(pgdown, Rect(vminfo.width-30, vminfo.height/2 +70, 20, 50));        
+        add(but_ok, Rect(vminfo.width-(vshrink?60:120), vminfo.height-(vshrink?30:60), vshrink?50:100, vshrink?20:40));        
+        add(pgup, Rect(vminfo.width-(vshrink?15:30), vminfo.height/2, vshrink?10:20, vshrink?25:50));        
+        add(pgdown, Rect(vminfo.width-(vshrink?15:30), vminfo.height/2 +(vshrink?35:70), vshrink?10:20, vshrink?25:50));        
     }
     
     void InfoMenu::draw_background(ecl::GC &amp;gc) {
         const video::VMInfo &amp;vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width &lt; 640 ? 1 : 0;
         blit(gc, vminfo.mbg_offsetx, vminfo.mbg_offsety, enigma::GetImage(&quot;menu_bg&quot;, &quot;.jpg&quot;));
         
         Font *f = enigma::GetFont(&quot;menufont&quot;);
         int row = 0;
-        int yoff[] = {0, -20, -40, -40};
-        int ygap[] = {0, 4, 6, 6};
+        int yoff[] = {0, 0, -20, -40, -40};
+        int ygap[] = {0, 0, 4, 6, 6};
         for (int p=0; p&lt;curPage; p++) {
             while (info[row])
                 row++;
@@ -54,8 +56,8 @@
         }
         for (int i = 0; info[row]; row++, i++) {
             const char *t = _(info[row]);
-            f-&gt;render (gc, 40 + (vminfo.width-640)/2, 
-                    20 + yoff[vminfo.tt] + (vminfo.height-480)/2 + i*(f-&gt;get_height() + ygap[vminfo.tt]), t);
+            f-&gt;render (gc, (vshrink?20:40) + (vminfo.width-(vshrink?320:640))/2, 
+                    (vshrink?10:20) + yoff[vminfo.tt] + (vminfo.height-(vshrink?240:480))/2 + i*(f-&gt;get_height() + ygap[vminfo.tt]), t);
         }
     }
     

Modified: trunk/src/gui/LPGroupConfig.cc
===================================================================
--- trunk/src/gui/LPGroupConfig.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/LPGroupConfig.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -33,6 +33,8 @@
 namespace enigma { namespace gui {
     LPGroupConfig::LPGroupConfig(std::string groupName) : oldGroupName (groupName) {
         const video::VMInfo &amp;vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width &lt; 640 ? 1 : 0;
+
         groups = lev::Index::getGroupNames();
         
         position = -1;
@@ -49,16 +51,16 @@
         }
 
         VList * titleVList = new VList;
-        titleVList-&gt;set_spacing(12);
+        titleVList-&gt;set_spacing(vshrink?6:12);
         titleVList-&gt;set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        titleVList-&gt;set_default_size(160, 35);
+        titleVList-&gt;set_default_size(vshrink?80:160, vshrink?17:35);
         Label * groupLabel = new Label(N_(&quot;Group:&quot;), HALIGN_RIGHT);
         titleVList-&gt;add_back(groupLabel);
         
         VList * groupsVList = new VList;
-        groupsVList-&gt;set_spacing(12);
+        groupsVList-&gt;set_spacing(vshrink?6:12);
         groupsVList-&gt;set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        groupsVList-&gt;set_default_size(160, 35);
+        groupsVList-&gt;set_default_size(vshrink?80:160, vshrink?17:35);
         
         Label * positionLabel = new Label(N_(&quot;Position:&quot;), HALIGN_LEFT);
         pre2Group = new UntranslatedLabel(&quot;&quot;);
@@ -77,21 +79,21 @@
         groupsVList-&gt;add_back(dummyLabel);
 
         VList * scrollVList = new VList;
-        scrollVList-&gt;set_spacing(12);
+        scrollVList-&gt;set_spacing(vshrink?6:12);
         scrollVList-&gt;set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        scrollVList-&gt;set_default_size(40, 35);
+        scrollVList-&gt;set_default_size(vshrink?20:40, vshrink?17:35);
 
         scrollUp = new ImageButton(&quot;ic-up&quot;, &quot;ic-up1&quot;, this);
         scrollDown = new ImageButton(&quot;ic-down&quot;, &quot;ic-down1&quot;, this);
         scrollVList-&gt;add_back(scrollUp);
         scrollVList-&gt;add_back(scrollDown);
 
-        this-&gt;add(titleVList, Rect(vminfo.width/2 - 290, 0, 160, vminfo.height-100));
-        this-&gt;add(groupsVList, Rect(vminfo.width/2 - 80, 0, 160, vminfo.height-100));
-        this-&gt;add(scrollVList, Rect(vminfo.width/2 + 130, 0, 40, vminfo.height-100));
+        this-&gt;add(titleVList, Rect(vminfo.width/2 - (vshrink?145:290), 0, (vshrink?80:160), vminfo.height-(vshrink?50:100)));
+        this-&gt;add(groupsVList, Rect(vminfo.width/2 - (vshrink?40:80), 0, (vshrink?80:160), vminfo.height-(vshrink?50:100)));
+        this-&gt;add(scrollVList, Rect(vminfo.width/2 + (vshrink?65:130), 0, (vshrink?20:40), vminfo.height-(vshrink?50:100)));
 
         errorLabel = new Label(&quot;&quot;, HALIGN_CENTER);
-        this-&gt;add(errorLabel, Rect(10, vminfo.height-100, vminfo.width-20, 35));
+        this-&gt;add(errorLabel, Rect((vshrink?5:10), vminfo.height-(vshrink?50:100), vminfo.width-(vshrink?10:20), (vshrink?17:35)));
         
         // Create buttons - positioning identical to Levelmenu
         but_newPack = new StaticTextButton(N_(&quot;New Pack&quot;), this);
@@ -100,14 +102,14 @@
         but_ok = new StaticTextButton(N_(&quot;Ok&quot;), this);
         
         HList * commandHList = new HList;
-        commandHList-&gt;set_spacing(10);
+        commandHList-&gt;set_spacing(vshrink?5:10);
         commandHList-&gt;set_alignment(HALIGN_CENTER, VALIGN_TOP);
-        commandHList-&gt;set_default_size(140, 35);
+        commandHList-&gt;set_default_size(vshrink?70:140, vshrink?17:35);
         commandHList-&gt;add_back(but_newPack);
         commandHList-&gt;add_back(but_delete);
         commandHList-&gt;add_back(but_ignore);
         commandHList-&gt;add_back(but_ok);
-        this-&gt;add(commandHList, Rect(10, vminfo.height-50, vminfo.width-20, 35));
+        this-&gt;add(commandHList, Rect(vshrink?5:10, vminfo.height-(vshrink?25:50), vminfo.width-(vshrink?10:20), vshrink?17:35));
         
         updateGroupList();
     }

Modified: trunk/src/gui/LevelInspector.cc
===================================================================
--- trunk/src/gui/LevelInspector.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/LevelInspector.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -181,15 +181,17 @@
         bool didGenerate;  // dummy
         previewImage = LevelPreviewCache::instance()-&gt;getPreview(aLevel, true, didGenerate);
         const video::VMInfo *vminfo = video::GetInfo();
-        vspacing = vminfo-&gt;height &lt; 500 ? 2 :(vminfo-&gt;height &lt; 650 ? 3 : 4);
-        vspacing2 = vminfo-&gt;height &lt; 500 ? 16 :(vminfo-&gt;height &lt; 650 ? 14 : 16);
-        vmargin = vminfo-&gt;height &lt; 500 ? 10 :(vminfo-&gt;height &lt; 650 ?  20 : 30);
-        hmargin = vminfo-&gt;width &lt; 660 ? 10 : (vminfo-&gt;width &lt; 900 ? 20 : 30);
+        const int vshrink = vminfo-&gt;width &lt; 640 ? 1 : 0;
+        vspacing = vminfo-&gt;height &lt; 400 ? 1 :(vminfo-&gt;height &lt; 500 ? 2 :(vminfo-&gt;height &lt; 650 ? 3 : 4));
+        vspacing2 = vminfo-&gt;height &lt; 400 ? 8 :(vminfo-&gt;height &lt; 500 ? 16 :(vminfo-&gt;height &lt; 650 ? 14 : 16));
+        vmargin = vminfo-&gt;height &lt; 400 ? 5 :(vminfo-&gt;height &lt; 500 ? 10 :(vminfo-&gt;height &lt; 650 ?  20 : 30));
+        hmargin = vminfo-&gt;width &lt; 640 ? 5 : (vminfo-&gt;width &lt; 660 ? 10 : (vminfo-&gt;width &lt; 900 ? 20 : 30));
         bool highres = vminfo-&gt;height &gt; 650 ? true : false;
         bool lowres = vminfo-&gt;height &lt; 600 ? true : false;
+        bool lowlowres = vminfo-&gt;height &lt; 400 ? true : false;
     
-        add(back, Rect(vminfo-&gt;width-130-2*hmargin,vminfo-&gt;height-50,130,35));
-        add(screenshot, Rect(vminfo-&gt;width-260-3*hmargin,vminfo-&gt;height-50,130,35));
+        add(back, Rect(vminfo-&gt;width-(vshrink?65:130)-2*hmargin,vminfo-&gt;height-(vshrink?25:50),vshrink?65:130,vshrink?17:35));
+        add(screenshot, Rect(vminfo-&gt;width-(vshrink?130:260)-3*hmargin,vminfo-&gt;height-(vshrink?25:50),vshrink?65:130,vshrink?17:35));
     
         try {
             aLevel-&gt;loadMetadata(true);
@@ -200,9 +202,9 @@
                                    + aLevel-&gt;getNormLevelPath() + &quot;'\n&quot;
                                    + err.what();
             ecl::split_copy (errmsg, '\n', back_inserter(lines));
-            int x     = 60;
-            int y     = 60;
-            int yskip = 25;
+            int x     = vshrink?30:60;
+            int y     = vshrink?30:60;
+            int yskip = vshrink?12:25;
             for (unsigned i=0; i&lt;lines.size(); ++i) {
                 add(new Label(lines[i], HALIGN_LEFT), Rect(x, y, vminfo-&gt;width-80,yskip));
                 y += yskip;
@@ -223,15 +225,15 @@
         for (std::string::size_type slpos = levelPathString.find('\\');
                 slpos != std::string::npos; slpos = levelPathString.find('\\')) 
             levelPathString.replace(slpos, 1, 1, '/');
-        BuildVList authorT(this, Rect(hmargin,vmargin,110,25), vspacing);
+        BuildVList authorT(this, Rect(hmargin,vmargin,vshrink?55:110,vshrink?12:25), vspacing);
         authorT.add(new Label(N_(&quot;Level: &quot;), HALIGN_RIGHT));
         authorT.add(new Label((&quot;&quot;), HALIGN_RIGHT)); // subtitle
         authorT.add(new Label(N_(&quot;Author: &quot;), HALIGN_RIGHT));
         authorT.add(new Label(N_(&quot;Contact: &quot;), HALIGN_RIGHT));
         authorT.add(new Label(N_(&quot;Homepage: &quot;), HALIGN_RIGHT));
         
-        BuildVList author(this, Rect(hmargin+110+10,vmargin,
-                vminfo-&gt;width-(hmargin+110+10)-10-(vminfo-&gt;thumbw+10)-hmargin,25), vspacing);
+        BuildVList author(this, Rect(hmargin+(vshrink?55+5:110+10),vmargin,
+                vminfo-&gt;width-(hmargin+(vshrink?55+5:110+10))-(vshrink?5:10)-(vminfo-&gt;thumbw+(vshrink?5:10))-hmargin,vshrink?12:25), vspacing);
         tmp = levelProxy-&gt;getTitle();
         tmp2 = levelProxy-&gt;getLocalizedString(&quot;title&quot;);
         if (tmp != tmp2)
@@ -243,14 +245,14 @@
         author.add(new Label(tmp, HALIGN_LEFT)); // subtitle
         author.add(new Label(levelProxy-&gt;getAuthor(), HALIGN_LEFT));
         
-        BuildVList address(this, Rect(hmargin+110+10,vmargin+3*(25+vspacing),
-                vminfo-&gt;width-(hmargin+110+10)-hmargin,25), vspacing);
+        BuildVList address(this, Rect(hmargin+(vshrink?55+5:110+10),vmargin+3*((vshrink?12:25)+vspacing),
+                vminfo-&gt;width-(hmargin+(vshrink?55+5:110+10))-hmargin,vshrink?12:25), vspacing);
         address.add(new Label(levelProxy-&gt;getContact(), HALIGN_LEFT));
         address.add(new Label(levelProxy-&gt;getHomepage(), HALIGN_LEFT));
         
-        BuildVList ratingPubT(this, Rect(hmargin+65,vmargin+5*25+4*vspacing+vspacing2, 130,25), 2);
+        BuildVList ratingPubT(this, Rect(hmargin+(vshrink?32:65),vmargin+5*(vshrink?12:25)+4*vspacing+vspacing2,vshrink?65:130,vshrink?12:25), vshrink?1:2);
         ratingPubT.add(new Label(N_(&quot;Public Ratings&quot;), HALIGN_CENTER));
-        BuildVList ratingPubST(this, Rect(hmargin,vmargin+6*25+5*vspacing+vspacing2, 130,25), 2);
+        BuildVList ratingPubST(this, Rect(hmargin,vmargin+6*(vshrink?12:25)+5*vspacing+vspacing2,vshrink?65:130,vshrink?12:25), vshrink?1:2);
         ratingPubST.add(new Label(N_(&quot;Intelligence: &quot;), HALIGN_RIGHT));
         ratingPubST.add(new Label(N_(&quot;Dexterity: &quot;), HALIGN_RIGHT));
         ratingPubST.add(new Label(N_(&quot;Patience: &quot;), HALIGN_RIGHT));
@@ -259,7 +261,7 @@
         if (!lowres) ratingPubST.add(new Label(N_(&quot;Difficulty: &quot;), HALIGN_RIGHT));
 
         
-        BuildVList ratingPub(this, Rect(hmargin+130+15,vmargin+6*25+5*vspacing+vspacing2, 30,25), 2);
+        BuildVList ratingPub(this, Rect(hmargin+(vshrink?65+7:130+15),vmargin+6*(vshrink?12:25)+5*vspacing+vspacing2,vshrink?15:30,vshrink?12:25),vshrink?1:2);
         if (WizardMode) {
             ratingPub.add(new IntelligenceButton(aLevel));
             ratingPub.add(new DexterityButton(aLevel));
@@ -276,10 +278,10 @@
             if (!lowres) ratingPub.add(new MonospacedLabel(ratingToString(theRatingMgr-&gt;getDifficulty(aLevel)).c_str(),'8', &quot; 0123456789&quot;, HALIGN_CENTER));
         }
         
-        BuildVList scoresT(this, Rect(vminfo-&gt;width/2-100-20,vmargin+5*25+4*vspacing+vspacing2,100,25), 2);
+        BuildVList scoresT(this, Rect(vminfo-&gt;width/2-(vshrink?50+10:100+20),vmargin+5*(vshrink?12:25)+4*vspacing+vspacing2,vshrink?50:100,vshrink?12:25), vshrink?1:2);
         scoresT.add(new Label(N_(&quot;Scores&quot;), HALIGN_RIGHT));
 
-        BuildVList scoresST(this, Rect(vminfo-&gt;width/2-100-20,vmargin+6*25+5*vspacing+vspacing2,100,25), 2);
+        BuildVList scoresST(this, Rect(vminfo-&gt;width/2-(vshrink?50+10:100+20),vmargin+6*(vshrink?12:25)+5*vspacing+vspacing2,vshrink?50:100,vshrink?12:25), vshrink?1:2);
         scoresST.add(new Label(N_(&quot;You: &quot;), HALIGN_RIGHT));
         scoresST.add(new Label(N_(&quot;World: &quot;), HALIGN_RIGHT));
 // TRANSLATORS: PAR = professional average rate - an expression used by golfers
@@ -288,8 +290,8 @@
         scoresST.add(new Label(N_(&quot;Solved %: &quot;), HALIGN_RIGHT));
         if (!lowres) scoresST.add(new Label(N_(&quot;Solved #: &quot;), HALIGN_RIGHT));
     
-        BuildVList scores(this, Rect(vminfo-&gt;width/2-15+(withEasy?0:20),
-                vmargin+6*25+5*vspacing+vspacing2,(withEasy?117:54),25), 2);
+        BuildVList scores(this, Rect(vminfo-&gt;width/2-(vshrink?7-(withEasy?0:10):15-(withEasy?0:20)),
+                vmargin+6*(vshrink?12:25)+5*vspacing+vspacing2,vshrink?(withEasy?53:27):(withEasy?117:54),vshrink?12:25), vshrink?1:2);
         scores.add(new MonospacedLabel(scoreToString(theScoreMgr-&gt;getBestUserScore(aLevel, DIFFICULTY_EASY),
             theScoreMgr-&gt;getBestUserScore(aLevel, DIFFICULTY_HARD),aLevel,true).c_str(),'8', &quot; 0123456789&quot;, HALIGN_CENTER));
         scores.add(new MonospacedLabel(scoreToString(theRatingMgr-&gt;getBestScoreEasy(aLevel),
@@ -307,9 +309,9 @@
             (ecl::strf(&quot;%5d&quot;, theRatingMgr-&gt;getNumSolvedDifficult(aLevel)) + &quot; &quot;).c_str(),
             '8', &quot; 0123456789&quot;, HALIGN_CENTER));        
         
-        BuildVList versionT(this, Rect(vminfo-&gt;width-100/2-90-2*hmargin,vmargin+5*25+4*vspacing+vspacing2,100,25), 2);
+        BuildVList versionT(this, Rect(vminfo-&gt;width-(vshrink?50/2+45:100/2+90)-2*hmargin,vmargin+5*(vshrink?12:25)+4*vspacing+vspacing2,vshrink?50:100,vshrink?12:25), vshrink?1:2);
         versionT.add(new Label(N_(&quot;Version&quot;), HALIGN_CENTER));
-        BuildVList versionST(this, Rect(vminfo-&gt;width-110-90-2*hmargin,vmargin+6*25+5*vspacing+vspacing2,110,25), 2);
+        BuildVList versionST(this, Rect(vminfo-&gt;width-(vshrink?55+45:110+90)-2*hmargin,vmargin+6*(vshrink?12:25)+5*vspacing+vspacing2,vshrink?55:110,vshrink?12:25), vshrink?1:2);
         if (!lowres || aLevel-&gt;getLevelStatus() == lev::STATUS_RELEASED)
             versionST.add(new Label(N_(&quot;Score: &quot;), HALIGN_RIGHT));
         else
@@ -321,7 +323,7 @@
         versionST.add(new Label(N_(&quot;Control: &quot;), HALIGN_RIGHT));
         versionST.add(new Label(N_(&quot;Target: &quot;), HALIGN_RIGHT));
 
-        BuildVList version(this, Rect(vminfo-&gt;width-80-2*hmargin,vmargin+6*25+5*vspacing+vspacing2,80+2*hmargin,25), 2);
+        BuildVList version(this, Rect(vminfo-&gt;width-(vshrink?40:80)-2*hmargin,vmargin+6*(vshrink?12:25)+5*vspacing+vspacing2,(vshrink?40:80)+2*hmargin,vshrink?12:25), vshrink?1:2);
         if (!lowres || aLevel-&gt;getLevelStatus() == lev::STATUS_RELEASED)
             version.add(new MonospacedLabel(ecl::strf(&quot;%6d&quot;, aLevel-&gt;getScoreVersion()).c_str(),
                     '8', &quot; 0123456789&quot;, HALIGN_LEFT));
@@ -379,13 +381,13 @@
         int annotationLines = 0; 
         int compatibilityLines = 0; 
         int idLines = 0; 
-        int vnext = vmargin+ (lowres?11:12)*25+(lowres?9:10)*vspacing+2*vspacing2;
-        int textwidth = vminfo-&gt;width-3*hmargin-110-10;
+        int vnext = vmargin+(lowres?11:12)*(vshrink?12:25)+(lowlowres?5:lowres?9:10)*vspacing+2*vspacing2;
+        int textwidth = vminfo-&gt;width-3*hmargin-(vshrink?55+5:110+10);
         dispatchBottomLines(bestScoreHolderLines, creditsLines, dedicationLines,
                 levelPathLines, annotationLines, compatibilityLines, idLines,
-                (vminfo-&gt;height-vnext-vmargin-25-vspacing2)/27, textwidth);
+                (vminfo-&gt;height-vnext-vmargin-(vshrink?12:25)-vspacing2)/(vshrink?13:27), textwidth);
         if (bestScoreHolderLines == 1) {
-            add(new Label(N_(&quot;World Record Holders: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,200,25));
+            add(new Label(N_(&quot;World Record Holders: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?100:200,vshrink?12:25));
             std::string holders;
             if (withEasy) {
                 holders = theRatingMgr-&gt;getBestScoreEasyHolder(aLevel);
@@ -398,7 +400,7 @@
             else
                 holders += theRatingMgr-&gt;getBestScoreDifficultHolder(aLevel);
             Label *wrLabel = new Label(holders, HALIGN_LEFT);
-            add(wrLabel, Rect(hmargin+200+10,vnext,textwidth-90,25));
+            add(wrLabel, Rect(hmargin+(vshrink?100+5:200+10),vnext,textwidth-(vshrink?45:90),vshrink?12:25));
             if (!wrLabel-&gt;text_fits()) {
                 int cutEasy = 0;
                 int cutDiff = 0;
@@ -443,49 +445,49 @@
                     }
                 }
             }
-            vnext += 25 + vspacing;
+            vnext += (vshrink?12:25) + vspacing;
         }
         if (creditsLines &gt;= 1) {
-            add(new Label(N_(&quot;Credits: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
+            add(new Label(N_(&quot;Credits: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
             std::string creditsString = levelProxy-&gt;getCredits(true);
             for (int i = 0; i&lt; creditsLines; i++) {
                 std::string::size_type breakPos = breakString(menufont, creditsString, 
                         &quot; &quot;, textwidth);
-                add(new Label(creditsString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+110+10,vnext,textwidth,25));
+                add(new Label(creditsString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+(vshrink?55+5:110+10),vnext,textwidth,vshrink?12:25));
                 creditsString = creditsString.substr(breakPos);
-                vnext += (25 + vspacing);
+                vnext += ((vshrink?12:25) + vspacing);
             }
         }
         if (dedicationLines &gt;= 1) {
-            add(new Label(N_(&quot;Dedication: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
+            add(new Label(N_(&quot;Dedication: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
             std::string dedicationString = levelProxy-&gt;getDedication(true);
             for (int i = 0; i&lt; dedicationLines; i++) {
                 std::string::size_type breakPos = breakString( menufont, dedicationString, 
                         &quot; &quot;, textwidth);
-                add(new Label(dedicationString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+110+10,vnext,textwidth,25));
+                add(new Label(dedicationString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+(vshrink?55+5:110+10),vnext,textwidth,vshrink?12:25));
                 dedicationString = dedicationString.substr(breakPos);
-                vnext += (25 + vspacing);
+                vnext += ((vshrink?12:25) + vspacing);
             }
         }
         if (levelPathLines &gt;= 1) {
-            add(new Label(N_(&quot;Level Path: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
+            add(new Label(N_(&quot;Level Path: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
             std::string workString = levelPathString;
             for (int i = 0; i&lt; levelPathLines - 1; i++) {
                 std::string::size_type breakPos = breakString(menufont, workString, 
                         &quot;/&quot;, textwidth);
-                add(new Label(workString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+110+10,vnext,textwidth,25));
+                add(new Label(workString.substr(0,breakPos), HALIGN_LEFT), Rect(hmargin+(vshrink?55+5:110+10),vnext,textwidth,vshrink?12:25));
                 workString = workString.substr(breakPos);
-                vnext += (25 + vspacing);
+                vnext += ((vshrink?12:25) + vspacing);
             }
             // show as much as possible from last line
             if (menufont-&gt;get_width(workString.c_str()) &gt; textwidth) {
                 // show the filename at the end - skip leading parts if necessary
-                add(new Label(workString, HALIGN_RIGHT), Rect(hmargin+110+10,vnext,textwidth,25));
+                add(new Label(workString, HALIGN_RIGHT), Rect(hmargin+(vshrink?55+5:110+10),vnext,textwidth,vshrink?12:25));
             } else {
                 // display up to the last character
-                add(new Label(workString, HALIGN_LEFT), Rect(hmargin+110+10,vnext,textwidth,25));
+                add(new Label(workString, HALIGN_LEFT), Rect(hmargin+(vshrink?55+5:110+10),vnext,textwidth,vshrink?12:25));
             }
-            vnext += (25 + vspacing);
+            vnext += ((vshrink?12:25) + vspacing);
         }
         if (idLines &gt;= 1) {
             add(new Label(N_(&quot;Id: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
@@ -493,23 +495,23 @@
             vnext += (25 + vspacing)*idLines;
         }
         if (compatibilityLines &gt;= 1) {
-            add(new Label(N_(&quot;Compatibility: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
+            add(new Label(N_(&quot;Compatibility: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
             std::string compString = ecl::strf(&quot;Enigma v%.2f  /  &quot;, levelProxy-&gt;getEnigmaCompatibility()) +
                     GetGameTypeName(levelProxy-&gt;getEngineCompatibility());
-            add(new Label(compString , HALIGN_LEFT),Rect(hmargin+110+10, vnext, textwidth, 25));
-            vnext += (25 + vspacing)*compatibilityLines;
+            add(new Label(compString , HALIGN_LEFT),Rect(hmargin+(vshrink?55+5:110+10), vnext, textwidth, vshrink?12:25));
+            vnext += ((vshrink?12:25) + vspacing)*compatibilityLines;
         }
         annotation-&gt;set_text(app.state-&gt;getAnnotation(levelProxy-&gt;getId())); // field needs to initialized for saves
         if (annotationLines &gt;= 1) {
-            add(new Label(N_(&quot;Annotation: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
-            add(annotation, Rect(hmargin+110+10, vnext, textwidth, 25));
-            vnext += (25 + vspacing)*annotationLines;
+            add(new Label(N_(&quot;Annotation: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
+            add(annotation, Rect(hmargin+(vshrink?55+5:110+10), vnext, textwidth, vshrink?12:25));
+            vnext += ((vshrink?12:25) + vspacing)*annotationLines;
         }
         vnext += vspacing2 - vspacing;
-        add(new Label(N_(&quot;Rating: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,110,25));
-        add(new RatingButton(aLevel),Rect(hmargin+110+10,vnext,40,25));
-        add(new Label(N_(&quot;Average: &quot;), HALIGN_RIGHT),Rect(hmargin+110+10+40+20,vnext,105,25));
-        add(new Label(theRatingMgr-&gt;getAverageRating(aLevel), HALIGN_RIGHT),Rect(hmargin+110+10+40+18+105+6,vnext,31,25));
+        add(new Label(N_(&quot;Rating: &quot;), HALIGN_RIGHT),Rect(hmargin,vnext,vshrink?55:110,vshrink?12:25));
+        add(new RatingButton(aLevel),Rect(hmargin+(vshrink?55+5:110+10),vnext,vshrink?20:40,vshrink?12:25));
+        add(new Label(N_(&quot;Average: &quot;), HALIGN_RIGHT),Rect(hmargin+(vshrink?55+5+20+10:110+10+40+20),vnext,vshrink?52:105,vshrink?12:25));
+        add(new Label(theRatingMgr-&gt;getAverageRating(aLevel), HALIGN_RIGHT),Rect(hmargin+(vshrink?55+5+20+9+52+3:110+10+40+18+105+6),vnext,vshrink?15:31,vshrink?12:25));
     }
     
     LevelInspector::~LevelInspector () {
@@ -571,6 +573,7 @@
     
     void LevelInspector::draw_background(ecl::GC &amp;gc) {
         const video::VMInfo *vminfo = video::GetInfo();
+        const int vshrink = vminfo-&gt;width &lt; 640 ? 1 : 0;
         video::SetCaption((std::string(&quot;Enigma - Level &quot;) + 
             (isDeveloperMode ? &quot;Developer &quot; : &quot;&quot;) + &quot;Inspector&quot;).c_str());
         blit(gc, vminfo-&gt;mbg_offsetx, vminfo-&gt;mbg_offsety, enigma::GetImage(&quot;menu_bg&quot;, &quot;.jpg&quot;));
@@ -578,16 +581,16 @@
         Surface *img_hard = enigma::GetImage(&quot;completed&quot;);
         if (withEasy) {
             Surface *img_easy = enigma::GetImage(&quot;completed-easy&quot;);
-            blit (gc, vminfo-&gt;width/2-4, vmargin+5*25+4*vspacing+vspacing2, img_easy);
-            blit (gc, vminfo-&gt;width/2-4+63, vmargin+5*25+4*vspacing+vspacing2, img_hard);
+            blit (gc, vminfo-&gt;width/2-(vshrink?2:4), vmargin+5*(vshrink?12:25)+4*vspacing+vspacing2, img_easy);
+            blit (gc, vminfo-&gt;width/2-(vshrink?2-31:4-63), vmargin+5*(vshrink?12:25)+4*vspacing+vspacing2, img_hard);
         } else {
-            blit (gc, vminfo-&gt;width/2-4+20, vmargin+5*25+4*vspacing+vspacing2, img_hard);
+            blit (gc, vminfo-&gt;width/2-(vshrink?2-10:4-20), vmargin+5*(vshrink?12:25)+4*vspacing+vspacing2, img_hard);
         }
         Surface *img_changed = enigma::GetImage(&quot;changed&quot;);
         ratingInherited = lev::ScoreManager::instance()-&gt;isRatingInherited(levelProxy);
         if (ratingInherited) {
-            int numLines = vminfo-&gt;height &lt; 500 ? 14 :(vminfo-&gt;height &lt; 650 ? 18 : 19);
-            blit (gc, hmargin+110+10+40, vmargin + numLines*25 +
+            int numLines = vminfo-&gt;height &lt; 400 ? 10 :(vminfo-&gt;height &lt; 500 ? 14 :(vminfo-&gt;height &lt; 650 ? 18 : 19));
+            blit (gc, hmargin+(vshrink?55+5+20:110+10+40), vmargin + numLines*(vshrink?12:25) +
                     (numLines-3)*vspacing + 3*vspacing2, img_changed);        
         }
     }

Modified: trunk/src/gui/LevelMenu.cc
===================================================================
--- trunk/src/gui/LevelMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/LevelMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -58,6 +58,12 @@
             int hsize_nav, hmargin_nav, vsize_nav, vgap_info_nav, vgap_nav_nav, vgap_nav1_nav2;
             int hsize_button_small, hsize_button_large, hgap_button, vsize_button, vmargin_bottom;
         } param[] = {
+            {  // VTS_16 (320x240)
+                2, 5, 10, 14,
+                5, 5, 5, 5,
+                10, 5, 25, 10, 5, 45,
+                45, 70, 5, 17, 7
+            },
             {  // VTS_32 (640x480)
                 5, 10, 20, 28,
                 10, 10, 10, 10,
@@ -85,6 +91,7 @@
         };
 
         const video::VMInfo &amp;vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width &lt; 640 ? 1 : 0;
         video::VideoModes vm = vminfo.videomode;
         video::VideoTileType vtt = vminfo.tt;
         
@@ -114,7 +121,7 @@
         hlr-&gt;add_back (but_back);
         
         hl = new HList;
-        hl-&gt;set_spacing (10);
+        hl-&gt;set_spacing (vshrink?5:10);
         hl-&gt;set_alignment (HALIGN_CENTER, VALIGN_TOP);
         hl-&gt;set_default_size (2*param[vtt].hsize_button_large + param[vtt].hgap_button, param[vtt].vsize_button);
         hl-&gt;add_back (hll);

Modified: trunk/src/gui/LevelPackConfig.cc
===================================================================
--- trunk/src/gui/LevelPackConfig.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/LevelPackConfig.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -85,6 +85,7 @@
             bool forceGroupReasign) : isReasignOnly (forceGroupReasign), 
             undo_quit (false), didEditMetaData (false), titleTF (NULL) {
         const video::VMInfo &amp;vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width &lt; 640 ? 1 : 0;
         
         if (indexName.empty())
             // new levelpack
@@ -148,9 +149,9 @@
         }
 
         VList * titleLeftVList = new VList;
-        titleLeftVList-&gt;set_spacing(11);
+        titleLeftVList-&gt;set_spacing(vshrink?5:11);
         titleLeftVList-&gt;set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        titleLeftVList-&gt;set_default_size(140, 35);
+        titleLeftVList-&gt;set_default_size(vshrink?70:140, vshrink?17:35);
         Label * titleLabel = new Label(N_(&quot;Levelpack:&quot;), HALIGN_RIGHT);
         Label * ownerLabel = new Label(N_(&quot;Owner:&quot;), HALIGN_RIGHT);
         Label * groupLabel = new Label(N_(&quot;Group:&quot;), HALIGN_RIGHT);
@@ -170,9 +171,9 @@
         }
         
         valueLeftVList = new VList;
-        valueLeftVList-&gt;set_spacing(11);
+        valueLeftVList-&gt;set_spacing(vshrink?5:11);
         valueLeftVList-&gt;set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        valueLeftVList-&gt;set_default_size(160, 35);
+        valueLeftVList-&gt;set_default_size(vshrink?80:160, vshrink?17:35);
 
         titleValueLabel = new UntranslatedLabel(indexName, HALIGN_CENTER);
         ownerValueLabel = new UntranslatedLabel(isPersistent ? persIndex-&gt;getOwner() : &quot;System&quot;);
@@ -197,9 +198,9 @@
         }
 
         VList * scrollVList = new VList;
-        scrollVList-&gt;set_spacing(12);
+        scrollVList-&gt;set_spacing(vshrink?6:12);
         scrollVList-&gt;set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        scrollVList-&gt;set_default_size(30, 35);
+        scrollVList-&gt;set_default_size(vshrink?15:30, vshrink?17:35);
 
         scrollUp = new ImageButton(&quot;ic-up&quot;, &quot;ic-up1&quot;, this);
         scrollDown = new ImageButton(&quot;ic-down&quot;, &quot;ic-down1&quot;, this);
@@ -207,9 +208,9 @@
         scrollVList-&gt;add_back(scrollDown);
 
         VList * metaVList = new VList;
-        metaVList-&gt;set_spacing(12);
+        metaVList-&gt;set_spacing(vshrink?6:12);
         metaVList-&gt;set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        metaVList-&gt;set_default_size(140, 35);
+        metaVList-&gt;set_default_size(vshrink?70:140, vshrink?17:35);
         
         if (isEditable)
             but_metadata = new StaticTextButton(N_(&quot;Edit Metadata&quot;), this);
@@ -242,9 +243,9 @@
         }
 
         valueMetaVList = new VList;
-        valueMetaVList-&gt;set_spacing(12);
+        valueMetaVList-&gt;set_spacing(vshrink?6:12);
         valueMetaVList-&gt;set_alignment(HALIGN_CENTER, VALIGN_CENTER);
-        valueMetaVList-&gt;set_default_size(75, 35);
+        valueMetaVList-&gt;set_default_size(vshrink?37:75, vshrink?17:35);
         Widget * levelmodeWidget;
         if (indexName.empty()){
             levelmode = new LevelmodeButton(false);
@@ -279,19 +280,32 @@
         }
         
 
-        if (isReasignOnly) {        
-            this-&gt;add(titleLeftVList, Rect(vminfo.width/2 - 270, 15, 140, vminfo.height-97));
-            this-&gt;add(valueLeftVList, Rect(vminfo.width/2 - 80, 15, 160, vminfo.height-97));
+        if (vshrink) {
+            if (isReasignOnly) {        
+                this-&gt;add(titleLeftVList, Rect(vminfo.width/2 - 135, 7, 70, vminfo.height-48));
+                this-&gt;add(valueLeftVList, Rect(vminfo.width/2 - 40, 7, 80, vminfo.height-48));
+            } else {
+                this-&gt;add(titleLeftVList, Rect(vminfo.width/2 - 150, 7, 70, vminfo.height-48));
+                this-&gt;add(valueLeftVList, Rect(vminfo.width/2 - 70, 7, 80, vminfo.height-48));
+                this-&gt;add(scrollVList, Rect(vminfo.width/2 + 15, 7+3*(17+6) + (vminfo.height-240)/2, 15, 5*17+4*6));
+                this-&gt;add(metaVList, Rect(vminfo.width/2 + 40, 7, 70, vminfo.height-48));
+                this-&gt;add(valueMetaVList, Rect(vminfo.width/2 + 117, 7, 37, vminfo.height-48));
+            }
         } else {
-            this-&gt;add(titleLeftVList, Rect(vminfo.width/2 - 300, 15, 140, vminfo.height-97));
-            this-&gt;add(valueLeftVList, Rect(vminfo.width/2 - 140, 15, 160, vminfo.height-97));
-            this-&gt;add(scrollVList, Rect(vminfo.width/2 + 30, 15+3*(35+12) + (vminfo.height-480)/2, 30, 5*35+4*12));
-            this-&gt;add(metaVList, Rect(vminfo.width/2 + 80, 15, 140, vminfo.height-97));
-            this-&gt;add(valueMetaVList, Rect(vminfo.width/2 + 235, 15, 75, vminfo.height-97));
+            if (isReasignOnly) {        
+                this-&gt;add(titleLeftVList, Rect(vminfo.width/2 - 270, 15, 140, vminfo.height-97));
+                this-&gt;add(valueLeftVList, Rect(vminfo.width/2 - 80, 15, 160, vminfo.height-97));
+            } else {
+                this-&gt;add(titleLeftVList, Rect(vminfo.width/2 - 300, 15, 140, vminfo.height-97));
+                this-&gt;add(valueLeftVList, Rect(vminfo.width/2 - 140, 15, 160, vminfo.height-97));
+                this-&gt;add(scrollVList, Rect(vminfo.width/2 + 30, 15+3*(35+12) + (vminfo.height-480)/2, 30, 5*35+4*12));
+                this-&gt;add(metaVList, Rect(vminfo.width/2 + 80, 15, 140, vminfo.height-97));
+                this-&gt;add(valueMetaVList, Rect(vminfo.width/2 + 235, 15, 75, vminfo.height-97));
+            }
         }
     
         errorLabel = new Label(&quot;&quot;, HALIGN_CENTER);
-        this-&gt;add(errorLabel, Rect(10, vminfo.height-97, vminfo.width-20, 35));
+        this-&gt;add(errorLabel, Rect(vshrink?5:10, vminfo.height-(vshrink?48:97), vminfo.width-(vshrink?10:20), vshrink?17:35));
         
         if (isReasignOnly) 
             errorLabel-&gt;set_text(N_(&quot;Please reasign levelpack to another group for group deletion&quot;));
@@ -307,9 +321,9 @@
         but_back = new StaticTextButton(N_(&quot;Ok&quot;), this);
         
         HList * commandHList = new HList;
-        commandHList-&gt;set_spacing(10);
+        commandHList-&gt;set_spacing(vshrink?5:10);
         commandHList-&gt;set_alignment(HALIGN_CENTER, VALIGN_TOP);
-        commandHList-&gt;set_default_size(140, 35);
+        commandHList-&gt;set_default_size(vshrink?70:140, vshrink?17:35);
         if (isReasignOnly) {
             commandHList-&gt;add_back(new Label());
             commandHList-&gt;add_back(new Label());
@@ -319,7 +333,7 @@
         }
         commandHList-&gt;add_back(but_ignore);
         commandHList-&gt;add_back(but_back);
-        this-&gt;add(commandHList, Rect(10, vminfo.height-50, vminfo.width-20, 35));
+        this-&gt;add(commandHList, Rect(vshrink?5:10, vminfo.height-(vshrink?25:50), vminfo.width-(vshrink?10:20), vshrink?17:35));
         
         updateLocationList();
         if (indexName.empty())

Modified: trunk/src/gui/LevelPackMenu.cc
===================================================================
--- trunk/src/gui/LevelPackMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/LevelPackMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -54,6 +54,7 @@
             scrollLeft (NULL), scrollRight (NULL), scrollUp (NULL),
             scrollDown (NULL), isLevelMenuSubmenu (false) {
         const video::VMInfo &amp;vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width &lt; 640 ? 1 : 0;
         vm = vminfo.videomode;
         vtt = vminfo.tt;
         vh = vminfo.area.x;
@@ -66,14 +67,14 @@
         but_main = new StaticTextButton(N_(&quot;Main Menu&quot;), this);
         
         commandHList = new HList;
-        commandHList-&gt;set_spacing(10);
+        commandHList-&gt;set_spacing(vshrink ? 5 : 10);
         commandHList-&gt;set_alignment(HALIGN_CENTER, VALIGN_TOP);
-        commandHList-&gt;set_default_size(140, 35);
+        commandHList-&gt;set_default_size(vshrink ? 70 : 140, vshrink ? 17 : 35);
         commandHList-&gt;add_back(but_new);
         commandHList-&gt;add_back(but_search);
         commandHList-&gt;add_back(but_level);
         commandHList-&gt;add_back(but_main);
-        this-&gt;add(commandHList, Rect(10, vminfo.height-50, vminfo.width-20, 35));
+        this-&gt;add(commandHList, Rect(vshrink ? 5 : 10, vminfo.height-(vshrink ? 25 : 50), vminfo.width-(vshrink ? 10 : 20), vminfo.height &lt; 320 ? 17 : 35));
         
     }
     
@@ -83,6 +84,11 @@
             int vmargin, vrow_row;
             int hmargin, hgroup_pack, hscrollbutton, hscroll_pack, hpack_pack;
         } param[] = {
+            {  // VTS_16 (320x240)
+                2, 9,
+                7, 5,
+                10, 18, 11, 5, 10
+            },
             {  // VTS_32 (640x480)
                 2, 9,
                 15, 10,
@@ -180,7 +186,7 @@
         groupsVList = new VList; 
         groupsVList-&gt;set_spacing(param[vtt].vrow_row);
         groupsVList-&gt;set_alignment(HALIGN_LEFT, VALIGN_CENTER);
-        groupsVList-&gt;set_default_size(160, 35);
+        groupsVList-&gt;set_default_size(vtt==0 ? 80 : 160, vtt==0 ? 17 : 35);
         
         for (int i = 0; i &lt; usedGroupRows; i++) {
             if (i == 0 &amp;&amp; needUpScroll) {
@@ -198,7 +204,7 @@
         }
 
         this-&gt;add(groupsVList, Rect(param[vtt].hmargin + vh, param[vtt].vmargin + vv, 
-                160, param[vtt].rows * 35 + 
+                vtt==0 ? 80 : 160, param[vtt].rows * (vtt==0 ? 17 : 35) + 
                 (param[vtt].rows - 1) * param[vtt].vrow_row));
         
         lastGroupName = curGroupName;
@@ -251,7 +257,7 @@
         packsHList = new HList; 
         packsHList-&gt;set_spacing(param[vtt].hpack_pack);
         packsHList-&gt;set_alignment(HALIGN_CENTER, VALIGN_TOP);
-        packsHList-&gt;set_default_size(160, param[vtt].rows*35 + 
+        packsHList-&gt;set_default_size(vtt==0 ? 80 : 160, param[vtt].rows*(vtt==0 ? 17 : 35) + 
                 (param[vtt].rows - 1) * param[vtt].vrow_row);
         
         for (int col = 0; col &lt; param[vtt].packcolumns; col++) {
@@ -260,7 +266,7 @@
                 pl-&gt;set_spacing (param[vtt].vrow_row);
                 // first column is centered - if it is full it is like top alignment:
                 pl-&gt;set_alignment (HALIGN_LEFT, col == 0 ? VALIGN_CENTER : VALIGN_TOP);
-                pl-&gt;set_default_size (160, 35);
+                pl-&gt;set_default_size (vtt==0 ? 80 : 160, vtt==0 ? 17 : 35);
                 for (int row = 0; row &lt; param[vtt].rows; row++) {
                     if (nextPack &lt; packCount) {
                         lev::Index *ind = (*group)[nextPack];
@@ -276,29 +282,29 @@
                 break;
         }
 
-        this-&gt;add(packsHList, Rect(param[vtt].hmargin + vh + 160 + param[vtt].hgroup_pack +
+        this-&gt;add(packsHList, Rect(param[vtt].hmargin + vh + (vtt==0 ? 80 : 160) + param[vtt].hgroup_pack +
                 param[vtt].hscrollbutton + param[vtt].hscroll_pack, 
                 param[vtt].vmargin + vv, 
-                param[vtt].packcolumns * 160 + (param[vtt].packcolumns - 1) * 
+                param[vtt].packcolumns * (vtt==0 ? 80 : 160) + (param[vtt].packcolumns - 1) * 
                 param[vtt].hpack_pack, 
-                param[vtt].rows * 35 + 
+                param[vtt].rows * (vtt==0 ? 17 : 35) + 
                 (param[vtt].rows - 1) * param[vtt].vrow_row));
         
         if (needLeftScroll) {
             scrollLeft = new ImageButton(&quot;ic-left&quot;, &quot;ic-left1&quot;, this);
-            this-&gt;add(scrollLeft, Rect(param[vtt].hmargin + vh + 160 + param[vtt].hgroup_pack,
-                    param[vtt].vmargin + vv + param[vtt].rows / 2 * (35 + param[vtt].vrow_row),
-                    param[vtt].hscrollbutton, 35));
+            this-&gt;add(scrollLeft, Rect(param[vtt].hmargin + vh + (vtt==0 ? 80 : 160) + param[vtt].hgroup_pack,
+                    param[vtt].vmargin + vv + param[vtt].rows / 2 * ((vtt==0 ? 17 : 35) + param[vtt].vrow_row),
+                    param[vtt].hscrollbutton, (vtt==0 ? 17 : 35)));
         }
                 
         if (needRightScroll) {
             scrollRight = new ImageButton(&quot;ic-right&quot;, &quot;ic-right1&quot;, this);
-            this-&gt;add(scrollRight, Rect(param[vtt].hmargin + vh + 160 + param[vtt].hgroup_pack +
+            this-&gt;add(scrollRight, Rect(param[vtt].hmargin + vh + (vtt==0 ? 80 : 160) + param[vtt].hgroup_pack +
                     param[vtt].hscrollbutton + 2 * param[vtt].hscroll_pack +
-                    param[vtt].packcolumns * 160 + (param[vtt].packcolumns - 1) * 
+                    param[vtt].packcolumns * (vtt==0 ? 80 : 160) + (param[vtt].packcolumns - 1) * 
                     param[vtt].hpack_pack,
-                    param[vtt].vmargin + vv+ param[vtt].rows / 2 * (35 + param[vtt].vrow_row),
-                    param[vtt].hscrollbutton, 35));
+                    param[vtt].vmargin + vv+ param[vtt].rows / 2 * ((vtt==0 ? 17 : 35) + param[vtt].vrow_row),
+                    param[vtt].hscrollbutton, (vtt==0 ? 17 : 35)));
         }
     }
     

Modified: trunk/src/gui/LevelWidget.cc
===================================================================
--- trunk/src/gui/LevelWidget.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/LevelWidget.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -46,9 +46,10 @@
             listener(0), isInvalidateUptodate (true), lastUpdate (0)
     {
         const video::VMInfo &amp;vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width &lt; 640 ? 1 : 0;
     
-        buttonw = vminfo.thumbw + 27;  // min should be +30 for all modes but 640x480
-        buttonh = vminfo.thumbh + 28;
+        buttonw = vminfo.thumbw + (vshrink?13:27);  // min should be +30 for all modes but 640x480
+        buttonh = vminfo.thumbh + (vshrink?14:28);
         curIndex = lev::Index::getCurrentIndex();
         iselected = curIndex-&gt;getCurrentPosition();
         ifirst = curIndex-&gt;getScreenFirstPosition();

Modified: trunk/src/gui/MainMenu.cc
===================================================================
--- trunk/src/gui/MainMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/MainMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -49,6 +49,7 @@
     void ChangeVideoMode()
     {
         enigma::WorldPrepareLevel();      // make sure no references to models remain
+        enigma::ClearFontCache();
         video::ChangeVideoMode();
         LevelPreviewCache::instance()-&gt;clear();
         enigma::ClearImageCache();
@@ -210,9 +211,9 @@
     void MainMenu::build_menu() 
     {
         const video::VMInfo *vminfo = video::GetInfo();
-    
-        int y[] = {150, 170, 200, 200};
-        BuildVList b(this, Rect((vminfo-&gt;width - 150)/2, y[vminfo-&gt;tt], 150, 40), 5);
+        const int vshrink = vminfo-&gt;width &lt; 640 ? 1 : 0;
+        int y[] = {75, 150, 170, 200, 200};
+        BuildVList b(this, Rect((vminfo-&gt;width - 150)/2, y[vminfo-&gt;tt], 150, vshrink?20:40), 5);
         m_startgame = b.add(new StaticTextButton(N_(&quot;Start Game&quot;), this));
         m_levelpack = b.add(new StaticTextButton(N_(&quot;Level Pack&quot;), this));
 #ifdef ENABLE_EXPERIMENTAL
@@ -236,7 +237,7 @@
         Font *f = enigma::GetFont(&quot;levelmenu&quot;);
         Surface * logo(enigma::GetImage(&quot;enigma_logo3&quot;));
         int x0=(vminfo-&gt;width - logo-&gt;width())/2;
-        int y0[] = {30, 40, 50, 60};
+        int y0[] = {0, 30, 40, 50, 60};
         blit(gc, x0, y0[vminfo-&gt;tt], logo);
         f-&gt;render (gc, 5, vminfo-&gt;height - 20, app.getVersionInfo().c_str());
     }

Modified: trunk/src/gui/OptionsMenu.cc
===================================================================
--- trunk/src/gui/OptionsMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/OptionsMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -326,13 +326,14 @@
       background(background_),
       previous_caption(video::GetCaption())
     {
-        const int spacing     = 5;
-        const int big_spacing = 60;
-        const int label_width = 180;
-        const int but_width   = 100;
-        const int but_height  = 30;
         const video::VMInfo *vminfo = video::GetInfo();
-        int hmargin = vminfo-&gt;width &lt; 660 ? 10 : (vminfo-&gt;width &lt; 900 ? 20 : 80);
+        const int vshrink = vminfo-&gt;width &lt; 640 ? 1 : 0;
+        const int spacing     = vshrink ? 2 : 5;
+        const int big_spacing = vshrink ? 30 : 60;
+        const int label_width = vshrink ? 90 : 180;
+        const int but_width   = vshrink ? 50 : 100;
+        const int but_height  = vshrink ? 15 : 30;
+        int hmargin = vshrink ? 5 : (vminfo-&gt;width &lt; 660 ? 10 : (vminfo-&gt;width &lt; 900 ? 20 : 80));
         int midspacing = vminfo-&gt;width - 2*hmargin - 2*but_width - 2*label_width;
     
         BuildVList leftlabels (this, Rect(-label_width, 0, label_width, but_height), spacing);

Modified: trunk/src/gui/SearchMenu.cc
===================================================================
--- trunk/src/gui/SearchMenu.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/SearchMenu.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -35,6 +35,7 @@
 
      SearchMenu::SearchMenu() : didSearch (false) {
         const video::VMInfo &amp;vminfo = *video::GetInfo();
+        const int vshrink = vminfo.width &lt; 640 ? 1 : 0;
         ecl::Font *menufont = enigma::GetFont(&quot;menufont&quot;);
         
         Label * shallowTitle = new Label(N_(&quot;Shallow Search:&quot;), HALIGN_LEFT);
@@ -42,15 +43,15 @@
         std::string helpText = _(&quot;case independent search in title, author, filename&quot;);
         std::string workString = helpText;
         std::string::size_type breakPos = breakString(menufont, workString, 
-                    &quot; &quot;, 380);
+                    &quot; &quot;, vshrink?190:380);
         Label * shallowHelp1 = new UntranslatedLabel(workString.substr(0,breakPos), HALIGN_LEFT);
         Label * shallowHelp2 = new UntranslatedLabel(workString.substr(breakPos), HALIGN_LEFT);
         shallowSearch = new TextField(&quot;&quot;, this);
         
-        this-&gt;add(shallowTitle, Rect(vminfo.width/2 - 190, vminfo.height/2 - 100, 380, 35));
-        this-&gt;add(shallowHelp1, Rect(vminfo.width/2 - 190, vminfo.height/2 - 40, 380, 25));
-        this-&gt;add(shallowHelp2, Rect(vminfo.width/2 - 190, vminfo.height/2 - 10, 380, 25));
-        this-&gt;add(shallowSearch, Rect(vminfo.width/2 - 190, vminfo.height/2 + 55, 380, 35));
+        this-&gt;add(shallowTitle, Rect(vminfo.width/2 - (vshrink?95:190), vminfo.height/2 - (vshrink?50:100), vshrink?190:380, vshrink?17:35));
+        this-&gt;add(shallowHelp1, Rect(vminfo.width/2 - (vshrink?95:190), vminfo.height/2 - (vshrink?20:40), vshrink?190:380, vshrink?12:25));
+        this-&gt;add(shallowHelp2, Rect(vminfo.width/2 - (vshrink?95:190), vminfo.height/2 - (vshrink?5:10), vshrink?190:380, vshrink?12:25));
+        this-&gt;add(shallowSearch, Rect(vminfo.width/2 - (vshrink?95:190), vminfo.height/2 + (vshrink?27:55), vshrink?190:380, vshrink?17:35));
        
         // Create buttons - positioning identical to Levelmenu
         Label * dummy1 = new Label();
@@ -61,12 +62,12 @@
         HList * commandHList = new HList;
         commandHList-&gt;set_spacing(10);
         commandHList-&gt;set_alignment(HALIGN_CENTER, VALIGN_TOP);
-        commandHList-&gt;set_default_size(140, 35);
+        commandHList-&gt;set_default_size(vshrink?70:140, vshrink?17:35);
         commandHList-&gt;add_back(dummy1);
         commandHList-&gt;add_back(dummy2);
         commandHList-&gt;add_back(but_ignore);
         commandHList-&gt;add_back(but_search);
-        this-&gt;add(commandHList, Rect(10, vminfo.height-50, vminfo.width-20, 35));
+        this-&gt;add(commandHList, Rect(vshrink?5:10, vminfo.height-(vshrink?25:50), vminfo.width-(vshrink?10:20), vshrink?17:35));
         
         set_key_focus(shallowSearch);
     }

Modified: trunk/src/gui/TextField.cc
===================================================================
--- trunk/src/gui/TextField.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/TextField.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -37,14 +37,11 @@
 
 #define SCREEN ecl::Screen::get_instance()
 
-ecl::Font *TextField::menufont = 0;
-
 TextField::TextField(const std::string &amp;t, ActionListener *al) : cursorTime(0),
         showCursor(true), isLastActionReturn (false), invalidChars(&quot;&quot;),
         isLimitedToValidChars(false), maxChars(-1) {
-    if (menufont == 0) {
-        menufont = enigma::GetFont(&quot;menufont&quot;);
-    }
+    menufont = enigma::GetFont(&quot;menufont&quot;);
+    
     set_listener(al);
     textPreCursor = t;
     ecl::utf8CharSizes(textPreCursor, charSizesPreCursor);

Modified: trunk/src/gui/TextField.hh
===================================================================
--- trunk/src/gui/TextField.hh	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/TextField.hh	2008-01-06 16:27:59 UTC (rev 975)
@@ -91,7 +91,7 @@
         std::string invalidChars;
         int maxChars;
         bool isLastActionReturn;
-        static ecl::Font *menufont;
+        ecl::Font *menufont;
     };
 }} // namespace enigma::gui
 #endif

Modified: trunk/src/gui/widgets.cc
===================================================================
--- trunk/src/gui/widgets.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/widgets.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -767,14 +767,9 @@
 
 /* -------------------- TextButton -------------------- */
 
-ecl::Font *TextButton::menufont = 0;
-ecl::Font *TextButton::menufont_pressed = 0;
-
 TextButton::TextButton(ActionListener *al) {
-    if (menufont == 0) {
-        menufont = enigma::GetFont(&quot;menufont&quot;);
-        menufont_pressed = enigma::GetFont(&quot;menufontsel&quot;);
-    }
+    menufont = enigma::GetFont(&quot;menufont&quot;);
+    menufont_pressed = enigma::GetFont(&quot;menufontsel&quot;);
     set_listener(al);
 }
 

Modified: trunk/src/gui/widgets.hh
===================================================================
--- trunk/src/gui/widgets.hh	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/gui/widgets.hh	2008-01-06 16:27:59 UTC (rev 975)
@@ -375,7 +375,8 @@
         void draw(ecl::GC &amp;gc, const ecl::Rect &amp;r);
 
         // Variables.
-        static ecl::Font *menufont, *menufont_pressed;
+        ecl::Font *menufont;
+        ecl::Font *menufont_pressed;
     };
 
 /* -------------------- StaticTextButton -------------------- */

Modified: trunk/src/main.cc
===================================================================
--- trunk/src/main.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/main.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -382,6 +382,7 @@
     
     //
     if (isMakePreviews) {
+        app.state-&gt;setProperty(&quot;Difficulty&quot;, DIFFICULTY_HARD); // will not be saved
         std::set&lt;lev::Proxy *&gt; proxies = lev::Proxy::getProxies();
         int size = proxies.size();
         std::set&lt;lev::Proxy *&gt;::iterator it;
@@ -402,15 +403,21 @@
         scr-&gt;flush_updates();
         
         int i = 0;
-        for (int m=0; m&lt;2; m++) {
+        for (int m=0; m&lt;3; m++) {
+            switch (m) {
+                case 0 : video::SetThumbInfo(120, 78, &quot;&quot;); break;
+                case 1 : video::SetThumbInfo(160, 104, &quot;-160x104&quot;); break;
+                case 2 : video::SetThumbInfo(60, 39, &quot;-60x39&quot;); break;
+            }        
             for (it = proxies.begin(); it != proxies.end(); it++, i++) {
+                Log &lt;&lt; &quot;Make preview &quot; &lt;&lt; (*it)-&gt;getId() &lt;&lt; &quot;\n&quot;;
                 gui::LevelPreviewCache::makeSystemPreview(*it, systemAppDataPath);
                 vline(gc, 170 + i*150 / size, 280, 20);
                 scr-&gt;update_all ();
                 scr-&gt;flush_updates();
             }
-            video::SetThumbInfo(160, 104, &quot;-160x104&quot;);
         }
+        Log &lt;&lt; &quot;Maske preview finished succesfully\n&quot;;
         return;
     }
     

Modified: trunk/src/video.cc
===================================================================
--- trunk/src/video.cc	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/video.cc	2008-01-06 16:27:59 UTC (rev 975)
@@ -499,6 +499,23 @@
             Rect (504, 873, 947, 53),        // text area //TODO
             false, true,                     // available window, fullscreen
             &quot;-0-&quot;,&quot;-9-0-&quot;                    // fallback modes window, fullscreen
+        },
+        { 
+            VM_320x240, 320, 240,            // id, w, h
+            16, VTS_16,                      // tilesize, tiletype
+            &quot;320x240&quot;, &quot;CGA&quot;, &quot;4:3&quot;,         // name, fsname, fs only
+            &quot;models-16.lua&quot;, &quot;gfx16/&quot;,       // initscript, dir
+            Rect (0, 0, 320, 240),           // display area
+            0, 0,                            // menu background image offsets 
+            60, 39, &quot;-60x39&quot;,                // thumbnail size/extension
+            Rect (0, 0, 320, 208),           // game area
+            Rect (0, 208, 320, 32),          // statusbar area
+            Rect (5, 212, 587, 21),          // time area
+            Rect (50, 212, 15, 21),          // moves area
+            Rect (76, 216, 245, 26),         // inventory area
+            Rect (75, 217, 237, 17),         // text area
+            true, true,                      // available window, fullscreen
+            &quot;-10-0-&quot;,&quot;-0-&quot;                   // fallback modes window, fullscreen
         }
     };
 

Modified: trunk/src/video.hh
===================================================================
--- trunk/src/video.hh	2008-01-06 13:22:19 UTC (rev 974)
+++ trunk/src/video.hh	2008-01-06 16:27:59 UTC (rev 975)
@@ -41,14 +41,16 @@
         VM_1440x960  = 7,   ///&lt; 64 bit embedded -  3:2  - none
         VM_1280x1024 = 8,   ///&lt; 64 bit embedded -  5:4  - SXGA
         VM_1680x1050 = 9,   ///&lt; 64 bit embedded - 16:10 - WSXGA+
+        VM_320x240   = 10,  ///&lt; 16 bit basic    -  4:3  - CGA
         VM_COUNT
     };
     
     enum VideoTileType {    // Tile size in pixels
-        VTS_32 = 0,
-        VTS_40 = 1,
-        VTS_48 = 2,
-        VTS_64 = 3
+        VTS_16 = 0,
+        VTS_32 = 1,
+        VTS_40 = 2,
+        VTS_48 = 3,
+        VTS_64 = 4,
     };
 
     struct VMInfo {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000406.html">[Enigma-game-svn] r974 - homepage/input/articles
</A></li>
	<LI>Next message: <A HREF="000408.html">[Enigma-game-svn] Commit 976
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#407">[ date ]</a>
              <a href="thread.html#407">[ thread ]</a>
              <a href="subject.html#407">[ subject ]</a>
              <a href="author.html#407">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
