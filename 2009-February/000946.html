<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1516 - in trunk: data data/schemas src src/floors
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1516%20-%20in%20trunk%3A%20data%20data/schemas%20src%20src/floors&In-Reply-To=%3C200902052251.n15MpqmF017639%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000945.html">
   <LINK REL="Next"  HREF="000947.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1516 - in trunk: data data/schemas src src/floors</H1>
    <B>ral at BerliOS</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1516%20-%20in%20trunk%3A%20data%20data/schemas%20src%20src/floors&In-Reply-To=%3C200902052251.n15MpqmF017639%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1516 - in trunk: data data/schemas src src/floors">ral at mail.berlios.de
       </A><BR>
    <I>Thu Feb  5 23:51:52 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000945.html">[Enigma-game-svn] r1515 - in trunk: attic/images-items data/gfx16	data/gfx32 data/gfx40 data/gfx48 data/gfx64
</A></li>
        <LI>Next message: <A HREF="000947.html">[Enigma-game-svn] r1517 - team_levelpacks/team_test_new_api
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#946">[ date ]</a>
              <a href="thread.html#946">[ thread ]</a>
              <a href="subject.html#946">[ subject ]</a>
              <a href="author.html#946">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ral
Date: 2009-02-05 23:51:49 +0100 (Thu, 05 Feb 2009)
New Revision: 1516

Added:
   trunk/src/floors/SlopeFloor.cc
   trunk/src/floors/SlopeFloor.hh
Modified:
   trunk/data/api1init.lua
   trunk/data/api2init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/floors.cc
   trunk/src/floors.hh
   trunk/src/floors/SimpleFloors.cc
   trunk/src/floors/SimpleFloors.hh
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/oxyd.cc
   trunk/src/world.cc
Log:
Commit message addendum to r1509:
- reengineering gradient floor:
  - renaming ( new = old)
    fl_slope_ps = &quot;fl-gradient1&quot;,
    fl_slope_pn = &quot;fl-gradient2&quot;,
    fl_slope_pe = &quot;fl-gradient3&quot;,
    fl_slope_pw = &quot;fl-gradient4&quot;,
    fl_slope_ose = &quot;fl-gradient5&quot;,
    fl_slope_osw = &quot;fl-gradient6&quot;,
    fl_slope_one = &quot;fl-gradient7&quot;,
    fl_slope_onw = &quot;fl-gradient8&quot;,
    fl_slope_ise = &quot;fl-gradient9&quot;,
    fl_slope_ine = &quot;fl-gradient10&quot;,
    fl_slope_isw = &quot;fl-gradient11&quot;,
    fl_slope_inw = &quot;fl-gradient12&quot;,
    fl_slope_ts = &quot;fl-gradient13&quot;,
    fl_slope_tn = &quot;fl-gradient14&quot;,
    fl_slope_te = &quot;fl-gradient15&quot;,
    fl_slope_tw = &quot;fl-gradient16&quot;,
    fl_slope_tsl = &quot;fl-gradient&quot;, type=20
    fl_slope_tnl = &quot;fl-gradient&quot;, type=18
    fl_slope_tel = &quot;fl-gradient&quot;, type=15
    fl_slope_twl = &quot;fl-gradient&quot;, type=14
    fl_slope_tsr = &quot;fl-gradient&quot;, type=19
    fl_slope_tnr = &quot;fl-gradient&quot;, type=17
    fl_slope_ter = &quot;fl-gradient&quot;, type=16
    fl_slope_twr = &quot;fl-gradient&quot;, type=13
  - naming scheme - suffix:
    - p* : planar, descending to given direction
    - o* : outer edge, descending to given direction
    - i* : inner edge, descending to given direction
    - t* : tube, descending to given direction
    - t*l : tube, left wall, descending to given direction
    - t*r : tube, right wall, descending to given direction
  - attribute &quot;shape&quot; with above suffix values, determines image
  - attribtute &quot;slope&quot;, values NODIR, WEST, SOUTH, EAST, NORTH, NORTHWEST,
      SOUTHWEST, SOUTHEAST, NORTHEAST determines force direction
  - variantes are preconfigured in both attributes shape, slope
  - attribute &quot;strength&quot; overrides global &quot;SlopeStrength&quot;
  - attribute &quot;force_x&quot;, &quot;force_y&quot; overrides all slope and strength values
- bottle - improved drunken forces on actors


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/data/api1init.lua	2009-02-05 22:51:49 UTC (rev 1516)
@@ -113,6 +113,22 @@
     fl_samba = &quot;fl-samba&quot;,
     fl_samba_h = &quot;fl-samba1&quot;,
     fl_samba_v = &quot;fl-samba2&quot;,
+    fl_slope_ps = &quot;fl-gradient1&quot;,
+    fl_slope_pn = &quot;fl-gradient2&quot;,
+    fl_slope_pe = &quot;fl-gradient3&quot;,
+    fl_slope_pw = &quot;fl-gradient4&quot;,
+    fl_slope_ose = &quot;fl-gradient5&quot;,
+    fl_slope_osw = &quot;fl-gradient6&quot;,
+    fl_slope_one = &quot;fl-gradient7&quot;,
+    fl_slope_onw = &quot;fl-gradient8&quot;,
+    fl_slope_ise = &quot;fl-gradient9&quot;,
+    fl_slope_ine = &quot;fl-gradient10&quot;,
+    fl_slope_isw = &quot;fl-gradient11&quot;,
+    fl_slope_inw = &quot;fl-gradient12&quot;,
+    fl_slope_ts = &quot;fl-gradient13&quot;,
+    fl_slope_tn = &quot;fl-gradient14&quot;,
+    fl_slope_te = &quot;fl-gradient15&quot;,
+    fl_slope_tw = &quot;fl-gradient16&quot;,
     fl_space = &quot;fl-space&quot;,
     fl_stone = &quot;fl-stone&quot;,
     fl_swamp = &quot;fl-swamp&quot;,
@@ -537,6 +553,9 @@
         local obj = enigma._MakeObject(&quot;ac_pearl_white&quot;)
         enigma._SetAttrib(obj, &quot;owner&quot;, nil)
         return obj
+    elseif name == &quot;fl-gradient&quot; then
+        local obj = enigma._MakeObject(&quot;fl_slope_ps&quot;)
+        return obj
     elseif name == &quot;fl-bridge-open&quot; then
         local obj = enigma._MakeObject(&quot;fl_bridge&quot;)
         return obj
@@ -732,6 +751,9 @@
     if _newname == &quot;st_mirror&quot; then
         return &quot;st-mirror&quot;
     end
+    if _newname == &quot;fl_slope&quot; then
+        return &quot;fl-gradient&quot;
+    end
     if _oldname ~= nil then
         return _oldname
     else
@@ -795,9 +817,7 @@
      if key == &quot;load&quot; then
          _key = &quot;state&quot;
      end
-     if key == &quot;force&quot; and (_obj_name == &quot;st-actorimpulse&quot; or
-             _obj_name == &quot;st-actorimpulse_invisible&quot; or _obj_name == &quot;ac-horse&quot; or
-             _obj_name == &quot;ac-rotor&quot; or _obj_name == &quot;ac-top&quot;)  then
+     if key == &quot;force&quot; then
          _key = &quot;strength&quot;
      end
      if key == &quot;friction_factor&quot; then
@@ -877,6 +897,83 @@
          else _val = &quot;gc&quot;
          end
      end
+     if key == &quot;type&quot; and string.find(_obj_name, &quot;fl-gradient&quot;, 1, true) == 1 then
+         if val == 1 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;ps&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 1)
+         elseif val == 2 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;pn&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 3)
+         elseif val == 3 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;pe&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 2)
+         elseif val == 4 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;pw&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 0)
+         elseif val == 5 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;ose&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 6)
+         elseif val == 6 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;osw&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 5)
+         elseif val == 7 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;one&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 7)
+         elseif val == 8 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;onw&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 4)
+         elseif val == 9 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;ise&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 6)
+         elseif val == 10 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;ine&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 7)
+         elseif val == 11 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;isw&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 5)
+         elseif val == 12 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;inw&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 4)
+         elseif val == 13 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;twr&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 5)
+         elseif val == 14 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;twl&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 4)
+         elseif val == 15 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;tel&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 6)
+         elseif val == 16 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;ter&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 7)
+         elseif val == 17 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;tnr&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 4)
+         elseif val == 18 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;tnl&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 7)
+         elseif val == 19 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;tsl&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 5)
+         elseif val == 20 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;tsr&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 6)
+         elseif val == 21 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;ts&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 1)
+         elseif val == 22 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;tn&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 3)
+         elseif val == 23 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;te&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 2)
+         elseif val == 24 then
+             enigma._SetAttrib(obj, &quot;shape&quot;, &quot;tw&quot;)
+             enigma._SetAttrib(obj, &quot;slope&quot;, 0)
+         end
+         return
+     end
+     
      if key == &quot;mousefactor&quot; then
          _key = &quot;adhesion&quot;
      end
@@ -920,9 +1017,7 @@
      if key == &quot;value&quot; then
          _key = &quot;coin_value&quot;
      end
-     if key == &quot;force&quot; and (_obj_name == &quot;st-actorimpulse&quot; or
-             _obj_name == &quot;st-actorimpulse_invisible&quot; or _obj_name == &quot;ac-horse&quot; or
-             _obj_name == &quot;ac-rotor&quot; or _obj_name == &quot;ac-top&quot;)  then
+     if key == &quot;force&quot; then
          _key = &quot;strength&quot;
      end
      if key == &quot;friction_factor&quot; then

Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/data/api2init.lua	2009-02-05 22:51:49 UTC (rev 1516)
@@ -122,10 +122,15 @@
 OXYD_BOLD   = -4
 
 -- direction
+NODIR = -1
 WEST  = 0
 SOUTH = 1
 EAST  = 2
 NORTH = 3
+NORTHWEST = 4
+SOUTHWEST = 5
+SOUTHEAST = 6
+NORTHEAST = 7
 
 -- alternative orientation notation for mirrors
 BACKSLASH  = 0

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/data/models-2d.lua	2009-02-05 22:51:49 UTC (rev 1516)
@@ -327,6 +327,31 @@
 -- gradients
 do
     DefSubimages(&quot;fl-gradient2&quot;, {w=6, h=4, modelname=&quot;fl-gradient&quot;})
+    DefAlias(&quot;fl_slope&quot;, &quot;fl-gradient21&quot;)
+    DefAlias(&quot;fl_slope_pw&quot;, &quot;fl-gradient4&quot;)
+    DefAlias(&quot;fl_slope_ps&quot;, &quot;fl-gradient1&quot;)
+    DefAlias(&quot;fl_slope_pe&quot;, &quot;fl-gradient3&quot;)
+    DefAlias(&quot;fl_slope_pn&quot;, &quot;fl-gradient2&quot;)
+    DefAlias(&quot;fl_slope_inw&quot;, &quot;fl-gradient12&quot;)
+    DefAlias(&quot;fl_slope_isw&quot;, &quot;fl-gradient11&quot;)
+    DefAlias(&quot;fl_slope_ise&quot;, &quot;fl-gradient9&quot;)
+    DefAlias(&quot;fl_slope_ine&quot;, &quot;fl-gradient10&quot;)
+    DefAlias(&quot;fl_slope_onw&quot;, &quot;fl-gradient8&quot;)
+    DefAlias(&quot;fl_slope_osw&quot;, &quot;fl-gradient6&quot;)
+    DefAlias(&quot;fl_slope_ose&quot;, &quot;fl-gradient5&quot;)
+    DefAlias(&quot;fl_slope_one&quot;, &quot;fl-gradient7&quot;)
+    DefAlias(&quot;fl_slope_tw&quot;, &quot;fl-gradient21&quot;)
+    DefAlias(&quot;fl_slope_ts&quot;, &quot;fl-gradient21&quot;)
+    DefAlias(&quot;fl_slope_te&quot;, &quot;fl-gradient21&quot;)
+    DefAlias(&quot;fl_slope_tn&quot;, &quot;fl-gradient21&quot;)
+    DefAlias(&quot;fl_slope_twl&quot;, &quot;fl-gradient2&quot;)
+    DefAlias(&quot;fl_slope_tsl&quot;, &quot;fl-gradient4&quot;)
+    DefAlias(&quot;fl_slope_tel&quot;, &quot;fl-gradient1&quot;)
+    DefAlias(&quot;fl_slope_tnl&quot;, &quot;fl-gradient3&quot;)
+    DefAlias(&quot;fl_slope_twr&quot;, &quot;fl-gradient1&quot;)
+    DefAlias(&quot;fl_slope_tsr&quot;, &quot;fl-gradient3&quot;)
+    DefAlias(&quot;fl_slope_ter&quot;, &quot;fl-gradient2&quot;)
+    DefAlias(&quot;fl_slope_tnr&quot;, &quot;fl-gradient4&quot;)
 end
 
 -- leaves --

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/data/schemas/objects.xml	2009-02-05 22:51:49 UTC (rev 1516)
@@ -75,7 +75,9 @@
     &lt;attr name=&quot;secure&quot; type=&quot;bool&quot; default=&quot;false&quot; rw=&quot;rw&quot;/&gt;
     &lt;attr name=&quot;scissor&quot; type=&quot;bool&quot; default=&quot;false&quot; rw=&quot;rw&quot;/&gt;
     &lt;attr name=&quot;scratches&quot; type=&quot;string&quot; default=&quot;&quot; rw=&quot;rw&quot;/&gt;
+    &lt;attr name=&quot;shape&quot; type=&quot;string&quot; default=&quot;&quot; rw=&quot;rw&quot;/&gt;
     &lt;attr name=&quot;selection&quot; type=&quot;tokens&quot; default=&quot;nil&quot; rw=&quot;rw&quot;/&gt;
+    &lt;attr name=&quot;slope&quot; type=&quot;int&quot; default=&quot;-1&quot; min=&quot;-1&quot; max=&quot;7&quot; rw=&quot;rw&quot;/&gt;
     &lt;attr name=&quot;spreading&quot; type=&quot;double&quot; default=&quot;nil&quot; rw=&quot;rw&quot;/&gt;
     &lt;attr name=&quot;state&quot; type=&quot;int&quot; default=&quot;0&quot; min=&quot;0&quot; max=&quot;1&quot; rw=&quot;rw&quot;/&gt;
     &lt;attr name=&quot;static&quot; type=&quot;bool&quot; default=&quot;false&quot; rw=&quot;rw&quot;/&gt;
@@ -332,6 +334,85 @@
     &lt;object name=&quot;fl_rock_framed&quot;&gt;
       &lt;attr name=&quot;faces&quot; value=&quot;nesw&quot;/&gt;
     &lt;/object&gt;
+    &lt;object name=&quot;fl_slope&quot;&gt;
+      &lt;attr name=&quot;friction&quot; default=&quot;4.0&quot;/&gt;
+      &lt;attr name=&quot;adhesion&quot; default=&quot;2.0&quot;/&gt;
+      &lt;attr name=&quot;slope&quot; default=&quot;-1&quot;/&gt;
+      &lt;attr name=&quot;strength&quot;/&gt;
+      &lt;attr name=&quot;shape&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_pw&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;pw&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_ps&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;ps&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_pe&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;pe&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_pn&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;pn&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_inw&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;inw&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_isw&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;isw&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_ise&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;ise&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_ine&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;ine&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_onw&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;onw&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_osw&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;osw&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_ose&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;ose&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_one&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;one&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_tw&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;tw&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_ts&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;ts&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_te&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;te&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_tn&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;tn&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_twl&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;twl&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_tsl&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;tsl&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_tel&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;tel&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_tnl&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;tnl&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_twr&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;twr&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_tsr&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;tsr&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_ter&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;ter&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;fl_slope_tnr&quot;&gt;
+      &lt;attr name=&quot;shape&quot; value=&quot;tnr&quot;/&gt;
+    &lt;/object&gt;
     &lt;object name=&quot;fl_space&quot;&gt;
       &lt;attr name=&quot;friction&quot; default=&quot;0.0&quot;/&gt;
       &lt;attr name=&quot;adhesion&quot; default=&quot;0.0&quot;/&gt;

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/Makefile.am	2009-02-05 22:51:49 UTC (rev 1516)
@@ -159,6 +159,8 @@
 	floors/FloodStream.hh	\
 	floors/SimpleFloors.cc	\
 	floors/SimpleFloors.hh	\
+	floors/SlopeFloor.cc	\
+	floors/SlopeFloor.hh	\
 	floors/ThiefFloor.cc	\
 	floors/ThiefFloor.hh	\
 	gui/ErrorMenu.cc	\

Modified: trunk/src/floors/SimpleFloors.cc
===================================================================
--- trunk/src/floors/SimpleFloors.cc	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/floors/SimpleFloors.cc	2009-02-05 22:51:49 UTC (rev 1516)
@@ -21,7 +21,7 @@
 #include &quot;floors/SimpleFloors.hh&quot;
 
 //#include &quot;errors.hh&quot;
-//#include &quot;main.hh&quot;
+#include &quot;main.hh&quot;
 #include &quot;player.hh&quot;
 #include &quot;world.hh&quot;
 
@@ -29,7 +29,7 @@
     
 /* -------------------- Abyss -------------------- */
 
-    Abyss::Abyss() : Floor(&quot;fl_abyss&quot;, 0.0, 0.0, flf_indestructible) {
+    Abyss::Abyss() : Floor (&quot;fl_abyss&quot;, 0.0, 0.0, flf_indestructible) {
     }
     
     std::string Abyss::getClass() const {
@@ -44,6 +44,21 @@
         SendMessage(a, &quot;_fall&quot;);
     }
     
+/* -------------------- DummyFloor -------------------- */
+
+    DummyFloor::DummyFloor() : Floor (&quot;fl_dummy&quot;, 4.0, 2.5) {
+    }
+    
+    std::string DummyFloor::getClass() const {
+        return &quot;fl_dummy&quot;;
+    }
+
+    void DummyFloor::actor_contact(Actor *) {
+        static int lastCode = -1;
+        int code = getAttr(&quot;code&quot;);
+        Log &lt;&lt; ecl::strf(&quot;Entering floor 0x%x\n&quot;, code);
+    }
+
 /* -------------------- Ice -------------------- */
 
 
@@ -113,6 +128,7 @@
     
     BOOT_REGISTER_START
         BootRegister(new Abyss(),     &quot;fl_abyss&quot;);
+        BootRegister(new DummyFloor(),&quot;fl_dummy&quot;);
         BootRegister(new IceFloor(),  &quot;fl_ice&quot;);
         BootRegister(new Space(),     &quot;fl_space&quot;);
         BootRegister(new Space(true), &quot;fl_space_force&quot;);

Modified: trunk/src/floors/SimpleFloors.hh
===================================================================
--- trunk/src/floors/SimpleFloors.hh	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/floors/SimpleFloors.hh	2009-02-05 22:51:49 UTC (rev 1516)
@@ -42,6 +42,22 @@
     };
 
     /** 
+     * DummyFloor
+     */
+    class DummyFloor : public Floor {
+        CLONEOBJ(DummyFloor);
+        
+    public:
+        DummyFloor();
+
+        // Object interface
+        virtual std::string getClass() const;
+
+        // Floor interface
+        virtual void actor_contact(Actor *);
+    };
+
+    /** 
      * IceFloor
      */
     class IceFloor : public Floor {

Added: trunk/src/floors/SlopeFloor.cc
===================================================================
--- trunk/src/floors/SlopeFloor.cc	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/floors/SlopeFloor.cc	2009-02-05 22:51:49 UTC (rev 1516)
@@ -0,0 +1,139 @@
+/*
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include &quot;floors/SlopeFloor.hh&quot;
+
+#include &quot;errors.hh&quot;
+#include &quot;main.hh&quot;
+#include &quot;stones.hh&quot;
+#include &quot;world.hh&quot;
+
+namespace enigma {
+    
+    SlopeFloor::SlopeFloor(int slope, std::string shape) : Floor(&quot;fl_slope&quot;, 4, 2)  {
+        state = slope;
+        Floor::setAttr(&quot;shape&quot;, shape);
+    }
+    
+    std::string SlopeFloor::getClass() const {
+        return &quot;fl_slope&quot;;
+    }
+        
+    void SlopeFloor::setAttr(const string&amp; key, const Value &amp;val) {
+        if (key == &quot;shape&quot;) {
+            std::string shape = val.to_string();
+            if (shape == &quot;&quot; || shape == &quot;pw&quot; || shape == &quot;ps&quot; || shape == &quot;pe&quot; || shape == &quot;pn&quot; ||
+                    shape == &quot;inw&quot; || shape == &quot;isw&quot; || shape == &quot;ise&quot; || shape == &quot;ine&quot; || 
+                    shape == &quot;onw&quot; || shape == &quot;osw&quot; || shape == &quot;ose&quot; || shape == &quot;one&quot; || 
+                    shape == &quot;tw&quot; || shape == &quot;ts&quot; || shape == &quot;te&quot; || shape == &quot;tn&quot; || 
+                    shape == &quot;twl&quot; || shape == &quot;tsl&quot; || shape == &quot;tel&quot; || shape == &quot;tnl&quot; || 
+                    shape == &quot;twr&quot; || shape == &quot;tsr&quot; || shape == &quot;ter&quot; || shape == &quot;tnr&quot;) {
+                Floor::setAttr(&quot;shape&quot;, shape);
+                init_model();
+            }
+        } else if (key == &quot;slope&quot;) {
+            int slope = val;
+            if (slope &gt;= -1 &amp;&amp; slope &lt;= 7)
+                state = slope;
+        } else if (key == &quot;strength&quot;) {
+            var_floorforce[0] = val;
+            objFlags = (objFlags &amp; ~OBJBIT_FORCE) | OBJBIT_STRENGTH;
+        } else if (key == &quot;force_x&quot;) {
+            var_floorforce[0] = val;
+            objFlags = (objFlags &amp; ~OBJBIT_STRENGTH) | OBJBIT_FORCE;
+        } else if (key == &quot;force_y&quot;) {
+            var_floorforce[1] = val;
+            objFlags = (objFlags &amp; ~OBJBIT_STRENGTH) | OBJBIT_FORCE;
+        } else
+            Floor::setAttr(key, val);
+    }
+        
+    Value SlopeFloor::getAttr(const std::string &amp;key) const {
+        if (key == &quot;slope&quot;) {
+            return state;
+        } else if (key == &quot;strength&quot;) {
+            return var_floorforce[0];
+       }
+        return Floor::getAttr(key);
+    }
+    
+    void SlopeFloor::setState(int extState) {
+        // ignore any state change attempts
+    }
+    
+    void SlopeFloor::init_model()  {
+        std::string shape = getAttr(&quot;shape&quot;).to_string();
+        if (shape == &quot;&quot;)
+            set_model(&quot;fl_slope&quot;);
+        else
+            set_model(std::string(&quot;fl_slope_&quot;) + shape);
+    }
+    
+    void SlopeFloor::add_force(Actor *a, ecl::V2 &amp;f) {
+        static int xforce[8] = {
+             -1,  0,  1, 0,
+             -1, -1,  1, 1
+        };
+        static int yforce[8] = {
+             0,  1,  0,  -1,
+             -1,  1, 1, -1
+        };
+        
+        if (objFlags &amp; OBJBIT_FORCE)
+            return Floor::add_force(a, f);
+        else {
+            ecl::V2 force(0,0);
+            if (state != NODIR) {
+                force = ecl::V2(xforce[state], yforce[state]);
+                force.normalize();
+            }            
+            f += ((objFlags &amp; OBJBIT_STRENGTH) ? var_floorforce[0] : server::SlopeForce) * force;
+        }
+    }
+    
+
+    BOOT_REGISTER_START
+        BootRegister(new SlopeFloor(-1, &quot;&quot;), &quot;fl_slope&quot;);
+        BootRegister(new SlopeFloor( 0, &quot;pw&quot;), &quot;fl_slope_pw&quot;);
+        BootRegister(new SlopeFloor( 1, &quot;ps&quot;), &quot;fl_slope_ps&quot;);
+        BootRegister(new SlopeFloor( 2, &quot;pe&quot;), &quot;fl_slope_pe&quot;);
+        BootRegister(new SlopeFloor( 3, &quot;pn&quot;), &quot;fl_slope_pn&quot;);
+        BootRegister(new SlopeFloor( 4, &quot;inw&quot;), &quot;fl_slope_inw&quot;);
+        BootRegister(new SlopeFloor( 5, &quot;isw&quot;), &quot;fl_slope_isw&quot;);
+        BootRegister(new SlopeFloor( 6, &quot;ise&quot;), &quot;fl_slope_ise&quot;);
+        BootRegister(new SlopeFloor( 7, &quot;ine&quot;), &quot;fl_slope_ine&quot;);
+        BootRegister(new SlopeFloor( 4, &quot;onw&quot;), &quot;fl_slope_onw&quot;);
+        BootRegister(new SlopeFloor( 5, &quot;osw&quot;), &quot;fl_slope_osw&quot;);
+        BootRegister(new SlopeFloor( 6, &quot;ose&quot;), &quot;fl_slope_ose&quot;);
+        BootRegister(new SlopeFloor( 7, &quot;one&quot;), &quot;fl_slope_one&quot;);
+        BootRegister(new SlopeFloor( 0, &quot;tw&quot;), &quot;fl_slope_tw&quot;);
+        BootRegister(new SlopeFloor( 1, &quot;ts&quot;), &quot;fl_slope_ts&quot;);
+        BootRegister(new SlopeFloor( 2, &quot;te&quot;), &quot;fl_slope_te&quot;);
+        BootRegister(new SlopeFloor( 3, &quot;tn&quot;), &quot;fl_slope_tn&quot;);
+        BootRegister(new SlopeFloor( 4, &quot;twl&quot;), &quot;fl_slope_twl&quot;);
+        BootRegister(new SlopeFloor( 5, &quot;tsl&quot;), &quot;fl_slope_tsl&quot;);
+        BootRegister(new SlopeFloor( 6, &quot;tel&quot;), &quot;fl_slope_tel&quot;);
+        BootRegister(new SlopeFloor( 7, &quot;tnl&quot;), &quot;fl_slope_tnl&quot;);
+        BootRegister(new SlopeFloor( 5, &quot;twr&quot;), &quot;fl_slope_twr&quot;);
+        BootRegister(new SlopeFloor( 6, &quot;tsr&quot;), &quot;fl_slope_tsr&quot;);
+        BootRegister(new SlopeFloor( 7, &quot;ter&quot;), &quot;fl_slope_ter&quot;);
+        BootRegister(new SlopeFloor( 4, &quot;tnr&quot;), &quot;fl_slope_tnr&quot;);
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/floors/SlopeFloor.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/floors/SlopeFloor.hh
===================================================================
--- trunk/src/floors/SlopeFloor.hh	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/floors/SlopeFloor.hh	2009-02-05 22:51:49 UTC (rev 1516)
@@ -0,0 +1,57 @@
+/*
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef SLOPEFLOOR_HH
+#define SLOPEFLOOR_HH
+
+#include &quot;floors.hh&quot;
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class SlopeFloor : public Floor {
+        CLONEOBJ(SlopeFloor);
+        
+    private:
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_STRENGTH =   1&lt;&lt;24,   ///&lt; floor specific strength factor
+            OBJBIT_FORCE    =   1&lt;&lt;25    ///&lt; floor specific force vector
+        };
+    public:
+        SlopeFloor(int gradient, std::string shape);
+
+        // Object interface
+        virtual std::string getClass() const;
+        virtual void setAttr(const string&amp; key, const Value &amp;val);
+        virtual Value getAttr(const std::string &amp;key) const;
+        
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+                
+        // Floor interface
+        virtual void add_force(Actor *, ecl::V2 &amp;);
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/floors/SlopeFloor.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/floors.cc	2009-02-05 22:51:49 UTC (rev 1516)
@@ -482,160 +482,4 @@
     }
 }
 
-/* =============== Special Floors ================ */
-
-namespace
-{
-
-/* -------------------- DummyFloor -------------------- */
-
-    class DummyFloor : public Floor {
-        CLONEOBJ(DummyFloor);
-    public:
-        DummyFloor() : Floor(&quot;fl-dummy&quot;, 4.0, 2.5) {}
-    private:
-        void actor_enter(Actor *) {
-            static int lastCode = -1;
-            int        code     = getAttr(&quot;code&quot;);
-            if (lastCode != code) {
-                fprintf(stderr, &quot;Entering floor 0x%x\n&quot;, code);
-                lastCode = code;
-            }
-        }
-    };
-}
-
-/* -------------------- Gradient -------------------- */
-
-/** \page fl-gradient Gradient Floor
-
-This is a sloped floor that accelerates in a particular direction.
-
-\subsection gradienta Attributes
-
-- \b type: number between 0 and 15 (see below)
-
-\subsection gradiente Examples
-
-*/
-namespace
-{
-    class Gradient : public Floor {
-        CLONEOBJ(Gradient);
-        int type;
-        bool use_forcefac;
-        double forcefac;
-    public:
-        Gradient(int type=MINTYPE);
-    private:
-        int get_type() const;
-        enum { MINTYPE=1, MAXTYPE=24 };
-
-        // Object interface
-        virtual void setAttr(const string&amp; key, const Value &amp;val);
-
-        // GridObject interface.
-        virtual void init_model();
-
-        // Floor interface
-        virtual void add_force(Actor *a, V2 &amp;f);
-    };
-}
-
-Gradient::Gradient(int type_)
-: Floor(&quot;fl-gradient&quot;, 4, 2),
-  type (type_),
-  use_forcefac (false),
-  forcefac (1.0)
-{
-    setAttr(&quot;type&quot;, Value(type_));
-}
-
-void Gradient::setAttr(const string&amp; key, const Value &amp;val)
-{
-    if (key == &quot;type&quot;) {
-        int t=to_int (val);
-        if (t &lt; MINTYPE || t&gt;MAXTYPE) {
-            enigma::Log &lt;&lt; &quot;Gradient: Illegal type=&quot;&lt;&lt; int(t) &lt;&lt; std::endl;
-            t=MINTYPE;
-        }
-        type = t;
-    }
-    else if (key == &quot;force&quot;) {
-        use_forcefac = true;
-        forcefac = to_double (val);
-    }
-    Floor::setAttr(key, val);
-}
-
-
-int Gradient::get_type() const
-{
-    return type;
-}
-
-void Gradient::init_model()
-{
-    set_model(ecl::strf(&quot;fl-gradient%d&quot;, get_type()));
-}
-
-void Gradient::add_force(Actor *a, V2 &amp;f)
-{
-    ecl::V2 force;
-    int t = get_type();
-
-    static int xforce[MAXTYPE-MINTYPE+1] = {
-         0,  0,  1, -1,
-         1, -1,  1, -1,
-         1,  1, -1, -1,
-        -1, -1,  1,  1,
-         1, -1,  1, -1,
-         0,  0,  1, -1
-    };
-    static int yforce[MAXTYPE-MINTYPE+1] = {
-         1, -1,  0,  0,
-         1,  1, -1, -1,
-         1, -1,  1, -1,
-         1, -1,  1, -1,
-        -1, -1,  1,  1,
-         1, -1,  0,  0
-    };
-    force = ecl::V2(xforce[t-MINTYPE], yforce[t-MINTYPE]);
-    force.normalize();
-
-    // use enigma::SlopeForce if no &quot;force&quot; attribute is set
-    double factor = server::SlopeForce;
-    if (use_forcefac)
-        factor = forcefac;
-    force *= factor;
-    f += force;
-    Floor::add_force(a, f);
-}
-
-
-
-void InitFloors()
-{
-    // Floors (most floors are defined in init.lua)
-    Register(new DummyFloor);
-
-    Register(new Gradient);
-    Register(&quot;fl-gradient1&quot;, new Gradient(1));
-    Register(&quot;fl-gradient2&quot;, new Gradient(2));
-    Register(&quot;fl-gradient3&quot;, new Gradient(3));
-    Register(&quot;fl-gradient4&quot;, new Gradient(4));
-    Register(&quot;fl-gradient5&quot;, new Gradient(5));
-    Register(&quot;fl-gradient6&quot;, new Gradient(6));
-    Register(&quot;fl-gradient7&quot;, new Gradient(7));
-    Register(&quot;fl-gradient8&quot;, new Gradient(8));
-    Register(&quot;fl-gradient9&quot;, new Gradient(9));
-    Register(&quot;fl-gradient10&quot;, new Gradient(10));
-    Register(&quot;fl-gradient11&quot;, new Gradient(11));
-    Register(&quot;fl-gradient12&quot;, new Gradient(12));
-    Register(&quot;fl-gradient13&quot;, new Gradient(22));
-    Register(&quot;fl-gradient14&quot;, new Gradient(21));
-    Register(&quot;fl-gradient15&quot;, new Gradient(24));
-    Register(&quot;fl-gradient16&quot;, new Gradient(23));
-}
-
 } // namespace enigma

Modified: trunk/src/floors.hh
===================================================================
--- trunk/src/floors.hh	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/floors.hh	2009-02-05 22:51:49 UTC (rev 1516)
@@ -132,6 +132,7 @@
         int get_fire_countdown();
         virtual bool on_heattransform(Direction sourcedir, FloorHeatFlags flhf);
 
+        ecl::V2 var_floorforce;
     private:
         virtual void on_actorhit(Actor * /*a*/) {}
         // Fire logic
@@ -146,11 +147,8 @@
         int fire_countdown;  // used to delay ignition, default is 1.
         double friction;
         double adhesion;
-        ecl::V2 var_floorforce;
     };
 
-    void InitFloors();
-
 } // namespace enigma
 
 #endif

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/ox_extra.cc	2009-02-05 22:51:49 UTC (rev 1516)
@@ -71,8 +71,8 @@
     UNUSED,              // OxydExtra floor 0x22
     UNUSED,              // OxydExtra floor 0x23
     UNUSED,              // OxydExtra floor 0x24
-    &quot;fl-gradient3&quot;,      // OxydExtra floor 0x25
-    &quot;fl-gradient4&quot;,      // OxydExtra floor 0x26
+    &quot;fl_slope_pe&quot;,      // OxydExtra floor 0x25
+    &quot;fl_slope_pw&quot;,      // OxydExtra floor 0x26
     UNUSED,              // OxydExtra floor 0x27
     UNUSED,              // OxydExtra floor 0x28
     UNUSED,              // OxydExtra floor 0x29
@@ -83,8 +83,8 @@
     UNUSED,              // OxydExtra floor 0x2e
     UNUSED,              // OxydExtra floor 0x2f
     UNUSED,              // OxydExtra floor 0x30
-    &quot;fl-gradient15&quot;,     // OxydExtra floor 0x31
-    &quot;fl-gradient16&quot;,     // OxydExtra floor 0x32
+    &quot;fl_slope_te&quot;,     // OxydExtra floor 0x31
+    &quot;fl_slope_tw&quot;,     // OxydExtra floor 0x32
     UNUSED,              // OxydExtra floor 0x33
     &quot;fl_rough&quot;,          // OxydExtra floor 0x34
     UNUSED,              // OxydExtra floor 0x35

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/ox_magnum.cc	2009-02-05 22:51:49 UTC (rev 1516)
@@ -69,22 +69,22 @@
     UNUSED,                     // OxydMagnum floor 0x20
     UNUSED,                     // OxydMagnum floor 0x21
     UNUSED,                     // OxydMagnum floor 0x22
-    &quot;fl-gradient1&quot;,             // OxydMagnum floor 0x23
-    &quot;fl-gradient2&quot;,             // OxydMagnum floor 0x24
-    &quot;fl-gradient3&quot;,             // OxydMagnum floor 0x25
-    &quot;fl-gradient4&quot;,             // OxydMagnum floor 0x26
-    &quot;fl-gradient5&quot;,             // OxydMagnum floor 0x27
-    &quot;fl-gradient6&quot;,             // OxydMagnum floor 0x28
-    &quot;fl-gradient7&quot;,             // OxydMagnum floor 0x29
-    &quot;fl-gradient8&quot;,             // OxydMagnum floor 0x2a
-    &quot;fl-gradient9&quot;,             // OxydMagnum floor 0x2b
-    &quot;fl-gradient10&quot;,            // OxydMagnum floor 0x2c
-    &quot;fl-gradient11&quot;,            // OxydMagnum floor 0x2d
-    &quot;fl-gradient12&quot;,            // OxydMagnum floor 0x2e
-    &quot;fl-gradient13&quot;,            // OxydMagnum floor 0x2f
-    &quot;fl-gradient14&quot;,            // OxydMagnum floor 0x30
-    &quot;fl-gradient15&quot;,            // OxydMagnum floor 0x31
-    &quot;fl-gradient16&quot;,            // OxydMagnum floor 0x32
+    &quot;fl_slope_ps&quot;,             // OxydMagnum floor 0x23
+    &quot;fl_slope_ps&quot;,             // OxydMagnum floor 0x24
+    &quot;fl_slope_pe&quot;,             // OxydMagnum floor 0x25
+    &quot;fl_slope_pw&quot;,             // OxydMagnum floor 0x26
+    &quot;fl_slope_ose&quot;,             // OxydMagnum floor 0x27
+    &quot;fl_slope_osw&quot;,             // OxydMagnum floor 0x28
+    &quot;fl_slope_one&quot;,             // OxydMagnum floor 0x29
+    &quot;fl_slope_onw&quot;,             // OxydMagnum floor 0x2a
+    &quot;fl_slope_ise&quot;,             // OxydMagnum floor 0x2b
+    &quot;fl_slope_ine&quot;,            // OxydMagnum floor 0x2c
+    &quot;fl_slope_isw&quot;,            // OxydMagnum floor 0x2d
+    &quot;fl_slope_inw&quot;,            // OxydMagnum floor 0x2e
+    &quot;fl_slope_ts&quot;,            // OxydMagnum floor 0x2f
+    &quot;fl_slope_tn&quot;,            // OxydMagnum floor 0x30
+    &quot;fl_slope_te&quot;,            // OxydMagnum floor 0x31
+    &quot;fl_slope_tw&quot;,            // OxydMagnum floor 0x32
     &quot;fl_brick&quot;,                 // OxydMagnum floor 0x33 (common was 'fl-rough')
     &quot;fl_brick&quot;,                 // OxydMagnum floor 0x34 (common was 'fl-rough')
     UNUSED,                     // OxydMagnum floor 0x35

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/ox_oxyd1.cc	2009-02-05 22:51:49 UTC (rev 1516)
@@ -102,22 +102,22 @@
     &quot;fl_space&quot;,                 // Oxyd1 floor 0x20
     &quot;fl_space_force&quot;,           // Oxyd1 floor 0x21
     &quot;fl_space&quot;,                 // Oxyd1 floor 0x22
-    &quot;fl-gradient1&quot;,             // Oxyd1 floor 0x23
-    &quot;fl-gradient2&quot;,             // Oxyd1 floor 0x24
-    &quot;fl-gradient3&quot;,             // Oxyd1 floor 0x25
-    &quot;fl-gradient4&quot;,             // Oxyd1 floor 0x26
-    &quot;fl-gradient5&quot;,             // Oxyd1 floor 0x27
-    &quot;fl-gradient6&quot;,             // Oxyd1 floor 0x28
-    &quot;fl-gradient7&quot;,             // Oxyd1 floor 0x29
-    &quot;fl-gradient8&quot;,             // Oxyd1 floor 0x2a
-    &quot;fl-gradient9&quot;,             // Oxyd1 floor 0x2b
-    &quot;fl-gradient10&quot;,            // Oxyd1 floor 0x2c
-    &quot;fl-gradient11&quot;,            // Oxyd1 floor 0x2d
-    &quot;fl-gradient12&quot;,            // Oxyd1 floor 0x2e
-    &quot;fl-gradient13&quot;,            // Oxyd1 floor 0x2f
-    &quot;fl-gradient14&quot;,            // Oxyd1 floor 0x30
-    &quot;fl-gradient15&quot;,            // Oxyd1 floor 0x31
-    &quot;fl-gradient16&quot;,            // Oxyd1 floor 0x32
+    &quot;fl_slope_ps&quot;,              // Oxyd1 floor 0x23
+    &quot;fl_slope_pn&quot;,              // Oxyd1 floor 0x24
+    &quot;fl_slope_pe&quot;,              // Oxyd1 floor 0x25
+    &quot;fl_slope_pw&quot;,              // Oxyd1 floor 0x26
+    &quot;fl_slope_ose&quot;,             // Oxyd1 floor 0x27
+    &quot;fl_slope_osw&quot;,             // Oxyd1 floor 0x28
+    &quot;fl_slope_one&quot;,             // Oxyd1 floor 0x29
+    &quot;fl_slope_onw&quot;,             // Oxyd1 floor 0x2a
+    &quot;fl_slope_ise&quot;,             // Oxyd1 floor 0x2b
+    &quot;fl_slope_ine&quot;,             // Oxyd1 floor 0x2c
+    &quot;fl_slope_isw&quot;,             // Oxyd1 floor 0x2d
+    &quot;fl_slope_inw&quot;,             // Oxyd1 floor 0x2e
+    &quot;fl_slope_ts&quot;,              // Oxyd1 floor 0x2f
+    &quot;fl_slope_tn&quot;,              // Oxyd1 floor 0x30
+    &quot;fl_slope_te&quot;,              // Oxyd1 floor 0x31
+    &quot;fl_slope_tw&quot;,              // Oxyd1 floor 0x32
     &quot;fl_brick&quot;,                 // Oxyd1 floor 0x33
     &quot;fl_brick&quot;,                 // Oxyd1 floor 0x34 (common was 'fl-rough')
     UNUSED,                     // Oxyd1 floor 0x35

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/ox_peroxyd.cc	2009-02-05 22:51:49 UTC (rev 1516)
@@ -138,22 +138,22 @@
     UNUSED,                     // PerOxyd floor 0x20
     &quot;fl_space_force&quot;,           // PerOxyd floor 0x21 (flat force)
     UNUSED,                     // PerOxyd floor 0x22
-    &quot;fl-gradient1&quot;,             // PerOxyd floor 0x23
-    &quot;fl-gradient2&quot;,             // PerOxyd floor 0x24
-    &quot;fl-gradient3&quot;,             // PerOxyd floor 0x25
-    &quot;fl-gradient4&quot;,             // PerOxyd floor 0x26
-    &quot;fl-gradient5&quot;,             // PerOxyd floor 0x27
-    &quot;fl-gradient6&quot;,             // PerOxyd floor 0x28
-    &quot;fl-gradient7&quot;,             // PerOxyd floor 0x29
-    &quot;fl-gradient8&quot;,             // PerOxyd floor 0x2a
-    &quot;fl-gradient9&quot;,             // PerOxyd floor 0x2b
-    &quot;fl-gradient10&quot;,            // PerOxyd floor 0x2c
-    &quot;fl-gradient11&quot;,            // PerOxyd floor 0x2d
-    &quot;fl-gradient12&quot;,            // PerOxyd floor 0x2e
-    &quot;fl-gradient13&quot;,            // PerOxyd floor 0x2f (flat force)
-    &quot;fl-gradient14&quot;,            // PerOxyd floor 0x30 (flat force)
-    &quot;fl-gradient15&quot;,            // PerOxyd floor 0x31 (flat force)
-    &quot;fl-gradient16&quot;,            // PerOxyd floor 0x32 (flat force)
+    &quot;fl_slope_ps&quot;,             // PerOxyd floor 0x23
+    &quot;fl_slope_pn&quot;,             // PerOxyd floor 0x24
+    &quot;fl_slope_pe&quot;,             // PerOxyd floor 0x25
+    &quot;fl_slope_pw&quot;,             // PerOxyd floor 0x26
+    &quot;fl_slope_ose&quot;,             // PerOxyd floor 0x27
+    &quot;fl_slope_osw&quot;,             // PerOxyd floor 0x28
+    &quot;fl_slope_one&quot;,             // PerOxyd floor 0x29
+    &quot;fl_slope_onw&quot;,             // PerOxyd floor 0x2a
+    &quot;fl_slope_ise&quot;,             // PerOxyd floor 0x2b
+    &quot;fl_slope_ine&quot;,            // PerOxyd floor 0x2c
+    &quot;fl_slope_isw&quot;,            // PerOxyd floor 0x2d
+    &quot;fl_slope_inw&quot;,            // PerOxyd floor 0x2e
+    &quot;fl_slope_ts&quot;,            // PerOxyd floor 0x2f (flat force)
+    &quot;fl_slope_tn&quot;,            // PerOxyd floor 0x30 (flat force)
+    &quot;fl_slope_te&quot;,            // PerOxyd floor 0x31 (flat force)
+    &quot;fl_slope_tw&quot;,            // PerOxyd floor 0x32 (flat force)
     &quot;fl_rough&quot;,                 // PerOxyd floor 0x33 (common was 'fl-rough', should be a 'fl-paper')(only level 75)
     &quot;fl_rough&quot;,                 // PerOxyd floor 0x34
     UNUSED,                     // PerOxyd floor 0x35

Modified: trunk/src/oxyd.cc
===================================================================
--- trunk/src/oxyd.cc	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/oxyd.cc	2009-02-05 22:51:49 UTC (rev 1516)
@@ -435,7 +435,7 @@
 
             if( name == 0) {
                 Log &lt;&lt; ecl::strf (&quot;Unknown floor %X\n&quot;,code);
-                fl = MakeFloor(&quot;fl-dummy&quot;);
+                fl = MakeFloor(&quot;fl_dummy&quot;);
                 fl-&gt;setAttr(&quot;code&quot;, code);
             }
             else {

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2009-02-05 21:35:42 UTC (rev 1515)
+++ trunk/src/world.cc	2009-02-05 22:51:49 UTC (rev 1516)
@@ -566,9 +566,11 @@
     V2 f = mforce;
     if (a-&gt;get_controllers() != 0) {
         if (a-&gt;is_drunken()) {
-            double time = fmod(server::LevelTime, 2.0) - 1.0;
+//            double time = fmod(server::LevelTime, 2.0) - 1.0;
+            int t = (int)server::LevelTime;
+            double time = fmod(t * M_PI, 2.0) - 1.0;
             // rotate mouse force by random angle
-            double maxangle = M_PI * 0.7;
+            double maxangle = M_PI * 0.4;
             double angle = maxangle * time;
 //            double angle = DoubleRand (-maxangle, maxangle);
             f = V2(f[0]*cos(angle) - f[1]*sin(angle),
@@ -2393,7 +2395,6 @@
     Object::bootFinished();
     BootRegister(NULL, NULL, false);
     InitLasers();
-    InitFloors();
 }
 
 void ShutdownWorld() {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000945.html">[Enigma-game-svn] r1515 - in trunk: attic/images-items data/gfx16	data/gfx32 data/gfx40 data/gfx48 data/gfx64
</A></li>
	<LI>Next message: <A HREF="000947.html">[Enigma-game-svn] r1517 - team_levelpacks/team_test_new_api
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#946">[ date ]</a>
              <a href="thread.html#946">[ thread ]</a>
              <a href="subject.html#946">[ subject ]</a>
              <a href="author.html#946">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
