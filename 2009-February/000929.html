<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1500 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/stones
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1500%20-%20in%20trunk%3A%20data%20data/gfx32%20data/gfx40%0A%09data/gfx48%20data/schemas%20src%20src/stones&In-Reply-To=%3C200902020027.n120RX2o015694%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000928.html">
   <LINK REL="Next"  HREF="000930.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1500 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/stones</H1>
    <B>ral at BerliOS</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1500%20-%20in%20trunk%3A%20data%20data/gfx32%20data/gfx40%0A%09data/gfx48%20data/schemas%20src%20src/stones&In-Reply-To=%3C200902020027.n120RX2o015694%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1500 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/stones">ral at mail.berlios.de
       </A><BR>
    <I>Mon Feb  2 01:27:33 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000928.html">[Enigma-game-svn] r1499 - homepage/input
</A></li>
        <LI>Next message: <A HREF="000930.html">[Enigma-game-svn] r1501 - in trunk/data/levels: enigma_cross	enigma_iv enigma_v enigma_vii enigma_viii
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#929">[ date ]</a>
              <a href="thread.html#929">[ thread ]</a>
              <a href="subject.html#929">[ subject ]</a>
              <a href="author.html#929">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ral
Date: 2009-02-02 01:27:28 +0100 (Mon, 02 Feb 2009)
New Revision: 1500

Added:
   trunk/data/gfx32/sh_portal_horse.png
   trunk/data/gfx32/st_dummy.png
   trunk/data/gfx32/st_jamb_black.png
   trunk/data/gfx32/st_jamb_white.png
   trunk/data/gfx32/st_portal_horse.png
   trunk/data/gfx40/sh_portal_horse.png
   trunk/data/gfx40/st_dummy.png
   trunk/data/gfx40/st_jamb_black.png
   trunk/data/gfx40/st_jamb_white.png
   trunk/data/gfx40/st_portal_horse.png
   trunk/data/gfx48/sh_portal_horse.png
   trunk/data/gfx48/st_dummy.png
   trunk/data/gfx48/st_jamb_black.png
   trunk/data/gfx48/st_jamb_white.png
   trunk/data/gfx48/st_portal_horse.png
   trunk/src/stones/ChameleonStone.cc
   trunk/src/stones/ChameleonStone.hh
   trunk/src/stones/JambStone.cc
   trunk/src/stones/JambStone.hh
   trunk/src/stones/PortalStone.cc
   trunk/src/stones/PortalStone.hh
Removed:
   trunk/data/gfx32/sh-grate3.png
   trunk/data/gfx32/st-blackballs.png
   trunk/data/gfx32/st-dummy.png
   trunk/data/gfx32/st-grate3.png
   trunk/data/gfx32/st-whiteballs.png
   trunk/data/gfx40/sh-grate3.png
   trunk/data/gfx40/st-blackballs.png
   trunk/data/gfx40/st-dummy.png
   trunk/data/gfx40/st-grate3.png
   trunk/data/gfx40/st-whiteballs.png
   trunk/data/gfx48/sh-grate3.png
   trunk/data/gfx48/st-blackballs.png
   trunk/data/gfx48/st-dummy.png
   trunk/data/gfx48/st-grate3.png
   trunk/data/gfx48/st-whiteballs.png
Modified:
   trunk/data/api1init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/oxyd.cc
   trunk/src/stones.cc
   trunk/src/stones.hh
   trunk/src/stones/CompatibilityStones.cc
   trunk/src/stones/CompatibilityStones.hh
   trunk/src/stones/SimpleStones.hh
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering
- reengineering grate3:
  - new class portal stone
  - st-grate3 -&gt; st_portal_horse, st_portal
  - limit st_portal_horse to horse actors
  - st_portal_pearl lets pass only pearl actors
  - read only attribute flavor - &quot;horse&quot;, &quot;pearl&quot;
- reengineering black-/whiteballs:
  - new class jamb stone
  - st-blackballs -&gt; st_jamb_black, st_jamb
  - st-whiteballs -&gt; st_jamb_white
  - attribute &quot;color&quot;
- renaming:
  - st-chameleon -&gt; st_chameleon
  - st-dummy -&gt; st_dummy
Note:
- chameleon features are still incomplete and need to be fixed 

Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/data/api1init.lua	2009-02-02 00:27:28 UTC (rev 1500)
@@ -286,6 +286,7 @@
     st_camouflage = &quot;st-camouflage&quot;,
     st_camouflage_hollow = &quot;st-camouflage_hole&quot;,
     st_camouflage_movable = &quot;st-camouflage_move&quot;,
+    st_chameleon = &quot;st-chameleon&quot;,
     st_charge_minus = &quot;st-chargeminus&quot;,
     st_charge_plus = &quot;st-chargeplus&quot;,
     st_charge_zero = &quot;st-chargezero&quot;,
@@ -338,6 +339,8 @@
     st_invisible = &quot;st-invisible&quot;,
     st_invisible_hollow = &quot;st-invisible_hole&quot;,
     st_invisible_movable = &quot;st-invisible_move&quot;,
+    st_jamb_black = &quot;st-blackballs&quot;,
+    st_jamb_white = &quot;st-whiteballs&quot;,
     st_knight = &quot;st-knight&quot;,
     st_laser_w = &quot;st-laser-w&quot;,
     st_laser_s = &quot;st-laser-s&quot;,
@@ -427,6 +430,7 @@
     st_plaster_breakable = &quot;st-rock3_break&quot;,
     st_plaster_movebreakable = &quot;st-rock3_movebreak&quot;,
     st_plop = &quot;st-block&quot;,
+    st_portal_horse = &quot;st-grate3&quot;,
     st_pull = &quot;st-pull&quot;,
     st_purplegray = &quot;st-rock6&quot;,
     st_purplemarble = &quot;st-rock4&quot;,

Deleted: trunk/data/gfx32/sh-grate3.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/sh_portal_horse.png (from rev 1494, trunk/data/gfx32/sh-grate3.png)

Deleted: trunk/data/gfx32/st-blackballs.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-dummy.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-grate3.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-whiteballs.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/st_dummy.png (from rev 1494, trunk/data/gfx32/st-dummy.png)

Copied: trunk/data/gfx32/st_jamb_black.png (from rev 1494, trunk/data/gfx32/st-blackballs.png)

Copied: trunk/data/gfx32/st_jamb_white.png (from rev 1494, trunk/data/gfx32/st-whiteballs.png)

Copied: trunk/data/gfx32/st_portal_horse.png (from rev 1494, trunk/data/gfx32/st-grate3.png)

Deleted: trunk/data/gfx40/sh-grate3.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/sh_portal_horse.png (from rev 1494, trunk/data/gfx40/sh-grate3.png)

Deleted: trunk/data/gfx40/st-blackballs.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-dummy.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-grate3.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-whiteballs.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/st_dummy.png (from rev 1494, trunk/data/gfx40/st-dummy.png)

Copied: trunk/data/gfx40/st_jamb_black.png (from rev 1494, trunk/data/gfx40/st-blackballs.png)

Copied: trunk/data/gfx40/st_jamb_white.png (from rev 1494, trunk/data/gfx40/st-whiteballs.png)

Copied: trunk/data/gfx40/st_portal_horse.png (from rev 1494, trunk/data/gfx40/st-grate3.png)

Deleted: trunk/data/gfx48/sh-grate3.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/sh_portal_horse.png (from rev 1494, trunk/data/gfx48/sh-grate3.png)

Deleted: trunk/data/gfx48/st-blackballs.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-dummy.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-grate3.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-whiteballs.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/st_dummy.png (from rev 1494, trunk/data/gfx48/st-dummy.png)

Copied: trunk/data/gfx48/st_jamb_black.png (from rev 1494, trunk/data/gfx48/st-blackballs.png)

Copied: trunk/data/gfx48/st_jamb_white.png (from rev 1494, trunk/data/gfx48/st-whiteballs.png)

Copied: trunk/data/gfx48/st_portal_horse.png (from rev 1494, trunk/data/gfx48/st-grate3.png)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/data/models-2d.lua	2009-02-02 00:27:28 UTC (rev 1500)
@@ -727,7 +727,7 @@
     DefImage(&quot;sh-round2&quot;)
     DefImage(&quot;sh_grate_cross&quot;)
     DefImage(&quot;sh_grate_framed&quot;)
-    DefImage(&quot;sh-grate3&quot;)
+    DefImage(&quot;sh_portal_horse&quot;)
     DefImage(&quot;sh-glass&quot;)
     DefImage(&quot;sh-white4&quot;)
     DefImage(&quot;sh-puzzle1&quot;)
@@ -745,7 +745,7 @@
     DefStone(&quot;st-black2&quot;)
     DefStone(&quot;st-black3&quot;)
     DefStone(&quot;st-black4&quot;, &quot;sh-white4&quot;)
-    DefStone(&quot;st-blackballs&quot;)
+    DefStone(&quot;st_jamb_black&quot;)
     DefStone(&quot;st_plop_slate&quot;)
     DefStone(&quot;st_bluegray&quot;, &quot;sh-round&quot;)
     DefStone(&quot;st-brake&quot;, &quot;sh-brake&quot;)
@@ -753,7 +753,7 @@
     DefStone(&quot;st-bug&quot;)
     DefStone(&quot;st_pinkbumps&quot;)
     DefStone(&quot;st_camouflage&quot;)
-    DefStone(&quot;st-dummy&quot;)
+    DefStone(&quot;st_dummy&quot;)
     DefImage(&quot;st-easymode&quot;)
     DefStone(&quot;st-flhay&quot;)
     DefStone(&quot;st_flat_fire&quot;)
@@ -766,7 +766,7 @@
     DefStone(&quot;st_redfiber&quot;, &quot;sh-glass&quot;)
     DefStone(&quot;st_grate_cross&quot;, &quot;sh_grate_cross&quot;)
     DefStone(&quot;st_grate_framed&quot;, &quot;sh_grate_framed&quot;)
-    DefStone(&quot;st-grate3&quot;, &quot;sh-grate3&quot;)
+    DefStone(&quot;st_portal_horse&quot;, &quot;sh_portal_horse&quot;)
     DefStone(&quot;st_greenbrown&quot;, &quot;sh-round&quot;)
     DefStone(&quot;st-key0&quot;, &quot;sh-round&quot;, {filename=&quot;st-key1&quot;})
     DefStone(&quot;st-key1&quot;, &quot;sh-round&quot;, {filename=&quot;st-key2&quot;})
@@ -793,7 +793,7 @@
     DefStone(&quot;st-white2&quot;)
     DefStone(&quot;st-white3&quot;)
     DefStone(&quot;st-white4&quot;, &quot;sh-white4&quot;)
-    DefStone(&quot;st-whiteballs&quot;)
+    DefStone(&quot;st_jamb_white&quot;)
     DefStone(&quot;st_woven&quot;)
     DefStone(&quot;st_yellow&quot;)
     DefStone(&quot;st_blur_straight&quot;)

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/data/schemas/objects.xml	2009-02-02 00:27:28 UTC (rev 1500)
@@ -891,10 +891,15 @@
       &lt;msg name=&quot;heat&quot;/&gt;
       &lt;msg name=&quot;_fall&quot;/&gt;
     &lt;/object&gt;
-    &lt;object name=&quot;st_box_hay&quot; flavor=&quot;hay&quot;/&gt;
-    &lt;object name=&quot;st_box_rock&quot; flavor=&quot;rock&quot;/&gt;
-    &lt;object name=&quot;st_box_wood&quot; flavor=&quot;wood&quot;&gt;
+    &lt;object name=&quot;st_box_hay&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;hay&quot;/&gt;
     &lt;/object&gt;
+    &lt;object name=&quot;st_box_rock&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;rock&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_box_wood&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;wood&quot;/&gt;
+    &lt;/object&gt;
     &lt;object name=&quot;st_box_wood_growing&quot; init=&quot;true&quot;&gt;
     &lt;/object&gt;
     &lt;object name=&quot;st_box_wood_h&quot; init=&quot;true&quot;&gt;
@@ -990,6 +995,7 @@
     &lt;object name=&quot;st_camouflage_movable&quot;&gt;
       &lt;attr name=&quot;movable&quot; value=&quot;true&quot;/&gt;
     &lt;/object&gt;
+    &lt;object name=&quot;st_chameleon&quot;/&gt;
     &lt;object name=&quot;st_charge&quot;&gt;
       &lt;attr name=&quot;charge&quot;/&gt;
       &lt;attr name=&quot;$chargesign&quot;/&gt;
@@ -1201,6 +1207,17 @@
     &lt;object name=&quot;st_invisible_movable&quot;&gt;
       &lt;attr name=&quot;movable&quot; value=&quot;true&quot;/&gt;
     &lt;/object&gt;
+    &lt;object name=&quot;st_jamb&quot;&gt;
+      &lt;attr name=&quot;color&quot; default=&quot;0&quot;/&gt;
+      &lt;msg name=&quot;hit&quot;/&gt;
+      &lt;msg name=&quot;signal&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_jamb_black&quot;&gt;
+      &lt;attr name=&quot;color&quot; value=&quot;0&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_jamb_white&quot;&gt;
+      &lt;attr name=&quot;color&quot; value=&quot;1&quot;/&gt;
+    &lt;/object&gt;
     &lt;object name=&quot;st_key&quot;&gt;
       &lt;attr name=&quot;code&quot;/&gt;
       &lt;msg name=&quot;on&quot;/&gt;
@@ -1453,6 +1470,15 @@
       &lt;msg name=&quot;off&quot;/&gt;
       &lt;msg name=&quot;signal&quot;/&gt;
     &lt;/object&gt;
+    &lt;object name=&quot;st_portal&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; default=&quot;horse&quot; rw=&quot;r&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_portal_horse&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;horse&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_portal_pearl&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;pearl&quot;/&gt;
+    &lt;/object&gt;
     &lt;object name=&quot;st_pull&quot;&gt;
       &lt;attr name=&quot;state&quot; rw=&quot;r&quot;/&gt;
       &lt;msg name=&quot;_freeze&quot;/&gt;

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/Makefile.am	2009-02-02 00:27:28 UTC (rev 1500)
@@ -294,6 +294,8 @@
 	stones/BrakeStone.hh	\
 	stones/BreakStone.cc	\
 	stones/BreakStone.hh	\
+	stones/ChameleonStone.cc	\
+	stones/ChameleonStone.hh	\
 	stones/ChessStone.cc	\
 	stones/ChessStone.hh	\
 	stones/ClusterStone.cc	\
@@ -324,6 +326,8 @@
 	stones/GlassStones.hh	\
 	stones/GreenBrownStone.cc	\
 	stones/GreenBrownSTone.hh	\
+	stones/JambStone.cc	\
+	stones/JambStone.hh	\
 	stones/KeySwitch.cc	\
 	stones/KeySwitch.hh	\
 	stones/KnightStone.cc	\
@@ -352,6 +356,8 @@
 	stones/PlasterStone.hh	\
 	stones/PolarSwitchStone.cc	\
 	stones/PolarSwitchStone.hh	\
+	stones/PortalStone.cc	\
+	stones/PortalStone.hh	\
 	stones/PullStone.cc	\
 	stones/PullStone.hh	\
 	stones/PuzzleStone.cc	\

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/ox_oxyd1.cc	2009-02-02 00:27:28 UTC (rev 1500)
@@ -178,7 +178,7 @@
     &quot;st_grate_framed&quot;,          // Oxyd1 stone 0x1b
     &quot;st_break_bug&quot;,             // Oxyd1 stone 0x1c
     &quot;st_surprise&quot;,              // Oxyd1 stone 0x1d
-    &quot;st-chameleon&quot;,             // Oxyd1 stone 0x1e
+    &quot;st_chameleon&quot;,             // Oxyd1 stone 0x1e
     &quot;st_brick&quot;,                 // Oxyd1 stone 0x1f
     &quot;st_granite&quot;,               // Oxyd1 stone 0x20
     &quot;st_granite&quot;,               // Oxyd1 stone 0x21
@@ -292,8 +292,8 @@
     &quot;st_passage_black_square&quot;,  // Oxyd1 stone 0x8d
     &quot;st_blur_straight&quot;,         // Oxyd1 stone 0x8e
     UNUSED,                     // Oxyd1 stone 0x8f
-    &quot;st-whiteballs&quot;,            // Oxyd1 stone 0x90
-    &quot;st-blackballs&quot;,            // Oxyd1 stone 0x91
+    &quot;st_jamb_white&quot;,            // Oxyd1 stone 0x90
+    &quot;st_jamb_black&quot;,            // Oxyd1 stone 0x91
     &quot;st_fourswitch&quot;,            // Oxyd1 stone 0x92
     &quot;st_blur_cross&quot;,            // Oxyd1 stone 0x93
     &quot;st_break_white&quot;,           // Oxyd1 stone 0x94

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/ox_peroxyd.cc	2009-02-02 00:27:28 UTC (rev 1500)
@@ -215,7 +215,7 @@
     &quot;st_grate_cross&quot;,           // PerOxyd stone 0x18
     UNUSED,                     // PerOxyd stone 0x19
     &quot;st_surprise&quot;,              // PerOxyd stone 0x1a
-    &quot;st-chameleon&quot;,             // PerOxyd stone 0x1b (levels: 23 142 178 183)
+    &quot;st_chameleon&quot;,             // PerOxyd stone 0x1b (levels: 23 142 178 183)
     &quot;st_magic_brick&quot;,           // PerOxyd stone 0x1c
     &quot;st_camouflage&quot;,            // PerOxyd stone 0x1d (green camouflage piece)(if st-camouflage is implemented, put it in here)
     &quot;st_camouflage&quot;,            // PerOxyd stone 0x1e (green camouflage piece)
@@ -340,7 +340,7 @@
     0,                          // PerOxyd stone 0x95 (dynamite holder, will implememnt it)(levels: 41 184 200)
     &quot;st_rubberband&quot;,            // PerOxyd stone 0x96
     &quot;st_scissors&quot;,              // PerOxyd stone 0x97
-    &quot;st-grate3&quot;,                // PerOxyd stone 0x98
+    &quot;st_portal_horse&quot;,          // PerOxyd stone 0x98
     &quot;st_blocker&quot;,               // PerOxyd stone 0x99
     &quot;st-grate1&quot;,                // PerOxyd stone 0x9a
     &quot;st_metal_hollow&quot;,          // PerOxyd stone 0x9b

Modified: trunk/src/oxyd.cc
===================================================================
--- trunk/src/oxyd.cc	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/oxyd.cc	2009-02-02 00:27:28 UTC (rev 1500)
@@ -321,7 +321,7 @@
         const char *name = config.stonetable[type];
         if (name == 0) {
             Log &lt;&lt; ecl::strf(&quot;Unknown stone %X\n&quot;, type);
-            st = MakeStone (&quot;st-dummy&quot;);
+            st = MakeStone (&quot;st_dummy&quot;);
             st-&gt;setAttr(&quot;code&quot;, type);
         }
         else if (name[0] != '\0') { // ignore if name==&quot;&quot;

Added: trunk/src/stones/ChameleonStone.cc
===================================================================
--- trunk/src/stones/ChameleonStone.cc	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/stones/ChameleonStone.cc	2009-02-02 00:27:28 UTC (rev 1500)
@@ -0,0 +1,63 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include &quot;stones/ChameleonStone.hh&quot;
+
+#include &quot;errors.hh&quot;
+//#include &quot;main.hh&quot;
+
+namespace enigma {
+
+    ChameleonStone::ChameleonStone() : Stone() {
+    }
+    
+    std::string ChameleonStone::getClass() const {
+        return &quot;st_chameleon&quot;;
+    }
+    
+    Value ChameleonStone::message(const Message &amp;m) {
+        if (m.message == &quot;_model_reanimated&quot;) {
+                init_model();
+        }
+        return Stone::message(m);
+    }
+    
+    void ChameleonStone::init_model()  {
+        if (Floor *fl = GetFloor(get_pos())) {
+            set_model(fl-&gt;get_kind());
+        } else
+            ASSERT(false, XLevelRuntime, &quot;Chameleon Stone: Floor must be set before stone&quot;);
+    }
+    
+    bool ChameleonStone::is_floating() const {
+        return true;
+    }
+
+    StoneResponse ChameleonStone::collision_response(const StoneContact &amp;) {
+        return STONE_PASS;
+    }
+
+    DEF_TRAITS(ChameleonStone, &quot;st_chameleon&quot;, st_chameleon);
+
+    BOOT_REGISTER_START
+        BootRegister(new ChameleonStone(), &quot;st_chameleon&quot;);
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/ChameleonStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/ChameleonStone.hh
===================================================================
--- trunk/src/stones/ChameleonStone.hh	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/stones/ChameleonStone.hh	2009-02-02 00:27:28 UTC (rev 1500)
@@ -0,0 +1,52 @@
+/*
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef CHAMELEONSTONE_HH_
+#define CHAMELEONSTONE_HH_
+
+#include &quot;stones.hh&quot;
+#include &quot;stones_internal.hh&quot;
+
+namespace enigma {
+
+    /** 
+     * 
+     * 
+     */
+    class ChameleonStone : public Stone {
+         CLONEOBJ(ChameleonStone);
+         DECL_TRAITS;
+
+    public:
+        ChameleonStone();
+
+        // Object interface
+        virtual std::string getClass() const;
+        virtual Value message(const Message &amp;m);
+        
+        // GridObject interface
+        virtual void init_model();
+        
+        // Stone interface
+        virtual bool is_floating() const;
+        virtual StoneResponse collision_response(const StoneContact &amp;sc);
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/ChameleonStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones/CompatibilityStones.cc
===================================================================
--- trunk/src/stones/CompatibilityStones.cc	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/stones/CompatibilityStones.cc	2009-02-02 00:27:28 UTC (rev 1500)
@@ -20,7 +20,7 @@
 #include &quot;stones/CompatibilityStones.hh&quot;
 #include &quot;errors.hh&quot;
 #include &quot;client.hh&quot;
-//#include &quot;main.hh&quot;
+#include &quot;main.hh&quot;
 
 namespace enigma {
 
@@ -43,6 +43,21 @@
     DEF_TRAITSM(DongleStone, &quot;st_dongle&quot;, st_dongle, MOVABLE_BREAKABLE);
 
 
+/* -------------------- DummyStone -------------------- */
+
+    DummyStone::DummyStone() : Stone(&quot;st_dummy&quot;){
+    }
+    
+    StoneResponse DummyStone::collision_response(const StoneContact &amp;/*sc*/) {
+        static int lastCode = -1;
+        int        code     = getAttr(&quot;code&quot;);
+        if (code != lastCode) {
+            Log &lt;&lt; ecl::strf(&quot;Collision with stone 0x%02x\n&quot;, code);
+            lastCode = code;
+        }
+        return STONE_REBOUND;
+    }
+
     /**  st-easymode Easy-Mode Stone
     
     In easy game mode this stone converts the floor at its
@@ -110,6 +125,7 @@
     
     BOOT_REGISTER_START
         BootRegister(new DongleStone(), &quot;st_dongle&quot;);
+        BootRegister(new DummyStone(), &quot;st_dummy&quot;);
         BootRegister(new EasyModeStone(), &quot;st-easymode&quot;);
         BootRegister(new Peroxyd_0xb8(), &quot;st-peroxyd-0xb8&quot;);
         BootRegister(new Peroxyd_0xb9(), &quot;st-peroxyd-0xb9&quot;);

Modified: trunk/src/stones/CompatibilityStones.hh
===================================================================
--- trunk/src/stones/CompatibilityStones.hh	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/stones/CompatibilityStones.hh	2009-02-02 00:27:28 UTC (rev 1500)
@@ -35,6 +35,18 @@
         virtual void actor_hit (const StoneContact &amp;sc);
     };
     
+    /** 
+     * DummyStone
+     */
+    class DummyStone : public Stone {
+        CLONEOBJ(DummyStone);
+    public:
+        DummyStone();
+    
+        // Stone interface
+        virtual StoneResponse collision_response(const StoneContact &amp;sc);
+    };
+    
     class EasyModeStone : public Stone {
         CLONEOBJ(EasyModeStone);
         DECL_TRAITS;

Added: trunk/src/stones/JambStone.cc
===================================================================
--- trunk/src/stones/JambStone.cc	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/stones/JambStone.cc	2009-02-02 00:27:28 UTC (rev 1500)
@@ -0,0 +1,79 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include &quot;stones/JambStone.hh&quot;
+#include &quot;errors.hh&quot;
+//#include &quot;main.hh&quot;
+
+namespace enigma {
+    JambStone::JambStone(int color) : Stone() {
+        Stone::setAttr(&quot;color&quot;, color);
+    }
+    
+    std::string JambStone::getClass() const {
+        return &quot;st_jamb&quot;;
+    }
+    
+    Value JambStone::message(const Message &amp;m) {
+        if (m.message == &quot;signal&quot; || m.message == &quot;hit&quot;) {
+            if (GridObject *sender = dynamic_cast&lt;GridObject*&gt;(m.sender)) {
+                GridPos p = get_pos();
+                Object *o;
+                if (m.message == &quot;hit&quot;)
+                    o = m.value;
+                else
+                    o = SendMessage(m.sender, &quot;_hitactor&quot;);
+                
+                Actor *a = dynamic_cast&lt;Actor *&gt;(o);
+                int c = getAttr(&quot;color&quot;);
+                if ((c == BLACK &amp;&amp; a &amp;&amp; get_id(a) == ac_marble_black) || 
+                        (c == WHITE &amp;&amp; a &amp;&amp; get_id(a) == ac_marble_white) ||
+                        (m.sender-&gt;getObjectType() != Object::ITEM &amp;&amp; m.message == &quot;signal&quot;)) {
+                    if (p.y == sender-&gt;get_pos().y) {
+                        SendMessage (GetStone (move (p, EAST)),  &quot;signal&quot;, 1.0);
+                        SendMessage (GetStone (move (p, WEST)),  &quot;signal&quot;, 1.0);
+                        SendMessage (GetStone (move (p, NORTH)), &quot;signal&quot;, 0.0);
+                        SendMessage (GetStone (move (p, SOUTH)), &quot;signal&quot;, 0.0);
+                    }
+                    else {
+                        SendMessage (GetStone (move (p, EAST)),  &quot;signal&quot;, 0.0);
+                        SendMessage (GetStone (move (p, WEST)),  &quot;signal&quot;, 0.0);
+                        SendMessage (GetStone (move (p, NORTH)), &quot;signal&quot;, 1.0);
+                        SendMessage (GetStone (move (p, SOUTH)), &quot;signal&quot;, 1.0);
+                    }
+                    return Value();
+                }
+            }
+        }
+        return Stone::message(m);
+    }
+
+    void JambStone::init_model() {
+        set_model(ecl::strf(&quot;st_jamb_%s&quot;, getAttr(&quot;color&quot;) == BLACK ? &quot;black&quot; : &quot;white&quot;));
+    }
+    
+    DEF_TRAITS(JambStone, &quot;st_jamb&quot;, st_jamb);
+    
+    BOOT_REGISTER_START
+        BootRegister(new JambStone(0), &quot;st_jamb&quot;);
+        BootRegister(new JambStone(0), &quot;st_jamb_black&quot;);
+        BootRegister(new JambStone(1), &quot;st_jamb_white&quot;);
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/JambStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/JambStone.hh
===================================================================
--- trunk/src/stones/JambStone.hh	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/stones/JambStone.hh	2009-02-02 00:27:28 UTC (rev 1500)
@@ -0,0 +1,52 @@
+/*
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef JAMBSTONE_HH
+#define JAMBSTONE_HH
+
+#include &quot;stones.hh&quot;
+
+#include &quot;stones_internal.hh&quot;
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class JambStone : public Stone {
+         CLONEOBJ(JambStone);
+         DECL_TRAITS;
+
+    public:
+        JambStone(int color);
+        
+        // Object interface
+        virtual std::string getClass() const;
+        virtual Value message(const Message &amp;m);
+            
+        // GridObject interface
+        virtual void init_model();
+        
+    private:
+        // Private methods.
+        int traitsIdx() const;
+    };
+
+} // namespace enigma
+
+#endif /*JAMBSTONE_HH*/


Property changes on: trunk/src/stones/JambStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/PortalStone.cc
===================================================================
--- trunk/src/stones/PortalStone.cc	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/stones/PortalStone.cc	2009-02-02 00:27:28 UTC (rev 1500)
@@ -0,0 +1,80 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include &quot;stones/PortalStone.hh&quot;
+//#include &quot;errors.hh&quot;
+//#include &quot;main.hh&quot;
+
+namespace enigma {
+    PortalStone::PortalStone(int typ) : Stone() {
+        state = typ;
+    }
+    
+    std::string PortalStone::getClass() const {
+        return &quot;st_portal&quot;;
+    }
+    
+    Value PortalStone::getAttr(const std::string &amp;key) const {
+        if (key == &quot;flavor&quot;) {
+            switch (state) {
+                case HORSE:
+                    return &quot;horse&quot;;
+                case PEARL:
+                    return &quot;pearl&quot;;
+            }
+        }
+        return Stone::getAttr(key);
+    }
+
+    void PortalStone::setState(int extState) {
+        // no external states
+    }
+    
+    void PortalStone::init_model() {
+        switch (state) {
+            default:
+            case HORSE:
+            case PEARL:
+                set_model(&quot;st_portal_horse&quot;);
+                break;
+        }
+    }
+    
+    bool PortalStone::is_floating() const {
+        return true;
+    }
+    
+    StoneResponse PortalStone::collision_response(const StoneContact &amp;sc) {
+        ActorID id = get_id(sc.actor);
+        if ((state == HORSE &amp;&amp; id == ac_horse) || (state == PEARL &amp;&amp; id == ac_pearl_white))
+            return STONE_PASS;
+        else
+            return STONE_REBOUND;
+    }
+    
+    DEF_TRAITS(PortalStone, &quot;st_portal&quot;, st_portal);
+
+    BOOT_REGISTER_START
+        BootRegister(new PortalStone(0), &quot;st_portal&quot;);
+        BootRegister(new PortalStone(0), &quot;st_portal_horse&quot;);
+        BootRegister(new PortalStone(1), &quot;st_portal_pearl&quot;);
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/PortalStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/PortalStone.hh
===================================================================
--- trunk/src/stones/PortalStone.hh	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/stones/PortalStone.hh	2009-02-02 00:27:28 UTC (rev 1500)
@@ -0,0 +1,61 @@
+/*
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef PORTALSTONE_HH
+#define PORTALSTONE_HH
+
+#include &quot;stones.hh&quot;
+
+#include &quot;stones_internal.hh&quot;
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class PortalStone : public Stone {
+         CLONEOBJ(PortalStone);
+         DECL_TRAITS;
+
+    private:
+        enum iState {
+            HORSE,      ///&lt; 
+            PEARL       ///&lt; 
+        };
+        
+    public:
+        PortalStone(int typ);
+        
+        // Object interface
+        virtual std::string getClass() const;
+        virtual Value getAttr(const std::string &amp;key) const;
+        
+        // StateObject interface
+        virtual void setState(int extState);
+        
+        // GridObject interface
+        virtual void init_model();
+        
+        // Stone interface
+        virtual bool is_floating() const;
+        virtual StoneResponse collision_response(const StoneContact &amp;sc);
+    };
+
+} // namespace enigma
+
+#endif /*PORTALSTONE_HH*/


Property changes on: trunk/src/stones/PortalStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones/SimpleStones.hh
===================================================================
--- trunk/src/stones/SimpleStones.hh	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/stones/SimpleStones.hh	2009-02-02 00:27:28 UTC (rev 1500)
@@ -1,6 +1,6 @@
 /*
  * Copyright (C) 2008 Andreas Lochmann
- * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/stones.cc	2009-02-02 00:27:28 UTC (rev 1500)
@@ -407,93 +407,7 @@
     }
 }
 
-/* -------------------- Black- and Whiteballs Stones -------------------- */
 
-namespace
-{
-    class BlackBallsStone : public Stone {
-        CLONEOBJ(BlackBallsStone);
-
-        virtual Value message(const Message &amp;m)
-        {
-            if (m.message == &quot;signal&quot; || m.message == &quot;hit&quot;) {
-                if (GridObject *sender = dynamic_cast&lt;GridObject*&gt;(m.sender)) {
-                    GridPos p = get_pos();
-                    Object *o;
-                    if (m.message == &quot;hit&quot;)
-                        o = m.value;
-                    else
-                        o = SendMessage(m.sender, &quot;_hitactor&quot;);
-                    
-                    Actor *a = dynamic_cast&lt;Actor *&gt;(o);
-                    if ((a &amp;&amp; get_id(a) == ac_marble_black) || 
-                            (m.sender-&gt;getObjectType() != Object::ITEM &amp;&amp; m.message == &quot;signal&quot;)) {
-                        if (p.y == sender-&gt;get_pos().y) {
-                            SendMessage (GetStone (move (p, EAST)),  &quot;signal&quot;, 1.0);
-                            SendMessage (GetStone (move (p, WEST)),  &quot;signal&quot;, 1.0);
-                            SendMessage (GetStone (move (p, NORTH)), &quot;signal&quot;, 0.0);
-                            SendMessage (GetStone (move (p, SOUTH)), &quot;signal&quot;, 0.0);
-                        }
-                        else {
-                            SendMessage (GetStone (move (p, EAST)),  &quot;signal&quot;, 0.0);
-                            SendMessage (GetStone (move (p, WEST)),  &quot;signal&quot;, 0.0);
-                            SendMessage (GetStone (move (p, NORTH)), &quot;signal&quot;, 1.0);
-                            SendMessage (GetStone (move (p, SOUTH)), &quot;signal&quot;, 1.0);
-                        }
-                        return Value();
-                    }
-                }
-            }
-            return Stone::message(m);
-        }
-    public:
-        BlackBallsStone() : Stone (&quot;st-blackballs&quot;) {
-        }
-    };
-
-    class WhiteBallsStone : public Stone {
-        CLONEOBJ(WhiteBallsStone);
-
-        virtual Value message(const Message &amp;m)
-        {
-            if (m.message == &quot;signal&quot; || m.message == &quot;hit&quot;) {
-                if (GridObject *sender = dynamic_cast&lt;GridObject*&gt;(m.sender)) {
-                    GridPos p = get_pos();
-                    Object *o;
-                    if (m.message == &quot;hit&quot;)
-                        o = m.value;
-                    else
-                        o = SendMessage(m.sender, &quot;_hitactor&quot;);
-                        
-                    Actor *a = dynamic_cast&lt;Actor *&gt;(o);
-                    if ((a &amp;&amp; get_id(a) == ac_marble_white) ||
-                             (m.sender-&gt;getObjectType() != Object::ITEM &amp;&amp; m.message == &quot;signal&quot;)) {
-                        if (p.y == sender-&gt;get_pos().y) {
-                            SendMessage (GetStone (move (p, EAST)),  &quot;signal&quot;, 1.0);
-                            SendMessage (GetStone (move (p, WEST)),  &quot;signal&quot;, 1.0);
-                            SendMessage (GetStone (move (p, NORTH)), &quot;signal&quot;, 0.0);
-                            SendMessage (GetStone (move (p, SOUTH)), &quot;signal&quot;, 0.0);
-                        }
-                        else {
-                            SendMessage (GetStone (move (p, EAST)),  &quot;signal&quot;, 0.0);
-                            SendMessage (GetStone (move (p, WEST)),  &quot;signal&quot;, 0.0);
-                            SendMessage (GetStone (move (p, NORTH)), &quot;signal&quot;, 1.0);
-                            SendMessage (GetStone (move (p, SOUTH)), &quot;signal&quot;, 1.0);
-                        }
-                        return Value();
-                    }
-                }
-            }
-            return Stone::message(m);
-        }
-
-    public:
-        WhiteBallsStone() : Stone (&quot;st-whiteballs&quot;) {
-        }
-
-    };
-}
-
 // --------------------------------------------------------------------------------
 
 void InitStones() {
@@ -501,8 +415,6 @@
     // Register(new ...);
 
     Register (new SpitterStone);
-    Register (new BlackBallsStone);
-    Register (new WhiteBallsStone);
 
     // Init stones from stones_simple.cc and stones_complex.cc:
     Init_simple();

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/stones.hh	2009-02-02 00:27:28 UTC (rev 1500)
@@ -50,6 +50,7 @@
         st_break_plain,
         st_break_white,
         st_ghost_break,
+        st_jamb,
         st_chameleon,
         st_chess,
         st_magic_oxydc,
@@ -73,6 +74,7 @@
         st_peroxyd_0xb8,
         st_peroxyd_0xb9,
         st_plop,
+        st_portal,
         st_pull,
         st_puzzle,
         st_rotator,

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2009-02-01 15:14:54 UTC (rev 1499)
+++ trunk/src/stones_simple.cc	2009-02-02 00:27:28 UTC (rev 1500)
@@ -24,7 +24,6 @@
 #include &quot;client.hh&quot;
 #include &quot;main.hh&quot;
 #include &quot;Inventory.hh&quot;
-#include &quot;items/GlassesItem.hh&quot;
 
 #include &quot;stones_internal.hh&quot;
 
@@ -32,103 +31,6 @@
 
 namespace enigma {
 
-
-/* -------------------- DummyStone -------------------- */
-
-namespace
-{
-    /*! Used for debugging; Prints its own oxyd code when hit. */
-    class DummyStone : public Stone {
-        CLONEOBJ(DummyStone);
-    public:
-        DummyStone() : Stone(&quot;st-dummy&quot;) {}
-    private:
-
-        StoneResponse collision_response(const StoneContact &amp;/*sc*/) {
-            static int lastCode = -1;
-            int        code     = getAttr(&quot;code&quot;);
-            if (code != lastCode) {
-                fprintf(stderr, &quot;Collision with stone 0x%02x\n&quot;, code);
-                lastCode = code;
-            }
-            return STONE_REBOUND;
-        }
-    };
-}
-
-/* -------------------- Grates -------------------- */
-
-namespace
-{
-    class GrateBase : public Stone {
-    public:
-        GrateBase(const char *kind) : Stone(kind) {}
-    private:
-        bool is_floating() const { return true; }
-        bool is_transparent (Direction) const { return true; }
-
-        virtual StoneResponse collision_response(const StoneContact &amp;sc) {
-            if (server::GameCompatibility == GAMET_OXYD1) {
-                return STONE_PASS;
-            }
-            // tested with per.oxyd
-            return sc.actor-&gt;is_on_floor() ? STONE_PASS : STONE_REBOUND;
-        }
-    };
-
-    /*! Horses and small marbles can move through this stone, but
-      normal marbles can't. */
-    class Grate3 : public GrateBase {
-        CLONEOBJ(Grate3);
-    public:
-        Grate3() : GrateBase(&quot;st-grate3&quot;) {}
-
-        StoneResponse collision_response(const StoneContact &amp;sc) {
-            ActorID id = get_id(sc.actor);
-            if (id == ac_horse || id == ac_pearl_white || id == ac_killer)
-                return STONE_PASS;
-            else
-                return STONE_REBOUND;
-        }
-    };
-}
-
-
-/* -------------------- Chameleon Stone -------------------- */
-
-namespace
-{
-    class ChameleonStone : public Stone {
-        CLONEOBJ(ChameleonStone);
-        DECL_TRAITS;
-
-        Value message(const Message &amp;m) {
-            if (m.message == &quot;_model_reanimated&quot;) {
-                init_model();
-            }
-            return Stone::message(m);
-        }
-        
-        void init_model() {
-            if (Floor *fl = GetFloor(get_pos())) {
-                set_model(fl-&gt;get_kind());
-            } else
-                ASSERT(false, XLevelRuntime, &quot;Chameleon Stone: Floor must be set before stone&quot;);
-        }
-
-        bool is_floating() const 
-        { return true; }
-
-        StoneResponse collision_response(const StoneContact &amp;)
-        { return STONE_PASS; }
-
-    public:
-        ChameleonStone() 
-        {}
-    };
-    DEF_TRAITS(ChameleonStone, &quot;st-chameleon&quot;, st_chameleon);
-}
-
 /* -------------------- BombStone -------------------- */
 
 namespace
@@ -202,11 +104,6 @@
     Register(new BombStone(&quot;st-bombs&quot;, &quot;it-blackbomb&quot;));
     //Register(new BombStone(&quot;st-dynamite&quot;, &quot;it-dynamite&quot;));
     //Register(new BombStone(&quot;st-whitebombs&quot;, &quot;it-whitebomb&quot;));
-
-    Register(new ChameleonStone);
-
-    Register(new DummyStone);
-    Register(new Grate3);
 }
 
 } // namespace enigma


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000928.html">[Enigma-game-svn] r1499 - homepage/input
</A></li>
	<LI>Next message: <A HREF="000930.html">[Enigma-game-svn] r1501 - in trunk/data/levels: enigma_cross	enigma_iv enigma_v enigma_vii enigma_viii
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#929">[ date ]</a>
              <a href="thread.html#929">[ thread ]</a>
              <a href="subject.html#929">[ subject ]</a>
              <a href="author.html#929">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
