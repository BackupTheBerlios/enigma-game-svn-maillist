From ral at mail.berlios.de  Tue Dec  2 01:05:15 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Tue, 2 Dec 2008 01:05:15 +0100
Subject: [Enigma-game-svn] r1384 - homepage/input
Message-ID: <200812020005.mB205Fld003850@sheep.berlios.de>

Author: ral
Date: 2008-12-02 01:05:05 +0100 (Tue, 02 Dec 2008)
New Revision: 1384

Modified:
   homepage/input/stat-other.html
   homepage/input/table-hcp.html
   homepage/input/table-rat.html
   homepage/input/table-solved.html
   homepage/input/table-wr.html
   homepage/input/userlist.html
Log:
Homepage:
- statistics November 2008


Modified: homepage/input/stat-other.html
===================================================================
--- homepage/input/stat-other.html	2008-11-30 20:49:04 UTC (rev 1383)
+++ homepage/input/stat-other.html	2008-12-02 00:05:05 UTC (rev 1384)
@@ -1,22 +1,22 @@
   <div class="stat-help">
     <h3>$$Other_Statistics$$</h3>
     <h4>$$Scores$$</h4>
-      84662 $$single_level_scores$$.
+      85178 $$single_level_scores$$.
     <h4>$$Ratings$$</h4>
-      16167 $$single_level_ratings$$ 4.92 $$and_distribution$$: 
+      16352 $$single_level_ratings$$ 4.92 $$and_distribution$$: 
       <table>
         <colgroup><col width="80"><col width="80"></colgroup>
         <tr><th>$$rating$$</th><th>$$count$$</th></tr>
         <tr><td class="num">0</td><td class="num">103</td></tr>
-        <tr><td class="num">1</td><td class="num">293</td></tr>
-        <tr><td class="num">2</td><td class="num">854</td></tr>
-        <tr><td class="num">3</td><td class="num">2257</td></tr>
-        <tr><td class="num">4</td><td class="num">3079</td></tr>
-        <tr><td class="num">5</td><td class="num">3857</td></tr>
-        <tr><td class="num">6</td><td class="num">2728</td></tr>
-        <tr><td class="num">7</td><td class="num">1831</td></tr>
-        <tr><td class="num">8</td><td class="num">720</td></tr>
-        <tr><td class="num">9</td><td class="num">295</td></tr>
-        <tr><td class="num">10</td><td class="num">150</td></tr>
+        <tr><td class="num">1</td><td class="num">296</td></tr>
+        <tr><td class="num">2</td><td class="num">858</td></tr>
+        <tr><td class="num">3</td><td class="num">2267</td></tr>
+        <tr><td class="num">4</td><td class="num">3104</td></tr>
+        <tr><td class="num">5</td><td class="num">3905</td></tr>
+        <tr><td class="num">6</td><td class="num">2775</td></tr>
+        <tr><td class="num">7</td><td class="num">1855</td></tr>
+        <tr><td class="num">8</td><td class="num">737</td></tr>
+        <tr><td class="num">9</td><td class="num">301</td></tr>
+        <tr><td class="num">10</td><td class="num">151</td></tr>
       </table>
   </div>

Modified: homepage/input/table-hcp.html
===================================================================
--- homepage/input/table-hcp.html	2008-11-30 20:49:04 UTC (rev 1383)
+++ homepage/input/table-hcp.html	2008-12-02 00:05:05 UTC (rev 1384)
@@ -1,168 +1,169 @@
   <table>
-    <caption>$$Handicap_Statistics$$ $$October$$ 2008</caption>
+    <caption>$$Handicap_Statistics$$ $$November$$ 2008</caption>
     <colgroup><col width="130"><col width="220"></colgroup>
     <tr><th>$$solved_hcp$$</th><th class="left">$$user$$</th></tr>
-     <tr><td class="num">-143.5</td><td class="left">'Moneymaker'</td></tr>
-     <tr><td class="num"> -86.7</td><td class="left">'daydreamer'</td></tr>
-     <tr><td class="num"> -79.9</td><td class="left">'Stupid'</td></tr>
-     <tr><td class="num"> -79.8</td><td class="left">'Johannes'</td></tr>
-     <tr><td class="num"> -68.3</td><td class="left">'Great Scott'</td></tr>
-     <tr><td class="num"> -59.9</td><td class="left">'dev0'</td></tr>
-     <tr><td class="num"> -58.1</td><td class="left">'Duffy'</td></tr>
-     <tr><td class="num"> -57.1</td><td class="left">'Malla'</td></tr>
-     <tr><td class="num"> -54.2</td><td class="left">'ryujun'</td></tr>
-     <tr><td class="num"> -49.0</td><td class="left">'Alexandros'</td></tr>
-     <tr><td class="num"> -46.5</td><td class="left">'Django'</td></tr>
-     <tr><td class="num"> -44.5</td><td class="left">'Gloop'</td></tr>
-     <tr><td class="num"> -39.9</td><td class="left">'Crystalicum'</td></tr>
-     <tr><td class="num"> -37.6</td><td class="left">'Taztunes'</td></tr>
-     <tr><td class="num"> -34.7</td><td class="left">'Safalra'</td></tr>
-     <tr><td class="num"> -34.4</td><td class="left">'Emmanuel'</td></tr>
-     <tr><td class="num"> -31.8</td><td class="left">'Ludmian'</td></tr>
-     <tr><td class="num"> -29.2</td><td class="left">'B-Huff'</td></tr>
-     <tr><td class="num"> -26.9</td><td class="left">'dpl'</td></tr>
-     <tr><td class="num"> -26.4</td><td class="left">'Zekobah'</td></tr>
-     <tr><td class="num"> -25.1</td><td class="left">'bojster'</td></tr>
-     <tr><td class="num"> -22.5</td><td class="left">'ged'</td></tr>
-     <tr><td class="num"> -20.7</td><td class="left">'hendrik'</td></tr>
-     <tr><td class="num"> -20.0</td><td class="left">'Daisy'</td></tr>
-     <tr><td class="num"> -19.4</td><td class="left">'ABS'</td></tr>
-     <tr><td class="num"> -18.3</td><td class="left">'Ghatotkacha'</td></tr>
-     <tr><td class="num"> -17.7</td><td class="left">'Raoul'</td></tr>
-     <tr><td class="num"> -15.1</td><td class="left">'Ronald'</td></tr>
-     <tr><td class="num"> -10.4</td><td class="left">'Lukas'</td></tr>
-     <tr><td class="num">  -9.6</td><td class="left">'HuB34'</td></tr>
-     <tr><td class="num">  -6.2</td><td class="left">'Iceshark7'</td></tr>
-     <tr><td class="num">  -6.1</td><td class="left">'joseba'</td></tr>
-     <tr><td class="num">  -6.1</td><td class="left">'Timo'</td></tr>
-     <tr><td class="num">  -2.5</td><td class="left">'Daniel'</td></tr>
-     <tr><td class="num">  -1.3</td><td class="left">'fabian'</td></tr>
-     <tr><td class="num">  -0.9</td><td class="left">'Hairball'</td></tr>
-     <tr><td class="num">  -0.6</td><td class="left">'U-Punkt'</td></tr>
-     <tr><td class="num">   0.1</td><td class="left">'Craven'</td></tr>
-     <tr><td class="num">   0.2</td><td class="left">'JuSt'</td></tr>
-     <tr><td class="num">   0.4</td><td class="left">'Wuzzy'</td></tr>
-     <tr><td class="num">   0.9</td><td class="left">'Freshman'</td></tr>
-     <tr><td class="num">   1.7</td><td class="left">'mrduke'</td></tr>
-     <tr><td class="num">   2.7</td><td class="left">'para_doks'</td></tr>
-     <tr><td class="num">   3.0</td><td class="left">'Tobias'</td></tr>
+     <tr><td class="num">-142.8</td><td class="left">'Moneymaker'</td></tr>
+     <tr><td class="num"> -88.1</td><td class="left">'daydreamer'</td></tr>
+     <tr><td class="num"> -79.3</td><td class="left">'Stupid'</td></tr>
+     <tr><td class="num"> -79.2</td><td class="left">'Johannes'</td></tr>
+     <tr><td class="num"> -67.7</td><td class="left">'Great Scott'</td></tr>
+     <tr><td class="num"> -60.3</td><td class="left">'dev0'</td></tr>
+     <tr><td class="num"> -57.6</td><td class="left">'Duffy'</td></tr>
+     <tr><td class="num"> -56.6</td><td class="left">'Malla'</td></tr>
+     <tr><td class="num"> -53.6</td><td class="left">'ryujun'</td></tr>
+     <tr><td class="num"> -48.4</td><td class="left">'Alexandros'</td></tr>
+     <tr><td class="num"> -46.0</td><td class="left">'Django'</td></tr>
+     <tr><td class="num"> -44.0</td><td class="left">'Gloop'</td></tr>
+     <tr><td class="num"> -41.9</td><td class="left">'Crystalicum'</td></tr>
+     <tr><td class="num"> -37.0</td><td class="left">'Taztunes'</td></tr>
+     <tr><td class="num"> -35.7</td><td class="left">'Daisy'</td></tr>
+     <tr><td class="num"> -34.2</td><td class="left">'Safalra'</td></tr>
+     <tr><td class="num"> -33.8</td><td class="left">'Emmanuel'</td></tr>
+     <tr><td class="num"> -31.2</td><td class="left">'Ludmian'</td></tr>
+     <tr><td class="num"> -28.7</td><td class="left">'B-Huff'</td></tr>
+     <tr><td class="num"> -26.6</td><td class="left">'dpl'</td></tr>
+     <tr><td class="num"> -25.9</td><td class="left">'Zekobah'</td></tr>
+     <tr><td class="num"> -24.7</td><td class="left">'bojster'</td></tr>
+     <tr><td class="num"> -21.9</td><td class="left">'ged'</td></tr>
+     <tr><td class="num"> -20.2</td><td class="left">'hendrik'</td></tr>
+     <tr><td class="num"> -18.9</td><td class="left">'ABS'</td></tr>
+     <tr><td class="num"> -17.8</td><td class="left">'Ghatotkacha'</td></tr>
+     <tr><td class="num"> -17.3</td><td class="left">'Raoul'</td></tr>
+     <tr><td class="num"> -15.2</td><td class="left">'Ronald'</td></tr>
+     <tr><td class="num"> -10.1</td><td class="left">'Lukas'</td></tr>
+     <tr><td class="num">  -9.3</td><td class="left">'HuB34'</td></tr>
+     <tr><td class="num">  -5.8</td><td class="left">'Iceshark7'</td></tr>
+     <tr><td class="num">  -5.8</td><td class="left">'Timo'</td></tr>
+     <tr><td class="num">  -5.6</td><td class="left">'joseba'</td></tr>
+     <tr><td class="num">  -3.3</td><td class="left">'Angolino'</td></tr>
+     <tr><td class="num">  -2.1</td><td class="left">'Daniel'</td></tr>
+     <tr><td class="num">  -0.9</td><td class="left">'fabian'</td></tr>
+     <tr><td class="num">  -0.7</td><td class="left">'U-Punkt'</td></tr>
+     <tr><td class="num">  -0.5</td><td class="left">'Hairball'</td></tr>
+     <tr><td class="num">   0.4</td><td class="left">'Craven'</td></tr>
+     <tr><td class="num">   0.4</td><td class="left">'JuSt'</td></tr>
+     <tr><td class="num">   0.8</td><td class="left">'Wuzzy'</td></tr>
+     <tr><td class="num">   1.2</td><td class="left">'Freshman'</td></tr>
+     <tr><td class="num">   2.0</td><td class="left">'mrduke'</td></tr>
+     <tr><td class="num">   3.0</td><td class="left">'para_doks'</td></tr>
+     <tr><td class="num">   3.3</td><td class="left">'Tobias'</td></tr>
      <tr><td class="num">   3.7</td><td class="left">'Kevin'</td></tr>
-     <tr><td class="num">   4.3</td><td class="left">'Guglielmo'</td></tr>
-     <tr><td class="num">   4.5</td><td class="left">'alfred69'</td></tr>
-     <tr><td class="num">   5.5</td><td class="left">'Andy'</td></tr>
-     <tr><td class="num">   5.6</td><td class="left">'serpent'</td></tr>
-     <tr><td class="num">   8.0</td><td class="left">'Austin'</td></tr>
-     <tr><td class="num">   9.3</td><td class="left">'shoki'</td></tr>
-     <tr><td class="num">  10.3</td><td class="left">'Tiza'</td></tr>
-     <tr><td class="num">  10.3</td><td class="left">'mecke'</td></tr>
-     <tr><td class="num">  12.0</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-     <tr><td class="num">  13.8</td><td class="left">'Andreas'</td></tr>
-     <tr><td class="num">  14.2</td><td class="left">'Mark P.'</td></tr>
-     <tr><td class="num">  15.2</td><td class="left">'Chocolate Zero'</td></tr>
-     <tr><td class="num">  15.3</td><td class="left">'AlephD'</td></tr>
-     <tr><td class="num">  15.5</td><td class="left">'Sim_Ed'</td></tr>
-     <tr><td class="num">  15.9</td><td class="left">'Angolino'</td></tr>
-     <tr><td class="num">  16.0</td><td class="left">'Agnieszka'</td></tr>
-     <tr><td class="num">  20.2</td><td class="left">'Alex'</td></tr>
-     <tr><td class="num">  20.7</td><td class="left">'Ale'</td></tr>
-     <tr><td class="num">  22.4</td><td class="left">'Antonio EE'</td></tr>
-     <tr><td class="num">  22.8</td><td class="left">'Jinajon'</td></tr>
-     <tr><td class="num">  23.0</td><td class="left">'Klaus'</td></tr>
-     <tr><td class="num">  23.4</td><td class="left">'Marc-Hendrik'</td></tr>
-     <tr><td class="num">  23.4</td><td class="left">'Chris'</td></tr>
-     <tr><td class="num">  24.4</td><td class="left">'Thomas'</td></tr>
-     <tr><td class="num">  24.7</td><td class="left">'Feynman'</td></tr>
-     <tr><td class="num">  25.2</td><td class="left">'hdwow'</td></tr>
-     <tr><td class="num">  25.6</td><td class="left">'Gottseinsohn'</td></tr>
-     <tr><td class="num">  25.6</td><td class="left">'Bent'</td></tr>
-     <tr><td class="num">  26.3</td><td class="left">'Hans-HD'</td></tr>
-     <tr><td class="num">  27.6</td><td class="left">'un_guru'</td></tr>
-     <tr><td class="num">  27.9</td><td class="left">'Little_Mole'</td></tr>
-     <tr><td class="num">  28.3</td><td class="left">'J3FF'</td></tr>
-     <tr><td class="num">  29.2</td><td class="left">'biotopa'</td></tr>
-     <tr><td class="num">  29.2</td><td class="left">'GiannuzzITA'</td></tr>
-     <tr><td class="num">  29.3</td><td class="left">'Vinksu'</td></tr>
-     <tr><td class="num">  29.3</td><td class="left">'oxyd4ever'</td></tr>
-     <tr><td class="num">  29.9</td><td class="left">'oblo'</td></tr>
-     <tr><td class="num">  30.1</td><td class="left">'redsantz'</td></tr>
-     <tr><td class="num">  30.8</td><td class="left">'geembo_90'</td></tr>
-     <tr><td class="num">  31.3</td><td class="left">'Edgar_Flesk'</td></tr>
-     <tr><td class="num">  31.6</td><td class="left">'Melanie'</td></tr>
-     <tr><td class="num">  32.0</td><td class="left">'IChrisI'</td></tr>
-     <tr><td class="num">  32.3</td><td class="left">'NorthForty'</td></tr>
-     <tr><td class="num">  32.5</td><td class="left">'erich'</td></tr>
-     <tr><td class="num">  32.5</td><td class="left">'Gorn'</td></tr>
-     <tr><td class="num">  32.8</td><td class="left">'Davacardo'</td></tr>
-     <tr><td class="num">  35.3</td><td class="left">'niebie'</td></tr>
-     <tr><td class="num">  35.3</td><td class="left">'MicWa'</td></tr>
-     <tr><td class="num">  35.5</td><td class="left">'WP319'</td></tr>
-     <tr><td class="num">  35.9</td><td class="left">'Kosby'</td></tr>
-     <tr><td class="num">  36.8</td><td class="left">'alain'</td></tr>
-     <tr><td class="num">  37.8</td><td class="left">'Rugby4ever'</td></tr>
-     <tr><td class="num">  38.9</td><td class="left">'WesleyCrusher'</td></tr>
-     <tr><td class="num">  39.0</td><td class="left">'Drotten'</td></tr>
-     <tr><td class="num">  39.4</td><td class="left">'Archcorenth'</td></tr>
-     <tr><td class="num">  39.6</td><td class="left">'Harry Lim'</td></tr>
-     <tr><td class="num">  39.9</td><td class="left">'B-man'</td></tr>
-     <tr><td class="num">  40.3</td><td class="left">'Nfol'</td></tr>
-     <tr><td class="num">  41.3</td><td class="left">'Tiger'</td></tr>
-     <tr><td class="num">  41.4</td><td class="left">'gringer'</td></tr>
-     <tr><td class="num">  41.4</td><td class="left">'Liam Sheehan'</td></tr>
-     <tr><td class="num">  41.8</td><td class="left">'Snaily'</td></tr>
-     <tr><td class="num">  41.9</td><td class="left">'Vlad'</td></tr>
-     <tr><td class="num">  43.1</td><td class="left">'Momcat'</td></tr>
-     <tr><td class="num">  43.8</td><td class="left">'Breezy'</td></tr>
-     <tr><td class="num">  44.0</td><td class="left">'Uli'</td></tr>
-     <tr><td class="num">  45.5</td><td class="left">'Tarim'</td></tr>
-     <tr><td class="num">  46.2</td><td class="left">'IntKecsk'</td></tr>
-     <tr><td class="num">  46.6</td><td class="left">'tjRaven'</td></tr>
-     <tr><td class="num">  47.3</td><td class="left">'Valkyrie2'</td></tr>
-     <tr><td class="num">  47.6</td><td class="left">'ntaeijr'</td></tr>
-     <tr><td class="num">  47.6</td><td class="left">'mhatta'</td></tr>
-     <tr><td class="num">  49.3</td><td class="left">'Zak'</td></tr>
-     <tr><td class="num">  49.7</td><td class="left">'rima'</td></tr>
-     <tr><td class="num">  50.2</td><td class="left">'Sandra'</td></tr>
-     <tr><td class="num">  50.6</td><td class="left">'ReasonAnce'</td></tr>
-     <tr><td class="num">  51.1</td><td class="left">'jdcampo'</td></tr>
-     <tr><td class="num">  51.4</td><td class="left">'Jeffrey S'</td></tr>
-     <tr><td class="num">  51.7</td><td class="left">'brynn'</td></tr>
-     <tr><td class="num">  52.0</td><td class="left">'AkRa'</td></tr>
-     <tr><td class="num">  52.2</td><td class="left">'Slav'</td></tr>
-     <tr><td class="num">  52.5</td><td class="left">'Vaily'</td></tr>
-     <tr><td class="num">  52.6</td><td class="left">'Pascal'</td></tr>
-     <tr><td class="num">  53.6</td><td class="left">'Turbogurk'</td></tr>
+     <tr><td class="num">   4.7</td><td class="left">'Guglielmo'</td></tr>
+     <tr><td class="num">   4.8</td><td class="left">'alfred69'</td></tr>
+     <tr><td class="num">   5.8</td><td class="left">'Andy'</td></tr>
+     <tr><td class="num">   5.8</td><td class="left">'serpent'</td></tr>
+     <tr><td class="num">   8.3</td><td class="left">'Austin'</td></tr>
+     <tr><td class="num">   8.8</td><td class="left">'Tiza'</td></tr>
+     <tr><td class="num">   9.6</td><td class="left">'shoki'</td></tr>
+     <tr><td class="num">  10.5</td><td class="left">'mecke'</td></tr>
+     <tr><td class="num">  12.3</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+     <tr><td class="num">  14.1</td><td class="left">'Andreas'</td></tr>
+     <tr><td class="num">  14.5</td><td class="left">'Mark P.'</td></tr>
+     <tr><td class="num">  15.5</td><td class="left">'AlephD'</td></tr>
+     <tr><td class="num">  15.6</td><td class="left">'Chocolate Zero'</td></tr>
+     <tr><td class="num">  15.8</td><td class="left">'Sim_Ed'</td></tr>
+     <tr><td class="num">  16.2</td><td class="left">'Agnieszka'</td></tr>
+     <tr><td class="num">  20.0</td><td class="left">'Ale'</td></tr>
+     <tr><td class="num">  20.4</td><td class="left">'Alex'</td></tr>
+     <tr><td class="num">  22.7</td><td class="left">'Antonio EE'</td></tr>
+     <tr><td class="num">  23.0</td><td class="left">'Jinajon'</td></tr>
+     <tr><td class="num">  23.1</td><td class="left">'Klaus'</td></tr>
+     <tr><td class="num">  23.6</td><td class="left">'Marc-Hendrik'</td></tr>
+     <tr><td class="num">  23.6</td><td class="left">'Chris'</td></tr>
+     <tr><td class="num">  24.5</td><td class="left">'Thomas'</td></tr>
+     <tr><td class="num">  24.8</td><td class="left">'Feynman'</td></tr>
+     <tr><td class="num">  25.4</td><td class="left">'hdwow'</td></tr>
+     <tr><td class="num">  25.8</td><td class="left">'Gottseinsohn'</td></tr>
+     <tr><td class="num">  25.9</td><td class="left">'Bent'</td></tr>
+     <tr><td class="num">  26.5</td><td class="left">'Hans-HD'</td></tr>
+     <tr><td class="num">  27.7</td><td class="left">'un_guru'</td></tr>
+     <tr><td class="num">  28.1</td><td class="left">'Little_Mole'</td></tr>
+     <tr><td class="num">  28.5</td><td class="left">'J3FF'</td></tr>
+     <tr><td class="num">  29.4</td><td class="left">'biotopa'</td></tr>
+     <tr><td class="num">  29.4</td><td class="left">'GiannuzzITA'</td></tr>
+     <tr><td class="num">  29.4</td><td class="left">'oxyd4ever'</td></tr>
+     <tr><td class="num">  29.5</td><td class="left">'Vinksu'</td></tr>
+     <tr><td class="num">  30.1</td><td class="left">'oblo'</td></tr>
+     <tr><td class="num">  30.3</td><td class="left">'redsantz'</td></tr>
+     <tr><td class="num">  31.1</td><td class="left">'geembo_90'</td></tr>
+     <tr><td class="num">  31.5</td><td class="left">'Edgar_Flesk'</td></tr>
+     <tr><td class="num">  31.7</td><td class="left">'Melanie'</td></tr>
+     <tr><td class="num">  32.2</td><td class="left">'IChrisI'</td></tr>
+     <tr><td class="num">  32.4</td><td class="left">'NorthForty'</td></tr>
+     <tr><td class="num">  32.6</td><td class="left">'erich'</td></tr>
+     <tr><td class="num">  32.6</td><td class="left">'Gorn'</td></tr>
+     <tr><td class="num">  33.0</td><td class="left">'Davacardo'</td></tr>
+     <tr><td class="num">  35.5</td><td class="left">'niebie'</td></tr>
+     <tr><td class="num">  35.6</td><td class="left">'WP319'</td></tr>
+     <tr><td class="num">  35.6</td><td class="left">'MicWa'</td></tr>
+     <tr><td class="num">  36.0</td><td class="left">'Kosby'</td></tr>
+     <tr><td class="num">  36.9</td><td class="left">'alain'</td></tr>
+     <tr><td class="num">  37.6</td><td class="left">'Liam Sheehan'</td></tr>
+     <tr><td class="num">  37.9</td><td class="left">'Rugby4ever'</td></tr>
+     <tr><td class="num">  39.1</td><td class="left">'WesleyCrusher'</td></tr>
+     <tr><td class="num">  39.2</td><td class="left">'Drotten'</td></tr>
+     <tr><td class="num">  39.5</td><td class="left">'Archcorenth'</td></tr>
+     <tr><td class="num">  39.8</td><td class="left">'Harry Lim'</td></tr>
+     <tr><td class="num">  40.1</td><td class="left">'B-man'</td></tr>
+     <tr><td class="num">  40.4</td><td class="left">'Nfol'</td></tr>
+     <tr><td class="num">  41.4</td><td class="left">'Tiger'</td></tr>
+     <tr><td class="num">  41.5</td><td class="left">'gringer'</td></tr>
+     <tr><td class="num">  42.0</td><td class="left">'Vlad'</td></tr>
+     <tr><td class="num">  42.0</td><td class="left">'Snaily'</td></tr>
+     <tr><td class="num">  43.3</td><td class="left">'Momcat'</td></tr>
+     <tr><td class="num">  43.9</td><td class="left">'Breezy'</td></tr>
+     <tr><td class="num">  44.2</td><td class="left">'Uli'</td></tr>
+     <tr><td class="num">  45.6</td><td class="left">'Tarim'</td></tr>
+     <tr><td class="num">  46.4</td><td class="left">'IntKecsk'</td></tr>
+     <tr><td class="num">  46.8</td><td class="left">'tjRaven'</td></tr>
+     <tr><td class="num">  47.5</td><td class="left">'Valkyrie2'</td></tr>
+     <tr><td class="num">  47.7</td><td class="left">'mhatta'</td></tr>
+     <tr><td class="num">  47.8</td><td class="left">'ntaeijr'</td></tr>
+     <tr><td class="num">  49.4</td><td class="left">'Zak'</td></tr>
+     <tr><td class="num">  49.9</td><td class="left">'rima'</td></tr>
+     <tr><td class="num">  50.3</td><td class="left">'Sandra'</td></tr>
+     <tr><td class="num">  50.8</td><td class="left">'ReasonAnce'</td></tr>
+     <tr><td class="num">  51.2</td><td class="left">'jdcampo'</td></tr>
+     <tr><td class="num">  51.5</td><td class="left">'Jeffrey S'</td></tr>
+     <tr><td class="num">  51.8</td><td class="left">'brynn'</td></tr>
+     <tr><td class="num">  52.2</td><td class="left">'AkRa'</td></tr>
+     <tr><td class="num">  52.3</td><td class="left">'Slav'</td></tr>
+     <tr><td class="num">  52.6</td><td class="left">'Vaily'</td></tr>
+     <tr><td class="num">  52.7</td><td class="left">'Pascal'</td></tr>
      <tr><td class="num">  53.6</td><td class="left">'Neophilus'</td></tr>
-     <tr><td class="num">  53.6</td><td class="left">'Cyphase'</td></tr>
+     <tr><td class="num">  53.7</td><td class="left">'Turbogurk'</td></tr>
+     <tr><td class="num">  53.7</td><td class="left">'Cyphase'</td></tr>
      <tr><td class="num">  56.0</td><td class="left">'krazy62'</td></tr>
-     <tr><td class="num">  56.9</td><td class="left">'Adonica'</td></tr>
-     <tr><td class="num">  57.1</td><td class="left">'Kadu'</td></tr>
-     <tr><td class="num">  59.3</td><td class="left">'Mecki'</td></tr>
-     <tr><td class="num">  59.9</td><td class="left">'Sopoforic'</td></tr>
-     <tr><td class="num">  61.2</td><td class="left">'jdrexler'</td></tr>
-     <tr><td class="num">  62.0</td><td class="left">'Asbel'</td></tr>
-     <tr><td class="num">  63.8</td><td class="left">'tasker'</td></tr>
-     <tr><td class="num">  64.1</td><td class="left">'Meeve'</td></tr>
-     <tr><td class="num">  66.2</td><td class="left">'ael'</td></tr>
-     <tr><td class="num">  66.8</td><td class="left">'Samuel'</td></tr>
-     <tr><td class="num">  66.8</td><td class="left">'Fred_the_wise'</td></tr>
+     <tr><td class="num">  57.0</td><td class="left">'Adonica'</td></tr>
+     <tr><td class="num">  57.3</td><td class="left">'Kadu'</td></tr>
+     <tr><td class="num">  59.4</td><td class="left">'Mecki'</td></tr>
+     <tr><td class="num">  60.0</td><td class="left">'Sopoforic'</td></tr>
+     <tr><td class="num">  60.7</td><td class="left">'jumbo'</td></tr>
+     <tr><td class="num">  61.3</td><td class="left">'jdrexler'</td></tr>
+     <tr><td class="num">  62.1</td><td class="left">'Asbel'</td></tr>
+     <tr><td class="num">  63.9</td><td class="left">'tasker'</td></tr>
+     <tr><td class="num">  64.2</td><td class="left">'Meeve'</td></tr>
+     <tr><td class="num">  66.3</td><td class="left">'ael'</td></tr>
+     <tr><td class="num">  66.9</td><td class="left">'Fred_the_wise'</td></tr>
+     <tr><td class="num">  67.0</td><td class="left">'Samuel'</td></tr>
      <tr><td class="num">  67.1</td><td class="left">'schmusi20'</td></tr>
      <tr><td class="num">  67.3</td><td class="left">'Sparkey'</td></tr>
      <tr><td class="num">  67.7</td><td class="left">'Alf'</td></tr>
      <tr><td class="num">  69.3</td><td class="left">'Magnus and Susi'</td></tr>
      <tr><td class="num">  69.9</td><td class="left">'Zhura'</td></tr>
-     <tr><td class="num">  70.6</td><td class="left">'xmouse'</td></tr>
-     <tr><td class="num">  72.0</td><td class="left">'Joona'</td></tr>
+     <tr><td class="num">  70.7</td><td class="left">'xmouse'</td></tr>
+     <tr><td class="num">  72.1</td><td class="left">'Joona'</td></tr>
      <tr><td class="num">  72.2</td><td class="left">'AQZ'</td></tr>
      <tr><td class="num">  73.7</td><td class="left">'crypto_rsa'</td></tr>
-     <tr><td class="num">  73.9</td><td class="left">'Dvorhagen'</td></tr>
-     <tr><td class="num">  74.8</td><td class="left">'Eselchen'</td></tr>
-     <tr><td class="num">  75.1</td><td class="left">'Nicol?s'</td></tr>
-     <tr><td class="num">  75.2</td><td class="left">'jojo'</td></tr>
+     <tr><td class="num">  74.0</td><td class="left">'Dvorhagen'</td></tr>
+     <tr><td class="num">  74.9</td><td class="left">'Eselchen'</td></tr>
+     <tr><td class="num">  75.2</td><td class="left">'Nicol?s'</td></tr>
      <tr><td class="num">  75.2</td><td class="left">'AsuCaga'</td></tr>
-     <tr><td class="num">  78.6</td><td class="left">'colonel crayon'</td></tr>
+     <tr><td class="num">  75.3</td><td class="left">'jojo'</td></tr>
+     <tr><td class="num">  78.7</td><td class="left">'colonel crayon'</td></tr>
      <tr><td class="num">  79.4</td><td class="left">'Kroetchen'</td></tr>
-     <tr><td class="num">  80.2</td><td class="left">'Agares'</td></tr>
-     <tr><td class="num">  85.0</td><td class="left">'Miel56'</td></tr>
+     <tr><td class="num">  80.3</td><td class="left">'Agares'</td></tr>
+     <tr><td class="num">  85.1</td><td class="left">'Miel56'</td></tr>
      <tr><td class="num">  90.0</td><td class="left">'The red O'</td></tr>
      <tr><td class="num">  90.3</td><td class="left">'Sequoyah'</td></tr>
      <tr><td class="num">  92.3</td><td class="left">'Michael'</td></tr>

Modified: homepage/input/table-rat.html
===================================================================
--- homepage/input/table-rat.html	2008-11-30 20:49:04 UTC (rev 1383)
+++ homepage/input/table-rat.html	2008-12-02 00:05:05 UTC (rev 1384)
@@ -1,31 +1,31 @@
   <table>
-    <caption>$$Rating_Statistics$$ $$October$$ 2008</caption>
+    <caption>$$Rating_Statistics$$ $$November$$ 2008</caption>
     <colgroup><col width="80"><col width="80"><col width="220"></colgroup>
     <tr><th>$$count$$</th><th>$$average$$</th><th class="left">$$user$$</th></tr>    <tr><td class="num">1062</td><td class="num"> 5.06</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1056</td><td class="num"> 4.83</td><td class="left">'Taztunes'</td></tr>
     <tr><td class="num">1045</td><td class="num"> 4.93</td><td class="left">'Crystalicum'</td></tr>
-    <tr><td class="num">1020</td><td class="num"> 5.04</td><td class="left">'dev0'</td></tr>
-    <tr><td class="num">893</td><td class="num"> 4.79</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num">1029</td><td class="num"> 5.06</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num">896</td><td class="num"> 4.79</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">871</td><td class="num"> 5.09</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num">653</td><td class="num"> 5.01</td><td class="left">'Duffy'</td></tr>
-    <tr><td class="num">642</td><td class="num"> 4.80</td><td class="left">'U-Punkt'</td></tr>
+    <tr><td class="num">643</td><td class="num"> 4.79</td><td class="left">'U-Punkt'</td></tr>
     <tr><td class="num">628</td><td class="num"> 5.00</td><td class="left">'Moneymaker'</td></tr>
     <tr><td class="num">622</td><td class="num"> 4.22</td><td class="left">'shoki'</td></tr>
-    <tr><td class="num">572</td><td class="num"> 5.16</td><td class="left">'dpl'</td></tr>
+    <tr><td class="num">573</td><td class="num"> 5.16</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">562</td><td class="num"> 4.48</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num">534</td><td class="num"> 4.97</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num">511</td><td class="num"> 5.30</td><td class="left">'Lukas'</td></tr>
-    <tr><td class="num">496</td><td class="num"> 5.03</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num">503</td><td class="num"> 5.05</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num">482</td><td class="num"> 4.04</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num">448</td><td class="num"> 5.08</td><td class="left">'Johannes'</td></tr>
     <tr><td class="num">433</td><td class="num"> 4.36</td><td class="left">'ged'</td></tr>
     <tr><td class="num">388</td><td class="num"> 4.86</td><td class="left">'Gloop'</td></tr>
     <tr><td class="num">307</td><td class="num"> 4.01</td><td class="left">'Sim_Ed'</td></tr>
     <tr><td class="num">285</td><td class="num"> 4.60</td><td class="left">'ABS'</td></tr>
+    <tr><td class="num">274</td><td class="num"> 5.12</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num">254</td><td class="num"> 4.91</td><td class="left">'JuSt'</td></tr>
     <tr><td class="num">208</td><td class="num"> 6.15</td><td class="left">'Momcat'</td></tr>
     <tr><td class="num">200</td><td class="num"> 5.74</td><td class="left">'Malla'</td></tr>
-    <tr><td class="num">189</td><td class="num"> 5.05</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num">187</td><td class="num"> 5.05</td><td class="left">'WP319'</td></tr>
     <tr><td class="num">135</td><td class="num"> 4.13</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num">129</td><td class="num"> 5.64</td><td class="left">'Raoul'</td></tr>
@@ -34,6 +34,7 @@
     <tr><td class="num"> 85</td><td class="num"> 4.76</td><td class="left">'para_doks'</td></tr>
     <tr><td class="num"> 75</td><td class="num"> 4.52</td><td class="left">'Kroetchen'</td></tr>
     <tr><td class="num"> 72</td><td class="num"> 5.63</td><td class="left">'Wuzzy'</td></tr>
+    <tr><td class="num"> 70</td><td class="num"> 5.46</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num"> 64</td><td class="num"> 6.08</td><td class="left">'mecke'</td></tr>
     <tr><td class="num"> 63</td><td class="num"> 4.84</td><td class="left">'Mark P.'</td></tr>
     <tr><td class="num"> 52</td><td class="num"> 6.56</td><td class="left">'Hairball'</td></tr>
@@ -41,9 +42,9 @@
     <tr><td class="num"> 50</td><td class="num"> 5.26</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num"> 49</td><td class="num"> 6.02</td><td class="left">'oblo'</td></tr>
     <tr><td class="num"> 49</td><td class="num"> 4.90</td><td class="left">'hendrik'</td></tr>
+    <tr><td class="num"> 47</td><td class="num"> 6.62</td><td class="left">'Ale'</td></tr>
     <tr><td class="num"> 43</td><td class="num"> 3.74</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 39</td><td class="num"> 6.08</td><td class="left">'mrduke'</td></tr>
-    <tr><td class="num"> 38</td><td class="num"> 6.21</td><td class="left">'Ale'</td></tr>
     <tr><td class="num"> 33</td><td class="num"> 3.39</td><td class="left">'Freshman'</td></tr>
     <tr><td class="num"> 33</td><td class="num"> 5.27</td><td class="left">'gringer'</td></tr>
     <tr><td class="num"> 32</td><td class="num"> 5.97</td><td class="left">'ReasonAnce'</td></tr>
@@ -79,9 +80,9 @@
     <tr><td class="num">  3</td><td class="num"> 4.33</td><td class="left">'krazy62'</td></tr>
     <tr><td class="num">  2</td><td class="num"> 6.50</td><td class="left">'tjRaven'</td></tr>
     <tr><td class="num">  2</td><td class="num"> 0.00</td><td class="left">'mhatta'</td></tr>
+    <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'jumbo'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'ael'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 6.00</td><td class="left">'Slav'</td></tr>
-    <tr><td class="num">  1</td><td class="num"> 4.00</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'Uli'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 0.00</td><td class="left">'Fred_the_wise'</td></tr>
     <tr><td class="num">  1</td><td class="num">10.00</td><td class="left">'Cyphase'</td></tr>

Modified: homepage/input/table-solved.html
===================================================================
--- homepage/input/table-solved.html	2008-11-30 20:49:04 UTC (rev 1383)
+++ homepage/input/table-solved.html	2008-12-02 00:05:05 UTC (rev 1384)
@@ -1,22 +1,22 @@
   <table>
-    <caption>$$Solved_Level_Statistics$$ $$October$$ 2008</caption>
+    <caption>$$Solved_Level_Statistics$$ $$November$$ 2008</caption>
     <colgroup><col width="130"><col width="130"><col width="130"><col width="240"></colgroup>
     <tr><th>$$difficult$$</th><th>$$easy$$</th><th>$$total$$</th><th class="left">$$user$$</th></tr>
     <tr><td class="num">1045/1045</td><td class="num">189/189</td><td class="num">100.00%</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1043/1045</td><td class="num">189/189</td><td class="num"> 99.84%</td><td class="left">'Taztunes'</td></tr>
+    <tr><td class="num">1030/1045</td><td class="num">187/189</td><td class="num"> 98.62%</td><td class="left">'dev0'</td></tr>
     <tr><td class="num">1029/1045</td><td class="num">185/189</td><td class="num"> 98.38%</td><td class="left">'Freshman'</td></tr>
     <tr><td class="num">1029/1045</td><td class="num">183/189</td><td class="num"> 98.22%</td><td class="left">'Craven'</td></tr>
+    <tr><td class="num">1023/1045</td><td class="num">187/189</td><td class="num"> 98.06%</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num">1026/1045</td><td class="num">184/189</td><td class="num"> 98.06%</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">1031/1045</td><td class="num">179/189</td><td class="num"> 98.06%</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">1021/1045</td><td class="num">186/189</td><td class="num"> 97.81%</td><td class="left">'dev0'</td></tr>
-    <tr><td class="num">1021/1045</td><td class="num">183/189</td><td class="num"> 97.57%</td><td class="left">'daydreamer'</td></tr>
-    <tr><td class="num">1017/1045</td><td class="num">183/189</td><td class="num"> 97.24%</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num">1024/1045</td><td class="num">185/189</td><td class="num"> 97.97%</td><td class="left">'Ale'</td></tr>
     <tr><td class="num">1021/1045</td><td class="num">177/189</td><td class="num"> 97.08%</td><td class="left">'Malla'</td></tr>
     <tr><td class="num">1014/1045</td><td class="num">175/189</td><td class="num"> 96.35%</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num"> 999/1045</td><td class="num">177/189</td><td class="num"> 95.30%</td><td class="left">'biotopa'</td></tr>
-    <tr><td class="num">1011/1045</td><td class="num">137/189</td><td class="num"> 93.03%</td><td class="left">'Ale'</td></tr>
+    <tr><td class="num"> 964/1045</td><td class="num">175/189</td><td class="num"> 92.30%</td><td class="left">'Daisy'</td></tr>
     <tr><td class="num"> 970/1045</td><td class="num">166/189</td><td class="num"> 92.06%</td><td class="left">'Andy'</td></tr>
     <tr><td class="num"> 960/1045</td><td class="num">173/189</td><td class="num"> 91.82%</td><td class="left">'mecke'</td></tr>
-    <tr><td class="num"> 951/1045</td><td class="num">175/189</td><td class="num"> 91.25%</td><td class="left">'Daisy'</td></tr>
     <tr><td class="num"> 949/1045</td><td class="num">170/189</td><td class="num"> 90.68%</td><td class="left">'para_doks'</td></tr>
     <tr><td class="num"> 922/1045</td><td class="num">154/189</td><td class="num"> 87.20%</td><td class="left">'mrduke'</td></tr>
     <tr><td class="num"> 933/1045</td><td class="num">125/189</td><td class="num"> 85.74%</td><td class="left">'Alex'</td></tr>
@@ -32,10 +32,10 @@
     <tr><td class="num"> 874/1045</td><td class="num">103/189</td><td class="num"> 79.17%</td><td class="left">'Melanie'</td></tr>
     <tr><td class="num"> 950/1045</td><td class="num">  0/189</td><td class="num"> 76.99%</td><td class="left">'Tarim'</td></tr>
     <tr><td class="num"> 804/1045</td><td class="num">142/189</td><td class="num"> 76.66%</td><td class="left">'Safalra'</td></tr>
-    <tr><td class="num"> 798/1045</td><td class="num">135/189</td><td class="num"> 75.61%</td><td class="left">'dpl'</td></tr>
+    <tr><td class="num"> 800/1045</td><td class="num">135/189</td><td class="num"> 75.77%</td><td class="left">'dpl'</td></tr>
     <tr><td class="num"> 782/1045</td><td class="num">132/189</td><td class="num"> 74.07%</td><td class="left">'AlephD'</td></tr>
     <tr><td class="num"> 783/1045</td><td class="num">126/189</td><td class="num"> 73.66%</td><td class="left">'Ludmian'</td></tr>
-    <tr><td class="num"> 779/1045</td><td class="num">118/189</td><td class="num"> 72.69%</td><td class="left">'U-Punkt'</td></tr>
+    <tr><td class="num"> 779/1045</td><td class="num">121/189</td><td class="num"> 72.93%</td><td class="left">'U-Punkt'</td></tr>
     <tr><td class="num"> 739/1045</td><td class="num">131/189</td><td class="num"> 70.50%</td><td class="left">'ABS'</td></tr>
     <tr><td class="num"> 728/1045</td><td class="num">126/189</td><td class="num"> 69.21%</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num"> 755/1045</td><td class="num"> 96/189</td><td class="num"> 68.96%</td><td class="left">'brynn'</td></tr>
@@ -67,27 +67,27 @@
     <tr><td class="num"> 499/1045</td><td class="num">111/189</td><td class="num"> 49.43%</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 500/1045</td><td class="num"> 92/189</td><td class="num"> 47.97%</td><td class="left">'Kosby'</td></tr>
     <tr><td class="num"> 522/1045</td><td class="num"> 66/189</td><td class="num"> 47.65%</td><td class="left">'Timo'</td></tr>
+    <tr><td class="num"> 503/1045</td><td class="num"> 77/189</td><td class="num"> 47.00%</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num"> 478/1045</td><td class="num">101/189</td><td class="num"> 46.92%</td><td class="left">'Austin'</td></tr>
     <tr><td class="num"> 504/1045</td><td class="num"> 62/189</td><td class="num"> 45.87%</td><td class="left">'Hans-HD'</td></tr>
     <tr><td class="num"> 492/1045</td><td class="num"> 63/189</td><td class="num"> 44.98%</td><td class="left">'Antonio EE'</td></tr>
     <tr><td class="num"> 541/1045</td><td class="num">  6/189</td><td class="num"> 44.33%</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num"> 516/1045</td><td class="num"> 24/189</td><td class="num"> 43.76%</td><td class="left">'niebie'</td></tr>
-    <tr><td class="num"> 463/1045</td><td class="num"> 72/189</td><td class="num"> 43.35%</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num"> 508/1045</td><td class="num"> 26/189</td><td class="num"> 43.27%</td><td class="left">'Feynman'</td></tr>
+    <tr><td class="num"> 462/1045</td><td class="num"> 63/189</td><td class="num"> 42.54%</td><td class="left">'Liam Sheehan'</td></tr>
     <tr><td class="num"> 494/1045</td><td class="num"> 26/189</td><td class="num"> 42.14%</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num"> 506/1045</td><td class="num"> 12/189</td><td class="num"> 41.98%</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num"> 503/1045</td><td class="num">  7/189</td><td class="num"> 41.33%</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num"> 397/1045</td><td class="num"> 93/189</td><td class="num"> 39.71%</td><td class="left">'Hairball'</td></tr>
     <tr><td class="num"> 440/1045</td><td class="num"> 50/189</td><td class="num"> 39.71%</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 369/1045</td><td class="num">112/189</td><td class="num"> 38.98%</td><td class="left">'Jinajon'</td></tr>
-    <tr><td class="num"> 393/1045</td><td class="num"> 50/189</td><td class="num"> 35.90%</td><td class="left">'Liam Sheehan'</td></tr>
     <tr><td class="num"> 438/1045</td><td class="num">  3/189</td><td class="num"> 35.74%</td><td class="left">'oblo'</td></tr>
     <tr><td class="num"> 392/1045</td><td class="num"> 40/189</td><td class="num"> 35.01%</td><td class="left">'hendrik'</td></tr>
     <tr><td class="num"> 391/1045</td><td class="num"> 36/189</td><td class="num"> 34.60%</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 397/1045</td><td class="num"> 24/189</td><td class="num"> 34.12%</td><td class="left">'Chocolate Zero'</td></tr>
     <tr><td class="num"> 376/1045</td><td class="num"> 35/189</td><td class="num"> 33.31%</td><td class="left">'Jeffrey S'</td></tr>
+    <tr><td class="num"> 339/1045</td><td class="num"> 69/189</td><td class="num"> 33.06%</td><td class="left">'Crystalicum'</td></tr>
     <tr><td class="num"> 392/1045</td><td class="num"> 12/189</td><td class="num"> 32.74%</td><td class="left">'NorthForty'</td></tr>
-    <tr><td class="num"> 334/1045</td><td class="num"> 69/189</td><td class="num"> 32.66%</td><td class="left">'Crystalicum'</td></tr>
     <tr><td class="num"> 344/1045</td><td class="num"> 51/189</td><td class="num"> 32.01%</td><td class="left">'Momcat'</td></tr>
     <tr><td class="num"> 382/1045</td><td class="num"> 10/189</td><td class="num"> 31.77%</td><td class="left">'J3FF'</td></tr>
     <tr><td class="num"> 347/1045</td><td class="num"> 45/189</td><td class="num"> 31.77%</td><td class="left">'rima'</td></tr>
@@ -110,6 +110,7 @@
     <tr><td class="num"> 276/1045</td><td class="num"> 15/189</td><td class="num"> 23.58%</td><td class="left">'Thomas'</td></tr>
     <tr><td class="num"> 258/1045</td><td class="num"> 27/189</td><td class="num"> 23.10%</td><td class="left">'un_guru'</td></tr>
     <tr><td class="num"> 245/1045</td><td class="num"> 36/189</td><td class="num"> 22.77%</td><td class="left">'B-man'</td></tr>
+    <tr><td class="num"> 232/1045</td><td class="num"> 38/189</td><td class="num"> 21.88%</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num"> 259/1045</td><td class="num">  7/189</td><td class="num"> 21.56%</td><td class="left">'geembo_90'</td></tr>
     <tr><td class="num"> 243/1045</td><td class="num"> 23/189</td><td class="num"> 21.56%</td><td class="left">'Snaily'</td></tr>
     <tr><td class="num"> 201/1045</td><td class="num"> 54/189</td><td class="num"> 20.66%</td><td class="left">'mhatta'</td></tr>
@@ -121,7 +122,7 @@
     <tr><td class="num"> 209/1045</td><td class="num"> 11/189</td><td class="num"> 17.83%</td><td class="left">'GiannuzzITA'</td></tr>
     <tr><td class="num"> 206/1045</td><td class="num">  4/189</td><td class="num"> 17.02%</td><td class="left">'krazy62'</td></tr>
     <tr><td class="num"> 181/1045</td><td class="num"> 20/189</td><td class="num"> 16.29%</td><td class="left">'Vaily'</td></tr>
-    <tr><td class="num"> 155/1045</td><td class="num"> 32/189</td><td class="num"> 15.15%</td><td class="left">'Angolino'</td></tr>
+    <tr><td class="num"> 170/1045</td><td class="num"> 26/189</td><td class="num"> 15.88%</td><td class="left">'jumbo'</td></tr>
     <tr><td class="num"> 156/1045</td><td class="num"> 24/189</td><td class="num"> 14.59%</td><td class="left">'jdcampo'</td></tr>
     <tr><td class="num"> 125/1045</td><td class="num"> 55/189</td><td class="num"> 14.59%</td><td class="left">'Vlad'</td></tr>
     <tr><td class="num"> 149/1045</td><td class="num"> 30/189</td><td class="num"> 14.51%</td><td class="left">'Chris'</td></tr>

Modified: homepage/input/table-wr.html
===================================================================
--- homepage/input/table-wr.html	2008-11-30 20:49:04 UTC (rev 1383)
+++ homepage/input/table-wr.html	2008-12-02 00:05:05 UTC (rev 1384)
@@ -1,39 +1,39 @@
   <table>
-    <caption>$$Worldrecord_Statistics$$ $$October$$ 2008</caption>
+    <caption>$$Worldrecord_Statistics$$ $$November$$ 2008</caption>
     <colgroup><col width="80"><col width="80"><col width="470"></colgroup>
     <tr><th>$$total$$</th><th>$$shared$$</th><th class="left">$$user$$</th></tr>
-    <tr><td class="num">923</td><td class="num">243</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">155</td><td class="num">114</td><td class="left">'daydreamer'</td></tr>
-    <tr><td class="num">152</td><td class="num"> 90</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num">146</td><td class="num">127</td><td class="left">'Crystalicum'</td></tr>
+    <tr><td class="num">911</td><td class="num">242</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">170</td><td class="num">124</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num">152</td><td class="num">129</td><td class="left">'Crystalicum'</td></tr>
+    <tr><td class="num">151</td><td class="num"> 89</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num">107</td><td class="num">100</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num"> 80</td><td class="num"> 68</td><td class="left">'dev0'</td></tr>
-    <tr><td class="num"> 54</td><td class="num"> 39</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num"> 79</td><td class="num"> 66</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num"> 52</td><td class="num"> 39</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num"> 42</td><td class="num"> 29</td><td class="left">'Malla'</td></tr>
-    <tr><td class="num"> 42</td><td class="num"> 30</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 40</td><td class="num"> 31</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num"> 40</td><td class="num"> 39</td><td class="left">'Great Scott'</td></tr>
+    <tr><td class="num"> 39</td><td class="num"> 27</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 31</td><td class="num"> 27</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 31</td><td class="num"> 29</td><td class="left">'Django'</td></tr>
-    <tr><td class="num"> 30</td><td class="num"> 21</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 29</td><td class="num"> 26</td><td class="left">'Zekobah'</td></tr>
+    <tr><td class="num"> 28</td><td class="num"> 20</td><td class="left">'Emmanuel'</td></tr>
+    <tr><td class="num"> 27</td><td class="num"> 18</td><td class="left">'Daisy'</td></tr>
     <tr><td class="num"> 27</td><td class="num"> 26</td><td class="left">'joseba'</td></tr>
-    <tr><td class="num"> 25</td><td class="num"> 24</td><td class="left">'Ghatotkacha'</td></tr>
-    <tr><td class="num"> 22</td><td class="num"> 20</td><td class="left">'ged'</td></tr>
-    <tr><td class="num"> 18</td><td class="num"> 16</td><td class="left">'Ludmian'</td></tr>
+    <tr><td class="num"> 24</td><td class="num"> 23</td><td class="left">'Ghatotkacha'</td></tr>
+    <tr><td class="num"> 21</td><td class="num"> 19</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 17</td><td class="num">  9</td><td class="left">'Gloop'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 14</td><td class="left">'B-Huff'</td></tr>
-    <tr><td class="num"> 16</td><td class="num"> 15</td><td class="left">'Safalra'</td></tr>
+    <tr><td class="num"> 16</td><td class="num"> 15</td><td class="left">'Safalra' + 'Ludmian'</td></tr>
     <tr><td class="num"> 15</td><td class="num"> 14</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 14</td><td class="num"> 14</td><td class="left">'bojster'</td></tr>
-    <tr><td class="num"> 13</td><td class="num"> 11</td><td class="left">'dpl'</td></tr>
-    <tr><td class="num"> 12</td><td class="num">  6</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num"> 13</td><td class="num">  6</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num"> 12</td><td class="num"> 11</td><td class="left">'dpl'</td></tr>
+    <tr><td class="num"> 11</td><td class="num">  8</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num"> 11</td><td class="num"> 11</td><td class="left">'ABS'</td></tr>
-    <tr><td class="num"> 10</td><td class="num">  8</td><td class="left">'Chocolate Zero'</td></tr>
     <tr><td class="num">  9</td><td class="num">  5</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+    <tr><td class="num">  9</td><td class="num">  7</td><td class="left">'Chocolate Zero'</td></tr>
     <tr><td class="num">  9</td><td class="num">  9</td><td class="left">'fabian'</td></tr>
-    <tr><td class="num">  8</td><td class="num">  5</td><td class="left">'Daisy'</td></tr>
-    <tr><td class="num">  7</td><td class="num">  5</td><td class="left">'Taztunes' + 'Angolino'</td></tr>
+    <tr><td class="num">  7</td><td class="num">  5</td><td class="left">'Taztunes'</td></tr>
     <tr><td class="num">  7</td><td class="num">  6</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num">  6</td><td class="num">  3</td><td class="left">'para_doks' + 'Breezy'</td></tr>
     <tr><td class="num">  6</td><td class="num">  5</td><td class="left">'Guglielmo'</td></tr>
@@ -43,11 +43,11 @@
     <tr><td class="num">  5</td><td class="num">  5</td><td class="left">'Raoul' + 'Thomas' + 'Chris' + 'Wuzzy' + 'Ralf'</td></tr>
     <tr><td class="num">  4</td><td class="num">  2</td><td class="left">'Hairball'</td></tr>
     <tr><td class="num">  4</td><td class="num">  4</td><td class="left">'U-Punkt' + 'J3FF' + 'Cyphase' + 'GiannuzzITA'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'mrduke' + 'mecke' + 'Stephanie'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'geembo_90' + 'Tiza' + 'Neophilus' + 'Nicol?s' + 'Andy' + 'Sopoforic'</td></tr>
+    <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'mecke' + 'Stephanie'</td></tr>
+    <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'geembo_90' + 'Tiza' + 'Neophilus' + 'Nicol?s' + 'Andy'</td></tr>
     <tr><td class="num">  2</td><td class="num">  0</td><td class="left">'Ale'</td></tr>
-    <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'alfred69' + 'ReasonAnce' + 'Drotten' + 'tjRaven' + 'Sim_Ed' + 'hendrik' + 'Bent' + 'Austin' + 'Snaily' + 'Craven' + 'Ingo' + 'serpent'</td></tr>
+    <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'alfred69' + 'ReasonAnce' + 'mrduke' + 'Drotten' + 'tjRaven' + 'Sim_Ed' + 'hendrik' + 'Bent' + 'Austin' + 'Snaily' + 'Craven' + 'Sopoforic' + 'Ingo' + 'serpent'</td></tr>
     <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'Feynman' + 'alain' + 'colonel crayon' + 'Gorn' + 'Nat'</td></tr>
     <tr><td class="num">  1</td><td class="num">  1</td><td class="left">'Agares' + 'Tiger' + 'Zak' + 'Daniel' + 'Slav' + 'niebie' + 'Andreas' + 'AlephD' + 'Samuel' + 'Mark P.' + 'oblo' + 'Pascal' + 'hdwow' + 'B-man' + 'Asbel' + 'Vlad' + 'Jinajon' + 'Vaily' + 'Antonio EE' + 'JuSt'</td></tr>
-    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'tasker' + 'Miel56' + 'Zhura' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'ntaeijr' + 'Eselchen' + 'ael' + 'biotopa' + 'brynn' + 'IntKecsk' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'jdrexler' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'Valkyrie2' + 'Fred_the_wise' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'Kroetchen' + 'crypto_rsa' + 'Harry Lim' + 'Sequoyah' + 'AkRa' + 'Momcat' + 'NorthForty' + 'Mecki' + 'The red O' + 'gringer' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'Kadu' + 'shoki' + 'jojo' + 'WesleyCrusher' + 'rima' + 'Klaus' + 'MicWa' + 'AsuCaga' + 'oxyd4ever' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'un_guru' + 'krazy62' + 'Dvorhagen' + 'Sparkey' + 'Holger' + 'Ingo_K' + 'Ant' + 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Liam Sheehan' + 'Michael' + 'Tarim' + 'Agnieszka'</td></tr>
+    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'tasker' + 'jumbo' + 'Miel56' + 'Zhura' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'ntaeijr' + 'Eselchen' + 'ael' + 'biotopa' + 'brynn' + 'IntKecsk' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'jdrexler' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'Valkyrie2' + 'Fred_the_wise' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'Kroetchen' + 'crypto_rsa' + 'Harry Lim' + 'Sequoyah' + 'AkRa' + 'Momcat' + 'NorthForty' + 'Mecki' + 'The red O' + 'gringer' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'Kadu' + 'shoki' + 'jojo' + 'WesleyCrusher' + 'rima' + 'Klaus' + 'MicWa' + 'AsuCaga' + 'oxyd4ever' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'un_guru' + 'krazy62' + 'Dvorhagen' + 'Sparkey' + 'Holger' + 'Ingo_K' + 'Ant' + 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Liam Sheehan' + 'Michael' + 'Tarim' + 'Agnieszka'</!
 td></tr>
   </table>

Modified: homepage/input/userlist.html
===================================================================
--- homepage/input/userlist.html	2008-11-30 20:49:04 UTC (rev 1383)
+++ homepage/input/userlist.html	2008-12-02 00:05:05 UTC (rev 1384)
@@ -87,6 +87,7 @@
     <li>jojo</li>
     <li>Joona</li>
     <li>joseba</li>
+    <li>jumbo</li>
     <li>JuSt</li>
     <li>Kadu</li>
     <li>Kevin</li>



From ged at mail.berlios.de  Thu Dec  4 20:43:42 2008
From: ged at mail.berlios.de (ged at mail.berlios.de)
Date: Thu, 4 Dec 2008 20:43:42 +0100
Subject: [Enigma-game-svn] r1385 - homepage/input/news
Message-ID: <200812041943.mB4Jhgli015241@sheep.berlios.de>

Author: ged
Date: 2008-12-04 20:43:38 +0100 (Thu, 04 Dec 2008)
New Revision: 1385

Added:
   homepage/input/news/news_issue26_ru.html
Log:
Homepage:
- Russian translation of news issue dedicated to announcement of End of Year Awards 2008 poll.

Added: homepage/input/news/news_issue26_ru.html
===================================================================
--- homepage/input/news/news_issue26_ru.html	2008-12-02 00:05:05 UTC (rev 1384)
+++ homepage/input/news/news_issue26_ru.html	2008-12-04 19:43:38 UTC (rev 1385)
@@ -0,0 +1,20 @@
+<h3 class="news">
+    <span class="date">1 ??????? 2008: </span> ??????? ????? 2008 ???? - ???????????
+</h3>
+
+<p>????????? ???? ??????? ????????, ?????????? ? ??????? ????, ? ???? ???? ??
+????????????? ?????? ???????? ?????? ??????? &mdash; ??????? ????? 2008 ????. ??
+????? ?????????? ??????? ???? 2008, ??????? ?????? ??????? ?????? ? ??????
+??????? ????????, ????????????? ???????? ?????? ?????? 2007: &quot;Island
+Labyrinth&quot;. ?? ?? ??????? ?????? ? ??? ? ???? ??????????: ?????? ???????
+??? ????????? ? ?????? ???????? ???????, ??? ?? ??? ? ? ???? ???????? ??????????:
+?????? ???????????? ???????, ?????? ?????????? ? ????? ???????? ???????. ?????????,
+??? ? ? ??????? ????, ???????????? ?? ?????? mag-heut.net ?? ?????????? ??????????
+??????, ? ?????? ?? ?????? ????????????? ?? ??? ??????? <a
+href="http://enigma.seymutor.de/eoya_2008/eoya_2008.php">?????</a>
+??? ?????????? ??????, <a
+	href="http://enigma.seymutor.de/eoya_2008/eoya_2008_de.php">?????</a> ??? ????????
+?????? ??? <a
+	href="http://enigma.seymutor.de/eoya_2008/eoya_2008_ru.php">?????</a> ??? ???????
+??????. ????? ??????? ??????! :-)</p>
+



From ral at mail.berlios.de  Sun Dec  7 01:36:11 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 7 Dec 2008 01:36:11 +0100
Subject: [Enigma-game-svn] r1386 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 data/schemas src src/floors src/items src/stones
Message-ID: <200812070036.mB70aBIb007592@sheep.berlios.de>

Author: ral
Date: 2008-12-07 01:36:01 +0100 (Sun, 07 Dec 2008)
New Revision: 1386

Added:
   trunk/data/gfx32/fl_abyss.png
   trunk/data/gfx32/fl_ice.png
   trunk/data/gfx32/fl_ice_heating.png
   trunk/data/gfx32/fl_space.png
   trunk/data/gfx32/fl_swamp.png
   trunk/data/gfx32/fl_swamp_heating.png
   trunk/data/gfx32/fl_water.png
   trunk/data/gfx32/fl_water_heating.png
   trunk/data/gfx40/fl_abyss.png
   trunk/data/gfx40/fl_ice.png
   trunk/data/gfx40/fl_ice_heating.png
   trunk/data/gfx40/fl_space.png
   trunk/data/gfx40/fl_swamp.png
   trunk/data/gfx40/fl_swamp_heating.png
   trunk/data/gfx40/fl_water.png
   trunk/data/gfx40/fl_water_heating.png
   trunk/data/gfx48/fl_abyss.png
   trunk/data/gfx48/fl_ice.png
   trunk/data/gfx48/fl_ice_heating.png
   trunk/data/gfx48/fl_space.png
   trunk/data/gfx48/fl_swamp.png
   trunk/data/gfx48/fl_swamp_heating.png
   trunk/data/gfx48/fl_water.png
   trunk/data/gfx48/fl_water_heating.png
   trunk/src/stones/FloorBuilder.cc
   trunk/src/stones/FloorBuilder.hh
Removed:
   trunk/data/gfx32/fl-abyss.png
   trunk/data/gfx32/fl-ice-heating.png
   trunk/data/gfx32/fl-ice.png
   trunk/data/gfx32/fl-space.png
   trunk/data/gfx32/fl-swamp-heating.png
   trunk/data/gfx32/fl-swamp.png
   trunk/data/gfx32/fl-water-heating.png
   trunk/data/gfx32/fl-water.png
   trunk/data/gfx40/fl-abyss.png
   trunk/data/gfx40/fl-ice-heating.png
   trunk/data/gfx40/fl-ice.png
   trunk/data/gfx40/fl-space.png
   trunk/data/gfx40/fl-swamp-heating.png
   trunk/data/gfx40/fl-swamp.png
   trunk/data/gfx40/fl-water-heating.png
   trunk/data/gfx40/fl-water.png
   trunk/data/gfx48/fl-abyss.png
   trunk/data/gfx48/fl-ice-heating.png
   trunk/data/gfx48/fl-ice.png
   trunk/data/gfx48/fl-space.png
   trunk/data/gfx48/fl-swamp-heating.png
   trunk/data/gfx48/fl-swamp.png
   trunk/data/gfx48/fl-water-heating.png
   trunk/data/gfx48/fl-water.png
Modified:
   trunk/data/api1init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/data/startup.lua
   trunk/src/Makefile.am
   trunk/src/floors.cc
   trunk/src/floors/BridgeFloor.cc
   trunk/src/items.cc
   trunk/src/items/SeedItem.cc
   trunk/src/nls.hh
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.cc
   trunk/src/stones.hh
   trunk/src/stones/BoulderStone.cc
   trunk/src/stones/ChessStone.cc
   trunk/src/stones/PuzzleStone.cc
   trunk/src/stones/VolcanoStone.cc
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering
-floorbuilding stones:
  - st_wood (random orientation), st_wood_h, st_wood_v, st_wood_growing
  - st_flhay
  - st_flrock
  modified features:
  - keep identity from seed to stone, from stone to floor
  - eliminate stone killing within on_move(), it is done on floor change only
  - let stone fall on first occurence, even if multiple impulses are received
- rename some floors:
  - fl_abyss
  - fl_ice
  - fl_water
  - fl_swamp
  - fl_space
- fix greek language menu


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/data/api1init.lua	2008-12-07 00:36:01 UTC (rev 1386)
@@ -45,7 +45,12 @@
 }
 
 RenamingObjectsNew2Old = {
+    fl_abyss = "fl-abyss",
     fl_bridge = "fl-bridge",
+    fl_ice = "fl-ice",
+    fl_space = "fl-space",
+    fl_swamp = "fl-swamp",
+    fl_water = "fl-water",
     it_blocker = "it-blocker",
     it_blocker_new = "it-blocker-new",
     it_brake = "it-brake",
@@ -64,6 +69,7 @@
     it_magicwand = "it-magicwand",
     it_magnet = "it-magnet",
     it_magnet_on = "it-magnet-on",
+    it_magnet_off = "it-magnet-off",
     it_meditation_hollow = "it-hollow",
     it_meditation_dent = "it-tinyhollow",
     it_meditation_bump = "it-tinyhill",
@@ -78,7 +84,6 @@
     it_pipe_nw = "it-pipe-wn",
     it_pipe_ns = "it-pipe-v",
     it_pipe_ne = "it-pipe-ne",
-    it_magnet_off = "it-magnet-off",
     it_rubberband = "it-rubberband",
     it_seed = "it-seed",
     it_seed_fake = "it-seed_nowood",
@@ -154,6 +159,8 @@
     st_door_c = "st-door_c",
     st_fart = "st-fart",
     st_floppy = "st-floppy",
+    st_flhay = "st-flhay",
+    st_flrock = "st-flrock",
     st_fourswitch = "st-fourswitch",
     st_knight = "st-knight",
     st_laser_w = "st-laser-w",
@@ -287,7 +294,11 @@
     st_volcano_new = "st-volcano-growing",
     st_volcano_active = "st-volcano_active",
     st_volcano_idle = "st-volcano_inactive",
-    st_window = "st-window"
+    st_window = "st-window",
+    st_wood = "st-wood",
+    st_wood_growing = "st-wood-growing",
+    st_wood_h = "st-wood1",
+    st_wood_v = "st-wood2"
 }
 
 for k,v in pairs(RenamingObjectsNew2Old) do

Deleted: trunk/data/gfx32/fl-abyss.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-ice-heating.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-ice.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-space.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-swamp-heating.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-swamp.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-water-heating.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-water.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/fl_abyss.png (from rev 1382, trunk/data/gfx32/fl-abyss.png)

Copied: trunk/data/gfx32/fl_ice.png (from rev 1382, trunk/data/gfx32/fl-ice.png)

Copied: trunk/data/gfx32/fl_ice_heating.png (from rev 1382, trunk/data/gfx32/fl-ice-heating.png)

Copied: trunk/data/gfx32/fl_space.png (from rev 1382, trunk/data/gfx32/fl-space.png)

Copied: trunk/data/gfx32/fl_swamp.png (from rev 1382, trunk/data/gfx32/fl-swamp.png)

Copied: trunk/data/gfx32/fl_swamp_heating.png (from rev 1382, trunk/data/gfx32/fl-swamp-heating.png)

Copied: trunk/data/gfx32/fl_water.png (from rev 1382, trunk/data/gfx32/fl-water.png)

Copied: trunk/data/gfx32/fl_water_heating.png (from rev 1382, trunk/data/gfx32/fl-water-heating.png)

Deleted: trunk/data/gfx40/fl-abyss.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-ice-heating.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-ice.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-space.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-swamp-heating.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-swamp.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-water-heating.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-water.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/fl_abyss.png (from rev 1382, trunk/data/gfx40/fl-abyss.png)

Copied: trunk/data/gfx40/fl_ice.png (from rev 1382, trunk/data/gfx40/fl-ice.png)

Copied: trunk/data/gfx40/fl_ice_heating.png (from rev 1382, trunk/data/gfx40/fl-ice-heating.png)

Copied: trunk/data/gfx40/fl_space.png (from rev 1382, trunk/data/gfx40/fl-space.png)

Copied: trunk/data/gfx40/fl_swamp.png (from rev 1382, trunk/data/gfx40/fl-swamp.png)

Copied: trunk/data/gfx40/fl_swamp_heating.png (from rev 1382, trunk/data/gfx40/fl-swamp-heating.png)

Copied: trunk/data/gfx40/fl_water.png (from rev 1382, trunk/data/gfx40/fl-water.png)

Copied: trunk/data/gfx40/fl_water_heating.png (from rev 1382, trunk/data/gfx40/fl-water-heating.png)

Deleted: trunk/data/gfx48/fl-abyss.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-ice-heating.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-ice.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-space.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-swamp-heating.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-swamp.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-water-heating.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-water.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/fl_abyss.png (from rev 1382, trunk/data/gfx48/fl-abyss.png)

Copied: trunk/data/gfx48/fl_ice.png (from rev 1382, trunk/data/gfx48/fl-ice.png)

Copied: trunk/data/gfx48/fl_ice_heating.png (from rev 1382, trunk/data/gfx48/fl-ice-heating.png)

Copied: trunk/data/gfx48/fl_space.png (from rev 1382, trunk/data/gfx48/fl-space.png)

Copied: trunk/data/gfx48/fl_swamp.png (from rev 1382, trunk/data/gfx48/fl-swamp.png)

Copied: trunk/data/gfx48/fl_swamp_heating.png (from rev 1382, trunk/data/gfx48/fl-swamp-heating.png)

Copied: trunk/data/gfx48/fl_water.png (from rev 1382, trunk/data/gfx48/fl-water.png)

Copied: trunk/data/gfx48/fl_water_heating.png (from rev 1382, trunk/data/gfx48/fl-water-heating.png)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/data/models-2d.lua	2008-12-07 00:36:01 UTC (rev 1386)
@@ -232,7 +232,7 @@
 ------------------------
 do
     floorlist = {
-        "fl-abyss",
+        "fl_abyss",
         "fl-acblack",
         "fl-acwhite",
         "fl-black",
@@ -241,7 +241,7 @@
         "fl-dummy",
         "fl-dunes",
         "fl-floor_001",
-        "fl-ice",
+        "fl_ice",
         "fl-inverse",
         "fl-inverse2",
         "fl-light",
@@ -258,6 +258,7 @@
     DefImages(floorlist)
 end
 
+
 -----------------------------------------
 -- Floors with multiple (random) tiles --
 -----------------------------------------
@@ -284,11 +285,11 @@
     DefRandFloorSi("fl-rough-red", 4)
     DefRandFloorSi("fl-sahara", 4)
     DefRandFloorSi("fl-samba", 2)
-    DefRandFloorSi("fl-space", 3,2)
+    DefRandFloorSi("fl_space", 3,2)
     DefRandFloorSi("fl-stwood", 2)
-    DefRandFloorSi("fl-swamp", 4)
+    DefRandFloorSi("fl_swamp", 4)
     DefRandFloorSi("fl-tigris", 4)
-    DefRandFloorSi("fl-water", 4)
+    DefRandFloorSi("fl_water", 4)
     DefRandFloorSi("fl-woven", 5)
 end
 
@@ -367,14 +368,14 @@
 ------------------------
 do
     function heating_animation(basemodel)
-        local images = DefSubimages(basemodel.."-heating", {h=8});
+        local images = DefSubimages(basemodel.."_heating", {h=8});
         local frames = BuildFrames(images, 240)
-        DefAnim(basemodel.."-heating", frames);
+        DefAnim(basemodel.."_heating", frames);
     end
 
-    heating_animation("fl-ice")
-    heating_animation("fl-water")
-    heating_animation("fl-swamp")
+    heating_animation("fl_ice")
+    heating_animation("fl_water")
+    heating_animation("fl_swamp")
 end
 
 --------------------------------------------------------------------------------

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/data/schemas/objects.xml	2008-12-07 00:36:01 UTC (rev 1386)
@@ -75,6 +75,8 @@
     <msg name="darken" type="nil"/>
     <msg name="disconnect" type="nil"/>
     <msg name="expl" type="nil"/>
+    <msg name="fall" type="nil"/>
+    <msg name="fire" type="nil"/>
     <msg name="flip" type="nil"/>
     <msg name="forcefire" type="nil"/>
     <msg name="get_adjacents" type="nil"/>
@@ -670,6 +672,16 @@
       <msg name="_explosion"/>
       <msg name="_trigger"/>
     </object>
+    <object name="st_flhay">
+      <msg name="fire"/>
+      <msg name="heat"/>
+      <msg name="fall"/>
+    </object>
+    <object name="st_flrock">
+      <msg name="fire"/>
+      <msg name="heat"/>
+      <msg name="fall"/>
+    </object>
     <object name="st_floppy">
       <msg name="on"/>
       <msg name="off"/>
@@ -1081,5 +1093,16 @@
     <object name="st_window_nesw">
       <attr name="faces" value="nesw"/>
     </object>
+    <object name="st_wood">
+      <msg name="fire"/>
+      <msg name="heat"/>
+      <msg name="fall"/>
+    </object>
+    <object name="st_wood_growing" init="true">
+    </object>
+    <object name="st_wood_h" init="true">
+    </object>
+    <object name="st_wood_v" init="true">
+    </object>
   </zoo>
 </objects>

Modified: trunk/data/startup.lua
===================================================================
--- trunk/data/startup.lua	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/data/startup.lua	2008-12-07 00:36:01 UTC (rev 1386)
@@ -233,7 +233,7 @@
 def_floor("fl-samba1",       6.0,   2.0,    true,   "fl-abyss")
 def_floor("fl-samba2",       6.0,   2.0,    true,   "fl-abyss")
 def_floor("fl-sand",         6.0,   2.0,   false,   "")
-def_floor("fl-space",        0.0,   0.0,   false,   "")
+def_floor("fl_space",        0.0,   0.0,   false,   "")
 def_floor("fl-springboard",  4.0,   2.0,   false,   "")
 def_floor("fl-stone",        1.4,   1.0,   false,   "")
 def_floor("fl-tigris",       6.0,   2.0,    true,   "")

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/Makefile.am	2008-12-07 00:36:01 UTC (rev 1386)
@@ -254,8 +254,10 @@
 	stones/Door.hh		\
 	stones/FartStone.cc	\
 	stones/FartStone.hh	\
-	stones/FloppySwitch.cc   \
-	stones/FloppySwitch.hh   \
+	stones/FloorBuilder.cc	\
+	stones/FloorBuilder.hh	\
+	stones/FloppySwitch.cc	\
+	stones/FloppySwitch.hh	\
 	stones/FourSwitch.cc	\
 	stones/FourSwitch.hh	\
 	stones/KeySwitch.cc	\

Modified: trunk/src/floors/BridgeFloor.cc
===================================================================
--- trunk/src/floors/BridgeFloor.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/floors/BridgeFloor.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -27,7 +27,7 @@
 namespace enigma {
     
     BridgeFloor::BridgeFloor(std::string flavor) : Floor("fl_bridge", 5, 1,
-        flf_default, flft_noash, "fl-abyss")
+        flf_default, flft_noash, "fl_abyss")
     {
         Floor::setAttr("flavor", flavor);
         state = OPEN;

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/floors.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -203,7 +203,7 @@
     string model = this->get_kind();
     if (   model == "fl-wood"   || model == "fl-wood1"   || model == "fl-wood2"
         || model == "fl-stwood" || model == "fl-stwood1" || model == "fl-stwood2")
-        return "fl-abyss";
+        return "fl_abyss";
     else
         return "";
 }
@@ -328,9 +328,9 @@
     // Maybe also transform floor?
     reaction_happened = on_heattransform(sourcedir, flhf) || reaction_happened;
     // Maybe transform stone, or stone blocks fire?
-    if(doStone)
-        if(Stone *st = GetStone(get_pos()))
-            if(to_int(SendMessage(st, "heat", Value(sourcedir))) != 0.0)
+    if (doStone)
+        if (Stone *st = GetStone(get_pos()))
+            if (SendMessage(st, "heat", Value(sourcedir)).to_bool())
                 reaction_happened = true;
     // Not item nor floor nor stone reacted? Then try to ignite the floor!
     // (Note: try_ignite also tests for the heating animation:
@@ -347,7 +347,7 @@
     if(!doHeatTransform || get_heattransform(false) == "")
         return false;
     if(doHeatTransform && get_heattransform(false) != "" && !heating_animation) {
-        set_anim(((string) this->get_kind()) + "-heating");
+        set_anim(((string) this->get_kind()) + "_heating");
         heating_animation = true;
     }
     return true;
@@ -471,7 +471,7 @@
     class Abyss : public Floor {
         CLONEOBJ(Abyss);
     public:
-        Abyss() : Floor("fl-abyss", 2.0, 1, flf_indestructible, flft_noash) {}
+        Abyss() : Floor("fl_abyss", 2.0, 1, flf_indestructible, flft_noash) {}
     private:
 //         void actor_enter(Actor* a) {SendMessage(a, "fall");}
         void actor_contact (Actor* a) {SendMessage(a, "fall");}
@@ -483,8 +483,8 @@
     class Ice : public Floor {
         CLONEOBJ (Ice);
     public:
-        Ice() : Floor ("fl-ice", 0.1, 0.1, flf_default, flft_default, "",
-            "fl-water") { }
+        Ice() : Floor ("fl_ice", 0.1, 0.1, flf_default, flft_default, "",
+            "fl_water") { }
 
         virtual double get_friction() const {
             return 0.1 * server::IceFriction;
@@ -496,8 +496,8 @@
     class Water : public Floor {
         CLONEOBJ(Water);
     public:
-        Water() : Floor("fl-water", 5, 1, flf_indestructible, flft_default, "",
-            "fl-swamp") {}
+        Water() : Floor("fl_water", 5, 1, flf_indestructible, flft_default, "",
+            "fl_swamp") {}
     private:
 
         bool is_destructible() const {return false;}
@@ -514,7 +514,7 @@
     class Swamp : public Floor {
         CLONEOBJ(Swamp);
     public:
-        Swamp() : Floor("fl-swamp", 13, 1.0, flf_indestructible, flft_default,
+        Swamp() : Floor("fl_swamp", 13, 1.0, flf_indestructible, flft_default,
             "", "fl-dunes") {}
     private:
         bool is_destructible() const {return false;}
@@ -546,7 +546,7 @@
         CLONEOBJ(FallenBox);
     public:
         FallenBox(const char *kind)
-        :  Floor(kind, 6.4, 2.0, flf_default, flft_burnable, "fl-abyss")
+        :  Floor(kind, 6.4, 2.0, flf_default, flft_burnable, "fl_abyss")
         // uses same traits as fl-wood
         {}
 

Modified: trunk/src/items/SeedItem.cc
===================================================================
--- trunk/src/items/SeedItem.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/items/SeedItem.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -104,7 +104,7 @@
                 return;
            }
        }
-       Stone *st = MakeStone(flavor == 0 ? "st-wood-growing" : (flavor == 1 ? "st-greenbrown-growing" : "st_volcano_growing"));
+       Stone *st = MakeStone(flavor == 0 ? "st_wood_growing" : (flavor == 1 ? "st-greenbrown-growing" : "st_volcano_growing"));
        transferIdentity(st);
        if (Value v = getAttr("secure"))
            st->setAttr("secure", v);

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/items.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -928,12 +928,12 @@
             string model = fl->get_kind();
             // SetItem(p, it_explosion2) only used by it-dynamite?
             // If Yes, the following block could be places in the explosion class:
-            if (model == "fl-space") {
+            if (model == "fl_space") {
                 // In space, an it-dynamite explodes to an it-sherd:
                 // HOT FIX
                 //replace(it_sherd);
                 replace("it-hollow");
-            } else if (model == "fl-ice") {
+            } else if (model == "fl_ice") {
                 // In ice, an it-dynamite explodes to an it-crack2:
                 replace("it-crack2");
             } else {
@@ -1272,7 +1272,7 @@
         void animcb() {
             if (state == CRACKING2) {
                 GridPos p= get_pos();
-                SetFloor(p, MakeFloor("fl-abyss"));
+                SetFloor(p, MakeFloor("fl_abyss"));
                 KillItem(p);
             } else {
                 state = CRACKING2;
@@ -1356,7 +1356,7 @@
         }
         void animcb() {
             GridPos p = get_pos();
-            SetFloor(p, MakeFloor("fl-abyss"));
+            SetFloor(p, MakeFloor("fl_abyss"));
             KillItem(p);
         }
     public:
@@ -2054,13 +2054,13 @@
                 string model = fl->get_kind();
 
                 /* do not allow markings on this floortypes:
-                   fl-abyss, fl-water, fl-swamp
+                   fl_abyss, fl_water, fl_swamp
                    fl-bridge[{-closed,-open}]?
-                   markings on fl-ice will result as it-crack1
+                   markings on fl_ice will result as it-crack1
                 */
-                if (model == "fl-abyss" || model == "fl-water" || model == "fl-swamp") {
+                if (model == "fl_abyss" || model == "fl_water" || model == "fl_swamp") {
                     return ITEM_KEEP;
-                } else  if (model == "fl-ice") {
+                } else  if (model == "fl_ice") {
                     SetItem (p, MakeItem("it-crack1"));
                 } else {
                     SetItem (p, MakeItem("it-cross"));

Modified: trunk/src/nls.hh
===================================================================
--- trunk/src/nls.hh	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/nls.hh	2008-12-07 00:36:01 UTC (rev 1386)
@@ -39,7 +39,7 @@
         { "Suomi",      "fi_FI", "flags25x15/fi" },
         { "??????????", "uk_UA", "flags25x15/ua" },
         { "??????????", "be_BY", "flags25x15/by" },
-        { "??? ????????", "el_GR", "flags25x15/gr" },
+        { "????????",   "el_GR", "flags25x15/gr" },
     };
 }
 

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/ox_extra.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -34,7 +34,7 @@
 // only tables following!
 
 const char *oxyd::oxydextra_floor_map[256] = {
-    "fl-abyss",          // OxydExtra floor 0x00
+    "fl_abyss",          // OxydExtra floor 0x00
     "fl-gray",           // OxydExtra floor 0x01
     "fl-metal",          // OxydExtra floor 0x02
     UNUSED,              // OxydExtra floor 0x03
@@ -53,16 +53,16 @@
     UNUSED,              // OxydExtra floor 0x10
     UNUSED,              // OxydExtra floor 0x11
     UNUSED,              // OxydExtra floor 0x12
-    "fl-water",          // OxydExtra floor 0x13
+    "fl_water",          // OxydExtra floor 0x13
     UNUSED,              // OxydExtra floor 0x14
     UNUSED,              // OxydExtra floor 0x15
     UNUSED,              // OxydExtra floor 0x16
-    "fl-ice",            // OxydExtra floor 0x17
+    "fl_ice",            // OxydExtra floor 0x17
     UNUSED,              // OxydExtra floor 0x18
     UNUSED,              // OxydExtra floor 0x19
     UNUSED,              // OxydExtra floor 0x1a
     UNUSED,              // OxydExtra floor 0x1b
-    "fl-space",          // OxydExtra floor 0x1c
+    "fl_space",          // OxydExtra floor 0x1c
     UNUSED,              // OxydExtra floor 0x1d
     UNUSED,              // OxydExtra floor 0x1e
     UNUSED,              // OxydExtra floor 0x1f
@@ -155,7 +155,7 @@
     "st-plain_break",    // OxydExtra stone 0x24
     "st-plain_hole",     // OxydExtra stone 0x25
     "st-plain_move",     // OxydExtra stone 0x26
-    "st-wood",           // OxydExtra stone 0x27
+    "st_wood",           // OxydExtra stone 0x27
     "st_switch_instant", // OxydExtra stone 0x28
     UNUSED,              // OxydExtra stone 0x29
     UNUSED,              // OxydExtra stone 0x2a

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/ox_magnum.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -34,7 +34,7 @@
 // only tables following!
 
 const char *oxyd::oxydmag_floor_map[256] = {
-    "fl-abyss",                 // OxydMagnum floor 0x00
+    "fl_abyss",                 // OxydMagnum floor 0x00
     "fl-gray",                  // OxydMagnum floor 0x01 (common was 'fl-gray')
     "fl-metal",                 // OxydMagnum floor 0x02 (This should be "fl-stwood" for #112)
     "fl-metal3",                // OxydMagnum floor 0x03
@@ -49,20 +49,20 @@
     "fl-inverse",               // OxydMagnum floor 0x0c (common was 'fl-inverse')
     "fl-acblack",               // OxydMagnum floor 0x0d
     "fl-acwhite",               // OxydMagnum floor 0x0e
-    "fl-swamp",                 // OxydMagnum floor 0x0f
+    "fl_swamp",                 // OxydMagnum floor 0x0f
     UNUSED,                     // OxydMagnum floor 0x10
     UNUSED,                     // OxydMagnum floor 0x11
     UNUSED,                     // OxydMagnum floor 0x12
-    "fl-water",                 // OxydMagnum floor 0x13
+    "fl_water",                 // OxydMagnum floor 0x13
     UNUSED,                     // OxydMagnum floor 0x14
     UNUSED,                     // OxydMagnum floor 0x15
     UNUSED,                     // OxydMagnum floor 0x16
-    "fl-ice",                   // OxydMagnum floor 0x17
+    "fl_ice",                   // OxydMagnum floor 0x17
     UNUSED,                     // OxydMagnum floor 0x18
     UNUSED,                     // OxydMagnum floor 0x19
     UNUSED,                     // OxydMagnum floor 0x1a
     UNUSED,                     // OxydMagnum floor 0x1b
-    "fl-space",                 // OxydMagnum floor 0x1c
+    "fl_space",                 // OxydMagnum floor 0x1c
     UNUSED,                     // OxydMagnum floor 0x1d
     UNUSED,                     // OxydMagnum floor 0x1e
     UNUSED,                     // OxydMagnum floor 0x1f
@@ -159,7 +159,7 @@
     "st-plain_break",           // OxydMagnum stone 0x28
     "st-plain_hole",            // OxydMagnum stone 0x29
     "st-plain_move",            // OxydMagnum stone 0x2a
-    "st-wood",                  // OxydMagnum stone 0x2b
+    "st_wood",                  // OxydMagnum stone 0x2b
     "st_switch_instant",        // OxydMagnum stone 0x2c
     "st_floppy",                // OxydMagnum stone 0x2d (in normal Oxyd Magnum Levels unused!)
     UNUSED,                     // OxydMagnum stone 0x2e

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/ox_oxyd1.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -67,7 +67,7 @@
 // only tables following!
 
 const char *oxyd::oxyd1_floor_map[256] = {
-    "fl-abyss",                 // Oxyd1 floor 0x00
+    "fl_abyss",                 // Oxyd1 floor 0x00
     "fl-gray",                  // Oxyd1 floor 0x01
     "fl-metal",                 // Oxyd1 floor 0x02
     "fl-samba",                 // Oxyd1 floor 0x03 was: checkered floor
@@ -82,26 +82,26 @@
     "fl-inverse2",              // Oxyd1 floor 0x0c
     "fl-acblack",               // Oxyd1 floor 0x0d
     "fl-acwhite",               // Oxyd1 floor 0x0e
-    "fl-swamp",                 // Oxyd1 floor 0x0f
+    "fl_swamp",                 // Oxyd1 floor 0x0f
     UNUSED,                     // Oxyd1 floor 0x10
     UNUSED,                     // Oxyd1 floor 0x11
     UNUSED,                     // Oxyd1 floor 0x12
-    "fl-water",                 // Oxyd1 floor 0x13
+    "fl_water",                 // Oxyd1 floor 0x13
     UNUSED,                     // Oxyd1 floor 0x14
     UNUSED,                     // Oxyd1 floor 0x15
     UNUSED,                     // Oxyd1 floor 0x16
-    "fl-ice",                   // Oxyd1 floor 0x17
+    "fl_ice",                   // Oxyd1 floor 0x17
     UNUSED,                     // Oxyd1 floor 0x18
     UNUSED,                     // Oxyd1 floor 0x19
     UNUSED,                     // Oxyd1 floor 0x1a
     UNUSED,                     // Oxyd1 floor 0x1b
-    "fl-space",                 // Oxyd1 floor 0x1c
-    "fl-space",                 // Oxyd1 floor 0x1d
+    "fl_space",                 // Oxyd1 floor 0x1c
+    "fl_space",                 // Oxyd1 floor 0x1d
     UNUSED,                     // Oxyd1 floor 0x1e
     UNUSED,                     // Oxyd1 floor 0x1f
-    "fl-space",                 // Oxyd1 floor 0x20
+    "fl_space",                 // Oxyd1 floor 0x20
     "fl-space-force",           // Oxyd1 floor 0x21
-    "fl-space",                 // Oxyd1 floor 0x22
+    "fl_space",                 // Oxyd1 floor 0x22
     "fl-gradient1",             // Oxyd1 floor 0x23
     "fl-gradient2",             // Oxyd1 floor 0x24
     "fl-gradient3",             // Oxyd1 floor 0x25
@@ -191,7 +191,7 @@
     "st-plain_break",           // Oxyd1 stone 0x28 [see Level#12]
     "st-plain_hole",            // Oxyd1 stone 0x29
     "st-plain_move",            // Oxyd1 stone 0x2a
-    "st-wood",                  // Oxyd1 stone 0x2b
+    "st_wood",                  // Oxyd1 stone 0x2b
     "st_switch_instant",        // Oxyd1 stone 0x2c
     "st_switch_black_instant",  // Oxyd1 stone 0x2d
     "st_switch_white_instant",  // Oxyd1 stone 0x2e

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/ox_peroxyd.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -103,7 +103,7 @@
 // only tables following!
 
 const char *oxyd::peroxyd_floor_map[256] = {
-    "fl-abyss",                 // PerOxyd floor 0x00
+    "fl_abyss",                 // PerOxyd floor 0x00
     "fl-gray",                  // PerOxyd floor 0x01
     "fl-metal",                 // PerOxyd floor 0x02
     "fl-metal",                 // PerOxyd floor 0x03
@@ -118,20 +118,20 @@
     "fl-inverse",               // PerOxyd floor 0x0c
     "fl-acblack",               // PerOxyd floor 0x0d
     "fl-acwhite",               // PerOxyd floor 0x0e
-    "fl-swamp",                 // PerOxyd floor 0x0f
+    "fl_swamp",                 // PerOxyd floor 0x0f
     UNUSED,                     // PerOxyd floor 0x10
     UNUSED,                     // PerOxyd floor 0x11
     UNUSED,                     // PerOxyd floor 0x12
-    "fl-water",                 // PerOxyd floor 0x13
-    "fl-water",                 // PerOxyd floor 0x14
+    "fl_water",                 // PerOxyd floor 0x13
+    "fl_water",                 // PerOxyd floor 0x14
     UNUSED,                     // PerOxyd floor 0x15
     UNUSED,                     // PerOxyd floor 0x16
-    "fl-ice",                   // PerOxyd floor 0x17
+    "fl_ice",                   // PerOxyd floor 0x17
     UNUSED,                     // PerOxyd floor 0x18
     UNUSED,                     // PerOxyd floor 0x19
     UNUSED,                     // PerOxyd floor 0x1a
     UNUSED,                     // PerOxyd floor 0x1b
-    "fl-space",                 // PerOxyd floor 0x1c
+    "fl_space",                 // PerOxyd floor 0x1c
     UNUSED,                     // PerOxyd floor 0x1d
     UNUSED,                     // PerOxyd floor 0x1e
     UNUSED,                     // PerOxyd floor 0x1f
@@ -227,7 +227,7 @@
     "st-plain_break",           // PerOxyd stone 0x24
     "st-bluegray_hole",         // PerOxyd stone 0x25
     "st-plain_move",            // PerOxyd stone 0x26
-    "st-wood",                  // PerOxyd stone 0x27
+    "st_wood",                  // PerOxyd stone 0x27
     "st_switch_instant",        // PerOxyd stone 0x28
     "st_switch_black_instant",  // PerOxyd stone 0x29
     "st_switch_white_instant",  // PerOxyd stone 0x2a

Modified: trunk/src/stones/BoulderStone.cc
===================================================================
--- trunk/src/stones/BoulderStone.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/stones/BoulderStone.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -133,7 +133,7 @@
 
     void BoulderStone::on_floor_change() {
         Floor *fl = GetFloor(get_pos());
-        if (fl->is_kind("fl-abyss")) {
+        if (fl->is_kind("fl_abyss")) {
             state = FALLING;
             init_model();
         }

Modified: trunk/src/stones/ChessStone.cc
===================================================================
--- trunk/src/stones/ChessStone.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/stones/ChessStone.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -151,9 +151,9 @@
     void ChessStone::on_floor_change() {
         Floor *fl = GetFloor(get_pos());
         if (fl != NULL) {
-            if (fl->is_kind("fl-abyss"))
+            if (fl->is_kind("fl_abyss"))
                 try_state(FALLING);
-            if (fl->is_kind("fl-swamp"))
+            if (fl->is_kind("fl_swamp"))
                 try_state(SINKING);
         }
     }

Added: trunk/src/stones/FloorBuilder.cc
===================================================================
--- trunk/src/stones/FloorBuilder.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/stones/FloorBuilder.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -0,0 +1,196 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/FloorBuilder.hh"
+#include "errors.hh"
+//#include "main.hh"
+
+namespace enigma {
+    FloorBuilder::FloorBuilder(int subtyp, int initState) : Stone() {
+        objFlags |= (subtyp << 25);
+        if (subtyp == ROCK)
+            objFlags |= OBJBIT_BLOCKFIRE;
+        state = initState;
+    }
+    
+    FloorBuilder* FloorBuilder::clone() {
+        if ((FloorBuilderTyp)((objFlags & OBJBIT_SUBTYP) >> 25) == WOOD) { 
+             // When st_wood is created it randomly becomes st_wood1 or st_wood2.
+             if (IntegerRand(0, 1) == 0)
+                return new FloorBuilder(WOOD1, state);
+            else
+                return new FloorBuilder(WOOD2, state);
+        } else {
+            return new FloorBuilder(*this);
+        }
+    }
+    
+    void FloorBuilder::dispose() {
+        delete this;
+    }
+    
+    std::string FloorBuilder::getClass() const {
+        FloorBuilderTyp typ = (FloorBuilderTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
+        switch (typ) {
+            case WOOD:
+            case WOOD1:
+            case WOOD2:
+                return "st_wood";
+            case HAY:
+                return "st_flhay";
+            case ROCK:
+                return "st_flrock";
+        }
+    }
+    
+    const char *FloorBuilder::get_kind() const {
+        FloorBuilderTyp typ = (FloorBuilderTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
+        switch (typ) {
+            case WOOD:
+                return "st_wood";
+            case WOOD1:
+                return "st_wood_h";
+            case WOOD2:
+                return "st_wood_v";
+            case HAY:
+                return "st_flhay";
+            case ROCK:
+                return "st_flrock";
+        }
+    }
+
+    Value FloorBuilder::message(const Message &m) {
+        if (m.message == "fire" && !(objFlags & OBJBIT_BLOCKFIRE)) {
+            KillStone(get_pos());
+            return true;  // allow fire to spread
+        } else if (m.message == "heat") {
+            return (objFlags & OBJBIT_BLOCKFIRE) != 0;  // block fire
+        } else if (m.message == "fall") {
+            maybe_fall_or_stopfire();
+            return Value();
+        }
+        return Stone::message(m);
+    }
+
+    void FloorBuilder::setState(int extState) {
+        // no external states
+    }
+    
+    void FloorBuilder::init_model() {
+        FloorBuilderTyp typ = (FloorBuilderTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
+        switch (typ) {
+            case WOOD:
+                ASSERT(false, XLevelRuntime, "Wood stone init model state error");
+            case WOOD1:
+                if (state == GROWING)
+                    set_anim("st-wood-growing");
+                else
+                    set_model("st-wood1");
+                break;
+            case WOOD2:
+                if (state == GROWING)
+                    set_anim("st-wood-growing");
+                else
+                    set_model("st-wood2");
+                break;
+            case HAY:
+                set_model("st-flhay"); break;
+                break;
+            case ROCK:
+                set_model("st-flrock"); break;
+        }
+    }
+    
+    void FloorBuilder::animcb() {
+        state = IDLE;
+        init_model();
+        maybe_fall_or_stopfire(); // instantly builds a bridge on fl_swamp etc
+    }
+
+    void FloorBuilder::actor_hit(const StoneContact &sc) {
+        if (state == GROWING)
+            SendMessage(sc.actor, "shatter");
+        else
+            Stone::actor_hit(sc);
+    }
+    
+    void FloorBuilder::actor_inside(Actor *a) {
+        if (state == GROWING)
+            SendMessage(a, "shatter");
+    }
+    
+    void FloorBuilder::actor_contact(Actor *a) {
+        if (state == GROWING)
+            SendMessage(a, "shatter");
+    }
+    
+    void FloorBuilder::on_move() {
+        // in oxyd1 only fall when moving
+        Stone::on_move();
+        maybe_fall_or_stopfire(true);
+    }
+    
+    void FloorBuilder::on_floor_change() {
+        // other oxyds versions: fall everytime the floor changes
+        maybe_fall_or_stopfire(false, true);
+    }
+    
+    void FloorBuilder::maybe_fall_or_stopfire(bool onMove, bool onFloorChange) {
+        FloorBuilderTyp typ = (FloorBuilderTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
+        GridPos p = get_pos();
+        if (server::GameCompatibility != GAMET_ENIGMA && IsLevelBorder(p))
+            return;
+        if (Floor *fl = GetFloor(p)) {
+            const std::string &k = fl->get_kind();
+            if (objFlags & OBJBIT_BLOCKFIRE)
+                SendMessage(fl, "stopfire");
+            if (k == "fl_abyss" || k == "fl_water" || k == "fl_swamp") {
+                if (onMove)
+                    // just mark - can not kill stone yet - this will be done on floor change event
+                    state = FALLING;  // keep the stone from moving any longer
+                else if ((server::GameCompatibility != GAMET_OXYD1) || state == FALLING || !onFloorChange) {
+                    state = FALLEN;
+                    Floor *fl = MakeFloor((typ == HAY) ? "fl-hay" : ((typ == ROCK) ? "fl-rock" : ((typ == WOOD1) ? "fl-stwood1" : "fl-stwood2")));
+                    transferIdentity(fl);
+                    SetFloor(p, fl); 
+                    KillStone(p);
+                }
+            }
+        }
+    }
+    
+    int FloorBuilder::traitsIdx() const {
+        return (state == IDLE) ? 1 : 0;
+    }
+
+    StoneTraits FloorBuilder::traits[2] = {
+        {"st_floorbuilder", st_floorbuilder, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_floorbuilder", st_floorbuilder, stf_none, material_stone, 1.0, MOVABLE_STANDARD},
+    };
+
+    BOOT_REGISTER_START
+        BootRegister(new FloorBuilder(0), "st_wood");
+        BootRegister(new FloorBuilder(0, 1), "st_wood_growing");
+        BootRegister(new FloorBuilder(1), "st_wood_h");
+        BootRegister(new FloorBuilder(2), "st_wood_v");
+        BootRegister(new FloorBuilder(3), "st_flhay");
+        BootRegister(new FloorBuilder(4), "st_flrock");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/FloorBuilder.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/FloorBuilder.hh
===================================================================
--- trunk/src/stones/FloorBuilder.hh	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/stones/FloorBuilder.hh	2008-12-07 00:36:01 UTC (rev 1386)
@@ -0,0 +1,89 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef FLOORBUILDERSTONE_HH
+#define FLOORBUILDERSTONE_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class FloorBuilder : public Stone {
+         DECL_TRAITS_ARRAY(2, traitsIdx());
+
+    private:
+        enum iState {
+            IDLE,       ///< standard movable stone
+            GROWING,    ///< a stone growing from a seed
+            FALLING,    ///< a stone moved into water or abyss and marked to fall on floor change notification
+            FALLEN      ///< a stone that is fallen on floor change notification and is vanishing
+        };
+        
+    private:
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_BLOCKFIRE =   1<<24,   ///< stone blocks fire on moves and floor changes beneath
+            OBJBIT_SUBTYP    =   7<<25,   ///< the FloorBuilderTyp
+        };
+        
+        enum FloorBuilderTyp {
+            WOOD = 0,
+            WOOD1,
+            WOOD2,
+            HAY,
+            ROCK
+        };
+    public:
+        FloorBuilder(int subtyp, int initState = IDLE);
+        
+        // Object interface
+        virtual FloorBuilder* clone();
+        virtual void dispose();
+        virtual std::string getClass() const;
+        virtual const char *get_kind() const;  // for backward compatibility
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual void setState(int extState);
+        
+        // GridObject interface
+        virtual void init_model();
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+        virtual void actor_inside(Actor *a);
+        virtual void actor_contact(Actor *a);
+        virtual void on_move();
+        virtual void on_floor_change();
+    
+    private:
+        // Private methods.
+        void maybe_fall_or_stopfire(bool onMove = false, bool onFloorChange = false);
+        int traitsIdx() const;
+    };
+
+} // namespace enigma
+
+#endif /*FLOORBUILDERSTONE_HH*/


Property changes on: trunk/src/stones/FloorBuilder.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones/PuzzleStone.cc
===================================================================
--- trunk/src/stones/PuzzleStone.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/stones/PuzzleStone.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -409,7 +409,7 @@
 
         for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
             if (Floor *fl = GetFloor(move((*itr)->get_pos(), dir))) {
-                if (!((fl->is_kind("fl-abyss") && isComplete) || (fl->is_kind("fl-water") && (isComplete || waterSink)))) {
+                if (!((fl->is_kind("fl_abyss") && isComplete) || (fl->is_kind("fl_water") && (isComplete || waterSink)))) {
                     createBridge = false;
                     break;
                 }

Modified: trunk/src/stones/VolcanoStone.cc
===================================================================
--- trunk/src/stones/VolcanoStone.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/stones/VolcanoStone.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -74,7 +74,7 @@
     }
     
     void VolcanoStone::init_model() {
-        switch( state) {
+        switch (state) {
             case FINISHED:
             case INACTIVE: set_model("st-plain"); break;
             case ACTIVE:   set_anim("st-farting"); break;

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/stones.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -746,7 +746,7 @@
 
         void on_floor_change() {
             if (Floor *fl = GetFloor (get_pos()))
-                if (fl->is_kind("fl-abyss"))
+                if (fl->is_kind("fl_abyss"))
                     ReplaceStone (get_pos(), MakeStone("st-plain_falling"));
         }
 
@@ -825,10 +825,10 @@
 //            Stone::on_move();
             GridPos p = get_pos();
             if (Floor *fl = GetFloor (p)) {
-                if (fl->is_kind("fl-abyss")) {
+                if (fl->is_kind("fl_abyss")) {
                     ReplaceStone (p, MakeStone("st-plain_falling"));
                 }
-                else if (fl->is_kind("fl-swamp") || fl->is_kind("fl-water")) {
+                else if (fl->is_kind("fl_swamp") || fl->is_kind("fl_water")) {
                     sound_event ("drown");
                     client::Msg_Sparkle (p.center());
                     KillStone (p);

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/stones.hh	2008-12-07 00:36:01 UTC (rev 1386)
@@ -61,6 +61,7 @@
         st_fart,
         st_firebreak,
         st_firebreak_move,
+        st_floorbuilder,
         st_floppy,
         st_fourswitch,
         st_greenbrown_growing,

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-12-04 19:43:38 UTC (rev 1385)
+++ trunk/src/stones_simple.cc	2008-12-07 00:36:01 UTC (rev 1386)
@@ -392,7 +392,7 @@
         void on_floor_change() {
             if (Floor *fl=GetFloor(get_pos())) {
                 const string &k = fl->get_kind();
-                if (k=="fl-water" || k=="fl-abyss" || k == "fl-swamp") {
+                if (k=="fl_water" || k=="fl_abyss" || k == "fl_swamp") {
                     client::Msg_Sparkle (get_center());
                     KillStone(get_pos());
                 }
@@ -833,123 +833,12 @@
     };
 }
 
-/* -------------------- Wooden stone -------------------- */
 
-/** \page st-wood Wooden Stone
-
-This stone is movable.  If moved into abyss, water or swamp it builds
-a wooden plank.
-
-\subsection woode Example
-\verbatim
-set_stone("st-wood", 10,10)
-\endverbatim
-
-Note: There are two flavors of st-wood which may be specified
-by using st-wood1 or st-wood2, and two related kinds: st-flrock,
-which creates the unburnable fl-rock and denies fire under it, and 
-the burnable st-hay, which leaves the burnable but stable fl-hay
-behind.
-
-\image html st-wood.png
-*/
-namespace
-{
-    class WoodenStone : public Stone {
-        CLONEOBJ(WoodenStone);
-        DECL_TRAITS;
-    public:
-        WoodenStone(const char *kind, const char *floorkind_, bool blockfire_ = false) :
-            Stone(kind), floorkind(floorkind_), blockfire(blockfire_) {}
-
-    private:
-        const char *floorkind;
-        bool blockfire;
-
-        void maybe_fall_or_stopfire() {
-            GridPos p = get_pos();
-            if (server::GameCompatibility != GAMET_ENIGMA && IsLevelBorder(p))
-                return;
-            if (Floor *fl = GetFloor(p)) {
-                const string &k = fl->get_kind();
-                if(blockfire)
-                    SendMessage(fl, "stopfire");
-                if (k == "fl-abyss" || k == "fl-water" || k == "fl-swamp") {
-                    SetFloor(p, MakeFloor(floorkind));
-                    KillStone(p);
-                }
-            }
-        }
-
-        virtual Value message(const Message &m) {
-            if (m.message == "fire" && !blockfire) {
-                KillStone(get_pos());
-                return true;  // allow fire to spread
-            } else if (m.message == "heat" && blockfire) {
-                return true;  // block fire
-            } else if (m.message == "fall") {
-                maybe_fall_or_stopfire();
-                return Value();
-            }
-            return Stone::message(m);
-        }
-
-        // in oxyd1 only fall when moving
-        void on_move() {
-            Stone::on_move();
-            if (server::GameCompatibility == GAMET_OXYD1)
-                maybe_fall_or_stopfire();
-        }
-        
-        // other oxyds versions: fall everytime the floor changes
-        void on_floor_change() {
-            if (server::GameCompatibility != GAMET_OXYD1)
-                maybe_fall_or_stopfire();
-        }
-    };
-    DEF_TRAITSM(WoodenStone, "INVALID", st_INVALID, MOVABLE_STANDARD);
-
-    /*! When st-wood is created it randomly becomes st-wood1 or
-      st-wood2. */
-    class RandomWoodenStone : public Stone {
-    public:
-        RandomWoodenStone() : Stone("st-wood") {}
-    private:
-        Stone *clone() {
-            if(IntegerRand(0, 1) == 0)
-                return new WoodenStone("st-wood1", "fl-stwood1");
-            else
-                return new WoodenStone("st-wood2", "fl-stwood2");
-        }
-        void dispose() {delete this;}
-    };
-}
-
 //----------------------------------------
 // Growing stones used by it-seed
 //----------------------------------------
 namespace
 {
-    class WoodenStone_Growing : public Stone {
-        CLONEOBJ(WoodenStone_Growing);
-        DECL_TRAITS;
-    public:
-        WoodenStone_Growing()
-        {}
-    private:
-        void init_model() { set_anim("st-wood-growing"); }
-        void animcb() {
-            Stone *st = MakeStone ("st-wood");
-            ReplaceStone (get_pos(), st);
-            SendMessage(st, "fall"); // instantly builds a bridge on fl-swamp etc
-        }
-        void actor_contact(Actor *a) {SendMessage(a, "shatter");}
-        void actor_inside(Actor *a) {SendMessage(a, "shatter");}
-        void actor_hit(const StoneContact &sc) {SendMessage(sc.actor, "shatter");}
-
-        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_STANDARD; }
-    };
-    DEF_TRAITS(WoodenStone_Growing, "st-wood-growing", st_wood_growing);
     
     class GreenbrownStone_Growing : public Stone {
         CLONEOBJ(GreenbrownStone_Growing);
@@ -1401,10 +1290,10 @@
         void on_floor_change() {
             GridPos p = get_pos();
             if (Floor *fl = GetFloor (p)) {
-                if (fl->is_kind("fl-abyss")) {
+                if (fl->is_kind("fl_abyss")) {
                     ReplaceStone (p, MakeStone("st-plain_falling"));
                 }
-                else if (fl->is_kind("fl-swamp") || fl->is_kind("fl-water")) {
+                else if (fl->is_kind("fl_swamp") || fl->is_kind("fl_water")) {
                     sound_event ("drown");
                     client::Msg_Sparkle (p.center());
                     KillStone (p);
@@ -1473,12 +1362,6 @@
     Register(new Stonebrush);
     Register(new ThiefStone);
 
-    Register(new RandomWoodenStone); // random flavor
-    Register(new WoodenStone("st-wood1", "fl-stwood1")); // horizontal planks
-    Register(new WoodenStone("st-wood2", "fl-stwood2")); // vertical planks
-    Register(new WoodenStone("st-flrock", "fl-rock", true));
-    Register(new WoodenStone("st-flhay", "fl-hay"));
-    Register(new WoodenStone_Growing);
     Register(new GreenbrownStone_Growing);
 
     Register(new YinYangStone1);



From ral at mail.berlios.de  Sun Dec  7 01:44:09 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 7 Dec 2008 01:44:09 +0100
Subject: [Enigma-game-svn] r1387 - team_levelpacks/team_test_new_api
Message-ID: <200812070044.mB70i9fI026628@sheep.berlios.de>

Author: ral
Date: 2008-12-07 01:43:53 +0100 (Sun, 07 Dec 2008)
New Revision: 1387

Modified:
   team_levelpacks/team_test_new_api/andreasT01_1.xml
   team_levelpacks/team_test_new_api/andreasT02_1.xml
   team_levelpacks/team_test_new_api/ralD002_1.xml
   team_levelpacks/team_test_new_api/ralD003_1.xml
   team_levelpacks/team_test_new_api/ralD004_1.xml
   team_levelpacks/team_test_new_api/ralD006_1.xml
   team_levelpacks/team_test_new_api/ralT016_1.xml
   team_levelpacks/team_test_new_api/ralT021_1.xml
   team_levelpacks/team_test_new_api/ralT025_1.xml
   team_levelpacks/team_test_new_api/ralT027_1.xml
   team_levelpacks/team_test_new_api/ralT031_1.xml
   team_levelpacks/team_test_new_api/ralT034_1.xml
   team_levelpacks/team_test_new_api/ralT035_1.xml
   team_levelpacks/team_test_new_api/ralT037_1.xml
   team_levelpacks/team_test_new_api/ralT039_1.xml
   team_levelpacks/team_test_new_api/ralT041_1.xml
   team_levelpacks/team_test_new_api/ralT042_1.xml
   team_levelpacks/team_test_new_api/ralT046_1.xml
   team_levelpacks/team_test_new_api/ralT047_1.xml
   team_levelpacks/team_test_new_api/ralT049_1.xml
   team_levelpacks/team_test_new_api/ralT053_1.xml
   team_levelpacks/team_test_new_api/ralT054_1.xml
   team_levelpacks/team_test_new_api/ralT055_1.xml
   team_levelpacks/team_test_new_api/ralT060_1.xml
   team_levelpacks/team_test_new_api/ralT061_1.xml
   team_levelpacks/team_test_new_api/ralT063_1.xml
   team_levelpacks/team_test_new_api/ralT065_1.xml
   team_levelpacks/team_test_new_api/ralT067_1.xml
   team_levelpacks/team_test_new_api/ralT068_1.xml
   team_levelpacks/team_test_new_api/ralT071_1.xml
   team_levelpacks/team_test_new_api/raoulT03_1.xml
   team_levelpacks/team_test_new_api/raoulT04_1.xml
   team_levelpacks/team_test_new_api/raoulT05_1.xml
   team_levelpacks/team_test_new_api/raoulT06_1.xml
Log:
Test Level new API:
- update demo levels concerning floorbuilders and floor renamings


Modified: team_levelpacks/team_test_new_api/andreasT01_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/andreasT01_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/andreasT01_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -42,12 +42,12 @@
 ti["s"] = {"it_sensor", invisible = true} --{"it-spring2"}
 
 ti["A"] = ti["."] .. {"fl-leaves"}
-ti["B"] = ti["."] .. {"fl-water"}
+ti["B"] = ti["."] .. {"fl_water"}
 ti["C"] = ti["."] .. {"fl-metal"}
 ti["D"] = ti["."] .. {"fl-black"}
 ti["E"] = ti["."] .. {"fl-inverse"}
 ti["F"] = ti["."] .. {"fl-rough-blue"}
-ti["G"] = ti["."] .. {"fl-abyss"}
+ti["G"] = ti["."] .. {"fl_abyss"}
 ti["H"] = ti["."] .. {"fl-floor_001"}
 
 w, h = wo(ti, " ", {

Modified: team_levelpacks/team_test_new_api/andreasT02_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/andreasT02_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/andreasT02_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -21,19 +21,19 @@
 
 ti["  "] = {"fl-sahara"}
 ti["A "] = {"fl-leaves"}
-ti["B "] = {"fl-swamp"}
+ti["B "] = {"fl_swamp"}
 ti["C "] = {"fl-metal"}
 ti["D "] = {"fl-black"}
 ti["E "] = {"fl-inverse"}
 ti["F "] = {"fl-rough-blue"}
 ti["G "] = {"fl-rough"}
 ti["H "] = {"fl-floor_001"}
-ti["I "] = {"fl-abyss"}
-ti["J "] = {"fl-water"}
+ti["I "] = {"fl_abyss"}
+ti["J "] = {"fl_water"}
 
 ti[" "] = {"fl-sahara"}
 ti["A"] = {"fl-leaves"}
-ti["B"] = {"fl-swamp"}
+ti["B"] = {"fl_swamp"}
 ti["C"] = {"fl-metal"}
 ti["D"] = {"fl-black"}
 ti["E"] = {"fl-inverse"}

Modified: team_levelpacks/team_test_new_api/ralD002_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD002_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralD002_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -15,7 +15,7 @@
       <el:score el:easy="-" el:difficult="-"/>
     </el:info>
     <el:luamain><![CDATA[
-ti["~"] = {"fl-water"}
+ti["~"] = {"fl_water"}
 ti["s"] = {"fl-sahara"}
 ti["t"] = {"fl-tigris"}
 ti["1"] = {"ac-blackball", 0, 0.5}

Modified: team_levelpacks/team_test_new_api/ralD003_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD003_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralD003_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -17,7 +17,7 @@
     <el:luamain><![CDATA[
 wo["ConserveLevel"] = false
 
-ti["~"] = {"fl-water"}
+ti["~"] = {"fl_water"}
 ti[" "] = {"fl-plank"}
 ti["c"] = {"it-crack3", brittleness=0}
 ti["^"] = {"st_oneway_n"}

Modified: team_levelpacks/team_test_new_api/ralD004_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD004_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralD004_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -15,7 +15,7 @@
       <el:score el:easy="-" el:difficult="-"/>
     </el:info>
     <el:luamain><![CDATA[
-ti["~"] = {"fl-water"}
+ti["~"] = {"fl_water"}
 ti["s"] = {"fl-sahara"}
 ti["t"] = {"fl-tigris"}
 ti["i"] = {"fl-inverse2"}

Modified: team_levelpacks/team_test_new_api/ralD006_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD006_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralD006_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -16,8 +16,8 @@
 wo["ConserveLevel"] = true
 
 ti[" "] = {"fl-samba"}
-ti["."] = {"fl-abyss"}
-ti["~"] = {"fl-water"}
+ti["."] = {"fl_abyss"}
+ti["~"] = {"fl_water"}
 ti["#"] = {"st-rock1"}
 ti["X"] = {"st_oxyd"}
 

Modified: team_levelpacks/team_test_new_api/ralT016_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT016_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT016_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -22,7 +22,7 @@
 wo["SwampSinkSpeed"] = 2
 
 ti[" "] = {"fl-sahara"}
-ti["."] = {"fl-abyss"}
+ti["."] = {"fl_abyss"}
 ti["#"] = {"st-rock1"}
 ti["l"] = {"st_lightpassenger_off"}
 ti["B"] = {"st_boulder_n"}
@@ -39,7 +39,7 @@
 ti["L"] = {"st_rotator_ccw"}
 ti["R"] = {"st_rotator_cw"}
 ti["b"] = {"st_blocker"}
-ti["H"] = {"st-wood"}
+ti["H"] = {"st_wood"}
 ti["A"] = {"st_blocker"}
 ti["a"] = {"it_blocker"}
 ti["c"] = {"it_blocker_new"}

Modified: team_levelpacks/team_test_new_api/ralT021_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT021_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT021_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -27,7 +27,7 @@
 ti["C"] = {"it_vortex", name="v3", destination={"v1","v2","v4"}}
 ti["D"] = {"it_vortex", name="v4", destination=po(3.1,7.7)}
 ti["R"] = {"st_rubberband"}
-ti["W"] = {"st-wood"}
+ti["W"] = {"st_wood"}
 ti["S"] = {"st_switch", target="autoclose"}
 
 ti["1"] = {"#ac-blackball"}

Modified: team_levelpacks/team_test_new_api/ralT025_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT025_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT025_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -41,7 +41,7 @@
 
 -- the bolder on fourswitch trigger will work after the reengineering of boulder
 ti["B"] = {"st_boulder_w"}
-ti["W"] = {"st-wood"}
+ti["W"] = {"st_wood"}
 
 
 -- 4 switches to set state of fourswitch that switches 4 others

Modified: team_levelpacks/team_test_new_api/ralT027_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT027_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT027_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -36,8 +36,8 @@
 
 ti["S"] = {"st_switch", target="blocker"}
 ti["s"] = {"it_blocker", "blocker"}
-ti["H"] = {"st-wood", "wood1"}
-ti["t"] = {"it_trigger", target="blocker"} .. ti({"st-wood", "wood2"})
+ti["H"] = {"st_wood", "wood1"}
+ti["t"] = {"it_trigger", target="blocker"} .. ti({"st_wood", "wood2"})
 
 
 

Modified: team_levelpacks/team_test_new_api/ralT031_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT031_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT031_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -20,8 +20,8 @@
 wo["ConserveLevel"] = true
 
 ti[" "] = {"fl-sahara"}
-ti["."] = {"fl-water"}
-ti["~"] = {"fl-abyss"}
+ti["."] = {"fl_water"}
+ti["~"] = {"fl_abyss"}
 ti["!"] = {"fl-wood", ignitable=true}
 ti["#"] = ti[" "] .. {"st-rock1"}
 
@@ -47,7 +47,7 @@
 ti["p"] = ti[" "] .. {"st_laser_n", "laseroon"}
 
 
-ti["W"] = ti[" "] .. {"st-wood"}
+ti["W"] = ti[" "] .. {"st_wood"}
 ti["U"] = ti[" "] .. {"st-block"}
 ti["V"] = ti[" "] .. {"st-brownie"}
 ti["u"] = ti[" "] .. {"it-spring1"}
@@ -67,7 +67,7 @@
 ti["4"] = (ti[" "]  .. {"it_trigger", target={"laserj","laserjon"}, action={"toggle", "on"}})
                 .. {"#ac-whiteball-small", controllers=0}
 ti["5"] = (ti[" "]  .. {"it_trigger", target={"laserl","laserlon"}, action={"toggle", "on"}})
-                .. {"st-wood"}
+                .. {"st_wood"}
 ti["6"] = (ti[" "]  .. {"it_trigger", "killtrigger", target="killstone"})
 
 

Modified: team_levelpacks/team_test_new_api/ralT034_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT034_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT034_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -26,7 +26,7 @@
 
 ti[" "] = ti["."] .. {"it_blocker"}
 ti["n"] = {}       -- just nothing
-ti["w"] = {"st-wood"}
+ti["w"] = {"st_wood"}
 ti["s"] = {"st_switch", target="rmfloor"}
 ti["i"] = {"st_switch", target="icefloor"}
 

Modified: team_levelpacks/team_test_new_api/ralT035_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT035_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT035_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -19,9 +19,9 @@
 wo["ConserveLevel"] = true
 
 ti["  "] = {"fl-sahara"}
-ti["~~"] = {"fl-water"}
+ti["~~"] = {"fl_water"}
 ti["##"] = {"st-rock1"}
-ti["++"] = {"st-wood"}
+ti["++"] = {"st_wood"}
 ti[" 1"] = ti["  "] .. {"#ac-blackball"}
 
 -- sample of create world without a given map - just default floors

Modified: team_levelpacks/team_test_new_api/ralT037_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT037_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT037_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -19,9 +19,9 @@
 wo["MagnetRange"] = 3
 
 ti[" "] = {"fl-sahara"}
-ti["~"] = {"fl-water"}
+ti["~"] = {"fl_water"}
 ti["s"] = {"st_shogun", "him"}
-ti["w"] = {"st-wood", "you"}
+ti["w"] = {"st_wood", "you"}
 ti["r"] = {"it_rubberband", anchor2="you", length=4}
 ti["S"] = {"st_switch", target="privat.callbacks.killwood"}
 ti["X"] = {"st_scissors"}

Modified: team_levelpacks/team_test_new_api/ralT039_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT039_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT039_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -22,7 +22,7 @@
 ti[" "] = {"fl-sahara"}
 
 ti["s"] = {"st_swap"}
-ti["W"] = {"st-wood"}
+ti["W"] = {"st_wood"}
 
 ti["A"] = {"#ac-blackball"}
 

Modified: team_levelpacks/team_test_new_api/ralT041_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT041_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT041_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -41,7 +41,7 @@
 
 ti["r"] = {"st_rotator_cw", movable=true}
 ti["R"] = {"st_rotator_ccw", movable=false}
-ti["W"] = {"st-wood"}
+ti["W"] = {"st_wood"}
 ti["s"] = {"st_swap"}
 ti["g"] = {"st-glass1"}
 ti["S"] = {"st_switch", target="addrot"}

Modified: team_levelpacks/team_test_new_api/ralT042_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT042_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT042_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -20,7 +20,7 @@
 wo["ConserveLevel"] = true
 
 ti[" "] = {"fl-sahara"}
-ti["."] = {"fl-ice"}
+ti["."] = {"fl_ice"}
 ti["c"] = {"it_cross"}
 ti["v"] = {"it-cherry"}
 
@@ -42,7 +42,7 @@
 
 ti["s"] = {"st_swap"}
 ti["i"] = {"st_stoneimpulse_movable"}
-ti["w"] = {"st-wood"}
+ti["w"] = {"st_wood"}
 ti["h"] = {"it_hammer"}
 ti["m"] = {"it_magicwand"}
 ti["b"] = {"it_brush"}

Modified: team_levelpacks/team_test_new_api/ralT046_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT046_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT046_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -19,12 +19,12 @@
 
 ti["  "] = {"fl-sahara"}
 ti[" ="] = {"fl-tigris"}
-ti[" ."] = {"fl-abyss"}
-ti[" ~"] = {"fl-water"}
+ti[" ."] = {"fl_abyss"}
+ti[" ~"] = {"fl_water"}
 ti[" ;"] = {"fl-leaves"}
 
 ti["# "] = {"st-rock1"}
-ti["W "] = {"st-wood"}
+ti["W "] = {"st_wood"}
 ti["X "] = {"st_oxyd"}
 ti["G "] = {"st-grate1"}
 

Modified: team_levelpacks/team_test_new_api/ralT047_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT047_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT047_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -19,12 +19,12 @@
 
 ti["   "] = {"fl-sahara"}
 ti["  ="] = {"fl-tigris"}
-ti["  ."] = {"fl-abyss"}
-ti["  ~"] = {"fl-water"}
+ti["  ."] = {"fl_abyss"}
+ti["  ~"] = {"fl_water"}
 ti["  ;"] = {"fl-leaves"}
 
 ti["#  "] = {"st-rock1"}
-ti["W  "] = {"st-wood"}
+ti["W  "] = {"st_wood"}
 ti["X  "] = {"st_oxyd"}
 ti["G  "] = {"st-grate1"}
 

Modified: team_levelpacks/team_test_new_api/ralT049_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT049_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT049_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -27,7 +27,7 @@
 ti["l"] = {"st_switch", target="newlp"}
 ti["A"] = {"st_actorimpulse_invisible"}
 ti["S"] = {"it_sensor", invisible=true}
-ti["#"] = {"st-wood"}
+ti["#"] = {"st_wood"}
 ti["N"] = {"st_laser_n", "laser", state=OFF}
 ti["n"] = {"st_switch", target="laser"}
 

Modified: team_levelpacks/team_test_new_api/ralT053_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT053_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT053_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -19,11 +19,11 @@
 wo["RubberViolationStrength"] = 50
 
 ti[" "] = {"fl-sahara"}
-ti["~"] = {"fl-water"}
+ti["~"] = {"fl_water"}
 ti["#"] = {"st-rock1"}
 ti["y"] = {"it-yinyang"}
-ti["."] = {"st-wood"}
-ti["w"] = {"st-wood", "w"}
+ti["."] = {"st_wood"}
+ti["w"] = {"st_wood", "w"}
 ti["s"] = {"st_scissors"}
 ti["S"] = {"st_swap"}
 ti["r"] = {"st_rubberband"}
@@ -66,11 +66,13 @@
 wo:add({"ot_rubberband", anchor1="a1", anchor2="w", length=3, strength=10, threshold=2, max=4, min=4})
 
 function cutme(value, sender)
-    wo[{19, 5}] = {"it_extralife"}
-    sender:kill()
+    if not value then
+        wo[{19, 5}] = {"it_extralife"}
+        sender:kill()
+    end
 end
 function shatter(value, sender)
-    if value == 0 then
+    if not value then
         sender["anchor1"]:shatter()
         sender["anchor2"]:shatter()
     end

Modified: team_levelpacks/team_test_new_api/ralT054_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT054_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT054_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -20,14 +20,14 @@
 ti[" "] = {"fl-sahara"}
 ti["#"] = {"st-rock1"}
 ti["+"] = {"st-rock1", "rock"}
-ti["~"] = {"fl-water"}
+ti["~"] = {"fl_water"}
 
 ti["p"] = {"it-puller-w"}
 ti["m"] = {"it_magicwand"}
 ti["t"] = {"it_wrench"}
 
-ti["w"] = {"st-wood"}
-ti["template_w"] = {"st-wood", "w%%"}
+ti["w"] = {"st_wood"}
+ti["template_w"] = {"st_wood", "w%%"}
 ti["template_b"] = {"st-brownie", "b%%"}
 ti["s"] = {"st_scissors"}
 ti["S"] = {"st_swap"}

Modified: team_levelpacks/team_test_new_api/ralT055_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT055_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT055_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -18,44 +18,75 @@
 wo["ConserveLevel"] = true
 
 ti[" "] = {"fl-sahara"}
-ti["~"] = {"fl-water"}
-ti["."] = {"fl-abyss"}
+ti["~"] = {"fl_water"}
+ti["."] = {"fl_abyss"}
 
-ti["w"] = {"st-wood"}
+ti[","] = {"it_seed"}
+
+
+ti["w"] = {"st_wood"}
+ti["h"] = {"st_flhay"}
+ti["r"] = {"st_flrock"}
 ti["b"] = {"st-block"}
 ti["f"] = {"st-firebreak_move"}
 ti["p"] = {"st-plain_move"}
 
 ti["s"] = {"st_switch", target="flood"}
 
-ti["W"] = ti["~"] .. {"st-wood"}
+ti["W"] = ti["~"] .. {"st_wood"}
+ti["H"] = ti["~"] .. {"st_flhay"}
+ti["R"] = ti["~"] .. {"st_flrock"}
 ti["B"] = ti["~"] .. {"st-block"}
 ti["F"] = ti["~"] .. {"st-firebreak_move"}
 ti["P"] = ti["~"] .. {"st-plain_move"}
 
 ti["S"] = ti["~"] .. {"st_swap"}
 
+ti["v"] = {"st_wood", "woody"}
+ti["V"] = {"st_swap", "buddy"}
+
+ti["i"] = {"st_stoneimpulse", "i2"}
+ti["I"] = {"st_stoneimpulse", "i1"}
+ti["k"] = {"st_stoneimpulse", "k2"}
+ti["K"] = {"st_stoneimpulse", "k1"}
+ti["J"] = {"st_switch", target="push"}
+
 ti["1"] = {"#ac-blackball"} 
 
 
 w, h = wo(ti, " ", {
-"   ~~~              ",
+" h ~~~ h  ,,   h .  ",
 " w ~~~ w       w .  ",
 " b ~~~ b 1     b .  ",
 " f ~~~ f       f .  ",
 " p ~~~ p       p .  ",
-" s ~~~           .  ",
-"   ~~~           .  ",
-"   ~~W              ",
+" r ~~~ r       r .  ",
+" s ~~H              ",
+"   ~~W         Sh   ",
 "   ~~B         Sw   ",
 "   ~~F         Sb   ",
 "   ~~P         Sf   ",
-"   ~~~         Sp   ",
-"               ~    "
+"   ~~R         Sp   ",
+"               Sr   ",
+" ~~~~  v V          ",
+"i~~~ k              ",
+" w  w               ",
+" IJ K               ",
+"                    ",
 })
 
+wo:add({"ot_wire", anchor1="woody", anchor2="buddy"})
+wo:add({"ot_wire", anchor1="woody", anchor2="buddy"})  -- this should autodelete the first wire
+
+function push(value, sender)   -- test for block on moves on falling
+    no["i1"]:signal(1)
+    no["i2"]:signal(1)
+    no["k1"]:signal(1)
+    no["k2"]:signal(1)
+end
+
 function flood(value, sender)
-    for i = 1, 4 do
+    for i = 1, 6 do
         wo[sender - i*po(0,1)] = {"fl-water"}
     end
 end

Modified: team_levelpacks/team_test_new_api/ralT060_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT060_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT060_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -41,9 +41,9 @@
 ti["X"] = {"st_door_a", "door_mx", state=OPEN}
 ti["Y"] = {"st_door_a", "door_ly"}
 
-ti["w"] = {"st-wood", "wood"}
-ti["v"] = {"st-wood", "wood2"}
-ti["u"] = {"st-wood", "wood3"}
+ti["w"] = {"st_wood", "wood"}
+ti["v"] = {"st_wood", "wood2"}
+ti["u"] = {"st_wood", "wood3"}
 ti["r"] = {"st-rock1"}
 ti["s"] = {"st_swap"}
 ti["c"] = {"it-cherry"}

Modified: team_levelpacks/team_test_new_api/ralT061_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT061_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT061_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -29,8 +29,8 @@
 
 ti["B"] = {"st_brake"}
 ti["R"] = {"st_rotator", movable=true}
-ti["w"] = {"st-wood", "wood1"}
-ti["W"] = {"st-wood", "wood2"}
+ti["w"] = {"st_wood", "wood1"}
+ti["W"] = {"st_wood", "wood2"}
 ti["c"] = {"it_coin_s"}
 
 ti["g"] = {"st-grate1"}

Modified: team_levelpacks/team_test_new_api/ralT063_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT063_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT063_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -18,9 +18,9 @@
 wo["ConserveLevel"] = true
 
 ti[" "] = {"fl-sahara"}
-ti["~"] = {"fl-water"}
-ti["_"] = {"fl-abyss"}
-ti["w"] = {"st-wood"}
+ti["~"] = {"fl_water"}
+ti["_"] = {"fl_abyss"}
+ti["w"] = {"st_wood"}
 ti["s"] = {"st_swap"}
 
 ti["1"] = {"st_puzzle_blue", cluster=1, hollow=false}
@@ -49,12 +49,12 @@
 
 ti["'"] = {"st_puzzle", "puz1", connections="n"}
 ti["!"] = {"st_puzzle_yellow", "puz2", connections="w"}
-ti["W"] = {"st-wood", "wood1"}
-ti["V"] = {"st-wood", "wood2"}
+ti["W"] = {"st_wood", "wood1"}
+ti["V"] = {"st_wood", "wood2"}
 
 ti["n"] = {"st_puzzle_blue", "puz3", connections="n"}
 ti["m"] = {"st_puzzle_blue", "puz4", connections="s"}
-ti["v"] = {"st-wood", "wood3"}
+ti["v"] = {"st_wood", "wood3"}
 
 ti["N"] = {"st_puzzle_blue", "puz5", connections="n"}
 ti["M"] = {"st_puzzle_blue", "puz6", connections="s"}
@@ -68,8 +68,8 @@
 ti["."] = {"st_stoneimpulse_movable"}
 ti["*"] = {"it-cherry"}
 
-ti["x"] = {"st-wood", "wood4"}
-ti["X"] = {"st-wood", "wood5"}
+ti["x"] = {"st_wood", "wood4"}
+ti["X"] = {"st_wood", "wood5"}
 
 ti["@"] = {"#ac-blackball"}  ..ti({"it_magicwand"})
 

Modified: team_levelpacks/team_test_new_api/ralT065_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT065_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT065_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -30,7 +30,7 @@
 ti["("] = {"it_meditation_volcano", "vol#"}
 ti[")"] = {"it_meditation_caldera", "vol#"}
 
-ti["w"] = {"st-wood"}
+ti["w"] = {"st_wood"}
 ti["d"] = {"it-dynamite"}
 ti["?"] = {"it-spade"}
 ti["S"] = {"st_switch", target="hilli#*", action="flip"}

Modified: team_levelpacks/team_test_new_api/ralT067_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT067_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT067_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -18,11 +18,11 @@
 wo["ConserveLevel"] = true
 
 ti[" "] = {"fl-sahara"}
-ti["~"] = {"fl-water", "water"}
-ti["_"] = {"fl-abyss", "ab#"}
-ti["."] = {"fl-water", "pw#"}
+ti["~"] = {"fl_water", "water"}
+ti["_"] = {"fl_abyss", "ab#"}
+ti["."] = {"fl_water", "pw#"}
 
-ti["w"] = {"st-wood"}
+ti["w"] = {"st_wood"}
 ti["b"] = {"it_brush"}
 ti["T"] = {"st_switch", target="dopos"}
 ti["U"] = {"st_switch", target="doabyss"}

Modified: team_levelpacks/team_test_new_api/ralT068_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT068_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT068_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -30,7 +30,7 @@
 ti["S"] = {"st_switch", target="@bridge#*"}
 ti["T"] = {"st_switch", target="closed", action_1="open", action_0="close"}
 
-ti["w"] = {"st-wood"}
+ti["w"] = {"st_wood"}
 ti["g"] = {"st-glass_move"}
 ti["c"] = {"it-cherry"}
 ti["s"] = {"it-spring1"}

Modified: team_levelpacks/team_test_new_api/ralT071_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT071_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/ralT071_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -28,15 +28,15 @@
 
 ti["m"] = {"it_magicwand"}
 ti["d"] = {"it-dynamite"}
-ti["w"] = {"st-wood"}
+ti["w"] = {"st_wood"}
 ti["s"] = {"st_swap"}
 ti["p"] = {"st_polarswitch"}
 ti["n"] = {"st_laser_n",state=ON}
 ti["r"] = {"st_boulder_w"}
 
-ti["W"] = {"st-wood", "w1"}
-ti["V"] = {"st-wood", "w2"}
-ti["U"] = {"st-wood", "w3"}
+ti["W"] = {"st_wood", "w1"}
+ti["V"] = {"st_wood", "w2"}
+ti["U"] = {"st_wood", "w3"}
 
 ti["a"] = {"st_stoneimpulse_hollow", "a1"}
 ti["A"] = {"st_stoneimpulse_hollow", "a2"}

Modified: team_levelpacks/team_test_new_api/raoulT03_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -18,7 +18,7 @@
 wo["ConserveLevel"] = true
 
 ti[" "] = {"fl-sahara"}
-ti["."] = {"fl-space"}
+ti["."] = {"fl_space"}
 
 ti["0"] = {"#ac-blackball"}
 ti["'"] = {"#ac-whiteball"}
@@ -63,7 +63,7 @@
 ti["G"] = {"st_window", faces="ws", "pullwindow"}
 ti["L"] = {"st_laser_w", "laser"}
 ti["S"] = {"st_switch", target="laser"}
-ti["M"] = {"st-wood"}
+ti["M"] = {"st_wood"}
 
 
 ti["x"] = ti["C"] .. {"it_vortex", "vortexx", destination="vortexy"}

Modified: team_levelpacks/team_test_new_api/raoulT04_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT04_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/raoulT04_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -68,7 +68,7 @@
 ti["5"] = ti[" "] .. {"st_laser_w", name="la12"}
 ti["6"] = ti[" "] .. {"st_laser_w", name="la13"}
 
-ti["W"] = {"st-wood"}
+ti["W"] = {"st_wood"}
 
 w, h = wo(ti, " ", {
 "0      A     RL     ",

Modified: team_levelpacks/team_test_new_api/raoulT05_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT05_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/raoulT05_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -15,8 +15,8 @@
       <el:score el:easy="-" el:difficult="-"/>
     </el:info>
     <el:luamain><![CDATA[
-ti[" "] = {"fl-swamp"}
-ti["."] = {"fl-abyss"}
+ti[" "] = {"fl_swamp"}
+ti["."] = {"fl_abyss"}
 
 ti["a"] = {"it_strip"}
 
@@ -45,7 +45,7 @@
 ti["E"] = ti["."] .. {"it_strip_n"}
 
 
-ti["w"] = {"st-wood"}
+ti["w"] = {"st_wood"}
 ti["v"] = {"st-plain_move"}
 
 ti["A"] = {"#ac-blackball"} .. ti["a"]

Modified: team_levelpacks/team_test_new_api/raoulT06_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT06_1.xml	2008-12-07 00:36:01 UTC (rev 1386)
+++ team_levelpacks/team_test_new_api/raoulT06_1.xml	2008-12-07 00:43:53 UTC (rev 1387)
@@ -15,7 +15,7 @@
       <el:score el:easy="-" el:difficult="-"/>
     </el:info>
     <el:luamain><![CDATA[
-ti[" "] = {"fl-space"}
+ti[" "] = {"fl_space"}
 ti["*"] = {"fl-wood"}
 
 ti["a"] = {"it_strip", friction=1, adhesion=1}



From ral at mail.berlios.de  Sun Dec  7 16:28:25 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 7 Dec 2008 16:28:25 +0100
Subject: [Enigma-game-svn] r1388 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 data/schemas src/items src/stones
Message-ID: <200812071528.mB7FSPSv018495@sheep.berlios.de>

Author: ral
Date: 2008-12-07 16:28:22 +0100 (Sun, 07 Dec 2008)
New Revision: 1388

Added:
   trunk/data/gfx32/st-oxyde.png
   trunk/data/gfx40/st-oxyde.png
   trunk/data/gfx48/st-oxyde.png
Modified:
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/items/GlassesItem.cc
   trunk/src/items/Magnet.cc
   trunk/src/stones/OxydStone.cc
   trunk/src/stones/OxydStone.hh
Log:
Trunk 1.1:  new API 
- magnet item: default "it_magnet" to switched off as the refman reports
- glasses item: eliminate braking sound on stones being pushed over already
    broken glasses
- oxyd stone new flavor "e" - allows to peep the color:
  - initial closed image like flavor "b" (black standard oxyd)
  - once opened the oxyd closes to an image with a peephole
  - message "peepall" to one oxyd after shuffling results in peepholes
  - any further reshuffling closes to intransparent initial "b" image


Added: trunk/data/gfx32/st-oxyde.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-oxyde.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st-oxyde.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-oxyde.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st-oxyde.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-oxyde.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-12-07 00:43:53 UTC (rev 1387)
+++ trunk/data/models-2d.lua	2008-12-07 15:28:22 UTC (rev 1388)
@@ -1342,7 +1342,7 @@
         a="st-oxyda-open",
         b="st-oxydb-open",
         c="st-oxydc-open",
-        d="st-oxydd-open"
+        d="st-oxydd-open",
     }
     local shadow = {
        a="sh-round",
@@ -1457,6 +1457,27 @@
     mkoxyd("b")
     mkoxyd("c")
     mkoxyd("d")
+
+    -- flavors 'e' 
+    for color = 0, num_colors - 1 do
+        DefOverlay("st-oxyde"..color.."-peep", {"st-oxydb-open", colorspots[color+1], "st-oxyde"})
+        DefShModel("st-oxyde"..color, "st-oxyde"..color.."-peep", "sh-round")
+        DefAlias("st-oxyde"..color.."-opening", "st-oxydb"..color.."-opening")
+        DefAlias("st-oxyde"..color.."-closing", "st-oxydb"..color.."-closing")
+        DefAlias("st-oxyde"..color.."-blink", "st-oxydb"..color.."-blink")
+        DefAlias("st-oxyde"..color.."-open", "st-oxydb"..color.."-open")
+    end
+    DefAlias("st-oxyde", "st-oxydb")
+    DefAlias("st-oxyde-3-opening", "st-oxydb-3-opening")
+    DefAlias("st-oxyde-pseudo-3", "st-oxydb-pseudo-3")
+    DefAlias("st-oxyde-3-closing", "st-oxydb-3-closing")
+    DefOverlay("st-oxyde-3-peep", {"st-oxydb-open", colorspots[97], "st-oxyde"})
+    DefShModel("st-oxyde-3", "st-oxyde-3-peep", "sh-round")
+    DefAlias("st-oxyde-4-opening", "st-oxydb-4-opening")
+    DefAlias("st-oxyde-pseudo-4", "st-oxydb-pseudo-4")
+    DefAlias("st-oxyde-4-closing", "st-oxydb-4-closing")
+    DefOverlay("st-oxyde-4-peep", {"st-oxydb-open", colorspots[96], "st-oxyde"})
+    DefShModel("st-oxyde-4", "st-oxyde-4-peep", "sh-round")
 end
 
 -- st-coffee --

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-07 00:43:53 UTC (rev 1387)
+++ trunk/data/schemas/objects.xml	2008-12-07 15:28:22 UTC (rev 1388)
@@ -92,6 +92,7 @@
     <msg name="on" type="nil"/>
     <msg name="open" type="nil"/>
     <msg name="orientate" type="nil"/>
+    <msg name="peepall" type="nil"/>
     <msg name="pull_rotate" type="int"/>
     <msg name="push_rotate" type="int"/>
     <msg name="setfire" type="nil"/>
@@ -799,6 +800,7 @@
       <attr name="oxydcolor"/>
       <attr name="static"/>
       <msg name="closeall"/>
+      <msg name="peepall"/>
       <msg name="shuffle"/>
       <msg name="_trigger"/>
       <msg name="_spitter"/>

Modified: trunk/src/items/GlassesItem.cc
===================================================================
--- trunk/src/items/GlassesItem.cc	2008-12-07 00:43:53 UTC (rev 1387)
+++ trunk/src/items/GlassesItem.cc	2008-12-07 15:28:22 UTC (rev 1388)
@@ -77,8 +77,10 @@
         updateGlasses();
     }
     void Glasses::on_stonehit(Stone *) {
-        sound_event ("shatter");
-        setState(0);
+        if (state > 0) {
+            sound_event ("shatter");
+            setState(0);
+        }
     }
         
     int Glasses::traitsIdx() const {

Modified: trunk/src/items/Magnet.cc
===================================================================
--- trunk/src/items/Magnet.cc	2008-12-07 00:43:53 UTC (rev 1387)
+++ trunk/src/items/Magnet.cc	2008-12-07 15:28:22 UTC (rev 1388)
@@ -93,7 +93,7 @@
     };
     
     BOOT_REGISTER_START
-        BootRegister(new Magnet(true), "it_magnet");
+        BootRegister(new Magnet(false), "it_magnet");
         BootRegister(new Magnet(false), "it_magnet_off");
         BootRegister(new Magnet(true), "it_magnet_on");
     BOOT_REGISTER_END

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-12-07 00:43:53 UTC (rev 1387)
+++ trunk/src/stones/OxydStone.cc	2008-12-07 15:28:22 UTC (rev 1388)
@@ -210,6 +210,10 @@
             fairShuffleColors(logFlag);
         else
             simpleShuffleColors();
+            
+        for (unsigned i=0; i<levelOxyds.size(); ++i)
+            if (levelOxyds[i]->state == CLOSED && levelOxyds[i]->isDisplayable())
+                levelOxyds[i]->setClosedModel(true);
     }
     
     void OxydStone::simpleShuffleColors() {
@@ -858,23 +862,23 @@
         if (m.message == "closeall") {
             closeAllStandardOxyds();
             return Value();
-        }
-        else if (m.message == "shuffle") {
+        } else if (m.message == "peepall") {
+            for (unsigned i=0; i<levelOxyds.size(); ++i)
+                if (levelOxyds[i]->state == CLOSED && levelOxyds[i]->isDisplayable())
+                    levelOxyds[i]->setClosedModel(false);
+        } else if (m.message == "shuffle") {
             shuffleColors();
             return Value();
-        }
-        else if ((m.message == "_trigger"  && m.value.to_bool()) || m.message == "_spitter") {
+        } else if ((m.message == "_trigger"  && m.value.to_bool()) || m.message == "_spitter") {
             tryOpen();   // just internal messages on displayable oxyds
             return Value();
-        }
-        else if (m.message == "_init") {
+        } else if (m.message == "_init") {
             initColors();
             return Value();
         } else if (m.message == "_model_reanimated") {
             if (objFlags & OBJBIT_CLOSED) {
                 state = CLOSED;
-                std::string flavor(getAttr("flavor"));
-                set_model(string("st-oxyd") + flavor);
+                setClosedModel();
                 objFlags &= ~OBJBIT_CLOSED;
             } else if (objFlags & OBJBIT_OPENPAIR) {
                 state = OPEN_PAIR;
@@ -891,15 +895,15 @@
     
     void OxydStone::setAttr(const string& key, const Value &val) {
         if (key == "oxydcolor") 
-            ASSERT(state == CLOSED, XLevelRuntime, "OxydStone error - recoloring of an not closed stone");
+            ASSERT(state == CLOSED, XLevelRuntime, "OxydStone error - recoloring of a not closed stone");
         else if (key == "flavor") {
-            ASSERT(state == CLOSED, XLevelRuntime, "OxydStone error - reflavoring of an not closed stone");
+            ASSERT(state == CLOSED, XLevelRuntime, "OxydStone error - reflavoring of a not closed stone");
         }
         
         Stone::setAttr(key, val);   // do value checking
         
         if (key == "flavor" && IsInsideLevel(get_pos()))
-            set_model(string("st-oxyd")+(std::string)val);
+            setClosedModel(true);
     }
         
     int OxydStone::maxState() const {
@@ -963,8 +967,7 @@
     }
     
     void OxydStone::on_creation (GridPos p) {
-        std::string flavor(getDefaultedAttr("flavor", "a"));
-        set_model(string("st-oxyd") + flavor);
+        setClosedModel(true);
         activatePhoto();
         Stone::on_creation(p);
     }
@@ -984,6 +987,16 @@
         }
     }
     
+    void OxydStone::setClosedModel(bool isInitial) {
+        std::string flavor(getDefaultedAttr("flavor", "a"));
+        Value c = getAttr("oxydcolor");
+        if (flavor == "e" && !isInitial && (int)c != FAKE)
+            set_model(std::string("st-oxyd") + flavor + (std::string)c);
+        else
+            set_model(std::string("st-oxyd") + flavor);
+        
+    }
+    
     void OxydStone::tryOpen() {
         bool isSingleOpened = false;
         OxydStone *pairCandidate = NULL;
@@ -1081,13 +1094,17 @@
         int oldExtState = externalState();
         
         state = newState;
+        bool didShuffle = false;
+        bool didFart = false;
     
         switch (newState) {
             case CLOSED:
-                if ((int)getAttr("oxydcolor") == BOLD)
+                if ((int)getAttr("oxydcolor") == BOLD) {
                     shuffleColors();    // shuffle all closed oxyds including itself
-                    
-                set_model(string("st-oxyd")+flavor);
+                    didShuffle = true;
+                }
+                setClosedModel();
+//                set_model(string("st-oxyd")+flavor);
                 break;
         
             case OPEN_SINGLE:
@@ -1095,6 +1112,7 @@
                     set_anim(basemodelname + "-pseudo" + color);
                     if ((int)getAttr("oxydcolor") == FART) {
                         closeAllStandardOxyds();
+                        didFart = true;
                         sound_event("fart");
                     } else if ((int)getAttr("oxydcolor") == BOLD) {
                         sound_event("shuffle");
@@ -1141,7 +1159,9 @@
                 }
                 break;
         }
-        if (oldExtState != externalState() && (oldExtState != 1 || externalState() != 2))
+        // perform action
+        if (((int)getAttr("oxydcolor") > AUTO && oldExtState != externalState() && (oldExtState != 1 || externalState() != 2)) // avoid second action of paired oxyd that changes from single to pair open state
+                || didShuffle || didFart)
             performAction(externalState() != 0);
     }
     
@@ -1152,6 +1172,7 @@
         BootRegister(new OxydStone("b"), "st_oxyd_b");
         BootRegister(new OxydStone("c"), "st_oxyd_c");
         BootRegister(new OxydStone("d"), "st_oxyd_d");
+        BootRegister(new OxydStone("e"), "st_oxyd_e");
     BOOT_REGISTER_END
 
 } // namespace enigma

Modified: trunk/src/stones/OxydStone.hh
===================================================================
--- trunk/src/stones/OxydStone.hh	2008-12-07 00:43:53 UTC (rev 1387)
+++ trunk/src/stones/OxydStone.hh	2008-12-07 15:28:22 UTC (rev 1388)
@@ -187,6 +187,7 @@
 
 
         // Private methods
+        void setClosedModel(bool isInitial = false);
         void tryOpen();
         void closeAllStandardOxyds();
         void set_iState(iState newState);



From ral at mail.berlios.de  Sun Dec  7 16:35:41 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 7 Dec 2008 16:35:41 +0100
Subject: [Enigma-game-svn] r1389 - team_levelpacks/team_test_new_api
Message-ID: <200812071535.mB7FZfK3019507@sheep.berlios.de>

Author: ral
Date: 2008-12-07 16:35:02 +0100 (Sun, 07 Dec 2008)
New Revision: 1389

Added:
   team_levelpacks/team_test_new_api/ralT032_1.xml
Log:
Test Level new API:
- add demo level for new oxyd flavor e with peep holes



Added: team_levelpacks/team_test_new_api/ralT032_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT032_1.xml	2008-12-07 15:28:22 UTC (rev 1388)
+++ team_levelpacks/team_test_new_api/ralT032_1.xml	2008-12-07 15:35:02 UTC (rev 1389)
@@ -0,0 +1,58 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Oxyd Peep new API" el:subtitle="" el:id="20081207ral187"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2007 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+wo["MaxOxydColor"] = OXYD_BROWN
+
+ti[" "] = {"fl-sahara"}
+
+ti["1"] = {"#ac-blackball"}
+
+ti["x"] = {"st_oxyd_e"}
+ti["y"] = {"st_oxyd_e", "oo", oxydcolor=OXYD_BOLD}
+ti["f"] = {"st_fart"}
+ti["p"] = {"st_switch", target="oo", action="peepall"}
+
+
+w, h = wo(ti, " ", {
+"x  x  x  x  x       ",
+"                    ",
+"                   f",
+"x  x  x  x  x       ",
+"                    ",
+"                    ",
+"x  x  x  x  y  1   p",
+"                    ",
+"                    ",
+"x  x  x  x  x       ",
+"                    ",
+"                    ",
+"x  x  x  x  x       "
+})
+
+  
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT032_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From andreasl at mail.berlios.de  Mon Dec  8 00:46:57 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Mon, 8 Dec 2008 00:46:57 +0100
Subject: [Enigma-game-svn] r1390 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 data/gfx64 data/levels/enigma_experimental src
Message-ID: <200812072346.mB7NkvFu007832@sheep.berlios.de>

Author: andreasl
Date: 2008-12-08 00:46:47 +0100 (Mon, 08 Dec 2008)
New Revision: 1390

Added:
   trunk/data/gfx32/floor_frame.png
   trunk/data/gfx40/floor_frame.png
   trunk/data/gfx48/floor_frame.png
   trunk/data/gfx64/floor_frame.png
Modified:
   trunk/data/levels/enigma_experimental/floors_1.xml
   trunk/data/models-2d.lua
   trunk/data/models.lua
   trunk/data/startup.lua
   trunk/src/floors.cc
Log:
Trunk:
 - Added framed floors.
    - Removed "DefRandFloorSi", as it isn't of use anymore.
    - For level authors: Most floors (not all) now have
      framed versions, access them by adding "_framed"
      to their name.
 - Adapted "All Floors" level accordingly.
 - Degraded fl-stwood to become a simple floor
    - Side effect: modify_kind doesn't work on fl-stwood
      anymore. But hasn't been used anyway.
    - For a short time only, "fl-stwood[1/2]_framed" is
      available to see the slight difference of the old
      and new frame: The old one was of a higher contrast,
      and darker.
 - Fix r1386: fl-space-force now has its image back.
Note:
 - If you want to switch frames for a floor on and off,
   you currently have to do this in two locations:
   models-2d.lua for the graphics, startup.lua for the
   actual floor.


Added: trunk/data/gfx32/floor_frame.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/floor_frame.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx40/floor_frame.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/floor_frame.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx48/floor_frame.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/floor_frame.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx64/floor_frame.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx64/floor_frame.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/data/levels/enigma_experimental/floors_1.xml
===================================================================
--- trunk/data/levels/enigma_experimental/floors_1.xml	2008-12-07 15:35:02 UTC (rev 1389)
+++ trunk/data/levels/enigma_experimental/floors_1.xml	2008-12-07 23:46:47 UTC (rev 1390)
@@ -15,7 +15,7 @@
     <el:luamain><![CDATA[
 -- GENERAL --
 levelh = 13
-levelw = 100
+levelw = 120
 
 create_world(levelw, levelh)
 enigma.ConserveLevel = TRUE
@@ -29,36 +29,148 @@
 fill_floor(floor, 0,0,levelw,levelh)
 
 -- STONES --
-draw_border(wall)
+--draw_border(wall)
 
 -- ITEMS --
-set_item("it-document", 10, 6, {text="text1"})
+set_item("it-document", 10, 5, {text="text1"})
 
 -- ACTORS --
-set_actor("ac-blackball", 4.5,4.5, {player=0})
-set_actor("ac-whiteball", 6.5,4.5, {player=1})
-set_item("it-yinyang",4,4)
-set_item("it-yinyang",6,4)
+set_actor("ac-blackball", 4.5,3.5, {player=0})
+set_actor("ac-whiteball", 6.5,3.5, {player=1})
+set_item("it-yinyang",4,3)
+set_item("it-yinyang",6,3)
 
 -- Funktionen
 -- VARS
-floorlist={"fl-abyss_fake", "fl-black", "fl-bluegray", "fl-bluegreen", "fl-bluegreenx", "fl-brick", "fl-bumps", "fl-concrete", "fl-darkgray", "fl-dunes", "fl-floor_001", "fl-gravel", "fl-gray", "fl-hay", "fl-himalaya", "fl-leaves", "fl-leavesb", "fl-leavesc1", "fl-leavesc2", "fl-leavesc3", "fl-leavesc4", "fl-leavesd1", "fl-leavesd2", "fl-leavesd3", "fl-leavesd4", "fl-leavese1", "fl-leavese2", "fl-leavese3", "fl-leavese4", "fl-light", "fl-lightgray", "fl-marble", "fl-metal1", "fl-metal2", "fl-metal3", "fl-metal4", "fl-metal5", "fl-metal6", "fl-mortar", "fl-normal", "fl-normal_x", "fl-plank", "fl-red", "fl-rock", "fl-rough", "fl-rough_medium", "fl-rough_slow", "fl-rough-blue", "fl-rough-red", "fl-sahara", "fl-samba", "fl-samba1", "fl-samba2", "fl-sand", "fl-springboard", "fl-stone", "fl-stwood", "fl-stwood1", "fl-stwood2", "fl-tigris", "fl-trigger", "fl-white", "fl-wood", "fl-woven", "fl-abyss", "fl-acblack", "fl-acwhite", "fl-bridge-closed", "fl-gradient1", "fl-gradient2", "!
 fl-gradient3", "fl-gradient4", "fl-gradient5", "fl-gradient6", "fl-gradient7", "fl-gradient8", "fl-gradient9", "fl-gradient10", "fl-gradient11", "fl-gradient12", "fl-gradient13", "fl-gradient14", "fl-gradient15", "fl-gradient16", "fl-ice", "fl-inverse", "fl-inverse2", "fl-nomouse", "fl-space", "fl-space-force", "fl-swamp", "fl-thief", "fl-water"}
+    floorlist = {
+        -- The first two sections are copied from models-2d.lua,
+        -- except for "fl_abyss", which has been replaced by "fl_abyss_fake".
+        -- (see below for "fl_abyss")
+        -- single
+        {"fl-abyss_fake", noframe = true},
+        {"fl-acblack", noframe = true},
+        {"fl-acwhite", noframe = true},
+        {"fl-black"},
+        {"fl-bluegreen"},
+        {"fl-darkgray"},
+        {"fl-dummy", noframe = true},
+        {"fl-dunes"},
+        {"fl-floor_001"},
+        {"fl_ice", noframe = true},
+        {"fl-inverse", noframe = true},
+        {"fl-inverse2", noframe = true},
+        {"fl-light"},
+        {"fl-lightgray"},
+        {"fl-nomouse", noframe = true},
+        {"fl-normal"},
+        {"fl-sand"},
+        {"fl-stone"},
+        {"fl-springboard"},
+        {"fl-trigger"},
+        {"fl-white"},
+        -- multiple, with height and width (or 1)
+        {"fl-bluegray", 4},
+        {"fl-bluegreenx", 2},
+        {"fl-brick", 3},
+        {"fl-bumps", 2, 2},
+        {"fl-concrete", 4},
+        {"fl-gravel", 4},
+        {"fl-gray", 5},
+        {"fl-hay", 4},
+        {"fl-himalaya", 4},
+        {"fl-marble", 4},
+        {"fl-metal", 6},
+        {"fl-mortar", 2, 2},
+        {"fl-plank", 4},
+        {"fl-red", 4},
+        {"fl-rock", 2},
+        {"fl-rough", 5},
+        {"fl-rough-blue", 4},
+        {"fl-rough-red", 4},
+        {"fl-sahara", 4},
+        {"fl-samba", 2},
+        {"fl_space", 3, 2, noframe = true},
+        {"fl-stwood", 2},
+        {"fl_swamp", 4, noframe = true},
+        {"fl-tigris", 4},
+        {"fl_water", 4, noframe = true},
+        {"fl-woven", 5},
+        -- Additional floors
+        {"fl-leaves", noframe = true},
+        {"fl-leavesb", noframe = true},
+        {"fl-leavesc1", noframe = true},
+        {"fl-leavesc2", noframe = true},
+        {"fl-leavesc3", noframe = true},
+        {"fl-leavesc4", noframe = true},
+        {"fl-leavesd1", noframe = true},
+        {"fl-leavesd2", noframe = true},
+        {"fl-leavesd3", noframe = true},
+        {"fl-leavesd4", noframe = true},
+        {"fl-leavese1", noframe = true},
+        {"fl-leavese2", noframe = true},
+        {"fl-leavese3", noframe = true},
+        {"fl-leavese4", noframe = true},
+        {"fl-metal1"},
+        {"fl-metal2"},
+        {"fl-metal3"},
+        {"fl-metal4"},
+        {"fl-metal5"},
+        {"fl-metal6"},
+        {"fl-normal_x"},
+        {"fl-rough_medium"},
+        {"fl-rough_slow"},
+        {"fl-samba1"},
+        {"fl-samba2"},
+        {"fl-stwood1"},
+        {"fl-stwood2"},
+        {"fl-wood", noframe = true},
+        {"fl-wood1", noframe = true},
+        {"fl-wood2", noframe = true},
+        {"fl-abyss", noframe = true},
+        {"fl-acblack", noframe = true},
+        {"fl-acwhite", noframe = true},
+        {"fl-bridge-closed", noframe = true},
+        {"fl-gradient1", noframe = true},
+        {"fl-gradient2", noframe = true},
+        {"fl-gradient3", noframe = true},
+        {"fl-gradient4", noframe = true},
+        {"fl-gradient5", noframe = true},
+        {"fl-gradient6", noframe = true},
+        {"fl-gradient7", noframe = true},
+        {"fl-gradient8", noframe = true},
+        {"fl-gradient9", noframe = true},
+        {"fl-gradient10", noframe = true},
+        {"fl-gradient11", noframe = true},
+        {"fl-gradient12", noframe = true},
+        {"fl-gradient13", noframe = true},
+        {"fl-gradient14", noframe = true},
+        {"fl-gradient15", noframe = true},
+        {"fl-gradient16", noframe = true},
+        {"fl-inverse", noframe = true},
+        {"fl-inverse2", noframe = true},
+        {"fl-space-force", noframe = true},
+        {"fl-thief", noframe = true}        
+    }
+    
+------
 
-------
 nr=1
 for i=1,table.getn(floorlist) do
-      nr = nr+1
-      set_stone("st-switch",1+i,3, {action="callback", target="sw"..nr, name="switch"..nr})
-      func = "function sw"..nr.."() flnr="..i.."; setfloor(flnr) ; end"
-      dostring(func)
+    nr = nr+1
+    set_stone("st-switch", 1 + i, 2, {action="callback", target="sw"..nr, name="switch"..nr})
+    func = "function sw"..nr.."() flnr="..i.."; setfloor(flnr) ; end"
+    dostring(func)
 end
 
 function setfloor(flnr)
- floor=floorlist[flnr]
- fldo=floorlist[flnr]
- draw_floor(floor,{1+flnr,5},{0,1},5)
- set_item("it-document", 1+flnr, 1, {text=fldo})
+    local floor = floorlist[flnr]
+    draw_floor(floor[1], {1 + flnr, 4}, {0, 1}, 8)
+    if not floorlist[flnr].noframe then
+        draw_floor(floor[1].."_framed", {1 + flnr, 8}, {0, 1}, 4)
+    end
+    set_item("it-document", 1 + flnr, 0, {text = floor[1]})
 end
+
     ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-12-07 15:35:02 UTC (rev 1389)
+++ trunk/data/models-2d.lua	2008-12-07 23:46:47 UTC (rev 1390)
@@ -227,70 +227,103 @@
 --------------------------------------------------------------------------------
 Progress(15, "Loading floor models")
 
-------------------------
--- single tile floors --
-------------------------
+-------------------
+-- floor borders --
+-------------------
 do
+    DefImage("floor_frame")
+end
+
+-------------------------------------------------------
+-- simple tile floors (single and multiple (random)) --
+-------------------------------------------------------
+do
     floorlist = {
-        "fl_abyss",
-        "fl-acblack",
-        "fl-acwhite",
-        "fl-black",
-        "fl-bluegreen",
-        "fl-darkgray",
-        "fl-dummy",
-        "fl-dunes",
-        "fl-floor_001",
-        "fl_ice",
-        "fl-inverse",
-        "fl-inverse2",
-        "fl-light",
-        "fl-lightgray",
-        "fl-nomouse",
-        "fl-normal",
-        "fl-sand",
-        "fl-stone",
-        "fl-springboard",
-        "fl-trigger",
-        "fl-white",
+        -- single
+        {"fl_abyss", noframe = true},
+        {"fl-acblack", noframe = true},
+        {"fl-acwhite", noframe = true},
+        {"fl-black"},
+        {"fl-bluegreen"},
+        {"fl-darkgray"},
+        {"fl-dummy", noframe = true},
+        {"fl-dunes"},
+        {"fl-floor_001"},
+        {"fl_ice", noframe = true},
+        {"fl-inverse", noframe = true},
+        {"fl-inverse2", noframe = true},
+        {"fl-light"},
+        {"fl-lightgray"},
+        {"fl-nomouse", noframe = true},
+        {"fl-normal"},
+        {"fl-sand"},
+        {"fl-stone"},
+        {"fl-springboard"},
+        {"fl-trigger"},
+        {"fl-white"},
+        -- multiple, with height and width (or 1)
+        {"fl-bluegray", 4},
+        {"fl-bluegreenx", 2},
+        {"fl-brick", 3},
+        {"fl-bumps", 2, 2},
+        {"fl-concrete", 4},
+        {"fl-gravel", 4},
+        {"fl-gray", 5},
+        {"fl-hay", 4},
+        {"fl-himalaya", 4},
+        {"fl-marble", 4},
+        {"fl-metal", 6},
+        {"fl-mortar", 2, 2},
+        {"fl-plank", 4},
+        {"fl-red", 4},
+        {"fl-rock", 2},
+        {"fl-rough", 5},
+        {"fl-rough-blue", 4},
+        {"fl-rough-red", 4},
+        {"fl-sahara", 4},
+        {"fl-samba", 2},
+        {"fl_space", 3, 2, noframe = true},
+        {"fl-stwood", 2},
+        {"fl_swamp", 4, noframe = true},
+        {"fl-tigris", 4},
+        {"fl_water", 4, noframe = true},
+        {"fl-woven", 5},
     }
 
-    DefImages(floorlist)
+    for _, floor in pairs(floorlist) do
+        local basename = floor[1]
+        local height = floor[2] or 1
+        local width = floor[3] or 1
+        if (height == 1) and (width == 1) then
+            -- single floor
+            DefImage(basename)
+            if not floor.noframe then
+                display.DefineComposite(basename .. "_framed", basename, "floor_frame")
+            end
+        else
+            -- multiple (random) floor
+            local imagelist = DefSubimages(basename, {h = height, w = width})
+            display.DefineRandModel(basename, getn(imagelist), imagelist)
+            if not floor.noframe then
+                local framedlist = {}
+                for _, subimage in pairs(imagelist) do
+                    display.DefineComposite(subimage .. "_framed", subimage, "floor_frame")
+                    table.insert(framedlist, subimage .. "_framed")
+                end
+                display.DefineRandModel(basename .. "_framed", getn(framedlist), framedlist)
+            end
+        end
+    end
 end
 
 
 -----------------------------------------
--- Floors with multiple (random) tiles --
+-- Special Floors
 -----------------------------------------
+
+-- gradients
 do
     DefSubimages("fl-gradient2", {w=6, h=4, modelname="fl-gradient"})
-
-    DefRandFloorSi("fl-bluegray", 4)
-    DefRandFloorSi("fl-bluegreenx", 2)
-    DefRandFloorSi("fl-brick", 3)
-    DefRandFloorSi("fl-bumps", 2,2)
-    DefRandFloorSi("fl-concrete", 4)
-    DefRandFloorSi("fl-gravel", 4)
-    DefRandFloorSi("fl-gray", 5)
-    DefRandFloorSi("fl-hay", 4)
-    DefRandFloorSi("fl-himalaya", 4)
-    DefRandFloorSi("fl-marble", 4)
-    DefRandFloorSi("fl-metal", 6)
-    DefRandFloorSi("fl-mortar", 2, 2)
-    DefRandFloorSi("fl-plank", 4)
-    DefRandFloorSi("fl-red", 4)
-    DefRandFloorSi("fl-rock", 2)
-    DefRandFloorSi("fl-rough", 5)
-    DefRandFloorSi("fl-rough-blue", 4)
-    DefRandFloorSi("fl-rough-red", 4)
-    DefRandFloorSi("fl-sahara", 4)
-    DefRandFloorSi("fl-samba", 2)
-    DefRandFloorSi("fl_space", 3,2)
-    DefRandFloorSi("fl-stwood", 2)
-    DefRandFloorSi("fl_swamp", 4)
-    DefRandFloorSi("fl-tigris", 4)
-    DefRandFloorSi("fl_water", 4)
-    DefRandFloorSi("fl-woven", 5)
 end
 
 -- leaves --
@@ -324,11 +357,14 @@
 -- Simple floor aliases --
 --------------------------
 do
-    DefAlias("fl-abyss_fake", "fl-abyss")
+    DefAlias("fl-abyss_fake", "fl_abyss")
     DefAlias("fl-normal_x", "fl-normal")
+    DefAlias("fl-normal_x_framed", "fl-normal_framed")
     DefAlias("fl-rough_medium", "fl-rough")
+    DefAlias("fl-rough_medium_framed", "fl-rough_framed")
     DefAlias("fl-rough_slow", "fl-rough")
-    DefAlias("fl-space-force", "fl-space")
+    DefAlias("fl-rough_slow_framed", "fl-rough_framed")
+    DefAlias("fl-space-force", "fl_space")
 end
 
 ----------------------

Modified: trunk/data/models.lua
===================================================================
--- trunk/data/models.lua	2008-12-07 15:35:02 UTC (rev 1389)
+++ trunk/data/models.lua	2008-12-07 23:46:47 UTC (rev 1390)
@@ -338,13 +338,6 @@
     display.DefineRandModel(name, getn(imagelist), imagelist)
 end
 
--- Defines a random floor tile out of a given image with multiple tiles.
--- This is used for the most kinds of floors.
-function DefRandFloorSi(name, height, width)
-    imagelist = DefSubimages(name, {h=height, w=width})
-    display.DefineRandModel(name, getn(imagelist), imagelist)
-end
-
 ---------------------------------
 --   Stone related Functions   --
 ---------------------------------

Modified: trunk/data/startup.lua
===================================================================
--- trunk/data/startup.lua	2008-12-07 15:35:02 UTC (rev 1389)
+++ trunk/data/startup.lua	2008-12-07 23:46:47 UTC (rev 1390)
@@ -173,77 +173,83 @@
 ------------------------------
 -- Define the simple floors --
 ------------------------------
-function def_floor(name, frict, mfactor, burnable, firetransform)
+function def_floor(name, frict, mfactor, burnable, firetransform, frames)
     world.DefineSimpleFloor(name, frict, mfactor, burnable, firetransform)
+    if frames then
+        world.DefineSimpleFloor(name.."_framed", frict, mfactor, burnable, firetransform)    
+    end
 end
 
--- Floor(kind, friction, mousefactor, burnable, firetransform)
-def_floor("fl-bluegray",     4.5,   1.5,    true,   "")
-def_floor("fl-bluegreen",    6.0,   2.0,    true,   "")
-def_floor("fl-bluegreenx",   0.4,   1.0,    true,   "")
-def_floor("fl-brick",        3.5,   2.0,   false,   "")
-def_floor("fl-bumps",        5.0,   1.2,   false,   "")
-def_floor("fl-concrete",     4.5,   1.3,   false,   "")
-def_floor("fl-dunes",        1.3,   1.0,   false,   "")
-def_floor("fl-floor_001",    1.5,   2.5,    true,   "fl-abyss")
-def_floor("fl-gravel",       3.2,   1.5,   false,   "")
-def_floor("fl-gray",         5.0,   3.0,   false,   "")
-def_floor("fl-hay",          5.0,   1.5,    true,   "")
-def_floor("fl-himalaya",     5.0,   2.0,   false,   "")
-def_floor("fl-inverse",      3.0,  -2.0,   false,   "")
-def_floor("fl-inverse2",     3.0,  -2.0,   false,   "")
-def_floor("fl-leaves",       4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavesb",      4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavesc1",     4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavesc2",     4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavesc3",     4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavesc4",     4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavesd1",     4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavesd2",     4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavesd3",     4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavesd4",     4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavese1",     4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavese2",     4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavese3",     4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-leavese4",     4.0,   1.5,    true,   "fl-dunes")
-def_floor("fl-light",        2.2,   1.6,    true,   "")
-def_floor("fl-lightgray",    3.0,   1.6,    true,   "")
-def_floor("fl-darkgray",     3.0,   1.6,   false,   "")
-def_floor("fl-marble",       6.4,   2.0,    true,   "")
-def_floor("fl-metal",        3.0,   2.0,   false,   "")
-def_floor("fl-metal1",       3.0,   2.0,   false,   "")
-def_floor("fl-metal2",       3.0,   2.0,   false,   "")
-def_floor("fl-metal3",       3.0,   2.0,   false,   "")
-def_floor("fl-metal4",       3.0,   2.0,   false,   "")
-def_floor("fl-metal5",       3.0,   2.0,   false,   "")
-def_floor("fl-metal6",       3.0,   2.0,   false,   "")
-def_floor("fl-mortar",       7.2,   1.8,   false,   "")
-def_floor("fl-normal",       4.0,   2.0,   false,   "")
-def_floor("fl-normal_x",     3.0,   2.0,   false,   "")
-def_floor("fl-plank",        5.5,   2.0,    true,   "fl-abyss")
-def_floor("fl-red",          0.9,   1.0,    true,   "")
-def_floor("fl-rock",         6.5,   2.2,   false,   "")
-def_floor("fl-rough",        7.0,   2.0,    true,   "")
-def_floor("fl-rough_medium", 5.0,   1.2,    true,   "")
-def_floor("fl-rough_slow",   7.0,   0.5,    true,   "")
-def_floor("fl-rough-blue",   7.0,   2.0,    true,   "")
-def_floor("fl-rough-red",    7.0,   2.0,    true,   "")
-def_floor("fl-sahara",       6.4,   2.0,   false,   "")
-def_floor("fl-samba",        6.0,   2.0,    true,   "fl-abyss")
-def_floor("fl-samba1",       6.0,   2.0,    true,   "fl-abyss")
-def_floor("fl-samba2",       6.0,   2.0,    true,   "fl-abyss")
-def_floor("fl-sand",         6.0,   2.0,   false,   "")
-def_floor("fl_space",        0.0,   0.0,   false,   "")
-def_floor("fl-springboard",  4.0,   2.0,   false,   "")
-def_floor("fl-stone",        1.4,   1.0,   false,   "")
-def_floor("fl-tigris",       6.0,   2.0,    true,   "")
-def_floor("fl-wood",         6.4,   2.0,    true,   "fl-abyss")
-def_floor("fl-wood1",        6.4,   2.0,    true,   "fl-abyss")
-def_floor("fl-wood2",        6.4,   2.0,    true,   "fl-abyss")
-def_floor("fl-woven",        6.5,   3.0,    true,   "")
-def_floor("fl-nomouse",      2.5,   0.0,    true,   "")
-def_floor("fl-black",        3.0,   1.5,   false,   "")
-def_floor("fl-white",        3.0,   1.5,   false,   "")
-def_floor("fl-trigger",      3.0,   1.5,    true,   "")
-def_floor("fl-abyss_fake",   3.0,   2.0,   false,   "")
+-- Floor(kind, friction, mousefactor, burnable, firetransform, frames)
+def_floor("fl-bluegray",     4.5,   1.5,    true,   "",         true)
+def_floor("fl-bluegreen",    6.0,   2.0,    true,   "",         true)
+def_floor("fl-bluegreenx",   0.4,   1.0,    true,   "",         true)
+def_floor("fl-brick",        3.5,   2.0,   false,   "",         true)
+def_floor("fl-bumps",        5.0,   1.2,   false,   "",         true)
+def_floor("fl-concrete",     4.5,   1.3,   false,   "",         true)
+def_floor("fl-dunes",        1.3,   1.0,   false,   "",         true)
+def_floor("fl-floor_001",    1.5,   2.5,    true,   "fl-abyss", true)
+def_floor("fl-gravel",       3.2,   1.5,   false,   "",         true)
+def_floor("fl-gray",         5.0,   3.0,   false,   "",         true)
+def_floor("fl-hay",          5.0,   1.5,    true,   "",         true)
+def_floor("fl-himalaya",     5.0,   2.0,   false,   "",         true)
+def_floor("fl-inverse",      3.0,  -2.0,   false,   "",         false)
+def_floor("fl-inverse2",     3.0,  -2.0,   false,   "",         false)
+def_floor("fl-leaves",       4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavesb",      4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavesc1",     4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavesc2",     4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavesc3",     4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavesc4",     4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavesd1",     4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavesd2",     4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavesd3",     4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavesd4",     4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavese1",     4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavese2",     4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavese3",     4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-leavese4",     4.0,   1.5,    true,   "fl-dunes", false)
+def_floor("fl-light",        2.2,   1.6,    true,   "",         true)
+def_floor("fl-lightgray",    3.0,   1.6,    true,   "",         true)
+def_floor("fl-darkgray",     3.0,   1.6,   false,   "",         true)
+def_floor("fl-marble",       6.4,   2.0,    true,   "",         true)
+def_floor("fl-metal",        3.0,   2.0,   false,   "",         true)
+def_floor("fl-metal1",       3.0,   2.0,   false,   "",         true)
+def_floor("fl-metal2",       3.0,   2.0,   false,   "",         true)
+def_floor("fl-metal3",       3.0,   2.0,   false,   "",         true)
+def_floor("fl-metal4",       3.0,   2.0,   false,   "",         true)
+def_floor("fl-metal5",       3.0,   2.0,   false,   "",         true)
+def_floor("fl-metal6",       3.0,   2.0,   false,   "",         true)
+def_floor("fl-mortar",       7.2,   1.8,   false,   "",         true)
+def_floor("fl-normal",       4.0,   2.0,   false,   "",         true)
+def_floor("fl-normal_x",     3.0,   2.0,   false,   "",         true)
+def_floor("fl-plank",        5.5,   2.0,    true,   "fl-abyss", true)
+def_floor("fl-red",          0.9,   1.0,    true,   "",         true)
+def_floor("fl-rock",         6.5,   2.2,   false,   "",         true)
+def_floor("fl-rough",        7.0,   2.0,    true,   "",         true)
+def_floor("fl-rough_medium", 5.0,   1.2,    true,   "",         true)
+def_floor("fl-rough_slow",   7.0,   0.5,    true,   "",         true)
+def_floor("fl-rough-blue",   7.0,   2.0,    true,   "",         true)
+def_floor("fl-rough-red",    7.0,   2.0,    true,   "",         true)
+def_floor("fl-sahara",       6.4,   2.0,   false,   "",         true)
+def_floor("fl-samba",        6.0,   2.0,    true,   "fl-abyss", true)
+def_floor("fl-samba1",       6.0,   2.0,    true,   "fl-abyss", true)
+def_floor("fl-samba2",       6.0,   2.0,    true,   "fl-abyss", true)
+def_floor("fl-sand",         6.0,   2.0,   false,   "",         true)
+def_floor("fl_space",        0.0,   0.0,   false,   "",         false)
+def_floor("fl-springboard",  4.0,   2.0,   false,   "",         true)
+def_floor("fl-stone",        1.4,   1.0,   false,   "",         true)
+def_floor("fl-stwood",       6.4,   2.0,    true,   "fl-abyss", true)
+def_floor("fl-stwood1",      6.4,   2.0,    true,   "fl-abyss", true)
+def_floor("fl-stwood2",      6.4,   2.0,    true,   "fl-abyss", true)
+def_floor("fl-tigris",       6.0,   2.0,    true,   "",         true)
+def_floor("fl-wood",         6.4,   2.0,    true,   "fl-abyss", false)
+def_floor("fl-wood1",        6.4,   2.0,    true,   "fl-abyss", false)
+def_floor("fl-wood2",        6.4,   2.0,    true,   "fl-abyss", false)
+def_floor("fl-woven",        6.5,   3.0,    true,   "",         true)
+def_floor("fl-nomouse",      2.5,   0.0,    true,   "",         false)
+def_floor("fl-black",        3.0,   1.5,   false,   "",         true)
+def_floor("fl-white",        3.0,   1.5,   false,   "",         true)
+def_floor("fl-trigger",      3.0,   1.5,    true,   "",         true)
+def_floor("fl-abyss_fake",   3.0,   2.0,   false,   "",         false)
 

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2008-12-07 15:35:02 UTC (rev 1389)
+++ trunk/src/floors.cc	2008-12-07 23:46:47 UTC (rev 1390)
@@ -540,25 +540,6 @@
         }
     };
 
-/* -------------------- FallenBox -------------------- */
-
-    class FallenBox : public Floor {
-        CLONEOBJ(FallenBox);
-    public:
-        FallenBox(const char *kind)
-        :  Floor(kind, 6.4, 2.0, flf_default, flft_burnable, "fl_abyss")
-        // uses same traits as fl-wood
-        {}
-
-    private:
-        const char *modify_kind(const char *kind) {
-            if (0 == strcmp(kind, "fl-stwood")) {
-                return enigma::IntegerRand(0, 1) ? "fl-stwood1" :  "fl-stwood2";
-            }
-            return kind;
-        }
-    };
-
 /* -------------------- DummyFloor -------------------- */
 
     class DummyFloor : public Floor {
@@ -854,9 +835,6 @@
     Register(new Water);
     Register(new Swamp);
     Register(new DummyFloor);
-    Register(new FallenBox("fl-stwood"));
-    Register(new FallenBox("fl-stwood1"));
-    Register(new FallenBox("fl-stwood2"));
     Register(new Thief);
     Register(new WhiteTile);
     Register(new BlackTile);



From raoulb at bluewin.ch  Fri Dec 12 23:17:46 2008
From: raoulb at bluewin.ch (Raoul)
Date: Fri, 12 Dec 2008 23:17:46 +0100
Subject: [Enigma-game-svn] r1391 - in trunk
Message-ID: <20081212231746.1b803cce@amarok.loinet.zh>

-> New api object renaming for fl-{water,swamp,abyss,space}
-> Removed last depreceated "Require()"


From ral at mail.berlios.de  Sat Dec 13 15:14:24 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 13 Dec 2008 15:14:24 +0100
Subject: [Enigma-game-svn] r1392 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 data/schemas src src/floors src/stones
Message-ID: <200812131414.mBDEEOUm017209@sheep.berlios.de>

Author: ral
Date: 2008-12-13 15:14:22 +0100 (Sat, 13 Dec 2008)
New Revision: 1392

Added:
   trunk/data/gfx32/fl_hay.png
   trunk/data/gfx32/fl_rock.png
   trunk/data/gfx40/fl_hay.png
   trunk/data/gfx40/fl_rock.png
   trunk/data/gfx48/fl_hay.png
   trunk/data/gfx48/fl_rock.png
   trunk/src/floors/FloodStream.cc
   trunk/src/floors/FloodStream.hh
Removed:
   trunk/data/gfx32/fl-hay.png
   trunk/data/gfx32/fl-rock.png
   trunk/data/gfx40/fl-hay.png
   trunk/data/gfx40/fl-rock.png
   trunk/data/gfx48/fl-hay.png
   trunk/data/gfx48/fl-rock.png
Modified:
   trunk/data/api1init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/data/startup.lua
   trunk/src/Makefile.am
   trunk/src/WorldProxy.cc
   trunk/src/enigma-lua.pkg
   trunk/src/floors.cc
   trunk/src/floors.hh
   trunk/src/floors/BridgeFloor.cc
   trunk/src/lua-display.cc
   trunk/src/lua-display.hh
   trunk/src/lua-ecl.cc
   trunk/src/lua-ecl.hh
   trunk/src/lua-editor.cc
   trunk/src/lua-editor.hh
   trunk/src/lua-enigma.cc
   trunk/src/lua-enigma.hh
   trunk/src/lua-global.cc
   trunk/src/lua-global.hh
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/server.cc
   trunk/src/server.hh
   trunk/src/stones.hh
   trunk/src/stones/Door.cc
   trunk/src/stones/Door.hh
   trunk/src/stones/FloorBuilder.cc
   trunk/src/stones/FloorBuilder.hh
   trunk/src/stones/WindowStone.cc
   trunk/src/stones/WindowStone.hh
Log:
Trunk 1.1: new API reengineering
- floor preparation for declartion in objects.xml instead of startup.lua
- object declarations for floors: swamp, space, abyss, ice, fixes for bridge
- floodstream floors: 
  fl_water, fl_water_source, fl_hay, fl_hay_framed, fl_rock, fl_rock_framed,
  fl_wood, fl_wood_h, fl_wood_v, fl_wood_framed, fl_wood_framed_h and _v
 - water and these framed floors, as created by floorbuilding stones, do
   represent flooded areas
 - all floors do support new attribute "floodable", default false
 - flood activation by state FLOODING on water or framed floodstream floors
 - fl_water_source is water in state FLOODING
 - attribute "interval" on floodstream floors determines speed
 - flood spreads on floodable areas and over water and framed floodstream floors
 - flood is stopped by stones that deny spreading: all stones besides floating
   onces and open doors and windows on sides without faces
 - floorbuilder stones will fall on flood but will not stop flood
 - flood continues when obstacle is removed, e.g. movable stone pushed away,
   door opened, window face broken or pulled
- remove unused and depreceated global attribute "IceFriction"
- no new API access from Lua to depreceated global attribute "FlatForce"
- fix memory smasher on heating animation


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/data/api1init.lua	2008-12-13 14:14:22 UTC (rev 1392)
@@ -47,10 +47,18 @@
 RenamingObjectsNew2Old = {
     fl_abyss = "fl-abyss",
     fl_bridge = "fl-bridge",
+    fl_hay = "fl-hay",
     fl_ice = "fl-ice",
+    fl_rock = "fl-rock",
     fl_space = "fl-space",
     fl_swamp = "fl-swamp",
     fl_water = "fl-water",
+    fl_wood = "fl-wood",
+    fl_wood_h = "fl-wood1",
+    fl_wood_v = "fl-wood2",
+    fl_wood_framed = "fl-stwood",
+    fl_wood_framed_h = "fl-stwood1",
+    fl_wood_framed_v = "fl-stwood2",
     it_blocker = "it-blocker",
     it_blocker_new = "it-blocker-new",
     it_brake = "it-brake",

Deleted: trunk/data/gfx32/fl-hay.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-rock.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/fl_hay.png (from rev 1390, trunk/data/gfx32/fl-hay.png)

Copied: trunk/data/gfx32/fl_rock.png (from rev 1390, trunk/data/gfx32/fl-rock.png)

Deleted: trunk/data/gfx40/fl-hay.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-rock.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/fl_hay.png (from rev 1390, trunk/data/gfx40/fl-hay.png)

Copied: trunk/data/gfx40/fl_rock.png (from rev 1390, trunk/data/gfx40/fl-rock.png)

Deleted: trunk/data/gfx48/fl-hay.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-rock.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/fl_hay.png (from rev 1390, trunk/data/gfx48/fl-hay.png)

Copied: trunk/data/gfx48/fl_rock.png (from rev 1390, trunk/data/gfx48/fl-rock.png)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/data/models-2d.lua	2008-12-13 14:14:22 UTC (rev 1392)
@@ -269,14 +269,14 @@
         {"fl-concrete", 4},
         {"fl-gravel", 4},
         {"fl-gray", 5},
-        {"fl-hay", 4},
+        {"fl_hay", 4},
         {"fl-himalaya", 4},
         {"fl-marble", 4},
         {"fl-metal", 6},
         {"fl-mortar", 2, 2},
         {"fl-plank", 4},
         {"fl-red", 4},
-        {"fl-rock", 2},
+        {"fl_rock", 2},
         {"fl-rough", 5},
         {"fl-rough-blue", 4},
         {"fl-rough-red", 4},
@@ -351,6 +351,13 @@
     DefRandFloor("fl-wood", {"fl-woodx1", "fl-woodx2", "fl-woodx3", "fl-woodx4"})
     DefRandFloor("fl-wood1", {"fl-woodx3", "fl-woodx4"})
     DefRandFloor("fl-wood2", {"fl-woodx1", "fl-woodx2"})
+    
+    DefAlias("fl_wood", "fl-wood")
+    DefAlias("fl_wood1", "fl-wood1")
+    DefAlias("fl_wood2", "fl-wood2")
+    DefAlias("fl_wood_framed", "fl-stwood")
+    DefAlias("fl_wood_framed1", "fl-stwood1")
+    DefAlias("fl_wood_framed2", "fl-stwood2")
 end
 
 --------------------------

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/data/schemas/objects.xml	2008-12-13 14:14:22 UTC (rev 1392)
@@ -7,7 +7,7 @@
     <attr name="anchor1" type="tokens" default="nil" rw="rw"/>
     <attr name="anchor2" type="tokens" default="nil" rw="rw"/>
     <attr name="autoclose" type="bool" default="false" rw="rw"/>
-    <attr name="burnable" type="bool" default="false" rw="rw"/>
+    <attr name="burnable" type="bool" default="nil" rw="rw"/>
     <attr name="cluster" type="int" default="nil" min="0" max="9" rw="rw"/>
     <attr name="code" type="int" default="1" rw="rw"/>
     <attr name="coin_value" type="double" default="1" rw="rw"/>
@@ -22,6 +22,7 @@
     <attr name="fastfire" type="bool" default="false" rw="rw"/>
     <attr name="fellows" type="group" default="nil" rw="r"/>
     <attr name="flavor" type="string" default="b" rw="rw"/>
+    <attr name="floodable" type="bool" default="false" rw="rw"/>
     <attr name="freeze_check" type="bool" default="false" rw="rw"/>
     <attr name="friction" type="double" default="nil" rw="rw"/>
     <attr name="gradient" type="double" default="nil" rw="rw"/>
@@ -68,6 +69,8 @@
     <attr name="transparent" type="bool" default="false" rw="rw"/>
     <attr name="threshold" type="double" default="0" rw="rw"/>
     <attr name="wires" type="group" default="nil" rw="r"/>
+    <attr name="$firetransform" type="string" default="" rw=""/>
+    <attr name="$heattransform" type="string" default="" rw=""/>
   </attributes>
   <messages>
     <msg name="close" type="nil"/>
@@ -106,6 +109,7 @@
     <msg name="_bombstone" type="nil"/>
     <msg name="_brush" type="nil"/>
     <msg name="_capture" type="nil"/>
+    <msg name="_checkflood" type="nil"/>
     <msg name="_explosion" type="nil"/>
     <msg name="_freeze" type="nil"/>
     <msg name="_glasses" type="nil"/>
@@ -143,6 +147,7 @@
       <attr name="burnable"/>
       <attr name="eternal"/>
       <attr name="fastfire"/>
+      <attr name="floodable"/>
       <attr name="freeze_check"/>
       <attr name="friction"/>
       <attr name="ignitable"/>
@@ -156,8 +161,23 @@
       <msg name="setfire"/>
       <msg name="stopfire"/>
     </object>
+    <object name="fl_floodstream" abstract="true">
+      <attr name="faces"/>
+      <attr name="interval" default="0.5"/>
+      <msg name="_init"/>
+      <msg name="_checkflood"/>
+    </object>
+    <object name="fl_abyss">
+      <attr name="friction" default="2.0"/>
+      <attr name="adhesion" default="1.0"/>
+      <attr name="noash" default="true"/>
+    </object>
     <object name="fl_bridge">
       <attr name="flavor" default="gc"/>
+      <attr name="friction" default="5.0"/>
+      <attr name="adhesion" default="1.0"/>
+      <attr name="noash" default="true"/>
+      <attr name="$firetransform" default="fl_abyss"/>
       <msg name="close"/>
       <msg name="open"/>
       <msg name="signal"/>
@@ -172,6 +192,51 @@
     <object name="fl_bridge_bn">
       <attr name="flavor" value="bn"/>
     </object>
+    <object name="fl_hay" super="fl_floodstream">
+      <attr name="friction" default="5.0"/>
+      <attr name="adhesion" default="1.5"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_hay_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_ice">
+      <attr name="friction" default="0.1"/>
+      <attr name="adhesion" default="0.1"/>
+    </object>
+    <object name="fl_rock" super="fl_floodstream">
+      <attr name="friction" default="6.5"/>
+      <attr name="adhesion" default="2.2"/>
+    </object>
+    <object name="fl_rock_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_space">
+      <attr name="friction" default="0.0"/>
+      <attr name="adhesion" default="0.0"/>
+    </object>
+    <object name="fl_swamp">
+      <attr name="friction" default="13.0"/>
+      <attr name="adhesion" default="1.0"/>
+    </object>
+    <object name="fl_water" super="fl_floodstream">
+      <attr name="friction" default="5.0"/>
+      <attr name="adhesion" default="1.0"/>
+      <attr name="$heattransform" default="fl_swamp"/>
+    </object>
+    <object name="fl_wood" super="fl_floodstream">
+      <attr name="friction" default="6.4"/>
+      <attr name="adhesion" default="2.0"/>
+      <attr name="burnable" default="true"/>
+      <attr name="$firetransform" default="fl_abyss"/>
+    </object>
+    <object name="fl_wood_h" init="true"/>
+    <object name="fl_wood_v" init="true"/>
+    <object name="fl_wood_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_wood_framed_h" init="true"/>
+    <object name="fl_wood_framed_v" init="true"/>
     <object name="it" abstract="true"/>
     <object name="it_blocker">
       <attr name="autoclose"/>

Modified: trunk/data/startup.lua
===================================================================
--- trunk/data/startup.lua	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/data/startup.lua	2008-12-13 14:14:22 UTC (rev 1392)
@@ -188,10 +188,9 @@
 def_floor("fl-bumps",        5.0,   1.2,   false,   "",         true)
 def_floor("fl-concrete",     4.5,   1.3,   false,   "",         true)
 def_floor("fl-dunes",        1.3,   1.0,   false,   "",         true)
-def_floor("fl-floor_001",    1.5,   2.5,    true,   "fl-abyss", true)
+def_floor("fl-floor_001",    1.5,   2.5,    true,   "fl_abyss", true)
 def_floor("fl-gravel",       3.2,   1.5,   false,   "",         true)
 def_floor("fl-gray",         5.0,   3.0,   false,   "",         true)
-def_floor("fl-hay",          5.0,   1.5,    true,   "",         true)
 def_floor("fl-himalaya",     5.0,   2.0,   false,   "",         true)
 def_floor("fl-inverse",      3.0,  -2.0,   false,   "",         false)
 def_floor("fl-inverse2",     3.0,  -2.0,   false,   "",         false)
@@ -223,29 +222,25 @@
 def_floor("fl-mortar",       7.2,   1.8,   false,   "",         true)
 def_floor("fl-normal",       4.0,   2.0,   false,   "",         true)
 def_floor("fl-normal_x",     3.0,   2.0,   false,   "",         true)
-def_floor("fl-plank",        5.5,   2.0,    true,   "fl-abyss", true)
+def_floor("fl-plank",        5.5,   2.0,    true,   "fl_abyss", true)
 def_floor("fl-red",          0.9,   1.0,    true,   "",         true)
-def_floor("fl-rock",         6.5,   2.2,   false,   "",         true)
 def_floor("fl-rough",        7.0,   2.0,    true,   "",         true)
 def_floor("fl-rough_medium", 5.0,   1.2,    true,   "",         true)
 def_floor("fl-rough_slow",   7.0,   0.5,    true,   "",         true)
 def_floor("fl-rough-blue",   7.0,   2.0,    true,   "",         true)
 def_floor("fl-rough-red",    7.0,   2.0,    true,   "",         true)
 def_floor("fl-sahara",       6.4,   2.0,   false,   "",         true)
-def_floor("fl-samba",        6.0,   2.0,    true,   "fl-abyss", true)
-def_floor("fl-samba1",       6.0,   2.0,    true,   "fl-abyss", true)
-def_floor("fl-samba2",       6.0,   2.0,    true,   "fl-abyss", true)
+def_floor("fl-samba",        6.0,   2.0,    true,   "fl_abyss", true)
+def_floor("fl-samba1",       6.0,   2.0,    true,   "fl_abyss", true)
+def_floor("fl-samba2",       6.0,   2.0,    true,   "fl_abyss", true)
 def_floor("fl-sand",         6.0,   2.0,   false,   "",         true)
 def_floor("fl_space",        0.0,   0.0,   false,   "",         false)
 def_floor("fl-springboard",  4.0,   2.0,   false,   "",         true)
 def_floor("fl-stone",        1.4,   1.0,   false,   "",         true)
-def_floor("fl-stwood",       6.4,   2.0,    true,   "fl-abyss", true)
-def_floor("fl-stwood1",      6.4,   2.0,    true,   "fl-abyss", true)
-def_floor("fl-stwood2",      6.4,   2.0,    true,   "fl-abyss", true)
+def_floor("fl-stwood",       6.4,   2.0,    true,   "fl_abyss", true)
+def_floor("fl-stwood1",      6.4,   2.0,    true,   "fl_abyss", true)
+def_floor("fl-stwood2",      6.4,   2.0,    true,   "fl_abyss", true)
 def_floor("fl-tigris",       6.0,   2.0,    true,   "",         true)
-def_floor("fl-wood",         6.4,   2.0,    true,   "fl-abyss", false)
-def_floor("fl-wood1",        6.4,   2.0,    true,   "fl-abyss", false)
-def_floor("fl-wood2",        6.4,   2.0,    true,   "fl-abyss", false)
 def_floor("fl-woven",        6.5,   3.0,    true,   "",         true)
 def_floor("fl-nomouse",      2.5,   0.0,    true,   "",         false)
 def_floor("fl-black",        3.0,   1.5,   false,   "",         true)

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/Makefile.am	2008-12-13 14:14:22 UTC (rev 1392)
@@ -146,6 +146,8 @@
 	XMLtoUtf8.hh		\
 	floors/BridgeFloor.cc	\
 	floors/BridgeFloor.hh	\
+	floors/FloodStream.cc	\
+	floors/FloodStream.hh	\
 	gui/ErrorMenu.cc	\
 	gui/ErrorMenu.hh	\
 	gui/GameMenu.cc		\

Modified: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/WorldProxy.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -82,14 +82,10 @@
             return server::ElectricForce;
         } else if (key == "ExtralifeGlasses") {
             return server::ExtralifeGlasses;
-        } else if (key == "FlatForce") {
-            return server::FlatForce;
         } else if (key == "FrictionFactor") {
             return server::FrictionFactor;
         } else if (key == "MeditationStrength") {
             return server::HoleForce;
-        } else if (key == "IceFriction") {
-            return server::IceFriction;
         } else if (key == "MagnetStrength") {
             return server::MagnetForce;
         } else if (key == "MagnetRange") {
@@ -170,14 +166,10 @@
             server::ElectricForce = val;
         } else if (key == "ExtralifeGlasses") {
             server::ExtralifeGlasses = val;
-        } else if (key == "FlatForce") {
-            server::FlatForce = val;
         } else if (key == "FrictionFactor") {
             server::FrictionFactor = val;
         } else if (key == "MeditationStrength") {
             server::HoleForce = val;
-        } else if (key == "IceFriction") {
-            server::IceFriction = val;
         } else if (key == "MagnetStrength") {
             server::MagnetForce = val;
             BroadcastMessage("_updateglobals", "it_magnet", GRID_ITEMS_BIT);

Modified: trunk/src/enigma-lua.pkg
===================================================================
--- trunk/src/enigma-lua.pkg	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/enigma-lua.pkg	2008-12-13 14:14:22 UTC (rev 1392)
@@ -57,7 +57,6 @@
     extern double SlopeForce;
     extern double FlatForce;
     extern double FrictionFactor;
-    extern double IceFriction;
     extern double ElectricForce;
     extern double BumperForce;
     extern double MagnetForce;

Modified: trunk/src/floors/BridgeFloor.cc
===================================================================
--- trunk/src/floors/BridgeFloor.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/floors/BridgeFloor.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -26,10 +26,9 @@
 
 namespace enigma {
     
-    BridgeFloor::BridgeFloor(std::string flavor) : Floor("fl_bridge", 5, 1,
-        flf_default, flft_noash, "fl_abyss")
-    {
+    BridgeFloor::BridgeFloor(std::string flavor) : Floor("fl_bridge")  {
         Floor::setAttr("flavor", flavor);
+        Floor::setAttr("burnable", flavor != "gc");
         state = OPEN;
     }
     

Added: trunk/src/floors/FloodStream.cc
===================================================================
--- trunk/src/floors/FloodStream.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/floors/FloodStream.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -0,0 +1,156 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "floors/FloodStream.hh"
+
+#include "errors.hh"
+#include "main.hh"
+#include "stones.hh"
+#include "world.hh"
+
+namespace enigma {
+    
+    FloodStream::FloodStream(int subtyp, int model, bool framed, FloorFlags flags,  bool isFloodSource) :
+                Floor("fl_floodstream", 0.0, 0.0, flags) {
+        objFlags |= (subtyp << 24) | (model << 26);
+        state = isFloodSource ? FLOODING : IDLE;
+        Floor::setAttr("faces", framed ? "nesw" : "");
+    }
+    
+    FloodStream::~FloodStream() {
+        GameTimer.remove_alarm(this);
+    }
+    
+    std::string FloodStream::getClass() const {
+        switch (getTyp()) { 
+            case WATER : return "fl_water";
+            case WOOD :  return "fl_wood";
+            case HAY :   return "fl_hay";
+            case ROCK :  return "fl_rock";
+        }   
+    }
+
+    // temporary hack for backward compatibility during reengineering
+    const char * FloodStream::get_kind() const {
+        return (getClass() + ((getAttr("faces").to_string() == "nesw") ? "_framed" : "")).c_str();
+    }
+        
+    Value FloodStream::message(const Message &m) {
+        if (m.message == "_checkflood") {
+            if (state == FLOODING)
+                GameTimer.set_alarm(this, (double)getAttr("interval"), false);
+            return Value();
+        } else
+            return Floor::message(m);
+    }
+
+    void FloodStream::setState(int extState) {
+        if (isDisplayable() && extState == FLOODING && state == IDLE) {
+            if (getTyp() == WATER || getAttr("faces").to_string() == "nesw") {
+                state = FLOODING;
+                GameTimer.set_alarm(this, (double)getAttr("interval"), false);
+            }
+        } else if (extState == IDLE) {
+            state == IDLE;
+            GameTimer.remove_alarm(this);
+        } else
+            state = extState;
+    }
+    
+    void FloodStream::init_model()  {
+        bool isFramed = (getAttr("faces").to_string() == "nesw");
+        if (getTyp() == WOOD) {
+            int modelnr = (objFlags & OBJBIT_MODEL) >> 26;
+            set_model((std::string)get_kind() + ((modelnr == 0 )? "" : ecl::strf("%d", modelnr))); 
+        } else {
+            set_model(get_kind());
+        } 
+    }
+    
+    void FloodStream::on_creation(GridPos p) {
+        Floor::on_creation(p);
+        if (state == FLOODING)
+            GameTimer.set_alarm(this, (double)getAttr("interval"), false);
+    }
+    
+    bool FloodStream::is_destructible() const {
+        return getTyp() != WATER;  // all flood stream floors besides wood can be destroyed
+    }
+
+    void FloodStream::get_sink_speed (double &sink_speed, double &raise_speed) const { 
+        if (getTyp() == WATER) {
+            sink_speed = server::WaterSinkSpeed;
+            raise_speed = 1000; // always sink in water
+        } else
+            return Floor::get_sink_speed (sink_speed, raise_speed);
+    }
+    
+    void FloodStream::stone_change(Stone *st) {
+        if (getTyp() == WATER || getAttr("faces").to_string() == "nesw") {
+            SendMessage(GetFloor(get_pos()), "_checkflood");
+            for (Direction d = NORTH; d != NODIR; d = previous(d))
+                SendMessage(GetFloor(move(get_pos(), d)), "_checkflood");
+        } else
+            Floor::stone_change(st);
+    }
+
+    void FloodStream::alarm() {
+        if (isDisplayable()) {
+            Stone *thisstone = GetStone(get_pos());
+            for (Direction d = NORTH; d != NODIR; d = previous(d)) {
+                if (thisstone == NULL || thisstone->allowsSpreading(d)) {
+                    GridPos p = move(get_pos(), d);
+                    Floor *f = GetFloor(p);
+                    if (f != NULL && f->isKind("fl_floodstream") && 
+                            (f->getAttr("faces").to_string() == "nesw" || f->isKind("fl_water"))) {
+                        f->setAttr("interval", getAttr("interval"));
+                        f->setAttr("state", FLOODING);
+                    } else if (f != NULL && f->getAttr("floodable").to_bool()) {
+                        Stone *st = GetStone(p);
+                        if (st == NULL || st->allowsSpreading(reverse(d), true)) {
+                            Floor *newfloor = MakeFloor("fl_water_source");
+                            newfloor->setAttr("interval", getAttr("interval"));
+                            SetFloor(p, newfloor);
+                        }
+                    }
+                }
+            }
+        }
+    }
+    
+    FloodStream::FloodStreamTyp FloodStream::getTyp() const {
+        return (FloodStreamTyp)((objFlags & OBJBIT_SUBTYP) >> 24);
+    } 
+    
+    BOOT_REGISTER_START
+        BootRegister(new FloodStream(0, 0, false, flf_indestructible), "fl_water");
+        BootRegister(new FloodStream(0, 0, false, flf_indestructible, true), "fl_water_source");
+        BootRegister(new FloodStream(1, 0, false), "fl_wood");
+        BootRegister(new FloodStream(1, 1, false), "fl_wood_h");
+        BootRegister(new FloodStream(1, 2, false), "fl_wood_v");
+        BootRegister(new FloodStream(1, 0, true), "fl_wood_framed");
+        BootRegister(new FloodStream(1, 1, true), "fl_wood_framed_h");
+        BootRegister(new FloodStream(1, 2, true), "fl_wood_framed_v");
+        BootRegister(new FloodStream(2, 0, false), "fl_hay");
+        BootRegister(new FloodStream(2, 0, true), "fl_hay_framed");
+        BootRegister(new FloodStream(3, 0, false), "fl_rock");
+        BootRegister(new FloodStream(3, 0, true), "fl_rock_framed");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/floors/FloodStream.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/floors/FloodStream.hh
===================================================================
--- trunk/src/floors/FloodStream.hh	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/floors/FloodStream.hh	2008-12-13 14:14:22 UTC (rev 1392)
@@ -0,0 +1,81 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef FLOODSTREAM_HH
+#define FLOODSTREAM_HH
+
+#include "floors.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class FloodStream : public Floor, public TimeHandler {
+        CLONEOBJ(FloodStream);
+                
+    private:
+        enum iState {
+            IDLE,       ///< 
+            FLOODING    ///< 
+        };
+
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_SUBTYP    =   3<<24,   ///< the FloodStream typ
+            OBJBIT_MODEL     =   3<<26,   ///< the model typ (h/v for wood)
+        };
+        
+        enum FloodStreamTyp {
+            WATER = 0,
+            WOOD,
+            HAY,
+            ROCK
+        };
+    public:
+        FloodStream(int subtyp, int model, bool framed, 
+                FloorFlags flags = flf_default, bool isFloodSource = false);
+        ~FloodStream();
+
+        // Object interface
+        virtual std::string getClass() const;
+        virtual const char *get_kind() const;
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        virtual void on_creation(GridPos p);
+                
+        // Floor interface
+        virtual bool is_destructible() const;
+        virtual void get_sink_speed (double &sinkspeed, double &raisespeed) const;
+        virtual void stone_change(Stone *st);
+
+        // TimeHandler interface
+        virtual void alarm();
+    
+    private:
+        // Private methods.
+        FloodStreamTyp getTyp() const;
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/floors/FloodStream.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/floors.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -33,12 +33,12 @@
 Floor::Floor(const char *kind, double friction_, double mfactor, FloorFlags flags,
              FloorFireType flft, const char *firetransform_, const char *heattransform_)
 : GridObject (kind),
-  traits (kind, friction_, mfactor, flags, flft, firetransform_, heattransform_),
+  traits (kind, flags, flft, firetransform_, heattransform_),
   heating_animation(false),
   fire_countdown(1),
   var_floorforce(),
-  var_mousefactor(mfactor),
-  var_friction(friction_)
+  adhesion(mfactor),
+  friction(friction_)
 {}
 
 Floor::Floor (const FloorTraits &tr)
@@ -48,6 +48,10 @@
   fire_countdown(1)
 {}
 
+const char * Floor::get_kind() const {
+    return traits.name.c_str();
+}
+
 Floor *Floor::clone() {
     return new Floor(*this);
 }
@@ -80,33 +84,39 @@
 
 ecl::V2 Floor::process_mouseforce (Actor *a, ecl::V2 force) {
     if (a->controlled_by(player::CurrentPlayer()))
-        return get_mousefactor() * force;
+        return getAdhesion() * force;
     else
         return ecl::V2();
 }
 
-void Floor::setAttr(const string& key, const Value &val)
-{
-    if (key == "adhesion")
-        var_mousefactor = to_double(val);
-    else if (key == "friction")
-        var_friction = to_double(val);
-    else if (key == "force_x")
-        var_floorforce[0] = to_double(val);
-    else if (key == "force_y")
-        var_floorforce[1] = to_double(val);
-    GridObject::setAttr(key, val);
-}
+    void Floor::setAttr(const string& key, const Value &val) {
+        if (key == "adhesion")
+            adhesion = val;
+        else if (key == "friction")
+            friction = val;
+        else if (key == "force_x")
+            var_floorforce[0] = val;
+        else if (key == "force_y")
+            var_floorforce[1] = val;
+        GridObject::setAttr(key, val);
+    }
 
     Value Floor::getAttr(const std::string &key) const {
         if (key == "adhesion") {
-            return var_mousefactor;
+            return adhesion;
         } else if (key == "friction") {
-            return var_friction;
+            return friction;
         }
         return GridObject::getAttr(key);
-
     }
+    
+    void Floor::on_creation(GridPos p) {
+        if (Value v = GridObject::getAttr("adhesion"))
+            adhesion = v;
+        if (Value v = GridObject::getAttr("friction"))
+            friction = v;
+        GridObject::on_creation(p);
+    }
 
 void Floor::get_sink_speed (double &sinkspeed, double &raisespeed) const {
 //     sinkspeed = raisespeed = 0.0;
@@ -114,13 +124,12 @@
 
 double Floor::get_friction() const 
 { 
-    return var_friction; 
+    return friction; 
 }
 
-double Floor::get_mousefactor() const 
-{ 
-    return var_mousefactor; 
-}
+    double Floor::getAdhesion() const { 
+        return adhesion; 
+    }
 
 bool Floor::is_destructible() const 
 {
@@ -153,6 +162,15 @@
     f += var_floorforce;
 }
 
+    void Floor::stone_change(Stone *st) {
+        if (getDefaultedAttr("floodable", false).to_bool()) {
+            SendMessage(GetFloor(get_pos()), "_checkflood");
+            for (Direction d = NORTH; d != NODIR; d = previous(d))
+                SendMessage(GetFloor(move(get_pos(), d)), "_checkflood");
+        }
+    }
+
+
 /* -------------- Fire Handling -------------- */
 
 /*  The fire system is a confusing tangle of bools and flags.
@@ -193,31 +211,33 @@
  *  Have I forgotten something?
  */
 
-string Floor::get_firetransform() {
-    if(server::GameCompatibility == GAMET_ENIGMA)
-        return traits.firetransform;
-    // In non-Enigma-compatibility-modes, only fl-wood and fl-stwood
-    // transform. Note: This might have been a bug, as fl-stwood1/2
-    // and fl-wood1/2 were not included (at least fl-wood1/2 were of
-    // a newer date). However, we include them here.
-    string model = this->get_kind();
-    if (   model == "fl-wood"   || model == "fl-wood1"   || model == "fl-wood2"
-        || model == "fl-stwood" || model == "fl-stwood1" || model == "fl-stwood2")
-        return "fl_abyss";
-    else
-        return "";
+std::string Floor::get_firetransform() {
+    if (server::GameCompatibility == GAMET_ENIGMA) {
+        std::string classname = getAttr("$firetransform").to_string();
+        return (classname.length() > 0) ? classname : traits.firetransform;
+    } else {
+        // In non-Enigma-compatibility-modes, only fl-wood and fl-stwood
+        // transform. Note: This might have been a bug, as fl-stwood1/2
+        // and fl-wood1/2 were not included (at least fl-wood1/2 were of
+        // a newer date). However, we include them here.
+        return isKind("fl_wood") ? "fl_abyss" : "";
+    }
 }
-string Floor::get_heattransform(bool override_mode) {
+
+std::string Floor::get_heattransform(bool override_mode) {
     // The bool is needed to correctly exit the heating-animation
     // in case the level switched to non-Enigma-mode in between.
-    if(server::GameCompatibility == GAMET_ENIGMA || override_mode)
-        return traits.heattransform;
-    // In non-Enigma-compatibility-modes, there is no heat-transformation.
-    return "";
+    if (server::GameCompatibility == GAMET_ENIGMA || override_mode) {
+        std::string classname = getAttr("$heattransform").to_string();
+        return (classname.length() > 0) ? classname : traits.heattransform;
+    } else {
+        // In non-Enigma-compatibility-modes, there is no heat-transformation.
+        return "";
+    }
 }
 int Floor::get_fire_countdown() {
-    if(Item *it = GetItem(get_pos()))
-        if(get_id(it) == it_burnable || get_id(it) == it_burnable_oil)
+    if (Item *it = GetItem(get_pos()))
+        if (get_id(it) == it_burnable || get_id(it) == it_burnable_oil)
             return 0;
     return fire_countdown;
 }
@@ -232,7 +252,7 @@
     GridPos p = get_pos();
 
     // Don't disturb heating-transformation
-    if(heating_animation)
+    if (heating_animation)
         return false;
 
     // No or floating stone -> Burn items and replicate.
@@ -248,23 +268,23 @@
             return false;
     }
 
-    if(server::GameCompatibility == GAMET_ENIGMA) {
-        if(has_firetype(flft_burnable)) {
+    if (server::GameCompatibility == GAMET_ENIGMA) {
+        if (has_firetype(flft_burnable)) {
             // has_firetype also checks whether floor is already burning or ignited
             // (via it-burnables), but not which stone is above it.
-            if(Item *it = GetItem(p)) {
+            if (Item *it = GetItem(p)) {
                 // The item didn't respond to the "heat"-message, so we
                 // could assume it's burnable. However, as there might also
                 // be a "setfire"-message from the user or a lazy "message"-
                 // implementation, we still have to check the burnable-flag
                 // of this item:
-                if(!has_flags(it, itf_fireproof))
+                if (!has_flags(it, itf_fireproof))
                     return force_fire();
             } else {
                 // Just spread. Use the fire-countdown to delay fire without
                 // it-burnable, but not in case of a message or a secure+last
                 // call or a fastfire-floor.
-                if(    (get_fire_countdown() == 0) || (flhf == flhf_message)
+                if (   (get_fire_countdown() == 0) || (flhf == flhf_message)
                     || (has_firetype(flft_fastfire))
                     || (((bool) (flhf & flhf_last)) && has_firetype(flft_secure)))
                     return force_fire();            
@@ -272,7 +292,7 @@
             }        
         }
     } else {  // non-Enigma-mode
-        if(has_firetype(flft_burnable) || flhf == flhf_message) {
+        if (has_firetype(flft_burnable) || flhf == flhf_message) {
             // We only get here when there is a burnable item or the
             // burnable attribute is set (e.g. as part of replication).
             // A fireproof item doesn't allow to get here. (Note: We
@@ -282,11 +302,11 @@
             // This floor doesn't burn by default or by item. But, in
             // non-Enigma-compatibility-mode it should, when its neighbor
             // is of the same kind and burns also.
-            if(Floor *fl = GetFloor(move(p, sourcedir))) {
+            if (Floor *fl = GetFloor(move(p, sourcedir))) {
                 string sourcekind = fl->get_kind();
                 string mykind = this->get_kind();
-                if(no_closing_stone && sourcekind == mykind)
-                    if(has_firetype(flft_fastfire))
+                if (no_closing_stone && sourcekind == mykind)
+                    if (has_firetype(flft_fastfire))
                         return force_fire();
                     else
                         this->setAttr("burnable", true);
@@ -321,9 +341,9 @@
     bool doIgnite = doItem;
     bool reaction_happened = false;
     // Heat item -> destroy cracks, ignite bombs...
-    if(doItem)
-        if(Item *it = GetItem(get_pos()))
-            if(to_int(SendMessage(it, "heat", Value(sourcedir))) != 0.0)
+    if (doItem)
+        if (Item *it = GetItem(get_pos()))
+            if (to_int(SendMessage(it, "heat", Value(sourcedir))) != 0.0)
                 reaction_happened = true;        
     // Maybe also transform floor?
     reaction_happened = on_heattransform(sourcedir, flhf) || reaction_happened;
@@ -335,7 +355,7 @@
     // Not item nor floor nor stone reacted? Then try to ignite the floor!
     // (Note: try_ignite also tests for the heating animation:
     //        No fire during transformation allowed!)
-    if(doIgnite && !reaction_happened)
+    if (doIgnite && !reaction_happened)
         return this->try_ignite(sourcedir, flhf);
     // Else: return reaction_happened from item or heat-transform
     return reaction_happened;
@@ -344,9 +364,9 @@
 bool Floor::on_heattransform(Direction sourcedir, FloorHeatFlags flhf) {
     // return true to forbid fire (message caught)
     bool doHeatTransform = (flhf == flhf_message) || ((bool) (flhf & flhf_first));
-    if(!doHeatTransform || get_heattransform(false) == "")
+    if (!doHeatTransform || get_heattransform(false) == "")
         return false;
-    if(doHeatTransform && get_heattransform(false) != "" && !heating_animation) {
+    if (doHeatTransform && get_heattransform(false) != "" && !heating_animation) {
         set_anim(((string) this->get_kind()) + "_heating");
         heating_animation = true;
     }
@@ -354,7 +374,7 @@
 }
 
 void Floor::heat_neighbor(Direction dir, FloorHeatFlags flhf) {
-    if(Floor *fl = GetFloor(move(get_pos(), dir))) {
+    if (Floor *fl = GetFloor(move(get_pos(), dir))) {
         fl->try_heating(reverse(dir), flhf);
     }
 }
@@ -369,20 +389,20 @@
 
     // is_message indicates use of the stopfire-message,
     // so we have to check if there is fire at all.
-    if(is_message)
-        if(Item *it = GetItem(p)) {
+    if (is_message)
+        if (Item *it = GetItem(p)) {
             ItemID id = get_id(it);
-            if(id != it_burnable_burning && id != it_burnable_ignited)
+            if (id != it_burnable_burning && id != it_burnable_ignited)
                 return false;  // no fire
         } else
             return false; // no item == no fire
 
     KillItem(p);
     fire_countdown = 1;
-    if(!is_message && get_firetransform() != "")
+    if (!is_message && get_firetransform() != "")
         SetFloor(p, MakeFloor(get_firetransform().c_str()));
     // Remember, at this point "this" may be destroyed.
-    if(!GetFloor(p)->has_firetype(flft_noash))
+    if (!GetFloor(p)->has_firetype(flft_noash))
         SetItem(p, MakeItem("it-burnable_ash"));
     return true; // fire extinguished  
 }
@@ -407,7 +427,7 @@
     if (st == NULL || st->allowsSpreading(WEST))
         heat_neighbor(WEST,  flhf);
 
-    if(cont_fire)
+    if (cont_fire)
         // continue burning
         //   -> put animation
         SetItem(p, MakeItem("it-burnable_burning"));
@@ -416,17 +436,17 @@
 }
 
 bool Floor::has_firetype(FloorFireType selector) {
-    if(Item *it = GetItem(get_pos())) {
+    if (Item *it = GetItem(get_pos())) {
         ItemID id = get_id(it);
-        if(selector == flft_burnable || selector == flft_ignitable) {
-            if(   id == it_burnable || id == it_burnable_oil )
+        if (selector == flft_burnable || selector == flft_ignitable) {
+            if (  id == it_burnable || id == it_burnable_oil )
                 return true;
-            if(   id == it_burnable_ash     || id == it_burnable_fireproof
+            if (  id == it_burnable_ash     || id == it_burnable_fireproof
                || id == it_burnable_ignited || id == it_burnable_burning )
                 return false;
             // In non-Enigma-compatibility-modes, the item decides about
             // burnability and only it_burnable[_oil] is ignitable:
-            if(server::GameCompatibility != GAMET_ENIGMA)
+            if (server::GameCompatibility != GAMET_ENIGMA)
                 return (selector == flft_burnable) && !has_flags(it, itf_fireproof);
         }
     }
@@ -454,10 +474,10 @@
 
 void Floor::animcb() {
     // Probably the heating-animation ended.
-    if(heating_animation) {
-        if(this->get_heattransform(true) != "")
-            SetFloor(get_pos(), MakeFloor(get_heattransform(true).c_str()));
+    if (heating_animation) {
         heating_animation = false;
+        if (this->get_heattransform(true) != "")
+            SetFloor(get_pos(), MakeFloor(get_heattransform(true).c_str()));
     }
 }
 
@@ -486,29 +506,8 @@
         Ice() : Floor ("fl_ice", 0.1, 0.1, flf_default, flft_default, "",
             "fl_water") { }
 
-        virtual double get_friction() const {
-            return 0.1 * server::IceFriction;
-        }
     };
 
-/* -------------------- Water -------------------- */
-
-    class Water : public Floor {
-        CLONEOBJ(Water);
-    public:
-        Water() : Floor("fl_water", 5, 1, flf_indestructible, flft_default, "",
-            "fl_swamp") {}
-    private:
-
-        bool is_destructible() const {return false;}
-
-        void get_sink_speed (double &sink_speed, double &raise_speed) const { 
-            sink_speed = server::WaterSinkSpeed;
-            raise_speed = 1000; // always sink in water
-        }
-
-    };
-
 /* -------------------- Swamp -------------------- */
 
     class Swamp : public Floor {
@@ -558,7 +557,6 @@
     };
 }
 
-
 /* -------------------- Gradient -------------------- */
 
 /** \page fl-gradient Gradient Floor
@@ -806,7 +804,7 @@
 
         ecl::V2 process_mouseforce (Actor *, ecl::V2 force) {
             if (player::CurrentPlayer() == 0)
-                return get_mousefactor() * force;
+                return getAdhesion() * force;
             else
                 return ecl::V2();
         }
@@ -819,7 +817,7 @@
 
         ecl::V2 process_mouseforce (Actor *, ecl::V2 force) {
             if (player::CurrentPlayer() == 1)
-                return get_mousefactor() * force;
+                return getAdhesion() * force;
             else
                 return ecl::V2();
         }
@@ -832,7 +830,6 @@
     // Floors (most floors are defined in init.lua)
     Register(new Abyss);
     Register(new Ice);
-    Register(new Water);
     Register(new Swamp);
     Register(new DummyFloor);
     Register(new Thief);

Modified: trunk/src/floors.hh
===================================================================
--- trunk/src/floors.hh	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/floors.hh	2008-12-13 14:14:22 UTC (rev 1392)
@@ -59,19 +59,15 @@
     struct FloorTraits {
         // Variables
         string         name;
-        double         friction;
-        double         mousefactor;
         FloorFlags     flags;
         FloorFireType  firetype;
         string         firetransform;  // fire on the same tile
         string         heattransform;  // fire on neighboring tile
 
         // Constructor
-        FloorTraits (const char *n, double f, double m,
-                     FloorFlags flags_, FloorFireType flft = flft_default,
+        FloorTraits (const char *n, FloorFlags flags_, FloorFireType flft = flft_default,
                      const char *ft = "", const char *ht = "")
-            : name(n), friction(f), mousefactor(m),
-              flags(flags_), firetype(flft), firetransform(ft), heattransform(ht)
+            : name(n), flags(flags_), firetype(flft), firetransform(ft), heattransform(ht)
         {}
     };
 
@@ -87,11 +83,12 @@
     class Floor : public GridObject {
     public:
         Floor (const FloorTraits &tr);
-        Floor (const char *kind, double friction_, double mfactor,
+        Floor (const char *kind, double friction_ = 0.0, double adhesion = 0.0,
                FloorFlags flags = flf_default, FloorFireType flft = flft_default,
                const char *firetransform_ = "", const char *heattransform_ = "");
 
         // Object interface
+        virtual const char *get_kind() const;
         Floor *clone();
         void dispose();
         virtual Value message(const Message &m);
@@ -105,11 +102,11 @@
         virtual void on_drop (Item *) {}
         virtual void on_pickup (Item *) {}
 
-        virtual void stone_change(Stone *) {}
+        virtual void stone_change(Stone *);
         virtual void actor_contact(Actor *) {}
 
         virtual double get_friction() const;
-        virtual double get_mousefactor() const;
+        virtual double getAdhesion() const;
 
         virtual void get_sink_speed (double &sinkspeed, double &raisespeed) const;
         virtual bool is_destructible() const;
@@ -122,9 +119,11 @@
          virtual Object::ObjectType getObjectType() const {return Object::FLOOR;}
         
         // GridObject interface
-        void set_model (const std::string &mname);
-        display::Model *get_model ();
-        void kill_model (GridPos p);
+        virtual void on_creation(GridPos p);
+        virtual void set_model (const std::string &mname);
+        virtual display::Model *get_model();
+        virtual void kill_model(GridPos p);
+        
         // Fire interface
         virtual bool has_firetype(FloorFireType selector);
         virtual string get_firetransform();
@@ -145,8 +144,8 @@
         FloorTraits traits;
         bool heating_animation;
         int fire_countdown;  // used to delay ignition, default is 1.
-        double var_friction;
-        double var_mousefactor;
+        double friction;
+        double adhesion;
         ecl::V2 var_floorforce;
     };
 

Modified: trunk/src/lua-display.cc
===================================================================
--- trunk/src/lua-display.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/lua-display.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: display
-** Generated automatically by tolua++-1.0.92 on Fri Apr 18 01:20:21 2008.
+** Generated automatically by tolua++-1.0.92 on Mon Dec  8 13:32:36 2008.
 */
 
 #ifndef __cplusplus

Modified: trunk/src/lua-display.hh
===================================================================
--- trunk/src/lua-display.hh	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/lua-display.hh	2008-12-13 14:14:22 UTC (rev 1392)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: display
-** Generated automatically by tolua++-1.0.92 on Fri Apr 18 01:20:21 2008.
+** Generated automatically by tolua++-1.0.92 on Mon Dec  8 13:32:36 2008.
 */
 
 /* Exported function */

Modified: trunk/src/lua-ecl.cc
===================================================================
--- trunk/src/lua-ecl.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/lua-ecl.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: px
-** Generated automatically by tolua++-1.0.92 on Fri Apr 18 01:20:21 2008.
+** Generated automatically by tolua++-1.0.92 on Mon Dec  8 13:32:36 2008.
 */
 
 #ifndef __cplusplus

Modified: trunk/src/lua-ecl.hh
===================================================================
--- trunk/src/lua-ecl.hh	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/lua-ecl.hh	2008-12-13 14:14:22 UTC (rev 1392)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: px
-** Generated automatically by tolua++-1.0.92 on Fri Apr 18 01:20:21 2008.
+** Generated automatically by tolua++-1.0.92 on Mon Dec  8 13:32:36 2008.
 */
 
 /* Exported function */

Modified: trunk/src/lua-editor.cc
===================================================================
--- trunk/src/lua-editor.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/lua-editor.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: editor
-** Generated automatically by tolua++-1.0.92 on Fri Apr 18 01:20:21 2008.
+** Generated automatically by tolua++-1.0.92 on Mon Dec  8 13:32:36 2008.
 */
 
 #ifndef __cplusplus

Modified: trunk/src/lua-editor.hh
===================================================================
--- trunk/src/lua-editor.hh	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/lua-editor.hh	2008-12-13 14:14:22 UTC (rev 1392)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: editor
-** Generated automatically by tolua++-1.0.92 on Fri Apr 18 01:20:21 2008.
+** Generated automatically by tolua++-1.0.92 on Mon Dec  8 13:32:36 2008.
 */
 
 /* Exported function */

Modified: trunk/src/lua-enigma.cc
===================================================================
--- trunk/src/lua-enigma.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/lua-enigma.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: enigma
-** Generated automatically by tolua++-1.0.92 on Fri Apr 18 01:20:21 2008.
+** Generated automatically by tolua++-1.0.92 on Mon Dec  8 13:32:36 2008.
 */
 
 #ifndef __cplusplus
@@ -429,30 +429,6 @@
 }
 #endif //#ifndef TOLUA_DISABLE
 
-/* get function: IceFriction */
-#ifndef TOLUA_DISABLE_tolua_get_enigma_IceFriction
-static int tolua_get_enigma_IceFriction(lua_State* tolua_S)
-{
-  tolua_pushnumber(tolua_S,(lua_Number)IceFriction);
- return 1;
-}
-#endif //#ifndef TOLUA_DISABLE
-
-/* set function: IceFriction */
-#ifndef TOLUA_DISABLE_tolua_set_enigma_IceFriction
-static int tolua_set_enigma_IceFriction(lua_State* tolua_S)
-{
-#ifndef TOLUA_RELEASE
-  tolua_Error tolua_err;
-  if (!tolua_isnumber(tolua_S,2,0,&tolua_err))
-   tolua_error(tolua_S,"#vinvalid type in variable assignment.",&tolua_err);
-#endif
-  IceFriction = ((double)  tolua_tonumber(tolua_S,2,0))
-;
- return 0;
-}
-#endif //#ifndef TOLUA_DISABLE
-
 /* get function: ElectricForce */
 #ifndef TOLUA_DISABLE_tolua_get_enigma_ElectricForce
 static int tolua_get_enigma_ElectricForce(lua_State* tolua_S)
@@ -1247,7 +1223,6 @@
    tolua_variable(tolua_S,"SlopeForce",tolua_get_enigma_SlopeForce,tolua_set_enigma_SlopeForce);
    tolua_variable(tolua_S,"FlatForce",tolua_get_enigma_FlatForce,tolua_set_enigma_FlatForce);
    tolua_variable(tolua_S,"FrictionFactor",tolua_get_enigma_FrictionFactor,tolua_set_enigma_FrictionFactor);
-   tolua_variable(tolua_S,"IceFriction",tolua_get_enigma_IceFriction,tolua_set_enigma_IceFriction);
    tolua_variable(tolua_S,"ElectricForce",tolua_get_enigma_ElectricForce,tolua_set_enigma_ElectricForce);
    tolua_variable(tolua_S,"BumperForce",tolua_get_enigma_BumperForce,tolua_set_enigma_BumperForce);
    tolua_variable(tolua_S,"MagnetForce",tolua_get_enigma_MagnetForce,tolua_set_enigma_MagnetForce);

Modified: trunk/src/lua-enigma.hh
===================================================================
--- trunk/src/lua-enigma.hh	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/lua-enigma.hh	2008-12-13 14:14:22 UTC (rev 1392)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: enigma
-** Generated automatically by tolua++-1.0.92 on Fri Apr 18 01:20:21 2008.
+** Generated automatically by tolua++-1.0.92 on Mon Dec  8 13:32:36 2008.
 */
 
 /* Exported function */

Modified: trunk/src/lua-global.cc
===================================================================
--- trunk/src/lua-global.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/lua-global.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: global
-** Generated automatically by tolua++-1.0.92 on Fri Apr 18 01:20:21 2008.
+** Generated automatically by tolua++-1.0.92 on Mon Dec  8 13:32:36 2008.
 */
 
 #ifndef __cplusplus

Modified: trunk/src/lua-global.hh
===================================================================
--- trunk/src/lua-global.hh	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/lua-global.hh	2008-12-13 14:14:22 UTC (rev 1392)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: global
-** Generated automatically by tolua++-1.0.92 on Fri Apr 18 01:20:21 2008.
+** Generated automatically by tolua++-1.0.92 on Mon Dec  8 13:32:36 2008.
 */
 
 /* Exported function */

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/ox_extra.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -106,7 +106,7 @@
     UNUSED,              // OxydExtra floor 0x45
     UNUSED,              // OxydExtra floor 0x46
     "fl-bumps",          // OxydExtra floor 0x47
-    "fl-rock",           // OxydExtra floor 0x48
+    "fl_rock",           // OxydExtra floor 0x48
     UNUSED,              // OxydExtra floor 0x49
     UNUSED,              // OxydExtra floor 0x4a
     UNUSED,              // OxydExtra floor 0x4b

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/ox_magnum.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -94,13 +94,13 @@
     UNUSED,                     // OxydMagnum floor 0x39
     UNUSED,                     // OxydMagnum floor 0x3a
     UNUSED,                     // OxydMagnum floor 0x3b
-    "fl-rock",                  // OxydMagnum floor 0x3c
+    "fl_rock",                  // OxydMagnum floor 0x3c
     UNUSED,                     // OxydMagnum floor 0x3d
     UNUSED,                     // OxydMagnum floor 0x3e
     0,                          // OxydMagnum floor 0x3f (Level 121 ?)(in normal Oxyd Magnum Levels unused!)
-    "fl-stwood1",               // OxydMagnum floor 0x40
-    "fl-wood",                  // OxydMagnum floor 0x41
-    "fl-wood1",                 // OxydMagnum floor 0x42
+    "fl-wood_framed_h",         // OxydMagnum floor 0x40
+    "fl_wood",                  // OxydMagnum floor 0x41
+    "fl_wood_h",                // OxydMagnum floor 0x42
     UNUSED,                     // OxydMagnum floor 0x43
     UNUSED,                     // OxydMagnum floor 0x44
     UNUSED,                     // OxydMagnum floor 0x45

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/ox_oxyd1.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -127,12 +127,12 @@
     UNUSED,                     // Oxyd1 floor 0x39
     UNUSED,                     // Oxyd1 floor 0x3a
     UNUSED,                     // Oxyd1 floor 0x3b
-    "fl-rock",                  // Oxyd1 floor 0x3c
+    "fl_rock",                  // Oxyd1 floor 0x3c
     UNUSED,                     // Oxyd1 floor 0x3d
     UNUSED,                     // Oxyd1 floor 0x3e
     UNUSED,                     // Oxyd1 floor 0x3f
-    "fl-stwood1",               // Oxyd1 floor 0x40
-    "fl-wood",                  // Oxyd1 floor 0x41
+    "fl_wood_framed_h",         // Oxyd1 floor 0x40
+    "fl_wood",                  // Oxyd1 floor 0x41
     "fl-samba1",                // Oxyd1 floor 0x42
     UNUSED,                     // Oxyd1 floor 0x43
     UNUSED,                     // Oxyd1 floor 0x44

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/ox_peroxyd.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -163,7 +163,7 @@
     "fl-concrete",              // PerOxyd floor 0x39 (Tan/green horizontal Grain, same as 0x38)(only level 118)
     UNUSED,                     // PerOxyd floor 0x3a
     UNUSED,                     // PerOxyd floor 0x3b
-    "fl-stwood1",               // PerOxyd floor 0x3c
+    "fl_wood_framed_h",         // PerOxyd floor 0x3c
     "fl-samba",                 // PerOxyd floor 0x3d (common was 'fl-wood', horizontal or vertical slats)(many)
     "fl-samba1",                // PerOxyd floor 0x3e (common was 'fl-wood', horizontal slats)(only level 32)
     "fl-samba2",                // PerOxyd floor 0x3f (common was 'fl-wood', vertical slats)(levels: 35, 152)

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/server.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -108,7 +108,6 @@
 int      server::GlassesVisibility;         // no Lua access
 int      server::ExtralifeGlasses;
 double   server::HoleForce;
-double   server::IceFriction;
 lev::levelStatusType   server::LevelStatus; // no Lua access
 double   server::MagnetForce;
 double   server::MagnetRange;
@@ -266,7 +265,6 @@
     server::FrictionFactor    = 1.0;
     server::GlassesVisibility = 0;     // nothing
     server::ExtralifeGlasses  = 19;  // death + hollow + lightpassenger
-    server::IceFriction       = 1.0;
     server::ElectricForce     = 15.0;
     server::BumperForce       = 200.0;
     server::WaterSinkSpeed    = 1000;

Modified: trunk/src/server.hh
===================================================================
--- trunk/src/server.hh	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/server.hh	2008-12-13 14:14:22 UTC (rev 1392)
@@ -114,15 +114,12 @@
     // ...for floor tiles that look sloped
     extern double   SlopeForce;
 
-    // ...for floor tiles that DON'T look sloped
+    // depreceated - vertical factor for space floor tiles - used in oxyd emulation only 
     extern double   FlatForce;
 
     // ...for friction on certain floor types
     extern double   FrictionFactor;
 
-    // ...for friction on ice
-    extern double   IceFriction;
-
     // ...for electrostatic forces between actors (default: 15)
     extern double   ElectricForce;
 

Modified: trunk/src/stones/Door.cc
===================================================================
--- trunk/src/stones/Door.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/stones/Door.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -106,7 +106,7 @@
         }
     }
     
-    bool Door::allowsSpreading(Direction dir) const {
+    bool Door::allowsSpreading(Direction dir, bool isFlood) const {
         return state != CLOSED || !has_dir(getFaces(), dir);
     }
     
@@ -161,6 +161,9 @@
                 case OPEN:
                     set_model(basename+"-open");
                     MaybeRecalcLight(get_pos());
+                    SendMessage(GetFloor(get_pos()), "_checkflood");
+                    for (Direction d = NORTH; d != NODIR; d = previous(d))
+                        SendMessage(GetFloor(move(get_pos(), d)), "_checkflood");
                     break;
                 case CLOSED:
                     set_model(basename+"-closed");

Modified: trunk/src/stones/Door.hh
===================================================================
--- trunk/src/stones/Door.hh	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/stones/Door.hh	2008-12-13 14:14:22 UTC (rev 1392)
@@ -63,7 +63,7 @@
         // Stone interface
         virtual bool is_floating() const;
         virtual bool is_transparent(Direction d) const;
-        virtual bool allowsSpreading(Direction dir) const;
+        virtual bool allowsSpreading(Direction dir, bool isFlood = false) const;
         virtual StoneResponse collision_response(const StoneContact &sc);
         virtual void actor_hit(const StoneContact &sc);
         virtual const char *collision_sound();

Modified: trunk/src/stones/FloorBuilder.cc
===================================================================
--- trunk/src/stones/FloorBuilder.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/stones/FloorBuilder.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -123,6 +123,10 @@
         maybe_fall_or_stopfire(); // instantly builds a bridge on fl_swamp etc
     }
 
+    bool FloorBuilder::allowsSpreading(Direction dir, bool isFlood) const {
+        return isFlood;
+    }
+    
     void FloorBuilder::actor_hit(const StoneContact &sc) {
         if (state == GROWING)
             SendMessage(sc.actor, "shatter");
@@ -156,19 +160,23 @@
         GridPos p = get_pos();
         if (server::GameCompatibility != GAMET_ENIGMA && IsLevelBorder(p))
             return;
-        if (Floor *fl = GetFloor(p)) {
-            const std::string &k = fl->get_kind();
+        if (Floor *oldfl = GetFloor(p)) {
+            const std::string &k = oldfl->get_kind();
             if (objFlags & OBJBIT_BLOCKFIRE)
-                SendMessage(fl, "stopfire");
+                SendMessage(oldfl, "stopfire");
             if (k == "fl_abyss" || k == "fl_water" || k == "fl_swamp") {
                 if (onMove)
                     // just mark - can not kill stone yet - this will be done on floor change event
                     state = FALLING;  // keep the stone from moving any longer
                 else if ((server::GameCompatibility != GAMET_OXYD1) || state == FALLING || !onFloorChange) {
                     state = FALLEN;
-                    Floor *fl = MakeFloor((typ == HAY) ? "fl-hay" : ((typ == ROCK) ? "fl-rock" : ((typ == WOOD1) ? "fl-stwood1" : "fl-stwood2")));
-                    transferIdentity(fl);
-                    SetFloor(p, fl); 
+                    Floor *newfl = MakeFloor((typ == HAY) ? "fl_hay_framed" : ((typ == ROCK) ? "fl_rock_framed" : ((typ == WOOD1) ? "fl_wood_framed_h" : "fl_wood_framed_v")));
+                    transferIdentity(newfl);
+                    if (k == "fl_water") {
+                        newfl->setAttr("interval", oldfl->getAttr("interval"));
+                        newfl->setAttr("state", oldfl->getAttr("state"));
+                    }
+                    SetFloor(p, newfl); 
                     KillStone(p);
                 }
             }

Modified: trunk/src/stones/FloorBuilder.hh
===================================================================
--- trunk/src/stones/FloorBuilder.hh	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/stones/FloorBuilder.hh	2008-12-13 14:14:22 UTC (rev 1392)
@@ -39,7 +39,6 @@
             FALLEN      ///< a stone that is fallen on floor change notification and is vanishing
         };
         
-    private:
         enum ObjectPrivatFlagsBits {
             OBJBIT_BLOCKFIRE =   1<<24,   ///< stone blocks fire on moves and floor changes beneath
             OBJBIT_SUBTYP    =   7<<25,   ///< the FloorBuilderTyp
@@ -72,6 +71,7 @@
         virtual void animcb();
         
         // Stone interface
+        virtual bool allowsSpreading(Direction dir, bool isFlood = false) const;
         virtual void actor_hit(const StoneContact &sc);
         virtual void actor_inside(Actor *a);
         virtual void actor_contact(Actor *a);

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/stones/WindowStone.cc	2008-12-13 14:14:22 UTC (rev 1392)
@@ -129,6 +129,7 @@
     }
 
     void WindowStone::animcb() {
+        postFaceChange();
         if (state == FINALBREAK)
             KillStone(get_pos());
         else {
@@ -137,7 +138,7 @@
         }
     }
     
-    bool WindowStone::allowsSpreading(Direction dir) const {
+    bool WindowStone::allowsSpreading(Direction dir, bool isFlood) const {
         return !has_dir(getFaces(), dir);
     }
     
@@ -290,11 +291,19 @@
                     }
                 }
                 TouchStone(get_pos());  // avoid another actor getting below a moved window face
+                postFaceChange();
                 return true;
             }
         }
         return false;
     }
+
+    void WindowStone::postFaceChange() {
+        SendMessage(GetFloor(get_pos()), "_checkflood");
+        for (Direction d = NORTH; d != NODIR; d = previous(d))
+            SendMessage(GetFloor(move(get_pos(), d)), "_checkflood");
+    }
+
     
     DEF_TRAITSM(WindowStone, "st_window", st_window, MOVABLE_BREAKABLE);
 

Modified: trunk/src/stones/WindowStone.hh
===================================================================
--- trunk/src/stones/WindowStone.hh	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/stones/WindowStone.hh	2008-12-13 14:14:22 UTC (rev 1392)
@@ -66,7 +66,7 @@
         virtual void animcb();
 
         // Stone interface
-        virtual bool allowsSpreading(Direction dir) const;
+        virtual bool allowsSpreading(Direction dir, bool isFlood = false) const;
         virtual void actor_hit(const StoneContact &sc);
         virtual StoneResponse collision_response(const StoneContact &sc);
         virtual const char *collision_sound() {return "glass";}
@@ -78,6 +78,7 @@
     private:
         void breakFaces(DirectionBits faces);
         bool tryInnerPull(Direction dir, Actor *initiator = NULL);
+        void postFaceChange();
     };
 
 } // namespace enigma

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-12-12 22:16:08 UTC (rev 1391)
+++ trunk/src/stones.hh	2008-12-13 14:14:22 UTC (rev 1392)
@@ -209,7 +209,7 @@
         }
         
         // Fire and water spreading that is face and state dependent for stones like doors, window
-        virtual bool allowsSpreading(Direction dir) const {
+        virtual bool allowsSpreading(Direction dir, bool isFlood = false) const {
             return is_floating();
         }
         



From ral at mail.berlios.de  Sat Dec 13 15:38:52 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sat, 13 Dec 2008 15:38:52 +0100
Subject: [Enigma-game-svn] r1393 - team_levelpacks/team_test_new_api
Message-ID: <200812131438.mBDEcqm6020322@sheep.berlios.de>

Author: ral
Date: 2008-12-13 15:38:34 +0100 (Sat, 13 Dec 2008)
New Revision: 1393

Added:
   team_levelpacks/team_test_new_api/ralT072_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralD006_1.xml
   team_levelpacks/team_test_new_api/ralT026_1.xml
   team_levelpacks/team_test_new_api/ralT031_1.xml
   team_levelpacks/team_test_new_api/ralT047_1.xml
   team_levelpacks/team_test_new_api/ralT055_1.xml
   team_levelpacks/team_test_new_api/ralT066_1.xml
   team_levelpacks/team_test_new_api/raoulT06_1.xml
Log:
Test Level new API:
- add demo level for flood
- update renames of floodstream floors


Modified: team_levelpacks/team_test_new_api/ralD006_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD006_1.xml	2008-12-13 14:14:22 UTC (rev 1392)
+++ team_levelpacks/team_test_new_api/ralD006_1.xml	2008-12-13 14:38:34 UTC (rev 1393)
@@ -41,7 +41,7 @@
 ti["E"] = {"st_turnstilearm", orientation=EAST}
 ti["N"] = ti["."] .. {"st_turnstilearm_n"}
 
-ti["+"] = {"fl-samba", checkerboard=0} .. ti({"fl-wood", checkerboard=1})
+ti["+"] = {"fl-samba", checkerboard=0} .. ti({"fl_wood", checkerboard=1})
 
 ti["1"] = {"#ac-blackball"}
 

Modified: team_levelpacks/team_test_new_api/ralT026_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT026_1.xml	2008-12-13 14:14:22 UTC (rev 1392)
+++ team_levelpacks/team_test_new_api/ralT026_1.xml	2008-12-13 14:38:34 UTC (rev 1393)
@@ -20,17 +20,17 @@
 wo["ConserveLevel"] = true
 
 ti[" "] = {"fl-sahara"}
-ti["1"] = {"fl-rock", name="d1"}
-ti["2"] = {"fl-rock", name="d2"}
-ti["3"] = {"fl-rock", name="d3"}
-ti["4"] = {"fl-rock", name="d4"}
-ti["5"] = {"fl-rock", name="d5"}
-ti["6"] = {"fl-rock", name="d6"}
+ti["1"] = {"fl_rock", name="d1"}
+ti["2"] = {"fl_rock", name="d2"}
+ti["3"] = {"fl_rock", name="d3"}
+ti["4"] = {"fl_rock", name="d4"}
+ti["5"] = {"fl_rock", name="d5"}
+ti["6"] = {"fl_rock", name="d6"}
 ti["h"] = ti[" "] .. {"ac-horse", name="horse", destination={"d1","d2","d3","d4","d5","d6"}}
-ti["i"] = {"fl-rock", name="i1"}
-ti["j"] = {"fl-rock", name="i2"}
-ti["k"] = {"fl-rock", name="i3"}
-ti["l"] = {"fl-rock", name="i4"}
+ti["i"] = {"fl_rock", name="i1"}
+ti["j"] = {"fl_rock", name="i2"}
+ti["k"] = {"fl_rock", name="i3"}
+ti["l"] = {"fl_rock", name="i4"}
 ti["s"] = ti[" "] .. {"st_switch", target="innercircle"}
 
 

Modified: team_levelpacks/team_test_new_api/ralT031_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT031_1.xml	2008-12-13 14:14:22 UTC (rev 1392)
+++ team_levelpacks/team_test_new_api/ralT031_1.xml	2008-12-13 14:38:34 UTC (rev 1393)
@@ -22,7 +22,7 @@
 ti[" "] = {"fl-sahara"}
 ti["."] = {"fl_water"}
 ti["~"] = {"fl_abyss"}
-ti["!"] = {"fl-wood", ignitable=true}
+ti["!"] = {"fl_wood", ignitable=true}
 ti["#"] = ti[" "] .. {"st-rock1"}
 
 ti["A"] = ti[" "] .. {"it_trigger", target="lasera", action="toggle", "triggerA"}

Modified: team_levelpacks/team_test_new_api/ralT047_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT047_1.xml	2008-12-13 14:14:22 UTC (rev 1392)
+++ team_levelpacks/team_test_new_api/ralT047_1.xml	2008-12-13 14:38:34 UTC (rev 1393)
@@ -36,7 +36,7 @@
 ti[" k "] = {"it_key"} 
 
 ti["#2 "] = {"it_sword"}
-ti["# ~"] = {"fl-hay"}
+ti["# ~"] = {"fl_hay"}
 ti[" 2~"] = {"fl-gray"}
 
 ti["xxx"] = {"#ac-blackball"} 

Modified: team_levelpacks/team_test_new_api/ralT055_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT055_1.xml	2008-12-13 14:14:22 UTC (rev 1392)
+++ team_levelpacks/team_test_new_api/ralT055_1.xml	2008-12-13 14:38:34 UTC (rev 1393)
@@ -87,7 +87,7 @@
 
 function flood(value, sender)
     for i = 1, 6 do
-        wo[sender - i*po(0,1)] = {"fl-water"}
+        wo[sender - i*po(0,1)] = {"fl_water"}
     end
 end
   ]]></el:luamain>

Modified: team_levelpacks/team_test_new_api/ralT066_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT066_1.xml	2008-12-13 14:14:22 UTC (rev 1392)
+++ team_levelpacks/team_test_new_api/ralT066_1.xml	2008-12-13 14:38:34 UTC (rev 1393)
@@ -17,7 +17,7 @@
     <el:luamain><![CDATA[
 wo["ConserveLevel"] = true
 
-ti[" "] = {"fl-wood", burnable=true, ignitable=true, secure=true}
+ti[" "] = {"fl_wood", burnable=true, ignitable=true, secure=true}
 
 ti["w"] = {"st_window_nesw"}
 ti["v"] = {"st_window_ne"}

Added: team_levelpacks/team_test_new_api/ralT072_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT072_1.xml	2008-12-13 14:14:22 UTC (rev 1392)
+++ team_levelpacks/team_test_new_api/ralT072_1.xml	2008-12-13 14:38:34 UTC (rev 1393)
@@ -0,0 +1,78 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Flood new API" el:subtitle="" el:id="20081213ral473"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl_hay"}
+ti["~"] = {"fl_water"}
+ti["*"] = {"fl_water_source"}
+ti["."] = {"fl-sand", floodable=true}
+ti["-"] = {"fl_hay_framed"}
+ti["o"] = {"st_flhay"}
+ti["w"] = {"st_wood"}
+ti["b"] = {"st-brownie"}
+ti["_"] = {"st_window_s"} .. ti["."]
+
+ti["s"] = {"fl_water", "source1", interval=0.2}
+ti["S"] = {"st_switch", target="source1"}
+
+ti["="] = {"st_door_d", faces="ns"} .. ti["."]
+ti["d"] = {"st_door_d", "door", faces="ns"} .. ti["."]
+ti["D"] = {"st_switch", target="door"}
+ti["e"] = {"st_door_d", "doore", faces="ns"} .. ti["."]
+ti["E"] = {"st_switch", target="doore"}
+
+ti["g"] = {"st-glass_move"}
+ti["x"] = {"st-grate1"} .. ti["."]
+ti["^"] = {"st_oneway_n"} .. ti["."]
+
+ti["@"] = {"#ac-blackball"} 
+
+w, h = wo(ti, " ", {
+" *.............     ",
+" ~       ........   ",
+" ~       ......     ",
+" ...    @           ",
+".  .   Ss...........",
+".  .               .",
+"....     .....~.....",
+"         .          ",
+"         ..-....... ",
+"                 o. ",
+"                  . ",
+"     .___  g b   w. ",
+"  ................. ",
+" Dd                 ",
+"  ..=e=...__...~... ",
+"    ..E   ..   g  . ",
+"    ..            ^ ",
+"                  . ",
+"            ....x.. ",
+"            ...     ",
+"                    ",
+"                    "
+})
+
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: team_levelpacks/team_test_new_api/ralT072_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Modified: team_levelpacks/team_test_new_api/raoulT06_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT06_1.xml	2008-12-13 14:14:22 UTC (rev 1392)
+++ team_levelpacks/team_test_new_api/raoulT06_1.xml	2008-12-13 14:38:34 UTC (rev 1393)
@@ -16,7 +16,7 @@
     </el:info>
     <el:luamain><![CDATA[
 ti[" "] = {"fl_space"}
-ti["*"] = {"fl-wood"}
+ti["*"] = {"fl_wood"}
 
 ti["a"] = {"it_strip", friction=1, adhesion=1}
 
@@ -39,7 +39,7 @@
 
 ti["q"] = {"it_strip_nesw", friction=1, adhesion=1}
 
-ti["w"] = {"st-wood"}
+ti["w"] = {"st_wood"}
 ti["v"] = {"st-plain_move"}
 
 ti["A"] = {"#ac-blackball"} .. ti["*"]



From ral at mail.berlios.de  Sun Dec 14 13:56:17 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 14 Dec 2008 13:56:17 +0100
Subject: [Enigma-game-svn] r1394 - in trunk: data data/schemas src src/floors
Message-ID: <200812141256.mBECuHQL016156@sheep.berlios.de>

Author: ral
Date: 2008-12-14 13:56:16 +0100 (Sun, 14 Dec 2008)
New Revision: 1394

Added:
   trunk/src/floors/SimpleFloors.cc
   trunk/src/floors/SimpleFloors.hh
Modified:
   trunk/data/api2init.lua
   trunk/data/schemas/objects.xml
   trunk/data/startup.lua
   trunk/src/Makefile.am
   trunk/src/floors.cc
   trunk/src/floors/FloodStream.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
Log:
- remove superceeded "fl-stwood"
- add state constant FLOODING
- adjust flood interval default value to 0.2 seconds
- reengineering of abyss, ice, space, swamp - collect these small classes in
  a single file "SimpleFloors.cc/hh"
  - combine space and space_force in one class


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-12-13 14:38:34 UTC (rev 1393)
+++ trunk/data/api2init.lua	2008-12-14 12:56:16 UTC (rev 1394)
@@ -72,6 +72,7 @@
 LIGHT    = 0
 MEDIUM   = 1
 DARK     = 2
+FLOODING = 1
 
 -- color
 BLACK  = 0

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-13 14:38:34 UTC (rev 1393)
+++ trunk/data/schemas/objects.xml	2008-12-14 12:56:16 UTC (rev 1394)
@@ -163,7 +163,7 @@
     </object>
     <object name="fl_floodstream" abstract="true">
       <attr name="faces"/>
-      <attr name="interval" default="0.5"/>
+      <attr name="interval" default="0.2"/>
       <msg name="_init"/>
       <msg name="_checkflood"/>
     </object>
@@ -203,6 +203,7 @@
     <object name="fl_ice">
       <attr name="friction" default="0.1"/>
       <attr name="adhesion" default="0.1"/>
+      <attr name="$heattransform" default="fl_water"/>
     </object>
     <object name="fl_rock" super="fl_floodstream">
       <attr name="friction" default="6.5"/>
@@ -218,6 +219,7 @@
     <object name="fl_swamp">
       <attr name="friction" default="13.0"/>
       <attr name="adhesion" default="1.0"/>
+      <attr name="$heattransform" default="fl-dunes"/>
     </object>
     <object name="fl_water" super="fl_floodstream">
       <attr name="friction" default="5.0"/>

Modified: trunk/data/startup.lua
===================================================================
--- trunk/data/startup.lua	2008-12-13 14:38:34 UTC (rev 1393)
+++ trunk/data/startup.lua	2008-12-14 12:56:16 UTC (rev 1394)
@@ -234,12 +234,8 @@
 def_floor("fl-samba1",       6.0,   2.0,    true,   "fl_abyss", true)
 def_floor("fl-samba2",       6.0,   2.0,    true,   "fl_abyss", true)
 def_floor("fl-sand",         6.0,   2.0,   false,   "",         true)
-def_floor("fl_space",        0.0,   0.0,   false,   "",         false)
 def_floor("fl-springboard",  4.0,   2.0,   false,   "",         true)
 def_floor("fl-stone",        1.4,   1.0,   false,   "",         true)
-def_floor("fl-stwood",       6.4,   2.0,    true,   "fl_abyss", true)
-def_floor("fl-stwood1",      6.4,   2.0,    true,   "fl_abyss", true)
-def_floor("fl-stwood2",      6.4,   2.0,    true,   "fl_abyss", true)
 def_floor("fl-tigris",       6.0,   2.0,    true,   "",         true)
 def_floor("fl-woven",        6.5,   3.0,    true,   "",         true)
 def_floor("fl-nomouse",      2.5,   0.0,    true,   "",         false)

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-13 14:38:34 UTC (rev 1393)
+++ trunk/src/Makefile.am	2008-12-14 12:56:16 UTC (rev 1394)
@@ -148,6 +148,8 @@
 	floors/BridgeFloor.hh	\
 	floors/FloodStream.cc	\
 	floors/FloodStream.hh	\
+	floors/SimpleFloors.cc	\
+	floors/SimpleFloors.hh	\
 	gui/ErrorMenu.cc	\
 	gui/ErrorMenu.hh	\
 	gui/GameMenu.cc		\

Modified: trunk/src/floors/FloodStream.cc
===================================================================
--- trunk/src/floors/FloodStream.cc	2008-12-13 14:38:34 UTC (rev 1393)
+++ trunk/src/floors/FloodStream.cc	2008-12-14 12:56:16 UTC (rev 1394)
@@ -19,9 +19,8 @@
 
 #include "floors/FloodStream.hh"
 
-#include "errors.hh"
-#include "main.hh"
-#include "stones.hh"
+//#include "errors.hh"
+//#include "main.hh"
 #include "world.hh"
 
 namespace enigma {

Added: trunk/src/floors/SimpleFloors.cc
===================================================================
--- trunk/src/floors/SimpleFloors.cc	2008-12-13 14:38:34 UTC (rev 1393)
+++ trunk/src/floors/SimpleFloors.cc	2008-12-14 12:56:16 UTC (rev 1394)
@@ -0,0 +1,100 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "floors/SimpleFloors.hh"
+
+//#include "errors.hh"
+//#include "main.hh"
+#include "world.hh"
+
+namespace enigma {
+    
+/* -------------------- Abyss -------------------- */
+
+    Abyss::Abyss() : Floor("fl_abyss", 0.0, 0.0, flf_indestructible) {
+    }
+    
+    std::string Abyss::getClass() const {
+        return "fl_abyss";
+    }
+    
+    bool Abyss::is_destructible() const {
+        return false;
+    }
+
+    void Abyss::actor_contact (Actor* a) {
+        SendMessage(a, "fall");
+    }
+    
+/* -------------------- Ice -------------------- */
+
+
+    IceFloor::IceFloor() : Floor ("fl_ice") {
+    }
+    
+    std::string IceFloor::getClass() const {
+        return "fl_ice";
+    }
+    
+/* -------------------- Space -------------------- */
+
+    
+    Space::Space(bool withForce) : Floor("fl_space") {
+        if (withForce)
+            objFlags |= OBJBIT_FORCETYP;
+    }
+    
+    std::string Space::getClass() const {
+        return "fl_space";
+    }
+    
+    void Space::add_force (Actor *a, V2 &f) {
+        if (objFlags & OBJBIT_FORCETYP)
+            f[1] -= server::FlatForce;
+        Floor::add_force(a, f);
+    }
+    
+/* -------------------- Swamp -------------------- */
+
+    Swamp::Swamp() : Floor("fl_swamp", 0.0, 0.0, flf_indestructible) {
+    }
+    
+    std::string Swamp::getClass() const {
+        return "fl_swamp";
+    }
+    
+    bool Swamp::is_destructible() const {
+        return false;
+    }
+
+    void Swamp::get_sink_speed (double &sink_speed, double &raise_speed) const { 
+        sink_speed = server::SwampSinkSpeed;
+        raise_speed = 6.0;
+    }
+    
+    BOOT_REGISTER_START
+        BootRegister(new Abyss(), "fl_abyss");
+        BootRegister(new IceFloor(), "fl_ice");
+        BootRegister(new Space(), "fl_space");
+        BootRegister(new Space(true), "fl_space_force");
+        BootRegister(new Swamp(), "fl_swamp");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/floors/SimpleFloors.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/floors/SimpleFloors.hh
===================================================================
--- trunk/src/floors/SimpleFloors.hh	2008-12-13 14:38:34 UTC (rev 1393)
+++ trunk/src/floors/SimpleFloors.hh	2008-12-14 12:56:16 UTC (rev 1394)
@@ -0,0 +1,96 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef SIMPLEFLOORS_HH
+#define SIMPLEFLOORS_HH
+
+#include "floors.hh"
+
+namespace enigma {
+
+    /** 
+     * Abyss
+     */
+    class Abyss : public Floor {
+        CLONEOBJ(Abyss);
+        
+    public:
+        Abyss();
+
+        // Object interface
+        virtual std::string getClass() const;
+
+        // Floor interface
+        virtual bool is_destructible() const;
+        virtual void actor_contact(Actor *);
+    };
+
+    /** 
+     * IceFloor
+     */
+    class IceFloor : public Floor {
+        CLONEOBJ(IceFloor);
+        
+    public:
+        IceFloor();
+
+        // Object interface
+        virtual std::string getClass() const;
+    };
+
+    /** 
+     * Space
+     */
+    class Space : public Floor {
+        CLONEOBJ(Space);
+
+    private:
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_FORCETYP  =   1<<24   ///< apply flat force on space
+        };
+        
+    public:
+        Space(bool withForce = false);
+ 
+        // Object interface
+        virtual std::string getClass() const;
+
+        // Floor interface
+        virtual void add_force(Actor *a, ecl::V2 &);  // Note: actor = 0 must be allowed!
+    };
+
+    /** 
+     * Swamp
+     */
+    class Swamp : public Floor {
+        CLONEOBJ(Swamp);
+        
+    public:
+        Swamp();
+
+        // Object interface
+        virtual std::string getClass() const;
+
+        // Floor interface
+        virtual bool is_destructible() const;
+        virtual void get_sink_speed (double &sinkspeed, double &raisespeed) const;        
+    };
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/floors/SimpleFloors.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2008-12-13 14:38:34 UTC (rev 1393)
+++ trunk/src/floors.cc	2008-12-14 12:56:16 UTC (rev 1394)
@@ -486,59 +486,6 @@
 namespace
 {
 
-/* -------------------- Abyss -------------------- */
-
-    class Abyss : public Floor {
-        CLONEOBJ(Abyss);
-    public:
-        Abyss() : Floor("fl_abyss", 2.0, 1, flf_indestructible, flft_noash) {}
-    private:
-//         void actor_enter(Actor* a) {SendMessage(a, "fall");}
-        void actor_contact (Actor* a) {SendMessage(a, "fall");}
-	bool is_destructible() const {return false;}
-    };
-
-/* -------------------- Ice -------------------- */
-
-    class Ice : public Floor {
-        CLONEOBJ (Ice);
-    public:
-        Ice() : Floor ("fl_ice", 0.1, 0.1, flf_default, flft_default, "",
-            "fl_water") { }
-
-    };
-
-/* -------------------- Swamp -------------------- */
-
-    class Swamp : public Floor {
-        CLONEOBJ(Swamp);
-    public:
-        Swamp() : Floor("fl_swamp", 13, 1.0, flf_indestructible, flft_default,
-            "", "fl-dunes") {}
-    private:
-        bool is_destructible() const {return false;}
-        
-        void get_sink_speed (double &sink_speed, double &raise_speed) const { 
-            sink_speed = server::SwampSinkSpeed;
-            raise_speed = 6.0;
-        }
-    };
-
-/* -------------------- Space with force -------------------- */
-
-    class SpaceForce : public Floor {
-        CLONEOBJ (SpaceForce);
-
-        // Floor interface
-        void add_force (Actor *, V2 &f) {
-            f[1] -= server::FlatForce;
-        }
-
-    public:
-        SpaceForce() : Floor("fl-space-force", 0, 0) {
-        }
-    };
-
 /* -------------------- DummyFloor -------------------- */
 
     class DummyFloor : public Floor {
@@ -828,14 +775,10 @@
 void InitFloors()
 {
     // Floors (most floors are defined in init.lua)
-    Register(new Abyss);
-    Register(new Ice);
-    Register(new Swamp);
     Register(new DummyFloor);
     Register(new Thief);
     Register(new WhiteTile);
     Register(new BlackTile);
-    Register(new SpaceForce);
 
     Register(new Gradient);
     Register("fl-gradient1", new Gradient(1));

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-12-13 14:38:34 UTC (rev 1393)
+++ trunk/src/ox_oxyd1.cc	2008-12-14 12:56:16 UTC (rev 1394)
@@ -100,7 +100,7 @@
     UNUSED,                     // Oxyd1 floor 0x1e
     UNUSED,                     // Oxyd1 floor 0x1f
     "fl_space",                 // Oxyd1 floor 0x20
-    "fl-space-force",           // Oxyd1 floor 0x21
+    "fl_space_force",           // Oxyd1 floor 0x21
     "fl_space",                 // Oxyd1 floor 0x22
     "fl-gradient1",             // Oxyd1 floor 0x23
     "fl-gradient2",             // Oxyd1 floor 0x24

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-12-13 14:38:34 UTC (rev 1393)
+++ trunk/src/ox_peroxyd.cc	2008-12-14 12:56:16 UTC (rev 1394)
@@ -136,7 +136,7 @@
     UNUSED,                     // PerOxyd floor 0x1e
     UNUSED,                     // PerOxyd floor 0x1f
     UNUSED,                     // PerOxyd floor 0x20
-    "fl-space-force",           // PerOxyd floor 0x21 (flat force)
+    "fl_space_force",           // PerOxyd floor 0x21 (flat force)
     UNUSED,                     // PerOxyd floor 0x22
     "fl-gradient1",             // PerOxyd floor 0x23
     "fl-gradient2",             // PerOxyd floor 0x24



From ral at mail.berlios.de  Sun Dec 14 14:00:21 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 14 Dec 2008 14:00:21 +0100
Subject: [Enigma-game-svn] r1395 - in trunk/src: . gui lev
Message-ID: <200812141300.mBED0LR7016478@sheep.berlios.de>

Author: ral
Date: 2008-12-14 14:00:20 +0100 (Sun, 14 Dec 2008)
New Revision: 1395

Modified:
   trunk/src/PropertyManager.cc
   trunk/src/StateManager.cc
   trunk/src/gui/LevelPackComposer.cc
   trunk/src/lev/Index.cc
Log:
Trunk 1.1:  new API 
- GCC 4.4 compatibility: add missing includes

Modified: trunk/src/PropertyManager.cc
===================================================================
--- trunk/src/PropertyManager.cc	2008-12-14 12:56:16 UTC (rev 1394)
+++ trunk/src/PropertyManager.cc	2008-12-14 13:00:20 UTC (rev 1395)
@@ -28,6 +28,7 @@
 #include "XMLtoLocal.hh"
 #include "XMLtoUtf8.hh"
 #include "ecl_system.hh"
+#include <cstdio>
 #include <iostream>
 #include <xercesc/dom/DOM.hpp>
 #include <xercesc/util/XMLDouble.hpp>

Modified: trunk/src/StateManager.cc
===================================================================
--- trunk/src/StateManager.cc	2008-12-14 12:56:16 UTC (rev 1394)
+++ trunk/src/StateManager.cc	2008-12-14 13:00:20 UTC (rev 1395)
@@ -31,6 +31,7 @@
 #include "XMLtoUtf8.hh"
 #include "ecl_system.hh"
 #include "gui/ErrorMenu.hh"
+#include <cstdio>
 #include <iostream>
 #include <sstream>
 #include <xercesc/dom/DOM.hpp>

Modified: trunk/src/gui/LevelPackComposer.cc
===================================================================
--- trunk/src/gui/LevelPackComposer.cc	2008-12-14 12:56:16 UTC (rev 1394)
+++ trunk/src/gui/LevelPackComposer.cc	2008-12-14 13:00:20 UTC (rev 1395)
@@ -29,6 +29,8 @@
 
 #include "main.hh"
 
+#include <cstdio>
+
 using namespace ecl;
 using namespace std;
 

Modified: trunk/src/lev/Index.cc
===================================================================
--- trunk/src/lev/Index.cc	2008-12-14 12:56:16 UTC (rev 1394)
+++ trunk/src/lev/Index.cc	2008-12-14 13:00:20 UTC (rev 1395)
@@ -27,6 +27,7 @@
 #include "lev/ScoreManager.hh"
 #include "lev/RatingManager.hh"
 
+#include <cstdio>
 
 namespace enigma { namespace lev {
 



From ral at mail.berlios.de  Tue Dec 16 00:46:20 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 16 Dec 2008 00:46:20 +0100
Subject: [Enigma-game-svn] r1396 - in trunk: data data/schemas src src/stones
Message-ID: <200812152346.mBFNkKnL004009@sheep.berlios.de>

Author: ral
Date: 2008-12-16 00:46:13 +0100 (Tue, 16 Dec 2008)
New Revision: 1396

Added:
   trunk/src/stones/PassageStone.cc
   trunk/src/stones/PassageStone.hh
Modified:
   trunk/data/api1init.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.hh
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering
- st-black/white to st_passage:
  - old typs 1,2,3,4 renamed to st_passage_black/white_square/slash/cross/frame
  - attribute state as synonym for attribute color
  - standard state message toggle, but signal has no value is identical to 
    toggle for compatibility reasons
  - attribute flavor with strings identical to suffices: "square",...


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-12-14 13:00:20 UTC (rev 1395)
+++ trunk/data/api1init.lua	2008-12-15 23:46:13 UTC (rev 1396)
@@ -236,6 +236,14 @@
     st_oneway_white_w = "st-oneway_white-w",
     st_panel = "st-wood_001",
     st_polarswitch = "st-polarswitch",
+    st_passage_black_square = "st-black1",
+    st_passage_black_slash = "st-black2",
+    st_passage_black_cross = "st-black3",
+    st_passage_black_frame = "st-black4",
+    st_passage_white_square = "st-white1",
+    st_passage_white_slash = "st-white2",
+    st_passage_white_cross = "st-white3",
+    st_passage_white_frame = "st-white4",
     st_pull = "st-pull",
     st_puzzle = "st-puzzle",
     st_puzzle_blue_w = "st-puzzle-w",
@@ -775,10 +783,6 @@
     it_vortex__openclose = "toggle",
     it_vortex__trigger = "toggle",
     it_wormhole__onoff = "toggle",
-    ["st-black1__trigger"] = "signal",
-    ["st-black2__trigger"] = "signal",
-    ["st-black3__trigger"] = "signal",
-    ["st-black4__trigger"] = "signal",
     st_blocker__openclose = "toggle",
     st_blocker__trigger = "toggle",
     st_blocker_new__openclose = "toggle",
@@ -795,15 +799,12 @@
     st_lightpassenger__onoff = "toggle",
     st_mirror__trigger = "turn",
     st_oxyd__trigger = "open",
+    st_passage__trigger = "signal",
     ["st-plain__trigger"] = "signal",
     ["st-plain_hole__trigger"] = "signal",
     st_polarswitch__onoff = "toggle",
     st_switch__onoff = "toggle",
-    st_volcano__trigger = "toggle",
-    ["st-white1__trigger"] = "signal",
-    ["st-white2__trigger"] = "signal",
-    ["st-white3__trigger"] = "signal",
-    ["st-white4__trigger"] = "signal"
+    st_volcano__trigger = "toggle"
 }
 ----------------------
 -- old API 1.0      --

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-14 13:00:20 UTC (rev 1395)
+++ trunk/data/schemas/objects.xml	2008-12-15 23:46:13 UTC (rev 1396)
@@ -947,6 +947,18 @@
     <object name="st_panel_nesw">
       <attr name="connections" value="nesw"/>
     </object>
+    <object name="st_passage">
+      <attr name="color" default="0"/>
+      <attr name="flavor" default="square"/>
+      <msg name="signal"/>
+      <msg name="_trigger"/>
+    </object>
+    <object name="st_passage_black">
+      <attr name="color" value="0"/>
+    </object>
+    <object name="st_passage_white">
+      <attr name="color" value="1"/>
+    </object>
     <object name="st_polarswitch">
       <msg name="on"/>
       <msg name="off"/>

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-14 13:00:20 UTC (rev 1395)
+++ trunk/src/Makefile.am	2008-12-15 23:46:13 UTC (rev 1396)
@@ -284,6 +284,8 @@
 	stones/OneWayStone.hh	\
 	stones/OxydStone.cc	\
 	stones/OxydStone.hh	\
+	stones/PassageStone.cc	\
+	stones/PassageStone.hh	\
 	stones/PolarSwitchStone.cc	\
 	stones/PolarSwitchStone.hh	\
 	stones/PullStone.cc	\

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-12-14 13:00:20 UTC (rev 1395)
+++ trunk/src/ox_magnum.cc	2008-12-15 23:46:13 UTC (rev 1396)
@@ -256,8 +256,8 @@
     0,                          // OxydMagnum stone 0x89 (Level 121 ?)(in normal Oxyd Magnum Levels unused!)
     "st-stone1",                // OxydMagnum stone 0x8a
     "st-rock6",                 // OxydMagnum stone 0x8b
-    "st-white1",                // OxydMagnum stone 0x8c
-    "st-black1",                // OxydMagnum stone 0x8d
+    "st_passage_white_square",  // OxydMagnum stone 0x8c
+    "st_passage_black_square",  // OxydMagnum stone 0x8d
     "st-yinyang2",              // OxydMagnum stone 0x8e
     UNUSED,                     // OxydMagnum stone 0x8f
     "st-redrock",               // OxydMagnum stone 0x90 (Level 89 only)

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-12-14 13:00:20 UTC (rev 1395)
+++ trunk/src/ox_oxyd1.cc	2008-12-15 23:46:13 UTC (rev 1396)
@@ -288,8 +288,8 @@
     UNUSED,                     // Oxyd1 stone 0x89
     "st-stone1",                // Oxyd1 stone 0x8a
     "st_bluesand",              // Oxyd1 stone 0x8b
-    "st-white1",                // Oxyd1 stone 0x8c
-    "st-black1",                // Oxyd1 stone 0x8d
+    "st_passage_white_square",  // Oxyd1 stone 0x8c
+    "st_passage_black_square",  // Oxyd1 stone 0x8d
     "st-yinyang2",              // Oxyd1 stone 0x8e
     UNUSED,                     // Oxyd1 stone 0x8f
     "st-whiteballs",            // Oxyd1 stone 0x90

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-12-14 13:00:20 UTC (rev 1395)
+++ trunk/src/ox_peroxyd.cc	2008-12-15 23:46:13 UTC (rev 1396)
@@ -309,8 +309,8 @@
     "st-stonebrush",            // PerOxyd stone 0x76
     "st_door_d_open",           // PerOxyd stone 0x77
     "st_door_d_ew_open",        // PerOxyd stone 0x78
-    "st-white1",                // PerOxyd stone 0x79 (Can be either st-white1 or st-white4)
-    "st-black1",                // PerOxyd stone 0x7a (Can be either st-black1 or st-black4)
+    "st_passage_white_square",  // PerOxyd stone 0x79 (Can be either st-white1 or st-white4)
+    "st_passage_black_square",  // PerOxyd stone 0x7a (Can be either st-black1 or st-black4)
     "st-metal_hole",            // PerOxyd stone 0x7b (because it looks similar ...; only link level 79)
     0,                          // PerOxyd stone 0x7c (probably complex stone, behavior unknown)(only levels: 23 142, these levels are identical!)
     "st-yinyang3",              // PerOxyd stone 0x7d

Added: trunk/src/stones/PassageStone.cc
===================================================================
--- trunk/src/stones/PassageStone.cc	2008-12-14 13:00:20 UTC (rev 1395)
+++ trunk/src/stones/PassageStone.cc	2008-12-15 23:46:13 UTC (rev 1396)
@@ -0,0 +1,131 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/PassageStone.hh"
+
+//#include "main.hh"
+
+namespace enigma {
+
+    PassageStone::PassageStone(int color, int flavor) : Stone() {
+        state = color;
+        objFlags |= (flavor << 24);
+    }
+    
+    std::string PassageStone::getClass() const {
+        return "st_passage";
+    }
+    
+    void PassageStone::setAttr(const string& key, const Value &val) {
+        if (key == "color") {
+            Stone::setAttr("state", val);
+        } else if (key == "flavor") {
+            std::string fs = val.to_string();
+            int fo = (objFlags & OBJBIT_FLAVOR) >> 24;
+            int fi = -1;
+            if (fs == "square") fi = 0;
+            else if (fs == "slash") fi = 1;
+            else if (fs == "cross") fi = 2;
+            else if (fs == "frame") fi = 3;
+            if (fi != -1 && fi !=fo) {
+                objFlags = (objFlags & ~OBJBIT_FLAVOR) | (fi << 24);
+                if (isDisplayable())
+                    init_model();
+            }
+            return;
+        } else
+            Stone::setAttr(key, val);
+    }
+    
+    Value PassageStone::getAttr(const std::string &key) const {
+        if (key == "color") {
+            return state;
+        } else if (key == "flavor") {
+            switch ((objFlags & OBJBIT_FLAVOR) >> 24) {
+                case 0 : return "square";
+                case 1 : return "slash";
+                case 2 : return "cross";
+                case 3 : return "frame";
+            }
+            return Value();
+        }
+        return Stone::getAttr(key);
+    }
+    
+    Value PassageStone::message(const Message &m) {
+        if (m.message == "signal" || m.message == "_trigger") {
+            toggleState();
+            return Value();
+        }
+        return Stone::message(m);
+    }
+    
+    void PassageStone::init_model()  {
+        // the models are still encoded in the old API notation
+        set_model(ecl::strf("st-%s%d", (state == BLACK) ? "black" : "white", (int)(((objFlags & OBJBIT_FLAVOR) >> 24)+1)));
+    }
+
+    bool PassageStone::is_floating() const {
+        return true;
+    }
+    
+    bool PassageStone::is_transparent (Direction d) const {
+        return true;
+    }
+    
+    StoneResponse PassageStone::collision_response(const StoneContact &sc) {
+        Value accolor = sc.actor->getAttr("color"); 
+        if (state == BLACK) {
+            return (accolor && accolor == BLACK) ?  STONE_PASS : STONE_REBOUND;
+        }
+        else {
+            return (accolor && accolor == WHITE) ?  STONE_PASS : STONE_REBOUND;
+        }
+    }
+
+    int PassageStone::traitsIdx() const {
+        return ((objFlags & OBJBIT_FLAVOR) >> 24) + 4 * state;
+    }
+
+    StoneTraits PassageStone::traits[8] = {
+        {"st_passage_black_square", st_passage_black_square, stf_transparent, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_passage_black_slash",  st_passage_black_slash,  stf_transparent, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_passage_black_cross",  st_passage_black_cross,  stf_transparent, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_passage_black_frame",  st_passage_black_frame,  stf_transparent, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_passage_white_square", st_passage_white_square, stf_transparent, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_passage_white_slash",  st_passage_white_slash,  stf_transparent, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_passage_white_cross",  st_passage_white_cross,  stf_transparent, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_passage_white_frame",  st_passage_white_frame,  stf_transparent, material_stone, 1.0, MOVABLE_PERSISTENT},
+    };
+    
+    BOOT_REGISTER_START
+        BootRegister(new PassageStone(BLACK, 0), "st_passage");
+        BootRegister(new PassageStone(BLACK, 0), "st_passage_black");
+        BootRegister(new PassageStone(BLACK, 0), "st_passage_black_square");
+        BootRegister(new PassageStone(BLACK, 1), "st_passage_black_slash");
+        BootRegister(new PassageStone(BLACK, 2), "st_passage_black_cross");
+        BootRegister(new PassageStone(BLACK, 3), "st_passage_black_frame");
+        BootRegister(new PassageStone(WHITE, 0), "st_passage_white");
+        BootRegister(new PassageStone(WHITE, 0), "st_passage_white_square");
+        BootRegister(new PassageStone(WHITE, 1), "st_passage_white_slash");
+        BootRegister(new PassageStone(WHITE, 2), "st_passage_white_cross");
+        BootRegister(new PassageStone(WHITE, 3), "st_passage_white_frame");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/PassageStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/PassageStone.hh
===================================================================
--- trunk/src/stones/PassageStone.hh	2008-12-14 13:00:20 UTC (rev 1395)
+++ trunk/src/stones/PassageStone.hh	2008-12-15 23:46:13 UTC (rev 1396)
@@ -0,0 +1,67 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef PASSAGESTONE_HH
+#define PASSAGESTONE_HH
+
+#include "stones.hh"
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     * 
+     */
+    class PassageStone : public Stone {
+         CLONEOBJ(PassageStone);
+         DECL_TRAITS_ARRAY(8, traitsIdx());
+    private:
+        enum iState {
+            BLACK,
+            WHITE
+        };
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_FLAVOR   =   3<<24,    ///< 
+        };
+
+    public:
+        PassageStone(int color, int flavor); 
+
+        // Object interface
+        virtual std::string getClass() const;
+        virtual void setAttr(const string& key, const Value &val);
+        virtual Value getAttr(const std::string &key) const;
+        virtual Value message(const Message &m);
+        
+        // GridObject interface
+        virtual void init_model();
+        
+        // Stone interface
+        virtual bool is_floating() const;
+        virtual bool is_transparent(Direction d) const;
+        virtual StoneResponse collision_response(const StoneContact &sc);
+               
+    private:
+        // Private methods.
+        int traitsIdx() const;
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/PassageStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-12-14 13:00:20 UTC (rev 1395)
+++ trunk/src/stones.hh	2008-12-15 23:46:13 UTC (rev 1396)
@@ -34,10 +34,10 @@
         st_actorimpulse,
         st_actorimpulse_invisible,
         st_borderstone,
-        st_black1,
-        st_black2,
-        st_black3,
-        st_black4,
+        st_passage_black_square,
+        st_passage_black_slash,
+        st_passage_black_cross,
+        st_passage_black_frame,
         st_block,
         st_boulder,
         st_brake,
@@ -103,10 +103,10 @@
         st_turnstilearm_e,
         st_turnstilearm_n,
         st_volcano,
-        st_white1,
-        st_white2,
-        st_white3,
-        st_white4,
+        st_passage_white_square,
+        st_passage_white_slash,
+        st_passage_white_cross,
+        st_passage_white_frame,
         st_window,
         st_wood_growing,
         st_lightpassenger,

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-12-14 13:00:20 UTC (rev 1395)
+++ trunk/src/stones_simple.cc	2008-12-15 23:46:13 UTC (rev 1396)
@@ -1008,64 +1008,6 @@
     };
 }
 
-
-/* -------------------- Black Stones -------------------- */
-namespace
-{
-    class BlackWhiteStone : public Stone {
-        CLONEOBJ(BlackWhiteStone);
-        DECL_TRAITS_ARRAY(8, m_type);
-        int m_type;
-
-        BlackWhiteStone(int type) : m_type(type)
-        {}
-
-        StoneResponse collision_response(const StoneContact &sc) {
-            Value accolor = sc.actor->getAttr("color"); 
-            if (m_type < 4) {
-                return (accolor && accolor == BLACK) ? 
-                    STONE_PASS : STONE_REBOUND;
-            }
-            else {
-                return (accolor && accolor == WHITE) ? 
-                    STONE_PASS : STONE_REBOUND;
-            }
-        }
-
-        virtual Value message(const Message &m) {
-            if (m.message == "signal" || m.message == "_trigger") {
-                // toggle between black and white stone
-                m_type = (m_type + 4) % 8;
-                init_model();
-                return Value();
-            }
-            return Stone::message(m);
-        }
-
-        bool is_floating() const { return true; }
-        bool is_transparent (Direction) const { return true; }
-
-    public:
-        static void setup() {
-            for (int i=0; i<8; ++i)
-                Register(new BlackWhiteStone(i));
-        }
-    };
-
-    StoneTraits BlackWhiteStone::traits[8] = {
-        {"st-black1", st_black1, stf_transparent, material_stone, MOVABLE_PERSISTENT},
-        {"st-black2", st_black2, stf_transparent, material_stone, MOVABLE_PERSISTENT},
-        {"st-black3", st_black3, stf_transparent, material_stone, MOVABLE_PERSISTENT},
-        {"st-black4", st_black4, stf_transparent, material_stone, MOVABLE_PERSISTENT},
-        {"st-white1", st_white1, stf_transparent, material_stone, MOVABLE_PERSISTENT},
-        {"st-white2", st_white2, stf_transparent, material_stone, MOVABLE_PERSISTENT},
-        {"st-white3", st_white3, stf_transparent, material_stone, MOVABLE_PERSISTENT},
-        {"st-white4", st_white4, stf_transparent, material_stone, MOVABLE_PERSISTENT},
-    };
-
-}
-
-
 /* -------------------- YinYang stones -------------------- */
 namespace
 {
@@ -1075,11 +1017,11 @@
         {}
 
     protected:
-        void turn_white(const char *stonename = "st-white1") {
+        void turn_white(const char *stonename = "st_passage_white_square") {
             sound_event("yinyang");
             ReplaceStone (get_pos(), MakeStone(stonename));
         }
-        void turn_black(const char *stonename = "st-black1") {
+        void turn_black(const char *stonename = "st-passage_black_square") {
             sound_event("yinyang");
             ReplaceStone (get_pos(), MakeStone(stonename));
         }
@@ -1330,8 +1272,6 @@
 
 void Init_simple()
 {
-    BlackWhiteStone::setup();
-
     Register(new BlockStone);
     Register(new BombStone("st-bombs", "it-blackbomb"));
     //Register(new BombStone("st-dynamite", "it-dynamite"));



From ral at mail.berlios.de  Tue Dec 16 00:51:29 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 16 Dec 2008 00:51:29 +0100
Subject: [Enigma-game-svn] r1397 - in trunk/src: . items
Message-ID: <200812152351.mBFNpTis011365@sheep.berlios.de>

Author: ral
Date: 2008-12-16 00:51:27 +0100 (Tue, 16 Dec 2008)
New Revision: 1397

Added:
   trunk/src/items/Coin.cc
   trunk/src/items/Coin.hh
   trunk/src/items/ExtraLife.cc
   trunk/src/items/ExtraLife.hh
   trunk/src/items/Hammer.cc
   trunk/src/items/Hammer.hh
   trunk/src/items/SimpleItems.cc
   trunk/src/items/SimpleItems.hh
   trunk/src/items/Sword.cc
   trunk/src/items/Sword.hh
   trunk/src/items/Umbrella.cc
   trunk/src/items/Umbrella.hh
Modified:
   trunk/src/Makefile.am
   trunk/src/items.cc
Log:
Trunk 1.1:
- code cleanup of reengineered item classes:
  - extraction of classes ExtraLife, Hammer, Sword, Umbrella, Coin
  - files SimpeItems with Brush, DeathItem, Floppy, Key, Wrench


Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/Makefile.am	2008-12-15 23:51:27 UTC (rev 1397)
@@ -194,8 +194,14 @@
 	items/BrakeItem.hh	\
 	items/BlockerItem.cc	\
 	items/BlockerItem.hh	\
+	items/Coin.cc		\
+	items/Coin.hh		\
+	items/ExtraLife.cc	\
+	items/ExtraLife.hh	\
 	items/GlassesItem.cc	\
 	items/GlassesItem.hh	\
+	items/Hammer.cc		\
+	items/Hammer.hh		\
 	items/Magnet.cc		\
 	items/Magnet.hh		\
 	items/Meditation.cc	\
@@ -210,10 +216,16 @@
 	items/Sensor.hh		\
 	items/ShogunDot.cc	\
 	items/ShogunDot.hh	\
+	items/SimpleItems.cc	\
+	items/SimpleItems.hh	\
 	items/StripItem.cc	\
 	items/StripItem.hh	\
+	items/Sword.cc		\
+	items/Sword.hh		\
 	items/Trigger.cc	\
 	items/Trigger.hh	\
+	items/Umbrella.cc	\
+	items/Umbrella.hh	\
 	items/Vortex.cc		\
 	items/Vortex.hh		\
 	items/WormHole.cc	\

Added: trunk/src/items/Coin.cc
===================================================================
--- trunk/src/items/Coin.cc	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items/Coin.cc	2008-12-15 23:51:27 UTC (rev 1397)
@@ -0,0 +1,75 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "items/Coin.hh"
+//#include "errors.hh"
+//#include "main.hh"
+//#include "player.hh"
+#include "world.hh"
+
+namespace enigma {
+
+    Coin::Coin(int type) {
+        state = type;
+        setAttr("coin_value", state == 0 ? 3.0 : (state == 1 ? 6.0 : 12.0));
+    }
+    
+    std::string Coin::getClass() const {
+        return "it_coin";
+    }
+    
+    void Coin::setState(int extState) {
+        // ignore any state access
+    }
+
+    void Coin::processLight(Direction d) {
+        sound_event("itemtransform");
+        switch (state) {
+            case 0 : 
+                transform("it_umbrella_new"); break;
+            case 1 :
+                transform("it_hammer_new"); break;
+            case 2 :
+                transform("it_extralife_new"); break;
+        }
+    }
+
+    void Coin::on_stonehit(Stone *) {
+        if (state <= 1) {
+            state += 1;
+            setAttr("coin_value", (state == 1 ? 6.0 : 12.0));  // API 1 compatibility
+            init_model();
+        }
+
+    }
+    
+    ItemTraits Coin::traits[3] = {
+        {"it_coin_s",  it_coin1,  itf_none, 0.0},
+        {"it_coin_m",  it_coin2,  itf_none, 0.0},
+        {"it_coin_l",  it_coin4,  itf_none, 0.0},
+    };
+
+    BOOT_REGISTER_START
+        BootRegister(new Coin(0), "it_coin_s");
+        BootRegister(new Coin(1), "it_coin_m");
+        BootRegister(new Coin(2), "it_coin_l");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/items/Coin.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/Coin.hh
===================================================================
--- trunk/src/items/Coin.hh	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items/Coin.hh	2008-12-15 23:51:27 UTC (rev 1397)
@@ -0,0 +1,53 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef COINITEM_HH
+#define COINITEM_HH
+
+#include "items.hh"
+
+#include "enigma.hh"
+
+namespace enigma {
+    /**
+     */
+// TODO id renaming when names are stable
+
+    class Coin : public Item {
+        CLONEOBJ(Coin);
+        DECL_ITEMTRAITS_ARRAY(3, state);
+
+    public:
+        Coin(int type);
+        
+        // Object interface
+        virtual std::string getClass() const;
+
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void processLight(Direction d);
+        
+        // Item interface
+        virtual void on_stonehit(Stone *st);
+    };
+   
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/items/Coin.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/ExtraLife.cc
===================================================================
--- trunk/src/items/ExtraLife.cc	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items/ExtraLife.cc	2008-12-15 23:51:27 UTC (rev 1397)
@@ -0,0 +1,83 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "items/ExtraLife.hh"
+//#include "errors.hh"
+//#include "main.hh"
+//#include "server.hh"
+#include "player.hh"
+#include "world.hh"
+
+namespace enigma {
+
+    ExtraLife::ExtraLife(bool isNew) : Item() {
+        if (isNew) {
+            objFlags |= ALL_DIRECTIONS;
+        }
+    }
+    
+    std::string ExtraLife::get_inventory_model() {
+        if (player::CurrentPlayer()==0)
+            return "inv-blackball";
+        else
+            return "inv-whiteball";
+    }
+
+    void ExtraLife::on_creation(GridPos p) {
+        if ((objFlags & ALL_DIRECTIONS) == ALL_DIRECTIONS) {
+            // a new transformed extralife
+            GameTimer.set_alarm(this, 0.2, false);
+        } else {
+            updateCurrentLightDirs();
+            activatePhoto();
+        }
+        Item::on_creation(p);
+    }
+    
+    void ExtraLife::on_removal(GridPos p) {
+        GameTimer.remove_alarm(this);
+        objFlags &= ~ALL_DIRECTIONS;
+        Item::on_removal(p);
+    }
+    
+    void ExtraLife::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
+        if (added_dirs(oldDirs, newDirs) != 0) {
+            sound_event ("itemtransform");
+            replace("it_glasses");
+        }
+    }
+    
+    void  ExtraLife::setup_successor(Item *newitem) {
+        newitem->setState(server::ExtralifeGlasses);
+    }
+    
+    void ExtraLife::alarm() {
+            DirectionBits db = updateCurrentLightDirs();
+            activatePhoto();        
+    }
+
+    DEF_ITEMTRAITS(ExtraLife, "it_extralife", it_extralife);
+
+    BOOT_REGISTER_START
+        BootRegister(new ExtraLife(false), "it_extralife");
+        BootRegister(new ExtraLife(true), "it_extralife_new");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/items/ExtraLife.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/ExtraLife.hh
===================================================================
--- trunk/src/items/ExtraLife.hh	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items/ExtraLife.hh	2008-12-15 23:51:27 UTC (rev 1397)
@@ -0,0 +1,51 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef EXTRALIFEITEM_HH
+#define EXTRALIFEITEM_HH
+
+#include "items.hh"
+
+#include "enigma.hh"
+
+namespace enigma {
+    /**
+     */
+    class ExtraLife : public Item, public TimeHandler {
+        CLONEOBJ(ExtraLife);
+        DECL_ITEMTRAITS;
+        
+    public:
+        ExtraLife(bool isNew);
+
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+        virtual void on_removal(GridPos p);
+        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
+        
+        // Item interface
+        virtual string get_inventory_model();
+        virtual void setup_successor(Item *newitem);
+
+        // TimeHandler interface
+        virtual void alarm();
+    };
+    
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/items/ExtraLife.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/Hammer.cc
===================================================================
--- trunk/src/items/Hammer.cc	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items/Hammer.cc	2008-12-15 23:51:27 UTC (rev 1397)
@@ -0,0 +1,71 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "items/Hammer.hh"
+//#include "errors.hh"
+//#include "main.hh"
+#include "world.hh"
+
+namespace enigma {
+
+    Hammer::Hammer(bool isNew) : Item() {
+        if (isNew) {
+            objFlags |= ALL_DIRECTIONS;
+        }
+    }
+    
+    void Hammer::on_creation(GridPos p) {
+        if ((objFlags & ALL_DIRECTIONS) == ALL_DIRECTIONS) {
+            // a new transformed hammer
+            GameTimer.set_alarm(this, 0.2, false);
+        } else {
+            updateCurrentLightDirs();
+            activatePhoto();
+        }
+        Item::on_creation(p);
+    }
+    
+    void Hammer::on_removal(GridPos p) {
+        GameTimer.remove_alarm(this);
+        objFlags &= ~ALL_DIRECTIONS;
+        Item::on_removal(p);
+    }
+    
+    void Hammer::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
+        if (added_dirs(oldDirs, newDirs) != 0 && server::GameCompatibility != enigma::GAMET_PEROXYD) {
+            sound_event ("itemtransform");
+            transform("it_sword_new");
+        }
+    }
+    
+    void Hammer::alarm() {
+            DirectionBits db = updateCurrentLightDirs();
+            activatePhoto();        
+    }
+    
+    DEF_ITEMTRAITS(Hammer, "it_hammer", it_hammer);
+
+
+    BOOT_REGISTER_START
+        BootRegister(new Hammer(false), "it_hammer");
+        BootRegister(new Hammer(true), "it_hammer_new");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/items/Hammer.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/Hammer.hh
===================================================================
--- trunk/src/items/Hammer.hh	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items/Hammer.hh	2008-12-15 23:51:27 UTC (rev 1397)
@@ -0,0 +1,47 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef HAMMERITEM_HH
+#define HAMMERITEM_HH
+
+#include "items.hh"
+
+#include "enigma.hh"
+
+namespace enigma {
+    /**
+     */
+    class Hammer : public Item, public TimeHandler {
+        CLONEOBJ(Hammer);
+        DECL_ITEMTRAITS;
+
+    public:
+        Hammer(bool isNew);
+
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+        virtual void on_removal(GridPos p);
+        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
+
+        // TimeHandler interface
+        virtual void alarm();
+    };
+   
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/items/Hammer.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/SimpleItems.cc
===================================================================
--- trunk/src/items/SimpleItems.cc	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items/SimpleItems.cc	2008-12-15 23:51:27 UTC (rev 1397)
@@ -0,0 +1,76 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "items/SimpleItems.hh"
+//#include "errors.hh"
+//#include "main.hh"
+//#include "player.hh"
+#include "world.hh"
+
+namespace enigma {
+
+/* -------------------- Brush -------------------- */
+   
+    Brush::Brush() {
+    }
+    
+    ItemAction Brush::activate(Actor *a, GridPos p) {
+        if (Item *it = GetItem(p))
+            SendMessage (it, "_brush");
+        return ITEM_DROP;
+    }
+    
+    DEF_ITEMTRAITSF(Brush, "it_brush", it_brush, itf_inflammable);
+
+/* -------------------- Death Item  -------------------- */
+    
+    DeathItem::DeathItem() {
+    }
+    
+    void DeathItem::animcb() { 
+        set_model("it_death"); 
+        state = 0;
+     }
+
+    bool DeathItem::actor_hit(Actor *a) {
+        ActorInfo &ai = * a->get_actorinfo();
+        if (!ai.grabbed) {
+            SendMessage(a, "shatter");
+            if (state == 0) {
+                state = 1;
+                set_anim("it_death_anim");
+            }
+        }
+        return false;
+    }
+    
+    DEF_ITEMTRAITSF(DeathItem, "it_death", it_death, itf_static | itf_indestructible);
+
+
+    BOOT_REGISTER_START
+        BootRegister(new Brush(), "it_brush");
+        BootRegister(new DeathItem(), "it_death");
+        BootRegister(new Floppy(), "it_floppy");
+        BootRegister(new MagicWand(), "it_magicwand");
+        BootRegister(new Key(), "it_key");
+        BootRegister(new Wrench(), "it_wrench");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/items/SimpleItems.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/SimpleItems.hh
===================================================================
--- trunk/src/items/SimpleItems.hh	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items/SimpleItems.hh	2008-12-15 23:51:27 UTC (rev 1397)
@@ -0,0 +1,82 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef SIMPLEITEMS_HH
+#define SIMPLEITEMS_HH
+
+#include "items.hh"
+
+#include "enigma.hh"
+
+namespace enigma {
+    /**
+     * Brush Can "paint" some stones and remove ash
+     */
+    class Brush : public Item {
+        CLONEOBJ(Brush);
+        DECL_ITEMTRAITS;
+
+    public:
+        Brush();
+        
+        // Item interface
+        virtual ItemAction activate(Actor* a, GridPos p);
+    };
+    
+
+    /**
+     * DeathItem
+     */
+    class DeathItem : public Item {
+        CLONEOBJ(DeathItem);
+        DECL_ITEMTRAITS;
+        
+    public:
+        DeathItem();
+        
+        // ModelCallback interface
+        virtual void animcb();
+
+        // Item interface
+        virtual bool actor_hit(Actor *a);
+        
+    };
+
+    /**
+     * Floppy
+     */
+    DEF_ITEM(Floppy, "it_floppy", it_floppy);
+
+    /**
+     * MagicWand
+     */
+    DEF_ITEM(MagicWand, "it_magicwand", it_magicwand);
+
+    /**
+     * Key
+     */
+    DEF_ITEM(Key, "it_key", it_key);
+
+    /**
+     * Wrench
+     */
+    DEF_ITEM(Wrench, "it_wrench", it_wrench);
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/items/SimpleItems.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/Sword.cc
===================================================================
--- trunk/src/items/Sword.cc	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items/Sword.cc	2008-12-15 23:51:27 UTC (rev 1397)
@@ -0,0 +1,72 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "items/Sword.hh"
+//#include "errors.hh"
+//#include "main.hh"
+#include "world.hh"
+
+namespace enigma {
+
+    Sword::Sword(bool isNew) : Item() {
+        if (isNew) {
+            objFlags |= ALL_DIRECTIONS;
+        }
+    }
+
+    void Sword::on_creation(GridPos p) {
+        if ((objFlags & ALL_DIRECTIONS) == ALL_DIRECTIONS) {
+            // a new transformed hammer
+            GameTimer.set_alarm(this, 0.2, false);
+        } else {
+            updateCurrentLightDirs();
+            activatePhoto();
+        }
+        Item::on_creation(p);
+    }
+    
+    void Sword::on_removal(GridPos p) {
+        GameTimer.remove_alarm(this);
+        objFlags &= ~ALL_DIRECTIONS;
+        Item::on_removal(p);
+    }
+
+    
+    void Sword::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
+        if (added_dirs(oldDirs, newDirs) != 0) {
+            sound_event ("itemtransform");
+            transform("it_hammer_new");
+        }
+    }
+    
+    void Sword::alarm() {
+            updateCurrentLightDirs();
+            activatePhoto();        
+    }
+    
+    DEF_ITEMTRAITS(Sword, "it_sword", it_sword);
+
+
+    BOOT_REGISTER_START
+        BootRegister(new Sword(false), "it_sword");
+        BootRegister(new Sword(true), "it_sword_new");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/items/Sword.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/Sword.hh
===================================================================
--- trunk/src/items/Sword.hh	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items/Sword.hh	2008-12-15 23:51:27 UTC (rev 1397)
@@ -0,0 +1,47 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef SWORDITEM_HH
+#define SWORDITEM_HH
+
+#include "items.hh"
+
+#include "enigma.hh"
+
+namespace enigma {
+    /**
+     */
+    class Sword : public Item, public TimeHandler {
+        CLONEOBJ(Sword);
+        DECL_ITEMTRAITS;
+
+    public:
+        Sword(bool isNew);
+
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+        virtual void on_removal(GridPos p);
+        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
+
+        // TimeHandler interface
+        virtual void alarm();
+    };
+   
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/items/Sword.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/Umbrella.cc
===================================================================
--- trunk/src/items/Umbrella.cc	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items/Umbrella.cc	2008-12-15 23:51:27 UTC (rev 1397)
@@ -0,0 +1,77 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "items/Umbrella.hh"
+//#include "errors.hh"
+//#include "main.hh"
+//#include "server.hh"
+//#include "player.hh"
+#include "world.hh"
+
+namespace enigma {
+
+    Umbrella::Umbrella(bool isNew) : Item() {
+        if (isNew) {
+            objFlags |= ALL_DIRECTIONS;
+        }
+    }
+    
+    void Umbrella::on_creation(GridPos p) {
+        if ((objFlags & ALL_DIRECTIONS) == ALL_DIRECTIONS) {
+            // a new transformed umbrella
+            GameTimer.set_alarm(this, 0.2, false);
+        } else {
+            updateCurrentLightDirs();
+            activatePhoto();
+        }
+        Item::on_creation(p);
+    }
+    
+    void Umbrella::on_removal(GridPos p) {
+        GameTimer.remove_alarm(this);
+        objFlags &= ~ALL_DIRECTIONS;
+        Item::on_removal(p);
+    }
+    
+    void Umbrella::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
+        if (added_dirs(oldDirs, newDirs) != 0 && server::GameCompatibility != enigma::GAMET_PEROXYD) {
+            sound_event ("itemtransform");
+            replace("it-explosion1");
+        }
+    }
+    
+    ItemAction Umbrella::activate(Actor *a, GridPos) {
+        SendMessage(a, "shield");
+        return ITEM_KILL;
+    }
+    
+    void Umbrella::alarm() {
+            DirectionBits db = updateCurrentLightDirs();
+            activatePhoto();        
+    }
+
+    DEF_ITEMTRAITS (Umbrella, "it_umbrella", it_umbrella);
+
+    BOOT_REGISTER_START
+        BootRegister(new Umbrella(false), "it_umbrella");
+        BootRegister(new Umbrella(true), "it_umbrella_new");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/items/Umbrella.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/Umbrella.hh
===================================================================
--- trunk/src/items/Umbrella.hh	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items/Umbrella.hh	2008-12-15 23:51:27 UTC (rev 1397)
@@ -0,0 +1,50 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef UMBRELLAITEM_HH
+#define UMBRELLAITEM_HH
+
+#include "items.hh"
+
+#include "enigma.hh"
+
+namespace enigma {
+    /**
+     */
+    class Umbrella : public Item, public TimeHandler {
+        CLONEOBJ(Umbrella);
+        DECL_ITEMTRAITS;
+
+    public:
+        Umbrella(bool isNew);
+
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+        virtual void on_removal(GridPos p);
+        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
+
+        // Item interface
+        virtual ItemAction activate(Actor* a, GridPos p);
+        
+        // TimeHandler interface
+        virtual void alarm();
+    };
+   
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/items/Umbrella.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-12-15 23:46:13 UTC (rev 1396)
+++ trunk/src/items.cc	2008-12-15 23:51:27 UTC (rev 1397)
@@ -159,11 +159,7 @@
 
 namespace
 {
-    DEF_ITEM(MagicWand, "it_magicwand", it_magicwand);
-    DEF_ITEM(Floppy,    "it_floppy", it_floppy);
-    DEF_ITEM(Key,       "it_key", it_key);
     DEF_ITEM(Odometer,  "it-odometer", it_odometer);
-    DEF_ITEM(Wrench,    "it_wrench", it_wrench);
     DEF_ITEMF(Coffee,   "it-coffee", it_coffee, itf_inflammable);
 }
 
@@ -284,251 +280,6 @@
     };
     DEF_ITEMTRAITS(Banana, "it-banana", it_banana);
 
-/* -------------------- Sword -------------------- */
-
-    class Sword : public Item, public TimeHandler {
-        CLONEOBJ(Sword);
-        DECL_ITEMTRAITS;
-
-    public:
-        Sword(bool isNew);
-
-        // GridObject interface
-        virtual void on_creation(GridPos p);
-        virtual void on_removal(GridPos p);
-        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
-
-        // TimeHandler interface
-        virtual void alarm();
-    };
-
-    Sword::Sword(bool isNew) : Item() {
-        if (isNew) {
-            objFlags |= ALL_DIRECTIONS;
-        }
-    }
-
-    void Sword::on_creation(GridPos p) {
-        if ((objFlags & ALL_DIRECTIONS) == ALL_DIRECTIONS) {
-            // a new transformed hammer
-            GameTimer.set_alarm(this, 0.2, false);
-        } else {
-            updateCurrentLightDirs();
-            activatePhoto();
-        }
-        Item::on_creation(p);
-    }
-    
-    void Sword::on_removal(GridPos p) {
-        GameTimer.remove_alarm(this);
-        objFlags &= ~ALL_DIRECTIONS;
-        Item::on_removal(p);
-    }
-
-    
-    void Sword::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
-        if (added_dirs(oldDirs, newDirs) != 0) {
-            sound_event ("itemtransform");
-            transform("it_hammer_new");
-        }
-    }
-    
-    void Sword::alarm() {
-            updateCurrentLightDirs();
-            activatePhoto();        
-    }
-    
-    DEF_ITEMTRAITS(Sword, "it_sword", it_sword);
-
-/* -------------------- Hammer -------------------- */
-
-    class Hammer : public Item, public TimeHandler {
-        CLONEOBJ(Hammer);
-        DECL_ITEMTRAITS;
-
-    public:
-        Hammer(bool isNew);
-
-        // GridObject interface
-        virtual void on_creation(GridPos p);
-        virtual void on_removal(GridPos p);
-        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
-
-        // TimeHandler interface
-        virtual void alarm();
-    };
-    
-    Hammer::Hammer(bool isNew) : Item() {
-        if (isNew) {
-            objFlags |= ALL_DIRECTIONS;
-        }
-    }
-    
-    void Hammer::on_creation(GridPos p) {
-        if ((objFlags & ALL_DIRECTIONS) == ALL_DIRECTIONS) {
-            // a new transformed hammer
-            GameTimer.set_alarm(this, 0.2, false);
-        } else {
-            updateCurrentLightDirs();
-            activatePhoto();
-        }
-        Item::on_creation(p);
-    }
-    
-    void Hammer::on_removal(GridPos p) {
-        GameTimer.remove_alarm(this);
-        objFlags &= ~ALL_DIRECTIONS;
-        Item::on_removal(p);
-    }
-    
-    void Hammer::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
-        if (added_dirs(oldDirs, newDirs) != 0 && server::GameCompatibility != enigma::GAMET_PEROXYD) {
-            sound_event ("itemtransform");
-            transform("it_sword_new");
-        }
-    }
-    
-    void Hammer::alarm() {
-            DirectionBits db = updateCurrentLightDirs();
-            activatePhoto();        
-    }
-    
-    DEF_ITEMTRAITS(Hammer, "it_hammer", it_hammer);
-
-
-/* -------------------- ExtraLife -------------------- */
-
-    class ExtraLife : public Item, public TimeHandler {
-        CLONEOBJ(ExtraLife);
-        DECL_ITEMTRAITS;
-        
-    public:
-        ExtraLife(bool isNew);
-
-        // GridObject interface
-        virtual void on_creation(GridPos p);
-        virtual void on_removal(GridPos p);
-        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
-        
-        // Item interface
-        virtual string get_inventory_model();
-        virtual void setup_successor(Item *newitem);
-
-        // TimeHandler interface
-        virtual void alarm();
-    };
-
-    ExtraLife::ExtraLife(bool isNew) : Item() {
-        if (isNew) {
-            objFlags |= ALL_DIRECTIONS;
-        }
-    }
-    
-    std::string ExtraLife::get_inventory_model() {
-        if (player::CurrentPlayer()==0)
-            return "inv-blackball";
-        else
-            return "inv-whiteball";
-    }
-
-    void ExtraLife::on_creation(GridPos p) {
-        if ((objFlags & ALL_DIRECTIONS) == ALL_DIRECTIONS) {
-            // a new transformed extralife
-            GameTimer.set_alarm(this, 0.2, false);
-        } else {
-            updateCurrentLightDirs();
-            activatePhoto();
-        }
-        Item::on_creation(p);
-    }
-    
-    void ExtraLife::on_removal(GridPos p) {
-        GameTimer.remove_alarm(this);
-        objFlags &= ~ALL_DIRECTIONS;
-        Item::on_removal(p);
-    }
-    
-    void ExtraLife::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
-        if (added_dirs(oldDirs, newDirs) != 0) {
-            sound_event ("itemtransform");
-            replace("it_glasses");
-        }
-    }
-    
-    void  ExtraLife::setup_successor(Item *newitem) {
-        newitem->setState(server::ExtralifeGlasses);
-    }
-    
-    void ExtraLife::alarm() {
-            DirectionBits db = updateCurrentLightDirs();
-            activatePhoto();        
-    }
-
-    DEF_ITEMTRAITS(ExtraLife, "it_extralife", it_extralife);
-
-/* -------------------- Umbrella -------------------- */
-
-    class Umbrella : public Item, public TimeHandler {
-        CLONEOBJ(Umbrella);
-        DECL_ITEMTRAITS;
-
-    public:
-        Umbrella(bool isNew);
-
-        // GridObject interface
-        virtual void on_creation(GridPos p);
-        virtual void on_removal(GridPos p);
-        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
-
-        // Item interface
-        virtual ItemAction activate(Actor* a, GridPos p);
-        
-        // TimeHandler interface
-        virtual void alarm();
-    };
-
-    Umbrella::Umbrella(bool isNew) : Item() {
-        if (isNew) {
-            objFlags |= ALL_DIRECTIONS;
-        }
-    }
-    
-    void Umbrella::on_creation(GridPos p) {
-        if ((objFlags & ALL_DIRECTIONS) == ALL_DIRECTIONS) {
-            // a new transformed umbrella
-            GameTimer.set_alarm(this, 0.2, false);
-        } else {
-            updateCurrentLightDirs();
-            activatePhoto();
-        }
-        Item::on_creation(p);
-    }
-    
-    void Umbrella::on_removal(GridPos p) {
-        GameTimer.remove_alarm(this);
-        objFlags &= ~ALL_DIRECTIONS;
-        Item::on_removal(p);
-    }
-    
-    void Umbrella::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
-        if (added_dirs(oldDirs, newDirs) != 0 && server::GameCompatibility != enigma::GAMET_PEROXYD) {
-            sound_event ("itemtransform");
-            replace("it-explosion1");
-        }
-    }
-    
-    ItemAction Umbrella::activate(Actor *a, GridPos) {
-        SendMessage(a, "shield");
-        return ITEM_KILL;
-    }
-    
-    void Umbrella::alarm() {
-            DirectionBits db = updateCurrentLightDirs();
-            activatePhoto();        
-    }
-
-    DEF_ITEMTRAITS (Umbrella, "it_umbrella", it_umbrella);
-
 /* -------------------- Spoon -------------------- */
 namespace
 {
@@ -602,103 +353,6 @@
     DEF_ITEMTRAITSF(BrokenBooze, "it-booze-broken", it_booze_broken, itf_static | itf_indestructible);
 }
 
-/* -------------------- Brush -------------------- */
-    /* Can "paint" some stones and remove ash. */
-    class Brush : public Item {
-        CLONEOBJ(Brush);
-        DECL_ITEMTRAITS;
-
-    public:
-        Brush();
-        
-        // Item interface
-        virtual ItemAction activate(Actor* a, GridPos p);
-    };
-    
-    Brush::Brush() {
-    }
-    
-    ItemAction Brush::activate(Actor *a, GridPos p) {
-        if (Item *it = GetItem(p))
-            SendMessage (it, "_brush");
-        return ITEM_DROP;
-    }
-    
-    DEF_ITEMTRAITSF(Brush, "it_brush", it_brush, itf_inflammable);
-
-
-
-/* -------------------- Coins -------------------- */
-
-// TODO id renaming when names are stable
-
-    class Coin : public Item {
-        CLONEOBJ(Coin);
-        DECL_ITEMTRAITS_ARRAY(3, state);
-
-    public:
-        Coin(int type);
-        static void setup();
-        
-        // Object interface
-        virtual std::string getClass() const;
-
-        // StateObject interface
-        virtual void setState(int extState);
-
-        // GridObject interface
-        virtual void processLight(Direction d);
-        
-        // Item interface
-        virtual void on_stonehit(Stone *st);
-    };
-    
-    void Coin::setup() {
-        RegisterItem (new Coin(0));
-        RegisterItem (new Coin(1));
-        RegisterItem (new Coin(2));
-    }
-
-    Coin::Coin(int type) {
-        state = type;
-        setAttr("coin_value", state == 0 ? 3.0 : (state == 1 ? 6.0 : 12.0));
-    }
-    
-    std::string Coin::getClass() const {
-        return "it_coin";
-    }
-    
-    void Coin::setState(int extState) {
-        // ignore any state access
-    }
-
-    void Coin::processLight(Direction d) {
-        sound_event("itemtransform");
-        switch (state) {
-            case 0 : 
-                transform("it_umbrella_new"); break;
-            case 1 :
-                transform("it_hammer_new"); break;
-            case 2 :
-                transform("it_extralife_new"); break;
-        }
-    }
-
-    void Coin::on_stonehit(Stone *) {
-        if (state <= 1) {
-            state += 1;
-            setAttr("coin_value", (state == 1 ? 6.0 : 12.0));  // API 1 compatibility
-            init_model();
-        }
-
-    }
-    
-    ItemTraits Coin::traits[3] = {
-        {"it_coin_s",  it_coin1,  itf_none, 0.0},
-        {"it_coin_m",  it_coin2,  itf_none, 0.0},
-        {"it_coin_l",  it_coin4,  itf_none, 0.0},
-    };
-    
 /* -------------------- Springs -------------------- */
 
 /** \page it-spring Spring
@@ -2076,44 +1730,6 @@
     DEF_ITEMTRAITS(Pencil, "it-pencil", it_pencil);
 }
 
-/* -------------------- Death Item  -------------------- */
-    class DeathItem : public Item {
-        CLONEOBJ(DeathItem);
-        DECL_ITEMTRAITS;
-        
-    public:
-        DeathItem();
-        
-        // ModelCallback interface
-        virtual void animcb();
-
-        // Item interface
-        virtual bool actor_hit(Actor *a);
-        
-    };
-    
-    DeathItem::DeathItem() {
-    }
-    
-    void DeathItem::animcb() { 
-        set_model("it_death"); 
-        state = 0;
-     }
-
-    bool DeathItem::actor_hit(Actor *a) {
-        ActorInfo &ai = * a->get_actorinfo();
-        if (!ai.grabbed) {
-            SendMessage(a, "shatter");
-            if (state == 0) {
-                state = 1;
-                set_anim("it_death_anim");
-            }
-        }
-        return false;
-    }
-    
-    DEF_ITEMTRAITSF(DeathItem, "it_death", it_death, itf_static | itf_indestructible);
-
 /* -------------------- it-surprise -------------------- */
 namespace
 {
@@ -2268,15 +1884,12 @@
     RegisterItem (new BlackBombBurning);
     RegisterItem (new Booze);
     RegisterItem (new BrokenBooze);
-    RegisterItem (new Brush);
     Burnable::setup();
     RegisterItem (new ChangeFloorItem);
     RegisterItem (new Cherry);
     RegisterItem (new Coffee);
-    Coin::setup();
     Crack::setup();
     RegisterItem (new Cross);
-    RegisterItem (new DeathItem);
     RegisterItem (new Debris);
     RegisterItem (new Document);
     RegisterItem (new Drop);
@@ -2288,17 +1901,10 @@
     RegisterItem (new Explosion2);
     RegisterItem (new Explosion3);
     Extinguisher::setup();
-    RegisterItem (new ExtraLife(false));
-    Register ("it_extralife_new", new ExtraLife(true));
     RegisterItem (new FlagBlack);
     RegisterItem (new FlagWhite);
-    RegisterItem (new Floppy);
-    RegisterItem (new Hammer(false));
-    Register ("it_hammer_new", new Hammer(true));
     RegisterItem (new Trap);
-    RegisterItem (new Key);
     RegisterItem (new Landmine);
-    RegisterItem (new MagicWand);
     RegisterItem (new Odometer);
     RegisterItem (new OnePKillStone);
     RegisterItem (new OxydBridge);
@@ -2314,14 +1920,9 @@
     RegisterItem (new Springboard);
     RegisterItem (new Squashed);
     RegisterItem (new SurpriseItem);
-    RegisterItem (new Sword(false));
-    Register ("it_sword_new", new Sword(true));
     RegisterItem (new TwoPKillStone);
-    RegisterItem (new Umbrella(false));
-    Register ("it_umbrella_new", new Umbrella(true));
     RegisterItem (new Weight);
     RegisterItem (new WhiteBomb);
-    RegisterItem (new Wrench);
     RegisterItem (new YinYang);
 }
 



From raoul at mail.berlios.de  Tue Dec 16 20:36:56 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Tue, 16 Dec 2008 20:36:56 +0100
Subject: [Enigma-game-svn] r1398 - homepage/input
Message-ID: <200812161936.mBGJaucN012026@sheep.berlios.de>

Author: raoul
Date: 2008-12-16 20:36:56 +0100 (Tue, 16 Dec 2008)
New Revision: 1398

Modified:
   homepage/input/credits.html
   homepage/input/credits_de.html
Log:
-> Update of credits for level designers



Modified: homepage/input/credits.html
===================================================================
--- homepage/input/credits.html	2008-12-15 23:51:27 UTC (rev 1397)
+++ homepage/input/credits.html	2008-12-16 19:36:56 UTC (rev 1398)
@@ -103,23 +103,28 @@
     <p>For various smaller contributions, thanks go to:</p>
     <ul>
         <li>Roberto Bardin&nbsp;&nbsp;&nbsp;(Level design)</li>
+        <li>Thomas Bernhardt&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Nathan Bronecke&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Harry Bruder&nbsp;&nbsp;&nbsp;(LotM articles)</li>
         <li>Alain Busser&nbsp;&nbsp;&nbsp;(Level design, French translation, manual)</li>
         <li>Guy Busser&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Richi B&uuml;tzer&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>capkoh&nbsp;&nbsp;&nbsp;(Level design)</li>
-        <li>Christoph & Anita&nbsp;&nbsp;&nbsp;(Level design)</li>
+        <li>Christoph &amp; Anita&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Serge Dremuk&nbsp;&nbsp;&nbsp;(Russian translation)</li>
         <li>Joseph Dunne&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Xerxes M. Dynatos&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Edward&nbsp;&nbsp;&nbsp;(Level design)</li>
+        <li>Manuel Eisentraut&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Stephanie Fabian&nbsp;&nbsp;&nbsp;(Invaluable bug reports)</li>
+        <li>Johann Freymuth&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Roberto Garc&iacute;a&nbsp;&nbsp;&nbsp;(Spanish translation)</li>
         <li>Andy Geldmacher&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Edwin Groothuis&nbsp;&nbsp;&nbsp;(FreeBSD port)</li>
         <li>Immanuel Herrmann&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>M&aacute;t&eacute; Lehel Juh&aacute;sz&nbsp;&nbsp;&nbsp;(Hungarian translation)</li>
+        <li>Johannes H&uuml;sing&nbsp;&nbsp;&nbsp;(Level design)</li>
+        <li>Brian Huffman&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Samuele Kaplun&nbsp;&nbsp;&nbsp;(Italian translation)</li>
         <li>Jens-Christian Korth&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Manuel K&ouml;nig&nbsp;&nbsp;&nbsp;(Level design, bug reports)</li>
@@ -127,20 +132,23 @@
         <li>Joona Laire&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Markus Laire&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Dominik Lehmann&nbsp;&nbsp;&nbsp;(Level design)</li>
+        <li>Dominik Leipold&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Edward Leuf&nbsp;&nbsp;&nbsp;(Feedback, bug reports)</li>
         <li>Ingo van Lil&nbsp;&nbsp;&nbsp;(Feedback, bug reports)</li>
         <li>Frank van der Loo&nbsp;&nbsp;&nbsp;(Dutch translation)</li>
         <li>Sidney Markowitz&nbsp;&nbsp;&nbsp;(Mac OS X port)</li>
-        <li>Barry & Lori Mead&nbsp;&nbsp;&nbsp;(Level design)</li>
+        <li>Barry &amp; Lori Mead&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Linda Mihalic&nbsp;&nbsp;&nbsp;(English proof reading)</li>
         <li>moonpearl&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Krishnamurti Lelis Lima Vieira Nunes&nbsp;&nbsp;&nbsp;(Portuguese translation)</li>
         <li>Daniel Nylander&nbsp;&nbsp;&nbsp;(Swedish translation)</li>
         <li>Andreas Persenius&nbsp;&nbsp;&nbsp;(Level design)</li>
-	<li>Mark Pulley&nbsp;&nbsp;&nbsp;(Level design)</li>
+        <li>Mark Pulley&nbsp;&nbsp;&nbsp;(Level design)</li>
+        <li>Safalra (Stephen Morley)&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Peter Santo&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Tobias Schmidbauer&nbsp;&nbsp;&nbsp;(Windows installer and icon)</li>
         <li>Achim Settelmeier&nbsp;&nbsp;&nbsp;(RPM specfile)</li>
+        <li>ShadowPhrogg32642342&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Jon Sneyers&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Spaceman&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Ulf Stegemann&nbsp;&nbsp;&nbsp;(Level design)</li>
@@ -148,10 +156,11 @@
         <li>Mikke Surakka (Finnish Translation)</li>
         <li>Andrzej Szombierski&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Tacvek&nbsp;&nbsp;&nbsp;(Lua 5.1 upgrade)</li>
-	<li>James Taylor&nbsp;&nbsp;&nbsp;(Level design)</li>
+        <li>James Taylor&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Michael Terry&nbsp;&nbsp;&nbsp;(.desktop file)</li>
         <li>Ray Wick&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Joe Wreschnig&nbsp;&nbsp;&nbsp;(Manual page)</li>
         <li>Yuriy Zhyromskiy&nbsp;&nbsp;&nbsp;(Russian Manual and Homepage Translation, Slackware Package)</li>
+        <li>/dev/null&nbsp;&nbsp;&nbsp;(Level design)</li>
     </ul>
 </div>

Modified: homepage/input/credits_de.html
===================================================================
--- homepage/input/credits_de.html	2008-12-15 23:51:27 UTC (rev 1397)
+++ homepage/input/credits_de.html	2008-12-16 19:36:56 UTC (rev 1398)
@@ -10,11 +10,11 @@
         </tr>
         <tr>
             <td>Siegfried&nbsp;Fennig</td>
-            <td>Landschaftsdesign, Grafik</td>
+            <td>(Landschaftsdesign), Grafik</td>
         </tr>
         <tr>
             <td>Martin&nbsp;Hawlisch</td>
-            <td>Landschaftsdesign, Grafik, Programmierung</td>
+            <td>(Landschaftsdesign), Grafik, Programmierung</td>
         </tr>
         <tr>
             <td>Daniel&nbsp;Heck</td>
@@ -30,23 +30,23 @@
         </tr>
         <tr>
             <td>Petr&nbsp;Machata</td>
-            <td>Landschaftsdesign, Programmierung</td>
+            <td>(Landschaftsdesign), Programmierung</td>
         </tr>
         <tr>
             <td>Nat&nbsp;Pryce</td>
-            <td>Landschaftsdesign</td>
+            <td>(Landschaftsdesign)</td>
         </tr>
         <tr>
             <td>Jacob&nbsp;Scott</td>
-            <td>Landschaftsdesign</td>
+            <td>(Landschaftsdesign)</td>
         </tr>
         <tr>
             <td>Sven&nbsp;Siggelkow</td>
-            <td>Landschaftsdesign und besondere Oxyd-Expertise</td>
+            <td>(Landschaftsdesign) und besondere Oxyd-Expertise</td>
         </tr>
         <tr>
             <td>Ralf&nbsp;Westram</td>
-            <td>Programmierung, Landschaftsdesign</td>
+            <td>Programmierung, (Landschaftsdesign)</td>
         </tr>
     </table>
 
@@ -58,7 +58,7 @@
         </tr>
         <tr>
             <td>illmind</td>
-            <td>Forum mag-heut.net Administration, Landschaftsdesign</td>
+            <td>Forum mag-heut.net Administration, (Landschaftsdesign)</td>
         </tr>
         <tr>
             <td>Dustin&nbsp;Norlander</td>
@@ -79,11 +79,11 @@
         </tr>
         <tr>
             <td>Erich&nbsp;Schubert</td>
-            <td>Debian/Ubuntu-Pakete, Landschaftsdesign</td>
+            <td>Debian/Ubuntu-Pakete, (Landschaftsdesign)</td>
         </tr>
         <tr>
             <td>Lukas Sch&uuml;ller</td>
-            <td>Landschaftsdesign</td>
+            <td>(Landschaftsdesign)</td>
         </tr>
         <tr>
             <td>Andrew&nbsp;``Necros''&nbsp;Sega</td>
@@ -104,9 +104,10 @@
     <p>F&uuml;r verschiedene kleinere Beitr&auml;ge danken wir:</p>
     <ul>
         <li>Roberto Bardin&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
+        <li>Thomas Bernhardt&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Nathan Bronecke&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Harry Bruder&nbsp;&nbsp;&nbsp;(LdM-Artikel)</li>
-        <li>Alain Busser&nbsp;&nbsp;&nbsp;(Landschaftsdesign, franz&ouml;sische &Uuml;bersetzung und Handbuch)</li>
+        <li>Alain Busser&nbsp;&nbsp;&nbsp;(Landschaftsdesign), franz&ouml;sische &Uuml;bersetzung und Handbuch)</li>
         <li>Guy Busser&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Richi B&uuml;tzer&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>capkoh&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
@@ -115,19 +116,24 @@
         <li>Joseph Dunne&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Xerxes M. Dynatos&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Edward&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
+        <li>Manuel Eisentraut&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Stephanie Fabian&nbsp;&nbsp;&nbsp;(Wertvolle Fehlerberichte)</li>
+        <li>Johann Freymuth&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Roberto Garc&iacute;a&nbsp;&nbsp;&nbsp;(Spanische &Uuml;bersetzung)</li>
         <li>Andy Geldmacher&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Edwin Groothuis&nbsp;&nbsp;&nbsp;(FreeBSD Portierung)</li>
         <li>Immanuel Herrmann&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>M&aacute;t&eacute; Lehel Juh&aacute;sz&nbsp;&nbsp;&nbsp;(Ungarische &Uuml;bersetzung)</li>
+        <li>Johannes H&uuml;sing&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
+        <li>Brian Huffman&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Samuele Kaplun&nbsp;&nbsp;&nbsp;(Italienische &Uuml;bersetzung)</li>
         <li>Jens-Christian Korth&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
-        <li>Manuel K&ouml;nig&nbsp;&nbsp;&nbsp;(Landschaftsdesign, Fehlerberichte)</li>
+        <li>Manuel K&ouml;nig&nbsp;&nbsp;&nbsp;(Landschaftsdesign), Fehlerberichte)</li>
         <li>Johannes Laire&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Joona Laire&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Markus Laire&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Dominik Lehmann&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
+        <li>Dominik Leipold&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Edward Leuf&nbsp;&nbsp;&nbsp;(Feedback, Fehlerberichte)</li>
         <li>Ingo van Lil&nbsp;&nbsp;&nbsp;(Feedback, Fehlerberichte)</li>
         <li>Frank van der Loo&nbsp;&nbsp;&nbsp;(Niederl&auml;ndische &Uuml;bersetzung)</li>
@@ -138,10 +144,12 @@
         <li>Krishnamurti Lelis Lima Vieira Nunes&nbsp;&nbsp;&nbsp;(Portugiesische &Uuml;bersetzung)</li>
         <li>Daniel Nylander&nbsp;&nbsp;&nbsp;(Schwedische &Uuml;bersetzung)</li>
         <li>Andreas Persenius&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
-	<li>Mark Pulley&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
+        <li>Mark Pulley&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
+        <li>Safalra (Stephen Morley)&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Peter Santo&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Tobias Schmidbauer&nbsp;&nbsp;&nbsp;(Windows Installer und Icon)</li>
         <li>Achim Settelmeier&nbsp;&nbsp;&nbsp;(RPM specfile)</li>
+        <li>ShadowPhrogg32642342&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Jon Sneyers&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Spaceman&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Ulf Stegemann&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
@@ -149,10 +157,11 @@
         <li>Mikke Surakka (Finnische &Uuml;bersetzung)</li>
         <li>Andrzej Szombierski&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Tacvek&nbsp;&nbsp;&nbsp;(Lua 5.1 Upgrade)</li>
-	<li>James Taylor&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
+        <li>James Taylor&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Michael Terry&nbsp;&nbsp;&nbsp;(.desktop file)</li>
         <li>Ray Wick&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Joe Wreschnig&nbsp;&nbsp;&nbsp;(Manual page f&uuml;r Unix)
         <li>Yuriy Zhyromskiy&nbsp;&nbsp;&nbsp;(Russisches Handbuch und Homepage, Slackware Paket)</li>
+        <li>/dev/null&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
     </ul>
 </div>



From ral at mail.berlios.de  Thu Dec 18 00:44:45 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 18 Dec 2008 00:44:45 +0100
Subject: [Enigma-game-svn] r1399 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 data/schemas src src/stones
Message-ID: <200812172344.mBHNijdo022481@sheep.berlios.de>

Author: ral
Date: 2008-12-18 00:44:42 +0100 (Thu, 18 Dec 2008)
New Revision: 1399

Added:
   trunk/data/gfx32/st_flash.png
   trunk/data/gfx40/st_flash.png
   trunk/data/gfx48/st_flash.png
   trunk/src/stones/CompatibilityStones.cc
   trunk/src/stones/CompatibilityStones.hh
   trunk/src/stones/FakeStone.cc
   trunk/src/stones/FakeStone.hh
   trunk/src/stones/QuakeStone.cc
   trunk/src/stones/QuakeStone.hh
   trunk/src/stones/SimpleStones.cc
   trunk/src/stones/SimpleStones.hh
Removed:
   trunk/data/gfx32/st-flash.png
   trunk/data/gfx40/st-flash.png
   trunk/data/gfx48/st-flash.png
   trunk/src/stones/FartStone.cc
   trunk/src/stones/FartStone.hh
Modified:
   trunk/data/api1init.lua
   trunk/data/api2init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/data/startup.lua
   trunk/src/Makefile.am
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.cc
   trunk/src/stones.hh
   trunk/src/stones/ChessStone.cc
   trunk/src/stones/OxydStone.cc
   trunk/src/stones/OxydStone.hh
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering
- renaming of "fart" to "quake":
  - st_fart to st_quake
  - class QuakeStone
  - OxydStone color QUAKE
- new class "st_fake":
  - "st_fake_quake" as successor of "st-fakeoxyd"
  - "st_fake_oxyda" to "st_fake_oxyde" as successor of "st-likeoxyda",...
  - attribute flavor with suffix
  - attribute state with IDLE/ACTIVE for quake, CLOSED/OPEN for oxyds
- renaming of "st-flash" to "st_flash"
- code cleanup:
  - file CompatibilityStones for stones not used in Enigma mode
  - file SimpleStones for very simple implemented stones
  - remove obsolete ExplosionStone


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/data/api1init.lua	2008-12-17 23:44:42 UTC (rev 1399)
@@ -165,9 +165,14 @@
     st_door_a = "st-door_a",
     st_door_b = "st-door_b",
     st_door_c = "st-door_c",
-    st_fart = "st-fart",
+    st_fake_quake = "st-fakeoxyd",
+    st_fake_oxyda = "st-likeoxyda",
+    st_fake_oxydb = "st-likeoxydb",
+    st_fake_oxydc = "st-likeoxydc",
+    st_fake_oxydd = "st-likeoxydd",
+    st_flash = "st-flash",
+    st_flhay = "st-flhay",
     st_floppy = "st-floppy",
-    st_flhay = "st-flhay",
     st_flrock = "st-flrock",
     st_fourswitch = "st-fourswitch",
     st_knight = "st-knight",
@@ -278,6 +283,7 @@
     st_puzzle_yellow_nes = "st-puzzle2-nes",
     st_puzzle_yellow_nesw = "st-puzzle2-nesw",
     st_puzzle_yellow_nesw_hollow = "st-puzzle2-hollow",
+    st_quake = "st-fart",
     st_rotator_cw = "st-rotator-right",
     st_rotator_ccw = "st-rotator-left",
     st_rotator_cw_movable = "st-rotator_move-right",
@@ -422,8 +428,23 @@
         enigma._SetAttrib(obj, "faces", "ew")
         enigma._SetAttrib(obj, "state", 1)
         return obj
-    end
-    
+    elseif name == "st-likeoxyda-open" then
+        local obj = enigma._MakeObject("st_fake_oxyda")
+        enigma._SetAttrib(obj, "state", 1)
+        return obj
+    elseif name == "st-likeoxydb-open" then
+        local obj = enigma._MakeObject("st_fake_oxydb")
+        enigma._SetAttrib(obj, "state", 1)
+        return obj
+    elseif name == "st-likeoxydc-open" then
+        local obj = enigma._MakeObject("st_fake_oxydc")
+        enigma._SetAttrib(obj, "state", 1)
+        return obj
+    elseif name == "st-likeoxydd-open" then
+        local obj = enigma._MakeObject("st_fake_oxydd")
+        enigma._SetAttrib(obj, "state", 1)
+        return obj
+    end    
     newname = RenamingObjectsOld2New[name]
     
     if name == "st-laser" then
@@ -636,6 +657,9 @@
      if key == "mousefactor" then
          _key = "adhesion"
      end
+     if key == "blinking" then
+         _key = "state"
+     end
      enigma._SetAttrib(obj, _key, _val)
 end
 
@@ -679,6 +703,9 @@
      if key == "on" then
          _key = "state"
      end
+     if key == "blinking" then
+         _key = "state"
+     end
      if key == "type" and _obj_name == "st-door" then
          local faces = enigma._GetAttrib(obj, "faces")
          if faces == "ns" then val = "h" else val = "v" end

Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/data/api2init.lua	2008-12-17 23:44:42 UTC (rev 1399)
@@ -100,7 +100,7 @@
 OXYD_BROWN  = 11
 OXYD_AUTO   = -1
 OXYD_FAKE   = -2
-OXYD_FART   = -3
+OXYD_QUAKE  = -3
 OXYD_BOLD   = -4
 
 -- direction

Deleted: trunk/data/gfx32/st-flash.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/st_flash.png (from rev 1398, trunk/data/gfx32/st-flash.png)

Deleted: trunk/data/gfx40/st-flash.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/st_flash.png (from rev 1398, trunk/data/gfx40/st-flash.png)

Deleted: trunk/data/gfx48/st-flash.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/st_flash.png (from rev 1398, trunk/data/gfx48/st-flash.png)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/data/models-2d.lua	2008-12-17 23:44:42 UTC (rev 1399)
@@ -943,8 +943,8 @@
 
 -- st-flash --
 do
-    local images = DefSubimages("st-flash", {h=1})
-    DefSolidStone("st-flash", "st-flash1")
+    local images = DefSubimages("st_flash", {h=1})
+    DefSolidStone("st_flash", "st_flash1")
 end
 
 -- st-fourswitch --
@@ -1511,6 +1511,8 @@
         DefAlias("st-oxyde"..color.."-open", "st-oxydb"..color.."-open")
     end
     DefAlias("st-oxyde", "st-oxydb")
+    DefAlias("st-likeoxyde", "st-oxydb")
+    DefAlias("st-likeoxyde-open", "st-likeoxydb-open")
     DefAlias("st-oxyde-3-opening", "st-oxydb-3-opening")
     DefAlias("st-oxyde-pseudo-3", "st-oxydb-pseudo-3")
     DefAlias("st-oxyde-3-closing", "st-oxydb-3-closing")
@@ -1583,13 +1585,8 @@
     DefAnim("st-door_c-closing", ReverseFrames(frames))
 end
 
--- st-fakeoxyd --
+-- st-fakeoxyda --
 do
-    DefStone("st-fakeoxyd", "sh-round", {filename="st-oxydb"})
-    DefAnimImages("fakeoxyd-blink",
-        RepeatAnim(PingPong(BuildFrames(FrameNames("st-fakeoxyd-blink", 1,4),50))))
-    DefRoundStone("st-fakeoxyd-blink", "fakeoxyd-blink")
-
     DefAlias("st-fakeoxyda", "st-oxyda")
 end
 

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/data/schemas/objects.xml	2008-12-17 23:44:42 UTC (rev 1399)
@@ -734,27 +734,49 @@
     <object name="st_door_d">
       <attr name="flavor" value="d"/>
     </object>
-    <object name="st_fart" states="3">
-      <msg name="ignite"/>
-      <msg name="signal"/>
-      <msg name="_explosion"/>
-      <msg name="_trigger"/>
+    <object name="st_fake">
+      <attr name="flavor" default="quake"/>
     </object>
+    <object name="st_fake_quake">
+      <attr name="flavor" value="quake"/>
+    </object>
+    <object name="st_fake_oxyda">
+      <attr name="flavor" value="oxyda"/>
+    </object>
+    <object name="st_fake_oxydb">
+      <attr name="flavor" value="oxydb"/>
+    </object>
+    <object name="st_fake_oxydc">
+      <attr name="flavor" value="oxydc"/>
+    </object>
+    <object name="st_fake_oxydd">
+      <attr name="flavor" value="oxydd"/>
+    </object>
+    <object name="st_fake_oxyde">
+      <attr name="flavor" value="oxyde"/>
+    </object>
+    <object name="st_flash">
+      <attr name="hit_factor"/>
+      <attr name="hit_distortion_xx"/>
+      <attr name="hit_distortion_xy"/>
+      <attr name="hit_distortion_yx"/>
+      <attr name="hit_distortion_yy"/>
+    </object>
     <object name="st_flhay">
       <msg name="fire"/>
       <msg name="heat"/>
       <msg name="fall"/>
     </object>
+    <object name="st_floppy">
+      <msg name="on"/>
+      <msg name="off"/>
+      <msg name="signal"/>
+    </object>
     <object name="st_flrock">
       <msg name="fire"/>
       <msg name="heat"/>
       <msg name="fall"/>
     </object>
-    <object name="st_floppy">
-      <msg name="on"/>
-      <msg name="off"/>
-      <msg name="signal"/>
-    </object>
     <object name="st_fourswitch" states="4">
       <attr name="counterclock"/>
       <action type="dir" statetype="bool"/>
@@ -987,7 +1009,13 @@
     </object>
     <object name="st_puzzle_yellow">
       <attr name="color" value="3"/>
-   </object>
+    </object>
+    <object name="st_quake" states="3">
+      <msg name="ignite"/>
+      <msg name="signal"/>
+      <msg name="_explosion"/>
+      <msg name="_trigger"/>
+    </object>
     <object name="st_rotator">
       <attr name="counterclock"/>
       <attr name="movable" rw="rw"/>

Modified: trunk/data/startup.lua
===================================================================
--- trunk/data/startup.lua	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/data/startup.lua	2008-12-17 23:44:42 UTC (rev 1399)
@@ -161,14 +161,6 @@
 def_stone_hollow("st-glass2_hole")
 def_stone_glass("st-glass3")
 
-function mkoxydlikes(flavor)
-   def_stone("st-likeoxyd"..flavor)
-   def_stone("st-likeoxyd"..flavor.."-open")
-end
-mkoxydlikes("a")
-mkoxydlikes("b")
-mkoxydlikes("c")
-mkoxydlikes("d")
 
 ------------------------------
 -- Define the simple floors --

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/Makefile.am	2008-12-17 23:44:42 UTC (rev 1399)
@@ -262,14 +262,16 @@
 	stones/ClusterStone.hh	\
 	stones/CoinSlot.cc	\
 	stones/CoinSlot.hh	\
+	stones/CompatibilityStones.cc	\
+	stones/CompatibilityStones.hh	\
 	stones/DeathStone.cc	\
 	stones/DeathStone.hh	\
 	stones/DiscoStone.cc	\
 	stones/DiscoStone.hh	\
 	stones/Door.cc		\
 	stones/Door.hh		\
-	stones/FartStone.cc	\
-	stones/FartStone.hh	\
+	stones/FakeStone.cc	\
+	stones/FakeStone.hh	\
 	stones/FloorBuilder.cc	\
 	stones/FloorBuilder.hh	\
 	stones/FloppySwitch.cc	\
@@ -304,6 +306,8 @@
 	stones/PullStone.hh	\
 	stones/PuzzleStone.cc	\
 	stones/PuzzleStone.hh	\
+	stones/QuakeStone.cc	\
+	stones/QuakeStone.hh	\
 	stones/RotatorStone.cc	\
 	stones/RotatorStone.hh	\
 	stones/RubberbandStone.cc	\
@@ -312,6 +316,8 @@
 	stones/ScissorsStone.hh	\
 	stones/ShogunStone.cc	\
 	stones/ShogunStone.hh	\
+	stones/SimpleStones.cc	\
+	stones/SimpleStones.hh	\
 	stones/StoneImpulse.cc	\
 	stones/StoneImpulse.hh	\
 	stones/SwapStone.cc	\

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/ox_magnum.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -133,7 +133,7 @@
     0,                          // OxydMagnum stone 0x00
     0,0,0,0,0,0,0,0,            // 0x01 -- 0x08  Oxyd stones
     0,0,0,0,0,0,0,0,            // 0x09 -- 0x10  Oxyd stones
-    "st-likeoxydd",             // OxydMagnum stone 0x11
+    "st_fake_oxydd",             // OxydMagnum stone 0x11
     "st-plain",                 // OxydMagnum stone 0x12
     "st_brick_es",              // OxydMagnum stone 0x13
     "st_brick_sw",              // OxydMagnum stone 0x14

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/ox_oxyd1.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -165,7 +165,7 @@
 const char *oxyd::oxyd1_stone_map[256] = {
     0,                          // Oxyd1 stone 0x00
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-    "st-fakeoxyd",              // Oxyd1 stone 0x11
+    "st_fake_quake",             // Oxyd1 stone 0x11
     "st_door_c",                // Oxyd1 stone 0x12
     "st_brick_es",              // Oxyd1 stone 0x13
     "st_brick_sw",              // Oxyd1 stone 0x14

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/ox_peroxyd.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -205,7 +205,7 @@
     0,                          // PerOxyd stone 0x00 no stone
     0,0,0,0,0,0,0,0,            // PerOxyd stone 0x01 - 0x08   oxyd stones
     0,0,0,0,0,0,0,0,            // PerOxyd stone 0x08 - 0x10   oxyd stones
-    "st-likeoxydc",             // PerOxyd stone 0x11
+    "st_fake_oxydc",             // PerOxyd stone 0x11
     "st-plain_break",           // PerOxyd stone 0x12   no, should be destructible with hammer
     "st-rock4",                 // PerOxyd stone 0x13
     "st-beads",                 // PerOxyd stone 0x14
@@ -345,7 +345,7 @@
     "st-grate1",                // PerOxyd stone 0x9a
     "st-metal_hole",            // PerOxyd stone 0x9b
     "st-stone1",                // PerOxyd stone 0x9c
-    "st_fart",                  // PerOxyd stone 0x9d
+    "st_quake",                 // PerOxyd stone 0x9d
     "st_turnstile_red",         // PerOxyd stone 0x9e
     "st_turnstilearm_n",        // PerOxyd stone 0x9f
     "st_turnstilearm_s",        // PerOxyd stone 0xa0

Modified: trunk/src/stones/ChessStone.cc
===================================================================
--- trunk/src/stones/ChessStone.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/ChessStone.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -113,7 +113,7 @@
                 KillStone(get_pos());
                 break;
             default:
-               ASSERT(0, XLevelRuntime, "ChessStone: inconsistent state in animcb()");
+               ASSERT(false, XLevelRuntime, "ChessStone: inconsistent state in animcb()");
         }
     }
 

Added: trunk/src/stones/CompatibilityStones.cc
===================================================================
--- trunk/src/stones/CompatibilityStones.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/CompatibilityStones.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,71 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/CompatibilityStones.hh"
+#include "errors.hh"
+//#include "main.hh"
+
+namespace enigma {
+
+/* -------------------- Oxyd compatibility stones -------------------- */
+
+    /* I have no idea what these stones are _really_ supposed to do;
+       they seemingly do not appear in the landscape and they create
+       normal floor tiles on creation.  Other than that... who
+       knows... */
+
+    Peroxyd_0xb8::Peroxyd_0xb8() {
+    }
+
+    void Peroxyd_0xb8::on_creation (GridPos p) {
+        SetFloor(p, MakeFloor("fl-normal"));
+        KillStone(p);
+    }
+
+    DEF_TRAITSM(Peroxyd_0xb8, "st-peroxyd-0xb8", st_peroxyd_0xb8, MOVABLE_BREAKABLE);
+
+
+    Peroxyd_0xb9::Peroxyd_0xb9() {
+    }
+
+    void Peroxyd_0xb9::on_creation (GridPos p) {
+        SetFloor(p, MakeFloor("fl-normal"));
+        KillStone(p);
+    }
+
+    DEF_TRAITSM(Peroxyd_0xb9, "st-peroxyd-0xb9", st_peroxyd_0xb9, MOVABLE_BREAKABLE);
+
+  
+    Oxyd_0x18::Oxyd_0x18() {
+    }
+        
+    void Oxyd_0x18::on_creation (GridPos p) {
+        KillStone(p);
+    }
+
+    DEF_TRAITSM(Oxyd_0x18, "st-oxyd-0x18", st_oxyd_0x18, MOVABLE_BREAKABLE);
+    
+    BOOT_REGISTER_START
+        BootRegister(new Peroxyd_0xb8(), "st-peroxyd-0xb8");
+        BootRegister(new Peroxyd_0xb9(), "st-peroxyd-0xb9");
+        BootRegister(new Oxyd_0x18(), "st-oxyd-0x18");
+    BOOT_REGISTER_END
+
+} // namespace enigma
+


Property changes on: trunk/src/stones/CompatibilityStones.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/CompatibilityStones.hh
===================================================================
--- trunk/src/stones/CompatibilityStones.hh	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/CompatibilityStones.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,63 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef COMPATIBILITYSTONES_HH
+#define COMPATIBILITYSTONES_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class Peroxyd_0xb8 : public Stone {
+        CLONEOBJ(Peroxyd_0xb8);
+        DECL_TRAITS;
+    public:
+        Peroxyd_0xb8();
+
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+    };
+
+    class Peroxyd_0xb9 : public Stone {
+        CLONEOBJ(Peroxyd_0xb9);
+        DECL_TRAITS;
+    public:
+        Peroxyd_0xb9();
+
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+    };
+
+    class Oxyd_0x18 : public Stone {
+        CLONEOBJ(Oxyd_0x18);
+        DECL_TRAITS;
+    public:
+        Oxyd_0x18();
+        
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+    };
+
+} // namespace enigma
+
+#endif /*COMPATIBILITYSTONES_HH*/


Property changes on: trunk/src/stones/CompatibilityStones.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/FakeStone.cc
===================================================================
--- trunk/src/stones/FakeStone.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/FakeStone.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,140 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/FakeStone.hh"
+#include "errors.hh"
+//#include "main.hh"
+
+namespace enigma {
+    FakeStone::FakeStone(int subtyp) : Stone() {
+        objFlags |= (subtyp << 24);
+    }
+    
+    std::string FakeStone::getClass() const {
+        return "st_fake";
+    }
+    
+    void FakeStone::setAttr(const string& key, const Value &val) {
+        if (key == "flavor") {
+            std::string fl = val.to_string();
+            FakeStoneTyp typ = QUAKE;
+            if (fl == "quake") typ = QUAKE;
+            else if (fl == "oxyda") typ = OXYDA;
+            else if (fl == "oxydb") typ = OXYDB;
+            else if (fl == "oxydc") typ = OXYDC;
+            else if (fl == "oxydd") typ = OXYDD;
+            else if (fl == "oxyde") typ = OXYDE;
+            else
+                ASSERT(false, XLevelRuntime, ecl::strf("Fake stone with illegal flavor value: %s", fl.c_str()).c_str());
+            objFlags = objFlags & OBJBIT_SUBTYP | (typ << 24);
+            if (isDisplayable())
+                init_model();
+            return;
+        } else
+            Stone::setAttr(key, val);
+    }
+    
+    Value FakeStone::getAttr(const std::string &key) const {
+        if (key == "flavor") {
+            return getFlavor();
+        } else
+            return Stone::getAttr(key);
+    }
+
+    void FakeStone::setState(int extState) {
+        if (isDisplayable()) {
+            if (((objFlags & OBJBIT_SUBTYP) >> 25) == QUAKE && state != extState) {
+                state = extState;
+                init_model();
+            }
+            // oxyd fakes do not allow a state change once they are set
+        } else
+            Stone::setState(extState);
+    }
+    
+    void FakeStone::init_model() {
+        FakeStoneTyp typ = (FakeStoneTyp)((objFlags & OBJBIT_SUBTYP) >> 24);
+        switch (typ) {
+            case QUAKE:
+                if (state == ACTIVE)
+                    set_anim("st-farting");
+                else
+                    set_model("st-fart");
+                break;
+            case OXYDA:
+            case OXYDB:
+            case OXYDC:
+            case OXYDD:
+            case OXYDE:
+                set_model(ecl::strf("st-like%s%s", getFlavor().c_str(), state == IDLE ? "" : "-open").c_str());
+                break;
+        }
+    }
+    
+    void FakeStone::animcb() {
+        state = IDLE;
+        init_model();
+    }
+
+    const char * FakeStone::collision_sound() {
+        if ((FakeStoneTyp)((objFlags & OBJBIT_SUBTYP) >> 24) == QUAKE)
+            return "metal";
+        else
+            return "stone";
+    }
+    
+    void FakeStone::actor_hit(const StoneContact &sc) {
+        if (((objFlags & OBJBIT_SUBTYP) >> 24) == QUAKE && state == IDLE) {
+            sound_event ("fakeoxyd");
+            state = ACTIVE;
+            init_model();
+        } else
+            Stone::actor_hit(sc);
+    }
+    
+    std::string FakeStone::getFlavor() const {
+        FakeStoneTyp typ = (FakeStoneTyp)((objFlags & OBJBIT_SUBTYP) >> 24);
+        switch (typ) {
+            case QUAKE:
+                return "quake";
+            case OXYDA:
+                return "oxyda";
+            case OXYDB:
+                return "oxydb";
+            case OXYDC:
+                return "oxydc";
+            case OXYDD:
+                return "oxydd";
+            case OXYDE:
+                return "oxyde";
+        }
+    }
+    
+    BOOT_REGISTER_START
+        BootRegister(new FakeStone(0), "st_fake_quake");
+        BootRegister(new FakeStone(1), "st_fake_oxyda");
+        BootRegister(new FakeStone(2), "st_fake_oxydb");
+        BootRegister(new FakeStone(3), "st_fake_oxydc");
+        BootRegister(new FakeStone(4), "st_fake_oxydd");
+        BootRegister(new FakeStone(5), "st_fake_oxyde");
+    BOOT_REGISTER_END
+
+} // namespace enigma
+


Property changes on: trunk/src/stones/FakeStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/FakeStone.hh
===================================================================
--- trunk/src/stones/FakeStone.hh	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/FakeStone.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,80 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef FAKESTONE_HH
+#define FAKESTONE_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class FakeStone : public Stone {
+         CLONEOBJ(FakeStone);
+
+    private:
+        enum iState {
+            IDLE,     ///< standard fake stone - idle or closed
+            ACTIVE    ///< a blinking quake or opened oxyd
+        };
+        
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_SUBTYP    =   7<<24   ///< the FakeStoneTyp
+        };
+        
+        enum FakeStoneTyp {
+            QUAKE = 0,
+            OXYDA,
+            OXYDB,
+            OXYDC,
+            OXYDD,
+            OXYDE
+        };
+    public:
+        FakeStone(int subtyp);
+        
+        // Object interface
+        virtual std::string getClass() const;
+        virtual void setAttr(const string& key, const Value &val);
+        virtual Value getAttr(const std::string &key) const;
+        
+        // StateObject interface
+        virtual void setState(int extState);
+        
+        // GridObject interface
+        virtual void init_model();
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual const char *collision_sound();
+        virtual void actor_hit(const StoneContact &sc);
+    
+    private:
+        // Private methods.
+        std::string getFlavor() const;
+    };
+
+} // namespace enigma
+
+#endif /*FLOORBUILDERSTONE_HH*/


Property changes on: trunk/src/stones/FakeStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Deleted: trunk/src/stones/FartStone.cc
===================================================================
--- trunk/src/stones/FartStone.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/FartStone.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -1,119 +0,0 @@
-/*
- * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2008 Ronald Lamprecht
- *
- * This program is free software; you can redistribute it and/or
- * modify it under the terms of the GNU General Public License
- * as published by the Free Software Foundation; either version 2
- * of the License, or (at your option) any later version.
- *  
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along
- * with this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
- *
- */
-
-#include "stones/FartStone.hh"
-#include "player.hh"
-#include "world.hh"
-//#include "main.hh"
-
-namespace enigma {
-    FartStone::FartStone() {
-    }
-    
-    std::string FartStone::getClass() const {
-        return "st_fart";
-    }
-    
-    Value FartStone::message(const Message &m) {
-        if (m.message == "toggle" || (m.message == "signal" && m.value != 0) ||
-                (m.message == "_trigger" && m.value.to_bool())) {
-            setState(ACTIVE);
-            return Value();
-        } else if (m.message == "ignite" || m.message == "_explosion") { 
-            setState(BREAKING);
-            return Value();
-        }
-        return Stone::message(m);
-    }
-
-    int FartStone::maxState() const {
-        return BREAKING;
-    }
-    
-    int FartStone::externalState() const {
-        return (state == ACTIVEBREAKING) ? BREAKING : state;
-    }
-    
-    void FartStone::setState(int extState) {
-        if (state == extState)
-            return;
-            
-        if ((state == IDLE && extState == BREAKING) || (state == ACTIVEBREAKING && extState == IDLE)) {
-            state = BREAKING;
-            if (isDisplayable()) {
-                fart();
-                sound_event("stonedestroy");
-            }
-        } else if (state == IDLE && extState == ACTIVE) {
-            state = ACTIVE;
-            if (isDisplayable())            
-                fart();
-        } else if (state == ACTIVE && extState == IDLE) {
-            state = IDLE;
-        } else if (state == ACTIVE && extState == BREAKING) {
-            state = ACTIVEBREAKING;
-        } else
-            return;
-        
-        if (isDisplayable())
-            init_model();
-    }
-    
-    void FartStone::init_model() {
-        switch (state) {
-            case IDLE:     set_model("st-fart"); break;
-            case ACTIVEBREAKING:
-            case ACTIVE:   set_anim("st-farting"); break;
-            case BREAKING: set_anim("st-fartbreak-anim"); break;
-        }
-    }
-    
-    void FartStone::processLight(Direction d) {
-        setState(BREAKING);
-    }
-
-    void FartStone::animcb() {
-        if (state == ACTIVE || state == ACTIVEBREAKING)
-            setState(IDLE);
-        else if (state == BREAKING)
-            KillStone(get_pos());
-    }
-
-    void FartStone::actor_hit(const StoneContact &sc) {
-        if (player::WieldedItemIs(sc.actor, "it_hammer"))
-            setState(BREAKING);
-        else
-            setState(ACTIVE);
-    }
-    
-    void FartStone::fart() {
-        Object *ox = GetObjectTemplate("st_oxyd");
-        SendMessage(ox, "closeall");
-        sound_event("fart");
-    }
-    
-        
-    DEF_TRAITSM(FartStone, "st_fart", st_fart, MOVABLE_BREAKABLE);
-    
-    BOOT_REGISTER_START
-        BootRegister(new FartStone(), "st_fart");
-    BOOT_REGISTER_END
-
-} // namespace enigma

Deleted: trunk/src/stones/FartStone.hh
===================================================================
--- trunk/src/stones/FartStone.hh	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/FartStone.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -1,71 +0,0 @@
-/*
- * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2008 Ronald Lamprecht
- *
- * This program is free software; you can redistribute it and/or
- * modify it under the terms of the GNU General Public License
- * as published by the Free Software Foundation; either version 2
- * of the License, or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along
- * with this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
- *
- */
-#ifndef FARTSTONE_HH
-#define FARTSTONE_HH
-
-#include "stones.hh"
-
-#include "stones_internal.hh"
-
-namespace enigma {
-
-    /** 
-     * 
-     */
-    class FartStone : public Stone {
-        CLONEOBJ(FartStone);
-        DECL_TRAITS;
-    private:
-        enum iState {
-            IDLE,           ///< 
-            ACTIVE,         ///< 
-            BREAKING,       ///< 
-            ACTIVEBREAKING  ///< active state with a pending breaking 
-        };
-        
-    public:
-        FartStone();
-        
-        // Object interface
-        virtual std::string getClass() const;        
-        virtual Value message(const Message &m);
-        
-        // StateObject interface
-        virtual int maxState() const;
-        virtual int externalState() const;
-        virtual void setState(int extState);
-
-        // GridObject interface
-        virtual void init_model();
-        virtual void processLight(Direction d);
-        
-        // ModelCallback interface
-        virtual void animcb();
-        
-        // Stone interface
-        virtual void actor_hit(const StoneContact &sc);
-
-    private:
-        void fart();
-    };
-
-} // namespace enigma
-
-#endif

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/OxydStone.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -31,7 +31,7 @@
     bool OxydStone::isInit = false;
     std::vector<unsigned short> OxydStone::colorsUsageCount;
     unsigned short OxydStone::shuffledFakeCount;
-    unsigned short OxydStone::shuffledFartCount;
+    unsigned short OxydStone::shuffledQuakeCount;
     unsigned short OxydStone::shuffledBoldCount;
     bool OxydStone::oddUnshuffledColor;
     
@@ -115,7 +115,7 @@
         colorsUsageCount = std::vector<unsigned short>(numColors);
         std::vector<unsigned short>colorsUsageCountNoShuffle(numColors);
         shuffledFakeCount = 0;
-        shuffledFartCount = 0;
+        shuffledQuakeCount = 0;
         shuffledBoldCount = 0;
         oddUnshuffledColor = false;
         
@@ -137,8 +137,8 @@
                     case FAKE:
                         if (!declineShuffle) shuffledFakeCount++;
                         break;
-                    case FART:
-                        if (!declineShuffle) shuffledFartCount++;
+                    case QUAKE:
+                        if (!declineShuffle) shuffledQuakeCount++;
                         break;
                     case BOLD:
                         if (!declineShuffle) shuffledBoldCount++;
@@ -292,7 +292,7 @@
                 base.oxydsCandidatesCount.push_back(countOxyds(candidates));
             }
             base.freeOxydsMask = all;
-            base.freePseudoCount = shuffledFakeCount + shuffledFartCount + shuffledBoldCount;
+            base.freePseudoCount = shuffledFakeCount + shuffledQuakeCount + shuffledBoldCount;
             base.freePairsCount = 0;
             for (int i = 0; i < numColorsAvailable(); i++) {
                 base.freePairsCount += colorsUsageCount[i];
@@ -666,7 +666,7 @@
         unsigned short numColors = numColorsAvailable();
         std::vector<unsigned short> colorsRemainCount = colorsUsageCount;
         unsigned short remainFakeCount = shuffledFakeCount;
-        unsigned short remainFartCount = shuffledFartCount;
+        unsigned short remainQuakeCount = shuffledQuakeCount;
         unsigned short remainBoldCount = shuffledBoldCount;
         
         // distribute colors of pairs with noshuffle, open, blinking oxyds and the pseudooxyds
@@ -676,14 +676,14 @@
                 if ((*itr).selOxyd2Mask == 0) {
                     // a single oxyd -- it must be a pseudo
                     OxydStone *oxyd = levelOxyds[oxydId((*itr).selOxyd1Mask)];
-                    ASSERT(remainFakeCount + remainFartCount + remainBoldCount > 0, XLevelRuntime, "Oxyd shuffle - to few pseudo colors");
-                    int i = IntegerRand(1, remainFakeCount + remainFartCount + remainBoldCount);  // use enigma's internal rand!
+                    ASSERT(remainFakeCount + remainQuakeCount + remainBoldCount > 0, XLevelRuntime, "Oxyd shuffle - to few pseudo colors");
+                    int i = IntegerRand(1, remainFakeCount + remainQuakeCount + remainBoldCount);  // use enigma's internal rand!
                     if (i <= remainFakeCount) {
                         remainFakeCount--;
                         oxyd->setAttr("oxydcolor", FAKE);
-                    } else if ( i <= remainFakeCount + remainFartCount) {
-                        remainFartCount--;
-                        oxyd->setAttr("oxydcolor", FART);
+                    } else if ( i <= remainFakeCount + remainQuakeCount) {
+                        remainQuakeCount--;
+                        oxyd->setAttr("oxydcolor", QUAKE);
                     } else {
                         remainBoldCount--;
                         oxyd->setAttr("oxydcolor", BOLD);
@@ -1025,8 +1025,8 @@
                 // a standard single oxyd is open - close it
                 pairCandidate->set_iState(CLOSING);
             }
-            // open FART and BOLD, keep FAKE closed
-            if ((int)mycolor <= FART)
+            // open QUAKE and BOLD, keep FAKE closed
+            if ((int)mycolor <= QUAKE)
                 set_iState(OPENING);
         }
         else if (state == CLOSED || state == CLOSING) {
@@ -1095,7 +1095,7 @@
         
         state = newState;
         bool didShuffle = false;
-        bool didFart = false;
+        bool didQuake = false;
     
         switch (newState) {
             case CLOSED:
@@ -1108,11 +1108,11 @@
                 break;
         
             case OPEN_SINGLE:
-                if ((int)getAttr("oxydcolor") <= FART) {
+                if ((int)getAttr("oxydcolor") <= QUAKE) {
                     set_anim(basemodelname + "-pseudo" + color);
-                    if ((int)getAttr("oxydcolor") == FART) {
+                    if ((int)getAttr("oxydcolor") == QUAKE) {
                         closeAllStandardOxyds();
-                        didFart = true;
+                        didQuake = true;
                         sound_event("fart");
                     } else if ((int)getAttr("oxydcolor") == BOLD) {
                         sound_event("shuffle");
@@ -1161,7 +1161,7 @@
         }
         // perform action
         if (((int)getAttr("oxydcolor") > AUTO && oldExtState != externalState() && (oldExtState != 1 || externalState() != 2)) // avoid second action of paired oxyd that changes from single to pair open state
-                || didShuffle || didFart)
+                || didShuffle || didQuake)
             performAction(externalState() != 0);
     }
     

Modified: trunk/src/stones/OxydStone.hh
===================================================================
--- trunk/src/stones/OxydStone.hh	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/OxydStone.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -66,11 +66,11 @@
         enum Color {BLUE = 0, RED, GREEN, YELLOW, CYAN, PURPLE, WHITE, BLACK, 
             GREY, ORANGE, PINE, BROWN,
             COLORCOUNT,
-            AUTO = -1,
-            FAKE = -2,
-            FART = -3,
-            BOLD = -4,
-            MIN  = -4
+            AUTO  = -1,
+            FAKE  = -2,
+            QUAKE = -3,
+            BOLD  = -4,
+            MIN   = -4
         };
         enum LogType {NOTHING, SOLUTION, COUNT, ALL};
             
@@ -152,7 +152,7 @@
         static bool isInit;
         static std::vector<unsigned short> colorsUsageCount;
         static unsigned short shuffledFakeCount;
-        static unsigned short shuffledFartCount;
+        static unsigned short shuffledQuakeCount;
         static unsigned short shuffledBoldCount;
         static bool oddUnshuffledColor;
         

Copied: trunk/src/stones/QuakeStone.cc (from rev 1397, trunk/src/stones/FartStone.cc)
===================================================================
--- trunk/src/stones/FartStone.cc	2008-12-15 23:51:27 UTC (rev 1397)
+++ trunk/src/stones/QuakeStone.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,119 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/QuakeStone.hh"
+#include "player.hh"
+#include "world.hh"
+//#include "main.hh"
+
+namespace enigma {
+    QuakeStone::QuakeStone() {
+    }
+    
+    std::string QuakeStone::getClass() const {
+        return "st_quake";
+    }
+    
+    Value QuakeStone::message(const Message &m) {
+        if (m.message == "toggle" || (m.message == "signal" && m.value != 0) ||
+                (m.message == "_trigger" && m.value.to_bool())) {
+            setState(ACTIVE);
+            return Value();
+        } else if (m.message == "ignite" || m.message == "_explosion") { 
+            setState(BREAKING);
+            return Value();
+        }
+        return Stone::message(m);
+    }
+
+    int QuakeStone::maxState() const {
+        return BREAKING;
+    }
+    
+    int QuakeStone::externalState() const {
+        return (state == ACTIVEBREAKING) ? BREAKING : state;
+    }
+    
+    void QuakeStone::setState(int extState) {
+        if (state == extState)
+            return;
+            
+        if ((state == IDLE && extState == BREAKING) || (state == ACTIVEBREAKING && extState == IDLE)) {
+            state = BREAKING;
+            if (isDisplayable()) {
+                fart();
+                sound_event("stonedestroy");
+            }
+        } else if (state == IDLE && extState == ACTIVE) {
+            state = ACTIVE;
+            if (isDisplayable())            
+                fart();
+        } else if (state == ACTIVE && extState == IDLE) {
+            state = IDLE;
+        } else if (state == ACTIVE && extState == BREAKING) {
+            state = ACTIVEBREAKING;
+        } else
+            return;
+        
+        if (isDisplayable())
+            init_model();
+    }
+    
+    void QuakeStone::init_model() {
+        switch (state) {
+            case IDLE:     set_model("st-fart"); break;
+            case ACTIVEBREAKING:
+            case ACTIVE:   set_anim("st-farting"); break;
+            case BREAKING: set_anim("st-fartbreak-anim"); break;
+        }
+    }
+    
+    void QuakeStone::processLight(Direction d) {
+        setState(BREAKING);
+    }
+
+    void QuakeStone::animcb() {
+        if (state == ACTIVE || state == ACTIVEBREAKING)
+            setState(IDLE);
+        else if (state == BREAKING)
+            KillStone(get_pos());
+    }
+
+    void QuakeStone::actor_hit(const StoneContact &sc) {
+        if (player::WieldedItemIs(sc.actor, "it_hammer"))
+            setState(BREAKING);
+        else
+            setState(ACTIVE);
+    }
+    
+    void QuakeStone::fart() {
+        Object *ox = GetObjectTemplate("st_oxyd");
+        SendMessage(ox, "closeall");
+        sound_event("fart");
+    }
+    
+        
+    DEF_TRAITSM(QuakeStone, "st_quake", st_quake, MOVABLE_BREAKABLE);
+    
+    BOOT_REGISTER_START
+        BootRegister(new QuakeStone(), "st_quake");
+    BOOT_REGISTER_END
+
+} // namespace enigma

Copied: trunk/src/stones/QuakeStone.hh (from rev 1397, trunk/src/stones/FartStone.hh)
===================================================================
--- trunk/src/stones/FartStone.hh	2008-12-15 23:51:27 UTC (rev 1397)
+++ trunk/src/stones/QuakeStone.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,71 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef FARTSTONE_HH
+#define FARTSTONE_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class QuakeStone : public Stone {
+        CLONEOBJ(QuakeStone);
+        DECL_TRAITS;
+    private:
+        enum iState {
+            IDLE,           ///< 
+            ACTIVE,         ///< 
+            BREAKING,       ///< 
+            ACTIVEBREAKING  ///< active state with a pending breaking 
+        };
+        
+    public:
+        QuakeStone();
+        
+        // Object interface
+        virtual std::string getClass() const;        
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual int maxState() const;
+        virtual int externalState() const;
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        virtual void processLight(Direction d);
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+
+    private:
+        void fart();
+    };
+
+} // namespace enigma
+
+#endif

Added: trunk/src/stones/SimpleStones.cc
===================================================================
--- trunk/src/stones/SimpleStones.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/SimpleStones.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,49 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Andreas Lochmann
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/SimpleStones.hh"
+#include "errors.hh"
+//#include "main.hh"
+#include "world.hh"
+
+namespace enigma {
+
+/* -------------------- Flash stone -------------------- */
+
+    FlashStone::FlashStone() : Stone ("st_flash") {
+    }
+    
+    std::string FlashStone::getClass() const {
+        return "st_flash";
+    }
+        
+    void FlashStone::actor_hit(const StoneContact &sc) {
+        if (Actor *other = FindOtherMarble(sc.actor)) {
+            other->add_force (distortedVelocity(sc.actor->get_vel(), 20));
+        }
+    }
+    
+    BOOT_REGISTER_START
+        BootRegister(new FlashStone(), "st_flash");
+    BOOT_REGISTER_END
+
+} // namespace enigma
+


Property changes on: trunk/src/stones/SimpleStones.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/SimpleStones.hh
===================================================================
--- trunk/src/stones/SimpleStones.hh	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/SimpleStones.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,47 @@
+/*
+ * Copyright (C) 2008 Andreas Lochmann
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef SIMPLESTONES_HH
+#define SIMPLESTONES_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * FlashStone
+     */
+    class FlashStone : public Stone {
+        CLONEOBJ(FlashStone);
+
+    public:
+        FlashStone();
+
+        // Object interface
+        virtual std::string getClass() const;
+
+        // Stone interface
+        virtual void actor_hit (const StoneContact &sc);
+    };
+
+} // namespace enigma
+
+#endif /*SIMPLESTONES_HH*/


Property changes on: trunk/src/stones/SimpleStones.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -337,37 +337,6 @@
 //  Stones under development :
 
 
-
-/* -------------------- Explosion stone -------------------- */
-namespace
-{
-    class ExplosionStone : public Stone {
-        CLONEOBJ(ExplosionStone);
-        DECL_TRAITS;
-
-        StoneResponse collision_response(const StoneContact &) {
-            return STONE_PASS;
-        }
-
-        void actor_contact (Actor *a) {
-            SendMessage(a, "shatter");
-        }
-        void init_model() {
-            set_anim("st-explosion");
-        }
-
-        void animcb() {
-            KillStone(get_pos());
-        }
-
-    public:
-        ExplosionStone()
-        {}
-    };
-    DEF_TRAITSM(ExplosionStone, "st-explosion", st_explosion, MOVABLE_BREAKABLE);
-}
-
-
 /* -------------------- Charge stone -------------------- */
 
 // Attributes:
@@ -467,77 +436,6 @@
     }
 }
 
-
-/* -------------------- Oxyd compatibility stones -------------------- */
-
-namespace
-{
-    /* I have no idea what these stones are _really_ supposed to do;
-       they seemingly do not appear in the landscape and they create
-       normal floor tiles on creation.  Other than that... who
-       knows... */
-    class Peroxyd_0xb8 : public Stone {
-        CLONEOBJ(Peroxyd_0xb8);
-        DECL_TRAITS;
-    public:
-        Peroxyd_0xb8()
-        {}
-
-        void on_creation (GridPos p) {
-            SetFloor (p, MakeFloor ("fl-normal"));
-            KillStone(p);
-        }
-    };
-    DEF_TRAITSM(Peroxyd_0xb8, "st-peroxyd-0xb8", st_peroxyd_0xb8, MOVABLE_BREAKABLE);
-    
-    class Peroxyd_0xb9 : public Stone {
-        CLONEOBJ(Peroxyd_0xb9);
-        DECL_TRAITS;
-    public:
-        Peroxyd_0xb9()
-        {}
-
-        void on_creation (GridPos p) {
-            SetFloor (p, MakeFloor ("fl-normal"));
-            KillStone(p);
-        }
-    };
-    DEF_TRAITSM(Peroxyd_0xb9, "st-peroxyd-0xb9", st_peroxyd_0xb9, MOVABLE_BREAKABLE);
-    
-    class Oxyd_0x18 : public Stone {
-        CLONEOBJ(Oxyd_0x18);
-        DECL_TRAITS;
-    public:
-        Oxyd_0x18()
-        {}
-        
-        void on_creation (GridPos p) {
-            KillStone (p);
-        }
-    };
-    DEF_TRAITSM(Oxyd_0x18, "st-oxyd-0x18", st_oxyd_0x18, MOVABLE_BREAKABLE);
-}
-
-
-/* -------------------- Flash stone -------------------- */
-namespace
-{
-    class FlashStone : public Stone {
-        CLONEOBJ(FlashStone);
-
-        void actor_hit (const StoneContact &sc) {
-            if (Actor *other = FindOtherMarble(sc.actor)) {
-                other->add_force (distortedVelocity(sc.actor->get_vel(), 20));
-            }
-        }
-
-    public:
-        FlashStone() : Stone ("st-flash")
-        {}
-    };
-}
-
-
 /* -------------------- Surprise stone -------------------- */
 namespace 
 {
@@ -595,6 +493,9 @@
 /* -------------------- Breaking stone -------------------- */
 namespace
 {
+    
+    // only used by Bug stone as replacement!
+    
     class BreakingStone : public Stone {
         CLONEOBJ(BreakingStone);
         DECL_TRAITS;
@@ -973,15 +874,10 @@
 
     // Register(new ...);
 
-    Register (new ExplosionStone);
     Register (new ChargeStone ("st-chargeplus", +1.0));
     Register (new ChargeStone ("st-chargeminus", -1.0));
     Register (new ChargeStone ("st-chargezero", 0.0));
     Register (new SpitterStone);
-    Register (new Peroxyd_0xb8);
-    Register (new Peroxyd_0xb9);
-    Register (new Oxyd_0x18);
-    Register (new FlashStone);
     Register (new SurpriseStone);
     Register (new CoffeeStone);
     Register (new BlackBallsStone);

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -58,7 +58,7 @@
         st_easymode,
         st_explosion,
         st_fakeoxyda,
-        st_fart,
+        st_quake,
         st_firebreak,
         st_firebreak_move,
         st_floorbuilder,

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones_simple.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -968,46 +968,6 @@
     return Stone::message(m);
 }
 
-//----------------------------------------
-// FakeOxydStone
-//----------------------------------------
-
-/** \page st-fakeoxyd Fake Oxyd Stone
-
-These stones look like real Oxyd stones, but they only blink a little
-when touched and do not open or have other special abilities.
-
-\image html st-fakeoxyd-blink_0001.png
-*/
-namespace
-{
-    class FakeOxydStone : public Stone {
-        CLONEOBJ(FakeOxydStone);
-    public:
-        FakeOxydStone() : Stone("st-fakeoxyd"), state(IDLE) {
-            setAttr("blinking", 0.0);
-        }
-    private:
-        enum State { IDLE, BLINKING } state;
-        void actor_hit(const StoneContact &/*sc*/) {
-            if (state == IDLE) {
-                set_anim("st-fakeoxyd-blink");
-                sound_event ("fakeoxyd");
-                state = BLINKING;
-                setAttr("blinking", 1.0);
-            }
-        }
-        const char *collision_sound() {
-            return "metal";
-        }
-        void animcb() {
-            set_model("st-fakeoxyd");
-            state = IDLE;
-            setAttr("blinking", 0.0);
-        }
-    };
-}
-
 /* -------------------- YinYang stones -------------------- */
 namespace
 {
@@ -1288,7 +1248,6 @@
 
     Register(new DummyStone);
     Register(new EasyModeStone);
-    Register(new FakeOxydStone);
     Register(new Grate1);
     Register(new Grate2);
     Register(new Grate3);



From ral at mail.berlios.de  Fri Dec 19 22:20:15 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 19 Dec 2008 22:20:15 +0100
Subject: [Enigma-game-svn] r1400 - trunk/src
Message-ID: <200812192120.mBJLKFHJ008682@sheep.berlios.de>

Author: ral
Date: 2008-12-19 22:20:14 +0100 (Fri, 19 Dec 2008)
New Revision: 1400

Modified:
   trunk/src/client.cc
   trunk/src/display.cc
Log:
Trunk 1.1:
- fix TextDisplay:
  - long strings on a shared world record did pingpong at a crasy speed:
    - cut shared world record holders string like in level selection menu
    - reduce pingpong speed
  - once a long string had been displayed the TextDisplay did remain in
    pingpong mode for all strings - fixed.


Modified: trunk/src/client.cc
===================================================================
--- trunk/src/client.cc	2008-12-17 23:44:42 UTC (rev 1399)
+++ trunk/src/client.cc	2008-12-19 21:20:14 UTC (rev 1400)
@@ -726,14 +726,17 @@
     int    difficulty     = app.state->getInt("Difficulty");
     int    wr_time       = ratingMgr->getBestScore(curProxy, difficulty);
     int    best_user_time = scm->getBestUserScore(curProxy, difficulty);
-    string par_name       = ratingMgr->getBestScoreHolder(curProxy, difficulty);
     int par_time   = ratingMgr->getParScore(curProxy, difficulty);
 
     int    level_time     = round_nearest<int> (m_total_game_time);
 
     string      text;
     bool        timehunt_restart = false;
-
+    
+    std::string par_name  = ratingMgr->getBestScoreHolder(curProxy, difficulty);
+    for (int cut = 2; par_name.length() > 55; cut++)
+        par_name  = ratingMgr->getBestScoreHolder(curProxy, difficulty, cut);
+    
     if (wr_time > 0) {
         if (best_user_time<0 || best_user_time>wr_time) {
             if (level_time == wr_time)
@@ -791,7 +794,7 @@
     if (m_cheater)
         text += _(" Cheater!");
 
-    Msg_ShowText (text, false);
+    Msg_ShowText(text, false);
 
     if (!m_cheater) {
         scm->updateUserScore(curProxy, difficulty, level_time);

Modified: trunk/src/display.cc
===================================================================
--- trunk/src/display.cc	2008-12-17 23:44:42 UTC (rev 1399)
+++ trunk/src/display.cc	2008-12-19 21:20:14 UTC (rev 1400)
@@ -321,7 +321,7 @@
 {
     text = t;
     textsurface.reset(font.render(text.c_str()));
-    
+    pingpong = false;
 
     time = 0;
 
@@ -351,11 +351,10 @@
     if (!scrolling) {// centered text string
         if (area.w < textsurface->width()) {
             pingpong = true;
-            scrollspeed = 4 * (textsurface->width() - area.w) / duration;
+            scrollspeed = (textsurface->width() - area.w) / duration;
             xoff = 0;
         }
         else {
-            pingpong = false;
             xoff = -(area.w - textsurface->width())/2;
             scrollspeed = 0;
         }



From raoul at mail.berlios.de  Sat Dec 20 01:23:01 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sat, 20 Dec 2008 01:23:01 +0100
Subject: [Enigma-game-svn] r1401 - homepage/input
Message-ID: <200812200023.mBK0N1Uo020531@sheep.berlios.de>

Author: raoul
Date: 2008-12-20 01:23:00 +0100 (Sat, 20 Dec 2008)
New Revision: 1401

Modified:
   homepage/input/credits.html
   homepage/input/credits_de.html
Log:
-> Updates of credit pages
--> English and german pages are up to date, all levelauthors since 1.01 added
--> TODO: Russian page


Modified: homepage/input/credits.html
===================================================================
--- homepage/input/credits.html	2008-12-19 21:20:14 UTC (rev 1400)
+++ homepage/input/credits.html	2008-12-20 00:23:00 UTC (rev 1401)
@@ -144,11 +144,11 @@
         <li>Daniel Nylander&nbsp;&nbsp;&nbsp;(Swedish translation)</li>
         <li>Andreas Persenius&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Mark Pulley&nbsp;&nbsp;&nbsp;(Level design)</li>
-        <li>Safalra (Stephen Morley)&nbsp;&nbsp;&nbsp;(Level design)</li>
+        <li>Stephen Morley (Safalra)&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Peter Santo&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Tobias Schmidbauer&nbsp;&nbsp;&nbsp;(Windows installer and icon)</li>
         <li>Achim Settelmeier&nbsp;&nbsp;&nbsp;(RPM specfile)</li>
-        <li>ShadowPhrogg32642342&nbsp;&nbsp;&nbsp;(Level design)</li>
+        <li>ShadowPhrogg32642342 (D&aacute;niel Borb&eacute;ly)&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Jon Sneyers&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Spaceman&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Ulf Stegemann&nbsp;&nbsp;&nbsp;(Level design)</li>

Modified: homepage/input/credits_de.html
===================================================================
--- homepage/input/credits_de.html	2008-12-19 21:20:14 UTC (rev 1400)
+++ homepage/input/credits_de.html	2008-12-20 00:23:00 UTC (rev 1401)
@@ -10,11 +10,11 @@
         </tr>
         <tr>
             <td>Siegfried&nbsp;Fennig</td>
-            <td>(Landschaftsdesign), Grafik</td>
+            <td>Landschaftsdesign, Grafik</td>
         </tr>
         <tr>
             <td>Martin&nbsp;Hawlisch</td>
-            <td>(Landschaftsdesign), Grafik, Programmierung</td>
+            <td>Landschaftsdesign, Grafik, Programmierung</td>
         </tr>
         <tr>
             <td>Daniel&nbsp;Heck</td>
@@ -30,23 +30,23 @@
         </tr>
         <tr>
             <td>Petr&nbsp;Machata</td>
-            <td>(Landschaftsdesign), Programmierung</td>
+            <td>Landschaftsdesign, Programmierung</td>
         </tr>
         <tr>
             <td>Nat&nbsp;Pryce</td>
-            <td>(Landschaftsdesign)</td>
+            <td>Landschaftsdesign</td>
         </tr>
         <tr>
             <td>Jacob&nbsp;Scott</td>
-            <td>(Landschaftsdesign)</td>
+            <td>Landschaftsdesign</td>
         </tr>
         <tr>
             <td>Sven&nbsp;Siggelkow</td>
-            <td>(Landschaftsdesign) und besondere Oxyd-Expertise</td>
+            <td>Landschaftsdesign und besondere Oxyd-Expertise</td>
         </tr>
         <tr>
             <td>Ralf&nbsp;Westram</td>
-            <td>Programmierung, (Landschaftsdesign)</td>
+            <td>Programmierung, Landschaftsdesign</td>
         </tr>
     </table>
 
@@ -58,7 +58,7 @@
         </tr>
         <tr>
             <td>illmind</td>
-            <td>Forum mag-heut.net Administration, (Landschaftsdesign)</td>
+            <td>Forum mag-heut.net Administration, Landschaftsdesign</td>
         </tr>
         <tr>
             <td>Dustin&nbsp;Norlander</td>
@@ -79,11 +79,11 @@
         </tr>
         <tr>
             <td>Erich&nbsp;Schubert</td>
-            <td>Debian/Ubuntu-Pakete, (Landschaftsdesign)</td>
+            <td>Debian/Ubuntu-Pakete, Landschaftsdesign</td>
         </tr>
         <tr>
             <td>Lukas Sch&uuml;ller</td>
-            <td>(Landschaftsdesign)</td>
+            <td>Landschaftsdesign</td>
         </tr>
         <tr>
             <td>Andrew&nbsp;``Necros''&nbsp;Sega</td>
@@ -145,11 +145,11 @@
         <li>Daniel Nylander&nbsp;&nbsp;&nbsp;(Schwedische &Uuml;bersetzung)</li>
         <li>Andreas Persenius&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Mark Pulley&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
-        <li>Safalra (Stephen Morley)&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
+        <li>Stephen Morley (Safalra)&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Peter Santo&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Tobias Schmidbauer&nbsp;&nbsp;&nbsp;(Windows Installer und Icon)</li>
         <li>Achim Settelmeier&nbsp;&nbsp;&nbsp;(RPM specfile)</li>
-        <li>ShadowPhrogg32642342&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
+        <li>ShadowPhrogg32642342 (D&aacute;niel Borb&eacute;ly)&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Jon Sneyers&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Spaceman&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Ulf Stegemann&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>



From ral at mail.berlios.de  Sat Dec 20 01:40:17 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 20 Dec 2008 01:40:17 +0100
Subject: [Enigma-game-svn] r1402 - in trunk: data data/schemas src src/items
	src/stones
Message-ID: <200812200040.mBK0eHPl019564@sheep.berlios.de>

Author: ral
Date: 2008-12-20 01:40:14 +0100 (Sat, 20 Dec 2008)
New Revision: 1402

Modified:
   trunk/data/api1init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/WorldProxy.cc
   trunk/src/actors.cc
   trunk/src/items.cc
   trunk/src/items/SimpleItems.cc
   trunk/src/items/SimpleItems.hh
   trunk/src/items/Vortex.cc
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.cc
   trunk/src/stones/MailStone.cc
   trunk/src/stones/SimpleStones.cc
   trunk/src/stones/SimpleStones.hh
Log:
Trunk 1.1: new API reengineering
- fix old API fart message trigger mapping
- rename global variables:
  - FrictionFactor to FrictionStrength
  - SlopeForce to SlopeStrength
  - ElectricForce to ElectricStrength
- reengineering charge stone:
  - renaming to st_charge, st_charge_zero, st_charge_plus, st_charge_minus
  - attribute "charge", defaults to 0.0, plus equals 1.0, minus equals -1.0,
    but no more limited to any specific value range
  - charge value can be changed on the fly, but the image shows always the
    real sign of the charge
- reengineering items - concerning the new API it is just a renaming:
  - it_cherry
  - it_banana
  - it_squashed
- actors: some code cleanup


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/data/api1init.lua	2008-12-20 00:40:14 UTC (rev 1402)
@@ -59,10 +59,12 @@
     fl_wood_framed = "fl-stwood",
     fl_wood_framed_h = "fl-stwood1",
     fl_wood_framed_v = "fl-stwood2",
+    it_banana = "it-banana",
     it_blocker = "it-blocker",
     it_blocker_new = "it-blocker-new",
     it_brake = "it-brake",
     it_brush = "it-brush",
+    it_cherry = "it-cherry",
     it_coin_s = "it-coin1",
     it_coin_m = "it-coin2",
     it_coin_l = "it-coin4",
@@ -96,6 +98,7 @@
     it_seed = "it-seed",
     it_seed_fake = "it-seed_nowood",
     it_seed_volcano = "it-seed_volcano",
+    it_squashed = "it-squashed",
     it_shogun_s = "it-shogun-s",
     it_shogun_m = "it-shogun-m",
     it_shogun_l = "it-shogun-l",
@@ -153,6 +156,9 @@
     st_brick_new = "st-bigbrick-new",
     st_brick_nes = "st-bigbrick-nes",
     st_brick_nesw = "st-bigbrick-nesw",
+    st_charge_minus = "st-chargeminus",
+    st_charge_plus = "st-chargeplus",
+    st_charge_zero = "st-chargezero",
     st_chess = "st-chess",
     st_chess_black = "st-chess_black",
     st_chess_white = "st-chess_white",
@@ -816,12 +822,10 @@
     st_blocker_new__trigger = "toggle",
     st_boulder__direction = "orientate",
     st_door__openclose = "toggle",
-    st_fart__trigger = "toggle",
     st_fourswitch__trigger = "toggle",
     st_floppy__onoff = "toggle",
     st_key__onoff = "toggle",
     st_laser__onoff = "toggle",
-    st_stoneimpulse__trigger = "signal",
     st_lightpassenger__trigger = "toggle",
     st_lightpassenger__onoff = "toggle",
     st_mirror__trigger = "turn",
@@ -830,6 +834,8 @@
     ["st-plain__trigger"] = "signal",
     ["st-plain_hole__trigger"] = "signal",
     st_polarswitch__onoff = "toggle",
+    st_quake__trigger = "toggle",
+    st_stoneimpulse__trigger = "signal",
     st_switch__onoff = "toggle",
     st_volcano__trigger = "toggle"
 }

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/data/models-2d.lua	2008-12-20 00:40:14 UTC (rev 1402)
@@ -432,12 +432,10 @@
 do
     itemlist = {
         "it-bag",
-        "it-banana",
         "it-blackbomb",
         "it-blocker",
         "it-booze",
         "it-booze-broken",
-        "it-cherry",
         "it-document",
         "it-drop",
         "it-dynamite",
@@ -449,7 +447,6 @@
         "it-ring",
         "it-spade",
         "it-spoon",
-        "it-squashed",
         "it-spring1",
         "it-spring2",
         "it-surprise",
@@ -459,8 +456,10 @@
 
     DefImages(itemlist)
 
-    DefImage("it-brake", {filename="st-brake"})
+    DefImage("it_banana", {filename="it-banana"})
+    DefImage("it_brake", {filename="st-brake"})
     DefImage("it_brush", {filename="it-brush"})
+    DefImage("it_cherry", {filename="it-cherry"})
     DefImage("it_coin_s", {filename="it-coin1"})
     DefImage("it_coin_m", {filename="it-coin2"})
     DefImage("it_coin_l", {filename="it-coin4"})
@@ -480,6 +479,7 @@
     DefImage("it_meditation_volcano", {filename="it_meditation_volcano"})
     DefImage("it_meditation_caldera", {filename="it_meditation_caldera"})
     DefImage("it_rubberband", {filename="it-rubberband"})
+    DefImage("it_squashed", {filename="it-squashed"})
     DefImage("it_sword", {filename="it-sword"})
     DefImage("it_umbrella", {filename="it-umbrella"})
     DefImage("it_wrench", {filename="it-wrench"})

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/data/schemas/objects.xml	2008-12-20 00:40:14 UTC (rev 1402)
@@ -8,6 +8,7 @@
     <attr name="anchor2" type="tokens" default="nil" rw="rw"/>
     <attr name="autoclose" type="bool" default="false" rw="rw"/>
     <attr name="burnable" type="bool" default="nil" rw="rw"/>
+    <attr name="charge" type="double" default="0" rw="rw"/>
     <attr name="cluster" type="int" default="nil" min="0" max="9" rw="rw"/>
     <attr name="code" type="int" default="1" rw="rw"/>
     <attr name="coin_value" type="double" default="1" rw="rw"/>
@@ -69,6 +70,7 @@
     <attr name="transparent" type="bool" default="false" rw="rw"/>
     <attr name="threshold" type="double" default="0" rw="rw"/>
     <attr name="wires" type="group" default="nil" rw="r"/>
+    <attr name="$charge" type="int" default="0" min="-1" max="1" rw=""/>
     <attr name="$firetransform" type="string" default="" rw=""/>
     <attr name="$heattransform" type="string" default="" rw=""/>
   </attributes>
@@ -111,10 +113,12 @@
     <msg name="_capture" type="nil"/>
     <msg name="_checkflood" type="nil"/>
     <msg name="_explosion" type="nil"/>
+    <msg name="_fallvortex" type="nil"/>
     <msg name="_freeze" type="nil"/>
     <msg name="_glasses" type="nil"/>
     <msg name="_hit" type="object"/>
     <msg name="_init" type="nil"/>
+    <msg name="_invisibility" type="nil"/>
     <msg name="_jumping" type="bool"/>
     <msg name="_model_reanimated" type="nil"/>
     <msg name="_passed" type="nil"/>            <!-- check type-->
@@ -240,6 +244,7 @@
     <object name="fl_wood_framed_h" init="true"/>
     <object name="fl_wood_framed_v" init="true"/>
     <object name="it" abstract="true"/>
+    <object name="it_banana"/>
     <object name="it_blocker">
       <attr name="autoclose"/>
       <msg name="close"/>
@@ -252,6 +257,7 @@
     </object>
     <object name="it_brake"/>
     <object name="it_brush"/>
+    <object name="it_cherry"/>
     <object name="it_coin">
       <attr name="coin_value" default="3"/>
       <attr name="state" rw="r"/>
@@ -404,6 +410,9 @@
     <object name="it_shogun_l">
       <attr name="flavor" value="l"/>
     </object>
+    <object name="it_squashed">
+      <msg name="_brush"/>
+    </object>
     <object name="it_strip">
       <attr name="connections"/>
       <attr name="friction"/>
@@ -670,6 +679,19 @@
     <object name="st_brick_nesw">
       <attr name="connections" value="nesw"/>
     </object>
+    <object name="st_charge">
+      <attr name="charge"/>
+      <attr name="$charge"/>
+    </object>
+    <object name="st_charge_zero">
+      <attr name="$charge" value="0"/>
+    </object>
+    <object name="st_charge_plus">
+      <attr name="$charge" value="1"/>
+    </object>
+    <object name="st_charge_minus">
+      <attr name="$charge" value="-1"/>
+    </object>
     <object name="st_chess">
       <attr name="color" default="0"/>
       <attr name="movable" default="true" rw="r"/>

Modified: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/WorldProxy.cc	2008-12-20 00:40:14 UTC (rev 1402)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2007 Ronald Lamprecht
+ * Copyright (C) 2007,2008 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -78,11 +78,11 @@
             return server::Brittleness;
         } else if (key == "ActorimpulseStrength") {
             return server::BumperForce;
-        } else if (key == "ElectricForce") {
+        } else if (key == "ElectricStrength") {
             return server::ElectricForce;
         } else if (key == "ExtralifeGlasses") {
             return server::ExtralifeGlasses;
-        } else if (key == "FrictionFactor") {
+        } else if (key == "FrictionStrength") {
             return server::FrictionFactor;
         } else if (key == "MeditationStrength") {
             return server::HoleForce;
@@ -94,7 +94,7 @@
             return server::MaxOxydColor;
         } else if (key == "RubberViolationStrength") {
             return server::RubberViolationStrength;
-        } else if (key == "SlopeForce") {
+        } else if (key == "SlopeStrength") {
             return server::SlopeForce;
         } else if (key == "SwampSinkSpeed") {
             return server::SwampSinkSpeed;
@@ -162,11 +162,11 @@
             server::Brittleness = val;
         } else if (key == "ActorimpulseStrength") {
             server::BumperForce = val;
-        } else if (key == "ElectricForce") {
+        } else if (key == "ElectricStrength") {
             server::ElectricForce = val;
         } else if (key == "ExtralifeGlasses") {
             server::ExtralifeGlasses = val;
-        } else if (key == "FrictionFactor") {
+        } else if (key == "FrictionStrength") {
             server::FrictionFactor = val;
         } else if (key == "MeditationStrength") {
             server::HoleForce = val;
@@ -182,7 +182,7 @@
                     "Attribute 'MaxOxydColor' value is out of range.");
         } else if (key == "RubberViolationStrength") {
             server::RubberViolationStrength = val;
-        } else if (key == "SlopeForce") {
+        } else if (key == "SlopeStrength") {
             server::SlopeForce = val;
         } else if (key == "SwampSinkSpeed") {
             server::SwampSinkSpeed = val;

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/actors.cc	2008-12-20 00:40:14 UTC (rev 1402)
@@ -625,7 +625,6 @@
             NO_STATE,
             NORMAL,
             SHATTERING,
-            DROWNING,
             BUBBLING,
             FALLING,            // falling into abyss
             JUMPING,
@@ -782,13 +781,10 @@
             } else if (m.message == "laserhit") {
                 change_state_noshield(SHATTERING);
                 handled = true;
-            } else if (m.message == "drown") {
-                change_state_noshield(DROWNING);
-                handled = true;
             } else if (m.message == "fall") {
                 change_state_noshield(FALLING);
                 handled = true;
-            } else if (m.message == "fallvortex") {
+            } else if (m.message == "_fallvortex") {
                 change_state(FALLING_VORTEX);
                 handled = true;
             } else if (m.message == "jump") {
@@ -859,7 +855,7 @@
             update_halo();
             handled = true;
         }
-        else if (m.message == "invisibility") {
+        else if (m.message == "_invisibility") {
             m_invisible_rest_time += 8.0;
             handled = true;
         }
@@ -996,7 +992,6 @@
         set_model(kind+"-shattered");
         change_state(DEAD);
         break;
-    case DROWNING:
     case BUBBLING:
         set_model("invisible");
         change_state(DEAD);
@@ -1077,14 +1072,6 @@
         set_anim (kind+"-shatter");
         break;
 
-    case DROWNING:
-        // @@@ FIXME: use same animation as SINKING ?
-        GrabActor(this);
-//         sound::PlaySound("drown");
-        sound_event("drown");
-//         set_anim ("ring-anim");
-        set_anim ("ac-drowned");
-        break;
     case BUBBLING:
         GrabActor(this);
 //         sound::PlaySound("drown");

Modified: trunk/src/items/SimpleItems.cc
===================================================================
--- trunk/src/items/SimpleItems.cc	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/items/SimpleItems.cc	2008-12-20 00:40:14 UTC (rev 1402)
@@ -26,6 +26,23 @@
 
 namespace enigma {
 
+/* -------------------- Banana -------------------- */
+
+    Banana::Banana() {
+    }
+    
+    void Banana::processLight(Direction d) {
+        sound_event("itemtransform");
+        transform("it_cherry");
+    }
+
+    void Banana::on_stonehit(Stone *) {
+        transform("it_squashed");
+    }
+
+    DEF_ITEMTRAITS(Banana, "it_banana", it_banana);
+
+
 /* -------------------- Brush -------------------- */
    
     Brush::Brush() {
@@ -39,6 +56,22 @@
     
     DEF_ITEMTRAITSF(Brush, "it_brush", it_brush, itf_inflammable);
 
+/* -------------------- Cherry -------------------- */
+
+    Cherry::Cherry() {
+    }
+    
+    ItemAction Cherry::activate(Actor *actor, GridPos p) {
+        SendMessage(actor, "_invisibility");
+        return ITEM_KILL;
+    }
+
+    void Cherry::on_stonehit(Stone *) {
+        transform("it_squashed");
+    }
+
+    DEF_ITEMTRAITS(Cherry, "it_cherry", it_cherry);
+
 /* -------------------- Death Item  -------------------- */
     
     DeathItem::DeathItem() {
@@ -63,13 +96,33 @@
     
     DEF_ITEMTRAITSF(DeathItem, "it_death", it_death, itf_static | itf_indestructible);
 
+/* -------------------- Squashed Cherry -------------------- */
 
+    Squashed::Squashed() {
+    }
+    
+    Value Squashed::message (const Message &m) {
+        if (enigma_server::GameCompatibility == GAMET_ENIGMA) {
+            if (m.message == "_brush") {
+                KillItem(this->get_pos());
+                return Value();
+            }
+        }
+        return Item::message(m);
+    }
+
+    DEF_ITEMTRAITSF(Squashed, "it_squashed", it_squashed, itf_static);
+
+
     BOOT_REGISTER_START
+        BootRegister(new Banana(), "it_banana");
         BootRegister(new Brush(), "it_brush");
+        BootRegister(new Cherry(), "it_cherry");
         BootRegister(new DeathItem(), "it_death");
         BootRegister(new Floppy(), "it_floppy");
         BootRegister(new MagicWand(), "it_magicwand");
         BootRegister(new Key(), "it_key");
+        BootRegister(new Squashed(), "it_squashed");
         BootRegister(new Wrench(), "it_wrench");
     BOOT_REGISTER_END
 

Modified: trunk/src/items/SimpleItems.hh
===================================================================
--- trunk/src/items/SimpleItems.hh	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/items/SimpleItems.hh	2008-12-20 00:40:14 UTC (rev 1402)
@@ -25,6 +25,23 @@
 
 namespace enigma {
     /**
+     * Banana
+     */
+    class Banana : public Item {
+        CLONEOBJ(Banana);
+        DECL_ITEMTRAITS;
+
+    public:
+        Banana();
+
+        // GridObject interface
+        virtual void processLight(Direction d);   // direction of laserbeam
+        
+        // Item interface
+        virtual void on_stonehit(Stone *st);
+    };
+
+    /**
      * Brush Can "paint" some stones and remove ash
      */
     class Brush : public Item {
@@ -40,6 +57,22 @@
     
 
     /**
+     * Cherry
+     */
+
+    class Cherry : public Item {
+        CLONEOBJ(Cherry);
+        DECL_ITEMTRAITS;
+        
+    public:
+        Cherry();
+
+        // Item interface
+        virtual ItemAction activate(Actor* a, GridPos p);
+        virtual void on_stonehit(Stone *st);
+    };
+    
+    /**
      * DeathItem
      */
     class DeathItem : public Item {
@@ -73,6 +106,20 @@
     DEF_ITEM(Key, "it_key", it_key);
 
     /**
+     * Squashed
+     */
+    class Squashed : public Item {
+        CLONEOBJ(Squashed);
+        DECL_ITEMTRAITS;
+
+    public:
+        Squashed();
+        
+        // Object interface
+        virtual Value message(const Message &m);
+    };
+
+    /**
      * Wrench
      */
     DEF_ITEM(Wrench, "it_wrench", it_wrench);

Modified: trunk/src/items/Vortex.cc
===================================================================
--- trunk/src/items/Vortex.cc	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/items/Vortex.cc	2008-12-20 00:40:14 UTC (rev 1402)
@@ -68,7 +68,7 @@
                 }
                 else if (state == CLOSED) {
                     state = OPENING;
-                    sound_event ("vortexopen");
+                    sound_event("vortexopen");
                     init_model();
                 }
             } else if (extState == 0) { // close
@@ -78,7 +78,7 @@
                 }
                 else if (state == OPEN) {
                     state = CLOSING;
-                    sound_event ("vortexclose");
+                    sound_event("vortexclose");
                     init_model();
                 }
             }
@@ -142,14 +142,14 @@
             emit_actor(dynamic_cast<Vortex *>((Object *)getAttr("$dest_vortex")));
         } else if (state == SWALLOWING) {
             state = WARPING;
-            sound_event ("hitfloor");
+            sound_event("hitfloor");
             perform_warp();
         } else
             ASSERT (0, XLevelRuntime, "Vortex: alarm called with inconsistent state");
     }
     
     void Vortex::prepare_for_warp (Actor *actor) {
-        SendMessage(actor, "fallvortex");
+        SendMessage(actor, "_fallvortex");
         setAttr("$dest_idx", 0);
         setAttr("$grabbed_actor", actor);
         state = SWALLOWING;

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/items.cc	2008-12-20 00:40:14 UTC (rev 1402)
@@ -163,7 +163,6 @@
     DEF_ITEMF(Coffee,   "it-coffee", it_coffee, itf_inflammable);
 }
 
-
 /* -------------------- DummyItem -------------------- */
     class Dummyitem : public Item {
         CLONEOBJ(Dummyitem);
@@ -182,49 +181,6 @@
     };
     DEF_ITEMTRAITSF(Dummyitem, "it-dummy", it_dummy, itf_fireproof);
 
-/* -------------------- Cherry -------------------- */
-
-    class Cherry : public Item {
-        CLONEOBJ(Cherry);
-        DECL_ITEMTRAITS;
-        ItemAction activate(Actor *actor, GridPos) {
-            SendMessage (actor, "invisibility");
-            return ITEM_KILL;
-        }
-
-        void on_stonehit(Stone *) {
-            replace("it-squashed");
-        }
-    public:
-        Cherry() {
-        }
-    };
-    DEF_ITEMTRAITS(Cherry, "it-cherry", it_cherry);
-
-/* -------------------- Squashed Cherry -------------------- */
-
-    class Squashed : public Item {
-        CLONEOBJ(Squashed);
-        DECL_ITEMTRAITS;
-
-        virtual Value message (const Message &m) {
-            if (enigma_server::GameCompatibility == GAMET_ENIGMA) {
-                if (m.message == "_brush") {
-                    KillItem(this->get_pos());
-                    return Value();
-                }
-            }
-            return Item::message(m);
-        }
-
-
-    public:
-        Squashed() {
-        }
-    };
-    DEF_ITEMTRAITSF(Squashed, "it-squashed", it_squashed, itf_static);
-
-
 /* -------------------- Weight -------------------- */
 
     class Weight : public Item {
@@ -260,26 +216,6 @@
     };
     DEF_ITEMTRAITS(Pin, "it-pin", it_pin);
 
-/* -------------------- Banana -------------------- */
-
-    class Banana : public Item {
-        CLONEOBJ(Banana);
-        DECL_ITEMTRAITS;
-
-        void processLight(Direction d) {
-            sound_event ("itemtransform");
-            replace("it-cherry");
-        }
-
-        void on_stonehit(Stone *) {
-            replace("it-squashed");
-        }
-
-    public:
-        Banana() {}
-    };
-    DEF_ITEMTRAITS(Banana, "it-banana", it_banana);
-
 /* -------------------- Spoon -------------------- */
 namespace
 {
@@ -1879,14 +1815,12 @@
 void InitItems()
 {
     RegisterItem (new Bag);
-    RegisterItem (new Banana);
     RegisterItem (new BlackBomb);
     RegisterItem (new BlackBombBurning);
     RegisterItem (new Booze);
     RegisterItem (new BrokenBooze);
     Burnable::setup();
     RegisterItem (new ChangeFloorItem);
-    RegisterItem (new Cherry);
     RegisterItem (new Coffee);
     Crack::setup();
     RegisterItem (new Cross);
@@ -1918,7 +1852,6 @@
     RegisterItem (new Spring1);
     RegisterItem (new Spring2);
     RegisterItem (new Springboard);
-    RegisterItem (new Squashed);
     RegisterItem (new SurpriseItem);
     RegisterItem (new TwoPKillStone);
     RegisterItem (new Weight);

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/ox_extra.cc	2008-12-20 00:40:14 UTC (rev 1402)
@@ -314,7 +314,7 @@
     IT_EXTERNAL,                // OxydExtra item 0x03
     "it_hammer",                  // OxydExtra item 0x04
     "it-coffee",                  // OxydExtra item 0x05
-    "it-cherry",                  // OxydExtra item 0x06
+    "it_cherry",                  // OxydExtra item 0x06
     "it_umbrella",                // OxydExtra item 0x07
     IT_MISSING,                 // OxydExtra item 0x08
     UNUSED,                  // OxydExtra item 0x09
@@ -374,6 +374,6 @@
     UNUSED,                  // OxydExtra item 0x3f
     "it_trigger",                 // OxydExtra item 0x40
     "it_brush",                   // OxydExtra item 0x41
-    "it-banana",                  // OxydExtra item 0x42
+    "it_banana",                  // OxydExtra item 0x42
     // codes >= 0x43 are unused
 };

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/ox_magnum.cc	2008-12-20 00:40:14 UTC (rev 1402)
@@ -266,9 +266,9 @@
     "st-yinyang1",              // OxydMagnum stone 0x93
     "st-break_acwhite",         // OxydMagnum stone 0x94
     "st-break_acblack",         // OxydMagnum stone 0x95
-    "st-chargeplus",            // OxydMagnum stone 0x96
-    "st-chargeminus",           // OxydMagnum stone 0x97
-    "st-chargezero",            // OxydMagnum stone 0x98
+    "st_charge_plus",           // OxydMagnum stone 0x96
+    "st_charge_minus",          // OxydMagnum stone 0x97
+    "st_charge_zero",           // OxydMagnum stone 0x98
     0,                          // OxydMagnum stone 0x99 (common was 'st-blocker')(Level 121 ?)(in normal Oxyd Magnum Levels unused!)
     "st_turnstile_red",         // OxydMagnum stone 0x9a
     "st_turnstilearm_n",        // OxydMagnum stone 0x9b
@@ -296,7 +296,7 @@
     IT_EXTERNAL,      // OxydMagnum item 0x03 document 2
     "it_hammer",        // OxydMagnum item 0x04
     "it-coffee",        // OxydMagnum item 0x05
-    "it-cherry",        // OxydMagnum item 0x06
+    "it_cherry",        // OxydMagnum item 0x06
     "it_umbrella",      // OxydMagnum item 0x07
     "it_glasses",       // OxydMagnum item 0x08
     "it_glasses_broken", // OxydMagnum item 0x09

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/ox_oxyd1.cc	2008-12-20 00:40:14 UTC (rev 1402)
@@ -298,9 +298,9 @@
     "st-yinyang1",              // Oxyd1 stone 0x93
     "st-break_acwhite",         // Oxyd1 stone 0x94
     "st-break_acblack",         // Oxyd1 stone 0x95
-    "st-chargeplus",            // Oxyd1 stone 0x96
-    "st-chargeminus",           // Oxyd1 stone 0x97
-    "st-chargezero",            // Oxyd1 stone 0x98
+    "st_charge_plus",           // Oxyd1 stone 0x96
+    "st_charge_minus",          // Oxyd1 stone 0x97
+    "st_charge_zero",           // Oxyd1 stone 0x98
     "st-glass1",                // Oxyd1 stone 0x99
     // codes >= 0x9a are unused
 };
@@ -312,7 +312,7 @@
     IT_EXTERNAL,                  // 0x03 document 2
     "it_hammer",                  // 0x04
     "it-coffee",                  // 0x05
-    "it-cherry",                  // 0x06
+    "it_cherry",                  // 0x06
     "it_umbrella",                // 0x07
     "it_glasses",                 // 0x08
     "it_glasses_broken",          // 0x09

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/ox_peroxyd.cc	2008-12-20 00:40:14 UTC (rev 1402)
@@ -316,9 +316,9 @@
     "st-yinyang3",              // PerOxyd stone 0x7d
     "st-break_acwhite",         // PerOxyd stone 0x7e
     "st-break_acblack",         // PerOxyd stone 0x7f
-    "st-chargeplus",            // PerOxyd stone 0x80
-    "st-chargeminus",           // PerOxyd stone 0x81
-    "st-chargezero",            // PerOxyd stone 0x82
+    "st_charge_plus",           // PerOxyd stone 0x80
+    "st_charge_minus",          // PerOxyd stone 0x81
+    "st_charge_zero",           // PerOxyd stone 0x82
     "st_boulder_n",             // PerOxyd stone 0x83
     "st_boulder_s",             // PerOxyd stone 0x84
     "st_boulder_w",             // PerOxyd stone 0x85
@@ -385,7 +385,7 @@
     IT_EXTERNAL,                  // 0x03 document 2
     "it_hammer",                  // 0x04
     "it-coffee",                  // 0x05
-    "it-cherry",                  // 0x06
+    "it_cherry",                  // 0x06
     "it_umbrella",                // 0x07
     "it_glasses",                 // 0x08
     "it_glasses_broken",          // 0x09
@@ -445,10 +445,10 @@
     "it-changefloor",             // 0x3f
     "it_trigger",                 // 0x40
     "it_brush",                   // 0x41
-    "it-banana",                  // 0x42
+    "it_banana",                  // 0x42
     "it-pencil",                  // 0x43
     "it_brake",                   // 0x44
-    "it-squashed",                // 0x45
+    "it_squashed",                // 0x45
     "it_blocker",                 // 0x46
     "it_magicwand",               // 0x47
     "it_wrench",                  // 0x48

Modified: trunk/src/stones/MailStone.cc
===================================================================
--- trunk/src/stones/MailStone.cc	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/stones/MailStone.cc	2008-12-20 00:40:14 UTC (rev 1402)
@@ -53,9 +53,9 @@
         if (enigma::Inventory *inv = player::GetInventory(sc.actor)) {
             if (Item *it = inv->get_item(0)) {
                 GridPos p = PipeItem::findPipeEndpoint(get_pos(), getOrientation());
-                if (IsInsideLevel(p) && it->can_drop_at (p)) {
+                if (IsInsideLevel(p) && it->can_drop_at(p)) {
                     it = inv->yield_first();
-                    player::RedrawInventory (inv);
+                    player::RedrawInventory(inv);
                     it->drop(sc.actor, p);
                 }
             }

Modified: trunk/src/stones/SimpleStones.cc
===================================================================
--- trunk/src/stones/SimpleStones.cc	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/stones/SimpleStones.cc	2008-12-20 00:40:14 UTC (rev 1402)
@@ -26,6 +26,55 @@
 
 namespace enigma {
 
+/* -------------------- Charge stone -------------------- */
+
+    ChargeStone::ChargeStone(double charge) : Stone("st_charge") {
+        Stone::setAttr("charge", charge);
+    }
+    
+    std::string ChargeStone::getClass() const {
+        return "st_charge";
+    }
+
+    void ChargeStone::setAttr(const string& key, const Value &val) {
+        Stone::setAttr(key, val);
+        if (key == "charge" && isDisplayable()) 
+            init_model();
+    }
+
+    Value ChargeStone::getAttr(const std::string &key) const {
+        if (key == "$charge") {
+            double charge = getAttr("charge");
+            return (charge == 0) ? 0 : ((charge > 0.0) ? 1 : -1);
+        } else
+            return Stone::getAttr(key);
+    }
+
+    Value ChargeStone::message(const Message &m) {
+        if (server::GameCompatibility == enigma::GAMET_PEROXYD && m.message == "signal") {
+            performAction(m.value);
+            return Value();
+        }
+        return Stone::message(m);
+    }
+    
+    void ChargeStone::init_model() {
+        double charge = getAttr("charge");
+        set_model(ecl::strf("st-charge%s", (charge == 0) ? "zero" : ((charge > 0.0) ? "plus" : "minus")).c_str());
+    }
+    
+    void ChargeStone::animcb() {
+        init_model();
+    }
+    
+    void ChargeStone::actor_hit(const StoneContact &sc) {
+        double charge = getAttr("charge");
+        ActorInfo *ai = sc.actor->get_actorinfo();
+        ai->charge = charge;
+        set_anim(ecl::strf("st-charge%s-anim", (charge == 0) ? "zero" : ((charge > 0.0) ? "plus" : "minus")).c_str());
+    }
+    
+
 /* -------------------- Flash stone -------------------- */
 
     FlashStone::FlashStone() : Stone ("st_flash") {
@@ -42,6 +91,10 @@
     }
     
     BOOT_REGISTER_START
+        BootRegister(new ChargeStone(0.0), "st_charge");
+        BootRegister(new ChargeStone(0.0), "st_charge_zero");
+        BootRegister(new ChargeStone(1.0), "st_charge_plus");
+        BootRegister(new ChargeStone(-1.0), "st_charge_minus");
         BootRegister(new FlashStone(), "st_flash");
     BOOT_REGISTER_END
 

Modified: trunk/src/stones/SimpleStones.hh
===================================================================
--- trunk/src/stones/SimpleStones.hh	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/stones/SimpleStones.hh	2008-12-20 00:40:14 UTC (rev 1402)
@@ -27,6 +27,31 @@
 namespace enigma {
 
     /** 
+     * ChargeStone
+     */
+    class ChargeStone : public Stone {
+        CLONEOBJ(ChargeStone);
+        
+    public:
+        ChargeStone(double charge);
+
+        // Object interface
+        virtual std::string getClass() const;
+        virtual void setAttr(const string& key, const Value &val);
+        virtual Value getAttr(const std::string &key) const;
+        virtual Value message(const Message &m);
+
+        // GridObject interface
+        virtual void init_model();
+        
+        // ModelCallback interface  - Animation callback
+        virtual void animcb();
+
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+    };
+
+    /** 
      * FlashStone
      */
     class FlashStone : public Stone {

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-12-20 00:23:00 UTC (rev 1401)
+++ trunk/src/stones.cc	2008-12-20 00:40:14 UTC (rev 1402)
@@ -337,43 +337,7 @@
 //  Stones under development :
 
 
-/* -------------------- Charge stone -------------------- */
 
-// Attributes:
-//
-// :charge  + - 0
-namespace
-{
-    class ChargeStone : public Stone {
-        CLONEOBJ(ChargeStone);
-    public:
-        ChargeStone(const char *kind, double charge)
-        : Stone(kind)
-        {
-            setAttr("charge", charge);
-        }
-        virtual Value message(const Message &m) {
-            if (server::GameCompatibility == enigma::GAMET_PEROXYD && m.message == "signal") {
-                performAction(m.value);
-                return Value();
-            }
-            return Stone::message(m);
-        }
-    private:
-        double get_charge() {
-            double q = getAttr("charge");
-            return max(-1.0, min(1.0, q));
-        }
-        void animcb() { init_model(); }
-        void actor_hit (const StoneContact &sc) {
-            ActorInfo *ai = sc.actor->get_actorinfo();
-            ai->charge = get_charge();
-            set_anim(string(get_kind())+"-anim");
-        }
-    };
-}
-
-
 /* -------------------- SpitterStone -------------------- */
 
 namespace
@@ -874,9 +838,6 @@
 
     // Register(new ...);
 
-    Register (new ChargeStone ("st-chargeplus", +1.0));
-    Register (new ChargeStone ("st-chargeminus", -1.0));
-    Register (new ChargeStone ("st-chargezero", 0.0));
     Register (new SpitterStone);
     Register (new SurpriseStone);
     Register (new CoffeeStone);



From ral at mail.berlios.de  Sun Dec 21 01:12:18 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 21 Dec 2008 01:12:18 +0100
Subject: [Enigma-game-svn] r1403 - team_levelpacks/team_test_new_api
Message-ID: <200812210012.mBL0CIGa016203@sheep.berlios.de>

Author: ral
Date: 2008-12-21 01:11:43 +0100 (Sun, 21 Dec 2008)
New Revision: 1403

Modified:
   team_levelpacks/team_test_new_api/ralD005_1.xml
   team_levelpacks/team_test_new_api/ralT014_1.xml
   team_levelpacks/team_test_new_api/ralT016_1.xml
   team_levelpacks/team_test_new_api/ralT018_1.xml
   team_levelpacks/team_test_new_api/ralT028_1.xml
   team_levelpacks/team_test_new_api/ralT032_1.xml
   team_levelpacks/team_test_new_api/ralT042_1.xml
   team_levelpacks/team_test_new_api/ralT046_1.xml
   team_levelpacks/team_test_new_api/ralT047_1.xml
   team_levelpacks/team_test_new_api/ralT050_1.xml
   team_levelpacks/team_test_new_api/ralT060_1.xml
   team_levelpacks/team_test_new_api/ralT063_1.xml
   team_levelpacks/team_test_new_api/ralT067_1.xml
   team_levelpacks/team_test_new_api/ralT068_1.xml
   team_levelpacks/team_test_new_api/raoulT03_1.xml
   team_levelpacks/team_test_new_api/raoulT09_1.xml
Log:
Test Level new API:
- updates for last renamings
- fake stones in ralT018
- charge stones in ralT050

Modified: team_levelpacks/team_test_new_api/ralD005_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD005_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralD005_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -17,8 +17,8 @@
     <el:luamain><![CDATA[
 ti[" "] = {"fl-plank"}
 ti["X"] = {"st_oxyd"}
-ti["B"] = {"st-black3"}
-ti["W"] = {"st-white3"}
+ti["B"] = {"st_passage_black", flavor="cross"}
+ti["W"] = {"st_passage_white", flavor="cross"}
 
 ti["y"] = {"it-yinyang"}
 ti["1"] = ti["y"] .. {"#ac-blackball"}

Modified: team_levelpacks/team_test_new_api/ralT014_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT014_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT014_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -23,12 +23,12 @@
 ti[" "] = {"fl-sahara"}
 ti["."] = ti({"fl-rough-blue", checkerboard=0}) .. {"fl-rough-red", checkerboard=1}
 ti["*"] = ti({"st_chess_black", checkerboard=0}) .. {"st_chess_white", checkerboard=1}
-ti["c"] = {"it-cherry", name="cherry#"}
+ti["c"] = {"it_cherry", name="cherry#"}
 ti["5"] = {"it_coin_m", name="money", target={"otto", "emil*"}}
 ti["S"] = {"st_coinslot"}
 ti["m"] = {"#ac-blackball"}
-ti["x"] = {"fl-rough-blue"} .. {"it-banana"} .. ti({"ac-bug", 0.7})
-ti["y"] = (ti({"fl-rough-blue"}) .. {"it-banana"}) .. {"ac-bug", name="buggy"}
+ti["x"] = {"fl-rough-blue"} .. {"it_banana"} .. ti({"ac-bug", 0.7})
+ti["y"] = (ti({"fl-rough-blue"}) .. {"it_banana"}) .. {"ac-bug", name="buggy"}
 ti["s"] = {"st_switch", action="callback", target="doit"}
 ti["b"] = {"st_blocker", name="blocker"}
 ti["d"] = {"st_door_b", name="door#"}
@@ -69,7 +69,7 @@
 tokens = no["money"]["action"]
 
 if (tokens[4] == no["blocker"]) then
-    wo[{1, 1}] = {"it-magicwand"}
+    wo[{1, 1}] = {"it_magicwand"}
 end
 --tokens[3]:kill()
 wo[tokens[3]] = {"fl-rough-blue"}
@@ -87,7 +87,7 @@
     mygrp = no["cherry#*"]
     obj = mygrp[#mygrp - 1]
     if (-obj) then
-        wo[obj] = {"it-banana"}
+        wo[obj] = {"it_banana"}
     end
 
     
@@ -110,7 +110,7 @@
         chess_grp["color"] = 1
         chess_grp:move(po(-2,-1))
 --        chess_grp:message("move",po(-2,-1))
-        wo[mygrp] = {"st-wood"}
+        wo[mygrp] = {"st_wood"}
     else
         it(blocker_pos):close()
         --door_grp:message("close")

Modified: team_levelpacks/team_test_new_api/ralT016_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT016_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT016_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -26,7 +26,7 @@
 ti["#"] = {"st-rock1"}
 ti["l"] = {"st_lightpassenger_off"}
 ti["B"] = {"st_boulder_n"}
-ti["W"] = {"st-white1"}
+ti["W"] = {"st_passage_white"}
 ti["P"] = {"st-plain"}
 ti["p"] = {"st_polarswitch"}
 ti["E"] = {"st_laser_e", state = ON}

Modified: team_levelpacks/team_test_new_api/ralT018_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT018_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT018_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -21,32 +21,47 @@
 wo["AllowSingleOxyds"] = true
 
 ti[" "] = {"fl-sahara"}
-ti["#"] = ti[" "] .. {"st-rock1"}
+ti["#"] = {"st-rock1"}
 
-ti["O"] = ti[" "] .. {"st_oxyd", name="o#", flavor="d"}
-ti["P"] = ti[" "] .. {"st_oxyd", name="p#"}
-ti["Q"] = ti[" "] .. {"st_oxyd", name="q1", oxydcolor=5}
+ti["O"] = {"st_oxyd", name="o#", flavor="d"}
+ti["P"] = {"st_oxyd", name="p#"}
+ti["Q"] = {"st_oxyd", name="q1", oxydcolor=5}
 --ti["S"] = ti[" "] .. {"st_switch", action="shuffle", target="o#1"}
-ti["S"] = ti[" "] .. {"st_switch", action="callback", target="newflavor"}
-ti["1"] = ti[" "] .. {"#ac-blackball"}
-ti["B"] = ti[" "] .. {"st_oxyd", oxydcolor=-4, flavor="d", noshuffle=false}
-ti["F"] = ti[" "] .. {"st_oxyd", oxydcolor=-3, flavor="a", noshuffle=false}
-ti["K"] = ti[" "] .. {"st_oxyd", oxydcolor=-2, flavor="c", noshuffle=false}
+ti["S"] = {"st_switch", action="callback", target="newflavor"}
+ti["1"] = {"#ac-blackball"}
+ti["B"] = {"st_oxyd", oxydcolor=OXYD_BOLD, flavor="d", noshuffle=false}
+ti["F"] = {"st_oxyd", oxydcolor=OXYD_QUAKE, flavor="a", noshuffle=false}
+ti["K"] = {"st_oxyd", oxydcolor=OXYD_FAKE, flavor="c", noshuffle=false}
 
+ti["q"] = {"st_fake_quake", "quake"}
+ti["a"] = {"st_fake_oxyda"}
+ti["b"] = {"st_fake_oxydb"}
+ti["c"] = {"st_fake_oxydc"}
+ti["d"] = {"st_fake_oxydd"}
+ti["e"] = {"st_fake_oxyde"}
+ti["f"] = {"st_fake_oxyda", state=OPEN}
+ti["g"] = {"st_fake_oxydb", state=OPEN}
+ti["h"] = {"st_fake_oxydc", state=OPEN}
+ti["i"] = {"st_fake_oxydd", state=OPEN}
+ti["j"] = {"st_fake_oxyde", state=OPEN}
+ti["s"] = {"st_switch", target="quake"}
 
+
+
+
 w, h = wo(ti, " ", {
 "B  OOOOOOOOPPPPPPK F",
 "                    ",
 "                    ",
 "                    ",
+"                 s  ",
+"                 q  ",
 "                    ",
-"                    ",
-"                    ",
-"      1             ",
-"                    ",
-"                    ",
-"       S            ",
-"                    ",
+"      1          af ",
+"                 bg ",
+"                 ch ",
+"       S         di ",
+"                 ej ",
 "                    "
 })
 

Modified: team_levelpacks/team_test_new_api/ralT028_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT028_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT028_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -42,7 +42,7 @@
 ti["@"] = (ti[" "] .. {"it_magicwand"}) .. {"#ac-blackball"}
 
 ti["w"] = {"st_switch", target="Laser%7", action="toggle"}
-ti["f"] = {"st_fart"}
+ti["f"] = {"st_quake"}
 ti["h"] = {"it_hammer"}
 ti["d"] = {"it-dynamite"}
 ti["E"] = {"st-bombs"}

Modified: team_levelpacks/team_test_new_api/ralT032_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT032_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT032_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -26,7 +26,7 @@
 
 ti["x"] = {"st_oxyd_e"}
 ti["y"] = {"st_oxyd_e", "oo", oxydcolor=OXYD_BOLD}
-ti["f"] = {"st_fart"}
+ti["f"] = {"st_quake"}
 ti["p"] = {"st_switch", target="oo", action="peepall"}
 
 

Modified: team_levelpacks/team_test_new_api/ralT042_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT042_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT042_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -22,7 +22,7 @@
 ti[" "] = {"fl-sahara"}
 ti["."] = {"fl_ice"}
 ti["c"] = {"it_cross"}
-ti["v"] = {"it-cherry"}
+ti["v"] = {"it_cherry"}
 
 ti["A"] = {"#ac-blackball"}
 

Modified: team_levelpacks/team_test_new_api/ralT046_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT046_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT046_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -30,7 +30,7 @@
 
 ti["2 "] = {"it_coin_s"}
 ti["s "] = {"it_seed"}
-ti["c "] = {"it-cherry"}
+ti["c "] = {"it_cherry"}
 ti["h "] = {"it_hammer"}
 
 ti["k "] = {"it_key"} .. ti({"st-glass1"})

Modified: team_levelpacks/team_test_new_api/ralT047_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT047_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT047_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -30,7 +30,7 @@
 
 ti[" 2 "] = {"it_coin_s"}
 ti[" s "] = {"it_seed"}
-ti[" c "] = {"it-cherry"}
+ti[" c "] = {"it_cherry"}
 ti[" h "] = {"it_hammer"}
 
 ti[" k "] = {"it_key"} 

Modified: team_levelpacks/team_test_new_api/ralT050_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT050_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT050_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -36,7 +36,16 @@
 ti["K"] = {"st_knight"}
 ti["L"] = {"st_laser_e", state=ON}
 
+ti["F"] = {"st_flash"}
 
+ti["Z"] = {"st_charge_zero"}
+ti["P"] = {"st_charge_plus"}
+ti["M"] = {"st_charge_minus", charge=-4}
+
+ti["p"] = {"st_charge_plus", "cp"}
+ti["q"] = {"st_switch", target="togglecharge"}
+ti["Q"] = {"st_switch", target="togglestrength"}
+
 ti["w"] = {"it_magicwand"}
 ti["c"] = {"st_chess_black"}
 ti["3"] = {"#ac-blackball", player=DEFAULT, controllers=0}
@@ -54,11 +63,18 @@
 "   4             K  ",
 "                    ",
 "                    ",
+"   F                ",
 "                    ",
-"                    ",
-"                    "
+"    Q   P  Z  M   pq"
 })
 
+function togglecharge()
+    no["cp"]["charge"] = - no["cp"]["charge"]
+end
+
+function togglestrength()
+    wo["ElectricStrength"] = - wo["ElectricStrength"]
+end
   ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Modified: team_levelpacks/team_test_new_api/ralT060_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT060_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT060_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -46,7 +46,7 @@
 ti["u"] = {"st_wood", "wood3"}
 ti["r"] = {"st-rock1"}
 ti["s"] = {"st_swap"}
-ti["c"] = {"it-cherry"}
+ti["c"] = {"it_cherry"}
 
 ti["S"] = {"st_switch", target="kill_l"}
 ti["T"] = {"st_switch", target="kill_m"}

Modified: team_levelpacks/team_test_new_api/ralT063_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT063_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT063_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -66,7 +66,7 @@
 ti["="] = {"st_polarswitch"}
 ti[":"] = {"st_polarswitch", state=ON}
 ti["."] = {"st_stoneimpulse_movable"}
-ti["*"] = {"it-cherry"}
+ti["*"] = {"it_cherry"}
 
 ti["x"] = {"st_wood", "wood4"}
 ti["X"] = {"st_wood", "wood5"}

Modified: team_levelpacks/team_test_new_api/ralT067_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT067_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT067_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -60,7 +60,7 @@
 
 function doabyss()
     for i = 1, #abypos do
-       wo[abypos[i]] = {"it-cherry"}
+       wo[abypos[i]] = {"it_cherry"}
     end
 end
 
@@ -77,19 +77,19 @@
        print ("water is not nil but type " .. type(p) .. " usertype ".. usertype(p))
     end
     print("water at "..p.x.." - "..p.y)
-    wo[po["water"]] = {"it-cherry"}
+    wo[po["water"]] = {"it_cherry"}
 end
 
 function dopw()
     print ("number of pws "..#po["pw#*"])
-    wo[po["pw#*"]] = {"it-cherry"}
+    wo[po["pw#*"]] = {"it_cherry"}
 end
 
 po["emil"] = po(2, 10)
-wo[po["emil"]] = {"it-cherry"}
+wo[po["emil"]] = {"it_cherry"}
 
 function dojoin()
-    wo[abypos .. po["pw#*"]] = {"it-banana"}
+    wo[abypos .. po["pw#*"]] = {"it_banana"}
 end
 
   ]]></el:luamain>

Modified: team_levelpacks/team_test_new_api/ralT068_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT068_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/ralT068_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -32,7 +32,7 @@
 
 ti["w"] = {"st_wood"}
 ti["g"] = {"st-glass_move"}
-ti["c"] = {"it-cherry"}
+ti["c"] = {"it_cherry"}
 ti["s"] = {"it-spring1"}
 ti["p"] = {"st_pull"}
 ti["W"] = {"st_window_ew", secure=true}

Modified: team_levelpacks/team_test_new_api/raoulT03_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -53,7 +53,7 @@
 ti["r"] = {"it-ring"}
 ti["s"] = {"it_seed"}
 ti["k"] = {"it-coffee"}
-ti["K"] = {"it-cherry"}
+ti["K"] = {"it_cherry"}
 ti[":"] = {"it-dynamite"}
 ti["I"] = {"st_stoneimpulse"}
 ti["&"] = {"st-bombs"}

Modified: team_levelpacks/team_test_new_api/raoulT09_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT09_1.xml	2008-12-20 00:40:14 UTC (rev 1402)
+++ team_levelpacks/team_test_new_api/raoulT09_1.xml	2008-12-21 00:11:43 UTC (rev 1403)
@@ -30,7 +30,7 @@
 ti["P"] = {"st_polarswitch", state=ON}
 ti["L"] = {"st_laser", orientation=EAST, state=ON}
 ti["R"] = {"st_laser", orientation=WEST, state=ON}
-ti["C"] = {"it-cherry"}
+ti["C"] = {"it_cherry"}
 ti["U"] = {"it_umbrella"}
 ti["@"] = {"#ac-blackball"}
 



From ral at mail.berlios.de  Sun Dec 21 17:00:48 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 21 Dec 2008 17:00:48 +0100
Subject: [Enigma-game-svn] r1404 - in trunk: data data/schemas src
	src/actors src/items src/stones
Message-ID: <200812211600.mBLG0moQ007361@sheep.berlios.de>

Author: ral
Date: 2008-12-21 17:00:40 +0100 (Sun, 21 Dec 2008)
New Revision: 1404

Added:
   trunk/src/actors/
   trunk/src/actors/Balls.cc
   trunk/src/actors/Balls.hh
Removed:
   trunk/src/sim/
Modified:
   trunk/data/api1init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/actors.cc
   trunk/src/actors.hh
   trunk/src/items.cc
   trunk/src/items/Meditation.cc
   trunk/src/oxyd.cc
   trunk/src/player.cc
   trunk/src/stones.cc
   trunk/src/stones/Switch.cc
   trunk/src/stones_simple.cc
   trunk/src/world.cc
Log:
Trunk 1.1: new API reengineering
- actors reengineering part I:
  - ac-blackball renamed to ac_marble_black
  - ac-whiteball renamed to ac_marble_white
  - ac-whiteball renamed to ac_pearl_white
  - ac_marble defaults to ac_marble_black
  - ac_pearl defaults to ac_pearl_white
  - attribute "mousefactor" renamed to "adhesion" for all actors
  - the othe existing "ball" attributes remain unchanged besides:
    - ac_pearl is assigned to "player" 0 what reflects its main usage in
      meditation levels. A not assigned pearl needs to reset the player
      attribute to "nil" or DEFAULT, if done in a Lua table
Note:
- additional attribute and message declaration will follow, but they will not
  affect existing levels
- other actors will follow in the renaming by just switching the hyphen into
  an underscore.
- all existing new API levels need an update!

Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/data/api1init.lua	2008-12-21 16:00:40 UTC (rev 1404)
@@ -45,6 +45,9 @@
 }
 
 RenamingObjectsNew2Old = {
+    ac_marble_black = "ac-blackball",
+    ac_marble_white = "ac-whiteball",
+    ac_pearl_white = "ac-whiteball-small",
     fl_abyss = "fl-abyss",
     fl_bridge = "fl-bridge",
     fl_hay = "fl-hay",
@@ -334,7 +337,11 @@
 end
 
 function enigma.MakeObject(name)
-    if name == "fl-bridge-open" then
+    if name == "ac-whiteball-small" then
+        local obj = enigma._MakeObject("ac_pearl_white")
+        enigma._SetAttrib(obj, "player", nil)
+        return obj
+    elseif name == "fl-bridge-open" then
         local obj = enigma._MakeObject("fl_bridge")
         return obj
     elseif name == "fl-bridge-closed" then
@@ -663,6 +670,9 @@
      if key == "mousefactor" then
          _key = "adhesion"
      end
+     if key == "mouseforce" then
+         _key = "adhesion"
+     end
      if key == "blinking" then
          _key = "state"
      end
@@ -712,6 +722,9 @@
      if key == "blinking" then
          _key = "state"
      end
+     if key == "mouseforce" then
+         _key = "adhesion"
+     end
      if key == "type" and _obj_name == "st-door" then
          local faces = enigma._GetAttrib(obj, "faces")
          if faces == "ns" then val = "h" else val = "v" end

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/data/models-2d.lua	2008-12-21 16:00:40 UTC (rev 1404)
@@ -39,37 +39,37 @@
     -- Normal Blackball
     images = SpriteImages("fg-blackball", 2, 0.5, 0.32)
     shadows = SpriteImage("sh-blackball", 0.4, 0.29)
-    DefShModel("ac-blackball", "fg-blackball1", "sh-blackball")
-    DefShModel("ac-blackball-shine", "fg-blackball2", "sh-blackball")
+    DefShModel("ac_marble_black", "fg-blackball1", "sh-blackball")
+    DefShModel("ac_marble_black-shine", "fg-blackball2", "sh-blackball")
 
     -- Normal Whiteball
     -- Use shadow from black ball
     DefAlias("sh-whiteball", "sh-blackball")
     images = SpriteImages("fg-whiteball", 2, 0.5, 0.32)
-    DefShModel("ac-whiteball", "fg-whiteball1", "sh-whiteball")
-    DefShModel("ac-whiteball-shine", "fg-whiteball2", "sh-whiteball")
+    DefShModel("ac_marble_white", "fg-whiteball1", "sh-whiteball")
+    DefShModel("ac_marble_white-shine", "fg-whiteball2", "sh-whiteball")
 
     -- Falling Blackball
     images = SpriteImages("ac-blackball-fall", 10)
     frames = ComposeFrames(images,{70,65,60,55,50,50,50,50,50,50,50})
-    DefAnim("ac-blackball-fall", frames)
-    DefAlias("ac-blackball-fallen", "invisible")
+    DefAnim("ac_marble_black-fall", frames)
+    DefAlias("ac_marble_black-fallen", "invisible")
 
     -- Appearing / disappearing Blackball
     -- use the images from falling
-    DefAnim("ac-blackball-appear", ReverseFrames(BuildFrames(images, 25)))
-    DefAnim("ac-blackball-disappear", BuildFrames(images, 25))
+    DefAnim("ac_marble_black-appear", ReverseFrames(BuildFrames(images, 25)))
+    DefAnim("ac_marble_black-disappear", BuildFrames(images, 25))
 
     -- Falling Whiteball
     images = SpriteImages("ac-whiteball-fall", 10)
     frames = ComposeFrames(images,{70,65,60,55,50,50,50,50,50,50,50})
-    DefAnim("ac-whiteball-fall", frames)
-    DefAlias("ac-whiteball-fallen", "invisible")
+    DefAnim("ac_marble_white-fall", frames)
+    DefAlias("ac_marble_white-fallen", "invisible")
 
     -- Appearing / disappearing Whiteball
     -- use the images from falling
-    DefAnim("ac-whiteball-appear", ReverseFrames(BuildFrames(images, 25)))
-    DefAnim("ac-whiteball-disappear", BuildFrames(images, 25))
+    DefAnim("ac_marble_white-appear", ReverseFrames(BuildFrames(images, 25)))
+    DefAnim("ac_marble_white-disappear", BuildFrames(images, 25))
 
     -- Jumping Blackball
     images  = SpriteImages("ac-blackball-jump", 4)
@@ -79,7 +79,7 @@
         DefShModel("bb-jump"..i, images[i], shadows[i])
         table.insert(frames, "bb-jump"..i)
     end
-    DefAnim("ac-blackball-jump", PingPong(BuildFrames(frames, 70)))
+    DefAnim("ac_marble_black-jump", PingPong(BuildFrames(frames, 70)))
 
     -- Jumping Whiteball
     -- Use shadow from black ball
@@ -89,31 +89,33 @@
         DefShModel("wb-jump"..i, images[i], shadows[i])
         table.insert(frames, "wb-jump"..i)
     end
-    DefAnim("ac-whiteball-jump", PingPong(BuildFrames(frames, 70)))
+    DefAnim("ac_marble_white-jump", PingPong(BuildFrames(frames, 70)))
 
     -- Sinking Blackball
     shadows = SpriteImages("sh-blackball-sink", 7, 0.4)
     images = SpriteImages("fg-blackball-sink", 7)
     for i=1,table.getn(images) do
-        DefShModel("ac-blackball-sink"..(i-1), images[i], shadows[i])
+        DefShModel("ac_marble_black-sink"..(i-1), images[i], shadows[i])
     end
-    DefAlias("ac-blackball-sunk", "invisible")
+    DefAlias("ac_marble_black-sunk", "invisible")
 
     -- Sinking Whiteball
     -- Use shadow from black ball
     images = SpriteImages("fg-whiteball-sink", 7)
     for i=1,table.getn(images) do
-        DefShModel("ac-whiteball-sink"..(i-1), images[i], shadows[i])
+        DefShModel("ac_marble_white-sink"..(i-1), images[i], shadows[i])
     end
-    DefAlias("ac-whiteball-sunk", "invisible")
+    DefAlias("ac_marble_white-sunk", "invisible")
 
     -- Shattering Blackball
     Sprite({name="ac-blackball-shatter", nimages=5, framelen=60})
-    DefAlias("ac-blackball-shattered", "ac-blackball-shatter5")
+    DefAlias("ac_marble_black-shatter", "ac-blackball-shatter")
+    DefAlias("ac_marble_black-shattered", "ac-blackball-shatter5")
 
     -- Shattering Whiteball
     Sprite({name="ac-whiteball-shatter", nimages=5, framelen=60})
-    DefAlias("ac-whiteball-shattered", "ac-whiteball-shatter5")
+    DefAlias("ac_marble_white-shatter", "ac-whiteball-shatter")
+    DefAlias("ac_marble_white-shattered", "ac-whiteball-shatter5")
 end
 
 -- ac-whiteball-small --
@@ -123,19 +125,19 @@
     -- Normal
     SpriteImage ("sh-whiteball-small", 0.4, 0.41)
     SpriteImage ("fg-whiteball-small", 0.5, 0.43)
-    DefShModel("ac-whiteball-small", "fg-whiteball-small", "sh-whiteball-small")
-    DefAlias ("ac-whiteball-small-shine", "ac-whiteball-small")
+    DefShModel("ac_pearl_white", "fg-whiteball-small", "sh-whiteball-small")
+    DefAlias ("ac_pearl_white-shine", "ac_pearl_white")
 
     -- Falling
     images = SpriteImages ("ac-whiteball-small-fall", 5, 0.5, 0.43)
     table.insert(images, "invisible")
-    DefAnim("ac-whiteball-small-fall", ComposeFrames(images,{70,65,60,55,50,30}))
-    DefAlias("ac-whiteball-small-fallen", "invisible")
+    DefAnim("ac_pearl_white-fall", ComposeFrames(images,{70,65,60,55,50,30}))
+    DefAlias("ac_pearl_white-fallen", "invisible")
 
     -- Appearing / disappearing
     -- use the images from falling
-    DefAnim("ac-whiteball-small-appear", ReverseFrames(BuildFrames(images, 25)))
-    DefAnim("ac-whiteball-small-disappear", BuildFrames(images, 25))
+    DefAnim("ac_pearl_white-appear", ReverseFrames(BuildFrames(images, 25)))
+    DefAnim("ac_pearl_white-disappear", BuildFrames(images, 25))
 
     -- Jumping
     images  = SpriteImages("ac-whiteball-small-jump", 4)
@@ -145,7 +147,7 @@
         DefShModel("sb-jump"..i, images[i], shadows[i])
         table.insert(frames, "sb-jump"..i)
     end
-    DefAnim("ac-whiteball-small-jump", PingPong(BuildFrames(frames, 70)))
+    DefAnim("ac_pearl_white-jump", PingPong(BuildFrames(frames, 70)))
 
     -- sinking
     DefAlias ("ac-whiteball-small-sink0", "ac-whiteball-small-fall1")
@@ -155,17 +157,18 @@
     DefAlias ("ac-whiteball-small-sink4", "ac-whiteball-small-fall5")
     DefAlias ("ac-whiteball-small-sink5", "ac-whiteball-small-fall5")
     DefAlias ("ac-whiteball-small-sink6", "ac-whiteball-small-fall5")
-    DefAlias ("ac-whiteball-small-sunk", "invisible")
+    DefAlias ("ac_pearl_white-sunk", "invisible")
 
     -- Shattering
     images = SpriteImages ("ac-whiteball-small-shatter", 5)
-    DefAnim("ac-whiteball-small-shatter", BuildFrames(images, 60))
+    DefAnim("ac_pearl_white-shatter", BuildFrames(images, 60))
     SpriteImage ("ac-whiteball-small-shattered")
+    DefAlias("ac_pearl_white-shattered", "ac-whiteball-small-shattered")
 end
 
 -- ac-killerball --
 do
-    DefAlias("ac-killerball", "ac-whiteball-small")
+    DefAlias("ac-killerball", "ac_pearl_white")
 end
 
 -- Marbles in inventory  --

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/data/schemas/objects.xml	2008-12-21 16:00:40 UTC (rev 1404)
@@ -14,10 +14,12 @@
     <attr name="coin_value" type="double" default="1" rw="rw"/>
     <attr name="color" type="int" default="nil" min="0" max="1" rw="rw"/>
     <attr name="connections" type="string" default="nil" rw="rw"/>
+    <attr name="controllers" type="int" default="0" min="0" max="3" rw="rw"/>
     <attr name="counterclock" type="bool" default="false" rw="rw"/>
     <attr name="checkerboard" type="int" default="nil" rw="rw"/>
     <attr name="destination" type="tokens" default="nil" rw="rw"/>
     <attr name="essential" type="int" default="0" min="0" max="2" rw="rw"/>
+    <attr name="essential_id" type="string" default="nil" rw="rw"/>
     <attr name="eternal" type="bool" default="false" rw="rw"/>
     <attr name="faces" type="string" default="nil" rw="rw"/>
     <attr name="fastfire" type="bool" default="false" rw="rw"/>
@@ -56,6 +58,7 @@
     <attr name="noshuffle" type="bool" default="false" rw="rw"/>
     <attr name="orientation" type="int" default="0" min="0" max="3" rw="rw"/>
     <attr name="oxydcolor" type="int" default="-1" min="-4" max="7" rw="rw"/>
+    <attr name="player" type="int" default="nil" min="0" max="1" rw="rw"/>
     <attr name="push_directions" type="string" default="nil" rw="rw"/>
     <attr name="range" type="double" default="1.0" rw="rw"/>
     <attr name="rubbers" type="group" default="nil" rw="r"/>
@@ -146,6 +149,30 @@
       <msg name="kill"/>
       <msg name="toggle"/>
     </object>
+    <object name="ac" abstract="true">
+      <attr name="adhesion" default="1.0"/>
+      <attr name="controllers"/>
+      <attr name="color"/>
+      <attr name="player"/>
+      <attr name="essential"/>
+      <attr name="essential_id"/>
+      <attr name="charge"/>
+    </object>
+    <object name="ac_marble">
+      <attr name="color" default="0"/>
+    </object>
+    <object name="ac_marble_black">
+      <attr name="color" value="0"/>
+    </object>
+    <object name="ac_marble_white">
+      <attr name="color" value="1"/>
+    </object>
+    <object name="ac_pearl">
+      <attr name="color" default="1" min="1"/>
+    </object>
+    <object name="ac_pearl_white">
+      <attr name="color" value="1"/>
+    </object>
     <object name="fl" abstract="true">
       <attr name="adhesion"/>
       <attr name="burnable"/>

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/Makefile.am	2008-12-21 16:00:40 UTC (rev 1404)
@@ -144,6 +144,8 @@
 	XMLtoLocal.hh		\
 	XMLtoUtf8.cc		\
 	XMLtoUtf8.hh		\
+	actors/Balls.cc		\
+	actors/Balls.hh		\
 	floors/BridgeFloor.cc	\
 	floors/BridgeFloor.hh	\
 	floors/FloodStream.cc	\

Added: trunk/src/actors/Balls.cc
===================================================================
--- trunk/src/actors/Balls.cc	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/actors/Balls.cc	2008-12-21 16:00:40 UTC (rev 1404)
@@ -0,0 +1,576 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "actors/Balls.hh"
+#include "errors.hh"
+//#include "main.hh"
+#include "world.hh"
+
+namespace enigma {
+
+/* -------------------- BasicBall  -------------------- */
+
+    const double BasicBall::SHIELD_TIME = 10.0;
+
+    BasicBall::BasicBall(const ActorTraits &tr, int maxSinkDepthValue) : Actor (tr), 
+            maxSinkDepth (maxSinkDepthValue), sinkDepth (minSinkDepth), sinkModel (-1),
+            lastshinep (false), vortex_normal_time (0), m_halosprite (),
+            m_shield_rest_time (0), m_halostate (NOHALO),
+            m_drunk_rest_time (0), m_invisible_rest_time (0) {
+        state = NO_STATE;
+    }
+    
+//    void BasicBall::setAttr(const string& key, const Value &val) {
+//        if (key == "charge") {
+//        } else
+//        Stone::setAttr(key, val);
+//    }
+//
+//    Value BasicBall::getAttr(const std::string &key) const {
+//        if (key == "charge") {
+//        } else
+//            return Stone::getAttr(key);
+//    }
+
+    Value BasicBall::message(const Message &m) {
+        bool handled = false;
+        switch (state) {
+            case NORMAL:
+                if (m.message == "shatter") {
+                    change_state_noshield(SHATTERING);
+                    handled = true;
+                } else if (m.message == "suicide") {
+                    change_state(SHATTERING);
+                    handled = true;
+                } else if (m.message == "laserhit") {
+                    change_state_noshield(SHATTERING);
+                    handled = true;
+                } else if (m.message == "fall") {
+                    change_state_noshield(FALLING);
+                    handled = true;
+                } else if (m.message == "_fallvortex") {
+                    change_state(FALLING_VORTEX);
+                    handled = true;
+                } else if (m.message == "jump") {
+                    change_state(JUMPING);
+                    handled = true;
+                } else if (m.message == "appear") {
+                    change_state(APPEARING);
+                    handled = true;
+                } else if (m.message == "disappear") {
+                    change_state(DISAPPEARING);
+                    handled = true;
+                }
+                break;
+            case JUMPING:
+                if (m.message == "shatter") {
+                    change_state_noshield(SHATTERING);
+                    handled = true;
+                } else if (m.message == "disappear") {
+                    change_state(DISAPPEARING);
+                    handled = true;
+                }
+                break;
+            case SHATTERING:
+                if (m.message == "_levelfinish") {
+                    change_state(DEAD);
+                    handled = true;
+                }
+                break;
+            case DEAD:
+                if (m.message == "resurrect") {
+                    change_state(RESURRECTED);
+                    handled = true;
+                }
+                break;
+            case FALLING_VORTEX:
+                if (m.message == "rise") {
+                    change_state(RISING_VORTEX); // vortex->vortex teleportation
+                } else if (m.message == "appear") {
+                    change_state(APPEARING); // vortex->non-vortex teleportation
+                    handled = true;
+                }
+                break;
+            case JUMP_VORTEX:
+                if (m.message == "laserhit") {
+                    change_state(SHATTERING);
+                    handled = true;
+                }
+                break;
+            case APPEARING:
+                // ugly hack
+                if (m.message == "_init") {
+                    Actor::message (m);
+                    handled = true;
+                } else if (m.message == "shatter") {
+                    change_state (SHATTERING);
+                    handled = true;
+                }
+                break;
+            default:
+                break;
+        }
+    
+        // Shield, booze and invisibility can be activated in all states except DEAD
+    
+        if (state != DEAD) {
+            if (m.message == "shield") {
+                m_shield_rest_time += SHIELD_TIME;
+                update_halo();
+                handled = true;
+            }
+            else if (m.message == "_invisibility") {
+                m_invisible_rest_time += 8.0;
+                handled = true;
+            }
+            else if (m.message == "booze") {
+                m_drunk_rest_time += 5.0; // Drunken for 5 more seconds
+                handled = true;
+            }
+        }
+    
+        return handled ? Value() : Actor::message(m);
+    }
+    
+    bool BasicBall::is_dead() const {
+        return state == DEAD;
+    }
+    
+    bool BasicBall::is_movable() const {
+        return (state!=DEAD && state!=RESURRECTED && state!=APPEARING && state!=DISAPPEARING); 
+    }
+    
+    bool BasicBall::is_flying() const {
+        return state == JUMPING;
+    }
+    
+    bool BasicBall::is_on_floor() const {
+        return state == NORMAL || state == JUMP_VORTEX || state==APPEARING;
+    }
+    
+    bool BasicBall::is_drunken() const {
+        return m_drunk_rest_time>0;
+    }
+    
+    bool BasicBall::is_invisible() const {
+        return m_invisible_rest_time>0;
+    }
+    bool BasicBall::can_drop_items() const {
+        return state == NORMAL || state == JUMP_VORTEX || state==JUMPING;
+    }
+    
+    bool BasicBall::can_pickup_items() const {
+        return state == NORMAL || state == JUMP_VORTEX;
+    }
+    
+    bool BasicBall::can_be_warped() const {
+        return state==NORMAL;
+    }
+    
+    bool BasicBall::has_shield() const {
+        return m_shield_rest_time > 0;
+    }
+    
+    void BasicBall::on_creation(const ecl::V2 &p) {
+        Actor::on_creation(p);
+        if (server::CreatingPreview)
+            change_state(NORMAL);
+        else
+            change_state(APPEARING);
+    }
+
+    void BasicBall::think(double dtime)  {
+        if (m_invisible_rest_time > 0)
+            m_invisible_rest_time -= dtime;
+    
+        // Update protection shield
+        if (m_shield_rest_time > 0) 
+            m_shield_rest_time -= dtime;
+    
+        switch (state) {
+            case NORMAL: 
+                if (m_drunk_rest_time > 0) 
+                    m_drunk_rest_time -= dtime;
+                sink (dtime);
+                break;
+            case JUMP_VORTEX:
+                vortex_normal_time += dtime;
+                if (vortex_normal_time > 0.025) // same time as appear animation
+                    if (vortex_normal_time > dtime) // ensure min. one tick in state JUMP_VORTEX!
+                        change_state(JUMPING); // end of short control over actor
+                break;
+            default:
+                break;
+        }
+    
+        Actor::think(dtime);
+    }
+    
+    void BasicBall::on_respawn (const ecl::V2 &pos) {
+            change_state(APPEARING);
+    }
+
+    void BasicBall::move_screen() {
+        update_model();
+        update_halo();
+        Actor::move_screen();
+    }
+    
+    void BasicBall::hide() {
+        Actor::hide();
+        disable_shield();
+    }
+    
+    void BasicBall::animcb() {
+        string kind=get_kind();
+    
+        switch (state) {
+            case SHATTERING:
+                set_model(kind+"-shattered");
+                change_state(DEAD);
+                break;
+            case BUBBLING:
+                set_model("invisible");
+                change_state(DEAD);
+                break;
+            case FALLING:
+                set_model(kind+"-fallen"); // invisible
+                if (get_id (this) == ac_marble_white)
+                    sound_event ("shattersmall");
+                else
+                    sound_event ("shatter");
+                change_state(DEAD);
+                break;
+            case JUMPING:
+                set_model(kind);
+                change_state(NORMAL);
+                break;
+            case APPEARING:
+                set_model(kind);
+                change_state(NORMAL);
+                break;
+            case DISAPPEARING:
+                set_model("ring-anim");
+                break;
+            case FALLING_VORTEX: {
+                set_model(kind+"-fallen"); // invisible
+                break;
+            }
+            case RISING_VORTEX: {
+                set_model(kind);
+                if (Item *it = GetItem(get_gridpos())) {
+                    ItemID id = get_id(it);
+                    if (id == it_vortex_open || id == it_vortex_closed) 
+                        SendMessage(it, "_passed"); // closes some vortex
+                }
+                change_state(JUMP_VORTEX);
+                break;
+            }
+            default:
+                break;
+        }
+    }
+    
+    void BasicBall::sink(double dtime) {
+        double sink_speed  = 0.0;
+        double raise_speed = 0.0;   // at this velocity don't sink; above: raise
+    
+        Floor *fl = m_actorinfo.field->floor;
+        Item *it = m_actorinfo.field->item;
+        if (!(it != NULL && it->covers_floor(get_pos(), this)) && fl != NULL)
+            fl->get_sink_speed (sink_speed, raise_speed);
+        
+        if (sink_speed == 0.0 || has_shield()) {
+            sinkDepth = minSinkDepth;
+            sinkModel = -1;
+        }
+        else {
+            ActorInfo *ai = get_actorinfo();
+            double sinkSpeed = sink_speed * (1 - length(ai->vel) / raise_speed);
+            sinkDepth += sinkSpeed*dtime;
+    
+            if (sinkDepth >= maxSinkDepth) {
+                set_model(string(get_kind())+"-sunk");
+                ai->vel = V2();     // stop!
+                sound_event ("swamp");
+                change_state(BUBBLING);
+            }
+            else {
+                if (sinkDepth < minSinkDepth) 
+                    sinkDepth = minSinkDepth;
+            }
+        }
+    }
+    
+    void BasicBall::disable_shield() {
+        if (has_shield()) {
+            m_shield_rest_time = 0;
+            update_halo();
+        }
+    }
+    
+    void BasicBall::change_state_noshield(iState newstate) {
+        if (!has_shield())
+            change_state(newstate);
+    }
+    
+    void BasicBall::change_state(iState newstate) {
+        if (newstate == state)
+            return;
+    
+        std::string kind = get_kind();
+        iState oldstate = (iState)state;
+        
+        if (oldstate == JUMPING) {
+            // notify objects on grid about the landing - used by it_trigger
+            SendMessage(GetStone(get_gridpos()), "_jumping", false);
+            SendMessage(GetItem(get_gridpos()), "_jumping", false);
+            SendMessage(GetFloor(get_gridpos()), "_jumping", false);
+        }
+    
+        // Whatever happened to the ball, the sink depth
+        // should be returned to zero.
+        sinkDepth = minSinkDepth;
+        sinkModel = -1;
+    
+        state = newstate;
+        switch (newstate) {
+            case NORMAL:
+                if (oldstate == APPEARING) {
+                    ActorInfo *ai = get_actorinfo();
+                    ai->forceacc = V2();
+                }
+                ReleaseActor(this);
+                break;
+        
+            case SHATTERING:
+                if (get_id (this) == ac_marble_white)
+                    sound_event("shattersmall");
+                else
+                    sound_event("shatter");
+                GrabActor(this);
+                set_anim(kind+"-shatter");
+                break;
+        
+            case BUBBLING:
+                GrabActor(this);
+        //         sound::PlaySound("drown");
+                set_anim("ac-drowned");
+                break;
+            case FALLING:
+            case FALLING_VORTEX:
+                GrabActor(this);
+                set_anim(kind+"-fall");
+                break;
+            case DEAD: 
+                disable_shield();
+                m_drunk_rest_time = 0;
+                m_invisible_rest_time = 0;
+                break;
+            case JUMPING:
+                sound_event("jump");
+                set_anim(kind+"-jump");
+                // notify objects on grid about the jumping - used by it_trigger
+                SendMessage(GetFloor(get_gridpos()), "_jumping", true);
+                SendMessage(GetItem(get_gridpos()), "_jumping", true);
+                SendMessage(GetStone(get_gridpos()), "_jumping", true);
+                break;
+            case APPEARING:
+            case RISING_VORTEX:
+                set_anim(kind+"-appear");
+                GrabActor(this);
+                break;
+            case JUMP_VORTEX:
+                ASSERT(oldstate == RISING_VORTEX, XLevelRuntime,
+                    "BasicBall: change to state JUMP_VORTEX but not RISING_VORTEX");
+                vortex_normal_time = 0;
+                set_model(kind);
+                ReleaseActor(this);
+                break;
+            case DISAPPEARING:
+                GrabActor(this);
+                disable_shield();
+                set_anim(kind+"-disappear");
+                break;
+            case RESURRECTED:
+                disable_shield();
+                sinkDepth = minSinkDepth;
+            break;
+            default:
+                break;
+        }
+    }
+    
+    void BasicBall::update_model() {
+        if (m_invisible_rest_time > 0)
+            get_sprite().hide();
+        else 
+            get_sprite().show();
+    
+        switch (state) {
+            case NORMAL:
+                if (sinkDepth > minSinkDepth && sinkDepth < maxSinkDepth) {
+                    set_sink_model(get_kind());
+                }
+                else {
+                    ActorInfo *ai = get_actorinfo();
+                    int xpos = ecl::round_nearest<int> (ai->pos[0] * 32.0);
+                    int ypos = ecl::round_nearest<int> (ai->pos[1] * 32.0);
+        
+                    bool shinep = ((xpos + ypos) % 2) != 0;
+                    set_shine_model (shinep);
+                }
+                break;
+            default:
+                break;
+        }
+    }
+    
+    void BasicBall::set_sink_model(const string &m) {
+        int modelnum = ecl::round_down<int>(sinkDepth);
+    
+        if (!has_shield() && modelnum != sinkModel) {
+            ASSERT(modelnum >= minSinkDepth && modelnum < maxSinkDepth, XLevelRuntime,
+                "BasicBall: set_sink_model called though modelnum incorrect");
+    
+            string img = m+"-sink";
+            img.append(1, static_cast<char>('0'+modelnum));
+            set_model(img);
+    
+            sinkModel = modelnum;
+        }
+    }
+    
+    void BasicBall::set_shine_model (bool shinep)
+    {
+        if (shinep != lastshinep) {
+            string modelname = get_kind();
+            if (shinep)
+                set_model (modelname + "-shine");
+            else
+                set_model (modelname);
+            lastshinep = shinep;
+        }
+    }
+    
+    void BasicBall::update_halo() {
+        HaloState newstate = m_halostate;
+    
+        if (m_shield_rest_time <= 0)
+            newstate = NOHALO;
+        else if (m_shield_rest_time <= 3.0)
+            newstate = HALOBLINK;
+        else
+            newstate = HALONORMAL;
+    
+        if (newstate != m_halostate) {
+            double radius = get_actorinfo()->radius;
+            string halokind;
+        
+            // Determine which halomodel has to be used:
+            if (radius == 19.0/64) { // Halo for normal balls
+                halokind = "halo";
+            } else if (radius == 13.0f/64) { // Halo for small balls
+                halokind = "halo-small";
+            }
+    
+            if (m_halostate == NOHALO){
+                m_halosprite = display::AddSprite (get_pos(), halokind.c_str());
+            }
+            switch (newstate) {
+            case NOHALO:
+                // remove halo
+                m_halosprite.kill();
+                m_halosprite = display::SpriteHandle();
+                break;
+            case HALOBLINK:
+                // blink for the last 3 seconds
+                m_halosprite.replace_model (display::MakeModel (halokind+"-blink"));
+                break;
+            case HALONORMAL:
+                m_halosprite.replace_model (display::MakeModel (halokind));
+                break;
+            }
+            m_halostate = newstate;
+        } else if (m_halostate != NOHALO) {
+            m_halosprite.move (get_pos());
+        }
+    }
+
+/* -------------------- Marble  -------------------- */
+    Marble::Marble(int color) : BasicBall(traits[color]) {
+        setAttr("adhesion", 1.0);
+        setAttr("color", color);
+        setAttr("player", color == BLACK ? 0 : 1);
+        setAttr("controllers", color == BLACK ? 1 : 2);
+    }
+    
+    std::string Marble::getClass() const {
+        return "ac_marble";
+    }
+
+    const char *Marble::get_kind() const {
+        return getAttr("color") == BLACK ? "ac_marble_black" : "ac_marble_white";
+    }
+
+    int Marble::traitsIdx() const {
+        return getAttr("color");
+    }
+
+    ActorTraits Marble::traits[2] = {
+        {"ac_marble_black", ac_marble_black, 1<<ac_marble_black, 19.0/64, 1.0},
+        {"ac_marble_white", ac_marble_white, 1<<ac_marble_white, 19.0/64, 1.0},
+    };
+
+/* -------------------- Pearl  -------------------- */
+    Pearl::Pearl(int color) : BasicBall(traits[color], 4) {
+        setAttr("adhesion", 1.0);
+        setAttr("color", color);
+        setAttr("player", 0);
+        setAttr("controllers", 3);
+    }
+
+    std::string Pearl::getClass() const {
+        return "ac_pearl";
+    }
+
+    const char *Pearl::get_kind() const {
+        return "ac_pearl_white";
+    }
+
+    int Pearl::traitsIdx() const {
+        return getAttr("color");
+    }
+
+    ActorTraits Pearl::traits[2] = {
+        {"ac_pearl_black", ac_pearl_black, 1<<ac_pearl_black, 13.0/64, 0.7},
+        {"ac_pearl_white", ac_pearl_white, 1<<ac_pearl_white, 13.0/64, 0.7},
+    };
+    
+    BOOT_REGISTER_START
+        BootRegister(new Marble(0), "ac_marble");
+        BootRegister(new Marble(0), "ac_marble_black");
+        BootRegister(new Marble(1), "ac_marble_white");
+        BootRegister(new Pearl(1), "ac_pearl");
+        BootRegister(new Pearl(1), "ac_pearl_white");
+    BOOT_REGISTER_END
+
+} // namespace enigma
+


Property changes on: trunk/src/actors/Balls.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/actors/Balls.hh
===================================================================
--- trunk/src/actors/Balls.hh	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/actors/Balls.hh	2008-12-21 16:00:40 UTC (rev 1404)
@@ -0,0 +1,149 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef BALLACTORS_HH
+#define BALLACTORS_HH
+
+#include "actors.hh"
+
+namespace enigma {
+
+    /** 
+     * ChargeStone
+     */
+    /*! The base class for all marbles. */
+    class BasicBall : public Actor {
+        
+    protected:
+        enum iState {
+            NO_STATE,
+            NORMAL,
+            SHATTERING,
+            BUBBLING,
+            FALLING,            // falling into abyss
+            JUMPING,
+            DEAD,               // marble is dead
+            RESURRECTED,        // has been resurrected; about to respawn
+            APPEARING,          // appearing when level starts/after respawn
+            DISAPPEARING,       // disappearing when level finished
+            FALLING_VORTEX,     // falling into vortex
+            RISING_VORTEX,      // appear in vortex
+            JUMP_VORTEX,        // jump out of vortex (here player controls actor)
+        };
+
+        enum HaloState {
+            NOHALO, HALOBLINK, HALONORMAL
+        };
+
+    public:
+        BasicBall(const ActorTraits &tr, int maxSinkDepthValue = 7);
+
+        // Object interface.
+//        virtual void setAttr(const string& key, const Value &val);
+//        virtual Value getAttr(const std::string &key) const;
+        virtual Value message(const Message &m);
+        
+        // Actor interface
+        virtual bool is_dead() const;
+        virtual bool is_movable() const;
+        virtual bool is_flying() const;
+        virtual bool is_on_floor() const;
+        virtual bool is_drunken() const;
+        virtual bool is_invisible() const;
+        virtual bool can_drop_items() const;
+        virtual bool can_pickup_items() const;
+        virtual bool can_be_warped() const;
+        virtual bool has_shield() const;
+        
+        virtual void on_creation(const ecl::V2 &pos);
+        virtual void think (double dtime);
+        virtual void on_respawn (const ecl::V2 &pos);
+
+        virtual void move_screen();
+        virtual void hide();
+        
+        // ModelCallback interface  - Animation callback
+        virtual void animcb();
+
+    private:
+        void sink(double dtime);
+        void disable_shield();
+        void change_state_noshield(iState newstate);
+        void change_state(iState newstate);
+
+        // Model management
+        void update_model();
+        void set_sink_model(const string &m);
+        void set_shine_model (bool shinep);
+        void update_halo();
+
+        static const int minSinkDepth = 0; // normal level
+        int maxSinkDepth;       // actor dies at this depth
+        double sinkDepth;       // how deep actor has sunk
+        int    sinkModel;       // current model
+        bool   lastshinep;
+
+        double vortex_normal_time; // while jumping out of vortex: time at normal level
+
+        // Variables
+        static const double   SHIELD_TIME;
+        display::SpriteHandle m_halosprite;
+        double                m_shield_rest_time;
+        HaloState             m_halostate;
+
+        double m_drunk_rest_time;
+        double m_invisible_rest_time;
+    };
+    
+/* -------------------- Marble  -------------------- */
+    class Marble : public BasicBall {
+        CLONEACTOR(Marble);
+        DECL_ACTORTRAITS_ARRAY(2, traitsIdx());
+        
+    public:
+        Marble(int color);
+        
+        // Object interface.
+        virtual std::string getClass() const;
+        virtual const char *get_kind() const;
+        
+    private:
+        int traitsIdx() const;
+    };
+    
+/* -------------------- Pearl  -------------------- */
+    class Pearl : public BasicBall {
+        CLONEACTOR(Pearl);
+        DECL_ACTORTRAITS_ARRAY(2, traitsIdx());
+        
+    public:
+        Pearl(int color);
+        
+        // Object interface.
+        virtual std::string getClass() const;
+        virtual const char *get_kind() const;
+        
+    private:
+        int traitsIdx() const;
+    };
+    
+
+} // namespace enigma
+
+#endif /*BALLACTORS_HH*/


Property changes on: trunk/src/actors/Balls.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/actors.cc	2008-12-21 16:00:40 UTC (rev 1404)
@@ -82,14 +82,6 @@
 }
 
 
-/* -------------------- Helper functions -------------------- */
-
-
-#define DECL_TRAITS \
-        static ActorTraits traits; \
-        const ActorTraits &get_traits() const { return traits; } \
-
-
 /* -------------------- Actor -------------------- */
 
 Actor::Actor (const ActorTraits &tr)
@@ -100,7 +92,7 @@
   respawnpos(), use_respawnpos(false),
   spikes(false), controllers (0), left (NULL), right (NULL)
 {
-    setAttr("mouseforce", 0.0);
+    setAttr("adhesion", 0.0);
 
     // copy default properties to dynamic properties
     m_actorinfo.mass = tr.default_mass;
@@ -262,7 +254,7 @@
 bool Actor::can_move() const { 
     if (Stone *st = GetStone (get_gridpos())) {
         if (!server::NoCollisions || !(get_traits().id_mask &
-                        (1<<ac_whiteball | 1<<ac_blackball | 1<<ac_meditation)))
+                        (1<<ac_marble_white | 1<<ac_marble_black | 1<<ac_marble_white)))
             return !st->is_sticky(this);
     }
     return true;
@@ -289,8 +281,8 @@
 {
     if (key == "controllers")
         controllers = to_int (val);
-    else if (key == "mouseforce") 
-        mouseforce = to_double (val);
+    else if (key == "adhesion") 
+        adhesion = to_double (val);
     Object::setAttr(key, val);
 }
 
@@ -380,7 +372,7 @@
     }
 
     ActorsInRangeIterator air_it = ActorsInRangeIterator(this, range,
-            1<<ac_whiteball | 1<<ac_blackball | 1<<ac_meditation);
+            1<<ac_marble_white | 1<<ac_marble_black | 1<<ac_marble_white);
     Actor *a;
     while((a = air_it.next()) != NULL) {
         if (a->is_movable() && !a->is_invisible()) {
@@ -419,7 +411,7 @@
 {
     class Rotor : public RotorBase {
         CLONEACTOR(Rotor);
-        DECL_TRAITS;
+        DECL_ACTORTRAITS;
    public:
         Rotor() : RotorBase (traits)
         {
@@ -441,7 +433,7 @@
 {
     class Top : public RotorBase {
         CLONEACTOR(Top);
-        DECL_TRAITS;
+        DECL_ACTORTRAITS;
     public:
         Top() : RotorBase (traits)
         {
@@ -463,7 +455,7 @@
 {
     class Bug : public Actor {
         CLONEACTOR(Bug);
-        DECL_TRAITS;
+        DECL_ACTORTRAITS;
     public:
         Bug() : Actor(traits) {}
         bool is_flying() const { return false; }
@@ -487,7 +479,7 @@
 {
     class Horse : public Actor {
         CLONEACTOR(Horse);
-        DECL_TRAITS;
+        DECL_ACTORTRAITS;
  
         int get_id() const { return ac_horse; }
         bool is_flying() const { return false; }
@@ -557,7 +549,7 @@
 {
     class CannonBall : public Actor {
         CLONEACTOR(CannonBall);
-        DECL_TRAITS;
+        DECL_ACTORTRAITS;
     public:
         CannonBall();
         bool is_flying() const { return true; }
@@ -612,628 +604,22 @@
     sprite.set_callback(this);
 }
 
-
-/* -------------------- BasicBall -------------------- */
-namespace
-{
-    /*! The base class for all marbles. */
-    class BasicBall : public Actor {
-    protected:
-        BasicBall(const ActorTraits &tr);
-
-        enum State {
-            NO_STATE,
-            NORMAL,
-            SHATTERING,
-            BUBBLING,
-            FALLING,            // falling into abyss
-            JUMPING,
-            DEAD,               // marble is dead
-            RESURRECTED,        // has been resurrected; about to respawn
-            APPEARING,          // appearing when level starts/after respawn
-            DISAPPEARING,       // disappearing when level finished
-            FALLING_VORTEX,     // falling into vortex
-            RISING_VORTEX,      // appear in vortex
-            JUMP_VORTEX,        // jump out of vortex (here player controls actor)
-        };
-
-        enum HaloState {
-            NOHALO, HALOBLINK, HALONORMAL
-        };
-
-        void sink (double dtime);
-        void disable_shield();
-        void change_state_noshield (State newstate);
-        void change_state(State newstate);
-
-        // Model management
-        void update_model();
-        void set_sink_model(const string &m);
-        void set_shine_model (bool shinep);
-        void update_halo();
-        virtual void hide();
-
-        /* ---------- Actor interface ---------- */
-        
-        virtual void think (double dtime);
-        virtual void move_screen ();
-
-        void on_creation(const ecl::V2 &p);
-        void on_respawn (const ecl::V2 &/*pos*/)
-        {
-            change_state(APPEARING);
-        }
-
-        bool is_dead() const;
-        bool is_movable() const;
-        bool is_flying() const { return state == JUMPING; }
-        bool is_on_floor() const;
-        bool is_drunken() const { return m_drunk_rest_time>0; }
-        bool is_invisible() const { return m_invisible_rest_time>0; }
-
-        bool can_drop_items() const;
-        bool can_pickup_items() const;
-        bool has_shield() const;
-
-        bool can_be_warped() const { return state==NORMAL; }
-
-        // Object interface.
-        virtual Value message(const Message &m);
-
-        // ModelCallback interface.
-        void animcb();
-
-        /* ---------- Variables ---------- */
-
-        State state;            // The marble's current state
-
-        static const int minSinkDepth = 0; // normal level
-        int maxSinkDepth;       // actor dies at this depth
-        double sinkDepth;       // how deep actor has sunk
-        int    sinkModel;       // current model
-        bool   lastshinep;
-
-        double vortex_normal_time; // while jumping out of vortex: time at normal level
-
-        display::SpriteHandle m_halosprite;
-        double                m_shield_rest_time;
-        static const double   SHIELD_TIME;
-        HaloState             m_halostate;
-
-        double m_drunk_rest_time;
-        double m_invisible_rest_time;
-    };
-
-    const double BasicBall::SHIELD_TIME = 10.0;
-}
-
-BasicBall::BasicBall(const ActorTraits &tr)
-: Actor                 (tr),
-  state                 (NO_STATE),
-  maxSinkDepth          (7),
-  sinkDepth             (minSinkDepth),
-  sinkModel             (-1),
-  lastshinep            (false),
-  vortex_normal_time    (0),
-  m_halosprite          (),
-  m_shield_rest_time    (0),
-  m_halostate           (NOHALO),
-  m_drunk_rest_time     (0),
-  m_invisible_rest_time (0)
-{
-}
-
-void BasicBall::on_creation(const ecl::V2 &p) 
-{
-    Actor::on_creation(p);
-    if (server::CreatingPreview)
-        change_state(NORMAL);
-    else
-        change_state(APPEARING);
-}
-
-
-void BasicBall::move_screen ()
-{
-    update_model();
-    update_halo();
-    Actor::move_screen();
-}
-
-bool BasicBall::is_movable() const 
-{
-    return (state!=DEAD && state!=RESURRECTED && state!=APPEARING && state!=DISAPPEARING); 
-}
-
-bool BasicBall::is_dead() const {
-    return state == DEAD;
-}
-
-bool BasicBall::is_on_floor() const {
-    return state == NORMAL || state == JUMP_VORTEX || state==APPEARING;
-}
-
-bool BasicBall::can_drop_items() const {
-    return state == NORMAL || state == JUMP_VORTEX || state==JUMPING;
-}
-
-bool BasicBall::can_pickup_items() const {
-    return state == NORMAL || state == JUMP_VORTEX;
-}
-
-void BasicBall::change_state_noshield (State newstate) 
-{
-    if (!has_shield())
-        change_state(newstate);
-}
-
-Value BasicBall::message(const Message &m) 
-{
-    bool handled = false;
-    switch (state) {
-        case NORMAL:
-            if (m.message == "shatter") {
-                change_state_noshield(SHATTERING);
-                handled = true;
-            } else if (m.message == "suicide") {
-                change_state(SHATTERING);
-                handled = true;
-            } else if (m.message == "laserhit") {
-                change_state_noshield(SHATTERING);
-                handled = true;
-            } else if (m.message == "fall") {
-                change_state_noshield(FALLING);
-                handled = true;
-            } else if (m.message == "_fallvortex") {
-                change_state(FALLING_VORTEX);
-                handled = true;
-            } else if (m.message == "jump") {
-                change_state(JUMPING);
-                handled = true;
-            } else if (m.message == "appear") {
-                change_state(APPEARING);
-                handled = true;
-            } else if (m.message == "disappear") {
-                change_state(DISAPPEARING);
-                handled = true;
-            }
-            break;
-        case JUMPING:
-            if (m.message == "shatter") {
-                change_state_noshield(SHATTERING);
-                handled = true;
-            } else if (m.message == "disappear") {
-                change_state(DISAPPEARING);
-                handled = true;
-            }
-            break;
-        case SHATTERING:
-            if (m.message == "_levelfinish") {
-                change_state(DEAD);
-                handled = true;
-            }
-            break;
-        case DEAD:
-            if (m.message == "resurrect") {
-                change_state(RESURRECTED);
-                handled = true;
-            }
-            break;
-        case FALLING_VORTEX:
-            if (m.message == "rise") {
-                change_state(RISING_VORTEX); // vortex->vortex teleportation
-            } else if (m.message == "appear") {
-                change_state(APPEARING); // vortex->non-vortex teleportation
-                handled = true;
-            }
-            break;
-        case JUMP_VORTEX:
-            if (m.message == "laserhit") {
-                change_state(SHATTERING);
-                handled = true;
-            }
-            break;
-        case APPEARING:
-            // ugly hack
-            if (m.message == "_init") {
-                Actor::message (m);
-                handled = true;
-            } else if (m.message == "shatter") {
-                change_state (SHATTERING);
-                handled = true;
-            }
-    	    break;
-        default:
-            break;
-    }
-
-    // Shield, booze and invisibility can be activated in all states except DEAD
-
-    if (state != DEAD) {
-        if (m.message == "shield") {
-            m_shield_rest_time += SHIELD_TIME;
-            update_halo();
-            handled = true;
-        }
-        else if (m.message == "_invisibility") {
-            m_invisible_rest_time += 8.0;
-            handled = true;
-        }
-        else if (m.message == "booze") {
-            m_drunk_rest_time += 5.0; // Drunken for 5 more seconds
-            handled = true;
-        }
-    }
-
-    return handled ? Value() : Actor::message(m);
-}
-
-void BasicBall::set_sink_model(const string &m)
-{
-    int modelnum = ecl::round_down<int>(sinkDepth);
-
-    if (!has_shield() && modelnum != sinkModel) {
-        ASSERT(modelnum >= minSinkDepth && modelnum < maxSinkDepth, XLevelRuntime,
-            "BasicBall: set_sink_model called though modelnum incorrect");
-
-        string img = m+"-sink";
-        img.append(1, static_cast<char>('0'+modelnum));
-        set_model(img);
-
-        sinkModel = modelnum;
-    }
-}
-
-void BasicBall::set_shine_model (bool shinep)
-{
-    if (shinep != lastshinep) {
-        string modelname = get_kind();
-        if (shinep)
-            set_model (modelname + "-shine");
-        else
-            set_model (modelname);
-        lastshinep = shinep;
-    }
-}
-
-void BasicBall::update_model()
-{
-    if (m_invisible_rest_time > 0)
-        get_sprite().hide();
-    else 
-        get_sprite().show();
-
-    switch (state) {
-    case NORMAL:
-        if (sinkDepth > minSinkDepth && sinkDepth < maxSinkDepth) {
-            set_sink_model(get_kind());
-        }
-        else {
-            ActorInfo *ai = get_actorinfo();
-            int xpos = ecl::round_nearest<int> (ai->pos[0] * 32.0);
-            int ypos = ecl::round_nearest<int> (ai->pos[1] * 32.0);
-
-            bool shinep = ((xpos + ypos) % 2) != 0;
-            set_shine_model (shinep);
-        }
-        break;
-    default:
-        break;
-    }
-}
-
-void BasicBall::sink (double dtime)
-{
-    double sink_speed  = 0.0;
-    double raise_speed = 0.0;   // at this velocity don't sink; above: raise
-
-    Floor *fl = m_actorinfo.field->floor;
-    Item *it = m_actorinfo.field->item;
-    if (!(it != NULL && it->covers_floor(get_pos(), this)) && fl != NULL)
-        fl->get_sink_speed (sink_speed, raise_speed);
     
-    if (sink_speed == 0.0 || has_shield()) {
-        sinkDepth = minSinkDepth;
-        sinkModel = -1;
-    }
-    else {
-        ActorInfo *ai = get_actorinfo();
-        double sinkSpeed = sink_speed * (1 - length(ai->vel) / raise_speed);
-        sinkDepth += sinkSpeed*dtime;
-
-        if (sinkDepth >= maxSinkDepth) {
-            set_model(string(get_kind())+"-sunk");
-            ai->vel = V2();     // stop!
-            sound_event ("swamp");
-            change_state(BUBBLING);
-        }
-        else {
-            if (sinkDepth < minSinkDepth) 
-                sinkDepth = minSinkDepth;
-        }
-    }
-}
-
-void BasicBall::think (double dtime) 
-{
-    if (m_invisible_rest_time > 0)
-        m_invisible_rest_time -= dtime;
-
-    // Update protection shield
-    if (m_shield_rest_time > 0) 
-        m_shield_rest_time -= dtime;
-
-    switch (state) {
-    case NORMAL: 
-        if (m_drunk_rest_time > 0) 
-            m_drunk_rest_time -= dtime;
-        sink (dtime);
-        break;
-    case JUMP_VORTEX:
-        vortex_normal_time += dtime;
-        if (vortex_normal_time > 0.025) // same time as appear animation
-            if (vortex_normal_time > dtime) // ensure min. one tick in state JUMP_VORTEX!
-                change_state(JUMPING); // end of short control over actor
-        break;
-    default:
-
-        break;
-    }
-
-    Actor::think(dtime);
-}
-
-void BasicBall::animcb()
-{
-    string kind=get_kind();
-
-    switch (state) {
-    case SHATTERING:
-        set_model(kind+"-shattered");
-        change_state(DEAD);
-        break;
-    case BUBBLING:
-        set_model("invisible");
-        change_state(DEAD);
-        break;
-    case FALLING:
-        set_model(kind+"-fallen"); // invisible
-        if (get_id (this) == ac_meditation)
-            sound_event ("shattersmall");
-        else
-            sound_event ("shatter");
-        change_state(DEAD);
-        break;
-    case JUMPING:
-        set_model(kind);
-        change_state(NORMAL);
-        break;
-    case APPEARING:
-        set_model(kind);
-        change_state(NORMAL);
-        break;
-    case DISAPPEARING:
-        set_model("ring-anim");
-        break;
-    case FALLING_VORTEX: {
-        set_model(kind+"-fallen"); // invisible
-        break;
-    }
-    case RISING_VORTEX: {
-        set_model(kind);
-        if (Item *it = GetItem(get_gridpos())) {
-            ItemID id = get_id(it);
-            if (id == it_vortex_open || id == it_vortex_closed) 
-                SendMessage(it, "_passed"); // closes some vortex
-        }
-        change_state(JUMP_VORTEX);
-        break;
-    }
-    default:
-        break;
-    }
-}
-
-void BasicBall::change_state(State newstate) {
-    if (newstate == state)
-        return;
-
-    string kind     = get_kind();
-    State  oldstate = state;
-    
-    if (oldstate == JUMPING) {
-        // notify objects on grid about the landing - used by it_trigger
-        SendMessage(GetStone(get_gridpos()), "_jumping", false);
-        SendMessage(GetItem(get_gridpos()), "_jumping", false);
-        SendMessage(GetFloor(get_gridpos()), "_jumping", false);
-    }
-
-    // Whatever happened to the ball, the sink depth
-    // should be returned to zero.
-    sinkDepth = minSinkDepth;
-    sinkModel = -1;
-
-    state = newstate;
-    switch (newstate) {
-    case NORMAL:
-        if (oldstate == APPEARING) {
-            ActorInfo *ai = get_actorinfo();
-            ai->forceacc = V2();
-        }
-        ReleaseActor(this);
-        break;
-
-    case SHATTERING:
-        if (get_id (this) == ac_meditation)
-            sound_event ("shattersmall");
-        else
-            sound_event ("shatter");
-        GrabActor(this);
-        set_anim (kind+"-shatter");
-        break;
-
-    case BUBBLING:
-        GrabActor(this);
-//         sound::PlaySound("drown");
-        set_anim ("ac-drowned");
-        break;
-    case FALLING:
-    case FALLING_VORTEX:
-        GrabActor(this);
-        set_anim(kind+"-fall");
-        break;
-    case DEAD: 
-        disable_shield();
-        m_drunk_rest_time = 0;
-        m_invisible_rest_time = 0;
-        break;
-    case JUMPING:
-        sound_event ("jump");
-        set_anim(kind+"-jump");
-        // notify objects on grid about the jumping - used by it_trigger
-        SendMessage(GetFloor(get_gridpos()), "_jumping", true);
-        SendMessage(GetItem(get_gridpos()), "_jumping", true);
-        SendMessage(GetStone(get_gridpos()), "_jumping", true);
-        break;
-    case APPEARING:
-    case RISING_VORTEX:
-        set_anim(kind+"-appear");
-        GrabActor(this);
-        break;
-    case JUMP_VORTEX:
-        ASSERT(oldstate == RISING_VORTEX, XLevelRuntime,
-            "BasicBall: change to state JUMP_VORTEX but not RISING_VORTEX");
-        vortex_normal_time = 0;
-        set_model(kind);
-        ReleaseActor(this);
-        break;
-    case DISAPPEARING:
-        GrabActor(this);
-        disable_shield();
-        set_anim(kind+"-disappear");
-        break;
-    case RESURRECTED:
-        disable_shield();
-        sinkDepth = minSinkDepth;
-	break;
-    default:
-        break;
-    }
-}
-
-void BasicBall::disable_shield() {
-    if (has_shield()) {
-        m_shield_rest_time = 0;
-        update_halo();
-    }
-}
-
-bool BasicBall::has_shield() const {
-    return m_shield_rest_time > 0;
-}
-
-void BasicBall::update_halo() {
-    HaloState newstate = m_halostate;
-
-    if (m_shield_rest_time <= 0)
-        newstate = NOHALO;
-    else if (m_shield_rest_time <= 3.0)
-        newstate = HALOBLINK;
-    else
-        newstate = HALONORMAL;
-
-    if (newstate != m_halostate) {
-        double radius = get_actorinfo()->radius;
-        string halokind;
-    
-        // Determine which halomodel has to be used:
-        if (radius == 19.0/64) { // Halo for normal balls
-            halokind = "halo";
-        } else if (radius == 13.0f/64) { // Halo for small balls
-            halokind = "halo-small";
-        }
-
-        if (m_halostate == NOHALO){
-            m_halosprite = display::AddSprite (get_pos(), halokind.c_str());
-        }
-        switch (newstate) {
-        case NOHALO:
-            // remove halo
-            m_halosprite.kill();
-            m_halosprite = display::SpriteHandle();
-            break;
-        case HALOBLINK:
-            // blink for the last 3 seconds
-            m_halosprite.replace_model (display::MakeModel (halokind+"-blink"));
-            break;
-        case HALONORMAL:
-            m_halosprite.replace_model (display::MakeModel (halokind));
-            break;
-        }
-        m_halostate = newstate;
-    } else if (m_halostate != NOHALO) {
-        m_halosprite.move (get_pos());
-    }
-}
-
-void BasicBall::hide() {
-    Actor::hide();
-    disable_shield();
-}
-
 //----------------------------------------
 // Balls of different sorts
 //----------------------------------------
 
 namespace
 {
-    class BlackBall : public BasicBall {
-        CLONEACTOR(BlackBall);
-        DECL_TRAITS;
-    public:
-        BlackBall() : BasicBall(traits)
-        {
-            setAttr("mouseforce", Value(1.0));
-            setAttr("color", Value(0.0));
-            setAttr("player", Value(0.0));
-            setAttr("controllers", Value(1.0));
-        }
-    };
 
-    class WhiteBall : public BasicBall {
-        CLONEACTOR(WhiteBall);
-        DECL_TRAITS;
-    public:
-        WhiteBall() : BasicBall(traits)
-        {
-            setAttr("mouseforce", Value(1.0));
-            setAttr("color", Value(1.0));
-            setAttr("player", Value(1.0));
-            setAttr("controllers", Value(2.0));
-        }
-    };
-
-    class WhiteBall_Small : public BasicBall {
-        CLONEACTOR(WhiteBall_Small);
-        DECL_TRAITS;
-    public:
-        WhiteBall_Small() : BasicBall(traits)
-        {
-            setAttr("mouseforce", Value(1.0));
-            setAttr("color", Value(1.0));
-            setAttr("controllers", Value(3.0));
-            maxSinkDepth = 4;
-        }
-    };
-
     class Killerball : public Actor {
         CLONEACTOR(Killerball);
-        DECL_TRAITS;
+        DECL_ACTORTRAITS;
     public:
 
         Killerball() : Actor (traits)
         {
-            setAttr("mouseforce", Value(2.0));
+            setAttr("adhesion", Value(2.0));
             setAttr("color", Value(1.0));
             setAttr("controllers", Value(3.0));
         }
@@ -1245,30 +631,6 @@
     };
 }
 
-ActorTraits BlackBall::traits = {
-    "ac-blackball",             // name
-    ac_blackball,               // id
-    1<<ac_blackball,            // id_mask
-    19.0/64,                    // radius
-    1.0                         // mass
-};
-
-ActorTraits WhiteBall::traits = {
-    "ac-whiteball",             // name
-    ac_whiteball,               // id
-    1<<ac_whiteball,            // id_mask
-    19.0/64,                    // radius
-    1.0                         // mass
-};
-
-ActorTraits WhiteBall_Small::traits = {
-    "ac-whiteball-small",       // name
-    ac_meditation,              // id
-    1<<ac_meditation,           // id_mask
-    13.0f/64,                   // radius
-    0.7f                        // mass
-};
-
 ActorTraits Killerball::traits = {
     "ac-killerball",            // name
     ac_killerball,              // id
@@ -1286,9 +648,6 @@
     RegisterActor (new Horse);
     RegisterActor (new Rotor);
     RegisterActor (new Top);
-    RegisterActor (new BlackBall);
-    RegisterActor (new WhiteBall);
-    RegisterActor (new WhiteBall_Small);
     RegisterActor (new Killerball);
     RegisterActor (new CannonBall);
 }

Modified: trunk/src/actors.hh
===================================================================
--- trunk/src/actors.hh	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/actors.hh	2008-12-21 16:00:40 UTC (rev 1404)
@@ -26,17 +26,18 @@
     enum ActorID {
         ac_INVALID    = -1,
         ac_FIRST      = 0,
-        ac_blackball  = 0,
-        ac_whiteball  = 1,
-        ac_meditation = 2,
-        ac_killerball = 3,
-        ac_rotor      = 4,
-        ac_top        = 5,
-        ac_horse      = 6,
-        ac_bug        = 7,
-        ac_cannonball = 8,
-        ac_spermbird  = 9,
-        ac_LAST       = 9,
+        ac_marble_black  = 0,
+        ac_marble_white  = 1,
+        ac_pearl_black   = 2,
+        ac_pearl_white   = 3,
+        ac_killerball = 4,
+        ac_rotor      = 5,
+        ac_top        = 6,
+        ac_horse      = 7,
+        ac_bug        = 8,
+        ac_cannonball = 9,
+        ac_spermbird  = 10,
+        ac_LAST       = 10,
         ac_COUNT
     };
 
@@ -176,8 +177,9 @@
 
         static double get_max_radius(); // max. radius of all actors
 
-        int get_controllers () const { return controllers; }
-        double get_mouseforce () const { return mouseforce; }
+        int get_controllers() const { return controllers; }
+        bool isSteerable() const { return adhesion != 0.0; }
+        double get_mouseforce() const { return adhesion; }
 
         bool controlled_by(int player) const {
             return (get_controllers() & (1+player)) != 0;
@@ -207,7 +209,7 @@
         bool                  use_respawnpos;
         bool                  spikes; // set by "it-pin"
         int                   controllers;
-        double                mouseforce;
+        double                adhesion;
         GridPos               last_gridpos;   // last pos handled by actor move
     };
 
@@ -244,6 +246,18 @@
 
     void InitActors();
     
+/* -------------------- Actor Macros -------------------- */
+
+
+#define DECL_ACTORTRAITS \
+        static ActorTraits traits; \
+        const ActorTraits &get_traits() const { return traits; } \
+
+#define DECL_ACTORTRAITS_ARRAY(n, subtype_expr)                                  \
+        static ActorTraits traits[n];                                            \
+        const ActorTraits &get_traits() const { return traits[subtype_expr]; }
+
+    
 } // namespace enigma
 
 #endif

Modified: trunk/src/items/Meditation.cc
===================================================================
--- trunk/src/items/Meditation.cc	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/items/Meditation.cc	2008-12-21 16:00:40 UTC (rev 1404)
@@ -134,7 +134,7 @@
         static const double MINTIME = 1.0;
         ItemID id = get_id(this);
     
-        if (whiteball == NULL && !a->is_flying() && get_id(a) == ac_meditation && isMeditating(a)) {
+        if (whiteball == NULL && !a->is_flying() && get_id(a) == ac_pearl_white && isMeditating(a)) {
             // meditatist entered a free hollow
             whiteball  = a;
             enter_time = server::LevelTime;
@@ -218,7 +218,7 @@
         std::vector<Actor*> actors;
         GetActorsInsideField(get_pos(), actors);
         for (std::vector<Actor*>::iterator itr = actors.begin(); itr != actors.end(); ++itr) {
-            if (!(*itr)->is_flying() &&  whiteball==NULL && get_id(*itr)==ac_meditation && isMeditating(*itr)) {
+            if (!(*itr)->is_flying() &&  whiteball==NULL && get_id(*itr)==ac_pearl_white && isMeditating(*itr)) {
                  // meditatist entered a free hollow
                 whiteball  = *itr;
                 enter_time = server::LevelTime;

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/items.cc	2008-12-21 16:00:40 UTC (rev 1404)
@@ -1778,7 +1778,7 @@
             int     iplayer = a->getAttr("player");
             ActorID id      = get_id (a);
 
-            if (id == ac_blackball || id == ac_whiteball) {
+            if (id == ac_marble_black || id == ac_marble_white) {
                 // Kill ALL rubberbands connected with the actor:
                 SendMessage(a, "disconnect");
                 Actor *rotor = MakeActor("ac-rotor");

Modified: trunk/src/oxyd.cc
===================================================================
--- trunk/src/oxyd.cc	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/oxyd.cc	2008-12-21 16:00:40 UTC (rev 1404)
@@ -501,11 +501,11 @@
 
         switch (marble.getMarbleType()) {
         case MarbleType_Black:
-            ac = MakeActor("ac-blackball");
+            ac = MakeActor("ac_marble_black");
             ac->setAttr ("player", Value(0.0));
             break;
         case MarbleType_White:
-            ac = MakeActor ("ac-whiteball");
+            ac = MakeActor ("ac_marble_white");
             ac->setAttr ("player", Value(1.0));
             break;
         case MarbleType_Meditation:
@@ -517,7 +517,7 @@
                 ac->setAttr ("controllers", Value (3.0));
             }
             else {
-                ac = MakeActor ("ac-whiteball-small");
+                ac = MakeActor("ac_pearl_white");
                 nmeditationmarbles += 1;
 
                 if (config.twoplayers && (nmeditationmarbles % 2) == 0)
@@ -893,7 +893,7 @@
     PerOxydLoader (level, c).load();
 
     // Add a yinyang item if a white marble is present
-    if (CountActorsOfKind (ac_whiteball) > 0)
+    if (CountActorsOfKind (ac_marble_white) > 0)
         player::AddYinYang();
 }
 

Modified: trunk/src/player.cc
===================================================================
--- trunk/src/player.cc	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/player.cc	2008-12-21 16:00:40 UTC (rev 1404)
@@ -434,7 +434,7 @@
             if (!a->is_dead() ||
                     (pl >= 0 && server::ConserveLevel && resurrect_actor(pl, a))) {
                 // actor is still alive
-                if (pl >= 0 && a->controlled_by(pl) && a->get_mouseforce() != 0.0) {
+                if (pl >= 0 && a->controlled_by(pl) && a->isSteerable()) {
                     has_living_actor = true;
                 }
                 // count number of alive actors per kind

Modified: trunk/src/stones/Switch.cc
===================================================================
--- trunk/src/stones/Switch.cc	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/stones/Switch.cc	2008-12-21 16:00:40 UTC (rev 1404)
@@ -100,8 +100,8 @@
     
     void Switch::actor_hit(const StoneContact &sc) {
         int ic = iColor();
-        if (ic == 0 || (ic == 1 && get_id(sc.actor) == ac_blackball)
-                 || (ic == 2 && get_id (sc.actor) == ac_whiteball))  // TODO why no small whiteballs?
+        if (ic == 0 || (ic == 1 && get_id(sc.actor) == ac_marble_black)
+                 || (ic == 2 && get_id (sc.actor) == ac_marble_white))  // TODO why no small whiteballs?
             setState(ON - state);  // switch on only if OFF, switch off only if ON, otherwise ignore
     }
 

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/stones.cc	2008-12-21 16:00:40 UTC (rev 1404)
@@ -742,7 +742,7 @@
                         o = SendMessage(m.sender, "_hitactor");
                     
                     Actor *a = dynamic_cast<Actor *>(o);
-                    if ((a && get_id(a) == ac_blackball) || 
+                    if ((a && get_id(a) == ac_marble_black) || 
                             (m.sender->getObjectType() != Object::ITEM && m.message == "signal")) {
                         if (p.y == sender->get_pos().y) {
                             SendMessage (GetStone (move (p, EAST)),  "signal", 1.0);
@@ -782,7 +782,7 @@
                         o = SendMessage(m.sender, "_hitactor");
                         
                     Actor *a = dynamic_cast<Actor *>(o);
-                    if ((a && get_id(a) == ac_whiteball) ||
+                    if ((a && get_id(a) == ac_marble_white) ||
                              (m.sender->getObjectType() != Object::ITEM && m.message == "signal")) {
                         if (p.y == sender->get_pos().y) {
                             SendMessage (GetStone (move (p, EAST)),  "signal", 1.0);

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/stones_simple.cc	2008-12-21 16:00:40 UTC (rev 1404)
@@ -330,7 +330,7 @@
 
         StoneResponse collision_response(const StoneContact &sc) {
             ActorID id = get_id(sc.actor);
-            if (id == ac_horse || id == ac_meditation || id == ac_killerball)
+            if (id == ac_horse || id == ac_pearl_white || id == ac_killerball)
                 return STONE_PASS;
             else
                 return STONE_REBOUND;

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-12-21 00:11:43 UTC (rev 1403)
+++ trunk/src/world.cc	2008-12-21 16:00:40 UTC (rev 1404)
@@ -434,7 +434,7 @@
         a->on_creation(pos);
     }
     
-    if (get_id(a) == ac_meditation)
+    if (get_id(a) == ac_pearl_white)
         ChangeMeditation(+1, 0, 0, 0);
 }
 
@@ -986,7 +986,7 @@
     double x = ai.pos[0];
     double y = ai.pos[1];
     bool noCollisions = server::NoCollisions  && 
-                (a->get_traits().id_mask & (1<<ac_whiteball | 1<<ac_blackball | 1<<ac_meditation));
+                (a->get_traits().id_mask & (1<<ac_marble_white | 1<<ac_marble_black | 1<<ac_pearl_white));
     
     // info about a Window stone on the Gridpos of the actor that may cause
     // contacts within the grid
@@ -1131,7 +1131,7 @@
     double     restitution = 1.0; //0.85;
 
     if (server::NoCollisions && (sc.stoneid != st_borderstone) && 
-                a->get_traits().id_mask & (1<<ac_whiteball | 1<<ac_blackball | 1<<ac_meditation))
+                a->get_traits().id_mask & (1<<ac_marble_white | 1<<ac_marble_black | 1<<ac_pearl_white))
         return;
 
     Contact contact (sc.contact_point, sc.normal);
@@ -2224,8 +2224,8 @@
         return 0;
 
     switch (get_id(thisMarble)) {
-    case ac_blackball: return FindActorByID (ac_whiteball);
-    case ac_whiteball: return FindActorByID (ac_blackball);
+        case ac_marble_black: return FindActorByID (ac_marble_white);
+        case ac_marble_white: return FindActorByID (ac_marble_black);
     default:
         return 0;
     }



From ral at mail.berlios.de  Sun Dec 21 17:23:59 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 21 Dec 2008 17:23:59 +0100
Subject: [Enigma-game-svn] r1405 - team_levelpacks/team_test_new_api
Message-ID: <200812211623.mBLGNxqn008869@sheep.berlios.de>

Author: ral
Date: 2008-12-21 17:23:29 +0100 (Sun, 21 Dec 2008)
New Revision: 1405

Modified:
   team_levelpacks/team_test_new_api/andreasT01_1.xml
   team_levelpacks/team_test_new_api/andreasT02_1.xml
   team_levelpacks/team_test_new_api/ralD001_1.xml
   team_levelpacks/team_test_new_api/ralD002_1.xml
   team_levelpacks/team_test_new_api/ralD003_1.xml
   team_levelpacks/team_test_new_api/ralD004_1.xml
   team_levelpacks/team_test_new_api/ralD005_1.xml
   team_levelpacks/team_test_new_api/ralD006_1.xml
   team_levelpacks/team_test_new_api/ralD007_1.xml
   team_levelpacks/team_test_new_api/ralT014_1.xml
   team_levelpacks/team_test_new_api/ralT016_1.xml
   team_levelpacks/team_test_new_api/ralT017_1.xml
   team_levelpacks/team_test_new_api/ralT018_1.xml
   team_levelpacks/team_test_new_api/ralT019_1.xml
   team_levelpacks/team_test_new_api/ralT021_1.xml
   team_levelpacks/team_test_new_api/ralT024_1.xml
   team_levelpacks/team_test_new_api/ralT025_1.xml
   team_levelpacks/team_test_new_api/ralT026_1.xml
   team_levelpacks/team_test_new_api/ralT027_1.xml
   team_levelpacks/team_test_new_api/ralT028_1.xml
   team_levelpacks/team_test_new_api/ralT029_1.xml
   team_levelpacks/team_test_new_api/ralT030_1.xml
   team_levelpacks/team_test_new_api/ralT031_1.xml
   team_levelpacks/team_test_new_api/ralT032_1.xml
   team_levelpacks/team_test_new_api/ralT033_1.xml
   team_levelpacks/team_test_new_api/ralT034_1.xml
   team_levelpacks/team_test_new_api/ralT035_1.xml
   team_levelpacks/team_test_new_api/ralT036_1.xml
   team_levelpacks/team_test_new_api/ralT037_1.xml
   team_levelpacks/team_test_new_api/ralT038_1.xml
   team_levelpacks/team_test_new_api/ralT039_1.xml
   team_levelpacks/team_test_new_api/ralT040_1.xml
   team_levelpacks/team_test_new_api/ralT041_1.xml
   team_levelpacks/team_test_new_api/ralT042_1.xml
   team_levelpacks/team_test_new_api/ralT043_1.xml
   team_levelpacks/team_test_new_api/ralT044_1.xml
   team_levelpacks/team_test_new_api/ralT045_1.xml
   team_levelpacks/team_test_new_api/ralT046_1.xml
   team_levelpacks/team_test_new_api/ralT047_1.xml
   team_levelpacks/team_test_new_api/ralT049_1.xml
   team_levelpacks/team_test_new_api/ralT050_1.xml
   team_levelpacks/team_test_new_api/ralT051_1.xml
   team_levelpacks/team_test_new_api/ralT052_1.xml
   team_levelpacks/team_test_new_api/ralT053_1.xml
   team_levelpacks/team_test_new_api/ralT054_1.xml
   team_levelpacks/team_test_new_api/ralT055_1.xml
   team_levelpacks/team_test_new_api/ralT057_1.xml
   team_levelpacks/team_test_new_api/ralT058_1.xml
   team_levelpacks/team_test_new_api/ralT059_1.xml
   team_levelpacks/team_test_new_api/ralT060_1.xml
   team_levelpacks/team_test_new_api/ralT061_1.xml
   team_levelpacks/team_test_new_api/ralT062_1.xml
   team_levelpacks/team_test_new_api/ralT063_1.xml
   team_levelpacks/team_test_new_api/ralT064_1.xml
   team_levelpacks/team_test_new_api/ralT065_1.xml
   team_levelpacks/team_test_new_api/ralT066_1.xml
   team_levelpacks/team_test_new_api/ralT067_1.xml
   team_levelpacks/team_test_new_api/ralT068_1.xml
   team_levelpacks/team_test_new_api/ralT069_1.xml
   team_levelpacks/team_test_new_api/ralT071_1.xml
   team_levelpacks/team_test_new_api/ralT072_1.xml
   team_levelpacks/team_test_new_api/raoulT01_1.xml
   team_levelpacks/team_test_new_api/raoulT02_1.xml
   team_levelpacks/team_test_new_api/raoulT03_1.xml
   team_levelpacks/team_test_new_api/raoulT04_1.xml
   team_levelpacks/team_test_new_api/raoulT05_1.xml
   team_levelpacks/team_test_new_api/raoulT06_1.xml
   team_levelpacks/team_test_new_api/raoulT07_1.xml
   team_levelpacks/team_test_new_api/raoulT08_1.xml
   team_levelpacks/team_test_new_api/raoulT09_1.xml
Log:
Test Level new API:
- updates for actor renamings


Modified: team_levelpacks/team_test_new_api/andreasT01_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/andreasT01_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/andreasT01_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -23,7 +23,7 @@
 
 ti["."] = {"it_trap"}
 
-ti["@"] = {"#ac-blackball"}
+ti["@"] = {"#ac_marble"}
 ti["0"] = {"#ac-bug"}
 
 ti["l"] = {"st_laser", state = ON, orientation = SOUTH}

Modified: team_levelpacks/team_test_new_api/andreasT02_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/andreasT02_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/andreasT02_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -42,14 +42,14 @@
 ti["H"] = {"fl-floor_001"}
 ti["R"] = {"fl-red"}
 
-ti[" @"] = {"#ac-blackball", "marble"}
+ti[" @"] = {"#ac_marble", "marble"}
 ti[" d"] = {"st_death", "death#"}
 ti[" 1"] = {"it_wrench"}
 ti[" S"] = {"st_switch", target = "call_switch1"}
 ti[" T"] = {"st_switch", target = "call_switch2"}
 ti[" U"] = {"st_switch", target = "call_switch3"}
 
-ti["@"] = {"#ac-blackball", "marble"}
+ti["@"] = {"#ac_marble", "marble"}
 ti["d"] = {"st_death", "death#"}
 ti["1"] = {"it_wrench", "wrench#"}
 

Modified: team_levelpacks/team_test_new_api/ralD001_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD001_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralD001_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -17,7 +17,7 @@
     <el:luamain><![CDATA[
 ti["r"] = {"fl-rough-red"}
 ti["b"] = {"fl-rough-blue"}
-ti["1"] = {"#ac-blackball"}
+ti["1"] = {"#ac_marble"}
 
 ti["x"] = {"it_cross"}
 

Modified: team_levelpacks/team_test_new_api/ralD002_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD002_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralD002_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -18,7 +18,7 @@
 ti["~"] = {"fl_water"}
 ti["s"] = {"fl-sahara"}
 ti["t"] = {"fl-tigris"}
-ti["1"] = {"ac-blackball", 0, 0.5}
+ti["1"] = {"ac_marble", 0, 0.5}
 
 ti["template_trigger"] = {"it_trigger", target="myoxyd%%", action="open"}
 ti["template_oxyd"]    = ti["~"] .. {"st_oxyd", "myoxyd%%"}

Modified: team_levelpacks/team_test_new_api/ralD003_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD003_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralD003_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -21,7 +21,7 @@
 ti[" "] = {"fl-plank"}
 ti["c"] = {"it-crack3", brittleness=0}
 ti["^"] = {"st_oneway_n"}
-ti["1"] = {"ac-blackball", 0, 0.5}
+ti["1"] = {"ac_marble", 0, 0.5}
 
 ti["x"] = {"st_oxyd", "island#"}
 ti["y"] = {"st_oxyd", "left#"}

Modified: team_levelpacks/team_test_new_api/ralD004_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD004_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralD004_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -25,7 +25,7 @@
 ti["c"] = {"it_coin_s"}
 ti["p"] = {"it_brush"}
 
-ti["1"] = {"ac-blackball", 0, 0.5}
+ti["1"] = {"ac_marble", 0, 0.5}
 
 simple_random = res.random(ti, " ", {"s", "t"})
 

Modified: team_levelpacks/team_test_new_api/ralD005_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD005_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralD005_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -21,8 +21,8 @@
 ti["W"] = {"st_passage_white", flavor="cross"}
 
 ti["y"] = {"it-yinyang"}
-ti["1"] = ti["y"] .. {"#ac-blackball"}
-ti["2"] = ti["y"] .. {"#ac-whiteball"}
+ti["1"] = ti["y"] .. {"#ac_marble_black"}
+ti["2"] = ti["y"] .. {"#ac_marble_white"}
 
 function myresolver(key, x, y)
     if key == "w" then

Modified: team_levelpacks/team_test_new_api/ralD006_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD006_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralD006_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -43,7 +43,7 @@
 
 ti["+"] = {"fl-samba", checkerboard=0} .. ti({"fl_wood", checkerboard=1})
 
-ti["1"] = {"#ac-blackball"}
+ti["1"] = {"#ac_marble"}
 
 if wo["IsDifficult"] then
     ti["="] = ti["~"]

Modified: team_levelpacks/team_test_new_api/ralD007_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD007_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralD007_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -28,7 +28,7 @@
 ti["I"] = {"st_puzzle_blue", intensity=2/6} 
 ti["M"] = {"st_puzzle_blue", algorithm="marked", intensity=10} 
 
-ti["xx"] = {"#ac-blackball"} .. ti({"it_magicwand"})
+ti["xx"] = {"#ac_marble"} .. ti({"it_magicwand"})
 
 local resolver = res.puzzle(ti, "B", "Y", "I", "M")
 

Modified: team_levelpacks/team_test_new_api/ralT014_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT014_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT014_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -26,7 +26,7 @@
 ti["c"] = {"it_cherry", name="cherry#"}
 ti["5"] = {"it_coin_m", name="money", target={"otto", "emil*"}}
 ti["S"] = {"st_coinslot"}
-ti["m"] = {"#ac-blackball"}
+ti["m"] = {"#ac_marble"}
 ti["x"] = {"fl-rough-blue"} .. {"it_banana"} .. ti({"ac-bug", 0.7})
 ti["y"] = (ti({"fl-rough-blue"}) .. {"it_banana"}) .. {"ac-bug", name="buggy"}
 ti["s"] = {"st_switch", action="callback", target="doit"}

Modified: team_levelpacks/team_test_new_api/ralT016_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT016_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT016_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -50,7 +50,7 @@
 
 
 ti["X"] = {"st_oxyd"}
-ti["1"] = {"#ac-blackball"}
+ti["1"] = {"#ac_marble"}
 
 w, h = wo(ti, " ", {
 "###X##########X#####",

Modified: team_levelpacks/team_test_new_api/ralT017_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT017_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT017_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -26,7 +26,7 @@
 ti["P"] = ti[" "] .. {"st_oxyd", name="p#"}
 ti["Q"] = ti[" "] .. {"st_oxyd", name="q1", oxydcolor=5, noshuffle=false}
 ti["q"] = ti[" "] .. {"st_oxyd", name="q2", oxydcolor=7, noshuffle=true}
-ti["1"] = ti[" "] .. {"#ac-blackball"}
+ti["1"] = ti[" "] .. {"#ac_marble"}
 
 w, h = wo(ti, " ", {
 "   O          O     ",

Modified: team_levelpacks/team_test_new_api/ralT018_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT018_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT018_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -28,7 +28,7 @@
 ti["Q"] = {"st_oxyd", name="q1", oxydcolor=5}
 --ti["S"] = ti[" "] .. {"st_switch", action="shuffle", target="o#1"}
 ti["S"] = {"st_switch", action="callback", target="newflavor"}
-ti["1"] = {"#ac-blackball"}
+ti["1"] = {"#ac_marble_black"}
 ti["B"] = {"st_oxyd", oxydcolor=OXYD_BOLD, flavor="d", noshuffle=false}
 ti["F"] = {"st_oxyd", oxydcolor=OXYD_QUAKE, flavor="a", noshuffle=false}
 ti["K"] = {"st_oxyd", oxydcolor=OXYD_FAKE, flavor="c", noshuffle=false}

Modified: team_levelpacks/team_test_new_api/ralT019_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT019_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT019_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -28,7 +28,7 @@
 ti["R"] = {"st_oxyd", name="r#"}
 ti["S"] = {"st_oxyd", name="s#1"}
 ti["T"] = {"st_oxyd", name="t#1"}
-ti["1"] = {"#ac-blackball"}
+ti["1"] = {"#ac_marble"}
 
 w, h = wo(ti, " ", {
 "S  OOO              ",

Modified: team_levelpacks/team_test_new_api/ralT021_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT021_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT021_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -30,7 +30,7 @@
 ti["W"] = {"st_wood"}
 ti["S"] = {"st_switch", target="autoclose"}
 
-ti["1"] = {"#ac-blackball"}
+ti["1"] = {"#ac_marble"}
 
 w, h = wo(ti, " ", {
 "   R                ",

Modified: team_levelpacks/team_test_new_api/ralT024_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT024_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT024_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -40,8 +40,8 @@
 ti["s"] = {"st_switch", target="recolor"}
 ti["w"] = {"it_hammer"}
 
-ti["1"] = ti["y"] .. {"#ac-blackball"}
-ti["2"] = ti["y"] .. {"#ac-whiteball"}
+ti["1"] = ti["y"] .. {"#ac_marble_black"}
+ti["2"] = ti["y"] .. {"#ac_marble_white"}
 
 w, h = wo(ti, " ", {
 "                    ",

Modified: team_levelpacks/team_test_new_api/ralT025_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT025_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT025_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -50,7 +50,7 @@
 ti["H"] = {"st_fourswitch", counterclock=true, name="anticlock"}
 
 
-ti["1"] = {"#ac-blackball"}
+ti["1"] = {"#ac_marble"}
 
 w, h = wo(ti, " ", {
 "            f  s    ",

Modified: team_levelpacks/team_test_new_api/ralT026_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT026_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT026_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -34,7 +34,7 @@
 ti["s"] = ti[" "] .. {"st_switch", target="innercircle"}
 
 
-ti["a"] = ti[" "] .. {"#ac-blackball"}
+ti["a"] = ti[" "] .. {"#ac_marble"}
 
 w, h = wo(ti, " ", {
 "                    ",

Modified: team_levelpacks/team_test_new_api/ralT027_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT027_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT027_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -21,7 +21,7 @@
 
 ti[" "] = {"fl-sahara"}
 ti["b"] = {"it_blocker"}
-ti["n"] = {"it_blocker_new"}
+ti["n"] = {"it_blocker_new"}                  
 ti["B"] = {"st_blocker"}
 ti["N"] = {"st_blocker_new"}
 
@@ -41,7 +41,7 @@
 
 
 
-ti["1"] = (ti[" "] .. {"#ac-blackball"}) .. {"it_magicwand"}
+ti["1"] = (ti[" "] .. {"#ac_marble"}) .. {"it_magicwand"}
 
 w, h = wo(ti, " ", {
 "                    ",

Modified: team_levelpacks/team_test_new_api/ralT028_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT028_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT028_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -39,7 +39,7 @@
 ti["s"] = {"st_swap"}
 ti["X"] = {"st_switch", target="o%1", action="shuffle"}
 ti["Y"] = {"st_switch", target="o%1", action="closeall"}
-ti["@"] = (ti[" "] .. {"it_magicwand"}) .. {"#ac-blackball"}
+ti["@"] = (ti[" "] .. {"it_magicwand"}) .. {"#ac_marble"}
 
 ti["w"] = {"st_switch", target="Laser%7", action="toggle"}
 ti["f"] = {"st_quake"}

Modified: team_levelpacks/team_test_new_api/ralT029_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT029_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT029_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -47,7 +47,7 @@
 ti["c"] = ti[" "] .. {"st_switch", "south", target="change"}
 ti["d"] = ti[" "] .. {"st_switch", "west", target="change"}
 
-ti["A"] = (ti[" "] .. {"st_brake"}) .. {"#ac-blackball"}
+ti["A"] = (ti[" "] .. {"st_brake"}) .. {"#ac_marble"}
 
 ti["D"] = ti[" "] .. {"st_switch", target="deletion"}
 ti["E"] = ti[" "] .. {"st_switch", target="recluster"}

Modified: team_levelpacks/team_test_new_api/ralT030_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT030_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT030_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -32,7 +32,7 @@
 ti["R"] = ti[" "] .. {"st_panel", faces="ne"}
 
 
-ti["A"] = (ti[" "] .. {"st_brake"}) .. {"#ac-blackball"}
+ti["A"] = (ti[" "] .. {"st_brake"}) .. {"#ac_marble"}
 
 
 ti["w"] = ti[" "] .. {"st_switch", target="Laser", action="toggle"}

Modified: team_levelpacks/team_test_new_api/ralT031_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT031_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT031_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -59,13 +59,13 @@
 ti["m"] = ti[" "] .. {"st_switch", target="makeactor"}
 ti["X"] = ti[" "] .. {"it_wormhole", destination="triggerA", range=1}
 
-ti["1"] = (ti[" "] .. {"#ac-blackball"}) .. {"it-ring"}
-ti["2"] = ti[" "] .. {"#ac-whiteball-small", player=nil, controllers=0}
+ti["1"] = (ti[" "] .. {"#ac_marble"}) .. {"it-ring"}
+ti["2"] = ti[" "] .. {"#ac_pearl", player=DEFAULT, controllers=0}
 
-ti["3"] = (ti[" "]  .. {"#ac-whiteball-small", controllers=0})
+ti["3"] = (ti[" "]  .. {"#ac_pearl", controllers=0})
                 .. {"it_trigger", target={"laserh","laserhon"}, action={"toggle", "on"}}
 ti["4"] = (ti[" "]  .. {"it_trigger", target={"laserj","laserjon"}, action={"toggle", "on"}})
-                .. {"#ac-whiteball-small", controllers=0}
+                .. {"#ac_pearl", controllers=0}
 ti["5"] = (ti[" "]  .. {"it_trigger", target={"laserl","laserlon"}, action={"toggle", "on"}})
                 .. {"st_wood"}
 ti["6"] = (ti[" "]  .. {"it_trigger", "killtrigger", target="killstone"})

Modified: team_levelpacks/team_test_new_api/ralT032_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT032_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT032_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -22,7 +22,7 @@
 
 ti[" "] = {"fl-sahara"}
 
-ti["1"] = {"#ac-blackball"}
+ti["1"] = {"#ac_marble"}
 
 ti["x"] = {"st_oxyd_e"}
 ti["y"] = {"st_oxyd_e", "oo", oxydcolor=OXYD_BOLD}

Modified: team_levelpacks/team_test_new_api/ralT033_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT033_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT033_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -35,7 +35,7 @@
 ti["I"] = {"st_switch", target="iskind"}
 
 
-ti["1"] = ti({"it_magicwand"}) .. {"#ac-blackball"}
+ti["1"] = ti({"it_magicwand"}) .. {"#ac_marble"}
 
 
 w, h = wo(ti, " ", {

Modified: team_levelpacks/team_test_new_api/ralT034_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT034_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT034_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -30,7 +30,7 @@
 ti["s"] = {"st_switch", target="rmfloor"}
 ti["i"] = {"st_switch", target="icefloor"}
 
-ti["1"] = ti["b"] .. {"#ac-blackball"}
+ti["1"] = ti["b"] .. {"#ac_marble"}
 ti["2"] = ti["b"] .. {"#ac-bug", "mybug"}
 
 function myresolver(key, x, y)

Modified: team_levelpacks/team_test_new_api/ralT035_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT035_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT035_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -22,7 +22,7 @@
 ti["~~"] = {"fl_water"}
 ti["##"] = {"st-rock1"}
 ti["++"] = {"st_wood"}
-ti[" 1"] = ti["  "] .. {"#ac-blackball"}
+ti[" 1"] = ti["  "] .. {"#ac_marble"}
 
 -- sample of create world without a given map - just default floors
 w, h = wo(ti, "  ", 20, 13)

Modified: team_levelpacks/team_test_new_api/ralT036_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT036_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT036_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -18,7 +18,7 @@
 wo["ConserveLevel"] = true
 
 ti[" "] = {"fl-sahara"}
-ti["1"] = ti[" "] .. {"#ac-blackball"}
+ti["1"] = ti[" "] .. {"#ac_marble"}
 
 w, h = wo(ti, " ", {
 "  ",

Modified: team_levelpacks/team_test_new_api/ralT037_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT037_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT037_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -37,8 +37,8 @@
 ti[";"] = {"it-spring2"}
 
 
-ti["1"] = {"#ac-blackball", "me"}
-ti["2"] = {"#ac-whiteball"}
+ti["1"] = {"#ac_marble_black", "me"}
+ti["2"] = {"#ac_marble_white"}
 
 w, h = wo(ti, " ", {
 "                    ",

Modified: team_levelpacks/team_test_new_api/ralT038_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT038_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT038_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -46,7 +46,7 @@
 ti["1"] = {"it_coin_s"}
 ti["2"] = {"it_coin_m"}
 ti["4"] = {"it_coin_l"}
-ti["0"] = {"#ac-blackball"}
+ti["0"] = {"#ac_marble"}
 
 w, h = wo(ti, " ", {
 "                    ",

Modified: team_levelpacks/team_test_new_api/ralT039_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT039_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT039_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -24,7 +24,7 @@
 ti["s"] = {"st_swap"}
 ti["W"] = {"st_wood"}
 
-ti["A"] = {"#ac-blackball"}
+ti["A"] = {"#ac_marble"}
 
 ti["k"] = {"st_laserswitch", target="LaserK"}
 ti["L"] = {"st_laser_n", "LaserL"}

Modified: team_levelpacks/team_test_new_api/ralT040_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT040_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT040_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -21,7 +21,7 @@
 
 ti[" "] = {"fl-sahara"}
 
-ti["A"] = {"#ac-blackball"}
+ti["A"] = {"#ac_marble"}
 
 ti["L"] = {"st_laser_n", "Laser", state=ON}
 ti["F"] = {"st_fourswitch", target="Laser", action="orientate"}

Modified: team_levelpacks/team_test_new_api/ralT041_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT041_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT041_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -56,8 +56,8 @@
 
 ti["I"] = {"st_switch", target="switchsensor"}
 
-ti["1"] = ti["y"] .. {"#ac-blackball"} 
-ti["2"] = ti["y"] .. {"#ac-whiteball"}
+ti["1"] = ti["y"] .. {"#ac_marble_black"} 
+ti["2"] = ti["y"] .. {"#ac_marble_white"}
 
 
 w, h = wo(ti, " ", {

Modified: team_levelpacks/team_test_new_api/ralT042_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT042_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT042_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -24,7 +24,7 @@
 ti["c"] = {"it_cross"}
 ti["v"] = {"it_cherry"}
 
-ti["A"] = {"#ac-blackball"}
+ti["A"] = {"#ac_marble"}
 
 ti["l"] = {"st_lightpassenger"}
 ti["L"] = {"st_lightpassenger", friction=1}

Modified: team_levelpacks/team_test_new_api/ralT043_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT043_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT043_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -33,7 +33,7 @@
 ti["v"] = {"it_vortex", destination="@@coin#*"}
 
 
-ti["1"] = ti["f"] .. {"#ac-blackball"} 
+ti["1"] = ti["f"] .. {"#ac_marble"} 
 
 ti["r"] = {"st_brake"}
 

Modified: team_levelpacks/team_test_new_api/ralT044_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT044_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT044_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -24,7 +24,7 @@
 ti["template_A"] = {"st_blocker", "door%%#"}
 ti["template_1"] = {"st_laser_s", "laser%%"}
 
-ti["x"] = ti["f"] .. {"#ac-blackball"} 
+ti["x"] = ti["f"] .. {"#ac_marble"} 
 
 local resolver = res.autotile(ti, {"a", "e", "template_a"}, 
     {"A", "E", "template_A"},  {"1", "5", "template_1"})

Modified: team_levelpacks/team_test_new_api/ralT045_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT045_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT045_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -26,7 +26,7 @@
 ti["template_A"] = {"st_blocker", "door%%#"}
 ti["template_L"] = {"st_laser_s", "laser%%"}
 
-ti["xx"] = ti["ff"] .. {"#ac-blackball"} 
+ti["xx"] = ti["ff"] .. {"#ac_marble"} 
 
 local resolver = res.autotile(ti, {"a1", "a5", "template_a"}, 
 --local resolver = res.autotile(ti, {"a", "template_a"}, 

Modified: team_levelpacks/team_test_new_api/ralT046_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT046_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT046_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -35,7 +35,7 @@
 
 ti["k "] = {"it_key"} .. ti({"st-glass1"})
 
-ti["xx"] = {"#ac-blackball"} 
+ti["xx"] = {"#ac_marble"} 
 
 local resolver = res.composer(ti)
 

Modified: team_levelpacks/team_test_new_api/ralT047_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT047_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT047_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -39,7 +39,7 @@
 ti["# ~"] = {"fl_hay"}
 ti[" 2~"] = {"fl-gray"}
 
-ti["xxx"] = {"#ac-blackball"} 
+ti["xxx"] = {"#ac_marble"} 
 
 local resolver = res.composer(ti)
 

Modified: team_levelpacks/team_test_new_api/ralT049_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT049_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT049_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -45,8 +45,8 @@
 
 ti["b"] = {"it-bag"}
 ti["y"] = {"it-yinyang"}
-ti["1"] = ti["y"] .. {"#ac-blackball"} 
-ti["2"] = ti["y"] .. {"#ac-whiteball"} 
+ti["1"] = ti["y"] .. {"#ac_marble_black"} 
+ti["2"] = ti["y"] .. {"#ac_marble_white"} 
 
 w, h = wo(ti, " ", {
 "!!!             HHHH",

Modified: team_levelpacks/team_test_new_api/ralT050_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT050_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT050_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -30,7 +30,7 @@
 ti["G"] = {"it_glasses"}
 ti["g"] = {"it_glasses", state=SPOT_ACTORIMPULSE}
 
-ti["1"] = {"#ac-blackball"} 
+ti["1"] = {"#ac_marble_black"} 
 
 ti["s"] = {"it_sword"}
 ti["K"] = {"st_knight"}
@@ -48,8 +48,8 @@
 
 ti["w"] = {"it_magicwand"}
 ti["c"] = {"st_chess_black"}
-ti["3"] = {"#ac-blackball", player=DEFAULT, controllers=0}
-ti["4"] = {"#ac-whiteball", player=DEFAULT, controllers=0}
+ti["3"] = {"#ac_marble_black", player=DEFAULT, controllers=0}
+ti["4"] = {"#ac_marble_white", player=DEFAULT, controllers=0}
 
 
 w, h = wo(ti, " ", {

Modified: team_levelpacks/team_test_new_api/ralT051_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT051_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT051_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -45,7 +45,7 @@
 ti["g"] = {"it_trigger", target="mymir", action_1="turn", action_0="turnback"}
 ti["i"] = {"st_stoneimpulse_movable"}
 
-ti["1"] = {"#ac-blackball"} 
+ti["1"] = {"#ac_marble"} 
 
 w, h = wo(ti, " ", {
 "         s         l",

Modified: team_levelpacks/team_test_new_api/ralT052_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT052_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT052_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -58,7 +58,7 @@
 ti["v"] = {"it_vortex_open", "vortex2", destination="vortex1"}
 
 ti["s"] = {"st_switch", target="doit"}
-ti["1"] = {"#ac-blackball"}
+ti["1"] = {"#ac_marble"}
 
 w, h = wo(ti, " ", {
 "##########################################################",

Modified: team_levelpacks/team_test_new_api/ralT053_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT053_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT053_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -38,10 +38,10 @@
 ti["a"] = {"it_wormhole", "wa", range=0.5, scissor=false}
 ti["b"] = {"it_wormhole", "wb", destination="wa", range=0.5,  scissor=false}
 
-ti["1"] = ti["y"] .. {"#ac-blackball", "a1"} 
-ti["2"] = ti["y"] .. {"#ac-whiteball", "a2"} 
+ti["1"] = ti["y"] .. {"#ac_marble_black", "a1"} 
+ti["2"] = ti["y"] .. {"#ac_marble_white", "a2"} 
 ti["3"] = {"#ac-horse", "a3"} 
-ti["*"] = {"#ac-whiteball-small", "s#", controllers=0} 
+ti["*"] = {"#ac_pearl_white", "s#", player=DEFAULT, controllers=0} 
 
 w, h = wo(ti, " ", {
 "*   #  r  r  r  a  *",
@@ -73,8 +73,8 @@
 end
 function shatter(value, sender)
     if not value then
-        sender["anchor1"]:shatter()
-        sender["anchor2"]:shatter()
+--        sender["anchor1"]:shatter()
+--        sender["anchor2"]:shatter()
     end
 end
 

Modified: team_levelpacks/team_test_new_api/ralT054_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT054_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT054_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -46,7 +46,7 @@
 ti["P"] = {"st_polarswitch"}
 
 
-ti["@"] = {"#ac-blackball"} 
+ti["@"] = {"#ac_marble"} 
 
 resolver = res.autotile(ti, {"1","9","template_w"}, {"a","h","template_b"})
 

Modified: team_levelpacks/team_test_new_api/ralT055_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT055_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT055_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -51,7 +51,7 @@
 ti["K"] = {"st_stoneimpulse", "k1"}
 ti["J"] = {"st_switch", target="push"}
 
-ti["1"] = {"#ac-blackball"} 
+ti["1"] = {"#ac_marble"} 
 
 
 w, h = wo(ti, " ", {

Modified: team_levelpacks/team_test_new_api/ralT057_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT057_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT057_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -63,9 +63,9 @@
 ti["H"] = {"it_meditation"}
 
 
-ti["1"] = ti["y"] .. {"#ac-blackball"}
-ti["2"] = ti["y"] .. {"#ac-whiteball"}
-ti["3"] = {"#ac-whiteball-small", controllers=0}
+ti["1"] = ti["y"] .. {"#ac_marble_black"}
+ti["2"] = ti["y"] .. {"#ac_marble_white"}
+ti["3"] = {"#ac_pearl_white", controllers=0}
 
 w, h = wo(ti, " ", {
 "                    ",

Modified: team_levelpacks/team_test_new_api/ralT058_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT058_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT058_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -31,8 +31,8 @@
 
 
 
-ti["@"] = {"#ac-blackball"} 
-ti["2"] = {"#ac-whiteball"} 
+ti["@"] = {"#ac_marble_black"} 
+ti["2"] = {"#ac_marble_white"} 
 ti["3"] = {"#ac-rotor"} 
 ti["4"] = {"#ac-bug"} 
 ti["5"] = {"#ac-horse"} 

Modified: team_levelpacks/team_test_new_api/ralT059_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT059_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT059_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -44,7 +44,7 @@
 ti["j"] = {"st_door_d", target="bb", action="hit", faces="ew"}
 ti["J"] = {"st-blackballs", "bb"}
 
-ti["@"] = {"#ac-blackball"} 
+ti["@"] = {"#ac_marble"} 
 
 
 w, h = wo(ti, " ", {

Modified: team_levelpacks/team_test_new_api/ralT060_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT060_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT060_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -54,8 +54,8 @@
 
 
 
-ti["@"] = {"#ac-blackball"} 
-ti["."] = {"#ac-whiteball", "white"} 
+ti["@"] = {"#ac_marble_black"} 
+ti["."] = {"#ac_marble_black", "white"} 
 
 w, h = wo(ti, " ", {
 "                    ",

Modified: team_levelpacks/team_test_new_api/ralT061_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT061_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT061_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -48,8 +48,8 @@
 ti["E"] = {"st-bombs"}
 ti["|"] = {"it-spring1"}
 
-ti["@"] = {"#ac-blackball"} 
-ti["."] = {"#ac-whiteball", "white"} 
+ti["@"] = {"#ac_marble_black"} 
+ti["."] = {"#ac_marble_white", "white"} 
 
 
 w, h = wo(ti, " ", {

Modified: team_levelpacks/team_test_new_api/ralT062_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT062_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT062_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -35,7 +35,7 @@
 ti["B"] = {"st_boulder_s"}
 ti["w"] = {"it_magicwand"}
 
-ti["@"] = {"#ac-blackball"} .. ti({"it_hammer"}) 
+ti["@"] = {"#ac_marble"} .. ti({"it_hammer"}) 
 
 w, h = wo(ti, " ", {
 "  v  #  V    #  u   ",

Modified: team_levelpacks/team_test_new_api/ralT063_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT063_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT063_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -71,7 +71,7 @@
 ti["x"] = {"st_wood", "wood4"}
 ti["X"] = {"st_wood", "wood5"}
 
-ti["@"] = {"#ac-blackball"}  ..ti({"it_magicwand"})
+ti["@"] = {"#ac_marble"}  ..ti({"it_magicwand"})
 
 w, h = wo(ti, " ", {
 "                                       ",

Modified: team_levelpacks/team_test_new_api/ralT064_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT064_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT064_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -42,8 +42,8 @@
 ti["d"] = {"it-dynamite"}
 ti["B"] = {"st-bombs"}
 
-ti["@"] = {"#ac-blackball"} 
-ti["."] = {"#ac-whiteball", "white"} 
+ti["@"] = {"#ac_marble_black"} 
+ti["."] = {"#ac_marble_white", "white"} 
 
 w, h = wo(ti, " ", {
 "B ddd           1234",

Modified: team_levelpacks/team_test_new_api/ralT065_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT065_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT065_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -38,8 +38,8 @@
 ti["T"] = {"st_switch", target="@vol#*", action="toggle"}
 ti["F"] = {"st_fourswitch", target="@vol#*", action_0="flip", action_2="flip"}
 
-ti["@"] = {"#ac-whiteball-small", player=0} 
-ti["1"] = {"#ac-blackball"} 
+ti["@"] = {"#ac_pearl"} 
+ti["1"] = {"#ac_marble"} 
 
 w, h = wo(ti, " ", {
 "F             T    T",

Modified: team_levelpacks/team_test_new_api/ralT066_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT066_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT066_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -35,7 +35,7 @@
 ti["e"] = {"it-dynamite"}
 ti["E"] = {"it-extinguisher"}
 
-ti["@"] = {"#ac-blackball"} 
+ti["@"] = {"#ac_marble"} 
 
 w, h = wo(ti, " ", {
 "         #          ",

Modified: team_levelpacks/team_test_new_api/ralT067_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT067_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT067_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -37,7 +37,7 @@
 
 
 
-ti["@"] = {"#ac-blackball"} 
+ti["@"] = {"#ac_marble"} 
 
 w, h = wo(ti, " ", {
 "DD S V___U    ~ b  T",

Modified: team_levelpacks/team_test_new_api/ralT068_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT068_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT068_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -43,7 +43,7 @@
 
 ti["b"] = {"st_brake"}
 
-ti["@"] = {"#ac-blackball"} 
+ti["@"] = {"#ac_marble"} 
 
 w, h = wo(ti, " ", {
 "    S    S     S    ",

Modified: team_levelpacks/team_test_new_api/ralT069_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT069_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT069_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -31,7 +31,7 @@
 ti["M"] = {"st_puzzle_blue", algorithm="marked"}
 ti["C"] = {"st_puzzle_blue", algorithm="marked", intensity=10}
 
-ti["@@"] = {"#ac-blackball"}  ..ti({"it_magicwand"})
+ti["@@"] = {"#ac_marble"}  ..ti({"it_magicwand"})
 
 puzz = res.puzzle(ti, "P","H", "S", "M", "C")
 

Modified: team_levelpacks/team_test_new_api/ralT071_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT071_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT071_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -49,7 +49,7 @@
 ti["2"] = {"st_stoneimpulse", "s4"}
 
 
-ti["@"] = {"#ac-blackball"} 
+ti["@"] = {"#ac_marble"} 
 
 w, h = wo(ti, " ", {
 "                    ",

Modified: team_levelpacks/team_test_new_api/ralT072_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT072_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/ralT072_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -40,7 +40,7 @@
 ti["x"] = {"st-grate1"} .. ti["."]
 ti["^"] = {"st_oneway_n"} .. ti["."]
 
-ti["@"] = {"#ac-blackball"} 
+ti["@"] = {"#ac_marble"} 
 
 w, h = wo(ti, " ", {
 " *.............     ",

Modified: team_levelpacks/team_test_new_api/raoulT01_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT01_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/raoulT01_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -19,7 +19,7 @@
 
 ti[" "] = {"fl-sahara"}
 
-ti["0"] = ti[" "] .. {"#ac-blackball"}
+ti["0"] = ti[" "] .. {"#ac_marble"}
 
 ti["5"] = ti[" "] .. {"st_switch", target="stfl1", action="signal"}
 ti["6"] = ti[" "] .. {"st_switch", target="stfl1", action="on"}

Modified: team_levelpacks/team_test_new_api/raoulT02_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT02_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/raoulT02_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -19,7 +19,7 @@
 
 ti[" "] = {"fl-sahara"}
 
-ti["0"] = ti[" "] .. {"#ac-blackball"}
+ti["0"] = ti[" "] .. {"#ac_marble"}
 
 ti["A"] = ti[" "] .. {"st_switch", name="da1", target="la5", action="toggle"}
 ti["B"] = ti[" "] .. {"st_switch", name="da2", target="la6", action="toggle"}

Modified: team_levelpacks/team_test_new_api/raoulT03_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -20,8 +20,8 @@
 ti[" "] = {"fl-sahara"}
 ti["."] = {"fl_space"}
 
-ti["0"] = {"#ac-blackball"}
-ti["'"] = {"#ac-whiteball"}
+ti["0"] = {"#ac_marble_black"}
+ti["'"] = {"#ac_marble_white"}
 
 ti["#"] = {"st-glass"}
 ti["+"] = {"st_window_nesw"}

Modified: team_levelpacks/team_test_new_api/raoulT04_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT04_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/raoulT04_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -19,7 +19,7 @@
 
 ti[" "] = {"fl-sahara"}
 
-ti["0"] = ti[" "] .. {"#ac-blackball"}
+ti["0"] = ti[" "] .. {"#ac_marble"}
 
 ti["A"] = ti[" "] .. {"st_coinslot", name="cs1", target="la1", action="toggle"}
 ti["B"] = ti[" "] .. {"st_coinslot", name="cs2", target="la2", action="signal"}

Modified: team_levelpacks/team_test_new_api/raoulT05_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT05_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/raoulT05_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -48,7 +48,7 @@
 ti["w"] = {"st_wood"}
 ti["v"] = {"st-plain_move"}
 
-ti["A"] = {"#ac-blackball"} .. ti["a"]
+ti["A"] = {"#ac_marble"} .. ti["a"]
 
 w, h = wo(ti, " ", {
 "hggggggwgggggvgggwww",

Modified: team_levelpacks/team_test_new_api/raoulT06_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT06_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/raoulT06_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -42,7 +42,7 @@
 ti["w"] = {"st_wood"}
 ti["v"] = {"st-plain_move"}
 
-ti["A"] = {"#ac-blackball"} .. ti["*"]
+ti["A"] = {"#ac_marble"} .. ti["*"]
 
 w, h = wo(ti, " ", {
 "hggggggggggggggggggf",

Modified: team_levelpacks/team_test_new_api/raoulT07_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT07_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/raoulT07_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -62,7 +62,7 @@
 
 ti["O"] = {"st-blackballs"}
 
-ti["@"] = {"#ac-blackball"}
+ti["@"] = {"#ac_marble"}
 
 w, h = wo(ti, " ", {
 "                   e",

Modified: team_levelpacks/team_test_new_api/raoulT08_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT08_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/raoulT08_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -105,7 +105,7 @@
 ti["LL"] = {"st_laser", orientation="w", state=ON}
 ti["PP"] = {"st_polarswitch", state=OFF}
 
-ti["@ "] = {"#ac-blackball"}  ..ti({"it_magicwand"})
+ti["@ "] = {"#ac_marble"}  ..ti({"it_magicwand"})
 
 w, h = wo(ti, "  ", {
 "                                                                              ",

Modified: team_levelpacks/team_test_new_api/raoulT09_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT09_1.xml	2008-12-21 16:00:40 UTC (rev 1404)
+++ team_levelpacks/team_test_new_api/raoulT09_1.xml	2008-12-21 16:23:29 UTC (rev 1405)
@@ -32,7 +32,7 @@
 ti["R"] = {"st_laser", orientation=WEST, state=ON}
 ti["C"] = {"it_cherry"}
 ti["U"] = {"it_umbrella"}
-ti["@"] = {"#ac-blackball"}
+ti["@"] = {"#ac_marble"}
 
 w, h = wo(ti, " ", {
 "####################",



From ral at mail.berlios.de  Sun Dec 21 22:42:33 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 21 Dec 2008 22:42:33 +0100
Subject: [Enigma-game-svn] r1406 - in trunk: data data/schemas src
	src/actors src/items src/stones
Message-ID: <200812212142.mBLLgXSm020179@sheep.berlios.de>

Author: ral
Date: 2008-12-21 22:42:32 +0100 (Sun, 21 Dec 2008)
New Revision: 1406

Added:
   trunk/src/stones/BoxStone.cc
   trunk/src/stones/BoxStone.hh
Removed:
   trunk/src/stones/FloorBuilder.cc
   trunk/src/stones/FloorBuilder.hh
Modified:
   trunk/data/api1init.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/actors/Balls.hh
   trunk/src/items/SeedItem.cc
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.hh
Log:
Trunk 1.1: new API reengineering
- FloorBuilder rereengineering:
  - renamed to BoxStone - "st_box" with kinds:
    - st_box_wood, st_box_wood_h, st_box_wood_v, st_box_wood_growing
    - st_box_hay
    - st_box_rock
  - attribute flavor as read only


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-12-21 16:23:29 UTC (rev 1405)
+++ trunk/data/api1init.lua	2008-12-21 21:42:32 UTC (rev 1406)
@@ -142,6 +142,12 @@
     st_boulder_e = "st-bolder-e",
     st_boulder_s = "st-bolder-s",
     st_boulder_w = "st-bolder-w",
+    st_box_hay = "st-flhay",
+    st_box_rock = "st-flrock",
+    st_box_wood = "st-wood",
+    st_box_wood_growing = "st-wood-growing",
+    st_box_wood_h = "st-wood1",
+    st_box_wood_v = "st-wood2",
     st_brake = "st-brake",
     st_brick = "st-brick",
     st_brick_w = "st-bigbrick-w",
@@ -180,9 +186,7 @@
     st_fake_oxydc = "st-likeoxydc",
     st_fake_oxydd = "st-likeoxydd",
     st_flash = "st-flash",
-    st_flhay = "st-flhay",
     st_floppy = "st-floppy",
-    st_flrock = "st-flrock",
     st_fourswitch = "st-fourswitch",
     st_knight = "st-knight",
     st_laser_w = "st-laser-w",
@@ -325,11 +329,7 @@
     st_volcano_new = "st-volcano-growing",
     st_volcano_active = "st-volcano_active",
     st_volcano_idle = "st-volcano_inactive",
-    st_window = "st-window",
-    st_wood = "st-wood",
-    st_wood_growing = "st-wood-growing",
-    st_wood_h = "st-wood1",
-    st_wood_v = "st-wood2"
+    st_window = "st-window"
 }
 
 for k,v in pairs(RenamingObjectsNew2Old) do

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-21 16:23:29 UTC (rev 1405)
+++ trunk/data/schemas/objects.xml	2008-12-21 21:42:32 UTC (rev 1406)
@@ -657,6 +657,22 @@
     <object name="st_boulder_n">
       <attr name="orientation" value="3"/>
     </object>
+    <object name="st_box">
+      <attr name="flavor" default="wood" rw="r"/>
+      <msg name="fire"/>
+      <msg name="heat"/>
+      <msg name="fall"/>
+    </object>
+    <object name="st_box_hay" flavor="hay"/>
+    <object name="st_box_rock" flavor="rock"/>
+    <object name="st_box_wood" flavor="wood">
+    </object>
+    <object name="st_box_wood_growing" init="true">
+    </object>
+    <object name="st_box_wood_h" init="true">
+    </object>
+    <object name="st_box_wood_v" init="true">
+    </object>
     <object name="st_brake">
       <msg name="_explosion"/>
     </object>
@@ -811,21 +827,11 @@
       <attr name="hit_distortion_yx"/>
       <attr name="hit_distortion_yy"/>
     </object>
-    <object name="st_flhay">
-      <msg name="fire"/>
-      <msg name="heat"/>
-      <msg name="fall"/>
-    </object>
     <object name="st_floppy">
       <msg name="on"/>
       <msg name="off"/>
       <msg name="signal"/>
     </object>
-    <object name="st_flrock">
-      <msg name="fire"/>
-      <msg name="heat"/>
-      <msg name="fall"/>
-    </object>
     <object name="st_fourswitch" states="4">
       <attr name="counterclock"/>
       <action type="dir" statetype="bool"/>
@@ -1251,16 +1257,5 @@
     <object name="st_window_nesw">
       <attr name="faces" value="nesw"/>
     </object>
-    <object name="st_wood">
-      <msg name="fire"/>
-      <msg name="heat"/>
-      <msg name="fall"/>
-    </object>
-    <object name="st_wood_growing" init="true">
-    </object>
-    <object name="st_wood_h" init="true">
-    </object>
-    <object name="st_wood_v" init="true">
-    </object>
   </zoo>
 </objects>

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-21 16:23:29 UTC (rev 1405)
+++ trunk/src/Makefile.am	2008-12-21 21:42:32 UTC (rev 1406)
@@ -274,8 +274,8 @@
 	stones/Door.hh		\
 	stones/FakeStone.cc	\
 	stones/FakeStone.hh	\
-	stones/FloorBuilder.cc	\
-	stones/FloorBuilder.hh	\
+	stones/BoxStone.cc	\
+	stones/BoxStone.hh	\
 	stones/FloppySwitch.cc	\
 	stones/FloppySwitch.hh	\
 	stones/FourSwitch.cc	\

Modified: trunk/src/actors/Balls.hh
===================================================================
--- trunk/src/actors/Balls.hh	2008-12-21 16:23:29 UTC (rev 1405)
+++ trunk/src/actors/Balls.hh	2008-12-21 21:42:32 UTC (rev 1406)
@@ -25,7 +25,7 @@
 namespace enigma {
 
     /** 
-     * ChargeStone
+     * 
      */
     /*! The base class for all marbles. */
     class BasicBall : public Actor {

Modified: trunk/src/items/SeedItem.cc
===================================================================
--- trunk/src/items/SeedItem.cc	2008-12-21 16:23:29 UTC (rev 1405)
+++ trunk/src/items/SeedItem.cc	2008-12-21 21:42:32 UTC (rev 1406)
@@ -104,7 +104,7 @@
                 return;
            }
        }
-       Stone *st = MakeStone(flavor == 0 ? "st_wood_growing" : (flavor == 1 ? "st-greenbrown-growing" : "st_volcano_growing"));
+       Stone *st = MakeStone(flavor == 0 ? "st_box_wood_growing" : (flavor == 1 ? "st-greenbrown-growing" : "st_volcano_growing"));
        transferIdentity(st);
        if (Value v = getAttr("secure"))
            st->setAttr("secure", v);

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-12-21 16:23:29 UTC (rev 1405)
+++ trunk/src/ox_extra.cc	2008-12-21 21:42:32 UTC (rev 1406)
@@ -155,7 +155,7 @@
     "st-plain_break",    // OxydExtra stone 0x24
     "st-plain_hole",     // OxydExtra stone 0x25
     "st-plain_move",     // OxydExtra stone 0x26
-    "st_wood",           // OxydExtra stone 0x27
+    "st_box_wood",       // OxydExtra stone 0x27
     "st_switch_instant", // OxydExtra stone 0x28
     UNUSED,              // OxydExtra stone 0x29
     UNUSED,              // OxydExtra stone 0x2a

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-12-21 16:23:29 UTC (rev 1405)
+++ trunk/src/ox_magnum.cc	2008-12-21 21:42:32 UTC (rev 1406)
@@ -159,7 +159,7 @@
     "st-plain_break",           // OxydMagnum stone 0x28
     "st-plain_hole",            // OxydMagnum stone 0x29
     "st-plain_move",            // OxydMagnum stone 0x2a
-    "st_wood",                  // OxydMagnum stone 0x2b
+    "st_box_wood",              // OxydMagnum stone 0x2b
     "st_switch_instant",        // OxydMagnum stone 0x2c
     "st_floppy",                // OxydMagnum stone 0x2d (in normal Oxyd Magnum Levels unused!)
     UNUSED,                     // OxydMagnum stone 0x2e

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-12-21 16:23:29 UTC (rev 1405)
+++ trunk/src/ox_oxyd1.cc	2008-12-21 21:42:32 UTC (rev 1406)
@@ -191,7 +191,7 @@
     "st-plain_break",           // Oxyd1 stone 0x28 [see Level#12]
     "st-plain_hole",            // Oxyd1 stone 0x29
     "st-plain_move",            // Oxyd1 stone 0x2a
-    "st_wood",                  // Oxyd1 stone 0x2b
+    "st_box_wood",              // Oxyd1 stone 0x2b
     "st_switch_instant",        // Oxyd1 stone 0x2c
     "st_switch_black_instant",  // Oxyd1 stone 0x2d
     "st_switch_white_instant",  // Oxyd1 stone 0x2e

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-12-21 16:23:29 UTC (rev 1405)
+++ trunk/src/ox_peroxyd.cc	2008-12-21 21:42:32 UTC (rev 1406)
@@ -227,7 +227,7 @@
     "st-plain_break",           // PerOxyd stone 0x24
     "st-bluegray_hole",         // PerOxyd stone 0x25
     "st-plain_move",            // PerOxyd stone 0x26
-    "st_wood",                  // PerOxyd stone 0x27
+    "st_box_wood",              // PerOxyd stone 0x27
     "st_switch_instant",        // PerOxyd stone 0x28
     "st_switch_black_instant",  // PerOxyd stone 0x29
     "st_switch_white_instant",  // PerOxyd stone 0x2a

Copied: trunk/src/stones/BoxStone.cc (from rev 1400, trunk/src/stones/FloorBuilder.cc)
===================================================================
--- trunk/src/stones/FloorBuilder.cc	2008-12-19 21:20:14 UTC (rev 1400)
+++ trunk/src/stones/BoxStone.cc	2008-12-21 21:42:32 UTC (rev 1406)
@@ -0,0 +1,213 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/BoxStone.hh"
+#include "errors.hh"
+//#include "main.hh"
+
+namespace enigma {
+    BoxStone::BoxStone(int subtyp, int initState) : Stone() {
+        objFlags |= (subtyp << 25);
+        if (subtyp == ROCK)
+            objFlags |= OBJBIT_BLOCKFIRE;
+        state = initState;
+    }
+    
+    BoxStone* BoxStone::clone() {
+        if ((BoxStoneTyp)((objFlags & OBJBIT_SUBTYP) >> 25) == WOOD) { 
+             // When st_wood is created it randomly becomes st_wood1 or st_wood2.
+             if (IntegerRand(0, 1) == 0)
+                return new BoxStone(WOOD1, state);
+            else
+                return new BoxStone(WOOD2, state);
+        } else {
+            return new BoxStone(*this);
+        }
+    }
+    
+    void BoxStone::dispose() {
+        delete this;
+    }
+    
+    std::string BoxStone::getClass() const {
+        return "st_box";
+    }
+    
+    const char *BoxStone::get_kind() const {
+        BoxStoneTyp typ = (BoxStoneTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
+        switch (typ) {
+            case WOOD:
+                return "st_box_wood";
+            case WOOD1:
+                return "st_box_wood_h";
+            case WOOD2:
+                return "st_box_wood_v";
+            case HAY:
+                return "st_box_hay";
+            case ROCK:
+                return "st_box_rock";
+        }
+    }
+
+    Value BoxStone::getAttr(const std::string &key) const {
+        if (key == "flavor") {
+            BoxStoneTyp typ = (BoxStoneTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
+            switch (typ) {
+                case WOOD:
+                case WOOD1:
+                case WOOD2:
+                    return "wood";
+                case HAY:
+                    return "hay";
+                case ROCK:
+                    return "rock";
+            }
+        }
+        return Stone::getAttr(key);
+    }
+    
+
+    Value BoxStone::message(const Message &m) {
+        if (m.message == "fire" && !(objFlags & OBJBIT_BLOCKFIRE)) {
+            KillStone(get_pos());
+            return true;  // allow fire to spread
+        } else if (m.message == "heat") {
+            return (objFlags & OBJBIT_BLOCKFIRE) != 0;  // block fire
+        } else if (m.message == "fall") {
+            maybe_fall_or_stopfire();
+            return Value();
+        }
+        return Stone::message(m);
+    }
+
+    void BoxStone::setState(int extState) {
+        // no external states
+    }
+    
+    void BoxStone::init_model() {
+        BoxStoneTyp typ = (BoxStoneTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
+        switch (typ) {
+            case WOOD:
+                ASSERT(false, XLevelRuntime, "Wood stone init model state error");
+            case WOOD1:
+                if (state == GROWING)
+                    set_anim("st-wood-growing");
+                else
+                    set_model("st-wood1");
+                break;
+            case WOOD2:
+                if (state == GROWING)
+                    set_anim("st-wood-growing");
+                else
+                    set_model("st-wood2");
+                break;
+            case HAY:
+                set_model("st-flhay"); break;
+                break;
+            case ROCK:
+                set_model("st-flrock"); break;
+        }
+    }
+    
+    void BoxStone::animcb() {
+        state = IDLE;
+        init_model();
+        maybe_fall_or_stopfire(); // instantly builds a bridge on fl_swamp etc
+    }
+
+    bool BoxStone::allowsSpreading(Direction dir, bool isFlood) const {
+        return isFlood;
+    }
+    
+    void BoxStone::actor_hit(const StoneContact &sc) {
+        if (state == GROWING)
+            SendMessage(sc.actor, "shatter");
+        else
+            Stone::actor_hit(sc);
+    }
+    
+    void BoxStone::actor_inside(Actor *a) {
+        if (state == GROWING)
+            SendMessage(a, "shatter");
+    }
+    
+    void BoxStone::actor_contact(Actor *a) {
+        if (state == GROWING)
+            SendMessage(a, "shatter");
+    }
+    
+    void BoxStone::on_move() {
+        // in oxyd1 only fall when moving
+        Stone::on_move();
+        maybe_fall_or_stopfire(true);
+    }
+    
+    void BoxStone::on_floor_change() {
+        // other oxyds versions: fall everytime the floor changes
+        maybe_fall_or_stopfire(false, true);
+    }
+    
+    void BoxStone::maybe_fall_or_stopfire(bool onMove, bool onFloorChange) {
+        BoxStoneTyp typ = (BoxStoneTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
+        GridPos p = get_pos();
+        if (server::GameCompatibility != GAMET_ENIGMA && IsLevelBorder(p))
+            return;
+        if (Floor *oldfl = GetFloor(p)) {
+            const std::string &k = oldfl->get_kind();
+            if (objFlags & OBJBIT_BLOCKFIRE)
+                SendMessage(oldfl, "stopfire");
+            if (k == "fl_abyss" || k == "fl_water" || k == "fl_swamp") {
+                if (onMove)
+                    // just mark - can not kill stone yet - this will be done on floor change event
+                    state = FALLING;  // keep the stone from moving any longer
+                else if ((server::GameCompatibility != GAMET_OXYD1) || state == FALLING || !onFloorChange) {
+                    state = FALLEN;
+                    Floor *newfl = MakeFloor((typ == HAY) ? "fl_hay_framed" : ((typ == ROCK) ? "fl_rock_framed" : ((typ == WOOD1) ? "fl_wood_framed_h" : "fl_wood_framed_v")));
+                    transferIdentity(newfl);
+                    if (k == "fl_water") {
+                        newfl->setAttr("interval", oldfl->getAttr("interval"));
+                        newfl->setAttr("state", oldfl->getAttr("state"));
+                    }
+                    SetFloor(p, newfl); 
+                    KillStone(p);
+                }
+            }
+        }
+    }
+    
+    int BoxStone::traitsIdx() const {
+        return (state == IDLE) ? 0 : 1;
+    }
+
+    StoneTraits BoxStone::traits[2] = {
+        {"st_box", st_box, stf_none, material_stone, 1.0, MOVABLE_STANDARD},
+        {"st_box_wood_growing", st_box_wood_growing, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+    };
+
+    BOOT_REGISTER_START
+        BootRegister(new BoxStone(0), "st_box");
+        BootRegister(new BoxStone(0), "st_box_wood");
+        BootRegister(new BoxStone(0, 1), "st_box_wood_growing");
+        BootRegister(new BoxStone(1), "st_box_wood_h");
+        BootRegister(new BoxStone(2), "st_box_wood_v");
+        BootRegister(new BoxStone(3), "st_box_hay");
+        BootRegister(new BoxStone(4), "st_box_rock");
+    BOOT_REGISTER_END
+
+} // namespace enigma

Copied: trunk/src/stones/BoxStone.hh (from rev 1400, trunk/src/stones/FloorBuilder.hh)
===================================================================
--- trunk/src/stones/FloorBuilder.hh	2008-12-19 21:20:14 UTC (rev 1400)
+++ trunk/src/stones/BoxStone.hh	2008-12-21 21:42:32 UTC (rev 1406)
@@ -0,0 +1,90 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef BOXSTONE_HH
+#define BOXSTONE_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class BoxStone : public Stone {
+         DECL_TRAITS_ARRAY(2, traitsIdx());
+
+    private:
+        enum iState {
+            IDLE,       ///< standard movable stone
+            GROWING,    ///< a stone growing from a seed
+            FALLING,    ///< a stone moved into water or abyss and marked to fall on floor change notification
+            FALLEN      ///< a stone that is fallen on floor change notification and is vanishing
+        };
+        
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_BLOCKFIRE =   1<<24,   ///< stone blocks fire on moves and floor changes beneath
+            OBJBIT_SUBTYP    =   7<<25,   ///< the BoxStoneTyp
+        };
+        
+        enum BoxStoneTyp {
+            WOOD = 0,
+            WOOD1,
+            WOOD2,
+            HAY,
+            ROCK
+        };
+    public:
+        BoxStone(int subtyp, int initState = IDLE);
+        
+        // Object interface
+        virtual BoxStone* clone();
+        virtual void dispose();
+        virtual std::string getClass() const;
+        virtual const char *get_kind() const;  // for backward compatibility
+        virtual Value getAttr(const std::string &key) const;
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual void setState(int extState);
+        
+        // GridObject interface
+        virtual void init_model();
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual bool allowsSpreading(Direction dir, bool isFlood = false) const;
+        virtual void actor_hit(const StoneContact &sc);
+        virtual void actor_inside(Actor *a);
+        virtual void actor_contact(Actor *a);
+        virtual void on_move();
+        virtual void on_floor_change();
+    
+    private:
+        // Private methods.
+        void maybe_fall_or_stopfire(bool onMove = false, bool onFloorChange = false);
+        int traitsIdx() const;
+    };
+
+} // namespace enigma
+
+#endif /*BOXSTONE_HH*/

Deleted: trunk/src/stones/FloorBuilder.cc
===================================================================
--- trunk/src/stones/FloorBuilder.cc	2008-12-21 16:23:29 UTC (rev 1405)
+++ trunk/src/stones/FloorBuilder.cc	2008-12-21 21:42:32 UTC (rev 1406)
@@ -1,204 +0,0 @@
-/*
- * Copyright (C) 2008 Ronald Lamprecht
- *
- * This program is free software; you can redistribute it and/or
- * modify it under the terms of the GNU General Public License
- * as published by the Free Software Foundation; either version 2
- * of the License, or (at your option) any later version.
- *  
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along
- * with this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
- *
- */
-
-#include "stones/FloorBuilder.hh"
-#include "errors.hh"
-//#include "main.hh"
-
-namespace enigma {
-    FloorBuilder::FloorBuilder(int subtyp, int initState) : Stone() {
-        objFlags |= (subtyp << 25);
-        if (subtyp == ROCK)
-            objFlags |= OBJBIT_BLOCKFIRE;
-        state = initState;
-    }
-    
-    FloorBuilder* FloorBuilder::clone() {
-        if ((FloorBuilderTyp)((objFlags & OBJBIT_SUBTYP) >> 25) == WOOD) { 
-             // When st_wood is created it randomly becomes st_wood1 or st_wood2.
-             if (IntegerRand(0, 1) == 0)
-                return new FloorBuilder(WOOD1, state);
-            else
-                return new FloorBuilder(WOOD2, state);
-        } else {
-            return new FloorBuilder(*this);
-        }
-    }
-    
-    void FloorBuilder::dispose() {
-        delete this;
-    }
-    
-    std::string FloorBuilder::getClass() const {
-        FloorBuilderTyp typ = (FloorBuilderTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
-        switch (typ) {
-            case WOOD:
-            case WOOD1:
-            case WOOD2:
-                return "st_wood";
-            case HAY:
-                return "st_flhay";
-            case ROCK:
-                return "st_flrock";
-        }
-    }
-    
-    const char *FloorBuilder::get_kind() const {
-        FloorBuilderTyp typ = (FloorBuilderTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
-        switch (typ) {
-            case WOOD:
-                return "st_wood";
-            case WOOD1:
-                return "st_wood_h";
-            case WOOD2:
-                return "st_wood_v";
-            case HAY:
-                return "st_flhay";
-            case ROCK:
-                return "st_flrock";
-        }
-    }
-
-    Value FloorBuilder::message(const Message &m) {
-        if (m.message == "fire" && !(objFlags & OBJBIT_BLOCKFIRE)) {
-            KillStone(get_pos());
-            return true;  // allow fire to spread
-        } else if (m.message == "heat") {
-            return (objFlags & OBJBIT_BLOCKFIRE) != 0;  // block fire
-        } else if (m.message == "fall") {
-            maybe_fall_or_stopfire();
-            return Value();
-        }
-        return Stone::message(m);
-    }
-
-    void FloorBuilder::setState(int extState) {
-        // no external states
-    }
-    
-    void FloorBuilder::init_model() {
-        FloorBuilderTyp typ = (FloorBuilderTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
-        switch (typ) {
-            case WOOD:
-                ASSERT(false, XLevelRuntime, "Wood stone init model state error");
-            case WOOD1:
-                if (state == GROWING)
-                    set_anim("st-wood-growing");
-                else
-                    set_model("st-wood1");
-                break;
-            case WOOD2:
-                if (state == GROWING)
-                    set_anim("st-wood-growing");
-                else
-                    set_model("st-wood2");
-                break;
-            case HAY:
-                set_model("st-flhay"); break;
-                break;
-            case ROCK:
-                set_model("st-flrock"); break;
-        }
-    }
-    
-    void FloorBuilder::animcb() {
-        state = IDLE;
-        init_model();
-        maybe_fall_or_stopfire(); // instantly builds a bridge on fl_swamp etc
-    }
-
-    bool FloorBuilder::allowsSpreading(Direction dir, bool isFlood) const {
-        return isFlood;
-    }
-    
-    void FloorBuilder::actor_hit(const StoneContact &sc) {
-        if (state == GROWING)
-            SendMessage(sc.actor, "shatter");
-        else
-            Stone::actor_hit(sc);
-    }
-    
-    void FloorBuilder::actor_inside(Actor *a) {
-        if (state == GROWING)
-            SendMessage(a, "shatter");
-    }
-    
-    void FloorBuilder::actor_contact(Actor *a) {
-        if (state == GROWING)
-            SendMessage(a, "shatter");
-    }
-    
-    void FloorBuilder::on_move() {
-        // in oxyd1 only fall when moving
-        Stone::on_move();
-        maybe_fall_or_stopfire(true);
-    }
-    
-    void FloorBuilder::on_floor_change() {
-        // other oxyds versions: fall everytime the floor changes
-        maybe_fall_or_stopfire(false, true);
-    }
-    
-    void FloorBuilder::maybe_fall_or_stopfire(bool onMove, bool onFloorChange) {
-        FloorBuilderTyp typ = (FloorBuilderTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
-        GridPos p = get_pos();
-        if (server::GameCompatibility != GAMET_ENIGMA && IsLevelBorder(p))
-            return;
-        if (Floor *oldfl = GetFloor(p)) {
-            const std::string &k = oldfl->get_kind();
-            if (objFlags & OBJBIT_BLOCKFIRE)
-                SendMessage(oldfl, "stopfire");
-            if (k == "fl_abyss" || k == "fl_water" || k == "fl_swamp") {
-                if (onMove)
-                    // just mark - can not kill stone yet - this will be done on floor change event
-                    state = FALLING;  // keep the stone from moving any longer
-                else if ((server::GameCompatibility != GAMET_OXYD1) || state == FALLING || !onFloorChange) {
-                    state = FALLEN;
-                    Floor *newfl = MakeFloor((typ == HAY) ? "fl_hay_framed" : ((typ == ROCK) ? "fl_rock_framed" : ((typ == WOOD1) ? "fl_wood_framed_h" : "fl_wood_framed_v")));
-                    transferIdentity(newfl);
-                    if (k == "fl_water") {
-                        newfl->setAttr("interval", oldfl->getAttr("interval"));
-                        newfl->setAttr("state", oldfl->getAttr("state"));
-                    }
-                    SetFloor(p, newfl); 
-                    KillStone(p);
-                }
-            }
-        }
-    }
-    
-    int FloorBuilder::traitsIdx() const {
-        return (state == IDLE) ? 1 : 0;
-    }
-
-    StoneTraits FloorBuilder::traits[2] = {
-        {"st_floorbuilder", st_floorbuilder, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
-        {"st_floorbuilder", st_floorbuilder, stf_none, material_stone, 1.0, MOVABLE_STANDARD},
-    };
-
-    BOOT_REGISTER_START
-        BootRegister(new FloorBuilder(0), "st_wood");
-        BootRegister(new FloorBuilder(0, 1), "st_wood_growing");
-        BootRegister(new FloorBuilder(1), "st_wood_h");
-        BootRegister(new FloorBuilder(2), "st_wood_v");
-        BootRegister(new FloorBuilder(3), "st_flhay");
-        BootRegister(new FloorBuilder(4), "st_flrock");
-    BOOT_REGISTER_END
-
-} // namespace enigma

Deleted: trunk/src/stones/FloorBuilder.hh
===================================================================
--- trunk/src/stones/FloorBuilder.hh	2008-12-21 16:23:29 UTC (rev 1405)
+++ trunk/src/stones/FloorBuilder.hh	2008-12-21 21:42:32 UTC (rev 1406)
@@ -1,89 +0,0 @@
-/*
- * Copyright (C) 2008 Ronald Lamprecht
- *
- * This program is free software; you can redistribute it and/or
- * modify it under the terms of the GNU General Public License
- * as published by the Free Software Foundation; either version 2
- * of the License, or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along
- * with this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
- *
- */
-#ifndef FLOORBUILDERSTONE_HH
-#define FLOORBUILDERSTONE_HH
-
-#include "stones.hh"
-
-#include "stones_internal.hh"
-
-namespace enigma {
-
-    /** 
-     * 
-     */
-    class FloorBuilder : public Stone {
-         DECL_TRAITS_ARRAY(2, traitsIdx());
-
-    private:
-        enum iState {
-            IDLE,       ///< standard movable stone
-            GROWING,    ///< a stone growing from a seed
-            FALLING,    ///< a stone moved into water or abyss and marked to fall on floor change notification
-            FALLEN      ///< a stone that is fallen on floor change notification and is vanishing
-        };
-        
-        enum ObjectPrivatFlagsBits {
-            OBJBIT_BLOCKFIRE =   1<<24,   ///< stone blocks fire on moves and floor changes beneath
-            OBJBIT_SUBTYP    =   7<<25,   ///< the FloorBuilderTyp
-        };
-        
-        enum FloorBuilderTyp {
-            WOOD = 0,
-            WOOD1,
-            WOOD2,
-            HAY,
-            ROCK
-        };
-    public:
-        FloorBuilder(int subtyp, int initState = IDLE);
-        
-        // Object interface
-        virtual FloorBuilder* clone();
-        virtual void dispose();
-        virtual std::string getClass() const;
-        virtual const char *get_kind() const;  // for backward compatibility
-        virtual Value message(const Message &m);
-        
-        // StateObject interface
-        virtual void setState(int extState);
-        
-        // GridObject interface
-        virtual void init_model();
-        
-        // ModelCallback interface
-        virtual void animcb();
-        
-        // Stone interface
-        virtual bool allowsSpreading(Direction dir, bool isFlood = false) const;
-        virtual void actor_hit(const StoneContact &sc);
-        virtual void actor_inside(Actor *a);
-        virtual void actor_contact(Actor *a);
-        virtual void on_move();
-        virtual void on_floor_change();
-    
-    private:
-        // Private methods.
-        void maybe_fall_or_stopfire(bool onMove = false, bool onFloorChange = false);
-        int traitsIdx() const;
-    };
-
-} // namespace enigma
-
-#endif /*FLOORBUILDERSTONE_HH*/

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-12-21 16:23:29 UTC (rev 1405)
+++ trunk/src/stones.hh	2008-12-21 21:42:32 UTC (rev 1406)
@@ -34,6 +34,8 @@
         st_actorimpulse,
         st_actorimpulse_invisible,
         st_borderstone,
+        st_box,
+        st_box_wood_growing,
         st_passage_black_square,
         st_passage_black_slash,
         st_passage_black_cross,
@@ -61,7 +63,6 @@
         st_quake,
         st_firebreak,
         st_firebreak_move,
-        st_floorbuilder,
         st_floppy,
         st_fourswitch,
         st_greenbrown_growing,
@@ -108,7 +109,6 @@
         st_passage_white_cross,
         st_passage_white_frame,
         st_window,
-        st_wood_growing,
         st_lightpassenger,
         st_camouflage,
         st_polarswitch,



From ral at mail.berlios.de  Mon Dec 22 01:20:56 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Mon, 22 Dec 2008 01:20:56 +0100
Subject: [Enigma-game-svn] r1407 - team_levelpacks/team_test_new_api
Message-ID: <200812220020.mBM0KuWR025727@sheep.berlios.de>

Author: ral
Date: 2008-12-22 01:20:36 +0100 (Mon, 22 Dec 2008)
New Revision: 1407

Modified:
   team_levelpacks/team_test_new_api/ralT016_1.xml
   team_levelpacks/team_test_new_api/ralT021_1.xml
   team_levelpacks/team_test_new_api/ralT025_1.xml
   team_levelpacks/team_test_new_api/ralT027_1.xml
   team_levelpacks/team_test_new_api/ralT031_1.xml
   team_levelpacks/team_test_new_api/ralT034_1.xml
   team_levelpacks/team_test_new_api/ralT035_1.xml
   team_levelpacks/team_test_new_api/ralT037_1.xml
   team_levelpacks/team_test_new_api/ralT039_1.xml
   team_levelpacks/team_test_new_api/ralT041_1.xml
   team_levelpacks/team_test_new_api/ralT042_1.xml
   team_levelpacks/team_test_new_api/ralT046_1.xml
   team_levelpacks/team_test_new_api/ralT047_1.xml
   team_levelpacks/team_test_new_api/ralT049_1.xml
   team_levelpacks/team_test_new_api/ralT053_1.xml
   team_levelpacks/team_test_new_api/ralT054_1.xml
   team_levelpacks/team_test_new_api/ralT055_1.xml
   team_levelpacks/team_test_new_api/ralT060_1.xml
   team_levelpacks/team_test_new_api/ralT061_1.xml
   team_levelpacks/team_test_new_api/ralT063_1.xml
   team_levelpacks/team_test_new_api/ralT065_1.xml
   team_levelpacks/team_test_new_api/ralT067_1.xml
   team_levelpacks/team_test_new_api/ralT068_1.xml
   team_levelpacks/team_test_new_api/ralT071_1.xml
   team_levelpacks/team_test_new_api/ralT072_1.xml
   team_levelpacks/team_test_new_api/raoulT03_1.xml
   team_levelpacks/team_test_new_api/raoulT04_1.xml
   team_levelpacks/team_test_new_api/raoulT05_1.xml
Log:
Test Level new API:
- updates for box stones


Modified: team_levelpacks/team_test_new_api/ralT016_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT016_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT016_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -39,7 +39,7 @@
 ti["L"] = {"st_rotator_ccw"}
 ti["R"] = {"st_rotator_cw"}
 ti["b"] = {"st_blocker"}
-ti["H"] = {"st_wood"}
+ti["H"] = {"st_box"}
 ti["A"] = {"st_blocker"}
 ti["a"] = {"it_blocker"}
 ti["c"] = {"it_blocker_new"}

Modified: team_levelpacks/team_test_new_api/ralT021_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT021_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT021_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -27,7 +27,7 @@
 ti["C"] = {"it_vortex", name="v3", destination={"v1","v2","v4"}}
 ti["D"] = {"it_vortex", name="v4", destination=po(3.1,7.7)}
 ti["R"] = {"st_rubberband"}
-ti["W"] = {"st_wood"}
+ti["W"] = {"st_box"}
 ti["S"] = {"st_switch", target="autoclose"}
 
 ti["1"] = {"#ac_marble"}

Modified: team_levelpacks/team_test_new_api/ralT025_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT025_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT025_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -41,7 +41,7 @@
 
 -- the bolder on fourswitch trigger will work after the reengineering of boulder
 ti["B"] = {"st_boulder_w"}
-ti["W"] = {"st_wood"}
+ti["W"] = {"st_box"}
 
 
 -- 4 switches to set state of fourswitch that switches 4 others

Modified: team_levelpacks/team_test_new_api/ralT027_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT027_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT027_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -36,8 +36,8 @@
 
 ti["S"] = {"st_switch", target="blocker"}
 ti["s"] = {"it_blocker", "blocker"}
-ti["H"] = {"st_wood", "wood1"}
-ti["t"] = {"it_trigger", target="blocker"} .. ti({"st_wood", "wood2"})
+ti["H"] = {"st_box", "wood1"}
+ti["t"] = {"it_trigger", target="blocker"} .. ti({"st_box", "wood2"})
 
 
 

Modified: team_levelpacks/team_test_new_api/ralT031_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT031_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT031_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -47,7 +47,7 @@
 ti["p"] = ti[" "] .. {"st_laser_n", "laseroon"}
 
 
-ti["W"] = ti[" "] .. {"st_wood"}
+ti["W"] = ti[" "] .. {"st_box"}
 ti["U"] = ti[" "] .. {"st-block"}
 ti["V"] = ti[" "] .. {"st-brownie"}
 ti["u"] = ti[" "] .. {"it-spring1"}
@@ -67,7 +67,7 @@
 ti["4"] = (ti[" "]  .. {"it_trigger", target={"laserj","laserjon"}, action={"toggle", "on"}})
                 .. {"#ac_pearl", controllers=0}
 ti["5"] = (ti[" "]  .. {"it_trigger", target={"laserl","laserlon"}, action={"toggle", "on"}})
-                .. {"st_wood"}
+                .. {"st_box"}
 ti["6"] = (ti[" "]  .. {"it_trigger", "killtrigger", target="killstone"})
 
 

Modified: team_levelpacks/team_test_new_api/ralT034_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT034_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT034_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -26,7 +26,7 @@
 
 ti[" "] = ti["."] .. {"it_blocker"}
 ti["n"] = {}       -- just nothing
-ti["w"] = {"st_wood"}
+ti["w"] = {"st_box"}
 ti["s"] = {"st_switch", target="rmfloor"}
 ti["i"] = {"st_switch", target="icefloor"}
 

Modified: team_levelpacks/team_test_new_api/ralT035_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT035_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT035_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -21,7 +21,7 @@
 ti["  "] = {"fl-sahara"}
 ti["~~"] = {"fl_water"}
 ti["##"] = {"st-rock1"}
-ti["++"] = {"st_wood"}
+ti["++"] = {"st_box"}
 ti[" 1"] = ti["  "] .. {"#ac_marble"}
 
 -- sample of create world without a given map - just default floors

Modified: team_levelpacks/team_test_new_api/ralT037_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT037_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT037_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -21,7 +21,7 @@
 ti[" "] = {"fl-sahara"}
 ti["~"] = {"fl_water"}
 ti["s"] = {"st_shogun", "him"}
-ti["w"] = {"st_wood", "you"}
+ti["w"] = {"st_box", "you"}
 ti["r"] = {"it_rubberband", anchor2="you", length=4}
 ti["S"] = {"st_switch", target="privat.callbacks.killwood"}
 ti["X"] = {"st_scissors"}

Modified: team_levelpacks/team_test_new_api/ralT039_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT039_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT039_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -22,7 +22,7 @@
 ti[" "] = {"fl-sahara"}
 
 ti["s"] = {"st_swap"}
-ti["W"] = {"st_wood"}
+ti["W"] = {"st_box"}
 
 ti["A"] = {"#ac_marble"}
 

Modified: team_levelpacks/team_test_new_api/ralT041_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT041_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT041_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -41,7 +41,7 @@
 
 ti["r"] = {"st_rotator_cw", movable=true}
 ti["R"] = {"st_rotator_ccw", movable=false}
-ti["W"] = {"st_wood"}
+ti["W"] = {"st_box"}
 ti["s"] = {"st_swap"}
 ti["g"] = {"st-glass1"}
 ti["S"] = {"st_switch", target="addrot"}

Modified: team_levelpacks/team_test_new_api/ralT042_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT042_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT042_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -42,7 +42,7 @@
 
 ti["s"] = {"st_swap"}
 ti["i"] = {"st_stoneimpulse_movable"}
-ti["w"] = {"st_wood"}
+ti["w"] = {"st_box"}
 ti["h"] = {"it_hammer"}
 ti["m"] = {"it_magicwand"}
 ti["b"] = {"it_brush"}

Modified: team_levelpacks/team_test_new_api/ralT046_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT046_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT046_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -24,7 +24,7 @@
 ti[" ;"] = {"fl-leaves"}
 
 ti["# "] = {"st-rock1"}
-ti["W "] = {"st_wood"}
+ti["W "] = {"st_box"}
 ti["X "] = {"st_oxyd"}
 ti["G "] = {"st-grate1"}
 

Modified: team_levelpacks/team_test_new_api/ralT047_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT047_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT047_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -24,7 +24,7 @@
 ti["  ;"] = {"fl-leaves"}
 
 ti["#  "] = {"st-rock1"}
-ti["W  "] = {"st_wood"}
+ti["W  "] = {"st_box"}
 ti["X  "] = {"st_oxyd"}
 ti["G  "] = {"st-grate1"}
 

Modified: team_levelpacks/team_test_new_api/ralT049_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT049_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT049_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -27,7 +27,7 @@
 ti["l"] = {"st_switch", target="newlp"}
 ti["A"] = {"st_actorimpulse_invisible"}
 ti["S"] = {"it_sensor", invisible=true}
-ti["#"] = {"st_wood"}
+ti["#"] = {"st_box"}
 ti["N"] = {"st_laser_n", "laser", state=OFF}
 ti["n"] = {"st_switch", target="laser"}
 

Modified: team_levelpacks/team_test_new_api/ralT053_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT053_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT053_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -22,8 +22,8 @@
 ti["~"] = {"fl_water"}
 ti["#"] = {"st-rock1"}
 ti["y"] = {"it-yinyang"}
-ti["."] = {"st_wood"}
-ti["w"] = {"st_wood", "w"}
+ti["."] = {"st_box"}
+ti["w"] = {"st_box", "w"}
 ti["s"] = {"st_scissors"}
 ti["S"] = {"st_swap"}
 ti["r"] = {"st_rubberband"}

Modified: team_levelpacks/team_test_new_api/ralT054_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT054_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT054_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -26,8 +26,8 @@
 ti["m"] = {"it_magicwand"}
 ti["t"] = {"it_wrench"}
 
-ti["w"] = {"st_wood"}
-ti["template_w"] = {"st_wood", "w%%"}
+ti["w"] = {"st_box"}
+ti["template_w"] = {"st_box", "w%%"}
 ti["template_b"] = {"st-brownie", "b%%"}
 ti["s"] = {"st_scissors"}
 ti["S"] = {"st_swap"}

Modified: team_levelpacks/team_test_new_api/ralT055_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT055_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT055_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -24,25 +24,25 @@
 ti[","] = {"it_seed"}
 
 
-ti["w"] = {"st_wood"}
-ti["h"] = {"st_flhay"}
-ti["r"] = {"st_flrock"}
+ti["w"] = {"st_box_wood"}
+ti["h"] = {"st_box_hay"}
+ti["r"] = {"st_box_rock"}
 ti["b"] = {"st-block"}
 ti["f"] = {"st-firebreak_move"}
 ti["p"] = {"st-plain_move"}
 
 ti["s"] = {"st_switch", target="flood"}
 
-ti["W"] = ti["~"] .. {"st_wood"}
-ti["H"] = ti["~"] .. {"st_flhay"}
-ti["R"] = ti["~"] .. {"st_flrock"}
+ti["W"] = ti["~"] .. {"st_box_wood"}
+ti["H"] = ti["~"] .. {"st_box_hay"}
+ti["R"] = ti["~"] .. {"st_box_rock"}
 ti["B"] = ti["~"] .. {"st-block"}
 ti["F"] = ti["~"] .. {"st-firebreak_move"}
 ti["P"] = ti["~"] .. {"st-plain_move"}
 
 ti["S"] = ti["~"] .. {"st_swap"}
 
-ti["v"] = {"st_wood", "woody"}
+ti["v"] = {"st_box", "woody"}
 ti["V"] = {"st_swap", "buddy"}
 
 ti["i"] = {"st_stoneimpulse", "i2"}

Modified: team_levelpacks/team_test_new_api/ralT060_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT060_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT060_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -41,9 +41,9 @@
 ti["X"] = {"st_door_a", "door_mx", state=OPEN}
 ti["Y"] = {"st_door_a", "door_ly"}
 
-ti["w"] = {"st_wood", "wood"}
-ti["v"] = {"st_wood", "wood2"}
-ti["u"] = {"st_wood", "wood3"}
+ti["w"] = {"st_box", "wood"}
+ti["v"] = {"st_box", "wood2"}
+ti["u"] = {"st_box", "wood3"}
 ti["r"] = {"st-rock1"}
 ti["s"] = {"st_swap"}
 ti["c"] = {"it_cherry"}

Modified: team_levelpacks/team_test_new_api/ralT061_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT061_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT061_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -29,8 +29,8 @@
 
 ti["B"] = {"st_brake"}
 ti["R"] = {"st_rotator", movable=true}
-ti["w"] = {"st_wood", "wood1"}
-ti["W"] = {"st_wood", "wood2"}
+ti["w"] = {"st_box", "wood1"}
+ti["W"] = {"st_box", "wood2"}
 ti["c"] = {"it_coin_s"}
 
 ti["g"] = {"st-grate1"}

Modified: team_levelpacks/team_test_new_api/ralT063_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT063_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT063_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -20,7 +20,7 @@
 ti[" "] = {"fl-sahara"}
 ti["~"] = {"fl_water"}
 ti["_"] = {"fl_abyss"}
-ti["w"] = {"st_wood"}
+ti["w"] = {"st_box"}
 ti["s"] = {"st_swap"}
 
 ti["1"] = {"st_puzzle_blue", cluster=1, hollow=false}
@@ -49,12 +49,12 @@
 
 ti["'"] = {"st_puzzle", "puz1", connections="n"}
 ti["!"] = {"st_puzzle_yellow", "puz2", connections="w"}
-ti["W"] = {"st_wood", "wood1"}
-ti["V"] = {"st_wood", "wood2"}
+ti["W"] = {"st_box", "wood1"}
+ti["V"] = {"st_box", "wood2"}
 
 ti["n"] = {"st_puzzle_blue", "puz3", connections="n"}
 ti["m"] = {"st_puzzle_blue", "puz4", connections="s"}
-ti["v"] = {"st_wood", "wood3"}
+ti["v"] = {"st_box", "wood3"}
 
 ti["N"] = {"st_puzzle_blue", "puz5", connections="n"}
 ti["M"] = {"st_puzzle_blue", "puz6", connections="s"}
@@ -68,8 +68,8 @@
 ti["."] = {"st_stoneimpulse_movable"}
 ti["*"] = {"it_cherry"}
 
-ti["x"] = {"st_wood", "wood4"}
-ti["X"] = {"st_wood", "wood5"}
+ti["x"] = {"st_box", "wood4"}
+ti["X"] = {"st_box", "wood5"}
 
 ti["@"] = {"#ac_marble"}  ..ti({"it_magicwand"})
 

Modified: team_levelpacks/team_test_new_api/ralT065_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT065_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT065_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -30,7 +30,7 @@
 ti["("] = {"it_meditation_volcano", "vol#"}
 ti[")"] = {"it_meditation_caldera", "vol#"}
 
-ti["w"] = {"st_wood"}
+ti["w"] = {"st_box"}
 ti["d"] = {"it-dynamite"}
 ti["?"] = {"it-spade"}
 ti["S"] = {"st_switch", target="hilli#*", action="flip"}

Modified: team_levelpacks/team_test_new_api/ralT067_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT067_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT067_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -22,7 +22,7 @@
 ti["_"] = {"fl_abyss", "ab#"}
 ti["."] = {"fl_water", "pw#"}
 
-ti["w"] = {"st_wood"}
+ti["w"] = {"st_box"}
 ti["b"] = {"it_brush"}
 ti["T"] = {"st_switch", target="dopos"}
 ti["U"] = {"st_switch", target="doabyss"}

Modified: team_levelpacks/team_test_new_api/ralT068_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT068_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT068_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -30,7 +30,7 @@
 ti["S"] = {"st_switch", target="@bridge#*"}
 ti["T"] = {"st_switch", target="closed", action_1="open", action_0="close"}
 
-ti["w"] = {"st_wood"}
+ti["w"] = {"st_box"}
 ti["g"] = {"st-glass_move"}
 ti["c"] = {"it_cherry"}
 ti["s"] = {"it-spring1"}

Modified: team_levelpacks/team_test_new_api/ralT071_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT071_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT071_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -28,15 +28,15 @@
 
 ti["m"] = {"it_magicwand"}
 ti["d"] = {"it-dynamite"}
-ti["w"] = {"st_wood"}
+ti["w"] = {"st_box"}
 ti["s"] = {"st_swap"}
 ti["p"] = {"st_polarswitch"}
 ti["n"] = {"st_laser_n",state=ON}
 ti["r"] = {"st_boulder_w"}
 
-ti["W"] = {"st_wood", "w1"}
-ti["V"] = {"st_wood", "w2"}
-ti["U"] = {"st_wood", "w3"}
+ti["W"] = {"st_box", "w1"}
+ti["V"] = {"st_box", "w2"}
+ti["U"] = {"st_box", "w3"}
 
 ti["a"] = {"st_stoneimpulse_hollow", "a1"}
 ti["A"] = {"st_stoneimpulse_hollow", "a2"}

Modified: team_levelpacks/team_test_new_api/ralT072_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT072_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/ralT072_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -22,8 +22,8 @@
 ti["*"] = {"fl_water_source"}
 ti["."] = {"fl-sand", floodable=true}
 ti["-"] = {"fl_hay_framed"}
-ti["o"] = {"st_flhay"}
-ti["w"] = {"st_wood"}
+ti["o"] = {"st_box_hay"}
+ti["w"] = {"st_box"}
 ti["b"] = {"st-brownie"}
 ti["_"] = {"st_window_s"} .. ti["."]
 

Modified: team_levelpacks/team_test_new_api/raoulT03_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -63,7 +63,7 @@
 ti["G"] = {"st_window", faces="ws", "pullwindow"}
 ti["L"] = {"st_laser_w", "laser"}
 ti["S"] = {"st_switch", target="laser"}
-ti["M"] = {"st_wood"}
+ti["M"] = {"st_box"}
 
 
 ti["x"] = ti["C"] .. {"it_vortex", "vortexx", destination="vortexy"}

Modified: team_levelpacks/team_test_new_api/raoulT04_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT04_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/raoulT04_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -68,7 +68,7 @@
 ti["5"] = ti[" "] .. {"st_laser_w", name="la12"}
 ti["6"] = ti[" "] .. {"st_laser_w", name="la13"}
 
-ti["W"] = {"st_wood"}
+ti["W"] = {"st_box"}
 
 w, h = wo(ti, " ", {
 "0      A     RL     ",

Modified: team_levelpacks/team_test_new_api/raoulT05_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT05_1.xml	2008-12-21 21:42:32 UTC (rev 1406)
+++ team_levelpacks/team_test_new_api/raoulT05_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
@@ -45,7 +45,7 @@
 ti["E"] = ti["."] .. {"it_strip_n"}
 
 
-ti["w"] = {"st_wood"}
+ti["w"] = {"st_box"}
 ti["v"] = {"st-plain_move"}
 
 ti["A"] = {"#ac_marble"} .. ti["a"]



From ral at mail.berlios.de  Mon Dec 22 23:38:01 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 22 Dec 2008 23:38:01 +0100
Subject: [Enigma-game-svn] r1408 - in trunk: data data/levels/enigma_ii
	data/schemas src src/actors src/floors src/items src/stones
Message-ID: <200812222238.mBMMc1Ke025326@sheep.berlios.de>

Author: ral
Date: 2008-12-22 23:37:58 +0100 (Mon, 22 Dec 2008)
New Revision: 1408

Modified:
   trunk/data/levels/enigma_ii/ralf16_1.xml
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/actors.cc
   trunk/src/actors.hh
   trunk/src/actors/Balls.cc
   trunk/src/actors/Balls.hh
   trunk/src/floors/BridgeFloor.cc
   trunk/src/floors/SimpleFloors.cc
   trunk/src/items.cc
   trunk/src/items/GlassesItem.cc
   trunk/src/items/SimpleItems.cc
   trunk/src/items/Umbrella.cc
   trunk/src/items/Vortex.cc
   trunk/src/laser.cc
   trunk/src/player.cc
   trunk/src/server.cc
   trunk/src/stones/BlockerStone.cc
   trunk/src/stones/BoxStone.cc
   trunk/src/stones/DeathStone.cc
   trunk/src/stones/KnightStone.cc
   trunk/src/stones/PuzzleStone.cc
   trunk/src/stones/SimpleStones.cc
   trunk/src/stones/StoneImpulse.cc
   trunk/src/stones/Turnstile.cc
   trunk/src/stones/VolcanoStone.cc
   trunk/src/stones/WindowStone.cc
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering
- fix broken pearl sink animation
- rename ball internal system messages
- add actor attribute "charge" - this allows initial charged actors
- rename BoxStone internal system message "fall"

Modified: trunk/data/levels/enigma_ii/ralf16_1.xml
===================================================================
--- trunk/data/levels/enigma_ii/ralf16_1.xml	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/data/levels/enigma_ii/ralf16_1.xml	2008-12-22 22:37:58 UTC (rev 1408)
@@ -164,7 +164,6 @@
          local bx = enigma.GetNamedObject("box"..b)
          local x,y = enigma.GetPos(bx)
          set_floor(fl,x,y)
-         --SendMessage(bx,"fall")
          dropbox[b] = { x=x, y=y }
       end
       dropboxes=5

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/data/models-2d.lua	2008-12-22 22:37:58 UTC (rev 1408)
@@ -150,13 +150,13 @@
     DefAnim("ac_pearl_white-jump", PingPong(BuildFrames(frames, 70)))
 
     -- sinking
-    DefAlias ("ac-whiteball-small-sink0", "ac-whiteball-small-fall1")
-    DefAlias ("ac-whiteball-small-sink1", "ac-whiteball-small-fall2")
-    DefAlias ("ac-whiteball-small-sink2", "ac-whiteball-small-fall3")
-    DefAlias ("ac-whiteball-small-sink3", "ac-whiteball-small-fall4")
-    DefAlias ("ac-whiteball-small-sink4", "ac-whiteball-small-fall5")
-    DefAlias ("ac-whiteball-small-sink5", "ac-whiteball-small-fall5")
-    DefAlias ("ac-whiteball-small-sink6", "ac-whiteball-small-fall5")
+    DefAlias ("ac_pearl_white-sink0", "ac-whiteball-small-fall1")
+    DefAlias ("ac_pearl_white-sink1", "ac-whiteball-small-fall2")
+    DefAlias ("ac_pearl_white-sink2", "ac-whiteball-small-fall3")
+    DefAlias ("ac_pearl_white-sink3", "ac-whiteball-small-fall4")
+    DefAlias ("ac_pearl_white-sink4", "ac-whiteball-small-fall5")
+    DefAlias ("ac_pearl_white-sink5", "ac-whiteball-small-fall5")
+    DefAlias ("ac_pearl_white-sink6", "ac-whiteball-small-fall5")
     DefAlias ("ac_pearl_white-sunk", "invisible")
 
     -- Shattering

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/data/schemas/objects.xml	2008-12-22 22:37:58 UTC (rev 1408)
@@ -73,7 +73,7 @@
     <attr name="transparent" type="bool" default="false" rw="rw"/>
     <attr name="threshold" type="double" default="0" rw="rw"/>
     <attr name="wires" type="group" default="nil" rw="r"/>
-    <attr name="$charge" type="int" default="0" min="-1" max="1" rw=""/>
+    <attr name="$chargesign" type="int" default="0" min="-1" max="1" rw=""/>
     <attr name="$firetransform" type="string" default="" rw=""/>
     <attr name="$heattransform" type="string" default="" rw=""/>
   </attributes>
@@ -83,7 +83,6 @@
     <msg name="darken" type="nil"/>
     <msg name="disconnect" type="nil"/>
     <msg name="expl" type="nil"/>
-    <msg name="fall" type="nil"/>
     <msg name="fire" type="nil"/>
     <msg name="flip" type="nil"/>
     <msg name="forcefire" type="nil"/>
@@ -111,27 +110,39 @@
     <msg name="toggle" type="nil"/>
     <msg name="turn" type="nil"/>
     <msg name="turnback" type="nil"/>
+    <msg name="_appear" type="nil"/>
     <msg name="_bombstone" type="nil"/>
+    <msg name="_booze" type="nil"/>
     <msg name="_brush" type="nil"/>
     <msg name="_capture" type="nil"/>
     <msg name="_checkflood" type="nil"/>
+    <msg name="_disappear" type="nil"/>
     <msg name="_explosion" type="nil"/>
+    <msg name="_fall" type="nil"/>
     <msg name="_fallvortex" type="nil"/>
     <msg name="_freeze" type="nil"/>
     <msg name="_glasses" type="nil"/>
     <msg name="_hit" type="object"/>
     <msg name="_init" type="nil"/>
     <msg name="_invisibility" type="nil"/>
+    <msg name="_jump" type="nil"/>
     <msg name="_jumping" type="bool"/>
+    <msg name="_laserhit" type="nil"/>
+    <msg name="_levelfinish" type="bool"/>
     <msg name="_model_reanimated" type="nil"/>
     <msg name="_passed" type="nil"/>            <!-- check type-->
     <msg name="_performaction" type="nil"/>
     <msg name="_recheck" type="nil"/>
+    <msg name="_resurrect" type="nil"/>
     <msg name="_revive" type="nil"/>
+    <msg name="_rise" type="nil"/>
     <msg name="_scramble" type="int"/>
+    <msg name="_shatter" type="nil"/>
+    <msg name="_shield" type="nil"/>
     <msg name="_shogun" type="int"/>
     <msg name="_spitter" type="nil"/>
     <msg name="_start" type="nil"/>
+    <msg name="_suicide" type="nil"/>
     <msg name="_trigger" type="bool"/>
     <msg name="_updateglobals" type="string"/>
   </messages>
@@ -160,6 +171,21 @@
     </object>
     <object name="ac_marble">
       <attr name="color" default="0"/>
+      <msg name="_appear"/>
+      <msg name="_booze"/>
+      <msg name="_disappear"/>
+      <msg name="_fall"/>
+      <msg name="_fallvortex"/>
+      <msg name="_init"/>
+      <msg name="_invisibility"/>
+      <msg name="_jump"/>
+      <msg name="_laserhit"/>
+      <msg name="_levelfinish"/>
+      <msg name="_resurrect"/>
+      <msg name="_rise"/>
+      <msg name="_shatter"/>
+      <msg name="_shield"/>
+      <msg name="_suicide"/>
     </object>
     <object name="ac_marble_black">
       <attr name="color" value="0"/>
@@ -169,6 +195,21 @@
     </object>
     <object name="ac_pearl">
       <attr name="color" default="1" min="1"/>
+      <msg name="_appear"/>
+      <msg name="_booze"/>
+      <msg name="_disappear"/>
+      <msg name="_fall"/>
+      <msg name="_fallvortex"/>
+      <msg name="_init"/>
+      <msg name="_invisibility"/>
+      <msg name="_jump"/>
+      <msg name="_laserhit"/>
+      <msg name="_levelfinish"/>
+      <msg name="_resurrect"/>
+      <msg name="_rise"/>
+      <msg name="_shatter"/>
+      <msg name="_shield"/>
+      <msg name="_suicide"/>
     </object>
     <object name="ac_pearl_white">
       <attr name="color" value="1"/>
@@ -661,7 +702,7 @@
       <attr name="flavor" default="wood" rw="r"/>
       <msg name="fire"/>
       <msg name="heat"/>
-      <msg name="fall"/>
+      <msg name="_fall"/>
     </object>
     <object name="st_box_hay" flavor="hay"/>
     <object name="st_box_rock" flavor="rock"/>
@@ -724,16 +765,16 @@
     </object>
     <object name="st_charge">
       <attr name="charge"/>
-      <attr name="$charge"/>
+      <attr name="$chargesign"/>
     </object>
     <object name="st_charge_zero">
-      <attr name="$charge" value="0"/>
+      <attr name="$chargesign" value="0"/>
     </object>
     <object name="st_charge_plus">
-      <attr name="$charge" value="1"/>
+      <attr name="$chargesign" value="1"/>
     </object>
     <object name="st_charge_minus">
-      <attr name="$charge" value="-1"/>
+      <attr name="$chargesign" value="-1"/>
     </object>
     <object name="st_chess">
       <attr name="color" default="0"/>

Modified: trunk/src/actors/Balls.cc
===================================================================
--- trunk/src/actors/Balls.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/actors/Balls.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -36,54 +36,42 @@
             m_drunk_rest_time (0), m_invisible_rest_time (0) {
         state = NO_STATE;
     }
-    
-//    void BasicBall::setAttr(const string& key, const Value &val) {
-//        if (key == "charge") {
-//        } else
-//        Stone::setAttr(key, val);
-//    }
-//
-//    Value BasicBall::getAttr(const std::string &key) const {
-//        if (key == "charge") {
-//        } else
-//            return Stone::getAttr(key);
-//    }
 
-    Value BasicBall::message(const Message &m) {
+    Value BasicBall::message(const Message &m) {   // shatter, suicide, fall, jump, booze, shield are candidates for public usage
         bool handled = false;
         switch (state) {
             case NORMAL:
-                if (m.message == "shatter") {
+                if (m.message == "_shatter") {
                     change_state_noshield(SHATTERING);
                     handled = true;
-                } else if (m.message == "suicide") {
+                } else if (m.message == "_suicide") {
                     change_state(SHATTERING);
                     handled = true;
-                } else if (m.message == "laserhit") {
+                } else if (m.message == "_laserhit") {
                     change_state_noshield(SHATTERING);
                     handled = true;
-                } else if (m.message == "fall") {
+                } else if (m.message == "_fall") {
                     change_state_noshield(FALLING);
                     handled = true;
                 } else if (m.message == "_fallvortex") {
                     change_state(FALLING_VORTEX);
                     handled = true;
-                } else if (m.message == "jump") {
+                } else if (m.message == "_jump") {
                     change_state(JUMPING);
                     handled = true;
-                } else if (m.message == "appear") {
+                } else if (m.message == "_appear") {
                     change_state(APPEARING);
                     handled = true;
-                } else if (m.message == "disappear") {
+                } else if (m.message == "_disappear") {
                     change_state(DISAPPEARING);
                     handled = true;
                 }
                 break;
             case JUMPING:
-                if (m.message == "shatter") {
+                if (m.message == "_shatter") {
                     change_state_noshield(SHATTERING);
                     handled = true;
-                } else if (m.message == "disappear") {
+                } else if (m.message == "_disappear") {
                     change_state(DISAPPEARING);
                     handled = true;
                 }
@@ -95,21 +83,21 @@
                 }
                 break;
             case DEAD:
-                if (m.message == "resurrect") {
+                if (m.message == "_resurrect") {
                     change_state(RESURRECTED);
                     handled = true;
                 }
                 break;
             case FALLING_VORTEX:
-                if (m.message == "rise") {
+                if (m.message == "_rise") {
                     change_state(RISING_VORTEX); // vortex->vortex teleportation
-                } else if (m.message == "appear") {
+                } else if (m.message == "_appear") {
                     change_state(APPEARING); // vortex->non-vortex teleportation
                     handled = true;
                 }
                 break;
             case JUMP_VORTEX:
-                if (m.message == "laserhit") {
+                if (m.message == "_laserhit") {
                     change_state(SHATTERING);
                     handled = true;
                 }
@@ -119,7 +107,7 @@
                 if (m.message == "_init") {
                     Actor::message (m);
                     handled = true;
-                } else if (m.message == "shatter") {
+                } else if (m.message == "_shatter") {
                     change_state (SHATTERING);
                     handled = true;
                 }
@@ -131,7 +119,7 @@
         // Shield, booze and invisibility can be activated in all states except DEAD
     
         if (state != DEAD) {
-            if (m.message == "shield") {
+            if (m.message == "_shield") {
                 m_shield_rest_time += SHIELD_TIME;
                 update_halo();
                 handled = true;
@@ -140,7 +128,7 @@
                 m_invisible_rest_time += 8.0;
                 handled = true;
             }
-            else if (m.message == "booze") {
+            else if (m.message == "_booze") {
                 m_drunk_rest_time += 5.0; // Drunken for 5 more seconds
                 handled = true;
             }
@@ -253,9 +241,9 @@
             case FALLING:
                 set_model(kind+"-fallen"); // invisible
                 if (get_id (this) == ac_marble_white)
-                    sound_event ("shattersmall");
+                    sound_event("shattersmall");
                 else
-                    sound_event ("shatter");
+                    sound_event("shatter");
                 change_state(DEAD);
                 break;
             case JUMPING:

Modified: trunk/src/actors/Balls.hh
===================================================================
--- trunk/src/actors/Balls.hh	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/actors/Balls.hh	2008-12-22 22:37:58 UTC (rev 1408)
@@ -55,8 +55,6 @@
         BasicBall(const ActorTraits &tr, int maxSinkDepthValue = 7);
 
         // Object interface.
-//        virtual void setAttr(const string& key, const Value &val);
-//        virtual Value getAttr(const std::string &key) const;
         virtual Value message(const Message &m);
         
         // Actor interface

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/actors.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -101,6 +101,41 @@
     ASSERT(m_actorinfo.radius <= get_max_radius(), XLevelRuntime, "Actor: radius of actor too large");
 }
 
+    void Actor::setAttr(const string& key, const Value &val) {
+        if (key == "controllers") {
+            controllers = val;
+        } else if (key == "adhesion") { 
+            adhesion = val;
+        } else if (key == "charge") {
+            m_actorinfo.charge = val;
+        } else
+            Object::setAttr(key, val);
+    }
+
+    Value Actor::getAttr(const std::string &key) const {
+        if (key == "controllers") {
+            return controllers;
+        } else if (key == "adhesion") { 
+            return adhesion;
+        } else if (key == "charge") {
+            return m_actorinfo.charge;
+        } else
+            return StateObject::getAttr(key);
+    }
+
+    Value Actor::message(const Message &m) {
+        if (m.message == "_init") {
+            startingpos = get_pos();
+            return Value();
+        } else if (m.message == "_freeze") {
+            m_actorinfo.frozen_vel = m_actorinfo.vel;
+            m_actorinfo.vel = ecl::V2();
+        } else if (m.message == "_revive") {
+            m_actorinfo.vel = m_actorinfo.frozen_vel;        
+        }
+        return StateObject::message(m);
+    }
+
 void Actor::on_collision (Actor *) 
 {
 }
@@ -260,32 +295,11 @@
     return true;
 }
 
-Value Actor::message(const Message &m) {
-    if (m.message == "_init") {
-        startingpos = get_pos();
-        return Value();
-    } else if (m.message == "_freeze") {
-        m_actorinfo.frozen_vel = m_actorinfo.vel;
-        m_actorinfo.vel = ecl::V2();
-    } else if (m.message == "_revive") {
-        m_actorinfo.vel = m_actorinfo.frozen_vel;        
-    }
-    return StateObject::message(m);
-}
 
 bool Actor::sound_event (const char *name, double vol) {
     return sound::EmitSoundEvent (name, get_pos(), getVolume(name, this, vol));
 }
 
-void Actor::setAttr(const string& key, const Value &val)
-{
-    if (key == "controllers")
-        controllers = to_int (val);
-    else if (key == "adhesion") 
-        adhesion = to_double (val);
-    Object::setAttr(key, val);
-}
-
     double Actor::squareDistance(const Object *other) const {
         const Actor *a = dynamic_cast<const Actor *>(other);
         if (a != NULL)
@@ -321,7 +335,7 @@
 //        bool is_on_floor() const { return false; } we need friction!
 
 	void on_collision (Actor *a) {
-	    SendMessage(a, "shatter");
+	    SendMessage(a, "_shatter");
 	}
 
         double range;
@@ -626,7 +640,7 @@
         bool is_dead() const { return false; }
 
 	void on_collision(Actor *a) {
-	    SendMessage(a, "shatter");
+	    SendMessage(a, "_shatter");
 	}
     };
 }

Modified: trunk/src/actors.hh
===================================================================
--- trunk/src/actors.hh	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/actors.hh	2008-12-22 22:37:58 UTC (rev 1408)
@@ -118,9 +118,10 @@
 
         /* ---------- Object interface ---------- */
         Actor *clone() = 0;
+        virtual void setAttr(const string& key, const Value &val);
+        virtual Value getAttr(const std::string &key) const;
         virtual Value message(const Message &m);
-        void   setAttr(const string& key, const Value &val);
-
+ 
         /* ---------- Actor interface ---------- */
         virtual const ActorTraits &get_traits() const = 0;
 

Modified: trunk/src/floors/BridgeFloor.cc
===================================================================
--- trunk/src/floors/BridgeFloor.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/floors/BridgeFloor.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -128,7 +128,7 @@
     }
     
     void BridgeFloor::actor_contact(Actor *a) {
-        if (state != CLOSED) SendMessage(a, "fall");
+        if (state != CLOSED) SendMessage(a, "_fall");
     }
     
     std::string BridgeFloor::model_basename() const {

Modified: trunk/src/floors/SimpleFloors.cc
===================================================================
--- trunk/src/floors/SimpleFloors.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/floors/SimpleFloors.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -40,7 +40,7 @@
     }
 
     void Abyss::actor_contact (Actor* a) {
-        SendMessage(a, "fall");
+        SendMessage(a, "_fall");
     }
     
 /* -------------------- Ice -------------------- */

Modified: trunk/src/items/GlassesItem.cc
===================================================================
--- trunk/src/items/GlassesItem.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/items/GlassesItem.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -78,7 +78,7 @@
     }
     void Glasses::on_stonehit(Stone *) {
         if (state > 0) {
-            sound_event ("shatter");
+            sound_event("shatter");
             setState(0);
         }
     }

Modified: trunk/src/items/SimpleItems.cc
===================================================================
--- trunk/src/items/SimpleItems.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/items/SimpleItems.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -85,7 +85,7 @@
     bool DeathItem::actor_hit(Actor *a) {
         ActorInfo &ai = * a->get_actorinfo();
         if (!ai.grabbed) {
-            SendMessage(a, "shatter");
+            SendMessage(a, "_shatter");
             if (state == 0) {
                 state = 1;
                 set_anim("it_death_anim");

Modified: trunk/src/items/Umbrella.cc
===================================================================
--- trunk/src/items/Umbrella.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/items/Umbrella.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -58,7 +58,7 @@
     }
     
     ItemAction Umbrella::activate(Actor *a, GridPos) {
-        SendMessage(a, "shield");
+        SendMessage(a, "_shield");
         return ITEM_KILL;
     }
     

Modified: trunk/src/items/Vortex.cc
===================================================================
--- trunk/src/items/Vortex.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/items/Vortex.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -38,7 +38,7 @@
         GameTimer.remove_alarm(this);
         if (Actor *actor = dynamic_cast<Actor *>((Object *)getAttr("$grabbed_actor"))) {
             // release an actor that is grabbed on behalf of this vortex - actor state FALLING_VORTEX
-            SendMessage(actor, "rise");
+            SendMessage(actor, "_rise");
         }
     }
 
@@ -163,7 +163,7 @@
         V2 v(destVortex->get_pos().center());
         if (Actor *actor = dynamic_cast<Actor *>((Object *)getAttr("$grabbed_actor"))) {
             WarpActor(actor, v[0], v[1], false);
-            SendMessage(actor, "rise");
+            SendMessage(actor, "_rise");
             if (destVortex != this) {
                 bool isScissor = to_bool(getDefaultedAttr("scissor", 
                         (server::EnigmaCompatibility >= 1.10) || server::GameCompatibility != GAMET_ENIGMA));
@@ -184,7 +184,7 @@
         client::Msg_Sparkle (target);
         if (Actor *actor = dynamic_cast<Actor *>((Object *)getAttr("$grabbed_actor"))) {
             WarpActor(actor, target[0], target[1], false);
-            SendMessage(actor, "appear");
+            SendMessage(actor, "_appear");
             bool isScissor = to_bool(getDefaultedAttr("scissor", 
                     (server::EnigmaCompatibility >= 1.10) || server::GameCompatibility != GAMET_ENIGMA));
             if (isScissor)

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/items.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -224,7 +224,7 @@
         DECL_ITEMTRAITS;
 
         ItemAction activate(Actor *a, GridPos) {
-            SendMessage(a, "suicide");
+            SendMessage(a, "_suicide");
             return ITEM_DROP;
         }
     public:
@@ -246,7 +246,7 @@
 	}
     private:
 	ItemAction activate(Actor *a, GridPos) {
-	    SendMessage(a, "booze");
+	    SendMessage(a, "_booze");
 	    return ITEM_DROP;
 	}
     void on_stonehit(Stone *) {
@@ -267,7 +267,7 @@
         bool actor_hit(Actor *a) {
             ActorInfo &ai = * a->get_actorinfo();
             if (!ai.grabbed && a->is_on_floor()) {
-                SendMessage(a, "shatter");
+                SendMessage(a, "_shatter");
             }
             return false;
         }
@@ -311,7 +311,7 @@
     private:
         ItemAction activate(Actor *a, GridPos)
         {
-            SendMessage(a, "jump");
+            SendMessage(a, "_jump");
             return ITEM_KEEP;
         }
     };
@@ -327,7 +327,7 @@
         {
             Item *it = GetItem(p);
             if (!it || has_flags(it, itf_static)) {
-                SendMessage(a, "jump");
+                SendMessage(a, "_jump");
                 return ITEM_DROP;  // drop if grid has no item
             } else {
                 // don't jump if a regular item is on the grid
@@ -352,7 +352,7 @@
             double dist = length(a->get_pos() - item_center);
             if (dist < ITEM_RADIUS) {
                 set_anim("it-springboard_anim");
-                SendMessage(a, "jump");
+                SendMessage(a, "_jump");
             }
             return false;
         }
@@ -377,7 +377,7 @@
     private:
         void init_model() {set_anim("expl");}
         bool actor_hit(Actor *actor) {
-            SendMessage(actor, "shatter");
+            SendMessage(actor, "_shatter");
             return false;
         }
     };
@@ -896,7 +896,7 @@
         }
         bool actor_hit(Actor *a) {
             if (anim_end)
-                SendMessage(a, "fall");
+                SendMessage(a, "_fall");
             return false;
         }
         virtual Value message(const Message &m) {
@@ -941,7 +941,7 @@
         DECL_ITEMTRAITS;
 
         bool actor_hit(Actor *a) {
-            SendMessage(a, "fall");
+            SendMessage(a, "_fall");
             return false;
         }
         void animcb() {
@@ -1025,7 +1025,7 @@
 
 bool Burnable::actor_hit(Actor *a) {
     if (state == IGNITE || state == BURNING)
-        SendMessage(a, "shatter");
+        SendMessage(a, "_shatter");
     return false;
 }
 
@@ -1398,7 +1398,7 @@
     
     bool Trap::actor_hit(Actor *a) {
         if (!a->is_flying()) {
-            SendMessage(a, "fall");
+            SendMessage(a, "_fall");
             if (state == 0) {
                 state = 1;
                 set_anim("it_trap_breaking");
@@ -1782,7 +1782,7 @@
                 // Kill ALL rubberbands connected with the actor:
                 SendMessage(a, "disconnect");
                 Actor *rotor = MakeActor("ac-rotor");
-                rotor->setAttr("mouseforce", Value (1.0));
+                rotor->setAttr("adhesion", Value (1.0));
                 rotor->setAttr("controllers", Value (iplayer+1));
                 rotor->setAttr("player", Value (iplayer));
                 rotor->setAttr("gohome", Value (0.0));

Modified: trunk/src/laser.cc
===================================================================
--- trunk/src/laser.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/laser.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -149,7 +149,7 @@
     if ((directions & (EASTBIT | WESTBIT) && dy<-0.1) ||
         (directions & (NORTHBIT | SOUTHBIT)) && dx<-0.1)
     {
-        SendMessage(actor, "laserhit");
+        SendMessage(actor, "_laserhit");
     }
 
     return false; // laser beams can't be picked up

Modified: trunk/src/player.cc
===================================================================
--- trunk/src/player.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/player.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -114,7 +114,7 @@
     const double RESPAWN_TIME = 1.5;
 
 //    a->find_respawnpos();
-    SendMessage(a, "resurrect");
+    SendMessage(a, "_resurrect");
     remove_extralife(a);
     respawn_list.push_back(RespawnInfo(a, RESPAWN_TIME));
 }
@@ -233,7 +233,7 @@
             if (stage == 0) {
                 SendMessage(a, "_levelfinish");
             } else {
-                SendMessage(a, "disappear");
+                SendMessage(a, "_disappear");
                 SendMessage(a, "disconnect");
             }
         }
@@ -326,7 +326,7 @@
     for (unsigned i=0; i<players.size(); ++i) {
         vector<Actor *> &al = players[i].actors;
         for (unsigned j=0; j<al.size(); ++j) {
-            SendMessage(al[j], "suicide");
+            SendMessage(al[j], "_suicide");
         }
     }
 }

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/server.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -496,8 +496,7 @@
 
     // ------------------------------ cheats
     else if (cmd == "god") {
-        SendMessage (player::GetMainActor (player::CurrentPlayer()),
-                     "shield");
+        SendMessage(player::GetMainActor(player::CurrentPlayer()), "_shield");
         client::Msg_Command("cheater");
     }
     else if (cmd == "collision") {

Modified: trunk/src/stones/BlockerStone.cc
===================================================================
--- trunk/src/stones/BlockerStone.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/stones/BlockerStone.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -121,13 +121,13 @@
         if (!(getDefaultedAttr("autoclose", false).to_bool()) && (
                 (state == GROWING && server::GameCompatibility != GAMET_PEROXYD) ||
                 (state == SOLID && server::GameCompatibility == GAMET_PEROXYD))) {
-            SendMessage(a, "shatter");
+            SendMessage(a, "_shatter");
         }
     }
     void BlockerStone::actor_inside(Actor *a) {
         if ((state == GROWING && server::GameCompatibility != GAMET_PEROXYD) ||
                 (state == SOLID && server::GameCompatibility == GAMET_PEROXYD)) {
-            SendMessage(a, "shatter");
+            SendMessage(a, "_shatter");
         }
     }
     

Modified: trunk/src/stones/BoxStone.cc
===================================================================
--- trunk/src/stones/BoxStone.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/stones/BoxStone.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -89,7 +89,7 @@
             return true;  // allow fire to spread
         } else if (m.message == "heat") {
             return (objFlags & OBJBIT_BLOCKFIRE) != 0;  // block fire
-        } else if (m.message == "fall") {
+        } else if (m.message == "_fall") {
             maybe_fall_or_stopfire();
             return Value();
         }
@@ -137,19 +137,19 @@
     
     void BoxStone::actor_hit(const StoneContact &sc) {
         if (state == GROWING)
-            SendMessage(sc.actor, "shatter");
+            SendMessage(sc.actor, "_shatter");
         else
             Stone::actor_hit(sc);
     }
     
     void BoxStone::actor_inside(Actor *a) {
         if (state == GROWING)
-            SendMessage(a, "shatter");
+            SendMessage(a, "_shatter");
     }
     
     void BoxStone::actor_contact(Actor *a) {
         if (state == GROWING)
-            SendMessage(a, "shatter");
+            SendMessage(a, "_shatter");
     }
     
     void BoxStone::on_move() {

Modified: trunk/src/stones/DeathStone.cc
===================================================================
--- trunk/src/stones/DeathStone.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/stones/DeathStone.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -90,7 +90,7 @@
     }
     
     void DeathStone::actor_hit(const StoneContact &sc) {
-        SendMessage(sc.actor, "shatter");
+        SendMessage(sc.actor, "_shatter");
         if (state == IDLE) {
             state = PULSING;
             set_anim("st-death-anim");

Modified: trunk/src/stones/KnightStone.cc
===================================================================
--- trunk/src/stones/KnightStone.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/stones/KnightStone.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -59,7 +59,7 @@
                 }
                 init_model();
             } else {
-                SendMessage(sc.actor, "shatter");
+                SendMessage(sc.actor, "_shatter");
             }
         }
     }

Modified: trunk/src/stones/PuzzleStone.cc
===================================================================
--- trunk/src/stones/PuzzleStone.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/stones/PuzzleStone.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -234,7 +234,7 @@
 
     void PuzzleStone::actor_contact (Actor *a) {
         if (state == EXPLODING || state == IGNITED)
-            SendMessage(a, "shatter");
+            SendMessage(a, "_shatter");
     }
 
     void PuzzleStone::on_impulse(const Impulse& impulse) {

Modified: trunk/src/stones/SimpleStones.cc
===================================================================
--- trunk/src/stones/SimpleStones.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/stones/SimpleStones.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -43,7 +43,7 @@
     }
 
     Value ChargeStone::getAttr(const std::string &key) const {
-        if (key == "$charge") {
+        if (key == "$chargesign") {             // used by validator to identify charge stone subkinds
             double charge = getAttr("charge");
             return (charge == 0) ? 0 : ((charge > 0.0) ? 1 : -1);
         } else
@@ -69,8 +69,7 @@
     
     void ChargeStone::actor_hit(const StoneContact &sc) {
         double charge = getAttr("charge");
-        ActorInfo *ai = sc.actor->get_actorinfo();
-        ai->charge = charge;
+        sc.actor->setAttr("charge", charge);
         set_anim(ecl::strf("st-charge%s-anim", (charge == 0) ? "zero" : ((charge > 0.0) ? "plus" : "minus")).c_str());
     }
     

Modified: trunk/src/stones/StoneImpulse.cc
===================================================================
--- trunk/src/stones/StoneImpulse.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/stones/StoneImpulse.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -173,7 +173,7 @@
     
     void StoneImpulse::actor_inside(Actor *a) {
         if ((state != IDLE) && (objFlags & OBJBIT_HOLLOW))
-            SendMessage(a, "shatter");
+            SendMessage(a, "_shatter");
     }
     
     void StoneImpulse::actor_hit(const StoneContact &sc) {

Modified: trunk/src/stones/Turnstile.cc
===================================================================
--- trunk/src/stones/Turnstile.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/stones/Turnstile.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -294,7 +294,7 @@
                 // Move only the actor that hit the turnstile in Oxyd mode
                 do_warp = (ac == dynamic_cast<Actor*>(impulse_sender));
                 if (!do_warp && arm_seen[idx_source])
-                    SendMessage(ac, "shatter"); // hit by an arm
+                    SendMessage(ac, "_shatter"); // hit by an arm
             } else { // green turnstile
                 // move all actors only if pushed by an arm
                 do_warp = arm_seen[idx_source];
@@ -307,7 +307,7 @@
             GridPos ac_target_pos(pv_pos.x+to_x[idx_target], pv_pos.y+to_y[idx_target]);
 
             if(!IsInsideLevel(ac_target_pos)) {
-                SendMessage(ac, "shatter");
+                SendMessage(ac, "_shatter");
                 continue;
             }
 

Modified: trunk/src/stones/VolcanoStone.cc
===================================================================
--- trunk/src/stones/VolcanoStone.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/stones/VolcanoStone.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -136,23 +136,23 @@
             state = BREAKING;
             init_model();
         } else if (state == GROWING) {
-            SendMessage(a, "shatter");
+            SendMessage(a, "_shatter");
         }
     }
     
     void VolcanoStone::actor_touch(const StoneContact &sc) {
         if (state == GROWING)
-            SendMessage(sc.actor, "shatter");        
+            SendMessage(sc.actor, "_shatter");        
     }
 
     void VolcanoStone::actor_inside(Actor *a) {
         if (state != NEW)
-            SendMessage(a, "shatter");
+            SendMessage(a, "_shatter");
     }
     
     void VolcanoStone::actor_contact(Actor *a) {
         if (state == GROWING)
-            SendMessage(a, "shatter");
+            SendMessage(a, "_shatter");
     }
     
     FreezeStatusBits VolcanoStone::get_freeze_bits() {

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/stones/WindowStone.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -154,7 +154,7 @@
                 threshold -= 10;
             
             if (impulse > 35) {
-                SendMessage(a, "shatter");
+                SendMessage(a, "_shatter");
             }
 
             else if (!(objFlags & OBJBIT_SECURE) && impulse > threshold) {

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-12-22 00:20:36 UTC (rev 1407)
+++ trunk/src/stones_simple.cc	2008-12-22 22:37:58 UTC (rev 1408)
@@ -852,9 +852,9 @@
             Stone *st = MakeStone("st-greenbrown");
             ReplaceStone(get_pos(), st);
         }
-        void actor_contact(Actor *a) {SendMessage(a, "shatter");}
-        void actor_inside(Actor *a) {SendMessage(a, "shatter");}
-        void actor_hit(const StoneContact &sc) {SendMessage(sc.actor, "shatter");}
+        void actor_contact(Actor *a) {SendMessage(a, "_shatter");}
+        void actor_inside(Actor *a) {SendMessage(a, "_shatter");}
+        void actor_hit(const StoneContact &sc) {SendMessage(sc.actor, "_shatter");}
     };
     DEF_TRAITS(GreenbrownStone_Growing, "st-greenbrown-growing", st_greenbrown_growing);
 



From andreasl at mail.berlios.de  Wed Dec 24 01:29:27 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Wed, 24 Dec 2008 01:29:27 +0100
Subject: [Enigma-game-svn] r1409 - in homepage: images/lotm input/lotm
Message-ID: <200812240029.mBO0TREo005962@sheep.berlios.de>

Author: andreasl
Date: 2008-12-24 01:29:13 +0100 (Wed, 24 Dec 2008)
New Revision: 1409

Added:
   homepage/images/lotm/lotm_200812.png
   homepage/images/lotm/lotm_200812_b.jpg
   homepage/images/lotm/lotm_200812_c.jpg
   homepage/images/lotm/lotm_200812_e.jpg
   homepage/images/lotm/lotm_200812_g.jpg
   homepage/images/lotm/lotm_200812_h.jpg
   homepage/images/lotm/lotm_200812_i.jpg
   homepage/images/lotm/lotm_200812_k.jpg
   homepage/images/lotm/lotm_200812_l.jpg
   homepage/images/lotm/lotm_200812_m.jpg
   homepage/images/lotm/lotm_200812_n.jpg
   homepage/input/lotm/lotm_200812.html
Modified:
   homepage/images/lotm/lotm-history.png
   homepage/input/lotm/lotm_200810.html
   homepage/input/lotm/lotm_archive_data.lua
Log:
Homepage:
 - English version of LotM 12/2008
Todo:
 - Russian translation
 - German translation
 - Validation
 - Upload


Modified: homepage/images/lotm/lotm-history.png
===================================================================
(Binary files differ)

Added: homepage/images/lotm/lotm_200812.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/lotm/lotm_200812.png
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/lotm/lotm_200812_b.jpg
===================================================================
(Binary files differ)


Property changes on: homepage/images/lotm/lotm_200812_b.jpg
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/lotm/lotm_200812_c.jpg
===================================================================
(Binary files differ)


Property changes on: homepage/images/lotm/lotm_200812_c.jpg
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/lotm/lotm_200812_e.jpg
===================================================================
(Binary files differ)


Property changes on: homepage/images/lotm/lotm_200812_e.jpg
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/lotm/lotm_200812_g.jpg
===================================================================
(Binary files differ)


Property changes on: homepage/images/lotm/lotm_200812_g.jpg
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/lotm/lotm_200812_h.jpg
===================================================================
(Binary files differ)


Property changes on: homepage/images/lotm/lotm_200812_h.jpg
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/lotm/lotm_200812_i.jpg
===================================================================
(Binary files differ)


Property changes on: homepage/images/lotm/lotm_200812_i.jpg
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/lotm/lotm_200812_k.jpg
===================================================================
(Binary files differ)


Property changes on: homepage/images/lotm/lotm_200812_k.jpg
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/lotm/lotm_200812_l.jpg
===================================================================
(Binary files differ)


Property changes on: homepage/images/lotm/lotm_200812_l.jpg
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/lotm/lotm_200812_m.jpg
===================================================================
(Binary files differ)


Property changes on: homepage/images/lotm/lotm_200812_m.jpg
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: homepage/images/lotm/lotm_200812_n.jpg
===================================================================
(Binary files differ)


Property changes on: homepage/images/lotm/lotm_200812_n.jpg
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Modified: homepage/input/lotm/lotm_200810.html
===================================================================
--- homepage/input/lotm/lotm_200810.html	2008-12-22 22:37:58 UTC (rev 1408)
+++ homepage/input/lotm/lotm_200810.html	2008-12-24 00:29:13 UTC (rev 1409)
@@ -71,6 +71,7 @@
 boss: &quot;<i>I'm sure you're very well-rested from your vacation. You can do
 it!</i>&quot; Well, if only he knew how much our marble had hoped for a restful
 first working day.
+</p>
 
 <p>
 Plant VI/98 is well-known among the employees. The building, made

Added: homepage/input/lotm/lotm_200812.html
===================================================================
--- homepage/input/lotm/lotm_200812.html	2008-12-22 22:37:58 UTC (rev 1408)
+++ homepage/input/lotm/lotm_200812.html	2008-12-24 00:29:13 UTC (rev 1409)
@@ -0,0 +1,517 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">December 2008: </span>
+    &quot;Procrustes&quot; by Andreas Lochmann
+  </h3>
+
+<p>
+In the last two years we've been talking about 10 epic levels with a
+strong emphasis on exploring and adventuring here at our column. These
+gorgeous multi-screen creations are the ones best loved by our players.
+We've also had the pleasure to talk about 6 excellent levels with a
+size of 2, 3 or 4 screens. Two months ago the first level with the
+classic size of just one screen has been awarded: &quot;Industrial
+Puzzles&quot; by Raoul Bourquin, and now the second represantative of
+this level species waits to step up onto stage and to receive his
+award. Although of the same kind they could hardly be more different.
+&quot;Industrial Puzzles&quot; is cluttered with various objects, the
+narrowness of the room may cause a feeling of oppressiveness,
+innumerable are the ways of failure - the player's in a state of
+confusion at first.
+</p>
+
+<p>
+Not so this month's LotM: The building gives the impression that it has
+been spaciously designed, just one sort of gaming object is presented to
+the player, everything's visible and easily understandable - you feel
+confused. The blue puzzle stones that appeared almost only in the role
+of designing elements in &quot;Industrial Puzzles&quot; are now playing
+the leading role. Instead of an industrial plant of modern times this
+month we find ourselves back again to Ancient Greece, as guests of an
+infamous hotel-manager: &quot;Welcome to the hotel 'Procrustes' - such a
+lovely place&quot;. Our host was so kind to start a fire in the
+guestrooms, which is quite comfortable at the beginning of the cold
+season. The warmth of the flickering flames make you feel at home -
+&quot;such a lovely place&quot;. Only the festive lights are still dark:
+As always it's up to you to light up the oxydean lamps.
+</p>
+
+<p>
+In level pack VI of Enigma 1.00 there has been a decade of levels
+dedicated to myths and legends of the ancient world. The most excellent
+of these levels has been (and of course still is) #36, and now has
+become our LotM December: &quot;Procrustes&quot;. This time there's not
+a report or a story waiting for you: Instead we're happy to present a
+decade of commentaries to you. Ten contributions, this is more than we
+had ever before in the by now 19-part history of LotM. Andreas will
+talk in detail about the &quot;making&quot; of his masterpiece, and
+Mecke, author of the reflective poetry of the &quot;Novice&quot; series,
+has written a lyrical essay. Together with the other 8 pieces an
+interesting medley of various thoughts and ideas in various styles of
+presentation is in store for you: United in one theme:
+&quot;Procrustes&quot;. Have fun reading.
+</p>
+
+<p>
+But first of all: Here's the visitor's book of the hotel
+&quot;Procrustes&quot;:
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_e.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">Enigma VI # 36</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Some records of September 2008</caption>
+<colgroup>
+    <col width="80">
+    <col width="160">
+</colgroup>
+    <tr><td class="num">4:18</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">5:42</td>
+        <td class="left">Django</td></tr>
+    <tr><td class="num">6:33</td>
+        <td class="left">Andreas</td></tr>
+    <tr><td class="num">7:50</td>
+        <td class="left">dev0</td></tr>
+    <tr><td class="num">7:57</td>
+        <td class="left">serpent</td></tr>
+    <tr><td class="num">8:26</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">8:53</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">9:37</td>
+        <td class="left">Mark P.</td></tr>
+    <tr><td class="num">10:09</td>
+        <td class="left">Johannes</td></tr>
+    <tr><td class="num">11:09</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">11:21</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">11:58</td>
+        <td class="left">dpl</td></tr>
+    <tr><td class="num">12:19</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">12:21</td>
+        <td class="left">JuSt</td></tr>
+    <tr><td class="num">12:28</td>
+        <td class="left">Safalra</td></tr>
+    <tr><td class="num">13:05</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">13:58</td>
+        <td class="left">redsantz</td></tr>
+    <tr><td class="num">14:02</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">14:26</td>
+        <td class="left">Daisy</td></tr>
+    <tr><td class="num">15:14</td>
+        <td class="left">shoki</td></tr>
+    <tr><td class="num">15:22</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">15:34</td>
+        <td class="left">Malla</td></tr>
+    <tr><td class="num">16:58</td>
+        <td class="left">Melanie</td></tr>
+    <tr><td class="num">18:16</td>
+        <td class="left">mecke</td></tr>
+    <tr><td class="num">19:55</td>
+        <td class="left">ABS</td></tr>
+    <tr><td class="num">20:14</td>
+        <td class="left">NorthForty</td></tr>
+    <tr><td class="num">22:16</td>
+        <td class="left">Duffy</td></tr>
+    <tr><td class="num">25:08</td>
+        <td class="left">Alex</td></tr>
+    <tr><td class="num">25:29</td>
+        <td class="left">alfred69</td></tr>
+    <tr><td class="num">26:43</td>
+        <td class="left">Sim_Ed</td></tr>
+    <tr><td class="num">27:55</td>
+        <td class="left">IntKecsk</td></tr>
+    <tr><td class="num">29:30</td>
+        <td class="left">Tarim</td></tr>
+    <tr><td class="num">32:06</td>
+        <td class="left">HuB34</td></tr>
+    <tr><td class="num">32:38</td>
+        <td class="left">biotopa</td></tr>
+    <tr><td class="num">33:18</td>
+        <td class="left">para_doks</td></tr>
+    <tr><td class="num">34:47</td>
+        <td class="left">Andy</td></tr>
+    <tr><td class="num">45:47</td>
+        <td class="left">Freshman</td></tr>
+    <tr><td class="num">45:53</td>
+        <td class="left">WP319</td></tr>
+    <tr><td class="num">47:17</td>
+        <td class="left">Valkyrie2</td></tr>
+    <tr><td class="num">142:21</td>
+        <td class="left">brynn</td></tr>
+</table>
+
+
+<h4>&quot;What I like best about Procrustes is that it's pure Enigma&quot;</h4>
+
+<div class="quote">It's my honor to be asked to comment on Procrustes (VI #36) the December 2008 LotM. But first I want to congratulate Andreas Lochmann, for his creation has earned this prestigious ranking among Enigma's elite!</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_k.jpg" alt="Level of the Month" border="0">
+</div>
+
+<div class="quote">As a player who is often mouse-challenged and who doesn't aspire to world records, I like that there isn't a time limiting factor, and that the player does not need a great deal of mouse dexterity. In so many levels, the fire grows and grows. But here, it's simply a static obstacle.</div>
+
+<div class="quote">There is a lot of meticulous moving around of stones, and the player must strategically think ahead, which as hallmarks of Enigma, no doubt contribute to its high ratings. I particularly enjoy the use of symmetry, and the kind of problems it presents, in this level.</div>
+
+<div class="quote">What I like best about Procrustes is that it's pure Enigma: No extra specialized knowledge is needed to solve it. Everything needed to play is near at hand, on one screen. Although in this level, like many others, having the solution nearby does not necessarily mean it is quick or easy!</div>
+
+<div class="quote">Until now, I thought the title had something to do with the fire, like burning something might make it 'crusty', lol! I tend not to see the anthropomorphic symbolism in Enigma, and instead just solve the puzzles based on the functions of the objects. But while becoming reacquainted with this level, I looked up 'Procrustes'. And it's really neat how Andreas Lochmann made this level to be so perfectly symbolic of the mythological character&mdash;it's very, very clever!</div>
+
+<div class="quote">While it's not nearly as complex or difficult as most other Levels of the Month, I think Procrustes, on all counts, exhibits the archetypal characteristics of the Levels of the Month.</div>
+
+<div class="author">Brynn</div> 
+
+
+<h4>&quot;For me no meditation level has such a strong meditative aspect like 'Procrustes'&quot;</h4>
+
+<div class="quote">Two or three hours after midnight. The first tunes of a lap steel guitar come out of the headphones - a slow country song &hellip; somehow familiar &hellip; &quot;<i>Well she's walking through the clouds, with a circus smile that's running 'round</i> &hellip;&quot; - Err?! - Pardon? - &quot;Little Wing&quot; interpreted as a country song? &hellip; &quot;<i>It's alright</i>&quot; &hellip; And how! It really works! Just about the limit!</div>
+
+<div class="quote">Well for the current level it's: &quot;This is the end my friend&quot;. Concentration vanishes into thin air. &quot; &hellip; <i>it's alright</i> &hellip; &quot;. And replay. &hellip; And again.</div>
+
+<div class="quote">For the moment &quot;Procrustes&quot; was history - a story without an end.</div>
+
+<div class="quote">In the following weeks &quot;Procrustes&quot; cleverly gave a wide berth to me - but probably it was the other way round. Finally it was inevitable. So I went for the oustanding solution. BTW the playlist was set to 'random'. I started &quot;Procrustes&quot;, and accidentally the next song began: The first tunes of a lap steel guitar &hellip; D&eacute;j&agrave;-vu: I realized at once that it was together with this level that I had heard this idiosyncratic version of &quot;Little Wing&quot; for the first time. Coincidence only?</div>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200812_g.jpg" alt="Level of the Month" border="0">
+</div>
+
+<div class="quote">I couldn't solve &quot;Procrustes&quot; this time. But the next time it worked much better accompanied by the - now intentionally chosen - right song.</div>
+
+<div class="quote">Since then &quot;Procrustes&quot; and John Campbelljohns version of the Hendrix classic belong together for me - two is a company. It's not very often that I can delve into a level so deeply, to forget about the time, even to become lost in it. For me no meditation level has such a strong meditative aspect like &quot;Procrustes&quot;. Perhaps that's because I discover new combinations for the puzzle stone actions again and again. Mostly the real aim to open the oxyds gets secondary. Definitely I never played any level more often without succeeding, and nevertheless felt myself satisfied, well-balanced and &quot;<i>riding with the wind</i>&quot;.</div>
+
+<div class="author">dev0</div> 
+
+
+<h4>&quot;The simple combination of magic wand/puzzle stones/abyss can be much fun&quot;</h4>
+
+<div class="quote">Shortly after I had discovered and downloaded Enigma 1.00, I came across &quot;Procrustes&quot; for the first time. This meeting didn't take too long - it was obvious to me, that the puzzle stones had to be sorted to bridge the gap: But the first complex of stones is just much too large, and the second one's much too small! Either has the author done a sloppy job (which is quite unlikely), or an extensive puzzle is behind it. But I was on my way through the new level packs at a cracking pace, so I just pushed F5 and continued with &quot;Ariadne&quot; instead. Not much of it stuck in my mind but the name &quot;Procrustes&quot;, which made me think of some figure of greek mythology - the levels around that area all seemed to deal with mythical beings.</div>
+
+<div class="quote">What a big mistake! A few days later I opened Gustav Schwab's &quot;Gods and Heroes: Myths and Epics of Ancient Greece&quot; - and there he was: Procrustes, dislocator of limbs. &quot;Was his visitor of tall stature, he showed him to the small bed. 'Alas! this bed's too small for you, my friend, but the situation can be helped soon.' Scornful laughter filled the room. And he cut the limbs of his poor guest to the size of the bed.&quot; &hellip;</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_b.jpg" alt="Level of the Month" border="0">
+</div>
+
+<div class="quote">That was the key. With the following attempt to solve the level I realized how much fun the simple combination of magic wand/puzzle stones/abyss can be. In the second half of the level some slight mishaps happenened to me: during the transports occasionally I happened to shove one of the &quot;limbs&quot; against the wall. Usually that would mean to start all over again, not so with this landscape: Here an extra puzzle &aacute; la &quot;Push? Pull!&quot; is offered to the player. I can't remenber to have come across any level in Enigma with such generous error tolerance. Twenty minutes later all oxyds had been opened - and never a dull moment. A fantastic job of the level author.</div>
+
+<div class="quote">To all who played through &quot;Procrustes&quot; only once, and then checked it off: I warmly recommend to give it another try. What put me off at first was the time needed to solve the level. But then on my second attempt, being more experienced now, I managed to almost halve my record. The puzzle stones are arranged in a new way each time the level is started (thanks to the &quot;libpuzzle&quot;), so there's no definite way to solve the level - another peculiarity of this landscape. Each time new constellations can be discovered, which are waiting to be solved. And after all we're not handling living materials like our &quot;great&quot; example - so we're free to give way to our drive to play around and experiment. Probably there has been no other onescreener that kept me occupied for such a long time.</div>
+
+<div class="author">Dominik Leipold</div>
+
+
+<h4>The first time I saw &quot;Procrustes&quot; it looked pretty confusing to me.</h4>
+
+<div class="quote">Two big holes in the ground, two heaps of puzzle stones: They seemed to 
+match perfectly at first glance. And the fire, burning for eternity: 
+It's still one of Enigma's most peculiar elements to me, I really can't
+say why. I think it was because of the many new levels that had been 
+added to Enigma then, that I laid it aside for a few days without even 
+starting to play it once.</div>
+
+<div class="quote">Some time later I finally took up the level. I quickly found out that
+the heaps of puzzle stones indeed match perfectly with the holes - 
+although just mirrored and not like I had them in mind initially. After
+realizing that, I was even more confused than before, but somehow I 
+managed to make good use of the available magic and to fill both holes
+with the blue materials.</div>
+
+<div class="quote">At large it is another quite successful level by Andreas. The best in
+my opinion isn't the level itself, but the marvellous reference to the
+name. I knew it was part of the &quot;mythology-decade&quot; and the name somehow
+seemed familiar to me, but it took me a while to recall the thing with
+the beds, being either too small or too large. Congratulations to 
+Andreas for his fortunate production of the name-giving myth.</div>
+
+<div class="author">Lukas Sch&uuml;ller</div>
+
+
+<h4>&quot;The level impresses with its obvious logic and clarity&quot;</h4>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_n.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">The original</div>
+</div>
+
+<div class="quote">Monsters are not an invention in modern computer games, but they have 
+been frightening us since the dawn of mankind. We discover a considerable
+number of their ilk in Greek mythology. A particularly insidious monster
+was the giant Procrustes (= someone who dislocates limbs, his real name 
+was &quot;Damastes&quot;): Driven by pathological constraints for standardization, 
+he captured harmless passing hikers and in one of his two beds: He 
+stretched the short people to fit his long bed and shortened the 
+towering legs of the tall ones to fit his short bed, crudely laughing 
+while he chopped! Only Theseus succeeded in beating this baddie.</div> 
+
+<div class="quote">In this level we enter the rooms of Procrustes and become him. Two hikers 
+in the form of puzzle stones are already waiting for their adaptation. 
+In the first room, above left, we easily find that a few changes are 
+needed to adapt the hiker and push him to the left &quot;bed&quot;, surrounded by 
+flames. It is however a tight fit and it can happen that puzzle stones 
+unintentionally connect at undesirable points or perhaps go to the brink
+and then can be brought back into the game with hooks only (or F3).</div> 
+
+<div class="quote">When we have solved the first part of this level, a second hiker is 
+waiting in the lower right area. Here is an even tighter fit and only 
+a temporary relocation of parts can adjust this situation. Thankfully, 
+the author has given us an indispensable tool which is now available 
+and without which our marble would burst from the flames. A judicious
+short-term stint as a firefighter and the transport problems are solved.
+Thus, the first five Oxydstones are safely accessible. Hopefully, 
+however, the leftover stones of the first action are still available! 
+Finally, we will succeed, and we can pass the second path through the
+sea of flames to the remaining Oxydstones after a couple of walks. 
+Success!</div> 
+
+<div class="quote">The level impresses with its obvious logic and clarity. The task is 
+undoubtedly to solve and  no oppressive rotor disturbs our approach. 
+Only skill in dealing with the marble and a planned action to move 
+the puzzle stones is needed; for the experienced Enigma or Oxyd fan 
+certainly not an insurmountable problem. Proper using the aforementioned
+utensil is absolutely necessary. A small temptation to a shortcut is 
+also available. One might think that it will simplify the work to push
+a few stones from the puzzle box in the upper left hand room to the 
+subjacent room and speculate for a subsequent docking. Perhaps it is 
+worth the attempt, but perhaps not.</div> 
+
+<div class="quote">All in all a good fun level that requires planning.</div>
+
+<div class="author">Martin</div>
+
+
+<h4>&quot;Procrustes is far subtler than it first looks&quot;</h4>
+
+<div class="quote">Hmm, Procrustes, wasn't he that dude who cut and stretched people,
+so they'd fit in his beds? Wonder why it's called that? Well, it looks
+easy enough - neat but probably won't ever make level of the month.
+Just push these bits around with the wand - shove it in the gap and
+&hellip; ah &hellip; so <i>that's</i> why it's called &quot;Procrustes&quot; &hellip;</div>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200812_c.jpg" alt="Level of the Month" border="0">
+</div>
+
+<div class="quote">Those were just some of the thoughts which went through Tarim's head
+when he first played Procrustes (or would have been if Level of the
+Month had been invented then). Procrustes is far subtler than it first
+looks. Although it's easy to slip and trap a piece against a wall -
+it's often possible to use the wand to construct a shape to retrieve it.</div>
+
+<div class="quote">Tarim seems to have spent more time on it <i>after</i> he solved it with
+problems like: Can he pass any of the &quot;legs&quot; he cut off through the gap
+in the wall on the middle left? That way they could be ready and waiting
+when the bottom &quot;body&quot; gets pushed into &quot;bed&quot;. Or could he do it just
+using &quot;body parts&quot; without filling in <i>all</i> the gaps? There just 
+don't seem to be enough ends for the means. Will Tarim ever be Theseus
+and put an end to all that cutting and stretching?</div>
+
+<div class="author">Tarim</div>
+
+
+<h4>At the beginning, I thought I could do it very quickly</h4>
+
+<div class="quote">When I tried for the first time to play this level, I thought it was a very simple level. It did not take a long time to discover it was not true. It's a good level, and I liked it.</div>
+ 
+<div class="quote">The goal is not very complicated and it's a WYSIWYG level. Nothing is hidden, nothing is secret, you can see every part. First you must cross an abyss with fire around it by building a ledge with puzzle pieces. It's a good beginning and when you arrive on the other side, you must build a new ledge from even more pieces and with even less space available. Don't forget to extinguish the fire in the first room at well chosen places, if you want to bring the puzzle pieces into the second room.</div>
+
+<div class="quote">You must build the ledge very carefully, because there is not much space available. If you don't take care, you'll be blocked and you'll have to restart the level again. At the beginning, I thought I could do it very quickly &hellip; It was only a dream. I spent some days on it. Every time I started it, I told myself: It's the last time I try it, and every time, I did something wrong and I had to start again. This level requires thoughtful building, and you can be looking for the solution for a long time. Big brain work &hellip;</div>
+
+<div class="quote">&quot;Procustes&quot; is an easy and pleasant level to play. No actors are chasing after the marble, and speed doesn't matter. This level is mainly about moving puzzle pieces. But when this work is done well, then you'll be really happy.</div> 
+
+<div class="quote">I like this level, it's interesting, but a little bit too
+simple. Although I like it, it's not my preferred one among Andreas' levels.</div>
+
+<div class="author">Xang</div>
+
+
+<p>Andreas Lochmann leads us with this level of the month back into the days of classical antiquity to the son of Poseidon, into &hellip; 
+
+<h4>&quot;A play with fire&quot;</h4>
+
+<p>Player of Enigma, Procrustes invites you! He's heard of you, and presents you now well-chosen delicacies: Stained oxyds, bluish stones and blazing flames. He laughs: &quot;The fire will show you the way!&quot; You feel surrounded: The omnipresence of the conflagration - these oppressing puzzle-stones next to you, they're not at all convenient &hellip; Coincidence? Not at all! Combine them! Stretch them, squash them - before HE does the same to YOU. Find the courage to look down into the abyss, but be aware of the flames &hellip;</p>
+
+<p>The flames distract me - Help! I'm not a firebird at all! Procrustes laughs again, and instead of sweetish bird-of-paradise tunes triumphantly Shostakovich's 4th symphony sounds: &quot;My friend!&quot; he says mischievously, &quot;Look around and see who's in power here. Inspect the oxyds closely inside this gloomy room, you weak marbleous creature, afraid of me and the fire. But, yes: 'The fire can show you the way'&quot;&hellip;</p>
+
+<h4>&quot;A play with fire (episode 2)&quot;</h4>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_l.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">Oops &hellip;</div>
+</div>
+
+<p>I'm losing my fears, I'm becoming a &quot;poete de feu&quot;. A vision emerges: &quot;A bridge built from combined puzzle-stones, pushed across a sea of flames, lowered down into the depths of an abyss&quot;. And that'll be the way: &quot;Can you see the magic wand? Puzzle-stones down in the abyss? Combined in the right way a metamorphosis is happening - the combination of puzzle-stones - abracadabra - becomes passable. Conclude, consider the narrowness of the room, the uniqueness of the intermediate as well as of the final product (important!) - and after all, fear of the fire's deadly power has given way to hope, you're ready to become a custom tailor, making the product of puzzle-stones which will be &quot;the way&quot;. You've only got one chance - one small mistake and your prospects for the future are spoiled. Pay close attention to the right use of the wand: Abracadabra - and all you've built crumbles to the floor and turns to dust &hellip;</p>
+
+<h4>&quot;About squashing and stretching&quot;</h4>
+
+<p>Make right use of the magic wand! Something's out of place in this room &hellip; Become a master of the Stretching Arts: From the individual parts generate a total worthy of Procrustes. The sands of time are trickling through the hourglass of fate. If you've been successfull, then you'll know: &quot;The fire has shown you the way&quot;. You've managed to enchant the puzzle-stones: Procrustes has respect for you, my little Procrustes, Bird of Fire, Solver of Puzzles, Master of Balance: Exam passed.</p>
+
+<p>And once again you derived pleasure from one of Enigma's mythological inspired levels: Andreas, we'd like to see more of it! Where's Poseidon, the Father? And Theseus, the Executioner? Or Aphrodite, the Beauty? Zeus already can be found in our level packs, but that's another Enigma theme.</p>
+
+<h4>&quot;Everything seems to be so easy, but &hellip; &quot;</h4>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200812_h.jpg" alt="Level of the Month" border="0">
+</div>
+
+<p>This onescreener is ingenious in its simplicity. The small number of used elements and the clarity of the thematical presentation impresses. Everything's visible, even the solution for the puzzle with the puzzle-stones: &quot;The fire will show you the way&quot;. Shape from the puzzle-stones the element you need, the Gods of the Enigman Olympus have granted the player a magic wand for such purposes &hellip; Are we really in need of the extinguishers? When combining the puzzle-stones our motto is &quot;Compose the final 'movements' according to a 'suitable' key&quot;. How easily we miss something important. &quot;Oops, I didn't mean to &hellip; &quot;. Pay attention to the &quot;connections&quot; during the installation.</p>
+
+Talking about connections: 
+
+<p>Andreas, we're all looking forward to coming marbleous games of yours, and we thank you for the gift of this &quot;fiery&quot; challenge.</p>
+
+<div class="author">Mecke </div>
+
+
+<h4>Non multa, sed multum</h4>
+
+<div class="quote">This old latin proverb expresses in my mind quite well, what the author must have had in mind when creating his work. It's not a multitude of gaming objects which he offers to the player, but the basic idea of the game (shortening and lengthening) has been elaborated with so much care in such a profound way, that it will take the player much time and many efforts to solve the puzzle - and he'll be rewarded by getting much pleasure from doing so.</div>
+
+<div class="quote">But first of all my congratulations to Andreas for his first LotM award. He's written 12 excellent articles about excellent levels, and he's also not been completely uninvolved in the shaping of the last 6 ones, and now he's caught it: LotM. Serves you right, Andreas, if I may say so. ;-) &quot;Procrustes&quot; really is a level of excellent quality.</div>
+
+<div class="quote">In his commentary on &quot;Quadropolis&quot; in October of last year Andreas wrote, that he likes to present new objects of Enigma in his own levels. For &quot;Procrustes&quot; that may not be completely true, but as far as I know there's no other level in whole Enigma in which the blue puzzle stones must be used in such an original way to build bridges as in &quot;Procrustes&quot;, here put into effects by means of the eternal fire: That's truely new, and unique until now.</div>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200812_i.jpg" alt="Level of the Month" border="0">
+</div>
+
+<div class="quote">Who's not aware how cleverly thought-out the whole thing is, might want to take a look at the reference manual. In chapter 4.3.45 the various characteristics of the puzzle stones are described in great detail, and in chapter 4.6 the new fire system of Enigma 1.0 is explained at some length. &quot;Procrustes&quot; by the way is the only level of Andreas in which the blue puzzle stones appear - and he's been able to credit remarkable 46 1/4 levels to Enigma's account by now.</div>
+
+<div class="quote">The uniqueness of the bridge-building manoeuvre has been one of the reasons, that I frequently and with pleasure paid a visit to &quot;Procrustes&quot; during the last two years, the other reason's been the record given by the author: Although Andreas is not famous for travelling through the levels at Phaetonian speed, he's always been 7-6-5-4-3-2-1 minutes faster than me. In the course of time I managed to get closer and closer to his record, and I succeeded in inventing new ways of solving the puzzle each time, but still I was lightyears away from the presumably shortest possible time - Ronald's record.</div>
+
+<div class="quote">Well, actually that was the only thing I didn't like too much about the level: That I couldn't manage to find the shortest possible way to get the operation &quot;Procrustes&quot; done, and therefore the matter of fact that it wasn't me holding the world record. But I hope that I could better this fault somewhere in the near past. ;-) </div>
+
+<div class="quote">Many thanks to Moneymaker for the verbal pattern ;-) - and of course to Andreas for the fantastic level. :-) </div>
+
+<div class="author">Daydreamer</div>
+
+
+<h4>A mail from September 8th, 2006:</h4>
+
+<div class="quote">&quot;Hi,</div>
+
+<div class="quote">the next theme decade (pack VI, 31-40) shall
+have the theme &quot;mythology&quot;. Which emerges to
+be quite a Procrustean bed for levels.
+Which in turn raises the subject of this mail :-) </div>
+
+<div class="quote">[&hellip;]&quot;</div>
+
+<p>As some of you might have already noticed, there occasionally are theme based
+decades in Enigma. I like some of them in retrospect, like the nightmare decade or
+the black-and-white decade, some I like less (like the blue decade II/81-90).
+The decades were one of the goals of Raoul's and my sorting attempts for Enigma
+1.00. The last decade to belong to the original re-sort, was the ice decade at
+the end of pack V. However, after completing the re-sort lots of levels were
+added to Enigma prior to the actual release of 1.00, levels which became
+difficult to sort into new decades. Thus the final decade of 1.00, the
+mythology decade, which includes &quot;Procrustes&quot;, had to be planned through
+completely. With &quot;Sisyphus&quot; and &quot;Zeus&quot; only two levels existed as a basis for
+this theme. &quot;Troy&quot; was planned before construction of the decade as well, as an
+example level for chess stones (the theme &quot;troy&quot; resulted from the use of the
+chess stones, not vice versa), but I realized it only later. &quot;Phaeton&quot; was
+planted into the mythology decade afterwards as well.</p>
+
+<p>So it was time to write levels specifically to the theme &quot;mythology&quot;. For days,
+I cudgled my brains, combed through all possible mythologies of the ancient
+Greeks and Romans, searching for ideas for levels. &quot;Prometheus&quot; was among them
+&hellip; a level with fire and a marble bound by rubber bands? Quite a thin plan,
+but I kept it in my mind, just for the case, that one level would still be
+missing. However, &quot;Prometheus&quot; has never been realized. I particularly looked
+out for motives in mythology, which were easy to abstract. The god Janus
+provided such a motive, although I'm very dissatisfied with the final
+implementation of the &quot;Janus&quot; level.</p>
+
+<p>Most myths are connected with battles in one way or another, something which
+is rarely compatible with Enigma's philosophy and gameplay. Virtually the whole
+Heracles saga fell in disgrace due to this. Unlike Theseus - where I got hold
+of the Procrustean motive. This story of Procrustes is a seldom used and hence
+less washed-out motive: Shorten what's too long, lengthen what's too short, no
+matter what the cost. This was something that should be realizable with Enigma!</p>
+
+<p>Well, when something in Enigma was to be lengthend or shortened, then it has to
+comprise of multiple parts, like puzzle stones. And it has to be comparable to
+something, it has to fit into something&mdash;just like puzzle stones! This also
+offered a chance to check Raoul's new libpuzzle. And so, the idea was born
+(during a bath, by the way). An appropriate shape of the puzzle was quickly
+found, a shape that could not be cheated upon, and the coarse version of the
+level stood. In this first version the two &quot;beds&quot; still were of equal size, the
+level was build symmetrical. But a difficulty became apparent: The upper,
+extra-long puzzle was too difficult to maneuvre and the parts could not easily
+be stored - there simply wasn't enough space to do this. I once again studied
+the old story of Procrustes, and only during a more precise reading I noticed
+that the original beds were of different lengths as well. I bit the bullet (how
+wonderful are symmetric levels after all!) and broke the symmetry of the level,
+in addition I tilted the middle line a little bit into the current, sloped
+position.</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_m.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">One of the earlier versions</div>
+</div>
+
+<p>I wasn't that sure about the fire and the design in the beginning, unsure how
+to do it. The new fire system was still in development, so eternally burning
+fire wasn't at my disposal yet. On the other hand I'd loved to use green
+grass as floor, which was going to be burnable in the new fire system. So at
+first I resorted to the new &quot;it_death&quot;, skulls, that lie on the floor. They
+couldn't be destroyed by pushing puzzles over them, this was good. And instead
+of a deep black abyss there was water, which fit well to the grass. But how
+should the player push the remaining puzzle stones to the other side? A switch
+to remove the it_deaths? Inelegant. So, fire and an extinguisher after all. But
+with which design, when water would evaporate and grass would start to burn?</p>
+
+<p>Initially, I wanted to use grass to illustrate the area, in which Procrustes
+lived. I searched for a solution for a relatively long time, but after all I
+came back to the &quot;emergency plan sand&quot;. Later I once more thought about this
+decision, as Siegfried Fennig reported to us that the type of stones that has
+been used in &quot;Procrustes&quot; among others, was in another hue than the original
+stone. As the original didn't fit as well to sand, I considered to fully
+redo the design of &quot;Procrustes&quot; once more. But as I realized that there were
+other levels as well which suffered from the change to the original hue, we
+decided to include both hues of the stone in Enigma. Just another aspect in
+which &quot;Procrustes&quot; became a proving ground, like with the fire system, it_death
+and libpuzzle.</p>
+
+<p>Procrustes gave lots of pleasure to me - as part of the mythology decade, as
+a level with relatively simple concept and still high popularity, and that I
+was able to hold the world record for this level for a long time by myself, as
+I learned some tricks how to handle the puzzle stones while test-playing the
+level. And today it once again gives pleasure to me, because it has been
+awarded as first of my levels to become Level of the Month - many thanks to all
+players out there, I hope, you had the same fun playing as I had writing!</p>
+
+<div class="author">Andreas Lochmann</div>
+
+<p>
+Season's Greeting, and IV/2,<br>
+<i>Your Enigma Team!</i>
+</p>
+
+<p>Dear reader, we have a constant need for articles from you about Enigma's
+great levels. Please, send us any articles, even comments, you write to:</p>
+<pre>
+<a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
+</pre>
+<p>We're particularly interested in articles about the following levels:
+</p>
+<ul>
+<li>&quot;Plan Ahead&quot; by Jacob Scott</li>
+<li>&quot;Little Puzzles&quot; by Jon 'WB' Sneyers</li>
+</ul>
+<p>Many thanks in advance, only your help can keep the LotM alive!</p>
+
+<p><i>Your Enigma Team</i></p>
+
+</div>

Modified: homepage/input/lotm/lotm_archive_data.lua
===================================================================
--- homepage/input/lotm/lotm_archive_data.lua	2008-12-22 22:37:58 UTC (rev 1408)
+++ homepage/input/lotm/lotm_archive_data.lua	2008-12-24 00:29:13 UTC (rev 1409)
@@ -166,6 +166,15 @@
   position_num   = "6098"
 }
 
+lotm_archive_data[19] = {
+  date           = { month = 12, year = 2008 },
+  chronological  = 19,
+  name           = "Procrustes",
+  author         = "Andreas Lochmann",
+  position       = "VI/36",
+  position_num   = "6036"
+}
+
 -- Further levels standing data
 -- (no need to change these)
 
@@ -264,28 +273,29 @@
 -- LotM variable data
 -- format: Level Title, current_rating, current_votes, additional text
 
-lotm_rating(    "Island Labyrinth",  9.29,  14,  "")
-lotm_rating(  "Pneumatic Delivery",  8.22,  18,  "(1 up)")
+lotm_rating(    "Island Labyrinth",  9.29,  14,  "(1 down)")
+lotm_rating(  "Pneumatic Delivery",  8.22,  18,  "")
 lotm_rating(    "The Aztec Temple",  9.08,  13,  "")
-lotm_rating("Labyrinth of Puzzles",  8.78,  18,  "(1 up)")
-lotm_rating(           "Elaborate",  8.62,  13,  "(1 up)")
-lotm_rating(             "Houdini",  9.24,   9,  "")
-lotm_rating(           "Tool Time",  8.21,  24,  "(1 down)")
+lotm_rating("Labyrinth of Puzzles",  8.78,  18,  "")
+lotm_rating(           "Elaborate",  8.62,  13,  "")
+lotm_rating(             "Houdini",  9.36,  11,  "(2 up)")
+lotm_rating(           "Tool Time",  8.21,  24,  "")
 lotm_rating(         "Quadropolis",  9.17,  12,  "")
-lotm_rating(      "Big Adventures",  8.40,  25,  "(1 up)")
-lotm_rating(      "Temple of Gold",  9.30,  10,  "")
-lotm_rating(      "Puzzle Puzzles",  8.56,   9,  "(1 up)")
+lotm_rating(      "Big Adventures",  8.40,  25,  "(1 down)")
+lotm_rating(      "Temple of Gold",  9.30,  10,  "(1 down)")
+lotm_rating(      "Puzzle Puzzles",  8.56,   9,  "")
 lotm_rating(      "Psycho Pushing",  8.17,  12,  "")
-lotm_rating(  "Turnstiles for Two",  8.29,   7,  "(7 down)")
-lotm_rating(     "Pleasure Garden",  8.38,  16,  "(1 up)")
+lotm_rating(  "Turnstiles for Two",  8.29,   7,  "")
+lotm_rating(     "Pleasure Garden",  8.38,  16,  "")
 lotm_rating(      "Block its way!",  8.00,  19,  "")
-lotm_rating(   "Gods of Enigma II",  8.39,  18,  "(1 up)")
-lotm_rating( "River of Challenges",  8.36,  11,  "(1 up)")
-lotm_rating(  "Industrial Puzzles",  8.55,  11,  "<b>(newcomer)</b>")
+lotm_rating(   "Gods of Enigma II",  8.42,  19,  "(1 up)")
+lotm_rating( "River of Challenges",  8.36,  11,  "")
+lotm_rating(  "Industrial Puzzles",  8.55,  11,  "")
+lotm_rating(          "Procrustes",  7.75,  16,  "<b>(newcomer)</b>")
 
 -- Don't forget to adjust the archive dates:
 
-lotm_archive_data_from = { month = 9, year = 2008 }
+lotm_archive_data_from = { month = 10, year = 2008 }
 
 lotm_current = lotm_archive_data[table.getn(lotm_archive_data)]
 



From andreasl at mail.berlios.de  Wed Dec 24 02:03:53 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Wed, 24 Dec 2008 02:03:53 +0100
Subject: [Enigma-game-svn] r1410 - homepage/input/lotm
Message-ID: <200812240103.mBO13rx4028860@sheep.berlios.de>

Author: andreasl
Date: 2008-12-24 02:03:50 +0100 (Wed, 24 Dec 2008)
New Revision: 1410

Added:
   homepage/input/lotm/lotm_200812_de.html
Modified:
   homepage/input/lotm/lotm_200707_ru.html
   homepage/input/lotm/lotm_200708_ru.html
   homepage/input/lotm/lotm_200812.html
Log:
Homepage:
 - German translation of LotM 12/2008
 - Correct bug in English version:
     Records are from November, not September.
 - Validation (including two older articles)
Todo:
 - Russian translation
 - Upload



Modified: homepage/input/lotm/lotm_200707_ru.html
===================================================================
--- homepage/input/lotm/lotm_200707_ru.html	2008-12-24 00:29:13 UTC (rev 1409)
+++ homepage/input/lotm/lotm_200707_ru.html	2008-12-24 01:03:50 UTC (rev 1410)
@@ -161,18 +161,18 @@
 
   <p>? ?? ??? ??? ?? ???? ????????, ??? Duffy ?????? ????? 150 ???????. ??? ????? ??????? ??????
     ???????. ??? ?????? ?????????? ???? ?? ???????? ?????????? ???????, ??????? ??? ????????
-    ??????.<br/>
-    <br/>
-    ?????, ???????? ????? &hellip;<br/>
-    <br/>
+    ??????.<br>
+    <br>
+    ?????, ???????? ????? &hellip;<br>
+    <br>
     &hellip; ????, ? ????????, ?? ????? ???? ????????, ?????????? ??????? ??? ????? ?????? ???????????????? ???????
-    ? ????????? ????<br/>
-    &hellip; Duffy ?????? ???? ??????! ?????? ??? ???????? ???????!<br/>
-    &hellip; ? ???? ?? ????? ????????! :-)<br/>
-    <br/>
+    ? ????????? ????<br>
+    &hellip; Duffy ?????? ???? ??????! ?????? ??? ???????? ???????!<br>
+    &hellip; ? ???? ?? ????? ????????! :-)<br>
+    <br>
     ????? ?????????? ? ??????!</p>
 
-  <p>? ?????????,<br/>
+  <p>? ?????????,<br>
   <i>Joe ? Harry</i></p>
 
 </div>

Modified: homepage/input/lotm/lotm_200708_ru.html
===================================================================
--- homepage/input/lotm/lotm_200708_ru.html	2008-12-24 00:29:13 UTC (rev 1409)
+++ homepage/input/lotm/lotm_200708_ru.html	2008-12-24 01:03:50 UTC (rev 1410)
@@ -230,7 +230,7 @@
   ????????? ? ??????? ??????? ? ????????????? ???????? ??????????. Ronald, ??????? ???? ??????? ??
   ?????????? ?????? ??? ??????? ??????????!</p>
 
-  <p>? ?????????,<br/>
+  <p>? ?????????,<br>
   <i>Andreas ? Harry</i></p>
 
 </div>

Modified: homepage/input/lotm/lotm_200812.html
===================================================================
--- homepage/input/lotm/lotm_200812.html	2008-12-24 00:29:13 UTC (rev 1409)
+++ homepage/input/lotm/lotm_200812.html	2008-12-24 01:03:50 UTC (rev 1410)
@@ -65,7 +65,7 @@
 </div>
 
 <table cellpadding="0" cellspacing="1" class="statistics">
-<caption class="normalcaption">Some records of September 2008</caption>
+<caption class="normalcaption">Some records of November 2008</caption>
 <colgroup>
     <col width="80">
     <col width="160">

Added: homepage/input/lotm/lotm_200812_de.html
===================================================================
--- homepage/input/lotm/lotm_200812_de.html	2008-12-24 00:29:13 UTC (rev 1409)
+++ homepage/input/lotm/lotm_200812_de.html	2008-12-24 01:03:50 UTC (rev 1410)
@@ -0,0 +1,521 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">Dezember 2008: </span>
+    &quot;Procrustes&quot; von Andreas Lochmann
+  </h3>
+
+<p>
+In den letzten beiden Jahren hatten wir an dieser Stelle bereits das
+Vergn&uuml;gen, ausf&uuml;hrlich &uuml;ber 10 epische Levels zu
+berichten, die sich dadurch auszeichneten, den Forschergeist und die
+Abenteuerlust im Spieler anzusprechen. Diese phantastischen Multi-Screen
+Welten erfreuen sich allergr&ouml;&szlig;ter Beliebtheit bei den
+Spielern, wie ein Blick ins LdM-Archiv zeigt. Ebenso war es uns
+verg&ouml;nnt, 6 herausragende Zwei-, Drei- oder Vier-Screen Level
+vorzustellen. Vor zwei Monaten konnten wir dann endlich unseren
+ersten Level im klassischen One-Screen Format pr&auml;sentieren:
+&quot;Industrial Puzzles&quot; von Raoul Bourquin. Und nun wartet
+bereits der zweite Vertreter dieser Levelspezies darauf, die LdM
+B&uuml;hne betreten zu d&uuml;rfen und seinen Preis in Empfang zu
+nehmen. Obwohl von der gleichen Art k&ouml;nnten die beiden Level kaum
+unterschiedlicher sein. &quot;Industrial Puzzles&quot; ist reichlich mit
+den verschiedensten Objekten ausgestattet (fast ist man geneigt
+&quot;&uuml;berfrachtet&quot; zu sagen), die Enge des Raumes ist schon
+fast beklemmend, M&ouml;glichkeiten das Falsche zu tun sind ebenfalls
+reichlich vorhanden - die meisten Spieler werden sich zu Beginn in
+einem Zustand der Verwirrung wiederfinden.
+</p>
+
+<p>
+Ganz anders bei unserem aktuellen LdM: Das Geb&auml;ude vermittelt den
+Eindruck weitr&auml;umig entworfen worden zu sein, dem Spieler wird nur
+eine Art von Spielobjekt angeboten, alles ist sichtbar und
+&uuml;bersichtlich gestaltet - und doch irgendwie verwirrend. Die blauen
+Puzzlesteine, die bei &quot;Industrial Puzzles&quot; lediglich in der
+Rolle von Designelementen in den Ecken des Raumes auftraten, spielen
+jetzt die Hauptrolle. Anstatt in einer Industrieanlage der Moderne
+finden wir uns diesmal in der griechischen Antike wieder, als G&auml;ste
+eines ber&uuml;hmt-ber&uuml;chtigten Hotelbetreibers: &quot;Welcome to
+the hotel 'Procrustes' - such a lovely place&quot;. Unser Gastgeber hat
+freundlicherweise schon mal das Feuer in den G&auml;stezimmern
+angemacht: Was doch sehr angenehm ist zu Beginn der kalten Jahreszeit.
+Die W&auml;rme der munter flackernden Flammen geben einem rasch ein
+Gef&uuml;hl von Zuhause - &quot;Such a lovely place&quot;. Nur die
+Lichter der Festtagsbeleuchtung sind noch dunkel: Wie immer ist es
+unsere Aufgabe die Oxydlampen zu entz&uuml;nden.
+</p>
+
+<p>
+Im Levelpack VI von Enigma 1.00 gibt es eine Dekade von Leveln, die sich
+alle mit dem Thema &quot;Mythen und Legenden der klassischen
+Antike&quot; besch&auml;ftigen. Der herausragende unter diesen Leveln
+war und ist #36, unser Level des Monats Dezember:
+&quot;Procrustes&quot;. Diesmal wird es keinen richtigen Artikel oder
+eine Erz&auml;hlung wie die letzten Male geben, sondern wir freuen uns,
+mal etwas anderes pr&auml;sentieren zu d&uuml;rfen: Eine Dekade von
+Kommentaren. 10 Beitr&auml;ge, so viele gab' es in der mittlerweile
+19-teiligen Geschichte von LdM noch nie. Andreas wird in aller
+Ausf&uuml;hrlichkeit von der Entstehungsgeschichte seines Meisterwerkes
+berichten, und Mecke, der Autor der neuen Homepage-Kolumne &quot;Der
+Neuling&quot; hat einen lyrischen Essay verfasst. Zusammen mit den
+anderen acht Beitr&auml;gen erwartet den Leser eine interessante
+Text-Collage verschiedener Gedanken und Ideen, auf unterschiedlicher
+stilistischer Form dargeboten, zu einem gemeinsamen Thema:
+&quot;Procrustes&quot;. Viel Vergn&uuml;gen beim Lesen.
+</p>
+
+<p>
+Aber bevor es los geht, wollen wir zun&auml;chst noch einen Blick
+ins &quot;G&auml;stebuch&quot; des Hotels &quot;Procrustes&quot; werfen:
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_e.jpg" alt="Level des Monats" border="0">
+<div class="imagetitle">Enigma VI # 36</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Einige Rekorde vom November 2008</caption>
+<colgroup>
+    <col width="80">
+    <col width="160">
+</colgroup>
+    <tr><td class="num">4:18</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">5:42</td>
+        <td class="left">Django</td></tr>
+    <tr><td class="num">6:33</td>
+        <td class="left">Andreas</td></tr>
+    <tr><td class="num">7:50</td>
+        <td class="left">dev0</td></tr>
+    <tr><td class="num">7:57</td>
+        <td class="left">serpent</td></tr>
+    <tr><td class="num">8:26</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">8:53</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">9:37</td>
+        <td class="left">Mark P.</td></tr>
+    <tr><td class="num">10:09</td>
+        <td class="left">Johannes</td></tr>
+    <tr><td class="num">11:09</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">11:21</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">11:58</td>
+        <td class="left">dpl</td></tr>
+    <tr><td class="num">12:19</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">12:21</td>
+        <td class="left">JuSt</td></tr>
+    <tr><td class="num">12:28</td>
+        <td class="left">Safalra</td></tr>
+    <tr><td class="num">13:05</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">13:58</td>
+        <td class="left">redsantz</td></tr>
+    <tr><td class="num">14:02</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">14:26</td>
+        <td class="left">Daisy</td></tr>
+    <tr><td class="num">15:14</td>
+        <td class="left">shoki</td></tr>
+    <tr><td class="num">15:22</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">15:34</td>
+        <td class="left">Malla</td></tr>
+    <tr><td class="num">16:58</td>
+        <td class="left">Melanie</td></tr>
+    <tr><td class="num">18:16</td>
+        <td class="left">mecke</td></tr>
+    <tr><td class="num">19:55</td>
+        <td class="left">ABS</td></tr>
+    <tr><td class="num">20:14</td>
+        <td class="left">NorthForty</td></tr>
+    <tr><td class="num">22:16</td>
+        <td class="left">Duffy</td></tr>
+    <tr><td class="num">25:08</td>
+        <td class="left">Alex</td></tr>
+    <tr><td class="num">25:29</td>
+        <td class="left">alfred69</td></tr>
+    <tr><td class="num">26:43</td>
+        <td class="left">Sim_Ed</td></tr>
+    <tr><td class="num">27:55</td>
+        <td class="left">IntKecsk</td></tr>
+    <tr><td class="num">29:30</td>
+        <td class="left">Tarim</td></tr>
+    <tr><td class="num">32:06</td>
+        <td class="left">HuB34</td></tr>
+    <tr><td class="num">32:38</td>
+        <td class="left">biotopa</td></tr>
+    <tr><td class="num">33:18</td>
+        <td class="left">para_doks</td></tr>
+    <tr><td class="num">34:47</td>
+        <td class="left">Andy</td></tr>
+    <tr><td class="num">45:47</td>
+        <td class="left">Freshman</td></tr>
+    <tr><td class="num">45:53</td>
+        <td class="left">WP319</td></tr>
+    <tr><td class="num">47:17</td>
+        <td class="left">Valkyrie2</td></tr>
+    <tr><td class="num">142:21</td>
+        <td class="left">brynn</td></tr>
+</table>
+
+<h4>&quot;Am meisten sch&auml;tze ich an &quot;Procrustes&quot;, dass es Enigma in Reinkultur ist!&quot;</h4>
+
+<div class="quote">Es ist mir eine Ehre gefragt worden zu sein, einen Kommentar &uuml;ber &quot;Procrustes&quot; (VI #36) f&uuml;r das LdM 
+im Dezember 2008 zu verfassen. Doch zuerst m&ouml;chte ich Andreas Lochmann dazu gratulieren, f&uuml;r seine Kreation diese 
+prestigetr&auml;chtige Auszeichnung erhalten zu haben.</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_k.jpg" alt="Level des Monats" border="0">
+</div>
+
+<div class="quote">Als jemand, der oft mit seinen 'Mausf&auml;higkeiten' hadert und nicht auf Weltrekorde aus ist, sch&auml;tze ich, dass Zeit 
+keine Rolle spielt und kein &uuml;bergro&szlig;es Ma&szlig; an Geschicklichkeit im Umgang mit der Maus n&ouml;tig ist. 
+In vielen Level breitet sich das Feuer weiter und immer weiter aus. Aber bei &quot;Procrustes&quot; ist es einfach ein 
+unbewegliches Hindernis.</div>
+
+<div class="quote">Gefordert ist akribisches Man&ouml;verieren um Steine herum und strategische Vorausplanung; eben Enigma-typische 
+Markenzeichen, die zweifelsfrei f&uuml;r die hohe Bewertung ausschlaggebend sind. Mir pers&ouml;nlich gef&auml;llt an diesem 
+Level der symmetrische Aspekt und die Problemstellung.</div>
+
+<div class="quote">Was sch&auml;tze ich an &quot;Procrustes&quot; am meisten? Es ist Enigma in Reinkultur; zur L&ouml;sung ist kein spezielles 
+Extrawissen von N&ouml;ten. Alles, was man braucht, ist vorhanden, in einem Raum. Obwohl, wie in vielen anderen Leveln auch, 
+die L&ouml;sung augenscheinlich ist, bedeutet das nicht notwendigerweise, dass einem diese schnell oder einfach von der Hand 
+geht!</div>
+
+<div class="quote">Bisher dachte ich, dass der Name des Levels irgendetwas mit Feuer zu tun hat; so in der Art, dass etwas durch Verbrennen eine 
+'Kruste' erh&auml;lt, LOL! Ich sah schlichtweg die innewohnende anthropomorphe Symbolik nicht und l&ouml;ste die Puzzles 
+gem&auml;&szlig; der vorliegenden Gegebenheiten. Als ich mich f&uuml;r meinen Kommentar mit dem Level wieder vertraut machte, 
+schlug ich &quot;Procrustes&quot; nach. Es ist wahrlich geschickt (klasse?) wie perfekt Andreas Lochmann die Symbolik des 
+mythologischen Charakters in seinem Level umgesetzt hat &mdash; sehr, sehr clever!</div>
+
+<div class="quote">Zwar ist das Level nicht so komplex und schwierig wie die meisten anderen LdM, trotzdem erf&uuml;llt es m.E. in jeder Hinsicht
+die archetypischen Charakteristika eines LdM.</div>
+
+<div class="author">Brynn</div> 
+
+
+<h4>&quot;Keine der Meditationen besitzt f&uuml;r mich einen so starken meditativen Aspekt wie &quot;Procrustes&quot;&quot;</h4>
+
+<div class="quote">Zwei oder drei Stunden nach Mitternacht. Aus den Kopfh&ouml;rern kommen die ersten T&ouml;ne einer Lap 
+Steel Guitar - ein langsamer Countrysong ... Irgendwie bekannt ... &quot;<i>Well she's walking 
+through the clouds with a circus smile that's running round</i> ... &quot; - &Auml;h! - Wie bitte? - 
+&quot;Little Wing&quot; interpretiert als Countrysong? ...  &quot;<i>It's alright</i>&quot; ...  
+Und wie! Das funktioniert tats&auml;chlich! Der Hammer!</div>
+
+<div class="quote">Tja, das war das Aus f&uuml;r das aktuelle Level. Die Konzentration war wie weggeblasen ... 
+&quot;<i>It's alright</i>&quot; ... Und Replay ... Und nochmal.</div>
+
+<div class="quote">&quot;Procrustes&quot; war erstmal Geschichte - eine ohne Ende.</div>
+
+<div class="quote">In den n&auml;chsten Wochen ging mir &quot;Procrustes&quot; geschickt aus dem Weg; aber wahrscheinlich 
+wares eher anders herum. Letztendlich f&uuml;hrte aber dann kein Weg mehr daran vorbei. Also machte 
+ich mich an die ausstehende L&ouml;sung. Die Playlist war auf 'random' gestellt. Ich startete 
+&quot;Procrustes&quot;, rein zuf&auml;llig begann auch der n&auml;chste Song: Die ersten T&ouml;ne 
+einer Lap Steel Guitar erklangen ... Schlagartig erinnerte ich mich, dass es dieses Level war, als 
+ich &quot;Little Wing&quot; in dieser eigenwilligen Interpretation das erste Mal h&ouml;rte. Nur 
+Zufall?</div>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200812_g.jpg" alt="Level des Monats" border="0">
+</div>
+
+<div class="quote">Gel&ouml;st habe ich &quot;Procrustes&quot; dann zwar nicht. Aber beim n&auml;chsten Mal klappte es 
+besser, mit der - nun bewusst ausgew&auml;hlten - passenden musikalischen Begleitung.</div> 
+
+<div class="quote">Seither geh&ouml;rt zu &quot;Procrustes&quot; John Campbelljohns Version dieses Hendrix Klassikers. 
+Selten kann ich mich in ein Level so vertiefen, die Zeit vergessen, ja darin sogar verlieren. Keine 
+der Meditationen besitzt f&uuml;r mich einen so starken meditativen Aspekt wie &quot;Procrustes&quot;. 
+Vielleicht liegt es auch daran, dass ich immer wieder neue Kombinationen f&uuml;r die Puzzlestein-Aktionen 
+entdecke. Nur zu oft r&uuml;ckt das eigentliche Ziel, alle Oxyds zu &ouml;ffnen, in den Hintergrund. 
+Mit Sicherheit habe ich keinen Level so oft gespielt, ohne es erfolgreich zu beenden, und dabei trotzdem 
+Genugtuung und Ausgeglichenheit empfunden.</div>
+
+<div class="author">dev0</div>
+
+
+<h4>&quot;Auch eine eigentlich simple Kombination wie Zauberstab/Puzzlesteine/Abgrund kann ziemlich viel Spa&szlig; machen&quot;</h4>
+
+<div class="quote">Kurz nachdem ich Enigma 1.00 entdeckt und heruntergeladen hatte, bin ich zum ersten Mal &quot;Prokrustes&quot; begegnet. Dieses Treffen w&auml;hrte nicht besonders lang - dass die Puzzlesteine sortiert werden m&uuml;ssen, um den Abgrund aufzuf&uuml;llen, war mir schon irgendwie klar, aber der erste Komplex ist ja viel zu gro&szlig;, der zweite viel zu klein geraten! Entweder ist das Ganze schlampig programmiert worden (was eher unwahrscheinlich ist) oder es versteckt sich ein umfangreicheres R&auml;tsel dahinter. Da ich jedoch nur beim ersten Gewaltmarsch durch die neuen Levels war, dr&uuml;ckte ich einfach meine F5-Taste und machte bei &quot;Ariadne&quot; weiter. H&auml;ngengeblieben ist bei mir damals nur der Name &quot;Prokrustes&quot;, der mich an irgendeine Gestalt aus der griechischen Mythologie denken lie&szlig;; die Levels in dieser Gegend schienen sich ohnehin mit sagenhaften Wesen zu besch&auml;ftigen.</div>
+
+<div class="quote">Was f&uuml;r ein gro&szlig;er Fehler! Einige Tage sp&auml;ter schlug ich wieder einmal Gustav Schwabs &quot;Sagen des klassischen Altertums&quot; auf - und da war er: Prokrustes, der Gliederausrenker. &quot;War sein Gast von hohem K&ouml;rperwuchs, so zeigte er ihm das kurze Bett. 'Leider ist die Lagerstatt f&uuml;r dich zu klein, lieber Gastfreund', sagte er mit Hohn; 'aber ich werde schnell Abhilfe schaffen!' Und er hieb dem Ungl&uuml;cklichen die Beine ab, soweit sie &uuml;ber das Bett hinausragten.&quot;</div> 
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_b.jpg" alt="Level des Monats" border="0">
+</div>
+
+<div class="quote">Das war der Schl&uuml;ssel. Bei meinem anschlie&szlig;enden L&ouml;sungsversuch sah ich, wie viel Spa&szlig; die simple Kombination Zauberstab/Puzzlesteine/Abgrund eigentlich machen kann. In der zweiten H&auml;lfte des Levels passierten mir dann einige Missgeschicke, indem ich beim Transport der &quot;Glieder&quot; mehrfach Steine versehentlich an die Wand schubste. Normalerweise bedeutet das einen Neustart, in dieser Landschaft meist jedoch nur ein zus&auml;tzliches R&auml;tsel &aacute; la &quot;Push? Pull!&quot;. Eine solche &quot;Fehlertoleranz&quot; war mir in Enigma bisher nirgends aufgefallen. Nach &uuml;ber 20 Minuten waren schlie&szlig;lich alle Oxydsteine ge&ouml;ffnet - ohne dass das Ganze eine Sekunde langweilig gewesen w&auml;re! Eine gro&szlig;artige Leistung eines Levelautors.</div>
+
+<div class="quote">Wer &quot;Prokrustes&quot; bisher nur einmal gel&ouml;st und dann &quot;abgehakt&quot; hat, dem sei eine Wiederholung w&auml;rmstens empfohlen. Mich selbst hat davor die ben&ouml;tigte Zeit abgeschreckt. Beim zweiten Mal war ich allerdings schon wesentlich routinierter, sodass ich meine Bestleistung fast halbieren konnte. Da die Puzzlesteine zu Beginn stets verschieden angeordnet sind (der &quot;libpuzzle&quot; sei Dank), gibt es keinen eindeutigen L&ouml;sungsweg - eine weitere Besonderheit der Landschaft. Immer wieder entdeckt man neue Konstellationen, die es aufzul&ouml;sen gilt. Und nachdem man ja nicht wie das &quot;gro&szlig;e&quot; Vorbild mit lebendem Material hantiert, kann man dem Spiel- und Experimentiertrieb freien Lauf lassen. Wahrscheinlich hat mich bisher kein Onescreener so lange besch&auml;ftigt wie &quot;Prokrustes&quot;.</div>
+
+<div class="author">Dominik Leipold</div>
+
+<h4>Das erste Mal, als ich &quot;Procrustes&quot; sah, fand ich es ziemlich verwirrend</h4>
+
+<div class="quote">Zwei gro&szlig;e L&ouml;cher im Boden. Zwei Puzzlesteinhaufen, die scheinbar perfekt hineinpassen. Und das ewig brennende Feuer, dass ich immer noch als eines der seltsamsten Enigma-Elemente &uuml;berhaupt ansehe; ich kann mir auch nicht wirklich erkl&auml;ren, warum. Ich glaube, da zu dieser Zeit einige neue Levels dazugekommen waren, hab ich es erstmal f&uuml;r ein paar Tage zur Seite gelegt, ohne dass ich auch nur angefangen hatte, es zu spielen.</div>
+
+<div class="quote">Irgendwann stellte ich mich dem Level dann doch. Ich stellte schnell fest, dass die Puzzlehaufen tats&auml;chlich perfekt passten, allerdings nur gespiegelt und nicht in die L&ouml;cher, f&uuml;r die ich sie anfangs vorgesehen hatte. Danach war ich noch verwirrter als zuvor, irgendwie hab ich es dann aber doch geschafft, die mir gegebene Magie richtig zu nutzen, und beide Erdl&ouml;cher zu f&uuml;llen.</div>
+
+<div class="quote">Im Gro&szlig;en und Ganzen gesehen ein weiteres sehr gelungenes Puzzle-Level von Andreas. Das Beste ist meiner Meinung nach aber nicht das Level selbst, sondern der wunderbare Bezug zum Namen. Ich wusste, dass es Teil der &quot;Mythologie-Dekade&quot; war, und der Name kam mir auch bekannt vor, aber ich brauchte eine Weile (und die Hilfe von Wikipedia) um mich an die zu kleinen beziehungsweise zu gro&szlig;en Betten zu erinnern. Herzlichen Gl&uuml;ckwunsch zu der sehr gelungenen Umsetzung des namengebenden Mythos!</div>
+
+<div class="author">Lukas Sch&uuml;ller</div>
+
+<h4>&quot;Der Level besticht durch seine offensichtliche Logik und Klarheit.&quot;</h4>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_n.jpg" alt="Level des Monats" border="0">
+<div class="imagetitle">The original</div>
+</div>
+
+<div class="quote">Monster sind keine Erfindung moderner Computerspiele, sondern sie treiben ihr Unwesen seit die Menschheit existiert. Eine beachtliche Anzahl dieser Spezies finden wir in der griechischen Mythologie. Ein besonders heimt&uuml;ckischer Unhold war Prokrustes (= Gliederausrenker, sein richtiger Name war &quot;Damastes&quot;): ein Riese, der - von krankhaften Normungszw&auml;ngen getrieben - harmlosen, vorbeiziehenden Wanderern auflauerte und sie in seinen beiden Betten zu liegen zwang: die k&ouml;rperlich Kleinen zwang er in ein zu gro&szlig;es Bett und zog sie in die L&auml;nge, um sie anzupassen, die Gro&szlig;en mussten in ein zu kleines Bett, die herausragenden Beine wurden einfach unter rohem Gel&auml;chter abgehackt. Erst Theseus gelang es, dem B&ouml;sewicht das &uuml;ble Handwerk zu legen.</div>
+
+<div class="quote">Wir betreten in diesem Level die Gem&auml;cher des Prokrustes und versetzen uns in die Rolle des B&ouml;sewichts. Zwei Wanderer in Form von Puzzlesteinen warten bereits auf ihre Anpassung. Im ersten Raum links oben stellen wir leicht fest, dass an der Form des Wanderers noch einige &Auml;nderungen n&ouml;tig sind, um sie an das linke von Flammen umgebene &quot;Bett&quot; anzupassen und dort hinein zu schieben. Es geht allerdings recht eng zu und es kann bei Unachtsamkeit geschehen, dass Puzzlesteine an unerw&uuml;nschten Stellen andocken oder wom&ouml;glich an den Rand gelangen und von dort nur mit Haken (oder F3) wieder ins Spiel zu bringen sind.</div>
+
+<div class="quote">Wenn wir diesen ersten Teil des Levels gel&ouml;st haben, wartet bereits der zweite Wanderer im Raum unten rechts. Hier wird aber die Enge richtig zur Beklemmung und nur eine vor&uuml;bergehende Verlagerung von Teilen bereinigt diese Situation. Dankenswerterweise hat uns der Autor ein unverzichtbares Utensil zur Verf&uuml;gung gestellt, ohne das unsere Murmel von den Flammen zum Zerspringen gebracht werden w&uuml;rde. Ein wohl&uuml;berlegter kurzzeitiger Einsatz als Feuerwehrmann und die Transportprobleme sind beseitigt.</div>
+
+<div class="quote">Damit sind auch die ersten f&uuml;nf Oxydsteine gefahrlos zug&auml;nglich. Hoffentlich sind aber die von der ersten Aktion &uuml;briggebliebenen Puzzlesteine noch transportf&auml;hig! Schlie&szlig;lich m&uuml;sste es uns wohl gelingen, uns auch den zweiten Weg durch das Flammenmeer zu bahnen und die restlichen Oxydsteine nach ein paar Spazierg&auml;ngen zu &ouml;ffnen. Geschafft!</div>
+
+<div class="quote">Der Level besticht durch seine offensichtliche Logik und Klarheit. Die Aufgabe steht zweifelsfrei fest, kein bedr&auml;ngender Rotor st&ouml;rt unser Vorgehen. Einzig Geschicklichkeit im Umgang mit der Murmel und planm&auml;&szlig;iges Verschieben der Puzzlesteine ist n&ouml;tig: f&uuml;r den ge&uuml;bten Enigmaner oder Oxydisten sicher kein unl&ouml;sbares Problem. Die sachgerechte Verwendung des erw&auml;hnten Utensils ist absolut notwendig.</div>
+
+<div class="quote">Eine kleine Versuchung zu einem Shortcut ist auch vorhanden. Man k&ouml;nnte meinen, sich die Arbeit zu vereinfachen, indem man ein paar Puzzlesteine vom oberen linken Feld in das darunterliegende schiebt und auf ein sp&auml;teres Andocken spekuliert. Vielleicht ist es den Versuch wert, vielleicht aber auch nicht.</div>
+
+<div class="quote">Ein alles in allem gelungener Level, der Spa&szlig; macht und planm&auml;&szlig;iges Vorgehen erfordert.</div>
+
+<div class="author">Martin</div>
+
+
+<h4>&quot;'Procrustes' ist viel trickreicher, als es zun&auml;chst den Anschein hat&quot;</h4>
+
+<div class="quote">Hmm, Prokrustes, war das nicht der Typ, der seinen G&auml;sten die Beine abgeschnitten oder sie in die L&auml;nge gestreckt hat, damit sie in seine Betten passen? Frag' mich, warum der Level so hei&szlig;t? Naja, sieht eigentlich recht einfach aus - ganz nett gemacht, aber ich sch&auml;tze mal, zum &quot;Level des Monats&quot; wird er's wohl nicht gerade bringen. Die Teile da mit Hilfe des Zauberstabes ein bisschen hin und her schieben - und dann ab damit in den Abgrund und &hellip; Aaahhh &hellip; <i>Deeessweeegen</i> hei&szlig;t er also &quot;<i>Prokrustes</i>&quot;.</div>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200812_c.jpg" alt="Level des Monats" border="0">
+</div>
+
+<div class="quote">Das waren nur einige Gedanken, die Tarim durch den Kopf gingen, als er zum ersten Mal &quot;Procrustes&quot; gespielt hat (beziehungsweise w&auml;ren es gewesen, wenn &quot;Level des Monats&quot; damals schon erfunden gewesen worden w&auml;re). &quot;Procrustes&quot; ist viel trickreicher, als es zun&auml;chst den Anschein hat. Obwohl es leicht passieren kann, dass man versehentlich ein Puzzleteil an eine Wand schiebt, so ist es doch sehr h&auml;ufig m&ouml;glich, aus anderen Teilen ein Hilfskonstrukt zu bauen, und das arme Ding aus seiner misslichen Lage wieder zu befreien.</div>
+
+<div class="quote">Tarim hat wahrscheinlich mehr Zeit mit dem Level zugebracht, <i>nachdem</i> er ihn gel&ouml;st hatte, mit Problemen wie: K&ouml;nnte es vielleicht doch m&ouml;glich sein, einige der &quot;Glieder&quot;, die er abgetrennt hatte, durch die L&uuml;cke links in der Mitte nach unten zu bef&ouml;rdern? So vorbereitet k&ouml;nnten sie schon darauf warten integriert zu werden, wenn der &quot;Gast&quot; im unteren Zimmer &quot;zu Bett&quot; gebracht werden w&uuml;rde. Oder lie&szlig;e sich die Aufgabe auch bew&auml;ltigen, wenn man nur einzelne Teile verwendete, und nicht <i>alle</i> L&uuml;cken schlie&szlig;en w&uuml;rde? Aber diese Methode scheint daran zu scheitern, dass es nicht genug Endst&uuml;cke gibt. Wird es Tarim jemals gelingen ein Theseus zu werden, und all diesem Zerst&uuml;ckeln und Strecken ein Ende zu bereiten?</div>
+
+<div class="quote">Tarim</div>
+
+
+<h4>&quot;Anfangs dachte ich, dieses Level sehr schnell l&ouml;sen zu k&ouml;nnen&quot;</h4> 
+
+<div class="quote">Als ich mich das erste Mal an diesem Level versuchte, hielt ich es zun&auml;chst f&uuml;r ziemlich einfach. 
+Es dauerte aber nicht lange und ich wurde eines Besseren belehrt. Es ist eines der guten Level, die ich gerne 
+spiele.</div>
+
+<div class="quote">Was getan werden muss, ist nicht zu kompliziert, schlie&szlig;lich handelt es sich um ein WYSIWYG-Level. 
+Nichts ist verborgen, keine Verstecke, alles ist auf einen Blick zu erkennen. Der Anfang ist ansprechend; 
+zun&auml;chst muss einen Abgrund umgeben von einem Flammenmeer durchquert werden. Zur &Uuml;berwindung 
+dieses Hindernisses gilt es, aus den Puzzlesteinen ein passendes Gebilde zu bauen. Hat man die andere Seite 
+erreicht, erwartet einen dieselbe Aufgabenstellung. Allerdings geht es nun enger zu, und das Puzzlegebilde 
+muss dazu auch noch l&auml;nger werden. Um die zus&auml;tzlich ben&ouml;tigten Puzzleteile heranzuschaffen, 
+leistet der Feuerl&ouml;scher, strategisch clever eingesetzt, unersetzliche Dienste.</div> 
+
+<div class="quote">Hier muss aufgrund des knapp bemessenen Platzes vorsichtig agiert werden, um sich nicht 
+den Weg zu versperren, was dann zu einem Neustart zwingen w&uuml;rde.Anfangs dachte ich, dieses Level sehr
+schnell l&ouml;sen zu k&ouml;nnen ... Aber das war wohl nur ein Wunschtraum. Ich verbrachte einige Tage damit. 
+Bei jedem weiteren Versuch sagte ich mir: &quot; Das ist das letzte Mal&quot;. Aber jedesmal machte ich irgendetwas falsch,
+und ich musste von vorne beginnen. Dieses Level ist eine subtile Sch&ouml;pfung, und man kann Einiges an Zeit 
+f&uuml;r die L&ouml;sung ben&ouml;tigen. Gutes Gehirn-Jogging ...</div>
+
+<div class="quote">&quot;Procrustes&quot; ist leicht und angenehm zu spielen: Kein Rotor jagt der Murmel hinterher, und 
+Schnelligkeit spielt keine Rolle. Die Hauptaufgabe besteht im Verschieben und Anordnen von Puzzlesteinen. 
+Wenn das jedoch gut gemacht ist, kann man sich gl&uuml;cklich sch&auml;tzen.</div>
+
+<div class="quote">Ich mag dieses Level. Es ist interessant, auch wenn es ein wenig zu einfach ist. Obwohl ich dieses Level 
+gerne spiele, ist es nicht mein Lieblingslevel von Andreas.</div>
+
+<div class="author">Xang</div>
+
+<p>Andreas Lochmann f&uuml;hrt uns in diesem Level des Monats in die Antike zum Sohn des Poseidon, in ein &hellip; </p>
+
+<h4>&quot;Spiel mit dem Feuer&quot;</h4>
+
+<p>Enigma Spieler, Prokrustes hat dich eingeladen! Er hat von dir geh&ouml;rt und hat dir besondere Delikatessen dargeboten: Oxyds, Steine und loderndes Feuer. Er lacht: &quot;Das Feuer wird dir den Weg weisen!&quot; Und du f&uuml;hlst dich umzingelt: Diese Allgegenwart der Feuersbrunst, neben dir die einengenden Puzzlesteine, so gar nicht &quot;passend&quot; &hellip; Zufall? Nein, kombiniere diese! Strecke, stauche, bevor er es mit dir tut! Habe den Mut, in den Abgrund zu blicken, die Flammen f&uuml;rchtend &hellip; </p>
+
+<p>Diese Flammen lenken mich ab - Hilfe, ich bin doch kein Feuervogel! Prokrustes lacht wieder, und statt s&uuml;sslicher Paradiesvogelmusik ert&ouml;nt triumphierend Schostakowitschs 4. Symphonie: &quot;Mein Freund!&quot;, ruft er schelmisch, &quot;sieh nur, wer die Macht hier hat. Schau dir die Oxyds in diesem d&uuml;steren Raum gut an, du schw&auml;chliche kugelige Kreatur, die mich und das Feuer f&uuml;rchtet. Ja, 'Das Feuer kann dir den Weg weisen' &hellip; &quot; </p>
+
+<h4>&quot;Spiel mit dem Feuer (Episode 2)&quot;</h4>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_l.jpg" alt="Level des Monats" border="0">
+<div class="imagetitle">Oops &hellip;</div>
+</div>
+
+<p>Ich verliere meine Furcht, werde zum &quot;Poete de feu&quot; und erkenne: &quot;Lass mich eine Br&uuml;cke bauen, kombiniert aus den Puzzlesteinen, &uuml;ber das Flammenmeer geschoben, im Abgrund versenkt.&quot; Das sollte funktionieren: Siehst du den Zauberstab? Puzzlesteine im Abgrund? Richtig kombiniert passiert eine Metamorphose, die Puzzlesteinkombination wird - Simsalabim - begehbar: Kombiniere, bedenke die Enge, die Einmaligkeit des Zwischen- wie auch des Endproduktes (wichtig!) - und nachdem die Angst vor der Feuergewalt der Hoffnung gewichen ist, wirst du zum Ma&szlig;schneider f&uuml;r das Puzzleprodukt, welches &quot;der Weg&quot; sein wird. Du hast nur eine Chance, ein Fehler, und es ist verbaut, unbrauchbar. Und achte auf die richtige Wahl des Zauberstabes: Simsalabim - und alles, was du gebaut hast zerf&auml;llt &hellip; </p>
+
+<h4>&quot;Vom Stauchen und Strecken&quot;</h4>
+
+<p>Nutze den Zauberstab richtig! Da passt doch was nicht &hellip; Sei ein Meister der &quot;Streckkunst&quot;, mache aus den Einzelteilen die Summe, die eines Prokrustes w&uuml;rdig ist. Die Uhr l&auml;uft, und wenn du erfolgreich warst, weisst du, das Feuer hat dir den Weg gewiesen, du hast die Puzzlesteine verzaubert &hellip; : Prokrustes hat Achtung vor dir, kleiner Prokrustes, Feuervogel, Puzzler, Balancier: Level geschafft!</p>
+
+<p>Und du hast wiedermal &quot;Freude gefunden&quot; an der &quot;Mythologie&quot; in Enigma: Andreas, mehr davon! Wo bleibt Poseidon, der Vater? Wo Theseus, der Vollstrecker? Oder Aphrodite, die Sch&ouml;ne? Einen &quot;Zeus&quot; haben wir ja schon, aber das ist ein anderes Enigma Thema.</p>
+
+<h4>&quot;Es sieht alles so einfach aus, aber &hellip; &quot;</h4>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200812_h.jpg" alt="Level des Monats" border="0">
+</div>
+
+<p>Dieser Onescreener &uuml;berzeugt in seiner Schlichtheit, der geringen Anzahl an Elementen, seiner thematischen &Uuml;bersichtlichkeit. Alles ist sichtbar, auch der Puzzlesteine-L&ouml;sungsweg: &quot;Das Feuer wird dir den Weg weisen&quot;. Forme aus den Puzzlesteinen das Element, das du brauchst - der Olymp hat dem Spieler hierzu den Zauberstab geliehen &hellip; Werden die Feuerl&ouml;scher wirklich gebraucht? Beim Puzzlesteine-kombinieren lautet dann die Devise: &quot;Endprodukt(e) richtig f&uuml;gen&quot;, da ist schnell mal was &uuml;bersehen. Oder &quot;Hoppla, den wollt ich doch gar nicht &hellip;&quot;. Bei dieser Montage auf die &quot;Anschl&uuml;sse&quot; achten.</p>
+
+Apropos Anschl&uuml;sse:
+
+<p>Andreas, wir freuen uns schon auf die n&auml;chsten wundervollen Spiele von Dir und danken f&uuml;r diese &quot;feurige&quot; Herausforderung.</p>
+
+<div class="author">Mecke </div>
+
+
+<h4>Non multa, sed multum</h4>
+
+<div class="quote">Dieses alte lateinische Sprichwort bringt meiner Ansicht nach sehr gut zum Ausdruck, was der Autor beim Erschaffen seines Werkes im Sinn gehabt haben mag. Nicht viel ist es, was dem Spieler da an Spielmaterial angeboten wird, wohl aber wird dieser bald feststellen m&uuml;ssen, dass es durchaus vieler Anstrengungen bedarf, um die ihm gestellte Aufgabe bew&auml;ltigen zu k&ouml;nnen. Die dem Spiel zugrundeliegende Idee ist vom Autor mit viel Sorgfalt ausgearbeitet worden, und entsprechend viel Vergn&uuml;gen bereitet es, sich mit der L&ouml;sung dieser Aufgabe zu besch&auml;ftigen.</div>
+
+<div class="quote">Aber zun&auml;chst einmal meinen Gl&uuml;ckwunsch an Andreas zu dieser Auszeichnung. Nachdem er 12 exzellente Artikel &uuml;ber exzellente Level verfasst hat, und auch an der Gestaltung der letzten 6 nicht ganz unbeteiligt war, hat es ihn nun endlich selbst erwischt, und das v&ouml;llig zu recht, kann ich da nur sagen. &quot;Procrustes&quot; ist wirklich ein Level von au&szlig;ergew&ouml;hnlicher Qualit&auml;t.</div>
+
+<div class="quote">In seinem Kommentar zu &quot;Quadropolis&quot; im Oktober letzten Jahres hat Andreas geschrieben, dass er &quot;in seinen eigenen Levels gerne neue Objekte von Enigma pr&auml;sentiert&quot;. F&uuml;r &quot;Procrustes&quot; trifft dies zwar nicht ganz zu, allerdings gibt es kein anderes Level, in dem die blauen Puzzlesteine auf so originelle Weise zum Br&uuml;ckenbauen verwendet werden m&uuml;ssen wie in &quot;Procrustes&quot;, hier realisiert mit Hilfe des ewigen Feuers: Das ist wirklich neu, und einzigartig bisher.</div>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200812_i.jpg" alt="Level des Monats" border="0">
+</div>
+
+<div class="quote">Wem nicht klar sein sollte, wie gut das Ganze ausgekl&uuml;gelt ist, dem mag an dieser Stelle ein Blick ins Referenzhandbuch empfohlen sein: In Kapitel 4.3.46 weden die Besonderheiten der Puzzlesteine genauestens beschrieben, und in Kapitel 4.6 das neue Feuer-System von Enigma 1.0 erl&auml;utert. &quot;Procrustes&quot; ist &uuml;brigens der einzige Level von Andreas, in dem die blauen Puzzlesteine auftauchen, und das obwohl er es immerhin schon auf 46 1/4 Levels gebracht hat.</div>
+
+<div class="quote">Die Einzigartigkeit des Br&uuml;ckenbauman&ouml;vers war der eine Grund, warum ich &quot;Procrustes&quot; im Laufe der letzten zwei Jahre immer wieder gerne einen Besuch abgestattet habe, der andere war die angegebene L&ouml;sungszeit des Autors: Obwohl Andreas nun nicht gerade daf&uuml;r bekannt ist, dass er mit phaetonischer Geschwindigkeit durch die Levels reist, war er doch immer 7-6-5-4-3-2-1 Minuten schneller unterwegs als ich. Im Laufe der Zeit kam ich seinem Rekord zwar immer n&auml;her, und es gelang mir immer wieder neue L&ouml;sungsmethoden zu erfinden, die aber immer noch Lichtjahre entfernt waren von der vermeintlich optimalen L&ouml;sungszeit - von der Bestzeit von Ronald.</div>
+
+<div class="quote">Tja, und das war eigentlich das Einzige, was mir an dem Level bisher nicht so sehr gefallen hat: Dass es mir einfach nicht gelingen wollte, den k&uuml;rzest m&ouml;glichen L&ouml;sungsweg f&uuml;r die Operation &quot;Procrustes&quot; zu finden, und somit die Tatsache, dass nicht ich es war, der die Bestzeit hielt. Aber ich hoffe, dass ich diesen Malus irgendwann in der k&uuml;rzeren Vergangenheit beseitigen konnte. ;-) </div>
+
+<div class="quote">Vielen Dank an Moneymaker f&uuml;r die verbale Volage ;-) - und nat&uuml;rlich an Andreas f&uuml;r den genialen Level. :-) </div>
+
+<div class="author">Daydreamer</div>
+
+
+<h4>Eine Mail vom 8.9.2006:</h4>
+
+<div class="quote">&quot;Hi,</div>
+
+<div class="quote">die n&auml;chste Themendekade (Pack VI, 31-40) soll
+ja das Thema &quot;Mythologie&quot; tragen. Was sich als
+ziemliches Prokrustesbett f&uuml;r Level herausgestellt
+hat. Womit wir auch gleich beim Thema sind :-) </div>
+
+<div class="quote">[&hellip;]&quot;</div>
+
+<p>Einigen mag es schon aufgefallen sein, es gibt gelegentlich themenbezogene
+Dekaden in Enigma. Einige davon gefallen mir im R&uuml;ckblick, wie die
+Nightmare-Dekade und die Schwarz-Wei&szlig;-Dekade, einige weniger gut (wie die blaue
+Dekade II/81-90). Die Dekaden waren ein Ziel Raouls und meiner Sortierarbeiten
+vor Enigma 1.00. Die letzte Dekade, die zu der urspr&uuml;nglichen Umsortierung
+geh&ouml;rte, war die Eisdekade am Ende von Pack V. Nach Abschluss der Sortierung
+kamen bis zur eigentlichen Erscheinung von 1.00 aber noch viele Levels dazu, die
+sich nur schwerlich in neuen Dekaden eingliedern lie&szlig;en. Folgerichtig musste die
+letzte Dekade f&uuml;r 1.00, die Mythologie-Dekade, zu der auch &quot;Procrustes&quot; geh&ouml;rte,
+komplett durchgeplant werden. Mit &quot;Sisyphus&quot; und &quot;Zeus&quot; standen anfangs nur zwei
+Levels als Grundstock zur Verf&uuml;gung. &quot;Troy&quot; war ebenfalls schon vor Konstruktion
+der Dekade geplant, als Beispiellevel f&uuml;r Schachsteine (das Thema Troja ergab
+sich n&auml;mlich aus dem Einsatz der Schachsteine, nicht umgekehrt), wurde aber erst
+sp&auml;ter von mir realisiert. Auch &quot;Phaeton&quot; wurde erst im Nachhinein in die
+Mythologie-Dekade eingepflanzt.</p>
+
+<p>Damit ging es daran, gezielt Levels mit dem Thema &quot;Mythologie&quot; zu schreiben.
+Ich habe mir also mehrere Tage den Kopf dar&uuml;ber zermartert, alle m&ouml;glichen
+Mythologien der alten Griechen und R&ouml;mer zu durchforsten, auf der Suche nach
+Ideen f&uuml;r Levels. &quot;Prometheus&quot; war darunter &hellip; ein Level mit Feuer und einer
+durch Gummib&auml;nder gehaltene Murmel? Ein ziemlich wager Plan, aber ich behielt
+ihn in der Hinterhand, f&uuml;r den Fall, dass doch noch ein Level fehlen w&uuml;rde.
+&quot;Prometheus&quot; wurde aber nie verwirklicht. Ich suchte gezielt nach Motiven in
+der Mythologie, die sich auch gut abstrahieren lie&szlig;en. Der Gott Janus lieferte
+ein solches Motiv, auch wenn ich mit der Umsetzung des &quot;Janus&quot;-Levels im
+Nachhinein sehr unzufrieden bin.</p>
+
+<p>Die meisten Mythen haben direkt oder indirekt mit K&auml;mpfen zu tun, etwas, was
+sich kaum mit Enigmas Philosophie und Spielprinzip vereinen lie&szlig;. Praktisch die
+ganze Herakles-Sage fiel somit in Ungnade. Anders bei Theseus - denn da fiel mir
+das Prokrustes-Motiv in die H&auml;nde. Es handelt sich bei der Geschichte um
+Prokrustes um ein sehr selten genutztes und daher wenig verbrauchtes Motiv: Was
+zu lang ist, wird gek&uuml;rzt, was zu kurz ist wird verl&auml;ngert, egal auf welche
+Kosten. Das war etwas, was sich auch mit Enigma realisieren lassen sollte!</p>
+
+<p>Nun, wenn etwas in Enigma verl&auml;ngert oder verk&uuml;rzt werden sollte, dann musste
+es aus mehreren Teilen bestehen, so wie Puzzle-St&uuml;cke. Und sie mussten mit
+etwas verglichen werden k&ouml;nnen, in etwas hinein passen -- so wie Puzzle-St&uuml;cke!
+Das kam gelegen, um auch Raouls neue libpuzzle auszuprobieren.
+Die Idee war damit geboren (&uuml;brigens beim Baden). Schnell war eine geeignete
+Puzzle-Form gefunden, die sich nicht verf&auml;lschen lie&szlig;, und die Grobversion des
+Levels stand. In dieser ersten Version waren noch beide &quot;Betten&quot; gleich gro&szlig;,
+der Level war symmetrisch aufgebaut. Aber es stellte sich als schwierig heraus,
+den oberen, &uuml;berlangen Puzzlek&ouml;rper zu man&ouml;vrieren und die Teile zwischen zu
+lagern - es war einfach zu wenig Platz vorhanden. Ich studierte nochmal die
+alte Geschichte von Prokrustes, und erst beim genaueren Lesen bemerkte ich,
+dass auch die Betten verschieden lang waren. Ich sprang &uuml;ber meinen eigenen
+Schatten (wie sch&ouml;n sind doch symmetrische Levels!) und brach die Symmetrie des
+Levels, au&szlig;erdem kippte ich die Mittellinie in ihre jetzige, schr&auml;ge Position.</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_m.jpg" alt="Level des Monats" border="0">
+<div class="imagetitle">One of the earlier versions</div>
+</div>
+
+<p>Beim Feuer und Design war ich mir anfangs noch nicht ganz sicher, wie ich es
+machen sollte. Das neue Feuersystem war noch in Entwicklung, daher stand ewig
+brennendes Feuer noch nicht richtig zur Verf&uuml;gung. Andererseits wollte ich
+gerne Grasboden verwenden, was im neuen Feuersystem brennbar sein sollte. Damit
+habe ich zun&auml;chst auf die neuen &quot;it_death&quot; zur&uuml;ckgegriffen, Totenk&ouml;pfe, die auf
+dem Boden lagen. Sie konnten durch &Uuml;berschieben mit dem Puzzle nicht zerst&ouml;rt
+werden, das war gut. Und statt tiefem schwarzem Abgrund gab es Wasser, was gut
+zum Gras passte. Aber wie sollte der Spieler die &uuml;brigen Puzzlesteine auf
+die andere Seite bringen? Ein Schalter, der die it_death entfernt? Unelegant.
+Also doch Feuer mit Feuerl&ouml;scher. Aber welches Design, wenn das Wasser
+verdampfen w&uuml;rde und das Gras Feuer f&auml;ngt?</p>
+
+<p>Ich wollte urspr&uuml;nglich Gras benutzen, um die Gegend abzubilden, in der
+Prokrustes lebte. Ich habe relativ lange nach einer guten L&ouml;sung gesucht, bin
+dann aber doch auf den &quot;Notfallplan Sand&quot; zur&uuml;ck gekommen. Ich kam sp&auml;ter
+nochmal dar&uuml;ber ins Gr&uuml;beln, als sich Siegfried Fennig bei uns meldete, und
+darauf hinwies, dass die Steinsorte, die auch in &quot;Procrustes&quot; verarbeitet
+worden war, anders gef&auml;rbt war als das Original. Da das Original farblich
+nicht so gut zu Sand passte, gab es erst &Uuml;berlegungen meinerseits, das Design
+nochmal komplett umzukrempeln, aber als ich sah, dass auch andere Levels von
+dieser Ver&auml;nderung betroffen waren, entschieden wir uns daf&uuml;r, beide
+Farbversionen dieses Steins beizubehalten. Auch in dieser Hinsicht entwickelte
+sich &quot;Procrustes&quot; als Versuchsfeld f&uuml;r Neues, nach dem Feuersystem, it_death und
+libpuzzle.</p>
+
+<p>Prokrustes hat mir sehr viel Freude bereitet - als Teil der Mythologie-Dekade,
+als relativ einfach konzipierter Level mit dennoch hohem Beliebtheitsgrad, und
+auch, dass ich lange Zeit selber den Weltrekord f&uuml;r diesen Level halten konnte,
+da ich durch die Tests doch einige Kniffe im Umgang mit den Puzzlesteinen in
+diesem Level lernte. Und heute bereitet er mir erneut Freude, weil er als
+erster meiner Levels von Ihnen zum Level des Monats gek&uuml;rt wurde - vielen Dank
+daf&uuml;r an alle Spielerinnen und Spieler da drau&szlig;en, ich hoffe, Sie hatten
+ebensoviel Spa&szlig; beim Spielen wie ich beim Schreiben!</p>
+
+<div class="author">Andreas Lochmann</div>
+
+<p>
+Frohe Festtage, und IV/2,<br>
+<i>Ihr Enigma-Team!</i>
+</p>
+
+<p>Liebe Leserin, lieber Leser, wir haben ein st&auml;ndiges Bed&uuml;rfnis nach
+Ihren Artikeln &uuml;ber Enigmas gro&szlig;e Levels. Bitte, schicken Sie uns
+jeden Artikel, sogar Kommentare, die Sie geschrieben haben, an:</p>
+<pre>
+<a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
+</pre>
+<p>Wir sind besonders interessiert an Artikeln &uuml;ber die folgenden Levels:
+</p>
+<ul>
+<li>&quot;Plan Ahead&quot; von Jacob Scott</li>
+<li>&quot;Little Puzzles&quot; von Jon 'WB' Sneyers</li>
+</ul>
+<p>Vielen Dank im voraus, nur Ihre Mithilfe kann den LdM am Leben erhalten!
+</p>
+<p><i>Ihr Enigma-Team</i></p>
+
+</div>



From raoulb at bluewin.ch  Thu Dec 25 21:35:04 2008
From: raoulb at bluewin.ch (Raoul)
Date: Thu, 25 Dec 2008 21:35:04 +0100
Subject: [Enigma-game-svn] svn revision 1411
Message-ID: <20081225213504.22a084bb@amarok.loinet.zh>

Keep levels in sync with new api objectnames


From ral at mail.berlios.de  Fri Dec 26 13:57:14 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 26 Dec 2008 13:57:14 +0100
Subject: [Enigma-game-svn] r1412 - in trunk: data/schemas src
Message-ID: <200812261257.mBQCvEo2010633@sheep.berlios.de>

Author: ral
Date: 2008-12-26 13:57:13 +0100 (Fri, 26 Dec 2008)
New Revision: 1412

Modified:
   trunk/data/schemas/objects.xml
   trunk/src/floors.cc
   trunk/src/player.cc
   trunk/src/stones_simple.cc
Log:
Trunk 1.1:
- fix missing force_x, force_y declarations for reengineered floors
- fix update spot ability on glasses stolen by thieves


Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-25 20:30:42 UTC (rev 1411)
+++ trunk/data/schemas/objects.xml	2008-12-26 12:57:13 UTC (rev 1412)
@@ -24,6 +24,8 @@
     <attr name="faces" type="string" default="nil" rw="rw"/>
     <attr name="fastfire" type="bool" default="false" rw="rw"/>
     <attr name="fellows" type="group" default="nil" rw="r"/>
+    <attr name="force_x" type="double" default="0" rw="rw"/>
+    <attr name="force_y" type="double" default="0" rw="rw"/>
     <attr name="flavor" type="string" default="b" rw="rw"/>
     <attr name="floodable" type="bool" default="false" rw="rw"/>
     <attr name="freeze_check" type="bool" default="false" rw="rw"/>
@@ -220,6 +222,8 @@
       <attr name="eternal"/>
       <attr name="fastfire"/>
       <attr name="floodable"/>
+      <attr name="force_x"/>
+      <attr name="force_y"/>
       <attr name="freeze_check"/>
       <attr name="friction"/>
       <attr name="ignitable"/>

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2008-12-25 20:30:42 UTC (rev 1411)
+++ trunk/src/floors.cc	2008-12-26 12:57:13 UTC (rev 1412)
@@ -23,6 +23,7 @@
 #include "server.hh"
 #include "world.hh"
 #include "main.hh"
+#include "items/GlassesItem.hh"
 
 #include <iostream>
 
@@ -701,6 +702,7 @@
             }
             int i = IntegerRand (0, int (inv->size()-1));
             dynamic_cast<ItemHolder *>(bag)->add_item(inv->yield_item(i));
+            Glasses::updateGlasses();
             player::RedrawInventory (inv);
             didSteal = true;
         }
@@ -712,7 +714,7 @@
                 bag = MakeItem("it-bag");
                 bag->setOwnerPos(get_pos());                
             }
-            dynamic_cast<ItemHolder *>(bag)->add_item(YieldItem(get_pos())); 
+            dynamic_cast<ItemHolder *>(bag)->add_item(YieldItem(get_pos()));
             didSteal = true;
         }
     }

Modified: trunk/src/player.cc
===================================================================
--- trunk/src/player.cc	2008-12-25 20:30:42 UTC (rev 1411)
+++ trunk/src/player.cc	2008-12-26 12:57:13 UTC (rev 1412)
@@ -25,6 +25,7 @@
 #include "server.hh"
 #include "world.hh"
 #include "main.hh"
+#include "items/GlassesItem.hh"
 
 #include "ecl_util.hh"
 
@@ -274,7 +275,7 @@
     else {
         icurrent_player = iplayer;
         RedrawInventory (GetInventory(iplayer));
-        dynamic_cast<Item *>(GetObjectTemplate("it_glasses"))->on_pickup(NULL);  // ugly hack to call updateGlasses
+        Glasses::updateGlasses();
     }
 }
 

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-12-25 20:30:42 UTC (rev 1411)
+++ trunk/src/stones_simple.cc	2008-12-26 12:57:13 UTC (rev 1412)
@@ -940,6 +940,7 @@
             }
             int i = IntegerRand (0, int (inv->size()-1));
             dynamic_cast<ItemHolder *>(bag)->add_item(inv->yield_item(i));
+            Glasses::updateGlasses();
             player::RedrawInventory (inv);
             sound_event("thief");
         }



From ral at mail.berlios.de  Fri Dec 26 22:29:17 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 26 Dec 2008 22:29:17 +0100
Subject: [Enigma-game-svn] r1413 - in trunk/src: . actors
Message-ID: <200812262129.mBQLTHwD007029@sheep.berlios.de>

Author: ral
Date: 2008-12-26 22:29:17 +0100 (Fri, 26 Dec 2008)
New Revision: 1413

Modified:
   trunk/src/actors/Balls.cc
   trunk/src/actors/Balls.hh
   trunk/src/world.cc
Log:
Trunk 1.1:
- fix r1408: marbles, pearls did not shatter on box pushed on top
- external state of marble, pearl is readable: 0 for alive, 1 for dead

Modified: trunk/src/actors/Balls.cc
===================================================================
--- trunk/src/actors/Balls.cc	2008-12-26 12:57:13 UTC (rev 1412)
+++ trunk/src/actors/Balls.cc	2008-12-26 21:29:17 UTC (rev 1413)
@@ -137,6 +137,15 @@
         return handled ? Value() : Actor::message(m);
     }
     
+
+    int BasicBall::externalState() const {
+        return state == DEAD ? 1 : 0;
+    }
+    
+    void BasicBall::setState(int extState) {
+        // no change possible
+    }
+
     bool BasicBall::is_dead() const {
         return state == DEAD;
     }

Modified: trunk/src/actors/Balls.hh
===================================================================
--- trunk/src/actors/Balls.hh	2008-12-26 12:57:13 UTC (rev 1412)
+++ trunk/src/actors/Balls.hh	2008-12-26 21:29:17 UTC (rev 1413)
@@ -57,6 +57,10 @@
         // Object interface.
         virtual Value message(const Message &m);
         
+        // StateObject interface
+        virtual int externalState() const;
+        virtual void setState(int extState);
+
         // Actor interface
         virtual bool is_dead() const;
         virtual bool is_movable() const;

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-12-26 12:57:13 UTC (rev 1412)
+++ trunk/src/world.cc	2008-12-26 21:29:17 UTC (rev 1413)
@@ -2274,14 +2274,14 @@
     return !actors.empty();
 }
 
-void ShatterActorsInsideField (const GridPos &p)
+void ShatterActorsInsideField(const GridPos &p)
 {
     vector<Actor *> actors;
     GetActorsInsideField (p, actors);
     vector<Actor *>::iterator i=actors.begin(),
         end = actors.end();
     for (; i != end; ++i) 
-        SendMessage(*i, "shatter");
+        SendMessage(*i, "_shatter");
 }
 
 



From ral at mail.berlios.de  Sat Dec 27 10:23:53 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sat, 27 Dec 2008 10:23:53 +0100
Subject: [Enigma-game-svn] r1414 - in trunk: data doc/reference
Message-ID: <200812270923.mBR9Nroe004481@sheep.berlios.de>

Author: ral
Date: 2008-12-27 10:23:44 +0100 (Sat, 27 Dec 2008)
New Revision: 1414

Modified:
   trunk/data/models-2d.lua
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk 1.1:
- fix r1399 broken anim model for spitter stones_8cc-source.html
- refman updates on rubberband, quake stone, oxyd and global attr.


Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-12-26 21:29:17 UTC (rev 1413)
+++ trunk/data/models-2d.lua	2008-12-27 09:23:44 UTC (rev 1414)
@@ -189,7 +189,7 @@
 
 -- ac-cannonball --
 do
-    DefAlias("ac-cannonball", "ac-blackball-jump")
+    DefAlias("ac-cannonball", "ac_marble_black-jump")
 end
 
 -- ac-horse --
@@ -1608,8 +1608,8 @@
 -- st-spitter --
 do
     DefAlias ("st-spitter", "st-timeswitch")
-    DefAlias ("st-spitter-loading", "st-fakeoxyd-blink")
-    DefAlias ("st-spitter-spitting", "st-fakeoxyd-blink")
+    DefAlias ("st-spitter-loading", "st-farting")
+    DefAlias ("st-spitter-spitting", "st-farting")
 end
 
 ---------------------------

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-12-26 21:29:17 UTC (rev 1413)
+++ trunk/doc/reference/enigma-ref.texi	2008-12-27 09:23:44 UTC (rev 1414)
@@ -43,7 +43,7 @@
 * Extension Development::       Resolver, Library Development
 * Old API - Objects::           Description of all objects in Enigma
 * Old API - Variables::         Lua variables that influence the game
-* Old API - Functions::               Predefined functions
+* Old API - Functions::         Predefined functions
 * Object Index::
 * Attribute Index::
 * Message Index::
@@ -478,7 +478,7 @@
 into an abyss, sheets of glass, spoon, actors and items may hide under
 movable stones, small not-killer whiteballs, coloured one-way-streets,
 actorimpulse-stones (``bumpers''), rotors can fly over an abyss,
-fart-stones, swords and knights, lasers, static and movable mirrors,
+quake-stones, swords and knights, lasers, static and movable mirrors,
 item- and coin-transformations by pushing stones over them and by
 using lasers, umbrellas protect in an abyss, hammer and breakable stones
 (although not in the tutorial).
@@ -1356,8 +1356,8 @@
  2   draw_border("st-brownie")
  3   fill_floor("fl-hay", 0,0, level_width,level_height)
  4
- 5   set_stone("st-fart", level_width-1,0, @{name="fart"@})
- 6   set_stone("st-timer", 0,0, @{action="trigger", target="fart",
+ 5   set_stone("st_quake", level_width-1,0, @{name="quake"@})
+ 6   set_stone("st-timer", 0,0, @{action="trigger", target="quake",
  7             interval=10@})
  8
  9   oxyd(3,3)
@@ -1402,8 +1402,8 @@
 corner and the width and height of the rectangle to be filled.
 
 @example
- 5   set_stone("st-fart", level_width-1,0, @{name="fart"@})
- 6   set_stone("st-timer", 0,0, @{action="trigger", target="fart",
+ 5   set_stone("st-quake", level_width-1,0, @{name="quake"@})
+ 6   set_stone("st-timer", 0,0, @{action="trigger", target="quake",
  7             interval=10@})
 @end example
 
@@ -1415,11 +1415,11 @@
 
 Attributes are the key to customizing the behavior of objects in a
 landscape.  Here, we name the first stone we create.
-It's a fart stone that has the unpleasant habit of ``blowing off''
-when triggered.  The timer stone that we create in line 6-7 triggers this fart stone.  This stone
+It's a quake stone that has the unpleasant habit of ``blowing off''
+when triggered.  The timer stone that we create in line 6-7 triggers this quake stone.  This stone
 performs a predefined action at
 regular intervals.  In this case, we want to send a ``trigger'' message
-every ten seconds to the object named ``fart''.
+every ten seconds to the object named ``quake''.
 
 @example
  9   oxyd(3,3)
@@ -4324,6 +4324,14 @@
 is reported by the standard Lua hash @samp{#} operator. If you need to iterate
 over the objects of a group you can write easily Lua for loops. You can either
 iterate with a counter or directly iterate the content objects.
+
+ at item @b{Shuffled Group:}
+ at example
+ at var{shuffled_group} = @var{sorted_group}:@b{shuffle}()
+ at var{shuffled_group} = @i{no}["@b{Atrax}#*"]:@b{shuffle}()
+ at end example
+Every group returns a shuffled group with the same members when receiving the
+message @code{"shuffle"}.
 @end table
 
 @c ----------------- Tiles and World Tasks --------------------
@@ -4411,7 +4419,7 @@
 
 @item @b{Position List Operations:}
 @example
- at i{wo}[@var{polist} .. @i{po}["@var{beach}#*"]] = @{"@b{it-banana}"@}
+ at i{wo}[@var{polist} .. @i{po}["@var{beach}#*"]] = @{"@b{it_banana}"@}
 @end example
 Two position lists can be appended. Single positions can be appended to a given
 position list, too.
@@ -5681,13 +5689,17 @@
 
 @menu
 * ActorimpulseStrength::
+* AllowSingleOxyds::
 * ConserveLevel::
+* CrackSpreading::
 * CreatingPreview::
+* ElectricStrength::
 * ExtralifeGlasses::
 * FollowAction::
 * FollowGrid::
 * FollowMethod::
 * FollowThreshold::
+* FrictionStrength::
 * Height::
 * IsDifficult::
 * MagnetRange::
@@ -5695,8 +5707,12 @@
 * MaxOxydColor::
 * MeditationStrength::
 * ProvideExtralifes::
+* RubberViolationStrength::
 * ShowMoves::
+* SlopeStrength::
 * SurviveFinish::
+* SwampSinkSpeed::
+* WaterSinkSpeed::
 * Width::
 * WormholeRange::
 * WormholeStrength::
@@ -5716,6 +5732,24 @@
 @item @b{Support:} @ @ @ref{st_actorimpulse}
 @end table
 
+ at node AllowSingleOxyds
+ at subsection AllowSingleOxyds
+
+A global variable that enables the existence of single unmatched @ref{st_oxyd}
+stones. Setting this variable to @code{true} allows you to set uneven numbers
+of oxyd stones for fixed colors. If a level deletes or adds oxyd stones during
+runtime a @code{true} value avoids possible problems due to temporary uneven
+oxyd stone numbers. The default @code{false} value causes an error message on
+detection of uneven oxyd numbers.
+
+ at table @asis
+ at item @b{Type:} @ @ bool
+ at item @b{Values:} @ @ @code{true}, @code{false}
+ at item @b{Default:} @ @ @code{false}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{st_oxyd}
+ at end table
+
 @node ConserveLevel
 @subsection ConserveLevel
 
@@ -5748,6 +5782,23 @@
 @item @b{Support:} @ @ no objects
 @end table
 
+ at node CrackSpreading
+ at subsection CrackSpreading
+
+A global default value denoting the probability that a brittle floor plate 
+causes direct neighboring floors to either start or to desintegrate further when
+an actor enters or leaves this plate at the center of the affected area. A value
+of @code{1.0} ensures that the crack spread to the direct neighbors, a value of
+ at code{0.0} prohibits the spreading to neighbor grids.
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ float number between @code{0.0} and @code{1.0}
+ at item @b{Default:} @ @ @code{0.5}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{it_crack}
+ at end table
+
 @node CreatingPreview
 @subsection CreatingPreview
 
@@ -5773,6 +5824,23 @@
 @item @b{Support:} @ @ object independent
 @end table
 
+ at node ElectricStrength
+ at subsection ElectricStrength
+
+A global scalar default factor for electrical forces. Positive numbers are
+attracting forces for opposite charges where as negative numbers are repelling
+forces for opposite charges. This global value is always multiplied by the
+charge load of the affected actors.
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ float number
+ at item @b{Default:} @ @ @code{15.0}
+Positve number are attracting, negative numbers are repelling.
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{st_charge}
+ at end table
+
 @node ExtralifeGlasses
 @subsection ExtralifeGlasses
 
@@ -5860,7 +5928,21 @@
 @item @b{Support:} @ @ no objects
 @end table
 
+ at node FrictionStrength
+ at subsection FrictionStrength
 
+A global scalar default factor for floor friction values. This global value is
+always multiplied by the floor specific friction on calculation of the friction
+forced applied to actors.
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ float number
+ at item @b{Default:} @ @ @code{1.0}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ all floors
+ at end table
+
 @node Height
 @subsection Height
 
@@ -5968,6 +6050,23 @@
 @item @b{Support:} @ @ object independent
 @end table
 
+ at node RubberViolationStrength
+ at subsection RubberViolationStrength
+
+A global scalar default factor for the @ref{ot_rubberband} force that is applied
+to actors if the length of the rubberband exceeds the given min or max limits.
+This can happen due to extraordinary events like actor warping, actor 
+resurrection, moving anchor stones or simply new rubberbands that are created
+with off limit length.
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ positive float number
+ at item @b{Default:} @ @ @code{50.0}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{it_magnet}
+ at end table
+
 @node ShowMoves
 @subsection ShowMoves
 
@@ -5982,6 +6081,20 @@
 @item @b{Support:} @ @ object independent
 @end table
 
+ at node SlopeStrength
+ at subsection SlopeStrength
+
+A global scalar default factor for @ref{fl_slope} floor gradient forces. This 
+global value is used if no slope object specific strength factor is supplied.
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ float number
+ at item @b{Default:} @ @ @code{25.0}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{fl_slope}
+ at end table
+
 @node SurviveFinish
 @subsection SurviveFinish
 
@@ -5998,6 +6111,32 @@
 @item @b{Support:} @ @ object independent
 @end table
 
+ at node SwampSinkSpeed
+ at subsection SwampSinkSpeed
+
+A global default for the speed at which actors need to move to avoid sinking.
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ positive float number or zero
+ at item @b{Default:} @ @ @code{4.0}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{fl_swamp}
+ at end table
+
+ at node WaterSinkSpeed
+ at subsection WaterSinkSpeed
+
+A global default for the speed at which actors need to move to avoid sinking.
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ positive float number or zero
+ at item @b{Default:} @ @ @code{4.0}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{fl_water}
+ at end table
+
 @node Width
 @subsection Width
 
@@ -6730,7 +6869,7 @@
 @table @asis
 @item @b{state}, @ @ @i{values}: @code{MEDITATION_CALDERA}, @code{MEDITATION_HOLLOW}, @code{MEDITATION_DENT}, @code{MEDITATION_BUMP}, @code{MEDITATION_HILL}, @code{MEDITATION_VOLCANO}; @ @ @i{default}: @code{MEDITATION_HOLLOW} @ @ @xref{state}
 The shape of the meditation.
- at item @b{essential} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+ at item @b{essential} @ @ @i{values}: @code{DISPENSIBLE}, @code{INDISPENSIBLE}; @ @ @i{default}: @code{DISPENSIBLE}
 Essentialness of being filled with a meditation marble to fulfill the
 @ref{Ending Conditions}.
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: @code{nil} @ @ @xref{friction}
@@ -7591,7 +7730,6 @@
 * st_death::           Skull Stone
 * st_disco::           Light shading Stone
 * st_door::            Door of various Flavors
-* st_fart::            Oxyd closing Stone
 * st_floppy::          Floppy Driven Switch
 * st_fourswitch::      Four Direction Switch
 * st_key::             Key Driven Switch
@@ -7608,6 +7746,7 @@
 * st_polarswitch::     Transparency Switch for Light Beams
 * st_pull::            Pullable Stone
 * st_puzzle::          Clusterable Puzzle Stones
+* st_quake::           Oxyd closing Stone
 * st_rotator::         Rotating Stone Impulser
 * st_rubberband::      Rubberband generator
 * st_scissors::        Scissors cutting rubberbands
@@ -7769,7 +7908,7 @@
 A marble blocking its way is shattered. When a stone blocks its way, the boulder
 triggers it by a sequence of two internal messages. Some stones give way like
 @ref{st_blocker}, others change their state like @ref{st_oxyd},
- at ref{st_stoneimpulse}, @ref{st_fart}, @ref{st_mirror}, @ref{st_fourswitch},
+ at ref{st_stoneimpulse}, @ref{st_quake}, @ref{st_mirror}, @ref{st_fourswitch},
 @ref{st_volcano}. A third category switches temporarily into another state on the
 first message sent when the boulder reaches a grid and switches back on the
 second message sent when the boulder gives up like @ref{st_[black/white]},
@@ -8183,49 +8322,6 @@
 
 @end table
 
- at c ----------------- Fart Stone --------------------
- at node st_fart
- at subsection st_fart
- at obindex st_fart
-
-This stone looks like an @ref{st_oxyd} of flavor @code{"b"}, but it has the
-unpleasant habit of "blowing off" when being activated. Unfortunatley the
-bad air closes all open @ref{st_oxyd}s.
-
-The stone gets activated on an actor hit, on @ref{st_boulder}s hit and on its
-destruction.
-
-The player can destroy this troublemaker with an actor that reveals an
- at ref{it_hammer}, by directing a laser light onto the fart stone or by a nearby
-explosion or ignition.
-
-Of course you can activate and destroy it by messages and state set operations,
-too.
-
- at table @asis
- at item @b{Attributes:}
-
- at table @asis
- at item @b{state}, @ @ @i{values}: @code{IDLE}, @code{ACTIVE}, @code{BREAKING}; @ @ @i{default}: @code{IDLE}: @ @ @xref{state}
-Current state of the fart stone. You can just change the state into legal
-follow up states. A breaking state is final.
- at end table
-
- at item @b{Messages:}
-
- at table @asis
- at item @b{toggle} @ @ @xref{toggle}
-Toggles stone from @samp{IDLE} to @samp{ACTIVE}
- at item @b{signal} @ @ @xref{signal}
-Toggles stone from @samp{IDLE} to @samp{ACTIVE}
- at item @b{ignite}
-Toggles stone to @samp{BREAKING}
- at end table
-
- at item @b{Action:} none
-
- at end table
-
 @c ----------------- Floppy Stone --------------------
 @node st_floppy
 @subsection st_floppy
@@ -8871,9 +8967,18 @@
 single color. With the world attribute @ref{MaxOxydColor} you can lower or
 increase this limit. By setting this attribute to @samp{OXYD_GREEN} you can
 enforce the engine to assign just the first three colors. Be careful in usage
-of more than 8 colors as levels can get incredibly difficult. Uneven number of
-regular colored oxyds are not allowed.
+of more than 8 colors as levels can get incredibly difficult. 
 
+The number auf auto colored oxyds should usually be even as a single remaining
+oxyd of a color keeps a level from being solvable. In case of an uneven number
+one oxyd stone gets colored to @samp{OXYD_FAKE} and does not participate in the
+stone opening procedure. But still you can set uneven number of oxyds of a given
+color if you do not use auto coloring but use explicit color values. Same thing
+happens if you delete a single oxyd during the running game. In both cases
+Enigma reacts with an error message by default. You can suppress this exception
+by setting @ref{AllowSingleOxyds} to @code{true}. In this case it is the authors
+responsibility to guarantee that the level can be solved.
+
 Usually oxyds are shuffled by a @samp{wo:shuffleOxyd()} statement after setting
 of all oxyds. All @samp{CLOSED} oxyds that are not explicitly excluded by the
 @samp{noshuffle} attribute take place in shuffling. But you can define
@@ -8891,12 +8996,16 @@
 an opened pair will not be closed this way.
 
 All oxyds including pairs will close on the @samp{closeall} messages that is
-issued by @ref{st_fart} and oxyds colored @samp{OXYD_FART} on actor hits.
+issued by @ref{st_quake} and oxyds colored @samp{OXYD_QUAKE} on actor hits.
 
 Closed oxyds can have different looks. Their visual representation is defined
-by their @samp{flavor}. For each flavor exists an identical looking simple
-stone: @ref{st_likeoxyd_a}, @ref{st_likeoxyd_b}, @ref{st_likeoxyd_c},
- at ref{st_likeoxyd_d}. If you like an identical looking pseudo stone that takes
+by their @samp{flavor}. Most flavors do hide the oxyd color in the closed state.
+Only flavor @code{"e"} starts with hidden color, but once opened returns to
+a closed image with a peep hole that lets the player still see the color.
+
+For each flavor exists an identical looking simple stone: @ref{st_fake_oxyda}, 
+ at ref{st_fake_oxydb}, @ref{st_fake_oxydc}, @ref{st_fake_oxydd}, 
+ at ref{st_fake_oxyde}. If you like an identical looking pseudo stone that takes
 part in the oxyd shuffling you can use an oxyd of color @samp{OXYD_FAKE}.
 
 During the game oxyds can be reshuffled. Just those oxyds that are still closed
@@ -8919,7 +9028,7 @@
 @table @asis
 @item @b{state}, @ @ @i{values}: @code{CLOSED}, @code{OPEN}, @code{OXYDPAIR}; @ @ @i{default}: @code{CLOSED} @ @ @xref{state}
 
- at item @b{flavor}, @ @ @i{values}: @code{"a"}, @code{"b"}, @code{"c"}, @code{"d"}; @ @ @i{default}: @code{"b"}
+ at item @b{flavor}, @ @ @i{values}: @code{"a"}, @code{"b"}, @code{"c"}, @code{"d"}, @code{"e"}; @ @ @i{default}: @code{"b"}
 The flavor only affects the visual representation of the stone. Mainly the
 closed state and the way of opening differ in the following way:
 @table @asis
@@ -8927,8 +9036,9 @@
 @item @code{"b"} black, flat stone that opens by a fade animation
 @item @code{"c"} blue, flat stone that opens by a concentric animation
 @item @code{"d"} dark blue, pyramid like stone that opens like a flower
+ at item @code{"e"} black, flat stone that provides a peep hole after closing
 @end table
- at item @b{oxydcolor}, @ @ @i{values}: @code{OXYD_AUTO}, @code{OXYD_FAKE}, @code{OXYD_FART}, @code{OXYD_BOLD}, @code{OXYD_BLUE}, @code{OXYD_RED}, @code{OXYD_GREEN}, @code{OXYD_YELLOW}, @code{OXYD_CYAN}, @code{OXYD_PURPLE}, @code{OXYD_WHITE}, @code{OXYD_BLACK}, @code{OXYD_GREY}, @code{OXYD_ORANGE}, @code{OXYD_PINE}, @code{OXYD_BROWN}; @ @ @i{default}: @code{OXYD_AUTO}
+ at item @b{oxydcolor}, @ @ @i{values}: @code{OXYD_AUTO}, @code{OXYD_FAKE}, @code{OXYD_QUAKE}, @code{OXYD_BOLD}, @code{OXYD_BLUE}, @code{OXYD_RED}, @code{OXYD_GREEN}, @code{OXYD_YELLOW}, @code{OXYD_CYAN}, @code{OXYD_PURPLE}, @code{OXYD_WHITE}, @code{OXYD_BLACK}, @code{OXYD_GREY}, @code{OXYD_ORANGE}, @code{OXYD_PINE}, @code{OXYD_BROWN}; @ @ @i{default}: @code{OXYD_AUTO}
 @item @b{noshuffle} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 @item @b{static} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 Static oxyds are neither swappable nor pullable.
@@ -8943,12 +9053,20 @@
 @item @b{close} @ @ @xref{close}
 @item @b{closeall}
 Closes all opened oxyds if send to any object instance.
+ at item @b{peepall}
+All closed oxyds of flavor @code{"e"} will show a peep hole if this message is
+sent to any oxyd object instance.
 @item @b{shuffle}
 Reshuffles all closed oxyds if send to any object instance.
 @end table
 
 @item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
-Values 0, 1.
+Whenever a @code{CLOSED} oxyd gets opened an action with value @code{true} is
+performed. The action is performed directly after the oxyds own reaction on being
+opened, like checking gaming ending conditions, reshuffling or closing all oxyds,
+did finish. Additionally an action with value @code{false} is performed after
+an oxyd changes from an open state to @code{CLOSED}. Note that no action is
+performed on state changes form @code{OPEN} to @code{OXYDPAIR}.
 
 @item @b{Variants:}
 
@@ -8958,6 +9076,7 @@
 @item @b{st_oxyd_b}: flavor = @code{"b"}
 @item @b{st_oxyd_c}: flavor = @code{"c"}
 @item @b{st_oxyd_d}: flavor = @code{"d"}
+ at item @b{st_oxyd_e}: flavor = @code{"e"}
 @end table
 
 @end table
@@ -9185,6 +9304,49 @@
 
 @end table
 
+ at c ----------------- Quake Stone --------------------
+ at node st_quake
+ at subsection st_quake
+ at obindex st_quake
+
+This stone looks like an @ref{st_oxyd} of flavor @code{"b"}, but it has the
+unpleasant habit of quaking when being activated. Unfortunatley this closes all
+open @ref{st_oxyd}s.
+
+The stone gets activated on an actor hit, on @ref{st_boulder}s hit and on its
+destruction.
+
+The player can destroy this troublemaker with an actor that reveals an
+ at ref{it_hammer}, by directing a laser light onto the quake stone or by a nearby
+explosion or ignition.
+
+Of course you can activate and destroy it by messages and state set operations,
+too.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{state}, @ @ @i{values}: @code{IDLE}, @code{ACTIVE}, @code{BREAKING}; @ @ @i{default}: @code{IDLE}: @ @ @xref{state}
+Current state of the quake stone. You can just change the state into legal
+follow up states. A breaking state is final.
+ at end table
+
+ at item @b{Messages:}
+
+ at table @asis
+ at item @b{toggle} @ @ @xref{toggle}
+Toggles stone from @samp{IDLE} to @samp{ACTIVE}
+ at item @b{signal} @ @ @xref{signal}
+Toggles stone from @samp{IDLE} to @samp{ACTIVE}
+ at item @b{ignite}
+Toggles stone to @samp{BREAKING}
+ at end table
+
+ at item @b{Action:} none
+
+ at end table
+
 @c ----------------- Rotator Stone --------------------
 @node st_rotator
 @subsection st_rotator
@@ -10005,16 +10167,27 @@
 repelling force, a negative one to an attracting force. A rubberband with a
 length inbetween @samp{threshold} and @samp{length} will apply no forces.
 
-In some cases you do want to limit the length of rubberband. You can do this
+In some cases you do want to limit the length of the rubberband. You can do this
 by setting @samp{min} and @samp{max} attributes. Actors will bounce on these
-limits. Do not try to use artificial large @samp{strength} values to ensure
-length limits, as this could lead to extreme forces causing unexpected and
+limits. Do not try to use artificial large @samp{strength} values instead to
+ensure length limits, as this could lead to extreme forces causing unexpected and
 unstable actor movements.
 
-Rubberbands can be cut by @ref{st_scissors}, by receiving a @ref{kill} message,
-by one of the anchors receiving a @ref{disconnect} message or a stone anchor
-that ceases to exist.
+If you set @samp{min} or @samp{max} limits, extraordinary events like actor 
+warping, actor resurrection, moving anchor stones or simply rubberbands that are
+created with an off limit length can cause trouble. When such a limit violation
+is detected an action is performed with a value @samp{false}. You may want to kill
+the rubberband or react in another way by a callback function. The default
+handling is an application of a constant force to bring the actors back within
+the limits. This force value is given by @ref{RubberViolationStrength} and 
+defaults to @samp{50.0}. If you really need to asure that the player is not able
+to violate the limits any further you may need to increase this constant.
 
+Rubberbands can be cut by @ref{st_scissors}, by an @ref{it_vortex} or
+ at ref{it_wormhole} with a set @samp{scissors} attribute ,by receiving a 
+ at ref{kill} message, by one of the anchors receiving a @ref{disconnect} message 
+or a stone anchor that ceases to exist.
+
 Rubberbands can be dynamically generated by @ref{it_rubberband} and
 @ref{st_rubberband}.
 
@@ -10044,8 +10217,10 @@
 
 @item @b{Messages:} none
 @item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
-An action will be performed on behalf of @ref{it_rubberband} after application
-and creation of this rubberband. The action value is @samp{1}.
+An action will be performed with value @samp{false} on violation of a min or max
+limit. Additionally an action will be performed on behalf of @ref{it_rubberband}
+after application and creation of this rubberband with an action value of
+ at samp{true}.
 @end table
 
 @c ----------------- Wirecontrol --------------------
@@ -11379,7 +11554,7 @@
 given rules.
 
 Rule based shuffling is limited to a maximum of one pair of each standard oxyd
-color plus any combination of additional special fake, fart or bold oxyds
+color plus any combination of additional special fake, quake or bold oxyds
 summing up to a maximum of 32 oxyds. If more than 32 oxyds or 2 or more pairs
 of a single standard color are set, all oxyds will be shuffled by random
 ignoring any provided rules.



From ged at mail.berlios.de  Sun Dec 28 12:44:22 2008
From: ged at mail.berlios.de (ged at mail.berlios.de)
Date: Sun, 28 Dec 2008 12:44:22 +0100
Subject: [Enigma-game-svn] r1415 - homepage/input/lotm
Message-ID: <200812281144.mBSBiMIJ025339@sheep.berlios.de>

Author: ged
Date: 2008-12-28 12:44:18 +0100 (Sun, 28 Dec 2008)
New Revision: 1415

Added:
   homepage/input/lotm/lotm_200812_ru.html
Log:
Homepage:
- Russian translation of December '08 LotM.

Added: homepage/input/lotm/lotm_200812_ru.html
===================================================================
--- homepage/input/lotm/lotm_200812_ru.html	2008-12-27 09:23:44 UTC (rev 1414)
+++ homepage/input/lotm/lotm_200812_ru.html	2008-12-28 11:44:18 UTC (rev 1415)
@@ -0,0 +1,631 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">??????? 2008: </span>
+    &quot;Procrustes&quot; ?? Andreas Lochmann
+  </h3>
+
+<p>
+?? ????????? ??? ???? ? ???? ??????? ?? ?????????? ? 10 ????????? ???????,
+? ??????? ???????? ???? ??????? ?? ???????????? ? ???????????. ???
+?????????????? ????????????? ???????? ?????? ????? ?????????? ??????
+????????. ????? ????, ?? ? ????????????? ?????????? ? 6 ????????????? ???????,
+????????? ?? 2, 3 ??? 4 ???????. ??? ?????? ????? ??? ??????? ??????
+??????? ????????????? ??????? ????? ? ???? ?????: &quot;Industrial
+Puzzles&quot; ?? Raoul Bourquin, ? ?????? ??? ?????? ????????????? ?????
+???? ??????? ????? ???????? ?? ????????? ? ???????? ???? ???????.
+???? ??? ????????? ? ?????? ? ???? ?? ????, ?????? ????? ????????? ?????????????
+??????. &quot;Industrial Puzzles&quot; ??????? ????? ? ?????????? ?????????,
+??????? ??????, ??????? ????? ??????? ???????? ???????, ????????????
+????????? ????????? ????? &mdash; ? ?????? ????? ??????????? ? ?????????????.
+</p>
+
+<p>
+? ????? ?? ??? ??-???????: ?????????? ?????? ??????? ???????????, ???
+?? ??? ????????????? ??????????, ? ???????????? ?????? ????? ???? ???
+???????? ???????, ??? ????? ? ????? ??????? &mdash; ??? ??? ? ???????.
+??????? ?????-???????????, ??????? ???? ??????????? ????????????? ??????????
+? &quot;Industrial Puzzles&quot;, ????? ??????? ?? ?????? ????. ? ???? ??????
+?? ??????????? ?? ? ???????????? ?????? ?????????????, ? ? ??????? ?????? ?
+?????? ? ??????????????? "???????????? ??????": &quot;????? ?????????? ? ?????
+'Procrustes', ????? ?????????? ?????&quot;. ??? ?????? ????????? ??? ???????,
+??? ???????? ????? ? ???????? ??? ??????, ??? ????? ??????? ? ?????? ????.
+????? ????????? ?????? ??????? ?????????? ??? ? ???????? ???? &mdash; &quot;?????
+?????????? ?????&quot;. ?? ????? ?????? ??????????? ???? &mdash; ??? ??????, ??????
+???????? ????? ????????? ???.
+</p>
+
+<p>
+? ?????? ?????? ??????? Enigma 1.00 ???? ??????? ???????, ???????????
+????? ? ???????? ???????? ????. ????? ????????????? ?? ???? ???????
+??? (?, ???????, ????????) #36, ? ?????? ??? ? ??????????? ??:
+&quot;Procrustes&quot;. ? ???? ??? ??? ???? ?? ?????? ??? ???????:
+?????? ????? ?? ?????????? ?????? ???????? ??????? ????????????.
+?????? ??????????, ??????? ?????? ???? ?????, ??? ??????, ??? ? ???
+?????-???? ???? ?? ??????? ??, ????????????? ??? 19 ????????. Andreas
+???????? ????????? ? &quot;????????&quot; ??? ???????, ? Mecke, ?????
+???????????????? ?????? ????? &quot;???????? ?? ???????&quot;, ???????
+?????????? ????. ??? ???, ?????? ? ?????????? 8 ????????? ??????????
+????? ????????? ?????? ? ????, ?????????????? ?? ???????, ???? ???,
+???????????? ????? ?????: &quot;Procrustes&quot;. ????????? ??????.
+</p>
+
+<p>
+??? ?????? ????????? ?? ?????? ??????????? ?????
+&quot;Procrustes&quot;:
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_e.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">Enigma VI # 36</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">????????? ???????? ?????? 2008</caption>
+<colgroup>
+    <col width="80">
+    <col width="160">
+</colgroup>
+    <tr><td class="num">4:18</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">5:42</td>
+        <td class="left">Django</td></tr>
+    <tr><td class="num">6:33</td>
+        <td class="left">Andreas</td></tr>
+    <tr><td class="num">7:50</td>
+        <td class="left">dev0</td></tr>
+    <tr><td class="num">7:57</td>
+        <td class="left">serpent</td></tr>
+    <tr><td class="num">8:26</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">8:53</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">9:37</td>
+        <td class="left">Mark P.</td></tr>
+    <tr><td class="num">10:09</td>
+        <td class="left">Johannes</td></tr>
+    <tr><td class="num">11:09</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">11:21</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">11:58</td>
+        <td class="left">dpl</td></tr>
+    <tr><td class="num">12:19</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">12:21</td>
+        <td class="left">JuSt</td></tr>
+    <tr><td class="num">12:28</td>
+        <td class="left">Safalra</td></tr>
+    <tr><td class="num">13:05</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">13:58</td>
+        <td class="left">redsantz</td></tr>
+    <tr><td class="num">14:02</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">14:26</td>
+        <td class="left">Daisy</td></tr>
+    <tr><td class="num">15:14</td>
+        <td class="left">shoki</td></tr>
+    <tr><td class="num">15:22</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">15:34</td>
+        <td class="left">Malla</td></tr>
+    <tr><td class="num">16:58</td>
+        <td class="left">Melanie</td></tr>
+    <tr><td class="num">18:16</td>
+        <td class="left">mecke</td></tr>
+    <tr><td class="num">19:55</td>
+        <td class="left">ABS</td></tr>
+    <tr><td class="num">20:14</td>
+        <td class="left">NorthForty</td></tr>
+    <tr><td class="num">22:16</td>
+        <td class="left">Duffy</td></tr>
+    <tr><td class="num">25:08</td>
+        <td class="left">Alex</td></tr>
+    <tr><td class="num">25:29</td>
+        <td class="left">alfred69</td></tr>
+    <tr><td class="num">26:43</td>
+        <td class="left">Sim_Ed</td></tr>
+    <tr><td class="num">27:55</td>
+        <td class="left">IntKecsk</td></tr>
+    <tr><td class="num">29:30</td>
+        <td class="left">Tarim</td></tr>
+    <tr><td class="num">32:06</td>
+        <td class="left">HuB34</td></tr>
+    <tr><td class="num">32:38</td>
+        <td class="left">biotopa</td></tr>
+    <tr><td class="num">33:18</td>
+        <td class="left">para_doks</td></tr>
+    <tr><td class="num">34:47</td>
+        <td class="left">Andy</td></tr>
+    <tr><td class="num">45:47</td>
+        <td class="left">Freshman</td></tr>
+    <tr><td class="num">45:53</td>
+        <td class="left">WP319</td></tr>
+    <tr><td class="num">47:17</td>
+        <td class="left">Valkyrie2</td></tr>
+    <tr><td class="num">142:21</td>
+        <td class="left">brynn</td></tr>
+</table>
+
+
+<h4>&quot;?????? ????? ? Procrustes ??? ????????, ??? ??? ????????? ???? Enigma&quot;</h4>
+
+<div class="quote">??? ???? ??????? ?????, ??? ??? ?????????? ???????? ??????????? ???
+Procrustes (VI #36), ?? ??????? 2008-?? ????. ?? ???????, ? ???? ?????????? Andreas Lochmann
+? ???, ??? ??? ???????? ???????? ????? ?????????? ?????? ????? ????? Enigma!</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_k.jpg" alt="??????? ??????" border="0">
+</div>
+
+<div class="quote">????????? ? ?????, ???????? ????? ???????? ?????????? ? ????? ? ?? ?????????
+? ??????? ????????, ?? ??? ????????, ??? ? ?????? ??????????? ??????????? ?? ??????? ? ?????
+?? ?????? ???????? ??????-?? ????????????????? ????????????? ????????? ? ?????. ?? ?????? ???????
+????? ??????????? ? ???????????, ?? ????? ??? ?????? ??????????? ???????????.</div>
+
+<div class="quote">????? ????? ????????? ??????????? ?????, ? ?? ?????? ????????? ??????????????
+????????; ?????? ???????????? ??????? Enigma, ??? ???????? ?????? ??? ???????? ????????? ?????
+?? ?????? ??? ??????? ??????. ????? ??? ? ???? ?????? ??????????? ????????????? ?????????, ? ?????????,
+??????? ?? ??? ????????.</div>
+
+<div class="quote">?????? ????? ? Procrustes ??? ????????, ??? ??? ????????? ???? Enigma; ????? ??????
+???, ?? ????? ??????? ?????????????? ?????? ??????. ???, ??? ????? ??? ????, ? ??? ????? ??? ?????, ??
+????? ??????. ?? ? ???? ??????, ??? ? ?? ?????? ??????, ???????????? ???????? ???????, ?????? ?? ????????,
+??? ??? ????? ??????? ??? ??????!</div>
+
+<div class="quote">? ??? ??? ? ?????, ??? ???????? ???-?? ??????? ? ?????, ????????, ?????? ????-?? ???????
+??? '???-??' ????? '???????', ??! ?????? ? ?? ???? ? Enigma ??????????????? ??????????, ? ?????? ?????
+??????????? ? ?????? ?? ??????? ????????. ??, ????? ?????????????? ? ???? ???????, ? ????????, ??? ?????
+????????. Andreas Lochmann ????? ??????? ?????? ????? ?????? ??????????? ?????????? ????????? &mdash; ?????
+? ????? ????!</div>
+
+<div class="quote">?? ?????? ?? ??, ??? ?? ?? ??? ?????? ? ??????, ??? ??????????? ????????? ??????? ??????,
+? ????? Procrustes, ?? ???????? ?????, ?????? ???????? ???????? ???? ??????? ??????.</div>
+
+<div class="author">Brynn</div> 
+
+
+<h4>&quot;??? ?? ???, ?? ???? ?? ??????? ??? ????????? ?? ????? ???????? ? 'Procrustes'&quot;</h4>
+
+<div class="quote">??? ??? ??? ???? ????? ????????. ?????? ????? ???????? ???????? ????? ?????????? ??
+????????? &mdash; ????????? ??????? ? ????? ?????? &hellip; ?????-?? ????????somehow familiar &hellip;
+&quot;<i>Well she's walking through the clouds, with a circus smile that's running 'round</i> &hellip;
+&quot; - ?? ??????! - ????????? - ????? &quot;Little Wing&quot; ??? ??????? &hellip; &quot;<i>It's alright</i>&quot;
+&hellip; ??? ??? ??! ??? ????????????? ???! ??????? ??????!</div>
+
+<div class="quote">??? ????? ?????? ????????: &quot;This is the end my friend&quot;. ?????????? ????????.
+&quot; &hellip; <i>it's alright</i> &hellip; &quot;. ??? ???. &hellip; ? ??? ?????-????? ???.</div>
+
+<div class="quote">?? ??? ?????? &quot;Procrustes&quot; ???? ???????? &mdash; ???????????? ????????.</div>
+
+<div class="quote">?? ?????????? ?????????? ?????? &quot;Procrustes&quot; ?????? ??????? ??????? ???? &mdash;
+???, ?????, ? ???. ??????? ??? ????? ??????????. ??????? ? ????????? ? ?????? ???????. ??????, ??????
+?????????????? ??? ????????? ? ????????? '????????'. ? ???????? &quot;Procrustes&quot; ? ?????????? ????????
+????????? ?????: ?????? ????? ???????? ???????? ????? &hellip; D&eacute;j&agrave;-vu: ? ????? ?????, ??? ???
+?? ? ?? ?????? ??????? ??????? ??? ?????????????????? ?????? &quot;Little Wing&quot;, ?? ????? ???? ??????
+? ??????? ???? ?????-?? ?????. ??? ??? ???????????</div>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200812_g.jpg" alt="??????? ??????" border="0">
+</div>
+
+<div class="quote">? ??? ??? ? ??? ? ?? ???? ?????? &quot;Procrustes&quot;. ?? ? ????????? ??? ??? ????? ???
+?? ?????, ??? ????????????? &mdash; ? ???? ??? ?????????? ??????????? &mdash; ?????????? ?????.</div>
+
+<div class="quote">? ??? ??? &quot;Procrustes&quot; ? ?????? John'? Campbelljohns'? ???????????? ????? ?????????
+??? ???? ????? ???????????? &mdash; ??? ????????? ???? ?????. ? ?? ??? ????? ????????? ??????? ?????????? ?
+???????, ??? ????? ????????????? ? ???????. ??? ?? ???, ?? ???? ?? ??????? ??? ????????? ?? ????? ???????? ?
+&quot;Procrustes&quot;. ????????, ??? ??????? ? ???, ??? ? ????? ? ????? ?????? ????? ??????? ?????????????
+??????-???????????. ?????? ????? ???????? ???? ????????? ?? ??????? ?????????? ??????????????. ? ??????, ???
+??????? ?????? ?????????? ?? ????? ?? ?????? ????????? ?????, ? ??? ?? ????? ??? ??????? ?????, ?????? ? &quot;
+<i>????? ?? ?????</i>&quot;.</div>
+
+<div class="author">dev0</div> 
+
+
+<h4>&quot;??????? ?????????? ????????? ???????/??????-???????????/?????? ????? ???? ?????????????&quot;</h4>
+
+<div class="quote">?????? ????? ????, ??? ? ????? ? ?????? Enigma 1.00, ? ?????????? ? &quot;Procrustes&quot;.
+??? ??????? ??????? ??????? &mdash; ???? ????????, ??? ????? ???????????? ??????? ??????????? ?????-???????????,
+????? ????????? ??????, ?? ?????? ????? ??????-??????????? ??? ??????? ???????, ? ?????? &mdash; ??????? ?????????!
+?? ?? ????? ??? ????????, ????? ???? ?????? (??? ????????????), ?? ?? ????? ?????????? ??????? ???????????.
+?? ? ??????????? ??????? ??????????? ?? ????? ??????? ???????, ??????? ?????? ????? F5 ? ?????? ????? ??????
+?? &quot;Ariadne&quot;. ? ??????????? ?????? ? ?? ???????? ?? ??????, ????? ???????? &quot;Procrustes&quot;,
+??????? ?????? ?????????? ??? ? ?????-?? ????????? ??????????????? ????????? &mdash; ??????, ??? ??? ??????
+? ???? ????? ?????? ????????? ? ???? ?????????????? ?????????.</div>
+
+<div class="quote">??? ?? ? ????????! ????????? ???? ?????? ? ?????? &quot;???? ? ?????: ??????? ? ???? ??????? ??????&quot;
+??????? ?????? ? ????? ??? ???: ????????, ?????????. &quot;???? ????????? ??? ???????? ????????????, ?? ??
+????????? ??? ????????? ????. '????? ???????! ??? ???? ??????? ???? ??? ????, ??? ????, ?? ?? ????? ??? ????????.'
+??????? ???????? ????????????? ????, ? ?? ??????? ?????????? ??????? ??????? ??? ??????? ????.&quot; &hellip;</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_b.jpg" alt="??????? ??????" border="0">
+</div>
+
+<div class="quote">??? ???? ???????? ????????. ? ????????? ???, ??????????? ?????? ???????, ? ?????, ????????? ?????????????
+????? ???? ??????? ?????????? ????????? ???????/??????-???????????/??????. ?? ?????? ???????? ?????? ??? ??????? ??
+???????: ??? ??????????????? ? ???????? ??????? ???? ?? &quot;???????????&quot; ? ?????. ?????? ??? ??????, ??? ?????
+??? ???????? ???????, ?? ?? ?????: ????? ?????? ???????????? ?????? ?????????????? ??????????? ? ?? &quot;Push? Pull!&quot;.
+? ?? ???? ?????????? ?? ?????? ?????? Enigma ? ????? ??????????? ??????????? ? ???????. ?????? ???????? ????? ??? ??????
+???? ??????? &mdash; ??? ???? ?????? ?? ??????. ?????????????? ?????? ????????? ??????.</div>
+
+<div class="quote">??? ????????? ????? ????, ??? ????? ? &quot;Procrustes&quot; ???? ???? ??? ? ????? ????????? ??? ??
+?????? ?????? &mdash; ????? ??? ??? ???? ????. ??????? ???? ?????????? ?????, ??????? ????????? ??? ??????? ??????.
+?? ?????, ?? ????? ?????? ???????, ? ???? ??? ??? ???? ? ??? ??????? ????????? ???? ????? ????? ? ??? ????. ??? ??????
+??????? ??????, ????? ??????????? ????????????? ?? ??? ?? ??????? (????????? &quot;libpuzzle&quot;), ???????
+???????????? ??????? ??? ?????? ??? &mdash; ??? ???? ??????????? ??????. ?????? ??? ????? ?????????? ????? ?????????,
+??????? ?????? ? ????, ????? ?? ??????. ? ? ????? ??????, ?? ?? ?? ???????? ? ???????????? ??????????, ??? ????????
+??????, &mdash; ??????? ?? ?????? ????????, ??? ?????? ? ??????????????????. ????????, ?? ???? ?????? ????????????
+??????? ?? ??????? ???? ????????? ?????.</div>
+
+<div class="author">Dominik Leipold</div>
+
+
+<h4>????? ? ??????? ?????? &quot;Procrustes&quot;, ? ??? ?????? ????????.</h4>
+
+<div class="quote">??? ??????? ??? ? ?????, ??? ????? ??????-???????????: ?? ?????? ?????? ????????, ??? ??? ????????
+???????? ???? ????? ?? ????????. ? ??? ?????? ????? &mdash; ?? ???????? ??? ???? ????? ?? ????? ?????????????? ????????????
+Enigma, ??? ?? ???? ??????. ? ?????, ??-?? ????????? ????? ???????, ??????? ???? ????? ????????? ? Enigma, ? ???????
+??? ? ????????, ???? ?? ??????? ? ???? ???????.</div>
+
+<div class="quote">???? ????? ?, ???????, ?????? ?? ???? ???????. ? ?????? ?????, ??? ????? ??????-???????????
+????????????? ???????? ???????? ?? ???????? ? ???? &mdash; ???? ? ? ?????????? ???????????, ? ?? ???, ??? ?
+????????????? ???????????. ????? ????????? ????? ?????, ? ??? ? ??? ??????? ?????????????, ??? ??????, ?? ???
+???-?? ??????? ????????? ????????????? ????????? ?????? ? ????????? ??? ??? ??????? ?????????.</div>
+
+<div class="quote">? ????? ??? ??? ???? ???????????? ??????? ?? Andreas'?. ??-?????, ????? ????? ?????? ???? ?? ???
+???????, ? ???????????? ????? ? ???????? ??????. ? ????, ??? ???? ??????? ?????? ? &quot;?????????? ???????&quot;
+? ??? ???????? ??? ????????, ?? ? ????? ?? ??? ????????? ? ?????, ??????? ???? ???? ??????? ??????, ???? ???????
+????????. ??? ???????????? Andreas'? ?? ????? ??????? ????????????? ????, ??????? ??? ???????? ??????.</div>
+
+<div class="author">Lukas Sch&uuml;ller</div>
+
+
+<h4>&quot;??????? ???????? ????? ?????????? ??????? ? ????????&quot;</h4>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_n.jpg" alt="??????? ??????" border="0">
+<div class="imagetitle">????????</div>
+</div>
+
+<div class="quote">??????? &mdash; ??? ?? ??????????? ??????? ??????????? ???????????? ???, ??? ??????
+???? ????????? ? ?????? ?????? ??????? ????????????. ?????? ?????????????? ?????
+???? ?? ????? ????? ? ????????? ?????????. ????? ?? ????? ???????? ???????? ???
+???????? (= ?????, ?????????? ??????????, ??? ????????? ??? &mdash; &quot;Damastes&quot;),
+??????, ??????? ???????????, ???????? ?????????????? ??????????? ?
+??????????????, ?? ? ??? ?? ???????? ???????? ? ????????? ?? ????????
+? ???? ?? ???? ???: ???, ??? ??? ????????, &mdash; ? ???????, ? ????? ??????????
+?? ?? ???? ????? ????, ??????? &mdash; ? ???????? ?????????, ?? ?????????
+?????????? ????? ?????????? ??? ??????? ??????????? ????. ?????? ?????
+??????? ???????? ??????.</div> 
+
+<div class="quote">? ???? ?????? ?? ?????? ? ????? ????????? ? ??????????? ? ???? ??????.
+??? ????????? ? ???? ??????-??????????? ??? ???? ?????? ?????????????????.
+? ?????? ???????, ????? ??????, ?? ????? ???????????? ????????? ?????????,
+??????? ?????, ????? ???????? ??????? ? ?????????? ????? &quot;????&quot; ??????.
+??????, ????? ??????? ????? ? ????? ????????? ???, ??? ?????-???????????
+???????? ????????? ?? ? ??? ????? ??? ???????? ?? ??????? ? ??????? ??
+?????? ?????? ?????? ?????? (??? F3).</div> 
+
+<div class="quote">???? ????, ??? ?? ???????? ? ?????? ?????? ????? ??????, ? ?????? ??????
+??? ????? ??? ???? ?????? ??????. ????? ??????????? ????? ? ?????????
+???????? ????? ?????? ????????? ???????????? ??????. ? ???????, ?????
+??? ??????????? ? ???, ????? ???????? ??? ??????????? ????????????, ???
+???????? ?? ?????? ?????? ???????? ?? ???? ???????. ????????
+??????????????? ????????????? ???????????? &mdash; ? ???????? ? ????????????
+?????? ??????. ? ??????, ?????? ???? ??????-??????? ????? ????????.
+????? ????????, ??? ?????????? ????? ??????? ???????? ????? ?????????
+?????????? ? ??????! ???????, ????? ????????? ?????, ??? ??????? ??????
+? ?? ??????? ????, ?????? ???? ??????? ? ?????????? ???????. ??????!</div> 
+
+<div class="quote">??????? ???????? ????? ?????????? ??????? ? ????????. ??? ????????, 
+???? ?????? &mdash; ?????? ???????????, ? ??????? ???????? ?????? ?? ??????
+?????????? ???? ????. ????? ??????????? ?????-??????????? ????? ??????
+?????????? ?????????? ??????? ? ????????????; ??? ??????? ???????
+Enigma ? Oxyd ??? ????? ?? ?????? ????????????? ?????????. ?????????
+?????????? ?????????? ????????????? ?????????? ???????????????.
+?????????? ? ??????? ??????? ????. ????? ????????, ??? ???????????
+?????????? ?????? ?? ????? ??????? ??????? ? ???????? ??? ????????????
+??????????? ????? ????????? ??????. ????????, ????? ??????????, ? ?????
+? ???.</div> 
+
+<div class="quote">? ????? ??? ??????? ??????? ???????, ??? ??????????? ????????????.</div>
+
+<div class="author">Martin</div>
+
+
+<h4>&quot;Procrustes ??????? ??????, ??? ??????? ?? ?????? ??????&quot;</h4>
+
+<div class="quote">??, ????????, ?? ??? ?? ??? ?????, ??????? ??????? ? ?????????? ?????,
+????? ??? ??? ??? ?????????? ? ??? ???????? ?????????, ?????? ????? ????????? ???????
+??????, ????????? &mdash; ????????, ?? ???? ?? ?????? ??????? ??????. ?????? ????????
+????-???? ??? ???????, ????????? ????????? ????????, ?????????? ?? ? ??????? ? &hellip;
+?? &hellip; ??? <i>??? ??????</i> ?? ?????????? &quot;Procrustes&quot; &hellip;</div>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200812_c.jpg" alt="??????? ??????" border="0">
+</div>
+
+<div class="quote">????? ????? ??????????? ? ?????? Tarim'?, ????? ?? ??????? ????? ? Procrustes
+(??? ??????????? ??, ???? ?? ????? ??? ???????? ??????? ??????). 
+Procrustes ??????? ??????, ??? ??????? ?? ?????? ??????. ???? ????? ????? ????????? ? ?????????
+??????? ????? ? ?????, ????? ????? ??????????????? ????????? ????????, ????? ??????? ?????? ??????
+? ??????? ??? ???????.</div>
+
+<div class="quote">??????, ??? <i>?????</i> ????, ??? Tarim ????? ???????, ?? ?????? ????? ???????, ?????
+??? ?????????? ????: ????? ?? ?? ???????? ?????-???? ?????????? &quot;????&quot; ????? ????????? ?
+????? ????? ?? ??????? ????? ??????? ??? ????? ?? ??? ??? ?????, ????? ?????? &quot;????&quot;
+????? ???????????? ? &quot;bed&quot;. ??? ?????? ?? ?? ?????? ???????????? &quot;????? ????&quot;,
+?? ???????? <i>???</i> ???????? ???????, ??? ?????????? ???? ?????? ?? ??????? ???????. ?????? ??
+?????-?????? Tarim ?????? ? ??????? ?? ????? ???? ????????? ? ????????????</div>
+
+<div class="author">Tarim</div>
+
+
+<h4>??????? ? ?????, ??? ????????? ? ??????? ????? ??????</h4>
+
+<div class="quote">????? ? ??????? ??????? ???????? ?? ???? ??????, ? ???????, ??? ??? ????? ??????? ???????.
+????? ??????, ??? ??? ?? ???, ??? ???????????? ?? ??? ????? ???????. ??? ??????? ???????, ????? ??? ??? ????????.</div>
+ 
+<div class="quote">??????? ?? ????? ???????, ? ?? ???? ?????? ????? ????? ???, ??? ?? ??????. ?????? ?? ??????,
+??????? ????????, ?? ?????? ?????? ??? ????????????. ??????? ?? ??????, ???????? ?????? ?? ??????-???????????,
+???????? ??????. ??????? ??????, ? ????? ?? ????????? ?? ?????? ???????, ?? ?????? ????????? ??? ????
+?????? ?? ??? ???????? ?????????? ?????? ? ?? ??? ??????? ?????? ?????. ???? ?????? ????????? ???????
+??????????? ?? ?????? ???????, ?? ???????? ???????? ????? ? ?????? ?????? ?????? ???????.</div>
+
+<div class="quote">??-?? ????, ??? ? ??? ?? ??? ????? ?????, ??? ????? ???????? ?????? ????? ?????????. ???? ??
+????????? ????????????, ?? ?????? ??????? ? ??? ???????? ?????? ??????? ??????. ??????? ? ?????, ???
+????????? ? ??????? ????? ??????&hellip; ??? ???? ?????? ?????. ?? ???? ??????? ? ???????? ????????? ????.
+?????? ???, ???????? ???, ? ??????? ????: ??? ??? ????????? ???????, ? ?????? ??? ? ????? ???-?? ?? ???
+? ???????? ??? ???????? ???????. ?????????? ????????, ???????????, ????? ????????? ???? ?? ???? ??????,
+?? ???????? ? ??????? ???????, ? ?? ????? ??????? ? ??? ????? ???? ???? ???????. ?????????? ??????????&hellip;</div>
+
+<div class="quote">&quot;Procustes&quot; &mdash; ??? ???????, ?? ??????? ????? ? ??????? ??????. ?? ??????? ?????
+?? ???????? ? ???????? ?? ????? ????????. ???? ??????? ? ???????? ???????? ??????????? ?????? ???????????.
+??, ????? ? ??? ??? ?????????, ?? ?????? ???????? ?????????.</div> 
+
+<div class="quote">??? ???????? ???? ???????, ?? ??????????, ?? ??????? ??????? ??? ????. ???? ?? ??? ????????,
+??? ?? ????? ??? ??????? ??????? ?? ???, ??? ?????? Andreas.</div>
+
+<div class="author">Xang</div>
+
+
+<p>Andreas Lochmann ????? ??????? ?????? ?????? ??? ?? ??????? ???????????? ??????????, ? ???? ?????????, ?&hellip; 
+
+<h4>&quot;???? ? ?????&quot;</h4>
+
+<p>????? Enigma, ???? ?????????? ????????! ?? ?????? ? ???? ? ?????????? ???????? ??????????: ???????????? ??????,
+??????????? ????? ? ????? ????? ???????. ?? ???????: &quot;????? ?????? ???? ????!&quot;. ??? ???????, ??? ??????
+???: ??? ???????? ???????? &mdash; ????? ???? ??? ??????????? ???? ?????? ?????-???????????&hellip; ???????????
+???????, ???! ?????????? ??! ?????????, ??????? ?? &mdash; ???? ?? ?? ??????? ??? ? ????. ??????? ????????
+????????? ? ??????, ?? ?????? ?????????? ? ??????? ???????&hellip;</p>
+
+<p>????? ?????? ???? &mdash; ????????! ? ?????? ?? ???-?????! ???????? ????? ???????, ? ?????? ???????????
+??????? ??????? ???? ?????? ???????????? 4? ???????? ???????????: &quot;??? ????!&quot;, ??????? ?? ?????,
+?? ???????? ??????????, &quot;??????? ?????? ? ???????, ??? ????? ???????. ???????????? ????? ?????? ? ????
+??????? ???????, ??, ?????????? ??????? ????????, ??????????? ???? ? ????. ??, ??? ? ???????: '????? ??????
+???? ????'&quot;&hellip;</p>
+
+<h4>&quot;???? ? ????? (????? 2)&quot;</h4>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_l.jpg" alt="??????? ??????" border="0">
+<div class="imagetitle">??? &hellip;</div>
+</div>
+
+<p>? ??????? ????? ???????, ? ?????????? &quot;?????? ????&quot; (????. &quot;poete de feu&quot;). ?????????
+???????: &quot;????, ??????????? ?? ??????-???????????, ???????????? ????? ???? ???????, ????????? ? ???????
+??????&quot;. ??? ??? ??? ????? ?????????: &quot;?????? ????????? ???????? ?????-???????????, ?????????? ?
+??????? ???? ??? ??????? ?????????, ?? ????? ????????? ?????????????? &mdash; ? ???????????? ??????-???????????
+&mdash; ??????????? &mdash; ??????????? ??????. ??????? ??, ???????? ??????? ???????, ???????????? ???
+????????? ??????, ??? ? ???????? ??????? (??? ?????!) &mdash; ?, ???????, ????? ????? ??????????? ???? ????
+??????? ????? ???????, ?? ?????? ????? ??????? ?? ?????, ????? ??????? ?? ???????????, ???????, ???????
+?????? &quot;?????&quot;. ? ??? ????? ???? ???? &mdash; ????? ???? ????????? ?????? ? ??? ???? ????? ??????.
+?????? ???????? ??????? ??????????? ????????? ? ????????: ??????????? &mdash; ? ???, ??? ?? ??????? ??????????
+? ????????? ? ????&hellip;</p>
+
+<h4>&quot;? ?????? ? ??????????&quot;</h4>
+
+<p>????????? ??????????? ????????? ????????! ? ???? ??????? ???? ???? ???-?? ??????&hellip; ??????? ????????
+??????????: ???????? ?? ????????? ??????, ?????, ????????? ???????? ?????? ?????????. ????? ??????? ??????????
+?? ???????? ????? ??????. ???? ??? ???????, ?? ??????? ???: &quot;????? ?????? ???? ????&quot;. ? ??? ??????
+?????????? ?????????? ?????-???????????: ???????? ???????? ????, ??? ????????? ????????, ???-?????, ????????
+???????????, ?????? ??????? &mdash; ?? ?????? ?????????.</p>
+
+<p>? ?? ????? ???????? ???????????? ?? ?????? ?? ??????? Enigma, ??????????? ?????????: Andreas, ??? ????????
+?? ??????? ???????? ????? ???????! ??? ???? ????????? ????? ?????? ??? ????????? ????????? ????? ??? ??????
+????? ????? ? ????? ??????? ???????, ?? ??? ?????? ???? ? Enigma.</p>
+
+<h4>&quot;??????? ??? ??????, ??&hellip; &quot;</h4>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200812_h.jpg" alt="??????? ??????" border="0">
+</div>
+
+<p>???? ???????????? ??????? ????????? ??????? ????????? ????? ????????. ????????? ?????????? ????????????
+????????? ? ??????? ?????? ???????? ?????????. ??? ?? ????, ???? ??????? ??? ?????? ? ???????-?????????????:
+&quot;????? ?????? ???? ????&quot;. ????????? ?????? ??? ?????? ?? ?????? ??????????? &mdash; ??? ????? ????
+????????????? ?????? ??????? ?????? ????????? ???????&hellip; ??? ?? ?? ??? ????? ????????????? ??????? ??????
+?????-??????????? ?? ??????????????? ??????? &quot;????????? ????? ????????? '????', ????? ??? ?????????????
+'???????????' ?????&quot;. ??? ?? ?????? ?? ???????? ???-?? ??????. &quot;???, ? ?? ?????????&hellip; &quot;.
+?????? ????????? ? &quot;????????????&quot; ?? ????? ????????????.</p>
+
+?? ?????? ??????????: 
+
+<p>Andreas, ?? ??? ???? ?? ???? ????? ??? ? ???????? ? ?????????? ???? ?? ????? ???????, ??? ???
+&quot;?????????&quot; ?????????.</p>
+
+<div class="author">Mecke </div>
+
+
+<h4>Non multa, sed multum (?????. ??????? &quot;??????? &mdash; ?? ??????????...&quot;)</h4>
+
+<div class="quote">??? ????????? ????????? ?????? ?????? ? ???? ? ??????, ???, ????????, ? ? ?????? ??????,
+????? ?? ???????? ???????. ????? ?????? ?? ???????????? ?????? ??????? ????????, ? ???????? ???? ????
+(?????? ? ??????????) ??????????? ????????? ? ????????????, ? ????? ???????, ??? ?????? ??????????? ????
+??????? ? ????????? ???????, ????? ?????? ??????????? ? ?? ????? ???????????? ?????????????,
+?????????? ?? ????????.</div>
+
+<div class="quote">??, ?????? ?????, ??? ???????????? Andreas'? ? ??? ?????? ???????? ?? ??. ?? ??????? 12
+???????????? ?????? ?? ???????????? ???????, ? ???? ?? ?????? ???????, ??? ?? ??? ????????? ???????????
+? ?????????? ????????? 6 ? ??? ?????? ?? ??????? ???: ??. Andreas, ?? ???????? ???, ???? ????? ???
+??????????. ;-) &quot;Procrustes&quot; ?? ????? ???? ??????????.</div>
+
+<div class="quote">? ??????? ???????? ????, ? ????? ??????????? ? &quot;Quadropolis&quot; Andreas ?????,
+??? ? ????? ??????? ??? ???????? ???????????? ????? ??????? Enigma. ??? ?? ?????? ??????????? ??? &quot;Procrustes&quot;,
+?? ????????? ? ????, ? Enigma ?? ???????? ??? ?????? ??????, ??? ??????? ?????-??????????? ???????????? ????? ????????????
+???????? ??? ????????????? ??????, ??? ? &quot;Procrustes&quot;, ?? ? ???? ?? ??????????? ? ???????? ??????? ????: ??
+?????? ?????? ??? ? ?????? ?????????? ??????.</div>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200812_i.jpg" alt="??????? ??????" border="0">
+</div>
+
+<div class="quote">??, ??? ?? ?? ????? ???????? ????????? ?????? ???????? ???? ???????, ????? ????????? ?
+?????????? ???????????. ? ????? 4.3.45 ???????? ??????????? ????????? ?????????????? ??????-???????????, ? ?
+????? 4.6 ???? ?????, ?????????? ????? ??????? ????????? ???? ? Enigma 1.0. ??????, &quot;Procrustes&quot;
+&mdash; ???????????? ??????? Andreas'?, ??? ?????????? ??????? ?????-???????????, ? ?? ??? ????? ??? 46 1/4
+??????? Enigma.</div>
+
+<div class="quote">???????????? ??????? ?? ?????????????? ????? &mdash; ??? ???? ?? ??????, ?? ??????? ? ?????
+? ????????????? ????????? ? &quot;Procrustes&quot; ?? ?????????? ????????? ???? ???, ?????? ??????? &mdash; ??????,
+??????????? ???????: ???? Andreas ?? ????? ???????????? ???????????? ?? ??????? ?? ????????? ???????, ?? ??????
+??????????? ?? 7-6-5-4-3-2-1 ????? ??????? ????. ?? ???????? ??? ????????? ???????????? ? ??? ??????? ??? ????? ?
+????? ? ?????? ??? ??? ??????? ??????????? ??? ????????? ???????????? ????? ??????? ?? ???????, ?? ? ??? ??? ??
+?????????? ???????? ??? ?? ???????????????? ?????? ?????????? ?? ????????? ??????????? &mdash; ??????? Ronald'?.</div>
+
+<div class="quote">?????, ?? ????? ???? ???? ???? ? ?????? ??? ???-???? ?? ????? ????????: ??, ??? ? ?? ????
+???????????? ?????????? ????, ??????? ????? ?????????? ? &quot;Procrustes&quot;, ? ????????????? ? ??? ????,
+??? ?? ? ????????? ??????? ??????. ?? ? ???????, ??? ????? ??? ????????. ;-) </div>
+
+<div class="quote">??????? ??????? Moneymaker'? ?? ?????????? ????????? ;-) ?, ???????, Andreas'? ??
+?????????????? ???????. :-) </div>
+
+<div class="author">Daydreamer</div>
+
+
+<h4>?????? ?? 8-? ???????? 2006-?? ????:</h4>
+
+<div class="quote">&quot;??????,</div>
+
+<div class="quote">????? ????????? ???????????? ??????? ??????? (?????
+VI, 31-40) ?????? ????? &quot;?????????&quot;. ??? ????? ???????
+????????? ???????? ??????????? ???? ??? ???????.
+??? ? ???? ??????? ? ????????? ??????? ??? ?????
+?????? :-) </div>
+
+<div class="quote">[&hellip;]&quot;</div>
+
+<p>??? ????????? ?? ??? ??? ????? ????????, ? Enigma ??????
+????? ????????? ???????????? ??????? ???????. ??????????? ?????,
+? ???? ???????, ??? ????????? ?? ??? ??? ???????? ??????, ????????, ?????
+??? ????????? ??????? ??? ?????-?????, ????????? ?????? (????? ???
+??????? ??????? II/81-90). ??????? ???? ????? ?? ????? ????? ? Raoul'??
+??????? ????????????? ??????? Enigma 1.00. ????????? ????????, ????????????
+? ????????????? ?????????????????, ???? ??????? ??????? ? ????? ?????? V.
+??????, ????? ?????????????? ?????????????????, ??? ?? ???????????? ??????
+1.00 ? Enigma ???? ????????? ???? ???????, ??????? ???? ???????? ??????
+???????????? ?? ????? ????????. ??????? ?????????, ??????????????, ???????
+?????? 1.00, ??????? ???????? &quot;Procrustes&quot;, ????????? ??????
+???????????? ?? ?????? ? ?? ?????. ??????? ??? ???? ???? ???? ????? ???
+?????????????? ?? ??? ?????? ??????: &quot;Sisyphus&quot; ? &quot;Zeus&quot;. ????? ????, ???
+?? ??????????? ???? ??????? ???????????? ??????? &quot;Troy&quot; &mdash; ???????-??????,
+??????? ???????? ?????? ? ?????????? ???????? (???? &quot;????&quot; ???????? ??
+????????????? ????????? ?????, ?? ????? ?? ????????), ?? ? ????? ??? ????
+?????. ????? ????, ?????, ? ?????????????? ??????? ??? ??????? &quot;Phaeton&quot;.</p>
+
+<p>????, ??????? ????? ???????? ??????, ????????????? ? ???? &quot;?????????&quot;.
+????? ? ????? ???? ??????, ???????????? ??? ????????? ???? ??????? ?????? ?
+??????, ????????? ???? ??? ???????. ????? ??? ??? ? &quot;Prometheus&quot;&hellip;
+??????? ? ????? ? ????????? ?????????? ??????? ???????? ???????? ??????????????
+????, ?? ? ????? ????? ?? ? ????, ?? ??? ??????, ???? ?? ????? ??????? ?????? ??????.
+??????, &quot;Prometheus&quot; ??? ??????? ? ?? ??? ??????????. ???????? ????????? ? ?????
+?????????????? ??????, ??????? ????? ???????????? ??????????. ????? ????? ??? ??? ????,
+???? ? ?????? ????????? ????????????? ??????????? ?????? &quot;Janus&quot;.</p>
+
+<p>??????????? ?????, ? ??? ??? ???? ???????, ??????? ? ???????, ??? ?????
+??????????? ? ?????????? ? ??????? ????????? Enigma. ?????????? ??-??
+????? ??? ????????? ???? ????????? ??? ???? ? ???????. ? ??????? ?? ?????, ??????
+? ???? ????? ? ?????????. ??????? ? ????????? ???????????? ?????, ? ?????????????
+??? ????? ?????????? ?????: ??????? ??, ??? ??????? ???? ???????? ???????, ??????? ??,
+??? ??????? ???? ??????? ????????, ? ?? ?????, ????? ?????. ??? ???? ?????? ????? ????
+??????????? ? Enigma!</p>
+
+<p>??? ????, ????? ? Enigma ???-?? ????? ??????????? ??? ???????????, ??? &quot;???-??&quot;
+?????? ???????? ?? ?????????? ??????, ????????, ??????-???????????. ? ????
+?? ??? &quot;???-??&quot; ?????? ???? ??????????? ? ???-??, ??? ?????? ?? ???-?? ????????????&mdash;
+????? ??? ?????-???????????! ??? ???? ???? ??????????? ????????? ?????
+libpuzzle Raoul'?. ??? ??? ? ???????? ???? (??????, ? ??????). ???????????????
+????? ??????????? ??????? ??????, ?????, ? ??????? ?? ???????? ????????, ? ?????
+??? ??????? ???????? ??????? ??????. ? ???? ?????? ?????? ??? &quot;????&quot; ??? ???? ???????????
+???????, ? ??????? ??? ????????????. ?? ????? ?? ???????? ?????????: ????? ?
+???????, ???????????? ???????????? ???? ?? ????????????, ? ??????? ????????????
+????? ???? ?? ??? ?????? &mdash; ??? ????? ?????? ?? ??????? ?????. ? ??? ??? ?????????
+?????? ??????? ? ????????? ? ?????? ??? ????? ???????????? ????????? ???????,
+???, ????? ????? ???????, ? ????????? ???? ???? ????????? ????????. ?? ??? ?????????
+(??? ?? ???-???? ????????? ???????????? ??????!) ? ???????? ????????? ??????,
+????? ???? ? ?????? ??????? ????? ?????? ?? ???????? ????????? ?????????.</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200812_m.jpg" alt="??????? ??????" border="0">
+<div class="imagetitle">???? ?? ?????? ??????</div>
+</div>
+
+<p>? ?????? ? ?? ??? ??????, ??? ??? ???????? ??????? ? ????? ?? ???????????? ?????.
+????? ??????? ????????? ???? ??? ??? ???? ? ??????????, ??????? ? ????
+???????????? ??? ?? ???? ??????? ????. ? ?????? ???????, ??? ???????????
+???????????? ? ???????? ???????? ??????? ?????, ??????? ?????? ???? ??????????
+? ????? ??????? ????????? ????. ????, ??? ?????? ? ??????? ?? ????? &quot;it_death&quot;,
+??????, ??????? ?? ????????. ?? ?????? ???? ??????????, ?????????
+?????????????, ? ??? ???? ??????. ? ?????? ???????? ?????? ?????? ? ???? ????
+????, ??????? ?????? ?????????? ? ??????. ??, ??? ????? ?????? ???????????
+?????????? ?????-??????????? ?? ?????? ???????? ????????? ?????????????, ?????
+?????? it_death? ?? ?????????. ? ????? ? ??????????? ?? ???? ? ????????????.
+?? ??? ?? ???????, ????? ???? ??????????, ? ????? ???????????</p>
+
+<p>???????, ??? ???? ????? ??????? ?????????, ??? ??? ????????, ? ????? ????????????
+?????. ? ???????? ????? ????? ???????, ?? ? ????? ?????? ???????? ?
+&quot;emergency plan sand&quot;. ????? ? ??? ??? ??????? ??? ???? ????????, ?????? ???
+Siegfried Fennig ??????? ???, ??? ??? ???? ??????, ???????????? ? ??? ????? ? ?
+&quot;Procrustes&quot;, ??????? ?????????? ?? ???? ????????????? ?????. ?????????
+???????????? ???, ???? ?? ????? ??????? ?? ?????, ? ????? ??? ??? ?????????
+???????????? &quot;Procrustes&quot;. ??, ????????? ? ???????, ??? ???? ????? ? ?????? ??????,
+??????? ????? ?????????? ?? ????????? ????? ?????, ?? ?????? ???????? ???
+???? ?????? ? Enigma. ??? ??? ???? ??????, ??? &quot;Procrustes&quot; ???? ?????????????
+?????????, ??? ? ??? ??????? ????????? ????, it_death ? libpuzzle.</p>
+
+<p>&quot;Procrustes&quot; ???????? ??? ???? ???????????? &mdash; ??? ????? ?????????????? ???????,
+??? ??????? ? ???????????? ??????? ?????????? ? ?? ????????? ?????????????, ? ??
+????, ??? ? ?????? ????? ??? ?????????? ???? ??????????? ??????? ?????? ??? ?????
+??????, ????????? ?????????? ?????? ?? ?????? ? ???????-?????????????, ???????
+? ????????, ????? ???????? ????????????? ??????. ? ??????? ?? ????? ???????? ???
+????????????, ?????? ??? ?? ?????? ?? ???? ??????? ???? ??????? ?????? &mdash;
+??????? ??????? ???? ???????, ? ???????, ??? ???? ??? ?? ????????? ??????, ??? ???
+??????!</p>
+
+<div class="author">Andreas Lochmann</div>
+
+<p>
+? ??????????? ??? ? IV/2,<br>
+<i>???? ??????? Enigma!</i>
+</p>
+
+<p>????????? ????????, ??? ?????? ????? ???? ?????? ? ??????? ??????? Enigma. ??????????,
+?????????? ??? ????? ??????, ??? ???? ???????????, ??????? ?? ???????? ?? ?????????? ??????:</p>
+<pre>
+<a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
+</pre>
+<p>? ?????????, ??? ?????????? ?????? ? ????????? ???????:
+</p>
+<ul>
+<li>&quot;Plan Ahead&quot; ?? Jacob Scott</li>
+<li>&quot;Little Puzzles&quot; ?? Jon 'WB' Sneyers</li>
+</ul>
+<p>??????? ??????? ???????, ?????? ???? ?????? ????? ????????? ??!</p>
+
+<p><i>???? ??????? Enigma</i></p>
+
+</div>



From andreasl at mail.berlios.de  Sun Dec 28 13:35:19 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Sun, 28 Dec 2008 13:35:19 +0100
Subject: [Enigma-game-svn] r1416 - homepage/input/lotm
Message-ID: <200812281235.mBSCZJQW001452@sheep.berlios.de>

Author: andreasl
Date: 2008-12-28 13:35:17 +0100 (Sun, 28 Dec 2008)
New Revision: 1416

Modified:
   homepage/input/lotm/lotm_200812_de.html
   homepage/input/lotm/lotm_200812_ru.html
Log:
Homepage:
 - Typos in German article (thanks to Nobby)
 - "..." -> "&hellip;"
 - Validation (was nothing to do)
Todo:
 - Upload


Modified: homepage/input/lotm/lotm_200812_de.html
===================================================================
--- homepage/input/lotm/lotm_200812_de.html	2008-12-28 11:44:18 UTC (rev 1415)
+++ homepage/input/lotm/lotm_200812_de.html	2008-12-28 12:35:17 UTC (rev 1416)
@@ -10,16 +10,14 @@
 In den letzten beiden Jahren hatten wir an dieser Stelle bereits das
 Vergn&uuml;gen, ausf&uuml;hrlich &uuml;ber 10 epische Levels zu
 berichten, die sich dadurch auszeichneten, den Forschergeist und die
-Abenteuerlust im Spieler anzusprechen. Diese phantastischen Multi-Screen
-Welten erfreuen sich allergr&ouml;&szlig;ter Beliebtheit bei den
+Abenteuerlust im Spieler anzusprechen. Diese phantastischen Multi-Screen-Welten erfreuen sich allergr&ouml;&szlig;ter Beliebtheit bei den
 Spielern, wie ein Blick ins LdM-Archiv zeigt. Ebenso war es uns
 verg&ouml;nnt, 6 herausragende Zwei-, Drei- oder Vier-Screen Level
 vorzustellen. Vor zwei Monaten konnten wir dann endlich unseren
-ersten Level im klassischen One-Screen Format pr&auml;sentieren:
+ersten Level im klassischen One-Screen-Format pr&auml;sentieren:
 &quot;Industrial Puzzles&quot; von Raoul Bourquin. Und nun wartet
-bereits der zweite Vertreter dieser Levelspezies darauf, die LdM
-B&uuml;hne betreten zu d&uuml;rfen und seinen Preis in Empfang zu
-nehmen. Obwohl von der gleichen Art k&ouml;nnten die beiden Level kaum
+bereits der zweite Vertreter dieser Levelspezies darauf, die LdM-B&uuml;hne betreten zu d&uuml;rfen und seinen Preis in Empfang zu
+nehmen. Obwohl von der gleichen Art, k&ouml;nnten die beiden Level kaum
 unterschiedlicher sein. &quot;Industrial Puzzles&quot; ist reichlich mit
 den verschiedensten Objekten ausgestattet (fast ist man geneigt
 &quot;&uuml;berfrachtet&quot; zu sagen), die Enge des Raumes ist schon
@@ -191,7 +189,7 @@
 <div class="quote">Bisher dachte ich, dass der Name des Levels irgendetwas mit Feuer zu tun hat; so in der Art, dass etwas durch Verbrennen eine 
 'Kruste' erh&auml;lt, LOL! Ich sah schlichtweg die innewohnende anthropomorphe Symbolik nicht und l&ouml;ste die Puzzles 
 gem&auml;&szlig; der vorliegenden Gegebenheiten. Als ich mich f&uuml;r meinen Kommentar mit dem Level wieder vertraut machte, 
-schlug ich &quot;Procrustes&quot; nach. Es ist wahrlich geschickt (klasse?) wie perfekt Andreas Lochmann die Symbolik des 
+schlug ich &quot;Procrustes&quot; nach. Es ist wahrlich geschickt wie perfekt Andreas Lochmann die Symbolik des 
 mythologischen Charakters in seinem Level umgesetzt hat &mdash; sehr, sehr clever!</div>
 
 <div class="quote">Zwar ist das Level nicht so komplex und schwierig wie die meisten anderen LdM, trotzdem erf&uuml;llt es m.E. in jeder Hinsicht
@@ -203,21 +201,21 @@
 <h4>&quot;Keine der Meditationen besitzt f&uuml;r mich einen so starken meditativen Aspekt wie &quot;Procrustes&quot;&quot;</h4>
 
 <div class="quote">Zwei oder drei Stunden nach Mitternacht. Aus den Kopfh&ouml;rern kommen die ersten T&ouml;ne einer Lap 
-Steel Guitar - ein langsamer Countrysong ... Irgendwie bekannt ... &quot;<i>Well she's walking 
-through the clouds with a circus smile that's running round</i> ... &quot; - &Auml;h! - Wie bitte? - 
-&quot;Little Wing&quot; interpretiert als Countrysong? ...  &quot;<i>It's alright</i>&quot; ...  
+Steel Guitar - ein langsamer Countrysong &hellip; Irgendwie bekannt &hellip; &quot;<i>Well she's walking 
+through the clouds with a circus smile that's running round</i> &hellip; &quot; - &Auml;h! - Wie bitte? - 
+&quot;Little Wing&quot; interpretiert als Countrysong? &hellip;  &quot;<i>It's alright</i>&quot; &hellip;  
 Und wie! Das funktioniert tats&auml;chlich! Der Hammer!</div>
 
-<div class="quote">Tja, das war das Aus f&uuml;r das aktuelle Level. Die Konzentration war wie weggeblasen ... 
-&quot;<i>It's alright</i>&quot; ... Und Replay ... Und nochmal.</div>
+<div class="quote">Tja, das war das Aus f&uuml;r das aktuelle Level. Die Konzentration war wie weggeblasen &hellip; 
+&quot;<i>It's alright</i>&quot; &hellip; Und Replay &hellip; Und nochmal.</div>
 
 <div class="quote">&quot;Procrustes&quot; war erstmal Geschichte - eine ohne Ende.</div>
 
 <div class="quote">In den n&auml;chsten Wochen ging mir &quot;Procrustes&quot; geschickt aus dem Weg; aber wahrscheinlich 
-wares eher anders herum. Letztendlich f&uuml;hrte aber dann kein Weg mehr daran vorbei. Also machte 
+war es eher anders herum. Letztendlich f&uuml;hrte aber dann kein Weg mehr daran vorbei. Also machte 
 ich mich an die ausstehende L&ouml;sung. Die Playlist war auf 'random' gestellt. Ich startete 
 &quot;Procrustes&quot;, rein zuf&auml;llig begann auch der n&auml;chste Song: Die ersten T&ouml;ne 
-einer Lap Steel Guitar erklangen ... Schlagartig erinnerte ich mich, dass es dieses Level war, als 
+einer Lap Steel Guitar erklangen &hellip; Schlagartig erinnerte ich mich, dass es dieses Level war, als 
 ich &quot;Little Wing&quot; in dieser eigenwilligen Interpretation das erste Mal h&ouml;rte. Nur 
 Zufall?</div>
 
@@ -312,18 +310,18 @@
 
 <div class="quote">Was getan werden muss, ist nicht zu kompliziert, schlie&szlig;lich handelt es sich um ein WYSIWYG-Level. 
 Nichts ist verborgen, keine Verstecke, alles ist auf einen Blick zu erkennen. Der Anfang ist ansprechend; 
-zun&auml;chst muss einen Abgrund umgeben von einem Flammenmeer durchquert werden. Zur &Uuml;berwindung 
+zun&auml;chst muss ein Abgrund umgeben von einem Flammenmeer durchquert werden. Zur &Uuml;berwindung 
 dieses Hindernisses gilt es, aus den Puzzlesteinen ein passendes Gebilde zu bauen. Hat man die andere Seite 
 erreicht, erwartet einen dieselbe Aufgabenstellung. Allerdings geht es nun enger zu, und das Puzzlegebilde 
 muss dazu auch noch l&auml;nger werden. Um die zus&auml;tzlich ben&ouml;tigten Puzzleteile heranzuschaffen, 
 leistet der Feuerl&ouml;scher, strategisch clever eingesetzt, unersetzliche Dienste.</div> 
 
 <div class="quote">Hier muss aufgrund des knapp bemessenen Platzes vorsichtig agiert werden, um sich nicht 
-den Weg zu versperren, was dann zu einem Neustart zwingen w&uuml;rde.Anfangs dachte ich, dieses Level sehr
-schnell l&ouml;sen zu k&ouml;nnen ... Aber das war wohl nur ein Wunschtraum. Ich verbrachte einige Tage damit. 
-Bei jedem weiteren Versuch sagte ich mir: &quot; Das ist das letzte Mal&quot;. Aber jedesmal machte ich irgendetwas falsch,
+den Weg zu versperren, was dann zu einem Neustart zwingen w&uuml;rde. Anfangs dachte ich, dieses Level sehr
+schnell l&ouml;sen zu k&ouml;nnen &hellip; Aber das war wohl nur ein Wunschtraum. Ich verbrachte einige Tage damit. 
+Bei jedem weiteren Versuch sagte ich mir: &quot;Das ist das letzte Mal&quot;. Aber jedesmal machte ich irgendetwas falsch,
 und ich musste von vorne beginnen. Dieses Level ist eine subtile Sch&ouml;pfung, und man kann Einiges an Zeit 
-f&uuml;r die L&ouml;sung ben&ouml;tigen. Gutes Gehirn-Jogging ...</div>
+f&uuml;r die L&ouml;sung ben&ouml;tigen. Gutes Gehirn-Jogging &hellip;</div>
 
 <div class="quote">&quot;Procrustes&quot; ist leicht und angenehm zu spielen: Kein Rotor jagt der Murmel hinterher, und 
 Schnelligkeit spielt keine Rolle. Die Hauptaufgabe besteht im Verschieben und Anordnen von Puzzlesteinen. 
@@ -386,11 +384,20 @@
 
 <div class="quote">Wem nicht klar sein sollte, wie gut das Ganze ausgekl&uuml;gelt ist, dem mag an dieser Stelle ein Blick ins Referenzhandbuch empfohlen sein: In Kapitel 4.3.46 weden die Besonderheiten der Puzzlesteine genauestens beschrieben, und in Kapitel 4.6 das neue Feuer-System von Enigma 1.0 erl&auml;utert. &quot;Procrustes&quot; ist &uuml;brigens der einzige Level von Andreas, in dem die blauen Puzzlesteine auftauchen, und das obwohl er es immerhin schon auf 46 1/4 Levels gebracht hat.</div>
 
-<div class="quote">Die Einzigartigkeit des Br&uuml;ckenbauman&ouml;vers war der eine Grund, warum ich &quot;Procrustes&quot; im Laufe der letzten zwei Jahre immer wieder gerne einen Besuch abgestattet habe, der andere war die angegebene L&ouml;sungszeit des Autors: Obwohl Andreas nun nicht gerade daf&uuml;r bekannt ist, dass er mit phaetonischer Geschwindigkeit durch die Levels reist, war er doch immer 7-6-5-4-3-2-1 Minuten schneller unterwegs als ich. Im Laufe der Zeit kam ich seinem Rekord zwar immer n&auml;her, und es gelang mir immer wieder neue L&ouml;sungsmethoden zu erfinden, die aber immer noch Lichtjahre entfernt waren von der vermeintlich optimalen L&ouml;sungszeit - von der Bestzeit von Ronald.</div>
+<div class="quote">Die Einzigartigkeit des Br&uuml;ckenbauman&ouml;vers war der
+eine Grund, warum ich &quot;Procrustes&quot; im Laufe der letzten zwei Jahre
+immer wieder gerne einen Besuch abgestattet habe, der andere war die angegebene
+L&ouml;sungszeit des Autors: Obwohl Andreas nun nicht gerade daf&uuml;r bekannt
+ist, dass er mit phaetonischer Geschwindigkeit durch die Levels reist, war er
+doch immer 7-6-5-4-3-2-1 Minuten schneller unterwegs als ich. Im Laufe der Zeit
+kam ich seinem Rekord zwar immer n&auml;her, und es gelang mir immer wieder neue
+L&ouml;sungsmethoden zu erfinden, die aber immer noch Lichtjahre entfernt waren
+von der vermeintlich optimalen L&ouml;sungszeit - von der Bestzeit von
+Ronald.</div>
 
 <div class="quote">Tja, und das war eigentlich das Einzige, was mir an dem Level bisher nicht so sehr gefallen hat: Dass es mir einfach nicht gelingen wollte, den k&uuml;rzest m&ouml;glichen L&ouml;sungsweg f&uuml;r die Operation &quot;Procrustes&quot; zu finden, und somit die Tatsache, dass nicht ich es war, der die Bestzeit hielt. Aber ich hoffe, dass ich diesen Malus irgendwann in der k&uuml;rzeren Vergangenheit beseitigen konnte. ;-) </div>
 
-<div class="quote">Vielen Dank an Moneymaker f&uuml;r die verbale Volage ;-) - und nat&uuml;rlich an Andreas f&uuml;r den genialen Level. :-) </div>
+<div class="quote">Vielen Dank an Moneymaker f&uuml;r die verbale Vorlage ;-) - und nat&uuml;rlich an Andreas f&uuml;r den genialen Level. :-) </div>
 
 <div class="author">Daydreamer</div>
 

Modified: homepage/input/lotm/lotm_200812_ru.html
===================================================================
--- homepage/input/lotm/lotm_200812_ru.html	2008-12-28 11:44:18 UTC (rev 1415)
+++ homepage/input/lotm/lotm_200812_ru.html	2008-12-28 12:35:17 UTC (rev 1416)
@@ -461,7 +461,7 @@
 <div class="author">Mecke </div>
 
 
-<h4>Non multa, sed multum (?????. ??????? &quot;??????? &mdash; ?? ??????????...&quot;)</h4>
+<h4>Non multa, sed multum (?????. ??????? &quot;??????? &mdash; ?? ??????????&hellip;&quot;)</h4>
 
 <div class="quote">??? ????????? ????????? ?????? ?????? ? ???? ? ??????, ???, ????????, ? ? ?????? ??????,
 ????? ?? ???????? ???????. ????? ?????? ?? ???????????? ?????? ??????? ????????, ? ???????? ???? ????



From ral at mail.berlios.de  Sun Dec 28 16:31:21 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 28 Dec 2008 16:31:21 +0100
Subject: [Enigma-game-svn] r1417 - in trunk: data data/schemas src
	src/actors src/stones
Message-ID: <200812281531.mBSFVLoO015396@sheep.berlios.de>

Author: ral
Date: 2008-12-28 16:31:18 +0100 (Sun, 28 Dec 2008)
New Revision: 1417

Added:
   trunk/src/actors/BugActor.cc
   trunk/src/actors/BugActor.hh
   trunk/src/actors/HorseActor.cc
   trunk/src/actors/HorseActor.hh
   trunk/src/actors/KillerActor.cc
   trunk/src/actors/KillerActor.hh
   trunk/src/actors/Rotors.cc
   trunk/src/actors/Rotors.hh
Modified:
   trunk/data/api1init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/Object.cc
   trunk/src/actors.cc
   trunk/src/actors.hh
   trunk/src/actors/Balls.hh
   trunk/src/ox_extra.cc
   trunk/src/oxyd.cc
   trunk/src/stones/FakeStone.cc
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering
- actors rotor and top
  - renamed to ac_rotor, ac_top
  - attribute "gohome" switched to bool
  - attribute "attacknearest" switched to bool
  - attribute "force" renamed to "strength"
- actor horse:
  - renaming to ac_horse
  - attribute "force" renamed to "strength"
  - attribute "target1" to "target4" eliminated 
  - support of attribute destination to define arbitrary move targets
- actor bug
  - renamed to ac_bug
- actor killer(ball)
  - renamed to ac_killer


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/data/api1init.lua	2008-12-28 15:31:18 UTC (rev 1417)
@@ -45,9 +45,14 @@
 }
 
 RenamingObjectsNew2Old = {
+    ac_bug = "ac-bug",
+    ac_horse = "ac-horse",
+    ac_killer = "ac-killerball",
     ac_marble_black = "ac-blackball",
     ac_marble_white = "ac-whiteball",
     ac_pearl_white = "ac-whiteball-small",
+    ac_rotor = "ac-rotor",
+    ac_top = "ac-top",
     fl_abyss = "fl-abyss",
     fl_bridge = "fl-bridge",
     fl_hay = "fl-hay",
@@ -587,7 +592,8 @@
          _key = "coin_value"
      end
      if key == "force" and (_obj_name == "st-actorimpulse" or
-             _obj_name == "st-actorimpulse_invisible")  then
+             _obj_name == "st-actorimpulse_invisible" or _obj_name == "ac-horse" or
+             _obj_name == "ac-rotor" or _obj_name == "ac-top")  then
          _key = "strength"
      end
      if key == "friction_factor" then
@@ -676,6 +682,12 @@
      if key == "blinking" then
          _key = "state"
      end
+     if key == "attacknearest" then
+         if val == 1 then _val = true else _val = false end
+     end
+     if key == "gohome" then
+         if val == 1 then _val = true else _val = false end
+     end
      enigma._SetAttrib(obj, _key, _val)
 end
 
@@ -692,7 +704,8 @@
          _key = "coin_value"
      end
      if key == "force" and (_obj_name == "st-actorimpulse" or
-             _obj_name == "st-actorimpulse_invisible")  then
+             _obj_name == "st-actorimpulse_invisible" or _obj_name == "ac-horse" or
+             _obj_name == "ac-rotor" or _obj_name == "ac-top")  then
          _key = "strength"
      end
      if key == "friction_factor" then
@@ -799,6 +812,12 @@
      if key == "movable" then
          if val == false then val = 0 else val = 1 end
      end
+     if key == "attacknearest" then
+         if val == false then val = 0 else val = 1 end
+     end
+     if key == "gohome" then
+         if val == false then val = 0 else val = 1 end
+     end
      return val
 end
 

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/data/models-2d.lua	2008-12-28 15:31:18 UTC (rev 1417)
@@ -168,7 +168,7 @@
 
 -- ac-killerball --
 do
-    DefAlias("ac-killerball", "ac_pearl_white")
+    DefAlias("ac_killer", "ac_pearl_white")
 end
 
 -- Marbles in inventory  --
@@ -184,7 +184,7 @@
 -- ac-bug --
 do
     SpriteImage("fg-bug",0.5,0.44)
-    DefShModel("ac-bug", "fg-bug", "sh-whiteball-small")
+    DefShModel("ac_bug", "fg-bug", "sh-whiteball-small")
 end
 
 -- ac-cannonball --
@@ -196,7 +196,7 @@
 do
     SpriteImage("fg-horse",0.5,0.18)
     SpriteImage("sh-horse", 0.4)
-    DefShModel("ac-horse", "fg-horse", "sh-horse")
+    DefShModel("ac_horse", "fg-horse", "sh-horse")
 end
 
 -- ac-rotor --
@@ -209,7 +209,7 @@
         DefShModel("ac-rotor"..i, fg[i], bg[i])
         table.insert(frames, "ac-rotor"..i)
     end
-    DefAnim("ac-rotor", BuildFrames(frames, 30), true)
+    DefAnim("ac_rotor", BuildFrames(frames, 30), true)
 end
 
 -- ac-top --
@@ -222,7 +222,7 @@
         DefShModel("ac-top"..i, fg[i], bg)
         table.insert(frames, "ac-top"..i)
     end
-    DefAnim("ac-top", BuildFrames(frames, 25), true)
+    DefAnim("ac_top", BuildFrames(frames, 25), true)
 end
 
 --------------------------------------------------------------------------------

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/data/schemas/objects.xml	2008-12-28 15:31:18 UTC (rev 1417)
@@ -6,6 +6,7 @@
     <attr name="algorithm" type="string" default="std" rw="rw"/>
     <attr name="anchor1" type="tokens" default="nil" rw="rw"/>
     <attr name="anchor2" type="tokens" default="nil" rw="rw"/>
+    <attr name="attacknearest" type="bool" default="true" rw="rw"/>
     <attr name="autoclose" type="bool" default="false" rw="rw"/>
     <attr name="burnable" type="bool" default="nil" rw="rw"/>
     <attr name="charge" type="double" default="0" rw="rw"/>
@@ -30,6 +31,7 @@
     <attr name="floodable" type="bool" default="false" rw="rw"/>
     <attr name="freeze_check" type="bool" default="false" rw="rw"/>
     <attr name="friction" type="double" default="nil" rw="rw"/>
+    <attr name="gohome" type="bool" default="true" rw="rw"/>
     <attr name="gradient" type="double" default="nil" rw="rw"/>
     <attr name="hit_factor" type="double" default="nil" rw="rw"/>
     <attr name="hit_distortion_xx" type="double" default="1" rw="rw"/>
@@ -61,6 +63,7 @@
     <attr name="orientation" type="int" default="0" min="0" max="3" rw="rw"/>
     <attr name="oxydcolor" type="int" default="-1" min="-4" max="7" rw="rw"/>
     <attr name="player" type="int" default="nil" min="0" max="1" rw="rw"/>
+    <attr name="prefercurrent" type="double" default="0.0" rw="rw"/>
     <attr name="push_directions" type="string" default="nil" rw="rw"/>
     <attr name="range" type="double" default="1.0" rw="rw"/>
     <attr name="rubbers" type="group" default="nil" rw="r"/>
@@ -171,6 +174,16 @@
       <attr name="essential_id"/>
       <attr name="charge"/>
     </object>
+    <object name="ac_bug">
+    </object>
+    <object name="ac_horse">
+      <attr name="destination"/>
+      <attr name="strength" default="10.0"/>
+    </object>
+    <object name="ac_killer">
+      <attr name="destination"/>
+      <attr name="strength" default="10.0"/>
+    </object>
     <object name="ac_marble">
       <attr name="color" default="0"/>
       <msg name="_appear"/>
@@ -216,6 +229,20 @@
     <object name="ac_pearl_white">
       <attr name="color" value="1"/>
     </object>
+    <object name="ac_rotor">
+      <attr name="range" default="5.0"/>
+      <attr name="strength" default="10.0"/>
+      <attr name="gohome"/>
+      <attr name="attacknearest"/>
+      <attr name="prefercurrent"/>
+    </object>
+    <object name="ac_top">
+      <attr name="range" default="5.0"/>
+      <attr name="strength" default="10.0"/>
+      <attr name="gohome"/>
+      <attr name="attacknearest"/>
+      <attr name="prefercurrent"/>
+    </object>
     <object name="fl" abstract="true">
       <attr name="adhesion"/>
       <attr name="burnable"/>

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/Makefile.am	2008-12-28 15:31:18 UTC (rev 1417)
@@ -146,6 +146,14 @@
 	XMLtoUtf8.hh		\
 	actors/Balls.cc		\
 	actors/Balls.hh		\
+	actors/BugActor.cc	\
+	actors/BugActor.hh	\
+	actors/HorseActor.cc	\
+	actors/HorseActor.hh	\
+	actors/KillerActor.cc	\
+	actors/KillerActor.hh	\
+	actors/Rotors.cc	\
+	actors/Rotors.hh	\
 	floors/BridgeFloor.cc	\
 	floors/BridgeFloor.hh	\
 	floors/FloodStream.cc	\

Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/Object.cc	2008-12-28 15:31:18 UTC (rev 1417)
@@ -374,7 +374,7 @@
                 ObjectList ol = (*tit).getObjectList(this);  // convert next token to an objectlist
                 for (ObjectList::iterator oit = ol.begin(); oit != ol.end(); ++oit) {
                     GridObject *go = dynamic_cast<GridObject *>(*oit);  // get the object
-                    if (go != NULL) {   // no actors as destination!
+                    if (go != NULL) {   // no actors and deleted objects as destination!
                         GridPos p = go->get_pos();
                         if (IsInsideLevel(p)) {   // no objects in inventory,...
                             if (i == idx) {

Modified: trunk/src/actors/Balls.hh
===================================================================
--- trunk/src/actors/Balls.hh	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/actors/Balls.hh	2008-12-28 15:31:18 UTC (rev 1417)
@@ -75,7 +75,7 @@
         
         virtual void on_creation(const ecl::V2 &pos);
         virtual void think (double dtime);
-        virtual void on_respawn (const ecl::V2 &pos);
+        virtual void on_respawn(const ecl::V2 &pos);
 
         virtual void move_screen();
         virtual void hide();

Added: trunk/src/actors/BugActor.cc
===================================================================
--- trunk/src/actors/BugActor.cc	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/actors/BugActor.cc	2008-12-28 15:31:18 UTC (rev 1417)
@@ -0,0 +1,52 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "actors/BugActor.hh"
+//#include "errors.hh"
+//#include "main.hh"
+#include "world.hh"
+
+namespace enigma {
+
+/* -------------------- Bug  -------------------- */
+
+    Bug::Bug() : Actor (traits) {
+    }
+
+    std::string Bug::getClass() const {
+        return "ac_bug";
+    }
+
+    const char *Bug::get_kind() const {
+        return "ac_bug";
+    }
+
+    bool Bug::is_dead() const {
+        return false;
+    }
+        
+    ActorTraits Bug::traits = {"ac_bug", ac_bug, 1<<ac_bug, 12.0/64, 0.7};
+    
+    BOOT_REGISTER_START
+        BootRegister(new Bug(), "ac_bug");
+    BOOT_REGISTER_END
+
+} // namespace enigma
+


Property changes on: trunk/src/actors/BugActor.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/actors/BugActor.hh
===================================================================
--- trunk/src/actors/BugActor.hh	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/actors/BugActor.hh	2008-12-28 15:31:18 UTC (rev 1417)
@@ -0,0 +1,48 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef BUGACTOR_HH
+#define BUGACTOR_HH
+
+#include "actors.hh"
+#include "ecl_math.hh"
+
+namespace enigma {
+
+    /** 
+     * Bug
+     */
+    class Bug : public Actor {
+        CLONEACTOR(Bug);
+        DECL_ACTORTRAITS;
+ 
+   public:
+        Bug();
+        
+        // Object interface.
+        virtual std::string getClass() const;
+        virtual const char *get_kind() const;
+
+        // Actor interface
+        virtual bool is_dead() const;
+    };
+
+} // namespace enigma
+
+#endif /*BUGACTOR_HH*/


Property changes on: trunk/src/actors/BugActor.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/actors/HorseActor.cc
===================================================================
--- trunk/src/actors/HorseActor.cc	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/actors/HorseActor.cc	2008-12-28 15:31:18 UTC (rev 1417)
@@ -0,0 +1,79 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "actors/HorseActor.hh"
+//#include "errors.hh"
+//#include "main.hh"
+#include "world.hh"
+
+namespace enigma {
+
+/* -------------------- Horse  -------------------- */
+
+    Horse::Horse() : Actor (traits), m_targetidx(-1), m_target() {
+        setAttr("strength", 10.0);
+    }
+
+    std::string Horse::getClass() const {
+        return "ac_horse";
+    }
+
+    const char *Horse::get_kind() const {
+        return "ac_horse";
+    }
+
+    bool Horse::is_dead() const {
+        return false;
+    }
+    
+    void Horse::think(double dtime)  {
+        double force = getAttr("strength");
+        update_target ();
+        if (m_targetidx != -1) {
+            add_force(normalize(m_target - get_pos()) * force);
+        }
+        Actor::think(dtime);
+    }
+
+    void Horse::update_target() {
+        ecl::V2 newPos;
+        if (m_targetidx == -1) {
+            // no target defined so far
+            if (getDestinationByIndex(0, newPos)) {
+                m_target = newPos;
+                m_targetidx = 0;
+            }
+        } else if (length(m_target - get_pos()) < 0.2) {
+            // target reached or? try next one
+            if (getDestinationByIndex(++m_targetidx, newPos)) {
+                m_target = newPos;
+            } else
+                m_targetidx = -1;     // failed -> start anew
+        } 
+    }
+    
+    ActorTraits Horse::traits = {"ac_horse", ac_horse, 1<<ac_horse, 24.0/64, 1.2};
+    
+    BOOT_REGISTER_START
+        BootRegister(new Horse(), "ac_horse");
+    BOOT_REGISTER_END
+
+} // namespace enigma
+


Property changes on: trunk/src/actors/HorseActor.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/actors/HorseActor.hh
===================================================================
--- trunk/src/actors/HorseActor.hh	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/actors/HorseActor.hh	2008-12-28 15:31:18 UTC (rev 1417)
@@ -0,0 +1,58 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef HORSEACTOR_HH
+#define HORSEACTOR_HH
+
+#include "actors.hh"
+#include "ecl_math.hh"
+
+namespace enigma {
+
+    /** 
+     * Horse
+     */
+    class Horse : public Actor {
+        CLONEACTOR(Horse);
+        DECL_ACTORTRAITS;
+ 
+   public:
+        Horse();
+        
+        // Object interface.
+        virtual std::string getClass() const;
+        virtual const char *get_kind() const;
+//        virtual void setAttr(const string& key, const Value &val);
+
+        // Actor interface
+        virtual bool is_dead() const;
+        virtual void think (double dtime);
+
+    private:
+        // Variables
+        int m_targetidx;
+        ecl::V2 m_target;
+        
+        // Private methods
+        void update_target();
+    };
+
+} // namespace enigma
+
+#endif /*HORSEACTOR_HH*/


Property changes on: trunk/src/actors/HorseActor.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/actors/KillerActor.cc
===================================================================
--- trunk/src/actors/KillerActor.cc	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/actors/KillerActor.cc	2008-12-28 15:31:18 UTC (rev 1417)
@@ -0,0 +1,59 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "actors/KillerActor.hh"
+//#include "errors.hh"
+//#include "main.hh"
+#include "world.hh"
+
+namespace enigma {
+
+/* -------------------- Killer  -------------------- */
+
+    Killer::Killer() : Actor (traits) {
+        setAttr("adhesion", Value(2.0));
+        setAttr("color", Value(WHITE));
+        setAttr("controllers", Value(3));
+    }
+
+    std::string Killer::getClass() const {
+        return "ac_killer";
+    }
+
+    const char *Killer::get_kind() const {
+        return "ac_killer";
+    }
+
+    bool Killer::is_dead() const {
+        return false;
+    }
+
+    void Killer::on_collision(Actor *a) {
+        SendMessage(a, "_shatter");
+    }
+    
+    ActorTraits Killer::traits = {"ac_killer", ac_killer, 1<<ac_killer, 13.0/64, 0.7};
+    
+    BOOT_REGISTER_START
+        BootRegister(new Killer(), "ac_killer");
+    BOOT_REGISTER_END
+
+} // namespace enigma
+


Property changes on: trunk/src/actors/KillerActor.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/actors/KillerActor.hh
===================================================================
--- trunk/src/actors/KillerActor.hh	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/actors/KillerActor.hh	2008-12-28 15:31:18 UTC (rev 1417)
@@ -0,0 +1,49 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef KILLERACTOR_HH
+#define KILLERACTOR_HH
+
+#include "actors.hh"
+
+namespace enigma {
+
+    /** 
+     * Killer
+     */
+    class Killer : public Actor {
+        CLONEACTOR(Killer);
+        DECL_ACTORTRAITS;
+ 
+   public:
+        Killer();
+        
+        // Object interface.
+        virtual std::string getClass() const;
+        virtual const char *get_kind() const;
+//        virtual void setAttr(const string& key, const Value &val);
+
+        // Actor interface
+        virtual bool is_dead() const;
+        virtual void on_collision(Actor *a);
+    };
+
+} // namespace enigma
+
+#endif /*KILLERACTOR_HH*/


Property changes on: trunk/src/actors/KillerActor.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/actors/Rotors.cc
===================================================================
--- trunk/src/actors/Rotors.cc	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/actors/Rotors.cc	2008-12-28 15:31:18 UTC (rev 1417)
@@ -0,0 +1,140 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "actors/Rotors.hh"
+#include "errors.hh"
+//#include "main.hh"
+#include "player.hh"
+#include "world.hh"
+
+namespace enigma {
+
+/* -------------------- RotorBase  -------------------- */
+
+    RotorBase::RotorBase(const ActorTraits &tr) : Actor (tr),  attackCurrentOnly(false), timeKeepAttackStrategy(0) {
+        setAttr("range", 5.0);
+        setAttr("strength", 10.0);
+        setAttr("gohome", true);
+        setAttr("attacknearest", true);
+        setAttr("prefercurrent", 0.0);
+    }
+
+    void RotorBase::setAttr(const string& key, const Value &val) {
+        if (key == "range")
+            range = val;
+        else if (key == "strength") 
+            force = val;
+        else if (key == "gohome") 
+            gohome = val;
+        else if (key == "attacknearest") 
+            attacknearest = val;
+        else if (key == "prefercurrent") 
+            prefercurrent = val;
+        Actor::setAttr(key, val);
+    }
+
+    bool RotorBase::is_dead() const {
+        return false;
+    }
+    
+    void RotorBase::think(double dtime)  {
+        double cforce = force/6;
+    
+        Actor *target = 0;
+        V2     target_vec;
+        timeKeepAttackStrategy  -= dtime;
+        if (timeKeepAttackStrategy < 0) {
+            timeKeepAttackStrategy = enigma::DoubleRand(0.8, 1.6);
+            attackCurrentOnly = (enigma::DoubleRand(0.0, 1.0) < prefercurrent);
+        }
+    
+        ActorsInRangeIterator air_it = ActorsInRangeIterator(this, range,
+                1<<ac_marble_white | 1<<ac_marble_black | 1<<ac_marble_white);
+        Actor *a;
+        while((a = air_it.next()) != NULL) {
+            if (a->is_movable() && !a->is_invisible()) {
+                V2 v = a->get_pos() - get_pos();
+                if (attacknearest && !attackCurrentOnly ||
+                        attackCurrentOnly && a == player::GetMainActor(
+                        player::CurrentPlayer())) {
+                    if (!target || (length(v) < length(target_vec))) {
+                        target = a;
+                        target_vec = v;
+                    }
+                } else if (!attackCurrentOnly) {            
+                    target = a;
+                    target_vec += normalize(v);
+                }
+            }
+        }
+    
+        if (!target && gohome) { 
+            // no actors focussed -> return to start position
+            target_vec = get_respawnpos()-get_pos();
+        }
+    
+        double target_dist = length(target_vec);
+    
+        if (target_dist > 0.2)
+            target_vec.normalize();
+        add_force(target_vec * cforce);
+    
+        Actor::think(dtime);
+    }
+    
+    void RotorBase::on_collision (Actor *a) {
+        SendMessage(a, "_shatter");
+    }
+
+/* -------------------- Rotor  -------------------- */
+    Rotor::Rotor() : RotorBase(traits) {
+    }
+    
+    std::string Rotor::getClass() const {
+        return "ac_rotor";
+    }
+
+    const char *Rotor::get_kind() const {
+        return "ac_rotor";
+    }
+
+    ActorTraits Rotor::traits = {"ac_rotor", ac_rotor, 1<<ac_rotor, 22.0/64, 0.8};
+
+/* -------------------- Top  -------------------- */
+    Top::Top() : RotorBase(traits) {
+    }
+
+    std::string Top::getClass() const {
+        return "ac_top";
+    }
+
+    const char *Top::get_kind() const {
+        return "ac_top";
+    }
+
+    ActorTraits Top::traits = {"ac_top", ac_top, 1<<ac_top, 16.0/64, 0.8};
+    
+    BOOT_REGISTER_START
+        BootRegister(new Rotor(), "ac_rotor");
+        BootRegister(new Top(), "ac_top");
+    BOOT_REGISTER_END
+
+} // namespace enigma
+


Property changes on: trunk/src/actors/Rotors.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/actors/Rotors.hh
===================================================================
--- trunk/src/actors/Rotors.hh	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/actors/Rotors.hh	2008-12-28 15:31:18 UTC (rev 1417)
@@ -0,0 +1,84 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef ROTORACTORS_HH
+#define ROTORACTORS_HH
+
+#include "actors.hh"
+
+namespace enigma {
+
+    /** 
+     * The base class for rotors and spinning tops
+     */
+    class RotorBase : public Actor {
+        
+    public:
+        RotorBase(const ActorTraits &tr);
+
+        // Object interface.
+        virtual void setAttr(const string& key, const Value &val);
+//        virtual Value getAttr(const std::string &key) const;
+        
+        // Actor interface
+        virtual bool is_dead() const;
+        virtual void think (double dtime);
+        virtual void on_collision(Actor *a);
+
+    private:
+        // Variables
+        double range;
+        double force;
+        bool   gohome;
+        bool   attacknearest;
+        double prefercurrent;
+        bool   attackCurrentOnly;
+        double timeKeepAttackStrategy;
+    };
+    
+/* -------------------- Rotor  -------------------- */
+    class Rotor : public RotorBase {
+        CLONEACTOR(Rotor);
+        DECL_ACTORTRAITS;
+        
+    public:
+        Rotor();
+        
+        // Object interface.
+        virtual std::string getClass() const;
+        virtual const char *get_kind() const;
+    };
+    
+/* -------------------- Top  -------------------- */
+    class Top : public RotorBase {
+        CLONEACTOR(Top);
+        DECL_ACTORTRAITS;
+        
+    public:
+        Top();
+        
+        // Object interface.
+        virtual std::string getClass() const;
+        virtual const char *get_kind() const;
+    };
+    
+
+} // namespace enigma
+
+#endif /*ROTORACTORS_HH*/


Property changes on: trunk/src/actors/Rotors.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/actors.cc	2008-12-28 15:31:18 UTC (rev 1417)
@@ -316,247 +316,7 @@
             return !(other->isSouthOrEastOf(this));
     }
 
-/* -------------------- RotorBase -------------------- */
 
-namespace
-{
-    /*! The base class for rotors and spinning tops. */
-    class RotorBase : public Actor {
-    public:
-        void   setAttr (const string& key, const Value &val);
-    protected:
-        RotorBase(const ActorTraits &tr);
-    private:
-        // Actor interface.
-        void think (double dtime);
-        bool is_dead() const { return false; }
-//         bool is_flying() const { return true; }
-        bool is_flying() const { return false; }
-//        bool is_on_floor() const { return false; } we need friction!
-
-	void on_collision (Actor *a) {
-	    SendMessage(a, "_shatter");
-	}
-
-        double range;
-        double force;
-        bool   gohome;
-        bool   attacknearest;
-        double prefercurrent;
-        bool   attackCurrentOnly;
-        double timeKeepAttackStrategy;
-    };
-}
-
-RotorBase::RotorBase(const ActorTraits &tr)
-: Actor(tr), attackCurrentOnly(false), timeKeepAttackStrategy(0)
-{
-    setAttr("range", 5.0);
-    setAttr("force", 10.0);
-    setAttr("gohome", 1.0);
-    setAttr("attacknearest", 1.0);
-    setAttr("prefercurrent", 0.0);
-}
-
-void RotorBase::setAttr(const string& key, const Value &val)
-{
-    if (key == "range")
-        range = to_double(val);
-    else if (key == "force") 
-        force = to_double(val);
-    else if (key == "gohome") 
-        gohome = (to_int(val) != 0);
-    else if (key == "attacknearest") 
-        attacknearest = (to_int(val) != 0);
-    else if (key == "prefercurrent") 
-        prefercurrent = to_double(val);
-    Actor::setAttr(key, val);
-}
-
-void RotorBase::think (double dtime)
-{
-    double cforce = force/6;
-
-    Actor *target = 0;
-    V2     target_vec;
-    timeKeepAttackStrategy  -= dtime;
-    if (timeKeepAttackStrategy < 0) {
-        timeKeepAttackStrategy = enigma::DoubleRand(0.8, 1.6);
-        attackCurrentOnly = (enigma::DoubleRand(0.0, 1.0) < prefercurrent);
-    }
-
-    ActorsInRangeIterator air_it = ActorsInRangeIterator(this, range,
-            1<<ac_marble_white | 1<<ac_marble_black | 1<<ac_marble_white);
-    Actor *a;
-    while((a = air_it.next()) != NULL) {
-        if (a->is_movable() && !a->is_invisible()) {
-            V2 v = a->get_pos() - get_pos();
-            if (attacknearest && !attackCurrentOnly ||
-                    attackCurrentOnly && a == player::GetMainActor(
-                    player::CurrentPlayer())) {
-                if (!target || (length(v) < length(target_vec))) {
-                    target = a;
-                    target_vec = v;
-                }
-            } else if (!attackCurrentOnly) {            
-                target = a;
-                target_vec += normalize(v);
-            }
-        }
-    }
-
-    if (!target && gohome) { 
-        // no actors focussed -> return to start position
-        target_vec = get_respawnpos()-get_pos();
-    }
-
-    double target_dist = length(target_vec);
-
-    if (target_dist > 0.2)
-        target_vec.normalize();
-    add_force (target_vec * cforce);
-
-    Actor::think(dtime);
-}
-
-
-/* -------------------- Rotor -------------------- */
-namespace
-{
-    class Rotor : public RotorBase {
-        CLONEACTOR(Rotor);
-        DECL_ACTORTRAITS;
-   public:
-        Rotor() : RotorBase (traits)
-        {
-        }
-    };
-}
-
-ActorTraits Rotor::traits = {
-    "ac-rotor",                 // name
-    ac_rotor,                   // id
-    1<<ac_rotor,                // id_mask
-    22.0f/64,                   // radius
-    0.8f                        // mass
-};
-
-
-/* -------------------- Spinning top -------------------- */
-namespace
-{
-    class Top : public RotorBase {
-        CLONEACTOR(Top);
-        DECL_ACTORTRAITS;
-    public:
-        Top() : RotorBase (traits)
-        {
-        }
-    };
-}
-
-ActorTraits Top::traits = {
-    "ac-top",                   // name
-    ac_top,                     // id
-    1<<ac_top,                  // id_mask
-    16.0f/64,                   // radius
-    0.8f                        // mass
-};
-
-/* -------------------- Bug -------------------- */
-
-namespace
-{
-    class Bug : public Actor {
-        CLONEACTOR(Bug);
-        DECL_ACTORTRAITS;
-    public:
-        Bug() : Actor(traits) {}
-        bool is_flying() const { return false; }
-        bool is_dead() const { return false; }
-        int get_id() const { return ac_bug; }
-    };
-}
-
-ActorTraits Bug::traits = {
-    "ac-bug",                   // name
-    ac_bug,                     // id
-    1<<ac_bug,                  // id_mask
-    12.0f/64,                   // radius
-    0.7f                        // mass
-};
-
-
-/* -------------------- Horse -------------------- */
-
-namespace
-{
-    class Horse : public Actor {
-        CLONEACTOR(Horse);
-        DECL_ACTORTRAITS;
- 
-        int get_id() const { return ac_horse; }
-        bool is_flying() const { return false; }
-        bool is_dead() const { return false; }
-
-        void think (double dtime);
-
-        // Private methods
-        void update_target ();
-
-        // Variables
-        int m_targetidx;
-        V2 m_target;
-   public:
-        Horse();
-    };
-}
-
-ActorTraits Horse::traits = {
-    "ac-horse",                 // name
-    ac_horse,                   // id
-    1<<ac_horse,                // id_mask
-    24.0f/64,                   // radius
-    1.2f                        // mass
-};
-
-Horse::Horse() 
-: Actor(traits),
-  m_targetidx(-1),
-  m_target()
-{
-    setAttr("force", Value(10.0));
-}
- 
-void Horse::think (double /* dtime */) 
-{
-    double force = getAttr("force");
-    update_target ();
-    if (m_targetidx != -1) {
-        add_force (normalize(m_target - get_pos()) * force);
-    }
-}
-
-void Horse::update_target () {
-    V2 newPos;
-    if (m_targetidx == -1) {
-        // no target defined so far
-        if (getDestinationByIndex(0, newPos)) {
-            m_target = newPos;
-            m_targetidx = 0;
-        }
-    } 
-    else if (length(m_target - get_pos()) < 0.2) {
-        // target reached or? try next one
-        if (getDestinationByIndex(++m_targetidx, newPos)) {
-            m_target = newPos;
-        } else
-            m_targetidx = -1;     // failed -> start anew
-    } 
-}
-
-
-
 /* -------------------- CannonBall -------------------- */
 
 namespace
@@ -619,50 +379,11 @@
 }
 
     
-//----------------------------------------
-// Balls of different sorts
-//----------------------------------------
 
-namespace
-{
-
-    class Killerball : public Actor {
-        CLONEACTOR(Killerball);
-        DECL_ACTORTRAITS;
-    public:
-
-        Killerball() : Actor (traits)
-        {
-            setAttr("adhesion", Value(2.0));
-            setAttr("color", Value(1.0));
-            setAttr("controllers", Value(3.0));
-        }
-        bool is_dead() const { return false; }
-
-	void on_collision(Actor *a) {
-	    SendMessage(a, "_shatter");
-	}
-    };
-}
-
-ActorTraits Killerball::traits = {
-    "ac-killerball",            // name
-    ac_killerball,              // id
-    1<<ac_killerball,           // id_mask
-    13.0f/64,                   // radius
-    0.7f                        // mass
-};
-
-
 /* -------------------- Functions -------------------- */
 
 void InitActors () 
 {
-    RegisterActor (new Bug);
-    RegisterActor (new Horse);
-    RegisterActor (new Rotor);
-    RegisterActor (new Top);
-    RegisterActor (new Killerball);
     RegisterActor (new CannonBall);
 }
 

Modified: trunk/src/actors.hh
===================================================================
--- trunk/src/actors.hh	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/actors.hh	2008-12-28 15:31:18 UTC (rev 1417)
@@ -30,7 +30,7 @@
         ac_marble_white  = 1,
         ac_pearl_black   = 2,
         ac_pearl_white   = 3,
-        ac_killerball = 4,
+        ac_killer     = 4,
         ac_rotor      = 5,
         ac_top        = 6,
         ac_horse      = 7,

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/ox_extra.cc	2008-12-28 15:31:18 UTC (rev 1417)
@@ -133,7 +133,7 @@
     0,                   // no stone
     0, 0, 0, 0, 0, 0, 0, 0,     // oxyd stones
     0, 0, 0, 0, 0, 0, 0, 0,     // oxyd stones
-    "st-fakeoxyd",       // OxydExtra stone 0x11
+    "st_fake_quake",     // OxydExtra stone 0x11
     "st-plain",          // OxydExtra stone 0x12
     "st-rock4",          // OxydExtra stone 0x13
     UNUSED,              // OxydExtra stone 0x14

Modified: trunk/src/oxyd.cc
===================================================================
--- trunk/src/oxyd.cc	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/oxyd.cc	2008-12-28 15:31:18 UTC (rev 1417)
@@ -502,99 +502,95 @@
         switch (marble.getMarbleType()) {
         case MarbleType_Black:
             ac = MakeActor("ac_marble_black");
-            ac->setAttr ("player", Value(0.0));
+            ac->setAttr("player", 0);
             break;
         case MarbleType_White:
-            ac = MakeActor ("ac_marble_white");
-            ac->setAttr ("player", Value(1.0));
+            ac = MakeActor("ac_marble_white");
+            ac->setAttr("player", 1);
             break;
         case MarbleType_Meditation:
             if (have_black_marble && !level.getHarmlessMeditationMarbles()) {
                 // # example: Oxyd Extra #28
-                ac = MakeActor ("ac-killerball");
+                ac = MakeActor ("ac_killer");
 //                ac->setAttr ("player", Value(0.0));
-                ac->setAttr ("mouseforce", Value (1.0));
-                ac->setAttr ("controllers", Value (3.0));
+                ac->setAttr("adhesion", 1.0);
+                ac->setAttr("controllers", 3);
             }
             else {
                 ac = MakeActor("ac_pearl_white");
                 nmeditationmarbles += 1;
 
                 if (config.twoplayers && (nmeditationmarbles % 2) == 0)
-                    ac->setAttr("player", Value(1.0));
+                    ac->setAttr("player", 1);
                 else
-                    ac->setAttr ("player", Value(0.0));
+                    ac->setAttr("player", 0);
             }
 
             if (minfo.is_default(MI_FORCE)) {
-                ac->setAttr("mouseforce", Value(1.0));
+                ac->setAttr("adhesion", 1.0);
             }
             else {
-                ac->setAttr("mouseforce", Value(minfo.get_value(MI_FORCE) / 32.0)); // just a guess
+                ac->setAttr("adhesion", (minfo.get_value(MI_FORCE) / 32.0)); // just a guess
             }
             break;
         case MarbleType_Jack:
-            ac = MakeActor ("ac-top");
+            ac = MakeActor("ac_top");
             if (!minfo.is_default(MI_FORCE)) {
                 double force = minfo.get_value(MI_FORCE) / 4; // just a guess
-                ac->setAttr("force", Value(force) );
-                enigma::Log << "Set jack force to " << force << endl;
+                ac->setAttr("strength", force);
+                enigma::Log << "Set jack strength to " << force << endl;
             }
             if (!minfo.is_default(MI_RANGE)) {
                 double range = minfo.get_value(MI_RANGE) / 32.0; // value seems to contain distance in pixels
-                ac->setAttr("range", Value(range) );
+                ac->setAttr("range", range);
                 enigma::Log << "Set jack range to " << range << endl;
             }
             break;
 
         case MarbleType_Rotor: {
-            ac = MakeActor ("ac-rotor");
+            ac = MakeActor("ac_rotor");
 
-            double force = minfo.get_value (MI_FORCE, 30) * 0.3;
-            double range = minfo.get_value (MI_RANGE, 100) / 32.0;
-            int gohome = minfo.get_value (MI_GOHOME, 1);
+            double force = minfo.get_value(MI_FORCE, 30) * 0.3;
+            double range = minfo.get_value(MI_RANGE, 100) / 32.0;
+            int gohome = minfo.get_value(MI_GOHOME, 1);
 
-            ac->setAttr ("force", force);
-            ac->setAttr ("range", range);
-            ac->setAttr ("gohome", Value (gohome));
+            ac->setAttr("strength", force);
+            ac->setAttr("range", range);
+            ac->setAttr("gohome", Value(gohome == 1));
 
-            enigma::Log << "rotor force " << force << endl;
+            enigma::Log << "rotor strength " << force << endl;
             enigma::Log << "rotor range " << range << endl;
             
             break;
         }
 
         case MarbleType_Horse: {
-            ac = MakeActor ("ac-horse");
+            ac = MakeActor("ac_horse");
             int levelw = level.getWidth();
+            ObjectList ol;
             if (!minfo.is_default(MI_HORSETARGET1)) {
                 int targetpos = minfo.get_value(MI_HORSETARGET1);
-                ac->setAttr("target1", ecl::strf("%d %d", 
-                                                   targetpos % levelw, 
-                                                   int(targetpos / levelw)));
+                ol.push_back(GetFloor(GridPos(targetpos % levelw, int(targetpos / levelw))));
             }
             if (!minfo.is_default(MI_HORSETARGET2)) {
                 int targetpos = minfo.get_value(MI_HORSETARGET2);
-                ac->setAttr("target2", ecl::strf("%d %d", 
-                                                   targetpos % levelw, 
-                                                   int(targetpos / levelw)));
+                ol.push_back(GetFloor(GridPos(targetpos % levelw, int(targetpos / levelw))));
             }
             if (!minfo.is_default(MI_HORSETARGET3)) {
                 int targetpos = minfo.get_value(MI_HORSETARGET3);
-                ac->setAttr("target3", ecl::strf("%d %d", 
-                                                   targetpos % levelw, 
-                                                   int(targetpos / levelw)));
+                ol.push_back(GetFloor(GridPos(targetpos % levelw, int(targetpos / levelw))));
             }
             if (!minfo.is_default(MI_HORSETARGET4)) {
                 int targetpos = minfo.get_value(MI_HORSETARGET4);
-                ac->setAttr("target4", ecl::strf("%d %d", 
-                                                   targetpos % levelw, 
-                                                   int(targetpos / levelw)));
+                ol.push_back(GetFloor(GridPos(targetpos % levelw, int(targetpos / levelw))));
             }
+            if (ol.size() > 0) {
+                ac->setAttr("destination", ol);
+            }
             break;
         }
         case MarbleType_Bug:
-            ac = MakeActor ("ac-bug");
+            ac = MakeActor("ac_bug");
             break;
         default:
             enigma::Log << "Unhandled actor type " << int(marble.getMarbleType()) << endl;
@@ -605,7 +601,7 @@
         }
 
         if (ac) 
-            AddActor (x, y, ac);
+            AddActor(x, y, ac);
 
         m_actors.push_back (ac);
     }

Modified: trunk/src/stones/FakeStone.cc
===================================================================
--- trunk/src/stones/FakeStone.cc	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/stones/FakeStone.cc	2008-12-28 15:31:18 UTC (rev 1417)
@@ -102,7 +102,7 @@
     
     void FakeStone::actor_hit(const StoneContact &sc) {
         if (((objFlags & OBJBIT_SUBTYP) >> 24) == QUAKE && state == IDLE) {
-            sound_event ("fakeoxyd");
+            sound_event("fakeoxyd");
             state = ACTIVE;
             init_model();
         } else

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-12-28 12:35:17 UTC (rev 1416)
+++ trunk/src/stones_simple.cc	2008-12-28 15:31:18 UTC (rev 1417)
@@ -330,7 +330,7 @@
 
         StoneResponse collision_response(const StoneContact &sc) {
             ActorID id = get_id(sc.actor);
-            if (id == ac_horse || id == ac_pearl_white || id == ac_killerball)
+            if (id == ac_horse || id == ac_pearl_white || id == ac_killer)
                 return STONE_PASS;
             else
                 return STONE_REBOUND;



From ral at mail.berlios.de  Sun Dec 28 18:39:24 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 28 Dec 2008 18:39:24 +0100
Subject: [Enigma-game-svn] r1418 - in trunk: data/schemas src src/others
Message-ID: <200812281739.mBSHdO3v005576@sheep.berlios.de>

Author: ral
Date: 2008-12-28 18:39:22 +0100 (Sun, 28 Dec 2008)
New Revision: 1418

Modified:
   trunk/data/schemas/objects.xml
   trunk/src/actors.cc
   trunk/src/others/Rubberband.cc
Log:
Trunk 1.1: new API reengineering
- actors
  - add attributes "velocity_x", "velocity_y" - actor speed on creation for
    initial moving actors (does not reflect current velocity on runtime)
- rubberband:
  - another correction now for actor-stone rubbers for strong forces


Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-28 15:31:18 UTC (rev 1417)
+++ trunk/data/schemas/objects.xml	2008-12-28 17:39:22 UTC (rev 1418)
@@ -77,6 +77,8 @@
     <attr name="target" type="tokens" default="nil" rw="rw"/>
     <attr name="transparent" type="bool" default="false" rw="rw"/>
     <attr name="threshold" type="double" default="0" rw="rw"/>
+    <attr name="velocity_x" type="double" default="nil" rw="rw"/>
+    <attr name="velocity_y" type="double" default="nil" rw="rw"/>
     <attr name="wires" type="group" default="nil" rw="r"/>
     <attr name="$chargesign" type="int" default="0" min="-1" max="1" rw=""/>
     <attr name="$firetransform" type="string" default="" rw=""/>
@@ -173,6 +175,8 @@
       <attr name="essential"/>
       <attr name="essential_id"/>
       <attr name="charge"/>
+      <attr name="velocity_x"/>
+      <attr name="velocity_y"/>
     </object>
     <object name="ac_bug">
     </object>

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2008-12-28 15:31:18 UTC (rev 1417)
+++ trunk/src/actors.cc	2008-12-28 17:39:22 UTC (rev 1418)
@@ -211,11 +211,16 @@
     m_sprite = display::AddSprite(get_pos());
 }
 
-void Actor::on_creation(const ecl::V2 &p) 
-{
+void Actor::on_creation(const ecl::V2 &p)  {
+    if (Value vx = getAttr("velocity_x")) {
+        m_actorinfo.vel = V2(vx,  m_actorinfo.vel[1]);
+    }
+    if (Value vy = getAttr("velocity_y")) {
+        m_actorinfo.vel = V2(m_actorinfo.vel[0], vy);
+    }
     set_model(get_kind());
-    m_sprite.move (p);
-    move ();
+    m_sprite.move(p);
+    move();
 }
 
 void Actor::on_respawn (const ecl::V2 &/*pos*/) {

Modified: trunk/src/others/Rubberband.cc
===================================================================
--- trunk/src/others/Rubberband.cc	2008-12-28 15:31:18 UTC (rev 1417)
+++ trunk/src/others/Rubberband.cc	2008-12-28 17:39:22 UTC (rev 1418)
@@ -181,6 +181,22 @@
             force = - (1 + 0.8 / numRubbers) * relspeed * vn / dt * ai->mass;  // damping for inverse friction and multiconnections
 //            Log << "Rubber stone force "<< force1 << "  " <<relspeed<< "\n";
             
+            // in case one actor is blocked the length can exceed the limits due to later force corrections
+            // in the last timestep - we need to correct possible small errors before they sum up
+            if (isMax && (len > maxLength) && (relspeed <= 0) && !(objFlags & OBJBIT_MAXVIOLATION)) {
+                double dlen = ecl::Min(len - maxLength, len - (minLength + eps));
+                dlen = ecl::Max(0.0, dlen);
+                force = (ai->mass * dlen / dt / dt) * vn;
+            }
+            if (isMin && (len < minLength) && (relspeed >= 0) && !(objFlags & OBJBIT_MINVIOLATION)) {
+                double dlen = len - minLength;
+                if (maxLength > 0) {
+                    dlen = ecl::Max(len - minLength, len - (maxLength - eps));
+                    dlen = ecl::Min(0.0, dlen);
+                }
+                force = (ai->mass * dlen / dt / dt) * vn;
+            }
+            
             // eliminate limit violations by moderate forces
             if (isMax && (objFlags & OBJBIT_MAXVIOLATION)) {
                 force += server::RubberViolationStrength * vn;



From ral at mail.berlios.de  Sun Dec 28 18:51:32 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 28 Dec 2008 18:51:32 +0100
Subject: [Enigma-game-svn] r1419 - team_levelpacks/team_test_new_api
Message-ID: <200812281751.mBSHpWcr019092@sheep.berlios.de>

Author: ral
Date: 2008-12-28 18:51:13 +0100 (Sun, 28 Dec 2008)
New Revision: 1419

Added:
   team_levelpacks/team_test_new_api/ralT073_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT026_1.xml
   team_levelpacks/team_test_new_api/ralT037_1.xml
   team_levelpacks/team_test_new_api/ralT049_1.xml
   team_levelpacks/team_test_new_api/ralT058_1.xml
Log:
Test Level new API:
- updates for actor renamings
- add level for actors with initial velocity



Modified: team_levelpacks/team_test_new_api/ralT026_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT026_1.xml	2008-12-28 17:39:22 UTC (rev 1418)
+++ team_levelpacks/team_test_new_api/ralT026_1.xml	2008-12-28 17:51:13 UTC (rev 1419)
@@ -26,7 +26,7 @@
 ti["4"] = {"fl_rock", name="d4"}
 ti["5"] = {"fl_rock", name="d5"}
 ti["6"] = {"fl_rock", name="d6"}
-ti["h"] = ti[" "] .. {"ac-horse", name="horse", destination={"d1","d2","d3","d4","d5","d6"}}
+ti["h"] = ti[" "] .. {"ac_horse", name="horse", destination={"d1","d2","d3","d4","d5","d6"}}
 ti["i"] = {"fl_rock", name="i1"}
 ti["j"] = {"fl_rock", name="i2"}
 ti["k"] = {"fl_rock", name="i3"}

Modified: team_levelpacks/team_test_new_api/ralT037_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT037_1.xml	2008-12-28 17:39:22 UTC (rev 1418)
+++ team_levelpacks/team_test_new_api/ralT037_1.xml	2008-12-28 17:51:13 UTC (rev 1419)
@@ -35,16 +35,18 @@
 ti["."] = {"it-springboard"}
 ti["|"] = {"it-spring1"}
 ti[";"] = {"it-spring2"}
+ti["*"] = {"it_landmine"}
 
 
 ti["1"] = {"#ac_marble_black", "me"}
 ti["2"] = {"#ac_marble_white"}
+ti["3"] = {"#ac_pearl"}
 
 w, h = wo(ti, " ", {
 "                    ",
-"               t    ",
+"  *  3         t    ",
 "           R   T    ",
-"                    ",
+"  *   3             ",
 "     m  ~  2        ",
 "                    ",
 "       pw  s        ",

Modified: team_levelpacks/team_test_new_api/ralT049_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT049_1.xml	2008-12-28 17:39:22 UTC (rev 1418)
+++ team_levelpacks/team_test_new_api/ralT049_1.xml	2008-12-28 17:51:13 UTC (rev 1419)
@@ -43,6 +43,9 @@
 ti["x"] = {"it_glasses", "myglasses"}
 ti["X"] = {"st_switch", target="breakglasses"}
 
+ti["T"] = {"st-thief"}
+ti["t"] = {"fl-thief"}
+
 ti["b"] = {"it-bag"}
 ti["y"] = {"it-yinyang"}
 ti["1"] = ti["y"] .. {"#ac_marble_black"} 
@@ -57,8 +60,8 @@
 "         G         x",
 "#    b  1  2  b    X",
 "                    ",
-"                    ",
-"                    ",
+"                   T",
+"                   t",
 "hh       s       a  ",
 "                    ",
 "LLL l   SSS      AAA"

Modified: team_levelpacks/team_test_new_api/ralT058_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT058_1.xml	2008-12-28 17:39:22 UTC (rev 1418)
+++ team_levelpacks/team_test_new_api/ralT058_1.xml	2008-12-28 17:51:13 UTC (rev 1419)
@@ -33,9 +33,11 @@
 
 ti["@"] = {"#ac_marble_black"} 
 ti["2"] = {"#ac_marble_white"} 
-ti["3"] = {"#ac-rotor"} 
-ti["4"] = {"#ac-bug"} 
-ti["5"] = {"#ac-horse"} 
+ti["3"] = {"#ac_rotor"} 
+ti["4"] = {"#ac_bug"} 
+ti["5"] = {"#ac_horse"} 
+ti["6"] = {"#ac_killer"} 
+ti["7"] = {"#ac_top"} 
 
 
 w, h = wo(ti, " ", {
@@ -51,7 +53,7 @@
 "   A   a    2       ",
 "            5       ",
 "            4       ",
-"            3       "
+"            3     67"
 })
 
 

Added: team_levelpacks/team_test_new_api/ralT073_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT073_1.xml	2008-12-28 17:39:22 UTC (rev 1418)
+++ team_levelpacks/team_test_new_api/ralT073_1.xml	2008-12-28 17:51:13 UTC (rev 1419)
@@ -0,0 +1,58 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Actors new API" el:subtitle="" el:id="20081228ral537"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["."] = {"fl_space"}
+
+
+ti["@"] = {"#ac_marble"} 
+ti["k"] = ti["."] .. {"ac_killer", 0.5, 0 ,name="killer", velocity_x=7} 
+ti["K"] = {"st_rotator_ccw", "killerbox"}
+ti["t"] = ti["."] .. {"ac_top", 0.99, 0.5, name="top", velocity_y=40} 
+ti["T"] = {"st_rotator_ccw", "topbox"}
+ti["b"] = ti["."] .. {"#ac_bug", "bug", velocity_x=-6.5} 
+ti["B"] = {"it_magnet_on", range=4, strength=50} .. ti["."]
+
+w, h = wo(ti, " ", {
+".......      .......",
+".......      .......",
+".......      .......",
+"...K...      t..T...",
+".......  @   .......",
+".......      .......",
+"...k.....b..........",
+"      .......       ",
+"      .......       ",
+"      ...B...       ",
+"      .......       ",
+"      .......       ",
+"      .......       "
+})
+
+wo:add({"ot_rubberband", anchor1="killer", anchor2="killerbox", length=2.5, max=2.55, min=2.45})
+wo:add({"ot_rubberband", anchor1="top", anchor2="topbox", length=2.5, max=2.55, min=2.45})
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: team_levelpacks/team_test_new_api/ralT073_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From raoul at mail.berlios.de  Mon Dec 29 00:03:05 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Mon, 29 Dec 2008 00:03:05 +0100
Subject: [Enigma-game-svn] r1420 - homepage/input/lotm
Message-ID: <200812282303.mBSN35RS011016@sheep.berlios.de>

Author: raoul
Date: 2008-12-29 00:03:05 +0100 (Mon, 29 Dec 2008)
New Revision: 1420

Modified:
   homepage/input/lotm/lotm_200812_de.html
Log:
-> Two missing german translation for lotm 200812



Modified: homepage/input/lotm/lotm_200812_de.html
===================================================================
--- homepage/input/lotm/lotm_200812_de.html	2008-12-28 17:51:13 UTC (rev 1419)
+++ homepage/input/lotm/lotm_200812_de.html	2008-12-28 23:03:05 UTC (rev 1420)
@@ -267,7 +267,7 @@
 
 <div class="lotmpic">
 <img src="$$imagedir$$/lotm/lotm_200812_n.jpg" alt="Level des Monats" border="0">
-<div class="imagetitle">The original</div>
+<div class="imagetitle">Das Original</div>
 </div>
 
 <div class="quote">Monster sind keine Erfindung moderner Computerspiele, sondern sie treiben ihr Unwesen seit die Menschheit existiert. Eine beachtliche Anzahl dieser Spezies finden wir in der griechischen Mythologie. Ein besonders heimt&uuml;ckischer Unhold war Prokrustes (= Gliederausrenker, sein richtiger Name war &quot;Damastes&quot;): ein Riese, der - von krankhaften Normungszw&auml;ngen getrieben - harmlosen, vorbeiziehenden Wanderern auflauerte und sie in seinen beiden Betten zu liegen zwang: die k&ouml;rperlich Kleinen zwang er in ein zu gro&szlig;es Bett und zog sie in die L&auml;nge, um sie anzupassen, die Gro&szlig;en mussten in ein zu kleines Bett, die herausragenden Beine wurden einfach unter rohem Gel&auml;chter abgehackt. Erst Theseus gelang es, dem B&ouml;sewicht das &uuml;ble Handwerk zu legen.</div>
@@ -465,7 +465,7 @@
 
 <div class="lotmpic">
 <img src="$$imagedir$$/lotm/lotm_200812_m.jpg" alt="Level des Monats" border="0">
-<div class="imagetitle">One of the earlier versions</div>
+<div class="imagetitle">Eine der fr?heren Versionen</div>
 </div>
 
 <p>Beim Feuer und Design war ich mir anfangs noch nicht ganz sicher, wie ich es



From raoulb at bluewin.ch  Mon Dec 29 21:30:21 2008
From: raoulb at bluewin.ch (Raoul)
Date: Mon, 29 Dec 2008 21:30:21 +0100
Subject: [Enigma-game-svn] rev 1421
Message-ID: <20081229213021.557a12ae@amarok.loinet.zh>

-> Some new levels (Opals, Wirestars)
-> Fixed flagshortcut in "Aztec temple"
-> Fixed Pipes-level
-> New API version of "Zero magnetism"
-> removed a dejavu Level
-> New API version of "Zeus"
-> New version of "Mayan meditation"
-> Removed all st-magic stones
-> New version of "turbulencia"
-> Some other new API renamings

TODO: More new api renamings


From ral at mail.berlios.de  Mon Dec 29 23:29:43 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 29 Dec 2008 23:29:43 +0100
Subject: [Enigma-game-svn] r1422 - trunk/src/stones
Message-ID: <200812292229.mBTMThvX011312@sheep.berlios.de>

Author: ral
Date: 2008-12-29 23:29:43 +0100 (Mon, 29 Dec 2008)
New Revision: 1422

Modified:
   trunk/src/stones/StoneImpulse.cc
   trunk/src/stones/StoneImpulse.hh
Log:
Trunk 1.1:
- st_stoneimpulse:
  - reverse st_stoneimpulse_new orientation attribute according to refman
  - finetuning on behaviour on receiving and sending impulses per wire


Modified: trunk/src/stones/StoneImpulse.cc
===================================================================
--- trunk/src/stones/StoneImpulse.cc	2008-12-29 20:27:59 UTC (rev 1421)
+++ trunk/src/stones/StoneImpulse.cc	2008-12-29 22:29:43 UTC (rev 1422)
@@ -62,7 +62,7 @@
         } else if (key == "orientation") {
             if (!isDisplayable()) {
                 objFlags &= ~OBJBIT_INCOMINGDIR;
-                Direction incoming = to_direction(val); 
+                Direction incoming = reverse(to_direction(val)); 
                 if (incoming != NODIR ) {
                     objFlags |= (incoming << 29) | OBJBIT_NOBACKFIRE;
                 }
@@ -73,7 +73,7 @@
     
     Value StoneImpulse::getAttr(const std::string &key) const {
         if (key == "hollow") {
-            return (bool)(objFlags & OBJBIT_HOLLOW);
+            return isHollow();
         } else if (key == "movable") {
             return (bool)(objFlags & OBJBIT_MOVABLE);
         } else if (key == "steady") {
@@ -125,16 +125,16 @@
 
     void StoneImpulse::init_model() {
         if (state == IDLE)
-            set_model(ecl::strf("st-stoneimpulse%s", (objFlags & OBJBIT_HOLLOW) ? "-hollow" : ((objFlags & OBJBIT_STEADY) ? "-steady" : "")));
+            set_model(ecl::strf("st-stoneimpulse%s", isHollow() ? "-hollow" : ((objFlags & OBJBIT_STEADY) ? "-steady" : "")));
         else
-            set_anim(ecl::strf("st-stoneimpulse%s-anim%d", (objFlags & OBJBIT_HOLLOW) ? "-hollow" : "",
+            set_anim(ecl::strf("st-stoneimpulse%s-anim%d", isHollow() ? "-hollow" : "",
                     state == EXPANDING ? 1 : 2));
     }
     
     void StoneImpulse::on_creation(GridPos p) {
         updateCurrentLightDirs();
             
-        if (!(objFlags & OBJBIT_HOLLOW))
+        if (!isHollow())
             activatePhoto();
         
         if (state == IDLE && (objFlags & OBJBIT_STEADY) && (objFlags & OBJBIT_LIGHTNEWDIRS))
@@ -164,26 +164,27 @@
     }
     
     bool StoneImpulse::is_floating() const {
-        return objFlags & OBJBIT_HOLLOW;
+        return isHollow();
     }
     
     StoneResponse StoneImpulse::collision_response(const StoneContact &sc) {
-        return ((state != IDLE) || !(objFlags & OBJBIT_HOLLOW)) ? STONE_REBOUND : STONE_PASS;
+        return ((state != IDLE) || !isHollow()) ? STONE_REBOUND : STONE_PASS;
     }
     
     void StoneImpulse::actor_inside(Actor *a) {
-        if ((state != IDLE) && (objFlags & OBJBIT_HOLLOW))
+        if ((state != IDLE) && isHollow())
             SendMessage(a, "_shatter");
     }
     
     void StoneImpulse::actor_hit(const StoneContact &sc) {
         if ((objFlags & OBJBIT_MOVABLE) && maybe_push_stone(sc))
             return;                                      // stone did move on impulse
-        else if (!(objFlags & OBJBIT_HOLLOW)) 
+        else if (!isHollow()) 
             sc.actor->send_impulse(sc.stonepos, NODIR);  // impulse on the slightest touch
     }
 
     void StoneImpulse::on_impulse(const Impulse& impulse) {
+        Actor *hitman = NULL;
         if ((objFlags & OBJBIT_MOVABLE) && (impulse.dir != NODIR)) {
             // move stone without disturbing a running animation
             display::Model *yieldedModel = display::YieldModel(GridLoc(GRID_STONES, get_pos()));
@@ -193,20 +194,29 @@
             display::SetModel(GridLoc(GRID_STONES, get_pos()), yieldedModel);
             
             // pulse only if not pushed with a wand
-            Actor *hitman = dynamic_cast<Actor*>(impulse.sender);
+            hitman = dynamic_cast<Actor*>(impulse.sender);
             if (hitman == NULL || !player::WieldedItemIs(hitman, "it_magicwand")) {
                 if (state == IDLE)
-                    setIState(EXPANDING, NODIR);
+                    setIState(EXPANDING, impulse.dir);
                 else if (didMove && state != EXPANDING)
                     // ensure that an impulse to neighbors will be emitted when moved
                     objFlags |= OBJBIT_REPULSE;
-            } else if (((objFlags & OBJBIT_STEADY) && (objFlags & OBJBIT_LIGHTNEWDIRS) && state == IDLE))
-                setIState(EXPANDING);
+            } else if (((objFlags & OBJBIT_STEADY) && (objFlags & OBJBIT_LIGHTNEWDIRS) && state == IDLE)) {
+                setIState(EXPANDING, impulse.dir);
+            }
         } else {
             setIState(EXPANDING, impulse.dir);
         }
         
-        propagateImpulse(impulse);
+        // direct impulse propagation
+        if (objFlags & OBJBIT_MOVABLE) { 
+            if (hitman != NULL) {
+                objFlags &= ~OBJBIT_PROPAGATE;
+                propagateImpulse(impulse);
+            } else
+                objFlags |= OBJBIT_PROPAGATE;
+        }
+        setAttr("$impulse_source", impulse.sender->getId());
     }
     
     FreezeStatusBits StoneImpulse::get_freeze_bits() {
@@ -248,11 +258,36 @@
                         if (!(objFlags & OBJBIT_NOBACKFIRE) || d != origin)
                             send_impulse(move(p, d), d);
                     }
+                    if (!(objFlags & OBJBIT_MOVABLE) || (objFlags & OBJBIT_PROPAGATE)) {
+                        propagateImpulse(Impulse(this, GridPos(-1,-1), 
+                                (Direction)((objFlags & OBJBIT_INCOMINGDIR) >> 29)));
+                    }
+                    if (objFlags & OBJBIT_MOVABLE)
+                        objFlags &= ~OBJBIT_PROPAGATE;
                     break;
             }
         }
     }
     
+    void StoneImpulse::propagateImpulse(const Impulse& impulse) {
+        if (!impulse.byWire) {
+            ObjectList olist = getAttr("fellows");
+            int sourceId = getDefaultedAttr("$impulse_source", 0);
+            for (ObjectList::iterator it = olist.begin(); it != olist.end(); ++it) {
+                Stone *fellow = dynamic_cast<Stone *>(*it);
+                if (fellow != NULL && fellow->getId() != sourceId) {
+                    Impulse wireImpulse(this, fellow->get_pos(), impulse.dir, true);
+                    fellow->on_impulse(wireImpulse);
+                }
+            }
+        }
+        setAttr("$impulse_source", 0);
+    }
+    
+    bool StoneImpulse::isHollow() const {
+        return (bool)(objFlags & OBJBIT_HOLLOW) && !(bool)(objFlags & OBJBIT_MOVABLE);
+    }
+    
     int StoneImpulse::traitsIdx() const {
         if (objFlags & OBJBIT_MOVABLE)
             return 3;

Modified: trunk/src/stones/StoneImpulse.hh
===================================================================
--- trunk/src/stones/StoneImpulse.hh	2008-12-29 20:27:59 UTC (rev 1421)
+++ trunk/src/stones/StoneImpulse.hh	2008-12-29 22:29:43 UTC (rev 1422)
@@ -46,7 +46,8 @@
         
         enum ObjectPrivatFlagsBits {
             OBJBIT_MOVABLE     =  1<<24,   ///< Object is movable 
-            OBJBIT_HOLLOW      =  1<<25,   ///< 
+            OBJBIT_HOLLOW      =  1<<25,   ///< hollow SI (exclusive usage with movalble feature!)
+            OBJBIT_PROPAGATE   =  1<<25,   ///< only for movable SI mark impulse propagation on shrinking 
             OBJBIT_STEADY      =  1<<26,   ///< continuous laser light causes repeating impulses 
             OBJBIT_REPULSE     =  1<<27,   ///< pending impulse
             OBJBIT_NOBACKFIRE  =  1<<28,   ///< avoid sending impulse back into incoming direction
@@ -84,6 +85,8 @@
         
     private:
         void setIState(int newState, Direction incoming = NODIR);
+        void propagateImpulse(const Impulse& impulse);
+        bool isHollow() const;
         int traitsIdx() const;
     };
 



From ral at mail.berlios.de  Wed Dec 31 14:11:19 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Wed, 31 Dec 2008 14:11:19 +0100
Subject: [Enigma-game-svn] r1423 - in trunk/src: . actors
Message-ID: <200812311311.mBVDBJID002471@sheep.berlios.de>

Author: ral
Date: 2008-12-31 14:11:12 +0100 (Wed, 31 Dec 2008)
New Revision: 1423

Modified:
   trunk/src/actors/Rotors.cc
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering
- fix r1396: yinyang stones broken on PassageStone renaming
- fix r1404: rotors and tops no longer attacking pearls

Modified: trunk/src/actors/Rotors.cc
===================================================================
--- trunk/src/actors/Rotors.cc	2008-12-29 22:29:43 UTC (rev 1422)
+++ trunk/src/actors/Rotors.cc	2008-12-31 13:11:12 UTC (rev 1423)
@@ -66,7 +66,7 @@
         }
     
         ActorsInRangeIterator air_it = ActorsInRangeIterator(this, range,
-                1<<ac_marble_white | 1<<ac_marble_black | 1<<ac_marble_white);
+                1<<ac_marble_white | 1<<ac_marble_black | 1<<ac_pearl_white);
         Actor *a;
         while((a = air_it.next()) != NULL) {
             if (a->is_movable() && !a->is_invisible()) {

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-12-29 22:29:43 UTC (rev 1422)
+++ trunk/src/stones_simple.cc	2008-12-31 13:11:12 UTC (rev 1423)
@@ -982,7 +982,7 @@
             sound_event("yinyang");
             ReplaceStone (get_pos(), MakeStone(stonename));
         }
-        void turn_black(const char *stonename = "st-passage_black_square") {
+        void turn_black(const char *stonename = "st_passage_black_square") {
             sound_event("yinyang");
             ReplaceStone (get_pos(), MakeStone(stonename));
         }
@@ -1029,9 +1029,9 @@
             {
                 Value color = sc.actor->getAttr("color");
                 if      (color && color == BLACK) 
-                    turn_white("st-white4");
+                    turn_white("st_passage_white_square");
                 else if (color && color == WHITE) 
-                    turn_black("st-black4");
+                    turn_black("st_passage_black_square");
             }
         }
     };



From raoul at mail.berlios.de  Wed Dec 31 22:41:34 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Wed, 31 Dec 2008 22:41:34 +0100
Subject: [Enigma-game-svn] r1424 - in trunk/data/levels: enigma_cross
	enigma_iii enigma_iv enigma_vi enigma_vii enigma_viii
Message-ID: <200812312141.mBVLfYxU001143@sheep.berlios.de>

Author: raoul
Date: 2008-12-31 22:41:32 +0100 (Wed, 31 Dec 2008)
New Revision: 1424

Added:
   trunk/data/levels/enigma_viii/ral21_2.xml
Removed:
   trunk/data/levels/enigma_viii/ral21_1.xml
Modified:
   trunk/data/levels/enigma_cross/enigma0_92_2.xml
   trunk/data/levels/enigma_cross/enigma0_92_3.xml
   trunk/data/levels/enigma_cross/newlevels.xml
   trunk/data/levels/enigma_cross/newlevels_1.0.1.xml
   trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
   trunk/data/levels/enigma_iii/duffy37_1.xml
   trunk/data/levels/enigma_iii/index.xml
   trunk/data/levels/enigma_iv/duffy125_2.xml
   trunk/data/levels/enigma_iv/duffy73_3.xml
   trunk/data/levels/enigma_iv/index.xml
   trunk/data/levels/enigma_vi/index.xml
   trunk/data/levels/enigma_vi/ral10_2.xml
   trunk/data/levels/enigma_vi/raoul29_1.xml
   trunk/data/levels/enigma_vii/andreas46_3.xml
   trunk/data/levels/enigma_vii/index.xml
   trunk/data/levels/enigma_vii/mecke09_2.xml
   trunk/data/levels/enigma_vii/mecke11_2.xml
   trunk/data/levels/enigma_vii/mecke12_2.xml
   trunk/data/levels/enigma_vii/pulley04_2.xml
   trunk/data/levels/enigma_vii/pulley06_2.xml
   trunk/data/levels/enigma_vii/pulley07_1.xml
   trunk/data/levels/enigma_viii/index.xml
   trunk/data/levels/enigma_viii/mecke01_1.xml
   trunk/data/levels/enigma_viii/mecke02_1.xml
   trunk/data/levels/enigma_viii/mecke03_1.xml
   trunk/data/levels/enigma_viii/mecke05_1.xml
   trunk/data/levels/enigma_viii/mecke06_1.xml
   trunk/data/levels/enigma_viii/mecke07_1.xml
   trunk/data/levels/enigma_viii/mecke08_1.xml
   trunk/data/levels/enigma_viii/mecke10_2.xml
   trunk/data/levels/enigma_viii/mecke13_1.xml
   trunk/data/levels/enigma_viii/mecke15_1.xml
   trunk/data/levels/enigma_viii/mecke17_1.xml
   trunk/data/levels/enigma_viii/mecke19_1.xml
   trunk/data/levels/enigma_viii/mecke20_2.xml
   trunk/data/levels/enigma_viii/mecke21_2.xml
   trunk/data/levels/enigma_viii/mecke22_2.xml
   trunk/data/levels/enigma_viii/mecke23_1.xml
   trunk/data/levels/enigma_viii/mecke29_1.xml
   trunk/data/levels/enigma_viii/mecke31_1.xml
Log:
-> New API object renamings for actor objects
-> New version of "Tutoxyd" level



Modified: trunk/data/levels/enigma_cross/enigma0_92_2.xml
===================================================================
--- trunk/data/levels/enigma_cross/enigma0_92_2.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_cross/enigma0_92_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -117,7 +117,7 @@
     <level _seq="109" _title="Hexagony" _xpath="enigma_iii/nat22_1" author="Nat Pryce" ctrl="force" easy="true" id="nat22" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="110" _title="Jumpin' Jack Flash" _xpath="enigma_v/ss10_1" author="Sven Siggelkow" ctrl="force" easy="true" id="ss10" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="111" _title="It Never Stops" _xpath="enigma_iv/duffy36_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy36" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="112" _title="Fool the Warden" _xpath="enigma_iii/duffy37_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy37" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="112" _title="Fool the Warden" _xpath="enigma_iii/duffy37_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy37" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="113" _title="Drunk" _xpath="enigma_ii/duffy38_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy38" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="114" _title="Turnstile City" _xpath="enigma_v/duffy39_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy39" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="115" _title="Cover Your Ears" _xpath="enigma_iii/duffy40_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy40" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -153,7 +153,7 @@
     <level _seq="145" _title="Build Up and Tear Down" _xpath="enigma_v/duffy70_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy70" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="146" _title="Don't Be Greedy" _xpath="enigma_v/duffy71_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy71" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="147" _title="Where Am I?" _xpath="enigma_iv/duffy72_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy72" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="148" _title="Bizarro World" _xpath="enigma_iv/duffy73_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy73" rel="3" rev="7" score="2" target="time" unit="duration"/>
+    <level _seq="148" _title="Bizarro World" _xpath="enigma_iv/duffy73_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy73" rel="3" rev="8" score="2" target="time" unit="duration"/>
     <level _seq="149" _title="Solvable?" _xpath="enigma_v/barry01_2" author="Barry &amp; Lori Mead" ctrl="force" easy="false" id="barry01" rel="2" rev="0" score="2" target="time" unit="duration"/>
     <level _seq="150" _title="Where is it?" _xpath="enigma_iv/barry02_1" author="Barry &amp; Lori Mead" ctrl="force" easy="false" id="barry02" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="151" _title="Tool Time" _xpath="enigma_ii/barry03_1" author="Barry &amp; Lori Mead" ctrl="force" easy="false" id="barry03" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/enigma0_92_3.xml
===================================================================
--- trunk/data/levels/enigma_cross/enigma0_92_3.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_cross/enigma0_92_3.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -63,7 +63,7 @@
     <level _seq="55" _title="Civil Engineer" _xpath="enigma_i/duffy122_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy122" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="56" _title="Electric Meditation" _xpath="enigma_iv/duffy123_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy123" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="57" _title="Worse Nightmare" _xpath="enigma_iv/duffy124_2" author="Jacob Scott" ctrl="force" easy="true" id="duffy124" rel="2" rev="3" score="2" target="time" unit="duration"/>
-    <level _seq="58" _title="Triple-Maze" _xpath="enigma_iv/duffy125_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy125" rel="2" rev="7" score="2" target="time" unit="duration"/>
+    <level _seq="58" _title="Triple-Maze" _xpath="enigma_iv/duffy125_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy125" rel="2" rev="8" score="2" target="time" unit="duration"/>
     <level _seq="59" _title="Elaborate" _xpath="enigma_v/duffy126_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy126" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="60" _title="Now What?" _xpath="enigma_v/duffy127_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy127" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="61" _title="Patterns" _xpath="enigma_ii/duffy128_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy128" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_cross/newlevels.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -195,7 +195,7 @@
     <level _seq="187" _title="- Meditation -" _xpath="enigma_vi/andreas36_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas36" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="188" _title="Troy" _xpath="enigma_vi/andreas37_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas37" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="189" _title="Ben Hur" _xpath="enigma_vi/ral13_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20061011ral390" rel="1" rev="58" score="1" target="time" unit="duration"/>
-    <level _seq="190" _title="Bodyguard" _xpath="enigma_vi/ral10_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20060730ral012" rel="2" rev="99" score="1" target="time" unit="duration"/>
+    <level _seq="190" _title="Bodyguard" _xpath="enigma_vi/ral10_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20060730ral012" rel="2" rev="100" score="1" target="time" unit="duration"/>
     <level _seq="191" _title="Janus" _xpath="enigma_vi/andreas38_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas38" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="192" _title="Phaeton" _xpath="enigma_vi/andreas39_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas39" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="193" _title="Ariadne" _xpath="enigma_vi/andreas40_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas40" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels_1.0.1.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.0.1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_cross/newlevels_1.0.1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -26,7 +26,7 @@
     <level _seq="18" _title="Your Friend, the Light" _xpath="enigma_vi/just15_1" author="JuSt" ctrl="force" easy="true" id="just15" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="19" _title="jumping ball flash" _xpath="enigma_vi/illmind13_1" author="illmind" ctrl="force" easy="false" id="2007ill001" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="20" _title="Cold Meditation" _xpath="enigma_vii/ral18_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070314ral728" rel="1" rev="67" score="1" target="time" unit="duration"/>
-    <level _seq="21" _title="Same task ..." _xpath="enigma_vi/raoul29_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul29" rel="1" rev="6" score="1" target="time" unit="duration"/>
+    <level _seq="21" _title="Same task ..." _xpath="enigma_vi/raoul29_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul29" rel="1" rev="7" score="1" target="time" unit="duration"/>
     <level _seq="22" _title="Industrial Puzzles" _xpath="enigma_vi/raoul30_2" author="Raoul Bourquin" ctrl="force" easy="false" id="raoul30" rel="2" rev="7" score="2" target="time" unit="duration"/>
     <level _seq="23" _title="Odyssey" _xpath="enigma_vi/ant39_1" author="Petr Machata" ctrl="force" easy="false" id="ant39" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="24" _title="Tandem Chess" _xpath="enigma_vi/luc34_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc342007" rel="1" rev="2" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -30,7 +30,7 @@
     <level _seq="22" _title="Double Oneways" _xpath="enigma_vii/duffy172_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy172" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="23" _title="Wood - Water - Wood" _xpath="enigma_vii/duffy173_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy173" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="24" _title="Transpositions" _xpath="enigma_vii/duffy174_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy174" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="25" _title="Puppet" _xpath="enigma_vii/pulley06_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley06" rel="2" rev="4" score="1" target="time" unit="duration"/>
+    <level _seq="25" _title="Puppet" _xpath="enigma_vii/pulley06_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley06" rel="2" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="26" _title="Restless Meditation" _xpath="enigma_vii/ral09_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070623ral914" rel="2" rev="126" score="1" target="time" unit="duration"/>
     <level _seq="27" _title="Ghost Driver" _xpath="enigma_vii/duffy176_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy176" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="28" _title="Re-entry Circuit" _xpath="enigma_vii/pulley05_2" author="Mark Pulley" ctrl="force" easy="false" id="pulley05" rel="2" rev="4" score="1" target="time" unit="duration"/>
@@ -59,8 +59,8 @@
     <level _seq="51" _title="Swapping Puzzle II" _xpath="enigma_vii/joe22_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe22" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="52" _title="Multiban" _xpath="enigma_vii/dpl01_1" author="Dominik Leipold" ctrl="force" easy="false" id="dpl01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="53" _title="Riverside" _xpath="enigma_vii/johann02_2" author="Johann Freymuth" ctrl="force" easy="false" id="johann02" rel="2" rev="0" score="2" target="time" unit="duration"/>
-    <level _seq="54" _title="The Lone Ranger" _xpath="enigma_vii/pulley04_2" author="Mark Pulley" ctrl="force" easy="false" id="pulley04" rel="2" rev="4" score="2" target="time" unit="duration"/>
-    <level _seq="55" _title="Little Shop Of Horrors" _xpath="enigma_vii/pulley07_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley07" rel="1" rev="6" score="1" target="time" unit="duration"/>
+    <level _seq="54" _title="The Lone Ranger" _xpath="enigma_vii/pulley04_2" author="Mark Pulley" ctrl="force" easy="false" id="pulley04" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="55" _title="Little Shop Of Horrors" _xpath="enigma_vii/pulley07_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley07" rel="1" rev="7" score="1" target="time" unit="duration"/>
     <level _seq="56" _title="Spaceship Control" _xpath="enigma_vii/safalra01_1" author="Safalra" ctrl="force" easy="false" id="safalra01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="57" _title="Ball Alley" _xpath="enigma_vii/johann01_1" author="Johann Freymuth" ctrl="force" easy="false" id="johann01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="58" _title="Action Potential" _xpath="enigma_vii/pulley02_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley02" rel="2" rev="3" score="1" target="time" unit="duration"/>
@@ -69,7 +69,7 @@
     <level _seq="61" _title="Lady in Red" _xpath="enigma_vii/just30_1" author="Just" ctrl="force" easy="true" id="just30" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="62" _title="Crawling the Abyss" _xpath="enigma_vii/sph02_1" author="ShadowPhrogg32642342" ctrl="force" easy="true" id="sph02" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="63" _title="Bold Boulder" _xpath="enigma_vii/ral14_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20061124ral279" rel="1" rev="127" score="1" target="time" unit="duration"/>
-    <level _seq="64" _title="Tinker, Tailor" _xpath="enigma_vii/andreas46_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas46" rel="4" rev="7" score="2" target="time" unit="duration"/>
+    <level _seq="64" _title="Tinker, Tailor" _xpath="enigma_vii/andreas46_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas46" rel="4" rev="8" score="2" target="time" unit="duration"/>
     <level _seq="65" _title="Elbow Society" _xpath="enigma_vii/andreas45_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas45" rel="2" rev="6" score="2" target="time" unit="duration"/>
     <level _seq="66" _title="Watchmaker" _xpath="enigma_vii/huesing01_1" author="Johannes H?sing" ctrl="force" easy="false" id="huesing01" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="67" _title="Map it out II" _xpath="enigma_vii/manuel01_1" author="Manuel Eisentraut" ctrl="force" easy="true" id="manuel01" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -79,21 +79,21 @@
     <level _seq="71" _title="Pick-Up" _xpath="enigma_vii/joe27_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe27" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="72" _title="A Kind of Magic" _xpath="enigma_vii/just37_1" author="JuSt" ctrl="force" easy="true" id="JuStA Kind of Magic" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="73" _title="Blue Screen Of Death" _xpath="enigma_vii/pulley10_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley10" rel="2" rev="1" score="2" target="time" unit="duration"/>
-    <level _seq="74" _title="Audience in Venice" _xpath="enigma_vii/mecke09_2" author="mecke" ctrl="force" easy="true" id="mecke9" rel="2" rev="24" score="1" target="time" unit="duration"/>
-    <level _seq="75" _title="Black Liberation" _xpath="enigma_vii/mecke11_2" author="mecke" ctrl="force" easy="true" id="mecke11" rel="2" rev="29" score="1" target="time" unit="duration"/>
-    <level _seq="76" _title="Jack-Of-All-Trades" _xpath="enigma_vii/mecke12_2" author="mecke" ctrl="force" easy="true" id="mecke12" rel="2" rev="34" score="1" target="time" unit="duration"/>
-    <level _seq="77" _title="Enigmaparcour I" _xpath="enigma_viii/mecke15_1" author="mecke" ctrl="force" easy="true" id="mecke15" rel="1" rev="24" score="1" target="time" unit="duration"/>
-    <level _seq="78" _title="Rhythm of Space" _xpath="enigma_viii/mecke20_2" author="mecke" ctrl="force" easy="true" id="mecke20" rel="2" rev="24" score="1" target="time" unit="duration"/>
+    <level _seq="74" _title="Audience in Venice" _xpath="enigma_vii/mecke09_2" author="mecke" ctrl="force" easy="true" id="mecke9" rel="2" rev="25" score="1" target="time" unit="duration"/>
+    <level _seq="75" _title="Black Liberation" _xpath="enigma_vii/mecke11_2" author="mecke" ctrl="force" easy="true" id="mecke11" rel="2" rev="30" score="1" target="time" unit="duration"/>
+    <level _seq="76" _title="Jack-Of-All-Trades" _xpath="enigma_vii/mecke12_2" author="mecke" ctrl="force" easy="true" id="mecke12" rel="2" rev="35" score="1" target="time" unit="duration"/>
+    <level _seq="77" _title="Enigmaparcour I" _xpath="enigma_viii/mecke15_1" author="mecke" ctrl="force" easy="true" id="mecke15" rel="1" rev="25" score="1" target="time" unit="duration"/>
+    <level _seq="78" _title="Rhythm of Space" _xpath="enigma_viii/mecke20_2" author="mecke" ctrl="force" easy="true" id="mecke20" rel="2" rev="25" score="1" target="time" unit="duration"/>
     <level _seq="79" _title="The Show Jumper" _xpath="enigma_viii/andreas47_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas47" rel="1" rev="7" score="1" target="time" unit="duration"/>
     <level _seq="80" _title="The Red Room" _xpath="enigma_viii/joe29_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe29" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="81" _title="Enigmines" _xpath="enigma_viii/huffman01_1" author="Brian Huffman" ctrl="force" easy="true" id="huffman01" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="82" _title="Red Cave" _xpath="enigma_viii/mecke21_2" author="mecke" ctrl="force" easy="true" id="mecke21" rel="2" rev="34" score="1" target="time" unit="duration"/>
+    <level _seq="82" _title="Red Cave" _xpath="enigma_viii/mecke21_2" author="mecke" ctrl="force" easy="true" id="mecke21" rel="2" rev="35" score="1" target="time" unit="duration"/>
     <level _seq="83" _title="Status code 302" _xpath="enigma_viii/devnull02_1" author="/dev/null" ctrl="force" easy="true" id="devnull02" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="84" _title="A Screenful of Secrets" _xpath="enigma_viii/mecke01_1" author="mecke" ctrl="force" easy="true" id="mecke01" rel="1" rev="25" score="1" target="time" unit="duration"/>
-    <level _seq="85" _title="Southside Life" _xpath="enigma_viii/mecke10_2" author="mecke" ctrl="force" easy="true" id="mecke10" rel="2" rev="21" score="1" target="time" unit="duration"/>
+    <level _seq="84" _title="A Screenful of Secrets" _xpath="enigma_viii/mecke01_1" author="mecke" ctrl="force" easy="true" id="mecke01" rel="1" rev="26" score="1" target="time" unit="duration"/>
+    <level _seq="85" _title="Southside Life" _xpath="enigma_viii/mecke10_2" author="mecke" ctrl="force" easy="true" id="mecke10" rel="2" rev="22" score="1" target="time" unit="duration"/>
     <level _seq="86" _title="Joona's Chess" _xpath="enigma_viii/joona02_1" author="Joona Laire" ctrl="force" easy="true" id="joona02" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="87" _title="Helios I" _xpath="enigma_viii/mecke07_1" author="mecke" ctrl="force" easy="false" id="mecke48" rel="1" rev="14" score="1" target="time" unit="duration"/>
-    <level _seq="88" _title="The Green Hell" _xpath="enigma_viii/mecke22_2" author="mecke" ctrl="force" easy="true" id="mecke22" rel="2" rev="69" score="1" target="time" unit="duration"/>
+    <level _seq="87" _title="Helios I" _xpath="enigma_viii/mecke07_1" author="mecke" ctrl="force" easy="false" id="mecke48" rel="1" rev="15" score="1" target="time" unit="duration"/>
+    <level _seq="88" _title="The Green Hell" _xpath="enigma_viii/mecke22_2" author="mecke" ctrl="force" easy="true" id="mecke22" rel="2" rev="70" score="1" target="time" unit="duration"/>
     <level _seq="89" _title="Tilt Board" _xpath="enigma_viii/ulf06_2" author="Ulf Stegemann" ctrl="force" easy="true" id="20080529ulf118" rel="2" rev="116" score="2" target="time" unit="duration"/>
     <level _seq="90" _title="4 - 8 - 4" _xpath="enigma_viii/dpl03_3" author="Dominik Leipold" ctrl="force" easy="true" id="20070821dpl003" rel="3" rev="4" score="3" target="time" unit="duration"/>
     <level _seq="91" _title="Impulsive Order" _xpath="enigma_viii/raywick05_1" author="Ray Wick" ctrl="force" easy="true" id="raywick5" rel="1" rev="7" score="1" target="time" unit="duration"/>
@@ -108,21 +108,21 @@
     <level _seq="100" _title="Microwire" _xpath="enigma_viii/ral27_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral427" rel="1" rev="127" score="1" target="time" unit="duration"/>
     <level _seq="101" _title="More Microwire" _xpath="enigma_viii/ral28_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral282" rel="1" rev="127" score="1" target="time" unit="duration"/>
     <level _seq="102" _title="Freestyle Microwire" _xpath="enigma_viii/ral29_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080719ral530" rel="1" rev="127" score="1" target="time" unit="duration"/>
-    <level _seq="103" _title="Balance Beam" _xpath="enigma_viii/mecke03_1" author="mecke" ctrl="force" easy="true" id="mecke03" rel="1" rev="31" score="1" target="time" unit="duration"/>
+    <level _seq="103" _title="Balance Beam" _xpath="enigma_viii/mecke03_1" author="mecke" ctrl="force" easy="true" id="mecke03" rel="1" rev="32" score="1" target="time" unit="duration"/>
     <level _seq="104" _title="Colored Oxyds" _xpath="enigma_viii/andreas50_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas50" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="105" _title="Styles Change" _xpath="enigma_viii/andreas48_2" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas48" rel="2" rev="7" score="2" target="time" unit="duration"/>
     <level _seq="106" _title="Colored Turnstiles" _xpath="enigma_viii/andreas51_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas51" rel="1" rev="3" score="1" target="time" unit="duration"/>
-    <level _seq="107" _title="Sanssouci" _xpath="enigma_viii/mecke05_1" author="mecke" ctrl="force" easy="true" id="mecke05" rel="1" rev="29" score="1" target="time" unit="duration"/>
+    <level _seq="107" _title="Sanssouci" _xpath="enigma_viii/mecke05_1" author="mecke" ctrl="force" easy="true" id="mecke05" rel="1" rev="30" score="1" target="time" unit="duration"/>
     <level _seq="108" _title="Wired Shogun" _xpath="enigma_viii/ral34_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080828ral417" rel="1" rev="127" score="1" target="time" unit="duration"/>
     <level _seq="109" _title="Scarlet's Necklace" _xpath="enigma_viii/ral30_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080814ral422" rel="1" rev="127" score="1" target="time" unit="duration"/>
     <level _seq="110" _title="- Meditation -" _xpath="enigma_viii/raoul31_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul31" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="111" _title=" - Meditation - " _xpath="enigma_viii/devnull07_1" author="/dev/null" ctrl="force" easy="true" id="devnull07" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="112" _title=" - Meditation - " _xpath="enigma_viii/devnull06_1" author="/dev/null" ctrl="force" easy="true" id="devnull06" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="113" _title="Relaxing at the sea" _xpath="enigma_viii/devnull08_1" author="/dev/null" ctrl="force" easy="true" id="devnull08" rel="1" rev="14" score="1" target="time" unit="duration"/>
-    <level _seq="114" _title="Helios II" _xpath="enigma_viii/mecke08_1" author="mecke" ctrl="force" easy="true" id="mecke08" rel="1" rev="17" score="1" target="time" unit="duration"/>
-    <level _seq="115" _title="Tutoxyd's Pyramid" _xpath="enigma_viii/ral21_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20070822ral291" rel="1" rev="120" score="1" target="time" unit="duration"/>
-    <level _seq="116" _title="Alternation I" _xpath="enigma_viii/mecke17_1" author="mecke" ctrl="force" easy="false" id="mecke17" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="117" _title="Enigmaparcour II" _xpath="enigma_viii/mecke29_1" author="mecke" ctrl="force" easy="true" id="mecke29" rel="1" rev="4" score="1" target="time" unit="duration"/>
+    <level _seq="114" _title="Helios II" _xpath="enigma_viii/mecke08_1" author="mecke" ctrl="force" easy="true" id="mecke08" rel="1" rev="18" score="1" target="time" unit="duration"/>
+    <level _seq="115" _title="Tutoxyd's Pyramid" _xpath="enigma_viii/ral21_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070822ral291" rel="2" rev="136" score="2" target="time" unit="duration"/>
+    <level _seq="116" _title="Alternation I" _xpath="enigma_viii/mecke17_1" author="mecke" ctrl="force" easy="false" id="mecke17" rel="1" rev="6" score="1" target="time" unit="duration"/>
+    <level _seq="117" _title="Enigmaparcour II" _xpath="enigma_viii/mecke29_1" author="mecke" ctrl="force" easy="true" id="mecke29" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="118" _title=" - Meditation - " _xpath="enigma_viii/devnull07_1" author="/dev/null" ctrl="force" easy="true" id="devnull07" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="119" _title=" - Meditation - " _xpath="enigma_viii/devnull06_1" author="/dev/null" ctrl="force" easy="true" id="devnull06" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="120" _title="- Meditation -" _xpath="enigma_viii/devnull04_1" author="/dev/null" ctrl="force" easy="true" id="devnull04" rel="1" rev="6" score="1" target="time" unit="duration"/>
@@ -132,12 +132,12 @@
     <level _seq="124" _title=" - Meditation - " _xpath="enigma_viii/devnull12_1" author="/dev/null" ctrl="force" easy="true" id="devnull12" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="125" _title="On belay?" _xpath="enigma_viii/devnull15_1" author="/dev/null" ctrl="force" easy="true" id="devnull15" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="126" _title="Hang-dogging?" _xpath="enigma_viii/devnull16_1" author="/dev/null" ctrl="force" easy="true" id="devnull16" rel="1" rev="3" score="1" target="time" unit="duration"/>
-    <level _seq="127" _title="Alternation II" _xpath="enigma_viii/mecke31_1" author="mecke" ctrl="force" easy="false" id="mecke31" rel="1" rev="6" score="1" target="time" unit="duration"/>
-    <level _seq="128" _title="Fifty Years Later ..." _xpath="enigma_viii/mecke23_1" author="mecke" ctrl="force" easy="true" id="mecke23" rel="1" rev="21" score="1" target="time" unit="duration"/>
-    <level _seq="129" _title="Turbulencia" _xpath="enigma_viii/mecke19_1" author="mecke" ctrl="force" easy="true" id="mecke19" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="130" _title="Techno Voodoo" _xpath="enigma_viii/mecke06_1" author="mecke" ctrl="force" easy="false" id="mecke06" rel="1" rev="14" score="1" target="time" unit="duration"/>
-    <level _seq="131" _title="Plutos World" _xpath="enigma_viii/mecke02_1" author="mecke" ctrl="force" easy="false" id="mecke16" rel="1" rev="10" score="1" target="time" unit="duration"/>
-    <level _seq="132" _title="Plutos Confusion" _xpath="enigma_viii/mecke13_1" author="mecke" ctrl="force" easy="false" id="mecke30" rel="1" rev="8" score="1" target="time" unit="duration"/>
+    <level _seq="127" _title="Alternation II" _xpath="enigma_viii/mecke31_1" author="mecke" ctrl="force" easy="false" id="mecke31" rel="1" rev="7" score="1" target="time" unit="duration"/>
+    <level _seq="128" _title="Fifty Years Later ..." _xpath="enigma_viii/mecke23_1" author="mecke" ctrl="force" easy="true" id="mecke23" rel="1" rev="22" score="1" target="time" unit="duration"/>
+    <level _seq="129" _title="Turbulencia" _xpath="enigma_viii/mecke19_1" author="mecke" ctrl="force" easy="true" id="mecke19" rel="1" rev="6" score="1" target="time" unit="duration"/>
+    <level _seq="130" _title="Techno Voodoo" _xpath="enigma_viii/mecke06_1" author="mecke" ctrl="force" easy="false" id="mecke06" rel="1" rev="15" score="1" target="time" unit="duration"/>
+    <level _seq="131" _title="Plutos World" _xpath="enigma_viii/mecke02_1" author="mecke" ctrl="force" easy="false" id="mecke16" rel="1" rev="11" score="1" target="time" unit="duration"/>
+    <level _seq="132" _title="Plutos Confusion" _xpath="enigma_viii/mecke13_1" author="mecke" ctrl="force" easy="false" id="mecke30" rel="1" rev="9" score="1" target="time" unit="duration"/>
     <level _seq="133" _title="Coober Pedy Opals" _xpath="enigma_viii/ral35_1" author="Ronald Lamprecht, Andreas Lochmann" ctrl="force" easy="true" id="20081207ral610" rel="1" rev="126" score="1" target="time" unit="duration"/>
     <level _seq="134" _title="Butterfly Opals" _xpath="enigma_viii/ral36_1" author="Ronald Lamprecht, Andreas Lochmann" ctrl="force" easy="true" id="20081207ral708" rel="1" rev="126" score="1" target="time" unit="duration"/>
     <level _seq="135" _title="Brilliant Opals" _xpath="enigma_viii/ral37_1" author="Ronald Lamprecht, Andreas Lochmann" ctrl="force" easy="true" id="20081212ral162" rel="1" rev="126" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_iii/duffy37_1.xml
===================================================================
--- trunk/data/levels/enigma_iii/duffy37_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_iii/duffy37_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Fool the Warden" el:subtitle="" el:id="duffy37"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -55,12 +55,12 @@
         elseif c=="+" then
             set_stone( "st-wood", i-1, line)
         elseif c=="r" then
-            local ac0 = set_actor("ac-rotor", i,line+.5, {attacknearest=0, range=100, force=100,name="ac0"})
+            local ac0 = set_actor("ac-rotor", i,line+.5, {attacknearest=0, range=100, force=100, name="ac0"})
             abyss(i-1,line)
         elseif c=="R" then
-            local ac1 = set_actor("ac-killerball", i-.5,line+.5, {mouseforce=0, range=100, force=0,name="ac1"})
+            local ac1 = set_actor("ac-killerball", i-.5,line+.5, {mouseforce=0, name="ac1", controllers=0})
         elseif c=="Q" then
-            local ac2 = set_actor("ac-killerball", i-.5,line+.5, {mouseforce=0, range=100, force=0,name="ac2"})
+            local ac2 = set_actor("ac-killerball", i-.5,line+.5, {mouseforce=0, name="ac2", controllers=0})
             abyss(i-1,line)
         elseif c == "b" then
             yy1( "black",  i-1, line)
@@ -120,9 +120,7 @@
 ac2=enigma.GetNamedObject("ac2")
 
 enigma.AddRubberBand(ac0,ac1,100,4)
---enigma.AddRubberBand(ac0,ac1,-100,4)
 enigma.AddRubberBand(ac0,ac2,100,4)
---enigma.AddRubberBand(ac0,ac2,-100,4)
 enigma.AddRubberBand(ac1,ac2,100,6)
 enigma.AddRubberBand(ac1,ac2,-10,0)
     ]]></el:luamain>

Modified: trunk/data/levels/enigma_iii/index.xml
===================================================================
--- trunk/data/levels/enigma_iii/index.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_iii/index.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -66,7 +66,7 @@
     <level _seq="58" _title="Sacrifice" _xpath="./duffy49_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy49" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="59" _title="Double-Maze" _xpath="./duffy09_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy9" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="60" _title="Bad Flowers" _xpath="./nat30_1" author="Nat Pryce" ctrl="force" easy="true" id="nat30" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="61" _title="Fool the Warden" _xpath="./duffy37_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy37" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="61" _title="Fool the Warden" _xpath="./duffy37_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy37" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="62" _title="Don't Touch" _xpath="./raoul07_2" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul07" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="63" _title="Emergency Exit" _xpath="./ss05_1" author="Sven Siggelkow" ctrl="force" easy="false" id="ss5" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="64" _title="Laser Castle" _xpath="./andreas04_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas04" rel="1" rev="10" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_iv/duffy125_2.xml
===================================================================
--- trunk/data/levels/enigma_iv/duffy125_2.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_iv/duffy125_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Triple-Maze" el:subtitle="" el:id="duffy125"/>
-      <el:version el:score="2" el:release="2" el:revision="7" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="8" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2004 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -28,7 +28,7 @@
 ti["x"] = {"it-yinyang"}
 ti["z"] = {"#ac_marble_black", "a1"} .. ti["x"]
 ti["y"] = {"#ac_marble_white", "a3"} .. ti["x"]
-ti["h"] = {"#ac-horse", "a2"}
+ti["h"] = {"#ac_horse", "a2"}
 
 w, h = wo(ti, " ", {
 "####################",

Modified: trunk/data/levels/enigma_iv/duffy73_3.xml
===================================================================
--- trunk/data/levels/enigma_iv/duffy73_3.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_iv/duffy73_3.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Bizarro World" el:subtitle="" el:id="duffy73"/>
-      <el:version el:score="2" el:release="3" el:revision="7" el:status="released"/>
+      <el:version el:score="2" el:release="3" el:revision="8" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -66,8 +66,8 @@
 ti["a"] = {"st-greenbrown_hole"} .. ti["A"]
 ti["b"] = ti["%"] .. ti["A"]
 ti["I"] = {"st-invisible"}
-ti["M"] = {"#ac-rotor", player=1, adhesion=0, range=4, force=-5} .. ti["l"]
-ti["N"] = {"#ac-top", player=1, adhesion=0, range=8, force=20} .. ti["i"]
+ti["M"] = {"#ac_rotor", player=1, adhesion=0, range=4, strength=-5} .. ti["l"]
+ti["N"] = {"#ac_top", player=1, adhesion=0, range=8, strength=20} .. ti["i"]
 ti["R"] = {"st_oneway", orientation=EAST} .. ti["l"]
 ti["J"] = {"st-break_acwhite"}
 ti["D"] = {"it-dynamite"}

Modified: trunk/data/levels/enigma_iv/index.xml
===================================================================
--- trunk/data/levels/enigma_iv/index.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_iv/index.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -73,7 +73,7 @@
     <level _seq="65" _title="Little Bit of Everything" _xpath="./duffy34_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy34" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="66" _title="Snowball Fight" _xpath="./nat14_1" author="Nat Pryce" ctrl="force" easy="false" id="nat14" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="67" _title="U-Swap" _xpath="./ralf15_1" author="Ralf Westram" ctrl="force" easy="true" id="ralf15" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="68" _title="Triple-Maze" _xpath="./duffy125_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy125" rel="2" rev="7" score="2" target="time" unit="duration"/>
+    <level _seq="68" _title="Triple-Maze" _xpath="./duffy125_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy125" rel="2" rev="8" score="2" target="time" unit="duration"/>
     <level _seq="69" _title="The Dark Outside" _xpath="./andreas16_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas16" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="70" _title="Electric Meditation" _xpath="./duffy123_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy123" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="71" _title="Seed Puzzle" _xpath="./duffy77_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy77" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -103,7 +103,7 @@
     <level _seq="95" _title="MetaPuzzle" _xpath="./ant03_1" author="Petr Machata" ctrl="force" easy="false" id="ant03" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="96" _title=".c.R.e.A.z.Y.w.O.r.L.d." _xpath="./martin100_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin100" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="97" _title="Over the Lake" _xpath="./siegfried27_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level9d" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="98" _title="Bizarro World" _xpath="./duffy73_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy73" rel="3" rev="7" score="2" target="time" unit="duration"/>
+    <level _seq="98" _title="Bizarro World" _xpath="./duffy73_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy73" rel="3" rev="8" score="2" target="time" unit="duration"/>
     <level _seq="99" _title="Little Puzzles" _xpath="./wb11_1" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb11" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="100" _title="Big Adventures" _xpath="./wb12_1" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb12" rel="1" rev="0" score="1" target="time" unit="duration"/>
   </levels>

Modified: trunk/data/levels/enigma_vi/index.xml
===================================================================
--- trunk/data/levels/enigma_vi/index.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_vi/index.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -58,7 +58,7 @@
     <level _seq="50" _title="Hot Meditation" _xpath="./ral08_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20060527ral010" rel="1" rev="42" score="1" target="time" unit="duration"/>
     <level _seq="51" _title="Just a Maze?" _xpath="./duffy12_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy12" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="52" _title="Checkmate II" _xpath="./andreas35_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas35" rel="1" rev="4" score="1" target="time" unit="duration"/>
-    <level _seq="53" _title="Bodyguard" _xpath="./ral10_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20060730ral012" rel="2" rev="99" score="1" target="time" unit="duration"/>
+    <level _seq="53" _title="Bodyguard" _xpath="./ral10_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20060730ral012" rel="2" rev="100" score="1" target="time" unit="duration"/>
     <level _seq="54" _title="be quick or be dead" _xpath="./illmind12_1" author="illmind" ctrl="force" easy="true" id="illmind12" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="55" _title="Puzzle Puzzles" _xpath="./raoul26_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul26" rel="1" rev="25" score="1" target="time" unit="duration"/>
     <level _seq="56" _title="Tarzan" _xpath="./ulf03_1" author="Ulf Stegemann" ctrl="force" easy="true" id="20060629ulf003" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -77,7 +77,7 @@
     <level _seq="69" _title="Devil's Bolder" _xpath="./just14_1" author="JuSt" ctrl="force" easy="true" id="just14" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="70" _title="Twisting by the pool" _xpath="./alain23_1" author="Alain Busser" ctrl="force" easy="true" id="alain23" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="71" _title="Revolver" _xpath="./ral16_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070214ral703" rel="1" rev="59" score="1" target="time" unit="duration"/>
-    <level _seq="72" _title="Same task ..." _xpath="./raoul29_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul29" rel="1" rev="6" score="1" target="time" unit="duration"/>
+    <level _seq="72" _title="Same task ..." _xpath="./raoul29_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul29" rel="1" rev="7" score="1" target="time" unit="duration"/>
     <level _seq="73" _title="ZigZag" _xpath="./ralf06_1" author="Ralf Westram" ctrl="force" easy="true" id="ralf06" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="74" _title="Houdini" _xpath="./ral11_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20060816ral719" rel="2" rev="58" score="2" target="time" unit="duration"/>
     <level _seq="75" _title="The wrong Place?" _xpath="./just17_1" author="JuSt" ctrl="force" easy="false" id="just17" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_vi/ral10_2.xml
===================================================================
--- trunk/data/levels/enigma_vi/ral10_2.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_vi/ral10_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Bodyguard" el:subtitle="In the line of thieves" el:id="20060730ral012"/>
-      <el:version el:score="1" el:release="2" el:revision="$Revision: 99 $" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="$Revision: 100 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2006 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -32,8 +32,8 @@
 
 ti["1"] = ti["."] .. {"#ac_marble_black", player=0}
 ti["0"] = ti["."] .. {"#ac_marble_white", player=1, controllers=2}
-ti["H"] = ti["."] .. {"#ac-horse", force=1, destination={"op%1", "op%2","op%3", "op%4"}}
-ti["h"] = ti["."] .. {"#ac-horse", force=1, destination={"ip%1", "ip%2","ip%3", "ip%4"}}
+ti["H"] = ti["."] .. {"#ac_horse", strength=1, destination={"op%1", "op%2","op%3", "op%4"}}
+ti["h"] = ti["."] .. {"#ac_horse", strength=1, destination={"ip%1", "ip%2","ip%3", "ip%4"}}
 
 ti["T"] = {"it-document", text="help_keys"}
 ti["template_inner"] = {"fl-thief", "ip%%"}

Modified: trunk/data/levels/enigma_vi/raoul29_1.xml
===================================================================
--- trunk/data/levels/enigma_vi/raoul29_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_vi/raoul29_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Same task ..." el:subtitle="... different Mirrors" el:id="raoul29"/>
-      <el:version el:score="1" el:release="1" el:revision="6" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="7" el:status="released"/>
       <el:author  el:name="Raoul Bourquin" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Raoul Bourquin</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -59,11 +59,11 @@
 })
 
 if  wo["IsDifficult"]  then
-    wo[{10, 0.5}] = {"ac-rotor", force=20, range=15, prefercurrent=1}
-    wo[{10, 12.5}] = {"ac-rotor", force=20, range=15, prefercurrent=1}
+    wo[{10, 0.5}] = {"ac_rotor", strength=20, range=15, prefercurrent=1}
+    wo[{10, 12.5}] = {"ac_rotor", strength=20, range=15, prefercurrent=1}
 else
-    wo[{10, 0.5}] = {"ac-rotor", force=10, range=15, prefercurrent=1}
-    wo[{10, 12.5}] = {"ac-rotor", force=10, range=15, prefercurrent=1}
+    wo[{10, 0.5}] = {"ac_rotor", strength=10, range=15, prefercurrent=1}
+    wo[{10, 12.5}] = {"ac_rotor", strength=10, range=15, prefercurrent=1}
 end
 wo:shuffleOxyd()
     ]]></el:luamain>

Modified: trunk/data/levels/enigma_vii/andreas46_3.xml
===================================================================
--- trunk/data/levels/enigma_vii/andreas46_3.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_vii/andreas46_3.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Tinker, Tailor" el:subtitle="" el:id="andreas46"/>
-      <el:version el:score="2" el:release="4" el:revision="7" el:status="released"/>
+      <el:version el:score="2" el:release="4" el:revision="8" el:status="released"/>
       <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Andreas Lochmann</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -28,7 +28,7 @@
 ti["o "] = {"st_oxyd", flavor = "b"}
 ti["S*"] = {"st_scissors", name = "scissors%%", target = "call_scissors"}
 ti["C "] = {"st_scissors", name = "scissors_central", target = "call_scissors"}
-ti["X*"] = {"st-glass1"} .. ti({"#ac-horse", name = "horse%%"})
+ti["X*"] = {"st-glass1"} .. ti({"#ac_horse", name = "horse%%"})
 ti["s*"] = {"st-grate2", name = "parascissors%%"}
 ti["c "] = {"st-grate2", name = "parascissors_central"}
 ti["x*"] = {"st-glass1_hole", name = "paraplace%%"}
@@ -180,8 +180,7 @@
   --       they're connected to. It's the paraplace which Goal
   --       references to, in contrast to the real situation on
   --       the left side.
-  wo[no["paraplace%"..j]] = {"#ac-horse", name = "parahorse%"..Goal[j],
-                                          force = 4 + j/10}
+  wo[no["paraplace%"..j]] = {"#ac_horse", name = "parahorse%"..Goal[j], strength = 4 + j/10}
 end
 
 for j = 1, 8 do

Modified: trunk/data/levels/enigma_vii/index.xml
===================================================================
--- trunk/data/levels/enigma_vii/index.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_vii/index.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -54,7 +54,7 @@
     <level _seq="46" _title="Double Oneways" _xpath="./duffy172_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy172" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="47" _title="Wood - Water - Wood" _xpath="./duffy173_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy173" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="48" _title="Transpositions" _xpath="./duffy174_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy174" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="49" _title="Puppet" _xpath="./pulley06_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley06" rel="2" rev="4" score="1" target="time" unit="duration"/>
+    <level _seq="49" _title="Puppet" _xpath="./pulley06_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley06" rel="2" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="50" _title="Restless Meditation" _xpath="./ral09_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070623ral914" rel="2" rev="126" score="1" target="time" unit="duration"/>
     <level _seq="51" _title="Ghost Driver" _xpath="./duffy176_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy176" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="52" _title="Re-entry Circuit" _xpath="./pulley05_2" author="Mark Pulley" ctrl="force" easy="false" id="pulley05" rel="2" rev="4" score="1" target="time" unit="duration"/>
@@ -62,7 +62,7 @@
     <level _seq="54" _title="Give Way" _xpath="./just20_1" author="JuSt" ctrl="force" easy="false" id="just20" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="55" _title="Give more Way" _xpath="./just21_2" author="JuSt" ctrl="force" easy="true" id="just21" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="56" _title="Give Way 4 two" _xpath="./just22_2" author="JuSt" ctrl="force" easy="true" id="just22" rel="2" rev="2" score="2" target="time" unit="duration"/>
-    <level _seq="57" _title="Lost in Time and Space" _xpath="./just23_1" author="JuSt" ctrl="force" easy="false" id="just23" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="57" _title="Lost in Time and Space" _xpath="./just23_2" author="JuSt" ctrl="force" easy="false" id="just23" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="58" _title="Alternatives?" _xpath="./just24_1" author="JuSt" ctrl="force" easy="true" id="just24" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="59" _title="No More Alternatives" _xpath="./just25_1" author="JuSt" ctrl="force" easy="true" id="just25" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="60" _title="The Walls" _xpath="./just26_1" author="JuSt" ctrl="force" easy="true" id="just26" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -83,8 +83,8 @@
     <level _seq="75" _title="Swapping Puzzle II" _xpath="./joe22_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe22" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="76" _title="Multiban" _xpath="./dpl01_1" author="Dominik Leipold" ctrl="force" easy="false" id="dpl01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="77" _title="Riverside" _xpath="./johann02_2" author="Johann Freymuth" ctrl="force" easy="false" id="johann02" rel="2" rev="0" score="2" target="time" unit="duration"/>
-    <level _seq="78" _title="The Lone Ranger" _xpath="./pulley04_2" author="Mark Pulley" ctrl="force" easy="false" id="pulley04" rel="2" rev="4" score="2" target="time" unit="duration"/>
-    <level _seq="79" _title="Little Shop Of Horrors" _xpath="./pulley07_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley07" rel="1" rev="6" score="1" target="time" unit="duration"/>
+    <level _seq="78" _title="The Lone Ranger" _xpath="./pulley04_2" author="Mark Pulley" ctrl="force" easy="false" id="pulley04" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="79" _title="Little Shop Of Horrors" _xpath="./pulley07_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley07" rel="1" rev="7" score="1" target="time" unit="duration"/>
     <level _seq="80" _title="Spaceship Control" _xpath="./safalra01_1" author="Safalra" ctrl="force" easy="false" id="safalra01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="81" _title="Ball Alley" _xpath="./johann01_1" author="Johann Freymuth" ctrl="force" easy="false" id="johann01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="82" _title="Action Potential" _xpath="./pulley02_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley02" rel="2" rev="3" score="1" target="time" unit="duration"/>
@@ -93,7 +93,7 @@
     <level _seq="85" _title="Lady in Red" _xpath="./just30_1" author="Just" ctrl="force" easy="true" id="just30" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="86" _title="Crawling the Abyss" _xpath="./sph02_1" author="ShadowPhrogg32642342" ctrl="force" easy="true" id="sph02" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="87" _title="Bold Boulder" _xpath="./ral14_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20061124ral279" rel="1" rev="127" score="1" target="time" unit="duration"/>
-    <level _seq="88" _title="Tinker, Tailor" _xpath="./andreas46_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas46" rel="4" rev="7" score="2" target="time" unit="duration"/>
+    <level _seq="88" _title="Tinker, Tailor" _xpath="./andreas46_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas46" rel="4" rev="8" score="2" target="time" unit="duration"/>
     <level _seq="89" _title="Elbow Society" _xpath="./andreas45_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas45" rel="2" rev="6" score="2" target="time" unit="duration"/>
     <level _seq="90" _title="Watchmaker" _xpath="./huesing01_1" author="Johannes H?sing" ctrl="force" easy="false" id="huesing01" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="91" _title="Map it out II" _xpath="./manuel01_1" author="Manuel Eisentraut" ctrl="force" easy="true" id="manuel01" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -103,9 +103,9 @@
     <level _seq="95" _title="Pick-Up" _xpath="./joe27_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe27" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="96" _title="A Kind of Magic" _xpath="./just37_1" author="JuSt" ctrl="force" easy="true" id="JuStA Kind of Magic" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="97" _title="Blue Screen Of Death" _xpath="./pulley10_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley10" rel="2" rev="1" score="2" target="time" unit="duration"/>
-    <level _seq="98" _title="Audience in Venice" _xpath="./mecke09_2" author="mecke" ctrl="force" easy="true" id="mecke9" rel="2" rev="24" score="1" target="time" unit="duration"/>
-    <level _seq="99" _title="Black Liberation" _xpath="./mecke11_2" author="mecke" ctrl="force" easy="true" id="mecke11" rel="2" rev="29" score="1" target="time" unit="duration"/>
-    <level _seq="100" _title="Jack-Of-All-Trades" _xpath="./mecke12_2" author="mecke" ctrl="force" easy="true" id="mecke12" rel="2" rev="34" score="1" target="time" unit="duration"/>
+    <level _seq="98" _title="Audience in Venice" _xpath="./mecke09_2" author="mecke" ctrl="force" easy="true" id="mecke9" rel="2" rev="25" score="1" target="time" unit="duration"/>
+    <level _seq="99" _title="Black Liberation" _xpath="./mecke11_2" author="mecke" ctrl="force" easy="true" id="mecke11" rel="2" rev="30" score="1" target="time" unit="duration"/>
+    <level _seq="100" _title="Jack-Of-All-Trades" _xpath="./mecke12_2" author="mecke" ctrl="force" easy="true" id="mecke12" rel="2" rev="35" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Modified: trunk/data/levels/enigma_vii/mecke09_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/mecke09_2.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_vii/mecke09_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Audience in Venice" el:subtitle="Press the Triggers" el:id="mecke9"/>
-      <el:version el:score="1" el:release="2" el:revision="$Revision: 24 $" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="$Revision: 25 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -120,7 +120,7 @@
 ti["n-"] =  ti[" 5"] ..{"st_actorimpulse_invisible"}
 ti["ni"] = ti[" )"] ..{"it-coffee"}
 ti["x "] = {"#ac_marble_black"}
-ti["r "] = {"#ac-top", range="1", force="1"}
+ti["r "] = {"#ac_top", range=1, strength=1}
 ti["p1"] = ti[" $"] .. {"it-document", text="text1"}
 ti["p2"] = ti[" !"] .. {"it-document", text="text2"}
 ti["p3"] = ti[" -"] .. {"it-document", text="text3"}

Modified: trunk/data/levels/enigma_vii/mecke11_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/mecke11_2.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_vii/mecke11_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Black Liberation" el:subtitle="Black is Beautiful" el:id="mecke11" />
-      <el:version el:score="1" el:release="2" el:revision="$Revision:29$" el:status="released" />
+      <el:version el:score="1" el:release="2" el:revision="$Revision:30$" el:status="released" />
       <el:author el:name="mecke" el:email="" />
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true" />
@@ -121,10 +121,10 @@
 ti["vv"] = ti[" '"] .. {"it_strip", connections="ns"}
 ti["hh"] = ti[" '"] .. {"it_strip", connections="ew"}
 ti["hi"] = ti["a1"] .. {"it_strip", connections="ew"}
-ti["JJ"] = ti[" #"] .. {"#ac-top", range=10, force=10}
-ti["a2"] = ti[" #"] .. {"#ac-top", range=1, force=1}
-ti["a3"] = ti[" #"] .. {"#ac-top", range=3, force=3}
-ti["a6"] = ti["a5"] .. {"#ac-top", range=1, force=1}
+ti["JJ"] = ti[" #"] .. {"#ac_top", range=10, strength=10}
+ti["a2"] = ti[" #"] .. {"#ac_top", range=1, strength=1}
+ti["a3"] = ti[" #"] .. {"#ac_top", range=3, strength=3}
+ti["a6"] = ti["a5"] .. {"#ac_top", range=1, strength=1}
 ti["se"] = ti[" #"] .. {"it_seed"}
 ti["sc"] = ti[" *"] .. {"it_cherry"}
 ti["sb"] = ti[" )"] .. {"st-block"}

Modified: trunk/data/levels/enigma_vii/mecke12_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/mecke12_2.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_vii/mecke12_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Jack-Of-All-Trades" el:subtitle="Find The Paradise" el:id="mecke12"/>
-      <el:version el:score="1" el:release="2" el:revision="$Revision: 34 $" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="$Revision: 35 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -125,8 +125,8 @@
 ti["d7"] =  ti[" !"] ..{"st_door", faces="ns", name= "olli7"}
 ti["d8"] =  ti[" !"] ..{"st_door", faces="ns", name= "olli8"}
 ti["x "] = {"#ac_marble_black"}
-ti["r "] = {"#ac-rotor", range="7", force="7"}
-ti["q "] = {"#ac-top", range="10", force="10"}
+ti["r "] = {"#ac_rotor", range=7, strength=7}
+ti["q "] = {"#ac_top", range=10, strength=10}
 ti["v1"] =  ti[" !"] ..{"it_vortex_open", name="vortex1", destination="vortex2"}
 ti["v2"] =  ti[" $"] ..{"it_vortex_open", name="vortex2", destination={"vortex3","vortex1"}}
 ti["v3"] =  ti["z7"] ..{"it_vortex_open", name="vortex3", destination="vortex1"}

Modified: trunk/data/levels/enigma_vii/pulley04_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/pulley04_2.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_vii/pulley04_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="The Lone Ranger" el:subtitle="" el:id="pulley04"/>
-      <el:version el:score="2" el:release="2" el:revision="4" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="5" el:status="released"/>
       <el:author  el:name="Mark Pulley" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Mark Pulley</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -53,14 +53,14 @@
 ti["N"] = ti[" "] .. {"it-dynamite"}
 ti["O"] = ti["y"] .. {"st-invisible"} --Invisible stone on blue floor
 ti["P"] = ti[" "] .. {"st_door_a", name="Door1"} -- Tonto's prison door
-ti["Q"] = ti[" "] .. {"#ac-rotor", range=10, gohome=0}
+ti["Q"] = ti[" "] .. {"#ac_rotor", range=10, gohome=0}
 ti["R"] = ti["r"] .. {"st-invisible"} --Invisible stone on red floor
 ti["S"] = ti[" "] .. {"st_door_a", name="Door2"} -- Silver's prison door
 ti["T"] = ti["y"] .. {"st-thief"} --Thief on blue floor
 ti["U"] = ti[" "] .. {"it-crack3"}
-ti["V"] = ti[" "] .. {"#ac-rotor", name="RGuard1", gohome=0} -- Lone Ranger's Guard
-ti["W"] = ti[" "] .. {"#ac-rotor", name="RGuard2", gohome=0} -- Lone Ranger's Guard
-ti["X"] = ti[" "] .. {"#ac-rotor", name="RGuard3", gohome=0} -- Lone Ranger's Guard
+ti["V"] = ti[" "] .. {"#ac_rotor", name="RGuard1", gohome=0} -- Lone Ranger's Guard
+ti["W"] = ti[" "] .. {"#ac_rotor", name="RGuard2", gohome=0} -- Lone Ranger's Guard
+ti["X"] = ti[" "] .. {"#ac_rotor", name="RGuard3", gohome=0} -- Lone Ranger's Guard
 ti["Y"] = ti["y"] .. {"st_passage_white_slash"} --White grill on blue floor
 ti["Z"] = (ti[" "] .. {"it_death"}) .. {"st-break_gray"} --Tomb door with corpse
 ti["0"] = ti[" "] .. {"st_oxyd"}
@@ -74,7 +74,7 @@
 ti["$"] = ti[" "] .. {"st_box_wood"} .. ti({"it-yinyang"})
 ti["%"] = ti[" "] .. {"st_death_invisible"}
 ti["&"] = ti[" "] .. {"st_actorimpulse_invisible"}
-ti["*"] = ti[" "] .. {"#ac-rotor", range=5, force=100}
+ti["*"] = ti[" "] .. {"#ac_rotor", range=5, strength=100}
 ti[":"] = ti[" "] .. {"st-break_gray"} -- Tomb doors
 ti["v"] = {"fl-gradient14"} -- Down
 ti["<"] = {"fl-gradient15"} -- Left

Modified: trunk/data/levels/enigma_vii/pulley06_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/pulley06_2.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_vii/pulley06_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Puppet" el:subtitle="" el:id="pulley06"/>
-      <el:version el:score="1" el:release="2" el:revision="4" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="5" el:status="released"/>
       <el:author  el:name="Mark Pulley" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Mark Pulley</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -15,11 +15,11 @@
 if wo["IsDifficult"] then
     ti[" "]= {"fl-gradient14"}
     ti["^"]= {"fl-gradient13"} -- Up
-    ti["f"]= {"ac-horse", name="footL"} .. ti({"fl-gradient13"})
+    ti["f"]= {"ac_horse", name="footL"} .. ti({"fl-gradient13"})
 else
     ti[" "]= {"fl-normal"}
     ti["^"]= {"fl-normal"}
-    ti["f"]= {"ac-horse", name="footL"} .. ti({"fl-normal"})
+    ti["f"]= {"ac_horse", name="footL"} .. ti({"fl-normal"})
 end
 ti["b"] = {"fl-bluegreen"}
 ti["g"] = {"st-grate3"}
@@ -27,16 +27,16 @@
 ti["Y"] = {"st-glass", name="support1"}
 ti["Z"] = {"st-glass", name="support2"}
 --ti["z"] = {"st-glass1_move"}
-ti["O"] = {"#ac-horse", name="head"}
-ti["S"] = {"#ac-horse", name="shoulder"}
-ti["e"] = {"#ac-horse", name="elbowL"}
-ti["L"] = {"#ac-horse", name="elbowR"}
-ti["h"] = {"#ac-horse", name="handL"}
-ti["N"] = {"#ac-horse", name="handR"}
-ti["P"] = {"#ac-horse", name="hip"}
-ti["k"] = {"#ac-horse", name="kneeL"}
-ti["K"] = {"#ac-horse", name="kneeR"}
-ti["R"] = {"#ac-horse", name="footR"}
+ti["O"] = {"#ac_horse", name="head"}
+ti["S"] = {"#ac_horse", name="shoulder"}
+ti["e"] = {"#ac_horse", name="elbowL"}
+ti["L"] = {"#ac_horse", name="elbowR"}
+ti["h"] = {"#ac_horse", name="handL"}
+ti["N"] = {"#ac_horse", name="handR"}
+ti["P"] = {"#ac_horse", name="hip"}
+ti["k"] = {"#ac_horse", name="kneeL"}
+ti["K"] = {"#ac_horse", name="kneeR"}
+ti["R"] = {"#ac_horse", name="footR"}
 ti["door"] = {"st_door", name="Door%%", flavor="a"} .. ti["b"]
 ti["W"] = {"st_brick"}
 ti["trigger"]= {"it_trigger", target="Door%%"} .. ti["b"]

Modified: trunk/data/levels/enigma_vii/pulley07_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/pulley07_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_vii/pulley07_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Little Shop Of Horrors" el:subtitle="Watch out, here comes Audrey II!" el:id="pulley07"/>
-      <el:version el:score="1" el:release="1" el:revision="6" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="7" el:status="released"/>
       <el:author  el:name="Mark Pulley" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Mark Pulley</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -77,7 +77,7 @@
 ti["K"] = ti["z"] .. {"#ac_pearl_white", name="Mushnik", controllers=0,essential=-1}
 ti["L"] = ti["f"] .. {"#ac_pearl_white", name="Audrey", controllers=0,essential=-1}
 ti["Y"] = ti[" "] .. {"st-grate3"}
-ti["M"] = ti["Y"] .. {"#ac-horse", force=3, name="horse", destination={"d1","d2","d3","d4"}} -- Chiffon, Crystal, Ronnette
+ti["M"] = ti["Y"] .. {"#ac_horse", strength=3, name="horse", destination={"d1","d2","d3","d4"}} -- Chiffon, Crystal, Ronnette
 ti["O"] = ti[" "] .. {"st_panel", cluster=1}
 ti["P"] = {"fl-white"} .. ti({"st-plain_break"})
 ti["Q"] = ti[" "] .. {"st-rock3_hole"}

Modified: trunk/data/levels/enigma_viii/index.xml
===================================================================
--- trunk/data/levels/enigma_viii/index.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/index.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -7,18 +7,18 @@
 
   <levels>
     <level _seq="1" _title="Welcome" _xpath="./welcometopack8_1" author="Raoul Bourquin" ctrl="force" easy="true" id="welcometopack8" rel="1" rev="3" score="1" target="time" unit="duration"/>
-    <level _seq="2" _title="Enigmaparcour I" _xpath="./mecke15_1" author="mecke" ctrl="force" easy="true" id="mecke15" rel="1" rev="24" score="1" target="time" unit="duration"/>
-    <level _seq="3" _title="Rhythm of Space" _xpath="./mecke20_2" author="mecke" ctrl="force" easy="true" id="mecke20" rel="2" rev="24" score="1" target="time" unit="duration"/>
+    <level _seq="2" _title="Enigmaparcour I" _xpath="./mecke15_1" author="mecke" ctrl="force" easy="true" id="mecke15" rel="1" rev="25" score="1" target="time" unit="duration"/>
+    <level _seq="3" _title="Rhythm of Space" _xpath="./mecke20_2" author="mecke" ctrl="force" easy="true" id="mecke20" rel="2" rev="25" score="1" target="time" unit="duration"/>
     <level _seq="4" _title="The Show Jumper" _xpath="./andreas47_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas47" rel="1" rev="7" score="1" target="time" unit="duration"/>
     <level _seq="5" _title="The Red Room" _xpath="./joe29_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe29" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="6" _title="Enigmines" _xpath="./huffman01_1" author="Brian Huffman" ctrl="force" easy="true" id="huffman01" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="7" _title="Red Cave" _xpath="./mecke21_2" author="mecke" ctrl="force" easy="true" id="mecke21" rel="2" rev="34" score="1" target="time" unit="duration"/>
+    <level _seq="7" _title="Red Cave" _xpath="./mecke21_2" author="mecke" ctrl="force" easy="true" id="mecke21" rel="2" rev="35" score="1" target="time" unit="duration"/>
     <level _seq="8" _title="Status code 302" _xpath="./devnull02_1" author="/dev/null" ctrl="force" easy="true" id="devnull02" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="9" _title="A Screenful of Secrets" _xpath="./mecke01_1" author="mecke" ctrl="force" easy="true" id="mecke01" rel="1" rev="25" score="1" target="time" unit="duration"/>
-    <level _seq="10" _title="Southside Life" _xpath="./mecke10_2" author="mecke" ctrl="force" easy="true" id="mecke10" rel="2" rev="21" score="1" target="time" unit="duration"/>
+    <level _seq="9" _title="A Screenful of Secrets" _xpath="./mecke01_1" author="mecke" ctrl="force" easy="true" id="mecke01" rel="1" rev="26" score="1" target="time" unit="duration"/>
+    <level _seq="10" _title="Southside Life" _xpath="./mecke10_2" author="mecke" ctrl="force" easy="true" id="mecke10" rel="2" rev="22" score="1" target="time" unit="duration"/>
     <level _seq="11" _title="Joona's Chess" _xpath="./joona02_1" author="Joona Laire" ctrl="force" easy="true" id="joona02" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="12" _title="Helios I" _xpath="./mecke07_1" author="mecke" ctrl="force" easy="false" id="mecke48" rel="1" rev="14" score="1" target="time" unit="duration"/>
-    <level _seq="13" _title="The Green Hell" _xpath="./mecke22_2" author="mecke" ctrl="force" easy="true" id="mecke22" rel="2" rev="69" score="1" target="time" unit="duration"/>
+    <level _seq="12" _title="Helios I" _xpath="./mecke07_1" author="mecke" ctrl="force" easy="false" id="mecke48" rel="1" rev="15" score="1" target="time" unit="duration"/>
+    <level _seq="13" _title="The Green Hell" _xpath="./mecke22_2" author="mecke" ctrl="force" easy="true" id="mecke22" rel="2" rev="70" score="1" target="time" unit="duration"/>
     <level _seq="14" _title="Tilt Board" _xpath="./ulf06_2" author="Ulf Stegemann" ctrl="force" easy="true" id="20080529ulf118" rel="2" rev="116" score="2" target="time" unit="duration"/>
     <level _seq="15" _title="4 - 8 - 4" _xpath="./dpl03_3" author="Dominik Leipold" ctrl="force" easy="true" id="20070821dpl003" rel="3" rev="4" score="3" target="time" unit="duration"/>
     <level _seq="16" _title="Impulsive Order" _xpath="./raywick05_1" author="Ray Wick" ctrl="force" easy="true" id="raywick5" rel="1" rev="7" score="1" target="time" unit="duration"/>
@@ -33,19 +33,19 @@
     <level _seq="25" _title="Microwire" _xpath="./ral27_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral427" rel="1" rev="127" score="1" target="time" unit="duration"/>
     <level _seq="26" _title="More Microwire" _xpath="./ral28_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral282" rel="1" rev="127" score="1" target="time" unit="duration"/>
     <level _seq="27" _title="Freestyle Microwire" _xpath="./ral29_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080719ral530" rel="1" rev="127" score="1" target="time" unit="duration"/>
-    <level _seq="28" _title="Balance Beam" _xpath="./mecke03_1" author="mecke" ctrl="force" easy="true" id="mecke03" rel="1" rev="31" score="1" target="time" unit="duration"/>
+    <level _seq="28" _title="Balance Beam" _xpath="./mecke03_1" author="mecke" ctrl="force" easy="true" id="mecke03" rel="1" rev="32" score="1" target="time" unit="duration"/>
     <level _seq="29" _title="Colored Oxyds" _xpath="./andreas50_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas50" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="30" _title="Styles Change" _xpath="./andreas48_2" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas48" rel="2" rev="7" score="2" target="time" unit="duration"/>
     <level _seq="31" _title="Colored Turnstiles" _xpath="./andreas51_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas51" rel="1" rev="3" score="1" target="time" unit="duration"/>
-    <level _seq="32" _title="Sanssouci" _xpath="./mecke05_1" author="mecke" ctrl="force" easy="true" id="mecke05" rel="1" rev="29" score="1" target="time" unit="duration"/>
+    <level _seq="32" _title="Sanssouci" _xpath="./mecke05_1" author="mecke" ctrl="force" easy="true" id="mecke05" rel="1" rev="30" score="1" target="time" unit="duration"/>
     <level _seq="33" _title="Wired Shogun" _xpath="./ral34_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080828ral417" rel="1" rev="127" score="1" target="time" unit="duration"/>
     <level _seq="34" _title="Scarlet's Necklace" _xpath="./ral30_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080814ral422" rel="1" rev="127" score="1" target="time" unit="duration"/>
     <level _seq="35" _title="- Meditation -" _xpath="./raoul31_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul31" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="36" _title="Relaxing at the sea" _xpath="./devnull08_1" author="/dev/null" ctrl="force" easy="true" id="devnull08" rel="1" rev="14" score="1" target="time" unit="duration"/>
-    <level _seq="37" _title="Helios II" _xpath="./mecke08_1" author="mecke" ctrl="force" easy="true" id="mecke08" rel="1" rev="17" score="1" target="time" unit="duration"/>
-    <level _seq="38" _title="Tutoxyd's Pyramid" _xpath="./ral21_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20070822ral291" rel="1" rev="120" score="1" target="time" unit="duration"/>
-    <level _seq="39" _title="Alternation I" _xpath="./mecke17_1" author="mecke" ctrl="force" easy="false" id="mecke17" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="40" _title="Enigmaparcour II" _xpath="./mecke29_1" author="mecke" ctrl="force" easy="true" id="mecke29" rel="1" rev="4" score="1" target="time" unit="duration"/>
+    <level _seq="37" _title="Helios II" _xpath="./mecke08_1" author="mecke" ctrl="force" easy="true" id="mecke08" rel="1" rev="18" score="1" target="time" unit="duration"/>
+    <level _seq="38" _title="Tutoxyd's Pyramid" _xpath="./ral21_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070822ral291" rel="2" rev="136" score="2" target="time" unit="duration"/>
+    <level _seq="39" _title="Alternation I" _xpath="./mecke17_1" author="mecke" ctrl="force" easy="false" id="mecke17" rel="1" rev="6" score="1" target="time" unit="duration"/>
+    <level _seq="40" _title="Enigmaparcour II" _xpath="./mecke29_1" author="mecke" ctrl="force" easy="true" id="mecke29" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="41" _title=" - Meditation - " _xpath="./devnull07_1" author="/dev/null" ctrl="force" easy="true" id="devnull07" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="42" _title=" - Meditation - " _xpath="./devnull06_1" author="/dev/null" ctrl="force" easy="true" id="devnull06" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="43" _title="- Meditation -" _xpath="./devnull04_1" author="/dev/null" ctrl="force" easy="true" id="devnull04" rel="1" rev="6" score="1" target="time" unit="duration"/>
@@ -55,12 +55,12 @@
     <level _seq="47" _title=" - Meditation - " _xpath="./devnull12_1" author="/dev/null" ctrl="force" easy="true" id="devnull12" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="48" _title="On belay?" _xpath="./devnull15_1" author="/dev/null" ctrl="force" easy="true" id="devnull15" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="49" _title="Hang-dogging?" _xpath="./devnull16_1" author="/dev/null" ctrl="force" easy="true" id="devnull16" rel="1" rev="3" score="1" target="time" unit="duration"/>
-    <level _seq="50" _title="Alternation II" _xpath="./mecke31_1" author="mecke" ctrl="force" easy="false" id="mecke31" rel="1" rev="6" score="1" target="time" unit="duration"/>
-    <level _seq="51" _title="Fifty Years Later ..." _xpath="./mecke23_1" author="mecke" ctrl="force" easy="true" id="mecke23" rel="1" rev="21" score="1" target="time" unit="duration"/>
-    <level _seq="52" _title="Turbulencia" _xpath="./mecke19_1" author="mecke" ctrl="force" easy="true" id="mecke19" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="53" _title="Techno Voodoo" _xpath="./mecke06_1" author="mecke" ctrl="force" easy="false" id="mecke06" rel="1" rev="14" score="1" target="time" unit="duration"/>
-    <level _seq="54" _title="Plutos World" _xpath="./mecke02_1" author="mecke" ctrl="force" easy="false" id="mecke16" rel="1" rev="10" score="1" target="time" unit="duration"/>
-    <level _seq="55" _title="Plutos Confusion" _xpath="./mecke13_1" author="mecke" ctrl="force" easy="false" id="mecke30" rel="1" rev="8" score="1" target="time" unit="duration"/>
+    <level _seq="50" _title="Alternation II" _xpath="./mecke31_1" author="mecke" ctrl="force" easy="false" id="mecke31" rel="1" rev="7" score="1" target="time" unit="duration"/>
+    <level _seq="51" _title="Fifty Years Later ..." _xpath="./mecke23_1" author="mecke" ctrl="force" easy="true" id="mecke23" rel="1" rev="22" score="1" target="time" unit="duration"/>
+    <level _seq="52" _title="Turbulencia" _xpath="./mecke19_1" author="mecke" ctrl="force" easy="true" id="mecke19" rel="1" rev="6" score="1" target="time" unit="duration"/>
+    <level _seq="53" _title="Techno Voodoo" _xpath="./mecke06_1" author="mecke" ctrl="force" easy="false" id="mecke06" rel="1" rev="15" score="1" target="time" unit="duration"/>
+    <level _seq="54" _title="Plutos World" _xpath="./mecke02_1" author="mecke" ctrl="force" easy="false" id="mecke16" rel="1" rev="11" score="1" target="time" unit="duration"/>
+    <level _seq="55" _title="Plutos Confusion" _xpath="./mecke13_1" author="mecke" ctrl="force" easy="false" id="mecke30" rel="1" rev="9" score="1" target="time" unit="duration"/>
     <level _seq="56" _title="Coober Pedy Opals" _xpath="./ral35_1" author="Ronald Lamprecht, Andreas Lochmann" ctrl="force" easy="true" id="20081207ral610" rel="1" rev="126" score="1" target="time" unit="duration"/>
     <level _seq="57" _title="Butterfly Opals" _xpath="./ral36_1" author="Ronald Lamprecht, Andreas Lochmann" ctrl="force" easy="true" id="20081207ral708" rel="1" rev="126" score="1" target="time" unit="duration"/>
     <level _seq="58" _title="Brilliant Opals" _xpath="./ral37_1" author="Ronald Lamprecht, Andreas Lochmann" ctrl="force" easy="true" id="20081212ral162" rel="1" rev="126" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_viii/mecke01_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke01_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke01_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="A Screenful of Secrets" el:subtitle="My First Level" el:id="mecke01"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 25 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 26 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -17,7 +17,7 @@
     <el:luamain><![CDATA[
 wo["ConserveLevel"] = true
 
-ti["R"] = {"#ac-rotor", range="1", force="1"}
+ti["R"] = {"#ac_rotor", range=1, strength=1}
 ti["  "] = {"fl-normal"}
 ti[" r"] = {"fl-red"}
 ti[" h"] = {"fl-himalaya"}
@@ -51,7 +51,7 @@
 ti["| "] = {"st_death_invisible"}
 ti[", "] = {"st_fake_oxydd"}
 ti["= "] = {"st_mirror_triangle", movable=false, transparent=false, orientation=EAST}
-ti["T "] = ti["X "] .. {"#ac-top", range="1", force="1"}
+ti["T "] = ti["X "] .. {"#ac_top", range=1, strength=1}
 ti["6 "] = {"st_panel"}
 ti["b "] = {"it-blackbomb"}
 ti["B "] = ti["b "] .. ti["X "]

Modified: trunk/data/levels/enigma_viii/mecke02_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke02_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke02_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Plutos World" el:subtitle="Deep ..." el:id="mecke16"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 10 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 11 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -93,7 +93,7 @@
 ti["l "] = ti[" n"] ..{"st_polarswitch"}
 ti["mm"] = ti[" ~"] ..{"st-grate1"}
 ti["* "] = ti["mm"] ..{"#ac_marble_black"}
-ti["+ "] = {"#ac-rotor", range=2, force=2,gohome=false}
+ti["+ "] = {"#ac_rotor", range=2, strength=2, gohome=false}
 
 local resolver = res.composer(ti)
 

Modified: trunk/data/levels/enigma_viii/mecke03_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke03_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke03_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Balance Beam" el:subtitle="Balance Beam" el:id="mecke03"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 31 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 32 $" el:status="released"/>
       <el:author  el:name="mecke"/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -40,7 +40,7 @@
 ti["B"] = {"st-glass"}
 ti["0"] = ti["r"] .. {"#ac_marble_black"}
 ti["X"] = ti["r"] .. {"st_oxyd", flavor="a"}
-ti["#"] = ti["z"] .. {"#ac-top", range="3", force="10"}
+ti["#"] = ti["z"] .. {"#ac_top", range=3, strength=10}
 ti["+"] = ti["~"] .. {"st_actorimpulse"}
 ti["Y"] = ti["y"] .. {"it_wormhole"}
 ti["2"] = ti["r"] .. {"st_window_ns",secure=true}

Modified: trunk/data/levels/enigma_viii/mecke05_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke05_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke05_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Sanssouci" el:subtitle="A Baroque Game" el:id="mecke05"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision:29$" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision:30$" el:status="released"/>
       <el:author  el:name="mecke" el:email=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -88,8 +88,8 @@
 ti["g "] = {"it_wrench"}
 ti["7 "] = {"st_window_s",secure=true}
 ti["0 "] = ti["4 "] .. {"#ac_marble_black",0.5,0.5}
-ti["$ "] = ti["9 "] .. {"#ac-top", range="2", force="2"}
-ti["% "] = ti["9 "] .. {"#ac-top", range="7", force="6"}
+ti["$ "] = ti["9 "] .. {"#ac_top", range=2, strength=2}
+ti["% "] = ti["9 "] .. {"#ac_top", range=7, strength=6}
 ti["X "] = {"st_oxyd", flavor="d"}
 ti["( "] = ti["1 "] .. {"it-puller-e"}
 ti[") "] = ti["3 "] .. {"it-puller-w"}

Modified: trunk/data/levels/enigma_viii/mecke06_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke06_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke06_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Techno Voodoo" el:subtitle="Just a Dance ?" el:id="mecke06" />
-      <el:version el:score="1" el:release="1" el:revision="$Revision:14$" el:status="released" />
+      <el:version el:score="1" el:release="1" el:revision="$Revision:15$" el:status="released" />
       <el:author el:name="mecke" el:email="" />
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true" />
@@ -34,8 +34,8 @@
 ti["w "] = {"it_wormhole", range=10, strength=3}
 ti["d "] = {"it-drop"}
 ti["X "] = {"#ac_marble_black"}
-ti["r "] = {"#ac-top", range=5, force=7}
-ti["a "] = {"#ac-bug"}
+ti["r "] = {"#ac_top", range=5, strength=7}
+ti["a "] = {"#ac_bug"}
 ti["$ "] = {"st_oxyd_c"}
 ti["# "] = {"st_fake_oxydc"}
 ti["Y "] = {"st_timer",interval=5,invisible=0}
@@ -60,7 +60,7 @@
 ti["m2"] = ti[" !"] .. {"it_magnet", name="maggi2",state=OFF, range=20, strength=20}
 ti["m3"] = ti[" !"] .. {"it_magnet", name="maggi3",state=OFF, range=20, strength=20}
 ti["m4"] = ti[" !"] .. {"it_magnet", name="maggi4",state=OFF, range=20, strength=20}
-ti["&h"] = ti[" !"] .. {"#ac-horse", name="horse", force=7, destination={"1!","2!","3!","4!"}}
+ti["&h"] = ti[" !"] .. {"#ac_horse", name="horse", strength=7, destination={"1!","2!","3!","4!"}}
 
 local resolver = res.composer(ti)
 

Modified: trunk/data/levels/enigma_viii/mecke07_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke07_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke07_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Helios I" el:subtitle="Use the Lightpassenger" el:id="mecke48"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 14 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 15 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -51,8 +51,8 @@
 ti["P "] = ti[" n"] ..{"st_pull"}
 ti["g "] = {"it_glasses"}
 ti["T "] = ti["g "] .. {"st-grate1"}
-ti["J "] = {"#ac-top", range=1, force=1}
-ti["= "] = {"#ac-horse"}
+ti["J "] = {"#ac_top", range=1, strength=1}
+ti["= "] = {"#ac_horse"}
 ti["$1"] = {"it_trigger", target="olli1"}
 ti["$2"] = {"it_trigger", target="olli2"}
 ti["$3"] = {"it_trigger", target="olli3"}

Modified: trunk/data/levels/enigma_viii/mecke08_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke08_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke08_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Helios II" el:subtitle="Use the Lightpassenger" el:id="mecke08"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 17 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 18 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -68,8 +68,8 @@
 ti["2 "] = {"st-brake"}
 ti["P "] = {"st_pull"}
 
-ti["J "] = {"#ac-top", range=1, force=1}
-ti["= "] = {"#ac-horse"}
+ti["J "] = {"#ac_top", range=1, strength=1}
+ti["= "] = {"#ac_horse"}
 
 ti["Z "] = {"st_floppy", action="open",target="vortex1"}
 ti["V1"] = ti[" _"] ..{"it_vortex_closed", name="vortex1", destination="vortex2"}

Modified: trunk/data/levels/enigma_viii/mecke10_2.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke10_2.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke10_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Southside Life" el:subtitle="...Enjoy!" el:id="mecke10" />
-      <el:version el:score="1" el:release="2" el:revision="$Revision: 21 $" el:status="released" />
+      <el:version el:score="1" el:release="2" el:revision="$Revision: 22 $" el:status="released" />
       <el:author el:name="mecke" el:email="" el:homepage="" />
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true" />
@@ -123,9 +123,9 @@
 ti["j "] = {"it_magicwand"}
 ti["hh"] = ti[" &"] .. {"it_strip", connections="ew"}
 ti["x "] = {"#ac_marble_black"}
-ti["r "] = {"#ac-rotor", range="6", force="10"}
-ti["y "] = {"#ac-top", range="1", force="1"}
-ti["z "] = {"#ac-top", range="3", force="3"}
+ti["r "] = {"#ac_rotor", range=6, strength=10}
+ti["y "] = {"#ac_top", range=1, strength=1}
+ti["z "] = {"#ac_top", range=3, strength=3}
 
 if wo ["IsDifficult"] then
     ti["wd"] = ti[" &"]..{"it_death"}

Modified: trunk/data/levels/enigma_viii/mecke13_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke13_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke13_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Plutos Confusion" el:subtitle="The other side ..." el:id="mecke30"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 8 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 9 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -54,9 +54,9 @@
 ti["v"] = {"st_laser_n", name="laser", state=ON}
 ti["0"] = ti["t"] .. {"#ac_marble_black"}
 ti["X"] = ti[" "] .. {"st_oxyd", flavor="a"}
-ti["#"] = ti[" "] .. {"#ac-top", range="10", force="10"}
-ti["$"] = ti[" "] .. {"#ac-rotor", range="20", force="10"}
-ti["&"] = ti[" "] .. {"#ac-bug"}
+ti["#"] = ti[" "] .. {"#ac_top", range=10, strength=10}
+ti["$"] = ti[" "] .. {"#ac_rotor", range=20, strength=10}
+ti["&"] = ti[" "] .. {"#ac_bug"}
 ti["?"] = ti["~"] .. {"st_actorimpulse"}
 ti["Y"] = ti[" "] .. {"it_wormhole"}
 ti[";"] = ti[" "] .. {"it-document", text="text1"}

Modified: trunk/data/levels/enigma_viii/mecke15_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke15_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke15_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Enigmaparcour I" el:subtitle="Open the Doors" el:id="mecke15"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 24 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 25 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -22,11 +22,11 @@
     ti["  "] = {"fl-abyss_fake"}
     ti[" v"] = {"fl_ice"}
     ti[" '"] = {"fl-rough"}
-    ti["+ "] = ti[" '"] ..{"ac-rotor", 0.5, 0.5,}
+    ti["+ "] = ti[" '"] ..{"ac_rotor", 0.5, 0.5,}
 else
     ti["  "] = {"fl-rough"}
     ti[" v"] = {"fl-rough"}
-    ti["+ "] = ti[" v"] ..{"ac-rotor", 0.5, 0.5}
+    ti["+ "] = ti[" v"] ..{"ac_rotor", 0.5, 0.5}
 end
 ti[" ~"] = {"fl_water"}
 ti[" _"] = {"fl_swamp"}
@@ -102,8 +102,8 @@
 ti["l "] = {"st_turnstilearm", orientation=EAST}
 ti[" *"] = {"it-crack3"}
 ti["* "] = ti[" *"] ..  {"#ac_marble_black"}
-ti["J "] = {"#ac-top", range=1, force=1}
-ti["= "] = {"#ac-horse"}
+ti["J "] = {"#ac_top", range=1, strength=1}
+ti["= "] = {"#ac_horse"}
 ti["$1"] = {"it_trigger", target="door#2"}
 ti["$2"] = {"it_trigger", target="door#1"}
 ti["$3"] = {"it_trigger", target="laser"}

Modified: trunk/data/levels/enigma_viii/mecke17_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke17_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke17_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Alternation I" el:subtitle="Alternation in a Blue Area" el:id="mecke17"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 5 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 6 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -85,7 +85,7 @@
 ti["ps"] = ti["Br"] .. {"it_seed"}
 ti["kk"] = ti["Xw"] .. {"it_cherry"}
 ti["ki"] = ti["gi"] .. {"it_cherry"}
-ti["z&"] = ti[" &"] .. {"#ac-top", range=1, force=1}
+ti["z&"] = ti[" &"] .. {"#ac_top", range=1, strength=1}
 
 local resolver = res.composer(ti)
 

Modified: trunk/data/levels/enigma_viii/mecke19_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke19_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke19_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Turbulencia" el:subtitle="Meditation! Silence? ... Have a Look ..." el:id="mecke19" />
-      <el:version el:score="1" el:release="1" el:revision="$Revision:5$" el:status="released" />
+      <el:version el:score="1" el:release="1" el:revision="$Revision:6$" el:status="released" />
       <el:author el:name="mecke" el:email="" />
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true" />
@@ -77,8 +77,8 @@
 ti["pp"] = ti[" -"] .. {"it_squashed"}
 ti["pn"] = ti["pp"] .. {"st_oneway_e"}
 ti["X "] = {"#ac_pearl_white", essential=1, player=0, controllers=1, name="df1"}
-ti["r "] = ti[" $"] .. {"#ac-rotor", range=1, force=1}
-ti["t "] = ti[" $"] .. {"#ac-top", range=1, force=1}
+ti["r "] = ti[" $"] .. {"#ac_rotor", range=1, strength=1}
+ti["t "] = ti[" $"] .. {"#ac_top", range=1, strength=1}
 ti["8 "] = {"st_puzzle_blue_e"}
 ti["9 "] = {"st_puzzle_blue_w"}
 ti[": "] = {"st_puzzle_blue_ew"}

Modified: trunk/data/levels/enigma_viii/mecke20_2.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke20_2.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke20_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Rhythm of Space" el:subtitle="Only A Labyrinth" el:id="mecke20"/>
-      <el:version el:score="1" el:release="2" el:revision="$Revision: 24 $" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="$Revision: 25 $" el:status="released"/>
       <el:author  el:name="mecke" el:email=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -85,7 +85,7 @@
 ti["::"] = ti[" '"]..{"it-crack2"}
 ti["d1"] = ti[" $"] .. {"it-document", text="beginning"}
 ti["gg"] = ti[" ("]..{"it-puller-e"}
-ti["JJ"] = ti[" %"]..{"#ac-top", range=1, force=1}
+ti["JJ"] = ti[" %"]..{"#ac_top", range=1, strength=1}
 ti["ff"] = ti[" ("]..{"it-flagblack"}
 ti["J "] = {"st_oneway_black_n"}
 ti["K "] = {"st-bluegray"}

Modified: trunk/data/levels/enigma_viii/mecke21_2.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke21_2.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke21_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Red Cave" el:subtitle="In Red Light" el:id="mecke21" />
-      <el:version el:score="1" el:release="2" el:revision="$Revision: 34 $" el:status="released" />
+      <el:version el:score="1" el:release="2" el:revision="$Revision: 35 $" el:status="released" />
       <el:author el:name="mecke" el:email="" />
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true" />
@@ -103,11 +103,11 @@
 ti["fg"] = ti[" ("] .. {"st-glass"}
 ti["fx"] = ti["fg"] .. {"it_floppy"}
 ti["fy"] = ti[" !"] .. {"it-spoon"}
-ti["&h"] = ti[" !"] .. {"#ac-horse"}
-ti["r1"] = ti[" !"] .. {"#ac-top", range=2, force=2}
-ti["r2"] = ti["jj"] .. {"#ac-rotor", range=5, force=5}
-ti["r3"] = ti[" !"] .. {"#ac-rotor", range=8, force=8}
-ti["r4"] = ti[" !"] .. {"#ac-rotor", range=10, force=10}
+ti["&h"] = ti[" !"] .. {"#ac_horse"}
+ti["r1"] = ti[" !"] .. {"#ac_top", range=2, strength=2}
+ti["r2"] = ti["jj"] .. {"#ac_rotor", range=5, strength=5}
+ti["r3"] = ti[" !"] .. {"#ac_rotor", range=8, strength=8}
+ti["r4"] = ti[" !"] .. {"#ac_rotor", range=10, strength=10}
 ti["d5"] = ti[" *"] .. {"st_door", faces="ew", name= "olli5"}
 ti["d6"] = ti[" !"] .. {"st_door", faces="ew", name= "olli6"}
 ti["d7"] = ti[" !"] .. {"st_door", faces="ew", name= "olli7"}

Modified: trunk/data/levels/enigma_viii/mecke22_2.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke22_2.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke22_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="The Green Hell" el:subtitle="Exploration Trip to Green Waters" el:id="mecke22"/>
-      <el:version el:score="1" el:release="2" el:revision="$Revision:69$" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="$Revision:70$" el:status="released"/>
       <el:author  el:name="mecke" el:email=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -216,7 +216,7 @@
 
 if wo ["IsDifficult"] then
    ti["i+"] = ti[" +"] .. {"it_seed_fake"}
-   ti["rr"] = ti[" $"] .. {"#ac-rotor",range="3", force="3"}
+   ti["rr"] = ti[" $"] .. {"#ac_rotor", range=3, strength=3}
    ti["ww"] = {"fl_water"}
    ti["))"] = ti[" l"] .. {"it-burnable_burning"}
    ti[")$"] = ti[" $"] .. {"it-burnable_burning"}
@@ -232,7 +232,7 @@
 else
    ti["i+"] = ti[" +"] .. {"it-dynamite"}
    ti["rt"] = ti[" '"] .. {"st-break_invisible"}
-   ti["rr"] = ti["rt"] .. {"#ac-rotor",range="3", force="3"}
+   ti["rr"] = ti["rt"] .. {"#ac_rotor", range=3, strength=3}
    ti["ww"] = {"fl_swamp"}
    ti["))"] = ti[" l"] .. {"it-burnable_oil"}
    ti[")$"] = ti[" $"] .. {"fl_water"}

Modified: trunk/data/levels/enigma_viii/mecke23_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke23_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke23_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Fifty Years Later ..." el:subtitle="Survival Training in wasted Landscapes ..." el:id="mecke23"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 21 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 22 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -98,9 +98,9 @@
 ti["-m"] = ti["!1"] .. {"it_magnet",state=ON,range=5,strength=-7}
 ti["--"] = ti["!1"] .. {"it_magnet",state=ON,range=10,strength=-12}
 ti["Y "] = {"st_death"}
-ti["XX"] = ti[" O"] .. {"ac-top", 0.5, 0.5, range=1, force=1}
-ti["XA"] = ti["8 "] .. {"ac-top", 0.5, 0.5, range=1, force=1}
-ti["XS"] = ti[" +"] .. {"ac-top", 0.5, 0.5, range=5, force=5}
+ti["XX"] = ti[" O"] .. {"ac_top", 0.5, 0.5, range=1, strength=1}
+ti["XA"] = ti["8 "] .. {"ac_top", 0.5, 0.5, range=1, strength=1}
+ti["XS"] = ti[" +"] .. {"ac_top", 0.5, 0.5, range=5, strength=5}
 ti["XF"] = {"st_mail",orientation = EAST}
 ti["DD"] = ti[" ."] .. {"it_death"}
 ti["BD"] = ti[" o"] .. {"it_death"}
@@ -179,8 +179,8 @@
 ti["&6"] = {"fl-bluegreenx", name="&6"}
 ti["&7"] = {"fl-bluegreenx", name="&7"}
 ti["&8"] = {"fl-bluegreenx", name="&8"}
-ti["&h"] = ti["&1"] .. {"ac-horse", name="horse", destination={"&5","&6","&7","&8"}}
-ti["&r"] = ti[" 1"] .. {"ac-rotor", 0.5, 0.5, range=5, force=5}
+ti["&h"] = ti["&1"] .. {"ac_horse", name="horse", destination={"&5","&6","&7","&8"}}
+ti["&r"] = ti[" 1"] .. {"ac_rotor", 0.5, 0.5, range=5, strength=5}
 ti["t9"] = {"it_trigger", target="laser"}
 ti["PS"] = ti["  "] .. {"st_laserswitch",action="toggle", target={"trixi"}}
 ti[":9"] = {"st_door",faces="ns",name="trixi"}

Modified: trunk/data/levels/enigma_viii/mecke29_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke29_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke29_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Enigmaparcour II" el:subtitle="Open the Doors" el:id="mecke29"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 4 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 5 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -137,8 +137,8 @@
 ti["vv"] = ti[" v"] ..  {"fl_ice",name="hu"}
 ti[" ?"] = ti["wn"] ..  {"it-yinyang"}
 ti["? "] = ti[" ?"] ..  {"#ac_marble_white"}
-ti["J "] = {"#ac-top", range=1, force=1}
-ti["= "] = {"#ac-horse"}
+ti["J "] = {"#ac_top", range=1, strength=1}
+ti["= "] = {"#ac_horse"}
 ti["$1"] = {"it_trigger", target="door#2"}
 ti["$2"] = {"it_trigger", target="door#1"}
 ti["$3"] = {"it_trigger", target="laser1"}

Modified: trunk/data/levels/enigma_viii/mecke31_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke31_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/mecke31_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Alternation II" el:subtitle="Alternation in a Dark Area" el:id="mecke31"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 6 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 7 $" el:status="released"/>
       <el:author el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -97,7 +97,7 @@
 ti["ps"] = ti["Br"] .. {"it_seed"}
 ti["kk"] = ti["Xw"] .. {"it_cherry"}
 ti["ki"] = ti["gi"] .. {"it_cherry"}
-ti["z&"] = ti[" &"] .. {"#ac-top", range=1, force=1}
+ti["z&"] = ti[" &"] .. {"#ac_top", range=1, strength=1}
 ti["Xx"] = ti[" x"] .. {"st_passage_black_cross"}
 ti["Xn"] = ti[" n"] .. {"st_passage_black_cross"}
 ti["Xm"] = ti["Xn"] .. {"it_extralife"}

Deleted: trunk/data/levels/enigma_viii/ral21_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral21_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/ral21_1.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -1,725 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected >
-    <el:info el:type="level">
-      <el:identity el:title="Tutoxyd's Pyramid" el:subtitle="Marble Jones I" el:id="20070822ral291"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 120 $" el:status="released"/>
-      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
-      <el:copyright>Copyright ? 2007,2008 Ronald Lamprecht</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="1.10">
-        <el:dependency el:path="lib/liblua" el:id="lib/liblua" el:release="1" el:preload="true"/>
-        <el:dependency el:path="lib/libpuzzle" el:id="lib/libpuzzle" el:release="3" el:preload="true"/>
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:credits el:showinfo="false" el:showstart="false"></el:credits>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-wo["ConserveLevel"] = true
-wo["ProvideExtralifes"] = false
-wo["ExtralifeGlasses"] = SPOT_DEATH
-wo["Brittleness"] = 1.0
-
-ti["  "] = {"fl-sand"}
-ti["~~"] = {"fl_water"}
-ti["~e"] = {"fl_water", "escape_close#"}
-ti["__"] = {"fl_abyss"}
-ti["_f"] = {"fl-abyss_fake"}
-ti[",,"] = {"fl-concrete"}
-ti[",e"] = {"fl-concrete", "escape_pos"}
-ti[",f"] = {"fl-concrete", "escape_close#"}
-ti[".."] = {"fl-gravel"}
-ti["LZ"] = {"fl-gravel", "sunlight1"}
-ti["LY"] = {"fl-gravel", "sunlight2"}
-ti["RZ"] = {"fl-gravel", "ringroom"}
-ti[";;"] = {"fl-dunes", friction=6, mousefactor=2}
-ti["''"] = {"fl-sahara"}
-ti["%%"] = {"fl-samba"}
-ti["%."] = {"fl-samba", "volcan#", secure=true}
-ti["_v"] = {"fl_abyss", "volcan#"}
-ti["::"] = {"fl-rough-red"}
-ti["O0"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_BLUE}
-ti["O1"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_RED}
-ti["O2"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_GREEN}
-ti["O3"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_YELLOW}
-ti["O4"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_CYAN}
-ti["O5"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_PURPLE}
-ti["O6"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_WHITE}
-ti["O7"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_BLACK}
-ti[":;"] = {"fl-rough-blue"}
-ti["=="] = {"fl_wood"}
-ti["tt"] = {"fl-thief"}
-ti["$$"] = {"fl-acwhite"}
-ti["gs"] = {"fl-gradient", type=1}
-ti["gw"] = {"fl-gradient", type=4}
-ti["gn"] = {"fl-gradient", type=2}
-ti["ge"] = {"fl-gradient", type=3}
-ti["g5"] = {"fl-gradient", type=5}
-ti["g6"] = {"fl-gradient", type=6}
-ti["g7"] = {"fl-gradient", type=7}
-ti["g8"] = {"fl-gradient", type=8}
-ti["g9"] = {"fl-gradient", type=9}
-ti["ga"] = {"fl-gradient", type=10}
-ti["gb"] = {"fl-gradient", type=11}
-ti["gc"] = {"fl-gradient", type=12}
-ti["^^"] = {"fl-gray"}
-ti["%f"] = {"fl-samba", eternal=true, initfire=true}
-ti[" f"] = {"fl-sand", eternal=true, initfire=true}
-ti["FT"] = {"fl-sand", eternal=true, initfire=true, name="fire_target"}
-ti["%:"] = {"fl_hay", secure=true}
-ti[" v"] = {"fl-sand", force_y=10}
-ti[" h"] = {"fl-sand", force_x=-10}
-ti["XX"] = ti["  "] .. {st_oxyd_d}
-ti[" ."] = ti["  "] .. {"it_seed"}
-ti["'."] = ti["''"] .. {"it_seed"}
-ti["'o"] = ti["''"] .. {"it_meditation"}
-ti["%;"] = ti["%."] .. {"st_door_b", state=OPEN}
-ti[";@"] = ti[";;"] .. {"it_death"}
-ti[" %"] = ti["  "] .. {"it-booze-broken"}
-ti[",%"] = ti[",,"] .. {"it-booze-broken"}
-ti[",b"] = ti[",,"] .. {"it_banana"}
-ti[",d"] = ti[",,"] .. {"it_coin_l"}
-ti[",s"] = ti[",,"] .. {"it_sword"}
-ti[",r"] = ti[",,"] .. {"it-ring"}
-ti[",l"] = ti[",,"] .. {"it_extralife"}
-ti[".r"] = ti[".."] .. {"it-ring"}
-ti[",c"] = ti[",,"] .. {"it_rubberband", anchor2="white", threshold=1, length=10}
-ti[",g"] = ti[",,"] .. {"it_glasses", state=SPOT_DEATH}
-ti["$g"] = ti["$$"] .. {"it_glasses", state=SPOT_DEATH}
-ti[",p"] = ti[",,"] .. {"it-pencil"}
-ti[",t"] = ti[",,"] .. {"it-document", text="mystic"}
-ti[" k"] = ti["_f"] .. {"it_cherry"}
-ti[" e"] = ti["  "] .. {"it-extinguisher_medium"}
-ti["%l"] = ti["%%"] .. {"it_extralife"}
-ti[" m"] = ti["  "] .. {"it_landmine"}
-ti[" o"] = ti["  "] .. {"it-burnable_oil"}
-ti["$o"] = ti["$$"] .. {"it-burnable_oil"}
-ti[" s"] = ti["  "] .. {"it_squashed"}
-ti[".s"] = ti[".."] .. {"it_squashed"}
-ti[";s"] = ti[";;"] .. {"it_squashed"}
-ti["%t"] = ti["%%"] .. {"it_meditation_bump"}
-ti["_U"] = ti["__"] .. {"it_umbrella"}
-ti["_d"] = ti["__"] .. {"it-drop"}
-ti["_."] = ti["_v"] .. {"it_seed_volcano", secure=true}
-ti[";t"] = ti[";;"] .. {"it-spade"}
-ti[";w"] = ti[";;"] .. {"it_magicwand"}
-ti["%w"] = ti["%%"] .. {"it_magicwand"}
-ti[";g"] = ti[";;"] .. {"it_glasses_broken"}
-ti["fw"] = ti["  "] .. {"it-flagwhite"}
-ti["ww"] = ti["  "] .. {"it_wormhole", range=0.5, destination="white_grave"}
-ti[" y"] = ti["  "] .. {"it-yinyang"}
-ti["k0"] = ti["  "] .. {"it_key", code=0}
-ti["k1"] = ti["  "] .. {"it_key", code=1}
-ti["k3"] = ti["~~"] .. {"it_key", code=3}
-ti["k4"] = ti["%%"] .. {"it_key", code=4}
-ti["d1"] = ti[",,"] .. {"it-document", text="welcome"}
-ti["d2"] = ti[",,"] .. {"it-document", text="rainmaker"}
-ti["d3"] = ti[",,"] .. {"it-document", text="bug"}
-ti["d4"] = ti[",,"] .. {"it-document", text="barber"}
-ti["d5"] = ti[",,"] .. {"it-document", text="predecessor"}
-ti["d6"] = ti[";;"] .. {"it-document", text="curse"}
-ti["d7"] = ti["  "] .. {"it-document", text="repair"}
-ti["d8"] = ti["  "] .. {"it-document", text="mailbox"}
-ti["d9"] = ti["$$"] .. {"it-document", text="invoice"}
-ti["da"] = ti["  "] .. {"it-document", text="holy"}
-ti["db"] = ti[";;"] .. {"it-document", text="death"}
-ti["dc"] = ti["  "] .. {"it-document", text="fire"}
-ti["dd"] = ti["  "] .. {"it-document", text="research"}
-ti["de"] = ti[";;"] .. {"it-document", text="noitem"}
-ti["df"] = ti["%%"] .. {"it-document", text="thieves"}
-ti["dg"] = ti["''"] .. {"it-document", text="children"}
-ti["ph"] = ti["$$"] .. {"it_pipe_ew"}
-ti["pH"] = ti["  "] .. {"it_pipe_ew"}
-ti["pv"] = ti["$$"] .. {"it_pipe_ns"}
-ti["pV"] = ti[",,"] .. {"it_pipe_ns"}
-ti["pa"] = ti["  "] .. {"it_pipe_nw"}
-ti["pb"] = ti["$$"] .. {"it_pipe_ne"}
-ti["pB"] = ti[",,"] .. {"it_pipe_ne"}
-ti["pc"] = ti["$$"] .. {"it_pipe_es"}
-ti["pd"] = ti["$$"] .. {"it_pipe_sw"}
-ti["pD"] = ti[",,"] .. {"it_pipe_sw"}
-ti["pn"] = ti[";;"] .. {"it-puller-n"}
-ti["pe"] = ti["gs"] .. {"it-puller-e"}
-ti["te"] = ti[",,"] .. {"it_sensor", target="escape", invisible=true}
-ti["t'"] = ti["''"] .. {"it_trigger", target="open_grave"}
-ti["c'"] = ti["''"] .. {"it_sensor", target="home", invisible=true}
-ti["gS"] = ti["gs"] .. {"it_sensor", target="curse_brittle"}
-ti[";c"] = ti[";;"] .. {"it_sensor", target="curse_legs"}
-ti["t1"] = ti["%."] .. {"it_trigger", target="volcano", name="volcano1"}
-ti["t2"] = ti["%."] .. {"it_trigger", target="volcano", name="volcano2"}
-ti["t3"] = ti["%."] .. {"it_trigger", target="volcano", name="volcano3"}
-ti["t4"] = ti["%."] .. {"it_trigger", target="volcano", name="volcano4"}
-ti["t5"] = ti["%."] .. {"it_trigger", target="volcano", name="volcano5"}
-ti["t6"] = ti["%."] .. {"it_trigger", target="volcano", name="volcano6"}
-ti["tc"] = ti["^^"] .. {"it_sensor", target="scorpion_count"}
-ti["ti"] = ti["%%"] .. {"it_sensor", target="scorpion_init"}
-ti[" C"] = ti["  "] .. {"st-chameleon"}
-ti["'b"] = ti["''"] .. {"st_passage_black_frame"}
-ti["W "] = ti["  "] .. {"st_passage_white_cross"}
-ti["Wv"] = ti[" v"] .. {"st_passage_white_cross"}
-ti["Ws"] = ti["gs"] .. {"st_passage_white_cross"}
-ti["Ww"] = ti["gw"] .. {"st_passage_white_cross"}
-ti["Wf"] = ti[" f"] .. {"st_passage_white_cross"}
-ti["Wk"] = ti["k0"] .. {"st_passage_white_cross"}
-ti["##"] = ti[";;"] .. {"st-greenbrown"}
-ti["#!"] = ti["##"] .. {"it_death"}
-ti["#@"] = ti[";@"] .. {"st-greenbrown"}
-ti["#d"] = ti["d6"] .. {"st-greenbrown"}
-ti["#D"] = ti["_d"] .. {"st-greenbrown"}
-ti["#z"] = ti[";w"] .. {"st-greenbrown"}
-ti["#e"] = ti["ge"] .. {"st-greenbrown"}
-ti["#w"] = ti["gw"] .. {"st-greenbrown"}
-ti["#t"] = ti[";t"] .. {"st-greenbrown"}
-ti["#s"] = ti[";s"] .. {"st-greenbrown"}
-ti["H#"] = ti[";;"] .. {"st-greenbrown_hole"}
-ti["Hg"] = ti[";g"] .. {"st-greenbrown_hole"}
-ti["Hd"] = ti["db"] .. {"st-greenbrown_hole"}
-ti["Ht"] = ti["de"] .. {"st-greenbrown_hole"}
-ti["He"] = ti["ge"] .. {"st-greenbrown_hole"}
-ti["Hw"] = ti["gw"] .. {"st-greenbrown_hole"}
-ti["Hn"] = ti["gn"] .. {"st-greenbrown_hole"}
-ti["Hm"] = ti["pn"] .. {"st-greenbrown_hole"}
-ti["HE"] = ti[";;"] .. {"st-greenbrown_hole", "white_grave"}
-ti["Hp"] = ti["pe"] .. {"st-greenbrown_hole"}
-ti["Hs"] = ti["gs"] .. {"st-greenbrown_hole"}
-ti["HS"] = ti["gS"] .. {"st-greenbrown_hole"}
-ti["H5"] = ti["g5"] .. {"st-greenbrown_hole"}
-ti["H6"] = ti["g6"] .. {"st-greenbrown_hole"}
-ti["H7"] = ti["g7"] .. {"st-greenbrown_hole"}
-ti["H8"] = ti["g8"] .. {"st-greenbrown_hole"}
-ti["Hc"] = ti[";c"] .. {"st-greenbrown_hole"}
-ti["HF"] = ti["He"] .. {"it-document", text="trapped"}
-ti["I#"] = ti["  "] .. {"st_stoneimpulse"}
-ti["IM"] = ti["''"] .. {"st_stoneimpulse_movable"}
-ti["I."] = ti[".."] .. {"st_stoneimpulse"}
-ti["Im"] = ti[".."] .. {"st_stoneimpulse_movable"}
-ti["Ih"] = ti[".."] .. {"st_stoneimpulse_hollow"}
-ti["IH"] = ti["__"] .. {"st_stoneimpulse_hollow"}
-ti["M#"] = ti[";;"] .. {"st-greenbrown_move"}
-ti["MW"] = ti["''"] .. {"st_box_wood"}
-ti["M:"] = ti["::"] .. {"st_box_wood"}
-ti["MB"] = ti["c'"] .. {"st-brownie"}
-ti["R0"] = ti["  "] .. {"st-rock5"}
-ti["R1"] = ti["::"] .. {"st-rock1"}
-ti["R6"] = ti["::"] .. {"st-rock1_move"}
-ti["R2"] = ti["  "] .. {"st-rock1"}
-ti["R4"] = ti["^^"] .. {"st-rock1"}
-ti["R5"] = ti[".."] .. {"st-rock1"}
-ti["Rp"] = ti[".."] .. {"st-rock1_hole"}
-ti["Rh"] = ti["  "] .. {"st-rock1_hole"}
-ti["Rm"] = ti["::"] .. {"st-rock1_move"}
-ti["R3"] = ti["  "] .. {"st-rock3"}
-ti["RH"] = ti["  "] .. {"st-rock3_hole"}
-ti["RP"] = ti["  "] .. {"st_panel"}
-ti["R#"] = ti["  "] .. {"st_rotator_cw"}
-ti["RL"] = ti["  "] .. {"st_rotator_ccw"}
-ti["RM"] = ti["  "] .. {"st_rotator_ccw", movable=true}
-ti["RX"] = ti["::"] .. {"st_rotator_ccw", movable=true}
-ti["RY"] = ti["::"] .. {"st_rotator_cw", movable=true}
-ti["P#"] = ti[";;"] .. {"st_pull"}
-ti["P_"] = ti["__"] .. {"st_pull"}
-ti["T#"] = ti["  "] .. {"st-thief"}
-ti["F,"] = ti[",,"] .. {"st-grate1"}
-ti["F:"] = ti["::"] .. {"st-grate1"}
-ti["F'"] = ti["''"] .. {"st-grate1"}
-ti["F."] = ti[".."] .. {"st-grate1"}
-ti["FA"] = ti[".."] .. {"st_quake"}
-ti["S#"] = ti[",,"] .. {"st_scissors"}
-ti["B#"] = ti[".."] .. {"st-block"}
-ti["B,"] = ti[",,"] .. {"st_door_d", "ali_barber", faces="ew"}
-ti["K0"] = ti["  "] .. {"st_key", code=0, target="predecessor"}
-ti["B0"] = ti[",,"] .. {"st_door_d", "predecessor", faces="ew"}
-ti["O,"] = ti[",,"] .. {"st_door_d", "oil_shop", faces="ns"}
-ti["Cm"] = ti[" m"] .. {"st-chameleon"}
-ti["UA"] = ti["_U"] .. {"st-glass1"}
-ti["B;"] = ti[";;"] .. {"st_passage_black_frame"}
-ti["BB"] = ti["  "] .. {"st_brick", cluster=1}
-ti["Bw"] = ti[".."] .. {"st_boulder_w"}
-ti["Bo"] = ti[".."] .. {"st_boulder_e"}
-ti["BI"] = ti[".."] .. {"st_blocker"}
-ti["B."] = ti[".."] .. {"it_blocker"}
-ti["%b"] = ti["%%"] .. {"it_blocker"}
-ti["Bs"] = ti["%%"] .. {"st_boulder_s"}
-ti["BS"] = ti["%b"] .. {"st_boulder_s"}
-ti["Bn"] = ti["%%"] .. {"st_boulder_n"}
-ti["A1"] = ti[".."] .. {"st_bluesand", cluster=1}
-ti["A2"] = ti[".."] .. {"st_bluesand", cluster=2}
-ti["WE"] = ti["  "] .. {"st_window_e"}
-ti["WS"] = ti["  "] .. {"st_window_s"}
-ti["LE"] = ti[",,"] .. {"st_laser_e", "blacksmith"}
-ti["LX"] = ti[",,"] .. {"st_laser_e", state=ON}
-ti["l"] = ti[".."] .. {"st_puzzle_blue"}
-ti["b"] = ti["''"] .. {"st_puzzle_blue", "tutpuz#"}
-ti["Y"] = ti["''"] .. {"st_puzzle_yellow", "tutpuz#"}
-ti["LS"] = ti[".."] .. {"st_laserswitch", target="illumination"}
-ti["MD"] = ti[".."] .. {"st_mirror_triangle", state=WEST, transparent=true, movable=true}
-ti["MP"] = ti[".."] .. {"st_mirror_slab", state=VERTICAL, transparent=true, movable=true}
-ti["CB"] = ti[",,"] .. {"st_coinslot", target="blacksmith"}
-ti["CS"] = ti[",,"] .. {"st_coinslot", target="buy_south"}
-ti["CW"] = ti[",,"] .. {"st_coinslot", target="buy_west"}
-ti["CC"] = ti[",,"] .. {"st_coinslot", target="ali_barber"}
-ti["CO"] = ti[",,"] .. {"st_coinslot", target="oil_shop"}
-ti["DI"] = ti["__"] .. {"st_death_invisible"}
-ti["GB"] = ti[",b"] .. {"st-glass1_move"}
-ti["GP"] = ti[",p"] .. {"st-glass1_move"}
-ti["GS"] = ti[",s"] .. {"st-glass1_move"}
-ti["GR"] = ti[",r"] .. {"st-glass1_move"}
-ti["GG"] = ti[",g"] .. {"st-glass1_move"}
-ti["GT"] = ti[",t"] .. {"st-glass1_move"}
-ti["G."] = ti[".."] .. {"st-glass_move"}
-ti["G'"] = ti["''"] .. {"st-glass1"}
-ti["GO"] = ti["t'"] .. {"st-glass1_hole"}
-ti["GA"] = ti[",,"] .. {"st-beads"}
-ti["GV"] = ti["t1"] .. {"st_passage_black_frame"}
-ti["Ti"] = ti["ti"] .. {"st_passage_black_frame"}
-ti["HW"] = ti["  "] .. {"st_chess_white"}
-ti["C."] = ti[".."] .. {"st-chameleon"}
-ti["Mw"] = ti["  "] .. {"st_mail_w"}
-ti["TL"] = ti[",,"] .. {"st_timer", target="do_curse_legs", name="timer_curse_legs", state=OFF}
-ti["ON"] = ti["^^"] .. {"st_oneway_n"}
-ti["OS"] = ti["^^"] .. {"st_oneway_s"}
-ti["PA"] = ti["__"] .. {"st-plain"}
-ti["P%"] = ti["%."] .. {"st-plain"}
-ti["Pm"] = ti["%."] .. {"st-plain_move"}
-ti["Ph"] = ti["%."] .. {"st-plain_hole"}
-ti["Pc"] = ti["%."] .. {"st-plain_break"}
-ti["Pf"] = ti["%f"] .. {"st-plain_break"}
-ti["P."] = ti["_."] .. {"st-plain_break"}
-ti["PC"] = ti[".."] .. {"st-plain_break"}
-ti["PB"] = ti[".."] .. {"st-bug"}
-ti["TT"] = ti["tt"] .. {"st-thief"}
-ti["D1"] = ti[".."] .. {"st_blocker", "door1#"}
-ti["D2"] = ti[".."] .. {"st_blocker", "door2#"}
-ti["D3"] = ti[".."] .. {"st_blocker", "door3#"}
-ti["D4"] = ti[".."] .. {"st_blocker", "door4#"}
-ti["K1"] = ti[".."] .. {"st_key", code=1, target="door1#*"}
-ti["K2"] = ti[".."] .. {"st_key", code=2, target="door2#*"}
-ti["K3"] = ti[".."] .. {"st_key", code=3, target="door3#*"}
-ti["K4"] = ti[".."] .. {"st_key", code=4, target="door4#*"}
-ti["D5"] = ti["::"] .. {"st_door_c", "door5#"}
-ti["D7"] = ti[".."] .. {"st_door_a", "door7"}
-ti["_C"] = ti["__"] .. {"st-chameleon"}
-ti["_T"] = ti["__"] .. {"st-invisible"} .. ti({"#ac-horse"})
-
-ti[" 1"] = ti[",,"] .. {"#ac_marble_black", "black", essential=1, player=0, controllers=1} .. ti({"it_extralife"})
-ti[" 2"] = ti["ge"] .. {"#ac_marble_white", "white", essential=0, player=1, controllers=2}
-ti["c1"] = ti["  "] .. {"#ac_pearl_white", essential=1, controllers=0, name="kid1"}
-ti["c2"] = ti["  "] .. {"#ac_pearl_white", essential=1, controllers=0, name="kid2"}
-ti["c3"] = ti["  "] .. {"#ac_pearl_white", essential=1, controllers=0, name="kid3"}
-ti["c4"] = ti["  "] .. {"#ac_pearl_white", essential=1, controllers=0, name="kid4"}
-ti[" 8"] = ti["  "] .. {"#ac-bug"}
-ti[" 3"] = ti["  "] .. {"#ac-killerball", "killer"}
---ti[" 3"] = ti["  "] .. {"ac-killerball", "killer", mouseforce=0}
-ti[" 4"] = ti["  "] .. {"#ac-top", range=1.8, force=30}
-ti[" 5"] = ti["  "] .. {"#ac-top", range=3, force=40, name="top"}
-ti[" 6"] = ti["  "] .. {"#ac-rotor", range=3, force=40, name="rotor"}
-ti["%6"] = ti["%%"] .. {"#ac-rotor", range=3, force=40}
-ti["'6"] = ti["''"] .. {"#ac-rotor", range=3, force=40}
-
-ti["C4"] = ti[" 4"] .. {"st-chameleon"}    -- aka sand viper in natur
-ti["H4"] = ti[" 4"] .. {"st-greenbrown_hole"}    -- aka sand viper in natur
-ti["P5"] = ti[" 5"] .. {"st_pull"}    -- aka sand viper in a puller
-ti["G6"] = ti[" 6"] .. {"st-glass1"}    -- aka rotodile in a puller
-ti["G3"] = ti[" 3"] .. {"st-glass1"}    -- aka scorpion in a puller
-ti["G8"] = ti[" 8"] .. {"st-glass1_move"}
-ti["W4"] = ti[" 4"] .. {"st_window_e"}
-ti["C1"] = ti["k1"] .. {"st-chameleon"}
-
-ti["'A"] = {"fl-sahara", "tutoxyd"}
-
-ti["k2"] = ti["##"] .. {"it_key", code=2}
-
-ti["Va"] = ti[";;"] .. {"it_vortex", "vortex_a", destination="vortex_A"}
-ti["VA"] = ti["RH"] .. {"it_vortex", "vortex_A", destination="vortex_a"}
-ti["Vb"] = ti[" C"] .. {"it_vortex", "vortex_b", destination="vortex_B"}
-ti["VB"] = ti["ge"] .. {"it_vortex", "vortex_B", destination="vortex_b"}
-ti["Vc"] = ti["Hw"] .. {"it_vortex", "vortex_c", destination="vortex_C"}
-ti["VC"] = ti["%%"] .. {"it_vortex", "vortex_C", destination="vortex_c"}
-ti["Vd"] = ti["%%"] .. {"it_vortex", "vortex_d", destination="vortex_D"}
-ti["VD"] = ti["Hs"] .. {"it_vortex", "vortex_D", destination="vortex_d"}
-ti["Ve"] = ti["Hw"] .. {"it_vortex", "vortex_e", destination="vortex_E"}
-ti["VE"] = ti["%%"] .. {"it_vortex", "vortex_E", destination="vortex_e"}
-ti["FB"] = ti["Rh"] .. {"it_wormhole", destination="fire_target", range=1.5}
-
-ti["'c"] = ti["''"] .. {"st-chameleon"}
-ti["?g"] = ti["  "] .. {"st-grate3"}
-ti[" w"] = ti["  "] .. {"it_magicwand"}
-
-oxyd_colors = lib.lua.shuffle({OXYD_BLUE, OXYD_RED, OXYD_GREEN, OXYD_YELLOW,
-    OXYD_CYAN, OXYD_PURPLE, OXYD_WHITE, OXYD_BLACK})
-holy_idx = random(1, 8)
-fake_idx = 1
-
-myresolver = function(key, x, y)
-    if key == "o9" then
-        return ti["O"..oxyd_colors[holy_idx]]
-    elseif key == "of" then
-        local idx = lib.lua.cond(fake_idx == holy_idx, fake_idx + 1, fake_idx)
-        fake_idx = idx + 1
-        return ti["O"..oxyd_colors[idx]]
-    elseif key:sub(1,1) == "o" then
-        local idx = 0 + key:sub(2,2)
-        return ti["O"..oxyd_colors[idx]]
-    elseif key:sub(1,1) == "r" then
-        local idx = 0 + key:sub(2,2)
-        return lib.lua.cond(idx == holy_idx, ti["R6"], ti["R1"])
-    else
-        return ti[key]
-    end
-end
-
-w, h = wo(res.puzzle(myresolver,"l","b","Y"), "  ", {
---0 1 2 3 4 5 6 7 8 9101112131415161718||202122232425262728293031323334353637||394041424344454647484950515253545556||
-"C1 s  C4                                                                                                        ####", --  0
-"                                                                                                        ##      C4##", --  1
-"    C4                                                                                                              ", --  2
-"C4                                                                                                                  ", --  3
-"     m                                                                                                              ", --  4
-"                                                                                                                ##  ", --  5
-"                                                                                                                    ", --  6
-"                                                                                                                    ", --  7
-"                                                                                                                    ", --  8
-"                                        C4                                                                          ", --  9
-"                                                         % %                   %                                    ", -- 10
-"                                #d#################s####H#H##### %###############@#d                                ", -- 11
-"                                ###@#@#@#@#@#@#@#@M##@#@#@#@#@#@#@#@#@#@#@#@#@#@#@##                                ", -- 12 --
-"                                ###@##############;;##########################H#H##w                                ", -- 13
-"                                #eHeH5##VD##VeH6##;;##########################H##@##                                ", -- 14
-"                                ###@Hp##Hs####Hn##;;;;H#H#Hd_f_f_f_f_f_f_f####H##@                                  ", -- 15
-"                                ###@Hs##Hs####Hn##;;########DIDIDIDIDIDI_f####H##@                                  ", -- 16
-"                                ###@HS##Hs####Hn##;;########_f_f_f_f_fDI_f####Hc#@##                              ##", -- 17
-"                                ###@####HsHt##Hn##;;M# k kM#_fDIDIDI_fDI_f#######@##                               %", -- 18
-"                                ###@####Hs##H5H8R#;;H#######_fDI_f_f_fDI_f####Hm#@                                  ", -- 19
-"                                ###@####H7HeH8##H#;;##H#####_fDI_fDIDIDI_f####H##@##__                              ", -- 20
-"                             m  ##HFHE########H##D;;H#H#M#M#_fDI_f_f_f_f_f####H##@##                                ", -- 21
-"     %                          ###@####Va;;;;;;;;P_####B;####################H#H##w                                ", -- 22
-"                                ###@##########H#H#H#####H#HwHwHwHwHwHwHwHwVc#####@##                                ", -- 23
-"                                ###@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@##                                ", -- 24 --
-"                                #d#@###t####    ######Hg###z    M##### 4k2#########d                                ", -- 25
-"                                                ____                     s                                          ", -- 26
-"                                                                                                                    ", -- 27
-"                          d7                                                                                        ", -- 28
-"                                                                                                                    ", -- 29
-"                                                                                                                    ", -- 30
-"                                                                                                                    ", -- 31
-"                                                                                                                    ", -- 32
-"                                                                                                                    ", -- 33
-"                                                                                                                    ", -- 34
-"                                                                           f f                       f f            ", -- 35
-"      c2  c4 %                C4                                           fWfW W W W W W W W W W W Wf f            ", -- 36 --
-"    c1HWc3  R#~~        ~~RM                                                W $$$$$$ph$$$$ph$$$$$$$$W               ", -- 37
-"BBBBBBBBBBBBBB~e,f,f,f,f~eBBBBBBBBBBBBBB                                    W $$$g## fpb$$$o$$ f$$$oW               ", -- 38
-"BBCS,,GTCWGGCW,,,l 1d1,,,,,,,,B,,,d4,,BBT#                                  W $$$$$$$$$$$$$$$$pd##$$W d8            ", -- 39
-"BBGB,,,,,,,,F,,,,d,d,d,d,,,,,,CC,,S#,,BB                                    W $$$$$$$$$$$$ o    d9phMw              ", -- 40
-"BBCS,,CS,,CSBB,,,,,,,,,,,,,,BBBBBBBBBBBB                               m    W $$phph$o$$    C4  $$$$W               ", -- 41
-"BBGPF,GRF,GSBB,,,,,,,,,,,,,,,,,,,,BB,dBB                                    W $o$$pv## f fpa    $$$$W               ", -- 42
-"BBBBBBBBBBBBBB,,,,,,,,,,,,,,,,,,d5K0,dGA                                    W $$$$pv fWkpH f f  $$$$WvWvWvW W W W W ", -- 43
-"BBLE,,,,CBBB,,,,,,,etetete,,,,,,,,B0,cBBBBBBWSBBBBBB  BBBBBBBBW W W W W W W W $$$$$$ ffw o     fg5gsgsgsgs$$$o$$ f$$", -- 44
-"BB,,,,,,,,BB,,,,BBBBG3G6P5BBBBO,COBBBBBB    W4    da    R2R2BB$$$$$$$$$$$$$$$$$$$$####  Vb   hWwgwgwgwgwgwpb$$####pv", -- 45
-"BBUA,,d2,,,,,,,,BBd3teteteCSBB,,pDpVpBBBo9  W4           fFBBB$$phpv$$$$$o$$$$$$$$$$## f   e f fg7gngn####$$pc$$##$$", -- 46
-"BBUAUAUA,,BB,,,,F,,,,,,,,,G8BBpVpDpVpBBB    W4        dcR2R2BB$$$$$$$$$$$$##$$$$ f$$$o$$ f f$$$$$$$$$$$$$$$$$$##$$$$", -- 47
-"BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB###############!#!#!#!#!#!#!#!#!#!#!#!#!#!#!#!#!#!#!#!", -- 48 --
-"                                                                            ##%%%t%tPmPcPcPcPcPcPcPcPcPcPcPm%t%t%%##", -- 49
-"                                                                            ##%tVd%%P%PAPAPAPAPAPAPAPAPAPAP%%%%l%t##", -- 50
-"                                                                            ##%t%%%%P%%.%.%.%.%.%.%.%.%.%.P%%%%%%t##", -- 51
-"                                                                            ##PcP%P%P%%.%.%;%.%.%.%.%.%;%.P%P%P%Ph##", -- 52
-"                                                                            ##PcP.%.%.%.%.t3%.%;%.%.%.t5%.%.PcP%Ph##", -- 53
-"                                                                            ##PcP.%.%.%;%.%.%.GV%.%;%.%.%.%.PfP%Ph##", -- 54
-"                                                                            ##PcP.%.%.t2%.%.%.%.%.t4%.%.%.%;PcP%Ph##", -- 55
-"                                                                            ##PmP%P%P%%.%.%.%.%.%.%.%.%.%.t6PhP%Pm##", -- 56
-"                                                                            ##%t%%%%P%%.%.%.%.%.%.%.%.%.%.Ph%%%%%t##", -- 57
-"                                                                            ##%t%l%%P%P%PmP%PmP%P%PmP%PmP%P%%%VC%t##", -- 58
-"                                                                            ##%%%t%tP%PhPhPhPhPhPhPhPhPhPhPc%t%t%%##", -- 59
-"R0R0R0TTTTTTTTTTTTTTTTTTTTTTTTTTTTR0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0########################################", -- 60 --
-"R0VE%%BnttttTTttttttTTttttttTTtttt%b%bR0^^g5gsgsgsg6R4tcR4g5gsgsgsgsgsgsg6^^D7..............R5FTR5................R0", -- 61
-"R0dfR0ttTTttttttTTttttttTTttttttTT%b%bR0g5g9^^^^^^gwR4ONR4ge^^^^^^^^^^^^gbg6R0....................................R0", -- 62
-"R0R0R0R0TTTTTTTTTTTTTTTTTTTTTTTTTT%b%bR0ge^^^^^^^^gbgsgsgsg9^^^^^^^^^^^^^^gwR0....................................R0", -- 63
-"R0%wtttttttt%wtttt%w%wtttt%wtttttt%b%bR0ge^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^gwR0....................................R0", -- 64
-"R0%wtt%wtttt%wtttttttttttt%wtttttt%b%bR0ge^^^^^^^^^^^^^^^^^^^^^^^^g5g6^^^^gwR0....................................R0", -- 65
-"R0%wtttttttttttttttttttttttttttttt%b%bR0ge^^^^g5g6^^^^^^^^^^^^^^^^g7g8^^^^gwR0....RZF.l1F.............F.l1F.......R0", -- 66
-"R0tttttttttttttttttttttttttttttttt%b%bR0ge^^^^g7g8^^^^^^^^^^^^^^^^^^^^^^^^gwR0..R5l1l1l1F.............F.l1l1l1R5..R0", -- 67
-"R0tttttttttttttttttttt%wtttttttttt%b%bR0ge^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^gwR0..R5R5R5l1F.............F.l1R5RpRp..R0", -- 68
-"R0tttttttttt%wtttttttt%wtttttttttt%b%bR0ge^^^^^^^^^^^^^^gcgngngnga^^^^^^^^gwR0..R5R5VBl1F.............F.l1.rR5R5..R0", -- 69
-"R0%wtt%wtttt%wtt%wtttt%wtttttttttt%b%bR0g7ga^^^^^^^^^^^^gwR4OSR4ge^^^^^^gcg8R0..R5R5R5l1F.F.F.F.F.F.F.F.l1R5R5R5..R0", -- 70
-"R0%wtttttttttttt%wtttt%wttttttttttBSBSTi^^g7gngngngngngng8R4tcR4g7gngngng8^^R0......F.l1l1l1l1l1l1l1l1l1l1F.......R0", -- 71
-"R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0PCPBPCPBPCPBPCPBPCPBR0R0R0R0R0", -- 72 --
-"R0''''''''''''''''''''''''''''R0I#~~''MW''~~I#R0''''''''''''''''''''''''''''R0RLR3R3R3PBPCPBPCPBPCPBPCPBPCR3R3VAR#R0", -- 73
-"R0''''''''''''''''''''''''''''R0MWR0'b'b'bR0MWR0''''''''''''''''''''''''''''R0BwBIBIBIBIBIBIBIBIBIBIBIBIBIBIBIBIBIR0", -- 74
-"R0''''''''~~%%~~RP~~%%~~'''''''''''''b'''b''''''''''''~~RP~~RP~~RP~~''''''''R0B.B.B.B.B.B.B.B.B.B.B.B.B.B.B.B.B.BoR0", -- 75
-"R0''''''''%%%%~~~~~~%%%%'''''''''''''b'''b''''''MW''''RP%%~~~~~~%%RP''''''''R0R#................................RLR0", -- 76
-"R0''''''''~~~~%6%%%6~~~~'''''.'''''''b'''b''''''''''''~~~~%%%%%%~~~~''''''''R0...............................s....R0", -- 77
-"R0''''''''RP~~%%k4%%~~RP'''''''''''''b'''b''''''''''''RP~~%%k3%%~~RP'''''''''b....................................R0", -- 78
-"R0''''''''~~~~%6%%%6~~~~'''''.'''''''b'''b''''''''''''~~~~%%%%%%~~~~''''''''R0....................................R0", -- 79
-"R0''''''''%%%%~~~~~~%%%%'''''''''''''b'''b''''''MW''''RP%%~~~~~~%%RP''''''''R0....................................R0", -- 80
-"R0''''''''~~%%~~RP~~%%~~'''''''''''''b'''b''''''''''''~~RP~~RP~~RP~~''''''''R0A2A1K1A1K2A1A2D1D1D1D1A2A1K3A1K4A1A2R0", -- 81
-"R0''''''''''''''''''''''''''''R0MWR0'b'b'bR0MWR0''''''''''''''''''''''''''''R0A2A1A1A1A1A1A2D2D2D2D2A2A1A1A1A1A1A2R0", -- 82
-"R0''''''''''''''''''''''''''''R0I#~~''MW''~~I#R0''''''''''''''''''''''''''''R0A2A2A2A2A2A2A2D3D3D3D3A2A2A2A2A2A2A2R0", -- 83
-"R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0A1A1A1A1A1A1A1D4D4D4D4A1A1A1A1A1A1A1R0", -- 84 --
-"                                    B#B#I...ImI.I.I.I.I.I.I.I.I.I.I.B#..G.F.B#....................................B#", -- 85
-"  TL                                B#B#B#B#B#I.B#B#B#B#B#B#B#B#B#I.B#..G.F.B#................................MP..B#", -- 86
-"                                    B#B#B#B#B#I.B#B#B#B#B#B#B#B#B#I.B#..G.F.B#..........FA......LS......FA........B#", -- 87
-" 2ge,dgeddge;tgeww                  B#B#B#B#B#ImB#B#B#B#B#B#B#B#B#..B#..G.F.B#......LYl1l1............LZ..l1......B#", -- 88
-"                                    B#B#B#B#B#ImB#B#B#B#B#B#B#B#B#..B#MPG.F.B#......l1l1l1............l1l1l1......B#", -- 89
-"                                  LXC.....................................~~B#..MD..l1l1LS......FA......LSl1......B#", -- 90
-"  ofofofofofofof                    B#B#B#B#B#..IHIHIhIHIHIHIHB#B#B#B#MPG.F.B#......l1l1l1............l1l1l1......B#", -- 91
-"                                    B#B#B#B#B#B#B#B#..B#B#B#IHB#IHIHIH..G.F.B#........l1l1................l1......B#", -- 92
-"                                    B#B#B#B#B#B#B#B#I.I.I.B#IHB#IHB#IH..G.F.B#..........FA......LS......FA........B#", -- 93
-"                                    B#B#B#B#B#B#B#B#I.B#I.B#IHIHIHB#B#..G.F.B#................................MP..B#", -- 94
-"                                    B#B#B#B#B#B#B#B#I...ImB#B#B#B#B#B#..G.F.B#....................................B#", -- 95
-"RPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRP..RPRPRPRPRPRPRPRPRPRPD5D5D5D5RPRPRPRPRPRPRPRPRPRPRPRPRPRPRP", -- 96 --
-"RP::::::::::::M:::::::::::::::::::::::RP::::::::::::::::RX::::::::::::::::::RP::::::::RP::::::::::::M:::::::::::::RP", -- 97
-"RP::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::RP", -- 98
-"RP::::::::::::::::::::::::::::::::::::o1::::::::::::::::::::::::::::::::::::o2::::::::::::::::::::::::::::::::::::RP", -- 99
-"RP::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::RP", --100
-"RP::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::RP", --101
-"RP::::::::::::::::::::::::~~~~~~~~~~~~::::::::::::::::::::::::::::::::::::::::~~~~~~~~~~~~::::::::::::::::::::::::RP", --102
-"RP::::::::::::::::::::::::~~~~~~~~~~~~r1R1R1R1R1R1R1R1::::::::R1R1R1R1R1R1R1r2~~~~~~~~~~~~::::::::::::::::::::::::RP", --103
-"RP::::::::::::::::::::::::~~~~''''~~~~r1R1R1R1R1R1R1R1~~~~~~~~R1R1R1R1R1R1R1r2~~~~''''~~~~::::::::::::::::::::::::RP", --104
-"RP::::::::::::::::::::::::~~~~'''6~~~~r1R1R1R1R1R1R1R1~~~~~~~~R1R1R1R1R1R1R1r2~~~~'''6~~~~::::::::::::::::::::::::RP", --105
-"RP::::::::::::::::::::::::~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~::::::::::::::::::::::::RP", --106
-"RP::::::::::::::::::::::::~~~~~~~~~~''~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~''~~~~~~~~~~::::::::::::::::::::::::RP", --107
-"RP::::o3::::::::::::::::::::r3r3r3~~~~MBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMB~~~~r5r5r5::::::::::::::::::::o5::::RP", --108 --
-"RP:::::::::::::;::::::::::::R1R1R1~~~~MB''''''''''''''''''''''''''''''''''''MB~~~~R1R1R1:::::::::::::;::::::::::::RP", --109
-"RP:::::::::::;:::;::::::::::R1R1R1~~~~MB''''F'F'F'F'F'F'F'F'F'F'F'F'F'''''''MB~~~~R1R1R1:::::::::::;:::;::::::::::RP", --110
-"RP:::::::::;:::::::;::::::::R1R1R1~~~~MB'''AF'b1b1b1b1b1b1Y1b1b1b1b1F'''''''MB~~~~R1R1R1:::::::::;:::::::;::::::::RP", --111
-"RP:::::::::;:::::::;::::::::R1R1R1~~~~MB''''F'Y1Y1Y1Y1Y1b1Y1b1b1b1b1F'''''''MB~~~~R1R1R1:::::::::;:::::::;::::::::RP", --112
-"RP:::::::::::;:::;::::::::::::~~~~~~~~MB''''F'Y1G'G'G'Y1b1Y1b1b1b1b1F'''''''MB~~~~~~~~:::::::::::::;:::;::::::::::RP", --113
-"RP:::::::::::::;::::::::::::::~~~~~~~~MB''''F'Y1G'GOG'Y1Y1Y1Y1Y1Y1Y1F'''''''MB~~~~~~~~:::::::::::::::;::::::::::::RP", --114
-"RP:::::::;:;:;:;:;:;:;::::::::~~~~~~~~MB''''F'Y1G'G'G'Y1b1Y1b1b1b1b1F'''''''MB~~~~~~~~:::::::::;:;:;:;:;:;:;::::::RP", --115
-"RP:::::::::::::;::::::::::::R1R1R1~~~~MB''''F'Y1Y1Y1Y1Y1b1Y1b1b1b1b1F'''''''MB~~~~R1R1R1:::::::::::::;::::::::::::RP", --116
-"RP:::::::::::::;::::::::::::R1R1R1~~~~MB''''F'b1b1b1b1b1b1Y1b1b1b1b1F'''''''MB~~~~R1R1R1:::::::::::::;::::::::::::RP", --117
-"RP:::::::::::::;::::::::::::R1R1R1~~~~MB''''F'F'F'F'F'F'F'F'F'F'F'F'F'''''''MB~~~~R1R1R1:::::::::::::;::::::::::::RP", --118
-"RP:::::::::::::;::::::::::::R1R1R1~~~~MB''''''''''''''''''''''''''''''''''''MB~~~~R1R1R1:::::::::::::;::::::::::::RP", --119
-"RP::::o4::::::::::::::::::::r4r4r4~~~~MBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMB~~~~r6r6r6::::::::::::::::::::o6::::RP", --120 --
-"RP::::::::::::::::::::::::~~~~~~~~~~''~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~''~~~~~~~~~~::::::::::::::::::::::::RP", --121
-"RP::::::::::::::::::::::::~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~::::::::::::::::::::::::RP", --122
-"RP::::::::::::::::::::::::~~~~''''~~~~r7R1R1R1R1R1R1R1~~~~~~~~R1R1R1R1R1R1R1r8~~~~''''~~~~::::::::::::::::::::::::RP", --123
-"RP::::::::::::::::::::::::~~~~'''6~~~~r7R1R1R1R1R1R1R1~~~~~~~~R1R1R1R1R1R1R1r8~~~~'''6~~~~::::::::::::::::::::::::RP", --124
-"RP::::::::::::::::::::::::~~~~~~~~~~~~r7R1R1R1R1R1R1R1::::::::R1R1R1R1R1R1R1r8~~~~~~~~~~~~::::::::::::::::::::::::RP", --125
-"RP::::::::::::::::::::::::~~~~~~~~~~~~::::::::::::::::::::::::::::::::::::::::~~~~~~~~~~~~::::::::::::::::::::::::RP", --126
-"RP::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::RP", --127
-"RP::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::RP", --128
-"RP::::::::::::::::::::::::::::::::::::o7::::::::::::::::::::::::::::::::::::o8::::::::::::::::::::::::::::::::::::RP", --129
-"RPF:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:::F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:RP", --130
-"RP::::::::::::M:::::::::::::::::::::::::::::::::::::::::RY::::::::::::::::::::::::::::::::::::::::::M:::::::::::::RP", --131
-"RPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRP"  --132 --
-})
-
-
-function buy_south(value, sender)
-    st(sender + {0, 1}):kill()
-end
-
-function buy_west(value, sender)
-    st(sender + {-1, 0}):kill()
-end
-
-did_run_escape = false
-function escape()
-    if did_run_escape ==  false then
-        wo[no["escape_pos"]] = {"it-document", text="escape"}
-        did_run_escape = true
-    end
-    local y = no["escape_pos"].y + 1
-    if (no["rotor"].y ~= y) or (no["top"].y ~= y) or (no["killer"].y ~= y) then
-        wo[no["escape_close#*"]] = {"st-metal"}
-    end
-end
-
-did_curse_brittle = false
-function curse_brittle(value, sender)
-    if did_curse_brittle == false then
-        wo[sender + {-1, -3}] = {"it-crack2"}
-        wo[sender] = {"it-document", text="curse_brittle"}
-    end
-    did_curse_brittle = true
-end
-
-function curse_legs(value, sender)
-    wo[sender] = {"it-document", text="curse_legs"}
-    no["timer_curse_legs"]:on()
-end
-
-function do_curse_legs()
-    no["black"]["mouseforce"] = -no["black"]["mouseforce"]
-end
-
-trigger_count = 0
-function volcano(value, sender)
-    trigger_count = trigger_count + lib.lua.cond(value, 1, -1)
-    st(sender + {0, -1}):toggle()
-    
-    if (trigger_count == 6) then
-        for v in st(no["volcan#*"]) do
-            if -v and v:is("st_volcano") then
-                v:kill()
-            end
-        end
-        local t = no["volcano"..random(5)]
-        wo:drawRect(t - {1,1}, 3, 3, ti["%:"])
-        local dy = t.y - no["vortex_d"].y
-        wo:drawRect(t - {0, dy}, 1, dy, ti["%:"])
-    end
-end
-
-scorpions = 0
-function scorpion_count(value, sender)
-    scorpions = scorpions + 1
-    if (scorpions == 8) then
-        no["door7"]:open()
-    end
-end
-
-did_init_scorpions = false
-function scorpion_init(value, sender)
-    if (not did_init_scorpions) then
-        for i = 1, 8 do
-            dx = 1 + random(16)
-            dy = -8 + random(5)
-            mf = math.random()*3 - 1
-            if (mf < 0.5) then
-                mf = mf - 1
-            end
-            wo[sender + {dx, dy}] = {"ac-killerball", mouseforce=mf}
-        end
-    end
-    did_init_scorpions = true 
-end
-
-switch_count= 0
-function illumination(value, sender)
-    switch_count = switch_count + lib.lua.cond(value, 1, -1)
-    no["door5#*"]:message(lib.lua.cond(switch_count == 4, "open", "close"))
-end
-
-function open_grave(value, sender)
-    local a = no["tutoxyd"]
-    local solved = #no["tutpuz#*"] == 0 
-    if (not solved) then
-        wo[a + {1,3}] = {"it-document", text="puzzle"}
-        wo[a + {13,3}] = {"it_cherry"}
-    else
-        wo:drawRect(a + {1, -1}, 13, 9, {"st_nil"})
-        wo:drawMap(ti, a + {3, -1}, "  ",
-                    {"  F'          F'",
-                     "F''oF'      F''oF'",
-                     "  F'          F'",
-                     "      _C_C_C",
-                     "  dg  _C_T_C",
-                     "      _C_C_C",
-                     "  F'          F'",
-                     "F''oF'      F''oF'",
-                     "  F'          F'"})
-    end
-end
-
-did_say_bye = false
-did_set_magnet = false
-function home(value, sender)
-    local k1 = no["kid1"]
-    local k2 = no["kid2"]
-    local k3 = no["kid3"]
-    local k4 = no["kid4"]
-    local a = no["tutoxyd"]
-    local xa, ya = (a + {-2, -3}):xy()
-    local xb, yb = (a + {17, 9}):xy()
-    if (not did_set_magnet) and ((k1.x >= xa and k1.x <= xb and k1.y >= ya and k1.y <= yb) or
-            (k2.x >= xa and k2.x <= xb and k2.y >= ya and k2.y <= yb) or
-            (k3.x >= xa and k3.x <= xb and k3.y >= ya and k3.y <= yb) or
-            (k4.x >= xa and k4.x <= xb and k4.y >= ya and k4.y <= yb)) then
-        did_set_magnet = true
-        wo[a + {7, 3}] = {"it_magnet_on", strength=180, range=5, name="magnet"}
-    end
-    if (not did_say_bye) and ((k1.x >= xa and k1.x <= xb and k1.y >= ya and k1.y <= yb) and
-            (k2.x >= xa and k2.x <= xb and k2.y >= ya and k2.y <= yb) and
-            (k3.x >= xa and k3.x <= xb and k3.y >= ya and k3.y <= yb) and
-            (k4.x >= xa and k4.x <= xb and k4.y >= ya and k4.y <= yb)) then
-        wo[sender] = {"it-document", text="bye"}
-        did_say_bye = true
-    end
-end
-
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="true"/>
-        <el:translation el:lang="de">Tutoxyds Pyramide</el:translation>
-      </el:string>
-      <el:string el:key="subtitle">
-        <el:english el:translate="false"/>
-      </el:string>
-      <el:string el:key="welcome">
-        <el:english el:translate="true">Welcome Mr. Jones! Back from your "Alternatives" and "The Walls" training camp?  Got everything you ordered:  some money  --  40 marbleons -- and a horse outside this shopping center.    Many adventurers did loss their life on this pyramid.    Be aware of the dangerous sand vipers and Enighomatep's curses.</el:english>
-      </el:string>
-      <el:string el:key="rainmaker">
-        <el:english el:translate="true" >Mr.Rainmaker gave up this shop. He always insisted that his umbrellas were the most usefull items in this desert. But nobody was willing to spend 2 marbleons.  ---  Now a blacksmith offers his service.</el:english>
-      </el:string>
-      <el:string el:key="escape">
-        <el:english el:translate="true" >Safty Precaution: in case one of these dangerous animals escapes the gates of the shop center will be closed immediatly!</el:english>
-      </el:string>
-      <el:string el:key="mystic">
-        <el:english el:translate="true" >Not much is known of the pyramids architect Enighomatep. But it is said that he loved cherries. He ate so many of them that he sometimes got invisible.</el:english>
-      </el:string>
-      <el:string el:key="bug">
-        <el:english el:translate="true" >Have a look at my collection!    A white scorpion   --   a rotodile   --  and a sand viper.  It is not allowed to sell them.        But I can offer you a scarab that will be for your best.</el:english>
-      </el:string>
-      <el:string el:key="barber">
-        <el:english el:translate="true" >Ali Barber's shop for quick hair cuts. Want to know what is going on?  A thief is hanging around and nobody knows where the 4 pale kids that are playing with your horse are coming from.</el:english>
-      </el:string>
-      <el:string el:key="predecessor">
-        <el:english el:translate="true" >Home of the last adventurer who never returned.   Said he would drill for oil -- but no one believed him.</el:english>
-      </el:string>
-      <el:string el:key="curse">
-        <el:english el:translate="true" >Be cursed for trying to explore Tutoxyd's last secret -- may your homework left undone until you proof worth.</el:english>
-      </el:string>
-      <el:string el:key="repair">
-        <el:english el:translate="true" >It's a pitty that some explorers did damage this historic monument and did litter the environment.   But by magic means the pyramid repairs itself every time an adventurer gives up.</el:english>
-      </el:string>
-      <el:string el:key="curse_brittle">
-        <el:english el:translate="true" >Be cursed for disturbing Tutoxyd's peace -- may the earth part under your feet!</el:english>
-      </el:string>
-      <el:string el:key="curse_legs">
-        <el:english el:translate="true" >Be cursed for disturbing Tutoxyd's peace -- may your legs no longer be under your control!</el:english>
-      </el:string>
-      <el:string el:key="trapped">
-        <el:english el:translate="true" >Trapped?   Either wait for a stupid tourist willing to exchange positions with you by using a magic ring - or press Shift F3</el:english>
-      </el:string>
-      <el:string el:key="mailbox">
-        <el:english el:translate="true" >Private Property! This claim belongs to Mr.Whiteoil. In case of absence please drop a letter.</el:english>
-      </el:string>
-      <el:string el:key="invoice">
-        <el:english el:translate="true" >Invoice -- 40 marbleons for 20 barrels of oil.</el:english>
-      </el:string>
-      <el:string el:key="holy">
-        <el:english el:translate="true" >Welcome stranger -- have a look at our holy stone. It is said that it shows everyone his personal fortune color. As all visitors tried to touch it, we had to set up some protection.</el:english>
-      </el:string>
-      <el:string el:key="fire">
-        <el:english el:translate="true" >May I ask for a donation. Just a few bugs - throw the donation into the holy fire. Tutoxyd will be grateful.</el:english>
-      </el:string>
-      <el:string el:key="research">
-        <el:english el:translate="true" >Mr.Whiteoil, we did finish our library reserach. Enighomatep reports, that 4 keys are required. One key got lost immediatly after sealing the pyramid. One is hidden at the border of the pyramid. For the others you have to prove boldness and cleverness.</el:english>
-      </el:string>
-      <el:string el:key="death">
-        <el:english el:translate="true" >Facing the death you can walk without fear.</el:english>
-      </el:string>
-      <el:string el:key="noitem">
-        <el:english el:translate="true" >Sorry, the useful item that was hidden here has been stolen.</el:english>
-      </el:string>
-      <el:string el:key="thieves">
-        <el:english el:translate="true" >Tomb raiders are cursed to stone and floors for eternity.     Have a look at all these little funny sticks that they used to fight the curses.</el:english>
-      </el:string>
-      <el:string el:key="puzzle">
-        <el:english el:translate="true" >Remove all parts of the memorial plate before conjuring up Tutoxyd.</el:english>
-      </el:string>
-      <el:string el:key="children">
-        <el:english el:translate="true" >Who dared to dirsturb my peace? Stranger - you proved to be honorable. Bring back my children for a joint meditation. But be aware that once seeing me they may like to join me instead of a meditation. I make you responsible for the security of my children.</el:english>
-      </el:string>
-      <el:string el:key="bye">
-        <el:english el:translate="true" >You are bringing back my children. As soon as they come to rest I will deliver you from Enighomathep's curses and you may seek your next adventure.</el:english>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_viii/ral21_2.xml (from rev 1423, trunk/data/levels/enigma_viii/ral21_1.xml)
===================================================================
--- trunk/data/levels/enigma_viii/ral21_1.xml	2008-12-31 13:11:12 UTC (rev 1423)
+++ trunk/data/levels/enigma_viii/ral21_2.xml	2008-12-31 21:41:32 UTC (rev 1424)
@@ -0,0 +1,783 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Tutoxyd's Pyramid" el:subtitle="Marble Jones I" el:id="20070822ral291"/>
+      <el:version el:score="2" el:release="2" el:revision="$Revision: 136 $" el:status="released"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2007,2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/liblua" el:id="lib/liblua" el:release="1" el:preload="true"/>
+        <el:dependency el:path="lib/libpuzzle" el:id="lib/libpuzzle" el:release="3" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+        <el:credits el:showinfo="true" el:showstart="false">Thanks to Thomas for test playing</el:credits>
+      </el:comments>
+      <el:score el:easy="25:38" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+wo["ProvideExtralifes"] = false
+wo["ExtralifeGlasses"] = SPOT_DEATH
+wo["Brittleness"] = 1.0
+
+ti["  "] = {"fl-sand"}
+ti["~~"] = {"fl_water"}
+ti["~e"] = {"fl_water", "escape_close#"}
+ti["__"] = {"fl_abyss"}
+ti["_f"] = {"fl-abyss_fake"}
+ti[",,"] = {"fl-concrete"}
+ti[",e"] = {"fl-concrete", "escape_pos"}
+ti[",f"] = {"fl-concrete", "escape_close#"}
+ti[".."] = {"fl-gravel"}
+ti["LZ"] = {"fl-gravel", "sunlight1"}
+ti["LY"] = {"fl-gravel", "sunlight2"}
+ti["RZ"] = {"fl-gravel", "ringroom"}
+ti[";;"] = {"fl-dunes", friction=6, mousefactor=2}
+ti["''"] = {"fl-sahara"}
+ti["%%"] = {"fl-samba"}
+ti["%."] = {"fl-samba", "volcan#", secure=true}
+ti["_v"] = {"fl_abyss", "volcan#"}
+ti["::"] = {"fl-rough-red"}
+ti["O0"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_BLUE}
+ti["O1"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_RED}
+ti["O2"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_GREEN}
+ti["O3"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_YELLOW}
+ti["O4"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_CYAN}
+ti["O5"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_PURPLE}
+ti["O6"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_WHITE}
+ti["O7"] = ti["::"] .. {"st_oxyd_d", oxydcolor=OXYD_BLACK}
+ti["OE"] = {"st_oxyd_d"}
+ti[":;"] = {"fl-rough-blue"}
+ti["=="] = {"fl_wood"}
+ti["tt"] = {"fl-thief"}
+ti["$$"] = {"fl-acwhite"}
+ti["gs"] = {"fl-gradient", type=1}
+ti["gw"] = {"fl-gradient", type=4}
+ti["gn"] = {"fl-gradient", type=2}
+ti["ge"] = {"fl-gradient", type=3}
+ti["g5"] = {"fl-gradient", type=5}
+ti["g6"] = {"fl-gradient", type=6}
+ti["g7"] = {"fl-gradient", type=7}
+ti["g8"] = {"fl-gradient", type=8}
+ti["g9"] = {"fl-gradient", type=9}
+ti["ga"] = {"fl-gradient", type=10}
+ti["gb"] = {"fl-gradient", type=11}
+ti["gc"] = {"fl-gradient", type=12}
+ti["^^"] = {"fl-gray"}
+ti["%f"] = {"fl-samba", eternal=true, initfire=true}
+ti[" f"] = {"fl-sand", eternal=true, initfire=true}
+ti["FT"] = {"fl-sand", eternal=true, initfire=true, name="fire_target"}
+ti["%:"] = {"fl_hay", secure=true}
+ti[" v"] = {"fl-sand", force_y=10}
+ti[" h"] = {"fl-sand", force_x=-10}
+ti["XX"] = ti["  "] .. {st_oxyd_d}
+ti[" ."] = ti["  "] .. {"it_seed"}
+ti["'."] = ti["''"] .. {"it_seed"}
+ti["'o"] = ti["''"] .. {"it_meditation"}
+ti["%;"] = ti["%."] .. {"st_door_b", state=OPEN}
+ti[";@"] = ti[";;"] .. {"it_death"}
+ti[" %"] = ti["  "] .. {"it-booze-broken"}
+ti[",%"] = ti[",,"] .. {"it-booze-broken"}
+ti[",b"] = ti[",,"] .. {"it_banana"}
+ti[",d"] = ti[",,"] .. {"it_coin_l"}
+ti[",s"] = ti[",,"] .. {"it_sword"}
+ti[",r"] = ti[",,"] .. {"it-ring"}
+ti[",l"] = ti[",,"] .. {"it_extralife"}
+ti[",c"] = ti[",,"] .. {"it_rubberband", anchor2="white", threshold=1, length=10}
+ti[",g"] = ti[",,"] .. {"it_glasses", state=SPOT_DEATH}
+ti["$g"] = ti["$$"] .. {"it_glasses", state=SPOT_DEATH}
+ti[",a"] = ti[",,"] .. {"it_floppy"}
+ti[",p"] = ti[",,"] .. {"it-pencil"}
+ti[",t"] = ti[",,"] .. {"it-document", text="mystic"}
+ti[" k"] = ti["_f"] .. {"it_cherry"}
+ti[" e"] = ti["  "] .. {"it-extinguisher_medium"}
+ti["%l"] = ti["%%"] .. {"it_extralife"}
+ti[" m"] = ti["  "] .. {"it_landmine"}
+ti[" o"] = ti["  "] .. {"it-burnable_oil"}
+ti["$o"] = ti["$$"] .. {"it-burnable_oil"}
+ti[" s"] = ti["  "] .. {"it_squashed"}
+ti[".s"] = ti[".."] .. {"it_squashed"}
+ti[";s"] = ti[";;"] .. {"it_squashed"}
+ti["%t"] = ti["%%"] .. {"it_meditation_bump"}
+ti["_U"] = ti["__"] .. {"it_umbrella"}
+ti["_d"] = ti["__"] .. {"it-drop"}
+ti["_."] = ti["_v"] .. {"it_seed_volcano", secure=true}
+ti[";t"] = ti[";;"] .. {"it-spade"}
+ti[" t"] = ti["  "] .. {"it-spade"}
+ti[" H"] = ti["  "] .. {"it_meditation_hill"}
+ti[";w"] = ti[";;"] .. {"it_magicwand"}
+ti["%w"] = ti["%%"] .. {"it_magicwand"}
+ti[";g"] = ti[";;"] .. {"it_glasses_broken"}
+ti["fw"] = ti["  "] .. {"it-flagwhite"}
+ti["ww"] = ti["  "] .. {"it_wormhole", range=0.5, destination="white_grave"}
+ti[" y"] = ti["  "] .. {"it-yinyang"}
+ti["k0"] = ti["  "] .. {"it_key", code=0}
+ti["k1"] = ti["  "] .. {"it_key", code=1}
+ti["k3"] = ti["~~"] .. {"it_key", code=3}
+ti["k4"] = ti["%%"] .. {"it_key", code=4}
+ti["d1"] = ti[",,"] .. {"it-document", text="welcome"}
+ti["d2"] = ti[",,"] .. {"it-document", text="rainmaker"}
+ti["d3"] = ti[",,"] .. {"it-document", text="bug"}
+ti["d4"] = ti[",,"] .. {"it-document", text="barber"}
+ti["d5"] = ti[",,"] .. {"it-document", text="predecessor"}
+ti["d6"] = ti[";;"] .. {"it-document", text="curse"}
+ti["d7"] = ti["  "] .. {"it-document", text="repair"}
+ti["d8"] = ti["  "] .. {"it-document", text="mailbox"}
+ti["d9"] = ti["$$"] .. {"it-document", "docinvoice", text="invoice"}
+ti["da"] = ti["  "] .. {"it-document", text="holy"}
+ti["db"] = ti[";;"] .. {"it-document", text="death"}
+ti["dc"] = ti["  "] .. {"it-document", text="fire"}
+ti["dd"] = ti["  "] .. {"it-document", text="research"}
+ti["de"] = ti[";;"] .. {"it-document", text="noitem"}
+ti["df"] = ti["%%"] .. {"it-document", text="thieves"}
+ti["dg"] = ti["''"] .. {"it-document", text="children"}
+ti["ph"] = ti["$$"] .. {"it_pipe_ew"}
+ti["pH"] = ti[",,"] .. {"it_pipe_ew"}
+ti["pv"] = ti["$$"] .. {"it_pipe_ns"}
+ti["pV"] = ti[",,"] .. {"it_pipe_ns"}
+ti["pa"] = ti["  "] .. {"it_pipe_nw"}
+ti["pA"] = ti[",,"] .. {"it_pipe_nw"}
+ti["pb"] = ti["$$"] .. {"it_pipe_ne"}
+ti["pB"] = ti[",,"] .. {"it_pipe_ne"}
+ti["pc"] = ti["$$"] .. {"it_pipe_es"}
+ti["pC"] = ti[",,"] .. {"it_pipe_es"}
+ti["pd"] = ti["$$"] .. {"it_pipe_sw"}
+ti["pD"] = ti[",,"] .. {"it_pipe_sw"}
+ti["pn"] = ti[";;"] .. {"it-puller-n"}
+ti["pe"] = ti["gs"] .. {"it-puller-e"}
+ti["g1"] = {"it_rubberband", anchor2="kid1", min=0.55, max=0.65}
+ti["g2"] = {"it_rubberband", anchor2="kid2", min=1.00, max=1.10}
+ti["g3"] = {"it_rubberband", anchor2="kid3", min=1.45, max=1.55}
+ti["g4"] = {"it_rubberband", anchor2="kid4", min=1.90, max=2.00}
+ti["te"] = ti[",,"] .. {"it_sensor", target="escape", invisible=true}
+ti["t'"] = ti["''"] .. {"it_trigger", target="open_grave"}
+ti["c'"] = ti["''"] .. {"it_sensor", target="home", invisible=true}
+ti["gS"] = ti["gs"] .. {"it_sensor", target="curse_brittle"}
+ti[";c"] = ti[";;"] .. {"it_sensor", target="curse_legs"}
+ti["t1"] = ti["%."] .. {"it_trigger", target="volcano", name="volcano1"}
+ti["t2"] = ti["%."] .. {"it_trigger", target="volcano", name="volcano2"}
+ti["t3"] = ti["%."] .. {"it_trigger", target="volcano", name="volcano3"}
+ti["t4"] = ti["%."] .. {"it_trigger", target="volcano", name="volcano4"}
+ti["t5"] = ti["%."] .. {"it_trigger", target="volcano", name="volcano5"}
+ti["t6"] = ti["%."] .. {"it_trigger", target="volcano", name="volcano6"}
+ti["tc"] = ti["^^"] .. {"it_sensor", target="scorpion_count"}
+ti["ti"] = ti["%%"] .. {"it_sensor", target="scorpion_init", invisible=true}
+ti[" C"] = ti["  "] .. {"st-chameleon"}
+ti["'b"] = ti["''"] .. {"st_passage_black_frame"}
+ti["W "] = ti["  "] .. {"st_passage_white_cross"}
+ti["Wv"] = ti[" v"] .. {"st_passage_white_cross"}
+ti["Ws"] = ti["gs"] .. {"st_passage_white_cross"}
+ti["Ww"] = ti["gw"] .. {"st_passage_white_cross"}
+ti["Wf"] = ti[" f"] .. {"st_passage_white_cross"}
+ti["Wk"] = ti["k0"] .. {"st_passage_white_cross"}
+ti["##"] = ti[";;"] .. {"st-greenbrown"}
+ti["#!"] = ti["##"] .. {"it_death"}
+ti["#@"] = ti[";@"] .. {"st-greenbrown"}
+ti["#d"] = ti["d6"] .. {"st-greenbrown"}
+ti["#D"] = ti["_d"] .. {"st-greenbrown"}
+ti["#z"] = ti[";w"] .. {"st-greenbrown"}
+ti["#e"] = ti["ge"] .. {"st-greenbrown"}
+ti["#w"] = ti["gw"] .. {"st-greenbrown"}
+ti["#t"] = ti[";t"] .. {"st-greenbrown"}
+ti["#s"] = ti[";s"] .. {"st-greenbrown"}
+ti["H#"] = ti[";;"] .. {"st-greenbrown_hole"}
+ti["Hg"] = ti[";g"] .. {"st-greenbrown_hole"}
+ti["Hd"] = ti["db"] .. {"st-greenbrown_hole"}
+ti["Ht"] = ti["de"] .. {"st-greenbrown_hole"}
+ti["He"] = ti["ge"] .. {"st-greenbrown_hole"}
+ti["Hw"] = ti["gw"] .. {"st-greenbrown_hole"}
+ti["Hn"] = ti["gn"] .. {"st-greenbrown_hole"}
+ti["Hm"] = ti["pn"] .. {"st-greenbrown_hole"}
+ti["HE"] = ti[";;"] .. {"st-greenbrown_hole", "white_grave"}
+ti["Hp"] = ti["pe"] .. {"st-greenbrown_hole"}
+ti["Hs"] = ti["gs"] .. {"st-greenbrown_hole"}
+ti["HS"] = ti["gS"] .. {"st-greenbrown_hole"}
+ti["H5"] = ti["g5"] .. {"st-greenbrown_hole"}
+ti["H6"] = ti["g6"] .. {"st-greenbrown_hole"}
+ti["H7"] = ti["g7"] .. {"st-greenbrown_hole"}
+ti["H8"] = ti["g8"] .. {"st-greenbrown_hole"}
+ti["Hc"] = ti[";c"] .. {"st-greenbrown_hole"}
+ti["HF"] = ti["He"] .. {"it-document", text="trapped"}
+ti["I#"] = ti["  "] .. {"st_stoneimpulse"}
+ti["IM"] = ti["''"] .. {"st_stoneimpulse_movable"}
+ti["I."] = ti[".."] .. {"st_stoneimpulse"}
+ti["Im"] = ti[".."] .. {"st_stoneimpulse_movable"}
+ti["Ih"] = ti[".."] .. {"st_stoneimpulse_hollow"}
+ti["IH"] = ti["__"] .. {"st_stoneimpulse_hollow"}
+ti["G#"] = ti[";;"] .. {"st-glass1"}
+ti["M#"] = ti[";;"] .. {"st-greenbrown_move"}
+ti["MW"] = ti["''"] .. {"st_box"}
+ti["M:"] = ti["::"] .. {"st_box"}
+ti["MB"] = ti["c'"] .. {"st-brownie"}
+ti["M."] = ti[".."] .. {"st-brownie"}
+ti["W."] = ti[".."] .. {"st-break_acwhite"}
+ti["S."] = ti[".."] .. {"st-break_acblack"}
+ti["R0"] = ti["  "] .. {"st-rock5"}
+ti["R1"] = ti["::"] .. {"st-rock1"}
+ti["R6"] = ti["::"] .. {"st-rock1_move"}
+ti["R2"] = ti["  "] .. {"st-rock1"}
+ti["R4"] = ti["^^"] .. {"st-rock1"}
+ti["R5"] = ti[".."] .. {"st-rock1"}
+ti["Rp"] = ti[".."] .. {"st-rock1_hole"}
+ti["Rh"] = ti["  "] .. {"st-rock1_hole"}
+ti["Rm"] = ti["::"] .. {"st-rock1_move"}
+ti["R3"] = ti["  "] .. {"st-rock3"}
+ti["RH"] = ti["  "] .. {"st-rock3_hole"}
+ti["RP"] = ti["  "] .. {"st_panel"}
+ti["R#"] = ti["  "] .. {"st_rotator_cw"}
+ti["RL"] = ti["  "] .. {"st_rotator_ccw"}
+ti["RM"] = ti["  "] .. {"st_rotator_ccw", movable=true}
+ti["RX"] = ti["::"] .. {"st_rotator_ccw", movable=true}
+ti["RY"] = ti["::"] .. {"st_rotator_cw", movable=true}
+ti["P#"] = ti[";;"] .. {"st_pull"}
+ti["P_"] = ti["__"] .. {"st_pull"}
+ti["T#"] = ti["  "] .. {"st-thief"}
+ti["F,"] = ti[",,"] .. {"st-grate1"}
+ti["F:"] = ti["::"] .. {"st-grate1"}
+ti["F'"] = ti["''"] .. {"st-grate1"}
+ti["F."] = ti[".."] .. {"st-grate1"}
+ti["FA"] = ti[".."] .. {"st_quake"}
+ti["S#"] = ti[",,"] .. {"st_scissors"}
+ti["SS"] = {"st_scissors"}
+ti["B#"] = ti[".."] .. {"st-block"}
+ti["B,"] = ti[",,"] .. {"st_door_d", "ali_barber", faces="ew"}
+ti["K0"] = ti["  "] .. {"st_key", code=0, target="predecessor"}
+ti["B0"] = ti[",,"] .. {"st_door_d", "predecessor", faces="ew"}
+ti["O,"] = ti[",,"] .. {"st_door_d", "oil_shop", faces="ns"}
+ti["Cm"] = ti[" m"] .. {"st-chameleon"}
+ti["UA"] = ti["_U"] .. {"st-glass1"}
+ti["B;"] = ti[";;"] .. {"st_passage_black_frame"}
+ti["BB"] = ti["  "] .. {"st_brick", cluster=1}
+ti["Bw"] = ti[".."] .. {"st_boulder_w"}
+ti["Bo"] = ti[".."] .. {"st_boulder_e"}
+ti["BI"] = ti[".."] .. {"st_blocker"}
+ti["B."] = ti[".."] .. {"it_blocker"}
+ti["%b"] = ti["%%"] .. {"it_blocker"}
+ti["Bs"] = ti["%%"] .. {"st_boulder_s"}
+ti["BS"] = ti["%b"] .. {"st_boulder_s"}
+ti["Bn"] = ti["%%"] .. {"st_boulder_n"}
+ti["A1"] = ti[".."] .. {"st_bluesand", cluster=1}
+ti["A2"] = ti[".."] .. {"st_bluesand", cluster=2}
+ti["WE"] = ti["  "] .. {"st_window_e"}
+ti["WS"] = ti["  "] .. {"st_window_s"}
+ti["LE"] = ti[",,"] .. {"st_laser_e", "blacksmith"}
+ti["LX"] = ti[",,"] .. {"st_laser_e", state=ON}
+ti["l"] = ti[".."] .. {"st_puzzle_blue"}
+ti["b"] = ti["''"] .. {"st_puzzle_blue", "tutpuz#"}
+ti["Y"] = ti["''"] .. {"st_puzzle_yellow", "tutpuz#"}
+ti["LS"] = ti[".."] .. {"st_laserswitch", target="illumination"}
+ti["MD"] = ti[".."] .. {"st_mirror_triangle", state=WEST, transparent=true, movable=true}
+ti["MP"] = ti[".."] .. {"st_mirror_slab", state=VERTICAL, transparent=true, movable=true}
+ti["CB"] = ti[",,"] .. {"st_coinslot", target="blacksmith"}
+ti["CS"] = ti[",,"] .. {"st_coinslot", target="buy_south"}
+ti["CW"] = ti[",,"] .. {"st_coinslot", target="buy_west"}
+ti["CC"] = ti[",,"] .. {"st_coinslot", target="ali_barber"}
+ti["CO"] = ti[",,"] .. {"st_coinslot", target="oil_shop"}
+ti["DI"] = ti["__"] .. {"st_death_invisible"}
+ti["GB"] = ti[",b"] .. {"st-glass1_move"}
+ti["GP"] = ti[",p"] .. {"st-glass1_move"}
+ti["GS"] = ti[",s"] .. {"st-glass1_move"}
+ti["GR"] = ti[",r"] .. {"st-glass1_move"}
+ti["GG"] = ti[",g"] .. {"st-glass1_move"}
+ti["GT"] = ti[",t"] .. {"st-glass1_move"}
+ti["G."] = ti[".."] .. {"st-glass_move"}
+ti["G'"] = ti["''"] .. {"st-glass1"}
+ti["GO"] = ti["t'"] .. {"st-glass1_hole"}
+ti["GA"] = ti[",,"] .. {"st-beads"}
+ti["GV"] = ti["t1"] .. {"st_passage_black_frame"}
+ti["Ti"] = ti["ti"] .. {"st_passage_black_frame"}
+ti["HW"] = ti["  "] .. {"st_chess_white"}
+ti["C."] = ti[".."] .. {"st-chameleon"}
+ti["Mw"] = ti["  "] .. {"st_mail_w"}
+ti["TL"] = ti[",,"] .. {"st_timer", target="do_curse_legs", name="timer_curse_legs", state=OFF}
+ti["ON"] = ti["^^"] .. {"st_oneway_n"}
+ti["OS"] = ti["^^"] .. {"st_oneway_s"}
+ti["PA"] = ti["__"] .. {"st-plain"}
+ti["P%"] = ti["%."] .. {"st-plain"}
+ti["Pm"] = ti["%."] .. {"st-plain_move"}
+ti["Ph"] = ti["%."] .. {"st-plain_hole"}
+ti["Pc"] = ti["%."] .. {"st-plain_break"}
+ti["Pf"] = ti["%f"] .. {"st-plain_break"}
+ti["P."] = ti["_."] .. {"st-plain_break"}
+ti["PC"] = ti[".."] .. {"st-plain_break"}
+ti["PB"] = ti[".."] .. {"st-bug"}
+ti["TT"] = ti["tt"] .. {"st-thief"}
+ti["D1"] = ti[".."] .. {"st_blocker", "door1#"}
+ti["D2"] = ti[".."] .. {"st_blocker", "door2#"}
+ti["D3"] = ti[".."] .. {"st_blocker", "door3#"}
+ti["D4"] = ti[".."] .. {"st_blocker", "door4#"}
+ti["K1"] = ti[".."] .. {"st_key", code=1, target="door1#*"}
+ti["K2"] = ti[".."] .. {"st_key", code=2, target="door2#*"}
+ti["K3"] = ti[".."] .. {"st_key", code=3, target="door3#*"}
+ti["K4"] = ti[".."] .. {"st_key", code=4, target="door4#*"}
+ti["KA"] = ti["  "] .. {"st_floppy", target="door8"}
+ti["D5"] = ti["::"] .. {"st_door_c", "door5#"}
+ti["D7"] = ti[".."] .. {"st_door_a", "door7"}
+ti["D8"] = ti["gw"] .. {"st_door_a", "door8"}
+ti["_C"] = ti["__"] .. {"st-chameleon"}
+ti["_T"] = ti["__"] .. {"st-invisible"} .. ti({"#ac_horse"})
+
+ti[" 1"] = ti[",,"] .. {"#ac_marble_black", "black", essential=1, player=0, controllers=1} .. ti({"it_extralife"})
+ti[" 2"] = ti["ge"] .. {"#ac_marble_white", "white", essential=0, player=1, controllers=2}
+ti["c1"] = ti["  "] .. {"#ac_pearl", essential=1, player=DEFAULT, controllers=0, name="kid1"}
+ti["c2"] = ti["  "] .. {"#ac_pearl", essential=1, player=DEFAULT, controllers=0, name="kid2"}
+ti["c3"] = ti["  "] .. {"#ac_pearl", essential=1, player=DEFAULT, controllers=0, name="kid3"}
+ti["c4"] = ti["  "] .. {"#ac_pearl", essential=1, player=DEFAULT, controllers=0, name="kid4"}
+ti[" 8"] = ti["  "] .. {"#ac_bug"}
+ti[" 3"] = ti["  "] .. {"#ac_killer", "killer"}
+ti[" 4"] = ti["  "] .. {"#ac_top", range=1.8, strength=30}
+ti[" 5"] = ti["  "] .. {"#ac_top", range=3, strength=40, name="top"}
+ti[" 6"] = ti["  "] .. {"#ac_rotor", range=3, strength=40, name="rotor"}
+ti["%6"] = ti["%%"] .. {"#ac_rotor", range=3, strength=40}
+ti["'6"] = ti["''"] .. {"ac_rotor", range=3, strength=40}
+
+ti["C4"] = ti[" 4"] .. {"st-chameleon"}    -- aka sand viper in natur
+ti["H4"] = ti[" 4"] .. {"st-greenbrown_hole"}    -- aka sand viper in natur
+ti["P5"] = ti[" 5"] .. {"st_pull"}    -- aka sand viper in a puller
+ti["G6"] = ti[" 6"] .. {"st-glass1"}    -- aka rotodile in a puller
+ti["G3"] = ti[" 3"] .. {"st-glass1"}    -- aka scorpion in a puller
+ti["G8"] = ti[" 8"] .. {"st-glass1_move"}
+ti["W4"] = ti[" 4"] .. {"st_window_e"}
+ti["C1"] = ti["k1"] .. {"st-chameleon"}
+
+ti["'A"] = {"fl-sahara", "tutoxyd"}
+
+ti["k2"] = ti["##"] .. {"it_key", code=2}
+
+ti["Va"] = ti[";;"] .. {"it_vortex", "vortex_a", destination="vortex_A"}
+ti["VA"] = ti["RH"] .. {"it_vortex", "vortex_A", destination="vortex_a"}
+ti["Vb"] = ti[" C"] .. {"it_vortex", "vortex_b", destination="vortex_B"}
+ti["VB"] = ti["ge"] .. {"it_vortex", "vortex_B", destination="vortex_b"}
+ti["Vc"] = ti["Hw"] .. {"it_vortex", "vortex_c", destination="vortex_C"}
+ti["VC"] = ti["%%"] .. {"it_vortex", "vortex_C", destination="vortex_c"}
+ti["Vd"] = ti["%%"] .. {"it_vortex", "vortex_d", destination="vortex_D"}
+ti["VD"] = ti["Hs"] .. {"it_vortex", "vortex_D", destination="vortex_d"}
+ti["Ve"] = ti["Hw"] .. {"it_vortex", "vortex_e", destination="vortex_E"}
+ti["VE"] = ti["%%"] .. {"it_vortex", "vortex_E", destination="vortex_e"}
+ti["FB"] = ti["Rh"] .. {"it_wormhole", destination="fire_target", range=1.5}
+
+ti["'c"] = ti["''"] .. {"st-chameleon"}
+ti["?g"] = ti["  "] .. {"st-grate3"}
+ti[" w"] = ti["  "] .. {"it_magicwand"}
+
+ti["ni"] = {"st_nil"} .. ti{"it_nil"}
+
+if wo["IsDifficult"] then
+    ti[" u"] = ti["  "]
+    ti[".r"] = ti[".."] .. {"it-ring"}
+else
+    ti[" u"] = ti["  "] .. {"it_umbrella"}
+    ti[".r"] = ti[".."] .. {"it_extralife"}
+end
+
+oxyd_colors = lib.lua.shuffle({OXYD_BLUE, OXYD_RED, OXYD_GREEN, OXYD_YELLOW,
+    OXYD_CYAN, OXYD_PURPLE, OXYD_WHITE, OXYD_BLACK})
+holy_idx = random(1, 8)
+fake_idx = 1
+
+myresolver = function(key, x, y)
+    if wo["IsDifficult"] then
+        if key == "o9" then
+            return ti["O"..oxyd_colors[holy_idx]]
+        elseif key == "of" then
+            local idx = lib.lua.cond(fake_idx == holy_idx, fake_idx + 1, fake_idx)
+            fake_idx = idx + 1
+            return ti["O"..oxyd_colors[idx]]
+        elseif key:sub(1,1) == "o" then
+            local idx = 0 + key:sub(2,2)
+            return ti["O"..oxyd_colors[idx]]
+        elseif key:sub(1,1) == "r" then
+            local idx = 0 + key:sub(2,2)
+            return lib.lua.cond(idx == holy_idx, ti["R6"], ti["R1"])
+        end
+    else
+        if key == "o9" then
+            return ti["OE"]
+        elseif (key == "of" or key:sub(1,1) == "o" or key:sub(1,1) == "r") then
+            return ti["  "] -- dummy
+        end
+    end
+    return ti[key]
+end
+
+w, h = wo(res.puzzle(myresolver,"l","b","Y"), "  ", {
+--0 1 2 3 4 5 6 7 8 9101112131415161718||202122232425262728293031323334353637||394041424344454647484950515253545556||
+"C1 s  C4                                                                                                       u####", --  0
+"                                                                                                        ##      C4##", --  1
+"    C4                                                                                                              ", --  2
+"C4                                                                                                                  ", --  3
+"     m                                                                                                              ", --  4
+"                                                                                                                ##  ", --  5
+"                                                                                                                    ", --  6
+"                                                                                                                    ", --  7
+"                                                                                                                    ", --  8
+"                                        C4                                                                          ", --  9
+"                                                         % %                   %                                    ", -- 10
+"                                #d#################s####H#H##### %###############@#d                                ", -- 11
+"                                ###@#@#@#@#@#@#@#@M##@#@#@#@#@#@#@#@#@#@#@#@#@#@#@##                                ", -- 12 --
+"                                ###@##############;;##########################H#H##w                                ", -- 13
+"                                #eHeH5##VD##VeH6##;;##########################H##@##                                ", -- 14
+"                                ###@Hp##Hs####Hn##;;;;H#H#Hd_f_f_f_f_f_f_f####H##@                                  ", -- 15
+"                                ###@Hs##Hs####Hn##;;########DIDIDIDIDIDI_f####H##@                                  ", -- 16
+"                                ###@HS##Hs####Hn##;;########_f_f_f_f_fDI_f####Hc#@##                              ##", -- 17
+"                                ###@####HsHt##Hn##;;M# k kM#_fDIDIDI_fDI_f#######@##                               %", -- 18
+"                                ###@####Hs##H5H8R#;;H#######_fDI_f_f_fDI_f####Hm#@                                  ", -- 19
+"                                ###@####H7HeH8##H#;;##H#####_fDI_fDIDIDI_f####H##@##__                              ", -- 20
+"                             m  ##HFHE########G##D;;H#H#M#M#_fDI_f_f_f_f_f####H##@##                                ", -- 21
+"     %                          ###@####Va;;;;;;;;P_####B;####################H#H##w                                ", -- 22
+"                                ###@##########H#H#H#####H#HwHwHwHwHwHwHwHwVc#####@##                                ", -- 23
+"                                ###@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@##                                ", -- 24 --
+"                                #d#@###t####    ######Hg###z    M##### 4k2#########d                                ", -- 25
+"                                                ____                     s                                          ", -- 26
+"                                                                                                                    ", -- 27
+"                          d7                                                                                        ", -- 28
+"                                                                                                                    ", -- 29
+"                                                                                                                    ", -- 30
+"                                                                                                                    ", -- 31
+"                                                                                                                    ", -- 32
+"                                                                                                                    ", -- 33
+"                                                                                                                    ", -- 34
+"                                                                           f f                       f f            ", -- 35
+"      c2  c4 %                C4                                           fWfW W W W W W W W W W W Wf f            ", -- 36 --
+"    c1HWc3  R#~~        ~~RM                                                W $$$$$$ph$$$$ph$$$$$$$$W               ", -- 37
+"BBBBBBBBBBBBBB~e,f,f,f,f~eBBBBBBBBBBBBBB                                    W $$$g## fpb$$$o$$ f$$$oW               ", -- 38
+"BBCS,,GTCWGGCW,,,l 1d1,,,,,,,,B,,,d4S#BBT#                                  W $$$$$$$$$$$$$$$$pd##$$W d8            ", -- 39
+"BBGB,,,,,,,,F,,,,d,d,d,d,,,,,,CC,,BBBBBB                                    W $$$$$$$$$$$$ H o  d9phMw              ", -- 40
+"BBCS,,CS,,CSBB,,,,,,,,,,,,,,BBBBBBBB,aBB                               m    W $$phph$o$$ Hpa 4  $$$$W               ", -- 41
+"BBGPF,GRF,GSBB,,,,,,,,,,,,,,,,,,,,BB,dBB                                    W $o$$pv## f fKA H  $$$$W               ", -- 42
+"BBBBBBBBBBBBBB,,,,,,,,,,,,,,,,,,d5K0,dGA                                    W $$$$pv fWk H f ffw$$$$WvWvWvW W W W W ", -- 43
+"BBLE,,,,CBBB,,,,,,,etetete,,,,,,,,B0,cBBBBBBWSBBBBBB  BBBBBBBBW W W W W W W W $$$$$$ f   o e H fg5gsgsgsgs$$$o$$ f$$", -- 44
+"BB,,,,,,,,BB,,,,BBBBG3G6P5BBBBO,COBBBBBB    W4    da    R2R2BB$$$$$$$$$$$$$$$$$$$$#### HVb   hD8gwgwgwgwgwpb$$####pv", -- 45
+"BBUA,,d2,,,,,,,,BBd3teteteCSBB,,pDpVpBBBo9  W4           fFBBB$$phpv$$$$$o$$$$$$$$$$## f t H f fg7gngn####$$pc$$##$$", -- 46
+"BBUAUAUA,,BB,,,,F,,,,,,,,,G8BBpVpDpVpBBB    W4        dcR2R2BB$$$$$$$$$$$$##$$$$ f$$$o$$ f f$$$$$$$$$$$$$$$$$$##$$$$", -- 47
+"BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB###############!#!#!#!#!#!#!#!#!#!#!#!#!#!#!#!#!#!#!#!", -- 48 --
+"                                                                            ##%%%t%tPmPcPcPcPcPcPcPcPcPcPcPm%t%t%%##", -- 49
+"                                                                            ##%tVd%%P%PAPAPAPAPAPAPAPAPAPAP%%%%l%t##", -- 50
+"                                                                            ##%t%%%%P%%.%.%.%.%.%.%.%.%.%.P%%%%%%t##", -- 51
+"                                                                            ##PcP%P%P%%.%.%;%.%.%.%.%.%;%.P%P%P%Ph##", -- 52
+"                                                                            ##PcP.%.%.%.%.t3%.%;%.%.%.t5%.%.PcP%Ph##", -- 53
+"                                                                            ##PcP.%.%.%;%.%.%.GV%.%;%.%.%.%.PfP%Ph##", -- 54
+"                                                                            ##PcP.%.%.t2%.%.%.%.%.t4%.%.%.%;PcP%Ph##", -- 55
+"                                                                            ##PmP%P%P%%.%.%.%.%.%.%.%.%.%.t6PhP%Pm##", -- 56
+"                                                                            ##%t%%%%P%%.%.%.%.%.%.%.%.%.%.Ph%%%%%t##", -- 57
+"                                                                            ##%t%l%%P%P%PmP%PmP%P%PmP%PmP%P%%%VC%t##", -- 58
+"                                                                            ##%%%t%tP%PhPhPhPhPhPhPhPhPhPhPc%t%t%%##", -- 59
+"R0R0R0TTTTTTTTTTTTTTTTTTTTTTTTTTTTR0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0########################################", -- 60 --
+"R0VE%%BnttttTTttttttTTttttttTTtttt%b%bR0^^g5gsgsgsg6R4tcR4g5gsgsgsgsgsgsg6^^D7..............R5FTR5................R0", -- 61
+"R0dfR0ttTTttttttTTttttttTTttttttTT%b%bR0g5g9^^^^^^gwR4OSR4ge^^^^^^^^^^^^gbg6R0....................................R0", -- 62
+"R0R0R0R0TTTTTTTTTTTTTTTTTTTTTTTTTT%b%bR0ge^^^^^^^^gbgsgsgsg9^^^^^^^^^^^^^^gwR0....................................R0", -- 63
+"R0%wtttttttt%wtttt%w%wtttt%wtttttt%b%bR0ge^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^gwR0....................................R0", -- 64
+"R0%wtt%wtttt%wtttttttttttt%wtttttt%b%bR0ge^^^^^^^^^^^^^^^^^^^^^^^^g5g6^^^^gwR0....................................R0", -- 65
+"R0%wtttttttttttttttttttttttttttttt%b%bR0ge^^^^g5g6^^^^^^^^^^^^^^^^g7g8^^^^gwR0....RZF.l1F.............F.l1F.......R0", -- 66
+"R0tttttttttttttttttttttttttttttttt%b%bR0ge^^^^g7g8^^^^^^^^^^^^^^^^^^^^^^^^gwR0..R5l1l1l1F.............F.l1l1l1R5..R0", -- 67
+"R0tttttttttttttttttttt%wtttttttttt%b%bR0ge^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^gwR0..R5R5R5l1F.............F.l1R5RpRp..R0", -- 68
+"R0tttttttttt%wtttttttt%wtttttttttt%b%bR0ge^^^^^^^^^^^^^^gcgngngnga^^^^^^^^gwR0..R5R5VBl1F.............F.l1.rR5R5..R0", -- 69
+"R0%wtt%wtttt%wtt%wtttt%wtttttttttt%b%bR0g7ga^^^^^^^^^^^^gwR4ONR4ge^^^^^^gcg8R0..R5R5R5l1F.F.F.F.F.F.F.F.l1R5R5R5..R0", -- 70
+"R0%wtttttttttttt%wtttt%wttttttttttBSBSTi^^g7gngngngngngng8R4tcR4g7gngngng8^^R0......F.l1l1l1l1l1l1l1l1l1l1F.......R0", -- 71
+"R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0PCPBPCPBPCPBPCPBPCPBR0R0R0R0R0", -- 72 --
+"R0''''''''''''''''''''''''''''R0I#~~''MW''~~I#R0''''''''''''''''''''''''''''R0RLR3R3R3PBPCPBPCPBPCPBPCPBPCR3R3VAR#R0", -- 73
+"R0''''''''''''''''''''''''''''R0MWR0'b'b'bR0MWR0''''''''''''''''''''''''''''R0BwBIBIBIBIBIBIBIBIBIBIBIBIBIBIBIBIBIR0", -- 74
+"R0''''''''~~%%~~RP~~%%~~'''''''''''''b'''b''''''''''''~~RP~~RP~~RP~~''''''''R0B.B.B.B.B.B.B.B.B.B.B.B.B.B.B.B.B.BoR0", -- 75
+"R0''''''''%%%%~~~~~~%%%%'''''''''''''b'''b''''''MW''''RP%%~~~~~~%%RP''''''''R0R#................................RLR0", -- 76
+"R0''''''''~~~~%6%%%6~~~~'''''.'''''''b'''b''''''''''''~~~~%%%%%%~~~~''''''''R0...............................s....R0", -- 77
+"R0''''''''RP~~%%k4%%~~RP'''''''''''''b'''b''''''''''''RP~~%%k3%%~~RP'''''''''b....................................R0", -- 78
+"R0''''''''~~~~%6%%%6~~~~'''''.'''''''b'''b''''''''''''~~~~%%%%%%~~~~''''''''R0....................................R0", -- 79
+"R0''''''''%%%%~~~~~~%%%%'''''''''''''b'''b''''''MW''''RP%%~~~~~~%%RP''''''''R0....................................R0", -- 80
+"R0''''''''~~%%~~RP~~%%~~'''''''''''''b'''b''''''''''''~~RP~~RP~~RP~~''''''''R0A2A1K1A1K2A1A2D1D3D3D2A2A1K3A1K4A1A2R0", -- 81
+"R0''''''''''''''''''''''''''''R0MWR0'b'b'bR0MWR0''''''''''''''''''''''''''''R0A2A1A1A1A1A1A2D3D1D2D3A2A1A1A1A1A1A2R0", -- 82
+"R0''''''''''''''''''''''''''''R0I#~~''MW''~~I#R0''''''''''''''''''''''''''''R0A2A2A2A2A2A2A2D4D2D1D4A2A2A2A2A2A2A2R0", -- 83
+"R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0A1A1A1A1A1A1A1D2D4D4D1A1A1A1A1A1A1A1R0", -- 84 --
+"                                    B#B#I...ImI.I.I.I.I.I.I.I.I.I.B#B#..G.F.B#................................F...B#", -- 85
+"  TL                                B#B#B#B#I.B#B#B#B#B#B#B#B#B#I.I.I...G.F.B#................................F.MPB#", -- 86
+"                                    B#B#B#B#I.B#B#B#B#B#B#B#B#B#B#B#B#..G.F.B#..........FA......LS......FA....F...B#", -- 87
+" 2ge,dgeddge;tgeww                  B#B#B#B#ImB#B#B#B#B#B#B#B#B#B#B#B#..G.F.B#......LYl1l1............LZl1l1..F...B#", -- 88
+"                                    B#B#B#B#ImB#B#B#B#B#B#B#B#B#B#B#B#MPG.F.B#......l1l1l1............l1l1l1..F...B#", -- 89
+"                                  LXC.....F...............................~~B#..MD..l1l1LS......FA......LSl1..F...B#", -- 90
+"  ofofofofofofof                    B#B#B#B#..IHIHIhIHIHIHIHB#B#B#B#B#MPG.F.B#......l1l1l1............l1l1l1..F...B#", -- 91
+"                                    B#B#B#B#B#B#B#..B#B#B#IHB#IHIHIHIH..G.F.B#........l1l1..............l1l1..F...B#", -- 92
+"                                    B#B#B#B#B#B#B#I.I.I.B#IHB#IHB#B#IH..G.F.B#..........FA......LS......FA....F...B#", -- 93
+"                                    B#B#B#B#B#B#B#I.B#I.B#IHIHIHB#B#B#..G.F.B#................................F.MPB#", -- 94
+"                                    B#B#B#B#B#B#B#I...ImB#B#B#B#B#B#B#..G.F.B#................................F...B#", -- 95
+"RPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRP..RPRPRPRPRPRPRPRPRPRPRPD5D5D5D5RPRPRPRPRPRPRPRPRPRPRPRPRPRPRP", -- 96 --
+"RP::::::::::::M:::::::::::::::::::::::RP::::::::::::::RX::::::::::::::::::::RP::::::::RP::::::::::::M:::::::::::::RP", -- 97
+"RP::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::RP", -- 98
+"RP::::::::::::::::::::::::::::::::::::o1::::::::::::::::::::::::::::::::::::o2::::::::::::::::::::::::::::::::::::RP", -- 99
+"RP::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::RP", --100
+"RP::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::RP", --101
+"RP::::::::::::::::::::::::~~~~~~~~~~~~::::::::::::::::::::::::::::::::::::::::~~~~~~~~~~~~::::::::::::::::::::::::RP", --102
+"RP::::::::::::::::::::::::~~~~~~~~~~~~r1R1R1R1R1R1R1R1::::::::R1R1R1R1R1R1R1r2~~~~~~~~~~~~::::::::::::::::::::::::RP", --103
+"RP::::::::::::::::::::::::~~~~''''~~~~r1R1R1R1R1R1R1R1~~~~~~~~R1R1R1R1R1R1R1r2~~~~''''~~~~::::::::::::::::::::::::RP", --104
+"RP::::::::::::::::::::::::~~~~'''6~~~~r1R1R1R1R1R1R1R1~~~~~~~~R1R1R1R1R1R1R1r2~~~~'''6~~~~::::::::::::::::::::::::RP", --105
+"RP::::::::::::::::::::::::~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~::::::::::::::::::::::::RP", --106
+"RP::::::::::::::::::::::::~~~~~~~~~~''~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~''~~~~~~~~~~::::::::::::::::::::::::RP", --107
+"RP::::o3::::::::::::::::::::r3r3r3~~~~MBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMB~~~~r5r5r5::::::::::::::::::::o5::::RP", --108 --
+"RP:::::::::::::;::::::::::::R1R1R1~~~~MB''''''''''''''''''''''''''''''''''''MB~~~~R1R1R1:::::::::::::;::::::::::::RP", --109
+"RP:::::::::::;:::;::::::::::R1R1R1~~~~MB''''F'F'F'F'F'F'F'F'F'F'F'F'F'''''''MB~~~~R1R1R1:::::::::::;:::;::::::::::RP", --110
+"RP:::::::::;:::::::;::::::::R1R1R1~~~~MB'''AF'b1b1b1b1b1b1Y1b1b1b1b1F'''''''MB~~~~R1R1R1:::::::::;:::::::;::::::::RP", --111
+"RP:::::::::;:::::::;::::::::R1R1R1~~~~MB''''F'Y1Y1Y1Y1Y1b1Y1b1b1b1b1F'''''''MB~~~~R1R1R1:::::::::;:::::::;::::::::RP", --112
+"RP:::::::::::;:::;::::::::::::~~~~~~~~MB''''F'Y1G'G'G'Y1b1Y1b1b1b1b1F'''''''MB~~~~~~~~:::::::::::::;:::;::::::::::RP", --113
+"RP:::::::::::::;::::::::::::::~~~~~~~~MB''''F'Y1G'GOG'Y1Y1Y1Y1Y1Y1Y1F'''''''MB~~~~~~~~:::::::::::::::;::::::::::::RP", --114
+"RP:::::::;:;:;:;:;:;:;::::::::~~~~~~~~MB''''F'Y1G'G'G'Y1b1Y1b1b1b1b1F'''''''MB~~~~~~~~:::::::::;:;:;:;:;:;:;::::::RP", --115
+"RP:::::::::::::;::::::::::::R1R1R1~~~~MB''''F'Y1Y1Y1Y1Y1b1Y1b1b1b1b1F'''''''MB~~~~R1R1R1:::::::::::::;::::::::::::RP", --116
+"RP:::::::::::::;::::::::::::R1R1R1~~~~MB''''F'b1b1b1b1b1b1Y1b1b1b1b1F'''''''MB~~~~R1R1R1:::::::::::::;::::::::::::RP", --117
+"RP:::::::::::::;::::::::::::R1R1R1~~~~MB''''F'F'F'F'F'F'F'F'F'F'F'F'F'''''''MB~~~~R1R1R1:::::::::::::;::::::::::::RP", --118
+"RP:::::::::::::;::::::::::::R1R1R1~~~~MB''''''''''''''''''''''''''''''''''''MB~~~~R1R1R1:::::::::::::;::::::::::::RP", --119
+"RP::::o4::::::::::::::::::::r4r4r4~~~~MBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMBMB~~~~r6r6r6::::::::::::::::::::o6::::RP", --120 --
+"RP::::::::::::::::::::::::~~~~~~~~~~''~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~''~~~~~~~~~~::::::::::::::::::::::::RP", --121
+"RP::::::::::::::::::::::::~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~::::::::::::::::::::::::RP", --122
+"RP::::::::::::::::::::::::~~~~''''~~~~r7R1R1R1R1R1R1R1~~~~~~~~R1R1R1R1R1R1R1r8~~~~''''~~~~::::::::::::::::::::::::RP", --123
+"RP::::::::::::::::::::::::~~~~'''6~~~~r7R1R1R1R1R1R1R1~~~~~~~~R1R1R1R1R1R1R1r8~~~~'''6~~~~::::::::::::::::::::::::RP", --124
+"RP::::::::::::::::::::::::~~~~~~~~~~~~r7R1R1R1R1R1R1R1::::::::R1R1R1R1R1R1R1r8~~~~~~~~~~~~::::::::::::::::::::::::RP", --125
+"RP::::::::::::::::::::::::~~~~~~~~~~~~::::::::::::::::::::::::::::::::::::::::~~~~~~~~~~~~::::::::::::::::::::::::RP", --126
+"RP::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::RP", --127
+"RP::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::RP", --128
+"RP::::::::::::::::::::::::::::::::::::o7::::::::::::::::::::::::::::::::::::o8::::::::::::::::::::::::::::::::::::RP", --129
+"RPF:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:::F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:F:RP", --130
+"RP::::::::::::M:::::::::::::::::::::::::::::::::::::::::RY::::::::::::::::::::::::::::::::::::::::::M:::::::::::::RP", --131
+"RPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRPRP"  --132 --
+})
+
+
+function buy_south(value, sender)
+    st(sender + {0, 1}):kill()
+end
+
+function buy_west(value, sender)
+    st(sender + {-1, 0}):kill()
+end
+
+did_run_escape = false
+function escape()
+    if did_run_escape ==  false then
+        wo[no["escape_pos"]] = {"it-document", text="escape"}
+        did_run_escape = true
+    end
+    local y = no["escape_pos"].y + 1
+    if (no["rotor"].y ~= y) or (no["top"].y ~= y) or (no["killer"].y ~= y) then
+        wo[no["escape_close#*"]] = {"st-metal"}
+    end
+end
+
+did_curse_brittle = false
+function curse_brittle(value, sender)
+    if did_curse_brittle == false then
+        wo[sender + {-1, -3}] = {"it-crack2"}
+        wo[sender] = {"it-document", text="curse_brittle"}
+    end
+    did_curse_brittle = true
+end
+
+function curse_legs(value, sender)
+    wo[sender] = {"it-document", text="curse_legs"}
+    no["timer_curse_legs"]:on()
+end
+
+function do_curse_legs()
+    no["black"]["adhesion"] = -no["black"]["adhesion"]
+end
+
+trigger_count = 0
+function volcano(value, sender)
+    trigger_count = trigger_count + lib.lua.cond(value, 1, -1)
+    st(sender + {0, -1}):toggle()
+
+    if (trigger_count == 6) then
+        for v in st(no["volcan#*"]) do
+            if -v and v:is("st_volcano") then
+                v:kill()
+            end
+        end
+        local t = no["volcano"..random(5)]
+        wo:drawRect(t - {1,1}, 3, 3, ti["%:"])
+        local dy = t.y - no["vortex_d"].y
+        wo:drawRect(t - {0, dy}, 1, dy, ti["%:"])
+    end
+end
+
+scorpions = 0
+function scorpion_count(value, sender)
+    scorpions = scorpions + 1
+    if (scorpions == 8) then
+        no["door7"]:open()
+    end
+end
+
+did_init_scorpions = false
+function scorpion_init(value, sender)
+    if (not did_init_scorpions) then
+        for i = 1, 8 do
+            dx = 1 + random(16)
+            dy = -8 + random(5)
+            mf = math.random()*3 - 1
+            if (mf < 0.5) then
+                mf = mf - 1
+            end
+            wo[sender + {dx, dy}] = {"ac_killer", adhesion=mf}
+        end
+    end
+    did_init_scorpions = true
+end
+
+switch_count= 0
+function illumination(value, sender)
+    switch_count = switch_count + lib.lua.cond(value, 1, -1)
+    no["door5#*"]:message(lib.lua.cond(switch_count == 4, "open", "close"))
+end
+
+function open_grave(value, sender)
+    local a = no["tutoxyd"]
+    local solved = #no["tutpuz#*"] == 0
+    if (not solved) then
+        wo[a + {1,3}] = {"it-document", text="puzzle"}
+        wo[a + {13,3}] = {"it_cherry"}
+    else
+        wo:drawRect(a + {1, -1}, 13, 9, {"st_nil"})
+        wo:drawMap(ti, a + {3, -1}, "  ",
+                    {"  F'          F'",
+                     "F''oF'      F''oF'",
+                     "  F'g1      g2F'",
+                     "      _C_C_C",
+                     "  dg  _C_T_C        SS",
+                     "      _C_C_C",
+                     "  F'g3      g4F'",
+                     "F''oF'      F''oF'",
+                     "  F'          F'"})
+    end
+end
+
+did_say_bye = false
+did_set_magnet = false
+function home(value, sender)
+    local k1 = no["kid1"]
+    local k2 = no["kid2"]
+    local k3 = no["kid3"]
+    local k4 = no["kid4"]
+    local a = no["tutoxyd"]
+    local xa, ya = (a + {-2, -3}):xy()
+    local xb, yb = (a + {17, 9}):xy()
+    if (not did_set_magnet) and ((k1.x >= xa and k1.x <= xb and k1.y >= ya and k1.y <= yb) or
+            (k2.x >= xa and k2.x <= xb and k2.y >= ya and k2.y <= yb) or
+            (k3.x >= xa and k3.x <= xb and k3.y >= ya and k3.y <= yb) or
+            (k4.x >= xa and k4.x <= xb and k4.y >= ya and k4.y <= yb)) then
+        did_set_magnet = true
+        wo[a + {7, 3}] = {"it_magnet_on", strength=180, range=5, name="magnet"}
+    end
+    if (not did_say_bye) and ((k1.x >= xa and k1.x <= xb and k1.y >= ya and k1.y <= yb) and
+            (k2.x >= xa and k2.x <= xb and k2.y >= ya and k2.y <= yb) and
+            (k3.x >= xa and k3.x <= xb and k3.y >= ya and k3.y <= yb) and
+            (k4.x >= xa and k4.x <= xb and k4.y >= ya and k4.y <= yb)) then
+        wo[sender] = {"it-document", text="bye"}
+        did_say_bye = true
+    end
+end
+
+if not wo["IsDifficult"] then
+    wo[no["docinvoice"]] = {"it_nil"}
+    wo[no["door8"] - {2, 0}] = {"it-document", text="invoice"}
+
+    wo:drawMap(ti, no["oil_shop"] + {0, 1}, "  ",
+                {"nipHpVpV",
+                 "pVpCpVpA"})
+    local easychamber = no["door7"] + {0, 11}
+    wo:drawRect(easychamber, 20, 13, ti["ni"])
+    wo:drawMap(ti, easychamber, "  ",
+                {"R0R0R0R0R0R0R0PBPBPBPBPBPBR0R0R0R0R0R0R0",
+                 "R0........D2D1............D2D1........R0",
+                 "R0..W.M.S.D1G.G.G.....G.G.G.D2W.M.S...R0",
+                 "R0..M.OEM.D2G.K1G.....G.K2G.D1M.OEM...R0",
+                 "R0..S.M.W.D1G.G.G.....G.G.G.D2S.M.W...R0",
+                 "R0........D2D1D2D1D2D1D2D1D2D1........R0",
+                 "R0........D1D2D1D2D1D2D1D2D1D2........R0",
+                 "R0....................................R0",
+                 "R0..W.M.S...W.M.S.....W.M.S...W.M.S...R0",
+                 "R0..M.OEM...M.OEM.....M.OEM...M.OEM...R0",
+                 "R0..S.M.W...S.M.W.....S.M.W...S.M.W...R0",
+                 "R0....................................R0",
+                 "R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0R0"})
+    wo:shuffleOxyd()
+end
+
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="true"/>
+        <el:translation el:lang="de">Tutoxyds Pyramide</el:translation>
+      </el:string>
+      <el:string el:key="subtitle">
+        <el:english el:translate="false"/>
+      </el:string>
+      <el:string el:key="welcome">
+        <el:english el:translate="true">Welcome Mr. Jones! Back from your "Alternatives" and "The Walls" training camp?  Got everything you ordered:  some money  --  40 marbleons -- and a horse outside this shopping center.    Many adventurers did lose their lives in this pyramid.    Beware of the dangerous sand vipers and Enighomatep's curses.</el:english>
+      </el:string>
+      <el:string el:key="rainmaker">
+        <el:english el:translate="true" >Mr.Rainmaker used to own this shop. He always insisted that his umbrellas were the most usefull items in this desert. But nobody was willing to spend 2 marbleons.  ---  Now a blacksmith offers his service.</el:english>
+      </el:string>
+      <el:string el:key="escape">
+        <el:english el:translate="true" >Safety Precaution: in case one of these dangerous animals escapes, the gates of the shopping center will be closed immediately!</el:english>
+      </el:string>
+      <el:string el:key="mystic">
+        <el:english el:translate="true" >Not much is known of the pyramid's architect Enighomatep. But it is said that he loved cherries. He ate so many of them that he sometimes became invisible.</el:english>
+      </el:string>
+      <el:string el:key="bug">
+        <el:english el:translate="true" >Have a look at my collection!    A white scorpion   --   a rotodile   --  and a sand viper.  They cannot be sold.        But I can offer you a scarab that will be a better choice for you.</el:english>
+      </el:string>
+      <el:string el:key="barber">
+        <el:english el:translate="true" >Ali Barber's shop for quick hair cuts. Want to know what is going on?  A thief is hanging around and nobody knows where the 4 pale kids that are playing with your horse came from.</el:english>
+      </el:string>
+      <el:string el:key="predecessor">
+        <el:english el:translate="true" >Home of the last adventurer who never returned.   Said he would drill for oil -- but no one believed him.</el:english>
+      </el:string>
+      <el:string el:key="curse">
+        <el:english el:translate="true" >Be cursed for trying to explore Tutoxyd's last secret -- may your homework remain undone until you prove worthy!</el:english>
+      </el:string>
+      <el:string el:key="repair">
+        <el:english el:translate="true" >It's a pity that some explorers damaged this historic monument and did littered the environment.   But the pyramid magically repairs itself every time an adventurer gives up.</el:english>
+      </el:string>
+      <el:string el:key="curse_brittle">
+        <el:english el:translate="true" >Be cursed for disturbing Tutoxyd's peace -- may the earth part under your feet!</el:english>
+      </el:string>
+      <el:string el:key="curse_legs">
+        <el:english el:translate="true" >Be cursed for disturbing Tutoxyd's peace -- may your legs no longer be under your control!</el:english>
+      </el:string>
+      <el:string el:key="trapped">
+        <el:english el:translate="true" >Trapped?   Either wait for a stupid tourist willing to exchange positions with you by using a magic ring - or press Shift F3</el:english>
+      </el:string>
+      <el:string el:key="mailbox">
+        <el:english el:translate="true" >Private Property! This claim belongs to Mr. Whiteoil. In case of absence please send a letter.</el:english>
+      </el:string>
+      <el:string el:key="invoice">
+        <el:english el:translate="true" >Invoice -- 40 marbleons for 20 barrels of oil.</el:english>
+      </el:string>
+      <el:string el:key="holy">
+        <el:english el:translate="true" >Welcome stranger -- have a look at our holy stone. It is said that it shows everyone his personal fortune color. As all visitors tried to touch it, we had to set up some protection.</el:english>
+      </el:string>
+      <el:string el:key="fire">
+        <el:english el:translate="true" >May I ask for a donation. Just a few bugs - throw the donation into the holy fire. Tutoxyd will be grateful.</el:english>
+      </el:string>
+      <el:string el:key="research">
+        <el:english el:translate="true" >Mr. Whiteoil, we finished our library reserach. Enighomatep reports that 4 keys are required. One key got lost immediately after sealing the pyramid. One is hidden at the border of the pyramid. For the others you have to demonstrate boldness and cleverness.</el:english>
+      </el:string>
+      <el:string el:key="death">
+        <el:english el:translate="true" >Facing Death you can walk without fear.</el:english>
+      </el:string>
+      <el:string el:key="noitem">
+        <el:english el:translate="true" >Sorry, the useful item that was hidden here has been stolen.</el:english>
+      </el:string>
+      <el:string el:key="thieves">
+        <el:english el:translate="true" >Tomb raiders are cursed to be frozen in stone or floor for all eternity.     Have a look at all these little funny sticks that they used to fight the curses.</el:english>
+      </el:string>
+      <el:string el:key="puzzle">
+        <el:english el:translate="true" >Remove all parts of the memorial plate before conjuring up Tutoxyd.</el:english>
+      </el:string>
+      <el:string el:key="children">
+        <el:english el:translate="true" >Who dares to dirsturb my peace? Stranger - you have proven to be honorable. Bring back my children for a joint meditation. But beware that upon seeing me they may want to join me instead of meditate. I make you responsible for the security of my children.</el:english>
+      </el:string>
+      <el:string el:key="bye">
+        <el:english el:translate="true" >You are bringing back my children. As soon as they come to rest, I will deliver you from Enighomathep's curses so you may seek your next adventure.</el:english>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_viii/ral21_2.xml
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native



