<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1469 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/stones
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2009-January/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1469%20-%20in%20trunk%3A%20data%20data/gfx32%20data/gfx40%0A%09data/gfx48%20data/schemas%20src%20src/stones&In-Reply-To=%3C200901192356.n0JNuLWJ017193%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000897.html">
   <LINK REL="Next"  HREF="000899.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1469 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/stones</H1>
    <B>ral at BerliOS</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1469%20-%20in%20trunk%3A%20data%20data/gfx32%20data/gfx40%0A%09data/gfx48%20data/schemas%20src%20src/stones&In-Reply-To=%3C200901192356.n0JNuLWJ017193%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1469 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/stones">ral at mail.berlios.de
       </A><BR>
    <I>Tue Jan 20 00:56:21 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000897.html">[Enigma-game-svn] r1468 - feature_branches/hp_lotm/input/articles
</A></li>
        <LI>Next message: <A HREF="000899.html">[Enigma-game-svn] r1470 - in homepage: images/articles images/lotm	input input/articles input/lotm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#898">[ date ]</a>
              <a href="thread.html#898">[ thread ]</a>
              <a href="subject.html#898">[ subject ]</a>
              <a href="author.html#898">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ral
Date: 2009-01-20 00:56:16 +0100 (Tue, 20 Jan 2009)
New Revision: 1469

Added:
   trunk/data/gfx32/sh_grate_cross.png
   trunk/data/gfx32/sh_grate_framed.png
   trunk/data/gfx32/st_blur_cross.png
   trunk/data/gfx32/st_blur_straight.png
   trunk/data/gfx32/st_grate_cross.png
   trunk/data/gfx32/st_grate_framed.png
   trunk/data/gfx40/sh_grate_cross.png
   trunk/data/gfx40/sh_grate_framed.png
   trunk/data/gfx40/st_blur_cross.png
   trunk/data/gfx40/st_blur_straight.png
   trunk/data/gfx40/st_grate_cross.png
   trunk/data/gfx40/st_grate_framed.png
   trunk/data/gfx48/sh_grate_cross.png
   trunk/data/gfx48/sh_grate_framed.png
   trunk/data/gfx48/st_blur_cross.png
   trunk/data/gfx48/st_blur_straight.png
   trunk/data/gfx48/st_grate_cross.png
   trunk/data/gfx48/st_grate_framed.png
Removed:
   trunk/data/gfx32/sh-grate1.png
   trunk/data/gfx32/sh-grate2.png
   trunk/data/gfx32/st-grate1.png
   trunk/data/gfx32/st-grate2.png
   trunk/data/gfx32/st-yinyang1.png
   trunk/data/gfx32/st-yinyang2.png
   trunk/data/gfx40/sh-grate1.png
   trunk/data/gfx40/sh-grate2.png
   trunk/data/gfx40/st-grate1.png
   trunk/data/gfx40/st-grate2.png
   trunk/data/gfx40/st-yinyang1.png
   trunk/data/gfx40/st-yinyang2.png
   trunk/data/gfx48/sh-grate1.png
   trunk/data/gfx48/sh-grate2.png
   trunk/data/gfx48/st-grate1.png
   trunk/data/gfx48/st-grate2.png
   trunk/data/gfx48/st-yinyang1.png
   trunk/data/gfx48/st-yinyang2.png
Modified:
   trunk/data/api1init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.cc
   trunk/src/stones/SimpleStones.cc
   trunk/src/stones/SimpleStones.hh
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering
- reengineering st-yinyang:
  - st-yinyang1 -&gt; st_blur_cross
  - st-yinyang2 -&gt; st_blur_straight
  - st-yinyang3 -&gt; st_blur_magic
  - attribute flavor with type name &quot;cross&quot;, &quot;straight&quot;, &quot;magic&quot;
  - new graphic indicating color change instead of player change
- reengineering grates:
  - st-grate1 -&gt; st_grate_cross
  - st-grate2 -&gt; st_grate_framed
  - attribute flavor with type name &quot;cross&quot;, &quot;framed&quot;
 

Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2009-01-19 23:50:36 UTC (rev 1468)
+++ trunk/data/api1init.lua	2009-01-19 23:56:16 UTC (rev 1469)
@@ -217,6 +217,9 @@
     st_bluesand_new = &quot;st-bigbluesand-new&quot;,
     st_bluesand_nes = &quot;st-bigbluesand-nes&quot;,
     st_bluesand_nesw = &quot;st-bigbluesand-nesw&quot;,
+    st_blur_cross = &quot;st-yinyang1&quot;,
+    st_blur_magic = &quot;st-yinyang3&quot;,
+    st_blur_straight = &quot;st-yinyang2&quot;,
     st_boulder = &quot;st-bolder&quot;,
     st_boulder_n = &quot;st-bolder-n&quot;,
     st_boulder_e = &quot;st-bolder-e&quot;,
@@ -290,6 +293,8 @@
     st_granite = &quot;st-rock1&quot;,
     st_granite_hollow = &quot;st-rock1_hole&quot;,
     st_granite_movable = &quot;st-rock1_move&quot;,
+    st_grate_cross = &quot;st-grate1&quot;,
+    st_grate_framed = &quot;st-grate2&quot;,
     st_greenbrown = &quot;st-greenbrown&quot;,
     st_greenbrown_hollow = &quot;st-greenbrown_hole&quot;,
     st_greenbrown_movable = &quot;st-greenbrown_move&quot;,
@@ -1018,8 +1023,7 @@
     st_mirror__trigger = &quot;turn&quot;,
     st_oxyd__trigger = &quot;open&quot;,
     st_passage__trigger = &quot;signal&quot;,
-    [&quot;st-plain__trigger&quot;] = &quot;signal&quot;,
-    [&quot;st-plain_hole__trigger&quot;] = &quot;signal&quot;,
+    st_flat__trigger = &quot;signal&quot;,
     st_polarswitch__onoff = &quot;toggle&quot;,
     st_quake__trigger = &quot;toggle&quot;,
     st_stoneimpulse__trigger = &quot;signal&quot;,

Deleted: trunk/data/gfx32/sh-grate1.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/sh-grate2.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/sh_grate_cross.png (from rev 1465, trunk/data/gfx32/sh-grate1.png)

Copied: trunk/data/gfx32/sh_grate_framed.png (from rev 1465, trunk/data/gfx32/sh-grate2.png)

Deleted: trunk/data/gfx32/st-grate1.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-grate2.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-yinyang1.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-yinyang2.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx32/st_blur_cross.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st_blur_cross.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Copied: trunk/data/gfx32/st_blur_straight.png (from rev 1465, trunk/data/gfx32/st-yinyang2.png)

Copied: trunk/data/gfx32/st_grate_cross.png (from rev 1465, trunk/data/gfx32/st-grate1.png)

Copied: trunk/data/gfx32/st_grate_framed.png (from rev 1465, trunk/data/gfx32/st-grate2.png)

Deleted: trunk/data/gfx40/sh-grate1.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/sh-grate2.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/sh_grate_cross.png (from rev 1465, trunk/data/gfx40/sh-grate1.png)

Copied: trunk/data/gfx40/sh_grate_framed.png (from rev 1465, trunk/data/gfx40/sh-grate2.png)

Deleted: trunk/data/gfx40/st-grate1.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-grate2.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-yinyang1.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-yinyang2.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx40/st_blur_cross.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st_blur_cross.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Copied: trunk/data/gfx40/st_blur_straight.png (from rev 1465, trunk/data/gfx40/st-yinyang2.png)

Copied: trunk/data/gfx40/st_grate_cross.png (from rev 1465, trunk/data/gfx40/st-grate1.png)

Copied: trunk/data/gfx40/st_grate_framed.png (from rev 1465, trunk/data/gfx40/st-grate2.png)

Deleted: trunk/data/gfx48/sh-grate1.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/sh-grate2.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/sh_grate_cross.png (from rev 1465, trunk/data/gfx48/sh-grate1.png)

Copied: trunk/data/gfx48/sh_grate_framed.png (from rev 1465, trunk/data/gfx48/sh-grate2.png)

Deleted: trunk/data/gfx48/st-grate1.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-grate2.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-yinyang1.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-yinyang2.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx48/st_blur_cross.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st_blur_cross.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Copied: trunk/data/gfx48/st_blur_straight.png (from rev 1465, trunk/data/gfx48/st-yinyang2.png)

Copied: trunk/data/gfx48/st_grate_cross.png (from rev 1465, trunk/data/gfx48/st-grate1.png)

Copied: trunk/data/gfx48/st_grate_framed.png (from rev 1465, trunk/data/gfx48/st-grate2.png)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2009-01-19 23:50:36 UTC (rev 1468)
+++ trunk/data/models-2d.lua	2009-01-19 23:56:16 UTC (rev 1469)
@@ -725,8 +725,8 @@
     DefImage(&quot;sh-solid&quot;)
     DefImage(&quot;sh-round&quot;)
     DefImage(&quot;sh-round2&quot;)
-    DefImage(&quot;sh-grate1&quot;)
-    DefImage(&quot;sh-grate2&quot;)
+    DefImage(&quot;sh_grate_cross&quot;)
+    DefImage(&quot;sh_grate_framed&quot;)
     DefImage(&quot;sh-grate3&quot;)
     DefImage(&quot;sh-glass&quot;)
     DefImage(&quot;sh-white4&quot;)
@@ -764,8 +764,8 @@
     DefStone(&quot;st_lightglass&quot;, &quot;sh-glass&quot;)
     DefStone(&quot;st_darkglass&quot;, &quot;sh-glass&quot;)
     DefStone(&quot;st_redfiber&quot;, &quot;sh-glass&quot;)
-    DefStone(&quot;st-grate1&quot;, &quot;sh-grate1&quot;)
-    DefStone(&quot;st-grate2&quot;, &quot;sh-grate2&quot;)
+    DefStone(&quot;st_grate_cross&quot;, &quot;sh_grate_cross&quot;)
+    DefStone(&quot;st_grate_framed&quot;, &quot;sh_grate_framed&quot;)
     DefStone(&quot;st-grate3&quot;, &quot;sh-grate3&quot;)
     DefStone(&quot;st_greenbrown&quot;, &quot;sh-round&quot;)
     DefStone(&quot;st-key0&quot;, &quot;sh-round&quot;, {filename=&quot;st-key1&quot;})
@@ -796,8 +796,8 @@
     DefStone(&quot;st-whiteballs&quot;)
     DefStone(&quot;st_woven&quot;)
     DefStone(&quot;st_yellow&quot;)
-    DefStone(&quot;st-yinyang1&quot;)
-    DefStone(&quot;st-yinyang2&quot;)
+    DefStone(&quot;st_blur_straight&quot;)
+    DefStone(&quot;st_blur_cross&quot;)
 end
 
 ---------------------
@@ -1574,7 +1574,7 @@
 
 -- st-door_a --
 do
-    DefAlias(&quot;st-door_a-open&quot;, &quot;st-grate1&quot;)
+    DefAlias(&quot;st-door_a-open&quot;, &quot;st_grate_cross&quot;)
     DefAlias(&quot;st-door_a-closed&quot;, &quot;st-oxyda&quot;)
     local f = BuildFrames({&quot;st-door_a-closed&quot;, &quot;st-door_a-open&quot;},60)
     DefAnim(&quot;st-door_a-opening&quot;, f)
@@ -1593,7 +1593,7 @@
 
 -- st-door_c --
 do
-    DefAlias(&quot;st-door_c-open&quot;, &quot;st-grate2&quot;)
+    DefAlias(&quot;st-door_c-open&quot;, &quot;st_grate_framed&quot;)
     DefAlias(&quot;st-door_c-closed&quot;, &quot;st_flat&quot;)
     frames=BuildFrames({&quot;st-door_c-closed&quot;,&quot;st-door_c-open&quot;},60)
     DefAnim(&quot;st-door_c-opening&quot;, frames)
@@ -1750,7 +1750,7 @@
     DefAlias(&quot;st-glass_move&quot;, &quot;st-glass&quot;);
     DefAlias(&quot;st-laserbreak&quot;, &quot;st_flat&quot;)
     DefAlias(&quot;st-laserbreak-anim&quot;, &quot;st_flat_breaking&quot;)
-    DefAlias(&quot;st-yinyang3&quot;, &quot;st-yinyang1&quot;)
+    DefAlias(&quot;st_blur_magic&quot;, &quot;st_blur_cross&quot;)
 end
 
 -- Invisible stones --

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2009-01-19 23:50:36 UTC (rev 1468)
+++ trunk/data/schemas/objects.xml	2009-01-19 23:56:16 UTC (rev 1469)
@@ -759,6 +759,18 @@
     &lt;object name=&quot;st_bluesand_nesw&quot;&gt;
       &lt;attr name=&quot;connections&quot; value=&quot;nesw&quot;/&gt;
     &lt;/object&gt;
+    &lt;object name=&quot;st_blur&quot;&gt;
+      &lt;attr name=&quot;flavor&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_blur_cross&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;cross&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_blur_magic&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;magic&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_blur_straight&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;straight&quot;/&gt;
+    &lt;/object&gt;
     &lt;object name=&quot;st_boulder&quot;&gt;
       &lt;attr name=&quot;counterclock&quot;/&gt;
       &lt;attr name=&quot;orientation&quot;/&gt;
@@ -1026,6 +1038,15 @@
     &lt;object name=&quot;st_granite_movable&quot;&gt;
       &lt;attr name=&quot;movable&quot; value=&quot;true&quot;/&gt;
     &lt;/object&gt;
+    &lt;object name=&quot;st_grate&quot;&gt;
+      &lt;attr name=&quot;flavor&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_grate_cross&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;cross&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_grate_framed&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;framed&quot;/&gt;
+    &lt;/object&gt;
     &lt;object name=&quot;st_greenbrown&quot;&gt;
       &lt;attr name=&quot;hollow&quot; rw=&quot;r&quot;/&gt;
     &lt;/object&gt;

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2009-01-19 23:50:36 UTC (rev 1468)
+++ trunk/src/ox_extra.cc	2009-01-19 23:56:16 UTC (rev 1469)
@@ -138,9 +138,9 @@
     &quot;st_purplemarble&quot;,   // OxydExtra stone 0x13
     UNUSED,              // OxydExtra stone 0x14
     &quot;st_tigris&quot;,         // OxydExtra stone 0x15
-    &quot;st-rock7&quot;,          // OxydExtra stone 0x16
+    &quot;st_greengray&quot;,      // OxydExtra stone 0x16
     UNUSED,              // OxydExtra stone 0x17
-    &quot;st-grate1&quot;,         // OxydExtra stone 0x18
+    &quot;st_grate_cross&quot;,    // OxydExtra stone 0x18
     UNUSED,              // OxydExtra stone 0x19
     UNUSED,              // OxydExtra stone 0x1a
     UNUSED,              // OxydExtra stone 0x1b

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2009-01-19 23:50:36 UTC (rev 1468)
+++ trunk/src/ox_magnum.cc	2009-01-19 23:56:16 UTC (rev 1469)
@@ -142,8 +142,8 @@
     UNUSED,                     // OxydMagnum stone 0x17
     UNUSED,                     // OxydMagnum stone 0x18
     &quot;st_lightglass_hollow&quot;,     // OxydMagnum stone 0x19
-    &quot;st-grate1&quot;,                // OxydMagnum stone 0x1a
-    &quot;st-grate2&quot;,                // OxydMagnum stone 0x1b
+    &quot;st_grate_cross&quot;,           // OxydMagnum stone 0x1a
+    &quot;st_grate_framed&quot;,          // OxydMagnum stone 0x1b
     &quot;st-bug&quot;,                   // OxydMagnum stone 0x1c
     UNUSED,                     // OxydMagnum stone 0x1d
     UNUSED,                     // OxydMagnum stone 0x1e
@@ -258,12 +258,12 @@
     &quot;st_purplegray&quot;,            // OxydMagnum stone 0x8b
     &quot;st_passage_white_square&quot;,  // OxydMagnum stone 0x8c
     &quot;st_passage_black_square&quot;,  // OxydMagnum stone 0x8d
-    &quot;st-yinyang2&quot;,              // OxydMagnum stone 0x8e
+    &quot;st_blur_straight&quot;,         // OxydMagnum stone 0x8e
     UNUSED,                     // OxydMagnum stone 0x8f
     &quot;st_redrock&quot;,               // OxydMagnum stone 0x90 (Level 89 only)
     UNUSED,                     // OxydMagnum stone 0x91
     &quot;st_fourswitch&quot;,            // OxydMagnum stone 0x92 (Level 51 only)
-    &quot;st-yinyang1&quot;,              // OxydMagnum stone 0x93
+    &quot;st_blur_cross&quot;,            // OxydMagnum stone 0x93
     &quot;st-break_acwhite&quot;,         // OxydMagnum stone 0x94
     &quot;st-break_acblack&quot;,         // OxydMagnum stone 0x95
     &quot;st_charge_plus&quot;,           // OxydMagnum stone 0x96

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2009-01-19 23:50:36 UTC (rev 1468)
+++ trunk/src/ox_oxyd1.cc	2009-01-19 23:56:16 UTC (rev 1469)
@@ -174,8 +174,8 @@
     &quot;st_flat_hollow&quot;,           // Oxyd1 stone 0x17
     &quot;st-oxyd-0x18&quot;,             // Oxyd1 stone 0x18
     &quot;st_door_c_open&quot;,           // Oxyd1 stone 0x19
-    &quot;st-grate1&quot;,                // Oxyd1 stone 0x1a
-    &quot;st-grate2&quot;,                // Oxyd1 stone 0x1b
+    &quot;st_grate_cross&quot;,           // Oxyd1 stone 0x1a
+    &quot;st_grate_framed&quot;,          // Oxyd1 stone 0x1b
     &quot;st-bug&quot;,                   // Oxyd1 stone 0x1c
     &quot;st-surprise&quot;,              // Oxyd1 stone 0x1d
     &quot;st-chameleon&quot;,             // Oxyd1 stone 0x1e
@@ -290,12 +290,12 @@
     &quot;st_bluesand&quot;,              // Oxyd1 stone 0x8b
     &quot;st_passage_white_square&quot;,  // Oxyd1 stone 0x8c
     &quot;st_passage_black_square&quot;,  // Oxyd1 stone 0x8d
-    &quot;st-yinyang2&quot;,              // Oxyd1 stone 0x8e
+    &quot;st_blur_straight&quot;,         // Oxyd1 stone 0x8e
     UNUSED,                     // Oxyd1 stone 0x8f
     &quot;st-whiteballs&quot;,            // Oxyd1 stone 0x90
     &quot;st-blackballs&quot;,            // Oxyd1 stone 0x91
     &quot;st_fourswitch&quot;,            // Oxyd1 stone 0x92
-    &quot;st-yinyang1&quot;,              // Oxyd1 stone 0x93
+    &quot;st_blur_cross&quot;,            // Oxyd1 stone 0x93
     &quot;st-break_acwhite&quot;,         // Oxyd1 stone 0x94
     &quot;st-break_acblack&quot;,         // Oxyd1 stone 0x95
     &quot;st_charge_plus&quot;,           // Oxyd1 stone 0x96

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2009-01-19 23:50:36 UTC (rev 1468)
+++ trunk/src/ox_peroxyd.cc	2009-01-19 23:56:16 UTC (rev 1469)
@@ -212,7 +212,7 @@
     &quot;st_tigris&quot;,                // PerOxyd stone 0x15
     &quot;st_greengray&quot;,             // PerOxyd stone 0x16
     &quot;st-white1&quot;,                // PerOxyd stone 0x17 (Looks a little bit different, but function should be the same.)
-    &quot;st-grate1&quot;,                // PerOxyd stone 0x18
+    &quot;st_grate_cross&quot;,           // PerOxyd stone 0x18
     UNUSED,                     // PerOxyd stone 0x19
     &quot;st-surprise&quot;,              // PerOxyd stone 0x1a
     &quot;st-chameleon&quot;,             // PerOxyd stone 0x1b (levels: 23 142 178 183)
@@ -313,7 +313,7 @@
     &quot;st_passage_black_square&quot;,  // PerOxyd stone 0x7a (Can be either st-black1 or st-black4)
     &quot;st_metal_hollow&quot;,          // PerOxyd stone 0x7b (because it looks similar ...; only link level 79)
     0,                          // PerOxyd stone 0x7c (probably complex stone, behavior unknown)(only levels: 23 142, these levels are identical!)
-    &quot;st-yinyang3&quot;,              // PerOxyd stone 0x7d
+    &quot;st_blur_magic&quot;,            // PerOxyd stone 0x7d
     &quot;st-break_acwhite&quot;,         // PerOxyd stone 0x7e
     &quot;st-break_acblack&quot;,         // PerOxyd stone 0x7f
     &quot;st_charge_plus&quot;,           // PerOxyd stone 0x80

Modified: trunk/src/stones/SimpleStones.cc
===================================================================
--- trunk/src/stones/SimpleStones.cc	2009-01-19 23:50:36 UTC (rev 1468)
+++ trunk/src/stones/SimpleStones.cc	2009-01-19 23:56:16 UTC (rev 1469)
@@ -22,13 +22,65 @@
 #include &quot;stones/SimpleStones.hh&quot;
 #include &quot;errors.hh&quot;
 //#include &quot;main.hh&quot;
+#include &quot;player.hh&quot;
+#include &quot;server.hh&quot;
 #include &quot;world.hh&quot;
 
 namespace enigma {
 
+/* -------------------- Blur stone -------------------- */
+    BlurStone::BlurStone(int type) : Stone (&quot;st_blur&quot;) {
+        state = type;
+    }
+    
+    std::string BlurStone::getClass() const {
+        return &quot;st_blur&quot;;
+    }
+
+    void BlurStone::setAttr(const string&amp; key, const Value &amp;val) {
+        if (key == &quot;flavor&quot; &amp;&amp; isDisplayable()) {
+            std::string fs = val.to_string();
+            if (fs == &quot;straight&quot;) state = STRAIGHT;
+            else if (fs == &quot;cross&quot;) state = CROSS;
+            else if (fs == &quot;magic&quot;) state = MAGIC;
+            else ASSERT(false, XLevelRuntime, ecl::strf(&quot;Blur stone set known flavor%s&quot;, fs.c_str()).c_str());
+            return; 
+        } else
+            Stone::setAttr(key, val);
+    }
+
+    Value BlurStone::getAttr(const std::string &amp;key) const {
+        if (key == &quot;flavor&quot;) {             // used by validator to identify charge stone subkinds
+            return (state == STRAIGHT) ? &quot;straight&quot; : (state == CROSS ? &quot;cross&quot; : &quot;magic&quot;); 
+        } else
+            return Stone::getAttr(key);
+    }
+    
+    void BlurStone::setState(int extState) {
+        // block any calls
+    }
+
+    void BlurStone::init_model() {
+        set_model(state == STRAIGHT ? &quot;st_blur_straight&quot; : &quot;st_blur_cross&quot;);
+    }
+    
+    void BlurStone::actor_hit(const StoneContact &amp;sc) {
+        Value color = sc.actor-&gt;getAttr(&quot;color&quot;);
+        if (state != MAGIC || player::WieldedItemIs (sc.actor, &quot;it_magicwand&quot;) 
+                || player::WieldedItemIs (sc.actor, &quot;it_brush&quot;)) {
+            if (color &amp;&amp; ((state == STRAIGHT &amp;&amp; color == WHITE) || (state &gt;= CROSS &amp;&amp; color == BLACK))) {
+                sound_event(&quot;yinyang&quot;);
+                transform(&quot;st_passage_white_square&quot;);
+            } else if (color &amp;&amp; ((state == STRAIGHT &amp;&amp; color == BLACK) || (state &gt;= CROSS &amp;&amp; color == WHITE))) {
+                sound_event(&quot;yinyang&quot;);
+                transform(&quot;st_passage_black_square&quot;);
+            }
+        }
+    }
+
 /* -------------------- Charge stone -------------------- */
 
-    ChargeStone::ChargeStone(double charge) : Stone(&quot;st_charge&quot;) {
+    ChargeStone::ChargeStone(double charge) : Stone (&quot;st_charge&quot;) {
         Stone::setAttr(&quot;charge&quot;, charge);
     }
     
@@ -88,13 +140,70 @@
             other-&gt;add_force (distortedVelocity(sc.actor-&gt;get_vel(), 20));
         }
     }
+
+/* -------------------- Grate stone -------------------- */
+    GrateStone::GrateStone(int type) : Stone (&quot;st_grate&quot;) {
+        state = type;
+    }
     
+    std::string GrateStone::getClass() const {
+        return &quot;st_grate&quot;;
+    }
+
+    void GrateStone::setAttr(const string&amp; key, const Value &amp;val) {
+        if (key == &quot;flavor&quot; &amp;&amp; isDisplayable()) {
+            std::string fs = val.to_string();
+            if (fs == &quot;cross&quot;) state = CROSS;
+            else if (fs == &quot;framed&quot;) state = FRAMED;
+            else ASSERT(false, XLevelRuntime, ecl::strf(&quot;Grate stone set known flavor%s&quot;, fs.c_str()).c_str());
+            return; 
+        } else
+            Stone::setAttr(key, val);
+    }
+
+    Value GrateStone::getAttr(const std::string &amp;key) const {
+        if (key == &quot;flavor&quot;) {             // used by validator to identify charge stone subkinds
+            return (state == CROSS) ? &quot;cross&quot; : &quot;framed&quot;; 
+        } else
+            return Stone::getAttr(key);
+    }
+    
+    void GrateStone::setState(int extState) {
+        // block any calls
+    }
+
+    void GrateStone::init_model() {
+        set_model(state == CROSS ? &quot;st_grate_cross&quot; : &quot;st_grate_framed&quot;);
+    }
+    
+    bool GrateStone::is_floating() const {
+        return true;
+    }
+    
+    bool GrateStone::is_transparent(Direction) const {
+        return true;
+    }
+    
+    StoneResponse GrateStone::collision_response(const StoneContact &amp;sc) {
+        if (server::GameCompatibility == GAMET_OXYD1) {
+            return STONE_PASS;
+        } else
+            return sc.actor-&gt;is_on_floor() ? STONE_PASS : STONE_REBOUND;
+    }
+    
     BOOT_REGISTER_START
+        BootRegister(new BlurStone(0), &quot;st_blur&quot;);
+        BootRegister(new BlurStone(0), &quot;st_blur_straight&quot;);
+        BootRegister(new BlurStone(1), &quot;st_blur_cross&quot;);
+        BootRegister(new BlurStone(2), &quot;st_blur_magic&quot;);
         BootRegister(new ChargeStone(0.0), &quot;st_charge&quot;);
         BootRegister(new ChargeStone(0.0), &quot;st_charge_zero&quot;);
         BootRegister(new ChargeStone(1.0), &quot;st_charge_plus&quot;);
         BootRegister(new ChargeStone(-1.0), &quot;st_charge_minus&quot;);
         BootRegister(new FlashStone(), &quot;st_flash&quot;);
+        BootRegister(new GrateStone(0), &quot;st_grate&quot;);
+        BootRegister(new GrateStone(0), &quot;st_grate_cross&quot;);
+        BootRegister(new GrateStone(1), &quot;st_grate_framed&quot;);
     BOOT_REGISTER_END
 
 } // namespace enigma

Modified: trunk/src/stones/SimpleStones.hh
===================================================================
--- trunk/src/stones/SimpleStones.hh	2009-01-19 23:50:36 UTC (rev 1468)
+++ trunk/src/stones/SimpleStones.hh	2009-01-19 23:56:16 UTC (rev 1469)
@@ -27,6 +27,35 @@
 namespace enigma {
 
     /** 
+     * BlurStone (old YinYang)
+     */
+    class BlurStone : public Stone {
+        CLONEOBJ(BlurStone);
+    private:
+        enum iState {
+            STRAIGHT,   ///&lt;  encoded flavor 
+            CROSS,      ///&lt; 
+            MAGIC      ///&lt; 
+        };
+    public:
+        BlurStone(int type);
+        
+         // Object interface
+        virtual std::string getClass() const;        
+        virtual void setAttr(const string&amp; key, const Value &amp;val);
+        virtual Value getAttr(const std::string &amp;key) const;
+        
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        
+        // Stone interface
+        virtual void actor_hit(const StoneContact &amp;sc);
+    };
+    
+    /** 
      * ChargeStone
      */
     class ChargeStone : public Stone {
@@ -64,9 +93,40 @@
         virtual std::string getClass() const;
 
         // Stone interface
-        virtual void actor_hit (const StoneContact &amp;sc);
+        virtual void actor_hit(const StoneContact &amp;sc);
     };
 
+    /** 
+     * GrateStone
+     */
+    class GrateStone : public Stone {
+        CLONEOBJ(GrateStone);
+
+    private:
+        enum iState {
+            CROSS,      ///&lt; 
+            FRAMED      ///&lt; 
+        };
+    public:
+        GrateStone(int type);
+        
+         // Object interface
+        virtual std::string getClass() const;        
+        virtual void setAttr(const string&amp; key, const Value &amp;val);
+        virtual Value getAttr(const std::string &amp;key) const;
+        
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+
+        // Stone interface
+        virtual bool is_floating() const;
+        virtual bool is_transparent(Direction d) const;
+        virtual StoneResponse collision_response(const StoneContact &amp;sc);
+    };
+
 } // namespace enigma
 
 #endif /*SIMPLESTONES_HH*/

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2009-01-19 23:50:36 UTC (rev 1468)
+++ trunk/src/stones.cc	2009-01-19 23:56:16 UTC (rev 1469)
@@ -419,7 +419,7 @@
 
         void actor_hit (const StoneContact &amp;) {
             static const char *stonename[] = {
-                &quot;st-grate1&quot;,
+                &quot;st_grate_cross&quot;,
                 &quot;st_death&quot;,
                 &quot;st-surprise&quot;,
                 &quot;st_lightglass_hollow&quot;,

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2009-01-19 23:50:36 UTC (rev 1468)
+++ trunk/src/stones_simple.cc	2009-01-19 23:56:16 UTC (rev 1469)
@@ -309,18 +309,6 @@
         }
     };
 
-    class Grate1 : public GrateBase {
-        CLONEOBJ(Grate1);
-    public:
-        Grate1() : GrateBase(&quot;st-grate1&quot;) {}
-    };
-
-    class Grate2 : public GrateBase {
-        CLONEOBJ(Grate2);
-    public:
-        Grate2() : GrateBase(&quot;st-grate2&quot;) {}
-    };
-
     /*! Horses and small marbles can move through this stone, but
       normal marbles can't. */
     class Grate3 : public GrateBase {
@@ -547,57 +535,7 @@
     DEF_TRAITSM(Break_bolder, &quot;st-break_bolder&quot;, st_break_bolder, MOVABLE_BREAKABLE);
 }
 
-//----------------------------------------
-// Stone_movebreak
-//----------------------------------------
 
-/** \page st-rock3_movebreak Breakable Movable Stone
-
-This stone can be destroyed by an actor having a
-hammer and by laser, dynamite, bombs and bombstones.
-
-\subsection stone_breake Example
-\verbatim
-set_stone(&quot;st-rock3_movebreak&quot;, 10,10)
-\endverbatim
-
-\image html st-rock3.png
-*/
-namespace
-{
-    class Stone_movebreak : public BreakableStone {
-        CLONEOBJ(Stone_movebreak);
-        DECL_TRAITS;
-    public:
-        Stone_movebreak()
-        {}
-
-        void processLight(Direction d) {
-        }
-
-        string get_break_anim() const  {
-            return &quot;st-rock3_break-anim&quot;;
-        }
-        bool may_be_broken_by(Actor *a) const {
-            return player::WieldedItemIs (a, &quot;it_hammer&quot;);
-        }
-
-        void actor_hit(const StoneContact &amp;sc) {
-            if (may_be_broken_by(sc.actor))
-                break_me();
-//             else
-//                 maybe_push_stone (sc);
-        }
-        void on_impulse(const Impulse&amp; impulse) {
-            move_stone(impulse.dir);
-        }
-
-    private:
-        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_NO_STONE; }
-    };
-    DEF_TRAITSM(Stone_movebreak, &quot;st-rock3_movebreak&quot;, st_movebreak, MOVABLE_IRREGULAR);
-}
-
 //----------------------------------------
 // Break_acwhite
 //----------------------------------------
@@ -943,75 +881,6 @@
     return Stone::message(m);
 }
 
-/* -------------------- YinYang stones -------------------- */
-namespace
-{
-    class YinYangStone : public Stone {
-    public:
-        YinYangStone(const char *kind) : Stone(kind)
-        {}
-
-    protected:
-        void turn_white(const char *stonename = &quot;st_passage_white_square&quot;) {
-            sound_event(&quot;yinyang&quot;);
-            ReplaceStone (get_pos(), MakeStone(stonename));
-        }
-        void turn_black(const char *stonename = &quot;st_passage_black_square&quot;) {
-            sound_event(&quot;yinyang&quot;);
-            ReplaceStone (get_pos(), MakeStone(stonename));
-        }
-        
-        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_HOLLOW; }
-    };
-
-    class YinYangStone1 : public YinYangStone {
-        CLONEOBJ(YinYangStone1);
-    public:
-        YinYangStone1() : YinYangStone(&quot;st-yinyang1&quot;) {}
-
-    private:
-        void actor_hit(const StoneContact &amp;sc) {
-            Value color = sc.actor-&gt;getAttr(&quot;color&quot;);
-            if      (color &amp;&amp; color == BLACK) turn_white();
-            else if (color &amp;&amp; color == WHITE) turn_black();
-        }
-    };
-
-    class YinYangStone2 : public YinYangStone {
-        CLONEOBJ(YinYangStone2);
-    public:
-        YinYangStone2() : YinYangStone(&quot;st-yinyang2&quot;) {}
-    private:
-        void actor_hit(const StoneContact &amp;sc) {
-            Value color = sc.actor-&gt;getAttr(&quot;color&quot;);
-            if      (color &amp;&amp; color == BLACK) turn_black();
-            else if (color &amp;&amp; color == WHITE) turn_white();
-        }
-    };
-
-
-    /*! A Per.Oxyd compatible YinYang stone that must be activated
-      with a magic wand or a brush. */
-    class YinYangStone3 : public YinYangStone {
-        CLONEOBJ(YinYangStone3);
-    public:
-        YinYangStone3() : YinYangStone(&quot;st-yinyang3&quot;) {}
-    private:
-        void actor_hit(const StoneContact &amp;sc) {
-            if (player::WieldedItemIs (sc.actor, &quot;it_magicwand&quot;) ||
-                player::WieldedItemIs (sc.actor, &quot;it_brush&quot;))
-            {
-                Value color = sc.actor-&gt;getAttr(&quot;color&quot;);
-                if      (color &amp;&amp; color == BLACK) 
-                    turn_white(&quot;st_passage_white_square&quot;);
-                else if (color &amp;&amp; color == WHITE) 
-                    turn_black(&quot;st_passage_black_square&quot;);
-            }
-        }
-    };
-}
-
-
 /* -------------------- BombStone -------------------- */
 
 namespace
@@ -1135,21 +1004,14 @@
 
     Register(new DummyStone);
     Register(new EasyModeStone);
-    Register(new Grate1);
-    Register(new Grate2);
     Register(new Grate3);
     Register(new InvisibleMagic);
     Register(new LaserBreakable);
     Register(new MagicStone);
     Register(new Stone_break(&quot;st-stone_break&quot;));
     Register(new Stone_break(&quot;st-break_gray&quot;));
-    Register(new Stone_movebreak);
     Register(new Stonebrush);
     Register(new ThiefStone);
-
-    Register(new YinYangStone1);
-    Register(new YinYangStone2);
-    Register(new YinYangStone3);
 }
 
 } // namespace enigma


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000897.html">[Enigma-game-svn] r1468 - feature_branches/hp_lotm/input/articles
</A></li>
	<LI>Next message: <A HREF="000899.html">[Enigma-game-svn] r1470 - in homepage: images/articles images/lotm	input input/articles input/lotm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#898">[ date ]</a>
              <a href="thread.html#898">[ thread ]</a>
              <a href="subject.html#898">[ subject ]</a>
              <a href="author.html#898">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
