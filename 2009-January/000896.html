<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1467 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/stones
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2009-January/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1467%20-%20in%20trunk%3A%20data%20data/gfx32%20data/gfx40%0A%09data/gfx48%20data/schemas%20src%20src/stones&In-Reply-To=%3C200901192123.n0JLNgkf007906%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000895.html">
   <LINK REL="Next"  HREF="000897.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1467 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/stones</H1>
    <B>ral at BerliOS</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1467%20-%20in%20trunk%3A%20data%20data/gfx32%20data/gfx40%0A%09data/gfx48%20data/schemas%20src%20src/stones&In-Reply-To=%3C200901192123.n0JLNgkf007906%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1467 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/stones">ral at mail.berlios.de
       </A><BR>
    <I>Mon Jan 19 22:23:42 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000895.html">[Enigma-game-svn] r1466 - in feature_branches/hp_lotm/input: .	articles lotm
</A></li>
        <LI>Next message: <A HREF="000897.html">[Enigma-game-svn] r1468 - feature_branches/hp_lotm/input/articles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#896">[ date ]</a>
              <a href="thread.html#896">[ thread ]</a>
              <a href="subject.html#896">[ subject ]</a>
              <a href="author.html#896">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ral
Date: 2009-01-19 22:23:40 +0100 (Mon, 19 Jan 2009)
New Revision: 1467

Added:
   trunk/data/gfx32/st_flat-break.png
   trunk/data/gfx32/st_flat.png
   trunk/data/gfx32/st_flat_cracked.png
   trunk/data/gfx32/st_flat_falling.png
   trunk/data/gfx32/st_flat_fire.png
   trunk/data/gfx40/st_flat-break.png
   trunk/data/gfx40/st_flat.png
   trunk/data/gfx40/st_flat_cracked.png
   trunk/data/gfx40/st_flat_falling.png
   trunk/data/gfx40/st_flat_fire.png
   trunk/data/gfx48/st_flat-break.png
   trunk/data/gfx48/st_flat.png
   trunk/data/gfx48/st_flat_cracked.png
   trunk/data/gfx48/st_flat_falling.png
   trunk/data/gfx48/st_flat_fire.png
   trunk/src/stones/FlatStone.cc
   trunk/src/stones/FlatStone.hh
Removed:
   trunk/data/gfx32/st-firebreak.png
   trunk/data/gfx32/st-rock3-break.png
   trunk/data/gfx32/st-rock3-falling.png
   trunk/data/gfx32/st-rock3.png
   trunk/data/gfx32/st-rock3_cracked.png
   trunk/data/gfx40/st-firebreak.png
   trunk/data/gfx40/st-rock3-break.png
   trunk/data/gfx40/st-rock3-falling.png
   trunk/data/gfx40/st-rock3.png
   trunk/data/gfx40/st-rock3_cracked.png
   trunk/data/gfx48/st-firebreak.png
   trunk/data/gfx48/st-rock3-break.png
   trunk/data/gfx48/st-rock3-falling.png
   trunk/data/gfx48/st-rock3.png
   trunk/data/gfx48/st-rock3_cracked.png
Modified:
   trunk/data/api1init.lua
   trunk/data/gfx40/st-yinyang1.png
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.cc
   trunk/src/stones.hh
   trunk/src/stones/GlassStones.cc
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering
- fix glass stones: actors stuck beneath hollow stones
- fix swamp heat transformation - missing renaming
- reengineering st-plain:
  - st-plain -&gt; st_flat
  - st-plain_hole -&gt; st_flat_hollow
  - st-plain_move -&gt; st_flat_movable
  - st-plain_break -&gt; st_flat_breakable
  - st-plain_cracked -&gt; st_flat_cracked
  - st-firebreak -&gt; st_flat_burnable
  - st-firebreak -&gt;st_flat_moveburnable
  - unify in a single class
  - preserve identity on transformations
  - hollow flat stone gets invisible on glasses


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/data/api1init.lua	2009-01-19 21:23:40 UTC (rev 1467)
@@ -278,6 +278,13 @@
     st_fake_oxydc = &quot;st-likeoxydc&quot;,
     st_fake_oxydd = &quot;st-likeoxydd&quot;,
     st_flash = &quot;st-flash&quot;,
+    st_flat = &quot;st-plain&quot;,
+    st_flat_breakable = &quot;st-plain_break&quot;,
+    st_flat_hollow = &quot;st-plain_hole&quot;,
+    st_flat_movable = &quot;st-plain_move&quot;,
+    st_flat_cracked = &quot;st-plain_cracked&quot;,
+    st_flat_burnable = &quot;st-firebreak&quot;,
+    st_flat_moveburnable = &quot;st-firebreak_move&quot;,
     st_floppy = &quot;st-floppy&quot;,
     st_fourswitch = &quot;st-fourswitch&quot;,
     st_granite = &quot;st-rock1&quot;,

Deleted: trunk/data/gfx32/st-firebreak.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-rock3-break.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-rock3-falling.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-rock3.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-rock3_cracked.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/st_flat-break.png (from rev 1465, trunk/data/gfx32/st-rock3-break.png)

Copied: trunk/data/gfx32/st_flat.png (from rev 1465, trunk/data/gfx32/st-rock3.png)

Copied: trunk/data/gfx32/st_flat_cracked.png (from rev 1465, trunk/data/gfx32/st-rock3_cracked.png)

Added: trunk/data/gfx32/st_flat_falling.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st_flat_falling.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Copied: trunk/data/gfx32/st_flat_fire.png (from rev 1465, trunk/data/gfx32/st-firebreak.png)

Deleted: trunk/data/gfx40/st-firebreak.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-rock3-break.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-rock3-falling.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-rock3.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-rock3_cracked.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/st-yinyang1.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/st_flat-break.png (from rev 1465, trunk/data/gfx40/st-rock3-break.png)

Copied: trunk/data/gfx40/st_flat.png (from rev 1465, trunk/data/gfx40/st-rock3.png)

Copied: trunk/data/gfx40/st_flat_cracked.png (from rev 1465, trunk/data/gfx40/st-rock3_cracked.png)

Added: trunk/data/gfx40/st_flat_falling.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st_flat_falling.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Copied: trunk/data/gfx40/st_flat_fire.png (from rev 1465, trunk/data/gfx40/st-firebreak.png)

Deleted: trunk/data/gfx48/st-firebreak.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-rock3-break.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-rock3-falling.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-rock3.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-rock3_cracked.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/st_flat-break.png (from rev 1465, trunk/data/gfx48/st-rock3-break.png)

Copied: trunk/data/gfx48/st_flat.png (from rev 1465, trunk/data/gfx48/st-rock3.png)

Copied: trunk/data/gfx48/st_flat_cracked.png (from rev 1465, trunk/data/gfx48/st-rock3_cracked.png)

Added: trunk/data/gfx48/st_flat_falling.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st_flat_falling.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Copied: trunk/data/gfx48/st_flat_fire.png (from rev 1465, trunk/data/gfx48/st-firebreak.png)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/data/models-2d.lua	2009-01-19 21:23:40 UTC (rev 1467)
@@ -756,7 +756,7 @@
     DefStone(&quot;st-dummy&quot;)
     DefImage(&quot;st-easymode&quot;)
     DefStone(&quot;st-flhay&quot;)
-    DefStone(&quot;st-firebreak&quot;)
+    DefStone(&quot;st_flat_fire&quot;)
     DefStone(&quot;st-floppy0&quot;, &quot;sh-round&quot;, {filename=&quot;st-floppy1&quot;})
     DefStone(&quot;st-floppy1&quot;, &quot;sh-round&quot;, {filename=&quot;st-floppy2&quot;})
     DefStone(&quot;st-flrock&quot;)
@@ -776,8 +776,8 @@
     DefStone(&quot;st_granite&quot;, &quot;sh-round&quot;)
     DefStone(&quot;st_darkgray&quot;)
     DefStone(&quot;st_plaster&quot;)
-    DefStone(&quot;st-rock3&quot;)
-    DefStone(&quot;st-rock3_cracked&quot;)
+    DefStone(&quot;st_flat&quot;)
+    DefStone(&quot;st_flat_cracked&quot;)
     DefStone(&quot;st_purplemarble&quot;)
     DefStone(&quot;st_tigris&quot;)
     DefStone(&quot;st_purplegray&quot;)
@@ -1101,19 +1101,17 @@
     for i=32,63  do DefShModel(&quot;st_puzzle&quot;..i, &quot;st_puzzlex&quot;..i, &quot;sh-puzzle1&quot;) end
 end
 
--- st-rock3-break --
+-- st_flat-break --
 do
-    local images = DefSubimages(&quot;st-rock3-break&quot;, {h=6})
-    DefAnim(&quot;rock3_break-anim&quot;,BuildFrames(images,50))
-    DefSolidStone(&quot;st-rock3_break-anim&quot;, &quot;rock3_break-anim&quot;)
-    DefAlias(&quot;st-rock3_movebreak&quot;, &quot;st-rock3&quot;)
-    DefAlias(&quot;st_plaster_breaking&quot;, &quot;st-rock3_break-anim&quot;)
+    local images = DefSubimages(&quot;st_flat-break&quot;, {h=6})
+    DefAnim(&quot;flat_break-anim&quot;,BuildFrames(images,50))
+    DefSolidStone(&quot;st_flat_breaking&quot;, &quot;flat_break-anim&quot;)
 end
 
 -- st-rock3-falling --
 do
-    local images = DefSubimages(&quot;st-rock3-falling&quot;, {h=4})
-    DefAnim(&quot;st-rock3-falling&quot;, BuildFrames(images, 100))
+    local images = DefSubimages(&quot;st_flat_falling&quot;, {h=4})
+    DefAnim(&quot;st_flat_falling&quot;, BuildFrames(images, 100))
 end
 
 -- st-rotator --
@@ -1586,7 +1584,7 @@
 -- st-door_b --
 do
     DefAlias(&quot;st-door_b-open&quot;, &quot;invisible&quot;)
-    DefAlias(&quot;st-door_b-closed&quot;, &quot;st-rock3&quot;)
+    DefAlias(&quot;st-door_b-closed&quot;, &quot;st_flat&quot;)
     local img=DefSubimages(&quot;st-doorb&quot;, {modelname=&quot;doorb&quot;, h=8})
     local f = BuildFrames(img,60)
     DefAnim(&quot;st-door_b-opening&quot;, f)
@@ -1596,7 +1594,7 @@
 -- st-door_c --
 do
     DefAlias(&quot;st-door_c-open&quot;, &quot;st-grate2&quot;)
-    DefAlias(&quot;st-door_c-closed&quot;, &quot;st-rock3&quot;)
+    DefAlias(&quot;st-door_c-closed&quot;, &quot;st_flat&quot;)
     frames=BuildFrames({&quot;st-door_c-closed&quot;,&quot;st-door_c-open&quot;},60)
     DefAnim(&quot;st-door_c-opening&quot;, frames)
     DefAnim(&quot;st-door_c-closing&quot;, ReverseFrames(frames))
@@ -1747,22 +1745,11 @@
 -- Simple stone aliases --
 --------------------------
 do
-    DefAlias(&quot;st-breaking&quot;, &quot;st-rock3_break-anim&quot;)
+    DefAlias(&quot;st-breaking&quot;, &quot;st_flat_breaking&quot;)
     DefAlias(&quot;st-explosion&quot;, &quot;expl&quot;)
-    DefAlias(&quot;st-firebreak_move&quot;, &quot;st-firebreak&quot;)
     DefAlias(&quot;st-glass_move&quot;, &quot;st-glass&quot;);
-    DefAlias(&quot;st-laserbreak&quot;, &quot;st-rock3&quot;)
-    DefAlias(&quot;st-laserbreak-anim&quot;, &quot;st-rock3_break-anim&quot;)
-    DefAlias(&quot;st-plain&quot;, &quot;st-rock3&quot;)
-    DefAlias(&quot;st-plain_break&quot;, &quot;st-rock3&quot;)
-    DefAlias(&quot;st-plain_breaking&quot;, &quot;st-rock3_break-anim&quot;)
-    DefAlias(&quot;st-plain_cracked&quot;, &quot;st-rock3_cracked&quot;)
-    DefAlias(&quot;st-plain_falling&quot;, &quot;st-rock3-falling&quot;)
-    DefAlias(&quot;st-plain_hole&quot;, &quot;st-rock3&quot;)
-    DefAlias(&quot;st-plain_move&quot;, &quot;st-rock3&quot;)
-    DefAlias(&quot;st-rock3_hole&quot;, &quot;st-rock3&quot;)
-    DefAlias(&quot;st-rock3_move&quot;, &quot;st-rock3&quot;)
-    DefAlias(&quot;st-rock3_break&quot;, &quot;st-rock3&quot;)
+    DefAlias(&quot;st-laserbreak&quot;, &quot;st_flat&quot;)
+    DefAlias(&quot;st-laserbreak-anim&quot;, &quot;st_flat_breaking&quot;)
     DefAlias(&quot;st-yinyang3&quot;, &quot;st-yinyang1&quot;)
 end
 

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/data/schemas/objects.xml	2009-01-19 21:23:40 UTC (rev 1467)
@@ -333,7 +333,7 @@
     &lt;object name=&quot;fl_swamp&quot;&gt;
       &lt;attr name=&quot;friction&quot; default=&quot;13.0&quot;/&gt;
       &lt;attr name=&quot;adhesion&quot; default=&quot;1.0&quot;/&gt;
-      &lt;attr name=&quot;$heattransform&quot; default=&quot;fl-dunes&quot;/&gt;
+      &lt;attr name=&quot;$heattransform&quot; default=&quot;fl_dunes&quot;/&gt;
     &lt;/object&gt;
     &lt;object name=&quot;fl_water&quot; super=&quot;fl_floodstream&quot;&gt;
       &lt;attr name=&quot;friction&quot; default=&quot;5.0&quot;/&gt;
@@ -977,6 +977,35 @@
       &lt;attr name=&quot;hit_distortion_yx&quot;/&gt;
       &lt;attr name=&quot;hit_distortion_yy&quot;/&gt;
     &lt;/object&gt;
+    &lt;object name=&quot;st_flat&quot;&gt;
+      &lt;attr name=&quot;hollow&quot; rw=&quot;r&quot;/&gt;
+      &lt;attr name=&quot;breakable&quot; rw=&quot;r&quot;/&gt;
+      &lt;attr name=&quot;burnable&quot; rw=&quot;r&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_flat_hollow&quot;&gt;
+      &lt;attr name=&quot;hollow&quot; value=&quot;true&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_flat_movable&quot;&gt;
+      &lt;attr name=&quot;movable&quot; value=&quot;true&quot;/&gt;
+      &lt;attr name=&quot;breakable&quot; value=&quot;false&quot;/&gt;
+      &lt;attr name=&quot;burnable&quot; value=&quot;false&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_flat_breakable&quot;&gt;
+      &lt;attr name=&quot;breakable&quot; value=&quot;true&quot;/&gt;
+      &lt;attr name=&quot;movable&quot; value=&quot;false&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_flat_breaking&quot; init=&quot;true&quot;/&gt;
+    &lt;object name=&quot;st_flat_cracked&quot;&gt;
+      &lt;attr name=&quot;state&quot; value=&quot;1&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_flat_burnable&quot;&gt;
+      &lt;attr name=&quot;burnable&quot; value=&quot;true&quot;/&gt;
+      &lt;attr name=&quot;movable&quot; value=&quot;false&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_flat_moveburnable&quot;&gt;
+      &lt;attr name=&quot;movable&quot; value=&quot;true&quot;/&gt;
+      &lt;attr name=&quot;burnable&quot; value=&quot;true&quot;/&gt;
+    &lt;/object&gt;
     &lt;object name=&quot;st_floppy&quot;&gt;
       &lt;msg name=&quot;on&quot;/&gt;
       &lt;msg name=&quot;off&quot;/&gt;

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/src/Makefile.am	2009-01-19 21:23:40 UTC (rev 1467)
@@ -284,6 +284,8 @@
 	stones/Door.hh		\
 	stones/FakeStone.cc	\
 	stones/FakeStone.hh	\
+	stones/FlatStone.cc	\
+	stones/FlatStone.hh	\
 	stones/BoxStone.cc	\
 	stones/BoxStone.hh	\
 	stones/FloppySwitch.cc	\

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/src/ox_extra.cc	2009-01-19 21:23:40 UTC (rev 1467)
@@ -134,7 +134,7 @@
     0, 0, 0, 0, 0, 0, 0, 0,     // oxyd stones
     0, 0, 0, 0, 0, 0, 0, 0,     // oxyd stones
     &quot;st_fake_quake&quot;,     // OxydExtra stone 0x11
-    &quot;st-plain&quot;,          // OxydExtra stone 0x12
+    &quot;st_flat&quot;,           // OxydExtra stone 0x12
     &quot;st_purplemarble&quot;,   // OxydExtra stone 0x13
     UNUSED,              // OxydExtra stone 0x14
     &quot;st_tigris&quot;,         // OxydExtra stone 0x15
@@ -152,9 +152,9 @@
     &quot;st_greengray&quot;,      // OxydExtra stone 0x21
     &quot;st_lightglass&quot;,     // OxydExtra stone 0x22
     UNUSED,              // OxydExtra stone 0x23
-    &quot;st-plain_break&quot;,    // OxydExtra stone 0x24
-    &quot;st-plain_hole&quot;,     // OxydExtra stone 0x25
-    &quot;st-plain_move&quot;,     // OxydExtra stone 0x26
+    &quot;st_flat_breakable&quot;, // OxydExtra stone 0x24
+    &quot;st_flat_hollow&quot;,    // OxydExtra stone 0x25
+    &quot;st_flat_movable&quot;,   // OxydExtra stone 0x26
     &quot;st_box_wood&quot;,       // OxydExtra stone 0x27
     &quot;st_switch_instant&quot;, // OxydExtra stone 0x28
     UNUSED,              // OxydExtra stone 0x29

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/src/ox_magnum.cc	2009-01-19 21:23:40 UTC (rev 1467)
@@ -133,8 +133,8 @@
     0,                          // OxydMagnum stone 0x00
     0,0,0,0,0,0,0,0,            // 0x01 -- 0x08  Oxyd stones
     0,0,0,0,0,0,0,0,            // 0x09 -- 0x10  Oxyd stones
-    &quot;st_fake_oxydd&quot;,             // OxydMagnum stone 0x11
-    &quot;st-plain&quot;,                 // OxydMagnum stone 0x12
+    &quot;st_fake_oxydd&quot;,            // OxydMagnum stone 0x11
+    &quot;st_flat&quot;,                  // OxydMagnum stone 0x12
     &quot;st_brick_es&quot;,              // OxydMagnum stone 0x13
     &quot;st_brick_sw&quot;,              // OxydMagnum stone 0x14
     &quot;st_brick_ne&quot;,              // OxydMagnum stone 0x15
@@ -156,9 +156,9 @@
     &quot;st_lightglass&quot;,            // OxydMagnum stone 0x25
     &quot;st_redfiber&quot;,              // OxydMagnum stone 0x26
     &quot;st_lightglass&quot;,            // OxydMagnum stone 0x27
-    &quot;st-plain_break&quot;,           // OxydMagnum stone 0x28
-    &quot;st-plain_hole&quot;,            // OxydMagnum stone 0x29
-    &quot;st-plain_move&quot;,            // OxydMagnum stone 0x2a
+    &quot;st_flat_breakable&quot;,        // OxydMagnum stone 0x28
+    &quot;st_flat_hollow&quot;,           // OxydMagnum stone 0x29
+    &quot;st_flat_movable&quot;,          // OxydMagnum stone 0x2a
     &quot;st_box_wood&quot;,              // OxydMagnum stone 0x2b
     &quot;st_switch_instant&quot;,        // OxydMagnum stone 0x2c
     &quot;st_floppy&quot;,                // OxydMagnum stone 0x2d (in normal Oxyd Magnum Levels unused!)
@@ -215,7 +215,7 @@
     &quot;st_puzzle_yellow_e&quot;,       // Oxyd1 stone 0x60
     &quot;st_puzzle_yellow_nesw&quot;,    // Oxyd1 stone 0x61
     &quot;st_metal_hollow&quot;,          // OxydMagnum stone 0x62  (st-explosive: like st-metal, but explodes when touched ...)
-    &quot;st-plain_break&quot;,           // OxydMagnum stone 0x63
+    &quot;st_flat_breakable&quot;,        // OxydMagnum stone 0x63
     &quot;st-fakeoxyda&quot;,             // OxydMagnum stone 0x64
     UNUSED,                     // OxydMagnum stone 0x65
     UNUSED,                     // OxydMagnum stone 0x66

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/src/ox_oxyd1.cc	2009-01-19 21:23:40 UTC (rev 1467)
@@ -171,7 +171,7 @@
     &quot;st_brick_sw&quot;,              // Oxyd1 stone 0x14
     &quot;st_brick_ne&quot;  ,            // Oxyd1 stone 0x15
     &quot;st_brick_nw&quot;,              // Oxyd1 stone 0x16
-    &quot;st-plain_hole&quot;,            // Oxyd1 stone 0x17
+    &quot;st_flat_hollow&quot;,           // Oxyd1 stone 0x17
     &quot;st-oxyd-0x18&quot;,             // Oxyd1 stone 0x18
     &quot;st_door_c_open&quot;,           // Oxyd1 stone 0x19
     &quot;st-grate1&quot;,                // Oxyd1 stone 0x1a
@@ -188,9 +188,9 @@
     &quot;st_lightglass&quot;,            // Oxyd1 stone 0x25
     &quot;st_redfiber&quot;,              // Oxyd1 stone 0x26
     &quot;st_darkglass&quot;,             // Oxyd1 stone 0x27
-    &quot;st-plain_break&quot;,           // Oxyd1 stone 0x28 [see Level#12]
-    &quot;st-plain_hole&quot;,            // Oxyd1 stone 0x29
-    &quot;st-plain_move&quot;,            // Oxyd1 stone 0x2a
+    &quot;st_flat_breakable&quot;,        // Oxyd1 stone 0x28 [see Level#12]
+    &quot;st_flat_hollow&quot;,           // Oxyd1 stone 0x29
+    &quot;st_flat_movable&quot;,          // Oxyd1 stone 0x2a
     &quot;st_box_wood&quot;,              // Oxyd1 stone 0x2b
     &quot;st_switch_instant&quot;,        // Oxyd1 stone 0x2c
     &quot;st_switch_black_instant&quot;,  // Oxyd1 stone 0x2d

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/src/ox_peroxyd.cc	2009-01-19 21:23:40 UTC (rev 1467)
@@ -206,7 +206,7 @@
     0,0,0,0,0,0,0,0,            // PerOxyd stone 0x01 - 0x08   oxyd stones
     0,0,0,0,0,0,0,0,            // PerOxyd stone 0x08 - 0x10   oxyd stones
     &quot;st_fake_oxydc&quot;,            // PerOxyd stone 0x11
-    &quot;st-plain_break&quot;,           // PerOxyd stone 0x12   no, should be destructible with hammer
+    &quot;st_flat_breakable&quot;,        // PerOxyd stone 0x12   no, should be destructible with hammer
     &quot;st_purplemarble&quot;,          // PerOxyd stone 0x13
     &quot;st_beads&quot;,                 // PerOxyd stone 0x14
     &quot;st_tigris&quot;,                // PerOxyd stone 0x15
@@ -224,9 +224,9 @@
     &quot;st_greenbrown&quot;,            // PerOxyd stone 0x21
     &quot;st_rawglass&quot;,              // PerOxyd stone 0x22 (semi opaque piece, not really glass)
     &quot;st_rawglass&quot;,              // PerOxyd stone 0x23 (must be st-glass, see link level 92)
-    &quot;st-plain_break&quot;,           // PerOxyd stone 0x24
+    &quot;st_flat_breakable&quot;,        // PerOxyd stone 0x24
     &quot;st_bluegray_hollow&quot;,       // PerOxyd stone 0x25
-    &quot;st-plain_move&quot;,            // PerOxyd stone 0x26
+    &quot;st_flat_movable&quot;,          // PerOxyd stone 0x26
     &quot;st_box_wood&quot;,              // PerOxyd stone 0x27
     &quot;st_switch_instant&quot;,        // PerOxyd stone 0x28
     &quot;st_switch_black_instant&quot;,  // PerOxyd stone 0x29

Added: trunk/src/stones/FlatStone.cc
===================================================================
--- trunk/src/stones/FlatStone.cc	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/src/stones/FlatStone.cc	2009-01-19 21:23:40 UTC (rev 1467)
@@ -0,0 +1,219 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include &quot;stones/FlatStone.hh&quot;
+#include &quot;client.hh&quot;
+#include &quot;Inventory.hh&quot;
+#include &quot;items/GlassesItem.hh&quot;
+#include &quot;player.hh&quot;
+//#include &quot;world.hh&quot;
+//#include &quot;main.hh&quot;
+
+namespace enigma {
+    FlatStone::FlatStone(bool hollow, bool movable, bool breakable, bool cracked, bool burnable, bool breaking) {
+        if (hollow)
+            objFlags |= OBJBIT_HOLLOW;
+        if (movable)
+            objFlags |= OBJBIT_MOVABLE;
+        if (breakable)
+            objFlags |= OBJBIT_BREAKABLE;
+        if (burnable)
+            objFlags |= OBJBIT_BURNABLE;
+        if (cracked)
+            state = CRACKED;
+        if (breaking)
+            state = BREAKING;
+    }
+    
+    std::string FlatStone::getClass() const {
+        return get_traits().name;
+    }
+    
+    Value FlatStone::getAttr(const std::string &amp;key) const {
+        if (key == &quot;movable&quot;) {
+            return (bool)(objFlags &amp; OBJBIT_MOVABLE);
+        } else if (key == &quot;hollow&quot;) {
+            return (bool)(objFlags &amp; OBJBIT_HOLLOW);
+        } else if (key == &quot;breakable&quot;) {
+            return (bool)(objFlags &amp; OBJBIT_BREAKABLE);
+        } else if (key == &quot;burnable&quot;) {
+            return (bool)(objFlags &amp; OBJBIT_BURNABLE);
+        }
+        return Stone::getAttr(key);
+    }
+    
+    Value FlatStone::message(const Message &amp;m) {
+        if (m.message == &quot;_glasses&quot;) {
+            if ((to_int(m.value) &amp; Glasses::HOLLOW) &amp;&amp; !(objFlags &amp; OBJBIT_GLASSES)) {  // hollow
+                objFlags |= OBJBIT_GLASSES;
+                if (isDisplayable())
+                    init_model();
+            } else if (objFlags &amp; OBJBIT_GLASSES) {
+                objFlags &amp;= ~OBJBIT_GLASSES;
+                if (isDisplayable())
+                    init_model();
+            }
+            return Value();
+        } else if (((objFlags &amp; (OBJBIT_BREAKABLE | OBJBIT_MOVABLE)) || state == CRACKED) &amp;&amp; 
+                (m.message ==&quot;ignite&quot; || m.message == &quot;_explosion&quot; || m.message == &quot;_bombstone&quot;)) {
+            doBreak();
+            return Value();
+        } else if ((m.message == &quot;_trigger&quot; || m.message == &quot;signal&quot;) &amp;&amp; state == IDLE) {
+            if (!(objFlags &amp; (OBJBIT_BREAKABLE | OBJBIT_MOVABLE | OBJBIT_HOLLOW | OBJBIT_BURNABLE))) {
+                objFlags |= OBJBIT_HOLLOW;
+            } else if (objFlags &amp; OBJBIT_HOLLOW) {
+                objFlags &amp;= ~OBJBIT_HOLLOW;                
+            }
+            if (isDisplayable())
+                init_model();
+            return Value();
+        } else if (m.message == &quot;fire&quot; &amp;&amp; (objFlags &amp; OBJBIT_BURNABLE)) {
+            doBreak();
+            return true;
+        } else if (m.message == &quot;heat&quot; &amp;&amp; (objFlags &amp; OBJBIT_BURNABLE) &amp;&amp; !(objFlags &amp; OBJBIT_MOVABLE)) {
+            doBreak();
+            return true;
+        }
+        return Stone::message(m);
+    }
+   
+    void FlatStone::setState(int extState) {
+        // block all state writes
+    }
+    
+    void FlatStone::init_model() {
+        if ((objFlags &amp; OBJBIT_GLASSES) &amp;&amp; (objFlags &amp; OBJBIT_HOLLOW))
+            set_model(&quot;invisible&quot;);
+        else if (state == BREAKING)
+            set_anim(&quot;st_flat_breaking&quot;);
+        else if (state == FALLING)
+            set_anim(&quot;st_flat_falling&quot;);
+        else if (state == CRACKED)
+            set_anim(&quot;st_flat_cracked&quot;);
+        else if (objFlags &amp; OBJBIT_BURNABLE)
+            set_model(&quot;st_flat_fire&quot;);
+        else
+            set_model(&quot;st_flat&quot;);
+    }
+    
+    void FlatStone::processLight(Direction d) {
+        if (state == IDLE &amp;&amp; (objFlags &amp; OBJBIT_BREAKABLE))
+            doBreak();
+        else if (state == IDLE &amp;&amp; !(objFlags &amp; (OBJBIT_BREAKABLE | OBJBIT_MOVABLE | OBJBIT_HOLLOW | OBJBIT_BURNABLE))) {
+            state = CRACKED;
+            init_model();
+        } else
+            Stone::processLight(d);
+    }
+    
+    void FlatStone::animcb() {
+        if (state == FALLING)
+            sound_event(&quot;stonedestroy&quot;);
+        KillStone(get_pos());
+    }
+    
+    bool FlatStone::is_floating() const {
+        return objFlags &amp; OBJBIT_HOLLOW;
+    }
+    
+    void FlatStone::on_floor_change() {
+        if ((state == IDLE) &amp;&amp; (objFlags &amp; (OBJBIT_BREAKABLE | OBJBIT_MOVABLE))) {
+            GridPos p = get_pos();
+            if (Floor *fl = GetFloor(p)) {
+                if (fl-&gt;isKind(&quot;fl_abyss&quot;)) {
+                    state == FALLING;
+                    init_model();
+                }
+                else if ((objFlags &amp; OBJBIT_MOVABLE) &amp;&amp; ((fl-&gt;is_kind(&quot;fl_swamp&quot;) || fl-&gt;is_kind(&quot;fl_water&quot;)))) {
+                    sound_event(&quot;drown&quot;);
+                    client::Msg_Sparkle(p.center());
+                    KillStone(p);
+                }
+            }
+        }
+    }
+
+    StoneResponse FlatStone::collision_response(const StoneContact &amp;sc) {
+        if (objFlags &amp; OBJBIT_HOLLOW)
+            return STONE_PASS;
+        return Stone::collision_response(sc);
+    }
+
+    const char *FlatStone::collision_sound() {
+        if (state == BREAKING || state == CRACKED || (objFlags &amp; OBJBIT_BREAKABLE))
+            return &quot;metal&quot;;
+        else
+            return &quot;stone&quot;;
+    }
+    
+    void FlatStone::actor_hit(const StoneContact &amp;sc) {
+        if (((objFlags &amp; OBJBIT_BREAKABLE) || state == CRACKED) &amp;&amp; player::WieldedItemIs(sc.actor, &quot;it_hammer&quot;))
+            doBreak();
+        else if ((state == IDLE &amp;&amp; !(objFlags &amp; (OBJBIT_BREAKABLE | OBJBIT_HOLLOW))) &amp;&amp;
+                (player::WieldedItemIs(sc.actor, &quot;it-pencil&quot;))) {
+            enigma::Inventory *inv = player::GetInventory(sc.actor);
+            if (inv &amp;&amp; inv-&gt;size() &gt; 0) {
+                delete inv-&gt;yield_item(0);
+                player::RedrawInventory(inv);
+                sound_event(&quot;stonepaint&quot;);
+                objFlags |= OBJBIT_BURNABLE;
+                init_model();
+            }
+        } else if (state == IDLE &amp;&amp; (objFlags &amp; OBJBIT_BURNABLE) &amp;&amp;
+                player::WieldedItemIs(sc.actor, &quot;it_brush&quot;)) {
+            sound_event(&quot;stonepaint&quot;);
+            objFlags &amp;= ~OBJBIT_BURNABLE;
+            init_model();
+        } else
+            Stone::actor_hit(sc);
+    }
+    
+    void FlatStone::doBreak() {
+        if (state &lt;= CRACKED) {
+            state = BREAKING;
+            sound_event(&quot;stonedestroy&quot;);
+            if (isDisplayable())
+                init_model();
+        }
+    }
+        
+    int FlatStone::traitsIdx() const {
+        return (((objFlags &amp; OBJBIT_BREAKABLE)|| state == CRACKED) ? 1 : 0) + ((objFlags &amp; OBJBIT_MOVABLE) ? 2 : 0);
+    }
+    
+    StoneTraits FlatStone::traits[4] = {
+        {&quot;st_flat&quot;, st_standard, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {&quot;st_flat&quot;, st_standard, stf_none, material_stone, 1.0, MOVABLE_BREAKABLE},
+        {&quot;st_flat&quot;, st_standard, stf_none, material_stone, 1.0, MOVABLE_STANDARD},
+        {&quot;st_flat&quot;, st_standard, stf_none, material_stone, 1.0, MOVABLE_IRREGULAR},
+    };
+    
+    BOOT_REGISTER_START
+        BootRegister(new FlatStone(false, false), &quot;st_flat&quot;);
+        BootRegister(new FlatStone(true, false),  &quot;st_flat_hollow&quot;);
+        BootRegister(new FlatStone(false, true),  &quot;st_flat_movable&quot;);
+        BootRegister(new FlatStone(false, false, true), &quot;st_flat_breakable&quot;);
+        BootRegister(new FlatStone(false, false, false, true), &quot;st_flat_cracked&quot;);
+        BootRegister(new FlatStone(false, false, false, false, true), &quot;st_flat_burnable&quot;);
+        BootRegister(new FlatStone(false, true, false, false, true), &quot;st_flat_moveburnable&quot;);
+        BootRegister(new FlatStone(false, false, true, false, false, true), &quot;st_flat_breaking&quot;);
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/FlatStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/FlatStone.hh
===================================================================
--- trunk/src/stones/FlatStone.hh	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/src/stones/FlatStone.hh	2009-01-19 21:23:40 UTC (rev 1467)
@@ -0,0 +1,82 @@
+/*
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef FLATSTONE_HH
+#define FLATSTONE_HH
+
+#include &quot;stones.hh&quot;
+
+#include &quot;stones_internal.hh&quot;
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class FlatStone : public Stone {
+        CLONEOBJ(FlatStone);
+        DECL_TRAITS_ARRAY(4, traitsIdx());
+    private:
+        enum iState {
+            IDLE,         ///&lt; 
+            CRACKED,      ///&lt; 
+            BREAKING,     ///&lt; 
+            FALLING       ///&lt; 
+        };
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_MOVABLE   =   1&lt;&lt;24,    ///&lt;  
+            OBJBIT_HOLLOW    =   1&lt;&lt;25,    ///&lt; 
+            OBJBIT_GLASSES   =   1&lt;&lt;26,    ///&lt; invisible due to glasses
+            OBJBIT_BREAKABLE =   1&lt;&lt;27,    ///&lt; breakable
+            OBJBIT_BURNABLE  =   1&lt;&lt;28     ///&lt; fire breakable
+        };
+        
+    public:
+        FlatStone(bool hollow, bool movable, bool breakable = false, bool cracked = false,
+                bool burnable = false, bool breaking = false);
+        
+        // Object interface
+        virtual std::string getClass() const;        
+        virtual Value getAttr(const std::string &amp;key) const;
+        virtual Value message(const Message &amp;m);
+        
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        virtual void processLight(Direction d);   // direction of laserbeam
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual bool is_floating() const;
+        virtual void on_floor_change();
+        virtual StoneResponse collision_response(const StoneContact &amp;sc);
+        virtual const char *collision_sound();
+        virtual void actor_hit(const StoneContact &amp;sc);
+
+    private:
+        void doBreak();
+        int traitsIdx() const;
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/FlatStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones/GlassStones.cc
===================================================================
--- trunk/src/stones/GlassStones.cc	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/src/stones/GlassStones.cc	2009-01-19 21:23:40 UTC (rev 1467)
@@ -84,7 +84,7 @@
     }
     
     bool GlassStone::is_sticky(const Actor *a) const {
-        return !a-&gt;is_invisible();
+        return !is_floating() &amp;&amp; !a-&gt;is_invisible();
     }
     
     bool GlassStone::is_transparent(Direction d) const {

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/src/stones.cc	2009-01-19 21:23:40 UTC (rev 1467)
@@ -39,7 +39,14 @@
     GridObject::on_creation(p);
 }
 
+void Stone::transform(std::string kind) {
+    Stone *newStone = MakeStone(kind.c_str());
+    transferIdentity(newStone);          // subclasses may hook this call
+    SetStone(get_pos(), newStone);
+}
 
+
+
 /*! Determine whether the actor hitting the stone can move stone
   and return either the direction the stone should move or NODIR. */
 Direction get_push_direction (const StoneContact &amp;sc) 
@@ -419,8 +426,8 @@
                 &quot;st-magic&quot;,
                 &quot;st_knight&quot;,
                 &quot;st-thief&quot;,
-                &quot;st-plain_break&quot;,
-                &quot;st-plain_breaking&quot;
+                &quot;st_flat_breakable&quot;,
+                &quot;st_flat_breaking&quot;
             };
             int idx = enigma::IntegerRand (1, 9) - 1;
             sound_event (&quot;stonetransform&quot;);
@@ -499,230 +506,6 @@
     DEF_TRAITSM(BugStone, &quot;st-bug&quot;, st_bug, MOVABLE_BREAKABLE);
 }
 
-
-/* -------------------- Plain stones -------------------- */
-
-/* These stones mimic the behaviour of the plain-looking stones in
-   Oxyd. */
-namespace
-{
-    class PlainStone : public Stone {
-        CLONEOBJ(PlainStone);
-        DECL_TRAITS;
-
-        void processLight(Direction d) {
-            ReplaceStone (get_pos(), MakeStone(&quot;st-plain_cracked&quot;));
-        }
-
-        const char *collision_sound() {return &quot;stone&quot;;}
-
-        virtual Value message(const Message &amp;m) {
-            if (m.message == &quot;_trigger&quot; || m.message == &quot;signal&quot;) {
-                ReplaceStone(get_pos(), MakeStone(&quot;st-plain_hole&quot;));
-                return Value();
-            }
-            return Stone::message(m);
-        }
-        void actor_hit (const StoneContact &amp;sc) {
-            if (player::WieldedItemIs (sc.actor, &quot;it-pencil&quot;)) {
-                enigma::Inventory *inv = player::GetInventory(sc.actor);
-                if (inv &amp;&amp; inv-&gt;size() &gt; 0) {
-                    delete inv-&gt;yield_item(0);
-                    player::RedrawInventory(inv);
-                    sound_event(&quot;stonepaint&quot;);
-                    ReplaceStone(get_pos(), MakeStone(&quot;st-firebreak&quot;));
-                }
-            } else
-                Stone::actor_hit(sc);
-        }
-    public:
-        PlainStone()
-        {}
-    private:
-        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_PERSISTENT; }
-    };
-    DEF_TRAITSM(PlainStone, &quot;st-plain&quot;, st_plain, MOVABLE_BREAKABLE);
-    
-    class PlainStone_Hollow : public Stone {
-        CLONEOBJ(PlainStone_Hollow);
-        DECL_TRAITS;
-
-        virtual Value message(const Message &amp;m) {
-            if (m.message == &quot;_trigger&quot; || m.message == &quot;signal&quot;) {
-                ReplaceStone(get_pos(), MakeStone(&quot;st-plain&quot;));
-                return Value();
-            }
-            return Stone::message(m);
-        }
-
-        StoneResponse collision_response(const StoneContact &amp;) 
-        { return STONE_PASS; }
-
-        bool is_floating() const { return true; }
-    public:
-        PlainStone_Hollow()
-        {}
-    };
-    DEF_TRAITSM(PlainStone_Hollow, &quot;st-plain_hole&quot;, st_plain_hole, MOVABLE_PERSISTENT);
-
-    class PlainStone_Breaking : public Stone {
-        CLONEOBJ(PlainStone_Breaking);
-        DECL_TRAITS;
-
-        void init_model() {
-            set_anim(&quot;st-plain_breaking&quot;);
-        }
-        void animcb() {
-            KillStone(get_pos());
-        }
-        const char *collision_sound() {return &quot;metal&quot;;}
-    public:
-        PlainStone_Breaking()
-        {}
-    };
-    DEF_TRAITSM(PlainStone_Breaking, &quot;st-plain_breaking&quot;, st_plain_breaking,
-                MOVABLE_BREAKABLE);
-    
-    class PlainStone_Breakable : public Stone {
-        CLONEOBJ(PlainStone_Breakable);
-        DECL_TRAITS;
-
-        const char *collision_sound() {return &quot;metal&quot;;}
-
-        void break_me() {
-            sound_event (&quot;stonedestroy&quot;);
-            ReplaceStone(get_pos(), MakeStone (&quot;st-plain_breaking&quot;));
-        }
-        void processLight(Direction d) {
-            break_me();
-        }
-        virtual Value message(const Message &amp;m) {
-            if (m.message ==&quot;ignite&quot; || m.message == &quot;_explosion&quot; || m.message == &quot;_bombstone&quot;) {
-                break_me();
-                return Value();
-            }
-            return Stone::message(m);
-        }
-        void actor_hit (const StoneContact &amp;sc) {
-            if (player::WieldedItemIs (sc.actor, &quot;it_hammer&quot;)) {
-                break_me();
-            }
-        }
-
-        void on_floor_change() {
-            if (Floor *fl = GetFloor (get_pos()))
-                if (fl-&gt;is_kind(&quot;fl_abyss&quot;))
-                    ReplaceStone (get_pos(), MakeStone(&quot;st-plain_falling&quot;));
-        }
-
-    public:
-        PlainStone_Breakable()
-        {}
-    };
-    DEF_TRAITSM(PlainStone_Breakable, &quot;st-plain_break&quot;, st_plain_break,
-                MOVABLE_BREAKABLE);
-    
-    class PlainStone_Cracked : public Stone {
-        CLONEOBJ(PlainStone_Cracked);
-        DECL_TRAITS;
-
-        void break_me() {
-            sound_event (&quot;stonedestroy&quot;);
-            ReplaceStone(get_pos(), MakeStone(&quot;st-plain_breaking&quot;));
-        }
-
-        void actor_hit (const StoneContact &amp;sc) {
-            if (player::WieldedItemIs (sc.actor, &quot;it_hammer&quot;)) {
-                break_me();
-            }
-        }
-
-        virtual Value message(const Message &amp;m) {
-            if (m.message ==&quot;ignite&quot; || m.message == &quot;_explosion&quot; || m.message == &quot;_bombstone&quot;) {
-                break_me();
-                return Value();
-            }
-            return Stone::message(m);
-        }
-        const char *collision_sound() {return &quot;metal&quot;;}
-    public:
-        PlainStone_Cracked()
-        {}
-    };
-    DEF_TRAITSM(PlainStone_Cracked, &quot;st-plain_cracked&quot;, st_plain_cracked,
-                MOVABLE_BREAKABLE);
-    
-    class PlainStone_Falling : public Stone {
-        CLONEOBJ(PlainStone_Falling);
-        DECL_TRAITS;
-
-        void init_model() {
-            set_anim(&quot;st-plain_falling&quot;);
-        }
-
-        void animcb() {
-            sound_event (&quot;stonedestroy&quot;);
-            KillStone(get_pos());
-        }
-    public:
-        PlainStone_Falling()
-        {}
-    };
-    DEF_TRAITSM(PlainStone_Falling, &quot;st-plain_falling&quot;, st_plain_falling,
-                MOVABLE_BREAKABLE);
-
-    class PlainStone_Movable : public Stone {
-        CLONEOBJ(PlainStone_Movable);
-        DECL_TRAITS;
-
-        void break_me() {
-            sound_event (&quot;stonedestroy&quot;);
-            ReplaceStone(get_pos(), MakeStone (&quot;st-plain_breaking&quot;));
-        }
-        virtual Value message(const Message &amp;m) {
-            if (m.message ==&quot;ignite&quot; || m.message == &quot;_explosion&quot; || m.message == &quot;_bombstone&quot;) {
-                break_me();
-                return Value();
-            }
-            return Stone::message(m);
-        }
-        void on_floor_change() {
-//            Stone::on_move();
-            GridPos p = get_pos();
-            if (Floor *fl = GetFloor (p)) {
-                if (fl-&gt;is_kind(&quot;fl_abyss&quot;)) {
-                    ReplaceStone (p, MakeStone(&quot;st-plain_falling&quot;));
-                }
-                else if (fl-&gt;is_kind(&quot;fl_swamp&quot;) || fl-&gt;is_kind(&quot;fl_water&quot;)) {
-                    sound_event (&quot;drown&quot;);
-                    client::Msg_Sparkle (p.center());
-                    KillStone (p);
-                }
-            }
-        }
-
-        void actor_hit (const StoneContact &amp;sc) {
-            if (player::WieldedItemIs (sc.actor, &quot;it-pencil&quot;)) {
-                enigma::Inventory *inv = player::GetInventory(sc.actor);
-                if (inv &amp;&amp; inv-&gt;size() &gt; 0) {
-                    delete inv-&gt;yield_item(0);
-                    player::RedrawInventory(inv);
-                    sound_event(&quot;stonepaint&quot;);
-                    ReplaceStone(get_pos(), MakeStone(&quot;st-firebreak_move&quot;));
-                }
-            } else
-                Stone::actor_hit(sc);
-        }
-
-    public:
-        PlainStone_Movable()
-        {}
-    };
-    DEF_TRAITSM(PlainStone_Movable, &quot;st-plain_move&quot;, st_plain_move,
-                MOVABLE_STANDARD);
-}
-
-
 /* -------------------- Black- and Whiteballs Stones -------------------- */
 
 namespace
@@ -846,13 +629,6 @@
     Register (new FakeOxydA);
     Register (new BreakingStone);
     Register (new BugStone);
-    Register (new PlainStone);
-    Register (new PlainStone_Hollow);
-    Register (new PlainStone_Breakable);
-    Register (new PlainStone_Breaking);
-    Register (new PlainStone_Cracked);
-    Register (new PlainStone_Movable);
-    Register (new PlainStone_Falling);
 
     // Init stones from stones_simple.cc and stones_complex.cc:
     Init_simple();

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/src/stones.hh	2009-01-19 21:23:40 UTC (rev 1467)
@@ -238,6 +238,7 @@
         bool move_stone(GridPos newPos, const char *soundevent);
         bool move_stone(Direction dir);
         ecl::V2 distortedVelocity (ecl::V2 vel, double defaultfactor);
+        void transform(std::string kind);
         
         // Cluster support
         void autoJoinCluster();

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2009-01-19 19:38:50 UTC (rev 1466)
+++ trunk/src/stones_simple.cc	2009-01-19 21:23:40 UTC (rev 1467)
@@ -1100,95 +1100,7 @@
     DEF_TRAITSM(MagicStone, &quot;st-magic&quot;, st_magic, MOVABLE_BREAKABLE);
 }
 
-/* -------------------- Fire breakable stones -------------------- */
 
-/* These stones mimic the behaviour of the plain-looking stones in
-   Oxyd. */
-namespace
-{
-    class Stone_firebreak : public Stone {
-        CLONEOBJ(Stone_firebreak);
-        DECL_TRAITS;
-
-        const char *collision_sound() {return &quot;stone&quot;;}
-
-        void break_me() {
-            sound_event(&quot;stonedestroy&quot;);
-            ReplaceStone(get_pos(), MakeStone(&quot;st-plain_breaking&quot;));
-        }
-
-        virtual Value message(const Message &amp;m) {
-            if (m.message ==&quot;heat&quot; || m.message == &quot;fire&quot;) {
-                break_me();
-                return true;
-            }
-            return Stone::message(m);
-        }
-
-        void actor_hit(const StoneContact &amp;sc) {
-            if (player::WieldedItemIs(sc.actor, &quot;it_brush&quot;)) {
-                sound_event(&quot;stonepaint&quot;);
-                ReplaceStone(get_pos(), MakeStone(&quot;st-plain&quot;));
-            } else
-                Stone::actor_hit(sc);
-        }
-
-    public:
-        Stone_firebreak()
-        {}
-    };
-    DEF_TRAITSM(Stone_firebreak, &quot;st-firebreak&quot;, st_firebreak, MOVABLE_BREAKABLE);
-
-    class Stone_movefirebreak : public Stone {
-        CLONEOBJ(Stone_movefirebreak);
-        DECL_TRAITS;
-
-        void break_me() {
-            sound_event(&quot;stonedestroy&quot;);
-            ReplaceStone(get_pos(), MakeStone(&quot;st-plain_breaking&quot;));
-        }
-
-        virtual Value message(const Message &amp;m) {
-            if (m.message ==&quot;fire&quot;) {
-                break_me();
-                return Value();
-            }
-            return Stone::message(m);
-        }
-
-        void actor_hit(const StoneContact &amp;sc) {
-            if (player::WieldedItemIs(sc.actor, &quot;it_brush&quot;)) {
-                sound_event(&quot;stonepaint&quot;);
-                ReplaceStone(get_pos(), MakeStone(&quot;st-plain_move&quot;));
-            } else
-                Stone::actor_hit(sc);
-        }
-
-        void on_floor_change() {
-            GridPos p = get_pos();
-            if (Floor *fl = GetFloor (p)) {
-                if (fl-&gt;is_kind(&quot;fl_abyss&quot;)) {
-                    ReplaceStone (p, MakeStone(&quot;st-plain_falling&quot;));
-                }
-                else if (fl-&gt;is_kind(&quot;fl_swamp&quot;) || fl-&gt;is_kind(&quot;fl_water&quot;)) {
-                    sound_event (&quot;drown&quot;);
-                    client::Msg_Sparkle (p.center());
-                    KillStone (p);
-                }
-            }
-        }
-
-    public:
-        Stone_movefirebreak() : Stone(&quot;st-firebreak&quot;) { }
-        
-    private:
-        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_NO_STONE; }        
-    };
-    DEF_TRAITSM(Stone_movefirebreak, &quot;st-firebreak_move&quot;, st_firebreak_move,
-                MOVABLE_IRREGULAR);
-}
-
-
 /* -------------------- Functions -------------------- */
 
 void DefineSimpleStone(const std::string &amp;kind, 
@@ -1230,7 +1142,6 @@
     Register(new LaserBreakable);
     Register(new MagicStone);
     Register(new Stone_break(&quot;st-stone_break&quot;));
-    Register(new Stone_break(&quot;st-rock3_break&quot;));
     Register(new Stone_break(&quot;st-break_gray&quot;));
     Register(new Stone_movebreak);
     Register(new Stonebrush);
@@ -1239,9 +1150,6 @@
     Register(new YinYangStone1);
     Register(new YinYangStone2);
     Register(new YinYangStone3);
-
-    Register(new Stone_firebreak);
-    Register(new Stone_movefirebreak);
 }
 
 } // namespace enigma


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000895.html">[Enigma-game-svn] r1466 - in feature_branches/hp_lotm/input: .	articles lotm
</A></li>
	<LI>Next message: <A HREF="000897.html">[Enigma-game-svn] r1468 - feature_branches/hp_lotm/input/articles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#896">[ date ]</a>
              <a href="thread.html#896">[ thread ]</a>
              <a href="subject.html#896">[ subject ]</a>
              <a href="author.html#896">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
