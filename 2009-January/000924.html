<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1495 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/actors src/items
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2009-January/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1495%20-%20in%20trunk%3A%20data%20data/gfx32%20data/gfx40%0A%09data/gfx48%20data/schemas%20src%20src/actors%20src/items&In-Reply-To=%3C200901310027.n0V0R2il007610%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000923.html">
   <LINK REL="Next"  HREF="000925.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1495 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/actors src/items</H1>
    <B>ral at BerliOS</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1495%20-%20in%20trunk%3A%20data%20data/gfx32%20data/gfx40%0A%09data/gfx48%20data/schemas%20src%20src/actors%20src/items&In-Reply-To=%3C200901310027.n0V0R2il007610%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1495 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/actors src/items">ral at mail.berlios.de
       </A><BR>
    <I>Sat Jan 31 01:27:02 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000923.html">[Enigma-game-svn] r1494 - in trunk: data/schemas src src/others
</A></li>
        <LI>Next message: <A HREF="000925.html">[Enigma-game-svn] r1496 - in trunk/data/levels: enigma_cross	enigma_iii enigma_iv enigma_v enigma_vi enigma_vii enigma_viii
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#924">[ date ]</a>
              <a href="thread.html#924">[ thread ]</a>
              <a href="subject.html#924">[ subject ]</a>
              <a href="author.html#924">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ral
Date: 2009-01-31 01:26:52 +0100 (Sat, 31 Jan 2009)
New Revision: 1495

Added:
   trunk/data/gfx32/it_burnable_ash.png
   trunk/data/gfx32/it_burnable_burning.png
   trunk/data/gfx32/it_burnable_fireproof.png
   trunk/data/gfx32/it_burnable_ignite.png
   trunk/data/gfx32/it_burnable_oil.png
   trunk/data/gfx32/it_flag_black.png
   trunk/data/gfx32/it_flag_white.png
   trunk/data/gfx40/it_burnable_ash.png
   trunk/data/gfx40/it_burnable_burning.png
   trunk/data/gfx40/it_burnable_fireproof.png
   trunk/data/gfx40/it_burnable_ignite.png
   trunk/data/gfx40/it_burnable_oil.png
   trunk/data/gfx40/it_flag_black.png
   trunk/data/gfx40/it_flag_white.png
   trunk/data/gfx48/it_burnable_ash.png
   trunk/data/gfx48/it_burnable_burning.png
   trunk/data/gfx48/it_burnable_fireproof.png
   trunk/data/gfx48/it_burnable_ignite.png
   trunk/data/gfx48/it_burnable_oil.png
   trunk/data/gfx48/it_flag_black.png
   trunk/data/gfx48/it_flag_white.png
   trunk/src/items/BurnableItem.cc
   trunk/src/items/BurnableItem.hh
   trunk/src/items/CompatibilityItems.cc
   trunk/src/items/CompatibilityItems.hh
Removed:
   trunk/data/gfx32/it-burnable_ash.png
   trunk/data/gfx32/it-burnable_burning.png
   trunk/data/gfx32/it-burnable_fireproof.png
   trunk/data/gfx32/it-burnable_ignite.png
   trunk/data/gfx32/it-burnable_oil.png
   trunk/data/gfx32/it-flagblack.png
   trunk/data/gfx32/it-flagwhite.png
   trunk/data/gfx40/it-burnable_ash.png
   trunk/data/gfx40/it-burnable_burning.png
   trunk/data/gfx40/it-burnable_fireproof.png
   trunk/data/gfx40/it-burnable_ignite.png
   trunk/data/gfx40/it-burnable_oil.png
   trunk/data/gfx40/it-flagblack.png
   trunk/data/gfx40/it-flagwhite.png
   trunk/data/gfx48/it-burnable_ash.png
   trunk/data/gfx48/it-burnable_burning.png
   trunk/data/gfx48/it-burnable_fireproof.png
   trunk/data/gfx48/it-burnable_ignite.png
   trunk/data/gfx48/it-burnable_oil.png
   trunk/data/gfx48/it-flagblack.png
   trunk/data/gfx48/it-flagwhite.png
Modified:
   trunk/data/api1init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/actors/Balls.cc
   trunk/src/floors.cc
   trunk/src/items.cc
   trunk/src/items.hh
   trunk/src/items/Crack.cc
   trunk/src/items/Crack.hh
   trunk/src/items/Extinguisher.cc
   trunk/src/items/SimpleItems.cc
   trunk/src/items/SimpleItems.hh
   trunk/src/items/Umbrella.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/player.cc
   trunk/src/player.hh
   trunk/src/server.cc
Log:
Trunk 1.1: new API reengineering
- umbrella and god mode shield all actors of current initiating player
- reengineering burnable item - renaming:
  - it-burnable -&gt; it_burnable_invisible, it_burnable
  - it-burnable_oil -&gt; it_burnable_oil
  - it-burnable_ignited -&gt; it_burnable_ignited
  - it-burnable_burning -&gt; it_burnable_burning
  - it-burnable_ash -&gt; it_burnable_ash
  - it-burnable_fireproof -&gt; it_burnable_fireproof
  - message &quot;trigger&quot; substituted by &quot;ignite&quot;
- reengineering flags:
  - it-flagblack -&gt; it_flag_black, it_flag
  - it-flagwhite -&gt; it_flag_white
  - attribute &quot;color&quot;
- code cleanup

Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/data/api1init.lua	2009-01-31 00:26:52 UTC (rev 1495)
@@ -136,6 +136,12 @@
     it_blocker_new = &quot;it-blocker-new&quot;,
     it_brake = &quot;it-brake&quot;,
     it_brush = &quot;it-brush&quot;,
+    it_burnable_invisible = &quot;it-burnable&quot;,
+    it_burnable_oil = &quot;it-burnable_oil&quot;,
+    it_burnable_ignited = &quot;it-burnable_ignited&quot;,
+    it_burnable_burning = &quot;it-burnable_burning&quot;,
+    it_burnable_ash = &quot;it-burnable_ash&quot;,
+    it_burnable_fireproof = &quot;it-burnable_fireproof&quot;,
     it_cherry = &quot;it-cherry&quot;,
     it_coffee = &quot;it-coffee&quot;,
     it_coin_s = &quot;it-coin1&quot;,
@@ -152,6 +158,8 @@
     it_extinguisher_full = &quot;it-extinguisher&quot;,
     it_extralife = &quot;it-extralife&quot;,
     it_death = &quot;it-death&quot;,
+    it_flag_black = &quot;it-flagblack&quot;,
+    it_flag_white = &quot;it-flagwhite&quot;,
     it_floppy = &quot;it-floppy&quot;,
     it_glasses = &quot;it-glasses&quot;,
     it_glasses_broken = &quot;it-glasses-broken&quot;,
@@ -1035,12 +1043,7 @@
     fl_bridge__signal = &quot;toggle&quot;,
     it_blocker__trigger = &quot;toggle&quot;,
     it_blocker__openclose = &quot;toggle&quot;,
-    [&quot;it-burnable__trigger&quot;] = &quot;ignite&quot;,
-    [&quot;it-burnable_ignited__trigger&quot;] = &quot;ignite&quot;,
-    [&quot;it-burnable_burning__trigger&quot;] = &quot;ignite&quot;,
-    [&quot;it-burnable_fireproof__trigger&quot;] = &quot;ignite&quot;,
-    [&quot;it-burnable_ash__trigger&quot;] = &quot;ignite&quot;,
-    [&quot;it-burnable_oil__trigger&quot;] = &quot;ignite&quot;,
+    it_burnable__trigger = &quot;ignite&quot;,
     it_magnet__onoff = &quot;toggle&quot;,
     it_meditation__trigger = &quot;flip&quot;,
     it_vortex__openclose = &quot;toggle&quot;,

Deleted: trunk/data/gfx32/it-burnable_ash.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/it-burnable_burning.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/it-burnable_fireproof.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/it-burnable_ignite.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/it-burnable_oil.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/it-flagblack.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/it-flagwhite.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/it_burnable_ash.png (from rev 1492, trunk/data/gfx32/it-burnable_ash.png)

Copied: trunk/data/gfx32/it_burnable_burning.png (from rev 1492, trunk/data/gfx32/it-burnable_burning.png)

Copied: trunk/data/gfx32/it_burnable_fireproof.png (from rev 1492, trunk/data/gfx32/it-burnable_fireproof.png)

Copied: trunk/data/gfx32/it_burnable_ignite.png (from rev 1492, trunk/data/gfx32/it-burnable_ignite.png)

Copied: trunk/data/gfx32/it_burnable_oil.png (from rev 1492, trunk/data/gfx32/it-burnable_oil.png)

Copied: trunk/data/gfx32/it_flag_black.png (from rev 1494, trunk/data/gfx32/it-flagblack.png)

Copied: trunk/data/gfx32/it_flag_white.png (from rev 1494, trunk/data/gfx32/it-flagwhite.png)

Deleted: trunk/data/gfx40/it-burnable_ash.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/it-burnable_burning.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/it-burnable_fireproof.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/it-burnable_ignite.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/it-burnable_oil.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/it-flagblack.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/it-flagwhite.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/it_burnable_ash.png (from rev 1492, trunk/data/gfx40/it-burnable_ash.png)

Copied: trunk/data/gfx40/it_burnable_burning.png (from rev 1492, trunk/data/gfx40/it-burnable_burning.png)

Copied: trunk/data/gfx40/it_burnable_fireproof.png (from rev 1492, trunk/data/gfx40/it-burnable_fireproof.png)

Copied: trunk/data/gfx40/it_burnable_ignite.png (from rev 1492, trunk/data/gfx40/it-burnable_ignite.png)

Copied: trunk/data/gfx40/it_burnable_oil.png (from rev 1492, trunk/data/gfx40/it-burnable_oil.png)

Copied: trunk/data/gfx40/it_flag_black.png (from rev 1494, trunk/data/gfx40/it-flagblack.png)

Copied: trunk/data/gfx40/it_flag_white.png (from rev 1494, trunk/data/gfx40/it-flagwhite.png)

Deleted: trunk/data/gfx48/it-burnable_ash.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/it-burnable_burning.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/it-burnable_fireproof.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/it-burnable_ignite.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/it-burnable_oil.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/it-flagblack.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/it-flagwhite.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/it_burnable_ash.png (from rev 1492, trunk/data/gfx48/it-burnable_ash.png)

Copied: trunk/data/gfx48/it_burnable_burning.png (from rev 1492, trunk/data/gfx48/it-burnable_burning.png)

Copied: trunk/data/gfx48/it_burnable_fireproof.png (from rev 1492, trunk/data/gfx48/it-burnable_fireproof.png)

Copied: trunk/data/gfx48/it_burnable_ignite.png (from rev 1492, trunk/data/gfx48/it-burnable_ignite.png)

Copied: trunk/data/gfx48/it_burnable_oil.png (from rev 1492, trunk/data/gfx48/it-burnable_oil.png)

Copied: trunk/data/gfx48/it_flag_black.png (from rev 1494, trunk/data/gfx48/it-flagblack.png)

Copied: trunk/data/gfx48/it_flag_white.png (from rev 1494, trunk/data/gfx48/it-flagwhite.png)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/data/models-2d.lua	2009-01-31 00:26:52 UTC (rev 1495)
@@ -458,8 +458,8 @@
         &quot;it_document&quot;,
         &quot;it-drop&quot;,
         &quot;it-dynamite&quot;,
-        &quot;it-flagblack&quot;,
-        &quot;it-flagwhite&quot;,
+        &quot;it_flag_black&quot;,
+        &quot;it_flag_white&quot;,
         &quot;it-odometer&quot;,
         &quot;it_pencil&quot;,
         &quot;it_pin&quot;,
@@ -533,7 +533,7 @@
 
 -- Oil --
 do
-    DefSubimages(&quot;it-burnable_oil&quot;, {h=4})
+    DefSubimages(&quot;it_burnable_oil&quot;, {h=4})
 end
 
 -- Laserbeams --
@@ -590,17 +590,17 @@
 
 -- Burning Floor --
 do
-    local images = DefSubimages(&quot;it-burnable_ignite&quot;, {h=8})
+    local images = DefSubimages(&quot;it_burnable_ignite&quot;, {h=8})
     local frames = BuildFrames(images, 100)
-    DefAnim(&quot;it-burnable_ignited&quot;, frames)
+    DefAnim(&quot;it_burnable_ignited&quot;, frames)
 
-    local images = DefSubimages(&quot;it-burnable_burning&quot;, {h=8})
+    local images = DefSubimages(&quot;it_burnable_burning&quot;, {h=8})
     local frames = BuildFrames(images, 100)
-    DefAnim(&quot;it-burnable_burning&quot;, frames)
+    DefAnim(&quot;it_burnable_burning&quot;, frames)
 
     -- Simple fire related items:
-    DefImages({&quot;it-burnable_ash&quot;, &quot;it-burnable_fireproof&quot;})
-    DefAlias(&quot;it-burnable&quot;, &quot;invisible&quot;)
+    DefImages({&quot;it_burnable_ash&quot;, &quot;it_burnable_fireproof&quot;})
+    DefAlias(&quot;it_burnable_invisible&quot;, &quot;invisible&quot;)
 end
 
 -- it-coffee --

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/data/schemas/objects.xml	2009-01-31 00:26:52 UTC (rev 1495)
@@ -98,6 +98,7 @@
     &lt;msg name=&quot;darken&quot; type=&quot;nil&quot;/&gt;
     &lt;msg name=&quot;disconnect&quot; type=&quot;nil&quot;/&gt;
     &lt;msg name=&quot;expl&quot; type=&quot;nil&quot;/&gt;
+    &lt;msg name=&quot;extinguish&quot; type=&quot;nil&quot;/&gt;
     &lt;msg name=&quot;fire&quot; type=&quot;nil&quot;/&gt;
     &lt;msg name=&quot;flip&quot; type=&quot;nil&quot;/&gt;
     &lt;msg name=&quot;forcefire&quot; type=&quot;nil&quot;/&gt;
@@ -390,6 +391,31 @@
       &lt;attr name=&quot;coin_value&quot; default=&quot;3&quot;/&gt;
       &lt;attr name=&quot;state&quot; rw=&quot;r&quot;/&gt;
     &lt;/object&gt;
+    &lt;object name=&quot;it_burnable&quot;&gt;
+      &lt;attr name=&quot;state&quot; max=&quot;5&quot; rw=&quot;r&quot;/&gt;
+      &lt;msg name=&quot;extinguish&quot;/&gt;
+      &lt;msg name=&quot;ignite&quot;/&gt;
+      &lt;msg name=&quot;_brush&quot;/&gt;
+      &lt;msg name=&quot;_explosion&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;it_burnable_invisible&quot;&gt;
+      &lt;attr name=&quot;state&quot; value=&quot;0&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;it_burnable_oil&quot;&gt;
+      &lt;attr name=&quot;state&quot; value=&quot;1&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;it_burnable_ignited&quot;&gt;
+      &lt;attr name=&quot;state&quot; value=&quot;2&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;it_burnable_burning&quot;&gt;
+      &lt;attr name=&quot;state&quot; value=&quot;3&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;it_burnable_ash&quot;&gt;
+      &lt;attr name=&quot;state&quot; value=&quot;4&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;it_burnable_fireproof&quot;&gt;
+      &lt;attr name=&quot;state&quot; value=&quot;5&quot;/&gt;
+    &lt;/object&gt;
     &lt;object name=&quot;it_coin_s&quot;&gt;
       &lt;attr name=&quot;state&quot; value=&quot;0&quot;/&gt;
     &lt;/object&gt;
@@ -399,7 +425,7 @@
     &lt;object name=&quot;it_coin_l&quot;&gt;
       &lt;attr name=&quot;state&quot; value=&quot;2&quot;/&gt;
     &lt;/object&gt;
-     &lt;object name=&quot;it_crack&quot;&gt;
+    &lt;object name=&quot;it_crack&quot;&gt;
       &lt;attr name=&quot;state&quot; min=&quot;-1&quot; max=&quot;3&quot;/&gt;
       &lt;attr name=&quot;fragility&quot;/&gt;
       &lt;attr name=&quot;spreading&quot;/&gt;
@@ -418,7 +444,7 @@
     &lt;object name=&quot;it_crack_l&quot;&gt;
       &lt;attr name=&quot;state&quot; value=&quot;2&quot;/&gt;
     &lt;/object&gt;
-   &lt;object name=&quot;it_cross&quot;&gt;
+    &lt;object name=&quot;it_cross&quot;&gt;
       &lt;attr name=&quot;interval&quot; default=&quot;10&quot;/&gt;
       &lt;attr name=&quot;state&quot; rw=&quot;r&quot;/&gt;
       &lt;msg name=&quot;_brush&quot;/&gt;
@@ -428,7 +454,7 @@
     &lt;object name=&quot;it_document&quot;&gt;
       &lt;attr name=&quot;text&quot;/&gt;
     &lt;/object&gt;
-     &lt;object name=&quot;it_extinguisher&quot;&gt;
+    &lt;object name=&quot;it_extinguisher&quot;&gt;
       &lt;attr name=&quot;state&quot; max=&quot;2&quot;/&gt;
     &lt;/object&gt;
     &lt;object name=&quot;it_extinguisher_empty&quot;&gt;
@@ -446,6 +472,15 @@
     &lt;object name=&quot;it_glasses&quot;&gt;
       &lt;attr name=&quot;state&quot; max=&quot;31&quot;/&gt;
     &lt;/object&gt;
+    &lt;object name=&quot;it_flag&quot;&gt;
+      &lt;attr name=&quot;color&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;it_flag_black&quot;&gt;
+      &lt;attr name=&quot;color&quot; value=&quot;0&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;it_flag_white&quot;&gt;
+      &lt;attr name=&quot;color&quot; value=&quot;1&quot;/&gt;
+    &lt;/object&gt;
     &lt;object name=&quot;it_glasses_broken&quot;&gt;
       &lt;attr name=&quot;state&quot; value=&quot;0&quot;/&gt;
     &lt;/object&gt;

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/Makefile.am	2009-01-31 00:26:52 UTC (rev 1495)
@@ -208,8 +208,12 @@
 	items/BrakeItem.hh	\
 	items/BlockerItem.cc	\
 	items/BlockerItem.hh	\
+	items/BurnableItem.cc	\
+	items/BurnableItem.hh	\
 	items/Coin.cc		\
 	items/Coin.hh		\
+	items/CompatibilityItems.cc	\
+	items/CompatibilityItems.hh	\
 	items/Crack.cc		\
 	items/Crack.hh		\
 	items/CrossItem.cc	\

Modified: trunk/src/actors/Balls.cc
===================================================================
--- trunk/src/actors/Balls.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/actors/Balls.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -119,7 +119,7 @@
         // Shield, booze and invisibility can be activated in all states except DEAD
     
         if (state != DEAD) {
-            if (m.message == &quot;_shield&quot;) {
+            if (m.message == &quot;_shield&quot; &amp;&amp; getAttr(&quot;owner&quot;) ==  m.value) {
                 m_shield_rest_time += SHIELD_TIME;
                 update_halo();
                 handled = true;

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/floors.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -238,13 +238,13 @@
 }
 int Floor::get_fire_countdown() {
     if (Item *it = GetItem(get_pos()))
-        if (get_id(it) == it_burnable || get_id(it) == it_burnable_oil)
+        if (get_id(it) == it_burnable_invisible || get_id(it) == it_burnable_oil)
             return 0;
     return fire_countdown;
 }
 
 bool Floor::force_fire() {
-    SetItem(get_pos(), MakeItem(&quot;it-burnable_ignited&quot;));
+    SetItem(get_pos(), MakeItem(&quot;it_burnable_ignited&quot;));
     fire_countdown = 0;
     return true;
 }
@@ -404,7 +404,7 @@
         SetFloor(p, MakeFloor(get_firetransform().c_str()));
     // Remember, at this point &quot;this&quot; may be destroyed.
     if (!GetFloor(p)-&gt;has_firetype(flft_noash))
-        SetItem(p, MakeItem(&quot;it-burnable_ash&quot;));
+        SetItem(p, MakeItem(&quot;it_burnable_ash&quot;));
     return true; // fire extinguished  
 }
 
@@ -431,7 +431,7 @@
     if (cont_fire)
         // continue burning
         //   -&gt; put animation
-        SetItem(p, MakeItem(&quot;it-burnable_burning&quot;));
+        SetItem(p, MakeItem(&quot;it_burnable_burning&quot;));
     else
         stop_fire(false);
 }
@@ -440,7 +440,7 @@
     if (Item *it = GetItem(get_pos())) {
         ItemID id = get_id(it);
         if (selector == flft_burnable || selector == flft_ignitable) {
-            if (  id == it_burnable || id == it_burnable_oil )
+            if (  id == it_burnable_invisible || id == it_burnable_oil )
                 return true;
             if (  id == it_burnable_ash     || id == it_burnable_fireproof
                || id == it_burnable_ignited || id == it_burnable_burning )

Added: trunk/src/items/BurnableItem.cc
===================================================================
--- trunk/src/items/BurnableItem.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/items/BurnableItem.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -0,0 +1,96 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include &quot;items/BurnableItem.hh&quot;
+//#include &quot;errors.hh&quot;
+//#include &quot;main.hh&quot;
+#include &quot;world.hh&quot;
+
+namespace enigma {
+
+    BurnableItem::BurnableItem(int type) {
+        state = type;
+    }
+    
+    std::string BurnableItem::getClass() const {
+        return &quot;it_burnable&quot;;
+    }
+    
+    Value BurnableItem::message(const Message &amp;m) {
+        if (m.message == &quot;extinguish&quot;) {   // stop / never start burning
+            state = FIREPROOF;
+            init_model();
+            return Value();
+        } else if (m.message == &quot;_brush&quot; &amp;&amp; (state == ASH || state == FIREPROOF)) {
+            kill();   // The brush cleans the floor
+            return Value();
+        } else if (Floor *fl = GetFloor(get_pos())) {
+            if (m.message == &quot;ignite&quot; || m.message == &quot;_explosion&quot;)
+                return SendMessage(fl, &quot;ignite&quot;);
+        }
+        return Item::message(m);
+    }
+    
+    void BurnableItem::setState(int extState) {
+        // ignore set state attempts
+    }
+    
+    void BurnableItem::init_model() {
+        if(state == OIL) {
+            set_model(ecl::strf(&quot;it_burnable_oil%d&quot;, IntegerRand(1, 4)));  // TODO store and keep model subtyp!
+        } else
+            Item::init_model();
+    }
+    
+    void BurnableItem::animcb() {
+        if(Floor *fl = GetFloor(get_pos()))
+            fl-&gt;on_burnable_animcb(state == IGNITE);
+    }
+    
+    bool BurnableItem::actor_hit(Actor *a) {
+        if (state == IGNITE || state == BURNING)
+            SendMessage(a, &quot;_shatter&quot;);
+        return false;
+    }
+
+    int BurnableItem::traitsIdx() const {
+        return state;
+    }
+    
+    ItemTraits BurnableItem::traits[6] = {
+        {&quot;it_burnable_invisible&quot;, it_burnable_invisible, itf_static, 0.0},
+        {&quot;it_burnable_oil&quot;,       it_burnable_oil,       itf_static, 0.0},
+        {&quot;it_burnable_ignited&quot;,   it_burnable_ignited,   itf_static | itf_animation | itf_fireproof, 0.0},
+        {&quot;it_burnable_burning&quot;,   it_burnable_burning,   itf_static | itf_animation | itf_fireproof, 0.0},
+        {&quot;it_burnable_ash&quot;,       it_burnable_ash,       itf_static | itf_fireproof, 0.0},
+        {&quot;it_burnable_fireproof&quot;, it_burnable_fireproof, itf_static | itf_fireproof, 0.0},
+    };
+
+    BOOT_REGISTER_START
+        BootRegister(new BurnableItem(0), &quot;it_burnable&quot;);
+        BootRegister(new BurnableItem(0), &quot;it_burnable_invisible&quot;);
+        BootRegister(new BurnableItem(1), &quot;it_burnable_oil&quot;);
+        BootRegister(new BurnableItem(2), &quot;it_burnable_ignited&quot;);
+        BootRegister(new BurnableItem(3), &quot;it_burnable_burning&quot;);
+        BootRegister(new BurnableItem(4), &quot;it_burnable_ash&quot;);
+        BootRegister(new BurnableItem(5), &quot;it_burnable_fireproof&quot;);
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/items/BurnableItem.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/BurnableItem.hh
===================================================================
--- trunk/src/items/BurnableItem.hh	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/items/BurnableItem.hh	2009-01-31 00:26:52 UTC (rev 1495)
@@ -0,0 +1,73 @@
+/*
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef BURNABLEITEM_HH
+#define BURNABLEITEM_HH
+
+#include &quot;items.hh&quot;
+
+//#include &quot;enigma.hh&quot;
+
+namespace enigma {
+    /**
+     * Used for animations and interfaces of fire. Study 
+     * floors.hh and floors.cc for the fire implementation.
+     */
+
+    class BurnableItem : public Item {
+        CLONEOBJ(BurnableItem);
+        DECL_ITEMTRAITS_ARRAY(6, traitsIdx());
+
+    private:
+        enum iState {
+            IDLE       =  0,       ///&lt; 
+            OIL        =  1,       ///&lt; 
+            IGNITE     =  2,       ///&lt;
+            BURNING    =  3,       ///&lt;  
+            ASH        =  4,       ///&lt;  
+            FIREPROOF  =  5,       ///&lt;  
+        };
+
+    public:
+        BurnableItem(int type);
+        
+        // Object interface
+        virtual std::string getClass() const;
+        virtual Value message (const Message &amp;m);
+
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Item interface
+        virtual bool actor_hit(Actor *a);
+        
+    private:
+        void crack();
+        void spread();
+        int traitsIdx() const;
+    };
+   
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/items/BurnableItem.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/CompatibilityItems.cc
===================================================================
--- trunk/src/items/CompatibilityItems.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/items/CompatibilityItems.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -0,0 +1,173 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include &quot;items/CompatibilityItems.hh&quot;
+//#include &quot;errors.hh&quot;
+//#include &quot;main.hh&quot;
+#include &quot;server.hh&quot;
+#include &quot;world.hh&quot;
+
+namespace enigma {
+
+/* -------------------- EasyKeepStone -------------------- */
+
+    EasyKeepStone::EasyKeepStone() {
+    }
+    
+    Value EasyKeepStone::message(const Message &amp;m) {
+        if (m.message == &quot;_init&quot;) {
+            // does not work in on_creation() because items are created
+            // before stones are created.
+            if (server::GetDifficulty() == DIFFICULTY_HARD)
+                KillStone(get_pos());
+            kill();
+            return Value();
+        }
+        return Item::message(m);
+    }
+
+    DEF_ITEMTRAITSF(EasyKeepStone, &quot;it-easykeepstone&quot;, it_easykeepstone,  itf_invisible | itf_fireproof);
+
+/* -------------------- EasyKillStone -------------------- */
+
+/*
+This item is never visible during the game.  Its only purpose is to
+modify the level if the difficulty mode is set to easy *before* the
+game starts.
+
+In easy game mode this item removes the stone at its position.  Then
+in both modes it kills itself.
+
+E.g. it can be used to hide walls in easy game mode.
+
+\ref st-easymode
+*/
+
+    EasyKillStone::EasyKillStone() {
+    }
+    
+    Value EasyKillStone::message(const Message &amp;m) {
+        if (m.message == &quot;_init&quot;) {
+            // does not work in on_creation() because items are created
+            // before stones are created.
+            if (server::GetDifficulty() == DIFFICULTY_EASY) {
+                if (Stone *st = GetStone (get_pos())) {
+                    if (st-&gt;is_kind (&quot;st_death&quot;) ||
+                        st-&gt;is_kind (&quot;st_flash&quot;) ||
+                        st-&gt;is_kind (&quot;st_thief&quot;))
+                    {
+                        SetStone (get_pos(), MakeStone (&quot;st_flat&quot;));
+                    }
+                    else
+                        KillStone(get_pos());
+                }
+            }
+            kill();
+            return Value();
+        }
+        return Item::message(m);
+    }
+    
+    DEF_ITEMTRAITSF(EasyKillStone, &quot;it-easykillstone&quot;, it_easykillstone, itf_invisible | itf_fireproof);
+
+/* -------------------- SingleKillStone -------------------- */
+
+    OnePKillStone::OnePKillStone() {
+    }
+    
+    Value OnePKillStone::message(const Message &amp;m) {
+        if (m.message == &quot;_init&quot;) {
+            if (server::SingleComputerGame)
+                KillStone (get_pos());
+            kill();
+            return Value();
+        }
+        return Item::message(m);
+    }
+    
+    DEF_ITEMTRAITSF(OnePKillStone, &quot;it-1pkillstone&quot;, it_1pkillstone, itf_invisible | itf_fireproof);
+
+/* -------------------- NetworkKillStone -------------------- */
+
+    TwoPKillStone::TwoPKillStone() {
+    }
+  
+    Value TwoPKillStone::message(const Message &amp;m) {
+        if (m.message == &quot;_init&quot;) {
+            if (!server::SingleComputerGame)
+                KillStone (get_pos());
+            kill();
+            return Value();
+        }
+        return Item::message(m);
+    }
+
+    DEF_ITEMTRAITSF(TwoPKillStone, &quot;it-2pkillstone&quot;, it_2pkillstone, itf_invisible | itf_fireproof);
+
+//----------------------------------------
+// Bridge item (for Oxyd compatibility)
+//
+// Floor tiles seem to be static in Oxyd and cannot change dynamically
+// or be animated.  For this reason, every bridge floor in Oxyd has to
+// be combined with a bridge &quot;item&quot; that receives the signals, shows
+// the animation and sets or removes the floor.
+//----------------------------------------
+
+    OxydBridge::OxydBridge() {
+    }
+
+    Value OxydBridge::message(const Message &amp;m) {
+        if (m.message == &quot;signal&quot;) {
+            int ival = m.value;
+            Floor *floor = GetFloor (get_pos());
+            if (ival &gt; 0)
+                SendMessage (floor, &quot;close&quot;);
+            else
+                SendMessage (floor, &quot;open&quot;);
+            return Value();
+        }
+        return Item::message(m);
+    }
+    
+    DEF_ITEMTRAITSF(OxydBridge, &quot;it-bridge-oxyd&quot;, it_bridge_oxyd,
+            itf_static | itf_indestructible | itf_invisible | itf_fireproof);
+
+/* -------------------- OxydBridgeActive -------------------- */
+    OxydBridgeActive::OxydBridgeActive() {
+    }
+    
+    void OxydBridgeActive::on_creation (GridPos p) {
+        Floor *floor = GetFloor (p);
+        SendMessage (floor, &quot;close&quot;);
+    }
+
+    DEF_ITEMTRAITSF(OxydBridgeActive, &quot;it-bridge-oxyd_active&quot;, it_bridge_oxyd_active,
+            itf_static | itf_indestructible | itf_invisible | itf_fireproof);
+
+    BOOT_REGISTER_START
+        BootRegister(new EasyKeepStone(), &quot;it-easykeepstone&quot;);
+        BootRegister(new EasyKillStone(), &quot;it-easykillstone&quot;);
+        BootRegister(new OnePKillStone(), &quot;it-1pkillstone&quot;);
+        BootRegister(new TwoPKillStone(), &quot;it-2pkillstone&quot;);
+        BootRegister(new OxydBridge(), &quot;it-bridge-oxyd&quot;);
+        BootRegister(new OxydBridgeActive(), &quot;it-bridge-oxyd_active&quot;);
+    BOOT_REGISTER_END
+
+} // namespace enigma
+


Property changes on: trunk/src/items/CompatibilityItems.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/items/CompatibilityItems.hh
===================================================================
--- trunk/src/items/CompatibilityItems.hh	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/items/CompatibilityItems.hh	2009-01-31 00:26:52 UTC (rev 1495)
@@ -0,0 +1,107 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef COMPATIBILITYITEMS_HH
+#define COMPATIBILITYITEMS_HH
+
+#include &quot;items.hh&quot;
+
+#include &quot;enigma.hh&quot;
+
+namespace enigma {
+    /**
+     * EasyKeepStone
+     */
+    class EasyKeepStone : public Item {
+        CLONEOBJ(EasyKeepStone);
+        DECL_ITEMTRAITS;
+    public:
+        EasyKeepStone();
+        
+        // Object interface
+        virtual Value message(const Message &amp;m);
+    };
+
+    /**
+     * EasyKillStone
+     */
+    class EasyKillStone : public Item {
+        CLONEOBJ(EasyKillStone);
+        DECL_ITEMTRAITS;
+    public:
+        EasyKillStone();
+        
+        // Object interface
+        virtual Value message(const Message &amp;m);
+    };
+
+    /**
+     * OnePKillStone
+     */
+    class OnePKillStone : public Item {
+        CLONEOBJ (OnePKillStone);
+        DECL_ITEMTRAITS;
+    public:
+        OnePKillStone();
+        
+        // Object interface
+        virtual Value message(const Message &amp;m);
+    };
+
+    /**
+     * TwoPKillStone
+     */
+    class TwoPKillStone : public Item {
+        CLONEOBJ (TwoPKillStone);
+        DECL_ITEMTRAITS;
+    public:
+        TwoPKillStone();
+        
+        // Object interface
+        virtual Value message(const Message &amp;m);
+    };
+
+    /**
+     * OxydBridge
+     */
+    class OxydBridge : public Item {
+        CLONEOBJ(OxydBridge);
+        DECL_ITEMTRAITS;
+    public:
+        OxydBridge();
+        
+        // Object interface
+        virtual Value message(const Message &amp;m);
+    };
+
+    /**
+     * OxydBridgeActive
+     */
+    class OxydBridgeActive : public OxydBridge {
+        CLONEOBJ(OxydBridgeActive);
+        DECL_ITEMTRAITS;
+    public:
+        OxydBridgeActive();
+        
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/items/CompatibilityItems.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/items/Crack.cc
===================================================================
--- trunk/src/items/Crack.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/items/Crack.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -78,12 +78,13 @@
         KillItem(p);
     }
     
-    void Crack::actor_enter(Actor *a) {
+    bool Crack::actor_hit(Actor *a) {
         if (a-&gt;is_on_floor()) {
             crack();
             if (state &lt; DISSOLVING)
                 spread();
         }
+        return false;
     }
     
     void Crack::crack() {

Modified: trunk/src/items/Crack.hh
===================================================================
--- trunk/src/items/Crack.hh	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/items/Crack.hh	2009-01-31 00:26:52 UTC (rev 1495)
@@ -60,7 +60,7 @@
         virtual void animcb();
         
         // Item interface
-        virtual void actor_enter(Actor *a);
+        virtual bool actor_hit(Actor *a);
         
     private:
         void crack();

Modified: trunk/src/items/Extinguisher.cc
===================================================================
--- trunk/src/items/Extinguisher.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/items/Extinguisher.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -86,7 +86,7 @@
             SendMessage (it, &quot;extinguish&quot;);
         } else {
             // set extinguishing foam to prevent upcoming fire
-            SetItem (p, MakeItem(&quot;it-burnable_fireproof&quot;));
+            SetItem (p, MakeItem(&quot;it_burnable_fireproof&quot;));
         }
     }
     

Modified: trunk/src/items/SimpleItems.cc
===================================================================
--- trunk/src/items/SimpleItems.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/items/SimpleItems.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -98,6 +98,29 @@
     
     DEF_ITEMTRAITSF(DeathItem, &quot;it_death&quot;, it_death, itf_static | itf_indestructible);
 
+/* -------------------- Flag -------------------- */
+
+    FlagItem::FlagItem(int type) {
+        Item::setAttr(&quot;color&quot;, type);
+    }
+    
+    void FlagItem::on_drop(Actor *a) {
+        player::SetRespawnPositions(get_pos(), getAttr(&quot;color&quot;));
+    }
+    
+    void FlagItem::on_pickup(Actor *a) {
+        player::RemoveRespawnPositions(getAttr(&quot;color&quot;));
+    }
+    
+    int FlagItem::traitsIdx() const {
+        return getAttr(&quot;color&quot;);
+    }
+    
+    ItemTraits FlagItem::traits[2] = {
+        {&quot;it_flag_black&quot;, it_flag_black,  itf_none, 0.0},
+        {&quot;it_flag_white&quot;, it_flag_white,  itf_none, 0.0},
+    };
+
 /* -------------------- Pencil -------------------- */
 
     Pencil::Pencil() {
@@ -337,6 +360,9 @@
         BootRegister(new Cherry(), &quot;it_cherry&quot;);
         BootRegister(new Coffee(), &quot;it_coffee&quot;);
         BootRegister(new DeathItem(), &quot;it_death&quot;);
+        BootRegister(new FlagItem(0), &quot;it_flag&quot;);
+        BootRegister(new FlagItem(0), &quot;it_flag_black&quot;);
+        BootRegister(new FlagItem(1), &quot;it_flag_white&quot;);
         BootRegister(new Floppy(), &quot;it_floppy&quot;);
         BootRegister(new MagicWand(), &quot;it_magicwand&quot;);
         BootRegister(new Key(), &quot;it_key&quot;);

Modified: trunk/src/items/SimpleItems.hh
===================================================================
--- trunk/src/items/SimpleItems.hh	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/items/SimpleItems.hh	2009-01-31 00:26:52 UTC (rev 1495)
@@ -96,6 +96,23 @@
     };
 
     /**
+     * FlagItem
+     */
+    class FlagItem : public Item {
+        CLONEOBJ(FlagItem);
+        DECL_ITEMTRAITS_ARRAY(2, traitsIdx());
+    public:
+        FlagItem(int type);
+        
+        // Item interface
+       virtual void on_drop(Actor *a);
+       virtual void on_pickup(Actor *a);
+        
+    private:
+        int traitsIdx() const;
+    };
+    
+    /**
      * Floppy
      */
     DEF_ITEM(Floppy, &quot;it_floppy&quot;, it_floppy);

Modified: trunk/src/items/Umbrella.cc
===================================================================
--- trunk/src/items/Umbrella.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/items/Umbrella.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -58,7 +58,7 @@
     }
     
     ItemAction Umbrella::activate(Actor *a, GridPos) {
-        SendMessage(a, &quot;_shield&quot;);
+        BroadcastMessage(&quot;_shield&quot;, a-&gt;getAttr(&quot;owner&quot;), GRID_NONE_BIT, true);
         return ITEM_KILL;
     }
     

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/items.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -540,299 +540,6 @@
                 itf_static | itf_animation | itf_indestructible | itf_fireproof);
 }
 
-
-/* -------------------- Burning floor -------------------- */
-
-namespace
-{
-    /* Used for animations and interfaces of fire. Study    */
-    /* floors.hh and floors.cc for the fire implementation. */
-
-    class Burnable : public Item {
-        CLONEOBJ(Burnable);
-        DECL_ITEMTRAITS_ARRAY(6, state);
-    public:
-        static void setup() {
-            RegisterItem (new Burnable(IDLE));
-            RegisterItem (new Burnable(IGNITE));
-            RegisterItem (new Burnable(BURNING));
-            RegisterItem (new Burnable(FIREPROOF));
-            RegisterItem (new Burnable(ASH));
-            RegisterItem (new Burnable(OIL));
-        }
-    private:
-        enum State { IDLE, IGNITE, BURNING, FIREPROOF, ASH, OIL };
-        Burnable (State initstate) {
-            state = initstate;
-        }
-        State state;
-
-        virtual Value message(const Message &amp;m);
-        void animcb();
-        bool actor_hit(Actor *a);
-        void init_model();
-    };
-
-    ItemTraits Burnable::traits[6] = {
-        {&quot;it-burnable&quot;,           it_burnable,           itf_static, 0.0},
-        {&quot;it-burnable_ignited&quot;,   it_burnable_ignited,
-             itf_static | itf_animation | itf_fireproof, 0.0},
-        {&quot;it-burnable_burning&quot;,   it_burnable_burning,
-             itf_static | itf_animation | itf_fireproof, 0.0},
-        {&quot;it-burnable_fireproof&quot;, it_burnable_fireproof,
-             itf_static | itf_fireproof, 0.0},
-        {&quot;it-burnable_ash&quot;,       it_burnable_ash,
-             itf_static | itf_fireproof, 0.0},
-        {&quot;it-burnable_oil&quot;,       it_burnable_oil,       itf_static, 0.0},
-    };
-}
-
-Value Burnable::message(const Message &amp;m) {
-    if (m.message == &quot;extinguish&quot;) {   // stop / never start burning
-        state = FIREPROOF;
-        init_model();
-        return Value();
-    } else if (m.message == &quot;_brush&quot; &amp;&amp; (state == ASH || state == FIREPROOF)) {
-        kill();   // The brush cleans the floor
-        return Value();
-    } else if (Floor *fl = GetFloor(get_pos())) {
-        if (m.message == &quot;ignite&quot; || m.message == &quot;_explosion&quot;)
-            return SendMessage(fl, &quot;ignite&quot;);
-    }
-    return Item::message(m);
-}
-
-void Burnable::animcb() {
-    if(Floor *fl = GetFloor(get_pos()))
-        fl-&gt;on_burnable_animcb(state == IGNITE);
-}
-
-bool Burnable::actor_hit(Actor *a) {
-    if (state == IGNITE || state == BURNING)
-        SendMessage(a, &quot;_shatter&quot;);
-    return false;
-}
-
-void Burnable::init_model() {
-    if(state == OIL) {
-        string mymodel = &quot;it-burnable_oil&quot;;
-        mymodel = mymodel + ecl::strf(&quot;%d&quot;, IntegerRand(1, 4));
-        set_model(mymodel.c_str());
-    } else
-        Item::init_model();
-}
-
-
-/* -------------------- Flags -------------------- */
-
-namespace
-{
-    /*! Flags can be used to set a new respawn point for the black or
-      white marble. */
-    class FlagBlack : public Item {
-        CLONEOBJ(FlagBlack);
-        DECL_ITEMTRAITS;
-
-        void on_drop(Actor *) {
-            player::SetRespawnPositions(get_pos(), true);
-        }
-        void on_pickup(Actor *) {
-            player::RemoveRespawnPositions(true);
-        }
-
-    public:
-        FlagBlack() {}
-    };
-    DEF_ITEMTRAITS(FlagBlack, &quot;it-flagblack&quot;, it_flagblack);
-
-    class FlagWhite : public Item {
-        CLONEOBJ(FlagWhite);
-        DECL_ITEMTRAITS;
-
-        void on_drop(Actor *) {
-            player::SetRespawnPositions(get_pos(), false);
-        }
-        void on_pickup(Actor *) {
-            player::RemoveRespawnPositions(false);
-        }
-
-    public:
-        FlagWhite()
-        {}
-    };
-
-    DEF_ITEMTRAITS(FlagWhite, &quot;it-flagwhite&quot;, it_flagwhite);
-}
-
-
-//----------------------------------------
-// Bridge item (for Oxyd compatibility)
-//
-// Floor tiles seem to be static in Oxyd and cannot change dynamically
-// or be animated.  For this reason, every bridge floor in Oxyd has to
-// be combined with a bridge &quot;item&quot; that receives the signals, shows
-// the animation and sets or removes the floor.
-//----------------------------------------
-namespace
-{
-    class OxydBridge : public Item {
-        CLONEOBJ(OxydBridge);
-        DECL_ITEMTRAITS;
-
-        virtual Value message(const Message &amp;m) {
-            if (m.message == &quot;signal&quot;) {
-                int ival = m.value;
-                Floor *floor = GetFloor (get_pos());
-                if (ival &gt; 0)
-                    SendMessage (floor, &quot;close&quot;);
-                else
-                    SendMessage (floor, &quot;open&quot;);
-                return Value();
-            }
-            return Item::message(m);
-        }
-    public:
-        OxydBridge() {}
-    };
-    DEF_ITEMTRAITSF(OxydBridge, &quot;it-bridge-oxyd&quot;, it_bridge_oxyd,
-                itf_static | itf_indestructible | itf_invisible | itf_fireproof);
-
-    class OxydBridgeActive : public OxydBridge {
-        CLONEOBJ(OxydBridgeActive);
-        DECL_ITEMTRAITS;
-
-        void on_creation (GridPos p) {
-            Floor *floor = GetFloor (p);
-            SendMessage (floor, &quot;close&quot;);
-        }
-    public:
-        OxydBridgeActive() {}
-    };
-    DEF_ITEMTRAITSF(OxydBridgeActive, &quot;it-bridge-oxyd_active&quot;, it_bridge_oxyd_active,
-                itf_static | itf_indestructible | itf_invisible | itf_fireproof);
-}
-
-
-/* -------------------- EasyKillStone -------------------- */
-
-/*
-This item is never visible during the game.  Its only purpose is to
-modify the level if the difficulty mode is set to easy *before* the
-game starts.
-
-In easy game mode this item removes the stone at its position.  Then
-in both modes it kills itself.
-
-E.g. it can be used to hide walls in easy game mode.
-
-\ref st-easymode
-*/
-
-namespace
-{
-    class EasyKillStone : public Item {
-        CLONEOBJ(EasyKillStone);
-        DECL_ITEMTRAITS;
-
-        virtual Value message(const Message &amp;m);
-    public:
-        EasyKillStone() {}
-    };
-    DEF_ITEMTRAITSF(EasyKillStone, &quot;it-easykillstone&quot;,
-                it_easykillstone, itf_invisible | itf_fireproof);
-}
-
-Value EasyKillStone::message(const Message &amp;m)
-{
-    if (m.message == &quot;_init&quot;) {
-        // does not work in on_creation() because items are created
-        // before stones are created.
-        if (server::GetDifficulty() == DIFFICULTY_EASY) {
-            if (Stone *st = GetStone (get_pos())) {
-                if (st-&gt;is_kind (&quot;st_death&quot;) ||
-                    st-&gt;is_kind (&quot;st_flash&quot;) ||
-                    st-&gt;is_kind (&quot;st_thief&quot;))
-                {
-                    SetStone (get_pos(), MakeStone (&quot;st_flat&quot;));
-                }
-                else
-                    KillStone(get_pos());
-            }
-        }
-        kill();
-        return Value();
-    }
-    return Item::message(m);
-}
-
-/* -------------------- EasyKeepStone -------------------- */
-namespace
-{
-    class EasyKeepStone : public Item {
-        CLONEOBJ(EasyKeepStone);
-        DECL_ITEMTRAITS;
-
-        virtual Value message(const Message &amp;m) {
-            if (m.message == &quot;_init&quot;) {
-                // does not work in on_creation() because items are created
-                // before stones are created.
-                if (server::GetDifficulty() == DIFFICULTY_HARD)
-                    KillStone(get_pos());
-                kill();
-                return Value();
-            }
-            return Item::message(m);
-        }
-    public:
-        EasyKeepStone() {}
-    };
-    DEF_ITEMTRAITSF(EasyKeepStone, &quot;it-easykeepstone&quot;, it_easykeepstone,
-                itf_invisible | itf_fireproof);
-}
-
-/* -------------------- SingleKillStone -------------------- */
-namespace
-{
-    class OnePKillStone : public Item {
-        CLONEOBJ (OnePKillStone);
-        DECL_ITEMTRAITS;
-
-        virtual Value message (const Message &amp;m) {
-            if (m.message == &quot;_init&quot;) {
-                if (server::SingleComputerGame)
-                    KillStone (get_pos());
-                kill();
-                return Value();
-            }
-            return Item::message(m);
-        }
-    public:
-        OnePKillStone () {}
-    };
-    DEF_ITEMTRAITSF(OnePKillStone, &quot;it-1pkillstone&quot;, it_1pkillstone,
-                itf_invisible | itf_fireproof);
-
-    class TwoPKillStone : public Item {
-        CLONEOBJ (TwoPKillStone);
-        DECL_ITEMTRAITS;
-
-        virtual Value message (const Message &amp;m) {
-            if (m.message == &quot;_init&quot;) {
-                if (!server::SingleComputerGame)
-                    KillStone (get_pos());
-                kill();
-                return Value();
-            }
-            return Item::message(m);
-        }
-    public:
-        TwoPKillStone () {}
-    };
-    DEF_ITEMTRAITSF(TwoPKillStone, &quot;it-2pkillstone&quot;, it_2pkillstone,
-                itf_invisible | itf_fireproof);
-}
-
-
 /* -------------------- it-surprise -------------------- */
 namespace
 {
@@ -950,24 +657,15 @@
     RegisterItem (new BlackBombBurning);
     RegisterItem (new Booze);
     RegisterItem (new BrokenBooze);
-    Burnable::setup();
     RegisterItem (new Debris);
     RegisterItem (new Drop);
     RegisterItem (new Dummyitem);
     RegisterItem (new Dynamite);
-    RegisterItem (new EasyKillStone);
-    RegisterItem (new EasyKeepStone);
     RegisterItem (new Explosion1);
     RegisterItem (new Explosion2);
     RegisterItem (new Explosion3);
-    RegisterItem (new FlagBlack);
-    RegisterItem (new FlagWhite);
     RegisterItem (new Odometer);
-    RegisterItem (new OnePKillStone);
-    RegisterItem (new OxydBridge);
-    RegisterItem (new OxydBridgeActive);
     RegisterItem (new SurpriseItem);
-    RegisterItem (new TwoPKillStone);
     RegisterItem (new WhiteBomb);
 }
 

Modified: trunk/src/items.hh
===================================================================
--- trunk/src/items.hh	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/items.hh	2009-01-31 00:26:52 UTC (rev 1495)
@@ -40,7 +40,7 @@
         it_bridge_oxyd_active,
         it_booze_broken,
         it_brush,
-        it_burnable,
+        it_burnable_invisible,
         it_burnable_fireproof,
         it_burnable_ignited,
         it_burnable_burning,
@@ -73,8 +73,8 @@
         it_extinguisher_medium,
         it_extinguisher_empty,
         it_extralife,
-        it_flagblack,
-        it_flagwhite,
+        it_flag_black,
+        it_flag_white,
         it_floppy,
         it_glasses,
         it_glasses_broken,

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/ox_magnum.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -315,8 +315,8 @@
     &quot;it_key_c&quot;,         // OxydMagnum item 0x16
     &quot;it_floppy&quot;,        // OxydMagnum item 0x17
     &quot;it_sword&quot;,         // OxydMagnum item 0x18
-    &quot;it-flagwhite&quot;,     // OxydMagnum item 0x19
-    &quot;it-flagblack&quot;,     // OxydMagnum item 0x1a
+    &quot;it_flag_white&quot;,    // OxydMagnum item 0x19
+    &quot;it_flag_black&quot;,    // OxydMagnum item 0x1a
     &quot;it_ring&quot;,          // OxydMagnum item 0x1b
     &quot;it_pipe_nw&quot;,       // OxydMagnum item 0x1c
     &quot;it_pipe_sw&quot;,       // OxydMagnum item 0x1d

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/ox_oxyd1.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -331,8 +331,8 @@
     &quot;it_key_c&quot;,                   // 0x16
     &quot;it_floppy&quot;,                  // 0x17
     &quot;it_sword&quot;,                   // 0x18
-    &quot;it-flagwhite&quot;,               // 0x19
-    &quot;it-flagblack&quot;,               // 0x1a
+    &quot;it_flag_white&quot;,               // 0x19
+    &quot;it_flag_black&quot;,               // 0x1a
     &quot;it_ring&quot;,                    // 0x1b
     &quot;it_pipe_nw&quot;,                 // 0x1c
     &quot;it_pipe_sw&quot;,                 // 0x1d

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/ox_peroxyd.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -403,8 +403,8 @@
     &quot;it_key_b&quot;,                   // 0x15
     &quot;it_key_c&quot;,                   // 0x16
     &quot;it_floppy&quot;,                  // 0x17
-    &quot;it-flagwhite&quot;,               // 0x18
-    &quot;it-flagblack&quot;,               // 0x19
+    &quot;it_flag_white&quot;,              // 0x18
+    &quot;it_flag_black&quot;,              // 0x19
     &quot;it_ring&quot;,                    // 0x1a
     &quot;it_pipe_nw&quot;,                 // 0x1b
     &quot;it_pipe_sw&quot;,                 // 0x1c

Modified: trunk/src/player.cc
===================================================================
--- trunk/src/player.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/player.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -292,7 +292,7 @@
 }
 
 /*! Sets respawn positions for black or white actors. */
-void player::SetRespawnPositions(GridPos pos, bool black) 
+void player::SetRespawnPositions(GridPos pos, Value color) 
 {
     ecl::V2 center = pos.center();
 
@@ -300,8 +300,8 @@
         vector&lt;Actor *&gt; &amp;al = players[i].actors;
 
         for (unsigned j=0; j&lt;al.size(); ++j) {
-            if (Value color = al[j]-&gt;getAttr(&quot;color&quot;)) {
-                if (color == (black ? BLACK : WHITE))
+            if (Value ac = al[j]-&gt;getAttr(&quot;color&quot;)) {
+                if (ac == color)
                     al[j]-&gt;set_respawnpos(center);
             }
         }
@@ -309,13 +309,13 @@
 }
 
 /*! Remove respawn positions for black or white actors */
-void player::RemoveRespawnPositions(bool black) {
+void player::RemoveRespawnPositions(Value color) {
     for (unsigned i=0; i&lt;players.size(); ++i) {
         vector&lt;Actor *&gt; &amp;al = players[i].actors;
 
         for (unsigned j=0; j&lt;al.size(); ++j) {
-            if (Value color = al[j]-&gt;getAttr(&quot;color&quot;)) {
-                if (color == (black ? BLACK : WHITE))
+            if (Value ac = al[j]-&gt;getAttr(&quot;color&quot;)) {
+                if (ac == color)
                     al[j]-&gt;remove_respawnpos();
             }
         }

Modified: trunk/src/player.hh
===================================================================
--- trunk/src/player.hh	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/player.hh	2009-01-31 00:26:52 UTC (rev 1495)
@@ -64,8 +64,8 @@
 
         // set/remove respawn positions for all black or all white actors
         // (used when it-flagwhite/black is dropped)
-        void SetRespawnPositions(enigma::GridPos pos, bool black);
-        void RemoveRespawnPositions(bool black);
+        void SetRespawnPositions(enigma::GridPos pos, Value color);
+        void RemoveRespawnPositions(Value color);
 
         int      CurrentPlayer();
         void     SetCurrentPlayer(unsigned iplayer);

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2009-01-30 22:03:47 UTC (rev 1494)
+++ trunk/src/server.cc	2009-01-31 00:26:52 UTC (rev 1495)
@@ -502,7 +502,7 @@
 
     // ------------------------------ cheats
     else if (cmd == &quot;god&quot;) {
-        SendMessage(player::GetMainActor(player::CurrentPlayer()), &quot;_shield&quot;);
+        BroadcastMessage(&quot;_shield&quot;, player::CurrentPlayer(), GRID_NONE_BIT, true);
         client::Msg_Command(&quot;cheater&quot;);
     }
     else if (cmd == &quot;collision&quot;) {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000923.html">[Enigma-game-svn] r1494 - in trunk: data/schemas src src/others
</A></li>
	<LI>Next message: <A HREF="000925.html">[Enigma-game-svn] r1496 - in trunk/data/levels: enigma_cross	enigma_iii enigma_iv enigma_v enigma_vi enigma_vii enigma_viii
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#924">[ date ]</a>
              <a href="thread.html#924">[ thread ]</a>
              <a href="subject.html#924">[ subject ]</a>
              <a href="author.html#924">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
