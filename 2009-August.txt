From raoul at mail.berlios.de  Sat Aug  1 15:11:34 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sat, 1 Aug 2009 15:11:34 +0200
Subject: [Enigma-game-svn] r1776 - in trunk: . data/levels
	data/levels/pentomino_i doc/reference
Message-ID: <200908011311.n71DBY4b029812@sheep.berlios.de>

Author: raoul
Date: 2009-08-01 15:11:32 +0200 (Sat, 01 Aug 2009)
New Revision: 1776

Added:
   trunk/data/levels/pentomino_i/
Removed:
   trunk/data/levels/00makepreviews.sh
   trunk/data/levels/02grep_levels.pl
   trunk/data/levels/04crushprevievs.sh
   trunk/data/levels/04findtodo.sh
   trunk/data/levels/enigma_pentomino_i/
Modified:
   trunk/configure.ac
   trunk/data/levels/Makefile.am
   trunk/data/levels/pentomino_i/Makefile.am
   trunk/doc/reference/enigma-ref.texi
Log:
-> Moved pentomino level files
-> Removed some unused scripts
-> Fixed a bug in the refman



Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2009-07-31 00:52:41 UTC (rev 1775)
+++ trunk/configure.ac	2009-08-01 13:11:32 UTC (rev 1776)
@@ -384,7 +384,7 @@
            data/levels/enigma_sokoban/Makefile
            data/levels/enigma_microban/Makefile
            data/levels/enigma_mas_microban/Makefile
-           data/levels/enigma_pentomino_i/Makefile
+           data/levels/pentomino_i/Makefile
            data/levels/lib/Makefile
            data/levels/patches/Makefile
            data/fonts/Makefile

Deleted: trunk/data/levels/00makepreviews.sh
===================================================================
--- trunk/data/levels/00makepreviews.sh	2009-07-31 00:52:41 UTC (rev 1775)
+++ trunk/data/levels/00makepreviews.sh	2009-08-01 13:11:32 UTC (rev 1776)
@@ -1,57 +0,0 @@
-#!/bin/bash
-
-SCREENSHOTS=../../screenshots
-
-update_if_newer()  {
-    if [ -f $1 ]; then
-        if [ $1 -nt $2 ]; then
-            echo "creating $2"
-            convert $1 -crop 640x416+0+0 -resize 120x78 $2
-        fi
-    fi
-}
-
-update_for_subdir() {
-    if [ -d $1 ]; then
-        if [ -d $SCREENSHOTS/$1 ]; then
-            for shot in $SCREENSHOTS/$1/*.png; do
-                base=`basename $shot .png`
-                png="$1/$base.png"
-                update_if_newer $shot $png
-            done
-        fi
-    else
-        echo "Error: no such directory '$1'"
-        exit 1
-    fi
-}
-
-if [ -d $SCREENSHOTS ]; then
-    for shot in $SCREENSHOTS/*.png; do
-        base=`basename $shot .png`
-        png="$base.png"
-        update_if_newer $shot $png
-    done
-
-    update_for_subdir Sokoban
-    update_for_subdir m_tutor
-else
-    echo "Error: no such directory ($SCREENSHOTS)"
-    exit 1
-fi
-
-NEWPREVIEWS=`find . -name "*.png" -cmin -5`
-COUNT=`echo $NEWPREVIEWS | wc -w`
-
-if [ $COUNT = 0 ]; then
-    echo "All existing previews were up-to-date."
-else
-    # if pngcrush is installed crush previews
-    if [ -x /usr/local/bin/pngcrush ] ; then
-        ./04crushprevievs.sh $NEWPREVIEWS
-    elif which optipng ; then
-        optipng $NEWPREVIEWS
-    fi
-
-    echo "$COUNT preview(s) updated."
-fi

Deleted: trunk/data/levels/02grep_levels.pl
===================================================================
--- trunk/data/levels/02grep_levels.pl	2009-07-31 00:52:41 UTC (rev 1775)
+++ trunk/data/levels/02grep_levels.pl	2009-08-01 13:11:32 UTC (rev 1776)
@@ -1,62 +0,0 @@
-#!/usr/bin/perl -w
-
-my $outname = '+index_user.txt';
-my $regCount = $#ARGV+1;
-my $maxHits = 0;
-
-if ($regCount le 0) {
-  print "Usage: 02grep_levels.pl [<regex>]+\n";
-  print "       Greps all levels containing all <regex>s and create index_test.txt for these levels\n";
-
-  unlink $outname;
-  print "$outname unlinked\n";
-  exit 1;
-}
-
-my %levels = ();
-my %maxHittenLevels = ();
-
-foreach(@ARGV) {
-  my @found = `grep -i '$_' *.lua */*.lua | sed -e "s/:.*//ig" | sort | uniq`;
-  foreach (@found) {
-    chomp;
-    if (exists $levels{$_}) { $levels{$_}++; }
-    else { $levels{$_} = 1; }
-    if ($levels{$_} > $maxHits) { $maxHits = $levels{$_}; }
-  }
-}
-
-foreach (keys %levels) {
-  if ($levels{$_}==$maxHits) { $maxHittenLevels{$_}=$maxHits; }
-}
-
-# print "------------------------------------------------------------\n";
-if ($maxHits eq 0) {
-  print "No regex matched.\n";
-  unlink($outname);
-  print "$outname has been removed.\n";
-  exit 1;
-}
-elsif ($maxHits<$regCount) {
-  print "No level matched all $regCount expressions.\n";
-  print "Saving levels that were hit by at least $maxHits expressions.\n";
-}
-
-print "maxHits=$maxHits expressions=$regCount\n";
-my $index_regex = '';
-foreach (keys %maxHittenLevels) {
-  if (not /^todo.lua/) {
-    s/\.lua//ig;
-    $index_regex .= "\\|file=[ \"\}]*$_";
-  }
-}
-$index_regex = '\\('.substr($index_regex,2).'\\|^file=[ \"]*test[^ \"\}]*\\)[^a-z0-9_]';
-
-open FILE, ">$outname" || die "Can't open '$outname'";
-my @hits= `grep -hi '$index_regex' index_*.txt`;
-print FILE @hits;
-close FILE;
-
-my $hits = scalar(@hits);
-print "$hits levels indexed into '$outname'\n";
-

Deleted: trunk/data/levels/04crushprevievs.sh
===================================================================
--- trunk/data/levels/04crushprevievs.sh	2009-07-31 00:52:41 UTC (rev 1775)
+++ trunk/data/levels/04crushprevievs.sh	2009-08-01 13:11:32 UTC (rev 1776)
@@ -1,25 +0,0 @@
-#!/bin/bash
-
-if [ -z "$1" ]; then
-    echo "Usage: 04crushprevievs.sh files.."
-else
-    echo 'Crushing previews..'
-    pngcrush -brute -e .png.new $* | grep -i '^   .*png'
-
-    for PNG in *.png */*.png; do
-        NEW=$PNG.new
-        if [ -s $NEW ]; then
-            OLDSIZE=`stat -c '%s' $PNG`
-            NEWSIZE=`stat -c '%s' $NEW`
-            PERCENT=$(($NEWSIZE*100/$OLDSIZE))
-            if [ $PERCENT -lt 100 ]; then
-                ls -al $PNG
-                mv $NEW $PNG
-                ls -al $PNG
-             else
-                 rm $NEW
-             fi
-        fi
-    done
-fi
-

Deleted: trunk/data/levels/04findtodo.sh
===================================================================
--- trunk/data/levels/04findtodo.sh	2009-07-31 00:52:41 UTC (rev 1775)
+++ trunk/data/levels/04findtodo.sh	2009-08-01 13:11:32 UTC (rev 1776)
@@ -1,18 +0,0 @@
-echo "*** GetNamedObject"
-grep -n -e 'GetNamedObject' *.lua
-
-echo "*** SendMessage and GetNamedObject"
-grep -n -e 'SendMessage.*GetNamedObject' *.lua
-
-echo "*** levels that set holes attribute explicitly"
-grep -n -e 'st-shogun.*holes' *.lua
-
-
-echo "*** SendMessage with redundant nil argument"
-grep -n -e 'SendMessage.*nil' *.lua
-
-echo "*** levels that set orientation attribute explicitly"
-grep -n -e 'st-oneway.*orientation' *.lua
-
-echo "*** bolder stones with direction attribute"
-grep -n -e 'st-bolder.*direction' *.lua

Modified: trunk/data/levels/Makefile.am
===================================================================
--- trunk/data/levels/Makefile.am	2009-07-31 00:52:41 UTC (rev 1775)
+++ trunk/data/levels/Makefile.am	2009-08-01 13:11:32 UTC (rev 1776)
@@ -2,11 +2,11 @@
 	enigma_vi enigma_vii enigma_viii enigma_ix \
 	enigma_esprit enigma_oxyd enigma_peroxyd enigma_oxydmagnum enigma_oxydextra \
 	enigma_sokoban enigma_microban enigma_mas_microban \
-	enigma_pentomino_i \
 	enigma_experimental enigma_demolevels \
 	enigma_cross \
-    patches lib
+	pentomino_i \
+	patches lib
 
 pkgdatadir = $(datadir)/@PACKAGE@/levels
 pkgdata_DATA = $(wildcard $(srcdir)/*.lua $(srcdir)/*.xml)
-EXTRA_DIST = 00makepreviews.sh $(pkgdata_DATA)
+EXTRA_DIST = $(pkgdata_DATA)

Copied: trunk/data/levels/pentomino_i (from rev 1775, trunk/data/levels/enigma_pentomino_i)

Modified: trunk/data/levels/pentomino_i/Makefile.am
===================================================================
--- trunk/data/levels/enigma_pentomino_i/Makefile.am	2009-07-31 00:52:41 UTC (rev 1775)
+++ trunk/data/levels/pentomino_i/Makefile.am	2009-08-01 13:11:32 UTC (rev 1776)
@@ -1,3 +1,3 @@
-pkgdatadir = $(datadir)/@PACKAGE@/levels/enigma_pentomino_i
+pkgdatadir = $(datadir)/@PACKAGE@/levels/pentomino_i
 pkgdata_DATA = $(wildcard $(srcdir)/*.png $(srcdir)/*.txt $(srcdir)/*.xml)
 EXTRA_DIST = $(pkgdata_DATA)

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-07-31 00:52:41 UTC (rev 1775)
+++ trunk/doc/reference/enigma-ref.texi	2009-08-01 13:11:32 UTC (rev 1776)
@@ -42,7 +42,7 @@
 * Stone Objects::
 * Actor Objects::
 * Other Objects::               Wires, Rubberbands and Gadgets
-* Libraries::                   Supplemental Functions and Features 
+* Libraries::                   Supplemental Functions and Features
 * Advanced Features::           Resolvers, Scrolling, Flood, Fire, etc.
 * Extension Development::       Resolver, Library Development
 * Guidelines and Hints::        Tips and Recommendations for Levels to be included in Enigma
@@ -1419,13 +1419,13 @@
 @end example
 
 The welcome level provides two modes, the regular difficult one and an easy one.
-As the regular difficult one differs just in two additional stones we add two 
+As the regular difficult one differs just in two additional stones we add two
 mode specific tile declarations.
 
 In the difficult mode we assign two stone definitions. Each provides the
 stone kind and additional attributes. The @samp{st_quake} is the stone that
 closes oxyd stones when being hit or toggled. We just name it, to be able to
-reference it later on. The second stone is a timer that should get active 
+reference it later on. The second stone is a timer that should get active
 every 10 seconds and should send a toggle message to its target, our oxyd
 closing @samp{st_quake}. As we did name this stone we can reference it here
 as target by its name.
@@ -1461,7 +1461,7 @@
 @samp{wo}, our world handle, provide it our tile resolver, the key of the
 default floor and a map of tile keys.
 
-You will find all conceptional background information in chapter 
+You will find all conceptional background information in chapter
 @ref{Enigma Paradigm} and more examples and syntax information in chapter
 @ref{Lua API}. But first you should take the time to get aware of the XML
 based level metadata.
@@ -1780,7 +1780,7 @@
 never exposed to users.
 
 For backward compatibility, legacy levels keep their former filename as the
-new level id, and do not fit in the name schema given above. Still, that does 
+new level id, and do not fit in the name schema given above. Still, that does
 not harm since the only requirement is the uniqueness.
 
 @end table
@@ -2058,7 +2058,7 @@
 at this position when it gets downloaded. Or the path can be of the format
 @code{"externaldata/name"} for shared external data files, that are referenced
 by multiple level files stored at different folders. The external data file will
-be locally stored or gets saved in the folder @{"levels/externaldata"}. In any
+be locally stored or gets saved in the folder @code{"levels/externaldata"}. In any
 case the local name of the external data file will have the suffix @samp{.txt}
 to mark it readable but not executable for the local operating system.
 
@@ -2683,9 +2683,9 @@
 Another concept of code reusage besides @ref{Library Files} are multilevel files.
 The code contained in a single file generates several levels, called sublevels,
 that appear as autonomous levels in a levelpack. Of course this concept is much
-less flexible than the library concept as other level files can not reuse the 
-code. But you can write a multilevel if you wrote a lot of specific code for a 
-complex level that provides more than just two variants, which would be 
+less flexible than the library concept as other level files can not reuse the
+code. But you can write a multilevel if you wrote a lot of specific code for a
+complex level that provides more than just two variants, which would be
 otherwise presented as @samp{difficult} and @samp{easy} @ref{<modes>}.
 
 But the main reason for multilevel files is the support of foreign game level
@@ -2695,7 +2695,7 @@
 every level imported from a single foreign file.
 
 But multilevel files have some restrictions. They use a single set of XML
-level metadata. Thus these metadata must fit to all levels. The 
+level metadata. Thus these metadata must fit to all levels. The
 @ref{<version>} will be identical as it reflects either the code version of the
 native level or the version of the imported foreign file. But the other data
 like @ref{<author>}, @ref{<compatibility>} and @ref{<modes>} have to match, too.
@@ -2708,14 +2708,14 @@
 Let us look at all attributes and features of multilevels that differ from
 standard level files.
 
-First you have to declare in the @ref{Info metadata} element the type as 
- at code{"multilevel"} and to provide the quantity of generated levels. The 
+First you have to declare in the @ref{Info metadata} element the type as
+ at code{"multilevel"} and to provide the quantity of generated levels. The
 sublevels will be numbered from 1 to the given quantity.
 
-In the element @ref{<identity>} you have to provide just one unique level id 
+In the element @ref{<identity>} you have to provide just one unique level id
 value. Enigma will automatically append the string @code{"[1]"} for the first
 sublevel, @code{"[2]"} for the second and so on. Thus every sublevel has an
-unique id. 
+unique id.
 
 Additionally you should provide a base title for the levels in this metadata
 @ref{<identity>} element. If your title ends with a hash @samp{#} sign Enigma
@@ -3419,7 +3419,7 @@
 any random.
 
 Action may be simple or sometimes be very complex world rearrangements. But in
-any case you should @b{never ever} @samp{kill} the sender object. Killing the 
+any case you should @b{never ever} @samp{kill} the sender object. Killing the
 sender can cause application crashes! Be aware that even chained actions are not
 allowed to kill any prior sender object. Thus an @ref{it_trigger} that toggles
 an @ref{st_switch} which in turn kills the first trigger is as critical as the
@@ -3655,7 +3655,7 @@
 @subsection Level Initialization
 
 Knowing what has been preloaded and knowing exactly which objects we have to
-set in which state, it is time to have a look on how your level code is 
+set in which state, it is time to have a look on how your level code is
 processed. The main issue is to guarantee that all parts referenced have been
 set up properly in advance.
 
@@ -3685,7 +3685,7 @@
 
 Thus subsequent code lines should @ref{add} other objects, draw additional
 maps of objects and finalize some objects. The most common statement for such
-a finalization is the @ref{shuffleOxyd} method. It needs to know all 
+a finalization is the @ref{shuffleOxyd} method. It needs to know all
 @ref{st_oxyd} to be able to color and shuffle them. Another finalization may
 be a custom rendering of a maze, that extracts the maze shape out of the
 level map (@pxref{res.maze}).
@@ -3694,7 +3694,7 @@
 local used functions that need to be integrated to precede. Please keep such
 functions near by their usage and within the same code section.
 
-Another set of functions that you may want to add are @ref{Callbacks and Load 
+Another set of functions that you may want to add are @ref{Callbacks and Load
 Balancing}. We recommend to append these functions as the last section as they
 are not called within the level initialization itself.
 
@@ -3755,7 +3755,7 @@
 @subsection Callbacks and Load Balancing
 
 The most flexible feature for a level author to establish an unique behaviour
-of his level are @ref{Callback Function}s. 
+of his level are @ref{Callback Function}s.
 
 @ref{Target - Action} kill warning
 @ref{ot_timer}
@@ -3777,9 +3777,9 @@
 
 Knowing the basic principles of an Enigma level's world you now just need
 the language glue to write your first level. Enigma levels are written in
-the language @url{http://www.lua.org, Lua} as of version 5.1.4. This powerful 
-language gives you the ability to write most complex, dynamical levels, while 
-being nearly transparent on writing basic standard levels. Indeed there is no 
+the language @url{http://www.lua.org, Lua} as of version 5.1.4. This powerful
+language gives you the ability to write most complex, dynamical levels, while
+being nearly transparent on writing basic standard levels. Indeed there is no
 reason to dig into this language at the very beginning.
 
 With the second Lua API version, as of Enigma 1.10, we designed an optimized
@@ -4375,7 +4375,7 @@
 @example
 @var{pos}:exists()
 @end example
- at samp{true} if a position is a valid position of the world. All positions 
+ at samp{true} if a position is a valid position of the world. All positions
 outside of the world return @samp{false}.
 @end table
 
@@ -5239,7 +5239,7 @@
 64              @b{anchor2} = @var{woods}[@var{wire_p}[@var{j}%@var{3} + @var{1}]]@})
 @end example
 Finally we need to add the @ref{ot_wire} between our movable stones. This can
-not be done within the map. We need to use the @ref{World} method 
+not be done within the map. We need to use the @ref{World} method
 @samp{wo:add()}, which takes the two connected stones as two anchor attributes.
 We select the first 3 stones of our wood group as stones to be connected with
 3 other stones of the indices 4 to 12. Thus we take in every loop as the first
@@ -5286,7 +5286,7 @@
 @node Introduction Datatypes
 @section Introduction Datatypes
 
-Before describing the datatypes in detail let us look at the used common 
+Before describing the datatypes in detail let us look at the used common
 concepts and conventions.
 
 @menu
@@ -5321,7 +5321,7 @@
 @samp{>} and separated by @samp{|}. These characters are not part of the
 operator or method itself and should thus not be typed into the level code. Note
 that we keep square braces @samp{[}, @samp{]} and curly braces @samp{@{},
- at samp{@}} as literal Lua symbols. When these braces appear in the syntax you 
+ at samp{@}} as literal Lua symbols. When these braces appear in the syntax you
 need to type them in the code. E.g. the following syntax rule:
 
 @example
@@ -5405,7 +5405,7 @@
 of two objects? The vectorial addition of their positions, or the join of both
 objects in a new group? Either makes sense and would be useful. In this case
 we decided for the first possibility as the minus operation as the vectorial
-difference between two objects is a very important feature. Anyway you can 
+difference between two objects is a very important feature. Anyway you can
 always force the operation of your choice to be applied by transforming one
 object either into a position or a group. Please read carefully the given
 syntax rules for a clear understanding of the results.
@@ -5418,11 +5418,11 @@
 Even though we introduce just the ten additional fundamental datatypes as
 described in the following subchapters, the API does additionally differ
 the same datatype according to its usage. E.g. a standard Lua number is used to
-describe the @ref{state} of an object. Just in rare occurrences the state will 
+describe the @ref{state} of an object. Just in rare occurrences the state will
 reflect a real number like the state of @ref{ot_counter}. For most objects
 the state will just be one of a given set of allowed values, which happen to
 be described by numbers by the API. Thus we speak of a pseudo datatype
-in the case of @ref{state} values. 
+in the case of @ref{state} values.
 
 The API provides @ref{Common Constants} for all pseudo datatypes, all written in
 upper case letters only. You should use exclusively these constants and never
@@ -5431,15 +5431,15 @@
 need of changing the assigned values or transforming the pseudo datatype to a
 another datatype.
 
-There is one abstract datatype that needs to be mentioned, as it uses two 
+There is one abstract datatype that needs to be mentioned, as it uses two
 different pseudo datatypes at the same time. This special case is the datatype
-used to describe the @samp{direction} or @samp{orientation}. Both are 
-essentially the same. But we speak of @samp{orientation} if we are just 
-interested in enlisting the main directions by number values for the purpose of 
-identification. The constant values are given as @ref{orientations}. 
+used to describe the @samp{direction} or @samp{orientation}. Both are
+essentially the same. But we speak of @samp{orientation} if we are just
+interested in enlisting the main directions by number values for the purpose of
+identification. The constant values are given as @ref{orientations}.
 
 Sometimes you need values for calculation of position offsets. In this case we
-speak of a @samp{direction} and use @ref{Position} values as offset vectors. 
+speak of a @samp{direction} and use @ref{Position} values as offset vectors.
 The most common values are given as constants as listed in subchapter
 @ref{direction offsets}. Note that our @samp{direction} values have no need of
 being normalized to the length of 1.
@@ -5456,7 +5456,7 @@
 as introduced in @ref{World's Shape and Coordinates}. A position is a value
 and thus constant. Once a position is created it can not be modified anymore.
 But you can calculate with positions by usage of operators. When you add two
-position values you receive the resulting position as a new value. 
+position values you receive the resulting position as a new value.
 
 In contrast to @ref{Object}s positions have an unlimited lifetime and will never
 cease to exist. Thus you can store position values in a global variables and
@@ -5468,9 +5468,9 @@
 can take every positive or negative number and zero, too. Thus you can calculate
 with positions and use them to express offsets between two other positions.
 
-Positions are are created by the @ref{Positions Repository} singleton handle, 
-that allows you to convert coordinates, objects, position constants into 
-positions. The handle allows you to retrieve existing named positions, too. 
+Positions are are created by the @ref{Positions Repository} singleton handle,
+that allows you to convert coordinates, objects, position constants into
+positions. The handle allows you to retrieve existing named positions, too.
 Furtheron positions are implicitly created as return values of many operations.
 
 For task driven samples @pxref{Position Tasks}.
@@ -5478,7 +5478,7 @@
 Let us look at the supported operators:
 
 @menu
-* Position Addition and Subtraction::     Operators @samp{+} and @samp{-} 
+* Position Addition and Subtraction::     Operators @samp{+} and @samp{-}
 * Position Multiplication and Division::  Operators @samp{*} and @samp{/}
 * Position Sign::                         Unary Operator @samp{-}
 * Position Center::                       Operator @samp{#}
@@ -5501,8 +5501,8 @@
 result = <@i{pos} | @i{obj} | @i{cpos} | @i{polist}> <@b{+}|@b{-}> @i{pos}
 
 @item @b{Details:}
-When a position is added to or subtracted from another position or data 
-convertible to a position the result is the position value representing the 
+When a position is added to or subtracted from another position or data
+convertible to a position the result is the position value representing the
 vectorial addition or difference of both arguments.
 
 If a position is added to subtracted from a position list a new list is created
@@ -5530,7 +5530,7 @@
 result = @i{number} @b{*} @i{pos}
 
 @item @b{Details:}
-A scalar multiplication or division of a position vector. A position value 
+A scalar multiplication or division of a position vector. A position value
 with both coordinate values multiplicated or divided by the given number
 is returned.
 
@@ -5551,7 +5551,7 @@
 result = - at i{pos}
 
 @item @b{Details:}
-An unary scalar multiplication of a position vector with @samp{-1}. A new 
+An unary scalar multiplication of a position vector with @samp{-1}. A new
 position value with both coordinate values multiplicated by @samp{-1} is returned.
 
 @item @b{Syntax Samples:}
@@ -5612,12 +5612,12 @@
 
 @table @asis
 @item @b{Syntax:}
-result = @i{pos1} .. <@i{pos2} | @i{polist}> 
+result = @i{pos1} .. <@i{pos2} | @i{polist}>
 
 result = <@i{pos1} | @i{polist}> .. @i{pos2}
 
 @item @b{Details:}
-Concatenates two positions or a position with an existing @ref{PositionList} to a 
+Concatenates two positions or a position with an existing @ref{PositionList} to a
 new PositionList containing all positions in the given order.  Note that this
 operation is associative, that means it does not matter if you use braces in
 multiple concatenations or not.
@@ -5688,14 +5688,14 @@
 result = @i{pos}:exists()
 
 @item @b{Details:}
-Checks if the position is part of the world and returns @samp{true} if it is 
-contained. Otherwise @samp{false} is returned. 
+Checks if the position is part of the world and returns @samp{true} if it is
+contained. Otherwise @samp{false} is returned.
 
 Note that the @ref{Object}s @samp{exists} method reports the existence of the
 object. Evaluation of @samp{po(obj):exists()} may result in @samp{false} for
-existing objects. E.g. this result occurs for @ref{Item Objects} currently 
-being part of a player's inventory. The item exists, but is not part of the 
-world. But items contained in a bag placed in the world will report the same 
+existing objects. E.g. this result occurs for @ref{Item Objects} currently
+being part of a player's inventory. The item exists, but is not part of the
+world. But items contained in a bag placed in the world will report the same
 position as the bag.
 
 @item @b{Syntax Samples:}
@@ -5726,7 +5726,7 @@
 would get @samp{nil} values on access of @samp{NULL} references.
 
 Objects take attributes that you access by Lua index methods. Additional to
-the object specific attributes you are free to store your own customer 
+the object specific attributes you are free to store your own customer
 attributes on any object. Customer attributes are any indices starting with an
 underscore @samp{_} as prefix to their name.
 
@@ -5735,12 +5735,12 @@
 by the @ref{NamedObjects} repository, by @ref{Functions} or other methods that
 return single object references.
 
-Objects provide most methods of a @ref{Position} and can in most cases be 
+Objects provide most methods of a @ref{Position} and can in most cases be
 directly used as a position without explicit conversion. Just special methods
 like existence differ on both datatypes. Of course all objects placed in the
-world are limited to positions within the world. But be aware that portable 
- at ref{Item Objects} can well be part of a player's inventory and thus report a 
-position  outside of the world. Actors will always report positions rounded to 
+world are limited to positions within the world. But be aware that portable
+ at ref{Item Objects} can well be part of a player's inventory and thus report a
+position  outside of the world. Actors will always report positions rounded to
 the containing grid. This feature is legacy. As Lua code is anyway inappropriate
 to handle actor movements we maintained this rounding feature.
 
@@ -5940,8 +5940,8 @@
 result = <@i{pos} | @i{obj} | @i{cpos} | @i{polist}> <@b{+}|@b{-}> @i{obj}
 
 @item @b{Details:}
-When an object is added to or subtracted from another position or data 
-convertible to a position the result is the position value representing the 
+When an object is added to or subtracted from another position or data
+convertible to a position the result is the position value representing the
 vectorial addition or difference of both positions.
 
 If an object is added to subtracted from a position list a new list is created
@@ -5966,8 +5966,8 @@
 result = #@i{obj}
 
 @item @b{Details:}
-A rounding of an objects position vector to the center of the grid. A new 
-position value with coordinates of the center of the containing grid position 
+A rounding of an objects position vector to the center of the grid. A new
+position value with coordinates of the center of the containing grid position
 is returned.
 
 @item @b{Syntax Samples:}
@@ -6010,7 +6010,7 @@
 result = @i{group} * @i{obj}
 
 @item @b{Details:}
-A new set containing just the object itself, in case it is part of the group, 
+A new set containing just the object itself, in case it is part of the group,
 too, or an empty group returned.
 
 @item @b{Syntax Samples:}
@@ -6081,11 +6081,11 @@
 if you just send a message to a group, but in other cases you may need to
 clean the group from invalid members (see below).
 
-You create a group by listing the contained objects as arguments to the 
+You create a group by listing the contained objects as arguments to the
 @samp{grp()} @ref{Functions}, by retrieving objects from the @ref{NamedObjects}
 repository or as result of other methods and calculations.
 
-As groups are constant the sequence of contained objects is stable. All 
+As groups are constant the sequence of contained objects is stable. All
 operations that generate resulting new groups maintain this sequence as far
 as possible. E.g. a join of two groups takes the objects of the first group
 in the given sequence and appends the additional objects of the second group
@@ -6138,7 +6138,7 @@
 is the return value of the message to the last object in the group, or @samp{nil}
 for an empty group.
 
-You are even allowed to send a @samp{kill()} message to all objects in a group. 
+You are even allowed to send a @samp{kill()} message to all objects in a group.
 The objects will be killed, but the group remains filled with invalid @samp{NULL}
 object references.
 
@@ -6236,7 +6236,7 @@
 to returned object references.
 
 An index like read access with an object as index returns the sequence position
-number, the number index, of the object if it is contained in the group or 
+number, the number index, of the object if it is contained in the group or
 @samp{nil} if it is not contained.
 
 @item @b{Syntax Samples:}
@@ -6375,7 +6375,7 @@
 With a string argument @code{"circular"} the objects are arranged around their
 center by their angle. The distance from this center has no influence.
 
-With a string argument @code{"linear"} the objects are arranged in a linear 
+With a string argument @code{"linear"} the objects are arranged in a linear
 fashion. You either supply a @ref{Position} as sorting direction vector, or
 the first two objects of the group will define the sorting direction as default.
 
@@ -6478,14 +6478,14 @@
 result = no["@i{name}"]
 
 @item @b{Details:}
-Request of one or several objects from the repository. If no wildcard 
+Request of one or several objects from the repository. If no wildcard
 characters are used in the name an @ref{Object} value is returned. It is either
 the unique object with the given name, or an invalid @samp{NULL} object if no
 object exists with the given name.
 
 If the requested name contains a wildcard character, either an asterisk @samp{*}
 or a question mark @samp{?}, a @ref{Group} containing all objects with matching
-names is returned. An asterisk matches zero, one or several arbitrary characters. 
+names is returned. An asterisk matches zero, one or several arbitrary characters.
 A question mark matches a single arbitrary character. Both wildcard characters
 can be used anywhere in the string and in arbitrary multiplicity. Anyway the
 result is always returned as a @ref{Group}. The group may contain multiple
@@ -6527,7 +6527,7 @@
 @node PositionList
 @section PositionList
 
-A PositionList is a sorted set, known as list, of @ref{Position}s. Like a 
+A PositionList is a sorted set, known as list, of @ref{Position}s. Like a
 @ref{Group} this container is a constant datatype, that can not be modified. But
 you can easily compose new position lists by concatenation of existing lists and
 single positions.
@@ -6541,7 +6541,7 @@
 created will never change or get invalid. They are true values themselves. Thus
 they are the containers of choice for longterm storage.
 
-You can easily transform a group into a position list by the @ref{Positions Repository} 
+You can easily transform a group into a position list by the @ref{Positions Repository}
 singleton by the simple expression @samp{po(group)}. And you can retrieve all
 @ref{Object}s of a basic kind located along a position list path by
 @ref{Functions} like @samp{st(polist)}, @samp{it(polist)} and @samp{fl(polist)}.
@@ -6561,7 +6561,7 @@
 in an attribute. In case floors can be destroyed you may need to name these
 floors as discussed in @ref{Named Positions}.
 
-For task driven samples @pxref{Named Positions Tasks}. 
+For task driven samples @pxref{Named Positions Tasks}.
 
 @menu
 * PositionList Comparison::          Equality @samp{==} and Inequality @samp{~=}
@@ -6622,7 +6622,7 @@
 An index like read access with an index number between 1 and #@i{polist} returns
 the position in the related position list position. Negative indices between
 -#@i{polist} and -1 give the same positions. Thus you can always access the last
-position at index -1. All other indices return a Lua @samp{nil} value like 
+position at index -1. All other indices return a Lua @samp{nil} value like
 tables.
 
 @item @b{Syntax Samples:}
@@ -6640,12 +6640,12 @@
 
 @table @asis
 @item @b{Syntax:}
-result = @i{polist1} .. <@i{pos} | @i{polist2}> 
+result = @i{polist1} .. <@i{pos} | @i{polist2}>
 
 result = <@i{pos} | @i{polist1}> .. @i{polist2}
 
 @item @b{Details:}
-Concatenates two position lists or a position with a position list to a 
+Concatenates two position lists or a position with a position list to a
 new PositionList containing all positions in the given order. Note that this
 operation is associative, that means it does not matter if you use braces in
 multiple concatenations or not.
@@ -6667,7 +6667,7 @@
 result = <@i{pos} | @i{obj} | @i{cpos}> <@b{+}|@b{-}> @i{polist}
 
 @item @b{Details:}
-If a position or data convertible to a position is added to or subtracted from 
+If a position or data convertible to a position is added to or subtracted from
 a position list a new list is created with the positions representing the sum or
 difference of the position with every member of the position list. In total the
 position list is shifted by the position as a vector.
@@ -6707,7 +6707,7 @@
 @node Positions Repository
 @section Positions Repository
 
-The Positions datatype is just used by a single instance, the singleton 
+The Positions datatype is just used by a single instance, the singleton
 repository of named positions. Besides the management of named positions it
 provides useful conversions of other datatypes to position based types.
 
@@ -6722,7 +6722,7 @@
 yourself, but positions of existing named objects will always override plane
 named positions on name clashes.
 
-For task driven samples @pxref{Named Positions Tasks}. 
+For task driven samples @pxref{Named Positions Tasks}.
 
 @menu
 * Positions Repository Request::  Index Operator @samp{[]} read
@@ -6740,15 +6740,15 @@
 result = po["@i{name}"]
 
 @item @b{Details:}
-Request of one or several positions from the repository. If no wildcard 
+Request of one or several positions from the repository. If no wildcard
 characters are used in the name the @ref{Position} value of the unique object
-with the given name, if existent, is returned. It no object exists with the 
+with the given name, if existent, is returned. It no object exists with the
 name, the last position stored with the same name is returned. If no position
 exists the value @samp{nil} is returned.
 
 If the requested name contains a wildcard character, either an asterisk @samp{*}
 or a question mark @samp{?}, a @ref{PositionList} containing all positions with
-matching names is returned. An asterisk matches zero, one or several arbitrary 
+matching names is returned. An asterisk matches zero, one or several arbitrary
 characters. A question mark matches a single arbitrary character. Both wildcard
 characters can be used anywhere in the string and in arbitrary multiplicity.
 Anyway the result is always returned as a @ref{PositionList}. The list may
@@ -6859,7 +6859,7 @@
 Enigma guarantees that the objects will be set to the world in the sequence
 of declarations in the tile.
 
-For task driven samples @pxref{Tiles and World Tasks}. 
+For task driven samples @pxref{Tiles and World Tasks}.
 
 @menu
 * Tile concat::     Compose a new tile as concatenation of two other
@@ -6880,7 +6880,7 @@
 Compose a new tile by concatenation of a tile with another tile or a table
 object declaration. In a concatenated chain of tiles and object declarations
 one of the first two evaluated arguments needs to be a tile as two Lua tables
-do not know how to concat. 
+do not know how to concat.
 
 Note that Lua does evaluate the @samp{..} operator from right to left! Thus you
 need either use proper braces or you need to guarantee that at least one of the
@@ -6911,14 +6911,14 @@
 
 The repositories stores tiles for given string keys. The key strings can be
 of any length. Due to Lua limitations they need to be composed of printable
-7-bit ASCII characters. 
+7-bit ASCII characters.
 
 You can assign a tile to every key just once. A reassign causes an error. On
 one hand this allow internal implementation optimization, but on the other hand
-an unforeseen key reassignment is the most common level coding error that 
+an unforeseen key reassignment is the most common level coding error that
 needs to be reported.
 
-For task driven samples @pxref{Tiles and World Tasks}. 
+For task driven samples @pxref{Tiles and World Tasks}.
 
 @menu
 * Tiles Storage::     Store a tile for a key
@@ -7121,7 +7121,7 @@
 @item @b{Details:}
 Just @ref{Other Objects} can be directly added to the world. Just portable
 @ref{Item Objects} can be added to the player's inventories @samp{YIN} and
- at samp{YANG} and to @ref{it_bag}s. No other targets do currently add objects by 
+ at samp{YANG} and to @ref{it_bag}s. No other targets do currently add objects by
 this method.
 
 @end table
@@ -7551,8 +7551,8 @@
 @section Functions
 
 Besides all the features strongly related to a value as context and thus
-implemented as operators or methods of these datatypes, a few other tasks 
-remain. These are either context free or take at least in one variation just a 
+implemented as operators or methods of these datatypes, a few other tasks
+remain. These are either context free or take at least in one variation just a
 standard Lua datatype, that does not supply a context. Thus these tasks are
 implemented as simple functions.
 
@@ -7567,7 +7567,7 @@
 * ORI2DIR::         Orientation to direction conversion
 * random::          Random number generator
 * st::              Stone retrieval
-* usertype::        Type info for Enigma userdata types 
+* usertype::        Type info for Enigma userdata types
 @end menu
 
 @c ----------------- assert_bool --------------------
@@ -7605,8 +7605,8 @@
 Assertions help you to detect coding errors. They are heavily used on argument
 checks of library functions and resolver implementations. As the assertions
 should not lead to performance penalties during runtime they are usually just
-evaluated when the level's @samp{status} is declared in the XML header element 
- at ref{<version>} with a value of either @code{"test"} or @code{"experimental"}. 
+evaluated when the level's @samp{status} is declared in the XML header element
+ at ref{<version>} with a value of either @code{"test"} or @code{"experimental"}.
 
 For @code{"stable"} and @code{"released"} levels standard assert statements are
 simply skipped on compilation like Lua comments. But you can enforce assert
@@ -7666,7 +7666,7 @@
 checks of library functions and resolver implementations. As the assertions
 should not lead to performance penalties during runtime they are usually just
 evaluated when the level's @samp{status} is declared in the XML header element
- at ref{<version>} with a value of either @code{"test"} or @code{"experimental"}. 
+ at ref{<version>} with a value of either @code{"test"} or @code{"experimental"}.
 
 For @code{"stable"} and @code{"released"} levels standard assert statements are
 simply skipped on compilation like Lua comments. But you can enforce assert
@@ -7746,8 +7746,8 @@
 @subsection cond
 
 @samp{cond} is a conditional assignment, a substitution for the ternary
- at samp{?:} operator of C-like languages. Note however, that it is not a 
-equivalent substitution but just a workaround with some subtle side effects. 
+ at samp{?:} operator of C-like languages. Note however, that it is not a
+equivalent substitution but just a workaround with some subtle side effects.
 
 @table @asis
 @item @b{Syntax:}
@@ -7827,7 +7827,7 @@
 @item @i{"userdata"}
 Instead of @code{"userdata"}, Enigma's special types will be returned. These
 special types are @code{"object"}, @code{"position"}, @code{"tile"},
- at code{"tiles"}, @code{"group"}, @code{"world"}, @code{"polist"} and 
+ at code{"tiles"}, @code{"group"}, @code{"world"}, @code{"polist"} and
 @code{"default"}. If an unknown userdata is encountered, @code{"unknown"} will
 be returned.
 
@@ -7835,7 +7835,7 @@
 If @code{var} is a table, it's metatable will be queried. If there is an entry
 @samp{_type}, this entry will be used as @code{etype}. Most important examples
 of this kind are @ref{libmap}-maps, @ref{Resolvers} and @ref{res.maze} with its
-mazes and cells. So @samp{etype} will return @code{"map"}, @code{"resolver"}, 
+mazes and cells. So @samp{etype} will return @code{"map"}, @code{"resolver"},
 @code{"maze"} and @code{"cell"}, too. You may access the @code{etype}-system
 through @samp{_type} whenever you use metatables on your own.
 @end table
@@ -7854,7 +7854,7 @@
 result = @b{fl}(<@i{pos}| @{@i{x}, @i{y}@}|@i{x}, @i{y}| @i{obj} | @i{group}| @i{polist}>)
 
 @item @b{Details:}
-If the argument describes a single position, the floor object at this position 
+If the argument describes a single position, the floor object at this position
 is returned. When this single position is outside of the world an invalid
 @samp{NULL} @ref{Object} reference is returned.
 
@@ -7874,7 +7874,7 @@
 @var{floor} = @i{fl}(@var{mystone})
 @var{group} = @i{fl}(@i{no}["door#*"])
 @var{group} = @i{fl}(@i{po}(@var{3}, @var{5}).. at i{po}(@var{4}, @var{2}))
- at end example 
+ at end example
 
 @end table
 
@@ -7889,7 +7889,7 @@
 @b{grp}(<@{@i{obj1}, at i{obj2},...@}| @i{obj1}, at i{obj2},... |@i{group}>)
 
 @item @b{Details:}
-Returns a new @ref{Group} that is build up by the objects listed by the 
+Returns a new @ref{Group} that is build up by the objects listed by the
 arguments. The contents objects must be either listed in a Lua table, given
 as multiple single object arguments or an existing group. In all cases the
 sequence of objects is maintained in the returned new group, but all invalid
@@ -7920,14 +7920,14 @@
 result = @b{it}(<@i{pos}| @{@i{x}, @i{y}@}|@i{x}, @i{y}| @i{obj} | @i{group}| @i{polist}>)
 
 @item @b{Details:}
-If the argument describes a single position, the item object at this position 
-is returned. When no item is located at the given single position or this 
+If the argument describes a single position, the item object at this position
+is returned. When no item is located at the given single position or this
 position is outside of the world an invalid @samp{NULL} @ref{Object} reference
 is returned.
 
 If the argument is either a @ref{Group} or @ref{PositionList} all item objects
 of the related positions are retrieved and added in the same sequence to a new
-result group. Invalid positions or positions without items will be skipped 
+result group. Invalid positions or positions without items will be skipped
 without adding an object to the group.
 
 In any case you can send messages to the result value.
@@ -7941,7 +7941,7 @@
 @var{item} = @i{it}(@var{mystone})
 @var{group} = @i{it}(@i{no}["door#*"])
 @var{group} = @i{it}(@i{po}(@var{3}, @var{5}).. at i{po}(@var{4}, @var{2}))
- at end example 
+ at end example
 
 @end table
 
@@ -7964,7 +7964,7 @@
 @var{direction} = @i{ORI2DIR}[NORTH]      -- N  = po(0, -1)
 @var{direction} = @i{ORI2DIR}[SOUTHEAST]  -- SE = po(1,  1)
 @var{direction} = @i{ORI2DIR}[NODIR]      --      po(0,  0)
- at end example 
+ at end example
 
 @end table
 @c ----------------- random --------------------
@@ -7981,14 +7981,14 @@
 
 @item @b{Details:}
 When called without arguments, math.random returns a pseudo-random real number
-in the range [0,1). When called with a number n, math.random returns a 
+in the range [0,1). When called with a number n, math.random returns a
 pseudo-random integer in the range [1,n]. When called with two arguments, l and
 u, math.random returns a pseudo-random integer in the range [l,u].
 
 The only difference from the Lua implementation is the random generator itself.
 Enigma uses an own implementation that guarantees the same pseudo-random
 number sequence on any operating system and any processor for a given seed.
-This feature will be important for future Enigma versions and thus the 
+This feature will be important for future Enigma versions and thus the
 randomseed can not be modified by the level itself.
 
 @item @b{Syntax Samples:}
@@ -7996,7 +7996,7 @@
 @var{float} = @i{random}()          -- e.g. 0.402834
 @var{integer} = @i{random}(20)      -- e.g. 13
 @var{integer} = @i{random}(5, 10)   -- e.g. 5
- at end example 
+ at end example
 
 @end table
 @c ----------------- st --------------------
@@ -8011,14 +8011,14 @@
 result = @b{st}(<@i{pos}| @{@i{x}, @i{y}@}|@i{x}, @i{y}| @i{obj} | @i{group}| @i{polist}>)
 
 @item @b{Details:}
-If the argument describes a single position, the stone object at this position 
-is returned. When no stone is located at the given single position or this 
+If the argument describes a single position, the stone object at this position
+is returned. When no stone is located at the given single position or this
 position is outside of the world an invalid @samp{NULL} @ref{Object} reference
 is returned.
 
 If the argument is either a @ref{Group} or @ref{PositionList} all stone objects
 of the related positions are retrieved and added in the same sequence to a new
-result group. Invalid positions or positions without stone will be skipped 
+result group. Invalid positions or positions without stone will be skipped
 without adding an object to the group.
 
 In any case you can send messages to the result value.
@@ -8032,7 +8032,7 @@
 @var{stone} = @i{st}(@var{myfloor})
 @var{group} = @i{st}(@i{no}["cherry#*"])
 @var{group} = @i{st}(@i{po}(@var{3}, @var{5}).. at i{po}(@var{4}, @var{2}))
- at end example 
+ at end example
 
 @end table
 
@@ -8059,7 +8059,7 @@
 @item @b{Details:}
 Just for Lua type @code{"userdata"} Enigma's special type info will be returned.
 These special types are @code{"object"}, @code{"position"}, @code{"tile"},
- at code{"tiles"}, @code{"group"}, @code{"world"}, @code{"polist"} and 
+ at code{"tiles"}, @code{"group"}, @code{"world"}, @code{"polist"} and
 @code{"default"}. If another data type is encountered, @code{"unknown"} will
 be returned.
 
@@ -8074,7 +8074,7 @@
 @chapter Common Attributes and Messages
 
 Some attributes, messages and constants are common to many objects or even
-supported by all objects. We describe them here in detail. The following 
+supported by all objects. We describe them here in detail. The following
 chapters will just reference them or even skip them when they are generally
 supported and used in the default manner.
 
@@ -8537,8 +8537,8 @@
 @node heat
 @subsection heat
 
-Sets fire to a floor if its burnable (@pxref{Fire Spreading}) or causes a 
- at ref{Heat-Transformation} on a floor or other objects like @ref{st_ice} that 
+Sets fire to a floor if its burnable (@pxref{Fire Spreading}) or causes a
+ at ref{Heat-Transformation} on a floor or other objects like @ref{st_ice} that
 starts melting. Some objects do react on a heat message like on an @ref{ignite}
 message by explosions or shattering.
 
@@ -8674,8 +8674,8 @@
 @node actor controllers
 @subsection actor controllers
 
-Number constants for actor attribute @ref{controllers}. Please choose the 
-constant that is appropriate for an object and do avoid using numbers. 
+Number constants for actor attribute @ref{controllers}. Please choose the
+constant that is appropriate for an object and do avoid using numbers.
 
 @itemize @bullet
 @item @samp{CTRL_NONE} = @code{0}, by all actors
@@ -8687,8 +8687,8 @@
 @node oxyd colors
 @subsection oxyd colors
 
-Number constants for @ref{st_oxyd} attribute @samp{oxydcolor}. Please choose the 
-constant that is appropriate for an object and do avoid using numbers. 
+Number constants for @ref{st_oxyd} attribute @samp{oxydcolor}. Please choose the
+constant that is appropriate for an object and do avoid using numbers.
 
 @itemize @bullet
 @item @samp{OXYD_BLUE} = @code{0}, by @ref{st_oxyd}
@@ -8779,7 +8779,7 @@
 @subsection essentialness
 
 Number constants for attribute @ref{essential}. Please choose the constant that
-is appropriate for an object and do avoid using numbers. 
+is appropriate for an object and do avoid using numbers.
 
 @itemize @bullet
 @item @samp{DISPENSABLE} = @code{0}, by all actors and @ref{it_meditation}
@@ -8791,7 +8791,7 @@
 @subsection meditation types
 
 Number constants for @ref{it_meditation} attribute @ref{state}. Please choose
-the  constant that is appropriate for an object and do avoid using numbers. 
+the  constant that is appropriate for an object and do avoid using numbers.
 
 @itemize @bullet
 @item @samp{MEDITATION_CALDERA} = @code{-3}, by @ref{it_meditation}
@@ -8806,7 +8806,7 @@
 @subsection glasses abilities
 
 Number constants for @ref{it_glasses} attribute @ref{state} and global variable
- at ref{ExtralifeGlasses}. Please use sums of the constants that are appropriate 
+ at ref{ExtralifeGlasses}. Please use sums of the constants that are appropriate
 for your glasses and do avoid using numbers.
 
 @itemize @bullet
@@ -8822,9 +8822,9 @@
 @node coinslot acceptance
 @subsection coinslot acceptance
 
-Number constants for @ref{st_coinslot} attributes @samp{interval_*}. Please 
-choose the constant that is appropriate for the coinslot and do avoid using 
-numbers. 
+Number constants for @ref{st_coinslot} attributes @samp{interval_*}. Please
+choose the constant that is appropriate for the coinslot and do avoid using
+numbers.
 
 @itemize @bullet
 @item @samp{COIN_IGNORE} = @code{-1}, by @ref{st_coinslot}
@@ -8835,8 +8835,8 @@
 @subsection screen scrolling
 
 Constants for screen scrolling global attributes @ref{FollowMethod} and
- at ref{FollowAction}. Please choose the constants that are appropriate for 
-screen scrolling and do avoid using numbers or position values. 
+ at ref{FollowAction}. Please choose the constants that are appropriate for
+screen scrolling and do avoid using numbers or position values.
 
 @itemize @bullet
 @item @samp{FOLLOW_NO} = @code{0}, by global @ref{FollowMethod}
@@ -9041,7 +9041,7 @@
 
 A global scalar default factor for electrical forces. Positive numbers result in
 attracting forces for opposite charges and repelling forces for equal signed
-charges. Where as negative numbers result in repelling forces for opposite 
+charges. Where as negative numbers result in repelling forces for opposite
 charges and attracting forces for equal signed charges. This global value is
 always multiplied by the charge load of the affected actors. The actor's charge
 load usually results from hits of @ref{st_charge}.
@@ -9146,9 +9146,9 @@
 @subsection Fragility
 
 A global default value denoting the probability that a brittle floor plate, that
-is a floor with an @ref{it_crack} on top, continues to disintegrate on events 
+is a floor with an @ref{it_crack} on top, continues to disintegrate on events
 like an actor entering, passing a neighboring @ref{it_crack}, nearby explosions
-or fire heating. A value of @code{1.0} ensures that the crack continues to 
+or fire heating. A value of @code{1.0} ensures that the crack continues to
 disintegrates on these events, a value of @code{0.0} prohibits visible cracks
 to get larger. This default is superseded by @ref{fragility (floor)} and
 @ref{it_crack} specific values.
@@ -9366,8 +9366,8 @@
 
 A global variable that is only used by @ref{Multilevel Files}. It contains the
 number of the sublevel that should be loaded and played. The number is preset
-to a value between @code{1} and the @samp{quantity} given in the 
- at ref{Info metadata}. 
+to a value between @code{1} and the @samp{quantity} given in the
+ at ref{Info metadata}.
 
 @table @asis
 @item @b{Type:} @ @ int
@@ -9518,7 +9518,7 @@
 @macro yref {name}
 @c @image{images/\name\} @tab
 @ifhtml
- at ref{\name\} 
+ at ref{\name\}
 @end ifhtml
 @iftex
 \name\
@@ -9596,11 +9596,11 @@
 * floodable::               Flood Affinity
 * force_x::                 Constant Force
 * force_y::                 Constant Force
-* fragility (floor)::       Crack 
+* fragility (floor)::       Crack
 * freeze_check (floor)::    Freeze Checking
 * friction (floor)::        Decelerating friction force factor
 * ignitable::               -
-* indestructible::          System Flag for destruction resistance 
+* indestructible::          System Flag for destruction resistance
 * initfire::                -
 * noash::                   -
 * push_directions::         Puzzle Shuffle Hint
@@ -9657,7 +9657,7 @@
 @node faces (floor)
 @subsection faces (floor)
 
-Describes if a floor is framed. 
+Describes if a floor is framed.
 
 Currently a floor is either not framed at all or framed on all sides. The frame
 attribute can not be directly accessed and modified on most floors. Append the
@@ -9734,7 +9734,7 @@
 
 A value denoting the probability that a brittle floor plate, that is a floor
 with an @ref{it_crack} on top, continues to disintegrate on events like an actor
-entering, passing a neighboring @ref{it_crack}, nearby explosions or fire 
+entering, passing a neighboring @ref{it_crack}, nearby explosions or fire
 heating. A value of @code{1.0} ensures that the crack continues to disintegrate
 on these events, a value of @code{0.0} prohibits visible cracks to get larger.
 This value is defaulted by @ref{Fragility} and superseded by @ref{it_crack}
@@ -9942,7 +9942,7 @@
 
 @item @b{Variants:}
 @table @asis
- at item @image{images/fl_adhesionless, 12mm} @b{fl_adhesionless} 
+ at item @image{images/fl_adhesionless, 12mm} @b{fl_adhesionless}
 @end table
 @end table
 
@@ -9964,7 +9964,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_aquamarine, 12mm} @b{fl_aquamarine}
- at item @image{images/fl_aquamarine_framed, 12mm} @b{fl_aquamarine_framed} 
+ at item @image{images/fl_aquamarine_framed, 12mm} @b{fl_aquamarine_framed}
 @end table
 @end table
 
@@ -9987,7 +9987,7 @@
 
 @item @b{Variants:}
 @table @asis
- at item @image{images/fl_bast, 12mm} @b{fl_bast} 
+ at item @image{images/fl_bast, 12mm} @b{fl_bast}
 @item @image{images/fl_bast_framed, 12mm} @b{fl_bast_framed}
 @end table
 @end table
@@ -10496,7 +10496,7 @@
 @subsection fl_redslab
 @obindex fl_redslab
 
-Dark red slab floor, that is marbled with black. A matching floor is 
+Dark red slab floor, that is marbled with black. A matching floor is
 @ref{fl_blueslab}.
 
 @table @asis
@@ -10563,7 +10563,7 @@
 @subsection fl_samba
 @obindex fl_samba
 
-Gray bleached wooden floor. Textures with horizontal and vertical aligned plank 
+Gray bleached wooden floor. Textures with horizontal and vertical aligned plank
 exist.
 
 When burnt, @code{fl_samba} becomes @ref{fl_abyss}.
@@ -10770,7 +10770,7 @@
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 2.0 @ @ @xref{friction}
 @item @b{indestructible}, @ @ @i{values}: bool ; @ @ @i{default}: true; @ @ @i{access}: @code{none}  @ @ @xref{indestructible}
 @item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable}
- at item @b{noash}, @ @ @i{values}: boolean; @ @ @i{default}: true @ @ @xref{noash} 
+ at item @b{noash}, @ @ @i{values}: boolean; @ @ @i{default}: true @ @ @xref{noash}
 @end table
 
 @item @b{Variants:}
@@ -10822,7 +10822,7 @@
 The type of the bridge.
 @item @b{adhesion}, @ @ @i{values}: number; @ @ @i{default}: 1.0 @ @ @xref{adhesion}
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 5.0 @ @ @xref{friction}
- at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: depends on @code{flavor} @ @ @xref{burnable} 
+ at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: depends on @code{flavor} @ @ @xref{burnable}
 True if flavor is @code{"b*"}, false otherwise.
 @end table
 
@@ -10876,7 +10876,7 @@
 @item @b{adhesion}, @ @ @i{values}: number; @ @ @i{default}: 2.0 @ @ @xref{adhesion}
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 3.0 @ @ @xref{friction}
 @item @b{flavor}, @ @ @i{values}: @code{"abyss"}, @code{"trigger"}; @ @ @i{default}: @code{"abyss"}; @ @ @i{access}: @code{none}
- at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: depends on @code{flavor} @ @ @xref{burnable} 
+ at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: depends on @code{flavor} @ @ @xref{burnable}
 True if flavor is @code{"trigger"}, false otherwise.
 @end table
 
@@ -10897,7 +10897,7 @@
 
 The framed variant is the successor of a fallen @ref{st_box}_hay. It may be
 flooded by a @ref{fl_water} stream without the attribute @samp{floodable} being
-set to @samp{true} as the flood passes below this floor. The framed wood 
+set to @samp{true} as the flood passes below this floor. The framed wood
 acts like a bridge over a flood stream and the water will continue to spread to
 neighboring grids, while the framed wood is still passable for actors. In fact
 a framed wood can even operate as a flood source, but we do not recommend this
@@ -10911,7 +10911,7 @@
 Number of seconds .
 @item @b{adhesion}, @ @ @i{values}: number; @ @ @i{default}: 1.5 @ @ @xref{adhesion}
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 5.0 @ @ @xref{friction}
- at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: true @ @ @xref{burnable} 
+ at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: true @ @ @xref{burnable}
 @end table
 
 @item @b{Variants:}
@@ -10938,7 +10938,7 @@
 @table @asis
 @item @b{adhesion}, @ @ @i{values}: number; @ @ @i{default}: 0.1 @ @ @xref{adhesion}
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 0.1 @ @ @xref{friction}
- at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable} 
+ at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable}
 @end table
 
 @item @b{Variants:}
@@ -10961,7 +10961,7 @@
 @item @b{adhesion}, @ @ @i{values}: number; @ @ @i{default}: -2.0 @ @ @xref{adhesion}
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 3.0 @ @ @xref{friction}
 @item @b{flavor}, @ @ @i{values}: @code{"white"}, @code{"gray"}; @ @ @i{default}: @code{"white"}; @ @ @i{access}: @code{none}
- at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable} 
+ at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable}
 @end table
 
 @item @b{Variants:}
@@ -10982,7 +10982,7 @@
 
 The framed variant is the successor of a fallen @ref{st_box}_rock. It may be
 flooded by a @ref{fl_water} stream without the attribute @samp{floodable} being
-set to @samp{true} as the flood passes below this floor. The framed wood 
+set to @samp{true} as the flood passes below this floor. The framed wood
 acts like a bridge over a flood stream and the water will continue to spread to
 neighboring grids, while the framed wood is still passable for actors. In fact
 a framed wood can even operate as a flood source, but we do not recommend this
@@ -10996,7 +10996,7 @@
 Number of seconds .
 @item @b{adhesion}, @ @ @i{values}: number; @ @ @i{default}: 2.2 @ @ @xref{adhesion}
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 6.5 @ @ @xref{friction}
- at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable} 
+ at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable}
 @end table
 
 @item @b{Variants:}
@@ -11062,7 +11062,7 @@
 @item @b{force_y} @ @ @i{values}: float number; @ @ @i{default}: @code{0.0} @ @ @xref{force_y}
 @item @b{adhesion}, @ @ @i{values}: number; @ @ @i{default}: 2.0 @ @ @xref{adhesion}
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 4.0 @ @ @xref{friction}
- at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable} 
+ at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable}
 
 @end table
 
@@ -11106,11 +11106,11 @@
 A swamp is very sticky floor caused by a high friction. Additionally ball like
 actors will sink in swamp. But the sink speed is limited and gives the user
 a certain time, defined by the global attribute @ref{SwampSinkTime}. When
-an actor moves faster than 6 grids per second, the actor start raising out of 
+an actor moves faster than 6 grids per second, the actor start raising out of
 the swamp. Jumping in a swamp raises an actor, too.
 
 A swamp is indestructible to the aspect that @ref{it_crack} will not spread
-onto it. But fire starting to burn nearby will dry out the swamp to 
+onto it. But fire starting to burn nearby will dry out the swamp to
 @ref{fl_dunes} (@pxref{Heat-Transformation}). A swamp itself may be a successor of
 a @ref{fl_water} heated by a fire.
 
@@ -11120,7 +11120,7 @@
 @item @b{adhesion}, @ @ @i{values}: number; @ @ @i{default}: 1.0 @ @ @xref{adhesion}
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 13.0 @ @ @xref{friction}
 @item @b{indestructible}, @ @ @i{values}: bool ; @ @ @i{default}: true; @ @ @i{access}: @code{none}  @ @ @xref{indestructible}
- at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable} 
+ at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable}
 @end table
 
 @item @b{Variants:}
@@ -11140,7 +11140,7 @@
 @samp{friction} and @samp{adhesion} values.
 
 The item is not directly stolen at the moment of entering the grid. The entering
-itself just causes the thief to emerge from his hiding-place. The thief steals 
+itself just causes the thief to emerge from his hiding-place. The thief steals
 from the actor that did conjure him at the moment of maximum visibility. He takes
 a random item from the owner's inventory. But he just will steal an item if
 the actor is not shielded due to an activated @ref{it_umbrella}.
@@ -11151,7 +11151,7 @@
 Thieves have an enemy - the @ref{st_chess}. If a chess stone is pushed onto
 a thief it will capture the thief, sober or drunken. The thief vanishes leaving
 an inactive standard floor and the chess stone jumps onto its position. But the
-thief will leave behind on the grid all stolen items in his own @ref{it_bag}. 
+thief will leave behind on the grid all stolen items in his own @ref{it_bag}.
 If the thief has not stolen any items he leaves no empty bag.
 
 @table @asis
@@ -11159,7 +11159,7 @@
 @table @asis
 @item @b{adhesion}, @ @ @i{values}: number; @ @ @i{default}: 1.5 @ @ @xref{adhesion}
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 4.5 @ @ @xref{friction}
- at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable} 
+ at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable}
 @end table
 
 @item @b{Messages:} none
@@ -11181,13 +11181,13 @@
 @obindex fl_water
 
 Besides @ref{fl_abyss} water is the second natural floor barrier for ball like
-actors, as they can not easily pass it. 
+actors, as they can not easily pass it.
 
-Both, @ref{ac_marble} and @ref{ac_pearl}, will sink in water, usually at once, 
-but the time amount can be configured by the global attribute @ref{WaterSinkTime}. 
-Unlike @ref{fl_swamp} water does not raise fast moving actors. But jumping 
+Both, @ref{ac_marble} and @ref{ac_pearl}, will sink in water, usually at once,
+but the time amount can be configured by the global attribute @ref{WaterSinkTime}.
+Unlike @ref{fl_swamp} water does not raise fast moving actors. But jumping
 within water raises an actor. Jumping completely over a water chasm is of course
-a more standard way to cross it. Actors protected by an activated 
+a more standard way to cross it. Actors protected by an activated
 @ref{it_umbrella} can pass and even move on water without restrictions.
 
 Some stones fall into water, too. @ref{st_box} will build floors on which all
@@ -11197,14 +11197,14 @@
 onto it. But a fire starting to burn nearby will dry out the water to
 @ref{fl_swamp} (see @ref{Heat-Transformation}).
 
-The standard water is static, its @samp{state} is @samp{IDLE}. It will not 
+The standard water is static, its @samp{state} is @samp{IDLE}. It will not
 spread to adjacent floors. But you can set up flood streams that will fill areas
-or flow through given paths. You just need to define the area by setting the 
+or flow through given paths. You just need to define the area by setting the
 attribute @samp{floodable} to @samp{true} on the affected floors. But static
 water lakes do not require an additional @samp{floodable} attribute, as they
 are floodable by default.
 
-As soon as you add a @samp{fl_water_source} or set the @samp{state} to 
+As soon as you add a @samp{fl_water_source} or set the @samp{state} to
 @samp{FLOODING}, the water starts to spread to floodable neighboring grids with
 a speed defined by the attribute @samp{interval}. The speed will be inherited to
 floors flooded by a stream.
@@ -11221,7 +11221,7 @@
 @item @b{indestructible}, @ @ @i{values}: bool ; @ @ @i{default}: true; @ @ @i{access}: @code{none}  @ @ @xref{indestructible}
 @item @b{adhesion}, @ @ @i{values}: number; @ @ @i{default}: 1.0 @ @ @xref{adhesion}
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 5.0 @ @ @xref{friction}
- at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable} 
+ at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable}
 @end table
 
 @item @b{Variants:}
@@ -11242,7 +11242,7 @@
 
 The framed variant is the successor of a fallen @ref{st_box}_wood. It may be
 flooded by a @ref{fl_water} stream without the attribute @samp{floodable} being
-set to @samp{true} as the flood passes below this floor. The framed wood 
+set to @samp{true} as the flood passes below this floor. The framed wood
 acts like a bridge over a flood stream and the water will continue to spread to
 neighboring grids, while the framed wood is still passable for actors. In fact
 a framed wood can even operate as a flood source, but we do not recommend this
@@ -11258,7 +11258,7 @@
 Number of seconds .
 @item @b{adhesion}, @ @ @i{values}: number; @ @ @i{default}: 2.0 @ @ @xref{adhesion}
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 6.4 @ @ @xref{friction}
- at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: true @ @ @xref{burnable} 
+ at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: true @ @ @xref{burnable}
 @end table
 
 @item @b{Variants:}
@@ -11294,7 +11294,7 @@
 @item @b{invisible} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 @item @b{adhesion}, @ @ @i{values}: number; @ @ @i{default}: 2.0 @ @ @xref{adhesion}
 @item @b{friction}, @ @ @i{values}: number; @ @ @i{default}: 5.2 @ @ @xref{friction}
- at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable} 
+ at item @b{burnable}, @ @ @i{values}: boolean; @ @ @i{default}: false @ @ @xref{burnable}
 @end table
 
 @item @b{Variants:}
@@ -11541,7 +11541,7 @@
 Inventory and bag are limited concerning pickups to 13 items.
 
 @item
-Both are generally LIFO (last item picked up is first item out), but the 
+Both are generally LIFO (last item picked up is first item out), but the
 inventory content can be rotated.
 
 @item
@@ -11627,16 +11627,16 @@
 A bottle filled with booze makes any ball like actor that activates it drunken.
 The control of actor gets difficult as it will likely no longer move straight
 into the intended direction. Fortunately the period of drunkenness lasts just
-5 seconds per default. But you can set this time by the attribute 
+5 seconds per default. But you can set this time by the attribute
 @samp{interval} to other values. The bottle will be dropped on activation.
 Activation of several bottles in sequence will lead to longer periods of
 drunkenness as the intervals will sum up.
 
-Alternatively you can fill the bottle with a message by the attribute 
+Alternatively you can fill the bottle with a message by the attribute
 @samp{text}. Like @ref{it_document} the message gets displayed on activation.
 Of course the actor does not get drunken in this case.
 
-When a stone gets pushed over a bottle it will break to sherds. These 
+When a stone gets pushed over a bottle it will break to sherds. These
 remnants are lethal to @ref{ac_marble} and @ref{ac_pearl} when entering the
 affected grid. But of course they can jump over the broken bottle or pass it
 while being protected by an activated @ref{it_umbrella}. Unlike @ref{it_death}
@@ -11772,17 +11772,17 @@
 all actors become invisible. Just the ball like actors @ref{ac_marble} and
 @ref{ac_pearl} do vanish.
 
-An invisible actor can walk through most kinds of glass 
+An invisible actor can walk through most kinds of glass
 (@pxref{Transparent Stones}) and as being invisible they do no longer attract
 hostile @ref{ac_rotor} and @ref{ac_top}.
 
 When several cherries are activated in sequence each does prolong the actor's
 time of invisibility by additional 8 seconds.
 
-Other actors drop the cherry as an @ref{it_squashed} on activation. Sending a 
+Other actors drop the cherry as an @ref{it_squashed} on activation. Sending a
 cherry via an @ref{st_mail} results in an  @ref{it_squashed}, too. This
 gives you the control that a cherry added to one player's inventory can not be
-easily transfered to other actors assigned to the other player. Just 
+easily transfered to other actors assigned to the other player. Just
 @ref{st_thief} and @ref{fl_thief} are able to steal the cherry undamaged.
 
 When a stone is pushed over a cherry an @ref{it_squashed} remains as remnants.
@@ -11808,7 +11808,7 @@
 
 A totally passive cup of coffee. It can be picked up and be dropped many times.
 It blocks laser light, prohibits @ref{it_crack} spreading but it burns on fire
-and is blown away on @ref{it_bomb} explosions. 
+and is blown away on @ref{it_bomb} explosions.
 
 @table @asis
 @item @b{Attributes:}
@@ -11875,9 +11875,9 @@
 @obindex it_document
 
 This item looks like a piece of paper and contains a text message that can be
-displayed by activating the item. It is destroyed by explosions from 
+displayed by activating the item. It is destroyed by explosions from
 @ref{it_bomb}, @ref{st_dispenser}, @ref{it_dynamite} and by burning fire.
-The document is sensitive to laser light an dissolves with an 
+The document is sensitive to laser light an dissolves with an
 @ref{it_explosion}_nil leaving no remnants when being hit by light.
 
 Another message carrying item is the @ref{it_bottle}.
@@ -11917,7 +11917,7 @@
 by its activation. Generally it is not possible to prolong the transformation
 by activation of several drops.
 
-Note that this object is currently just defined for the following actors: 
+Note that this object is currently just defined for the following actors:
 
 @itemize @bullet
 @item @ref{ac_marble} transforms to @ref{ac_rotor}.
@@ -11949,8 +11949,8 @@
 
 Dynamite is an explosive that can be picked up and that can be easily ignited
 at any free grid position. It ignites on drop, or if positioned on the floor in
- at samp{IDLE} state it ignites on laser light, nearby fire and other nearby 
-explosions as those caused by @ref{it_bomb}, @ref{st_dispenser}, or other 
+ at samp{IDLE} state it ignites on laser light, nearby fire and other nearby
+explosions as those caused by @ref{it_bomb}, @ref{st_dispenser}, or other
 dynamite. A falling @ref{ot_cannonball} lets it explode immediately without prior
 ignition.
 
@@ -11966,7 +11966,7 @@
 @samp{IDLE}. But when the user pushes an @ref{st_ice} over a @samp{ACTIVE}
 dynamite it will freeze and stop burning, returning to state @samp{IDLE}.
 
-Dynamite items will be added to the inventory when an actor hits a 
+Dynamite items will be added to the inventory when an actor hits a
 @ref{st_dispenser}_dynamite.
 
 @table @asis
@@ -12013,7 +12013,7 @@
 @ref{Flood Spreading}.
 
 The load is given by the attribute @samp{state} of the extinguisher and is
-visible for the user by a color spot. Green is a @samp{FULL} extinguisher, 
+visible for the user by a color spot. Green is a @samp{FULL} extinguisher,
 yellow a @samp{MEDIUM} filled extinguisher and red an @samp{EMPTY} extinguisher.
 
 Extinguishers themselves are fireprotected as long as they are not empty.
@@ -12299,7 +12299,7 @@
 @subsection it_pencil
 @obindex it_pencil
 
-An item to mark floors and stones. 
+An item to mark floors and stones.
 
 An activated pencil scratches an @ref{it_cross} on most floors. As the pencil
 gets consumed by this operation the cross takes the pencils identity on
@@ -12339,7 +12339,7 @@
 When it is picked up and is added to the inventory it significantly increases
 the floor friction applied to all actors owned by the inventory's owner.
 
-Pins do just increase friction as long as they are directly part of the 
+Pins do just increase friction as long as they are directly part of the
 inventory. A pin contained within an @ref{it_bag}, being part of the inventory,
 has no influence on the friction. Two or more pins do not apply more friction
 than a single pin. As soon as the last pin is dropped the friction returns
@@ -12456,12 +12456,12 @@
 or to the position of another actor that is warped to the initiators position in
 exchange.
 
-Note that this object is currently just defined in the following cases: 
+Note that this object is currently just defined in the following cases:
 
 @itemize @bullet
- at item just one arbitrary actor owned by player @samp{YIN} - the actor gets 
+ at item just one arbitrary actor owned by player @samp{YIN} - the actor gets
 warped to its respawn position.
- at item just an @ref{ac_marble}_black owned by player @samp{YIN} and an 
+ at item just an @ref{ac_marble}_black owned by player @samp{YIN} and an
 @ref{ac_marble}_white owned by player @samp{YANG} - both actors exchange their
 position.
 @end itemize
@@ -12634,7 +12634,7 @@
 besides a wooden spoon. They never dropped it. They had to peg out to give away
 their spoon.
 
-Thus an Enigma spoon shatters the actor who drops it. When a player owns 
+Thus an Enigma spoon shatters the actor who drops it. When a player owns
 multiple actors just the active one gets killed. This is an essential difference
 to pressing F3, what shatters all actors of all players. When providing a spoon
 you may sometimes want to revoke the ability to commit a global suicide by
@@ -12664,7 +12664,7 @@
 
 Springs let @ref{Flying Actors} jump on activation.
 
-There are two types of portable springs. A thin one that is kept in the 
+There are two types of portable springs. A thin one that is kept in the
 inventory on activation and can thus be used multiple times in sequence. And
 a thick, condensed one that gets dropped on activation. A static jump
 facility that can not be picked up by an actor is the @ref{it_springboard}.
@@ -13019,7 +13019,7 @@
 @subsection it_bomb
 @obindex it_bomb
 
-A bomb is an explosive that can not be picked up. It ignites on laser light, 
+A bomb is an explosive that can not be picked up. It ignites on laser light,
 nearby fire and other nearby explosions as those caused by other @ref{it_bomb}s,
 @ref{it_dynamite}, @ref{st_dispenser} exploding directly above a bomb, or simply
 by a solid stone being pushed over them (just a few stones like @ref{st_shogun},
@@ -13028,7 +13028,7 @@
 
 On ignition its fuse starts burning. After a short time the bomb explodes
 causing on the 8 neighboring positions items to ignite and some stones like
- at ref{st_break} to dissolve, too. 
+ at ref{st_break} to dissolve, too.
 
 @samp{BLACK} bombs will cause destructible items on the 4 neighboring positions
 to be blown away, and dissolves the floor beneath to a @ref{fl_abyss}.
@@ -13037,7 +13037,7 @@
 to be blown away, and dissolves the floor beneath and the 8 neighboring
 positions to @ref{fl_abyss}.
 
-Bomb items will be added to the inventory when an actor hits a 
+Bomb items will be added to the inventory when an actor hits a
 @ref{st_dispenser}_bombblack or @ref{st_dispenser}_bombwhite.
 
 @table @asis
@@ -13080,7 +13080,7 @@
 This item is nowadays mainly an internal system item as the @ref{Fire Spreading}
 with its attributes and messages is mainly handled by the @ref{Floor Objects}.
 But it may be essential for your understanding to be aware of this object in
-all its variants. You may also need to make use of all variants on level 
+all its variants. You may also need to make use of all variants on level
 initialization due to the @ref{Snapshot Principle}.
 
 The following variants do exist:
@@ -13089,8 +13089,8 @@
 explosions; set the attributes @ref{burnable} and @ref{ignitable} on the floor
 instead.
 @item @samp{oil} - is the visible variant of the invisible burnable item.
- at item @samp{ignited} - carries the starting-animation of fire; send the 
- at samp{setfire} message to a floor or set the floor with attribute 
+ at item @samp{ignited} - carries the starting-animation of fire; send the
+ at samp{setfire} message to a floor or set the floor with attribute
 @samp{initfire} instead.
 @item @samp{burning} - carries the animation of burning fire. Use setfire instead.
 @item @samp{ash} - the unburnable remnant of a fire.
@@ -13156,13 +13156,13 @@
 
 You can control the crack progress by the two attributes @samp{spreading} and
 @samp{fragility}. Where as the first attribute describes the likelihood that the
-crack spreads to a neighboring crack free grid, does the second attribute 
+crack spreads to a neighboring crack free grid, does the second attribute
 describe the likelihood that an existing crack advances its state.
 
 An actor entering a crack causes the crack itself to advance its state with the
 given likelihood. A default @samp{abyss} crack causes existing cracks on any of
-the 4 neighboring grid positions to advance their states, too. But a 
- at samp{water} crack does not advance neighboring cracks. Both do cause a spread 
+the 4 neighboring grid positions to advance their states, too. But a
+ at samp{water} crack does not advance neighboring cracks. Both do cause a spread
 with the given likelihood of an invisible crack to any of the 4 neighboring grid
 positions in case no crack or any other items exists on it.
 
@@ -13192,10 +13192,10 @@
 
 Indestructible floors like @ref{fl_abyss}, @ref{fl_water}, @ref{fl_swamp} will
 never crack. As any other item cracks do block laser light and prohibit other items to be
-dropped on the same grid. Nearby fire, explosions and hitting 
+dropped on the same grid. Nearby fire, explosions and hitting
 @ref{ot_cannonball}s will dissolve a crack by another step.
 
-On the other hand @ref{st_ice} will putty any existing crack when being pushed 
+On the other hand @ref{st_ice} will putty any existing crack when being pushed
 over it.
 
 @table @asis
@@ -13311,7 +13311,7 @@
 @obindex it_explosion
 
 An intermediate short living system item representing and visualizing an
-explosion. There are very few acceptable usages of this item besides the 
+explosion. There are very few acceptable usages of this item besides the
 internal setting due to explosions of @ref{it_bomb}, @ref{it_dynamite},
 @ref{it_landmine} and @ref{ot_cannonball}.
 
@@ -13321,7 +13321,7 @@
 @itemize @bullet
 @item @samp{nil} - no remnants.
 @item @samp{hollow} - leave an @ref{it_meditation}_hollow.
- at item @samp{crack} - make an @ref{it_crack}_water. 
+ at item @samp{crack} - make an @ref{it_crack}_water.
 @item @samp{debris} - dissolve the floor to @ref{fl_abyss}
 @end itemize
 
@@ -13671,7 +13671,7 @@
 square. A springboard can catapult any number of actors anytime with an idle
 reloading time after an activation.
 
-Another catapulting, but portal item is @ref{it_spring}. 
+Another catapulting, but portal item is @ref{it_spring}.
 
 @table @asis
 
@@ -13886,7 +13886,7 @@
 @subsection it_vortex
 @obindex it_vortex
 
-Teleports @ref{ac_marble} and @ref{ac_pearl} to a given @samp{destination}. 
+Teleports @ref{ac_marble} and @ref{ac_pearl} to a given @samp{destination}.
 Unlike @ref{it_wormhole} it does not teleport other @ref{Actors}.
 
 In the simplest case, a vortex is connected to a single destination given by
@@ -13901,7 +13901,7 @@
 reach the final destination of a vortex.
 
 Vortices can be @samp{OPEN} or @samp{CLOSED}. Of course an actor can enter just
-an open vortex. Closed vortices at the destination are opened automatically. 
+an open vortex. Closed vortices at the destination are opened automatically.
 By default such vortices remain open. By usage of the attribute @samp{autoclose}
 you can configure a vortex to close after an actor has been emitted.
 
@@ -13993,7 +13993,7 @@
 
 But the teleporting feature of a wormhole is not limited to actors. A water
 flood will spread through a wormhole, too. Of course all actor related
-attributes described above have no influence on the flood. Just the 
+attributes described above have no influence on the flood. Just the
 @samp{destination} is important as explained in details in @ref{Flood Spreading}.
 
 @table @asis
@@ -14197,7 +14197,7 @@
 @tab @image{images/st_woven, 12mm} @tab @yref{st_woven}
 @tab @image{images/st_yellow, 12mm} @tab @yref{st_yellow}
 @item @image{images/st_yinyang, 12mm} @tab @yref{st_yinyang}
- at tab @image{images/st_yinyang_inactive, 12mm} @tab @yref{st_yinyang}_inactive 
+ at tab @image{images/st_yinyang_inactive, 12mm} @tab @yref{st_yinyang}_inactive
 @end multitable
 
 
@@ -14252,7 +14252,7 @@
 are either based on the hit velocity or the position.
 
 By usage of a simple @samp{hit_strength} factor you can increase, decrease or
-invert the default factor. Note that you must not set this attribute, if you 
+invert the default factor. Note that you must not set this attribute, if you
 want to use the default.
 
 By setting the four attributes @samp{hit_distortion_xx}, @samp{hit_distortion_xy},
@@ -14959,7 +14959,7 @@
 @subsection st_beads
 @obindex st_beads
 
-A stone framed by glass beads. Like other @ref{Transparent Stones} it is 
+A stone framed by glass beads. Like other @ref{Transparent Stones} it is
 passable for invisible actors, but it is not transparent to laser beams.
 
 Like @ref{st_oneway} the beads stone does not detain visible actors once they
@@ -14970,7 +14970,7 @@
 
 @item @b{Messages:} none
 
- at item @b{Variants:} 
+ at item @b{Variants:}
 @table @asis
 @item @image{images/st_beads, 12mm} @b{st_beads}
 @end table
@@ -15177,17 +15177,17 @@
 @subsection st_box
 @obindex st_box
 
-A movable, floor building stone of various flavors. 
+A movable, floor building stone of various flavors.
 
 This very common stone is well known in its default flavor @code{"wood"}. But it
-exists in the flavors @code{"hay"} and @code{"rock"}, too. The flavor 
+exists in the flavors @code{"hay"} and @code{"rock"}, too. The flavor
 @code{"wood"} has a random wood tile orientation. You can set wooden boxes of
-given tile orientation by the variants @code{st_box_wood_h} and 
+given tile orientation by the variants @code{st_box_wood_h} and
 @code{st_box_wood_v}.
 
 The flavors @code{"wood"} and @code{"hay"} may originate from a growing
 @ref{it_seed}. Due to the @ref{Snapshot Principle} special box variants exist
-just for usage in level initialization: @code{st_box_wood_growing} and 
+just for usage in level initialization: @code{st_box_wood_growing} and
 @code{st_box_hay_growing}.
 
 All variants can easily be pushed around, do press @ref{it_trigger}s and do fall
@@ -15195,7 +15195,7 @@
 of the kind indicated by their @samp{flavor} attribute. All boxes will fall on
 the first occasion. Even if they receive two push impulses at the same time by
 @ref{ot_wire} they fall on the first grid. Thus it is impossible to push a box
-over a ditch. Boxes will fall if the floor beneath them vanishes. E.g. an 
+over a ditch. Boxes will fall if the floor beneath them vanishes. E.g. an
 @ref{it_bomb} explosion beneath a box may change the floor to @ref{fl_abyss} or
 a flood stream may change the floor to @ref{fl_water}. In all these cases the
 box above falls immediately building its kind of floor.
@@ -15291,7 +15291,7 @@
 Besides being breakable the stone is a standard stone. The different flavors let
 this stone appear in quite different outlooks.
 
-The flavor @code{"plain"} is a grey stone that is breakable by any actor hit 
+The flavor @code{"plain"} is a grey stone that is breakable by any actor hit
 with a revealed @ref{it_hammer} and by a laser beam hitting any side.
 
 The flavors @code{"black"} and @code{"white"} look similar to the @code{"plain"}
@@ -15299,19 +15299,19 @@
 just breakable by any actors of matching color. Of course the actors need a
 revealed @ref{it_hammer}. Laser beams do break the stone, too.
 
-The flavor @code{"oxydc"} looks like a cracked @ref{st_oxyd} of flavor 
- at code{"c"}. Like the @code{"plain"} variant it is breakable by any actor hit 
+The flavor @code{"oxydc"} looks like a cracked @ref{st_oxyd} of flavor
+ at code{"c"}. Like the @code{"plain"} variant it is breakable by any actor hit
 with a revealed @ref{it_hammer} and by a laser beam hitting any side.
 
-The flavor @code{"boulder"} looks like a yellowish version of flavor 
+The flavor @code{"boulder"} looks like a yellowish version of flavor
 @code{"oxydc"}. It is breakable under the same conditions plus additionally by
 an @ref{st_boulder} hitting on one of its sides.
 
 The flavor @code{"bug"} looks like an @ref{st_flat} with a bug symbol on top.
-It is just breakable by an @ref{ac_bug}. No other actor and no laser light will 
+It is just breakable by an @ref{ac_bug}. No other actor and no laser light will
 break it.
 
-The flavor @code{"laser"} looks identical to an @ref{st_flat}. It is not 
+The flavor @code{"laser"} looks identical to an @ref{st_flat}. It is not
 breakable by actors. Just laser light beams on one of its faces will break this
 variant.
 
@@ -15375,7 +15375,7 @@
 actors on the grid. The stone is hovering, thus it does not press any
 @ref{it_trigger} and lets pass any actors and laser light, too.
 
-Please make rare usage of this stone in Enigma 1.1* as the current display 
+Please make rare usage of this stone in Enigma 1.1* as the current display
 engine does not really support this stone. All dynamic floors and floor changes
 do cause faulty displays. Thus use it currently only in patterns without any
 floor dynamics.
@@ -15392,15 +15392,15 @@
 @subsection st_charge
 @obindex st_charge
 
-An electrical charger for actors. The image reflects the sign of the 
+An electrical charger for actors. The image reflects the sign of the
 @samp{charge} attribute.
 
 Any actor hitting this stone will recharge its @ref{charge} attribute to the
-value given by the stone's @samp{charge} attribute. 
+value given by the stone's @samp{charge} attribute.
 
 The stone itself does not cause any electrical forces. It is neither attracting
 nor repelling for charged actors. Electrical forces applied to actors just
-depend on the charges of different actors and the global attribute 
+depend on the charges of different actors and the global attribute
 @ref{ElectricStrength}.
 
 @table @asis
@@ -15559,7 +15559,7 @@
 @subsection st_darkglass
 @obindex st_darkglass
 
-A metal framed semi transparent glass stone. It exists in static, movable and 
+A metal framed semi transparent glass stone. It exists in static, movable and
 hollow variants and is just transparent to laser light in its hollow variant.
 Like other @ref{Transparent Stones} it is passable for invisible actors as long
 as it is not @samp{movable}.
@@ -15606,7 +15606,7 @@
 @ref{it_extralife} can be configured not to show invisible actorimpulse stones.
 
 A death stone can also be movable. Of course ball like actors can not push it.
-But other actors can push it. A movable death stone can be connected by an 
+But other actors can push it. A movable death stone can be connected by an
 @ref{ot_wire} to another movable stone that allows to control it. Furtheron
 all stones emitting stone impulses like @ref{st_stoneimpulse}, @ref{st_rotator},
 @ref{st_lightpassenger} can move it. And finally a pushing @ref{st_boulder}
@@ -15719,18 +15719,18 @@
 
 An item dispenser in some item flavors.
 
-On every actor hit the dispenser adds a new item given by the attribute 
+On every actor hit the dispenser adds a new item given by the attribute
 @samp{flavor}, namely @ref{it_bomb} in color black or white, @ref{it_dynamite}
-or @ref{it_extralife} to the inventory of the actor's owner. Of course an item 
-will just be added if the inventory is capable of adding a further item. 
-Additionally the dispenser's @samp{stock} must supply a further item. The 
-default stock of 1000 items should be enough for usual demands. But you can 
+or @ref{it_extralife} to the inventory of the actor's owner. Of course an item
+will just be added if the inventory is capable of adding a further item.
+Additionally the dispenser's @samp{stock} must supply a further item. The
+default stock of 1000 items should be enough for usual demands. But you can
 limit the supply to just a few counted items. This @samp{stock} attribute gets
 decremented every time an actor takes an item.
 
-The dispenser stone does break on adjacent @ref{it_bomb} explosions and 
+The dispenser stone does break on adjacent @ref{it_bomb} explosions and
 adjacent dispenser stone breaks. On its break it will itself cause adjacent
- at ref{it_dynamite} to ignite, @ref{it_bomb} positioned beneath itself to 
+ at ref{it_dynamite} to ignite, @ref{it_bomb} positioned beneath itself to
 explode, and of course neighboring dispensers to break. Dispenser stones will
 neither break on actor hits, even with a revealed hammer, nor on laser light
 beams.
@@ -15772,13 +15772,13 @@
 There are several flavors of doors. The variants @code{"a"} to @code{"c"}
 represent grid filling block doors. Flavor @code{"a"} looks in the closed state
 like @ref{st_oxyd} of flavor @code{"a"} and in the opened state like an
- at ref{st_grate} of flavor @code{"cross"}. Flavor @code{"b"} looks in the closed 
+ at ref{st_grate} of flavor @code{"cross"}. Flavor @code{"b"} looks in the closed
 state like @ref{st_flat} but opens to an invisible, free passable, but still
 existing and grid blocking stone. Flavor @code{"c"} looks in the closed state
 like @ref{st_flat} and in the opened state like an @ref{st_grate} of flavor
- at code{"framed"}. The flavor @code{"d"} represents a faces based door, that 
-opens or blocks just the given faces of the grid. Currently just the 
-combinations of two parallel aligned door faces, aka horizontal and vertical 
+ at code{"framed"}. The flavor @code{"d"} represents a faces based door, that
+opens or blocks just the given faces of the grid. Currently just the
+combinations of two parallel aligned door faces, aka horizontal and vertical
 doors, are supported.
 
 As door grids can be entered on unfaced sides you should block these faces by
@@ -15875,12 +15875,12 @@
 A stone that mimics other stones, but does not act like them.
 
 In contrast to @ref{st_magic} the fake stone does not transform but remains
-all time a passive variant of the stone that it models. The stone does look 
+all time a passive variant of the stone that it models. The stone does look
 like another stone of the kind given by the attribute @samp{flavor}. The fake
 stone may even mimic state dependent behaviour with state dependent models
 and animations.
 
-The flavor @code{"quake"} mimics a @ref{st_quake} including the pulsing 
+The flavor @code{"quake"} mimics a @ref{st_quake} including the pulsing
 animation on actor hits and state changes, but does not cause any @ref{st_oxyd}
 to close.
 
@@ -15975,7 +15975,7 @@
 distinguishable by small cracks. But further laser light will not break a
 cracked variant. Ignitions and explosions will shatter breakable, cracked and
 movable variants. An actor with a revealed @ref{it_hammer} is able to shatter
-both the breakable and the cracked variant. Note that the visually 
+both the breakable and the cracked variant. Note that the visually
 indistinguishable @ref{st_break}_laser breaks on a laser hit, too, but without
 being breakable by actors.
 
@@ -16012,7 +16012,7 @@
 @item @image{images/st_flat, 12mm} @b{st_flat_hollow}: hollow=@code{true}
 @item @image{images/st_flat, 12mm} @b{st_flat_movable}: movable=@code{"true"}
 @item @image{images/st_flat, 12mm} @b{st_flat_breakable}: breakable=@code{"true"}
- at item @image{images/st_flat_cracked, 12mm} @b{st_flat_cracked}: 
+ at item @image{images/st_flat_cracked, 12mm} @b{st_flat_cracked}:
 @item @image{images/st_flat_fire, 12mm} @b{st_flat_burnable}: burnable=@code{"true"}
 @item @image{images/st_flat_fire, 12mm} @b{st_flat_moveburnable}: movable=@code{"true"}, burnable=@code{"true"}
 @item @image{images/st_flat_break, 12mm} @b{st_flat_breaking}: breakable=@code{"true"}
@@ -16063,7 +16063,7 @@
 @obindex st_fourswitch
 
 A switch that points into one of the four orientations and turning on every
-switching event. The most common event is an actor hitting this stone. But 
+switching event. The most common event is an actor hitting this stone. But
 @ref{st_boulder} will trigger this switch, too. Of course other objects can send
 messages on actions to make this switch turning.
 
@@ -16101,7 +16101,7 @@
 Performs an action on each turn. If just a pair of global @samp{target/action}
 attributes are given, the action message is sent to the target with a value of
 the new orientation. This value suits any message of the target that expects
-an orientation value, and the @ref{signal} message, that translates the 
+an orientation value, and the @ref{signal} message, that translates the
 orientation value to a 1 for @samp{NORTH}, @samp{SOUTH} and a 0 for
 @samp{EAST}, @samp{WEST}.
 
@@ -16124,7 +16124,7 @@
 @subsection st_ghost
 @obindex st_ghost
 
-An invisible stone that transforms into a visible stone on actor hits with 
+An invisible stone that transforms into a visible stone on actor hits with
 properly revealed tools.
 
 Similar to @ref{st_magic} this stone does transform to another kind, but it
@@ -16143,7 +16143,7 @@
 The flavor @code{"greenbrown"} transforms to an @ref{st_greenbrown} on a hit
 with a revealed @ref{it_magicwand}.
 
-The flavor @code{"break"} transforms to an @ref{st_break} of variant 
+The flavor @code{"break"} transforms to an @ref{st_break} of variant
 @samp{st_break_oxydc} on a hit with a revealed @ref{it_brush}.
 
 
@@ -16177,7 +16177,7 @@
 
 The different flavors are just for decorative purposes, but @code{"cross"}
 variant looks identical to an open @ref{st_door} of flavor @code{"a"}, whereas
- at code{"framed"} variant looks identical to an open @ref{st_door} of flavor 
+ at code{"framed"} variant looks identical to an open @ref{st_door} of flavor
 @code{"b"}.
 
 In contrast to opened doors grates do bounce actors that are flying due to a
@@ -16219,7 +16219,7 @@
 a variant @samp{st_greenbrown_growing} due to the @ref{Snapshot Principle}.
 
 On the other hand a @ref{st_ghost} of flavor @code{"greenbrown"} will transform
-to standard, unmovable greenbrown on an actor hit with a revealed 
+to standard, unmovable greenbrown on an actor hit with a revealed
 @ref{it_magicwand}.
 
 @table @asis
@@ -16242,15 +16242,15 @@
 being pushed over it. But a block of ice can be destroyed by explosions and by
 heating fire leaving either @ref{fl_ice} or @ref{fl_water}.
 
-When an ice block without frozen item is pushed onto a grid with a 
+When an ice block without frozen item is pushed onto a grid with a
 @ref{freezable} item, the ice will freeze the item and will move it beneath
 itself on subsequent pushes. All items that the user can carry in his inventory
-are @ref{freezable} and even some @ref{Static Items} like @ref{it_magnet}, 
+are @ref{freezable} and even some @ref{Static Items} like @ref{it_magnet},
 @ref{it_springboard}, etc. But a few items react in a special manner when an
 ice block is pushed onto them:
 @itemize @bullet
- at item @ref{it_squashed} and @ref{it_burnable}, with the exception of 
- at samp{it_burnable_oil}, dissolve to nothing. 
+ at item @ref{it_squashed} and @ref{it_burnable}, with the exception of
+ at samp{it_burnable_oil}, dissolve to nothing.
 @item @ref{it_crack} will vanish as the ice is putty for the cracked floors
 @item @ref{it_seed} will not start growing, even though the ice is pushed as a
 solid stone on top.
@@ -16283,13 +16283,13 @@
 
 Ice blocks shatter on nearby @ref{it_bomb} and @ref{it_dynamite} explosions and
 on @ref{ot_cannonball} hits. The ice will spread to the four direct neighboring
-grid positions and will cover these and the originating position with 
+grid positions and will cover these and the originating position with
 @ref{fl_ice}. Just @ref{fl_abyss} will not be covered by this ice floor and
 remains unchanged. Thus an exploding bomb leaves an @ref{fl_abyss} at its
 position, even when an ice blocks shatters nearby.
 
 A fire starting to burn on a direct neighbor position will eventually melt the
-ice block by its @ref{Heat-Transformation}. The ice will melt to an 
+ice block by its @ref{Heat-Transformation}. The ice will melt to an
 @ref{fl_water}. Just in case the ice block melts over an @ref{fl_abyss} the
 floor remains unchanged. The ice heating is no secure feature, as the heat burst
 occurs just once for each fire. Thus a user may be able to push an ice block
@@ -16317,7 +16317,7 @@
 @subsection st_jamb
 @obindex st_jamb
 
-A colored door jamb that allows coupled opening and closing on adjacent 
+A colored door jamb that allows coupled opening and closing on adjacent
 @ref{st_door}s. Especially doors of flavor @code{"d"} can be opened by proper
 colored actors by door knocking.
 
@@ -16345,7 +16345,7 @@
 @end example
 
 The black marble touching the east door will open the east and the west door,
-and will close the north and south door at the same time. The black marble 
+and will close the north and south door at the same time. The black marble
 touching the south door will open the south and the north door, and will close
 the west and east door.
 
@@ -16614,7 +16614,7 @@
 @subsection st_lightglass
 @obindex st_lightglass
 
-A metal framed transparent glass stone. It exists in static, movable and 
+A metal framed transparent glass stone. It exists in static, movable and
 hollow variants and is by its very nature transparent to laser light. Like other
 @ref{Transparent Stones} it is passable for invisible actors as long as it is
 not @samp{movable}.
@@ -16746,10 +16746,10 @@
 The flavor @code{"brick"} just transforms on a hit with a revealed
 @ref{it_magicwand} into a static @ref{st_rawglass}.
 
-The flavor @code{"oxyda"} transforms on any hit into a movable 
+The flavor @code{"oxyda"} transforms on any hit into a movable
 @ref{st_lightglass}.
 
-The flavor @code{"oxydc"} transforms on any hit into a movable 
+The flavor @code{"oxydc"} transforms on any hit into a movable
 @ref{st_rawglass}.
 
 @table @asis
@@ -17271,14 +17271,14 @@
 @subsection st_plaster
 @obindex st_plaster
 
-A sculptured gypsum stone that exists in various variations of basic stone 
+A sculptured gypsum stone that exists in various variations of basic stone
 attributes.
 
 Unlike the similar looking @ref{st_flat} has no special features and behaves
-like a standard stone. 
+like a standard stone.
 
 But it provides breakable variants. Like @ref{st_break} it is breakable by
-laser light, neighboring ignitions like those caused by an exploding 
+laser light, neighboring ignitions like those caused by an exploding
 @ref{it_dynamite} on a direct neighboring position or an exploding black
 @ref{it_bomb} on a diagonal neighboring position. It breaks on actor hits with
 a revealed @ref{it_hammer}, too. But unlike @ref{st_break} it offers a
@@ -17321,7 +17321,7 @@
 stones it can cease under some conditions. And if it ceases it does it with
 a plop and some sparkles.
 
-Currently there is just one flavor called @code{"slate"} according to its 
+Currently there is just one flavor called @code{"slate"} according to its
 dark blue grey color. It falls and ceases to exist if pushed on @ref{fl_water},
 @ref{fl_abyss} or @ref{fl_swamp}. Unlike @ref{st_box} it does not build a floor.
 
@@ -17346,7 +17346,7 @@
 a transparent on state.
 
 The switch looks like an @ref{st_darkglass} in its opaque off state and like
-an @ref{st_lightglass} in its transparent on state. Like other 
+an @ref{st_lightglass} in its transparent on state. Like other
 @ref{Transparent Stones} it is passable for invisible actors.
 
 @table @asis
@@ -17380,7 +17380,7 @@
 @subsection st_portal
 @obindex st_portal
 
-A gate that is just passable for some special kind of actors. Like 
+A gate that is just passable for some special kind of actors. Like
 @ref{st_grate} it uses metallic frames but it does not let pass actors of all
 kinds.
 
@@ -17498,7 +17498,7 @@
 water with at least one abyss floor just complete blue clusters will sink. Note
 that puzzles just sink on moves. Moving a blue fragment besides another fragment
 on abyss so that both fragments build a complete cluster will not sink the new
-cluster. It will sink as a whole on the next move. If two or more stones of a 
+cluster. It will sink as a whole on the next move. If two or more stones of a
 cluster receive wire impulses originating from a single event, the whole cluster
 will move multiple times. But it will sink on the first opportunity.
 
@@ -17988,7 +17988,7 @@
 @item @ref{st_oxyd} do open,
 @item @ref{st_stoneimpulse} do pulse,
 @item @ref{st_yinyang} do toggle,
- at item @ref{st_puzzle} do explode completely connected clusters, 
+ at item @ref{st_puzzle} do explode completely connected clusters,
 @item @ref{st_brownpyramide} do break,
 @item @ref{st_spitter} do break, if not being @samp{secure}
 @item other stones do remain unmodified and protect items and floors,
@@ -18001,10 +18001,10 @@
 
 Actors will not be harmed by falling cannonballs.
 
-The spitting can be initiated by the message @code{"hit"}, too. No 
+The spitting can be initiated by the message @code{"hit"}, too. No
 @ref{it_extralife} is needed in this case. The hit message takes either a
 destination as message value or in case no value is given it evaluates the
- at samp{destination} attribute. The second case is suitable for usage of 
+ at samp{destination} attribute. The second case is suitable for usage of
 @samp{hit} as an action message.
 
 The destination can be any value that evaluates to a valid position, object
@@ -18024,7 +18024,7 @@
 destroyed on the next spit as the spitter starts again on the first (remaining)
 destination when the end of list is reached. This may be no problem if you
 want to destroy objects randomly or if you use named destinations with
-wildcards. But if you need control about the sequence you need either 
+wildcards. But if you need control about the sequence you need either
 destinations targets that get not destroyed or floor object references, as
 they represent @ref{Named Positions} that are persistent to object destruction.
 
@@ -18182,7 +18182,7 @@
 The tile declarations referenced by a key may even contain objects besides
 stone. But you should make rare and proper usage of this feature.
 
-Prior replacing the surprise stone the surprise stone will perform its action. 
+Prior replacing the surprise stone the surprise stone will perform its action.
 You can use this action to modify the selection or to set objects on your own.
 
 The surprise stone is killed by any replacement stone set to the grid position.
@@ -18322,7 +18322,7 @@
 
 Thieves have an enemy - the @ref{st_chess}. If a chess stone is pushed onto
 a thief it will capture the thief, sober or drunken. The thief stone vanishes
-and the chess stone jumps onto its position. But the thief will leave behind 
+and the chess stone jumps onto its position. But the thief will leave behind
 on the grid all stolen items in his own @ref{it_bag}. If an item happens to
 be positioned beneath the captured thief stone, this item will be added to
 the thief's bag, too. If the thief has not stolen any items he leaves no empty
@@ -18651,7 +18651,7 @@
 strong hits will cause marbles to shatter themselves. An actor can lower the
 required speed by adding @ref{it_weight}, by revealing an @ref{it_hammer}, or by
 weakening the window faces by prior scratching it with an @ref{it_ring}. Green
-safety glass windows will never break on actor attacks and actors will not 
+safety glass windows will never break on actor attacks and actors will not
 shatter on hitting safety glass.
 
 Bomb explosions can shatter window faces, too. Normal blue window faces adjacent
@@ -18850,11 +18850,11 @@
 @item @ref{st_ghost} @tab st_ghost_break @tab rebound @tab rebound @tab yes
 @end multitable
 
-These entries can be memorized as follows: A stone is transparent for laser 
+These entries can be memorized as follows: A stone is transparent for laser
 light if it is hollow, but not if it is dark. Exception is @samp{st_beads},
-whose irregular sides would scatter the beam. A stone can always be passed by 
-invisible actors, with three exceptions: @samp{st_redfiber}, whose inside is 
-filled with red stripes, and the two movables @samp{st_lightglass_movable} and 
+whose irregular sides would scatter the beam. A stone can always be passed by
+invisible actors, with three exceptions: @samp{st_redfiber}, whose inside is
+filled with red stripes, and the two movables @samp{st_lightglass_movable} and
 @samp{st_darkglass_movable} which have a non-glass frame which the actor can
 use to move the stone. @code{st_rawglass_movable} does not have such a frame
 and can not be moved by an invisible actor.
@@ -18912,7 +18912,7 @@
 @subsection charge
 
 The initial electrical charge that a new actor starts with when being added to
-the world. Actors do charge and recharge by hitting @ref{st_charge}. Hits 
+the world. Actors do charge and recharge by hitting @ref{st_charge}. Hits
 of charged actors among themselves does not affect their charge load. Each
 actor keeps its charge load.
 
@@ -19385,9 +19385,9 @@
 static @ref{it_springboard} that catapult crossing actors and @ref{it_vortex}
 that catapult warping actors.
 
-A flying actor can pass lethal grids with @ref{fl_water}, @ref{fl_abyss}, 
- at ref{it_trap} and even laser beams. But most stones will block flying actors, 
-even some hollow ones like @ref{st_grate} or @ref{st_oneway}. But some others as 
+A flying actor can pass lethal grids with @ref{fl_water}, @ref{fl_abyss},
+ at ref{it_trap} and even laser beams. But most stones will block flying actors,
+even some hollow ones like @ref{st_grate} or @ref{st_oneway}. But some others as
 @ref{st_door} or hollow @ref{Standard Stones} let flying actors pass.
 
 While flying an actor can not pick up any item. But the actor can still drop
@@ -19575,9 +19575,9 @@
 
 The attribute @samp{state} represents the count of switches in @samp{ON} state.
 Due to the @ref{Snapshot Principle} you need to set it to the initial number
-of @samp{ON} switches. All switches need to declare the counter gadget as their 
+of @samp{ON} switches. All switches need to declare the counter gadget as their
 @samp{target}. They all need to send a @code{"signal"} message as @samp{action}.
-The counter gadget increases or decreases its count state on every received 
+The counter gadget increases or decreases its count state on every received
 signal message thus keeping it up to date.
 
 The gadget itself can perform actions by usage of @ref{Object State} dependent
@@ -19598,8 +19598,8 @@
 wo:add(@{"ot_counter", "mycounter", state=2, target="mydoor", action_7="close", action_8="open"@})
 @end example
 
-Note that it is not sufficient to send an @code{"open"} message on a 
- at samp{state} count of 8, as this event occurs, when 7 boxes are on top of 
+Note that it is not sufficient to send an @code{"open"} message on a
+ at samp{state} count of 8, as this event occurs, when 7 boxes are on top of
 triggers and the last trigger is pressed by the actor itself, too. When the
 actor leaves the 8th trigger the gadget state decreases its state to 7 and
 sends a @code{"close"} message to the door.
@@ -19620,8 +19620,8 @@
 @end table
 
 @item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
-Sends an action with value @samp{true} just on explicitly given 
- at ref{Object State} dependent target or action attributes. No default 
+Sends an action with value @samp{true} just on explicitly given
+ at ref{Object State} dependent target or action attributes. No default
 @code{"toggle"} actions will be issued on other states.
 @end table
 
@@ -19688,7 +19688,7 @@
 Libraries do contain extensions that are not necessary for every level. By
 outsourcing them into separate files they do not get loaded if not used. This
 improves the level load time and runtime resource consumption. But as a level
-author you have to declare the usage of a library by an XML metadata 
+author you have to declare the usage of a library by an XML metadata
 @samp{dependency} element within the @ref{<compatibility>} element. The
 necessary line of code is listed within every library description.
 
@@ -19746,9 +19746,9 @@
 @section liblua
 
 This library of basic extensions to the Lua language is described as of release
-1. 
+1.
 
-You can load it by adding an @samp{dependency} element to the 
+You can load it by adding an @samp{dependency} element to the
 @ref{<compatibility>} XML Metadata element as follows:
 
 @example
@@ -20031,9 +20031,9 @@
 @node libmath
 @section libmath
 
-This library of basic mathematical extensions is described as of release 1. 
+This library of basic mathematical extensions is described as of release 1.
 
-You can load it by adding an @samp{dependency} element to the 
+You can load it by adding an @samp{dependency} element to the
 @ref{<compatibility>} XML Metadata element as follows:
 
 @example
@@ -20386,7 +20386,7 @@
 
 @item @b{Details:}
 @samp{random_vector} can be used in conjunction with @samp{cubic_polynomial} to
-create random patterns, see @ref{lib.math.cubic_polynomial} and 
+create random patterns, see @ref{lib.math.cubic_polynomial} and
 @ref{Weirdly Wired}.
 
 @item @b{Full Example:}
@@ -20445,14 +20445,14 @@
 @node libmap
 @section libmap
 
-The @samp{libmap} gives the author more possibilities to work with API 2-maps. 
-Up to now, a map just is a table of strings, as described in 
+The @samp{libmap} gives the author more possibilities to work with API 2-maps.
+Up to now, a map just is a table of strings, as described in
 @ref{World Creation}. With @samp{libmap}, you can utilize maps in a more
 advanced way.
 
-This library is described as of release 1. 
+This library is described as of release 1.
 
-You can load it by adding an @samp{dependency} element to the 
+You can load it by adding an @samp{dependency} element to the
 @ref{<compatibility>} XML Metadata element as follows:
 
 @example
@@ -20597,7 +20597,7 @@
 @end example
 to the same effect. Keep in mind that composing transformations is by far faster than
 applying transformations to maps. So the first example is faster than the
-second. Due to Lua's sequence of evaluating operators, 
+second. Due to Lua's sequence of evaluating operators,
 @example
 newmap = mymap ^ maptransformation1 ^ maptransformation2 ^ maptransformation3
 @end example
@@ -21992,7 +21992,7 @@
 The inverse can be calculated with a power to @code{-1}, but also by @samp{-},
 see @ref{Map Transformation Inverse}.
 @end table
-  
+
 @c ----------------- Map Transformation Inverse --------------------
 
 @node Map Transformation Inverse
@@ -22081,9 +22081,9 @@
 and @samp{lib.import.string_remove_multiples}, which removes multiple
 occurrences of a string in another string.
 
-This library is described as of release 1. 
+This library is described as of release 1.
 
-You can load it by adding an @samp{dependency} element to the 
+You can load it by adding an @samp{dependency} element to the
 @ref{<compatibility>} XML Metadata element as follows:
 
 @example
@@ -22327,9 +22327,9 @@
 @node libsoko
 @section libsoko
 
-This library is described as of release 1. 
+This library is described as of release 1.
 
-You can load it by adding an @samp{dependency} element to the 
+You can load it by adding an @samp{dependency} element to the
 @ref{<compatibility>} XML Metadata element as follows:
 
 @example
@@ -22404,13 +22404,13 @@
 @node Resolvers
 @section Resolvers
 
-Every tile in the world is defined by a key that needs to be resolved to its 
-declaration. This can be done either by the @ref{Tiles Repository} @samp{ti} 
+Every tile in the world is defined by a key that needs to be resolved to its
+declaration. This can be done either by the @ref{Tiles Repository} @samp{ti}
 alone, or by additionally chained resolvers. In the chapter @ref{Lua API} we
 learned how to set up a @ref{World} by static @ref{Tile and Object Declaration}s.
-Now it is time to explore the capabilities of resolvers. In the 
+Now it is time to explore the capabilities of resolvers. In the
 @ref{World Creation} you had to supply a top resolver as an argument. Let us
-look which types of resolvers are available and how you can chain these resolvers. 
+look which types of resolvers are available and how you can chain these resolvers.
 
 @menu
 * Resolver Chaining::  Linking resolvers and the tiles repository
@@ -22433,10 +22433,10 @@
 idea how to resolve them to object declarations. Thus each resolver has to be
 linked to a so called @samp{subresolver}. The resolver just forwards all key
 request that it can not handle itself to its subresolver. Indeed it will in
-most cases even forward modified key requests to its subresolver that are 
+most cases even forward modified key requests to its subresolver that are
 required by the process of handling its own keys.
 
-The last resolver in the chain will either use the @ref{Tiles Repository} 
+The last resolver in the chain will either use the @ref{Tiles Repository}
 @samp{ti} as its subresolver or a @ref{Custom Resolver} function, which will be
 @samp{ti} based, too
 .
@@ -22654,8 +22654,8 @@
 copy of the template rule will be generated and the @samp{%%} patterns will be
 substituted. But in this case the substitution is composed of a single percent
 sign followed by an integer number, that counts the key position within the
-given range, starting with the given offset or default @code{1}. Thus a key of 
- at samp{c} in the syntax sample above will target the door @samp{door%3}. You 
+given range, starting with the given offset or default @code{1}. Thus a key of
+ at samp{c} in the syntax sample above will target the door @samp{door%3}. You
 would need to use the key @samp{C} in the map for the matching door.
 
 The template tile definitions can well be composed of several concatenated
@@ -22700,8 +22700,8 @@
 @item @b{Caveats:}
 Do not use the hash sign @samp{#} as suffix character for key length 2 and
 above autotiled keys. A key @code{"A#"} could result in an unexpected @samp{%%}
-substitution in the name attribute. A name @code{"sample%%"} would be 
-substituted by @code{"sample%#"} which is a name that will be autonumbered 
+substitution in the name attribute. A name @code{"sample%%"} would be
+substituted by @code{"sample%#"} which is a name that will be autonumbered
 (@pxref{Object Naming}).
 @end table
 
@@ -22746,7 +22746,7 @@
 Resolver to which unresolved requests should be forwarded. May be @samp{ti}
 as the final resolver of the resolver chain.
 @item @i{sequence}
-Search sequence for basic tile declarations given as a string of priority 
+Search sequence for basic tile declarations given as a string of priority
 numbers. The sequence defaults to @code{"123456789"}.
 @end table
 
@@ -22757,18 +22757,18 @@
 
 @item @b{Details:}
 For every key in the map the subresolver will be first requested for a tile
-declaration. Thus any given explicit declaration will precede the auto 
+declaration. Thus any given explicit declaration will precede the auto
 composition.
 
 Just in case that no declaration exists the search starts for existing subkey
-tiles. Subkeys are keys with all but some characters replaced by a whitespace 
+tiles. Subkeys are keys with all but some characters replaced by a whitespace
 @samp{ }.
 
 The search sequence is given by the optional second argument and defaults to
- at code{"123456789"}. In the first step all character positions marked by a 
+ at code{"123456789"}. In the first step all character positions marked by a
 @samp{1} in the sequence string are maintained in the key string and all others
 are replaced by whitespace. In the second step all  character positions marked
-by a @samp{2} in the sequence string are maintained in the key string and all 
+by a @samp{2} in the sequence string are maintained in the key string and all
 others are replaced by whitespace. This procedure continues until the number
 equals the key length. All generated subkeys are resolved by the subresolver
 and concatenated in the given sequence.
@@ -22785,7 +22785,7 @@
 total decomposition into single character based subkeys. E.g. you may want
 to use a @ref{res.autotile} or @ref{res.puzzle} as subresolver. Both have the
 need of essential 2 character subkeys. In this case you can simply define
-the sequence as @code{"122"} for a key length of 3. A key request of 
+the sequence as @code{"122"} for a key length of 3. A key request of
 @code{"~Pa"} will be resolved to subkeys @code{"~  "}, @code{" Pa"}. In case
 of a puzzle subresolver this would result in:
 
@@ -22805,14 +22805,14 @@
 ti["  X"] .. ti["~  "] .. ti[" m "]
 @end example
 
-In all cases, subkeys, that are strings of whitespace only, will simply be 
+In all cases, subkeys, that are strings of whitespace only, will simply be
 ignored. With the default sequence the key @code{"~ X"} will result just in:
 
 @example
 ti["~  "] .. ti["  X"]
 @end example
 
-If you set your floors by usage of the composer you should use the all 
+If you set your floors by usage of the composer you should use the all
 whitespace key as your default floor as this key does not resolve via the
 composer and needs the backup of the default mechanism.
 
@@ -22879,19 +22879,19 @@
 can even be direction dependent. This allows you to use window panes on either
 side of a connection or to use oneways for your connections, too. These passages
 from one cell to another are the edges of our graph and as they may be directed
-we have a directed graph. But for most mazes the support of directions is 
+we have a directed graph. But for most mazes the support of directions is
 irrelevant and transparent, and you do not really need to know anything about
 graphs at all. Thus we called the resolver just a maze resolver.
 
 Of course such a versatile resolver needs some configuration. As the parameters
 exceed the number of arguments, that you can reasonably supply to a function
-just by enlisting them, we decided to group the parameters for specific 
-tasks and to use a table with named attributes for the configuration. This 
+just by enlisting them, we decided to group the parameters for specific
+tasks and to use a table with named attributes for the configuration. This
 sounds more complex than it is. But watch out carefully for the table curly
 braces as they are necessary and can not be omitted.
 
 In a big level you may want to generate two or even more completely independent
-mazes. You can do this by using multiple instances of this resolver. The 
+mazes. You can do this by using multiple instances of this resolver. The
 resolver handle returned on the configuration is a unique reference pointer for
 the maze for subsequent requests. Store it and link all the maze resolvers as
 explained in @ref{Resolver Chaining}.
@@ -22916,7 +22916,7 @@
 Resolver to which unresolved requests should be forwarded. May be @samp{ti}
 as the final resolver of the resolver chain.
 @item @i{attributes} = @{@i{keyvalue}, @i{keyvalue},...@}
-An anonymous table with one or many attributes given as key value pairs, 
+An anonymous table with one or many attributes given as key value pairs,
 separated by a comma.
 @item @i{keyvalue} = <area=@i{area_value} | render = @i{render_value} | kernel = @i{kernel_value} | spacing = @i{spacing_value} | persistent=@i{persistence}>
 Values for given keys that may occur in any sequence in the anonymous table.
@@ -22943,7 +22943,7 @@
 @item @i{render_value} = @{<@i{std_renderer_args} | @i{other_renderer}>@}
 The specification for drawing the maze. In case of a missing specification
 no drawing will be done at all. If the default standard renderer should be used
-its parameters can be directly supplied, other renderers need a type 
+its parameters can be directly supplied, other renderers need a type
 specification plus the necessary configuration information.
 @item @i{std_renderer_args} = @i{passage_keys} [, <@i{wall_key} [, @i{kernel_key}] | @i{cell_map}>]]
 The standard renderer takes info about tile keys to be used for the passages,
@@ -22952,8 +22952,8 @@
 @item @i{passage_keys} = <@i{passage_key} | @{@i{passage_open}, @i{passage_closed}@}>
 Usually you just give a tile key for open maze passages. Closed passages appear
 like walls and use the same tile key. But in case you want to use special tile
-keys for open and for closed passages you can supply two strings in an 
-anonymous table. If you give no wall key you may need to include an 
+keys for open and for closed passages you can supply two strings in an
+anonymous table. If you give no wall key you may need to include an
 @samp{st_nil} in your open passage tile declaration to kill a wall stone drawn
 by your world map.
 @item @i{wall_key}
@@ -22970,14 +22970,14 @@
 @item @i{other_renderer} = @i{renderer}  [, @i{other_renderer_args}]
 Enlisting of a a renderer function followed by its specific arguments.
 @item @i{renderer}
-The function that does the rendering. By default it is 
+The function that does the rendering. By default it is
 @samp{lib.maze.renderer_standard} with the above given arguments. Other supplied
-renderers are @samp{lib.maze.renderer_window} and 
+renderers are @samp{lib.maze.renderer_window} and
 @samp{lib.maze.renderer_strip}
 
 @item @i{persistence}
 A boolean flag that defaults to @samp{false}. You need to set it to @samp{true}
-if you want to access the maze or any of its cells after the level 
+if you want to access the maze or any of its cells after the level
 initialization. Otherwise the maze reference handle with all its data may get
 invalid due to memory garbage collection. This is no problem for most mazes,
 that will be directly rendered and have no need of further evaluation or changes
@@ -22989,7 +22989,7 @@
 maze1 = res.maze(ti, @{area =@{"anchor1", 4, 5@}, render = @{" ", "-", " "@}@})
 maze2 = res.maze(ti, @{area =@{"."@}, kernel=@{1,1@}, render = @{"!", "~", "-"@}@})
 maze3 = res.maze(ti, @{area =@{"amaze#*"@}, render = @{@{".","+"@}, "~", "-"@}@})
-maze4 = res.maze(ti, @{area =@{po(2, 12), 5, 5@}, kernel=@{3,2@}, 
+maze4 = res.maze(ti, @{area =@{po(2, 12), 5, 5@}, kernel=@{3,2@},
                    render = @{".", wo:newMap(" ", @{"!!!~","--!~","~~~~"@})@}@})
 @end example
 
@@ -23402,15 +23402,15 @@
 @cindex flood
 
 A flood is active @ref{fl_water} that, originating from a source, spreads over
- at ref{floodable} areas. In contrast to a flood standard water is just static, 
+ at ref{floodable} areas. In contrast to a flood standard water is just static,
 its @samp{state} is @samp{IDLE} and it will not spread to adjacent floors. But
 a flood reaching a static water lake will cross it as a tsunami and continue
 actively spreading on all riparian zones.
 
-You set up the area by adding the attribute @ref{floodable} with value 
+You set up the area by adding the attribute @ref{floodable} with value
 @code{true} on all its floors. Just @ref{fl_water} and the framed variants of
- at ref{fl_wood}, @ref{fl_hay} and @ref{fl_rock} do not require to be explicitly 
-marked floodable as they are floodable by default. The marked area is the 
+ at ref{fl_wood}, @ref{fl_hay} and @ref{fl_rock} do not require to be explicitly
+marked floodable as they are floodable by default. The marked area is the
 maximum area that may be flooded. But obstacles may block the flood temporarily
 or permanently.
 
@@ -23419,7 +23419,7 @@
 floodable neighboring grids with a speed defined by the attribute
 @samp{interval}. The speed will be inherited to floors flooded by the stream.
 
-Floodable floors with solid stones, closed doors or @ref{st_window} with 
+Floodable floors with solid stones, closed doors or @ref{st_window} with
 blocking faces on top will keep the flood from spreading to their grid position
 or if already flooded to spread to a neighboring grid. But as soon as the
 obstacle vanishes, e.g. an @ref{st_door} opens, the flood continues to spread.
@@ -23429,19 +23429,19 @@
 Of special interest are the @ref{st_box} variants and their successor floors,
 the framed variants of @ref{fl_wood}, @ref{fl_hay} and @ref{fl_rock}. A flood
 will flow beneath a box stone, if the floor beneath is floodable. In consequence
-of the upcoming water, the box stone will fall and build a framed floor of the 
-given kind. These floors act like bridges over flooding water. They still let 
+of the upcoming water, the box stone will fall and build a framed floor of the
+given kind. These floors act like bridges over flooding water. They still let
 the flood spread to further neighboring floodable floors. Thus a user can not
 stop a flood by pushing an @ref{st_box} onto its path, but he can make the water
 passable for his marbles. In fact this framed floors can even operate as a flood
 source, but we do not recommend this usage.
 
 In contrast to these floor building stones the @ref{st_puzzle} does neither
-fall on static nor on flooding @ref{fl_water}. As a solid stone it will even 
+fall on static nor on flooding @ref{fl_water}. As a solid stone it will even
 block a flood on neighboring grids to reach its position. But of course once
 moved completely over @ref{fl_water} the puzzle will fall if its own conditions
 are met. The successor @ref{fl_gray} will not build a bridge over water. It
-fills up the ditch and replaces the water completely. Thus the user can use 
+fills up the ditch and replaces the water completely. Thus the user can use
 puzzles to stop a flood.
 
 When a flood stream spreads to a new floor items on these floors may be affected.
@@ -23455,8 +23455,8 @@
 but of course just if it is in state @samp{OPEN}. In case the destinations are
 vortices, too, they must be open, too, for a successful flood spreading. When the
 last closed vortex on either end opens again the hold flood continues to spread.
-Note that in these cases the flood reaches the destination grid from beneath. 
-Thus no stone will block the emerging water. But nevertheless a stone on the 
+Note that in these cases the flood reaches the destination grid from beneath.
+Thus no stone will block the emerging water. But nevertheless a stone on the
 destination position may well block the water from spreading to the neighboring
 grids.
 
@@ -23465,7 +23465,7 @@
 independently of a still existing connection to the flood source. Thus once a
 door is opened and a bit of the flood passes the door, the flood will continue
 to spread even if the door closes again. Same is true for toggling vortices or
-puzzle stones being pushed into a flood building a complete bridge over the 
+puzzle stones being pushed into a flood building a complete bridge over the
 water stream. But this feature is intentionally, as it avoids many shortcut
 situations and thus makes the flood more usable for level authors.
 
@@ -23576,7 +23576,7 @@
 A good model of the 0.92-system can be attained via the
 compatibility-modes: All non-Enigma-modes (@pxref{Engine Compatibility} and
 @ref{<compatibility>}) feature a version which only marginally differs from
-0.92-fire, yet allowing some of the new achievements, like secure- or 
+0.92-fire, yet allowing some of the new achievements, like secure- or
 eternal-fire.
 
 Note that in 0.92, fire-transformation happened at the beginning of
@@ -23599,7 +23599,7 @@
 
 All other floors are fireproof (they don't burn by default):
 @code{fl_abyss*, fl_brick, fl_bright, fl_concrete, fl_dark, fl_darkgray,
-fl_dummy, fl_dunes,  fl_gravel, fl_gray, fl_himalaya, fl_ice, fl_inverse*, 
+fl_dummy, fl_dunes,  fl_gravel, fl_gray, fl_himalaya, fl_ice, fl_inverse*,
 fl_metal*, fl_mortar, fl_pinkbumps, fl_rock, fl_sahara, fl_sand, fl_slope*,
 fl_space, fl_stone, fl_swamp, fl_water, fl_white, fl_yinyang*}, and
 @ref{fl_bridge}_g*.
@@ -23945,12 +23945,12 @@
 first parameter of the configurator call needs to be the third context
 table entry.
 
-The context needs to add a metatable with two entries. First @code{"_type"} 
+The context needs to add a metatable with two entries. First @code{"_type"}
 needs to identify the context as an enigma data type for the @ref{etype}
 function. Most resolvers to simply store the string @code{"resolver"}, but
 special ones might return special identification strings like @code{"maze"}.
 The second required entry is @code{"_resolver"} that needs a boolean @samp{true}
-value assigned for purpose of secure identification of resolver tables. A 
+value assigned for purpose of secure identification of resolver tables. A
 default resolver metatable is stored at @samp{res.metatable} and can directly
 be set by @samp{setmetatable}.
 
@@ -24161,7 +24161,7 @@
 @strong{@code{oxyd1}-compatibility}
 
 @itemize @bullet
- at item @ref{it_seed} grows to @ref{fl_wood}_framed under @ref{st_grate}_cross, 
+ at item @ref{it_seed} grows to @ref{fl_wood}_framed under @ref{st_grate}_cross,
 not to @ref{st_box}_wood.
 @item Flying actors may pass @ref{st_grate}).
 @item @ref{st_box}_wood only falls when moved.
@@ -24186,7 +24186,7 @@
 @strong{@code{oxyd.magnum}-compatibility}
 
 @itemize @bullet
- at item @ref{it_seed} grows to @ref{fl_wood}_framed under @ref{st_grate}_cross, 
+ at item @ref{it_seed} grows to @ref{fl_wood}_framed under @ref{st_grate}_cross,
 not to @ref{st_box}_wood.
 @item Bombs at ref{it_bomb} aren't ignited when @ref{st_box}_wood is pushed over
 them (see @code{oxyd1}-compatibility).



From raoulb at bluewin.ch  Mon Aug  3 14:24:56 2009
From: raoulb at bluewin.ch (Raoul)
Date: Mon, 3 Aug 2009 14:24:56 +0200
Subject: [Enigma-game-svn] r1777
Message-ID: <20090803142456.53eccdc0@amarok.loinet.zh>

Levelupdates, new levels, and fixes


From ral at mail.berlios.de  Mon Aug 10 00:02:10 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Mon, 10 Aug 2009 00:02:10 +0200
Subject: [Enigma-game-svn] r1778 - in trunk: data doc/reference
	doc/reference/images src src/stones
Message-ID: <200908092202.n79M2As1021641@sheep.berlios.de>

Author: ral
Date: 2009-08-10 00:01:49 +0200 (Mon, 10 Aug 2009)
New Revision: 1778

Modified:
   trunk/data/api2init.lua
   trunk/doc/reference/enigma-ref.texi
   trunk/doc/reference/images/Makefile.am
   trunk/src/actors.cc
   trunk/src/floors.cc
   trunk/src/lua.cc
   trunk/src/stones/MirrorStone.cc
Log:
Trunk 1.1: 
- Mirror attribute "orientation" - new value on set: RANDOMDIR
- fix actor startingpos in case of actors being set during runtime - this
    fixes problems with "gohome" attribute and it_flag
- floor attribute "initfire": evaluate attribute for floors being set after
    level start, too
- refman:
  - add some missing images
  - some fixes


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2009-08-03 12:20:47 UTC (rev 1777)
+++ trunk/data/api2init.lua	2009-08-09 22:01:49 UTC (rev 1778)
@@ -1,5 +1,5 @@
 ------------------------------------------------------------------------
--- Copyright (C) 2008 Ronald Lamprecht
+-- Copyright (C) 2008,2009 Ronald Lamprecht
 --
 -- This program is free software; you can redistribute it and/or
 -- modify it under the terms of the GNU General Public License
@@ -121,15 +121,16 @@
 OXYD_BOLD   = -4
 
 -- direction/orientations
-NODIR = -1
-WEST  = 0
-SOUTH = 1
-EAST  = 2
-NORTH = 3
-NORTHWEST = 4
-SOUTHWEST = 5
-SOUTHEAST = 6
-NORTHEAST = 7
+RANDOMDIR = -2
+NODIR     = -1
+WEST      =  0
+SOUTH     =  1
+EAST      =  2
+NORTH     =  3
+NORTHWEST =  4
+SOUTHWEST =  5
+SOUTHEAST =  6
+NORTHEAST =  7
 
 -- alternative orientation notation for mirrors
 BACKSLASH  = 0

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-08-03 12:20:47 UTC (rev 1777)
+++ trunk/doc/reference/enigma-ref.texi	2009-08-09 22:01:49 UTC (rev 1778)
@@ -8717,6 +8717,7 @@
 choose the constant that is appropriate for an object and do avoid using numbers.
 
 @itemize @bullet
+ at item @samp{RANDOMDIR} = @code{-2}, by @ref{st_mirror}
 @item @samp{NODIR} = @code{-1}, by @ref{fl_slope}
 @item @samp{WEST} = @code{0}, by all objects with 4 orientations
 @item @samp{SOUTH} = @code{1}, by all actors with 4 orientations
@@ -10167,7 +10168,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/fl_darkgray, 12mm} @b{fl_darkgray}
- at item @image{images/fl_darkgray_framed, 12mm}@b{fl_darkgray_framed}
+ at item @image{images/fl_darkgray_framed, 12mm} @b{fl_darkgray_framed}
 @end table
 @end table
 
@@ -11369,7 +11370,7 @@
 @tab @image{images/it_meditation_volcano, 12mm} @tab @yref{it_meditation}_volcano
 @item @image{images/it_pencil, 12mm} @tab @yref{it_pencil}
 @tab @image{images/it_pin, 12mm} @tab @yref{it_pin}
- at tab @image{images/it_pipe, 12mm} @tab @yref{it_pipe}
+ at tab @image{images/it_pipe_e, 12mm} @tab @yref{it_pipe}
 @item @image{images/it_puller, 12mm} @tab @yref{it_puller}
 @tab @image{images/it_ring, 12mm} @tab @yref{it_ring}
 @tab @image{images/it_rubberband, 12mm} @tab @yref{it_rubberband}
@@ -12393,17 +12394,17 @@
 
 @item @b{Variants:}
 @table @asis
- at item @image{images/fl_white, 12mm} @b{it_pipe} connections = @code{"ew"} The horizontal pipe.
- at item @image{images/fl_white, 12mm} @b{it_pipe_w} connections = @code{"w"}
- at item @image{images/fl_white, 12mm} @b{it_pipe_s} connections = @code{"s"}
- at item @image{images/fl_white, 12mm} @b{it_pipe_sw} connections = @code{"sw"}
+ at item @image{images/it_pipe_e, 12mm} @b{it_pipe} connections = @code{"ew"} The horizontal pipe.
+ at item @image{images/it_pipe_f, 12mm} @b{it_pipe_w} connections = @code{"w"}
+ at item @image{images/it_pipe_b, 12mm} @b{it_pipe_s} connections = @code{"s"}
+ at item @image{images/it_pipe_d, 12mm} @b{it_pipe_sw} connections = @code{"sw"}
 @item @image{images/it_pipe, 12mm} @b{it_pipe_e} connections = @code{"e"}
- at item @image{images/fl_white, 12mm} @b{it_pipe_ew} connections = @code{"ew"} The horizontal pipe.
- at item @image{images/fl_white, 12mm} @b{it_pipe_es} connections = @code{"es"}
- at item @image{images/fl_white, 12mm} @b{it_pipe_n} connections = @code{"n"}
- at item @image{images/fl_white, 12mm} @b{it_pipe_nw} connections = @code{"nw"}
- at item @image{images/fl_white, 12mm} @b{it_pipe_ns} connections = @code{"ns"} The vertical pipe.
- at item @image{images/fl_white, 12mm}@b{it_pipe_ne} connections = @code{"ne"}
+ at item @image{images/it_pipe_e, 12mm} @b{it_pipe_ew} connections = @code{"ew"} The horizontal pipe.
+ at item @image{images/it_pipe_c, 12mm} @b{it_pipe_es} connections = @code{"es"}
+ at item @image{images/it_pipe_g, 12mm} @b{it_pipe_n} connections = @code{"n"}
+ at item @image{images/it_pipe_i, 12mm} @b{it_pipe_nw} connections = @code{"nw"}
+ at item @image{images/it_pipe_j, 12mm} @b{it_pipe_ns} connections = @code{"ns"} The vertical pipe.
+ at item @image{images/it_pipe_h, 12mm}@b{it_pipe_ne} connections = @code{"ne"}
 @end table
 @end table
 
@@ -13963,7 +13964,7 @@
 @table @asis
 @item @image{images/it_vortex, 12mm} @b{it_vortex}:  state = @code{OPEN}.
 @item @image{images/it_vortex, 12mm} @b{it_vortex_open}: state = @code{OPEN}.
- at item @image{images/fl_white, 12mm} @b{it_vortex_closed}: state @samp{CLOSED}.
+ at item @image{images/it_vortex_4, 12mm} @b{it_vortex_closed}: state @samp{CLOSED}.
 @end table
 @end table
 
@@ -14000,7 +14001,7 @@
 
 @item @b{Attributes:}
 @table @asis
- at item @b{state}, @ @ @i{values}: @code{ON}, @code{OFF}; @ @ @i{default}: @code{OFF} @ @ @xref{state}
+ at item @b{state}, @ @ @i{values}: @code{ON}, @code{OFF}; @ @ @i{default}: @code{ON} @ @ @xref{state}
 The current force state - @samp{ON} for a force applying wormholes, @samp{OFF}
 for force neutral wormholes.
 @item @b{destination}, @ @ @i{values}: tokens or position; @ @ @i{default}: @code{nil} @ @ @xref{destination}
@@ -14036,7 +14037,7 @@
 
 @item @b{Variants:}
 @table @asis
- at item @image{images/it_wormhole, 12mm} @b{it_wormhole}: state = @code{OFF}.
+ at item @image{images/it_wormhole, 12mm} @b{it_wormhole}: state = @code{ON}.
 @item @image{images/it_wormhole, 12mm} @b{it_wormhole_on}: state = @code{ON}.
 @item @image{images/fl_white, 12mm} @b{it_wormhole_off}: state @code{OFF}.
 @end table
@@ -16856,11 +16857,13 @@
 @item @b{state}, @ @ @i{values}: @code{NORTH}, @code{EAST}, @code{SOUTH}, @code{WEST}; @ @ @i{default}: @code{NORTH}; @ @ @xref{state}
 The orientation of the mirror. For a triangular mirror it is the triangle's
 pointing direction. For a planar mirror it is the reflection direction of an
-incoming northbound beam.
- at item @b{orientation}, @ @ @i{values}: @code{NORTH}, @code{EAST}, @code{SOUTH}, @code{WEST}; @ @ @i{default}: @code{NORTH}
+incoming northbound beam. 
+ at item @b{orientation}, @ @ @i{values}: @code{NORTH}, @code{EAST}, @code{SOUTH}, @code{WEST}, @code{RANDOMDIR}; @ @ @i{default}: @code{NORTH}
 The orientation of the mirror. For a triangular mirror it is the triangle's
 pointing direction. For a planar mirror it is the reflection direction of an
-incoming northbound beam.
+incoming northbound beam. The value @code{RANDOMDIR} is just evaluated when the
+mirror is being set. From this point of time the mirror will report a random
+orientation out of the other 4 real orientations.
 @item @b{transparent} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 Semitransparency of the mirror panes.
 @item @b{movable} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false} @ @ @xref{movable}

Modified: trunk/doc/reference/images/Makefile.am
===================================================================
--- trunk/doc/reference/images/Makefile.am	2009-08-03 12:20:47 UTC (rev 1777)
+++ trunk/doc/reference/images/Makefile.am	2009-08-09 22:01:49 UTC (rev 1778)
@@ -84,7 +84,8 @@
 	it_meditation_volcano.png \
 	it_pencil.png \
 	it_pin.png \
-	it_pipe.png \
+	it_pipe.png it_pipe_b.png it_pipe_c.png it_pipe_d.png it_pipe_e.png \
+	it_pipe_f.png it_pipe_g.png it_pipe_h.png it_pipe_i.png it_pipe_j.png \
 	it_puller.png it_puller_2.png it_puller_3.png it_puller_4.png \
 	it_ring.png \
 	it_rubberband.png \
@@ -109,7 +110,7 @@
 	it_trap.png \
 	it_trigger.png \
 	it_umbrella.png \
-	it_vortex.png \
+	it_vortex.png it_vortex_4.png \
 	it_weight.png \
 	it_wormhole.png \
 	it_wrench.png \

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2009-08-03 12:20:47 UTC (rev 1777)
+++ trunk/src/actors.cc	2009-08-09 22:01:49 UTC (rev 1778)
@@ -125,9 +125,7 @@
     }
 
     Value Actor::message(const Message &m) {
-        if (m.message == "_init") {
-            startingpos = get_pos();
-        } else if (m.message == "_freeze") {
+        if (m.message == "_freeze") {
             m_actorinfo.frozen_vel = m_actorinfo.vel;
             m_actorinfo.vel = ecl::V2();
         } else if (m.message == "_revive") {
@@ -224,6 +222,7 @@
 }
 
 void Actor::on_creation(const ecl::V2 &p)  {
+    startingpos = get_pos();
     if (Value vx = getAttr("velocity_x")) {
         m_actorinfo.vel = V2(vx,  m_actorinfo.vel[1]);
     }

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2009-08-03 12:20:47 UTC (rev 1777)
+++ trunk/src/floors.cc	2009-08-09 22:01:49 UTC (rev 1778)
@@ -117,6 +117,9 @@
         if (Value v = GridObject::getAttr("friction"))
             friction = v;
         GridObject::on_creation(p);
+        
+        if (server::WorldInitialized && has_firetype(flft_initfire))
+            force_fire();
     }
 
 void Floor::get_sink_speed (double &sinkspeed, double &raisespeed) const {

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2009-08-03 12:20:47 UTC (rev 1777)
+++ trunk/src/lua.cc	2009-08-09 22:01:49 UTC (rev 1778)
@@ -2186,7 +2186,10 @@
         name = name.substr(1);
     }
     
-    if (name == "fl_nil") {
+    if (name == "nil") {
+        lua_pop(L, 1);   // object type
+        return 0;
+    } else if (name == "fl_nil") {
         if (!onlyFloors)
             KillFloor(GridPos(xi, yi));
         lua_pop(L, 1);   // object type

Modified: trunk/src/stones/MirrorStone.cc
===================================================================
--- trunk/src/stones/MirrorStone.cc	2009-08-03 12:20:47 UTC (rev 1777)
+++ trunk/src/stones/MirrorStone.cc	2009-08-09 22:01:49 UTC (rev 1778)
@@ -76,8 +76,13 @@
                 handled = true;
             }
         } else if (key == "orientation") {
-            if (val >= minState() && val <= maxState()) {
-                setState(val);
+            int orientation = val;
+            // random orientation
+            if (orientation == -2)
+                orientation = IntegerRand(minState(), maxState());
+            
+            if (orientation >= minState() && orientation <= maxState()) {
+                setState(orientation);
                 handled = true;
             }
         } else if (key == "transparent") {



From ral at mail.berlios.de  Tue Aug 11 00:16:09 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Tue, 11 Aug 2009 00:16:09 +0200
Subject: [Enigma-game-svn] r1779 - in trunk: doc/reference
	doc/reference/images src
Message-ID: <200908102216.n7AMG9Vv017086@sheep.berlios.de>

Author: ral
Date: 2009-08-11 00:16:00 +0200 (Tue, 11 Aug 2009)
New Revision: 1779

Modified:
   trunk/doc/reference/enigma-ref.texi
   trunk/doc/reference/images/Makefile.am
   trunk/src/actors.cc
Log:
Trunk 1.1: 
- addendum r1778: introduced pseudo object of class "nil" to allow valid
    tile declarations that do neither add nor delete anything
- fix actor behaviour: do first leave old grid before entering new grid
- refman:
  - add some missing images
  - some fixes


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-08-09 22:01:49 UTC (rev 1778)
+++ trunk/doc/reference/enigma-ref.texi	2009-08-10 22:16:00 UTC (rev 1779)
@@ -11994,7 +11994,7 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/it_dynamite, 12mm} @b{it_dynamite}: state = @code{IDLE}
- at item @image{images/fl_white, 12mm} @b{it_dynamite_burning}: state = @code{ACTIVE}
+ at item @image{images/it_dynamite_burning, 12mm} @b{it_dynamite_burning}: state = @code{ACTIVE}
 @end table
 
 @end table
@@ -12040,9 +12040,9 @@
 @item @b{Variants:}
 @table @asis
 @item @image{images/it_extinguisher, 12mm} @b{it_extinguisher}: state = @code{FULL}
- at item @image{images/it_extinguisher, 12mm} @b{it_extinguisher_empty}: state = @code{FULL}
- at item @image{images/fl_white, 12mm} @b{it_extinguisher_medium}: state = @code{MEDIUM}
- at item @image{images/fl_white, 12mm} @b{it_extinguisher_full}: state = @code{FULL}
+ at item @image{images/it_extinguisher, 12mm} @b{it_extinguisher_full}: state = @code{FULL}
+ at item @image{images/it_extinguisher_2, 12mm} @b{it_extinguisher_medium}: state = @code{MEDIUM}
+ at item @image{images/it_extinguisher_3, 12mm} @b{it_extinguisher_empty}: state = @code{EMPTY}
 @end table
 
 @end table
@@ -13223,13 +13223,18 @@
 @end table
 
 @item @b{Variants:}
- at table @asis
- at item @image{images/it_crack_abyss, 12mm} @b{it_crack}: state = @code{SMALL}
- at item @image{images/fl_white, 12mm} @b{it_crack_i}: state = @code{INVISIBLE}
- at item @image{images/it_crack_abyss, 12mm} @b{it_crack_s}: state = @code{SMALL}
- at item @image{images/fl_white, 12mm} @b{it_crack_m}: state = @code{MEDIUM}
- at item @image{images/fl_white, 12mm} @b{it_crack_l}: state = @code{LARGE}
- at end table
+ at multitable @columnfractions .08 .42 .08 .42
+ at item @image{images/it_crack_abyss, 12mm}@tab  @b{it_crack}: state = @code{SMALL}, flavor = @code{"abyss"}
+ at tab @image{images/it_crack_water, 12mm}@tab  @b{it_crack}: state = @code{SMALL}, flavor = @code{"water"}
+ at item @image{images/fl_white, 12mm}@tab  @b{it_crack_i}: state = @code{INVISIBLE}, flavor = @code{"abyss"}
+ at tab @image{images/fl_white, 12mm}@tab  @b{it_crack_i}: state = @code{INVISIBLE}, flavor = @code{"water"}
+ at item @image{images/it_crack_abyss, 12mm}@tab  @b{it_crack_s}: state = @code{SMALL}, flavor = @code{"abyss"}
+ at tab @image{images/it_crack_water, 12mm}@tab  @b{it_crack_s}: state = @code{SMALL}, flavor = @code{"water"}
+ at item @image{images/it_crack_abyss_2, 12mm}@tab  @b{it_crack_m}: state = @code{MEDIUM}, flavor = @code{"abyss"}
+ at tab @image{images/it_crack_water_2, 12mm}@tab  @b{it_crack_m}: state = @code{MEDIUM}, flavor = @code{"water"}
+ at item @image{images/it_crack_abyss_3, 12mm}@tab  @b{it_crack_l}: state = @code{LARGE}, flavor = @code{"abyss"}
+ at tab @image{images/it_crack_water_3, 12mm}@tab  @b{it_crack_l}: state = @code{LARGE}, flavor = @code{"water"}
+ at end multitable
 
 @end table
 

Modified: trunk/doc/reference/images/Makefile.am
===================================================================
--- trunk/doc/reference/images/Makefile.am	2009-08-09 22:01:49 UTC (rev 1778)
+++ trunk/doc/reference/images/Makefile.am	2009-08-10 22:16:00 UTC (rev 1779)
@@ -54,15 +54,15 @@
 	it_coin_s.png \
 	it_coin_m.png \
 	it_coin_l.png \
-	it_crack_abyss.png \
-	it_crack_water.png \
+	it_crack_abyss.png it_crack_abyss_2.png it_crack_abyss_3.png \
+	it_crack_water.png it_crack_water_2.png it_crack_water_3.png \
 	it_cross.png \
 	it_death.png \
 	it_document.png \
 	it_drop.png \
-	it_dynamite.png \
+	it_dynamite.png it_dynamite_burning.png \
 	it_explosion.png \
-	it_extinguisher.png \
+	it_extinguisher.png it_extinguisher_2.png it_extinguisher_3.png \
 	it_extralife.png \
 	it_flag_black.png \
 	it_flag_white.png \

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2009-08-09 22:01:49 UTC (rev 1778)
+++ trunk/src/actors.cc	2009-08-10 22:16:00 UTC (rev 1779)
@@ -1,6 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004,2005 Daniel Heck
- * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2008,2009 Ronald Lamprecht
  * 
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -254,17 +254,20 @@
     if (m_actorinfo.field) {
         if (m_actorinfo.gridpos != last_gridpos) {
             // Actor entered a new field -> notify floor and item objects
-            if (Floor *fl = m_actorinfo.field->floor)
-                fl->actor_enter (this);
-            if (Item *it = m_actorinfo.field->item)
-                it->actor_enter (this);
-
+            // first leave old - avoid the possibility that an actor presses
+            // two triggers at once.
             if (const Field *of = GetField(last_gridpos)) {
                 if (Floor *fl = of->floor)
-                    fl->actor_leave (this);
+                    fl->actor_leave(this);
                 if (Item *it = of->item)
-                    it->actor_leave (this);
+                    it->actor_leave(this);
             }
+            // then enter new field
+            if (Floor *fl = m_actorinfo.field->floor)
+                fl->actor_enter(this);
+            if (Item *it = m_actorinfo.field->item)
+                it->actor_enter(this);
+
         }
 
         Item *it = m_actorinfo.field->item;



From ral at mail.berlios.de  Tue Aug 11 23:39:03 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Tue, 11 Aug 2009 23:39:03 +0200
Subject: [Enigma-game-svn] r1780 - in trunk: etc src/items
Message-ID: <200908112139.n7BLd3Rh016300@sheep.berlios.de>

Author: ral
Date: 2009-08-11 23:38:56 +0200 (Tue, 11 Aug 2009)
New Revision: 1780

Modified:
   trunk/etc/mingw32-dist.sh.in
   trunk/src/items/Magnet.cc
Log:
Trunk 1.1: 
- add curl dll to mingw dist
- fix magnet: show proper animation on being switched on


Modified: trunk/etc/mingw32-dist.sh.in
===================================================================
--- trunk/etc/mingw32-dist.sh.in	2009-08-10 22:16:00 UTC (rev 1779)
+++ trunk/etc/mingw32-dist.sh.in	2009-08-11 21:38:56 UTC (rev 1780)
@@ -6,7 +6,7 @@
 DDIR="`pwd`/Enigma-$VERSION"
 SDIR=@top_srcdir@
 BDIR=@top_builddir@
-DLLDEFAULTS="SDL SDL_image SDL_mixer SDL_ttf jpeg zlib1 libfreetype-6 libogg-0 libpng12-0 libtiff-3 libvorbis-0 libvorbisfile-3 smpeg"
+DLLDEFAULTS="SDL SDL_image SDL_mixer SDL_ttf jpeg zlib1 libfreetype-6 libogg-0 libpng12-0 libtiff-3 libvorbis-0 libvorbisfile-3 smpeg libcurl-4"
 
 if [ "$ENIGMADEVDLLS" != "" ]; then
   DLLS=$ENIGMADEVDLLS

Modified: trunk/src/items/Magnet.cc
===================================================================
--- trunk/src/items/Magnet.cc	2009-08-10 22:16:00 UTC (rev 1779)
+++ trunk/src/items/Magnet.cc	2009-08-11 21:38:56 UTC (rev 1780)
@@ -66,6 +66,7 @@
                     AddForceField(this);
                 else
                     RemoveForceField(this);
+                init_model();
             }
         }
     }



From ral at mail.berlios.de  Fri Aug 14 01:00:14 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 14 Aug 2009 01:00:14 +0200
Subject: [Enigma-game-svn] r1781 - in trunk: . builds data/levels/lib src
Message-ID: <200908132300.n7DN0Ei9018029@sheep.berlios.de>

Author: ral
Date: 2009-08-14 01:00:11 +0200 (Fri, 14 Aug 2009)
New Revision: 1781

Added:
   trunk/builds/
   trunk/builds/macosx/
Modified:
   trunk/Makefile.am
   trunk/data/levels/lib/libmap.xml
   trunk/src/Object.cc
   trunk/src/Object.hh
   trunk/src/Value.cc
   trunk/src/Value.hh
   trunk/src/floors.cc
   trunk/src/lua.cc
   trunk/src/world.cc
Log:
Trunk 1.1:
- libmap: brute force speedup of fuse op for a special case by a factor 100
- _init broadcast message speedup by appr. factor 5
- _init fix shadowing by floor fire handling
- .PHONY declarations for Makefiles
Note:
- libmap needs tuning in other cases, too


Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2009-08-11 21:38:56 UTC (rev 1780)
+++ trunk/Makefile.am	2009-08-13 23:00:11 UTC (rev 1781)
@@ -11,27 +11,34 @@
 
 ACLOCAL_AMFLAGS = -I m4
 
+.PHONY: tolua
 tolua:
 	cd src && $(MAKE) $(AM_MAKEFLAGS) tolua
 
+.PHONY: pot
 pot:
 	cd po && $(MAKE) $(AM_MAKEFLAGS) enigma.pot-update
 
+.PHONY: pos
 pos:
 	cd po && $(MAKE) $(AM_MAKEFLAGS) update-po
 
+.PHONY: gmo
 gmo:
 	cd po && $(MAKE) $(AM_MAKEFLAGS) update-gmo
 
+.PHONY: macapp
 macapp:
 	cd src && $(MAKE) $(AM_MAKEFLAGS) bundle && $(MAKE) $(AM_MAKEFLAGS) bundle-fw && $(MAKE) $(AM_MAKEFLAGS) bundle-doc && $(MAKE) $(AM_MAKEFLAGS) bundle-dmg
 
+.PHONY: pdf
 pdf:
 	cd doc/manual/images && $(MAKE) pdf
 	cd doc/manual && $(MAKE) pdf
 	cd doc/reference/images && $(MAKE) pdf
 	cd doc/reference && $(MAKE) pdf
 
+.PHONY: doxygen
 doxygen:
 	cd doc && $(MAKE) doxygen
 

Modified: trunk/data/levels/lib/libmap.xml
===================================================================
--- trunk/data/levels/lib/libmap.xml	2009-08-11 21:38:56 UTC (rev 1780)
+++ trunk/data/levels/lib/libmap.xml	2009-08-13 23:00:11 UTC (rev 1781)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libmap"/>
-      <el:version el:score="1" el:release="1" el:revision="5" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="6" el:status="released"/>
       <el:author  el:name="Enigma Team" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -97,12 +97,24 @@
     assert_type(map1, "lib.map.fuse first argument", 2, "map")
     assert_type(map2, "lib.map.fuse second argument", 2, "map")
     local result = {}
+    if type(arg1) == "string" and string.len(arg1) == 1 and map2.__keylength == 1 then
+--        print ("map fuse optimizer")
+        for y = 1, map2.height do
+            local line2 = map2[y]
+            local line = ""
+            for x = 1, string.len(line2) do
+                line = line .. arg1 .. string.sub(line2, x, x)
+            end
+            result[y] = line
+        end
+    else
     for y = 1, math.max(map1.height, map2.height) do
         result[y] = ""
         for x = 1, math.max(map1.width, map2.width) do
             result[y] = result[y] .. map1[{x - 1, y - 1}] .. map2[{x - 1, y - 1}]
         end
     end
+    end
     return wo:newMap(map1.defaultkey .. map2.defaultkey, result)  
 end
 

Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2009-08-11 21:38:56 UTC (rev 1780)
+++ trunk/src/Object.cc	2009-08-13 23:00:11 UTC (rev 1781)
@@ -149,7 +149,8 @@
     Value Object::message(const Message &m) {
         if (m.message == "_init") {
             // finalize nearest target and destination
-            finalizeNearestObjectReferences();
+            if (objFlags & OBJBIT_INIT)
+                finalizeNearestObjectReferences();
         } else if (m.message == "kill") {
             switch (getObjectType()) {
                 case OTHER:
@@ -239,9 +240,12 @@
                     (*itr)->setAttr("fellows", olist2);
                 }
             }
-        } else if (key.find('_') == 0 || ObjectValidator::instance()->validateAttributeWrite(this, key, val))
+        } else if (key.find('_') == 0 || ObjectValidator::instance()->validateAttributeWrite(this, key, val)) {
+            if (key == "destination" || key.find("target") == 0)
+                 if (val.maybeNearestObjectReference())
+                     objFlags |= OBJBIT_INIT; 
             setAttr(key, val);
-        else
+        } else
             ASSERT(false, XLevelRuntime, ecl::strf("Object: attribute '%s' write not allowed for kind '%s'",
                     key.c_str(), getKind().c_str()).c_str());
     }

Modified: trunk/src/Object.hh
===================================================================
--- trunk/src/Object.hh	2009-08-11 21:38:56 UTC (rev 1780)
+++ trunk/src/Object.hh	2009-08-13 23:00:11 UTC (rev 1781)
@@ -1,6 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2007,2008 Ronald Lamprecht
+ * Copyright (C) 2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -39,7 +39,8 @@
         OBJBIT_LIGHTALLDIRS  =  255,   ///< GridObject all 8 direction bits with old an new light
         OBJBIT_PHOTOACTIV    =  1<<8,  ///< GridObject registered as photo activ
         OBJBIT_INVERSE       =  1<<9,  ///< Object invert action value
-        OBJBIT_NOP           =  1<<10  ///< Object use nop instead toggle as default action
+        OBJBIT_NOP           =  1<<10, ///< Object use nop instead toggle as default action
+        OBJBIT_INIT          =  1<<11  ///< Object needs init message for @ finalization
     };
     
     class Value;

Modified: trunk/src/Value.cc
===================================================================
--- trunk/src/Value.cc	2009-08-11 21:38:56 UTC (rev 1780)
+++ trunk/src/Value.cc	2009-08-13 23:00:11 UTC (rev 1781)
@@ -558,6 +558,12 @@
         return false;
     }
     
+    bool Value::maybeNearestObjectReference() const {
+        if (type == STRING || type == NAMEDOBJECT || type == GROUP || type == TOKENS)
+            return std::string(val.str).find('@') != std::string::npos;
+        else
+            return false;
+    }
     
     int to_int(const Value &v) {
         return v;

Modified: trunk/src/Value.hh
===================================================================
--- trunk/src/Value.hh	2009-08-11 21:38:56 UTC (rev 1780)
+++ trunk/src/Value.hh	2009-08-13 23:00:11 UTC (rev 1781)
@@ -251,6 +251,7 @@
         ObjectList getObjectList(Object *reference = NULL) const;
         PositionList getPositionList(Object *reference =NULL) const;
         bool finalizeNearestObjectReference(Object *reference = NULL);
+        bool maybeNearestObjectReference() const;
     private:
         void clear();      ///< Release resources and assign type NIL
 

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2009-08-11 21:38:56 UTC (rev 1780)
+++ trunk/src/floors.cc	2009-08-13 23:00:11 UTC (rev 1781)
@@ -68,18 +68,23 @@
     // "setfire"  : Just try to make fire (if burnable).
     // "forcefire": Force fire, even on unburnable floor.
     // "stopfire" : Stop fire, put ash but don't transform floor.
-    if (m.message == "_init" && has_firetype(flft_initfire))
-        return force_fire();
-    if (m.message == "heat")
+    if (m.message == "_init") {
+        if (has_firetype(flft_initfire))
+            force_fire();
+    } else if (m.message == "heat") {
         return try_heating(NODIR, flhf_message);
-    if ((m.message == "ignite" || m.message == "_explosion") && has_firetype(flft_ignitable))
+    } else if (m.message == "ignite" || m.message == "_explosion") {
+        if (has_firetype(flft_ignitable))
+            return try_ignite(NODIR, flhf_message);
+        else
+            return Value();
+    } else if (m.message == "setfire") {
         return try_ignite(NODIR, flhf_message);
-    if (m.message == "setfire")
-        return try_ignite(NODIR, flhf_message);
-    if (m.message == "forcefire")
+    } else if (m.message == "forcefire") {
         return force_fire();
-    if (m.message == "stopfire")
+    } else if (m.message == "stopfire") {
         return stop_fire(true);
+    }
     return GridObject::message(m);
 }
 

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2009-08-11 21:38:56 UTC (rev 1780)
+++ trunk/src/lua.cc	2009-08-13 23:00:11 UTC (rev 1781)
@@ -3674,6 +3674,7 @@
     int retval;
     const char *funcname = funcpath.c_str();
     
+//    Uint32 start_tick_time = SDL_GetTicks();   // meassure time for level loading
     if (funcpath.find('.')) {
         std::list<std::string> nodes;
         ecl::split_copy(funcpath, '.', std::back_inserter(nodes));
@@ -3707,6 +3708,9 @@
         if (retval != 0)  {  // error
             lua_setglobal(L, "_LASTERROR") ; //Set _LASTERROR to returned error message
         }
+//        double exectime = (SDL_GetTicks() - start_tick_time)/1000.0;
+//        if (exectime > -1.000)
+//            Log << ecl::strf("Lua callback '%s' did take %g seconds\n", funcname, exectime);
         return _lua_err_code(retval);
     } else {
         if (expectFunction) {

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2009-08-11 21:38:56 UTC (rev 1780)
+++ trunk/src/world.cc	2009-08-13 23:00:11 UTC (rev 1781)
@@ -1940,6 +1940,8 @@
     bool to_items  = (grids & GRID_ITEMS_BIT) != 0;
     bool to_stones = (grids & GRID_STONES_BIT) != 0;
 
+//    Uint32 start_tick_time = SDL_GetTicks();   // meassure time for level loading
+
     if (grids != 0) {
         for (int y = 0; y<height; ++y) {
             for (int x = 0; x<width; ++x) {
@@ -1961,6 +1963,10 @@
             SendMessage(*oit, msg, value);
         }
     }
+    
+//    double exectime = (SDL_GetTicks() - start_tick_time)/1000.0;
+//    Log << ecl::strf("World init did take %g seconds for floors %d, items %d, stones %d, actors %d, others %d\n", 
+//         exectime, to_floors, to_items, to_stones, actors, others);
 }
 
 void PerformSecureAction(int senderId, bool isCallback, int targetId, std::string name, Value val) {



From ral at mail.berlios.de  Mon Aug 17 00:25:58 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Mon, 17 Aug 2009 00:25:58 +0200
Subject: [Enigma-game-svn] r1782 - homepage/input
Message-ID: <200908162225.n7GMPwqc005368@sheep.berlios.de>

Author: ral
Date: 2009-08-17 00:25:51 +0200 (Mon, 17 Aug 2009)
New Revision: 1782

Modified:
   homepage/input/stat-other.html
   homepage/input/table-hcp.html
   homepage/input/table-rat.html
   homepage/input/table-solved.html
   homepage/input/table-wr.html
   homepage/input/userlist.html
Log:
Homepage:
- statistics July 2009


Modified: homepage/input/stat-other.html
===================================================================
--- homepage/input/stat-other.html	2009-08-13 23:00:11 UTC (rev 1781)
+++ homepage/input/stat-other.html	2009-08-16 22:25:51 UTC (rev 1782)
@@ -1,21 +1,21 @@
   <div class="stat-help">
     <h3>$$Other_Statistics$$</h3>
     <h4>$$Scores$$</h4>
-      94765 $$single_level_scores$$.
+      95183 $$single_level_scores$$.
     <h4>$$Ratings$$</h4>
-      17819 $$single_level_ratings$$ 4.93 $$and_distribution$$: 
+      17860 $$single_level_ratings$$ 4.93 $$and_distribution$$: 
       <table>
         <colgroup><col width="80"><col width="80"></colgroup>
         <tr><th>$$rating$$</th><th>$$count$$</th></tr>
         <tr><td class="num">0</td><td class="num">118</td></tr>
         <tr><td class="num">1</td><td class="num">320</td></tr>
         <tr><td class="num">2</td><td class="num">919</td></tr>
-        <tr><td class="num">3</td><td class="num">2451</td></tr>
-        <tr><td class="num">4</td><td class="num">3396</td></tr>
-        <tr><td class="num">5</td><td class="num">4253</td></tr>
-        <tr><td class="num">6</td><td class="num">3029</td></tr>
-        <tr><td class="num">7</td><td class="num">2030</td></tr>
-        <tr><td class="num">8</td><td class="num">801</td></tr>
+        <tr><td class="num">3</td><td class="num">2455</td></tr>
+        <tr><td class="num">4</td><td class="num">3398</td></tr>
+        <tr><td class="num">5</td><td class="num">4262</td></tr>
+        <tr><td class="num">6</td><td class="num">3050</td></tr>
+        <tr><td class="num">7</td><td class="num">2033</td></tr>
+        <tr><td class="num">8</td><td class="num">803</td></tr>
         <tr><td class="num">9</td><td class="num">333</td></tr>
         <tr><td class="num">10</td><td class="num">169</td></tr>
       </table>

Modified: homepage/input/table-hcp.html
===================================================================
--- homepage/input/table-hcp.html	2009-08-13 23:00:11 UTC (rev 1781)
+++ homepage/input/table-hcp.html	2009-08-16 22:25:51 UTC (rev 1782)
@@ -1,184 +1,186 @@
   <table>
-    <caption>$$Handicap_Statistics$$ $$June$$ 2009</caption>
+    <caption>$$Handicap_Statistics$$ $$July$$ 2009</caption>
     <colgroup><col width="130"><col width="220"></colgroup>
     <tr><th>$$solved_hcp$$</th><th class="left">$$user$$</th></tr>
-     <tr><td class="num">-153.7</td><td class="left">'Moneymaker'</td></tr>
-     <tr><td class="num">-119.7</td><td class="left">'Medimaster'</td></tr>
-     <tr><td class="num">-108.3</td><td class="left">'daydreamer'</td></tr>
-     <tr><td class="num"> -75.2</td><td class="left">'Stupid'</td></tr>
-     <tr><td class="num"> -74.6</td><td class="left">'Johannes'</td></tr>
-     <tr><td class="num"> -66.9</td><td class="left">'Mentist'</td></tr>
-     <tr><td class="num"> -63.7</td><td class="left">'dev0'</td></tr>
-     <tr><td class="num"> -63.2</td><td class="left">'Great Scott'</td></tr>
-     <tr><td class="num"> -62.0</td><td class="left">'Daisy'</td></tr>
-     <tr><td class="num"> -54.7</td><td class="left">'Crystalicum'</td></tr>
-     <tr><td class="num"> -53.9</td><td class="left">'Duffy'</td></tr>
-     <tr><td class="num"> -52.6</td><td class="left">'Malla'</td></tr>
-     <tr><td class="num"> -49.3</td><td class="left">'ryujun'</td></tr>
-     <tr><td class="num"> -43.9</td><td class="left">'Alexandros'</td></tr>
-     <tr><td class="num"> -41.9</td><td class="left">'Django'</td></tr>
-     <tr><td class="num"> -39.5</td><td class="left">'Gloop'</td></tr>
-     <tr><td class="num"> -32.6</td><td class="left">'Taztunes'</td></tr>
-     <tr><td class="num"> -30.4</td><td class="left">'Safalra'</td></tr>
-     <tr><td class="num"> -29.8</td><td class="left">'Angolino'</td></tr>
-     <tr><td class="num"> -29.4</td><td class="left">'Emmanuel'</td></tr>
-     <tr><td class="num"> -27.6</td><td class="left">'Ludmian'</td></tr>
-     <tr><td class="num"> -24.6</td><td class="left">'B-Huff'</td></tr>
-     <tr><td class="num"> -23.4</td><td class="left">'dpl'</td></tr>
-     <tr><td class="num"> -21.9</td><td class="left">'Zekobah'</td></tr>
-     <tr><td class="num"> -21.6</td><td class="left">'bojster'</td></tr>
-     <tr><td class="num"> -20.9</td><td class="left">'Ghatotkacha'</td></tr>
-     <tr><td class="num"> -17.6</td><td class="left">'ged'</td></tr>
-     <tr><td class="num"> -16.3</td><td class="left">'hendrik'</td></tr>
-     <tr><td class="num"> -15.6</td><td class="left">'Raoul'</td></tr>
-     <tr><td class="num"> -15.5</td><td class="left">'ABS'</td></tr>
-     <tr><td class="num"> -12.7</td><td class="left">'Ronald'</td></tr>
-     <tr><td class="num"> -12.3</td><td class="left">'Dime'</td></tr>
-     <tr><td class="num">  -7.5</td><td class="left">'Lukas'</td></tr>
-     <tr><td class="num">  -6.7</td><td class="left">'HuB34'</td></tr>
-     <tr><td class="num">  -3.5</td><td class="left">'Timo'</td></tr>
-     <tr><td class="num">  -3.0</td><td class="left">'Iceshark7'</td></tr>
+     <tr><td class="num">-153.1</td><td class="left">'Moneymaker'</td></tr>
+     <tr><td class="num">-129.0</td><td class="left">'Medimaster'</td></tr>
+     <tr><td class="num">-108.1</td><td class="left">'daydreamer'</td></tr>
+     <tr><td class="num"> -74.6</td><td class="left">'Stupid'</td></tr>
+     <tr><td class="num"> -74.0</td><td class="left">'Johannes'</td></tr>
+     <tr><td class="num"> -66.3</td><td class="left">'Mentist'</td></tr>
+     <tr><td class="num"> -63.1</td><td class="left">'dev0'</td></tr>
+     <tr><td class="num"> -62.5</td><td class="left">'Great Scott'</td></tr>
+     <tr><td class="num"> -62.4</td><td class="left">'Daisy'</td></tr>
+     <tr><td class="num"> -54.3</td><td class="left">'Crystalicum'</td></tr>
+     <tr><td class="num"> -53.2</td><td class="left">'Duffy'</td></tr>
+     <tr><td class="num"> -52.1</td><td class="left">'Malla'</td></tr>
+     <tr><td class="num"> -48.8</td><td class="left">'ryujun'</td></tr>
+     <tr><td class="num"> -43.4</td><td class="left">'Alexandros'</td></tr>
+     <tr><td class="num"> -41.3</td><td class="left">'Django'</td></tr>
+     <tr><td class="num"> -38.9</td><td class="left">'Gloop'</td></tr>
+     <tr><td class="num"> -32.1</td><td class="left">'Taztunes'</td></tr>
+     <tr><td class="num"> -29.9</td><td class="left">'Safalra'</td></tr>
+     <tr><td class="num"> -29.3</td><td class="left">'Angolino'</td></tr>
+     <tr><td class="num"> -28.8</td><td class="left">'Emmanuel'</td></tr>
+     <tr><td class="num"> -27.1</td><td class="left">'Ludmian'</td></tr>
+     <tr><td class="num"> -24.0</td><td class="left">'B-Huff'</td></tr>
+     <tr><td class="num"> -23.0</td><td class="left">'dpl'</td></tr>
+     <tr><td class="num"> -21.4</td><td class="left">'Zekobah'</td></tr>
+     <tr><td class="num"> -21.2</td><td class="left">'bojster'</td></tr>
+     <tr><td class="num"> -20.5</td><td class="left">'Ghatotkacha'</td></tr>
+     <tr><td class="num"> -17.2</td><td class="left">'ged'</td></tr>
+     <tr><td class="num"> -15.8</td><td class="left">'hendrik'</td></tr>
+     <tr><td class="num"> -15.2</td><td class="left">'Raoul'</td></tr>
+     <tr><td class="num"> -15.2</td><td class="left">'ABS'</td></tr>
+     <tr><td class="num"> -12.4</td><td class="left">'Ronald'</td></tr>
+     <tr><td class="num"> -12.0</td><td class="left">'Dime'</td></tr>
+     <tr><td class="num">  -7.2</td><td class="left">'Lukas'</td></tr>
+     <tr><td class="num">  -6.1</td><td class="left">'HuB34'</td></tr>
+     <tr><td class="num">  -3.3</td><td class="left">'Timo'</td></tr>
+     <tr><td class="num">  -2.8</td><td class="left">'Iceshark7'</td></tr>
      <tr><td class="num">  -2.1</td><td class="left">'joseba'</td></tr>
-     <tr><td class="num">  -0.3</td><td class="left">'mecke'</td></tr>
-     <tr><td class="num">   0.9</td><td class="left">'Daniel'</td></tr>
-     <tr><td class="num">   1.4</td><td class="left">'fabian'</td></tr>
-     <tr><td class="num">   1.8</td><td class="left">'U-Punkt'</td></tr>
-     <tr><td class="num">   2.4</td><td class="left">'Hairball'</td></tr>
-     <tr><td class="num">   2.6</td><td class="left">'Craven'</td></tr>
-     <tr><td class="num">   2.7</td><td class="left">'JuSt'</td></tr>
-     <tr><td class="num">   3.3</td><td class="left">'Wuzzy'</td></tr>
-     <tr><td class="num">   3.6</td><td class="left">'Freshman'</td></tr>
+     <tr><td class="num">   0.0</td><td class="left">'mecke'</td></tr>
+     <tr><td class="num">   1.3</td><td class="left">'Daniel'</td></tr>
+     <tr><td class="num">   1.7</td><td class="left">'fabian'</td></tr>
+     <tr><td class="num">   2.1</td><td class="left">'U-Punkt'</td></tr>
+     <tr><td class="num">   2.8</td><td class="left">'Hairball'</td></tr>
+     <tr><td class="num">   2.8</td><td class="left">'Craven'</td></tr>
+     <tr><td class="num">   3.0</td><td class="left">'JuSt'</td></tr>
+     <tr><td class="num">   3.6</td><td class="left">'Wuzzy'</td></tr>
      <tr><td class="num">   3.7</td><td class="left">'Kevin'</td></tr>
-     <tr><td class="num">   4.4</td><td class="left">'mrduke'</td></tr>
-     <tr><td class="num">   5.3</td><td class="left">'Tiza'</td></tr>
-     <tr><td class="num">   5.3</td><td class="left">'para_doks'</td></tr>
-     <tr><td class="num">   5.7</td><td class="left">'Tobias'</td></tr>
-     <tr><td class="num">   6.2</td><td class="left">'Another'</td></tr>
-     <tr><td class="num">   6.8</td><td class="left">'alfred69'</td></tr>
-     <tr><td class="num">   7.1</td><td class="left">'Guglielmo'</td></tr>
-     <tr><td class="num">   8.1</td><td class="left">'Sigma'</td></tr>
-     <tr><td class="num">   8.2</td><td class="left">'serpent'</td></tr>
-     <tr><td class="num">   8.3</td><td class="left">'Andy'</td></tr>
-     <tr><td class="num">   9.8</td><td class="left">'H-J.Epting'</td></tr>
-     <tr><td class="num">  10.6</td><td class="left">'Austin'</td></tr>
-     <tr><td class="num">  11.7</td><td class="left">'shoki'</td></tr>
-     <tr><td class="num">  13.5</td><td class="left">'oxyd4ever'</td></tr>
-     <tr><td class="num">  14.3</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-     <tr><td class="num">  16.4</td><td class="left">'Mark P.'</td></tr>
-     <tr><td class="num">  16.5</td><td class="left">'Andreas'</td></tr>
-     <tr><td class="num">  17.2</td><td class="left">'AlephD'</td></tr>
-     <tr><td class="num">  17.5</td><td class="left">'Sim_Ed'</td></tr>
-     <tr><td class="num">  18.1</td><td class="left">'Agnieszka'</td></tr>
-     <tr><td class="num">  18.2</td><td class="left">'Chocolate Zero'</td></tr>
-     <tr><td class="num">  19.1</td><td class="left">'casmith_789'</td></tr>
-     <tr><td class="num">  19.8</td><td class="left">'ais523'</td></tr>
-     <tr><td class="num">  21.6</td><td class="left">'Ale'</td></tr>
-     <tr><td class="num">  22.0</td><td class="left">'Alex'</td></tr>
-     <tr><td class="num">  24.4</td><td class="left">'Antonio EE'</td></tr>
-     <tr><td class="num">  24.6</td><td class="left">'Klaus'</td></tr>
-     <tr><td class="num">  24.7</td><td class="left">'Jinajon'</td></tr>
-     <tr><td class="num">  25.2</td><td class="left">'Marc-Hendrik'</td></tr>
-     <tr><td class="num">  25.9</td><td class="left">'Chris'</td></tr>
-     <tr><td class="num">  26.2</td><td class="left">'Thomas'</td></tr>
-     <tr><td class="num">  26.4</td><td class="left">'Feynman'</td></tr>
-     <tr><td class="num">  27.0</td><td class="left">'hdwow'</td></tr>
-     <tr><td class="num">  27.1</td><td class="left">'Gottseinsohn'</td></tr>
-     <tr><td class="num">  28.0</td><td class="left">'Bent'</td></tr>
-     <tr><td class="num">  28.2</td><td class="left">'Hans-HD'</td></tr>
-     <tr><td class="num">  29.0</td><td class="left">'un_guru'</td></tr>
-     <tr><td class="num">  29.5</td><td class="left">'Little_Mole'</td></tr>
-     <tr><td class="num">  29.9</td><td class="left">'J3FF'</td></tr>
-     <tr><td class="num">  30.8</td><td class="left">'biotopa'</td></tr>
-     <tr><td class="num">  30.8</td><td class="left">'Vinksu'</td></tr>
-     <tr><td class="num">  31.0</td><td class="left">'evane'</td></tr>
-     <tr><td class="num">  31.2</td><td class="left">'oblo'</td></tr>
-     <tr><td class="num">  31.3</td><td class="left">'GiannuzzITA'</td></tr>
-     <tr><td class="num">  31.7</td><td class="left">'redsantz'</td></tr>
-     <tr><td class="num">  33.0</td><td class="left">'geembo_90'</td></tr>
-     <tr><td class="num">  33.0</td><td class="left">'Edgar_Flesk'</td></tr>
-     <tr><td class="num">  33.1</td><td class="left">'Melanie'</td></tr>
-     <tr><td class="num">  33.4</td><td class="left">'NorthForty'</td></tr>
-     <tr><td class="num">  33.7</td><td class="left">'IChrisI'</td></tr>
-     <tr><td class="num">  33.9</td><td class="left">'erich'</td></tr>
-     <tr><td class="num">  34.0</td><td class="left">'Gorn'</td></tr>
-     <tr><td class="num">  36.8</td><td class="left">'niebie'</td></tr>
-     <tr><td class="num">  36.9</td><td class="left">'MicWa'</td></tr>
-     <tr><td class="num">  37.0</td><td class="left">'WP319'</td></tr>
-     <tr><td class="num">  37.3</td><td class="left">'Kosby'</td></tr>
-     <tr><td class="num">  38.1</td><td class="left">'alain'</td></tr>
-     <tr><td class="num">  39.0</td><td class="left">'Liam Sheehan'</td></tr>
-     <tr><td class="num">  39.6</td><td class="left">'Rugby4ever'</td></tr>
-     <tr><td class="num">  40.5</td><td class="left">'Drotten'</td></tr>
-     <tr><td class="num">  40.5</td><td class="left">'WesleyCrusher'</td></tr>
-     <tr><td class="num">  40.8</td><td class="left">'Archcorenth'</td></tr>
-     <tr><td class="num">  41.0</td><td class="left">'Harry Lim'</td></tr>
+     <tr><td class="num">   3.8</td><td class="left">'Freshman'</td></tr>
+     <tr><td class="num">   4.0</td><td class="left">'H-J.Epting'</td></tr>
+     <tr><td class="num">   4.6</td><td class="left">'mrduke'</td></tr>
+     <tr><td class="num">   4.6</td><td class="left">'Tiza'</td></tr>
+     <tr><td class="num">   5.5</td><td class="left">'para_doks'</td></tr>
+     <tr><td class="num">   6.0</td><td class="left">'Tobias'</td></tr>
+     <tr><td class="num">   6.5</td><td class="left">'Another'</td></tr>
+     <tr><td class="num">   7.0</td><td class="left">'alfred69'</td></tr>
+     <tr><td class="num">   7.5</td><td class="left">'Guglielmo'</td></tr>
+     <tr><td class="num">   8.5</td><td class="left">'Sigma'</td></tr>
+     <tr><td class="num">   8.5</td><td class="left">'serpent'</td></tr>
+     <tr><td class="num">   8.6</td><td class="left">'Andy'</td></tr>
+     <tr><td class="num">  10.8</td><td class="left">'Austin'</td></tr>
+     <tr><td class="num">  11.9</td><td class="left">'shoki'</td></tr>
+     <tr><td class="num">  13.8</td><td class="left">'oxyd4ever'</td></tr>
+     <tr><td class="num">  14.6</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+     <tr><td class="num">  16.6</td><td class="left">'Mark P.'</td></tr>
+     <tr><td class="num">  16.8</td><td class="left">'Andreas'</td></tr>
+     <tr><td class="num">  17.4</td><td class="left">'AlephD'</td></tr>
+     <tr><td class="num">  17.7</td><td class="left">'Sim_Ed'</td></tr>
+     <tr><td class="num">  18.4</td><td class="left">'Chocolate Zero'</td></tr>
+     <tr><td class="num">  18.4</td><td class="left">'Agnieszka'</td></tr>
+     <tr><td class="num">  19.3</td><td class="left">'casmith_789'</td></tr>
+     <tr><td class="num">  20.0</td><td class="left">'ais523'</td></tr>
+     <tr><td class="num">  21.8</td><td class="left">'Ale'</td></tr>
+     <tr><td class="num">  22.1</td><td class="left">'Alex'</td></tr>
+     <tr><td class="num">  24.6</td><td class="left">'Antonio EE'</td></tr>
+     <tr><td class="num">  24.8</td><td class="left">'Klaus'</td></tr>
+     <tr><td class="num">  25.0</td><td class="left">'Jinajon'</td></tr>
+     <tr><td class="num">  25.5</td><td class="left">'Marc-Hendrik'</td></tr>
+     <tr><td class="num">  26.0</td><td class="left">'Chris'</td></tr>
+     <tr><td class="num">  26.4</td><td class="left">'Thomas'</td></tr>
+     <tr><td class="num">  26.6</td><td class="left">'Feynman'</td></tr>
+     <tr><td class="num">  27.2</td><td class="left">'hdwow'</td></tr>
+     <tr><td class="num">  27.3</td><td class="left">'Gottseinsohn'</td></tr>
+     <tr><td class="num">  28.3</td><td class="left">'Bent'</td></tr>
+     <tr><td class="num">  28.3</td><td class="left">'Hans-HD'</td></tr>
+     <tr><td class="num">  29.1</td><td class="left">'un_guru'</td></tr>
+     <tr><td class="num">  29.6</td><td class="left">'Little_Mole'</td></tr>
+     <tr><td class="num">  30.1</td><td class="left">'J3FF'</td></tr>
+     <tr><td class="num">  30.9</td><td class="left">'biotopa'</td></tr>
+     <tr><td class="num">  30.9</td><td class="left">'Vinksu'</td></tr>
+     <tr><td class="num">  31.1</td><td class="left">'evane'</td></tr>
+     <tr><td class="num">  31.3</td><td class="left">'oblo'</td></tr>
+     <tr><td class="num">  31.4</td><td class="left">'GiannuzzITA'</td></tr>
+     <tr><td class="num">  31.8</td><td class="left">'redsantz'</td></tr>
+     <tr><td class="num">  33.1</td><td class="left">'geembo_90'</td></tr>
+     <tr><td class="num">  33.2</td><td class="left">'Edgar_Flesk'</td></tr>
+     <tr><td class="num">  33.3</td><td class="left">'Melanie'</td></tr>
+     <tr><td class="num">  33.5</td><td class="left">'NorthForty'</td></tr>
+     <tr><td class="num">  33.8</td><td class="left">'IChrisI'</td></tr>
+     <tr><td class="num">  34.2</td><td class="left">'erich'</td></tr>
+     <tr><td class="num">  34.2</td><td class="left">'Gorn'</td></tr>
+     <tr><td class="num">  36.9</td><td class="left">'niebie'</td></tr>
+     <tr><td class="num">  37.0</td><td class="left">'MicWa'</td></tr>
+     <tr><td class="num">  37.1</td><td class="left">'WP319'</td></tr>
+     <tr><td class="num">  37.5</td><td class="left">'Kosby'</td></tr>
+     <tr><td class="num">  38.2</td><td class="left">'alain'</td></tr>
+     <tr><td class="num">  39.2</td><td class="left">'Liam Sheehan'</td></tr>
+     <tr><td class="num">  39.7</td><td class="left">'Rugby4ever'</td></tr>
+     <tr><td class="num">  40.6</td><td class="left">'Drotten'</td></tr>
+     <tr><td class="num">  40.6</td><td class="left">'WesleyCrusher'</td></tr>
+     <tr><td class="num">  41.0</td><td class="left">'Archcorenth'</td></tr>
+     <tr><td class="num">  41.1</td><td class="left">'Harry Lim'</td></tr>
      <tr><td class="num">  41.2</td><td class="left">'purplerainbow'</td></tr>
-     <tr><td class="num">  41.4</td><td class="left">'B-man'</td></tr>
-     <tr><td class="num">  41.8</td><td class="left">'Nfol'</td></tr>
-     <tr><td class="num">  42.6</td><td class="left">'Tiger'</td></tr>
-     <tr><td class="num">  42.7</td><td class="left">'gringer'</td></tr>
-     <tr><td class="num">  43.2</td><td class="left">'Vlad'</td></tr>
-     <tr><td class="num">  43.4</td><td class="left">'Snaily'</td></tr>
-     <tr><td class="num">  44.3</td><td class="left">'Momcat'</td></tr>
+     <tr><td class="num">  41.6</td><td class="left">'B-man'</td></tr>
+     <tr><td class="num">  42.0</td><td class="left">'Nfol'</td></tr>
+     <tr><td class="num">  42.7</td><td class="left">'Tiger'</td></tr>
+     <tr><td class="num">  42.8</td><td class="left">'gringer'</td></tr>
+     <tr><td class="num">  43.3</td><td class="left">'Vlad'</td></tr>
+     <tr><td class="num">  43.6</td><td class="left">'Snaily'</td></tr>
+     <tr><td class="num">  44.4</td><td class="left">'Momcat'</td></tr>
      <tr><td class="num">  45.1</td><td class="left">'Breezy'</td></tr>
-     <tr><td class="num">  45.7</td><td class="left">'Uli'</td></tr>
-     <tr><td class="num">  46.6</td><td class="left">'Tarim'</td></tr>
-     <tr><td class="num">  47.6</td><td class="left">'IntKecsk'</td></tr>
-     <tr><td class="num">  48.0</td><td class="left">'tjRaven'</td></tr>
-     <tr><td class="num">  48.1</td><td class="left">'Jonyzz'</td></tr>
+     <tr><td class="num">  45.6</td><td class="left">'Paulus'</td></tr>
+     <tr><td class="num">  45.9</td><td class="left">'Uli'</td></tr>
+     <tr><td class="num">  46.7</td><td class="left">'Tarim'</td></tr>
+     <tr><td class="num">  47.7</td><td class="left">'IntKecsk'</td></tr>
+     <tr><td class="num">  48.1</td><td class="left">'tjRaven'</td></tr>
+     <tr><td class="num">  48.2</td><td class="left">'Jonyzz'</td></tr>
      <tr><td class="num">  48.5</td><td class="left">'Valkyrie2'</td></tr>
-     <tr><td class="num">  48.7</td><td class="left">'mhatta'</td></tr>
-     <tr><td class="num">  48.9</td><td class="left">'ntaeijr'</td></tr>
-     <tr><td class="num">  50.9</td><td class="left">'Zak'</td></tr>
-     <tr><td class="num">  51.0</td><td class="left">'Tomson'</td></tr>
-     <tr><td class="num">  51.0</td><td class="left">'rima'</td></tr>
+     <tr><td class="num">  48.8</td><td class="left">'mhatta'</td></tr>
+     <tr><td class="num">  49.0</td><td class="left">'ntaeijr'</td></tr>
+     <tr><td class="num">  51.0</td><td class="left">'Zak'</td></tr>
+     <tr><td class="num">  51.1</td><td class="left">'rima'</td></tr>
+     <tr><td class="num">  51.2</td><td class="left">'Tomson'</td></tr>
      <tr><td class="num">  51.2</td><td class="left">'Mecki'</td></tr>
-     <tr><td class="num">  51.3</td><td class="left">'brynn'</td></tr>
-     <tr><td class="num">  51.4</td><td class="left">'Sandra'</td></tr>
-     <tr><td class="num">  51.4</td><td class="left">'Jeffrey S'</td></tr>
+     <tr><td class="num">  51.4</td><td class="left">'brynn'</td></tr>
+     <tr><td class="num">  51.5</td><td class="left">'Sandra'</td></tr>
+     <tr><td class="num">  51.5</td><td class="left">'Jeffrey S'</td></tr>
      <tr><td class="num">  52.2</td><td class="left">'jdcampo'</td></tr>
      <tr><td class="num">  52.6</td><td class="left">'ReasonAnce'</td></tr>
      <tr><td class="num">  53.1</td><td class="left">'AkRa'</td></tr>
-     <tr><td class="num">  53.8</td><td class="left">'Vaily'</td></tr>
-     <tr><td class="num">  53.9</td><td class="left">'Pascal'</td></tr>
-     <tr><td class="num">  54.0</td><td class="left">'Slav'</td></tr>
-     <tr><td class="num">  54.7</td><td class="left">'Cyphase'</td></tr>
-     <tr><td class="num">  55.2</td><td class="left">'Neophilus'</td></tr>
-     <tr><td class="num">  55.3</td><td class="left">'Turbogurk'</td></tr>
+     <tr><td class="num">  53.9</td><td class="left">'Vaily'</td></tr>
+     <tr><td class="num">  54.0</td><td class="left">'Pascal'</td></tr>
+     <tr><td class="num">  54.1</td><td class="left">'Slav'</td></tr>
+     <tr><td class="num">  54.8</td><td class="left">'Cyphase'</td></tr>
+     <tr><td class="num">  55.3</td><td class="left">'Neophilus'</td></tr>
+     <tr><td class="num">  55.4</td><td class="left">'Turbogurk'</td></tr>
      <tr><td class="num">  57.0</td><td class="left">'krazy62'</td></tr>
      <tr><td class="num">  58.2</td><td class="left">'Adonica'</td></tr>
-     <tr><td class="num">  58.5</td><td class="left">'Kadu'</td></tr>
-     <tr><td class="num">  60.1</td><td class="left">'Enrymather'</td></tr>
-     <tr><td class="num">  61.4</td><td class="left">'Sopoforic'</td></tr>
-     <tr><td class="num">  61.7</td><td class="left">'jumbo'</td></tr>
+     <tr><td class="num">  58.6</td><td class="left">'Kadu'</td></tr>
+     <tr><td class="num">  60.2</td><td class="left">'Enrymather'</td></tr>
+     <tr><td class="num">  61.5</td><td class="left">'Sopoforic'</td></tr>
+     <tr><td class="num">  61.8</td><td class="left">'jumbo'</td></tr>
      <tr><td class="num">  62.5</td><td class="left">'jdrexler'</td></tr>
-     <tr><td class="num">  62.5</td><td class="left">'Jan'</td></tr>
+     <tr><td class="num">  62.6</td><td class="left">'Jan'</td></tr>
      <tr><td class="num">  63.2</td><td class="left">'Asbel'</td></tr>
-     <tr><td class="num">  64.8</td><td class="left">'tasker'</td></tr>
-     <tr><td class="num">  65.2</td><td class="left">'Meeve'</td></tr>
+     <tr><td class="num">  64.9</td><td class="left">'tasker'</td></tr>
+     <tr><td class="num">  65.3</td><td class="left">'Meeve'</td></tr>
      <tr><td class="num">  67.1</td><td class="left">'ael'</td></tr>
-     <tr><td class="num">  67.6</td><td class="left">'Samuel'</td></tr>
+     <tr><td class="num">  67.7</td><td class="left">'Samuel'</td></tr>
      <tr><td class="num">  68.0</td><td class="left">'Fred_the_wise'</td></tr>
-     <tr><td class="num">  68.0</td><td class="left">'Sparkey'</td></tr>
      <tr><td class="num">  68.1</td><td class="left">'schmusi20'</td></tr>
-     <tr><td class="num">  68.2</td><td class="left">'Alf'</td></tr>
-     <tr><td class="num">  70.0</td><td class="left">'Magnus and Susi'</td></tr>
-     <tr><td class="num">  70.7</td><td class="left">'Zhura'</td></tr>
-     <tr><td class="num">  71.5</td><td class="left">'xmouse'</td></tr>
-     <tr><td class="num">  72.8</td><td class="left">'Joona'</td></tr>
-     <tr><td class="num">  72.9</td><td class="left">'AQZ'</td></tr>
-     <tr><td class="num">  74.6</td><td class="left">'crypto_rsa'</td></tr>
-     <tr><td class="num">  74.7</td><td class="left">'Dvorhagen'</td></tr>
+     <tr><td class="num">  68.1</td><td class="left">'Sparkey'</td></tr>
+     <tr><td class="num">  68.3</td><td class="left">'Alf'</td></tr>
+     <tr><td class="num">  69.7</td><td class="left">'Shaez'</td></tr>
+     <tr><td class="num">  70.1</td><td class="left">'Magnus and Susi'</td></tr>
+     <tr><td class="num">  70.8</td><td class="left">'Zhura'</td></tr>
+     <tr><td class="num">  71.6</td><td class="left">'xmouse'</td></tr>
+     <tr><td class="num">  72.9</td><td class="left">'Joona'</td></tr>
+     <tr><td class="num">  73.0</td><td class="left">'AQZ'</td></tr>
+     <tr><td class="num">  74.7</td><td class="left">'crypto_rsa'</td></tr>
+     <tr><td class="num">  74.8</td><td class="left">'Dvorhagen'</td></tr>
      <tr><td class="num">  75.6</td><td class="left">'Eselchen'</td></tr>
-     <tr><td class="num">  75.8</td><td class="left">'Nicol?s'</td></tr>
+     <tr><td class="num">  75.9</td><td class="left">'Nicol?s'</td></tr>
      <tr><td class="num">  75.9</td><td class="left">'AsuCaga'</td></tr>
      <tr><td class="num">  76.0</td><td class="left">'jojo'</td></tr>
      <tr><td class="num">  79.1</td><td class="left">'colonel crayon'</td></tr>
      <tr><td class="num">  79.9</td><td class="left">'Kroetchen'</td></tr>
      <tr><td class="num">  80.8</td><td class="left">'Agares'</td></tr>
-     <tr><td class="num">  81.8</td><td class="left">'IIkka'</td></tr>
+     <tr><td class="num">  81.9</td><td class="left">'IIkka'</td></tr>
      <tr><td class="num">  85.6</td><td class="left">'Miel56'</td></tr>
      <tr><td class="num">  90.2</td><td class="left">'The red O'</td></tr>
-     <tr><td class="num">  90.6</td><td class="left">'Sequoyah'</td></tr>
+     <tr><td class="num">  90.7</td><td class="left">'Sequoyah'</td></tr>
      <tr><td class="num">  92.6</td><td class="left">'Michael'</td></tr>
   </table>

Modified: homepage/input/table-rat.html
===================================================================
--- homepage/input/table-rat.html	2009-08-13 23:00:11 UTC (rev 1781)
+++ homepage/input/table-rat.html	2009-08-16 22:25:51 UTC (rev 1782)
@@ -1,5 +1,5 @@
   <table>
-    <caption>$$Rating_Statistics$$ $$June$$ 2009</caption>
+    <caption>$$Rating_Statistics$$ $$July$$ 2009</caption>
     <colgroup><col width="80"><col width="80"><col width="220"></colgroup>
     <tr><th>$$count$$</th><th>$$average$$</th><th class="left">$$user$$</th></tr>    <tr><td class="num">1062</td><td class="num"> 5.06</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1056</td><td class="num"> 4.83</td><td class="left">'Taztunes'</td></tr>
@@ -16,9 +16,9 @@
     <tr><td class="num">562</td><td class="num"> 4.48</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num">534</td><td class="num"> 4.97</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num">512</td><td class="num"> 5.05</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num">511</td><td class="num"> 5.05</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num">511</td><td class="num"> 5.30</td><td class="left">'Lukas'</td></tr>
     <tr><td class="num">482</td><td class="num"> 4.04</td><td class="left">'Vinksu'</td></tr>
-    <tr><td class="num">470</td><td class="num"> 5.01</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num">448</td><td class="num"> 5.08</td><td class="left">'Johannes'</td></tr>
     <tr><td class="num">433</td><td class="num"> 4.36</td><td class="left">'ged'</td></tr>
     <tr><td class="num">388</td><td class="num"> 4.86</td><td class="left">'Gloop'</td></tr>

Modified: homepage/input/table-solved.html
===================================================================
--- homepage/input/table-solved.html	2009-08-13 23:00:11 UTC (rev 1781)
+++ homepage/input/table-solved.html	2009-08-16 22:25:51 UTC (rev 1782)
@@ -1,5 +1,5 @@
   <table>
-    <caption>$$Solved_Level_Statistics$$ $$June$$ 2009</caption>
+    <caption>$$Solved_Level_Statistics$$ $$July$$ 2009</caption>
     <colgroup><col width="130"><col width="130"><col width="130"><col width="240"></colgroup>
     <tr><th>$$difficult$$</th><th>$$easy$$</th><th>$$total$$</th><th class="left">$$user$$</th></tr>
     <tr><td class="num">1045/1045</td><td class="num">189/189</td><td class="num">100.00%</td><td class="left">'ryujun'</td></tr>
@@ -16,9 +16,9 @@
     <tr><td class="num">1014/1045</td><td class="num">175/189</td><td class="num"> 96.35%</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num"> 999/1045</td><td class="num">177/189</td><td class="num"> 95.30%</td><td class="left">'biotopa'</td></tr>
     <tr><td class="num"> 989/1045</td><td class="num">176/189</td><td class="num"> 94.41%</td><td class="left">'Daisy'</td></tr>
+    <tr><td class="num"> 969/1045</td><td class="num">167/189</td><td class="num"> 92.06%</td><td class="left">'H-J.Epting'</td></tr>
     <tr><td class="num"> 970/1045</td><td class="num">166/189</td><td class="num"> 92.06%</td><td class="left">'Andy'</td></tr>
     <tr><td class="num"> 962/1045</td><td class="num">173/189</td><td class="num"> 91.98%</td><td class="left">'mecke'</td></tr>
-    <tr><td class="num"> 956/1045</td><td class="num">163/189</td><td class="num"> 90.68%</td><td class="left">'H-J.Epting'</td></tr>
     <tr><td class="num"> 949/1045</td><td class="num">170/189</td><td class="num"> 90.68%</td><td class="left">'para_doks'</td></tr>
     <tr><td class="num"> 937/1045</td><td class="num">162/189</td><td class="num"> 89.06%</td><td class="left">'Mentist'</td></tr>
     <tr><td class="num"> 922/1045</td><td class="num">154/189</td><td class="num"> 87.20%</td><td class="left">'mrduke'</td></tr>
@@ -53,7 +53,7 @@
     <tr><td class="num"> 650/1045</td><td class="num">110/189</td><td class="num"> 61.59%</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 681/1045</td><td class="num"> 78/189</td><td class="num"> 61.51%</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 659/1045</td><td class="num"> 95/189</td><td class="num"> 61.10%</td><td class="left">'Marc-Hendrik'</td></tr>
-    <tr><td class="num"> 631/1045</td><td class="num"> 98/189</td><td class="num"> 59.08%</td><td class="left">'Tiza'</td></tr>
+    <tr><td class="num"> 654/1045</td><td class="num"> 99/189</td><td class="num"> 61.02%</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num"> 665/1045</td><td class="num"> 64/189</td><td class="num"> 59.08%</td><td class="left">'alain'</td></tr>
     <tr><td class="num"> 643/1045</td><td class="num"> 83/189</td><td class="num"> 58.83%</td><td class="left">'Great Scott'</td></tr>
     <tr><td class="num"> 714/1045</td><td class="num">  0/189</td><td class="num"> 57.86%</td><td class="left">'Gottseinsohn'</td></tr>
@@ -86,10 +86,10 @@
     <tr><td class="num"> 494/1045</td><td class="num"> 26/189</td><td class="num"> 42.14%</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num"> 454/1045</td><td class="num"> 65/189</td><td class="num"> 42.06%</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num"> 506/1045</td><td class="num"> 12/189</td><td class="num"> 41.98%</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num"> 442/1045</td><td class="num"> 75/189</td><td class="num"> 41.90%</td><td class="left">'Medimaster'</td></tr>
     <tr><td class="num"> 503/1045</td><td class="num">  7/189</td><td class="num"> 41.33%</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num"> 397/1045</td><td class="num"> 93/189</td><td class="num"> 39.71%</td><td class="left">'Hairball'</td></tr>
     <tr><td class="num"> 440/1045</td><td class="num"> 50/189</td><td class="num"> 39.71%</td><td class="left">'ged'</td></tr>
-    <tr><td class="num"> 412/1045</td><td class="num"> 70/189</td><td class="num"> 39.06%</td><td class="left">'Medimaster'</td></tr>
     <tr><td class="num"> 369/1045</td><td class="num">112/189</td><td class="num"> 38.98%</td><td class="left">'Jinajon'</td></tr>
     <tr><td class="num"> 438/1045</td><td class="num">  3/189</td><td class="num"> 35.74%</td><td class="left">'oblo'</td></tr>
     <tr><td class="num"> 396/1045</td><td class="num"> 43/189</td><td class="num"> 35.58%</td><td class="left">'Jeffrey S'</td></tr>
@@ -130,6 +130,7 @@
     <tr><td class="num"> 214/1045</td><td class="num"> 22/189</td><td class="num"> 19.12%</td><td class="left">'Jonyzz'</td></tr>
     <tr><td class="num"> 214/1045</td><td class="num"> 19/189</td><td class="num"> 18.88%</td><td class="left">'Adonica'</td></tr>
     <tr><td class="num"> 188/1045</td><td class="num"> 33/189</td><td class="num"> 17.91%</td><td class="left">'Pascal'</td></tr>
+    <tr><td class="num"> 215/1045</td><td class="num">  6/189</td><td class="num"> 17.91%</td><td class="left">'Paulus'</td></tr>
     <tr><td class="num"> 209/1045</td><td class="num"> 11/189</td><td class="num"> 17.83%</td><td class="left">'GiannuzzITA'</td></tr>
     <tr><td class="num"> 206/1045</td><td class="num">  4/189</td><td class="num"> 17.02%</td><td class="left">'krazy62'</td></tr>
     <tr><td class="num"> 165/1045</td><td class="num"> 37/189</td><td class="num"> 16.37%</td><td class="left">'Jan'</td></tr>
@@ -153,6 +154,7 @@
     <tr><td class="num"> 123/1045</td><td class="num"> 13/189</td><td class="num"> 11.02%</td><td class="left">'tasker'</td></tr>
     <tr><td class="num"> 131/1045</td><td class="num">  1/189</td><td class="num"> 10.70%</td><td class="left">'Asbel'</td></tr>
     <tr><td class="num"> 105/1045</td><td class="num"> 22/189</td><td class="num"> 10.29%</td><td class="left">'Neophilus'</td></tr>
+    <tr><td class="num"> 106/1045</td><td class="num"> 14/189</td><td class="num">  9.72%</td><td class="left">'Shaez'</td></tr>
     <tr><td class="num">  89/1045</td><td class="num"> 24/189</td><td class="num">  9.16%</td><td class="left">'Zhura'</td></tr>
     <tr><td class="num">  98/1045</td><td class="num"> 13/189</td><td class="num">  9.00%</td><td class="left">'ReasonAnce'</td></tr>
     <tr><td class="num"> 101/1045</td><td class="num">  0/189</td><td class="num">  8.18%</td><td class="left">'Alf'</td></tr>

Modified: homepage/input/table-wr.html
===================================================================
--- homepage/input/table-wr.html	2009-08-13 23:00:11 UTC (rev 1781)
+++ homepage/input/table-wr.html	2009-08-16 22:25:51 UTC (rev 1782)
@@ -1,48 +1,48 @@
   <table>
-    <caption>$$Worldrecord_Statistics$$ $$June$$ 2009</caption>
+    <caption>$$Worldrecord_Statistics$$ $$July$$ 2009</caption>
     <colgroup><col width="80"><col width="80"><col width="470"></colgroup>
     <tr><th>$$total$$</th><th>$$shared$$</th><th class="left">$$user$$</th></tr>
-    <tr><td class="num">929</td><td class="num">259</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">328</td><td class="num">172</td><td class="left">'Medimaster'</td></tr>
-    <tr><td class="num">142</td><td class="num">118</td><td class="left">'daydreamer'</td></tr>
-    <tr><td class="num">124</td><td class="num">122</td><td class="left">'Crystalicum'</td></tr>
-    <tr><td class="num">102</td><td class="num"> 69</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num"> 74</td><td class="num"> 69</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num"> 65</td><td class="num"> 59</td><td class="left">'dev0'</td></tr>
-    <tr><td class="num"> 63</td><td class="num"> 62</td><td class="left">'Mentist'</td></tr>
-    <tr><td class="num"> 50</td><td class="num"> 43</td><td class="left">'Daisy'</td></tr>
-    <tr><td class="num"> 32</td><td class="num"> 27</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num">894</td><td class="num">251</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">365</td><td class="num">175</td><td class="left">'Medimaster'</td></tr>
+    <tr><td class="num">140</td><td class="num">112</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num">119</td><td class="num">117</td><td class="left">'Crystalicum'</td></tr>
+    <tr><td class="num">101</td><td class="num"> 68</td><td class="left">'Stupid'</td></tr>
+    <tr><td class="num"> 71</td><td class="num"> 66</td><td class="left">'Johannes'</td></tr>
+    <tr><td class="num"> 59</td><td class="num"> 54</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num"> 59</td><td class="num"> 58</td><td class="left">'Mentist'</td></tr>
+    <tr><td class="num"> 48</td><td class="num"> 41</td><td class="left">'Daisy'</td></tr>
     <tr><td class="num"> 31</td><td class="num"> 22</td><td class="left">'Malla'</td></tr>
+    <tr><td class="num"> 31</td><td class="num"> 26</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num"> 29</td><td class="num"> 28</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 23</td><td class="num"> 21</td><td class="left">'Alexandros'</td></tr>
-    <tr><td class="num"> 23</td><td class="num"> 22</td><td class="left">'Django'</td></tr>
     <tr><td class="num"> 23</td><td class="num"> 23</td><td class="left">'Great Scott'</td></tr>
     <tr><td class="num"> 22</td><td class="num"> 20</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 22</td><td class="num"> 21</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num"> 21</td><td class="num"> 21</td><td class="left">'joseba' + 'Iceshark7'</td></tr>
-    <tr><td class="num"> 20</td><td class="num"> 20</td><td class="left">'ryujun'</td></tr>
+    <tr><td class="num"> 20</td><td class="num"> 19</td><td class="left">'Django'</td></tr>
+    <tr><td class="num"> 18</td><td class="num"> 18</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num"> 15</td><td class="num"> 13</td><td class="left">'Emmanuel'</td></tr>
-    <tr><td class="num"> 14</td><td class="num"> 12</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num"> 14</td><td class="num"> 14</td><td class="left">'ged'</td></tr>
-    <tr><td class="num"> 13</td><td class="num">  8</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num"> 13</td><td class="num">  9</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num"> 13</td><td class="num"> 12</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 13</td><td class="num"> 13</td><td class="left">'Safalra' + 'Ludmian'</td></tr>
-    <tr><td class="num">  9</td><td class="num">  7</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-    <tr><td class="num">  9</td><td class="num">  9</td><td class="left">'bojster' + 'fabian'</td></tr>
+    <tr><td class="num"> 12</td><td class="num"> 10</td><td class="left">'B-Huff'</td></tr>
+    <tr><td class="num">  9</td><td class="num">  9</td><td class="left">'H-J.Epting' + 'bojster' + 'fabian'</td></tr>
+    <tr><td class="num">  8</td><td class="num">  6</td><td class="left">'ShadowPhrogg32642342'</td></tr>
     <tr><td class="num">  8</td><td class="num">  7</td><td class="left">'Chocolate Zero'</td></tr>
-    <tr><td class="num">  8</td><td class="num">  8</td><td class="left">'Gloop' + 'casmith_789' + 'dpl'</td></tr>
+    <tr><td class="num">  8</td><td class="num">  8</td><td class="left">'casmith_789' + 'dpl'</td></tr>
     <tr><td class="num">  7</td><td class="num">  6</td><td class="left">'Dime'</td></tr>
-    <tr><td class="num">  7</td><td class="num">  7</td><td class="left">'H-J.Epting'</td></tr>
-    <tr><td class="num">  6</td><td class="num">  5</td><td class="left">'Guglielmo' + 'Edgar_Flesk'</td></tr>
+    <tr><td class="num">  7</td><td class="num">  7</td><td class="left">'Gloop'</td></tr>
+    <tr><td class="num">  6</td><td class="num">  5</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num">  6</td><td class="num">  6</td><td class="left">'ABS'</td></tr>
     <tr><td class="num">  5</td><td class="num">  3</td><td class="left">'Breezy'</td></tr>
     <tr><td class="num">  5</td><td class="num">  4</td><td class="left">'Another'</td></tr>
-    <tr><td class="num">  5</td><td class="num">  5</td><td class="left">'Thomas' + 'Chris' + 'Ralf'</td></tr>
+    <tr><td class="num">  5</td><td class="num">  5</td><td class="left">'Guglielmo' + 'Thomas' + 'Chris' + 'Ralf'</td></tr>
     <tr><td class="num">  4</td><td class="num">  4</td><td class="left">'Taztunes' + 'U-Punkt' + 'Raoul' + 'J3FF' + 'para_doks' + 'mecke' + 'Tobias' + 'Wuzzy' + 'Lukas'</td></tr>
     <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'Hairball' + 'Stephanie'</td></tr>
     <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'GiannuzzITA'</td></tr>
     <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'alfred69' + 'ReasonAnce' + 'mrduke' + 'Sigma' + 'geembo_90' + 'Tiza' + 'Drotten' + 'Neophilus' + 'Sim_Ed' + 'Nicol?s' + 'Cyphase' + 'Andy' + 'hendrik' + 'Austin' + 'Snaily' + 'Craven' + 'Sopoforic' + 'Ingo' + 'serpent'</td></tr>
     <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'Feynman' + 'alain' + 'colonel crayon' + 'Gorn' + 'Nat'</td></tr>
     <tr><td class="num">  1</td><td class="num">  1</td><td class="left">'Agares' + 'Tiger' + 'Zak' + 'Daniel' + 'Slav' + 'niebie' + 'Andreas' + 'AlephD' + 'Samuel' + 'tjRaven' + 'Mark P.' + 'oblo' + 'Pascal' + 'hdwow' + 'B-man' + 'Asbel' + 'Vlad' + 'Bent' + 'Vaily' + 'Antonio EE' + 'JuSt' + 'Timo'</td></tr>
-    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'tasker' + 'jumbo' + 'Miel56' + 'Zhura' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'ntaeijr' + 'Eselchen' + 'ael' + 'biotopa' + 'Ale' + 'brynn' + 'IntKecsk' + 'purplerainbow' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'jdrexler' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'Valkyrie2' + 'Fred_the_wise' + 'Jan' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'Kroetchen' + 'crypto_rsa' + 'Harry Lim' + 'Sequoyah' + 'AkRa' + 'Momcat' + 'Tomson' + 'NorthForty' + 'Mecki' + 'The red O' + 'gringer' + 'IIkka' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'Kadu' + 'shoki' + 'Enrymather' + 'jojo' + 'WesleyCrusher' + 'evane' + 'Jinajon' + 'rima' + 'Klaus' + 'MicWa' + 'AsuCaga' + 'oxyd4ever' + 'Jonyzz' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'un_guru' + 'krazy62' + 'Dvorhagen' + 'Sparkey' + 'ais523' + 'Holger' + 'Ingo_K' + 'Ant' + !
 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Michael' + 'Liam Sheehan' + 'Tarim' + 'Agnieszka'</td></tr>
+    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'tasker' + 'jumbo' + 'Miel56' + 'Zhura' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'ntaeijr' + 'Eselchen' + 'ael' + 'biotopa' + 'Ale' + 'brynn' + 'IntKecsk' + 'purplerainbow' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'Shaez' + 'jdrexler' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'Valkyrie2' + 'Fred_the_wise' + 'Jan' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'Kroetchen' + 'crypto_rsa' + 'Harry Lim' + 'Sequoyah' + 'AkRa' + 'Momcat' + 'Tomson' + 'NorthForty' + 'Mecki' + 'The red O' + 'gringer' + 'IIkka' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'Kadu' + 'shoki' + 'Enrymather' + 'jojo' + 'WesleyCrusher' + 'evane' + 'Jinajon' + 'rima' + 'Klaus' + 'MicWa' + 'AsuCaga' + 'oxyd4ever' + 'Jonyzz' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'un_guru' + 'Paulus' + 'krazy62' + 'Dvorhagen' + 'Sparkey' + 'ais523' + 'Holger' !
 + 'Ingo_K' + 'Ant' + 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Michael' + 'Liam Sheehan' + 'Tarim' + 'Agnieszka'</td></tr>
   </table>

Modified: homepage/input/userlist.html
===================================================================
--- homepage/input/userlist.html	2009-08-13 23:00:11 UTC (rev 1781)
+++ homepage/input/userlist.html	2009-08-16 22:25:51 UTC (rev 1782)
@@ -137,6 +137,7 @@
     <li>oxyd4ever</li>
     <li>para_doks</li>
     <li>Pascal</li>
+    <li>Paulus</li>
     <li>purplerainbow</li>
     <li>Ralf</li>
     <li>Raoul</li>
@@ -153,6 +154,7 @@
     <li>Sequoyah</li>
     <li>serpent</li>
     <li>ShadowPhrogg32642342</li>
+    <li>Shaez</li>
     <li>shoki</li>
     <li>Sigma</li>
     <li>Sim_Ed</li>



From ral at mail.berlios.de  Thu Aug 27 00:55:30 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 27 Aug 2009 00:55:30 +0200
Subject: [Enigma-game-svn] r1783 - in trunk: data data/schemas src src/floors
Message-ID: <200908262255.n7QMtUmu030429@sheep.berlios.de>

Author: ral
Date: 2009-08-27 00:55:24 +0200 (Thu, 27 Aug 2009)
New Revision: 1783

Added:
   trunk/src/floors/StandardFloors.cc
   trunk/src/floors/StandardFloors.hh
Modified:
   trunk/data/schemas/objects.xml
   trunk/data/startup.lua
   trunk/src/Makefile.am
   trunk/src/floors.cc
   trunk/src/floors/SimpleFloors.cc
   trunk/src/floors/SimpleFloors.hh
Log:
Trunk 1.1:
- StandardFloor object with full new API support:
  - complete objects.xml declaration of all floors
  - support of methods like isKind and Lua API "is" for standard floors
- fl_fake and fl_inverse as separated simple floor objects:
  - support of attribute "flavor"


Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2009-08-16 22:25:51 UTC (rev 1782)
+++ trunk/data/schemas/objects.xml	2009-08-26 22:55:24 UTC (rev 1783)
@@ -294,6 +294,7 @@
       <msg name="setfire"/>
       <msg name="stopfire"/>
     </object>
+    <object name="fl_standard" abstract="true"/>
     <object name="fl_floodstream" abstract="true">
       <attr name="faces"/>
       <attr name="interval" default="0.2"/>
@@ -305,6 +306,65 @@
       <attr name="adhesion" default="1.0"/>
       <attr name="noash" default="true"/>
     </object>
+    <object name="fl_adhesionless" super="fl_standard">
+      <attr name="friction" default="2.5"/>
+      <attr name="adhesion" default="0.0"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_aquamarine" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="0.4"/>
+      <attr name="adhesion" default="1.0"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_aquamarine_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_bast" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="1.5"/>
+      <attr name="adhesion" default="2.5"/>
+      <attr name="burnable" default="true"/>
+      <attr name="$firetransform" default="fl_abyss"/>
+    </object>
+    <object name="fl_bast_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_bluegray" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="4.5"/>
+      <attr name="adhesion" default="1.5"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_bluegray_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_bluegreen" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="6.0"/>
+      <attr name="adhesion" default="2.0"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_bluegreen_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_blueslab" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="7.0"/>
+      <attr name="adhesion" default="2.0"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_blueslab_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_brick" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="3.5"/>
+      <attr name="adhesion" default="2.0"/>
+    </object>
+    <object name="fl_brick_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
     <object name="fl_bridge">
       <attr name="flavor" default="gc"/>
       <attr name="friction" default="5.0"/>
@@ -331,6 +391,73 @@
     <object name="fl_bridge_bn">
       <attr name="flavor" value="bn"/>
     </object>
+    <object name="fl_bright" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="3.0"/>
+      <attr name="adhesion" default="1.5"/>
+    </object>
+    <object name="fl_bright_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_concrete" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="4.5"/>
+      <attr name="adhesion" default="1.3"/>
+    </object>
+    <object name="fl_concrete_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_dark" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="3.0"/>
+      <attr name="adhesion" default="1.5"/>
+    </object>
+    <object name="fl_dark_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_darkgray" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="3.0"/>
+      <attr name="adhesion" default="1.6"/>
+    </object>
+    <object name="fl_darkgray_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_dunes" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="1.3"/>
+      <attr name="adhesion" default="1.0"/>
+    </object>
+    <object name="fl_dunes_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_fake">
+      <attr name="flavor" default="abyss"/>
+      <attr name="friction" default="3.0"/>
+      <attr name="adhesion" default="2.0"/>
+    </object>
+    <object name="fl_fake_abyss">
+      <attr name="flavor" value="abyss"/>
+    </object>
+    <object name="fl_fake_trigger">
+      <attr name="flavor" value="trigger"/>
+    </object>
+    <object name="fl_gravel" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="3.2"/>
+      <attr name="adhesion" default="1.5"/>
+    </object>
+    <object name="fl_gravel_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_gray" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="5.0"/>
+      <attr name="adhesion" default="3.0"/>
+    </object>
+    <object name="fl_gray_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
     <object name="fl_hay" super="fl_floodstream">
       <attr name="friction" default="5.0"/>
       <attr name="adhesion" default="1.5"/>
@@ -339,11 +466,153 @@
     <object name="fl_hay_framed">
       <attr name="faces" value="nesw"/>
     </object>
+    <object name="fl_himalaya" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="5.0"/>
+      <attr name="adhesion" default="2.0"/>
+    </object>
+    <object name="fl_himalaya_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
     <object name="fl_ice">
       <attr name="friction" default="0.1"/>
       <attr name="adhesion" default="0.1"/>
       <attr name="$heattransform" default="fl_water"/>
     </object>
+    <object name="fl_inverse">
+      <attr name="flavor" default="white"/>
+      <attr name="friction" default="3.0"/>
+      <attr name="adhesion" default="-2.0"/>
+    </object>
+    <object name="fl_inverse_white">
+      <attr name="flavor" value="white"/>
+    </object>
+    <object name="fl_inverse_gray">
+      <attr name="flavor" value="gray"/>
+    </object>
+    <object name="fl_ivory" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="2.2"/>
+      <attr name="adhesion" default="1.6"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_ivory_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_lawn" super="fl_standard">
+      <attr name="friction" default="4.0"/>
+      <attr name="adhesion" default="1.5"/>
+      <attr name="burnable" default="true"/>
+      <attr name="$firetransform" default="fl_dunes"/>
+    </object>
+    <object name="fl_lawn_a" init="true"/>
+    <object name="fl_lawn_b" init="true"/>
+    <object name="fl_lawn_c1" init="true"/>
+    <object name="fl_lawn_c2" init="true"/>
+    <object name="fl_lawn_c3" init="true"/>
+    <object name="fl_lawn_c4" init="true"/>
+    <object name="fl_lawn_d1" init="true"/>
+    <object name="fl_lawn_d2" init="true"/>
+    <object name="fl_lawn_d3" init="true"/>
+    <object name="fl_lawn_d4" init="true"/>
+    <object name="fl_lawn_e1" init="true"/>
+    <object name="fl_lawn_e2" init="true"/>
+    <object name="fl_lawn_e3" init="true"/>
+    <object name="fl_lawn_e4" init="true"/>
+    <object name="fl_marble" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="6.4"/>
+      <attr name="adhesion" default="2.0"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_marble_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_metal" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="3.0"/>
+      <attr name="adhesion" default="2.0"/>
+    </object>
+    <object name="fl_metal_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_metal_1" init="true"/>
+    <object name="fl_metal_1_framed" init="true"/>
+    <object name="fl_metal_2" init="true"/>
+    <object name="fl_metal_2_framed" init="true"/>
+    <object name="fl_metal_3" init="true"/>
+    <object name="fl_metal_3_framed" init="true"/>
+    <object name="fl_metal_4" init="true"/>
+    <object name="fl_metal_4_framed" init="true"/>
+    <object name="fl_metal_5" init="true"/>
+    <object name="fl_metal_5_framed" init="true"/>
+    <object name="fl_metal_6" init="true"/>
+    <object name="fl_metal_6_framed" init="true"/>
+    <object name="fl_metal_7" init="true"/>
+    <object name="fl_metal_7_framed" init="true"/>
+    <object name="fl_metal_7n" init="true"/>
+    <object name="fl_mortar" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="7.2"/>
+      <attr name="adhesion" default="1.8"/>
+    </object>
+    <object name="fl_mortar_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_pinkbumps" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="5.0"/>
+      <attr name="adhesion" default="1.2"/>
+    </object>
+    <object name="fl_pinkbumps_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_plank" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="5.5"/>
+      <attr name="adhesion" default="2.0"/>
+      <attr name="burnable" default="true"/>
+      <attr name="$firetransform" default="fl_abyss"/>
+    </object>
+    <object name="fl_plank_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_platinum" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="3.0"/>
+      <attr name="adhesion" default="1.6"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_platinum_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_red" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="0.9"/>
+      <attr name="adhesion" default="1.0"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_red_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_redslab" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="7.0"/>
+      <attr name="adhesion" default="2.0"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_redslab_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_rough" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="7.0"/>
+      <attr name="adhesion" default="2.0"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_rough_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
     <object name="fl_rock" super="fl_floodstream">
       <attr name="friction" default="6.5"/>
       <attr name="adhesion" default="2.2"/>
@@ -351,6 +620,28 @@
     <object name="fl_rock_framed">
       <attr name="faces" value="nesw"/>
     </object>
+    <object name="fl_sahara" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="6.4"/>
+      <attr name="adhesion" default="2.0"/>
+    </object>
+    <object name="fl_sahara_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_samba" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="6.0"/>
+      <attr name="adhesion" default="2.0"/>
+      <attr name="burnable" default="true"/>
+      <attr name="$firetransform" default="fl_abyss"/>
+    </object>
+    <object name="fl_samba_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
+    <object name="fl_samba_h" init="true"/>
+    <object name="fl_samba_h_framed" init="true"/>
+    <object name="fl_samba_v" init="true"/>
+    <object name="fl_samba_v_framed" init="true"/>
     <object name="fl_slope">
       <attr name="friction" default="4.0"/>
       <attr name="adhesion" default="2.0"/>
@@ -358,6 +649,14 @@
       <attr name="strength"/>
       <attr name="shape"/>
     </object>
+    <object name="fl_sand" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="6.0"/>
+      <attr name="adhesion" default="2.0"/>
+    </object>
+    <object name="fl_sand_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
     <object name="fl_slope_pw">
       <attr name="shape" value="pw"/>
     </object>
@@ -434,6 +733,14 @@
       <attr name="friction" default="0.0"/>
       <attr name="adhesion" default="0.0"/>
     </object>
+    <object name="fl_stone" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="1.4"/>
+      <attr name="adhesion" default="1.0"/>
+    </object>
+    <object name="fl_stone_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
     <object name="fl_swamp">
       <attr name="friction" default="13.0"/>
       <attr name="adhesion" default="1.0"/>
@@ -444,11 +751,28 @@
       <attr name="adhesion" default="1.5"/>
       <msg name="_capture"/>
     </object>
+    <object name="fl_tigris" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="6.0"/>
+      <attr name="adhesion" default="2.0"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_tigris_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
     <object name="fl_water" super="fl_floodstream">
       <attr name="friction" default="5.0"/>
       <attr name="adhesion" default="1.0"/>
       <attr name="$heattransform" default="fl_swamp"/>
     </object>
+    <object name="fl_white" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="4.0"/>
+      <attr name="adhesion" default="2.0"/>
+    </object>
+    <object name="fl_white_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
     <object name="fl_wood" super="fl_floodstream">
       <attr name="friction" default="6.4"/>
       <attr name="adhesion" default="2.0"/>
@@ -462,6 +786,15 @@
     </object>
     <object name="fl_wood_framed_h" init="true"/>
     <object name="fl_wood_framed_v" init="true"/>
+    <object name="fl_woven" super="fl_standard">
+      <attr name="faces"/>
+      <attr name="friction" default="6.5"/>
+      <attr name="adhesion" default="3.0"/>
+      <attr name="burnable" default="true"/>
+    </object>
+    <object name="fl_woven_framed">
+      <attr name="faces" value="nesw"/>
+    </object>
     <object name="fl_yinyang">
       <attr name="friction" default="5.2"/>
       <attr name="adhesion" default="2.0"/>

Modified: trunk/data/startup.lua
===================================================================
--- trunk/data/startup.lua	2009-08-16 22:25:51 UTC (rev 1782)
+++ trunk/data/startup.lua	2009-08-26 22:55:24 UTC (rev 1783)
@@ -118,66 +118,4 @@
 end
 
 -- Floor(kind, friction, adhesion, burnable, firetransform, frames)
-def_floor("fl_bluegray",     4.5,   1.5,    true,   "",         true)
-def_floor("fl_bluegreen",    6.0,   2.0,    true,   "",         true)
-def_floor("fl_aquamarine",   0.4,   1.0,    true,   "",         true)
-def_floor("fl_brick",        3.5,   2.0,   false,   "",         true)
-def_floor("fl_pinkbumps",    5.0,   1.2,   false,   "",         true)
-def_floor("fl_concrete",     4.5,   1.3,   false,   "",         true)
-def_floor("fl_dunes",        1.3,   1.0,   false,   "",         true)
-def_floor("fl_bast",         1.5,   2.5,    true,   "fl_abyss", true)
-def_floor("fl_gravel",       3.2,   1.5,   false,   "",         true)
-def_floor("fl_gray",         5.0,   3.0,   false,   "",         true)
-def_floor("fl_himalaya",     5.0,   2.0,   false,   "",         true)
-def_floor("fl_inverse",      3.0,  -2.0,   false,   "",         false)
-def_floor("fl_inverse_white",3.0,  -2.0,   false,   "",         false)
-def_floor("fl_inverse_gray", 3.0,  -2.0,   false,   "",         false)
-def_floor("fl_lawn",         4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_a",       4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_b",       4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_c1",      4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_c2",      4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_c3",      4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_c4",      4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_d1",      4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_d2",      4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_d3",      4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_d4",      4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_e1",      4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_e2",      4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_e3",      4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_lawn_e4",      4.0,   1.5,    true,   "fl_dunes", false)
-def_floor("fl_ivory",        2.2,   1.6,    true,   "",         true)
-def_floor("fl_platinum",     3.0,   1.6,    true,   "",         true)
-def_floor("fl_darkgray",     3.0,   1.6,   false,   "",         true)
-def_floor("fl_marble",       6.4,   2.0,    true,   "",         true)
-def_floor("fl_metal",        3.0,   2.0,   false,   "",         true)
-def_floor("fl_metal_1",      3.0,   2.0,   false,   "",         true)
-def_floor("fl_metal_2",      3.0,   2.0,   false,   "",         true)
-def_floor("fl_metal_3",      3.0,   2.0,   false,   "",         true)
-def_floor("fl_metal_4",      3.0,   2.0,   false,   "",         true)
-def_floor("fl_metal_5",      3.0,   2.0,   false,   "",         true)
-def_floor("fl_metal_6",      3.0,   2.0,   false,   "",         true)
-def_floor("fl_metal_7",      3.0,   2.0,   false,   "",         true)
-def_floor("fl_metal_7n",     4.0,   2.0,   false,   "",         true)
-def_floor("fl_mortar",       7.2,   1.8,   false,   "",         true)
-def_floor("fl_plank",        5.5,   2.0,    true,   "fl_abyss", true)
-def_floor("fl_red",          0.9,   1.0,    true,   "",         true)
-def_floor("fl_rough",        7.0,   2.0,    true,   "",         true)
-def_floor("fl_blueslab",     7.0,   2.0,    true,   "",         true)
-def_floor("fl_redslab",      7.0,   2.0,    true,   "",         true)
-def_floor("fl_sahara",       6.4,   2.0,   false,   "",         true)
-def_floor("fl_samba",        6.0,   2.0,    true,   "fl_abyss", true)
-def_floor("fl_samba_h",      6.0,   2.0,    true,   "fl_abyss", true)
-def_floor("fl_samba_v",      6.0,   2.0,    true,   "fl_abyss", true)
-def_floor("fl_sand",         6.0,   2.0,   false,   "",         true)
-def_floor("fl_white",        4.0,   2.0,   false,   "",         true)
-def_floor("fl_stone",        1.4,   1.0,   false,   "",         true)
-def_floor("fl_tigris",       6.0,   2.0,    true,   "",         true)
-def_floor("fl_woven",        6.5,   3.0,    true,   "",         true)
-def_floor("fl_adhesionless", 2.5,   0.0,    true,   "",         false)
-def_floor("fl_dark",         3.0,   1.5,   false,   "",         true)
-def_floor("fl_bright",       3.0,   1.5,   false,   "",         true)
-def_floor("fl_fake_trigger", 3.0,   2.0,    true,   "",         true)
-def_floor("fl_fake_abyss",   3.0,   2.0,   false,   "",         false)
 

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2009-08-16 22:25:51 UTC (rev 1782)
+++ trunk/src/Makefile.am	2009-08-26 22:55:24 UTC (rev 1783)
@@ -162,6 +162,8 @@
 	floors/SimpleFloors.hh	\
 	floors/SlopeFloor.cc	\
 	floors/SlopeFloor.hh	\
+	floors/StandardFloors.cc	\
+	floors/StandardFloors.hh	\
 	floors/ThiefFloor.cc	\
 	floors/ThiefFloor.hh	\
 	gui/ErrorMenu.cc	\

Modified: trunk/src/floors/SimpleFloors.cc
===================================================================
--- trunk/src/floors/SimpleFloors.cc	2009-08-16 22:25:51 UTC (rev 1782)
+++ trunk/src/floors/SimpleFloors.cc	2009-08-26 22:55:24 UTC (rev 1783)
@@ -59,9 +59,22 @@
         Log << ecl::strf("Entering floor 0x%x\n", code);
     }
 
+/* -------------------- FakeFloor -------------------- */
+
+    FakeFloor::FakeFloor(std::string flavor) : Floor ("fl_fake") {
+        setAttr("flavor", flavor);
+    }
+    
+    std::string FakeFloor::getClass() const {
+        return "fl_fake";
+    }
+    
+    void FakeFloor::init_model()  {
+        set_model("fl_fake_" + getAttr("flavor").to_string());
+    }
+
 /* -------------------- Ice -------------------- */
 
-
     IceFloor::IceFloor() : Floor ("fl_ice") {
     }
     
@@ -69,6 +82,20 @@
         return "fl_ice";
     }
     
+/* -------------------- InverseFloor -------------------- */
+
+    InverseFloor::InverseFloor(std::string flavor) : Floor ("fl_inverse") {
+        setAttr("flavor", flavor);
+    }
+    
+    std::string InverseFloor::getClass() const {
+        return "fl_inverse";
+    }
+    
+    void InverseFloor::init_model()  {
+        set_model("fl_inverse_" + getAttr("flavor").to_string());
+    }
+
 /* -------------------- Space -------------------- */
 
     
@@ -156,7 +183,13 @@
     BOOT_REGISTER_START
         BootRegister(new Abyss(),     "fl_abyss");
         BootRegister(new DummyFloor(),"fl_dummy");
+        BootRegister(new FakeFloor(),  "fl_fake");
+        BootRegister(new FakeFloor(),  "fl_fake_abyss");
+        BootRegister(new FakeFloor("trigger"),  "fl_fake_trigger");
         BootRegister(new IceFloor(),  "fl_ice");
+        BootRegister(new InverseFloor(),  "fl_inverse");
+        BootRegister(new InverseFloor(),  "fl_inverse_white");
+        BootRegister(new InverseFloor("gray"),  "fl_inverse_gray");
         BootRegister(new Space(),     "fl_space");
         BootRegister(new Space(true), "fl_space_force");
         BootRegister(new Swamp(),     "fl_swamp");

Modified: trunk/src/floors/SimpleFloors.hh
===================================================================
--- trunk/src/floors/SimpleFloors.hh	2009-08-16 22:25:51 UTC (rev 1782)
+++ trunk/src/floors/SimpleFloors.hh	2009-08-26 22:55:24 UTC (rev 1783)
@@ -58,6 +58,22 @@
     };
 
     /** 
+     * Fake
+     */
+    class FakeFloor : public Floor {
+        CLONEOBJ(FakeFloor);
+        
+    public:
+        FakeFloor(std::string flavor ="abyss");
+
+        // Object interface
+        virtual std::string getClass() const;
+        
+        // GridObject interface
+        virtual void init_model();
+    };
+
+    /** 
      * IceFloor
      */
     class IceFloor : public Floor {
@@ -71,6 +87,22 @@
     };
 
     /** 
+     * InverseFloor
+     */
+    class InverseFloor : public Floor {
+        CLONEOBJ(InverseFloor);
+        
+    public:
+        InverseFloor(std::string flavor ="white");
+
+        // Object interface
+        virtual std::string getClass() const;
+        
+        // GridObject interface
+        virtual void init_model();
+    };
+
+    /** 
      * Space
      */
     class Space : public Floor {

Added: trunk/src/floors/StandardFloors.cc
===================================================================
--- trunk/src/floors/StandardFloors.cc	2009-08-16 22:25:51 UTC (rev 1782)
+++ trunk/src/floors/StandardFloors.cc	2009-08-26 22:55:24 UTC (rev 1783)
@@ -0,0 +1,214 @@
+/*
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "floors/StandardFloors.hh"
+
+//#include "errors.hh"
+#include "main.hh"
+#include "world.hh"
+
+namespace enigma {
+    /**
+     * This is a temporary workaround that allows standard floors to support objects.xml
+     * and methods like isKind(). This mapping should vanish when floors and all other objects
+     * do support a common flexible traits concept.
+     */
+    static struct StandardFloorNames {
+        std::string classname;
+        std::string submodel;
+    } StandardFloorNames[] = {
+        {"fl_adhesionless"},
+        {"fl_aquamarine"},
+        {"fl_bast"},
+        {"fl_bluegray"},
+        {"fl_bluegreen"},
+        {"fl_blueslab"},
+        {"fl_brick"},
+        {"fl_bright"},
+        {"fl_concrete"},
+        {"fl_dark"},
+        {"fl_darkgray"},
+        {"fl_dunes"},
+        {"fl_gravel"},
+        {"fl_gray"},
+        {"fl_himalaya"},
+        {"fl_ivory"},
+        {"fl_lawn"},
+        {"fl_lawn", "fl_lawn_a"},
+        {"fl_lawn", "fl_lawn_b"},
+        {"fl_lawn", "fl_lawn_c1"},
+        {"fl_lawn", "fl_lawn_c2"},
+        {"fl_lawn", "fl_lawn_c3"},
+        {"fl_lawn", "fl_lawn_c4"},
+        {"fl_lawn", "fl_lawn_d1"},
+        {"fl_lawn", "fl_lawn_d2"},
+        {"fl_lawn", "fl_lawn_d3"},
+        {"fl_lawn", "fl_lawn_d4"},
+        {"fl_lawn", "fl_lawn_e1"},
+        {"fl_lawn", "fl_lawn_e2"},
+        {"fl_lawn", "fl_lawn_e3"},
+        {"fl_lawn", "fl_lawn_e4"},
+        {"fl_marble"},
+        {"fl_metal"},
+        {"fl_metal", "fl_metal_1"},
+        {"fl_metal", "fl_metal_2"},
+        {"fl_metal", "fl_metal_3"},
+        {"fl_metal", "fl_metal_4"},
+        {"fl_metal", "fl_metal_5"},
+        {"fl_metal", "fl_metal_6"},
+        {"fl_metal", "fl_metal_7"},
+        {"fl_metal", "fl_metal_7"},  // fl_metal_7n
+        {"fl_mortar"},
+        {"fl_pinkbumps"},
+        {"fl_plank"},
+        {"fl_platinum"},
+        {"fl_red"},
+        {"fl_redslab"},
+        {"fl_rough"},
+        {"fl_sahara"},
+        {"fl_samba"},
+        {"fl_samba", "fl_samba_h"},
+        {"fl_samba", "fl_samba_v"},
+        {"fl_sand"},
+        {"fl_stone"},
+        {"fl_tigris"},
+        {"fl_white"},
+        {"fl_woven"}
+    };
+    
+    StandardFloor::StandardFloor(int type, bool framed) : Floor(StandardFloorNames[type].classname.c_str()) {
+        state = type;
+        Floor::setAttr("faces", framed ? "nesw" : "");
+        if  (type = 40) { // fl_metal_7n -- legacy normal floor with special values
+            setAttr("friction", 4.0);
+            setAttr("adhesion", 2.0);
+        }
+    }
+    
+    std::string StandardFloor::getClass() const {
+        return StandardFloorNames[state].classname;
+    }
+    
+    void StandardFloor::init_model()  {
+        bool isFramed = (getAttr("faces").to_string() == "nesw");
+        set_model((StandardFloorNames[state].submodel.length() > 0 ? StandardFloorNames[state].submodel :
+                StandardFloorNames[state].classname) +  (isFramed ? "_framed" : ""));
+    }
+    
+    BOOT_REGISTER_START
+        BootRegister(new StandardFloor( 0), "fl_adhesionless");
+        BootRegister(new StandardFloor( 1), "fl_aquamarine");
+        BootRegister(new StandardFloor( 1, true), "fl_aquamarine_framed");
+        BootRegister(new StandardFloor( 2), "fl_bast");
+        BootRegister(new StandardFloor( 2, true), "fl_bast_framed");
+        BootRegister(new StandardFloor( 3), "fl_bluegray");
+        BootRegister(new StandardFloor( 3, true), "fl_bluegray_framed");
+        BootRegister(new StandardFloor( 4), "fl_bluegreen");
+        BootRegister(new StandardFloor( 4, true), "fl_bluegreen_framed");
+        BootRegister(new StandardFloor( 5), "fl_blueslab");
+        BootRegister(new StandardFloor( 5, true), "fl_blueslab_framed");
+        BootRegister(new StandardFloor( 6), "fl_brick");
+        BootRegister(new StandardFloor( 6, true), "fl_brick_framed");
+        BootRegister(new StandardFloor( 7), "fl_bright");
+        BootRegister(new StandardFloor( 7, true), "fl_bright_framed");
+        BootRegister(new StandardFloor( 8), "fl_concrete");
+        BootRegister(new StandardFloor( 8, true), "fl_concrete_framed");
+        BootRegister(new StandardFloor( 9), "fl_dark");
+        BootRegister(new StandardFloor( 9, true), "fl_dark_framed");
+        BootRegister(new StandardFloor(10), "fl_darkgray");
+        BootRegister(new StandardFloor(10, true), "fl_darkgray_framed");
+        BootRegister(new StandardFloor(11), "fl_dunes");
+        BootRegister(new StandardFloor(11, true), "fl_dunes_framed");
+        BootRegister(new StandardFloor(12), "fl_gravel");
+        BootRegister(new StandardFloor(12, true), "fl_gravel_framed");
+        BootRegister(new StandardFloor(13), "fl_gray");
+        BootRegister(new StandardFloor(13, true), "fl_gray_framed");
+        BootRegister(new StandardFloor(14), "fl_himalaya");
+        BootRegister(new StandardFloor(14, true), "fl_himalaya_framed");
+        BootRegister(new StandardFloor(15), "fl_ivory");
+        BootRegister(new StandardFloor(15, true), "fl_ivory_framed");
+        BootRegister(new StandardFloor(16), "fl_lawn");
+        BootRegister(new StandardFloor(17), "fl_lawn_a");
+        BootRegister(new StandardFloor(18), "fl_lawn_b");
+        BootRegister(new StandardFloor(19), "fl_lawn_c1");
+        BootRegister(new StandardFloor(20), "fl_lawn_c2");
+        BootRegister(new StandardFloor(21), "fl_lawn_c3");
+        BootRegister(new StandardFloor(22), "fl_lawn_c4");
+        BootRegister(new StandardFloor(23), "fl_lawn_d1");
+        BootRegister(new StandardFloor(24), "fl_lawn_d2");
+        BootRegister(new StandardFloor(25), "fl_lawn_d3");
+        BootRegister(new StandardFloor(26), "fl_lawn_d4");
+        BootRegister(new StandardFloor(27), "fl_lawn_e1");
+        BootRegister(new StandardFloor(28), "fl_lawn_e2");
+        BootRegister(new StandardFloor(29), "fl_lawn_e3");
+        BootRegister(new StandardFloor(30), "fl_lawn_e4");
+        BootRegister(new StandardFloor(31), "fl_marble");
+        BootRegister(new StandardFloor(31, true), "fl_marble_framed");
+        BootRegister(new StandardFloor(32), "fl_metal");
+        BootRegister(new StandardFloor(32, true), "fl_metal_framed");
+        BootRegister(new StandardFloor(33), "fl_metal_1");
+        BootRegister(new StandardFloor(33, true), "fl_metal_1_framed");
+        BootRegister(new StandardFloor(34), "fl_metal_2");
+        BootRegister(new StandardFloor(34, true), "fl_metal_2_framed");
+        BootRegister(new StandardFloor(35), "fl_metal_3");
+        BootRegister(new StandardFloor(35, true), "fl_metal_3_framed");
+        BootRegister(new StandardFloor(36), "fl_metal_4");
+        BootRegister(new StandardFloor(36, true), "fl_metal_4_framed");
+        BootRegister(new StandardFloor(37), "fl_metal_5");
+        BootRegister(new StandardFloor(37, true), "fl_metal_5_framed");
+        BootRegister(new StandardFloor(38), "fl_metal_6");
+        BootRegister(new StandardFloor(38, true), "fl_metal_6_framed");
+        BootRegister(new StandardFloor(39), "fl_metal_7");
+        BootRegister(new StandardFloor(39, true), "fl_metal_7_framed");
+        BootRegister(new StandardFloor(40), "fl_metal_7n");
+        BootRegister(new StandardFloor(41), "fl_mortar");
+        BootRegister(new StandardFloor(41, true), "fl_mortar_framed");
+        BootRegister(new StandardFloor(42), "fl_pinkbumps");
+        BootRegister(new StandardFloor(42, true), "fl_pinkbumps_framed");
+        BootRegister(new StandardFloor(43), "fl_plank");
+        BootRegister(new StandardFloor(43, true), "fl_plank_framed");
+        BootRegister(new StandardFloor(44), "fl_platinum");
+        BootRegister(new StandardFloor(44, true), "fl_platinum_framed");
+        BootRegister(new StandardFloor(45), "fl_red");
+        BootRegister(new StandardFloor(45, true), "fl_red_framed");
+        BootRegister(new StandardFloor(46), "fl_redslab");
+        BootRegister(new StandardFloor(46, true), "fl_redslab_framed");
+        BootRegister(new StandardFloor(47), "fl_rough");
+        BootRegister(new StandardFloor(47, true), "fl_rough_framed");
+        BootRegister(new StandardFloor(48), "fl_sahara");
+        BootRegister(new StandardFloor(48, true), "fl_sahara_framed");
+        BootRegister(new StandardFloor(49), "fl_samba");
+        BootRegister(new StandardFloor(49, true), "fl_samba_framed");
+        BootRegister(new StandardFloor(50), "fl_samba_h");
+        BootRegister(new StandardFloor(50, true), "fl_samba_h_framed");
+        BootRegister(new StandardFloor(51), "fl_samba_v");
+        BootRegister(new StandardFloor(51, true), "fl_samba_v_framed");
+        BootRegister(new StandardFloor(52), "fl_sand");
+        BootRegister(new StandardFloor(52, true), "fl_sand_framed");
+        BootRegister(new StandardFloor(53), "fl_stone");
+        BootRegister(new StandardFloor(53, true), "fl_stone_framed");
+        BootRegister(new StandardFloor(54), "fl_tigris");
+        BootRegister(new StandardFloor(54, true), "fl_tigris_framed");
+        BootRegister(new StandardFloor(55), "fl_white");
+        BootRegister(new StandardFloor(55, true), "fl_white_framed");
+        BootRegister(new StandardFloor(56), "fl_woven");
+        BootRegister(new StandardFloor(56, true), "fl_woven_framed");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/floors/StandardFloors.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/floors/StandardFloors.hh
===================================================================
--- trunk/src/floors/StandardFloors.hh	2009-08-16 22:25:51 UTC (rev 1782)
+++ trunk/src/floors/StandardFloors.hh	2009-08-26 22:55:24 UTC (rev 1783)
@@ -0,0 +1,40 @@
+/*
+ * Copyright (C) 2009 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef STANDARDLOORS_HH
+#define STANDARDLOORS_HH
+
+#include "floors.hh"
+
+namespace enigma {
+
+    class StandardFloor : public Floor {
+        CLONEOBJ(StandardFloor);
+        
+    public:
+        StandardFloor(int type, bool framed =false);
+
+        // Object interface
+        virtual std::string getClass() const;
+
+        // GridObject interface
+        virtual void init_model();
+    };
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/floors/StandardFloors.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2009-08-16 22:25:51 UTC (rev 1782)
+++ trunk/src/floors.cc	2009-08-26 22:55:24 UTC (rev 1783)
@@ -105,6 +105,8 @@
         else if (key == "force_y")
             var_floorforce[1] = val;
         GridObject::setAttr(key, val);
+        if (key == "faces" && isDisplayable())
+            init_model();
     }
 
     Value Floor::getAttr(const std::string &key) const {



From raoul at mail.berlios.de  Thu Aug 27 01:55:44 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Thu, 27 Aug 2009 01:55:44 +0200
Subject: [Enigma-game-svn] r1784 - trunk/data/levels/pentomino_i
Message-ID: <200908262355.n7QNti57000642@sheep.berlios.de>

Author: raoul
Date: 2009-08-27 01:55:44 +0200 (Thu, 27 Aug 2009)
New Revision: 1784

Modified:
   trunk/data/levels/pentomino_i/index.xml
   trunk/data/levels/pentomino_i/pento54_1.xml
   trunk/data/levels/pentomino_i/pento55_1.xml
   trunk/data/levels/pentomino_i/pento76_1.xml
   trunk/data/levels/pentomino_i/pento84_1.xml
   trunk/data/levels/pentomino_i/pento90_1.xml
Log:
-> Fixes for some pentomino levels



Modified: trunk/data/levels/pentomino_i/index.xml
===================================================================
--- trunk/data/levels/pentomino_i/index.xml	2009-08-26 22:55:24 UTC (rev 1783)
+++ trunk/data/levels/pentomino_i/index.xml	2009-08-26 23:55:44 UTC (rev 1784)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Sokoban" location="69000" network="false" owner="Enigma Team" release="1" revision="1" title="Pentomino I"/>
+  <info enigma="1.00" group="Sokoban" location="69000" network="false" owner="Enigma Team" release="1" revision="2" title="Pentomino I"/>
 
   <attributes/>
 
@@ -58,8 +58,8 @@
     <level _seq="50" _title="Pentomino LI" _xpath="./pento51_1" author="Enigma Team" ctrl="force" easy="false" id="pento51" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="51" _title="Pentomino LII" _xpath="./pento52_1" author="Enigma Team" ctrl="force" easy="false" id="pento52" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="52" _title="Pentomino LIII" _xpath="./pento53_1" author="Enigma Team" ctrl="force" easy="false" id="pento53" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="53" _title="Pentomino LIV" _xpath="./pento54_1" author="Enigma Team" ctrl="force" easy="false" id="pento54" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="54" _title="Pentomino LV" _xpath="./pento55_1" author="Enigma Team" ctrl="force" easy="false" id="pento55" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="53" _title="Pentomino LIV" _xpath="./pento54_1" author="Enigma Team" ctrl="force" easy="false" id="pento54" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="54" _title="Pentomino LV" _xpath="./pento55_1" author="Enigma Team" ctrl="force" easy="false" id="pento55" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="55" _title="Pentomino LVI" _xpath="./pento56_1" author="Enigma Team" ctrl="force" easy="false" id="pento56" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="56" _title="Pentomino LVII" _xpath="./pento57_1" author="Enigma Team" ctrl="force" easy="false" id="pento57" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="57" _title="Pentomino LVIII" _xpath="./pento58_1" author="Enigma Team" ctrl="force" easy="false" id="pento58" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -80,7 +80,7 @@
     <level _seq="72" _title="Pentomino LXXIII" _xpath="./pento73_1" author="Enigma Team" ctrl="force" easy="false" id="pento73" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="73" _title="Pentomino LXXIV" _xpath="./pento74_1" author="Enigma Team" ctrl="force" easy="false" id="pento74" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="74" _title="Pentomino LXXV" _xpath="./pento75_1" author="Enigma Team" ctrl="force" easy="false" id="pento75" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="75" _title="Pentomino LXXVI" _xpath="./pento76_1" author="Enigma Team" ctrl="force" easy="false" id="pento76" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="75" _title="Pentomino LXXVI" _xpath="./pento76_1" author="Enigma Team" ctrl="force" easy="false" id="pento76" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="76" _title="Pentomino LXXVII" _xpath="./pento77_1" author="Enigma Team" ctrl="force" easy="false" id="pento77" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="77" _title="Pentomino LXXVIII" _xpath="./pento78_1" author="Enigma Team" ctrl="force" easy="false" id="pento78" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="78" _title="Pentomino LXXIX" _xpath="./pento79_1" author="Enigma Team" ctrl="force" easy="false" id="pento79" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -88,13 +88,13 @@
     <level _seq="80" _title="Pentomino LXXXI" _xpath="./pento81_1" author="Enigma Team" ctrl="force" easy="false" id="pento81" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="81" _title="Pentomino LXXXII" _xpath="./pento82_1" author="Enigma Team" ctrl="force" easy="false" id="pento82" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="82" _title="Pentomino LXXXIII" _xpath="./pento83_1" author="Enigma Team" ctrl="force" easy="false" id="pento83" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="83" _title="Pentomino LXXXIV" _xpath="./pento84_1" author="Enigma Team" ctrl="force" easy="false" id="pento84" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="83" _title="Pentomino LXXXIV" _xpath="./pento84_1" author="Enigma Team" ctrl="force" easy="false" id="pento84" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="84" _title="Pentomino LXXXV" _xpath="./pento85_1" author="Enigma Team" ctrl="force" easy="false" id="pento85" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="85" _title="Pentomino LXXXVI" _xpath="./pento86_1" author="Enigma Team" ctrl="force" easy="false" id="pento86" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="86" _title="Pentomino LXXXVII" _xpath="./pento87_1" author="Enigma Team" ctrl="force" easy="false" id="pento87" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="87" _title="Pentomino LXXXVIII" _xpath="./pento88_1" author="Enigma Team" ctrl="force" easy="false" id="pento88" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="88" _title="Pentomino LXXXIX" _xpath="./pento89_1" author="Enigma Team" ctrl="force" easy="false" id="pento89" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="89" _title="Pentomino XC" _xpath="./pento90_1" author="Enigma Team" ctrl="force" easy="false" id="pento90" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="89" _title="Pentomino XC" _xpath="./pento90_1" author="Enigma Team" ctrl="force" easy="false" id="pento90" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="90" _title="Pentomino XCI" _xpath="./pento91_1" author="Enigma Team" ctrl="force" easy="false" id="pento91" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="91" _title="Pentomino XCII" _xpath="./pento92_1" author="Enigma Team" ctrl="force" easy="false" id="pento92" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="92" _title="Pentomino XCIII" _xpath="./pento93_1" author="Enigma Team" ctrl="force" easy="false" id="pento93" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/pentomino_i/pento54_1.xml
===================================================================
--- trunk/data/levels/pentomino_i/pento54_1.xml	2009-08-26 22:55:24 UTC (rev 1783)
+++ trunk/data/levels/pentomino_i/pento54_1.xml	2009-08-26 23:55:44 UTC (rev 1784)
@@ -2,8 +2,8 @@
 <el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
   <el:protected >
     <el:info el:type="level">
-      <el:identity el:title="Pentomino LIV" el:subtitle="337 solutions" el:id="pento54"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:identity el:title="Pentomino LIV" el:subtitle="377 solutions" el:id="pento54"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author el:name="Enigma Team" el:email=""/>
       <el:copyright>Copyright ? 2009 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>

Modified: trunk/data/levels/pentomino_i/pento55_1.xml
===================================================================
--- trunk/data/levels/pentomino_i/pento55_1.xml	2009-08-26 22:55:24 UTC (rev 1783)
+++ trunk/data/levels/pentomino_i/pento55_1.xml	2009-08-26 23:55:44 UTC (rev 1784)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Pentomino LV" el:subtitle="438 solutions" el:id="pento55"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author el:name="Enigma Team" el:email=""/>
       <el:copyright>Copyright ? 2009 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -38,13 +38,13 @@
     "#%%%%%%%%%%%%%%%%%%#",
     "%                  %",
     "%                  %",
-    "#       ...........#",
-    "& +++++  ......... #",
-    "# +++++  ......... #",
-    "/ +++++ @......... #",
-    "# +++++  ......... #",
-    "| +++++  ......... #",
-    "#       ...........#",
+    "#        ..........#",
+    "& +++++   ........ #",
+    "# +++++   ........ #",
+    "/ +++++ @ ........ #",
+    "# +++++   ........ #",
+    "| +++++   ........ #",
+    "#        ..........#",
     "%!!!!!             %",
     "%Nesw!             %",
     "#%%%%%%%%%%%%%%%%%%#"})

Modified: trunk/data/levels/pentomino_i/pento76_1.xml
===================================================================
--- trunk/data/levels/pentomino_i/pento76_1.xml	2009-08-26 22:55:24 UTC (rev 1783)
+++ trunk/data/levels/pentomino_i/pento76_1.xml	2009-08-26 23:55:44 UTC (rev 1784)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Pentomino LXXVI" el:subtitle="6 solutions" el:id="pento76"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author el:name="Enigma Team" el:email=""/>
       <el:copyright>Copyright ? 2009 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -37,7 +37,7 @@
 wo(pento, " ", {
     "#%%%%%%%############",
     "%       ...........#",
-    "%        ...... ...#",
+    "%        ..... ....#",
     "#        ..........#",
     "& +++++            %",
     "# +++++       !!!!!%",
@@ -45,7 +45,7 @@
     "# +++++       !!!!!%",
     "| +++++            %",
     "#        ..........#",
-    "%        ...... ...#",
+    "%        ..... ....#",
     "%       ...........#",
     "#%%%%%%%############"})
 

Modified: trunk/data/levels/pentomino_i/pento84_1.xml
===================================================================
--- trunk/data/levels/pentomino_i/pento84_1.xml	2009-08-26 22:55:24 UTC (rev 1783)
+++ trunk/data/levels/pentomino_i/pento84_1.xml	2009-08-26 23:55:44 UTC (rev 1784)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Pentomino LXXXIV" el:subtitle="2 solutions" el:id="pento84"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
       <el:author el:name="Enigma Team" el:email=""/>
       <el:copyright>Copyright ? 2009 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -14,6 +14,10 @@
       <el:score el:easy="-" el:difficult="-"/>
     </el:info>
     <el:luamain><![CDATA[
+wo["FollowGrid"] = true
+wo["FollowMethod"] = FOLLOW_SCROLL
+wo["FollowAction"] = FOLLOW_HALFSCREEN
+
 ti[" "] = {"fl_plank"}
 ti["+"] = {"fl_bluegreen", "source#"}
 ti["."] = {"fl_lawn", "target#"}

Modified: trunk/data/levels/pentomino_i/pento90_1.xml
===================================================================
--- trunk/data/levels/pentomino_i/pento90_1.xml	2009-08-26 22:55:24 UTC (rev 1783)
+++ trunk/data/levels/pentomino_i/pento90_1.xml	2009-08-26 23:55:44 UTC (rev 1784)
@@ -2,8 +2,8 @@
 <el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
   <el:protected >
     <el:info el:type="level">
-      <el:identity el:title="Pentomino XC" el:subtitle="3 solutions" el:id="pento90"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:identity el:title="Pentomino XC" el:subtitle="40 solutions" el:id="pento90"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
       <el:author el:name="Enigma Team" el:email=""/>
       <el:copyright>Copyright ? 2009 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -35,8 +35,8 @@
 pento = res.pento(ti, "source", "target")
 
 wo(pento, " ", {
-    "#%%%%%%%%%%%%%%%%%%#",
-    "%                  %",
+    "#%%%%%%%%%%%#####%%#",
+    "%           .....  %",
     "%          ....... %",
     "#          ....... %",
     "& +++++    ....... %",



From andreasl at mail.berlios.de  Thu Aug 27 21:40:37 2009
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Thu, 27 Aug 2009 21:40:37 +0200
Subject: [Enigma-game-svn] r1785 - in trunk/data: . levels/lib
Message-ID: <200908271940.n7RJebX0018795@sheep.berlios.de>

Author: andreasl
Date: 2009-08-27 21:40:35 +0200 (Thu, 27 Aug 2009)
New Revision: 1785

Modified:
   trunk/data/api2init.lua
   trunk/data/levels/lib/libmap.xml
   trunk/data/levels/lib/libsoko.xml
Log:
Trunk:
 - Speedup of remaining cases in lib.map.fuse (factor 30).
 - Speedup of lib.map.defuse.
 - Slight speedup of lib.map.set (factor 3 if positional argument is a table).
 - Fixed bug in libsoko (incorrect classification of some walls as
   type-two-walls, which resulted in wrongly set oxyds).



Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2009-08-26 23:55:44 UTC (rev 1784)
+++ trunk/data/api2init.lua	2009-08-27 19:40:35 UTC (rev 1785)
@@ -276,10 +276,11 @@
         end
         -- Draw map
         for y=1, #map do
-            local linelen = string.len(map[y])
+            local line = map[y]
+            local linelen = string.len(line)
             assert_bool(math.fmod(linelen, len) == 0, "wo:drawMap: Map line ".. y .. " with odd length.", 2)
             for x = 1, linelen/len do
-                local key = string.sub(map[y], len*(x-1)+1, len*x)
+                local key = string.sub(line, len*(x-1)+1, len*x)
                 if key ~= ignore then
                     local p = {origin.x - 1, origin.y - 1}
                     if readdir == MAP_IDENT then

Modified: trunk/data/levels/lib/libmap.xml
===================================================================
--- trunk/data/levels/lib/libmap.xml	2009-08-26 23:55:44 UTC (rev 1784)
+++ trunk/data/levels/lib/libmap.xml	2009-08-27 19:40:35 UTC (rev 1785)
@@ -86,54 +86,86 @@
     return wo:newMap(map1.defaultkey, result)
 end
 
-function lib.map.fuse(arg1, arg2)
-    local map1, map2 = arg1, arg2
-    if type(arg1) == "string" then
-        map1 = wo:newMap(arg1)
-    end
-    if type(arg2) == "string" then
-        map2 = wo:newMap(arg2)
-    end
-    assert_type(map1, "lib.map.fuse first argument", 2, "map")
-    assert_type(map2, "lib.map.fuse second argument", 2, "map")
+function lib.map.fuse(map1, map2)
+    assert_type(map1, "lib.map.fuse first argument", 2, "map", "string")
+    assert_type(map2, "lib.map.fuse second argument", 2, "map", "string")
+    assert_bool((etype(map1) == "map") or (etype(map2) == "map"),
+                "lib.map.fuse: At least one argument must be a map, but both are strings.", 2)
     local result = {}
-    if type(arg1) == "string" and string.len(arg1) == 1 and map2.__keylength == 1 then
---        print ("map fuse optimizer")
+    if type(map1) == "string" then
+        local width = map2.width
+        local kl = map2.__keylength
         for y = 1, map2.height do
             local line2 = map2[y]
             local line = ""
-            for x = 1, string.len(line2) do
-                line = line .. arg1 .. string.sub(line2, x, x)
+            for x = 1, width*kl, kl do
+                line = line .. map1 .. string.sub(line2, x, x + kl - 1)
             end
             result[y] = line
         end
+        return wo:newMap(map1 .. map2.defaultkey, result)  
+    elseif type(map2) == "string" then
+        local width = map1.width
+        local kl = map1.__keylength
+        for y = 1, map1.height do
+            local line1 = map1[y]
+            local line = ""
+            for x = 1, width*kl, kl do
+                line = line .. string.sub(line1, x, x + kl - 1) .. map2
+            end
+            result[y] = line
+        end        
+        return wo:newMap(map1.defaultkey .. map2, result)  
     else
-    for y = 1, math.max(map1.height, map2.height) do
-        result[y] = ""
-        for x = 1, math.max(map1.width, map2.width) do
-            result[y] = result[y] .. map1[{x - 1, y - 1}] .. map2[{x - 1, y - 1}]
+        local width = math.max(map1.width, map2.width)
+        local kl1 = map1.__keylength
+        local kl2 = map2.__keylength
+        local dk1 = map1.defaultkey
+        local dk2 = map2.defaultkey
+        for y = 1, math.max(map1.height, map2.height) do
+            local line1 = map1[y] or ""
+            local line2 = map2[y] or ""
+            local line = ""
+            for x = 1, width do
+                local p1 = string.sub(line1, x*kl1 - kl1 + 1, x*kl1)
+                local p2 = string.sub(line2, x*kl2 - kl2 + 1, x*kl2)
+                if p1 == "" then
+                    line = line .. dk1
+                else
+                    line = line .. p1
+                end
+                if p2 == "" then
+                    line = line .. dk2
+                else
+                    line = line .. p2
+                end
+            end
+            result[y] = line
         end
+        return wo:newMap(map1.defaultkey .. map2.defaultkey, result)  
     end
-    end
-    return wo:newMap(map1.defaultkey .. map2.defaultkey, result)  
 end
 
 function lib.map.defuse(map)
     assert_type(map, "lib.map.defuse first argument", 2, "map")
     local kl = rawget(map, "__keylength")
     local dk = rawget(map, "__defaultkey")
-    local result = {}
+    local premap = {}
     for j = 1, kl do
-        result[j] = wo:newMap(string.sub(dk, j, j), map.width, map.height)
+        premap[j] = {}
     end
-    for y = 0, map.height - 1 do
-        for x = 0, map.width - 1 do
-            local key = map[{x,y}]
-            for j = 1, kl do
-                result[j][{x,y}] = string.sub(key, j, j)
-            end
+    for y = 1, rawget(map, "__height") do
+        local line = map[y]
+        local j = 1
+        for x = 1, string.len(line) do
+            premap[j][y] = (premap[j][y] or "") .. string.sub(line, x, x)
+            j = (j % kl) + 1
         end
     end
+    local result = {}
+    for j = 1, kl do
+        result[j] = wo:newMap(string.sub(dk, j, j), premap[j])
+    end
     return result
 end
 
@@ -448,15 +480,15 @@
                 .."(should be "..kl.. ", is "..string.len(value)..").", 2)
         end
         if (usertype(posarg) == "position") or (usertype(posarg) == "object") then
-            local pos = posarg:grid()
-            if (pos.x < 0) or (pos.y < 0) then
-                error("lib.map.set: Negative positions are not supported.", 2)
+            local x, y = (posarg:grid()):xy()
+            assert_bool((x >= 0) and (y >= 0), "lib.map.set: Negative positions are not supported.", 2)
+            if (x >= rawget(map, "__width")) or (y >= rawget(map, "__height")) then
+                map:extend({x, y})
             end
-            map:extend(pos)
-            rawset(map, pos.y + 1,
-                   string.sub(rawget(map, pos.y + 1), 1, pos.x * kl)
+            rawset(map, y + 1,
+                   string.sub(rawget(map, y + 1), 1, x * kl)
                 .. value
-                .. string.sub(rawget(map, pos.y + 1), (pos.x + 1) * kl + 1, -1))
+                .. string.sub(rawget(map, y + 1), (x + 1) * kl + 1, -1))
         elseif usertype(posarg) == "group" then
             for obj in posarg do
                 map:extend(obj)
@@ -474,7 +506,17 @@
                   .. string.sub(rawget(map, posarg[j].y + 1), (posarg[j].x + 1) * kl + 1, -1))
             end
         elseif type(posarg) == "table" then
-            lib.map.set(map, po(posarg), value)
+            local x, y = posarg[1], posarg[2]
+            assert_bool(type(x) == "number", "lib.map.set second argument (position): Conversion to position failed.", 2)
+            assert_bool(type(y) == "number", "lib.map.set second argument (position): Conversion to position failed.", 2)
+            assert_bool((x >= 0) and (y >= 0), "lib.map.set: Negative positions are not supported.", 2)
+            if (x >= rawget(map, "__width")) or (y >= rawget(map, "__height")) then
+                map:extend({x, y})
+            end
+            rawset(map, y + 1,
+                   string.sub(rawget(map, y + 1), 1, x * kl)
+                .. value
+                .. string.sub(rawget(map, y + 1), (x + 1) * kl + 1, -1))
         end
     end
 end

Modified: trunk/data/levels/lib/libsoko.xml
===================================================================
--- trunk/data/levels/lib/libsoko.xml	2009-08-26 23:55:44 UTC (rev 1784)
+++ trunk/data/levels/lib/libsoko.xml	2009-08-27 19:40:35 UTC (rev 1785)
@@ -410,35 +410,34 @@
             local delta = NEIGHBORS_8[j]
             outside = outside or lib.soko.area[pos + delta].is_outf
         end
-        if outside then
-            local count = 0
-            local last_orientation
-            for _, dir in ipairs({{N, NORTH}, {S, SOUTH}, {E, EAST}, {W, WEST}}) do
-                if lib.soko.area[pos + dir[1]].is_way then
-                    count = count + 1
-                    last_orientation = dir[2]
-                end
+        local count = 0
+        local last_orientation
+        for _, dir in ipairs({{N, NORTH}, {S, SOUTH}, {E, EAST}, {W, WEST}}) do
+            if lib.soko.area[pos + dir[1]].is_way then
+                count = count + 1
+                last_orientation = dir[2]
             end
-            if count > 0 then
-                mark_as(pos, "wall_one")
-                lib.soko.area[pos].ways = count
-                if count == 1 then
-                    lib.soko.area[pos].orientation = last_orientation
-                end
+        end
+        lib.soko.area[pos].ways = count
+        if outside and (count > 0) then
+            mark_as(pos, "wall_one")
+            if count == 1 then
+                lib.soko.area[pos].orientation = last_orientation
             end
         end
     end
     -- polist.wall_two
-    -- There are three conditions for an element of polist.wall_two:
+    -- There are four conditions for an element of polist.wall_two:
     -- (i) it's near a wall_one, (ii) it's not a wall_one,
-    -- (iii) it's wall or outside. In addition, the neighboring
-    -- wall_one are added into the list.
+    -- (iii) it's wall or outside, (iii) it's not near a way.
+    -- In addition, the neighboring wall_one are added into the list.
     for i = 1, #lib.soko.polist.wall_one do
         local wall_one = lib.soko.polist.wall_one[i]
         for j = 1, #NEIGHBORS_4 do
             local delta = NEIGHBORS_4[j]
             local check = wall_one + delta
-            if not (lib.soko.area[check].is_way or lib.soko.area[check].is_wall_one) then
+            if not (lib.soko.area[check].is_way or lib.soko.area[check].is_wall_one
+                    or ((lib.soko.area[check].ways or 0) > 0)) then
                 mark_as(check, "wall_two")
                 lib.soko.area[check].wall_one =
                     (lib.soko.area[check].wall_one or po(grp())) .. wall_one



From ral at mail.berlios.de  Fri Aug 28 00:09:17 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 28 Aug 2009 00:09:17 +0200
Subject: [Enigma-game-svn] r1786 - trunk/src
Message-ID: <200908272209.n7RM9HOE005026@sheep.berlios.de>

Author: ral
Date: 2009-08-28 00:09:16 +0200 (Fri, 28 Aug 2009)
New Revision: 1786

Modified:
   trunk/src/lua.cc
Log:
Trunk 1.1:
- add convertion of a table of positions into a polist:
    polist = po({po(2,2), po(3,3), po(3,4), po(4,4)})
Note:
- a table of two numbers converts to a single position:
    position = po({3,4})

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2009-08-27 19:40:35 UTC (rev 1785)
+++ trunk/src/lua.cc	2009-08-27 22:09:16 UTC (rev 1786)
@@ -1722,7 +1722,7 @@
 }
 
 static int newPolist(lua_State *L) {
-    // (grp )
+    // (grp | table)
     PositionList positions;
     if (is_group(L, 1)) {
         ObjectList ol = toObjectList(L, 1);
@@ -1732,6 +1732,13 @@
                 positions.push_back(*itr);
             }
         }
+    } else if (is_table(L, 1)) {
+        int len = lua_objlen(L, 1);
+        for (int i = 1; i <= len; i++) {
+            lua_rawgeti(L, 1, i);
+            positions.push_back(to_value(L, -1));
+            lua_pop(L, 1);
+        }
     } else {
         throwLuaError(L, "New Polist - false arguments");
         return 0;
@@ -2048,6 +2055,20 @@
     }
     if (is_group(L, 1)) {
         return newPolist(L);
+    } else if (is_table(L, 1)) {
+        bool coordinates = true;
+        if (lua_objlen(L, -1) == 0)  // empty table as empty po list
+            coordinates = false;
+        else {
+            lua_rawgeti(L, 1, 1);   // examine first element
+            if (is_position(L, -1))
+                coordinates = false;
+            lua_pop(L, 1);
+        }
+        if (coordinates)
+            return newPosition(L);
+        else
+            return newPolist(L);
     } else
         return newPosition(L);
 }



From ral at mail.berlios.de  Fri Aug 28 01:09:24 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 28 Aug 2009 01:09:24 +0200
Subject: [Enigma-game-svn] r1787 - in trunk: data/schemas src/floors
	src/items
Message-ID: <200908272309.n7RN9OMV013168@sheep.berlios.de>

Author: ral
Date: 2009-08-28 01:09:11 +0200 (Fri, 28 Aug 2009)
New Revision: 1787

Modified:
   trunk/data/schemas/objects.xml
   trunk/src/floors/StandardFloors.cc
   trunk/src/floors/StandardFloors.hh
   trunk/src/items/Vortex.cc
Log:
Trunk 1.1:
- StandardFloors: block external state access
- vortex: new attribute "autoopen":
  - opens closed vortex when actor enters grid
  - reopens an autoclosed vortex when actor leaves vortex


Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2009-08-27 22:09:16 UTC (rev 1786)
+++ trunk/data/schemas/objects.xml	2009-08-27 23:09:11 UTC (rev 1787)
@@ -8,6 +8,7 @@
     <attr name="anchor2" type="tokens" default="nil" rw="rw"/>
     <attr name="attacknearest" type="bool" default="false" rw="rw"/>
     <attr name="autoclose" type="bool" default="false" rw="rw"/>
+    <attr name="autoopen" type="bool" default="false" rw="rw"/>
     <attr name="basename" type="string" default="nil" rw="r"/>
     <attr name="breakable" type="bool" default="false" rw="rw"/>
     <attr name="burnable" type="bool" default="nil" rw="rw"/>
@@ -1205,6 +1206,7 @@
     <object name="it_vortex">
       <attr name="destination"/>
       <attr name="autoclose"/>
+      <attr name="autoopen"/>
       <attr name="scissor" default="true"/>
       <msg name="open"/>
       <msg name="close"/>

Modified: trunk/src/floors/StandardFloors.cc
===================================================================
--- trunk/src/floors/StandardFloors.cc	2009-08-27 22:09:16 UTC (rev 1786)
+++ trunk/src/floors/StandardFloors.cc	2009-08-27 23:09:11 UTC (rev 1787)
@@ -105,6 +105,14 @@
         return StandardFloorNames[state].classname;
     }
     
+    int StandardFloor::externalState() const {
+        return 0;   // no external states
+    }
+    
+    void StandardFloor::setState(int extState) {
+        // no external states
+    }
+    
     void StandardFloor::init_model()  {
         bool isFramed = (getAttr("faces").to_string() == "nesw");
         set_model((StandardFloorNames[state].submodel.length() > 0 ? StandardFloorNames[state].submodel :

Modified: trunk/src/floors/StandardFloors.hh
===================================================================
--- trunk/src/floors/StandardFloors.hh	2009-08-27 22:09:16 UTC (rev 1786)
+++ trunk/src/floors/StandardFloors.hh	2009-08-27 23:09:11 UTC (rev 1787)
@@ -32,6 +32,10 @@
         // Object interface
         virtual std::string getClass() const;
 
+        // StateObject interface
+        virtual int externalState() const;
+        virtual void setState(int extState);
+
         // GridObject interface
         virtual void init_model();
     };

Modified: trunk/src/items/Vortex.cc
===================================================================
--- trunk/src/items/Vortex.cc	2009-08-27 22:09:16 UTC (rev 1786)
+++ trunk/src/items/Vortex.cc	2009-08-27 23:09:11 UTC (rev 1787)
@@ -139,6 +139,9 @@
     bool Vortex::actor_hit(Actor *actor) {
         if (state == OPEN && (length((actor->get_pos()) - get_pos().center()) < 0.25) && actor->can_be_warped())
             prepare_for_warp(actor);
+        else if (state == CLOSED && (length((actor->get_pos()) - get_pos().center()) > 0.25) && 
+                getAttr("autoopen").to_bool())
+            toggleState();
         return false;
     }
     



From ral at mail.berlios.de  Sat Aug 29 01:18:54 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 29 Aug 2009 01:18:54 +0200
Subject: [Enigma-game-svn] r1788 - trunk/src
Message-ID: <200908282318.n7SNIsav014918@sheep.berlios.de>

Author: ral
Date: 2009-08-29 01:18:52 +0200 (Sat, 29 Aug 2009)
New Revision: 1788

Modified:
   trunk/src/MusicManager.cc
   trunk/src/MusicManager.hh
   trunk/src/SoundEngine.cc
   trunk/src/SoundEngine.hh
   trunk/src/server.cc
Log:
Trunk 1.1:
- speed up level load by 0.5 seconds for all large levels by fading out
    menu music parallel to loading of level


Modified: trunk/src/MusicManager.cc
===================================================================
--- trunk/src/MusicManager.cc	2009-08-27 23:09:11 UTC (rev 1787)
+++ trunk/src/MusicManager.cc	2009-08-28 23:18:52 UTC (rev 1788)
@@ -32,7 +32,6 @@
 using namespace enigma;
 using namespace sound;
 
-
 /* -------------------- Interface Functions -------------------- */
 
 bool sound::StartMenuMusic()
@@ -43,10 +42,12 @@
     }
 }
 
-bool sound::StartLevelMusic()
+bool sound::StartLevelMusic(bool blocking)
 {
     if(MusicManager::instance()->getMusicContext() != MUSIC_GAME) {
-        sound::FadeoutMusic();
+        sound::FadeoutMusic(blocking);
+        if (!blocking)
+            return true;
         MusicManager::instance()->setMusicContext(MUSIC_GAME);
     }
 }

Modified: trunk/src/MusicManager.hh
===================================================================
--- trunk/src/MusicManager.hh	2009-08-27 23:09:11 UTC (rev 1787)
+++ trunk/src/MusicManager.hh	2009-08-28 23:18:52 UTC (rev 1788)
@@ -34,7 +34,7 @@
     void DefineMusicSingle(std::string title, std::string filename);
 
     bool StartMenuMusic();
-    bool StartLevelMusic();
+    bool StartLevelMusic(bool blocking =true);
     void MusicTick(double dtime);
     void InitMusic();
     void SetInGameMusicActive(bool active);

Modified: trunk/src/SoundEngine.cc
===================================================================
--- trunk/src/SoundEngine.cc	2009-08-27 23:09:11 UTC (rev 1787)
+++ trunk/src/SoundEngine.cc	2009-08-28 23:18:52 UTC (rev 1788)
@@ -31,7 +31,6 @@
 using namespace enigma;
 using namespace sound;
 
-
 /* -------------------- Local variables -------------------- */
 namespace
 {
@@ -44,7 +43,6 @@
     bool music_mute         = false;
 }
 
-
 /* -------------------- Interface Functions -------------------- */
 
 void sound::Init() 
@@ -162,9 +160,9 @@
     sound_engine->cache_sound(s);
 }
 
-void sound::FadeoutMusic() 
+void sound::FadeoutMusic(bool blocking) 
 {
-    sound_engine->fadeout_music();
+    sound_engine->fadeout_music(blocking);
 }
 
 bool sound::PlayMusic (const std::string &name, double position) 
@@ -202,7 +200,6 @@
     sound::SetMusicVolume(options::GetDouble("MusicVolume"));
 }
 
-
 /* -------------------- SoundEngine_SDL implementation -------------------- */
 
 SoundEngine::SoundEngine()
@@ -336,13 +333,18 @@
     return false;
 }
 
-void SoundEngine_SDL::fadeout_music()
+void SoundEngine_SDL::fadeout_music(bool blocking)
 {
-    while (Mix_FadingMusic() != MIX_NO_FADING)
+    while (Mix_FadingMusic() != MIX_NO_FADING) {
+        if (!blocking)
+            return;
         SDL_Delay(10);
+    }
 
     if (Mix_PlayingMusic()) {
         Mix_FadeOutMusic(500);
+        if (!blocking)
+            return;
         SDL_Delay(400);
     }
     while (Mix_PlayingMusic())

Modified: trunk/src/SoundEngine.hh
===================================================================
--- trunk/src/SoundEngine.hh	2009-08-27 23:09:11 UTC (rev 1787)
+++ trunk/src/SoundEngine.hh	2009-08-28 23:18:52 UTC (rev 1788)
@@ -45,7 +45,7 @@
     void EnableSound();
     void DisableMusic();
     bool PlayMusic(const std::string &name, double position = 0.0);
-    void FadeoutMusic();
+    void FadeoutMusic(bool blocking =true);
 
     /*! Stop any music currently playing. */
     void StopMusic();
@@ -89,7 +89,7 @@
 
         virtual bool play_music(const std::string &filename, double position) = 0;
         virtual void stop_music() = 0;
-        virtual void fadeout_music() = 0;
+        virtual void fadeout_music(bool blocking =true) = 0;
         virtual bool is_music_playing() = 0;
         
         // ---------- Sound effects ----------
@@ -113,7 +113,7 @@
         void set_music_volume(double /*musicvol*/) {}
         bool play_music (const std::string &/*filename*/, double /*position*/) { return false; }
         void stop_music() {}
-        void fadeout_music() {}
+        void fadeout_music(bool blocking =true) {}
         bool is_music_playing() { return false; }
         void clear_cache() {}
         void define_sound (const SoundName &, const SoundData &) {}
@@ -136,7 +136,7 @@
         void set_music_volume(double musicvol);
         bool play_music (const std::string &filename, double position);
         void stop_music();
-        void fadeout_music();
+        void fadeout_music(bool blocking =true);
         bool is_music_playing();
         void clear_cache();
         void define_sound (const SoundName &, const SoundData &);

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2009-08-27 23:09:11 UTC (rev 1787)
+++ trunk/src/server.cc	2009-08-28 23:18:52 UTC (rev 1788)
@@ -33,6 +33,7 @@
 #include "player.hh"
 #include "StateManager.hh"
 #include "world.hh"
+#include "MusicManager.hh"
 
 #include "enet/enet.h"
 
@@ -150,6 +151,10 @@
 void load_level(lev::Proxy *levelProxy, bool isRestart)
 {
     try {
+    Uint32 start_tick_time = SDL_GetTicks();   // meassure time for level loading
+        if (!CreatingPreview)
+            sound::StartLevelMusic(false);
+            
         server::LoadedProxy = levelProxy;
         server::PrepareLevel();
         IsLevelRestart = isRestart;
@@ -166,6 +171,8 @@
                 player::LevelLoaded(isRestart);
                 client::Msg_LevelLoaded(isRestart);
         }
+        double exectime = (SDL_GetTicks() - start_tick_time)/1000.0;
+        Log << ecl::strf("Server load level did take %g seconds\n", exectime);
     }
     catch (XLevelLoading &err) {
         std::string levelPathString = 



From ral at mail.berlios.de  Sat Aug 29 21:18:46 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sat, 29 Aug 2009 21:18:46 +0200
Subject: [Enigma-game-svn] r1789 - in trunk: data/levels/enigma_cross
	data/levels/enigma_viii data/levels/lib doc/reference
Message-ID: <200908291918.n7TJIk8s011351@sheep.berlios.de>

Author: ral
Date: 2009-08-29 21:18:36 +0200 (Sat, 29 Aug 2009)
New Revision: 1789

Modified:
   trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
   trunk/data/levels/enigma_viii/cel2_1.xml
   trunk/data/levels/enigma_viii/index.xml
   trunk/data/levels/enigma_viii/ral21_2.xml
   trunk/data/levels/lib/libpento_1.xml
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk 1.1:
- libpento: report false sized target areas by assertions
- fix levels Tutoxyd, Pentachomos on false floor attribute usage
- refman: updates on
  - vortex autoopen
  - polist initialization by position tables

Modified: trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2009-08-28 23:18:52 UTC (rev 1788)
+++ trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2009-08-29 19:18:36 UTC (rev 1789)
@@ -119,7 +119,7 @@
     <level _seq="111" _title=" - Meditation - " _xpath="enigma_viii/devnull07_1" author="/dev/null" ctrl="force" easy="true" id="devnull07" rel="1" rev="8" score="1" target="time" unit="duration"/>
     <level _seq="112" _title="Relaxing at the sea" _xpath="enigma_viii/devnull08_1" author="/dev/null" ctrl="force" easy="true" id="devnull08" rel="1" rev="23" score="1" target="time" unit="duration"/>
     <level _seq="113" _title="Helios II" _xpath="enigma_viii/mecke08_1" author="mecke" ctrl="force" easy="true" id="mecke08" rel="1" rev="26" score="1" target="time" unit="duration"/>
-    <level _seq="114" _title="Tutoxyd's Pyramid" _xpath="enigma_viii/ral21_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070822ral291" rel="2" rev="173" score="2" target="time" unit="duration"/>
+    <level _seq="114" _title="Tutoxyd's Pyramid" _xpath="enigma_viii/ral21_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070822ral291" rel="2" rev="180" score="2" target="time" unit="duration"/>
     <level _seq="115" _title="Alternation I" _xpath="enigma_viii/mecke17_1" author="mecke" ctrl="force" easy="false" id="mecke17" rel="1" rev="14" score="1" target="time" unit="duration"/>
     <level _seq="116" _title="Enigmaparcour II" _xpath="enigma_viii/mecke29_1" author="mecke" ctrl="force" easy="true" id="mecke29" rel="1" rev="17" score="1" target="time" unit="duration"/>
     <level _seq="117" _title="- Meditation -" _xpath="enigma_viii/devnull04_1" author="/dev/null" ctrl="force" easy="true" id="devnull04" rel="1" rev="10" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_viii/cel2_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/cel2_1.xml	2009-08-28 23:18:52 UTC (rev 1788)
+++ trunk/data/levels/enigma_viii/cel2_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
@@ -71,8 +71,8 @@
 ti["rf"] = {"fl_lawn"} .. ti({"it_floppy"})
 ti["rF"] = {"fl_lawn"} .. ti({"st_floppy", target="ral_fdoor", action="toggle"})
 ti["rG"] = ti["r "] .. {"st_door_d_ew", name="ral_fdoor"}
-ti["rj"] = {"fl_lawn", friction=6.0, type="x"} .. ti({"it_key", code=1})
-ti["rK"] = {"fl_lawn", friction=6.0, type="x"} .. ti({"it_key", code=4})
+ti["rj"] = {"fl_lawn", friction=6.0} .. ti({"it_key", code=1})
+ti["rK"] = {"fl_lawn", friction=6.0} .. ti({"it_key", code=4})
 ti["r-"] = ti["r "] .. {"st_switch", target="vortexRale"}
 
 -- Dominik Lehmann

Modified: trunk/data/levels/enigma_viii/index.xml
===================================================================
--- trunk/data/levels/enigma_viii/index.xml	2009-08-28 23:18:52 UTC (rev 1788)
+++ trunk/data/levels/enigma_viii/index.xml	2009-08-29 19:18:36 UTC (rev 1789)
@@ -43,7 +43,7 @@
     <level _seq="35" _title="- Meditation -" _xpath="./raoul31_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul31" rel="1" rev="8" score="1" target="time" unit="duration"/>
     <level _seq="36" _title="Relaxing at the sea" _xpath="./devnull08_1" author="/dev/null" ctrl="force" easy="true" id="devnull08" rel="1" rev="23" score="1" target="time" unit="duration"/>
     <level _seq="37" _title="Helios II" _xpath="./mecke08_1" author="mecke" ctrl="force" easy="true" id="mecke08" rel="1" rev="26" score="1" target="time" unit="duration"/>
-    <level _seq="38" _title="Tutoxyd's Pyramid" _xpath="./ral21_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070822ral291" rel="2" rev="173" score="2" target="time" unit="duration"/>
+    <level _seq="38" _title="Tutoxyd's Pyramid" _xpath="./ral21_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070822ral291" rel="2" rev="180" score="2" target="time" unit="duration"/>
     <level _seq="39" _title="Alternation I" _xpath="./mecke17_1" author="mecke" ctrl="force" easy="false" id="mecke17" rel="1" rev="14" score="1" target="time" unit="duration"/>
     <level _seq="40" _title="Enigmaparcour II" _xpath="./mecke29_1" author="mecke" ctrl="force" easy="true" id="mecke29" rel="1" rev="17" score="1" target="time" unit="duration"/>
     <level _seq="41" _title=" - Meditation - " _xpath="./devnull07_1" author="/dev/null" ctrl="force" easy="true" id="devnull07" rel="1" rev="8" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_viii/ral21_2.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral21_2.xml	2009-08-28 23:18:52 UTC (rev 1788)
+++ trunk/data/levels/enigma_viii/ral21_2.xml	2009-08-29 19:18:36 UTC (rev 1789)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Tutoxyd's Pyramid" el:subtitle="Marble Jones I" el:id="20070822ral291"/>
-      <el:version el:score="2" el:release="2" el:revision="$Revision: 173 $" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="$Revision: 180 $" el:status="stable"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2007,2008,2009 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -35,7 +35,7 @@
 ti["LZ"] = {"fl_gravel", "sunlight1"}
 ti["LY"] = {"fl_gravel", "sunlight2"}
 ti["RZ"] = {"fl_gravel", "ringroom"}
-ti[";;"] = {"fl_dunes", friction=6, mousefactor=2}
+ti[";;"] = {"fl_dunes", friction=6, adhesion=2}
 ti["''"] = {"fl_sahara"}
 ti["%%"] = {"fl_samba"}
 ti["%."] = {"fl_samba", "volcan#", secure=true}

Modified: trunk/data/levels/lib/libpento_1.xml
===================================================================
--- trunk/data/levels/lib/libpento_1.xml	2009-08-28 23:18:52 UTC (rev 1788)
+++ trunk/data/levels/lib/libpento_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
@@ -40,7 +40,7 @@
         end
     end
     context.target_area = no["target#*"]
-    assert_bool(#context.target_area == 60, "Pentomino target area not 60 grids.", 2)
+    local dummy = (assert_bool)(#context.target_area == 60, "Pentomino target area not 60 grids.", 2)
 
     context.last_shape = 12
     

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-08-28 23:18:52 UTC (rev 1788)
+++ trunk/doc/reference/enigma-ref.texi	2009-08-29 19:18:36 UTC (rev 1789)
@@ -6654,6 +6654,23 @@
 @example
 @var{newpolist} = @i{po}(@i{po}(@var{2}, at var{3}), @i{po}(@var{5}, at var{7})) .. @i{po}(@var{4}, @var{4}) -- = (2,3),(5,7),(4,4)
 @end example
+
+ at item @b{Caveats:}
+Note that due to the value nature of position lists the concatenation creates
+a new value. This is an expensive operation. When you are collecting potentially
+large number of positions in a loop, you should not concat each new candidate
+to an existing position list. Avoid the creation of numerous position list 
+values and collect the positions in a standard Lua table. Convert this table
+at the end to a position list (@xref{PositionList Conversion}).
+
+ at example
+ at var{result} = @{@}
+for @var{x} = 1, 200 do
+    table.insert(@var{result}, @i{po}(@var{x}, 17))
+end
+return @i{po}(@var{result})
+ at end example
+
 @end table
 
 @c ----------------- PositionList Translation --------------------
@@ -6809,15 +6826,17 @@
 
 @table @asis
 @item @b{Syntax:}
-result = po(@i{group})
+result = po(@i{group} | @{@i{pos1}, @i{pos2}, @i{pos3}@})
 
 @item @b{Details:}
-Converts the given group to a new @ref{PositionList} value, that contains
-the positions of all valid group @ref{Object}s in the same sequence.
+Converts the given group or table of positions to a new @ref{PositionList}
+value, that contains the positions of all valid group @ref{Object}s or table
+members in the same sequence.
 
 @item @b{Syntax Samples:}
 @example
 @var{polist} = @i{po}(@var{group})
+ at var{polist} = @i{po}(@{@i{po}(@var{3}, @var{7}), @i{po}(@var{2}, @var{6})@})
 @end example
 @end table
 
@@ -13909,7 +13928,13 @@
 Vortices can be @samp{OPEN} or @samp{CLOSED}. Of course an actor can enter just
 an open vortex. Closed vortices at the destination are opened automatically.
 By default such vortices remain open. By usage of the attribute @samp{autoclose}
-you can configure a vortex to close after an actor has been emitted.
+you can configure a vortex to close after an actor has been emitted. This helps
+the user to leave the vortex by keeping the marble from being reinserted into 
+the vortex. Of course an autoclose disables the user to return, too. If this
+is not your intention you set additionally the attribute @samp{autoopen} to
+ at code{true}. The vortex will reopen again when the marble leaves the closed
+vortex. If the user did directly jump out of the vortex, it will reopen when
+the user enters the vortex grid again.
 
 Actors are emitted by vortices in a jumping fashion. The user can accelerate
 the actor for a short period and the actor may jump out of a vortex into the
@@ -13944,6 +13969,10 @@
 @item @b{autoclose}, @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 Flag that indicates whether the vortex should be closed after a teleport.
 
+ at item @b{autoopen}, @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+Flag that indicates whether the vortex should open when an actor enters the grid
+or leaves the vortex.
+
 @item @b{scissor}, @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{true}
 Rubberband cutting behaviour on teleporting.
 @item @b{freezable}, @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}; @ @ @i{access}: @code{read only} @ @ @xref{freezable}



