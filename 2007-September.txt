From andreasl at mail.berlios.de  Sat Sep  1 01:35:42 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Sat, 1 Sep 2007 01:35:42 +0200
Subject: [Enigma-game-svn] r852 - trunk/doc/reference
Message-ID: <200708312335.l7VNZgZ4013121@sheep.berlios.de>

Author: andreasl
Date: 2007-09-01 01:35:40 +0200 (Sat, 01 Sep 2007)
New Revision: 852

Modified:
   trunk/doc/reference/enigma-ref.texi
Log:
Reference Manual:
 - Added Linda's corrections.
   (Refman now switched from mixed AE/BE to AE.)


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2007-08-30 23:27:56 UTC (rev 851)
+++ trunk/doc/reference/enigma-ref.texi	2007-08-31 23:35:40 UTC (rev 852)
@@ -18,9 +18,8 @@
 @top
 
 This manual describes the internals of
- at uref{http://www.nongnu.org/enigma/,Enigma}, in particular how to
+ at uref{http://www.nongnu.org/enigma/,Enigma} version 1.00, in particular how to
 build new levels using Lua and how to interact with the game engine.
-It describes Enigma version 1.00.
 @end ifnottex
 
 @menu
@@ -37,13 +36,13 @@
 @node  Running Enigma, Level Basics, Top, Top
 @chapter Running Enigma
 
-After a hopefully succesfull installation and some first levels you may be 
-interested in some information how Enigma is configured, how you can optimize
-Enigma to your demands and what some options and attributes within Enigma are for.
+Hopefully, after successfully installing and playing some first levels, you may be interested in
+some information about how we have configured Enigma, how you can optimize Enigma to your
+needs, and the purpose of some options and attributes within Enigma.
 
-This first chapter should give you some valuable information to these questions
-and provides some basic knowledge you will need to know to manage level packs,
-levels or write own levels as described in the following chapters.
+This first chapter should give you some valuable information about these questions, and provide
+some basic knowledge you will need to manage level packs, levels or write your own levels, as
+described in the following chapters.
 
 @menu
 * Locating Resources::
@@ -57,81 +56,79 @@
 @node Locating Resources, Startup Switches, Running Enigma, Running Enigma
 @section Locating Resources
 
-For reasons of backup, system changes, special configurations, level additions
-and hopefully own new levels you may need to know where Enigma stores the 
-resources and how you can control them.
+For reasons of backup, system changes, special configurations, level additions and hopefully
+your own new levels, you may need to know where Enigma stores the resources and how you
+can control them.
 
 Enigma maintains several paths for control of load and storage of files. You
-can list these paths either by pressing @key{F2} within the main menu or by 
-starting Enigma with the switch @option{--log} (@pxref{Startup Switches}) and looking at the console output.
+can list these paths either by pressing @key{F2} within the main menu, or by 
+starting Enigma with the switch @option{--log} (@pxref{Startup Switches}) and looking at the
+console output.
 
 @table @asis
 @cindex preferences path
 @item @b{Preferences Path}
 This is the path to the file that stores your preferences concerning application
 options. This file is usually located at your @env{HOME} directory. For @env{HOME}-less
-Windows users it is stored in the @samp{Application Data\Enigma} directory. As
-it is the third version in the history of Enigma the file is named 
+Windows users, it is stored in the @samp{Application Data\Enigma} directory. Since it is the
+third version in the history of Enigma, the file is named 
 @samp{.enigmarc.xml} by default. 
 
-It is recommended to backup this file, even though it contains only few data that
-can be quickly reconfigured.
+We recommend that you backup this file, although it contains only a few data that you can
+quickly reconfigure.
 
-As these preferences are quite specific for the operating system and 
-configuration you will use a different version on each Enigma installation you
-have.
+Since these preferences are quite specific for the operating system and configuration, you will
+use a different version on each Enigma installation you have.
 
-Mainly for Enigma developers exists a switch @option{--pref} (@pxref{Startup Switches})
+Mainly for Enigma developers, a switch exists @option{--pref} (@pxref{Startup Switches})
 to rename this preferences file. By starting Enigma with a renamed preferences
-file a developer can temporarily use a complete seperated configuration for
+file, a developer can temporarily use a complete separate configuration for
 testing purposes without the danger of destroying his main configuration. The
 developer may use it to start Enigma with a plain standard configuration for
 testing purposes, too.
 
-In all cases the preferences filename will be hidden by a leading @samp{.} in the
-filename.
+In all cases, a leading @samp{.} will hide the preferences filename.
 
 @cindex user path
 @item @b{User Path}
-This is the main path to the users Enigma data. All updates, user installed
-levels and user written levels, the users scores, history and usually the
-users screenshots and level previews are stored at this path.
+This is the main path to the user's Enigma data. All updates, user-installed levels and user-
+written levels, the user's scores, history and usually the user's screenshots and level previews,
+are stored at this path.
 
 A backup of this directory is mandatory!
 
 The standard location is the directory @samp{.enigma} at your @env{HOME} 
-directory. For @env{HOME}-less Windows users it is the @samp{Application Data\Enigma} 
+directory. For @env{HOME}-less Windows users, it is the @samp{Application Data\Enigma} 
 directory.
 
-You can define an own path within the @ref{User Options}. By this means you
-can store your Enigma user data on a memory stick or you can store them on
-a shared partition and use them alternatively from two Enigma installations.
+You can define your own path within the @ref{User Options}. By doing so, you can store your
+Enigma user data on a memory stick or on a shared partition, and use them alternatively from
+two Enigma installations.
 
 @cindex user image path
 @item @b{User Image Path}
-This is a second path to the users Enigma data that is used to access images
-like screenshots and thumbnails of levels. Usually this path is identical to 
-the main @samp{User Path}.
+This is a second path to the user's Enigma data, which you can use to access images such as
+screenshots and thumbnails of levels. Usually this path is identical to the main @samp{User
+Path}.
 
 Just in case you make many screenshots and have limited resources on the main
- at samp{User Path} you may want to store the images on another path. You can 
-define an own path within the @ref{User Options}.
+ at samp{User Path}, you may want to store the images on another path. You can 
+define your own path within the @ref{User Options}.
 
 @cindex system path
 @item @b{System Path}
-This path gives you the location of all system resources that are distributed
-with Enigma. Here you will find the levels, libraries, etc. A first class 
-address to look for examples if you start writing own levels.
+This path gives you the location of all system resources that are distributed with Enigma. Here
+you will find the levels, libraries, etc. This is a first class address to look for examples if you start
+writing your own levels.
 
 @cindex resource paths
 @item @b{Resource Paths}
-This is a list of paths. Every version independent resource is looked up on all 
-paths in this list and loaded from the first occurence.
+This is a list of paths. The program looks up each version-independent resource on all paths in
+this list, and loads from the first occurrence.
 
-User data preceed system data. This way updates on your user data path will win.
-Have a look at this list if you are observe difference between a source and the
-runtime behaviour. You may have looked at a file that was hidden by another on
-a preceeding path in this list.
+User data precedes system data; this way, updates on your user data path will win. Have a look
+at this list if you are observing a difference between a source and the runtime behavior. You may
+have looked at a file that another file had hidden on a preceding path in this list.
 
 @cindex l10n path
 @cindex localization path
@@ -140,25 +137,24 @@
 
 @end table
 
-Please note that some resources like levels may be zipped. In this case a 
-resource that you expect at @samp{dirname/filename} may be stored in a zipfile
+Please note that some resources, like levels, may be zipped. In this case, a 
+resource that you expect to find at @samp{dirname/filename} may be stored in a zipfile
 named @samp{dirname.zip}. The path of the file within the zip can be either
 @samp{dirname/filename} or @samp{./filename}. In case a resource is provided
-in zipped and unzipped the plain file stored in a directory wins, as it is 
-assumed to be an update to the zip.
+in zipped and unzipped form, the plain file stored in a directory wins, since Enigma 
+assumes it to to be an update to the zip.
 
 @node Startup Switches, User Options, Locating Resources, Running Enigma
 @section Startup Switches
 
-Besides starting Enigma by clicking on a installation provided icon or start
-menu entry you can start enigma from a shell or commandline. With release 1.00
-the Windows version supports this feature without restrictions. Even though
-it is not necessary using this feature to play the distributed levels you may
-take advantage of this feature in special or advanced usage.
+Besides starting Enigma by clicking on an installation-provided icon or start menu entry, you
+can start Enigma from a shell or commandline. With release 1.00, the Windows version
+supports this feature without restrictions. Although playing the distributed levels using this
+feature is not necessary, you may take advantage of this feature in special or advanced usage.
 
-The following list explains the supported user options. If an option is listed
-with a long name preceeded by two minus signs and with a one character abbreviation
-preceeded by one minus sign use one of both notations not both together, f.e. 
+The following list explains the supported user options. If an option is listed with a long name
+preceded by two minus signs, and with a one-character abbreviation preceded by one minus
+sign, use one of the notations, not both together; for example,
 @samp{--data path} or @samp{-d path}.
 
 @table @asis
@@ -168,39 +164,39 @@
 @samp{ASSERT(noAssert || long_lasting_check(), XLevelRuntime, "remark");}.
 
 @item @b{- at w{}-data -d path}
-A switch for Enigma developers that allows to add an additional path to the
-resource paths that preceeds the system path (@pxref{Startup Switches}). A
-developer can test an Enigma compilation without installation by calling it
+A switch for Enigma developers that allows you to add an additional path to the
+resource paths that precedes the system path (@pxref{Startup Switches}). A
+developer can test an Enigma compilation, without installation, by calling it
 from the shell with the current working directory on the main directory via
 @samp{src/Enigma -d ./data}.
 
 @item @b{- at w{}-help -h}
-Just list the available startup switches to the output and terminate.
+Just lists the available startup switches to the output and terminate.
 
 @item @b{- at w{}-lang -l lang}
-A switch that allows to override any other language preference. The language
-is given in the common 2 character sequence as @samp{fr} for French or @samp{ru}
+A switch that allows you to override any other language preference. The language
+is given in the common 2-character sequence as @samp{fr} for French or @samp{ru}
 for Russian.
 
 @item @b{- at w{}-log}
 This switch turns on logging of internal information to the standard output.
 Windows users will find an file called @samp{stdout.txt} in the current working
-directory. The output will f.e. list the paths described in @ref{Locating Resources}.
+directory. The output will, for example, list the paths described in @ref{Locating Resources}.
 
 @item @b{- at w{}-nograb}
-A switch for Enigma developers that causes Enigma not to grab the mouse. Levels
-can hardly be played in this mode, but it makes it possible to debug the
+A switch for Enigma developers that causes Enigma not to grab the mouse. You can hardly
+play a level in this mode, but it makes it possible to debug the
 application in its core parts.
 
 @item @b{- at w{}-nomusic}
 Start Enigma without playing background music.
 
 @item @b{- at w{}-nosound}
-Start Enigma with sounds being switched off.
+Start Enigma with sound being switched off.
 
 @item @b{- at w{}-pref -p filename}
 The name of an alternative preferences file without the leading dot for hidden
-filenames. This switch is a pure Enigma developer support feature as described
+filenames. This switch is a pure Enigma developer support feature, as described
 in @ref{Locating Resources}.
 
 @item @b{- at w{}-pref -p dirpath}
@@ -213,7 +209,7 @@
 Remember that a path with spaces needs to be quoted.
 
 @item @b{- at w{}-showfps}
-Show the framerate (FPS) during the Game.
+Show the framerate (FPS) during the game.
 
 @item @b{- at w{}-version}
 Just print the version number to the output and terminate.
@@ -223,34 +219,33 @@
 
 @end table
 
-All further arguments supplied on the commandline are taken as level file
-addresses. You can use absolut or relative addresses to level files stored
-on your computer. It is also possible to add url's to levels stored in the
-internet.
+Enigma interprets all further arguments supplied on the commandline as level file
+addresses. You can use absolute or relative addresses to level files stored
+on your computer. Adding url's to levels stored in the internet is also possible.
 
 A Unix user may start Enigma with the following command:
 
 @code{enigma --log ~/mylevel.xml http://somewhere.com/netlevel.xml}
 
-A Windows user may start Enimga from the command line (please adjust the Enigma
+A Windows user may start Enigma from the command line (please adjust the Enigma
 installation path):
 
 @code{C:\programs\Enigma-1.00\enigma.exe demo_simple.xml} 
 
-You will find the levels in a levelpack called @samp{Startup Levels} that is
-by default only visible if you supplied levels on the commandline.
+You will find these levels in a levelpack called @samp{Startup Levels}, which is
+only visible by default if you supplied levels on the commandline.
 
 @node User Options, Level Info, Startup Switches, Running Enigma
 @section User Options
 
 @table @asis
 @item @b{Ratings update}
-Please keep this option on the value @samp{Never} until release of Enigma 1.00.
+Please retain this option on the value @samp{Never} until release of Enigma 1.00.
 
 @item @b{User name}
-Enter your user name that will be attached to the scores. Please have a look at
-the Enigma home page for user names already in use and choose a new unique name.
-It is possible to change the user name at any point of time without loosing any
+Enter your user name, which Enigma will attach to your scores. Please look at
+the Enigma home page for user names already in use and choose a new, unique name.
+You can change your user name at anytime without losing any of your
 scores.
 
 @item @b{User path}
@@ -259,11 +254,11 @@
 
 Deletion of the string resets the path to the default.
 
-The new path is activated on leaving the options menu. Even though all files
-are stored directly to the new path and files will still be found on the old
-path you may want to quit Enigma immediatly and first copy/merge the old 
-directory to the new location. This copy of your old data is necessary as with
-the next start Enigma will locate user data at the new location exclusively. 
+Enigma activates the new path when you leave the options menu. Though it stores all files
+directly to the new path, and will still find files on the old path, you may want to quit Enigma
+immediately and first copy/merge the old directory to the new location. This copy of your old
+data is necessary, since with the next start, Enigma will locate user data at the new location
+exclusively. 
 
 @item @b{User image path}
 This textfield allows you to define an arbitrary directory for your Enigma user
@@ -271,11 +266,11 @@
 
 Deletion of the string resets the path to the default.
 
-The new path is activated on leaving the options menu. Even though all files
-are stored directly to the new path and files will still be found on the old
-path you may want to quit Enigma immediatly and first copy/merge the old 
-directory to the new location. This copy of your old data is necessary as with
-the next start Enigma will locate user data at the new location exclusively. 
+Enigma activates the new path when you leave the options menu. Though it has stored all files
+directly to the new path and files will still be found on the old path, you may want to quit
+Enigma immediately and first copy/merge the old directory to the new location. This copy of
+your old data is necessary, since with the next start, Enigma will locate user data at the new
+location exclusively.
 
 @end table
 
@@ -283,22 +278,20 @@
 @section Level Info
 
 @cindex levelinspector
-For every level Enigma manages more data than can be displayed in the level
-menu. You can view them all with the levelinspector. This special menu can 
-be called from within the level menu by right or control clicking on the
-level icon.
+For every level, Enigma manages more data than can be displayed in the level menu. You can
+view them all with the levelinspector. You can call this special menu from within the level menu
+by right or control clicking on the level icon.
 
-Besides title and author information is provided concerning a public rating of
-the level, different score values of interest, details on the level version,
-the level file location and more. Additionally the levelinspector allows you
-to enter personal annotations for a level. Any screenshots you made for this
-level can be directly reviewed from the levelinspector, too.
+Besides title and author, Enigma provides information concerning a public rating of the level,
+different score values of interest, details on the level version, the level file location and more.
+Additionally, the levelinspector allows you to enter personal annotations for a level. You can
+review any screenshots you made for this level directly from the levelinspector, too.
 
 @menu
 * Public Ratings::
 * Scores::
 * Versions::
-* Privat Annotations and Ratings::
+* Private Annotations and Ratings::
 * Screenshots::
 @end menu
 
@@ -324,31 +317,28 @@
 
 @end itemize
 
-To distinguish the ratings from their everyday-meanings, we use the
-abbreviations for the ratings. Each of these categories takes values
-between 1 (easy) and 5 (difficult), except for kno, which can also be
-6 (unique mechanism).
+To distinguish the ratings from their everyday-meanings, we use the following abbreviations for
+the ratings. Each of these categories takes values between 1 (easy) and 5 (difficult), except kno,
+which can also be 6 (unique mechanism).
 
-Please bear in mind that it's not very simple to hold on to the
-following definitions in each single of nearly 750 cases, so there
-might be (will be) derivations from them in single levels.
+Please bear in mind that it's not simple to retain the
+following definitions in each of nearly 750 cases, so there
+might be (will be) deviations from them in single levels.
 
 @strong{Intelligence (int)}
 
-This is intended to measure the creativity, planning and analytic
-requirements needed to solve the level. Intelligence is a very
-difficult notion in itself, and thus at first not easy to
-rate nor to grasp. Consequently, a fixed definition of the five
-rating-degrees does not only help in the rating process, but is
-essential. So, assume you know everything about the single elements of
-a level. Then ask yourself these questions:
+This rating is intended to measure the creativity, planning and analytic requirements needed to
+solve the level. Intelligence is a very difficult concept in itself, and thus at first not easy to rate or
+to grasp. Consequently, a fixed definition of the five rating-degrees not only helps, but is
+essential in the rating process. So, assume you know everything about the single elements of a
+level. Then ask yourself these questions:
 @itemize @bullet
 @item
 Can I see the solution at once? Yes -> int 1
 
 @item
-Do I only have to orient myself, like testing the exits of wormholes
-or see the function of a switch? -> int 2
+Do I only have to orient myself, for example, testing the exits of wormholes or to see the
+function of a switch? -> int 2
 
 @item
 Is there a standard algorithm to solve the problem, like in a maze, or
@@ -356,25 +346,23 @@
 
 @item
 Neither trial-and-error nor standard algorithms work; is it a simple
-kind of code or advanced planning? -> int 4
+kind of code or does it require advance planning? -> int 4
 
 @item
-A difficult code, pattern or causal chain? -> int 5
+Is it a difficult code, pattern or causal chain? -> int 5
 
 @end itemize
 
 High values for intelligence are typically puzzles.
 int-ratings do not accumulate; the most difficult puzzle
-alone already determines the rating.
+itself already determines the rating.
 
 @strong{Dexterity (dex)}
 
-There are lots of levels, which can be solved either by accuracy or by
-patience. In our context, dexterity is not meant in the sense of
-accuracy to avoid patience, but accuracy to avoid death. So it focuses
-on the lethal positions in a level, not only death-stones and abysses,
-but also casualties like pushing a stone accidentally into an
-unreachable corner.
+You can solve many levels either by accuracy or by patience. In our context, we do not mean
+dexterity in the sense of accuracy to avoid impatience, but accuracy to avoid death. So it focuses
+on the lethal positions in a level, not only death-stones and abysses, but also casualties like
+pushing a stone accidentally into an unreachable corner.
 
 @itemize @bullet
 @item
@@ -385,10 +373,10 @@
 they are not difficult to overcome. -> dex 2
 
 @item
-Comparable with a single row with abyss left and right. -> dex 3
+Comparable to a single row with an abyss left and right. -> dex 3
 
 @item
-Comparable with pushing a stone to the right while there is abyss on
+Comparable to pushing a stone to the right with an abyss on
 the left, or a single row with death-stones left and right. ->
 dex 4
 
@@ -397,47 +385,44 @@
 
 @end itemize
 
-In contrast to the int-rating, dex might accumulate: Many situations,
-each of dex 3 can add up to dex 4 or even 5. This way dex 5 can be
-achieved. Rotors in a level contribute as well to dex as to the
-speed-rating spe. Thus, levels with a high dex-spe-combination are
+In contrast to the int-rating, dex might accumulate: A level with many situations,
+each of dex 3, can add up to dex 4 or even 5. This way, you can achieve dex 5.  
+Rotors in a level also contribute to dex and to the
+speed-rating, spe. Thus, levels with a high dex-spe-combination are
 mostly action-driven, whereas a high dex-pat-combination typically is
 a dangerous maze.
 
 @strong{Patience (pat)}
 
-Patience is a relatively subjective rating, and refers much to
-''feeled time''. So two levels with same mechanics can have
-different pat-values, e.g. if one level has a nicer design or shows
-the progress of the level in some way, like the number of opened
-oxyds. It explicitly includes having to start the level over and over
-again; not the time in the lower left corner or the score is crucial,
-but the complete feeled time needed to solve the level, starting from
-the first look at it.
+Patience is a relatively subjective rating, and refers mostly to ``felt time'', how long it felt to
+complete the level. So two levels with same mechanics can have different pat-values, e.g., if one
+level has a nicer design or shows the progress of the level in some way, like the number of
+opened oxyds. It explicitly includes having to restart the level repeatedly; not the time in the
+lower left corner or the score is crucial, but the complete ``felt time'' needed to solve the level,
+starting from the first look at it.
 @itemize @bullet
 @item
 I solved the level right after understanding it. -> pat 1
 
 @item
-I needed some time but is wasn't boring. -> pat 2
+I needed some time, but it wasn't boring. -> pat 2
 
 @item
-Okay, some minutes. But the landscape is nice @enddots{} -> pat 3
+Okay, it took some minutes, but the landscape is nice @enddots{} -> pat 3
 
 @item
 I know what to do, but it doesn't seem to end. -> pat 4
 
 @item
-This level really needs discipline. -> pat 5
+This level really requires discipline. -> pat 5
 
 @end itemize
 
-A high number of oxyds can as well heighten the pat-value as lower it:
-If the player has to traverse the level several times to open matching
-pairs of oxyds, it is definitely pat-heightening. However, if they are
-arranged to mark the progress of the player, and deal as a kind of
-small rewards within the level, they can lower the pat-value. The same
-with a high number of doors: The arrangement is the critical factor.
+A high number of oxyds can heighten the pat-value and also lower it: If the player has to
+traverse the level several times to open matching pairs of oxyds, it is definitely pat-heightening.
+However, if oxyds are arranged to mark the progress of the player, and act as a kind of small
+reward within the level, they can lower the pat-value. It's the same with a high number of doors:
+The arrangement is the critical factor.
 
 High pat-values are typically mazes. In combination with int 3, a high
 pat-value can indicate a hidden item or a hollow stone. pat-values
@@ -447,24 +432,24 @@
 
 The kno-rating mostly takes on the function and interactions of single
 objects in the game, like stones, floors, items, and actors. However,
-in some cases it also deals with special techniques. The guide line is
+in some cases it also deals with special techniques. The guideline is
 the ``Advanced Tutorial'', which defines kno 3. kno 4 corresponds to
-standard objects that aren't shown in the tutorial, kno 5 requires a
+standard objects that aren't shown in the tutorial; kno 5 requires a
 deeper knowledge of the game internals. Finally, kno 6 indicates
-special mechanisms, that are seldom or unique. The overall kno-rating
+special mechanisms, that are seldom encountered or unique. The overall kno-rating
 of a level equals that of the most difficult object or technique (and
 thus is non-accumulative):
 @enumerate
 @item
 Moving a single marble on normal floors, normal walls, oxyds,
-stones that look like oxyds, death-stones, water, abyss, documents,
+stones that look like oxyds, death-stones, water, an abyss, documents,
 using the inventory, static gravity, visible gradients.
 
 @item
 Pushing stones, simple Sokoban-tricks, bridge-building in water
-and abyss, connected puzzle-stones, moving more than one marble,
+and an abyss, connected puzzle-stones, moving more than one marble,
 meditations, grates, rotors and tops, hidden gradients, triggers and
-switches, doors, holes (not by dynamite), swamp, floppys and
+switches, doors, holes (not made by dynamite), swamp, floppies and
 st-floppy, keys and locks, coins and slots, cracks, timer-stones.
 
 @item
@@ -472,38 +457,38 @@
 ice, inverted floor, some stones sink while others swim, black grates
 that hold rotors and tops away, dynamite, dynamite-breakable stones,
 spade, bolders, magic-wand to change bolder-direction, bolders sink
-into abyss, sheafs of glass, spoon, actors and items may hide under
+into an abyss, sheets of glass, spoon, actors and items may hide under
 movable stones, small not-killer whiteballs, coloured one-way-streets,
-actorimpulse-stones (``bumpers''), rotors can fly over abyss,
+actorimpulse-stones (``bumpers''), rotors can fly over an abyss,
 fart-stones, swords and knights, lasers, static and movable mirrors,
 item- and coin-transformations by pushing stones over them and by
-lasers, umbrellas protect of abyss, hammer and breakable stones
-(although not in tutorial).
+using lasers, umbrellas protect in an abyss, hammer and breakable stones
+(although not in the tutorial).
 
 @item
 Bridge-building in swamps, rubber-bands, rubber-band-stones,
 scissor-stones, unconnected puzzle-stones, exploding puzzle-stones,
 turning puzzle-stones (with and without a magic wand), springs (both
 types, on the floor and hole-kind springs like in ``Upstream
-Journey''), thiefs, three-parted shogun-stones, invisible stones,
+Journey''), thieves, three-part shogun-stones, invisible stones,
 hollow stones, chameleon-stones, items hidden under chameleon stones,
-stones that aren't what they seem (e.g. fake-death-stones), wormholes,
+stones that aren't what they seem (e.g., fake-death-stones), wormholes,
 magnets, using F3 for a restart to solve a level, yin-yangs,
-one-colour-, yin-yang- and inverted yin-yang-stones, stones breakable
-by only one colour, killer-balls, swap-stones, brush and paintable
-stones, changing one-way-streets with a magic wand, making stones to
+one-color-, yin-yang- and inverted yin-yang-stones, stones breakable
+by only one color, killer-balls, swap-stones, brush and paintable
+stones, changing one-way-streets with a magic wand, changing stones to
 glass with a magic wand, impulse-stones (movable, static and hollow),
 black and white bombs, bomb-stones, fire, extinguishers,
 rotator-stones, yellow anti-swapping stones, mines, flags, seeds,
 weights, putting objects under one-way-streets and other hollow
 stones, electric stones, turnstiles, mailing and pipes, rings (single
 and multiplayer), volcanos, bags, randomizers (as possible effect of a
-switch), horses and horse-passing stones, pins, bananas, cherries make
-invisible, surprise-item.
+switch), horses (the actors) and horse-passing stones, pins, bananas, cherries
+can make you invisible, surprise-item.
 
 @item
-Cracks, floor-springs, wormholes etc. are all items, seeds can grow
-inside stones, laser is blocked by all items, killer-balls don't sink
+Cracks, floor-springs, wormholes, etc., are all items, seeds can grow
+inside stones, the laser is blocked by all items, killer-balls don't sink
 in water, ``Space Meditation''-kind collisions, holding down the
 mouse-button, invisibility lets you go through glass, jumping over
 lasers @enddots{}
@@ -514,19 +499,19 @@
 
 @end enumerate
 
-kno 6 does not neccessarily mean that this level is difficult to
-understand; the unique mechanism or object might as well be very
+kno 6 does not necessarily mean that this level is difficult to
+understand; the unique mechanism or object might also be very
 intuitive, like in ``Flood Gates''.
 
 @strong{Speed and speed control (spe)}
 
-The spe-value not only corresponds to the maximum speed a level
-requires (like it's needed to run away from a rotor), but also the
-degree of control a player has over his mouse while moving it,
+The spe-value corresponds not only to the maximum speed a level
+requires (like you need to run away from a rotor), but also the
+degree of control a player has over his mouse while moving it;
 excellent examples for this are ``Mourning Palace'' and the middle
-part of ``Sacrifice''. This involves moving the mouse with a constant
+part of ``Sacrifice''. This involves moving the mouse at a constant
 velocity for a long time, as well as correctly estimating the speed
-that's needed in a certain task, like shattering a sheaf of glass.
+that's needed in a certain task, like shattering a sheet of glass.
 
 @enumerate
 @item
@@ -537,173 +522,167 @@
 be chasing you.
 
 @item
-There is an appropiate time limit or speed control task. This can
-be a single, not too fast rotor in an open area.
+There is an appropriate time limit or speed control task. This can
+be a single, not-too-fast rotor in an open area.
 
 @item
-Don't stop! Examples are difficult timing-tasks as well as a single
+Don't stop! Examples include difficult timing-tasks as well as a single
 fast rotor or several slower ones.
 
 @item
 Hurry Up! Whereas spe 4 is meant to be difficult, but obviously
-solvable in not too many attempts, spe 5 is everything above this.
+solvable in not too many attempts, spe 5 is everything beyond this.
 
 @end enumerate
 
-The spe-rating again is cumulative, as many slow rotors can add up
-to spe 3 or 4 or a combination of many slow time-switches to be
-pressed in a certain order can make up a horrible task. In contrast to
+The spe-rating again is cumulative, since many slow rotors can add up
+to spe 3 or 4, or a combination of many slow time-switches to be
+pressed in a certain order can create a horrible task. In contrast to
 the other categories, for which the average is near 3 (or between 3
-and 4 for kno), an overwhelming fraction of all levels are definitely
-spe 1. So, the spe-rating is more a kind of supplement to the three
+and 4 for kno), most levels are definitely
+spe 1. So, the spe-rating is more a supplement to the three
 core-ratings int, dex and pat.
 
 @strong{Combinations of ratings}
 
-In some cases it can be of interest to have a single value to measure
-the difficulty of a level. A simple possibility to calculate such a
-universal rating is to choose a linear combination of the 5 single
-ratings, weighted with appropriate weights. These weights should
-correspond to the difficulty a single category adds to the universal
-difficulty, but these weights also should be carefully chosen to avoid
-number-theoretic obstructions (e.g. when all weights are even except
-for the spe-rating, then there will be a visible difference in the
-distribution of even and odd univeral ratings, which can be very
-misleading). A working and very interesting linear combination is the
-following, which has been applied in the reordering process:
+Sometimes, it can be interesting to have a single value to measure the difficulty of a level. To
+calculate such a universal rating, a simple possibility is choosing a linear combination of the 5
+single ratings, weighted with appropriate weights. These weights should correspond to the
+difficulty a single category adds to the universal difficulty. Yet you should also choose these
+weights carefully to avoid number-theoretic obstructions (e.g., when all weights are even except
+for the spe-rating, then there will be a visible difference in the distribution of even and odd
+universal ratings, which can be very misleading). A working, and very interesting linear
+combination, is the following, which has been applied in the reordering process:
 
+
 @example
 universal difficulty  =  7*int + 6*dex + 4*pat + 3*kno + 4*spe - 23
 @end example
 
-This has the special property that it takes relatively broadly and
-continuously distributed values between 1 (all ratings 1) and 100 (all
-ratings 5, kno 6) and emphasizes the most difficult categories
-intelligence and dexterity. However, some very small or very high
-values cannot appear in this combination, like 2 or 99. Other
-combinations lead to full, but narrow, or to broad but
-uncontinuous spectra.
+This has a special property, in that it takes relatively broad and continuously distributed values
+between 1 (all ratings 1) and 100 (all ratings 5, kno 6) and emphasizes the most difficult
+categories, intelligence and dexterity. However, some very low or very high values cannot
+appear in this combination, such as 2 or 99. Other combinations lead to full but narrow, or to
+broad but noncontinuous spectra.
 
 @node Scores, Versions, Public Ratings, Level Info
 @subsection Scores
 
 The score columns show your and some comparison values for the difficult and
-for the easy mode if the levels supports it.
+for the easy mode, if the levels supports it.
 
-The world record is the best score that was retransmitted to the enigma team.
-The holders of the world record are listed below. 
+The world record is the best score that was retransmitted to the Enigma team.
+The world record holders are listed below.
 
-The PAR value is the "professional average rating" of the level. It is the 
-harmonic average of all scores that have been retransmitted. But we take only 
-into account scores from players that have solved a certain number of levels.
-Opposed to the world record that will be very difficult to gain the PAR value
-is a much more realistic aim for an ambitioned player. Within the level menu
-levels are marked with a speeding blackball if you are equal or better than PAR.
+The PAR value is the ``professional average rating'' of the level. It is the harmonic average of all
+scores that Enigma players have retransmitted. However, we take into account only scores from
+players who have solved a certain number of levels. Opposed to the world record, which will be
+very difficult to gain, the PAR value is a much more realistic aim for an ambitious player. If you
+are equal or better than PAR, the levels are marked with a speeding blackball within the level
+menu.
 
-The authors value is another reference score. Most authors are not keen on
-holding the world record of their own levels. But they will likley know the
-fastest way to solve the level. If your score is much higher than the authors
-score a simpler solution to solve the level may exist.
+The author's value is another reference score. Most authors are not keen on holding the world
+record of their own levels. However, they will likely know the fastest way to solve the level. If
+your score is much higher than the author's score, a simpler solution to solve the level may
+exist.
 
 The solved number is the number of players who solved this level in the given
 score version.
 
-The solved percentage is the relation of player who solved this level to the
-number of players who retransmitted scores. Actually we take only those players
-in account that could have solved the level. F.e. players that did retransmit
-scores before the level was written without updating afterwards are not taken 
-into account. A low percentage is a hint for a level that is not easy to solve.
+The solved percentage is the relation of the number of players who solved this
+level to the number of players who retransmitted scores. Actually, we take into
+account only those players who could have solved the level. For example, players
+who did retransmit scores before the level was written, without updating
+afterwards, are not taken into account. A low percentage is a hint that a level
+is not easy to solve.
 
- at node Versions, Privat Annotations and Ratings, Scores, Level Info
+ at node Versions, Private Annotations and Ratings, Scores, Level Info
 @subsection Versions
 
-The version column shows detail information about the level. Read chapter Level
-Basics node @pxref{<version>} and @pxref{<modes>} for explanation of the
+The version column shows detailed information about the level. Read the chapter Level
+Basics node @pxref{<version>} and @pxref{<modes>} for an explanation of the
 values.
 
-For you as a player the @samp{Score} version number can be of some interest.
-If solve a level with a certain score it may happen that in a updated Enigma
-release the level appears with a red triangle in the level menu. Even though
-the level menu displays the medals showing that you solved the level the score
-values will not be displayed any more. This is due to a incompatible level
-update that requires a new solution with different incomparable score values.
-The author will increase the score version number in such a case.
+For you as a player, the @samp{Score} version number can be interesting.
+A level you had solved with a certain score may appear with a red triangle in the level menu in
+an updated Enigma release of the level. Although the level menu displays the medals showing
+that you solved the level, it will not display the score values anymore. This is due to an
+incompatible level update that requires a new solution with different, incomparable score
+values. The author will increase the score version number in such a case.
 
- at node Privat Annotations and Ratings, Screenshots, Versions, Level Info
- at subsection Privat Annotations and Ratings
+ at node Private Annotations and Ratings, Screenshots, Versions, Level Info
+ at subsection Private Annotations and Ratings
 
-The textfield allows you to enter an annotation for a level that you can review
-on later replays. Note that the current textfield may not allow you to enter all
-characters and needs the mouse cursor to remain within its boundaries. But it
-should work for entering short annotations that may be very useful lateron.
+This textfield allows you to enter an annotation for a level that you can review
+on later replays. Note that the current textfield is limited (it may not allow you to enter all
+characters, and needs the mouse cursor to remain within its boundaries). Yet it should work for
+entering short annotations that may be very useful later.
 
-Annotations are stored in your private applications @samp{state.xml} file. There
-is one annotation per level independent of the level version.
+Enigma stores annotations in your private applications @samp{state.xml} file. It permits one
+annotation per level, independent of the level version.
 
 You may rate the levels, too. Just click on the ratings button. Values go from
 0 to 10 with an additional @samp{-} for abstention. 0 stands for a poor level
 that you think is not worth playing, 5 for an average level and 10 for the
-ultimate best levels. Try to use all values in your ratings.
+ultimate, best levels. Try to use all values in your ratings.
 
-The ratings are stored together with the scores and will be evaluated
-annonymously. The resulting average rating of all users is displayed for your
-information. Note that different ratings are possible for different score versions
-of the same level. This makes sense as levels may improve on suggestions of
-users. As long as you do not rerate a new version of a level your rating from
-a previous version in inherited.
+Enigma stores the ratings with the scores and evaluates them anonymously. Enigma displays
+the resulting average rating of all users, for your information. Note that different ratings are
+possible for different score versions of the same level, because levels may improve as a result of
+suggestions by users. If you do not re-rate a new version of a level, Enigma inherits your rating
+from a previous version.
 
- at node Screenshots, , Privat Annotations and Ratings, Level Info
+ at node Screenshots, , Private Annotations and Ratings, Level Info
 @subsection Screenshots
 
-While playing a level you can make screenshots by pressing @key{F10}. You can make
-several screenshots in sequence for documentation purposes. Each will be stored
-with a unique image filename. With help of the level inspector you can view the
-screenshots directly from within Enigma. Just click on the screenshot button to
+While playing a level, you can make screenshots by pressing @key{F10}. You can make
+several screenshots in sequence for documentation purposes. Enigma will store each
+with a unique image filename. Using the level inspector, you can view the screenshots directly
+from within Enigma. Just click on the screenshot button to
 view the first image. 
 
-As any buttons would disturb the view of a screenshot all functions are keyboard
-commands. Press @key{F1} to get a help. @key{ESC} returns to the level inspector. 
+Because any buttons would disturb the view of a screenshot, all functions are keyboard
+commands. Press @key{F1} to get a help screen. @key{ESC} returns to the level inspector. 
 @key{Page Up} and @key{Page Down} will show the previous and next screenshot.
-If you scroll down behind the last screenshot the "missing" screenshot file is named.
-This may be a useful hint were to search the other screenshot files on your
+If you scroll down behind the last screenshot, the ``missing'' screenshot file is named.
+This may be a useful hint as to where to search the other screenshot files on your
 @samp{user image path} (@pxref{Locating Resources}).
 
 @node Handicap and PAR, User Sound Sets, Level Info, Running Enigma
 @section Handicap and PAR
 
-As PAR (@pxref{Scores}) describes the difficulty of a level the handicap @samp{hcp}
+As PAR (@pxref{Scores}) describes the difficulty of a level, the handicap @samp{hcp}
 describes your ability to solve levels in PAR. The handicap is always related
-to a levelpack or group of levelpacks. For each levelpack you can see your
-handicap in the level menu if you select the PAR mode by clicking on the lower
+to a levelpack or group of levelpacks. You can see your handicap for each levelpack in the level
+menu, if you select the PAR mode by clicking on the lower
 left button until the speeding black marble appears. The value is displayed in
-the upper right corner together with the number of levels you solved in PAR.
+the upper right corner, with the number of levels you solved in PAR.
 
-The handicap is similar to the golfers handicap. A low value is better than a
-high value. If you solve all levels exactly in PAR your handicap will be 0. If
-you are even better than PAR your handicap will be negativ. Players can use
+The handicap is similar to the golfer's handicap. A low value is better than a
+high value. If you solve all levels exactly in PAR, your handicap will be 0. If
+you are even better than PAR, your handicap will be negative. Players can use
 this value to compare their overall abilities.
 
 Just for those of you that want to know the details of this score rating system
-of PAR and handicap some additional information that others may well skip to the
-next chapter @ref{Levelpack Basics}.
+of PAR and handicap, here is some additional information, which others may skip and
+continue with the next chapter @ref{Levelpack Basics}.
 
 We request all users to send their scores. All scores are evaluated for world
-records and counts of level solvage rates and numbers. 
+records and counts of level solution rates and numbers. 
 
-But for the PAR calculation we take only scores from users into account that have 
-solved more than a certain rate of levels (currently about 10% of the levels).
-For every level we calculate the harmonic average of the scores of these 
- at samp{professionals}. Professionals that did not solve a level are taken into
-account with the 10 fold world record score. The harmonic average calculates as
+However, for the PAR calculation, we take into account only scores from users who have solved
+more than a certain percentage of levels (currently about 10% of the levels). For every level, we
+calculate the harmonic average of the scores of these 
+ at samp{professionals}. We take professionals who did not solve a level into account with the
+10-fold world record score. The harmonic average calculates as
 
 harm.avg. = N / (sum_[j=1..N] 1/score_j) )
 
-It weights small times with a greater weight than large solvage times.
+It weights small (short) times with a greater weight than large (long) solution times.
 
-The handicap is a sum of values that describe your scores in relationship to
-the PAR value of a level. As it has to take into account that you have no score
-at all or that no PAR value exists some exception rules have to be applied to
-the addends:
+The handicap is a sum of values that describe your scores in relationship to the PAR value of a
+level. Since it has to take into account that you have no score at all or that no PAR value exists,
+we apply some exception rules to the addends:
 
 @multitable @columnfractions .1 .15 .75
 @item @bullet{ } @tab + 1.0 @tab for each unsolved level
@@ -714,9 +693,9 @@
 @end multitable
 
 Note that each score that is better than PAR results in a negative addend and
-thus reduces your handicap. For a levelpack with 100 levels the handicap will
-be in the range of +100 to -300. For levelpacks with more or less levels the
-sum will be scaled by a factor 100/size to result in comparable handicap values.
+thus reduces your handicap. For a levelpack with 100 levels, the handicap will
+be in the range of +100 to -300. For levelpacks with more or fewer levels, Enigma
+will scale the sum by a factor 100/size to result in comparable handicap values.
 Handicaps are stated with one digit behind the decimal point.
 
 
@@ -861,7 +840,7 @@
 @node  Levelpack Basics, Level Basics, Running Enigma, Top
 @chapter Levelpack Basics
 
-Knowing the basics of running Enigma you may wonder how levels are organized in
+Knowing the basics of running Enigma, you may wonder how levels are organized in
 levelpacks and how you can add levels or complete levelpacks to Enigma.
 
 @cindex crossreference
@@ -871,15 +850,14 @@
 Levelpacks are sorted collections of levels that consist of an index and optional
 attached level sources. Not all level sources of a levelpack have to be included
 within the levelpack itself. A levelpack can crossreference levels stored in
-other levelpacks. If a levelpack has no own level sources and consists only
-of crossreferences we speak of a crossindex as the levelpack is just represented
-by a single index file.
+other levelpacks. If a levelpack has no level sources of its own and consists only
+of crossreferences, we speak of a crossindex, since just a single index file represents the
+levelpack.
 
-These definitions suite well to all versions of Enigma. But up to Enigma 0.92
-levelpacks needed to be manually edited and the registration of levelpacks
-was a little bit cryptic. Thus we decided to rewrite the complete levelpack 
-system for Enigma 1.0 and tried to make it versatile and easy to use. We did set 
-us the following aims:
+These definitions suit all versions of Enigma well. However, up to Enigma 0.92, levelpacks
+needed to be manually edited, and the registration of levelpacks was a little bit cryptic. Thus, we
+decided to rewrite the complete levelpack system for Enigma 1.0, and tried to make it versatile
+and easy to use. We did set up the following aims:
 
 @itemize @bullet
 @item 
@@ -887,16 +865,16 @@
 level source
 
 @item
-levelpack addition by just copying the files to the userpath
+levelpack addition simply by copying the files to the userpath
 
 @item
 autodetection of all levelpacks without editing any registration files
 
 @item
-commandline supplied levels as a standard levelpack
+commandline-supplied levels as a standard levelpack
 
 @item
-a @samp{History} levelpack with crossreferences of last played levels
+a @samp{History} levelpack with crossreferences of last-played levels
 
 @item
 level search results as a levelpack of crossreferences
@@ -914,12 +892,12 @@
 updates of levelpacks without updating Enigma itself
 
 @item
-automatic convertion of Enigma 0.92 levelpacks
+automatic conversion of Enigma 0.92 levelpacks
 
 @end itemize
 
-Some of these features work seamlessy. You can use them immediately from the
-levelpack menu. For others you may need to know where to place files. We will
+Some of these features work seamlessly. You can use them immediately from the
+levelpack menu. For others, you may need to know where to place files. We will
 explain these details in the following sections:
 
 @menu
@@ -935,135 +913,129 @@
 @node Getting Started with Levelpacks, Converting 0.92 Levelpacks, Levelpack Basics, Levelpack Basics
 @section Getting Started with Levelpacks
 
-One of the outstanding features of Enigma is its extendibility by new levels.
-And the community of users usually provides us every week several new great levels.
+One of the outstanding features of Enigma is its extensibility by new levels.
+And the community of users usually provides us several new great levels every week.
 
 Adding a new level that you receive as an XML file is very simple. Locate the
 subdirectory @samp{levels/auto} on your @samp{user path} (@pxref{Locating Resources}).
 Just copy the level file to this folder and restart Enigma. The new level will be
-part of the @samp{Auto} levelpack and can be played like any other level.
+part of the @samp{Auto} levelpack, and you can play it like any other level.
 
-Please note that errornous or incompatible levels are displayed with an error
-icon in the level menu. Of course an attempt to run such a level will result in
-an error message. Have a look at the level metadata with the levelinspector 
-(@pxref{Level Info}) to identify the required compatibility version and contact
+Please note that Enigma displays erroneous or incompatible levels with an error icon in the level
+menu. Of course an attempt to run such a level will result in an error message. Look at the level
+metadata with the levelinspector 
+(@pxref{Level Info}) to identify the required compatibility version, and contact
 the author via the address in case of level code errors.
 
 A second way to run new levels is to add the address of the level files to the
-commandline (@pxref{Startup Switches}). This way you can play levels that are
-stored anywhere. Even Url addresses of levels stored in the internet may be used.
-Levels added to the commandline are accessable via the @samp{Startup Levels}
+commandline (@pxref{Startup Switches}). This way you can play levels that are stored
+anywhere, and you may even use url addresses of levels stored on the internet. Levels added to
+the commandline are accessible via the @samp{Startup Levels}
 levelpack. 
 
-If you want to run an old fashioned Lua level that was written for Enigma 0.92
-or earlier you may try to start it via the commandline. These old levels miss
-necessary metadata for auto detection. But commandline supplied levels are 
-treated as temporary levels that are available just for a single run of Enigma.
-The missing data is substituted by reasonable defaults. You will have good 
-chances that the level will run, but scoring and copy, past and linking of
-such levels is not possible.
+If you want to run an old-fashioned Lua level that someone wrote for Enigma 0.92 or earlier,
+you may try to start it via the commandline. These old levels miss necessary metadata for auto
+detection. However, commandline-supplied levels are treated as temporary levels available just
+for a single run of Enigma; reasonable defaults substitute the missing data. The level will
+probably run, but scoring and copy, paste and linking of such levels is not possible.
 
-Besides single new levels the community may provide you with complete levelpacks,
-too. These levelpacks may occur as directories with levels, zip archives or single
-XML files. All of them can be installed by simple copying the files. But we have
-to distinguish the three formats.
+Besides single new levels, the community may provide you with complete levelpacks, too. These
+levelpacks may occur as directories with levels, zip archives or single XML files. You can install
+all of them simply by copying the files, but we have to distinguish the three formats.
 
-Levelpacks that are distributed as directories with level files and an index file
-in it have just to be copied to the subdirectory @samp{levels} on your @samp{user path}
+You must copy levelpacks distributed as directories, with level files and an index file in them, to
+the subdirectory @samp{levels} on your @samp{user path}
 (@pxref{Locating Resources}).
 
-Levelpacks that are distributed as zip archives have to be copied to the subdirectory
- at samp{levels} on your @samp{user path}. There is no need to unpack the zip even
-though it is possible as described in the section @ref{Zip Levelpacks}.
+You must copy levelpacks distributed as zip archives to the subdirectory
+ at samp{levels} on your @samp{user path}. You do not need to unpack the zip,
+although it is possible, as described in the section @ref{Zip Levelpacks}.
 
-Levelpacks that are distributed as a single XML index file have to copied to the
-subdirectory @samp{levels/cross} on your @samp{user path}.
+You must copy levelpacks that are distributed as a single XML index file to the subdirectory
+ at samp{levels/cross} on your @samp{user path}.
 
-After restarting Enigma all new levelpacks should be accessable via the levelpack
-menu.
+All new levelpacks should be accessible via the levelpack
+menu after restarting Enigma.
 
 That is all you need to know to be able to add new levels and levelpacks for
-testing and playing. If your main interest lies in writing own levels you may 
-want to preceed directly to chapter @ref{Level Basics}. The rest of this chapter
-explains how to arrange and sort existing levels in own levelpacks.
+testing and playing. If your main interest lies in writing your own levels, you may 
+want to proceed directly to chapter @ref{Level Basics}. The rest of this chapter
+explains how to arrange and sort existing levels in your own levelpacks.
 
 @node Converting 0.92 Levelpacks, Zip Levelpacks, Getting Started with Levelpacks, Levelpack Basics
 @section Converting 0.92 Levelpacks
 
-With the changes of the levelpack index format it is necessary to convert old
-levelpacks. Even though the main work is done automatically just by starting
-Enigma a few special cases remain that need manual preparations. Furtheron some 
-cleanup after the autoconvertion may be useful.
+With the changes of the levelpack index format, converting old levelpacks is necessary. Although
+the main work is done automatically just by starting Enigma, a few special cases remain that
+need manual preparation. Further on, after the autoconversion, some cleanup may be useful.
 
-If you used to maintain your levelpacks within the Enigma system levels directory
-you should now copy your own levelpacks from the old Enigma version to the @samp{user path}
-subdir @samp{levels} (@pxref{Locating Resources}). The @samp{user path} exists
-on all systems and as Enigma 1.00 will never write to the system levels directory
-updates and convertions will only be performed on the @samp{user path}. If you
+If you formerly maintained your levelpacks within the Enigma system levels directory, you
+should now copy your own levelpacks from the old Enigma version to the @samp{user path}
+subdir @samp{levels} (@pxref{Locating Resources}). The @samp{user path} exists on all
+systems, and since Enigma 1.00 will never write to the system levels directory, it will perform
+updates and conversions only on the @samp{user path}. If you
 registered your levelpacks on the system levels directory within the @samp{index.lua}
-file you need to copy these registration lines to a file names @samp{index_user.lua}
-which you shoud store on your @samp{user path}.
+file, you need to copy these registration lines to the @samp{index_user.lua} file,
+which you should store on your @samp{user path}.
 
-If you maintained several own levelpacks Enigma 0.92 allowed you to keep them
-in several subdirectories of the @samp{levels} directory. But you were also allowed
-to keep all level files and different indices in the @samp{levels} directroy
-itself. In this last case you will run into trouble with the auto convertion as
-Enigma 1.00 allows only one levelpack with attached level files per directory.
-In this case we recommend a step by step convertion: in every step provide only
-one old index for convertion. Enigma will convert this index to an new @samp{index.xml}.
-Move this new index together with all levels to a subdirectory and convert the
+If you maintained several of your own levelpacks, Enigma 0.92 allowed you to keep them
+in several subdirectories of the @samp{levels} directory.However, since it also allowed you to
+keep all level files and different indices in the @samp{levels} directory
+itself, you will run into trouble with the auto conversion, because Enigma 1.00 allows only one
+levelpack with attached level files per directory. 
+In this case, we recommend a step-by-step conversion: in every step, provide only one old index
+for conversion. Enigma will convert this index to a new @samp{index.xml}.
+Move this new index, together with all levels, to a subdirectory and convert the
 next levelpack.
 
 A last special case occurs if you had an old index stored in @samp{levels} that
-referenced level files in different subdirectories of @samp{levels}. As Enigma 0.92
-did not had a concept of cross references and Enigma 1.00 requires all level files
-attached to a levelpack to be stored in a single subdirectory the convertion
-algorithm needs to guess the correct subdirectory. It just takes the subdirectory
-of the first level. If this does not fit you may need to clean up your 0.92
-levelpack prior to convertion.
+referenced level files in different subdirectories of @samp{levels}. Since Enigma 0.92 did not
+have a concept of cross-references, and Enigma 1.00 requires that you store all level files
+attached to a levelpack in a single subdirectory, the conversion algorithm needs to guess the
+correct subdirectory. It simply takes the subdirectory of the first level. If this does not fit, you
+may need to clean up your 0.92 levelpack prior to conversion.
 
-All other standard levelpacks should be converted without problems. The convertion
-is just performed once. As soon as the new @samp{index.xml} exists only this 
-index is used. Thus after a careful check you may remove the old @samp{index.txt}.
-We recommend to keep a backup of the old index until you completly switched to
+Enigma should convert all other standard levelpacks without problems. It only performs the
+conversion once. As soon as the new @samp{index.xml} exists, only this 
+index is used. Thus, after a careful check, you may remove the old @samp{index.txt}.
+We recommend keeping a backup of the old index until you have completely switched to
 Enigma 1.00.
 
-In the case that you used an own levelpack in the zip format you will find a
-subdirectory named with the base name of the zip archive in your user @samp{levels}
-directory. Within this directory the converted @samp{index.xml} is stored. You
+If you used a levelpack of your own in the zip format, you will find a subdirectory named with
+the base name of the zip archive in your user @samp{levels}
+directory. Enigma stores the converted @samp{index.xml} within this directory. You
 may want to exchange the old @samp{index.txt} in the zip with the new index.
-Afterwards you can delete the subdirectory as the index will be loaded directly
+Afterwards you can delete the subdirectory, since Enigma will load the index directly
 from the zip archive.
 
-After converting your levelpacks we strongly recommend that you update your own
-levels to the new XML format as described in @ref{Level Basics}.
+After converting your levelpacks, we strongly recommend that you update your own
+levels to the new XML format, as described in @ref{Level Basics}.
 
 @node Zip Levelpacks, Grouping and Sorting Levelpacks, Converting 0.92 Levelpacks, Levelpack Basics
 @section Zip Levelpacks
 
-Besides the classical levelpack format of a subdirectory of @samp{levels} with
-an @samp{index.xml} and several level files Enigma 1.00 provides a compatible
+Besides the classic levelpack format of a subdirectory of @samp{levels} with
+an @samp{index.xml} and several level files, Enigma 1.00 provides a compatible
 zip archive format. This zip allows you to reduce resources and to ease distribution
 of levelpacks.
 
-The compatibility is 100%. If you have a classical subdirectory levelpack you
+The compatibility is 100%. If you have a classic subdirectory levelpack, you
 can simply zip the complete subdirectory and name the zip with the name of the 
-subdirectory plus standard @samp{.zip} suffix. Now you can completly remove the
-subdirectory and the levelpack is autodetected and fully playable. Even cross
-references into this levelpacks will not be broken!
+subdirectory, plus the standard @samp{.zip} suffix. Now you can completely remove the
+subdirectory; Enigma autodetects the levelpack and it is fully playable. Even cross-references
+into this levelpack will not be broken!
 
-On the other hand you are allowed to expand every zip levelpack to a subdirectory
-with index and level files. Again everything runs and no crossreferences are
-broken.
+On the other hand, Enigma allows you to expand every zip levelpack to a subdirectory with
+index and level files. Again, everything runs and no cross-references are broken.
 
-If you keep both, files contained in the subdirectory preceed files in the zip
-archive. Thus updates of single files are stored in subdirectories in parallel
+If you keep both, the files contained in the subdirectory precede files in the zip
+archive. Thus, Enigma stores updates of single files in subdirectories in parallel
 to existing zip archives.
 
 @node Grouping and Sorting Levelpacks, Creating New Levelpacks, Zip Levelpacks, Levelpack Basics
 @section Grouping and Sorting Levelpacks
 
-As the number of levelpacks increased it got necessary to sort and group the
+As the number of levelpacks increased, it became necessary to sort and group the
 levelpacks in the menu. We tried to provide a useful set of default groups
 and default assignment of the distributed levelpacks to these groups:
 
@@ -1092,194 +1064,191 @@
 
 @end itemize
 
-But this is just a proposal. You are free to rename the groups, add new groups
-and change the assignments of the levelpacks. As in other parts of Enigma you
-can right or control click on the group and levelpack buttons.
+Still, this is just a proposal. You are free to rename the groups, add new groups and change the
+assignments of the levelpacks. As in other parts of Enigma, you can right or control click on the
+group and levelpack buttons.
 
 The group configuration menu allows you to rename and reposition a group. You
 can choose any name that is not a duplicate, that is not enclosed in square brackets
-and differs from @samp{Every Group}. Note that you may not be able to enter all
-characters that you are used too. Sorry for this inconvenience.
+and differs from @samp{Every Group}. Note that you may not be able to enter as many
+characters as you are used to. Sorry for this inconvenience.
 
 The levelpack configuration menu allows you to assign a pack to a group. The
 group list contains two special entries: @samp{[Every Group]} and another name
-enclosed in square brackets. A selection of the first pseudogroup shows up the
-levelpack in every group. The @samp{Startup Levels} group has this assignment
-by default. The second square bracket enclosed name is the default group of the
+enclosed in square brackets. Selecting the first pseudogroup displays the levelpack in every
+group. This is the default assignment of the @samp{Startup Levels} group. The second square
+bracket-enclosed name is the default group of the
 levelpack itself. It is a hint for you and allows you to reassign a levelpack
-to the default group even if you meanwhile have deleted the group.
+to the default group even if meanwhile you have deleted the group.
 
 @node Creating New Levelpacks, Modifying and Deleting Levelpacks, Grouping and Sorting Levelpacks, Levelpack Basics
 @section Creating New Levelpacks
 
-To create a new levelpack you simply select the group to which you want to add
-the new pack. This is most likly the @samp{User} group. Right or ctrl click on
-the group and simply click on the @samp{New Levelpack} button. The levelpack
-configuration menu will be called that allows you to enter all important
-data for the creation of a levelpack.
+To create a new levelpack, you simply select the group to which you want to add
+the new pack. This is most likely the @samp{User} group. Right or ctrl click on
+the group and simply click on the @samp{New Levelpack} button. Enigma will call the
+levelpack configuration menu, which allows you to enter all the important data for the creation
+of a levelpack.
 
 First you should enter a name for the levelpack. You are limited to characters
-that can be used for filenames, too. Alphanumerical characters A-Za-z0-9 and
-space, underscore and hyphen are usable. Note that you may rename the pack
-lateron for a better suitable display name (@pxref{Modifying and Deleting Levelpacks}).
+that can be used for filenames, too. You may use alphanumerical characters A-Z, a-z, 0-9 and
+space, underscore and hyphen. Note that you may rename the pack
+later for a better or more suitable display name (@pxref{Modifying and Deleting Levelpacks}).
 
-Furtheron you should decide whether you want a levelpack that can contain level
+Later, you should decide whether you want a levelpack that can contain level
 sources or just a crossreference levelpack. The first one is useful for storing
-own self written levels or levels that you download yourself from the internet.
-The crossreference levelpacks are for your favorite collections where you just
+your own self-written levels or levels that you download from the internet.
+You may use the crossreference levelpacks for your favorite collections, where you simply
 reference existing levels of other levelpacks with your own personal sorting.
-You set the selected type with the @samp{Level types} button which uses symbols
+You set the selected type with the @samp{Level types} button, which uses symbols
 for references and carbon copies.
 
 The @samp{Default Location} is a number that determines the sorting location 
-within levelpack groups as long as the levelpack has not been resorted manually
-(@pxref{Grouping and Sorting Levelpacks}). This default value is only relevant
+within levelpack groups, if you have not resorted the levelpack manually 
+(@pxref{Grouping and Sorting Levelpacks}). This default value is relevant only
 if you distribute your levelpack and want to ensure that the users will find
 your levelpack at a proper location. The value given after creating a new
-levelpack should work fine in most circumstances.
+levelpack should work well in most circumstances.
 
-You may declare yourself as owner or creator of the levelpack. This just a
+You may declare yourself as owner or creator of the levelpack. This is just a
 string for identification purposes.
 
-Finally when you completed the configuration you can create the levelpack by
-clickling @samp{OK}. The levelpack will be created on your @samp{userpath} 
+Finally, when you have completed the configuration, you can create the levelpack by
+clickling @samp{OK}. Enigma will create the levelpack on your @samp{userpath} 
 (@pxref{Locating Resources}).
 
-If you decide not to create a new levelpack just click @samp{Undo}. Nothing
-will be created or changed in this case.
+If you decide not to create a new levelpack, just click @samp{Undo}. Enigma will not create or
+change anything in this case.
 
-If you want to set up immediatly the new levelpack you can click directly on
- at samp{Compose Pack}. The levelpack will be created and you can use the composer
-to fill it with levels.
+If you want to set up the new levelpack immediately, you can click directly on
+ at samp{Compose Pack}. Enigma will create the levelpack, and you can use the composer to fill
+it with levels.
 
 @node Modifying and Deleting Levelpacks, Composing Levelpacks, Creating New Levelpacks, Levelpack Basics
 @section Modifying and Deleting Levelpacks
 
-To modify a levelpack right or ctrl click on its button in the levelpack menu.
-You will see the metadata for all levelpacks. But only for your own levelpacks
-that are stored on your @samp{userpath} a button @samp{Edit Metadata} will show
-up. Clicking on it allows you to edit the metadata.
+To modify a levelpack, right or ctrl click on its button in the levelpack menu.
+You will see the metadata for all levelpacks. However, an @samp{Edit Metadata} button will
+appear only for your own levelpacks, which Enigma stores on your @samp{userpath}.
+Clicking on it allows you to edit the metadata.
 
-It is possible to rename the levelpack, but the filenames will not be changed
-any more. The new name will be used as the logical levelpack name that shows
-up in Enigma.
+Renaming the levelpack is possible, but Enigma will not change the filenames anymore. It will
+use the new name as the logical levelpack name that shows up in Enigma.
 
-Other attributes that can be modified are the @samp{Default Location} and the 
+Other attributes that you can modify include the @samp{Default Location} and the 
 @samp{Owner}. 
 
-Note that it is not possible to change the levelpack type lateron. You have to
-create a new levelpack of proper type and copy the levels by 
+Note that changing the levelpack type later is not possible. You must create a new levelpack of
+the proper type and copy the levels by using
 @ref{Composing Levelpacks}.
 
-We do not provide a levelpack deletion function to avoid uninteded loss of levelsources.
-But the deletion of a levelpack is as simple as deleting the complete levelpack
-directory on your @samp{userpath}. For crossreference levelpacks you have to
-delete just the index XML file on the @samp{levels/cross} subdirectory of your
+We do not provide a levelpack deletion function to avoid unintended loss of levelsources.
+Still, the deletion of a levelpack is as simple as deleting the complete levelpack
+directory on your @samp{userpath}. For crossreference levelpacks, you simply need to
+delete the index XML file on the @samp{levels/cross} subdirectory of your
 @samp{userpath}.
 
 @node Composing Levelpacks, , Modifying and Deleting Levelpacks, Levelpack Basics
 @section Composing Levelpacks
 
-You can change the levels of a levelpack by the levelpack composer. You call it
-by right or ctrl clicking on the levelpack button in the levelpack menu and
+You can change the levels of a levelpack by using the levelpack composer. You call it
+by right or ctrl clicking on the levelpack button in the levelpack menu, then
 clicking on the @samp{Compose Pack} button in the levelpack configuration menu.
 
-The composer looks quite similar to the levelmenu but it provides other
-functionallity. All commands are listed in the F1 help menu. First you may note
-that the levels are bordered red if you compose your own levelpacks. This is a
-warning as you can modify these levelpacks. System levelpacks as the distributed
-Enigma levelpacks will border the levels in gray as you can use the composer only
-for copying levels to the clipboard.
+The composer looks similar to the levelmenu, but it provides other functionality. Enigma lists
+all commands in the F1 help menu. First, if you compose your own levelpacks, you may note
+that the levels are bordered red. This is a warning, since you can modify these levelpacks.
+System levelpacks (the distributed Enigma levelpacks) will border the levels in gray, since you
+can use the composer only for copying levels to the clipboard.
 
 The clipboard allows you to select levels in one or several levelpacks and to
-insert these levels as reference or as copy to your own levelpacks. First clear
-the clipboard by @samp{Shift delete}. Then select within the composer levels
-from any levelpack you want. Add them by @samp{Shift click}. They will show up
+insert these levels as reference or as copy to your own levelpacks. First, clear
+the clipboard by @samp{Shift delete}. Then select any levelpack you want from within the
+composer levels. Add them by @samp{Shift click}. They will appear
 in the upper text lines in the composer. Return to the levelpack where you want
 to add the levels. Select the level behind which you want to add the levels. Use
 @samp{F8} to insert the levels of the clipboard as references. If you edit a
-levelpack that can take level copies you may use @samp{F9} to insert the levels
+levelpack that can take level copies, you may use @samp{F9} to insert the levels
 of the clipboard as file copies.
 
-As soon as you modify the levelpack a small red triangle in the upper left corner
-signals the modification. Leaving the composer via button @samp{OK} finalizes all
-changes. Leaving the composer via button @samp{Undo} reverts all changes.
+As soon as you modify the levelpack, a small red triangle in the upper left corner
+signals the modification. Leaving the composer via the @samp{OK} button finalizes all
+changes. Leaving the composer via the at samp{Undo} button reverts all changes.
 
-Besides addition of levels you can delete levels by usage of the @samp{delete}
-button. Note that the level files itself will be deleted if you delete a level
+Besides adding levels, you can delete levels by using the @samp{delete}
+button. Note that Enigma will delete the level files themselves if you delete a level
 that is not just a reference. Be careful with all levels that have the document
-icon on its preview. Deletions can be reverted by the @samp{Undo} button.
+icon on their preview. You can revert deletions with the @samp{Undo} button.
 
-All levels can be resorted by @samp{alt left arrow} and @samp{alt right arrow}.
-The new sorting is shown up directly and saved by the @samp{OK} button.
+You can resort all levels with the @samp{alt left arrow} and @samp{alt right arrow}.
+The new sorting appears immediately, and you can save it by using the @samp{OK} button.
 
-The @samp{F5} button updates the index from the levels. This is very useful if
-you edit levels yourself. Changes in title, revision, easy mode support etc.
-will be noticed by the levelpack. All levels of the levelpack are updated at once.
+You can use the @samp{F5} button to update the index from the levels. This is very useful if
+you edit levels yourself. The levelpack will notice changes in title, revision, easy mode support
+etc. Enigma updates all levels of the levelpack at once.
 
-By usage of the Auto levelpack and the composer you can setup levelpacks of your
-own levels as follows. Create a new levelpack, add the level files to the @samp{auto}
+By using the Auto levelpack and the composer, you can set up levelpacks of your own levels, as
+follows: Create a new levelpack, add the level files to the @samp{auto}
 folder, restart Enigma, add the levels from the @samp{auto} folder to the clipboard,
-insert the levelpack by the composer to your levelpack as copies, delete the
+use the composer to insert the levelpack to your levelpack as a copy, and delete the
 unused level file copies from the @samp{auto} folder.
 
 
 @node  Level Basics, Objects, Levelpack Basics, Top
 @chapter Level Basics
 
-As you have played some levels of Enigma you may have noticed that Enigma is a
-quite dynamic game with versatile levels. Thus it is not astonishing that it is
-not possible to describe such levels with a static approach of a simple object
-map like Sokoban. Some levels like mazes, generate their layout and look different
-each time they are played. Other levels provide a dynamic behaviour during the 
-play. F.e. switches may open doors only on certain circumstances. To comply these 
-demands the powerful light-weight C extension language @url{http://www.lua.org, Lua}
-has been integrated into Enigma.
+Now that you have played some levels of Enigma, you may have noticed that Enigma is quite a
+dynamic game with versatile levels. Thus, it is not astonishing that it is impossible to describe
+such levels with a static approach of a simple object map like Sokoban. Some levels, like mazes,
+generate their layout and look different each time you play them. Other levels provide a dynamic
+behavior during the play; i.e., switches may open doors only in certain circumstances. To
+comply with these demands, we have integrated the powerful lightweight C extension language
+ at url{http://www.lua.org, Lua}
+into Enigma.
 
-Up to Enigma 0.92 two different level formats did exist. One was a XML like
-format that was primarily designed for external level editor programs. As its
-static object map description part was inconvenient for manual edition it was
-never used by many authors. The second format was plain Lua code that used
-an interface of Enigma Lua functions to add objects and callback functions.
-This second format was used by nearly all authors. But it had a small drawback -
-metadata for the level like the author name, license info and last but not least
-the level name itself could only be stored as unformatted Lua comments and had
-to be reinserted manually into the level-package indices.
+Up to Enigma 0.92, two different level formats did exist. One was a XML-like format, primarily
+designed for external level editor programs. Because its static object map description part was
+inconvenient for manual editing, many authors never used it. The second format was plain Lua
+code that used an interface of Enigma Lua functions to add objects and callback functions.
+Nearly all authors used this second format, but it had a small drawback:
+you could store metadata for the level (like the author name, license info, and last but not least,
+the level name itself) only as unformatted Lua comments, and you had
+to reinsert it manually into the level-package indices.
 
-With the post 0.92 XMLification of Enigma we achieved full XML support by 
-integration of Apache Xerces and were wondering how to get rid of the old
-level format drawbacks and how to add some compelling new features:
+With the post-0.92 XMLification of Enigma, we achieved full XML support by integrating
+Apache Xerces, and were wondering how to get rid of the old level format drawbacks and how to
+add some compelling new features:
 
 @itemize @bullet
 @item 
-a single format with optional parts - use only those parts you have need of
+a single format with optional parts - use only those parts you need
 
 @item
 no major changes or any limitations for Lua level authors
 
 @item
-keep all author supplied metadata in the level
+keep all author-supplied metadata in the level
 
 @item
 enable plug & play for users - copy the level from the author and play it 
 without manual index edition
 
 @item
-support of various encodings like US-ASCII, UTF-8, UTF-16, windows-1252
+support of various encodings, such as US-ASCII, UTF-8, UTF-16, Windows-1252
 
 @item
 internationalization of levels - allow authors to add strings in their native
 language and supply translators with all translatable level strings and comments
-from the authors how to translate.
+from the authors' how-to-translate.
 
 @item
-add a release and dependecy management for levels and libraries
+add a release and dependency management for levels and libraries
 
 @item
 add level update and upgrade support for levels and libraries
 
 @item
-substitute the old XML format by a versatile editor interface
+substitute the old XML format with a versatile editor interface
 
 @item
 keep the format open to future extensions
@@ -1320,26 +1289,28 @@
 </@i{el}:@b{level}>
 @end example
 
-You may notice that the XML part contains all the metadata that the level author
-is used to supply with a level. The XML part is like a formular that can be copied
-from a template and be filled out.
+You may notice that the XML portion contains all the metadata that the level author is
+accustomed to supplying with a level. The XML part is like a formula that you can copy from a
+template and fill out.
 
-The Lua code is embedded in the XML. The only limitation to the Lua part is that 
- at samp{]]>} is reserved for the end mark and would have to be substituted by 
+The Lua code is embedded in the XML. The only limitation to the Lua portion is that it reserves 
+ at samp{]]>} for the end mark, and you would have to substitute it with 
 @samp{]] >}. No further restrictions.
 
-As the example above includes all mandatory XML parts our aim to avoid major
-changes for Lua level authors should be achieved.
+Since the example above includes all mandatory XML parts, we should achieve our aim to avoid
+major changes for Lua level authors.
 
-You find the example above in the @samp{Exp} levelpack grouped in @samp{Development}.
-The source code is located on the system path subdirectory @samp{levels/enigma_experimental}
+You can find the example above in the @samp{Exp} levelpack grouped in
+ at samp{Development}.
+The source code is located on the system path subdirectory
+ at samp{levels/enigma_experimental}
 (@pxref{Locating Resources}).
 
-If you make your first coding experiments on a copy of this level either add your
-copy to the auto folder (@pxref{Getting Started with Levelpacks}) or use it as 
+If you make your first coding experiments on a copy of this level, either add your
+copy to the auto folder (@pxref{Getting Started with Levelpacks}), or use it as 
 an argument on the command line (@pxref{Startup Switches}).
 
-Of course we have to look at the details of the format and explain the optional
+Of course we must look at the details of the format and explain the optional
 parts:
 
 @menu
@@ -1396,16 +1367,16 @@
 @end example
 
 The level begins with a call to @code{CreateWorld}, which creates a
-new world that is 20 blocks wide and 13 blocks high.  Every
- at dfn{block} in the world can be accessed with a pair of coordinates:
-The upper left corner has coordinates (0,0), the lower right one has
+new world that is 20 blocks wide and 13 blocks high.  You can access every
+ at dfn{block} in the world with a pair of coordinates:
+The upper left corner has coordinates (0,0); the lower right has
 coordinates (19,12).  Every block contains a floor tile, an (optional)
 item, and an (optional) stone.
 
-A frame of stones is drawn around the newly created landscape with the
+You draw a frame of stones around the newly created landscape with the
 @code{draw_border} command.  Its argument, @code{"st-brownie"}, is the
 name of a stone.  By convention, all stones have @code{"st-"} prefixed
-to their name, similarly all item names begin with @code{"it-"} and
+to their name; similarly all item names begin with @code{"it-"} and
 all floor names with @code{"fl-"}.
 
 The @code{fill_floor} command in line 3 fills the complete floor with
@@ -1424,12 +1395,12 @@
 as arguments.  Note the use of curly braces @code{@{},
 @code{@}} to enclose the attribute list.
 
-Attributes are the key to customizing the behaviour of objects in a
-landscape.  Here, we first give a name to the first stone we create.
+Attributes are the key to customizing the behavior of objects in a
+landscape.  Here, we name the first stone we create.
 It's a fart stone that has the unpleasant habit of ``blowing off''
-when triggered.  Triggering this fart stone is done by the timer stone
-we create in line 6--7.  This stone performs a predefined action at
-regular intervals.  In this case we want to send a ``trigger'' message
+when triggered.  The timer stone that we create in line 6-7 triggers this fart stone.  This stone
+performs a predefined action at
+regular intervals.  In this case, we want to send a ``trigger'' message
 every ten seconds to the object named ``fart''.
 
 @example
@@ -1442,7 +1413,7 @@
 
 These commands place a couple of oxyd stones in the level.  The
 @code{oxyd} command internally uses @code{set_stone("st-oxyd", x,y,
- at dots{})}  to create the stones, but it additionally assigns sensible
+ at dots{})} to create the stones, but additionally it assigns sensible
 values to some of the oxyd stones' attributes (most notably the
 color).  The command on line 14 permutes the colors on the oxyd stones
 currently in the landscape.
@@ -1451,8 +1422,8 @@
 15   set_actor("ac-blackball", 10,6.5)
 @end example
 
-This final line creates the black marble controlled by the player.
-Objects that can move around freely are called ``actors'' in Enigma.
+This final line creates the black marble that the player controls.
+We call objects that can move around freely ``actors'' in Enigma.
 Unlike stones and items, actors are not restricted to integer
 coordinates, as you can see in this example. 
 
@@ -1463,7 +1434,7 @@
 
 Let us start with a complete overview of all existing top XML element nodes. The
 following level skeleton contains optional elements that are beyond level basics.
-These elements are just included for completeness:
+We include these elements for completeness:
 
 @example
 <?xml version="1.0" encoding="@var{UTF-8}" standalone="no" ?>
@@ -1486,131 +1457,131 @@
 @end example
 
 The first line is the XML declaration. It is fixed besides the encoding 
-specification. Enigma supports on all platforms at least @samp{US-ASCII}, 
+specification. Enigma supports on all platforms, at least @samp{US-ASCII}, 
 @samp{UTF-8}, @samp{UTF-16}, @samp{ISO-8859-1}, @samp{windows-1252}.
-Enter your encoding and ensure that your editor saves the level in this encoding.
-On some editors you can start in ASCII mode, copy the level skeleton with a
-different encoding declaration like UTF-8, save the level still in ASCII mode
-and reopen the file - the editor may detect the XML declaration and switch 
-automatically to the given encoding. Note that as long as you do not enter
-international strings in the level you do not have to bother with the encoding 
+Enter your encoding and make sure that your editor saves the level in this encoding.
+On some editors, you can start in ASCII mode, copy the level skeleton with a
+different encoding declaration, like UTF-8, save the level still in ASCII mode
+and reopen the file.  The editor may then detect the XML declaration and switch 
+automatically to the given encoding. Note that unless you enter
+international strings in the level, you do not have to bother with the encoding 
 at all. You can choose UTF-8 in this case.
 
-Some addiontal remarks for XML newbies. The XML markup tags are quite similar
-to HTML. But XML requires for each start tag @samp{<element>} a corresponding
-end tag @samp{</element>}. For elements that have only attributes and no content
-you can and should use the alternativ empty element notation @samp{<element/>}.
-Note that when we define an element as empty or state that no content is allowed
-not a single whitespace, even no linebreak is allowed between start and end tag -
-use the empty element notation to avoid mistakes.
+Some additional remarks for XML newbies: The XML markup tags are quite similar
+to HTML. But XML requires a corresponding
+end tag @samp{</element>} for each start tag @samp{<element>}. For elements that have
+only attributes and no content,
+you can and should use the alternative empty element notation @samp{<element/>}.
+Note that when we define an element as empty or state that no content is allowed,
+not a single whitespace, not even a linebreak is allowed between start and end tag. Use the
+empty element notation to avoid mistakes.
 
-We use a pretty printing format with an indention of 2. Each element starts on
-a separate line. Elements with text content have the end tag on the same line.
-Only elements with subelements have the end tag on a separate line with the same
-indention.
+We use a pretty printing format with an indentation of 2. Each element starts on a separate line.
+Elements with text content have the end tag on the same line. Only elements with subelements
+have the end tag on a separate line with the same indentation.
 
-This format is not mandatory. You can even insert linebreaks in text contents and
-within the marks and even within attribute values. But note that the basic rule
-is that each linebreak will be substituted by a space during the XML parsing.
-Take this space into account to avoid mistakes, or simply live with the long lines.
+This format is not mandatory. You can even insert linebreaks in text contents, within the marks,
+and even within attribute values. But note: The basic rule is that each linebreak will be
+substituted by a space during the XML parsing. Take this space into account to avoid mistakes,
+or simply live with the long lines.
 
-All tag names and attribute names are prefixed with a namespace identifier. We
-use @samp{el} as an abreviation for enigma level. All tag names that may be
-manually edited use this prefix.
+A namespace identifier prefixes all tag names and attribute names.  We
+use @samp{el} as an abbreviation for Enigma levels. All tag names you can
+manually edit use this prefix.
 
-And finally a short comment to the XML reserved characters @samp{&} and @samp{<}.
+Finally, a short comment on the XML reserved characters, @samp{&} and @samp{<}.
 These two characters are reserved as tag and entity starting characters. If you
-have need for them in text contents or in attribute values you have to substitute
-them by the entity sequences @samp{&amp;} and @samp{&lt;}. Additionally attribute
-values have to be enclosed either by @samp{"} or @samp{'}. Of course the used 
-enclosing character has to substituted in attribute values, too. Use @samp{&quot}
+need them in text contents or in attribute values, you must substitute
+them by the entity sequences @samp{&amp;} and @samp{&lt;}. Additionally, you must enclose
+attribute values with either @samp{"} or @samp{'}. Of course, you must substitute the
+enclosing character used in attribute values, too. Use @samp{&quot}
 and @samp{&apos}.
 
 @b{Elements:}
 
 @table @asis
 @item @b{/level}, @i{required, single occurence} 
-This is the root node. There is only one instance of this node per file. Like the
-first XML declaration line this second line is quite fixed. There are two versions.
-The simple 3 attribute version as used in the first example and the 4 attribute
-version as above that is only used by level editor programs. For manual level
-edition just copy the simple version as the second line to your level file.
-
+This is the root node. Only one instance of this node occurs per file. Like the first XML
+declaration line, this second line is quite fixed. There are two versions. The simple 3-attribute
+version, as used in the first example, and only level editor programs use the 4-attribute version
+as above. For manual level
+editing, just copy the simple version as the second line to your level file.
+ 
 @b{Attributes:}
 
 @table @asis
 @item @b{xmlns:xsi}, @i{required, contents fixed} 
-Namespace definition for the schema. The contents is fixed to 
-"http://www.w3.org/2001/XMLSchema-instance". The attribute tag @samp{xsi} must
-match the prefix of the next attribute tag and is standard.
+Namespace definition for the schema. The contents are fixed to 
+``http://www.w3.org/2001/XMLSchema-instance''. The attribute tag @samp{xsi} must
+match the prefix of the next attribute tag, and is standard.
 
 @item @b{xsi:schemaLocation}, @i{required, contents fixed} 
-Location of the used schemas. The contents is the fixed enigma level 
-namespace followed by the schema location URL. Level editor programs will add
-their namespace and their schema location URL as in the second example above.
+Location of the schemas used. The contents are the fixed Enigma level 
+namespace, followed by the schema location URL. Level editor programs will add
+their namespace and their schema location URL, as in the second example above.
 
 @item @b{xmlns:el}, @i{required, contents fixed} 
-Namespace definition for enigma level. We use @samp{el} as namespace prefix
-for all level element and attribut tags as standard. The used prefix can be
-arbitrary but must match this attibutes tag. The contents of the attribute is
-fixed to the enigma level namespace.
+Namespace definition for ``Enigma level''. We use @samp{el} as the namespace prefix
+for all level element and attribute tags, as standard. The prefix used can be
+arbitrary, but must match this attributes tag. The contents of the attribute is
+fixed to the Enigma level namespace.
 
 @item @b{xmlns:ee}, @i{optional} 
-This last namespace definition is used by level editor programs only. As an
-example we declared @samp{ee} as namespace prefix for all editor element and
-attribute tags.  The used prefix can be arbitrary but must match this attibutes
-tag. The contents of the attribute is the editors namespace.
+Only level editor programs use this last namespace definition. For
+example, we declared @samp{ee} as the namespace prefix for all editor element and
+attribute tags.  The prefix you use can be arbitrary, but must match this attributes
+tag. The contents of the attribute are the editor's namespace.
 
 @end table
 
- at item @b{/level/protected}, @i{required, single occurence} 
-
+ at item @b{/level/protected}, @i{required, single occurrence} 
+          
 The protected node section contains all level data that derive from the author and
 should not be modified by anyone else.
 
- at item @b{/level/protected/info}, @i{required, single occurence}
+ at item @b{/level/protected/info}, @i{required, single occurrence}
 
 The info node section contains all level metadata. It is mandatory and described in 
 detail at section @ref{Info metadata}.
 
- at item @b{/level/protected/elements}, @i{optional, single occurence} 
+ at item @b{/level/protected/elements}, @i{optional, single occurrence} 
 
 The elements node section is optional. It contains level description parts that
-are given in a data driven manner. Even though the driving force is the support
-for level editor programs a level author may use any parts of this section he
+are given in a data-driven manner. Though the driving force is the support
+for level editor programs, a level author may use any parts of this section he or she
 likes.
 
- at item @b{/level/protected/luamain}, @i{optional, single occurence}
+ at item @b{/level/protected/luamain}, @i{optional, single occurrence}
 
 The luamain node section is the part to insert manually Lua level descriptions.
 It is described in detail at section @ref{LUA code}.
 
- at item @b{/level/protected/editor}, @i{optional, single occurence} 
+ at item @b{/level/protected/editor}, @i{optional, single occurrence} 
 
 The editor node section is an open extension area for level editor programs.
-They can add any additional information in this section that they have need of.
-This node section is simply ignored by Enigma.
+They can add any additional information in this section that they need.
+Enigma simply ignores this node section.
 
- at item @b{/level/protected/i18n}, @i{required, single occurence} 
+ at item @b{/level/protected/i18n}, @i{required, single occurrence} 
 
 The i18n node section contains English strings, native translations and comments
-supplied from the author for the translators. This node section is mandatory 
+supplied by the author for the translators. This node section is mandatory 
 and described in detail at section @ref{Internationalization (i18n)}.
 
- at item @b{/level/public}, @i{optional, single occurence} 
+ at item @b{/level/public}, @i{optional, single occurrence} 
 
-This public node section is an optional extension to the proteced part. It
-contains information that is not validated by the author and may even be added
-after the last authors review.
+This public node section is an optional extension to the protected part. It
+contains information that the author has not validated and may even be added
+after the last author's review.
 
- at item @b{/level/public/i18n}, @i{optional, single occurence} 
+ at item @b{/level/public/i18n}, @i{optional, single occurrence} 
 
-This public i18n section contains further level supplied translations. They
-may derive from the author or other sources. These translations will be
-validated by the translators and are used as long as the translators do not
+This public i18n section contains further translations supplied for the level. They
+may derive from the author or other sources. The translators  will
+validate these translations, and they continue in use if the translators do not
 supply corrected versions. See @ref{Internationalization (i18n)}.
 
- at item @b{/level/public/upgrade}, @i{optional, single occurence} 
+ at item @b{/level/public/upgrade}, @i{optional, single occurrence} 
 
 This upgrade node is part of the @ref{Update and Upgrade} system.
 
@@ -1619,11 +1590,11 @@
 @node Info metadata, LUA code, XML Level structure, Level Basics
 @section Info metadata
 
-The Info node contains all author supplied metadata of the level. This is the
-source of these data. All other parts of Enigma like level indices just contain
-copies that will be automatically updated to the levels original data.
+The Info node contains all author-supplied metadata for the level. This is the
+source of these data. All other parts of Enigma, such as level indices, simply contain
+copies that will be automatically updated to the level's original data.
 
-Let us have a look on all supported subnodes of info with typically used attributes:
+Let us look at all supported subnodes of info with typically used attributes:
 
 @example
 <@i{el}:@b{info} @i{el}:@b{type}="@var{level}">
@@ -1644,24 +1615,24 @@
 @b{Attributes:}
 
 @table @asis
- at item @b{type}, @i{required}, values = "level", "library", "multilevel"
-The schema may be used for single enigma levels, libraries that contain level
-description parts for reusage as well as descriptions for multiple levels at once.
+ at item @b{type}, @i{required}, values = ``level'', ``library'', ``multilevel''
+You may use the schema for single Enigma levels, libraries that contain level
+description parts for reuse, and descriptions for multiple levels at once.
 
- at samp{level} are all single level descriptions. It does not matter if they are
-edited manually or by a level editor program and which description elements are
-used
+ at samp{level} are all single level descriptions. It does not matter if you
+edit them manually or with a level editor program, or which description elements you
+use.
 
- at samp{library} are level description parts that may be included into levels.
-The library may consist just of Lua code in the luamain node or addtional object
+ at samp{library} are level description parts that may be included in levels.
+The library may consist simply of Lua code in the luamain node, or additional object
 descriptions in the elements node. Libraries may make use of nearly all nodes besides
-the @samp{/level/protected/info/score} and @samp{/level/*/i18n} which both have
-to be provided but will not be evaluated. Libraries are included into levels via
+the @samp{/level/protected/info/score} and @samp{/level/*/i18n}, which both must be
+provided, but will not be evaluated. Libraries are included in levels via
 the dependency node-element. See @ref{<compatibility>}.
 
 @samp{multilevel} are descriptions for multiple levels at once. The main purpose
-is to support foreign game level formats like the Sokoban level format which
-describes usually a whole set of level maps in a single file.
+is to support foreign game level formats, like the Sokoban level format, which
+usually describes a whole set of level maps in a single file.
 
 @item @b{quantity}, @i{optional}
 The number of levels contained in a multilevel file.
@@ -1691,10 +1662,10 @@
 from libraries, external data and the editor program that generated the level.
 
 @item @b{modes}, @i{required} 
-The @ref{<modes>} that the level supports, as difficulty, network  and control.
+The @ref{<modes>} that the level supports, such as difficulty, network  and control.
 
 @item @b{comments}, @i{optional} 
-Optional comments like credits, dedication and code comments. See @ref{<comments>}.
+Optional comments, such as credits, dedication and code comments. See @ref{<comments>}.
 
 @item @b{update}, @i{optional} 
 @ref{Update and Upgrade}
@@ -1703,7 +1674,7 @@
 @ref{Update and Upgrade}
 
 @item @b{score}, @i{required} 
-The authors own @ref{<score>} of this level.
+The author's own @ref{<score>} of this level.
 
 @end table
 
@@ -1723,7 +1694,7 @@
 @node <identity>, <version>, Info metadata, Info metadata
 @subsection <identity>
 
-The @samp{@b{identity}} element is required, as it provides the information for human
+The @samp{@b{identity}} element is required, since it provides the information for human
 and system identification of the level. 
 
 @example
@@ -1734,38 +1705,38 @@
 
 @table @asis
 @item @b{title}, @i{required} 
-The English title of the level. Make sure that the title is not too long as it
-will be used on the level selection menu. Translations of the title can be provided
+The English title of the level. Make sure that the title is not too long, since Enigma
+will use it on the level selection menu. Translations of the title can be provided
 in the @ref{Internationalization (i18n)} sections.
 
 @item @b{subtitle}, @i{optional}
-An optional english subtitle. Used for title parts that are too long for the
-main title, or for a short first hint. The subtitle is displayed on the level info
+An optional English subtitle. Used for title parts that are too long for the
+main title, or for a short first hint. Enigma displays the subtitle on the level info
 page and on the start of the level. Translations of the subtitle can be provided
 in the @ref{Internationalization (i18n)} sections.
 
 @item @b{id}, @i{required}
 This is the central system identification string of the level that remains valid
-for all time independent of upcomming release updates. Enigma's single demand
-on the id is that it is unique. Unique among all levels created by all authors
+for all time, independent of upcoming release updates. Enigma's single demand
+on the id is that it is unique among all levels created by all authors
 around the world.
 
-As levels can be edited with any text editor or different special Enigma level
-editors there is no control about the uniqueness. Thus we have to provide a
-simple convention to avoid any possible id clashes:
+Since you can edit levels with any text editor or different special Enigma level editors, there is no
+control about the uniqueness. Thus, we have to provide a simple convention to avoid any
+possible id clashes:
 
 @var{@b{YYYYMMDDuserNNN}}
 
 Where @samp{YYYY}, at samp{MM}, at samp{DD} is the date of the creation of the first
-experimental version, @samp{user} stand for a user specific name and @samp{NNN}
-for a random number. F.e. my level called @samp{Houdini} has the id 
- at samp{20060816ral719}. Of course all level created on the same day have to
-differ in the random number part. The id is a Enigma level system id and is 
+experimental version, @samp{user} stands for a user-specific name and @samp{NNN}
+for a random number. For example, my level called @samp{Houdini} has the id 
+ at samp{20060816ral719}. Of course all levels created on the same day have to
+differ in the random number part. The id is an Enigma level system id, and is 
 never exposed to users.
 
-For backward compatibility legacy levels keep their former filename as the
-new level id and do not fit in the name schema given above. But that does not
-harm as the only requirement is the uniqueness.
+For backward compatibility, legacy levels keep their former filename as the
+new level id, and do not fit in the name schema given above. Still, that does no harm since the
+only requirement is the uniqueness.
 
 @end table
 
@@ -1786,71 +1757,69 @@
 
 @table @asis
 @item @b{score}, @i{required}
-The score version is given as a positiv integer number. New levels start with 
-score verison "1". New level versions need to increase the
+The score version is given as a positive integer number. New levels start with 
+score verison ``1''. New level versions need to increase the
 score version number if the level modifications cause different solutions with 
-uncomparable score values. Of course level authors should be very restrictive 
+uncomparable score values. Of course, level authors should be very restrictive 
 with such modifications.
 
-During the development of a level the attribute @samp{@b{status}} should be used to mark a
-level as not released. Not later than the author changes the @samp{@b{status}} to
- at samp{released} he has to check scoring compatibility and increase the score 
+During the development of a level, you should use the attribute @samp{@b{status}} to mark a
+level as not released. When the author changes the @samp{@b{status}} to
+ at samp{released}, he has to check scoring compatibility and increase the score 
 version if necessary.
 
 This attribute is the logical equivalence to the Enigma 0.92 @samp{index.txt} attribute 
 @samp{revision}.
 
 @item @b{release}, @i{required} 
-The technical release version is given as a positiv integer number. New levels
-start with release version "1". New level versions need to 
-increase the release version number if the level modifications either cause technical
-incompatibilities with previous Enigma releases or the scoring version has been
-increased.
+The technical release version is given as a positive integer number. New levels
+start with release version ``1''. You must increase the release version number if
+the level modifications cause either technical incompatibilities with previous Enigma releases,
+or the scoring version has been increased.
 
 The primary cause for technical incompatibilities should be the compensation 
-of Enigma engine changes. As such compensations will not run on the old Enigma
-version the level versions have to be distinguished by a different release number.
+of Enigma engine changes. Since such compensations will not run on the old Enigma
+version, the level versions must be distinguished by a different release number.
 
-In both cases, technical and scoring incompatibilities, the level file name has
-to be changed, too. This is necessary as on some systems different Enigma versions
-may be installed at the same time. They have the need for both level versions at
-the same time. Internet servers providing Enigma levels need to offer different
-level release at the same time, too.
+In both cases, technical and scoring incompatibilities, the level file name must
+be changed, too. This is necessary since different Enigma versions may be installed on some
+systems at the same time. They have the need for both level versions at the same time. Internet
+servers providing Enigma levels need to offer the different level release at the same time, too.
 
-To enable humans to assign different level release files to a level itself we
+To enable people to assign different level release files to a level itself, we
 strongly recommend the name convention for levels 
- at var{AuthoridentifierLevelnumber_Releasenumber.Suffix}. Where the levelnumber is at
-least 2 digits. For example @samp{ral01_2.xml}
+ at var{AuthoridentifierLevelnumber_Releasenumber.Suffix}, where the levelnumber is at
+least 2 digits; for example, @samp{ral01_2.xml}
 
 @item @b{revision}, @i{required} 
-The revision number is a simple ever increasing version number. Every published
+The revision number is a simple, ever-increasing version number. Every published
 version of the level should have a new revision number. The revision number is
 independent from the scoring and release version number.
 
-If Enigma finds two levelfiles in its data serach paths with identical filenames,
-id, score and release version it will load the one with the higher revision number.
-This feature guarantees, that a new revision of a level distributed with a new
-Enigma release can not be shadowed by an older level revision stored on the users
-home level directory. Online updates will check the level revision numbers, too.
+If Enigma finds two levelfiles in its data search paths with identical filenames,
+id, score and release version, it will load the one with the higher revision number.
+This feature guarantees that  an older level revision stored on the user's
+home level directory cannot supercede a new revision of a level distributed with a new
+Enigma release. Online updates will check the level revision numbers, too.
 
-Even though the revision evaluates to a number the attribute can take a second 
+Although  the revision evaluates to a number, the attribute can take a second 
 string format as the literal keyword @samp{$Revision$}. This 
 @url{http://subversion.tigris.org/, Subversion} format allows level authors to 
-let the level revision number be automatically inserted by their Subversion 
-repository. They just have to set @samp{svn propset svn:keywords "Revision" level.xml} 
-at their repository for every level file. As the Subversion revision number is 
-ever increasing it fulfills our criteria. Note that there is no need for revision
-numbers to be consecutive.
+let their Subversion repository automatically insert the level revision number. They must simply
+set @samp{svn propset svn:keywords "Revision" level.xml} 
+at their repository for every level file. Since the Subversion revision number is 
+ever-increasing, it fulfills our criteria. Note that Enigma does not require that revision
+numbers be consecutive.
 
- at item @b{status}, @i{required}, values = "released", "stable", "test", "experimental"
-This attributes describes the quality of the level during development. Enigma
-uses the status to protect the score database to be spoiled by unplanned solution
-scores. Only for levels marked as @samp{released} scores will be recorded.
+ at item @b{status}, @i{required}, values = ``released'', ``stable'', ``test'', ``experimental''
+This attribute describes the quality of the level during development. Enigma
+uses the status to protect the score database from being spoiled by unplanned solution
+scores. It will record scores only for levels marked as @samp{released}.
 
-A level author who starts a change on a released level should first change the
-status back to @samp{experimental}. Then he should make his changes and test 
-the level. When he is definitivly sure that he did not introduce any spoilers
-he can release the level again with a new revision and may be release or 
+As a level author, if you start to change a released level, you should first change the
+status back to @samp{experimental}. Then make your changes and test 
+the level. When you are definitively sure that you did not introduce any spoilers,
+you can release the level again with a new revision and perhaps a new release or 
 score version number.
 
 @end table
@@ -1862,10 +1831,10 @@
 @node <author>, <copyright>, <version>, Info metadata
 @subsection <author>
 
-The information about the author him/herself. The element itself is required.
-But all attributes are optional to allow an author to be anonymous. Please
-remember, that level adminstrators and translators may have a need to contact
-you as an author. So please give a way to drop a note for you.
+The information about the author him/herself. Enigma requires the author element itself, but
+all attributes are optional to allow an author to be anonymous. Please remember that level
+administrators and translators may need to contact you as the author. So please provide a way
+for them to contact you.
 
 The author element node may look like:
 
@@ -1876,29 +1845,29 @@
 @b{Attributes:}
 
 @table @asis
- at item @b{name}, @i{optional}, default = "anonymous" 
-The authors name as it will be displayed on the level info page and on the start
+ at item @b{name}, @i{optional}, default = ``anonymous''
+The author's name as it will be displayed on the level info page and on the start
 of the level. The name defaults to @samp{anonymous}.
 
 @item @b{email}, @i{optional} 
-The authors email address or a newsgroup or forum he listens to. In general a
-hint how to drop a note for him. The value will just be displayed as a string on
+The author's email address or a newsgroup or forum he monitors. In general, this is a
+hint as to how to communicate with him or her. The value will simply be displayed as a string on
 the level info page.
 
 @item @b{homepage}, @i{optional} 
-An address about the author or where the author publishes further Enigma levels.
-The value will just be displayed as a string on the level info page.
+An address for the author or where the author publishes additional Enigma levels.
+The value will simply be displayed as a string on the level info page.
 
 @end table
 
 @b{Contents:}
 
-The element itself is empty - no content is allowed.
+The element itself is empty; no content is allowed.
 
 @node <copyright>, <license>, <author>, Info metadata
 @subsection <copyright>
 
-The standardized location for a copyright message of the author:
+The standardized location for the author's copyright message:
 @example
 <@i{el}:@b{copyright}>@var{Copyright @copyright{} 2006 Ronald Lamprecht}</@i{el}:@b{copyright}>
 @end example
@@ -1909,13 +1878,13 @@
 
 @b{Contents:}
 
-The copyright notice of the author.
+The author's copyright notice.
 
 @node <license>, <compatibility>, <copyright>, Info metadata
 @subsection <license>
 
-Of course every author is free to choose the license conditions for his levels.
-But the author has to state the conditions. Thus this node element and its
+Of course, every author is free to choose the license conditions for his/her levels.
+However, the author must state the conditions. Thus, this node element and its
 attributes are required:
 
 @example
@@ -1926,22 +1895,22 @@
 
 @table @asis
 @item @b{type}, @i{required}
-A short license identifier of the license type with an optional link address to
-the license text or the string @samp{special} if the author supplies an own 
+A short license identifier of the license type, with an optional link address to
+the license text or the string @samp{special}, if the author supplies his/her own 
 license as the content of this element.
 
 @item @b{open}, @i{required}
-A boolean statement if the choosen license fulfills the criteria of the 
+A boolean statement, whether the chosen license fulfills the criteria of the 
 @url{http://www.opensource.org/, Open Source Initiative (OSI)}. Please note 
-that a value of @samp{false} may keep your level of being distributed together
+that a value of @samp{false} may prevent your level from being distributed
 with Enigma.
 
 @end table
 
 @b{Contents:}
 
-A complete license text may be added as the contens of this element. Please
-make use of identification of the level via the type attribute.
+You may add a complete license text as the contents of this element. Please
+use the type attribute to identify the level.
 
 @node <compatibility>, <modes>, <license>, Info metadata
 @subsection <compatibility>
@@ -1960,9 +1929,9 @@
 @item @b{enigma}, @i{required}
 The minimal Enigma release number required for compatibility.
 
- at item @b{engine}, @i{optional}, values = "enigma", "oxyd1", "per.oxyd", "oxyd.extra", "oxyd.magnum"; default = "enigma"
-The required engine compatibility mode that influences the behaviour of various
-objects. This attribute is only evaluated for levels. Libraries ignore this
+ at item @b{engine}, @i{optional}, values = ``enigma'', ``oxyd1'', ``per.oxyd'', ``oxyd.extra'', ``oxyd.magnum''; default = ``enigma''
+The required engine compatibility mode that influences the behavior of various
+objects. This attribute is evaluated only for levels. Libraries ignore this
 attribute.
 @end table
 
@@ -1972,51 +1941,49 @@
 
 @table @asis
 @item @b{dependency}, @i{optional, mutiple occurence}
-With the use of this element you can specify any Enigma-Lua library this levels
-depends on. You can specify several libraries by multiple occurence of this 
-element. If you configure a library to be preloaded it will be loaded by the
-engine before any level Lua code is loaded and executed. The load sequence of
-several libraries conforms strictly to the sequence of their dependencies elements.
+You can use this element to specify any Enigma-Lua library this level depends on. You can
+specify several libraries by multiple occurrence of this element. If you configure a library to be
+preloaded, the engine will load it before it loads or executes any level Lua code. The load
+sequence of several libraries conforms strictly to the sequence of their dependencies elements.
 
 @b{Attributes:}
 @table @asis
 @item @b{path}, @i{required}
-The resource path of the library without it's suffix and any release extension.
-As most libraries are stored in the @samp{lib} subdirectory of Enigma's 
- at samp{levels} directory the resource path will be in most cases like the one in 
+The resource path of the library without its suffix or any release extension.
+Enigma stores most libraries in the @samp{lib} subdirectory of its 
+ at samp{levels} directory, in most cases the resource path will be like the one in 
 the example above: @samp{lib/ant}. This is the valid path for the library file 
 that may be either @samp{levels/lib/ant.xml} or @samp{levels/lib/ant.lua} or 
 @samp{levels/lib/ant_1.xml}.
 
-But libraries can also be totally level pack specific. In this case you may use
-a relative resource path like @samp{./mylib} and store the library in the level
+However, libraries can also be totally level pack-specific. In this case, you may use
+a relative resource path, such as @samp{./mylib} and store the library in the level
 pack directory itself.
 
 @item @b{id}, @i{required}
-The version independent id of the library as specified in the library metadata.
-It will be checked on load of the library to avoid problems and may be used 
-together with the release number to detect relocated libraries.
+The version independent id of the library, as specified in the library metadata.
+Enigma will check it on load of the library to avoid problems, and may use 
+it with the release number to detect relocated libraries.
 
 @item @b{release}, @i{required}
-Even though different release versions of libraries have to have different
-filenames we require to specify the library version. It will be checked on load
-of the library to avoid problems and may be used together with the id to detect
-relocated libraries.
+Although different release versions of libraries must have different filenames, we require to
+specify the library version.  Enigma will check it on load of the library to avoid problems, and
+may use it with the release number to detect relocated libraries.
 
 @item @b{preload}, @i{required}
 A boolean statement that specifies whether the library should be preloaded. If
-the library is not preloaded you can still load it via Lua code statements. But
-even those libraries have to be declared as they will be checked on conformance.
+the library is not preloaded, you can still load it via Lua code statements. Yet
+even those libraries must be declared since Enigma will checked them on conformance.
 You should always preload your libraries if you make use of the @samp{elements}
 section.
 
 @item @b{url}, @i{optional}
-This optional attribute allows to specifiy a backup address for the library.
-This will be usefull for the usage of new libraries that are not yet distributed
+This optional attribute allows you to specify a backup address for the library.
+This will be useful for using new libraries that are not yet distributed
 with the system. 
 
-For the development and test phase of new libraries themself
-a developer can hand out test levels with an empty @samp{library} resource path
+For the development and test phase of new libraries themselves, a developer can hand out test
+levels with an empty @samp{library} resource path
 attribute. The test levels will load the newest library version as published
 at the given url.
 
@@ -2027,30 +1994,28 @@
 none.
 
 @item @b{externaldata}, @i{optional, multiple occurence}
-This element can be used to specify any external data file this levels
-depends on. You can specify several files by multiple occurence of this 
+You can use this element to specify any external data file this level
+depends on. You can specify several files by multiple occurrence of this 
 element. Files declared can be read via the Lua interface.
 
-This feature should support levels that simulate foreign games like Sokoban 
-within Enigma. Due to copyrights and license conditions it may not be possible 
-to include some data within a level. But it may be legal to distribute the data 
-in the original unmodified format.
+This feature should support levels that simulate foreign games like Sokoban within Enigma. Due
+to copyrights and license conditions, including some data within a level may not be possible.
+However, distributing the data in the original unmodified format may be legal.
 
 @b{Attributes:}
 @table @asis
 @item @b{path}, @i{optional}
-The resource path of the external data file with it's suffix. As the data are
-usually level specific they should be stored aside of the level in the same
-levelpacl directory. Thus a relative resource path like @samp{./datafile.ext} 
-should be preferable. 
+The resource path of the external data file with its suffix. Since the data are usually level-
+specific, you should store them with the level in the same levelpack directory. Thus, a relative
+resource path, such as @samp{./datafile.ext} 
+is preferable. 
 
 @item @b{url}, @i{optional}
-This optional attribute allows to specifiy an online address for the external data
-file. Only wellformed xml data files can be accessd by this method.
+This optional attribute allows you to specify an online address for the external data
+file. This method can access only well-formed xml data files.
 
-The online access method should only be used as a backup address or due to very
-restrictive license conditions that make it impossible to distribute the data
-file together with Enigma.
+You should use the online access method only as a backup address or due to very restrictive
+license conditions that make it impossible to distribute the data file with Enigma.
 
 @end table
 
@@ -2059,8 +2024,7 @@
 none.
 
 @item @b{editor}, @i{optional, single occurence}
-This element can be used by special level editor programs to store information
-about themselves.
+Special level editor programs use this element to store information about themselves.
 
 @b{Attributes:}
 
@@ -2069,7 +2033,7 @@
 The name of the level editor.
 
 @item @b{version}, @i{required}
-A version number of the editor given as a string.
+A version number of the editor, given as a string.
 .
 @end table
 
@@ -2097,39 +2061,38 @@
 @b{Attributes:}
 
 @table @asis
- at item @b{easy}, @i{required}, values = "true", "false"
-If a level provides a second easy-difficulty mode set this attribute to @samp{true}.
-If only a one difficulty mode is supported set this attribute to @samp{false}.
+ at item @b{easy}, @i{required}, values = ``true'', ``false''
+If a level provides a second easy-difficulty mode, set this attribute to @samp{true}.
+If only a one difficulty mode is supported, set this attribute to @samp{false}.
 
- at item @b{single}, @i{required}, values = "true", "false"
-If a level provides a single player game as it is standard set this attribute to
- at samp{true}. Only if the level is a 2-player-network game only set this attribute
-to @samp{false}.
+ at item @b{single}, @i{required}, values = ``true'', ``false''
+If a level provides a single player game as it is standard, set this attribute to
+ at samp{true}. Set this attribute to @samp{false} only if the level is a 2-player-network game.
 
- at item @b{network}, @i{required}, values = "true", "false"
-If a level provides a 2-player-network game set this attribute to @samp{true}.
-If not set this attribute to @samp{false}.
+ at item @b{network}, @i{required}, values = ``true'', ``false''
+If a level provides a 2-player-network game, set this attribute to @samp{true}.
+If not, set this attribute to @samp{false}.
 
- at item @b{control}, @i{optional}, values = "force", "balance", "key", "other"; default = "force"
-This attribute defines the standard control mode of the level. A level can be
-played by using the mouse to generate forces on the marbles as it is the standard
-and only way up to Enigma 0.92. Or a level can be played using the mouse, or
-other input devices to balance the level-world with the marbles. Or the keyboard
-may be used with its cursor keys to move the actor like in classical Sokoban games.
+ at item @b{control}, @i{optional}, values = ``force'', ``balance'', ``key'', ``other''; default = ``force''
+This attribute defines the standard control mode of the level. You can play a level by using the
+mouse to generate forces on the marbles, since it is the standard and was the only way up to
+Enigma 0.92. Or you can play a level using the mouse, or other input devices to balance the
+level-world with the marbles. Or you may use the keyboard with its cursor keys to move the
+actor like in classic Sokoban games.
 
-Even though the user has always the last choice to define the input method he
-currently wants to use the author has to define the standard control-mode that
-is used by the scoring system. Only scores achieved in the defined control mode
-will be saved and evaluated for high score lists.
+Although the user has always the last choice to define the input method he/she
+currently wants to use, the author must define the standard control-mode that
+the scoring system uses. Enigma will save and evaluate only scores achieved in the defined
+control mode for high score lists.
 
- at item @b{scoreunit}, @i{optional}, values = "duration", "number"; default = "duration"
+ at item @b{scoreunit}, @i{optional}, values = ``duration'', ``number''; default = ``duration''
 This attribute defines the evaluation and display mode of score values. By the
-default @samp{duration} the score is intepreted as level solution time and displayed
-in a @b{MM:SS} format. In the @samp{number} mode scores are displayed as plain
-numbers and lower numbers be evaluated as better scores. This mode is appropriate
-for counting of pushes and moves.
+default @samp{duration}, the score is interpreted as level solution time and displayed
+in a @b{MM:SS} format. The @samp{number} mode displays scores as plain
+numbers and lower numbers will be evaluated as better scores. This mode is appropriate
+for counting pushes and moves.
 
- at item @b{scoretarget}, @i{optional}, values = "time", "pushes", "moves", *; default = "time"
+ at item @b{scoretarget}, @i{optional}, values = ``time'', ``pushes'', ``moves'', *; default = ``time''
 The score target triggers the measuring of score values. @samp{time} will take the
 solution time, @samp{pushes} counts the pushes of stones, @samp{moves} counts the
 moves of the actor. Any other value will call a Lua function for score values.
@@ -2144,9 +2107,9 @@
 @node <comments>, <score>, <modes>, Info metadata
 @subsection <comments>
 
-The optional comments node allows the author to add a few comments and to determine
-how they should be processed. Please note that comments will not be translated
-by the internationalization support.
+The optional comments node allows the author to add a few comments and to determine how
+they should be processed. Please note that internationalization support will not translate
+comments.
 
 @example
 <@i{el}:@b{comments}>
@@ -2165,42 +2128,42 @@
 
 @table @asis
 @item @b{credits}, @i{optional, single occurence}
-The place to honor people who did make your level running.
+The place to honor people who helped to make your level run.
 
 @b{Attributes:}
 @table @asis
- at item @b{showinfo}, @i{optional}, default = "false"
-A value of @samp{true} will make the message being displayed on the level info
+ at item @b{showinfo}, @i{optional}, default = ``false''
+A value of @samp{true} will display the message on the level info
 page
 
- at item @b{showstart}, @i{optional}, default = "false"
-A value of @samp{true} will make the message being displayed on startup of the
+ at item @b{showstart}, @i{optional}, default = ``false''
+A value of @samp{true} will display the message on startup of the
 level. Please use this feature only in rare cases.
 @end table
 
 @b{Contents:}
 
-The credits message itself. It may be broken over several lines. Whitespaces will
+The credits message itself. It may be broken into several lines. Whitespaces will
 be collapsed before display.
 
- at item @b{dedication}, @i{optional, single occurence}
-The place to dedicate the level to a honorable of a beloved person. Please use
+ at item @b{dedication}, @i{optional, single occurrence}
+The place to dedicate the level to a honorable or a beloved person. Please use
 this place instead of adding document-items within the level.
 
 @b{Attributes:}
 @table @asis
- at item @b{showinfo}, @i{optional}, default = "false"
-A value of @samp{true} will make the message being displayed on the level info
+ at item @b{showinfo}, @i{optional}, default = ``false''
+A value of @samp{true} will display the message on the level info
 page
 
- at item @b{showstart}, @i{optional}, default = "false"
-A value of @samp{true} will make the message being displayed on startup of the
+ at item @b{showstart}, @i{optional}, default = ``false''
+A value of @samp{true} will display the message on startup of the
 level. Please use this feature only in rare cases.
 @end table
 
 @b{Contents:}
 
-The dedication message itself. It may be broken over several lines. Whitespaces will
+The dedication message itself. It may be broken into several lines. Whitespaces will
 be collapsed before display.
 
 @item @b{code}, @i{optional, single occurence}
@@ -2211,8 +2174,8 @@
 
 @b{Contents:}
 
-The main code comment that may be an explanation of the @ref{<version>} status 
-or a todo list. It may be broken over several lines. This comment will not be 
+The main code comment, which may be an explanation of the @ref{<version>} status 
+or a todo list. It may be broken into several lines. This comment will not be 
 processed.
 
 @end table
@@ -2220,8 +2183,8 @@
 @node <score>, , <comments>, Info metadata
 @subsection <score>
 
-In this node the author should provide his own scoring values as hints and
-challenge for other players. All values are related to the control mode defined
+In this node, the author should provide his own scoring values as hints and
+a challenge for other players. All values are related to the control mode defined
 in @ref{<modes>}.
 
 @example
@@ -2232,15 +2195,15 @@
 
 @table @asis
 @item @b{easy}, @i{required}
-The solvage time for the easy mode. The format is either @var{@b{MM:SS}} where
+The solution time for the easy mode. The format is either @var{@b{MM:SS}}, where
 MM stands for the minutes, and SS for the seconds, or @var{@b{-}} if the author did
-not yet solve the level himself. For levels with a score unit mode @samp{number}
+not yet solve the level him/herself. For levels with a score unit mode @samp{number},
 the value would be the number of marble moves or pushes.
 
 @item @b{difficult}, @i{required}
-The solvage time for the difficult mode. The format is either @var{@b{MM:SS}} where
+The solution time for the difficult mode. The format is either @var{@b{MM:SS}}, where
 MM stands for the minutes, and SS for the seconds, or @var{@b{-}} if the author did
-not yet solve the level himself. For levels with a score unit mode @samp{number}
+not yet solve the level him/herself. For levels with a score unit mode @samp{number},
 the value would be the number of marble moves or pushes.
 
 @end table
@@ -2250,7 +2213,7 @@
 @node LUA code, Internationalization (i18n), Info metadata, Level Basics
 @section LUA code
 
-This elements takes any Lua code as a single chunk with nearly no limitations:
+This element takes any Lua code as a single chunk with nearly no limitations:
 
 @example
     <@i{el}:@b{luamain}><![CDATA[
@@ -2279,29 +2242,29 @@
 
 This element takes the main Lua code as its contents. 
 
-All other possible libraries that are declared as dependencies and Lua chunks 
+All other possible libraries that are declared as dependencies, and Lua chunks 
 supplied by XML elements are preloaded as described in @ref{<compatibility>}.
 Generally there is no more need to use Lua functions like @samp{Require} to load
 libraries. Just in case you need to control the point of execution were the
-library has to be loaded you can declare the library with the attribute
+library must be loaded, you can declare the library with the attribute
 @samp{el:preload="false"}. You should use the new function @ref{enigma.LoadLib}
 to load the library.
 
-The Lua code itself that is enclosed in a XML CDATA section. This limitates the
-Lua code to not use the reserved end marker @samp{]]>}. Any occurence has to be
+The Lua code that is enclosed in a XML CDATA section. This limits the
+Lua code not to use the reserved end marker @samp{]]>}. Any occurrence must be
 substituted by @samp{]] >}. 
 
-On the other hand the XML format extends the Lua capatibilities to the usage of
-encodings. You may use Lua strings and comments with Umlauts. But Lua identifiers
-are still limited to pure US-ASCII. The benefit is that you can use Umlauts and
-other non ASCII characters within it-document hints.
+On the other hand, the XML format extends the Lua capabilities to the use of
+encodings. You may use Lua strings and comments with Umlauts, but Lua identifiers are still
+limited to pure US-ASCII. The benefit is that you can use Umlauts and
+other non-ASCII characters within it-document hints.
 
 @node Internationalization (i18n), Usage, LUA code, Level Basics
 @section Internationalization (i18n)
 
-The internationalization of levels is one of the driving forces behind the level
-format changes. As you may have noticed there are two @samp{i18n} elements, one
-in the authors protected section and one in the public. Let us look how to use
+The internationalization of levels is a driving force behind the level
+format changes. As you may have noticed, there are two @samp{i18n} elements, one
+in the author's protected section and one in the public. Let us review how to use
 them for internationalization of the three documents of our @samp{demo_i18n.xml}
 level:
 
@@ -2339,63 +2302,63 @@
 @end example
 
 Two of the documents use key words to reference a string. The last one uses the
-English string itself as the key. There are two additional reserved keys 
+English string itself as the key. There are two additional reserved keys, 
 @samp{title} and @samp{subtitle}.
 
-For each string we like to translate or have translated we define a @samp{string}
+For each string we like to translate or have translated, we define a @samp{string}
 subelement of the protected section and add a @samp{english} subelement to the
 @samp{string} element itself. The @samp{string} element just takes a single 
-mandatory attribute - the key of the string. The @samp{english} element has a
-one mandatory attribute @samp{translate} that defaults to @samp{true} stating
-the author decision whether the string should be translated. In case the author
-does not want a string to be translated he can, and will, just add no @samp{string}
-element for this string at all. Thus the elements for the strings with the keys
+mandatory attribute, the key of the string. The @samp{english} element has a
+single mandatory attribute @samp{translate} that defaults to @samp{true}, stating
+the author's decision whether the string should be translated. If the author
+does not want a string to be translated, he can and must simply add no @samp{string}
+element for this string at all. Thus, the elements for the strings with the keys
 @samp{title} and @samp{Heureka!} are optional and quite unusual.
 
- at samp{title} and @samp{subtitle} have the English text given in the @ref{<identity>}
+ at samp{title} and @samp{subtitle} display the English text in the @ref{<identity>}
 element. All other strings referenced by keys need to add the
 English text as the content of the @samp{english} element. @samp{hint1} and 
 @samp{hint2} are examples.
 
-As we did choose quite ambiguous English texts it is very likly that translators
-who do not play the game and just get the text to translate may deliver a wrong
-translation. To avoid mistakes a level author may add a @samp{comment} attribute
-to the @samp{english} element. The translator receives this comment together with
-the English string as we will see lateron.
+Because we chose quite ambiguous English texts, it is very likely that translators
+who do not play the game but just translate the text, may deliver a wrong
+translation. To avoid mistakes, a level author may add a @samp{comment} attribute
+to the @samp{english} element. The translator receives this comment with
+the English string as we will see later.
 
-If the author is not native English speaking he should add himself @samp{translation}
+If the author is not native English-speaking, he should add his own @samp{translation}
 subelement to the @samp{sting} element. The @samp{translation} element has a
 single mandatory attribute @samp{lang} that takes the 2-character language
 abbreviation. The contents of the element is the translation itself.
 
-All translations added in the protected section take preceedance over any translators
-translation and will work directly after addition without waiting for a translators
+All translations added in the protected section take precedence over any translator's
+translation and will work directly after addition without waiting for a translator's
 translation.
 
-Last but not least we have a @samp{i18n} element in the public section. This element
-takes translation suggestions. They may be added by the author himself for further
-languages he is aware of. They may be added by other people on the way to the user
-or even the user himself.
+Last but not least, we have an @samp{i18n} element in the public section. This element
+takes translation suggestions. The author may add them him/herself for other
+languages he/she knows. They may be added by others on the way to the user,
+or even by the user himself.
 
-Translations in this section will again work directly after addition without
-waiting for a translators tranlation. But they will be preceeded by available
-translations provided by translators.
+Translations in this section will work immediately after addition without
+waiting for a translator's translation. However, available translations, provided by translators,
+will precede them.
 
 The format is identical to the protected section, with the exception that no
 @samp{english} element may be provided. The @samp{key} attribute in the 
 @samp{string} element must match exactly the @samp{key} attribute in the corresponding
- at samp{string} element in the protected section. There is one subtle difference
+ at samp{string} element in the protected section. One subtle difference exists,
 due to technical and practical reasons. @samp{key} attributes in the public
-section need to be XML identifiers - thus you can not provide public translations
-for strings that use the english phrase as the key. Choose a keyword and provide
-the english string in the public @samp{i18n} section to avoid these troubles.
+section need to be XML identifiers; thus, you cannot provide public translations
+for strings that use the English phrase as the key. Choose a keyword and provide
+the English string in the public @samp{i18n} section to avoid these troubles.
 
-The @samp{string} element in protected section as well as in the public section
+The @samp{string} element in protected section and in the public section
 must be unique concerning the attribute @samp{key} within the section. This means
 you should add translations for all known languages for a string in @samp{string}
-element in the proteced and one in the public section. The sequence does not matter.
+element in the protected and in the public section. The sequence does not matter.
 
-Let us have a look what the translator gets presented for each string. Let us 
+Let us review what the translator receives for each string. Let us 
 start with @samp{hint2} for the German translator:
 
 @example
@@ -2409,10 +2372,10 @@
 @end example
 
 @samp{msgid} is the English string. @samp{msgstr} takes the German translation.
-But the translator does not need to translate as the German tranlation was 
-given by the author in the @samp{#  use:} line
+But the translator does not need to translate since the author provided the German translation
+in the @samp{#  use:} line
 
-And as another example @samp{hint1} for the French translator:
+As another example, @samp{hint1} for the French translator:
 @example
 #  @i{level}: "@var{Demo Internationalization}"
 #  @i{author}: "@var{Ronald Lamprecht}" @i{email} "@var{ral@@users.berlios.de}"
@@ -2423,27 +2386,27 @@
 @b{msgstr} "@var{Lisez le document de droite}"
 @end example
 
-Here the public translation is given in the @samp{#  check:} line. As it contains
-at least one mistake the translator will correct it as shown in the @samp{msgstr}
+Here the author gives the public translation in the @samp{#  check:} line. Since it
+contains at least one mistake, the translator will correct it, as shown in the @samp{msgstr}
 string.
 
 @node Usage, Update and Upgrade, Internationalization (i18n), Level Basics
 @section Usage
 
-After all the theory lets have a look how to deal with the XML levelformat in
-practice. Of course you will not assemble all XML metadata from scratch for
+After all the theory, let's look at how to deal with the XML levelformat in
+practice. Of course, you will not assemble all XML metadata from scratch for
 every new level you write. You should use templates. You can start with any
-existing level, f.e. the @samp{demo_i18n.xml} that is supplied with this
-documentation. Add your personal data to your template and store it as basis for all new levels
-you write.
+existing level, for example, the @samp{demo_i18n.xml} supplied with this
+documentation. Add your personal data to your template and store it as the basis for all new
+levels you write.
 
-Some level authors are very used to the Lua file format as their favorite editor supports
+Some level authors are very familiar with the Lua file format since their favorite editor supports
 Lua files with syntax coloring. The XML file name and the XML elements will cause
-their editor to use XML syntax coloring. As these authors are nevertheless used
-to supply metadata in the header of their Lua levels as non standardized Lua 
-comments we decided to support a similar Lua compatible XML format. We call it 
-"Lua commented XML" as it simply comments out all XML lines with the Lua comment
- at samp{--xml-- }. For example
+their editor to use XML syntax coloring. Nevertheless, these authors are used
+to supplying metadata in the header of their Lua levels as non-standardized Lua 
+comments; we decided to support a similar Lua-compatible XML format. We call it 
+``Lua commented XML'' since it simply comments out all XML lines with the Lua comment
+ at samp{--xml-- }. For example:
 
 @example
 --xml-- <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
@@ -2477,61 +2440,61 @@
 --xml-- </el:level>
 @end example
 
-Please note that each XML metadata line has to start exactly with @samp{--xml-- },
-8 charcters including the space at the end! An additional limitation of the
-Lua commented XML format arises from Lua's capability of handling character
-encodings. You need to limit yourself to @samp{UTF-8} or of cause @samp{US-ASCII}
-to successfully use the Lua commented XML format. Please remember, that even
-though the XML part is Lua commented, it will still be evaluated and has thus
-to valid.
+Please note that each XML metadata line must start exactly with @samp{--xml-- },
+8 characters, including the space at the end! An additional limitation of the
+Lua-commented XML format arises from Lua's capability of handling character
+encodings. You need to limit yourself to @samp{UTF-8} or, of course @samp{US-ASCII}
+to successfully use the Lua-commented XML format. Please remember, that
+although the XML part is Lua-commented, it must still be evaluated and thus must be
+valid.
 
-Every level stored in this Lua commented XML format as a file with extension
- at samp{.lua} can be used locally for command line usage as well as in any level
-package that is stored on the Enigma's users home directory. But Lua commented XML
-levels can not be stored on Internet servers and cannot be online updated. Thus
-this format is good for level development, but the levels should be converted
+Every level stored in this Lua-commented XML format as a file with extension
+ at samp{.lua} can be used locally for command line use as well as in any level
+package that is stored on the Enigma user's home directory. However, Lua-commented XML
+levels cannot be stored on Internet servers or be updated online. Thus,
+this format is good for level development, but you should convert the levels
 to the pure XML format for distribution. Please note that Enigma looks for XML levels
-first, and uses Lua levels only if no XML level could be found.
+first, and uses Lua levels only if it can't find an XML level.
 
-Another usage of Lua commented XML levels is the format backward compatibility to 
-Enigma 0.92. As long as levels do not use new Enigma features you can include
+Another use of Lua-commented XML levels is the format backward compatibility to 
+Enigma 0.92. If levels do not use new Enigma features, you can include
 your levels in Enigma 0.92 level packages in this format.
 
-As you may need to convert levels several times between the XML and the Lua format
+Since you may need to convert levels several times between the XML and the Lua format,
 we do provide tools for conversion: @samp{xml2lua} and @samp{lua2xml}. Both are
 very simple Lua 5 scripts that you can execute as 
- at samp{lua xml2lua demo_simple.xml > demo_simple.lua} with a proper installed
-Lua 5 version. On Unix systems you can mark the scripts as executables and
+ at samp{lua xml2lua demo_simple.xml > demo_simple.lua} with a properly installed
+Lua 5 version. On Unix systems, you can mark the scripts as executables and
 simply call @samp{xml2lua demo_simple.xml > demo_simple.lua}.
 
-Of course you can add the convertion algorithm as simple macros for your favorite
+Of course you can add the conversion algorithms as simple macros for your favorite
 editor. Please publish any editor macros you write.
 
-As you fiddle with the XML metadata you may of course produce syntactical errors.
+As you fiddle with the XML metadata, you may produce syntactical errors, of course.
 You can validate your level by trying to start it with Enigma. XML errors are
-output as Lua errors are. In case the error messages are too long to read you may
-want to start Enigma from the command line with option @samp{--log} and read the
+output as Lua errors are. If the error messages are too long to read, you may
+want to start Enigma from the command line with the option @samp{--log} and read the
 messages printed to the command line or written to the file @samp{stdout.txt} on
 the current working directory for Windows systems.
 
-Of course you can use any external XML validation tool, too. You just need to
+Of course, you can use any external XML validation tool, too. You just need to
 copy the schema file @samp{level.xsd} on the same directory as the level itself.
 Possible validation tools are the Xerces-C sample application 
- at samp{DOMPrint.exe -n -s -f -v=always level.xml} or validating editors like
+ at samp{DOMPrint.exe -n -s -f -v=always level.xml} or validating editors, such as
 @url{http://www.freexmleditor.com/, Exchanger XML Lite}. Such editors will provide
 you with selections of all possible elements and attributes at each position.
 
 @node Update and Upgrade, Libraries , Usage, Level Basics
 @section Update and Upgrade
 
-Enigma is capable to load new level versions as we provide all necessary 
+Enigma is able to load new level versions since we provide all necessary 
 attributes in the @ref{<version>} element.
 
-If Enigma loads a new level version that differs just in the @samp{@b{revision}}
-we speak of an @samp{@b{update}}. Updates can be performed quite automatically
-and old versions can be replaced by the updates as they are guaranteed by the
-author to be compatible in scoring and dependencies. In the protected info
-element the author should provide a download address for automatic updates:
+If Enigma loads a new level version, which differs just in the @samp{@b{revision}}, we speak of
+an @samp{@b{update}}. You can perform updates automatically and replace old versions with
+the updates, since the author guarantees them to be compatible in scoring and
+dependencies. The  author should provide a download address for automatic updates in the
+protected info element:
 
 @example
 <@i{el}:@b{update} @i{el}:@b{url}="@var{http://myLevelServer.org/path/level_1.xml}"/>
@@ -2541,18 +2504,17 @@
 
 @table @asis
 @item @b{url}, @i{required}
-A longtime valid complete address for update downloads of this level in the 
-same score and release version.
+A long-term valid, complete address for update downloads of this level in the same score and
+release version.
 
 @end table
 
-If the author of a level introduces incompatibilities into the level he increases 
-the release version of the level and stores it with a new filename. The download
-of such a new level version we call @samp{@b{upgrade}}.
+If the author of a level introduces incompatibilities into the level, he increases the release
+version of the level and stores it with a new filename. We call the download of such a new level
+version an @samp{@b{upgrade}}.
 
-To publish the availability of a upgrade release the author should update the 
-previous release with a final revision that just adds an upgrade element that
-announces the new release:
+To publish the availability of an upgrade release, the author should update the previous release
+with a final revision that simply adds an upgrade element that announces the new release:
 
 @example
 <@i{el}:@b{upgrade} @i{el}:@b{url}="@var{http://myLevelServer.org/path/level_2.xml}" @i{el}:@b{release}="@var{2}"/>
@@ -2562,7 +2524,7 @@
 
 @table @asis
 @item @b{url}, @i{required}
-A longtime valid complete address for upgrade downloads of this level. A path
+A long-term valid, complete address for upgrade downloads of this level. A path
 to the new file.
 
 @item @b{release}, @i{required}
@@ -2570,26 +2532,25 @@
 
 @end table
 
-As the author cannot update all distributed levels himself to announce the
-availability of the new release we added another upgrade element in the public
-section. Level administrators can use this element for the same purpose with
-the same syntax without modifying the authors protected section.
+Since the author cannot update all distributed levels himself to announce the availability of the
+new release, we added another upgrade element in the public section. Level administrators can
+use this element for the same purpose, with the same syntax, without modifying the author's
+protected section.
 
 @node Libraries, , Update and Upgrade, Level Basics
 @section Libraries
 
-Libraries are collections of Lua functions for reusage in many levels. To make
-use of a libray you have to declare it as an dependency as described in
- at ref{<compatibility>}. If you preload the library that is all you have to do to
-use the library. Otherwise you can use the function @ref{enigma.LoadLib} to
+Libraries are collections of Lua functions for reuse in many levels. To use a library, you must
+declare it as an dependency, as described in @ref{<compatibility>}. Preloading the library is all
+you have to do to use the library. Otherwise, you can use the function @ref{enigma.LoadLib} to
 load the library at a certain point of execution.
 
-Enigma provides several very usefull libraries. You fill find them on the system
-path in the subdirectory @samp{levels/lib}. Most of them are document in line.
-For @samp{ant} you will find a seperate documentation file
- at samp{doc/ant_lua.txt}.
+Enigma provides several very useful libraries. You will find them on the system
+path in the subdirectory @samp{levels/lib}. Most of them are documented in-line.
+You will find a separate documentation file
+ at samp{doc/ant_lua.txt} for @samp{ant}.
 
-In this section we will concentrate on the aspects of writing and maintaing
+In this section, we will concentrate on the aspects of writing and maintaining
 libraries:
 
 @menu
@@ -2601,18 +2562,18 @@
 @subsection Writing a Library
 
 Library files are nearly identical to level files. The main difference is the
-attribute @samp{el:type} in the @samp{info} element which should be set to 
- at samp{library}. All other elements and attributes have to be provided as they
-have to be for levels. Of course all scoring related attributes will never be
-evaluated and should be set to defaults.
+attribute @samp{el:type} in the @samp{info} element, which you should set to 
+ at samp{library}. You must provide all other elements and attributes as you
+must for levels. Of course no scoring related attributes will ever be
+evaluated and you should set them to default.
 
-Libraries may depend on others, they have to provide an id and a release number.
-Several releases of a library can coexist and they can be updated and upgraded
-if the necessary information is given. Of course libraries may contain document
-strings that can be localized if the @samp{i18n} elements are provided.
+Libraries may depend on others, so you must provide an id and a release number.
+Several releases of a library can coexist and you can update and upgrade them
+if you provide the necessary information. Of course, libraries may contain document
+strings that can be localized if you provide the @samp{i18n} elements.
 
 The @samp{el:luamain} element takes the complete Lua code as it does for levels.
-Lets have a look at the essential XML parts of a library:
+Let's look at the essential XML parts of a library:
 
 @example
 <?xml version="1.0" encoding="@var{UTF-8}" standalone="no" ?>
@@ -2641,30 +2602,27 @@
 @node Maintaining a Library, , Writing a Library, Libraries
 @subsection Maintaining a Library
 
-Libraries may exist in different releases and revisions. Library versions that
-just differ in the revision denote compatible versions. Library versions that
-introduce incompatibilities have to differ in the release number. But as existing
-leves may depend on the legacy behaviour of the older release both library
-release versions have to be maintained and distributed with Enigma at the same
-time.
+Libraries may exist in different releases and revisions. Library versions that differ simply  in the
+revision, denote compatible versions. Library versions that introduce incompatibilities must
+differ in the release number. However, since existing levels may depend on the legacy behavior
+of the older release, you must maintain both library release versions and distribute them with
+Enigma at the same time.
 
-To coexist these different library releases have to follow a strict naming
-scheme. Every library has a base name. In the example above it is @samp{lib/ant}.
-The filename of a given release is the basename with addition of an underscore
-and the release number plus suffix xml. Thus release 2 of @samp{lib/ant} has
-to be stored as @samp{lib/ant_2.xml}.
+To coexist, these different library releases must follow a strict naming scheme. Every library has
+a base name. In the example above it is @samp{lib/ant}.
+The filename of a given release is the basename with the addition of an underscore and the
+release number plus the suffix @samp{xml}. Thus, you must store release @samp{lib/ant} as
+ at samp{lib/ant_2.xml}.
 
-If you look at the lib directory you may wonder that most library files are
-stored without release number addition to the basename. This is due to 0.92
-Lua level format compatibility support. One, and of course only one, release of
-each library can be stored without release number addition to the basename.
-This version will be loaded from pure Lua levels that do not provide any
-information of the required library release.
+If you look at the lib directory, you may wonder that Enigma stores most library files without
+release number addition to the basename. This is due to 0.92 Lua level format compatibility
+support. You can store one, and of course only one, release of each library without release
+number addition to the basename. Enigma will load this version from pure Lua levels that do
+not provide any information of the required library release.
 
-In case a library file with complete filename is not present the default library 
-file without release number addition will be loaded for XML load requests, too.
-But the future belongs to the new naming scheme and every new library should
-follow it from the beginning.
+If a library file with a complete filename is not present, the default library file without release
+number addition will be loaded for XML load requests, too. Yet the future belongs to the new
+naming scheme, and every new library should follow it from the beginning.
 
 
 @node Objects, Variables, Level Basics, Top
@@ -2734,7 +2692,7 @@
 @item fastfire
 Sets if the fire spreads fast.
 @item initfire
-Sets if the floor starts burning on initialisation.
+Sets if the floor starts burning on initialization.
 @end table
 
 
@@ -2824,9 +2782,9 @@
 @node fl-abyss, fl-ac[black/white], Regular floor tiles, Floors
 @subsection fl-abyss
 
-Kills marbles that roll onto it, unless they're protected by
+Kills marbles that roll onto it, unless they're protected by an
 @ref{it-umbrella}.  @ref{st-wood} transforms this floor into
- at code{fl-stwood}.  Marbles may jump over @ref{fl-abyss} with an
+ at code{fl-stwood}.  Marbles may jump over an @ref{fl-abyss} with an
 @ref{it-spring[1/2/board]}.  Compare with @ref{it-abyss},
 @ref{fl-water} and @ref{fl-swamp}.
 
@@ -2835,7 +2793,7 @@
 @subsection fl-ac[black/white]
 
 Marbles on this floor are controlled by player 0 only (who has
- at ref{ac-blackball} by default) respectively player 1 only
+ at ref{ac-blackball} by default), respectively player 1 only
 (@ref{ac-whiteball} by default).  See @ref{it-changefloor} for an item
 interacting with these floors.
 
@@ -2879,8 +2837,8 @@
 @node fl-dummy, fl-gradient, fl-bridge, Floors
 @subsection fl-dummy
 
-Prints its Oxyd code when entered.  Used for maintaining purposes.
-Compare with @code{st-dummy} (@ref{Oxyd Compatibility Stones}) and
+Prints its Oxyd code when entered.  Used for maintenance purposes.
+Compare it with @code{st-dummy} (@ref{Oxyd Compatibility Stones}) and
 @code{it-dummy} (@ref{System and Debug Items}).
 
 
@@ -2899,7 +2857,7 @@
 @item force
 overrides @code{enigma.SlopeForce}
 @item type
-between 1 and 24, determines the direction of the gradient and its design
+between 1 and 24, determines the direction of the gradient and its design.
 @end table
 
 Direction of the forces to certain types: 1 and 21: south, 2 and 22:
@@ -2960,8 +2918,8 @@
 @subsection fl-space
 
 This floor prevents a player from controlling the marble
-(@code{mouseforce = 0}), but in contrast to @ref{fl-nomouse} there
-also is no friction, such that marbles seldom get stuck on space.
+(@code{mouseforce = 0}), but in contrast to @ref{fl-nomouse}, there
+also is no friction, so that marbles seldom get stuck on space.
 
 
 @node fl-space-force, fl-swamp, fl-space, Floors
@@ -2971,51 +2929,51 @@
 but adds a vertical force of the amount given in
 @code{enigma.FlatForce}.  This is obsolete since you can use
 @code{fl-space} with @code{force_y}-attribute (see @ref{Common Floor
-Attributes}).  Note however, that the @code{force_y}-attribute of
- at code{fl-space-force} is overriden by @code{enigma.FlatForce}.
+Attributes}).  Note however, that the @code{enigma.FlatForce} overrides the
+ at code{force_y}-attribute of @code{fl-space-force}.
 
 
 @node fl-swamp, fl-thief, fl-space-force, Floors
 @subsection fl-swamp
 
-Kills marbles that roll onto it, unless they're protected by
+Kills marbles that roll onto it, unless they're protected by an
 @ref{it-umbrella}.  @ref{st-wood} transforms this floor into
 @code{fl-stwood}.
 
 Once in the swamp, marbles constantly sink with the speed
-given by @code{enigma.SwampSinkSpeed} (see @ref{Variables})
-and may raise again when moving fast enough (compare with
+given by @code{enigma.SwampSinkSpeed} (see @ref{Variables}),
+and may rise again when moving fast enough (compare with
 @ref{fl-water} and @ref{fl-abyss}).
 
-Marbles may jump over @ref{fl-swamp} with an
+Marbles may jump over the swamp with an
 @ref{it-spring[1/2/board]}.
 
 
 @node fl-thief, fl-water, fl-swamp, Floors
 @subsection fl-thief
 
-This floor steals one item from the players inventory. It looks like
+This floor steals one item from the player's inventory. It looks like
 the simple floor @code{fl-bluegray}. Compare with @ref{st-thief} for
 details.
 
-Like @code{st-thief}, @code{fl-thief} can be deactivated with
- at ref{st-chess_[black/white]}, leaving an @ref{it-bag} behind filled
+Like @code{st-thief}, @ref{st-chess_[black/white]} can deactivate @code{fl-thief}, leaving an
+ at ref{it-bag} behind, filled
 with the items the thief stole from the actors (plus possibly the item
-that already lay on the floor if it could be picked up; if it is a
+that already lay on the floor, if it could be picked up; if it is a
 static item, no @code{it-bag} is produced). 
 
 
 @node fl-water, , fl-thief, Floors
 @subsection fl-water
 
-Kills marbles that roll onto it, unless they're protected by
+Kills marbles that roll onto it, unless they're protected by an
 @ref{it-umbrella}.  @ref{st-wood} transforms this floor into
 @code{fl-stwood}. 
 
 Once in the water, marbles constantly sink with the speed
 given by @code{enigma.WaterSinkSpeed} (see @ref{Variables}).
-In constrast to @ref{fl-swamp} they can't raise again, as
-long as they're in the water. Also compare with @ref{fl-abyss}.
+In contrast to @ref{fl-swamp}, they can't rise again, as
+long as they're in the water.
 
 Marbles may jump over @ref{fl-water} with an
 @ref{it-spring[1/2/board]}.
@@ -3208,13 +3166,13 @@
 @node System and Debug Items
 @subsection System and Debug Items
 
-There are several items that are not meant as items in the usual way:
+Enigma includes several items that are not meant as items in the usual way:
 
 @table @code
 @item it-1pkillstone, it-2pkillstone
 Kills the stone on the same tile in single-player mode
-(resp. multi-player mode). Unused due to missing networking capability
-of Enigma.
+(correspondingly in multi-player mode). Unused, due to Enigma's missing networking
+capability.
 
 @item it-bridge-oxyd, it-bridge-oxyd_active
 Used for Oxyd compatibility to animate bridges. Use @ref{fl-bridge}
@@ -3225,7 +3183,7 @@
 itself.
 
 @item it-dummy
-Prints its own oxyd code when picked up or used. Compare
+Prints its own Oxyd code when picked up or used. Compare
 @ref{fl-dummy} and @code{st-dummy} (@ref{Oxyd Compatibility Stones}).
 
 @item it-easykillstone
@@ -3247,7 +3205,7 @@
 
 @item it-signalfilter[0/1]
 Transforms signal 1 to signal 0 or 1, forgets signal 0. Used for Oxyd
-Compatibility only.
+compatibility only.
 
 @end table
 
@@ -3263,7 +3221,7 @@
 
 When a stone is pushed over them or an @ref{it-spade} is used on them,
 they decrease their size: @code{it-hill} and @code{it-hollow} become
- at code{it-tinyhill} and @code{it-tinyhollow}, the latter two disappear
+ at code{it-tinyhill} and @code{it-tinyhollow}; the latter two disappear
 completely.
 
 @strong{Messages}
@@ -3292,7 +3250,7 @@
 (@code{it-hollow} or @code{it-tinyhollow}), the level succeeds.
 
 Use the @code{essential}-attribute if there are more holes than small
-whiteballs in a level and you want to determine which of the holes are
+whiteballs in a level, and you want to determine which of the holes are
 needed to finish the level (1 means this hollow must be filled with a
 whiteball to end the level).
 
@@ -3300,8 +3258,8 @@
 @code{essential=1} in 3 holes.  The game will end when the 3
 whiteballs are inside the 3 marked holes.
 
-Note that hollows might appear or disappear during the game, they are
-handled the same way as descriped.
+Note that hollows might appear or disappear during the game; they are
+handled the same way as described above.
 
 
 @c -------------------- Fire and Extinguisher  --------------------
@@ -3310,10 +3268,10 @@
 
 Compare @ref{The 1.0-Fire System}.
 
-There are six items special to the fire system:
+Six items are particular to the fire system:
 @itemize
 @item Use @code{it-burnable} to allow a floor tile to catch fire, and
-it ignites from explosions like from @ref{it-dynamite},
+it ignites from explosions, like from @ref{it-dynamite},
 @ref{it-blackbomb} and @ref{it-whitebomb}.
 @item @code{it-burnable_oil} is the visible variant of the invisible
 @code{it-burnable}.
@@ -3326,7 +3284,7 @@
 @end itemize
 
 Use @code{it-extinguisher} to set @code{it-burnable_fireproof}. After
-using it once, it becomes @code{it-extinguisher_medium} which guards
+using it once, it becomes @code{it-extinguisher_medium}, which guards
 less floor, and itself becomes @code{it-extinguisher_empty}, which can
 be laid down again.
 
@@ -3337,7 +3295,7 @@
 Use this to set an invisible alternative to @ref{fl-abyss}.  Note
 however, that @ref{st-wood} doesn't fill @code{it-abyss} as it does
 with @code{fl-abyss}.  Marbles may jump over @code{it-abyss} with an
- at code{it-spring[1/2/board]}, in contrast to @ref{it-death}.  Also
+ at code{it-spring[1/2/board]}, in contrast to @ref{it-death}.  Also,
 compare to @ref{it-booze-broken}.
 
 
@@ -3347,8 +3305,8 @@
 
 As long as @code{it-bag} is at the first place in the inventory, new
 items are put into the bag instead of the inventory, until the bag is
-full (13 items).  @code{it-bag} can be dropped.  When picked up again,
-items from the bag are put back into inventory (until it is full).
+full (13 items). The player can drop @code{it-bag} anytime.  When picked up again,
+items from the bag are put back into the inventory (until it is full).
 
 @code{it-bag} is created by @ref{st-thief} and @ref{fl-thief} when
 they're captured by @ref{st-chess_[black/white]}.
@@ -3375,7 +3333,7 @@
 @ref{st-wood}).
 
 When exploding, @code{it-blackbomb} ignites or destroys neighboring
-items and destroys its own floor tile by replacing it against
+items, and destroys its own floor tile by replacing it against
 @code{fl-abyss}. See also @ref{it-whitebomb} for a stronger version.
 
 @strong{Messages}
@@ -3399,7 +3357,7 @@
 @node it-blocker
 @subsection it-blocker
 
-This item is the shrinked form of @ref{st-blocker}.  When it is hit by
+This item is the shrunken form of @ref{st-blocker}.  When it is hit by
 @ref{st-bolder}, it becomes @code{st-blocker} again.  It can be
 destroyed with @ref{it-brake}.
 
@@ -3407,7 +3365,7 @@
 
 @table @code
 @item trigger, openclose
-If shrinked, grow. Otherwise: change internal state, only sensible
+If shrunken, grow. Otherwise, change internal state; only sensible
 while a stone is on top of @code{it-blocker}.
 @item open, close
 These are complicated, but in most cases @code{close} makes the item
@@ -3422,7 +3380,7 @@
 @item it-blocker
 @item it-blocker-new
 doesn't grow at once when @code{st-bolder} just arrives (acts as if
-recently shrinked)
+recently shrank)
 @end table
 
 
@@ -3431,7 +3389,7 @@
 @subsection it-booze
 
 When used, the actor becomes slower for a short period of time.  Note
-that @code{it-booze} is still under development, behaviour might be
+that @code{it-booze} is still under development; its behavior might be
 changed.
 
 When hit by a stone, @code{it-booze} transforms into
@@ -3446,7 +3404,7 @@
 stone over it. Kills a marble that touches it, but not when it is jumping with
 @ref{it-spring[1/2/board]} or protected by @ref{it-umbrella}, compare
 @ref{it-abyss} and @ref{it-death}.  Can be removed with @ref{it-brush}
-while jumping over it or otherwise protected.
+while jumping over it, or otherwise protected.
 
 
 @c -------------------- Brake Item --------------------
@@ -3465,8 +3423,8 @@
 This item can be used to make some invisible stones visible
 (@code{st-actorimpulse_invisible} (see @ref{st-actorimpulse}),
 @code{st-break_invisible} (see @ref{Breakable Stones}),
- at code{st-stonebrush} (see @ref{st-invisible}) and to remove debris
-from the level (@ref{it-cross}, @ref{it-squashed},
+ at code{st-stonebrush} (see @ref{st-invisible}), and to remove debris
+from the level: (@ref{it-cross}, @ref{it-squashed},
 @ref{it-booze-broken}, @code{it-glasses-broken} (see
 @ref{it-glasses}), @code{it-burnable_ash},
 @code{it-burnable_fireproof} (see @ref{Fire and Extinguisher})).
@@ -3489,7 +3447,7 @@
 @code{fl-acwhite} below it after an actor has left it (see
 @ref{fl-ac[black/white]}).  This way the marble can't roll back
 as easily as before.  Try the original Per.Oxyd Link Level 69 to see
-this scarcely used item in action.
+this scarcely-used item in action.
 
 
 @c -------------------- Cherry --------------------
@@ -3508,7 +3466,7 @@
 @node it-coffee
 @subsection it-coffee
 
- at code{it-coffee} is supposed to pause the game. Not implemented yet.
+ at code{it-coffee} is supposed to pause the game; not implemented yet.
 
 
 @c -------------------- Coins --------------------
@@ -3517,7 +3475,7 @@
 
 Activates @ref{st-coinslot}. 
 
-When hit by a stone, @code{it-coin2} transforms into @code{it-coin4}
+When hit by a stone, @code{it-coin2} transforms into @code{it-coin4},
 and @code{it-coin1} into @code{it-coin2}.  A laser beam transforms
 @code{it-coin1}, @code{it-coin2}, and @code{it-coin4} into
 @ref{it-umbrella}, @ref{it-hammer}, and @ref{it-extralife}.
@@ -3591,8 +3549,8 @@
 
 When a marble remains on the cross for at least 10 seconds,
 @code{it-cross} performs its @code{action/target} (only once, not
-every 10 seconds).  Similar functions have @ref{it-trigger} and
- at ref{it-sensor}.
+every 10 seconds).   @ref{it-trigger} and
+ at ref{it-sensor} have similar functions.
 
 @strong{Attributes}
 
@@ -3607,7 +3565,7 @@
 @item brush
 remove @code{it-cross}
 @item signal
-performs @code{action/target} with inverted signal-data, works only in
+performs @code{action/target} with inverted signal-data; works only in
 Per.Oxyd-compatibility mode
 @end table
 
@@ -3625,9 +3583,9 @@
 @node it-document
 @subsection it-document
 
-This item looks like a piece of paper and contains text messages that
+This item looks like a piece of paper and contains a text message that
 can be displayed by activating the item.  It is destroyed by
-explosions (like @ref{it-blackbomb}, @ref{it-whitebomb},
+explosions (like from @ref{it-blackbomb}, @ref{it-whitebomb},
 @ref{st-bombs} and also @ref{it-dynamite}).
 
 @strong{Attributes}
@@ -3666,7 +3624,7 @@
 @code{it-dynamite} can be ignited by dropping it, by lasers, fire,
 other explosions (@ref{it-blackbomb}, @ref{it-whitebomb}, other
 @code{it-dynamite} and @ref{st-bombs}).  While burning, it can't be
-picked up.  During explosion, it ignites neighbouring items and leaves
+picked up.  During explosion, it ignites neighboring items and leaves
 an @code{it-hollow} behind (see @ref{Hills and Hollows}).
 
 @strong{Messages}
@@ -3703,7 +3661,7 @@
 @node it-floppy
 @subsection it-floppy
 
-The floppy disk is needed to activate the Floppy switch (see
+The floppy disk is needed to activate the floppy switch (see
 @ref{st-floppy}).
 
 
@@ -3716,8 +3674,8 @@
 @ref{st-death}).
 
 @code{it-glasses} breaks when a stone is pushed over it, and becomes
-the inactive version @code{it-glasses-broken}.  @code{it-glasses} is
-the result of the laser transformation of @ref{it-extralife}.
+the inactive version @code{it-glasses-broken}.  @code{it-glasses}
+results from the laser transformation of @ref{it-extralife}.
 
 @strong{Variants}
 
@@ -3733,8 +3691,8 @@
 
 The hammer is used to destroy some stones, see @ref{Breakable
 Stones} and @ref{st-lightpassenger}. It also transforms into
- at ref{it-sword} when hit with a laser beam and is itself
-laser-transformation-result of @ref{it-sword} and @code{it-coin2} (see
+ at ref{it-sword} when hit with a laser beam and is itself a
+laser transformation result of @ref{it-sword} and @code{it-coin2} (see
 @ref{it-coin}).
 
 
@@ -3801,8 +3759,8 @@
 @item
 Changes direction of a bolder stone (@ref{st-bolder}).
 @item
-Scrambles blue puzzle stones instead of pushing, lets complete
-clusters explode (@ref{st-puzzle}).
+Scrambles blue puzzle stones instead of pushing, causes complete
+clusters to explode (@ref{st-puzzle}).
 @c @item
 @c not implemented?  st-stoneimpulse_movable doesn't pulse
 @item
@@ -3813,7 +3771,7 @@
 @item
 Makes rubberband stones movable (@ref{st-rubberband}).
 @item
-Changes colour of a chess stone (@ref{st-chess_[black/white]}).
+Changes the color of a chess stone (@ref{st-chess_[black/white]}).
 @item
 Activates @code{st-yinyang3} (@ref{st-yinyang}).
 @end itemize
@@ -3869,7 +3827,7 @@
 @node it-pencil
 @subsection it-pencil
 
-Try to scratch an @ref{it-cross} into the floor, pencil is lost
+Try to scratch an @ref{it-cross} into the floor; the pencil is lost
 after this. Scratching onto ice results in a crack, scratching
 while flying or on certain floors results in dropping the pencil.
 
@@ -3893,7 +3851,7 @@
 
 Pipes are used by @ref{st-mail} to transport items over large
 distances or onto unreachable grounds.  Pipes can be destroyed by
-explosions (like from @ref{it-blackbomb} or @ref{it-whitebomb}).
+explosions (such as from @ref{it-blackbomb} or @ref{it-whitebomb}).
 
 @strong{Variants}
 
@@ -3921,7 +3879,7 @@
 @subsection it-puller
 
 When dropped, these items pull a stone from the direction they point
-to to their own position.  They explode during this, shattering
+to, to their own position.  They explode during this, shattering
 marbles near them.
 
 @strong{Variants}
@@ -3964,7 +3922,7 @@
 
 @table @code
 @item target
-The target to connect with. It has to be an the name of an other actor or a stone.
+The target to connect with. It must be the name of an other actor or a stone.
 @item length
 The natural length of the rubberband (default: 1)
 @item strength
@@ -3972,7 +3930,7 @@
 @item minlength
 The minimal length of the rubberband (default: 0)
 @item scissor
-Boolean value defining if already existing rubberbands to the actor should be cut off.
+Boolean value defining if already-existing rubberbands to the actor should be cut off.
 (Default: false)
 @end table
 
@@ -3989,12 +3947,12 @@
 @node it-seed
 @subsection it-seed
 
-There are three different seeds from which stones can grow:
+Stones can grow from three different seeds:
 @code{it-seed} creates @ref{st-wood}, @code{it-seed_nowood} creates
- at code{st-greenbrown-growing}, which results in the unmovable simple
-stone @code{st-greenbrown}, and @code{it-seed_volcano}, which creates
-an @ref{st-volcano}.  The name of the seed is inherited to the new
-stone.
+ at code{st-greenbrown-growing}, which produces the unmovable simple
+stone @code{st-greenbrown}, and @code{it-seed_volcano} that creates
+an @ref{st-volcano}.  The new
+stone inherits the name of the seed.
 
 In Oxyd-Magnum-compatibility mode, @code{it-seed} under
 @code{st-grate1} (see @ref{st-grate}) grows to the simple floor
@@ -4055,7 +4013,7 @@
 @strong{Attributes}
 
 @table @code
- at c @item size  couldn't find this in code, though annonced in remark
+ at c @item size couldn't find this in code, though announced in remark
 @item target, action
 as usual
 @end table
@@ -4099,17 +4057,17 @@
 @node it-spring[1/2/board]
 @subsection it-spring[1/2/board]
 
-Springs let marbles jump, e.g. over @ref{fl-water}, @ref{fl-swamp},
+Springs let marbles jump, e.g., over @ref{fl-water}, @ref{fl-swamp},
 @ref{fl-abyss}, @ref{it-abyss}, and laser beams.  Note that you can't
-jump over any kind of stone, and cannot pass @ref{st-grate} during the
+jump over any kind of stone, or pass @ref{st-grate} during the
 jump, even if you could on the ground.  The interplay of jumping and
-fire (@ref{The 1.0-Fire System}) will be target of future changes,
+fire (@ref{The 1.0-Fire System}) will be target of future changes;
 don't use them together yet.
 
 You can pick up and use @code{it-spring1} and @code{it-spring2}.  You
-keep the former in the inventory, but in general drop
+keep the former in the inventory, but in general, drop
 @code{it-spring2} when using.  @code{it-springboard} is fixed to the
-ground, you can only use it where it is.
+ground; you can only use it where it is.
 
 @strong{Variants}
 
@@ -4141,7 +4099,7 @@
 @node it-sword
 @subsection it-sword
 
-Used to neutralize @ref{st-knight}.  Laser-transforms into
+Used to neutralize @ref{st-knight}.  The laser transforms it into
 @ref{it-hammer} and vice versa.
 
 
@@ -4187,8 +4145,8 @@
 @ref{st-knight}, @ref{st-thief}, @ref{fl-abyss}, @ref{fl-water},
 @ref{fl-swamp}, @ref{fl-thief}, @ref{it-death}, @ref{it-abyss},
 @ref{it-booze-broken}, explosions, moving stones and the ``shatter''
-and ``fall''-messages - in other words: from all lethal situations and
-thiefs.
+and ``fall''-messages; in other words, from all lethal situations and
+thieves.
 
 @code{it-umbrella} can be destroyed by laserlight and is the result of
 laser-transforming an @code{it-coin1} (see @ref{it-coin}).
@@ -4271,7 +4229,7 @@
 @subsection it-weight
 
 Heightens the mass of the marble (making it more difficult to
-accelerate and guide) and can't be dropped.  Note that it can still be
+accelerate and guide) and it can't be dropped.  Note that it can still be
 stolen by @ref{st-thief} or @ref{fl-thief} and mailed away with
 @ref{st-mail}. 
 
@@ -4287,8 +4245,8 @@
 and by pushing stones over them (except for @ref{st-shogun-<sml>} and,
 in Oxyd compatibility mode, @ref{st-wood}).
 
-When exploding, @code{it-whitebomb} ignites or destroys neighbouring
-items and destroys all nine neighbouring floor tiles by replacing them
+When exploding, @code{it-whitebomb} ignites or destroys neighboring
+items and destroys all nine neighboring floor tiles by replacing them
 with @code{fl-abyss}.
 
 @strong{Messages}
@@ -4371,7 +4329,7 @@
 * Stone List::                  A complete list of all stones
 * Glassstones::                 A summary of all kinds of glassy stones
 * Breakable Stones::            A summary of all breakable stones
-* Oxyd Compatibility Stones::   Special stones for oxyd compatibility and debugging
+* Oxyd Compatibility Stones::   Special stones for Oxyd compatibility and debugging
 * st-actorimpulse::             Bumper Stones
 * st-big[brick/bluesand]::      Big Stones
 * st-[black/white]::            Black and White Stones
@@ -4423,7 +4381,7 @@
 * st-surprise::                 Surprise Stone
 * st-swap::                     Swap Stones
 * st-switch::                   Ordinary Switches
-* st-thief::                    Thiefs
+* st-thief::                    Thief (Thieves)
 * st-timer::                    Timers
 * st-timeswitch::               Time Switch
 * st-turnstile::                Turnstiles
@@ -4439,8 +4397,8 @@
 @strong{Simple stones}
 
 The following stone types are commonly used for ``decoration''.  They
-generally do not have special properties or abilities.  Three types of
-abbreviations are used in the tables: @code{[abc]} stands for any of the
+generally do not have special properties or abilities.  We use three types of
+abbreviations in the tables: @code{[abc]} stands for any of the
 characters in square brackets, @code{<abc>} stands for any subsequence
 of the characters between the angle brackets (in this case abc, ab, bc,
 a, b, c), and @code{@{1..9@}} indicates a sequence of numbers.
@@ -4728,9 +4686,9 @@
 @ref{fl-water} and @ref{fl-swamp}; see also @ref{st-firebreak[_move]}
 @end table
 
-For the mentioned objects see @ref{it-hammer}, @ref{it-dynamite},
+For the mentioned objects, see @ref{it-hammer}, @ref{it-dynamite},
 @ref{it-blackbomb}, @ref{st-bombs}, @ref{st-bolder}, @ref{it-brush}.
-Also compare @ref{st-plain}, as @code{st-plain_cracked} results from
+Also compare @ref{st-plain}, since @code{st-plain_cracked} results from
 @code{st-plain} when hit by a laser beam, and @code{st-plain[_move]}
 can be transformed into and out of @code{st-firebreak[_move]}.
 
@@ -4738,7 +4696,7 @@
 @node Oxyd Compatibility Stones, st-actorimpulse, Breakable Stones, Stones
 @subsection Oxyd Compatibility Stones
 
- at code{st-magic} disappears when hit strong enough.
+ at code{st-magic} disappears when hit hard enough.
 
 @code{st-dummy} prints its own Oxyd code when hit. Compare
 @code{it-dummy} (@ref{System and Debug Items}) and @ref{fl-dummy}.
@@ -4780,7 +4738,7 @@
 
 These stones are used to construct big clusters of stones that
 visually seem like one big stone.  Though mainly decorative, they also
-have a small special ability, as they are the only stones that can't
+have a small special ability, since they are the only stones that can't
 be swapped with @ref{st-swap} or @ref{st-pull} (besides @ref{st-oxyd}
 with true @code{static}-attribute).
 
@@ -4788,27 +4746,27 @@
 
 @table @code
 @item connections
-A number between 1 an 16.  Each bit in (connections-1) corresponds to
+A number between 1 and 16.  Each bit in (connections-1) corresponds to
 an open face of the stone.  You will normally simply use one of the
 Lua constants @code{PUZ_0001} to @code{PUZ_1111}.
 @end table
 
 @strong{Variants}
 
-There are two families of big stones, that differ in design:
+Two families of big stones differ in design:
 @code{st-bigbrick-<nesw>} (similar to @code{st-brick}) and
 @code{st-bigbluesand-<nesw>} (similar to @code{st-blue-sand}). 
 
 The term @code{<nesw>} denotes all non-empty substrings of
 @code{nesw}, describing the directions to which the single parts are
-open. Examples: @code{st-bigbluesand-nw} is a blue stone with border
+open. Examples: @code{st-bigbluesand-nw} is a blue stone with a border
 on the south and east side, @code{st-bigbrick-esw} is a brick-type
 stone which connects to the east, south and west, and has a border on
 the north side.
 
- at code{st-bigbrick} and @code{st-bigbluesand} without suffix are not
+ at code{st-bigbrick} and @code{st-bigbluesand}, without suffix, are not
 defined. Use @code{st-brick} and @code{st-blue-sand} to set single
-stones of these designs.  Note however, that these stones both are
+stones of these designs.  Note, however, that both these stones are
 swappable and pullable like normal stones.
 
 See @ref{st-puzzle} for another kind of cluster-building stones.
@@ -4817,7 +4775,7 @@
 @node st-[black/white], st-[black/white]balls, st-big[brick/bluesand], Stones
 @subsection st-[black/white]: Black and white stones
 
-These stones only let black respectively white marbles pass.
+These stones only let black, or respectively, white marbles, pass.
 
 @strong{Variants}
 
@@ -4826,16 +4784,16 @@
 @code{@dots{}2} has a diagonal bar, @code{@dots{}3} a cross and @code{@dots{}4}
 only consists of a black or white frame.
 
-See @ref{st-grate} for further stones which only special actors may
+See @ref{st-grate} for other stones that only special actors may
 pass.
 
 
 @node st-[black/white]balls, st-block, st-[black/white], Stones
 @subsection st-[black/white]balls: Blackballs and Whiteballs Stones
 
-Mainly used decorative, this stone also has a special function: When
+Mainly used as decorative, this stone also has a special function: When
 it receives a message from a stone, which is just hit by a black
-(resp. white) marble, it sends signal 1 to the neighbouring stones
+(or white, respectively) marble, it sends signal 1 to the neighboring stones
 west and east of it and 0 to north and south; or vice versa, depending
 on the position of the message-sending stone.
 
@@ -4847,7 +4805,7 @@
 @code{st-blackballs}.  This then opens the knocked door and the door in
 the opposite direction, while closing the doors in the perpendicular
 directions.  However, when @code{it-sensor} triggers because of the
-marble entering it, @code{st-blackballs} won't trigger as there is no
+marble entering it, @code{st-blackballs} won't trigger since there is no
 collision causing this event.
 
 
@@ -4873,7 +4831,7 @@
 1: shrink, 0: grow
 @end table
 
-Note that @code{st-blocker} becomes a new object when shrinking, such
+Note that @code{st-blocker} becomes a new object when shrinking, so
 that the messages @code{close} and @code{signal (0)} only make sense
 during transformation.
 
@@ -4991,7 +4949,7 @@
 When hit, the marble is provided with a constant electrostatic charge,
 given by the @code{charge}-attribute of @code{st-charge}.  The charge
 is confined to be between -1.0 and +1.0.  Actors with charges are
-drawn together respectively pushed apart by a force given by
+drawn together or pushed apart respectively, by a force given by
 multiplication of their charges and the factor
 @code{enigma.ElectricForce} (see @ref{Variables}) and divided by their
 relative distance.
@@ -5019,7 +4977,7 @@
 
 When hit, a chess stone makes a knight move: two steps in direction of
 the hit plus one step in direction of the vertical velocity
-component. @code{st-chess_black} can only be moved with the black
+component. @code{st-chess_black} can be moved only with the black
 marble, @code{st-chess_white} only with the white. When there is a
 chess stone of opposite color or a thief stone (@ref{st-thief}) at
 the target position of a knight move, this stone is destroyed.
@@ -5030,7 +4988,7 @@
 @ref{fl-thief}.
 
 Chess stones can't jump over or into fire (see @ref{The 1.0-Fire
-System}).  At least, a chess knight is brave enough not to get in
+System}).  At least, a chess knight is brave enough not to
 panic when fire starts to burn beneath.  Note that fire can't ignite
 the floor below an @code{st-chess_[black/white]}, in this context it
 acts like an immovable stone.  In the same sense, they don't act on
@@ -5127,7 +5085,7 @@
 
 When lightened or darkened, this stone also lightens and darkens
 neighboring @code{st-disco}, such that the light on a passage can be
-switched on and off just by sending one single message.
+switched on and off just by sending a single message.
 
 @strong{Messages}
 
@@ -5151,20 +5109,20 @@
 @node st-door, st-easymode, st-disco, Stones
 @subsection st-door: Doors
 
-Doors are designed to let actors pass or not, depended on their
+Doors are designed to let actors pass or not, depending on their
 internal state, which can be changed by triggers and other objects in
-game. There is a family of ``standard doors'' (referred to as
- at code{st-door}-variants) as well as three single variants
+the game. There is a family of ``standard doors'' (referred to as
+ at code{st-door}-variants) and three single variants
 (@code{st-door_a}, @code{st-door_b}, @code{st-door_c}), which differ
-in design and behaviour.
+in design and behavior.
 
 @code{st-door}-variants let actors and laser beams pass in all
 directions when they are opened, and block those perpendicular to the
 doors when @code{st-door} is closed. The other three have no
-distinguished directions, they let actors and laser beams pass if and
-only if they're open.
+distinguished directions, they let actors and laser beams pass if, and
+only if, they're open.
 
-When an @code{st-door}-variant is hit, the item at the doors position
+When an @code{st-door}-variant is hit, the item at the door's position
 performs its @code{action/target}-pair (you can use all items for
 this). There is nothing similar for the other variants.
 
@@ -5206,14 +5164,14 @@
 closed and like @code{st-grate} when open, @code{st-door_b} like
 @code{st-plain} and shrinks when opened, @code{st-door_c} also like
 @code{st-plain}, but @code{st-grate3} when opened.  Note that this is
-just design, they don't behave the same way.
+just design; they don't behave the same way.
 
 
 @node st-easymode, st-explosion, st-disco, Stones
 @subsection st-easymode: Easy Mode Stone
 
-In easy game mode this stone converts the floor at its position to
- at code{fl-normal}.  In normal game mode the stone removes any item at
+In easy game mode, this stone converts the floor at its position to
+ at code{fl-normal}.  In normal game mode, the stone removes any item at
 its position.  The stone itself never appears in either game mode; it
 removes itself immediately after performing its job.
 
@@ -5226,7 +5184,7 @@
 @subsection st-explosion: Explosion Stone
 
 This stone mimics an explosion when set, and destroys itself
-afterwards.  Actors in contact with it are shattered.
+afterwards.  Actors that contact it are shattered.
 
 
 @node st-fakeoxyda, st-fart, st-explosion, Stones
@@ -5347,12 +5305,12 @@
 @subsection st-grate: Grates
 
 Floating grates, mainly decorative.  @code{st-grate1} and
- at code{st-grate2} block jumping marbles, all other actors may pass.  In
+ at code{st-grate2} block jumping marbles; all other actors may pass.  In
 Oxyd compatibility mode, all actors may pass.  
 
 @code{st-grate3} lets only small marbles (@ref{ac-killerball} and
 @ref{ac-whiteball-small}) and @ref{ac-horse} pass. See
- at ref{st-[black/white]} for further stones that let only some actors
+ at ref{st-[black/white]} for other stones that let only some actors
 pass.
 
 @strong{Variants}
@@ -5368,7 +5326,7 @@
 @subsection st-invisible: Invisible Stones
 
 @code{st-invisible} is invisible and non-transparent for lasers, and
-in contrast to @ref{st-chameleon}, it is solid.
+is solid, in contrast to @ref{st-chameleon}.
 
 @code{st-stonebrush} initially equals @code{st-invisible}, but
 turns into @code{st-rock4} when hit with an @ref{it-brush},
@@ -5391,8 +5349,8 @@
 @subsection st-key: Key (or Lock) Stone
 
 When the right @ref{it-key} is used on this stone, it performs the
-action given by the @code{action/target}-pair.  For this, the key has
-to have the same @code{keycode}-attribute as the stone.
+action given by the @code{action/target}-pair.  For this, the key must
+have the same @code{keycode}-attribute as the stone.
 
 In Enigma compatibility mode, the key remains in the stone and can't
 be used until removed from it. In all other modes, you keep the key.
@@ -5432,8 +5390,8 @@
 Also called ``black knight stone'', this stone destroys all marbles
 that hit it, as long as they are not protected by @ref{it-umbrella}
 or wield an @ref{it-sword}.  By hitting @code{st-knight} with an
- at code{it-sword} four times the knight stone spits out a cheeky remark
-and can be passed thereon, even without a sword.
+ at code{it-sword} four times, the knight stone spits out a cheeky remark
+and can be passed thereafter, even without a sword.
 
 
 @node st-laser, st-laserswitch, st-knight, Stones
@@ -5501,20 +5459,20 @@
 @node st-lightpassenger, st-mail, st-lasertimeswitch, Stones
 @subsection st-lightpassenger: Light Passenger
 
-The light passenger skates on a laser beam and may push up to one
+The light passenger skates on a laser beam, and may push up to one
 movable stone in front of it. Opposing laser beams are ignored.
-When the actual laser beam on which the passenger skates is crossed
-by another one, the passenger switches beams. If it is initially
+When another laser beam crosses the actual laser beam on which the
+passenger skates, the passenger switches beams. If it is initially
 lighted by two rectangular beams, one of them will be chosen by
 random. The light passenger's skating ability can be turned off
 and on.
 
 When a stone is in its way, the passenger sends an impulse to the
-blocking stone, which may move it, but may also have other effects.
-E.g. a turnstile turns around and an impulse-stone starts pulsing,
+blocking stone, which may move it, but it may also have other effects;
+e.g., a turnstile turns around and an impulse-stone starts pulsing,
 but it does not open oxyds (this is intended).
 
-The light passenger can't be pushed by actors, but e.g. by
+The light passenger can't be pushed by actors, but, e.g., by
 @ref{st-stoneimpulse}.
 
 The speed of the light passenger can be changed with the
@@ -5530,7 +5488,7 @@
 with @code{base} the value of the @code{interval}-attribute,
 @code{friction} the friction of the floor below the light passenger,
 and @code{gradient} the parallel part of the force of the floor,
-i.e. the sum of gradient-force and @code{force_x/y}-attributes.
+i.e., the sum of gradient-force and @code{force_x/y}-attributes.
 
 The light passenger can be switched on and off by messages (see
 below), and appears as @code{st-glass2} when inactive.  The variant
@@ -5574,9 +5532,9 @@
 @node st-mail, st-mirror, st-lightpassenger, Stones
 @subsection st-mail: Mail Stones
 
-When hit, these stones take the first item out of the players
-inventory and drop it at their exit or the exit of the appending
- at ref{it-pipe}-structure. If this position is blocked (e.g. by another
+When hit, these stones take the first item out of the player's
+inventory and drop it at their exit, or the exit of the appending
+ at ref{it-pipe}-structure. If this position is blocked (e.g., by another
 item), no item is taken from inventory.
 
 @strong{Variants}
@@ -5593,7 +5551,7 @@
 @subsection st-mirror: Mirror Stones
 
 These stones redirect and fork laser beams. They can be movable or
-non-movable, semi-transparent or non-transparent, plane or triangular
+non-movable, semi-transparent or non-transparent, plane or triangular,
 and have one of four orientations.  When hit, the mirror turns 90
 degrees clockwise.
 
@@ -5634,7 +5592,7 @@
 @node st-oneway, st-oxyd, st-mirror, Stones
 @subsection st-oneway: One-way Stones
 
-This stone can be passed by the marble in only one direction. (Or, to
+The marble can be pass this stone  in only one direction. (Or to
 be more exact, the arrow on the stone points to the one side of the
 stone through which it @emph{can't} be entered.  Hard to explain, try
 it yourself :-)
@@ -5695,9 +5653,9 @@
 attribute declares the oxyd stone to be unswappable/unpullable (see
 @ref{st-swap} and @ref{st-pull}).
 
- at strong{Note}: You should rarely need to create Oxyd stones manually
+ at strong{Note}: You should rarely need to create oxyd stones manually
 with @ref{set_stone}.  Use the predefined @ref{oxyd} function
-instead.  It will automatically take care of creating two Oxyd stones
+instead.  It will automatically take care of creating two oxyd stones
 of every color.
 
 @strong{Attributes}
@@ -5721,7 +5679,7 @@
 Interchange the colors of the oxyd stones in the current
 landscape. Better use the @ref{oxyd_shuffle} function.
 @item trigger
-Open the stone (useful for opening Oxyd stones using switches)
+Open the stone (useful for opening oxyd stones using switches)
 @end table
 
 
@@ -5734,8 +5692,8 @@
 The solid version additionally becomes @code{st-plain_cracked} when hit
 by a laser beam and can then be destroyed with an @ref{it-hammer} or
 explosions (see @ref{Breakable Stones}).  The hollow version is
-transparent for lasers.  Note that @code{st-plain_cracked} doesn't
-become transparent nor hollow by messages.
+transparent to lasers.  Note that @code{st-plain_cracked} doesn't
+become transparent or hollow by messages.
 
 @code{st-plain_move} is a movable and breakable stone (see
 @ref{Breakable Stones}) that looks identical to @code{st-plain}. It
@@ -5747,7 +5705,7 @@
 As @code{st-plain} is a frequent design scheme, you might want to use
 a version that doesn't transform under laser light.  For this purpose,
 use @code{st-rock3} or one of the closed doors @code{st-door_b} or
- at code{st-door_c} (see @ref{st-door}).  Further stones with the typical
+ at code{st-door_c} (see @ref{st-door}).  Other stones with the typical
 @code{st-plain}-design are @ref{st-chess_[black/white]} and the
 already mentioned @code{st-firebreak[_move]}.
 
@@ -5804,20 +5762,20 @@
 
 When pushed, this stone acts like pulled, regardless of the source of
 the impulse.  Actors on the destination field are pulled through it,
-such that they are not caged under them.  Hollow stones on the
+not caged under them.  Hollow stones on the
 position of the actor exchange their position with the pull-stone.
 Note however, that the special combination of @ref{st-brake} and
 @code{st-pull} is lethal for the marble.
 
 The only stones that cannot be pulled, are
 @ref{st-big[brick/bluesand]}.  Use them to make sure that an
- at code{st-pull} can't get out of a restricted area when you use e.g.
+ at code{st-pull} can't get out of a restricted area when you use, e.g.,
 @ref{st-rotator} or other objects that @code{st-pull} reacts on.
 In addition, you can declare @ref{st-oxyd} to be unswappable by
 attribute @code{static}.
 
 Note that, in non-Enigma-modes, @code{st-pull} may not get pulled into
-the border of the level.  This behaviour might change in future
+the border of the level.  This behavior might change in future
 versions.
 
 For a stone with similar function and restrictions, see @ref{st-swap}.
@@ -5828,29 +5786,29 @@
 
 Puzzle stones can construct large clusters of stones, that move
 together and can be destroyed together.  There are two families, blue
-and yellow puzzle stones, that behave different (the yellow ones are
-compatible to the puzzle stones in the original Oxyd-Game). Each of
+and yellow puzzle stones, which behave different (the yellow ones are
+compatible to the puzzle stones in the original Oxyd-game). Each of
 these families again consists of several variants that differ in the
-location of soccets to which neighboring puzzle stones can be
-attached.  A cluster is complete as soon as all soccets are connected
-to soccets of other puzzle stones of the same color.
+location of sockets to which neighboring puzzle stones can be
+attached.  A cluster is complete as soon as all sockets are connected
+to sockets of other puzzle stones of the same color.
 
 Laser beams make all complete puzzle clusters explode. Besides this,
-yellow, non-complete puzzle cluster rotate on a laser beam (means: the
-lightened row or column rotates by one stone position).  Non-complete
+yellow, incomplete puzzle cluster rotate on a laser beam (means: the
+lightened row or column rotates by one stone position).  Incomplete
 blue clusters don't react on lasers. 
 
 If a complete cluster is moved fully onto a combination of
 @ref{fl-water} and @ref{fl-abyss}, it becomes a bridge of
- at code{fl-gray}, similar to @ref{st-wood}.  A non-complete cluster
-forms a bridge only on @ref{fl-water}, and only if it the wielded item
+ at code{fl-gray}, similar to @ref{st-wood}.  An incomplete cluster
+forms a bridge only on @ref{fl-water}, and only if the wielded item
 is not @ref{it-magicwand}.  Note that in contrast to @code{st-wood},
-puzzle stones only become bridges after they are moved, they don't
+puzzle stones become bridges only after they are moved' they don't
 react on changing the floor.
 
 There also is a single hollow variant for each of the two colors,
 @code{st-puzzle-hollow} and @code{st-puzzle2-hollow}.  It acts as if
-it had soccets to all four directions, but is still hollow.  However,
+it had sockets to all four directions, but is still hollow.  However,
 these stones are the only hollow ones that press down
 @ref{it-trigger}. 
 
@@ -5858,26 +5816,26 @@
 @itemize @bullet
 @item a yellow complete cluster, it explodes;
 @item a single yellow puzzle stone, it moves;
- at item a yellow  uncomplete cluster, it rotates;
+ at item a yellow incomplete cluster, it rotates;
 @item a blue complete cluster with @code{it-magicwand}, it explodes;
 @item a blue complete cluster without @code{it-magicwand}, it moves;
- at item a blue uncomplete cluster with @code{it-magicwand}, it rotates.
+ at item a blue incomplete cluster with @code{it-magicwand}, it rotates.
 @end itemize
 Note that an exploding cluster can shatter the marble.
 
 In the current implementation, moving a puzzle stone over an item
-doesn't change it.  This affects e.g. @ref{it-coin} (that don't
+doesn't change it.  This affects, e.g., @ref{it-coin} (that don't
 transform), @ref{Hills and Hollows} (that don't diminish),
 @ref{it-blackbomb} and @ref{it-whitebomb} (that don't explode).  Be
-aware when using these items together with @code{it-puzzle} that
-future implementations of Enigma might change this behaviour.
+aware when using these items with @code{it-puzzle} that
+future implementations of Enigma might change this behavior.
 
 
 @strong{Messages}
 
 @table @code
 @item scramble
-internal message used to scramble a puzzle using secondary
+Internal message used to scramble a puzzle using secondary
 information; use @ref{AddScramble} and @ref{SetScrambleIntensity} to
 scramble a puzzle in a level instead or make use of one of the
 libraries (@code{ant} and @code{libpuzzle} both offer this
@@ -5888,8 +5846,8 @@
 
 @table @code
 @item connections
-A number between 1 an 16.  Each bit in (connections-1) corresponds to
-a socket on one of the four faces.  You will normally simply use
+A number between 1 and 16.  Each bit in (connections-1) corresponds to
+a socket on one of the four faces.  Normally, you will simply use
 one of the Lua constants @code{PUZ_0000} to @code{PUZ_1111}.
 @item oxyd
 0, if the puzzle stone is blue; 1, if it is yellow
@@ -5910,7 +5868,7 @@
 @end table
 
 The term @code{<nesw>} denotes all non-empty substrings of
- at code{nesw}, describing the directions to which there are soccets on
+ at code{nesw}, describing the directions to which there are sockets on
 the stone.  Examples: @code{st-puzzle-nw} is a blue puzzle stone with
 connections going north and west, @code{st-puzzle2-esw} is a yellow
 puzzle stone with connections to the east, south and west.
@@ -5923,7 +5881,7 @@
 @subsection st-rotator: Rotator Stone
 
 Rotator stones come in four flavors: Clockwise or counterclockwise
-rotation and movable or not movable.  They send impulses to
+rotation, and movable or not movable.  They send impulses to
 neighboring stones, thus pushing them in the direction given by the
 rotation.  @ref{st-bolder} additionally change their direction to the
 one they are pushed to.  @code{st-rotator} changes direction when hit
@@ -5943,7 +5901,7 @@
 @subsection st-rubberband: Rubberband Stone
 
 If hit by a marble, this stone first removes existing connections with
-other rubberband stones and then attaches a new elastic between the
+other stones, then attaches a new elastic between the
 marble and itself.  Nothing happens if the marble was already attached
 to this particular stone.
 
@@ -5990,7 +5948,7 @@
 
 The shogun stones trigger shogun items (see @ref{it-shogun}):  A
 single @code{st-shogun-s} triggers @code{it-shogun-s}, a combined
- at code{st-shogun-sm} triggers @code{it-shogun-m}, and the ultimative
+ at code{st-shogun-sm} triggers @code{it-shogun-m}, and the triplet
 @code{st-shogun-sml} triggers @code{it-shogun-l}.
 
 Shogun stones don't ignite bombs when pushed over them.
@@ -6010,8 +5968,8 @@
 When hit, an @ref{it-extralife} from the inventory of the hitting
 marble is transformed into a cannonball (@ref{ac-cannonball}) which
 can open @ref{st-oxyd}, destroy items and floor tiles (replacing them
-by @ref{fl-abyss}).  The initial velocity of the cannonball can be
-varied by using the @code{hit_factor}- and
+by @ref{fl-abyss}).  You can vary the initial velocity of the cannonball
+by using the @code{hit_factor}- and
 @code{hit_distortion_*}-attributes.
 
 @strong{Attributes}
@@ -6027,15 +5985,15 @@
 @node st-stoneimpulse, st-surprise, st-spitter, Stones
 @subsection st-stoneimpulse: Impulse Stones
 
-These stones give impulses to their neighbors when they receive such
-themselves or when hit by a laser beam (only when laser beam is
-turned on or changed, not the whole time).
+These stones send impulses to their neighbors when they receive such
+themselves, or when hit by a laser beam (only when the laser beam is
+turned on or changed, not the entire time).
 
 @strong{Messages}
 
 @table @code
 @item trigger
-Pulse as if pulse arrived from direction given in second argument to
+Pulse as if pulse arrived from direction given in the second argument to
 SendMessage (like in @code{SendMessage(mystone, "trigger",
 NORTH}). Use @code{NODIR} if no direction shall be assumed.
 @item signal
@@ -6071,7 +6029,7 @@
 
 This stone can exchange its position with other neighboring stones
 if it is hit hard enough.  In a way, this makes swap stones a kind
-of "movable stone", except that they can be only exchanged with
+of ``movable stone'', except that they can be exchanged only with
 other stones and may not be moved on empty fields.
 
 The only stones that cannot be swapped, are
@@ -6081,7 +6039,7 @@
 @code{static}.
 
 Note that, in non-Enigma-modes, @code{st-swap} may not swap into the
-border of the level.  This behaviour might change in future versions.
+border of the level.  This behavior might change in future versions.
 
 For a stone with similar function and restrictions, see @ref{st-pull}.
 
@@ -6131,7 +6089,7 @@
 
 @table @code
 @item capture
-Destroy thief stone with capture-animation (as if captured by a chess
+Destroy the thief stone with capture-animation (as if captured by a chess
 stone).
 @end table
 
@@ -6206,12 +6164,12 @@
 A turnstile consists of the pivot (@code{st-turnstile} or
 @code{st-turnstile-green}) and up to four arms
 (@code{st-turnstile-[w/e/s/n]}). When hit by an actor or by another
-impulse (e.g. @ref{st-lightpassenger} or @ref{st-stoneimpulse}), the
-whole complex turns around by 90 degrees.  The red standard version takes only
-the actor hitting the turnstile with it to the other side and shatters all
-others in its surrounding. The green version takes all actors to the other
+impulse (e.g., @ref{st-lightpassenger} or @ref{st-stoneimpulse}), the
+whole complex turns 90 degrees.  The red standard version takes only
+the actor hitting the turnstile, with it to the other side and shatters all
+others in its surrounding; the green version takes all actors to the other
 side, for which there is an arm behind them, and ignores the rest. Imagine the
-red turnstile as pulling, the green one as pushing.
+red turnstile as pulling, the green one as pushing.  
 
 The turnstile may be blocked by other stones (even movable ones).
 Items are handled during rotation as if a stone is pushed over them.
@@ -6219,9 +6177,9 @@
 When a turnstile-pivot rotates, it subsequently performs its
 @code{action/target}-pair, with secondary data 0 if it rotates
 clockwise, 1 if counterclockwise.  If you send a signal to a pivot (or
-otherwise try to rotate it), which is already rotating, the signal
+otherwise try to rotate it) that is already rotating, the signal
 will be discarded.  This way you can concatenate several turnstiles to
-a complex which simultaneously rotates (or only in certain parts),
+a complex, which simultaneously rotates (or only in certain parts),
 without constructing an endless loop.
 
 When two green turnstiles are intertwined, one of them is hit and an actor would
@@ -6264,7 +6222,7 @@
 Seeds are spread to randomly chosen neighboring tiles on which are no
 other stones.  Other items are destroyed by this.
 
-While active (not while growing and not while inactive), a volcano
+While active (not while growing or while inactive), a volcano
 stone can be broken with @ref{it-hammer} (see @ref{Breakable Stones}).
 
 @strong{Messages}
@@ -6290,34 +6248,34 @@
 @node st-window, st-wood, st-volcano, Stones
 @subsection st-window: Breakable Stone
 
-Hit this window heavily with your marble to blast it into smithereens.
+Hit this window hard with your marble to blast it into smithereens.
 
 
 @node st-wood, st-yinyang, st-window, Stones
 @subsection st-wood: Wooden Stone
 
 This stone is movable.  If moved into @ref{fl-abyss}, @ref{fl-water} or
- at ref{fl-swamp} it builds a wooden plank (@code{fl-stwood1} or
+ at ref{fl-swamp}, it builds a wooden plank (@code{fl-stwood1} or
 @code{fl-stwood2}).  In Oxyd 1 compatibility mode @code{st-wood} only
 checks for floor when it is moved or when it receives the message
 ``fall''.
 
-Note: There are two flavors of @code{st-wood} which may be specified
+Note: There are two flavors of @code{st-wood} that you may specify
 by using @code{st-wood1} or @code{st-wood2}.
 
 @code{st-wood-growing} is a growing version of @code{st-wood}, it
 results from using a particular @ref{it-seed}.
 
 @code{st-flhay} and @code{st-flrock} are movable, too, and create
- at code{fl-hay} respectively @code{fl-rock} when moved into
+ at code{fl-hay}, respectively @code{fl-rock}, when moved into
 @code{fl-abyss}, @code{fl-water} or @code{fl-swamp}.  The difference
 to @code{st-wood} is that @code{fl-hay} doesn't become @code{fl-abyss}
 when burning and @code{fl-rock} doesn't burn at all.
 
 When there is fire under @code{st-wood} or @code{st-flhay}, they burn
-away.  In contrast to this, @code{st-flrock} extinguishes fire, as it
+away.  In contrast to this, @code{st-flrock} extinguishes fire as it
 is pushed over it (see @ref{The 1.0-Fire System}).  This distinguishes
-it from all other movable stones.  Fire that is extinguishes in this
+it from all other movable stones.  Fire that is extinguished in this
 way might leave @code{it-burnable_ash} behind, but the floor does not
 fire-transform.
 
@@ -6349,12 +6307,12 @@
 
 @table @code
 @item st-yinyang1       
-If touched it changes it's color to the opposite color of your marble.
+If touched, it changes it's color to the opposite color of your marble.
 @item st-yinyang2
-If touched it changes it's color to the same color as your marble.
+If touched, it changes it's color to the same color as your marble.
 @item st-yinyang3
 The Per.Oxyd compatible: You must hold @ref{it-magicwand} or
- at ref{it-brush} to change the color to the opposite color of your
+ at ref{it-brush} to change the color to the color opposite of your
 marble.
 @end table
 
@@ -6384,7 +6342,7 @@
 @subsection Actor Attributes
 
 All actors share a set of common attributes that determine their
-general behaviour:
+general behavior:
 
 @table @code
 @item @b{player} values: 0, 1, nil; default: nil 
@@ -6412,17 +6370,17 @@
 may well continue to play with other actors that he controls which are still
 alive. A value of -1
 marks an actor as totally necessary. If such an actor cannot be resurrected
-after a death the player is essentially dead. A value of 1 marks an actor as
-partially essental. Not the actor itself needs to survive but the number of
+after a death, the player is essentially dead. A value of 1 marks an actor as
+partially essential. Not the actor itself needs to survive but the number of
 actors of its kind controlled by the player need to be larger than the number
-of actors with value 1. F.e. marking 3 out of 5 small whiteballs with 1 means
-that the player is dead if no longer 3 small whiteballs are alive. See 
+of actors with value 1. For example, marking 3 out of 5 small whiteballs with 1 means
+that the player is dead if 3 small whiteballs are no longer alive. See 
 @ref{Variables} @samp{enigma.ConserveLevel} for more details about restart of levels.
 
 @item @b{essential_id} values: string; default: model name of actor
-As a player may control actors of different kind at the same time the 
+Since a player may control actors of different kinds at the same time, the 
 essentialness of actors is limited to its kind via this id. It is possible
-to group actors of different kind into an essential group via this id. The
+to group actors of different kinds into an essential group via this id. The
 engine keeps this id even if actors are transformed into other kinds.
 
 @item @b{whiteball}, @b{blackball} @i{depreceated}
@@ -6452,9 +6410,9 @@
 @node ac-bug
 @subsection ac-bug
 
-A small, passive marble.  Can be used to break @code{st-bug} (see
+A small, passive marble.  It can be used to break @code{st-bug} (see
 @ref{Breakable Stones}), to pass @code{st-grate3} (see @ref{st-grate})
-to open oxyds etc.  It can't shatter or die.
+to open oxyds, etc.  It can't shatter or die.
 
 @c @strong{Attributes}
 
@@ -6471,9 +6429,9 @@
 @node ac-horse
 @subsection ac-horse
 
-A slightly larger actor which shuttles between the targets given in
+A slightly larger actor that shuttles between the targets given in
 its @code{target1}- to @code{target4}- attributes with a given
- at code{force}.  In future versions it's planned that marbles can ride
+ at code{force}.  In future versions, it's planned that marbles can ride
 @code{ac-horse} to surpass @ref{fl-abyss}, @ref{fl-water} etc.
 @code{ac-horse} can pass @code{st-grate3} (see @ref{st-grate}), open
 oxyds and much more, without shattering or dying.
@@ -6491,17 +6449,17 @@
 @strong{Example}
 
 The syntax of the @code{target}-attributes is a little bit
-uncommon. Here an example from the meditation @code{ral04_1}:
+uncommon. Here is an example from the meditation @code{ral04_1}:
 
 @example
 set_actor("ac-horse",16.5, 6.5, @{force=6, target1="16 3",
     target2="3 3", target3="3 9", target4="16 9" @})
 @end example
 
-The attribute consists of a string, holding the x- and y-coordinates
+The attribute consists of a string, holding the x- and y-coordinates,
 separated by a blank.  The @code{ac-horse} in the example shuttles
 between the coordinates (16,3), (3,3), (3,9) and (16,9) on a
-rectangular route.  Note that there are only four targets allowed at
+rectangular route.  Note that only four targets are allowed at
 the moment.
 
 
@@ -6524,7 +6482,7 @@
 @node ac-rotor
 @subsection ac-rotor
 
-An actor which is actively attracted by marbles and shatters them.
+An actor that is actively attracted by marbles and shatters them.
 Compare @ref{ac-top}.
 
 @strong{Attributes}
@@ -6534,21 +6492,21 @@
 @item force (default 10.0)
 @item gohome (default 1)
 @item attacknearest (default FALSE)
-in case of multiple balls the default behaviour for rotors is to attac the
-center of all balls. If this flag is set to @samp{TRUE} the nearest ball will
+in case of multiple balls, the default behavior for rotors is to attack the
+center of all balls. If this flag is set to @samp{TRUE}, the nearest ball will
 be attacked.
 
 @item prefercurrent (default 0.0)
-with values from 0.0 to 1.0 the likelyhood is expressed that the rotor hunts
+with values from 0.0 to 1.0 the likelihood is expressed that the rotor hunts
 the current controlled ball instead of the otherwise attacked aim. You will
 usually use this attribute in combination with @samp{attacknearest=TRUE}. The
-Level @samp{Toreador} is an example of the behaviour of rotors.
+Level @samp{Toreador} is an example of the behavior of rotors.
 @end table
 
 @node ac-top
 @subsection ac-top
 
-An actor which is actively attracted by marbles and shatters them.
+An actor that is actively attracted by marbles and shatters them.
 Compare @ref{ac-rotor}.
 
 @strong{Attributes}
@@ -6558,15 +6516,15 @@
 @item force (default 10.0)
 @item gohome (default 1)
 @item attacknearest (default FALSE)
-in case of multiple balls the default behaviour for rotors is to attac the
-center of all balls. If this flag is set to @samp{TRUE} the nearest ball will
+in case of multiple balls, the default behavior for rotors is to attack the
+center of all balls. If this flag is set to @samp{TRUE}, the nearest ball will
 be attacked.
 
 @item prefercurrent (default 0.0)
-with values from 0.0 to 1.0 the likelyhood is expressed that the rotor hunts
+with values from 0.0 to 1.0 the likelihood is expressed that the rotor hunts
 the current controlled ball instead of the otherwise attacked aim. You will
 usually use this attribute in combination with @samp{attacknearest=TRUE}. The
-Level @samp{Toreador} is an example of the behaviour of rotors.
+Level @samp{Toreador} is an example of the behavior of rotors.
 
 @end table
 
@@ -6591,8 +6549,8 @@
 @node ac-whiteball-small
 @subsection ac-whiteball-small
 
-This is the meditation marble. In meditation levels, you have to place
-them in @code{it-hollow} or @code{it-tinyhollow} to succeed the level,
+This is the meditation marble. In meditation levels, you must place
+them in @code{it-hollow} or @code{it-tinyhollow} to win the level,
 see @ref{Hills and Hollows}.
 
 @strong{Attributes}
@@ -6624,32 +6582,32 @@
 ignited, spreads over the landscape and destroys items, marbles and
 some stones. It spreads along those floor tiles that are marked
 ``burnable'' by default (like @code{fl-hay} or @code{fl-wood1}), by
-attribute (setting @code{enigma.SetAttrib(myfloor, "burnable", TRUE)})
+attribute (setting @code{enigma.SetAttrib(myfloor, "burnable", TRUE)}),
 or by one of two items that indicate burnability: the invisible
 @code{it-burnable} and the visible @code{it-burnable_oil}. On a
-burning floor, all items are destroyed. However, some items deny the
-floor to burn, like @code{it-hollow} (see @ref{Hills and Hollows}) or
+burning floor, all items are destroyed. However, some items prevent the
+floor from burning, like @code{it-hollow} (see @ref{Hills and Hollows}) or
 @ref{it-dynamite} (which is ignited instead).
 
 Fire can be ignited in several standard ways:
 @itemize @bullet
 @item The @code{setfire}-message sets fire to a floor if it is
-burnable and the item on it allows it to burn (unburnable items like
- at code{it-dynamite} are not ignited by this!).
+burnable and the item on it allows it to burn; non-burnable items like
+ at code{it-dynamite} are not ignited by this!
 @item The @code{heat}-message ignites burnable floors as does
- at code{setfire}, but also initiate a heat-transformation of the floor
-(see below) and ignite items on it.
+ at code{setfire}, but also initiates a heat-transformation of the floor
+(see below) and ignites items on it.
 @item The @code{ignite} and @code{expl}-messages that are used by
 @code{it-dynamite}, @ref{it-blackbomb} and @ref{it-whitebomb} can
 initiate fire via @code{it-burnable[_oil]} or if the
 @code{ignitable}-attribute of the floor is set (off by default).
- at item The floor already starts burning on initialisation when the
+ at item The floor already starts burning on initialization when the
 @code{initfire}-attribute is set (off by default).
 @item Fire in the neighborhood, see below.
 @end itemize
 
 If needed, the @code{forcefire}-message can be used to set fire to
-unburnable floors. Internally, it is equivalent to manually setting
+non-burnable floors. Internally, it is equivalent to manually setting
 @code{it-burnable_ignited}, the last method (which was quite famous in
 0.92) should be avoided in future, to allow a further development of
 the fire-system.
@@ -6679,20 +6637,20 @@
 set if the floor is @code{fl-abyss} or the @code{noash}-attribute is
 set.
 
-As the spreading of fire is a random event, in 0.92 a level author
+Since the spreading of fire is a random event, in 0.92, a level author
 couldn't be sure that a particular item was ignited or fire was
-set. In 1.0 these can be assured by setting the
+set. In 1.0, these can be assured by setting the
 @code{secure}-attribute: When a burnable floor with
 @code{secure}-attribute is near fire, it will eventually catch fire,
-items on it are ignited etc.
+items on it are ignited, etc.
 
-In 0.92 there were two speeds of fire: When using @code{it-burnable},
-fire spread much faster as without. This is still the same in
-1.0. However, you can set the @code{fastfire}-attribute to fasten up
+In 0.92, there were two speeds of fire: When using @code{it-burnable},
+fire spread much faster than without. This is still the same in
+1.0. However, you can set the @code{fastfire}-attribute to hasten
 the fire without setting the invisible @code{it-burnable}. 
 
-Fire that burns under a stone is not allowed to spread, only exception
-are non-floating stones (as @ref{st-grate}), and those stones which
+Fire that burns under a stone is not allowed to spread; the only exceptions
+are floating stones (as @ref{st-grate}), and those stones that
 are destroyed by fire anyway (see @ref{st-wood}-variants and
 @ref{st-firebreak[_move]}). In contrast to this, fire might also
 spread to under a movable stone, but not further. 
@@ -6708,7 +6666,7 @@
 
 @strong{Heat-Transformations}
 
-When a fire starts to burn near @ref{fl-ice}, this melts to
+When a fire starts to burn near @ref{fl-ice}, it melts to
 @ref{fl-water}. In the same sense, @code{fl-water} boils to
 @ref{fl-swamp}, and this again to @code{fl-dunes}. In contrast to most
 other fire-related actions, this is not random, but always and only
@@ -6717,7 +6675,7 @@
 Examples: Put an @code{st-flrock} on @code{fl-ice}. A fire will melt
 the ice, and @code{st-flrock} creates a fireproof and safe way to the
 other side. If you use @ref{st-wood} instead, @code{fl-stwood} is
-created, which presumably catchs fire and leaves @code{fl-abyss}
+created, which presumably catches fire and leaves @code{fl-abyss}
 behind. A similar combination is @code{fl-water} with
 @ref{st-chess_[black/white]}.
 
@@ -6726,7 +6684,7 @@
 
 @strong{Differences between 1.0 and 0.92}
 
-The old fire system of Enigma versions up to 0.92 differs from
+The old fire system of Enigma versions up to 0.92, differs from
 the 1.0 version mainly in the following points:
 
 @itemize @bullet
@@ -6736,11 +6694,11 @@
 @item no difference between different floors
 @item replication via same-floor-pattern instead of
 burnable-floor-pattern: 0.92 didn't distinguish between burnable and
-unburnable floors. Instead, fire was allowed to spread to floors of
+non-burnable floors. Instead, fire was allowed to spread to floors of
 the same kind slowly.
- at item burnable items always catch fire: In 1.0 a burnable item (except
+ at item burnable items always catch fire: In 1.0, a burnable item (except
 for @code{it-burnable} and @code{it-burnable_oil} themselves) on an
-unburnable floor won't catch fire, in 0.92 it did.
+non-burnable floor won't catch fire, in 0.92 it did.
 @end itemize
 
 A good model of the 0.92-system can be attained via the
@@ -6751,12 +6709,12 @@
 
 Note that in 0.92, fire-transformation happened at the beginning of
 the fire, which manifested in the so called ``burning-abyss''-bug.
-Besides other details, this differs the original 0.92-system from the
+Besides other details, this is how the original 0.92 system differs from the
 one in 1.0-non-Enigma-mode.
 
 @strong{Burnable and Fireproof Floors}
 
-The following floors are fireproof (don't burn by default):
+The following floors are fireproof (they don't burn by default):
 @code{fl-abyss*, fl-ac*, fl-black, fl-brick, fl-bridge*, fl-bumps,
 fl-concrete, fl-dummy, fl-dunes, fl-gradient*, fl-gravel, fl-gray,
 fl-himalaya, fl-ice*, fl-inverse, fl-inverse2, fl-darkgray, fl-metal*,
@@ -6791,7 +6749,7 @@
 Note that @code{it-extinguisher_empty, it-trigger} (visible and
 invisible), @code{it-landmine}, @code{it-changefloor} and
 @code{it-death} are passively burnable.  In particular,
- at code{it-landmine} does not explode and does not create
+ at code{it-landmine} does not explode or create
 @code{it-hollow} when burning. The reaction of @ref{it-sensor} and
 @code{it-inversesensor} towards fire might be changed in future
 versions.
@@ -6813,7 +6771,7 @@
 well as between the Oxyds themselves. Using the compatibility-section
 of the xml-metadata (see @ref{<compatibility>}) or the
 @ref{enigma.SetCompatibility}-function, it's possible to activate some
-of these behaviours. Here's a list of the currently implemented
+of these behaviors. Here's a list of the currently implemented
 differences, not all of them are mentioned at the corresponding
 sections above: 
 
@@ -6859,7 +6817,7 @@
 @ref{st-invisible}) becomes @code{st-likeoxydc-open} instead of
 @code{st-rock4}.
 @item @ref{it-hammer} doesn't laser-transform into @ref{it-sword}.
- at item @ref{it-umbrella} doesn't explode in laser-light.
+ at item @ref{it-umbrella} doesn't explode in laser light.
 @item @ref{it-cross} inverts signals it receives.
 @end itemize
 
@@ -6880,11 +6838,11 @@
 @node Variables, Functions, Objects, Top
 @chapter Variables
 
-This chapter describes a few variables that can be changed from
+This chapter describes a few variables that you can change from
 level descriptions to alter the behavior of the game engine or set
 default attributes for some particular objects, or that carry
 interesting information about the context of the level.  In the second
-case, the same effect can usually be achieved by setting the
+case, you can usually achieve the same effect by setting the
 corresponding object attributes directly, but being able to specify a
 global default value often is more convenient.  You can always
 override these default attribute values for specific objects by
@@ -6892,30 +6850,30 @@
 
 @defvar enigma.ConserveLevel values: @code{TRUE}, @code{FALSE}; default: @code{TRUE} 
 The conserve mode determines if a dead actor will be resurrected in case of
-extralives in the gamers inventory. 
+extralives in the gamer's inventory. 
 
-If @code{TRUE} dead actors attached to a
+If @code{TRUE}, dead actors attached to a
 player will be resurrected as long as extralives are available. If a player has
-no living actor to control or is missing the actors essential constraints 
-(@pxref{Actor Attributes}) the
+no living actor to control or is missing the actor's essential constraints 
+(@pxref{Actor Attributes}), the
 player is dead. The level may still continue if a second player is alive. If
-the gamer has a yinyang in his inventory in single user mode the control switches
-to the second player. If all players are dead a new level game is started.
+the gamer has a yinyang in his inventory in single user mode, the control switches
+to the second player. If all players are dead, a new level game is started.
 
-If the conserve mode is @code{FALSE} no actors will be resurrected. As soon as the
-player is dead and the control cannot switch to another player all dead actors
-are resurrected by usage of extralives and the level is restartet without
+If the conserve mode is @code{FALSE}, no actors will be resurrected. As soon as the
+player is dead and the control cannot switch to another player, all dead actors
+are resurrected by using extralives, and the level is restarted without
 finishing the level game.
 
 Use @code{FALSE} if the level cannot be solved in case of resurrected actors.
-In all other cases mode @code{TRUE} with proper usage of actors essential 
+In all other cases, mode @code{TRUE} with proper usage of actors essential 
 constraints will be preferable (@pxref{Actor Attributes}).
 @end defvar
 
 @defvar enigma.CreatingPreview 
- at code{TRUE} or @code{FALSE}, read-only.  Use this to determine in a
-level whether it is just loaded to build a thumbnail.  If so, you can
-e.g. change the start-position of @ref{ac-blackball} to display
+ at code{TRUE} or @code{FALSE}, read-only.  Use this in a
+level to determine whether it is just loaded to build a thumbnail.  If so, you can,
+e.g., change the start-position of @ref{ac-blackball} to display
 another part of the level in the preview, or hide objects from it.
 When changing the initial position, it might be advantageous to also
 set the follow-mode to smooth (@ref{display.SetFollowMode}):
@@ -6930,7 +6888,7 @@
 
 @defvar enigma.Brittleness
 A value between 0 and 1, denoting the probability that a brittle floor
-plate desintegrates further when an actor enters or leaves it.  1
+plate disintegrates further when an actor enters or leaves it.  1
 means that the floor will always crack, 0 that it is indestructible
 (see @ref{it-crack}).  Default: 0.5.
 @end defvar
@@ -6954,7 +6912,7 @@
 
 @defvar enigma.FlatForce
 A global downward force.  This is currently only applied on floors of
-type @ref{fl-space-force} and obsolete since introduction of the
+type @ref{fl-space-force}, and obsolete since introduction of the
 @code{force_[x/y]}-attributes.  Default: 0.
 @end defvar
 
@@ -7057,8 +7015,8 @@
 created earlier with the @code{set_actor} function.  The second
 parameter @var{object} may be either an actor or a stone created
 earlier.  The last two parameters define the properties of the rubber
-band: @var{strength} denotes the force factor of the elastic and
- at var{length} its natural length.  No force is exerted on the actor if
+band: @var{strength} denotes the force factor of the elastic, and
+ at var{length} denotes its natural length.  No force is exerted on the actor if
 the rubber band is shorter than its natural length.
 
 @end defun
@@ -7077,15 +7035,15 @@
 
 @defun CreateWorld (width, heigth)
 
-This function creates a new level. Because objects can only be added
-to the level after @code{CreateWorld} has been called,
+This function creates a new level. Because objects can be added
+to the level only after @code{CreateWorld} has been called,
 you should usually do so near the beginning of your level
 description.
 
 The @var{width} and @var{height} denote the size of the new level.  All
 levels with only one screen have the minimum size of 20x13 blocks.
 
-Note that level fields are indexed from zero, i.e, the field indices
+Note that level fields are indexed from zero, i.e., the field indices
 for a 20x13 level are in the range (0..19)x(0..12). Also note that the
 screens in Enigma overlap by one line or column: A level that fits on
 a single screen has size of 20x13, but two a level that is two screens
@@ -7185,10 +7143,10 @@
 @defun draw_floor (floorname, location, increment, count , attribs)
 
 Description: Use this function to add several floor objects
-to your level in periodical distances. How does it work? At first it
+to your level at periodic distances. How does it work? At first it
 places the floor to location. Then it moves by
-increment, and again places given floor. And again and again
-- so many times as defined by count.
+increment, and again places the given floor. And again and again
+-- as many times as defined by count.
 @table @var
 @item Floorname 
 Name of floor object.
@@ -7198,7 +7156,7 @@
 @item Increment: Another Lua table with two elements:
 @{dx,dy@}. dx is the increment per step in x-axis,
 dy is increment per step in y-axis. Often this function is
-used to add a row of floors in one direction, and then
+used to add a row of floors in one direction, then
 Increment looks like this: @{1,0@} or
 @{0,1@}.
 @item Count
@@ -7227,8 +7185,8 @@
 
 @defun draw_items (itemname, location, increment, count [, attribs])
 
-Description: This function adds to your level several item
-objects in periodical distances. It works much like draw_floor
+Description: This function adds several item
+objects to your level at periodic distances. It works much like draw_floor,
 except that it adds items instead of floors.
 @table @var
 @item Itemname
@@ -7264,8 +7222,8 @@
 
 @defun draw_stones (stonename, location, increment, count [, attribs])
 
-Description: This function adds to your level several stones
-in periodical distances. It works much like draw_floor
+Description: This function adds several stones
+to your level at periodic distances. It works much like draw_floor,
 except that it adds stones instead of floors.
 @table @var
 @item Stonename
@@ -7327,8 +7285,8 @@
 @defun GetAttrib (object, attribname)
 
 Description: The function is similar to SetAttrib, except
-that it doesn't set the attribute, but return current attribute
-value. Function arguments have the same meaning like in
+that it doesn't set the attribute, but returns current attribute
+value. Function arguments have the same meaning as in
 SetAttrib, see its description. Also note
 GetKind.
 @table @var
@@ -7392,7 +7350,7 @@
 
 @table @var
 @item x, y
-Koordinates of the floortile to kill.
+Coordinates of the floortile to kill.
 @end table
 
 @end defun
@@ -7407,7 +7365,7 @@
 
 @table @var
 @item x, y
-Koordinates of the item to kill.
+Coordinates of the item to kill.
 @end table
 
 @end defun
@@ -7422,7 +7380,7 @@
 
 @table @var
 @item x, y
-Koordinates of the stone to kill.
+Coordinates of the stone to kill.
 @end table
 
 @end defun
@@ -7435,7 +7393,7 @@
 
 This function loads a Lua level library that has previously been declared in
 @ref{<compatibility>} at a given point of code execution. If the library is
-declared with @samp{el:preload="true"} no Lua function call is necessary.
+declared with @samp{el:preload="true"}, no Lua function call is necessary.
 The @var{libraryId} is the same as in the declaration. 
 @end defun
 
@@ -7459,13 +7417,14 @@
 @defun enigma.SetAttrib (object, attribname, value)
 
 Description: The function sets the given attribute of a
-given object to given value. If you try to pass unknown attribute to
-an object, enigma will ignore it (i.e. nothing happens).
+given object to a given value. If you try to pass an unknown attribute to
+an object, Enigma will ignore it (i.e., the value is assigned, but nothing
+special happens).
 @table @var
 @item Object
 The variable that holds the object. Every function
-that creates an object returns the variable representing freshly added
-object. That's right what should be passed to SetAttrib. (See example).
+that creates an object returns the variable representing the freshly added
+object. That's right, what should be passed to SetAttrib. (See example.)
 @item Attribname
 Name of the attribute. See the description of
 objects to learn which object knows what attributes.
@@ -7491,7 +7450,7 @@
 @defun enigma.set_attribs (object, attribs)
 
 Description: This function sets several attributes at a
-time. The only thing it does is call SetAttrib as many times as needed to set
+time. The only thing it does is to call SetAttrib as many times as needed to set
 values of all desired attributes.
 @table @var
 @item Object
@@ -7519,21 +7478,21 @@
 @defun enigma.SetDefaultAttribs (objectname, attribs)
 
 Description: Use this function if there are several objects
-of same kind, that have attributes (all or just some) with same
-value. For example if there are twenty wormholes with strength of 10,
+of same kind, which have attributes (all or just some) with the same
+value. For example, if there are twenty wormholes with strength of 10,
 you can set the strength of 10 as a default value for all
 wormholes.
 
-Notes: Default attributes can be overriden or several extra
-attributes can be assigned to object. The attributes specified at
+Notes: Default attributes can be overridden or several extra
+attributes can be assigned to an object. The attributes specified at
 creation time (using set_floor, set_item, set_stone
-functions) override default attributes specified by
+functions) override the default attributes specified by
 SetDefaultAttribs.
 @table @var
- at item Objname may be name of any enigma stone, floor or
-item. In most cases this is wormhole, because it's usual to have
-several wormholes with same strength and range, while it's not very
-common to have for example all doors vertical or all bolders facing
+ at item Objname may be name of any Enigma stone, floor or
+item. In most cases, this is a wormhole, because it's usual to have
+several wormholes with the same strength and range, while it's not very
+common to have, for example, all doors vertical or all bolders facing
 west.
 @item Attribs
 Table of keys and corresponding values:
@@ -7555,11 +7514,11 @@
 
 @defun enigma.SetCompatibility (compatibility)
 
-This function sets the compatibility of a level. Because in every of the original
-oxyd games certain objects may have a different behavior, there exists for each game
-a compatibility mode. Enigma itself has also a compatibilitiy mode, it's the default.
+This function sets the compatibility of a level. Because certain objects may have a different
+behavior in the original Oxyd games, a compatibility mode exists for each game. Enigma itself
+has also a compatibility mode, it's the default.
 
-Note: This function is depreceated. Set the compatibility information in the 
+Note: This function is deprecated. Set the compatibility information in the 
 xml-node @ref{<compatibility>} instead.
 
 Possible values for compatibility are:
@@ -7586,18 +7545,18 @@
 @defun fill_floor (floorname)
 fill_floor (floorname, x, y, w, h)
 
-Description: This function fills an area of map with
+Description: This function fills an area of map with a
 selected floor type.
 @table @var
 @item Floorname
-Name of floor object. If this is the only argument to the function,
-whole map area is filled with this kind of floor.
+Name of the floor object. If this is the only argument to the function,
+the whole map area is filled with this kind of floor.
 @item x, y
 Coordinates of upper left corner of filled area. Note
-that upper left square of map is at coordinates [0,0]. If those
+that the upper left square of map is at coordinates [0,0]. If those
 arguments are omitted, zero is passed instead.
 @item w, h
-Size of filled area. If any of these arguments is
+Size of the filled area. If any of these arguments is
 omitted, level width or height respectively is passed by default.
 @end table
 
@@ -7618,21 +7577,21 @@
 
 @defun fill_items (itemname, x, y, w, h)
 
-Description: This function fills an area of map with
-items of selected kind.
+Description: This function fills an area of the map with
+items of a selected kind.
 
 Note: Please note that in contrast to function fill_floor, this function
-doesn't have any default attributes and no parametter may be omitted.
+doesn't have any default attributes, and no parameter may be omitted.
 
 (strange, no one ever used this function in their map @enddots{})
 @table @var
 @item Itemname
 Name of item object.
 @item x, y
-Coordinates of upper left corner of filled area. Note
-that upper left square of map is at coordinates [0,0].
+Coordinates of the upper left corner of the filled area. Note
+that the upper left square of the map is at coordinates [0,0].
 @item w, h
-Size of filled area - w is width and
+Size of the filled area - w is width and
 h is height.
 @end table
 
@@ -7650,17 +7609,17 @@
 
 @defun fill_stones (stonename, x, y, w, h)
 
-Description: This function fills an area of map with
-stones of selected kind.
+Description: This function fills an area of the map with
+stones of a selected kind.
 
-Note: Please note thatin contrast to function fill_floor,
-this function doesn't have any default attributes and no parametter may be omitted.
+Note: Please note that in contrast to function fill_floor,
+this function doesn't have any default attributes, and no parameter may be omitted.
 @table @var
 @item Stonename
 Name of stone object.
 @item x, y
-Coordinates of upper left corner of filled area. Note
-that upper left square of map is at coordinates [0,0].
+Coordinates of the upper left corner of the filled area. Note
+that the upper left square of the map is at coordinates [0,0].
 @item w, h
 Size of filled area - w is width and h is height.
 @end table
@@ -7688,7 +7647,7 @@
 attributes, including default ones
 @table @var
 @item Objname
-Name of internal enigma object. It can be name of
+Name of an internal Enigma object. It can be the name of
 any floor, stone or item.
 @item Attribs
 Table of attribute names and corresponding values:
@@ -7701,9 +7660,9 @@
 
 @example
 Example: To my best knowledge, no one uses this function in
-their levels. You should rather use set_floor/stone/item functions for
-creating particular enigma objects. If you need this function, you are
-probably guru and you don't need this manual either.
+their levels. You should instead use set_floor/stone/item functions for
+creating particular Enigma objects. If you need this function, you are
+probably a guru and you don't need this manual either.
 @end example
 
 @c ......................................................................
@@ -7716,14 +7675,14 @@
 
 @table @var
 @item object
-The recipient of the message.  Can either be the name of an object or a
+The recipient of the message.  Can be either the name of an object or a
 reference as returned by @ref{enigma.GetNamedObject}.
 @item message
-The message itself (e.g. "signal") You can see which messages are
+The message itself (e.g. ``signal'') You can see which messages are
 understood in the documentation of the particular @ref{Objects}.
 @item data
-Some specific messages expect some additional data (e.g. message
-"direction" expects a direction like SOUTH or WEST).
+Some specific messages expect some additional data (e.g., message
+``direction'' expects a direction like SOUTH or WEST).
 @end table
 
 @end defun
@@ -7749,15 +7708,14 @@
 @defun set_floor (floorname, x, y, attribs)
 
 Description: As you would expect, this function creates a
-floor at given [x,y] position in enigma level, and passes all
+floor at a given [x,y] position in Enigma level, and passes all
 necessary default attributes and
-attributes passed in attribs argument.
+attributes passed in the attribs argument.
 @table @var
 @item Floorname
- Enigma internal object name. The name should be
-the name of floor (they typically start with "fl-" prefix). In fact,
-it is possible to add a stone object as a floor, but strange things
-happen. Generally nothing you would like to use in your levels.
+Enigma internal object name. The name should be
+the name of the floor (they typically start with ``fl-'' prefix). Enigma
+won't let you create a floor from another object, just from real floors.
 @item x, y 
 Location where you want the floor to be placed. Note
 that level coordinates begin with zero (see CreateWorld).
@@ -7786,21 +7744,21 @@
 @defun set_item (itemname, x, y, attribs)
 
 Description: This function is very similar to the one named
-set_floor, describer earlier. It creates an
-item at given position. Items in enigma are all those magic wands,
-brushes, coins, triggers, bombs and also for example the laser ray or
-crackles. There can be only one single item on each position.
+set_floor, described earlier. It creates an
+item at a given position. Items in Enigma are all those magic wands,
+brushes, coins, triggers, bombs and also, for example, the laser ray or
+crackles. Only one single item can be on each position.
 
-Note: The rule of single item per field also means, that
-laser cannot "overshoot" magic wand or trigger, that you cannot drop
-item to cracked floor etc. It may look like disadvantage, but on the
-other hand, it can be used as an advantage (see for example the level
-named "Follow the Light" in "Oxyd Clones" package).
+Note: The rule of single-item-per-field also means that a
+laser cannot ``overshoot'' a magic wand or trigger, or that you cannot drop
+an item to cracked floor, etc. It may look like a disadvantage, but on the
+other hand, it can be used as an advantage (see, for example, the level
+named ``Follow the Light'' in ``Oxyd Clones'' package).
 @table @var
 @item Itemname
-Enigma internal object name. The name has to be
-the name of item (they typically start with "it-" prefix). Enigma
-won't let you create an item from other object that just item.
+Enigma internal object name. The name must be
+the name of an item (they typically start with ``it-'' prefix). Enigma
+won't let you create an item from another object, just from real items.
 @item x, y
 Location where you want the item to be placed. Note
 that level coordinates begin with zero (see CreateWorld).
@@ -7825,14 +7783,14 @@
 
 Description: This function is very similar to the one named
 set_floor, describer earlier. It places the
-stone to desired location. Stones in enigma are all walls, glass
+stone to the desired location. Stones in Enigma are all walls, glass
 blocks, death's heads, and also doors, switches, lasers, bolders and
-lots of other special enigma objects.
+lots of other special Enigma objects.
 @table @var
 @item Stonename
-Enigma internal stone name. The name has to be
-the name of stone (they typically start with "st-" prefix). Enigma
-won't let you create the stone from other object that just stone.
+Enigma internal stone name. The name must be
+the name of a stone (they typically start with ``st-'' prefix). Enigma
+won't let you create a stone from another object, just from real stones.
 @item x, y
 Location where you want the stone to be placed. Note
 that level coordinates begin with zero (see CreateWorld).
@@ -7857,7 +7815,7 @@
 @defun set_stones (stonename, positions, attribs)
 
 Description: This function is somehow similar to draw_stones.
- It can place several stones to locations all over the map.
+It can place several stones in locations all over the map.
 The locations to which the stones will be placed are listed in argument
 positions.
 @table @var



From andreasl at mail.berlios.de  Sat Sep  1 13:33:04 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Sat, 1 Sep 2007 13:33:04 +0200
Subject: [Enigma-game-svn] r853 - in homepage/input: . lotm news
Message-ID: <200709011133.l81BX4he013804@sheep.berlios.de>

Author: andreasl
Date: 2007-09-01 13:33:03 +0200 (Sat, 01 Sep 2007)
New Revision: 853

Modified:
   homepage/input/lotm/lotm_200709.html
   homepage/input/lotm/lotm_archive_data.lua
   homepage/input/news/news_issue16_en.html
   homepage/input/stat-help.html
Log:
Homepage:
 - changed "solvage" to "solution" in stat-help and news_issue16
 - replaced "table.maxn" (Lua 5.1) by "table.getn" (Lua 5.0)
   in lotm-archive-data
 - small addition to englisch LotM 9/07, but it's far from ready


Modified: homepage/input/lotm/lotm_200709.html
===================================================================
--- homepage/input/lotm/lotm_200709.html	2007-08-31 23:35:40 UTC (rev 852)
+++ homepage/input/lotm/lotm_200709.html	2007-09-01 11:33:03 UTC (rev 853)
@@ -96,14 +96,17 @@
   </table>
   
   <p>As of our data from July, 13 users voted for &quot;Tool Time&quot,
-  averaging to <b>8.46</b> which catapults &quot;Tool Time&quot; onto position 6
+  averaging to <b>8.46</b> which establishes &quot;Tool Time&quot; at position 6
   in our <a href="$$lotm$$">LotM-highscore</a>, head-to-head with
-  &quot;Elaborate&quot;, which currently 
-  
-  </p>
+  &quot;Elaborate&quot;, which lost its slight lead over &quot;Labyrinth of
+  Puzzles&quot; in the last two months. And another surprise from the current
+  ratings: After it was second to &quot;Island Labyrinth&quot; for two months,
+  &quot;The Aztec Temple&quot; now tops the list again, with a really marginal
+  advance: 9.17 versus 9.13!</p>
 
-  <h4>&quot;Many happy hours of puzzling&quot;</h4>
+  <h4>&quot;First title&quot;</h4>
 
+
   <div class="lotmpic">
     <img src="$$imagedir$$/lotm/lotm_200709_b.png" alt="Level of the month" border="0">
     <div class="imagetitle">&quot;Listen, tin soldiers, once I find my tin opener
@@ -114,7 +117,57 @@
     <img src="$$imagedir$$/lotm/lotm_200709_c.png" alt="Level of the month" border="0">
     <div class="imagetitle">The Mead-Trap</div>
   </div>
+
+  <div class="quote">
+  I am a single father and my daughter comes to visit me twice a year. When Lori
+  visits, we like to play computer games and we were looking for a game that
+  involved the solving of puzzles.  I happend upon Enigma, when I did a google
+  search for &quot;Puzzle Games&quot; and we started playing the levels.</div>
   
+  <div class="quote">
+  After we had solved about 95% of the levels, we began to develop a feeling for
+  what kind of levels we liked and what kind of levels we thought were just
+  &quot;a-pain-in-the-neck&quot;. We determined that &quot;WE&quot; liked the
+  puzzles that made you EXPLORE and THINK. We didn't like the puzzles that made
+  you HURRY nearly as much.</div>
+
+  <div class="quote">
+  I had worked as a Senior Electronics/Software engineer for 25 years, so the
+  language for writing Enigma levels was not difficult for me, and my daughter
+  Lori actually contributed most of the really devious hiding places, and sneaky
+  puzzle attributes.</div>
+
+  <div class="quote">
+  One concept that we had never seen in any level before was the notion that you
+  had to have a &quot;pair&quot; of tools to get back out of a trap that you
+  knew you were walking into. We designed a little trap requiring both the
+  &quot;sword, and hammer&quot; if you wanted to escape, and that was the
+  centerpiece of the level.</div>
+
+  <div class="quote">
+  We also liked that notion that the wooden block seed must be expanded under
+  the grate to make use of it for all three of its purposes. The wooden block
+  &quot;1. Holds down a switch, 2. Changes the value of a coin, and  3. Makes a
+  bridge over the abyss&quot;.</div>
+
+  <div class="quote"> We had also never seen anyone hide an item underneath an
+  outer space square, where you have to plan your trajectory to recover the
+  item.</div>
+
+  <div class="quote"> I guess the experience from playing all of the levels in
+  version 0.82, combined with a love of puzzles, inspired us to create this
+  level.</div>
+
+  <div class="author">
+  Sincerely, Barry Mead & daughter Lori</div>
+
+  <p>We remember Manuel's <a href="lotm_200704.html">&quot;Pneumatic
+  Delivery&quot;</a>, which he designed for his father. And &quot;Tool
+  Time&quot; is a joint project of father and daughter. It's great to see how
+  Enigma brings together parents and children, even without network gaming.
+  Barry, Lori, thank you very much for this important lesson, and the great
+  level you shared with us!</p>
+
   <p>Greets,<br/>
   <i>Andreas and Harry</i></p>
 

Modified: homepage/input/lotm/lotm_archive_data.lua
===================================================================
--- homepage/input/lotm/lotm_archive_data.lua	2007-08-31 23:35:40 UTC (rev 852)
+++ homepage/input/lotm/lotm_archive_data.lua	2007-09-01 11:33:03 UTC (rev 853)
@@ -89,5 +89,5 @@
 
 lotm_archive_data_from = { month = 7, year = 2007 }
 
-lotm_current = lotm_archive_data[table.maxn(lotm_archive_data)]
+lotm_current = lotm_archive_data[table.getn(lotm_archive_data)]
 

Modified: homepage/input/news/news_issue16_en.html
===================================================================
--- homepage/input/news/news_issue16_en.html	2007-08-31 23:35:40 UTC (rev 852)
+++ homepage/input/news/news_issue16_en.html	2007-09-01 11:33:03 UTC (rev 853)
@@ -19,7 +19,7 @@
     <li> Countless smaller enhancements</li>
 </ul>
   
-<p>With 1.00 every level provides solvage rates and average user ratings
+<p>With 1.00 every level provides solution rates and average user ratings
     besides the world record. These data depend on your feedback. Please make
     use of this new feature by sending back your score file as described in 
     <a href="$$support$$#score">Score Registration</a></p>

Modified: homepage/input/stat-help.html
===================================================================
--- homepage/input/stat-help.html	2007-08-31 23:35:40 UTC (rev 852)
+++ homepage/input/stat-help.html	2007-09-01 11:33:03 UTC (rev 853)
@@ -22,8 +22,8 @@
     <h4>solved hcp</h4>
       The solved handicap is the handicap that is calculated over all levels
       that a player solved. Additionally 10% of the unsolved levels are taken
-      into account for unsuccessful solvage attempts. This way the solved hcp
-      can be used to compare players with quite different solvage rates. It
+      into account for unsuccessful solution attempts. This way the solved hcp
+      can be used to compare players with quite different solution rates. It
       shows if a player solves levels fast or slow.
   </div>
 



From ral at mail.berlios.de  Sat Sep  1 13:55:52 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 1 Sep 2007 13:55:52 +0200
Subject: [Enigma-game-svn] r854 - homepage/input
Message-ID: <200709011155.l81Btq4u015153@sheep.berlios.de>

Author: ral
Date: 2007-09-01 13:55:51 +0200 (Sat, 01 Sep 2007)
New Revision: 854

Modified:
   homepage/input/stat-other.html
   homepage/input/table-hcp.html
   homepage/input/table-rat.html
   homepage/input/table-solved.html
   homepage/input/table-wr.html
   homepage/input/userlist.html
Log:
Homepage:
- statistics for August 2007


Modified: homepage/input/stat-other.html
===================================================================
--- homepage/input/stat-other.html	2007-09-01 11:33:03 UTC (rev 853)
+++ homepage/input/stat-other.html	2007-09-01 11:55:51 UTC (rev 854)
@@ -1,22 +1,22 @@
   <div class="stat-help">
     <h3>$$Other_Statistics$$</h3>
     <h4>$$Scores$$</h4>
-      47843 $$single_level_scores$$
+      52073 $$single_level_scores$$.
     <h4>$$Ratings$$</h4>
-      8141 $$single_level_ratings$$ 4.93 $$and_distribution$$
+      9153 $$single_level_ratings$$ 4.95 $$and_distribution$$: 
       <table>
         <colgroup><col width="80"><col width="80"></colgroup>
         <tr><th>$$rating$$</th><th>$$count$$</th></tr>
-        <tr><td class="num">0</td><td class="num">34</td></tr>
-        <tr><td class="num">1</td><td class="num">167</td></tr>
-        <tr><td class="num">2</td><td class="num">381</td></tr>
-        <tr><td class="num">3</td><td class="num">1193</td></tr>
-        <tr><td class="num">4</td><td class="num">1520</td></tr>
-        <tr><td class="num">5</td><td class="num">2031</td></tr>
-        <tr><td class="num">6</td><td class="num">1254</td></tr>
-        <tr><td class="num">7</td><td class="num">967</td></tr>
-        <tr><td class="num">8</td><td class="num">350</td></tr>
-        <tr><td class="num">9</td><td class="num">162</td></tr>
-        <tr><td class="num">10</td><td class="num">82</td></tr>
+        <tr><td class="num">0</td><td class="num">38</td></tr>
+        <tr><td class="num">1</td><td class="num">179</td></tr>
+        <tr><td class="num">2</td><td class="num">416</td></tr>
+        <tr><td class="num">3</td><td class="num">1297</td></tr>
+        <tr><td class="num">4</td><td class="num">1690</td></tr>
+        <tr><td class="num">5</td><td class="num">2339</td></tr>
+        <tr><td class="num">6</td><td class="num">1449</td></tr>
+        <tr><td class="num">7</td><td class="num">1087</td></tr>
+        <tr><td class="num">8</td><td class="num">401</td></tr>
+        <tr><td class="num">9</td><td class="num">172</td></tr>
+        <tr><td class="num">10</td><td class="num">85</td></tr>
       </table>
   </div>

Modified: homepage/input/table-hcp.html
===================================================================
--- homepage/input/table-hcp.html	2007-09-01 11:33:03 UTC (rev 853)
+++ homepage/input/table-hcp.html	2007-09-01 11:55:51 UTC (rev 854)
@@ -1,97 +1,105 @@
   <table>
-    <caption>$$Handicap_Statistics$$ $$July$$ 2007</caption>
+    <caption>$$Handicap_Statistics$$ $$August$$ 2007</caption>
     <colgroup><col width="130"><col width="220"></colgroup>
     <tr><th>$$solved_hcp$$</th><th class="left">$$user$$</th></tr>
-     <tr><td class="num">-130.1</td><td class="left">'Moneymaker'</td></tr>
-     <tr><td class="num"> -86.6</td><td class="left">'Stupid'</td></tr>
-     <tr><td class="num"> -85.5</td><td class="left">'Johannes'</td></tr>
-     <tr><td class="num"> -75.2</td><td class="left">'Great Scott'</td></tr>
+     <tr><td class="num">-130.7</td><td class="left">'Moneymaker'</td></tr>
+     <tr><td class="num"> -86.3</td><td class="left">'Stupid'</td></tr>
+     <tr><td class="num"> -85.3</td><td class="left">'Johannes'</td></tr>
+     <tr><td class="num"> -75.1</td><td class="left">'Great Scott'</td></tr>
      <tr><td class="num"> -63.8</td><td class="left">'Duffy'</td></tr>
-     <tr><td class="num"> -48.8</td><td class="left">'Django'</td></tr>
-     <tr><td class="num"> -42.4</td><td class="left">'daydreamer'</td></tr>
-     <tr><td class="num"> -30.3</td><td class="left">'bojster'</td></tr>
-     <tr><td class="num"> -27.7</td><td class="left">'Alexandros'</td></tr>
-     <tr><td class="num"> -27.2</td><td class="left">'Taztunes'</td></tr>
-     <tr><td class="num"> -21.2</td><td class="left">'Raoul'</td></tr>
-     <tr><td class="num"> -18.9</td><td class="left">'Ghatotkacha'</td></tr>
-     <tr><td class="num"> -15.7</td><td class="left">'Safalra'</td></tr>
-     <tr><td class="num"> -14.9</td><td class="left">'Lukas'</td></tr>
-     <tr><td class="num"> -14.7</td><td class="left">'Ronald'</td></tr>
-     <tr><td class="num"> -14.0</td><td class="left">'HuB34'</td></tr>
-     <tr><td class="num"> -13.2</td><td class="left">'ged'</td></tr>
-     <tr><td class="num"> -10.1</td><td class="left">'Iceshark7'</td></tr>
-     <tr><td class="num">  -5.9</td><td class="left">'fabian'</td></tr>
-     <tr><td class="num">  -4.2</td><td class="left">'JuSt'</td></tr>
-     <tr><td class="num">  -3.8</td><td class="left">'Wuzzy'</td></tr>
-     <tr><td class="num">  -1.4</td><td class="left">'Tobias'</td></tr>
-     <tr><td class="num">  -1.2</td><td class="left">'para_doks'</td></tr>
-     <tr><td class="num">   0.2</td><td class="left">'Guglielmo'</td></tr>
-     <tr><td class="num">   2.6</td><td class="left">'Zekobah'</td></tr>
-     <tr><td class="num">   9.0</td><td class="left">'mrduke'</td></tr>
-     <tr><td class="num">  10.3</td><td class="left">'Andreas'</td></tr>
-     <tr><td class="num">  10.8</td><td class="left">'joseba'</td></tr>
+     <tr><td class="num"> -49.4</td><td class="left">'Django'</td></tr>
+     <tr><td class="num"> -48.3</td><td class="left">'daydreamer'</td></tr>
+     <tr><td class="num"> -36.2</td><td class="left">'Taztunes'</td></tr>
+     <tr><td class="num"> -30.4</td><td class="left">'bojster'</td></tr>
+     <tr><td class="num"> -27.4</td><td class="left">'Alexandros'</td></tr>
+     <tr><td class="num"> -21.8</td><td class="left">'Safalra'</td></tr>
+     <tr><td class="num"> -21.3</td><td class="left">'Raoul'</td></tr>
+     <tr><td class="num"> -18.8</td><td class="left">'Ghatotkacha'</td></tr>
+     <tr><td class="num"> -17.0</td><td class="left">'ged'</td></tr>
+     <tr><td class="num"> -15.1</td><td class="left">'Ronald'</td></tr>
+     <tr><td class="num"> -14.7</td><td class="left">'Lukas'</td></tr>
+     <tr><td class="num"> -13.9</td><td class="left">'HuB34'</td></tr>
+     <tr><td class="num"> -11.1</td><td class="left">'dpl'</td></tr>
+     <tr><td class="num"> -10.0</td><td class="left">'Iceshark7'</td></tr>
+     <tr><td class="num">  -5.8</td><td class="left">'fabian'</td></tr>
+     <tr><td class="num">  -4.0</td><td class="left">'JuSt'</td></tr>
+     <tr><td class="num">  -3.7</td><td class="left">'Wuzzy'</td></tr>
+     <tr><td class="num">  -1.2</td><td class="left">'Tobias'</td></tr>
+     <tr><td class="num">  -1.0</td><td class="left">'para_doks'</td></tr>
+     <tr><td class="num">   0.3</td><td class="left">'Guglielmo'</td></tr>
+     <tr><td class="num">   1.1</td><td class="left">'Ludmian'</td></tr>
+     <tr><td class="num">   2.8</td><td class="left">'Zekobah'</td></tr>
+     <tr><td class="num">   8.4</td><td class="left">'mrduke'</td></tr>
+     <tr><td class="num">  10.3</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+     <tr><td class="num">  10.6</td><td class="left">'Andreas'</td></tr>
+     <tr><td class="num">  11.0</td><td class="left">'joseba'</td></tr>
      <tr><td class="num">  11.4</td><td class="left">'Chocolate Zero'</td></tr>
-     <tr><td class="num">  11.5</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-     <tr><td class="num">  11.8</td><td class="left">'Ludmian'</td></tr>
-     <tr><td class="num">  12.1</td><td class="left">'Sim_Ed'</td></tr>
+     <tr><td class="num">  11.6</td><td class="left">'Daniel'</td></tr>
+     <tr><td class="num">  11.8</td><td class="left">'ryujun'</td></tr>
+     <tr><td class="num">  12.2</td><td class="left">'Sim_Ed'</td></tr>
      <tr><td class="num">  12.7</td><td class="left">'Agnieszka'</td></tr>
-     <tr><td class="num">  13.2</td><td class="left">'ryujun'</td></tr>
-     <tr><td class="num">  14.3</td><td class="left">'Mark P.'</td></tr>
-     <tr><td class="num">  17.2</td><td class="left">'Alex'</td></tr>
-     <tr><td class="num">  20.0</td><td class="left">'Klaus'</td></tr>
-     <tr><td class="num">  20.4</td><td class="left">'Marc-Hendrik'</td></tr>
-     <tr><td class="num">  20.6</td><td class="left">'shoki'</td></tr>
-     <tr><td class="num">  20.6</td><td class="left">'Chris'</td></tr>
-     <tr><td class="num">  21.2</td><td class="left">'Bent'</td></tr>
-     <tr><td class="num">  21.7</td><td class="left">'Thomas'</td></tr>
-     <tr><td class="num">  22.4</td><td class="left">'hdwow'</td></tr>
-     <tr><td class="num">  22.7</td><td class="left">'U-Punkt'</td></tr>
-     <tr><td class="num">  25.0</td><td class="left">'Ale'</td></tr>
-     <tr><td class="num">  25.5</td><td class="left">'J3FF'</td></tr>
-     <tr><td class="num">  27.6</td><td class="left">'redsantz'</td></tr>
-     <tr><td class="num">  28.0</td><td class="left">'biotopa'</td></tr>
-     <tr><td class="num">  29.2</td><td class="left">'IChrisI'</td></tr>
-     <tr><td class="num">  29.7</td><td class="left">'erich'</td></tr>
+     <tr><td class="num">  13.6</td><td class="left">'Mark P.'</td></tr>
+     <tr><td class="num">  17.3</td><td class="left">'Alex'</td></tr>
+     <tr><td class="num">  17.6</td><td class="left">'shoki'</td></tr>
+     <tr><td class="num">  18.0</td><td class="left">'ABS'</td></tr>
+     <tr><td class="num">  20.1</td><td class="left">'Klaus'</td></tr>
+     <tr><td class="num">  20.5</td><td class="left">'Marc-Hendrik'</td></tr>
+     <tr><td class="num">  20.7</td><td class="left">'Chris'</td></tr>
+     <tr><td class="num">  21.4</td><td class="left">'Bent'</td></tr>
+     <tr><td class="num">  21.5</td><td class="left">'U-Punkt'</td></tr>
+     <tr><td class="num">  21.5</td><td class="left">'Thomas'</td></tr>
+     <tr><td class="num">  22.5</td><td class="left">'hdwow'</td></tr>
+     <tr><td class="num">  23.0</td><td class="left">'Gottseinsohn'</td></tr>
+     <tr><td class="num">  24.9</td><td class="left">'Ale'</td></tr>
+     <tr><td class="num">  25.3</td><td class="left">'J3FF'</td></tr>
+     <tr><td class="num">  27.5</td><td class="left">'Tiza'</td></tr>
+     <tr><td class="num">  27.7</td><td class="left">'redsantz'</td></tr>
+     <tr><td class="num">  28.1</td><td class="left">'biotopa'</td></tr>
+     <tr><td class="num">  29.3</td><td class="left">'IChrisI'</td></tr>
      <tr><td class="num">  29.7</td><td class="left">'NorthForty'</td></tr>
-     <tr><td class="num">  29.7</td><td class="left">'Melanie'</td></tr>
-     <tr><td class="num">  30.1</td><td class="left">'Davacardo'</td></tr>
-     <tr><td class="num">  32.6</td><td class="left">'Edgar_Flesk'</td></tr>
-     <tr><td class="num">  33.0</td><td class="left">'niebie'</td></tr>
-     <tr><td class="num">  35.0</td><td class="left">'Rugby4ever'</td></tr>
+     <tr><td class="num">  29.9</td><td class="left">'erich'</td></tr>
+     <tr><td class="num">  29.9</td><td class="left">'Melanie'</td></tr>
+     <tr><td class="num">  30.2</td><td class="left">'Davacardo'</td></tr>
+     <tr><td class="num">  32.7</td><td class="left">'Edgar_Flesk'</td></tr>
+     <tr><td class="num">  33.1</td><td class="left">'niebie'</td></tr>
+     <tr><td class="num">  35.3</td><td class="left">'Rugby4ever'</td></tr>
+     <tr><td class="num">  36.9</td><td class="left">'WP319'</td></tr>
+     <tr><td class="num">  37.0</td><td class="left">'Drotten'</td></tr>
      <tr><td class="num">  37.5</td><td class="left">'Archcorenth'</td></tr>
-     <tr><td class="num">  37.7</td><td class="left">'WP319'</td></tr>
-     <tr><td class="num">  39.0</td><td class="left">'Tiger'</td></tr>
-     <tr><td class="num">  40.5</td><td class="left">'Vlad'</td></tr>
-     <tr><td class="num">  40.8</td><td class="left">'Momcat'</td></tr>
-     <tr><td class="num">  42.2</td><td class="left">'Nfol'</td></tr>
+     <tr><td class="num">  39.1</td><td class="left">'Tiger'</td></tr>
+     <tr><td class="num">  40.3</td><td class="left">'Nfol'</td></tr>
+     <tr><td class="num">  40.6</td><td class="left">'Vlad'</td></tr>
+     <tr><td class="num">  40.9</td><td class="left">'Momcat'</td></tr>
+     <tr><td class="num">  42.0</td><td class="left">'Vinksu'</td></tr>
      <tr><td class="num">  43.4</td><td class="left">'Liam Sheehan'</td></tr>
-     <tr><td class="num">  43.5</td><td class="left">'Tarim'</td></tr>
-     <tr><td class="num">  46.5</td><td class="left">'Breezy'</td></tr>
-     <tr><td class="num">  47.0</td><td class="left">'Zak'</td></tr>
+     <tr><td class="num">  43.6</td><td class="left">'Tarim'</td></tr>
+     <tr><td class="num">  44.5</td><td class="left">'Breezy'</td></tr>
+     <tr><td class="num">  46.0</td><td class="left">'mhatta'</td></tr>
+     <tr><td class="num">  47.1</td><td class="left">'Zak'</td></tr>
      <tr><td class="num">  47.9</td><td class="left">'Valkyrie2'</td></tr>
      <tr><td class="num">  48.2</td><td class="left">'Sandra'</td></tr>
-     <tr><td class="num">  48.8</td><td class="left">'Daniel'</td></tr>
-     <tr><td class="num">  49.5</td><td class="left">'Jeffrey S'</td></tr>
+     <tr><td class="num">  49.6</td><td class="left">'Jeffrey S'</td></tr>
      <tr><td class="num">  50.7</td><td class="left">'Vaily'</td></tr>
-     <tr><td class="num">  51.6</td><td class="left">'Turbogurk'</td></tr>
-     <tr><td class="num">  52.0</td><td class="left">'Neophilus'</td></tr>
-     <tr><td class="num">  52.0</td><td class="left">'Cyphase'</td></tr>
-     <tr><td class="num">  54.4</td><td class="left">'krazy62'</td></tr>
-     <tr><td class="num">  55.2</td><td class="left">'Adonica'</td></tr>
-     <tr><td class="num">  59.8</td><td class="left">'Harry Lim'</td></tr>
+     <tr><td class="num">  51.7</td><td class="left">'Turbogurk'</td></tr>
+     <tr><td class="num">  52.1</td><td class="left">'Neophilus'</td></tr>
+     <tr><td class="num">  52.2</td><td class="left">'Cyphase'</td></tr>
+     <tr><td class="num">  54.5</td><td class="left">'krazy62'</td></tr>
+     <tr><td class="num">  55.3</td><td class="left">'Adonica'</td></tr>
+     <tr><td class="num">  55.6</td><td class="left">'Uli'</td></tr>
+     <tr><td class="num">  59.9</td><td class="left">'Harry Lim'</td></tr>
      <tr><td class="num">  60.9</td><td class="left">'Asbel'</td></tr>
-     <tr><td class="num">  62.3</td><td class="left">'Meeve'</td></tr>
-     <tr><td class="num">  65.9</td><td class="left">'Samuel'</td></tr>
-     <tr><td class="num">  66.6</td><td class="left">'Alf'</td></tr>
-     <tr><td class="num">  68.0</td><td class="left">'Magnus and Susi'</td></tr>
+     <tr><td class="num">  62.5</td><td class="left">'Meeve'</td></tr>
+     <tr><td class="num">  66.0</td><td class="left">'Samuel'</td></tr>
+     <tr><td class="num">  66.7</td><td class="left">'Alf'</td></tr>
+     <tr><td class="num">  68.1</td><td class="left">'Magnus and Susi'</td></tr>
      <tr><td class="num">  68.2</td><td class="left">'Mecki'</td></tr>
-     <tr><td class="num">  69.4</td><td class="left">'xmouse'</td></tr>
-     <tr><td class="num">  70.8</td><td class="left">'Joona'</td></tr>
-     <tr><td class="num">  71.3</td><td class="left">'AQZ'</td></tr>
-     <tr><td class="num">  73.3</td><td class="left">'Dvorhagen'</td></tr>
-     <tr><td class="num">  74.2</td><td class="left">'jojo'</td></tr>
-     <tr><td class="num">  74.4</td><td class="left">'AsuCaga'</td></tr>
-     <tr><td class="num">  84.5</td><td class="left">'Miel56'</td></tr>
+     <tr><td class="num">  69.5</td><td class="left">'xmouse'</td></tr>
+     <tr><td class="num">  71.0</td><td class="left">'Joona'</td></tr>
+     <tr><td class="num">  71.4</td><td class="left">'AQZ'</td></tr>
+     <tr><td class="num">  73.4</td><td class="left">'Dvorhagen'</td></tr>
+     <tr><td class="num">  74.4</td><td class="left">'jojo'</td></tr>
+     <tr><td class="num">  74.5</td><td class="left">'AsuCaga'</td></tr>
+     <tr><td class="num">  84.6</td><td class="left">'Miel56'</td></tr>
      <tr><td class="num">  89.7</td><td class="left">'The red O'</td></tr>
      <tr><td class="num">  92.1</td><td class="left">'Michael'</td></tr>
   </table>

Modified: homepage/input/table-rat.html
===================================================================
--- homepage/input/table-rat.html	2007-09-01 11:33:03 UTC (rev 853)
+++ homepage/input/table-rat.html	2007-09-01 11:55:51 UTC (rev 854)
@@ -1,37 +1,41 @@
   <table>
-    <caption>$$Rating_Statistics$$ $$July$$ 2007</caption>
+    <caption>$$Rating_Statistics$$ $$August$$ 2007</caption>
     <colgroup><col width="80"><col width="80"><col width="220"></colgroup>
-    <tr><th>$$count$$</th><th>$$average$$</th><th class="left">$$user$$</th></tr>    <tr><td class="num">871</td><td class="num"> 5.09</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num">794</td><td class="num"> 4.87</td><td class="left">'ryujun'</td></tr>
-    <tr><td class="num">791</td><td class="num"> 4.70</td><td class="left">'daydreamer'</td></tr>
-    <tr><td class="num">642</td><td class="num"> 5.00</td><td class="left">'Duffy'</td></tr>
-    <tr><td class="num">620</td><td class="num"> 4.96</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">530</td><td class="num"> 4.16</td><td class="left">'shoki'</td></tr>
-    <tr><td class="num">493</td><td class="num"> 5.27</td><td class="left">'Lukas'</td></tr>
+    <tr><th>$$count$$</th><th>$$average$$</th><th class="left">$$user$$</th></tr>    <tr><td class="num">1020</td><td class="num"> 4.99</td><td class="left">'ryujun'</td></tr>
+    <tr><td class="num">871</td><td class="num"> 5.09</td><td class="left">'Stupid'</td></tr>
+    <tr><td class="num">834</td><td class="num"> 4.76</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num">653</td><td class="num"> 5.01</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num">621</td><td class="num"> 4.96</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">599</td><td class="num"> 4.21</td><td class="left">'shoki'</td></tr>
+    <tr><td class="num">496</td><td class="num"> 5.27</td><td class="left">'Lukas'</td></tr>
+    <tr><td class="num">482</td><td class="num"> 5.03</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">435</td><td class="num"> 5.09</td><td class="left">'Johannes'</td></tr>
     <tr><td class="num">426</td><td class="num"> 4.23</td><td class="left">'Alexandros'</td></tr>
-    <tr><td class="num">404</td><td class="num"> 4.99</td><td class="left">'Ronald'</td></tr>
-    <tr><td class="num">361</td><td class="num"> 4.32</td><td class="left">'ged'</td></tr>
+    <tr><td class="num">413</td><td class="num"> 5.01</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num">390</td><td class="num"> 4.33</td><td class="left">'ged'</td></tr>
     <tr><td class="num">307</td><td class="num"> 4.01</td><td class="left">'Sim_Ed'</td></tr>
-    <tr><td class="num">271</td><td class="num"> 6.33</td><td class="left">'Taztunes'</td></tr>
+    <tr><td class="num">275</td><td class="num"> 6.30</td><td class="left">'Taztunes'</td></tr>
+    <tr><td class="num">255</td><td class="num"> 5.06</td><td class="left">'U-Punkt'</td></tr>
     <tr><td class="num">254</td><td class="num"> 4.91</td><td class="left">'JuSt'</td></tr>
     <tr><td class="num">208</td><td class="num"> 6.15</td><td class="left">'Momcat'</td></tr>
-    <tr><td class="num">205</td><td class="num"> 5.29</td><td class="left">'U-Punkt'</td></tr>
-    <tr><td class="num">123</td><td class="num"> 5.67</td><td class="left">'Raoul'</td></tr>
+    <tr><td class="num">127</td><td class="num"> 5.64</td><td class="left">'Raoul'</td></tr>
     <tr><td class="num"> 85</td><td class="num"> 4.76</td><td class="left">'para_doks'</td></tr>
     <tr><td class="num"> 72</td><td class="num"> 5.63</td><td class="left">'Wuzzy'</td></tr>
-    <tr><td class="num"> 44</td><td class="num"> 5.27</td><td class="left">'WP319'</td></tr>
+    <tr><td class="num"> 55</td><td class="num"> 5.45</td><td class="left">'WP319'</td></tr>
     <tr><td class="num"> 43</td><td class="num"> 3.74</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 30</td><td class="num"> 4.40</td><td class="left">'Archcorenth'</td></tr>
+    <tr><td class="num"> 25</td><td class="num"> 4.88</td><td class="left">'Drotten'</td></tr>
+    <tr><td class="num"> 20</td><td class="num"> 4.90</td><td class="left">'Tiza'</td></tr>
+    <tr><td class="num"> 18</td><td class="num"> 6.28</td><td class="left">'Daniel'</td></tr>
+    <tr><td class="num"> 17</td><td class="num"> 5.53</td><td class="left">'Jeffrey S'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 7.63</td><td class="left">'Ghatotkacha'</td></tr>
-    <tr><td class="num"> 16</td><td class="num"> 5.31</td><td class="left">'Jeffrey S'</td></tr>
     <tr><td class="num"> 13</td><td class="num"> 5.23</td><td class="left">'Samuel'</td></tr>
     <tr><td class="num"> 10</td><td class="num"> 7.80</td><td class="left">'hdwow'</td></tr>
-    <tr><td class="num">  8</td><td class="num"> 5.50</td><td class="left">'mrduke'</td></tr>
+    <tr><td class="num">  9</td><td class="num"> 5.78</td><td class="left">'mrduke'</td></tr>
+    <tr><td class="num">  8</td><td class="num"> 5.63</td><td class="left">'Safalra'</td></tr>
     <tr><td class="num">  8</td><td class="num"> 3.25</td><td class="left">'Vlad'</td></tr>
-    <tr><td class="num">  7</td><td class="num"> 6.43</td><td class="left">'Safalra'</td></tr>
+    <tr><td class="num">  7</td><td class="num"> 6.29</td><td class="left">'ABS'</td></tr>
     <tr><td class="num">  6</td><td class="num"> 8.83</td><td class="left">'Ale'</td></tr>
-    <tr><td class="num">  5</td><td class="num"> 6.60</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num">  5</td><td class="num"> 9.20</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 5.75</td><td class="left">'joseba'</td></tr>
     <tr><td class="num">  4</td><td class="num">10.00</td><td class="left">'Mark P.'</td></tr>
@@ -44,6 +48,7 @@
     <tr><td class="num">  3</td><td class="num"> 4.33</td><td class="left">'krazy62'</td></tr>
     <tr><td class="num">  2</td><td class="num"> 6.00</td><td class="left">'Mecki'</td></tr>
     <tr><td class="num">  2</td><td class="num"> 8.00</td><td class="left">'Zekobah'</td></tr>
+    <tr><td class="num">  2</td><td class="num"> 0.00</td><td class="left">'mhatta'</td></tr>
     <tr><td class="num">  1</td><td class="num">10.00</td><td class="left">'Cyphase'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'Harry Lim'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 4.00</td><td class="left">'jojo'</td></tr>

Modified: homepage/input/table-solved.html
===================================================================
--- homepage/input/table-solved.html	2007-09-01 11:33:03 UTC (rev 853)
+++ homepage/input/table-solved.html	2007-09-01 11:55:51 UTC (rev 854)
@@ -1,69 +1,77 @@
   <table>
-    <caption>$$Solved_Level_Statistics$$ $$July$$ 2007</caption>
+    <caption>$$Solved_Level_Statistics$$ $$August$$ 2007</caption>
     <colgroup><col width="130"><col width="130"><col width="130"><col width="240"></colgroup>
     <tr><th>$$difficult$$</th><th>$$easy$$</th><th>$$total$$</th><th class="left">$$user$$</th></tr>
-    <tr><td class="num">1038/1045</td><td class="num">188/189</td><td class="num"> 99.35%</td><td class="left">'Taztunes'</td></tr>
-    <tr><td class="num">1023/1045</td><td class="num">176/189</td><td class="num"> 97.16%</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">1040/1045</td><td class="num">189/189</td><td class="num"> 99.59%</td><td class="left">'Taztunes'</td></tr>
+    <tr><td class="num">1024/1045</td><td class="num">176/189</td><td class="num"> 97.24%</td><td class="left">'Moneymaker'</td></tr>
     <tr><td class="num">1014/1045</td><td class="num">175/189</td><td class="num"> 96.35%</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num"> 982/1045</td><td class="num">170/189</td><td class="num"> 93.35%</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num">1001/1045</td><td class="num">177/189</td><td class="num"> 95.46%</td><td class="left">'ryujun'</td></tr>
+    <tr><td class="num"> 989/1045</td><td class="num">173/189</td><td class="num"> 94.17%</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num"> 949/1045</td><td class="num">170/189</td><td class="num"> 90.68%</td><td class="left">'para_doks'</td></tr>
-    <tr><td class="num"> 956/1045</td><td class="num">158/189</td><td class="num"> 90.28%</td><td class="left">'ryujun'</td></tr>
+    <tr><td class="num"> 944/1045</td><td class="num">165/189</td><td class="num"> 89.87%</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num"> 934/1045</td><td class="num">144/189</td><td class="num"> 87.36%</td><td class="left">'biotopa'</td></tr>
-    <tr><td class="num"> 915/1045</td><td class="num">159/189</td><td class="num"> 87.03%</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num"> 933/1045</td><td class="num">125/189</td><td class="num"> 85.74%</td><td class="left">'Alex'</td></tr>
     <tr><td class="num"> 914/1045</td><td class="num">135/189</td><td class="num"> 85.01%</td><td class="left">'JuSt'</td></tr>
     <tr><td class="num"> 863/1045</td><td class="num">161/189</td><td class="num"> 82.98%</td><td class="left">'Tobias'</td></tr>
+    <tr><td class="num"> 915/1045</td><td class="num">105/189</td><td class="num"> 82.66%</td><td class="left">'Django'</td></tr>
     <tr><td class="num"> 883/1045</td><td class="num">133/189</td><td class="num"> 82.33%</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num"> 914/1045</td><td class="num"> 95/189</td><td class="num"> 81.77%</td><td class="left">'Django'</td></tr>
+    <tr><td class="num"> 841/1045</td><td class="num">114/189</td><td class="num"> 77.39%</td><td class="left">'Lukas'</td></tr>
     <tr><td class="num"> 950/1045</td><td class="num">  0/189</td><td class="num"> 76.99%</td><td class="left">'Tarim'</td></tr>
-    <tr><td class="num"> 838/1045</td><td class="num">111/189</td><td class="num"> 76.90%</td><td class="left">'Lukas'</td></tr>
+    <tr><td class="num"> 830/1045</td><td class="num">109/189</td><td class="num"> 76.09%</td><td class="left">'shoki'</td></tr>
     <tr><td class="num"> 859/1045</td><td class="num"> 80/189</td><td class="num"> 76.09%</td><td class="left">'Melanie'</td></tr>
-    <tr><td class="num"> 896/1045</td><td class="num">  1/189</td><td class="num"> 72.69%</td><td class="left">'Ale'</td></tr>
-    <tr><td class="num"> 790/1045</td><td class="num"> 87/189</td><td class="num"> 71.07%</td><td class="left">'shoki'</td></tr>
-    <tr><td class="num"> 746/1045</td><td class="num">105/189</td><td class="num"> 68.96%</td><td class="left">'mrduke'</td></tr>
+    <tr><td class="num"> 908/1045</td><td class="num">  1/189</td><td class="num"> 73.66%</td><td class="left">'Ale'</td></tr>
+    <tr><td class="num"> 775/1045</td><td class="num">113/189</td><td class="num"> 71.96%</td><td class="left">'mrduke'</td></tr>
+    <tr><td class="num"> 729/1045</td><td class="num">128/189</td><td class="num"> 69.45%</td><td class="left">'Safalra'</td></tr>
     <tr><td class="num"> 762/1045</td><td class="num"> 73/189</td><td class="num"> 67.67%</td><td class="left">'redsantz'</td></tr>
+    <tr><td class="num"> 708/1045</td><td class="num">122/189</td><td class="num"> 67.26%</td><td class="left">'WP319'</td></tr>
     <tr><td class="num"> 734/1045</td><td class="num"> 82/189</td><td class="num"> 66.13%</td><td class="left">'bojster'</td></tr>
     <tr><td class="num"> 782/1045</td><td class="num"> 33/189</td><td class="num"> 66.05%</td><td class="left">'Sim_Ed'</td></tr>
-    <tr><td class="num"> 685/1045</td><td class="num">118/189</td><td class="num"> 65.07%</td><td class="left">'WP319'</td></tr>
-    <tr><td class="num"> 669/1045</td><td class="num">121/189</td><td class="num"> 64.02%</td><td class="left">'Safalra'</td></tr>
     <tr><td class="num"> 681/1045</td><td class="num"> 78/189</td><td class="num"> 61.51%</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 659/1045</td><td class="num"> 95/189</td><td class="num"> 61.10%</td><td class="left">'Marc-Hendrik'</td></tr>
-    <tr><td class="num"> 624/1045</td><td class="num">109/189</td><td class="num"> 59.40%</td><td class="left">'Raoul'</td></tr>
+    <tr><td class="num"> 629/1045</td><td class="num">109/189</td><td class="num"> 59.81%</td><td class="left">'Raoul'</td></tr>
     <tr><td class="num"> 643/1045</td><td class="num"> 83/189</td><td class="num"> 58.83%</td><td class="left">'Great Scott'</td></tr>
+    <tr><td class="num"> 714/1045</td><td class="num">  0/189</td><td class="num"> 57.86%</td><td class="left">'Gottseinsohn'</td></tr>
+    <tr><td class="num"> 658/1045</td><td class="num"> 50/189</td><td class="num"> 57.37%</td><td class="left">'U-Punkt'</td></tr>
     <tr><td class="num"> 636/1045</td><td class="num"> 55/189</td><td class="num"> 56.00%</td><td class="left">'fabian'</td></tr>
+    <tr><td class="num"> 610/1045</td><td class="num"> 81/189</td><td class="num"> 56.00%</td><td class="left">'dpl'</td></tr>
     <tr><td class="num"> 588/1045</td><td class="num"> 93/189</td><td class="num"> 55.19%</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 634/1045</td><td class="num"> 43/189</td><td class="num"> 54.86%</td><td class="left">'Klaus'</td></tr>
     <tr><td class="num"> 576/1045</td><td class="num"> 93/189</td><td class="num"> 54.21%</td><td class="left">'Guglielmo'</td></tr>
-    <tr><td class="num"> 637/1045</td><td class="num"> 27/189</td><td class="num"> 53.81%</td><td class="left">'U-Punkt'</td></tr>
-    <tr><td class="num"> 536/1045</td><td class="num">108/189</td><td class="num"> 52.19%</td><td class="left">'Mark P.'</td></tr>
-    <tr><td class="num"> 571/1045</td><td class="num"> 54/189</td><td class="num"> 50.65%</td><td class="left">'Breezy'</td></tr>
+    <tr><td class="num"> 556/1045</td><td class="num">111/189</td><td class="num"> 54.05%</td><td class="left">'Mark P.'</td></tr>
+    <tr><td class="num"> 616/1045</td><td class="num"> 46/189</td><td class="num"> 53.65%</td><td class="left">'ABS'</td></tr>
+    <tr><td class="num"> 579/1045</td><td class="num"> 56/189</td><td class="num"> 51.46%</td><td class="left">'Breezy'</td></tr>
     <tr><td class="num"> 589/1045</td><td class="num"> 26/189</td><td class="num"> 49.84%</td><td class="left">'hdwow'</td></tr>
     <tr><td class="num"> 533/1045</td><td class="num"> 82/189</td><td class="num"> 49.84%</td><td class="left">'Wuzzy'</td></tr>
     <tr><td class="num"> 506/1045</td><td class="num">108/189</td><td class="num"> 49.76%</td><td class="left">'Agnieszka'</td></tr>
     <tr><td class="num"> 501/1045</td><td class="num">106/189</td><td class="num"> 49.19%</td><td class="left">'Alexandros'</td></tr>
-    <tr><td class="num"> 500/1045</td><td class="num"> 93/189</td><td class="num"> 48.06%</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+    <tr><td class="num"> 510/1045</td><td class="num"> 93/189</td><td class="num"> 48.87%</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+    <tr><td class="num"> 500/1045</td><td class="num"> 67/189</td><td class="num"> 45.95%</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 519/1045</td><td class="num"> 37/189</td><td class="num"> 45.06%</td><td class="left">'Valkyrie2'</td></tr>
-    <tr><td class="num"> 484/1045</td><td class="num"> 65/189</td><td class="num"> 44.49%</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 516/1045</td><td class="num"> 24/189</td><td class="num"> 43.76%</td><td class="left">'niebie'</td></tr>
-    <tr><td class="num"> 486/1045</td><td class="num"> 13/189</td><td class="num"> 40.44%</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num"> 503/1045</td><td class="num"> 12/189</td><td class="num"> 41.73%</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num"> 495/1045</td><td class="num">  0/189</td><td class="num"> 40.11%</td><td class="left">'Edgar_Flesk'</td></tr>
+    <tr><td class="num"> 402/1045</td><td class="num"> 37/189</td><td class="num"> 35.58%</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 391/1045</td><td class="num"> 36/189</td><td class="num"> 34.60%</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 397/1045</td><td class="num"> 24/189</td><td class="num"> 34.12%</td><td class="left">'Chocolate Zero'</td></tr>
     <tr><td class="num"> 376/1045</td><td class="num"> 35/189</td><td class="num"> 33.31%</td><td class="left">'Jeffrey S'</td></tr>
     <tr><td class="num"> 392/1045</td><td class="num"> 12/189</td><td class="num"> 32.74%</td><td class="left">'NorthForty'</td></tr>
-    <tr><td class="num"> 368/1045</td><td class="num"> 32/189</td><td class="num"> 32.41%</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 344/1045</td><td class="num"> 51/189</td><td class="num"> 32.01%</td><td class="left">'Momcat'</td></tr>
     <tr><td class="num"> 382/1045</td><td class="num"> 10/189</td><td class="num"> 31.77%</td><td class="left">'J3FF'</td></tr>
     <tr><td class="num"> 346/1045</td><td class="num"> 38/189</td><td class="num"> 31.12%</td><td class="left">'Liam Sheehan'</td></tr>
     <tr><td class="num"> 332/1045</td><td class="num"> 48/189</td><td class="num"> 30.79%</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 306/1045</td><td class="num"> 71/189</td><td class="num"> 30.55%</td><td class="left">'Davacardo'</td></tr>
     <tr><td class="num"> 370/1045</td><td class="num">  7/189</td><td class="num"> 30.55%</td><td class="left">'IChrisI'</td></tr>
+    <tr><td class="num"> 328/1045</td><td class="num"> 39/189</td><td class="num"> 29.74%</td><td class="left">'Tiza'</td></tr>
+    <tr><td class="num"> 341/1045</td><td class="num"> 18/189</td><td class="num"> 29.09%</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num"> 331/1045</td><td class="num"> 14/189</td><td class="num"> 27.96%</td><td class="left">'Archcorenth'</td></tr>
     <tr><td class="num"> 281/1045</td><td class="num"> 63/189</td><td class="num"> 27.88%</td><td class="left">'erich'</td></tr>
     <tr><td class="num"> 295/1045</td><td class="num"> 29/189</td><td class="num"> 26.26%</td><td class="left">'Tiger'</td></tr>
+    <tr><td class="num"> 288/1045</td><td class="num"> 36/189</td><td class="num"> 26.26%</td><td class="left">'Drotten'</td></tr>
     <tr><td class="num"> 261/1045</td><td class="num"> 53/189</td><td class="num"> 25.45%</td><td class="left">'Andreas'</td></tr>
+    <tr><td class="num"> 304/1045</td><td class="num">  4/189</td><td class="num"> 24.96%</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num"> 276/1045</td><td class="num"> 15/189</td><td class="num"> 23.58%</td><td class="left">'Thomas'</td></tr>
-    <tr><td class="num"> 249/1045</td><td class="num"> 15/189</td><td class="num"> 21.39%</td><td class="left">'Nfol'</td></tr>
+    <tr><td class="num"> 273/1045</td><td class="num"> 15/189</td><td class="num"> 23.34%</td><td class="left">'Nfol'</td></tr>
+    <tr><td class="num"> 201/1045</td><td class="num"> 54/189</td><td class="num"> 20.66%</td><td class="left">'mhatta'</td></tr>
     <tr><td class="num"> 210/1045</td><td class="num"> 38/189</td><td class="num"> 20.10%</td><td class="left">'Sandra'</td></tr>
     <tr><td class="num"> 214/1045</td><td class="num"> 19/189</td><td class="num"> 18.88%</td><td class="left">'Adonica'</td></tr>
     <tr><td class="num"> 206/1045</td><td class="num">  4/189</td><td class="num"> 17.02%</td><td class="left">'krazy62'</td></tr>
@@ -73,8 +81,8 @@
     <tr><td class="num"> 158/1045</td><td class="num"> 20/189</td><td class="num"> 14.42%</td><td class="left">'Turbogurk'</td></tr>
     <tr><td class="num"> 156/1045</td><td class="num"> 17/189</td><td class="num"> 14.02%</td><td class="left">'Zak'</td></tr>
     <tr><td class="num"> 164/1045</td><td class="num">  0/189</td><td class="num"> 13.29%</td><td class="left">'Bent'</td></tr>
-    <tr><td class="num"> 147/1045</td><td class="num">  6/189</td><td class="num"> 12.40%</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num"> 148/1045</td><td class="num">  5/189</td><td class="num"> 12.40%</td><td class="left">'Rugby4ever'</td></tr>
+    <tr><td class="num"> 133/1045</td><td class="num"> 11/189</td><td class="num"> 11.67%</td><td class="left">'Uli'</td></tr>
     <tr><td class="num"> 110/1045</td><td class="num"> 31/189</td><td class="num"> 11.43%</td><td class="left">'Cyphase'</td></tr>
     <tr><td class="num"> 124/1045</td><td class="num"> 15/189</td><td class="num"> 11.26%</td><td class="left">'Magnus and Susi'</td></tr>
     <tr><td class="num"> 113/1045</td><td class="num"> 22/189</td><td class="num"> 10.94%</td><td class="left">'Mecki'</td></tr>

Modified: homepage/input/table-wr.html
===================================================================
--- homepage/input/table-wr.html	2007-09-01 11:33:03 UTC (rev 853)
+++ homepage/input/table-wr.html	2007-09-01 11:55:51 UTC (rev 854)
@@ -1,45 +1,47 @@
   <table>
-    <caption>$$Worldrecord_Statistics$$ $$July$$ 2007</caption>
+    <caption>$$Worldrecord_Statistics$$ $$August$$ 2007</caption>
     <colgroup><col width="80"><col width="80"><col width="470"></colgroup>
     <tr><th>$$total$$</th><th>$$shared$$</th><th class="left">$$user$$</th></tr>
-    <tr><td class="num">786</td><td class="num">234</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">257</td><td class="num">118</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num">181</td><td class="num">135</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num">102</td><td class="num"> 53</td><td class="left">'Duffy'</td></tr>
-    <tr><td class="num"> 87</td><td class="num"> 67</td><td class="left">'Great Scott'</td></tr>
-    <tr><td class="num"> 56</td><td class="num"> 45</td><td class="left">'Django'</td></tr>
-    <tr><td class="num"> 51</td><td class="num"> 41</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num">786</td><td class="num">238</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">253</td><td class="num">119</td><td class="left">'Stupid'</td></tr>
+    <tr><td class="num">175</td><td class="num">134</td><td class="left">'Johannes'</td></tr>
+    <tr><td class="num">100</td><td class="num"> 52</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num"> 84</td><td class="num"> 64</td><td class="left">'Great Scott'</td></tr>
+    <tr><td class="num"> 58</td><td class="num"> 46</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num"> 57</td><td class="num"> 46</td><td class="left">'Django'</td></tr>
     <tr><td class="num"> 40</td><td class="num"> 32</td><td class="left">'Iceshark7'</td></tr>
-    <tr><td class="num"> 36</td><td class="num">  9</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num"> 38</td><td class="num"> 10</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num"> 31</td><td class="num"> 25</td><td class="left">'Ghatotkacha'</td></tr>
-    <tr><td class="num"> 23</td><td class="num"> 13</td><td class="left">'Zekobah'</td></tr>
-    <tr><td class="num"> 20</td><td class="num"> 10</td><td class="left">'Alexandros'</td></tr>
-    <tr><td class="num"> 20</td><td class="num"> 17</td><td class="left">'bojster'</td></tr>
+    <tr><td class="num"> 23</td><td class="num"> 14</td><td class="left">'Zekobah'</td></tr>
+    <tr><td class="num"> 20</td><td class="num"> 16</td><td class="left">'ged'</td></tr>
+    <tr><td class="num"> 20</td><td class="num"> 18</td><td class="left">'bojster'</td></tr>
+    <tr><td class="num"> 19</td><td class="num"> 11</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 19</td><td class="num"> 13</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 17</td><td class="num"> 16</td><td class="left">'joseba'</td></tr>
+    <tr><td class="num"> 16</td><td class="num"> 14</td><td class="left">'Safalra'</td></tr>
     <tr><td class="num"> 15</td><td class="num">  9</td><td class="left">'Chocolate Zero'</td></tr>
-    <tr><td class="num"> 15</td><td class="num"> 12</td><td class="left">'ged'</td></tr>
-    <tr><td class="num"> 12</td><td class="num">  5</td><td class="left">'Lukas'</td></tr>
-    <tr><td class="num"> 11</td><td class="num">  3</td><td class="left">'Taztunes'</td></tr>
-    <tr><td class="num"> 11</td><td class="num">  9</td><td class="left">'Safalra'</td></tr>
+    <tr><td class="num"> 13</td><td class="num">  3</td><td class="left">'Taztunes'</td></tr>
+    <tr><td class="num"> 11</td><td class="num">  6</td><td class="left">'Lukas'</td></tr>
     <tr><td class="num"> 10</td><td class="num">  5</td><td class="left">'ShadowPhrogg32642342'</td></tr>
     <tr><td class="num"> 10</td><td class="num">  9</td><td class="left">'fabian'</td></tr>
-    <tr><td class="num">  9</td><td class="num">  6</td><td class="left">'Tobias'</td></tr>
+    <tr><td class="num">  9</td><td class="num">  3</td><td class="left">'Breezy'</td></tr>
+    <tr><td class="num">  9</td><td class="num">  5</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num">  9</td><td class="num">  7</td><td class="left">'Wuzzy'</td></tr>
-    <tr><td class="num">  8</td><td class="num">  5</td><td class="left">'Raoul'</td></tr>
-    <tr><td class="num">  7</td><td class="num">  2</td><td class="left">'Bent'</td></tr>
-    <tr><td class="num">  6</td><td class="num">  3</td><td class="left">'Ludmian' + 'para_doks'</td></tr>
+    <tr><td class="num">  8</td><td class="num">  4</td><td class="left">'Raoul'</td></tr>
+    <tr><td class="num">  8</td><td class="num">  6</td><td class="left">'Tobias'</td></tr>
+    <tr><td class="num">  7</td><td class="num">  6</td><td class="left">'dpl'</td></tr>
+    <tr><td class="num">  6</td><td class="num">  2</td><td class="left">'Bent'</td></tr>
+    <tr><td class="num">  6</td><td class="num">  3</td><td class="left">'para_doks'</td></tr>
     <tr><td class="num">  6</td><td class="num">  5</td><td class="left">'Guglielmo'</td></tr>
     <tr><td class="num">  5</td><td class="num">  5</td><td class="left">'Cyphase' + 'Thomas' + 'Chris' + 'Ralf'</td></tr>
+    <tr><td class="num">  4</td><td class="num">  0</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num">  4</td><td class="num">  4</td><td class="left">'J3FF'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  0</td><td class="left">'Ale'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  1</td><td class="left">'JuSt'</td></tr>
     <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'Stephanie'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'Neophilus'</td></tr>
-    <tr><td class="num">  2</td><td class="num">  0</td><td class="left">'shoki'</td></tr>
-    <tr><td class="num">  2</td><td class="num">  1</td><td class="left">'mrduke' + 'Edgar_Flesk' + 'Vlad'</td></tr>
+    <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'Neophilus' + 'ABS'</td></tr>
+    <tr><td class="num">  2</td><td class="num">  0</td><td class="left">'Ale'</td></tr>
+    <tr><td class="num">  2</td><td class="num">  1</td><td class="left">'mrduke' + 'Drotten' + 'Edgar_Flesk' + 'Vlad' + 'JuSt'</td></tr>
     <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'Sim_Ed' + 'Ingo'</td></tr>
-    <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'biotopa' + 'Turbogurk' + 'Daniel' + 'U-Punkt' + 'Alex' + 'NorthForty' + 'Breezy' + 'krazy62' + 'Ant' + 'Melanie' + 'IChrisI' + 'Markus' + 'Nat' + 'Tarim'</td></tr>
+    <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'biotopa' + 'Turbogurk' + 'U-Punkt' + 'Alex' + 'NorthForty' + 'shoki' + 'krazy62' + 'Ant' + 'Melanie' + 'IChrisI' + 'Markus' + 'Nat' + 'Tarim'</td></tr>
     <tr><td class="num">  1</td><td class="num">  1</td><td class="left">'Zak' + 'niebie' + 'Andreas' + 'Samuel' + 'Mark P.' + 'hdwow' + 'Asbel' + 'Vaily' + 'Meeve'</td></tr>
-    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'Miel56' + 'Alf' + 'Mecki' + 'Tiger' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'Magnus and Susi' + 'WP319' + 'xmouse' + 'erich' + 'Harry Lim' + 'Momcat' + 'The red O' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'jojo' + 'ryujun' + 'Klaus' + 'Valkyrie2' + 'AsuCaga' + 'Rugby4ever' + 'Archcorenth' + 'Dvorhagen' + 'Holger' + 'Ingo_K' + 'redsantz' + 'Liam Sheehan' + 'Michael' + 'Agnieszka'</td></tr>
+    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'Miel56' + 'Alf' + 'Gottseinsohn' + 'Mecki' + 'Tiger' + 'Davacardo' + 'Tiza' + 'Adonica' + 'Joona' + 'Sandra' + 'Magnus and Susi' + 'WP319' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Harry Lim' + 'Momcat' + 'The red O' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'jojo' + 'ryujun' + 'Klaus' + 'Valkyrie2' + 'AsuCaga' + 'Rugby4ever' + 'Archcorenth' + 'mhatta' + 'Dvorhagen' + 'Holger' + 'Ingo_K' + 'redsantz' + 'Liam Sheehan' + 'Michael' + 'Agnieszka'</td></tr>
   </table>

Modified: homepage/input/userlist.html
===================================================================
--- homepage/input/userlist.html	2007-09-01 11:33:03 UTC (rev 853)
+++ homepage/input/userlist.html	2007-09-01 11:55:51 UTC (rev 854)
@@ -1,6 +1,7 @@
 <div class="usernames">
 $$names_in_use$$
   <ul>
+    <li>ABS</li>
     <li>Adonica</li>
     <li>Agnieszka</li>
     <li>Ale</li>
@@ -24,6 +25,8 @@
     <li>Davacardo</li>
     <li>daydreamer</li>
     <li>Django</li>
+    <li>dpl</li>
+    <li>Drotten</li>
     <li>Duffy</li>
     <li>Dvorhagen</li>
     <li>Edgar_Flesk</li>
@@ -31,6 +34,7 @@
     <li>fabian</li>
     <li>ged</li>
     <li>Ghatotkacha</li>
+    <li>Gottseinsohn</li>
     <li>Great Scott</li>
     <li>Guglielmo</li>
     <li>Harry Lim</li>
@@ -60,6 +64,7 @@
     <li>Mecki</li>
     <li>Meeve</li>
     <li>Melanie</li>
+    <li>mhatta</li>
     <li>Michael</li>
     <li>Miel56</li>
     <li>Momcat</li>
@@ -90,11 +95,14 @@
     <li>The red O</li>
     <li>Thomas</li>
     <li>Tiger</li>
+    <li>Tiza</li>
     <li>Tobias</li>
     <li>Turbogurk</li>
+    <li>Uli</li>
     <li>U-Punkt</li>
     <li>Vaily</li>
     <li>Valkyrie2</li>
+    <li>Vinksu</li>
     <li>Vlad</li>
     <li>WP319</li>
     <li>Wuzzy</li>



From ral at mail.berlios.de  Sat Sep  1 15:29:52 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 1 Sep 2007 15:29:52 +0200
Subject: [Enigma-game-svn] r855 - in homepage/input: . news
Message-ID: <200709011329.l81DTqP7021912@sheep.berlios.de>

Author: ral
Date: 2007-09-01 15:29:52 +0200 (Sat, 01 Sep 2007)
New Revision: 855

Added:
   homepage/input/news/news_issue22_de.html
   homepage/input/news/news_issue22_en.html
Modified:
   homepage/input/credits.html
   homepage/input/credits_de.html
   homepage/input/infobox.html
   homepage/input/infobox_de.html
   homepage/input/output-files.lua
Log:
Homepage:
- 100th score committer info
- russian hp translation news 
- credits for Yuriy
 

Modified: homepage/input/credits.html
===================================================================
--- homepage/input/credits.html	2007-09-01 11:55:51 UTC (rev 854)
+++ homepage/input/credits.html	2007-09-01 13:29:52 UTC (rev 855)
@@ -151,6 +151,6 @@
         <li>Michael Terry&nbsp;&nbsp;&nbsp;(.desktop file)</li>
         <li>Ray Wick&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Joe Wreschnig&nbsp;&nbsp;&nbsp;(Manual page)</li>
-        <li>Yuriy Zhyromskiy&nbsp;&nbsp;&nbsp;(Russian Manual)</li>
+        <li>Yuriy Zhyromskiy&nbsp;&nbsp;&nbsp;(Russian Manual and Homepage Translation)</li>
     </ul>
 </div>

Modified: homepage/input/credits_de.html
===================================================================
--- homepage/input/credits_de.html	2007-09-01 11:55:51 UTC (rev 854)
+++ homepage/input/credits_de.html	2007-09-01 13:29:52 UTC (rev 855)
@@ -152,6 +152,6 @@
         <li>Michael Terry&nbsp;&nbsp;&nbsp;(.desktop file)</li>
         <li>Ray Wick&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Joe Wreschnig&nbsp;&nbsp;&nbsp;(Manual page f&uuml;r Unix)
-        <li>Yuriy Zhyromskiy&nbsp;&nbsp;&nbsp;(Russisches Handbuch)</li>
+        <li>Yuriy Zhyromskiy&nbsp;&nbsp;&nbsp;(Russisches Handbuch und Hompage)</li>
     </ul>
 </div>

Modified: homepage/input/infobox.html
===================================================================
--- homepage/input/infobox.html	2007-09-01 11:55:51 UTC (rev 854)
+++ homepage/input/infobox.html	2007-09-01 13:29:52 UTC (rev 855)
@@ -1,8 +1,8 @@
     <div class="infobody">
        <div class="info">
-         <h3>100 000 Downloads</h3>
-         Enigma release 1.01 shows again more than 100 000 downloads since
-	 end of May.
+         <h3>100 Score Submitters</h3>
+         We welcome user &quot;dpl&quot; who is the 100th active score submitter
+	 since Enigma 1.00.
          <h3>Level of the Month</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>

Modified: homepage/input/infobox_de.html
===================================================================
--- homepage/input/infobox_de.html	2007-09-01 11:55:51 UTC (rev 854)
+++ homepage/input/infobox_de.html	2007-09-01 13:29:52 UTC (rev 855)
@@ -1,8 +1,8 @@
     <div class="infobody">
        <div class="info">
-         <h3>100 000 Downloads</h3>
-         Auch Enigma Release 1.01 weist nun mehr als 100.000 Downloads seit
-	 Ende Mai auf.
+         <h3>100 Einsender von Ergebnissen</h3>
+         Wir heissen den Spieler &quot;dpl&quot; willkommen, der wir als 100sten
+	 aktiven Einsender von Spielergebnissen registriert haben.
          <h3>Level des Monats</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>

Added: homepage/input/news/news_issue22_de.html
===================================================================
--- homepage/input/news/news_issue22_de.html	2007-09-01 11:55:51 UTC (rev 854)
+++ homepage/input/news/news_issue22_de.html	2007-09-01 13:29:52 UTC (rev 855)
@@ -0,0 +1,7 @@
+<h3 class="news">
+    <span class="date">Sep 1 2007: </span> Russisches &Uuml;bersetzung der Homepage
+</h3>
+
+<p>Die Homepage wurde weitgehend ins Russische &uuml;bersetzt. Selektieren Sie
+Ihre bevorzugte Sprache durch klicken auf das Flaggensymbol in der rechten oberen
+Ecke.</p>


Property changes on: homepage/input/news/news_issue22_de.html
___________________________________________________________________
Name: svn:eol-style
   + native

Added: homepage/input/news/news_issue22_en.html
===================================================================
--- homepage/input/news/news_issue22_en.html	2007-09-01 11:55:51 UTC (rev 854)
+++ homepage/input/news/news_issue22_en.html	2007-09-01 13:29:52 UTC (rev 855)
@@ -0,0 +1,7 @@
+<h3 class="news">
+    <span class="date">Sep 1 2007: </span> Russian Homepage Translation
+</h3>
+
+<p>The homepage is now translated into Russian concerning most parts. Just
+select your favorite language by clicking on the flag symbols in the upper
+right corner.</p>


Property changes on: homepage/input/news/news_issue22_en.html
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: homepage/input/output-files.lua
===================================================================
--- homepage/input/output-files.lua	2007-09-01 11:55:51 UTC (rev 854)
+++ homepage/input/output-files.lua	2007-09-01 13:29:52 UTC (rev 855)
@@ -10,7 +10,7 @@
 
 -- The newsfield declares the news (by number) to be shown on the main page.
 
-newsfield = {16, 17, 18, 19, 20, 21}
+newsfield = {16, 17, 18, 19, 20, 21, 22}
 
 -- General $$mystring$$-macros. Strings are taken as-is, tables are
 -- constellations of html input files, functions are executed, with the



From andreasl at mail.berlios.de  Sat Sep  1 23:27:01 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Sat, 1 Sep 2007 23:27:01 +0200
Subject: [Enigma-game-svn] r856 - in homepage: images/lotm input input/lotm
Message-ID: <200709012127.l81LR1mb027152@sheep.berlios.de>

Author: andreasl
Date: 2007-09-01 23:27:00 +0200 (Sat, 01 Sep 2007)
New Revision: 856

Added:
   homepage/images/lotm/lotm-thumbnail.png
Modified:
   homepage/images/lotm/lotm-history.png
   homepage/input/credits.html
   homepage/input/credits_de.html
   homepage/input/lotm/lotm_200709.html
   homepage/input/lotm/lotm_core.html
   homepage/input/stat-other.html
Log:
Homepage:
 - thumbnail instead of full image in LotM archive,
   enlarged lotm-history.png
 - removed double "." and double ":" from stat-other
 - typos on German credits page
 - credits for Harry and me for LotM
 - additions in English LotM, but yet not ready


Modified: homepage/images/lotm/lotm-history.png
===================================================================
(Binary files differ)

Added: homepage/images/lotm/lotm-thumbnail.png
===================================================================
(Binary files differ)


Property changes on: homepage/images/lotm/lotm-thumbnail.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: homepage/input/credits.html
===================================================================
--- homepage/input/credits.html	2007-09-01 13:29:52 UTC (rev 855)
+++ homepage/input/credits.html	2007-09-01 21:27:00 UTC (rev 856)
@@ -26,7 +26,7 @@
         </tr>
         <tr>
             <td>Andreas&nbsp;Lochmann</td>
-            <td>Programming, level administration, level design, documentation, homepage</td>
+            <td>Programming, level administration, level design, documentation, homepage, LotM</td>
         </tr>
         <tr>
             <td>Petr&nbsp;Machata</td>
@@ -104,6 +104,7 @@
     <ul>
         <li>Roberto Bardin&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Nathan Bronecke&nbsp;&nbsp;&nbsp;(Level design)</li>
+        <li>Harry Bruder&nbsp;&nbsp;&nbsp;(LotM articles)</li>
         <li>Alain Busser&nbsp;&nbsp;&nbsp;(Level design, French translation, manual)</li>
         <li>Guy Busser&nbsp;&nbsp;&nbsp;(Level design)</li>
         <li>Richi B&uuml;tzer&nbsp;&nbsp;&nbsp;(Level design)</li>

Modified: homepage/input/credits_de.html
===================================================================
--- homepage/input/credits_de.html	2007-09-01 13:29:52 UTC (rev 855)
+++ homepage/input/credits_de.html	2007-09-01 21:27:00 UTC (rev 856)
@@ -26,7 +26,7 @@
         </tr>
         <tr>
             <td>Andreas&nbsp;Lochmann</td>
-            <td>Programmierung, Landschaftsverwaltung und -design, Dokumentation, Homepage</td>
+            <td>Programmierung, Landschaftsverwaltung und -design, Dokumentation, Homepage, LdM</td>
         </tr>
         <tr>
             <td>Petr&nbsp;Machata</td>
@@ -105,22 +105,23 @@
     <ul>
         <li>Roberto Bardin&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Nathan Bronecke&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
-        <li>Alain Busser&nbsp;&nbsp;&nbsp;(Landschaftsdesign, franz&ouml;sische &uuml;bersetzung und Handbuch)</li>
+        <li>Harry Bruder&nbsp;&nbsp;&nbsp;(LdM-Artikel)</li>
+        <li>Alain Busser&nbsp;&nbsp;&nbsp;(Landschaftsdesign, franz&ouml;sische &Uuml;bersetzung und Handbuch)</li>
         <li>Guy Busser&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Richi B&uuml;tzer&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>capkoh&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Christoph &amp; Anita&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
-        <li>Serge Dremuk&nbsp;&nbsp;&nbsp;(Russische &uuml;bersetzung)</li>
+        <li>Serge Dremuk&nbsp;&nbsp;&nbsp;(Russische &Uuml;bersetzung)</li>
         <li>Joseph Dunne&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Xerxes M. Dynatos&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Edward&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Stephanie Fabian&nbsp;&nbsp;&nbsp;(Wertvolle Fehlerberichte)</li>
-        <li>Roberto Garc&iacute;a&nbsp;&nbsp;&nbsp;(Spanische &uuml;bersetzung)</li>
+        <li>Roberto Garc&iacute;a&nbsp;&nbsp;&nbsp;(Spanische &Uuml;bersetzung)</li>
         <li>Andy Geldmacher&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Edwin Groothuis&nbsp;&nbsp;&nbsp;(FreeBSD Portierung)</li>
         <li>Immanuel Herrmann&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
-        <li>M&aacute;t&eacute; Lehel Juh&aacute;sz&nbsp;&nbsp;&nbsp;(Ungarische &uuml;bersetzung)</li>
-        <li>Samuele Kaplun&nbsp;&nbsp;&nbsp;(Italienische &uuml;bersetzung)</li>
+        <li>M&aacute;t&eacute; Lehel Juh&aacute;sz&nbsp;&nbsp;&nbsp;(Ungarische &Uuml;bersetzung)</li>
+        <li>Samuele Kaplun&nbsp;&nbsp;&nbsp;(Italienische &Uuml;bersetzung)</li>
         <li>Jens-Christian Korth&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Manuel K&ouml;nig&nbsp;&nbsp;&nbsp;(Landschaftsdesign, Fehlerberichte)</li>
         <li>Johannes Laire&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
@@ -129,13 +130,13 @@
         <li>Dominik Lehmann&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Edward Leuf&nbsp;&nbsp;&nbsp;(Feedback, Fehlerberichte)</li>
         <li>Ingo van Lil&nbsp;&nbsp;&nbsp;(Feedback, Fehlerberichte)</li>
-        <li>Frank van der Loo&nbsp;&nbsp;&nbsp;(Niederl&auml;ndische &uuml;bersetzung)</li>
+        <li>Frank van der Loo&nbsp;&nbsp;&nbsp;(Niederl&auml;ndische &Uuml;bersetzung)</li>
         <li>Sidney Markowitz&nbsp;&nbsp;&nbsp;(Mac OS X Portierung)</li>
         <li>Barry &amp; Lori Mead&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Linda Mihalic&nbsp;&nbsp;&nbsp;(Englisch Korrektur lesen)</li>
         <li>moonpearl&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
-        <li>Krishnamurti Lelis Lima Vieira Nunes&nbsp;&nbsp;&nbsp;(Portugiesische &uuml;bersetzung)</li>
-        <li>Daniel Nylander&nbsp;&nbsp;&nbsp;(Schwedische &uuml;bersetzung)</li>
+        <li>Krishnamurti Lelis Lima Vieira Nunes&nbsp;&nbsp;&nbsp;(Portugiesische &Uuml;bersetzung)</li>
+        <li>Daniel Nylander&nbsp;&nbsp;&nbsp;(Schwedische &Uuml;bersetzung)</li>
         <li>Andreas Persenius&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
 	<li>Mark Pulley&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Peter Santo&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
@@ -145,13 +146,13 @@
         <li>Spaceman&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Ulf Stegemann&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>J&uuml;rgen Sticht&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
-        <li>Mikke Surakka (Finnische &uuml;bersetzung)</li>
+        <li>Mikke Surakka (Finnische &Uuml;bersetzung)</li>
         <li>Andrzej Szombierski&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Tacvek&nbsp;&nbsp;&nbsp;(Lua 5.1 Upgrade)</li>
 	<li>James Taylor&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Michael Terry&nbsp;&nbsp;&nbsp;(.desktop file)</li>
         <li>Ray Wick&nbsp;&nbsp;&nbsp;(Landschaftsdesign)</li>
         <li>Joe Wreschnig&nbsp;&nbsp;&nbsp;(Manual page f&uuml;r Unix)
-        <li>Yuriy Zhyromskiy&nbsp;&nbsp;&nbsp;(Russisches Handbuch und Hompage)</li>
+        <li>Yuriy Zhyromskiy&nbsp;&nbsp;&nbsp;(Russisches Handbuch und Homepage)</li>
     </ul>
 </div>

Modified: homepage/input/lotm/lotm_200709.html
===================================================================
--- homepage/input/lotm/lotm_200709.html	2007-09-01 13:29:52 UTC (rev 855)
+++ homepage/input/lotm/lotm_200709.html	2007-09-01 21:27:00 UTC (rev 856)
@@ -104,20 +104,64 @@
   &quot;The Aztec Temple&quot; now tops the list again, with a really marginal
   advance: 9.17 versus 9.13!</p>
 
-  <h4>&quot;First title&quot;</h4>
+  <h4>&quot;It was clever how most of the tools had to be made&quot;</h4>
+  
+  <p>Unfortunately, this month only one of the three gamers we asked for a
+  comment, kindly answered our request; a fourth one at least was so kind to
+  promptly answer that he has no time. As it would've been too late to ask
+  others for comments (and we're no babysitters, by the way), this month's
+  article will be shorter than traditionally. I think they'd call it the peak
+  of LotM we just transgressed, don't you agree, Harry?</p>
+  
+  <div class="quote">
+  ...
+  </div>
 
+  However, &quot;Tool Time&quot; is our first Level of the Month, which makes
+  deep use of hiding objects. It's not the evil kind of hiding - it's more a
+  frame of exploration in which this feature is woven. 
+  
+  &quot;Tool Time&quot; also is a level from two lesser known authors.
 
+  <p>The design of &quot;Tool Time&quot; is quite familiar, and often seen in
+  other levels like &quot;Set Me Free&quot; or &quot;Laser Paradise&quot;.
+  Particularly the similarity to &quot;Disk Royal&quot; pops into mind. I think
+  they'd call it &quot;illmind-inspired design&quot;, don't you agree,
+  Harry?</p>
+
+  <div class="quote">
+  ...   [Indeed, it's the first and only level with this particular combination
+  of walls and floors in 0.92!]
+  </div>  
+
+  <div class="quote">
+  I thought the level was well designed in its use of items. Every single item
+  was used in the level, and it was clever how most of the tools had to be made
+  from other items, rather than just picked up and used.</div>
+
+  <div class="quote">
+  I became quite frustrated when I was getting close to solving it. I had
+  several attempts, each attempt ending with using the umbrella to cross the
+  abyss in the top right corner to hit the oxyd, then racing down to the bottom
+  of the level, arriving at the other abyss just after the umbrella wore off -
+  only to eventually realise that there was a much simpler way that I had
+  overlooked.</div>
+  <div class="author">Mark Pulley</div>
+
+
+
   <div class="lotmpic">
     <img src="$$imagedir$$/lotm/lotm_200709_b.png" alt="Level of the month" border="0">
     <div class="imagetitle">&quot;Listen, tin soldiers, once I find my tin opener
     &hellip;&quot; </div>
   </div>
+
+  -> Binford 6100 ?
   
-  <div class="lotmpic">
-    <img src="$$imagedir$$/lotm/lotm_200709_c.png" alt="Level of the month" border="0">
-    <div class="imagetitle">The Mead-Trap</div>
-  </div>
 
+  <h4>&quot;We designed a little trap, that was the centerpiece of the
+  level&quot;</h4>
+  
   <div class="quote">
   I am a single father and my daughter comes to visit me twice a year. When Lori
   visits, we like to play computer games and we were looking for a game that
@@ -137,6 +181,11 @@
   Lori actually contributed most of the really devious hiding places, and sneaky
   puzzle attributes.</div>
 
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200709_c.png" alt="Level of the month" border="0">
+    <div class="imagetitle">The Mead-Trap</div>
+  </div>
+  
   <div class="quote">
   One concept that we had never seen in any level before was the notion that you
   had to have a &quot;pair&quot; of tools to get back out of a trap that you

Modified: homepage/input/lotm/lotm_core.html
===================================================================
--- homepage/input/lotm/lotm_core.html	2007-09-01 13:29:52 UTC (rev 855)
+++ homepage/input/lotm/lotm_core.html	2007-09-01 21:27:00 UTC (rev 856)
@@ -33,8 +33,10 @@
   </table>
 
   <div class="lotmhistory">
-    <img src="$$imagedir$$/lotm/lotm-history.png" alt="$$lotm_history$$" border="0">
+    <a href="$$imagedir$$/lotm/lotm-history.png">
+    <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">
     <div class="imagetitle">$$lotm_history$$</div>
+    </a>
   </div>
 
 </div>

Modified: homepage/input/stat-other.html
===================================================================
--- homepage/input/stat-other.html	2007-09-01 13:29:52 UTC (rev 855)
+++ homepage/input/stat-other.html	2007-09-01 21:27:00 UTC (rev 856)
@@ -1,9 +1,9 @@
   <div class="stat-help">
     <h3>$$Other_Statistics$$</h3>
     <h4>$$Scores$$</h4>
-      52073 $$single_level_scores$$.
+      52073 $$single_level_scores$$
     <h4>$$Ratings$$</h4>
-      9153 $$single_level_ratings$$ 4.95 $$and_distribution$$: 
+      9153 $$single_level_ratings$$ 4.95 $$and_distribution$$ 
       <table>
         <colgroup><col width="80"><col width="80"></colgroup>
         <tr><th>$$rating$$</th><th>$$count$$</th></tr>



From ral at mail.berlios.de  Sun Sep  2 12:38:44 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 2 Sep 2007 12:38:44 +0200
Subject: [Enigma-game-svn] r857 - homepage
Message-ID: <200709021038.l82Aci0O022960@sheep.berlios.de>

Author: ral
Date: 2007-09-02 12:38:43 +0200 (Sun, 02 Sep 2007)
New Revision: 857

Modified:
   homepage/enigma.css
Log:
Homepage:
- css additions for lotm thumbnail

Modified: homepage/enigma.css
===================================================================
--- homepage/enigma.css	2007-09-01 21:27:00 UTC (rev 856)
+++ homepage/enigma.css	2007-09-02 10:38:43 UTC (rev 857)
@@ -458,3 +458,23 @@
 .credits table td {
     padding-right: 1em;
 }
+
+.lotmhistory {
+    text-align: center;
+    padding-top: 5em;
+    padding-left: 2em;
+    padding-bottom: 1em;
+}
+
+.lotmhistory img {
+    border-width: 4px;
+}
+
+.lotmhistory a:link, .lotmhistory  a:visited {
+    color: #777;   /* IE needs body attributes for image coloring */
+}
+
+.lotmhistory a:link:hover, .lotmhistory a:visited:hover {
+    color: #333;   /* IE needs body attributes for image coloring */
+}
+



From ral at mail.berlios.de  Sun Sep  2 15:00:14 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 2 Sep 2007 15:00:14 +0200
Subject: [Enigma-game-svn] r858 - trunk/src
Message-ID: <200709021300.l82D0Ekp016797@sheep.berlios.de>

Author: ral
Date: 2007-09-02 15:00:13 +0200 (Sun, 02 Sep 2007)
New Revision: 858

Modified:
   trunk/src/actors.cc
   trunk/src/world.cc
Log:
Trunk 1.1:
- limit no collision effects to basic ball actors


Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2007-09-02 10:38:43 UTC (rev 857)
+++ trunk/src/actors.cc	2007-09-02 13:00:13 UTC (rev 858)
@@ -255,7 +255,8 @@
 
 bool Actor::can_move() const { 
     if (Stone *st = GetStone (get_gridpos())) {
-        if (!server::NoCollisions)
+        if (!server::NoCollisions || !(get_traits().id_mask &
+                        (1<<ac_whiteball | 1<<ac_blackball | 1<<ac_meditation)))
             return !st->is_sticky(this);
     }
     return true;

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2007-09-02 10:38:43 UTC (rev 857)
+++ trunk/src/world.cc	2007-09-02 13:00:13 UTC (rev 858)
@@ -1141,7 +1141,8 @@
     ActorInfo &ai          = *a->get_actorinfo();
     double     restitution = 1.0; //0.85;
 
-    if (server::NoCollisions && (sc.stoneid != st_borderstone))
+    if (server::NoCollisions && (sc.stoneid != st_borderstone) && 
+                a->get_traits().id_mask & (1<<ac_whiteball | 1<<ac_blackball | 1<<ac_meditation))
         return;
 
     Contact contact (sc.contact_point, sc.normal);



From andreasl at mail.berlios.de  Tue Sep  4 00:06:04 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Tue, 4 Sep 2007 00:06:04 +0200
Subject: [Enigma-game-svn] r859 - homepage/input/lotm
Message-ID: <200709032206.l83M64MG011624@sheep.berlios.de>

Author: andreasl
Date: 2007-09-04 00:06:04 +0200 (Tue, 04 Sep 2007)
New Revision: 859

Added:
   homepage/input/lotm/lotm_200709_de.html
Modified:
   homepage/input/lotm/lotm_200709.html
   homepage/input/lotm/lotm_core_de.html
   homepage/input/lotm/lotm_core_ru.html
Log:
LotM:
 - Complete LotM article 9/07 in English and German
 - LotM-history-thumbnails in _de and _ru (forgot this last time)
Todo:
 - Proofread English LotM
 - Russian translation


Modified: homepage/input/lotm/lotm_200709.html
===================================================================
--- homepage/input/lotm/lotm_200709.html	2007-09-02 13:00:13 UTC (rev 858)
+++ homepage/input/lotm/lotm_200709.html	2007-09-03 22:06:04 UTC (rev 859)
@@ -3,7 +3,7 @@
 
   <h3 class="lotm">
     <span class="date">September 2007: </span>
-    &quot;Tool Time&quot; by Barri and Lori Mead
+    &quot;Tool Time&quot; by Barry and Lori Mead
   </h3>
 
   <p>You know this? You are standing in your crammed garage, your long-serving
@@ -103,7 +103,7 @@
   ratings: After it was second to &quot;Island Labyrinth&quot; for two months,
   &quot;The Aztec Temple&quot; now tops the list again, with a really marginal
   advance: 9.17 versus 9.13!</p>
-
+  
   <h4>&quot;It was clever how most of the tools had to be made&quot;</h4>
   
   <p>Unfortunately, this month only one of the three gamers we asked for a
@@ -113,28 +113,50 @@
   article will be shorter than traditionally. I think they'd call it the peak
   of LotM we just transgressed, don't you agree, Harry?</p>
   
-  <div class="quote">
-  ...
+  <p><i>Well, Andreas, last month's LotM article about &quot;Houdini&quot;
+  surely was a peak in Lotm History but isn't it a joy to write about excellent
+  Enigma levels each month again? With or without the support of our fellow
+  players we surely will be able to pay tribute to &quot;Tool Time&quot; as
+  another peak of level designing arts. Or would you disagree, Andreas? Should
+  we surrender due to the lack of supporters like the Titanic surrendered due to
+  the leaks supported by icebergs? And don't they say that brevity is the soul
+  of wit? If i compare my personal record of &quot;Houdini&quot; to the one of
+  &quot;Tool Time&quot; the latter one indeed seems rather brief. But it really
+  takes some time to gather together all the things you need to finally succeed.
+  Oh, just have a look at this lovely rhyme, Andreas! Don't you think i would
+  have become a good poet?</i></p>
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200709_b.png" alt="Level of the month" border="0">
+    <div class="imagetitle">&quot;Listen, tin soldiers, once I find my tin opener
+    &hellip;&quot; </div>
   </div>
+  
+  <p>One could think so, Harry. But I wonder how you plan to port this pretty
+  piece of poetry to plain German? ;-) Speaking of artists, the design of
+  &quot;Tool Time&quot; is quite familiar, and often seen in other levels like
+  &quot;Set Me Free&quot; or &quot;Laser Paradise&quot;. Particularly the
+  similarity to &quot;Disk Royal&quot; comes to mind. I think they'd call it
+  &quot;illmind-inspired design&quot;, don't you agree, Harry?</p>
 
-  However, &quot;Tool Time&quot; is our first Level of the Month, which makes
-  deep use of hiding objects. It's not the evil kind of hiding - it's more a
-  frame of exploration in which this feature is woven. 
+  <p><i>One could think so, Andreas, but wasn't that period which you call
+  &quot;illmind-inspired design&quot; two years after the publishing of
+  &quot;Tool Time&quot;?. Surely you mean this mixture of st-rock1 and fl-black
+  that gives you an uncanny sensation like walking in the abandoned castle of Dr
+  Frankenstein, every moment expecting his creature to sneak around the corner
+  makes your hair stand on end! If my investigations on this matter by
+  assistance of my servant Grep had been carried out correctly Barry & Lori Mead
+  had been the first to use this stone/floor-combination and so it would be fair
+  to call this arrangement Mead-Design. Wouldn't you agree, Andreas? </i></p>
   
-  &quot;Tool Time&quot; also is a level from two lesser known authors.
+  <p>I think so, Harry. And, &quot;Tool Time&quot; is first in yet another
+  respect: It's our first Level of the Month, which makes deep use of hiding
+  objects. It's not the evil kind of hiding - it's more a frame of exploration
+  in which this feature is woven. Speaking about Frankenstein, hiding behind
+  transformations is another wonderful aspect of this level, and surely the most
+  wonderous to beginners. Mark picks up on this:</p>
 
-  <p>The design of &quot;Tool Time&quot; is quite familiar, and often seen in
-  other levels like &quot;Set Me Free&quot; or &quot;Laser Paradise&quot;.
-  Particularly the similarity to &quot;Disk Royal&quot; pops into mind. I think
-  they'd call it &quot;illmind-inspired design&quot;, don't you agree,
-  Harry?</p>
-
   <div class="quote">
-  ...   [Indeed, it's the first and only level with this particular combination
-  of walls and floors in 0.92!]
-  </div>  
-
-  <div class="quote">
   I thought the level was well designed in its use of items. Every single item
   was used in the level, and it was clever how most of the tools had to be made
   from other items, rather than just picked up and used.</div>
@@ -148,26 +170,28 @@
   overlooked.</div>
   <div class="author">Mark Pulley</div>
 
+  <p><i> If only this laser had more power, we could blast that wall to the
+  south, or perhaps we could build a Binford 6100 Steamhammer. Working doors
+  into the walls would be a child's play with such a tool! Nothing beats the
+  right tool, as Aunt Julie from Yorkshire used to say, don't you agree to that,
+  Andreas? don't you agree, Andreas?</i>
 
+  <p>I don't think so, Harry. This is solid rock type 1. If it was type 3, this
+  could work. But Mark surely meant another way.</p>
 
-  <div class="lotmpic">
-    <img src="$$imagedir$$/lotm/lotm_200709_b.png" alt="Level of the month" border="0">
-    <div class="imagetitle">&quot;Listen, tin soldiers, once I find my tin opener
-    &hellip;&quot; </div>
-  </div>
+  <h4>&quot;We designed a little trap, that was the centerpiece of the
+  level&quot;</h4>
 
-  -> Binford 6100 ?
-  
+  <p>Barry and Lori are of the lesser known authors, and I'm very happy that
+  one of their three unique levels finally became LotM. Here's the history of
+  &quot;Tool Time&quot;, as Barry sent it to us:</p>
 
-  <h4>&quot;We designed a little trap, that was the centerpiece of the
-  level&quot;</h4>
-  
   <div class="quote">
   I am a single father and my daughter comes to visit me twice a year. When Lori
   visits, we like to play computer games and we were looking for a game that
   involved the solving of puzzles.  I happend upon Enigma, when I did a google
   search for &quot;Puzzle Games&quot; and we started playing the levels.</div>
-  
+
   <div class="quote">
   After we had solved about 95% of the levels, we began to develop a feeling for
   what kind of levels we liked and what kind of levels we thought were just
@@ -218,6 +242,6 @@
   level you shared with us!</p>
 
   <p>Greets,<br/>
-  <i>Andreas and Harry</i></p>
+  <i>Harry and Andreas</i></p>
 
 </div>

Added: homepage/input/lotm/lotm_200709_de.html
===================================================================
--- homepage/input/lotm/lotm_200709_de.html	2007-09-02 13:00:13 UTC (rev 858)
+++ homepage/input/lotm/lotm_200709_de.html	2007-09-03 22:06:04 UTC (rev 859)
@@ -0,0 +1,291 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">September 2007: </span>
+    &quot;Tool Time&quot; von Barry und Lori Mead
+  </h3>
+
+  <p>Kennen Sie das? Sie stehen in ihrer v&ouml;llig &uuml;berf&uuml;llten Werkstatt, Ihre
+  altgediente laserbetriebene Drehbank zu Ihrer Rechten, eine hei&szlig;e Tasse Kaffe
+  steht auf einer kleinen Ablage in einer Ecke besagter Werkstatt, ein
+  vollst&auml;ndig verkrusteter Oxydstein vor Ihnen, der seit langem schon auf eine
+  General&uuml;berholung wartet; und Ihre Gedanken kreisen nur um eine Frage:
+  &quot;Wo habe ich den Hammer hingelegt?&quot; Ja, es ist &quot;Tool
+  Time&quot;!</p>
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200709_a.png" alt="Level des Monats" border="0">
+    <div class="imagetitle">Enigma II # 97</div>
+  </div>
+
+  <table cellpadding="0" cellspacing="1" class="statistics">
+    <caption class="normalcaption">Einige Rekorde vom August 2007</caption>
+    <colgroup>
+       <col width="80">
+       <col width="160">
+    </colgroup>
+    <tr><td class="num">2:37</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">3:47</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">4:48</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">6:16</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">6:17</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">6:28</td>
+        <td class="left">Johannes</td></tr>
+    <tr><td class="num">7:15</td>
+        <td class="left">Alexandros+mrduke</td></tr>
+    <tr><td class="num">7:22</td>
+        <td class="left">Mark P.</td></tr>
+    <tr><td class="num">7:32</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">7:33</td>
+        <td class="left">hdwow</td></tr>
+    <tr><td class="num">7:53</td>
+        <td class="left">Tobias</td></tr>
+    <tr><td class="num">8:26</td>
+        <td class="left">para_doks</td></tr>
+    <tr><td class="num">8:27</td>
+        <td class="left">HuB34</td></tr>
+    <tr><td class="num">8:30</td>
+        <td class="left">Alex</td></tr>
+    <tr><td class="num">8:41</td>
+        <td class="left">Django</td></tr>
+    <tr><td class="num">8:43</td>
+        <td class="left">fabian</td></tr>
+    <tr><td class="num">9:08</td>
+        <td class="left">ShadowPhrogg32642342</td></tr>
+    <tr><td class="num">9:10</td>
+        <td class="left">JuSt</td></tr>
+    <tr><td class="num">9:24</td>
+        <td class="left">Marc-Hendrik</td></tr>
+    <tr><td class="num">9:30</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">9:43</td>
+        <td class="left">redsantz</td></tr>
+    <tr><td class="num">10:06</td>
+        <td class="left">shoki</td></tr>
+    <tr><td class="num">10:27</td>
+        <td class="left">Melanie</td></tr>
+    <tr><td class="num">10:45</td>
+        <td class="left">Ghatotkacha</td></tr>
+    <tr><td class="num">10:48</td>
+        <td class="left">Klaus</td></tr>
+    <tr><td class="num">10:58</td>
+        <td class="left">Tarim</td></tr>
+    <tr><td class="num">11:17</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">11:19</td>
+        <td class="left">Sim_Ed</td></tr>
+    <tr><td class="num">11:36</td>
+        <td class="left">Valkyrie2</td></tr>
+    <tr><td class="num">12:23</td>
+        <td class="left">Adonica</td></tr>
+    <tr><td class="num">12:56</td>
+        <td class="left">Jeffrey S</td></tr>
+    <tr><td class="num">13:53</td>
+        <td class="left">Duffy</td></tr>
+    <tr><td class="num">17:09</td>
+        <td class="left">WP319</td></tr>
+    <tr><td class="num">18:23</td>
+        <td class="left">Breezy</td></tr>
+    <tr><td class="num">32:15</td>
+        <td class="left">biotopa</td></tr>
+  </table>
+  
+  <p>Laut unseren Daten vom Juli haben 13 Spieler &uuml;ber &quot;Tool Time&quot;
+  abgestimmt, mit einem Schnitt von <b>8,46</b>, was &quot;Tool Time&quot; auf
+  Position 6 unserer <a href="$$lotm$$">LdM-Highscoreliste</a> installiert,
+  Kopf an Kopf mit &quot;Elaborate&quot;, der seinen leichten Vorsprung
+  gegen&uuml;ber &quot;Labyrinth of Puzzles&quot; in den letzten zwei Monaten
+  eingeb&uuml;&szlig;t hat. Und eine weitere &Uuml;berraschung der aktuellen Bewertungen:
+  Nachdem er f&uuml;r zwei Monate zweiter hinter &quot;Island Labyrinth&quot; war,
+  f&uuml;hrt &quot;The Aztec Temple&quot; nun die Liste wieder an, mit einem
+  wirklich marginalen Vorsprung: 9,17 gegen 9,13!</p>
+  
+  <h4>&quot;Es ist ziemlich clever gemacht, wie die meisten Tools hergestellt
+  werden m&uuml;ssen&quot;</h4>
+
+  <p>Ungl&uuml;cklicherweise hat diesen Monat nur einer der drei Spieler, die wir um
+  einen Kommentar gebeten haben, auch freundlicherweise geantwortet. Ein
+  vierter war zumindest so nett uns umgehend zu antworten, dass er keine Zeit
+  hat. Da es zu sp&auml;t gewesen w&auml;re, andere um Kommentare zu bitten (und wir im
+  &uuml;brigen keine Babysitter sind), wird dieser Artikel leider k&uuml;rzer ausfallen
+  als gew&ouml;hnlich. Ich denke, man k&ouml;nnte sagen, dass wir den Gipfel des LdM
+  &uuml;berschritten haben, meinst Du nicht, Harry?</p>
+
+  <p><i>Ja, man k&ouml;nnte vielleicht auf diesen Gedanken kommen, Andreas. Der
+  Artikel vom letzten Monat &uuml;ber &quot;Houdini&quot; war schon ein
+  H&ouml;hepunkt in der zugegebenerma&szlig;en noch ziemlich jungen Geschichte
+  von &quot;Level des Monats&quot;. Aber ist es nicht eine Freude, jeden Monat
+  aufs Neue einen n&auml;heren Blick auf einen herausragenden Level werfen zu
+  d&uuml;rfen?! Und ob mit oder ohne die Unterst&uuml;tzung durch die Berichte
+  unserer gesch&auml;tzten Mitspieler werden wir es auch dieses Mal hinbekommen,
+  einen dem Anlass angemessen Beitrag zu verfassen, und &quot;Tool Time&quot;
+  als einen weiteren H&ouml;hepunkt der Levelgestaltungskunst zu
+  w&uuml;rdigen.</i></p>
+
+  <p><i>Und sagt nicht das alte Sprichwort &quot;In der K&uuml;rze liegt die
+  W&uuml;rze&quot? Wenn der Artikel also dieses Mal etwas k&uuml;rzer
+  ausf&auml;llt als &uuml;blich, so ist dies sicherlich nicht als ein Anzeichen
+  von geringerer Qualit&auml;t zu bewerten.</i></p>
+
+  <p><i>Vergleicht man etwa die L&ouml;sungszeiten von &quot;Houdini&quot; mit
+  denen von &quot;Tool Time&quot;, k&ouml;nnte man den Eindruck gewinnen, das es
+  ein Leichtes ist, &quot;Tool Time&quot; zu bew&auml;ltigen. Weit gefehlt, man
+  muss schon einiges an Zeit investieren, bis man herausgefunden hat, wie man
+  &quot;Tool Time&quot; am besten &quot;bewerkstelligt&quot;, um dann eine
+  schnelle &quot;Tool Time&quot; erzielen zu k&ouml;nnen. Es braucht einiges an
+  Zeit, all die Dinge zusammenzubringen, und bist du endlich dann so weit, soll
+  es dir auch gelingen, all die Oxyds weit und breit, zum Erleuchten zu bringen.
+  Andreas, schau' dir nur diesen lieblichen Reim an! Meinst du nicht, an mir ist
+  ein Dichter verloren gegangen?</i></p> 
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200709_b.png" alt="Level of the month" border="0">
+    <div class="imagetitle">&quot;H&ouml;rt zu, Zinnsoldaten, wenn ich erstmal<br/>
+    meinen Dosen&ouml;ffner gefunden habe &hellip;&quot; </div>
+  </div>
+  
+  <p>Das k&ouml;nnte man denken, Harry. Aber ich frage mich, wie Du diese
+  durchtriebene Dichtkunst zu dolmetschen gedenkst, f&uuml;r unsere
+  englischsprachigen Leserinnen und Leser? Wo wir gerade von K&uuml;nstlern
+  sprechen, das Design von &quot;Tool Time&quot; ist recht vertraut, man trifft
+  es oft in anderen Levels wie &quot;Set Me Free&quot; oder &quot;Laser
+  Paradise&quot; an. Besonders die &Auml;hnlichkeit zu &quot;Disk Royal&quot; f&auml;llt
+  auf. Ich denke, man k&ouml;nnte dies &quot;illmind-inspiriertes Design&quot;
+  nennen, meinst Du nicht, Harry?</p>
+
+  <p><i>In der Tat, Andreas, auf diese Idee k&ouml;nnte man leicht kommen. Aber
+  hat diese Periode, die du als &quot;illmind-inspiriertes Design&quot;
+  bezeichnest, nicht erst zwei Jahre nach dem Erscheinen von &quot;Tool
+  Time&quot; eingesetzt? Bestimmt meinst du damit doch diese Mischung aus grauen
+  Mauersteinen (st-rock1) und schwarzen Bodenfliesen (fl-black)? Diese
+  Kombination vermittelt einem ein unheimliches Gef&uuml;hl, das einem die Haare
+  zu Berge stehen l&auml;sst, so in etwa als ob man in den Verliesen von Burg
+  Frankenstein unterwegs ist, in best&auml;ndiger Angst, dass auf einmal Doktor
+  F.'s Monster um die Ecke biegt. Wenn ich meine Nachforschungen in dieser
+  Angelegenheit richtig durchgef&uuml;hrt habe, will hei&szlig;en, wenn ich
+  meinen Assistenten Grep korrekt instruiert habe, dann waren Lori und Barry
+  Mead die ersten, die diese unheimlich anheimelnde Komposition aus Wand- und
+  Bodensteinen verwendet haben. Fairerweise sollte man dieses Design also als
+  Mead-Design bezeichnen, meinst du nicht auch, Andreas?</i></p>
+
+  <p>Das denke ich, Harry. Und, &quot;Tool Time&quot; ist noch in einem
+  weiteren Aspekt Erster: Er ist unser erster Level des Monats, der wesentlich
+  Gebrauch davon macht, Objekte zu verstecken. Es ist nicht die b&ouml;se Art des
+  Versteckens - es geschieht mehr in einem Kontext der Erforschung, in den
+  dieses Feature eingewoben ist. Wo wir von Frankenstein sprechen, das
+  Verstecken hinter Transformationen ist ein weiterer wundervoller Aspekt
+  dieses Levels, und sicherlich der wunderlichste f&uuml;r Anf&auml;nger. Mark greift das
+  nochmal auf:</p>
+
+  <div class="quote">
+  Der Level ist gut durchdacht, was die Anwendung der Items anbelangt. Jedes
+  einzelne Item hatte einen Verwendungszweck, und es ist ziemlich clever
+  gemacht, wie die meisten Tools aus anderen Items hergestellt werden m&uuml;ssen,
+  anstatt einfach nur aufgesammelt und benutzt zu werden.</div>
+
+  <div class="quote">
+  Kurz davor, den Level zu schaffen, hatte ich mehrere Fehlversuche, die mich
+  ziemlich frustriert haben. Es lief immer nach dem gleichen Schema ab: Den
+  Schirm in der oberen rechten Ecke benutzen, um an den Oxyd zu gelangen, und
+  dann so schnell wie m&ouml;glich nach unten zu dem anderen Abyss vor der
+  Kaffeetasse zu fliegen, und dort jedes Mal erst anzukommen, kurz nachdem die
+  Wirkung des Schirms aufgeh&ouml;rt hatte. Schlie&szlig;lich ist mir dann doch klar
+  geworden, dass es einen wesentlich einfacheren Weg gibt, den ich einfach
+  &uuml;bersehen hatte.</div>
+  <div class="author">Mark Pulley</div>
+
+  <p><i>Wenn doch nur dieser Laser mehr Power h&auml;tte! Dann k&ouml;nnten wir
+  diese Wand im S&uuml;den einfach in die Luft jagen! Oder wir k&ouml;nnten uns
+  einen Dampfhammer zusammenbauen, nat&uuml;rlich einen Binford, Modell 6100!
+  Mit so einem Ger&auml;t w&auml;r's ein Kinderspiel, ein paar Durchg&auml;nge in
+  die Mauern einzubauen! Wie meine Tante Julie aus Yorkshire immer gesagt hat:
+  Es geht doch nichts &uuml;ber das richtige Werkzeug! Oder was meinst du dazu,
+  Andreas?</i></p>
+
+  <p>Das glaube ich nicht, Harry. Das ist solider Fels vom Typ 1. Wenn das Typ
+  3 w&auml;re, k&ouml;nnte das funktionieren. Aber Mark hat bestimmt einen anderen Weg
+  gemeint.</p>
+
+  <h4>&quot;Wir entwarfen eine kleine Falle, die der Mittelpunkt dieses Level
+  ist&quot;</h4>
+
+  <p>Barry und Lori geh&ouml;ren zu den weniger bekannten Autoren, und es freut mich
+  sehr, dass einer ihrer drei einzigartigen Levels nun auch Level des Monats
+  geworden ist. Hier ist die Geschichte von &quot;Tool Time&quot;, wie sie uns
+  Barry zugesandt hat:</p>
+
+  <div class="quote">
+  Ich bin ein allein stehender Vater, und meine Tochter kommt mich zweimal im
+  Jahr besuchen. Wenn Lori bei mir ist, besch&auml;ftigen wir uns am liebsten mit
+  Computerspielen, und wir waren damals auf der Suche nach einem R&auml;tselspiel.
+  Ich bin auf Enigma gesto&szlig;en, als ich mit Google nach &quot;Puzzle Games&quot;
+  gesucht habe, und so begannen wir also damit, Enigmalevel zu spielen.</div>
+
+  <div class="quote">
+  Nachdem wir etwa 95% der Level gel&ouml;st hatten, entwickelten wir ein Gef&uuml;hl
+  daf&uuml;r, welche Level uns zusagten, und welche uns eigentlich nur auf den Wecker
+  gingen. Wir stellten fest, dass &quot;WIR&quot; die Puzzles am liebsten
+  hatten, bei denen man ERFORSCHEN und NACHDENKEN muss. So sehr wir diese Level
+  sch&auml;tzten, so wenig mochten wir hingegen diejenigen, bei denen man sich
+  BEEILEN muss.</div>
+
+  <div class="quote">
+  Ich hatte zuvor etwa 25 Jahre als Elekro-Ingenieur und Software-Entwickler
+  gearbeitet, so dass mir die Sprache, in der die Enigmalevel geschrieben
+  werden, keine Probleme bereitete, und meine Tochter Lori war es eigentlich,
+  die all diese wirklich schwer zu entdeckenden Verstecke ausgeheckt hat, und
+  auch insgesamt f&uuml;r die geheimnisvolle Atmosph&auml;re des Levels verantwortlich
+  ist.</div>
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200709_c.png" alt="Level des Monats" border="0">
+    <div class="imagetitle">Die Mead-Falle</div>
+  </div>
+
+  <div class="quote">
+  Ein Konzept, dass wir bis dahin in noch keinem einzigen Level verwirklicht
+  gesehen hatten, ist die Idee, gleich ein &quot;Paar&quot; von Werkzeugen zu
+  ben&ouml;tigen, um sich aus einer Falle wieder zu befreien, und es sollte klar
+  erkennbar sein, um welche Werkzeuge es sich handelt, bevor man sich in die
+  Falle begibt. Wir entwarfen eine kleine Falle, f&uuml;r die beides, sowohl Schwert
+  als auch Hammer, ben&ouml;tigt werden, um wieder zu entkommen, und die zugleich
+  auch der Mittelpunkt des ganzen Geschehens in diesem Level ist.</div>
+
+  <div class="quote">
+  Genauso gefiel uns die Vorstellung, dass der Samen, aus dem der Holzstein
+  entsteht, unter einem Ger&uuml;st gesetzt werden muss, und der Holzstein so einen
+  dreifachen Zweck erf&uuml;llen kann: 1. einen Bodenschalter gedr&uuml;ckt halten, 2. den
+  Wert einer M&uuml;nze ver&auml;ndern und 3. eine Br&uuml;cke &uuml;ber einen Abgrund bilden.</div>
+
+  <div class="quote">
+  Und genauso wenig hatten wir jemals zuvor bemerkt, dass jemand auf die Idee
+  gekommen war, einen Gegenstand unterhalb eines Weltraum-Feldes zu verstecken,
+  wobei die Flugbahn der Kugel im voraus genau berechnet werden muss, um an das
+  Objekt zu gelangen.</div>
+
+  <div class="quote">
+  Ich sch&auml;tze mal, die Erfahrung, die wir beim Spielen aller Level aus der
+  Version 0.82 gewonnen haben, kombiniert mit einer Liebe f&uuml;r R&auml;tselspiele im
+  Allgemeinen hat uns inspiriert, diesen Level zu kreieren.</div>
+
+  <div class="author">
+  Mit freundlichen Gr&uuml;&szlig;en, Barry Mead und Tochter Lori</div>
+
+  <p>Wir erinnern uns an Manuels <a href="lotm_200704.html">&quot;Pneumatic
+  Delivery&quot;</a>, das er f&uuml;r seinen Vater erschaffen hat. Und &quot;Tool
+  Time&quot; ist ein gemeinsames Projekt von Vater und Tochter. Es ist
+  gro&szlig;artig zu sehen, wie Enigma Eltern und Kinder zusammenbringt, selbst ohne
+  Netzwerkspiel. Barry, Lori: vielen, vielen Dank f&uuml;r diese wichtige Lektion,
+  und den wunderbaren Level, den Ihr mit uns geteilt habt!</p>
+
+  <p>Sch&ouml;ne Gr&uuml;&szlig;e,<br/>
+  <i>Harry and Andreas</i></p>
+
+</div>

Modified: homepage/input/lotm/lotm_core_de.html
===================================================================
--- homepage/input/lotm/lotm_core_de.html	2007-09-02 13:00:13 UTC (rev 858)
+++ homepage/input/lotm/lotm_core_de.html	2007-09-03 22:06:04 UTC (rev 859)
@@ -35,8 +35,10 @@
   </table>
 
   <div class="lotmhistory">
-    <img src="$$imagedir$$/lotm/lotm-history.png" alt="$$lotm_history$$" border="0">
+    <a href="$$imagedir$$/lotm/lotm-history.png">  
+    <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">
     <div class="imagetitle">$$lotm_history$$</div>
+    </a>
   </div>
 
 </div>

Modified: homepage/input/lotm/lotm_core_ru.html
===================================================================
--- homepage/input/lotm/lotm_core_ru.html	2007-09-02 13:00:13 UTC (rev 858)
+++ homepage/input/lotm/lotm_core_ru.html	2007-09-03 22:06:04 UTC (rev 859)
@@ -30,8 +30,10 @@
   </table>
 
   <div class="lotmhistory">
-    <img src="$$imagedir$$/lotm/lotm-history.png" alt="$$lotm_history$$" border="0">
+    <a href="$$imagedir$$/lotm/lotm-history.png">
+    <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">
     <div class="imagetitle">$$lotm_history$$</div>
+    </a>
   </div>
   
 </div>



From ral at mail.berlios.de  Tue Sep  4 13:14:47 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 4 Sep 2007 13:14:47 +0200
Subject: [Enigma-game-svn] r860 - homepage/input/lotm
Message-ID: <200709041114.l84BElft024911@sheep.berlios.de>

Author: ral
Date: 2007-09-04 13:14:46 +0200 (Tue, 04 Sep 2007)
New Revision: 860

Modified:
   homepage/input/lotm/lotm_core.html
   homepage/input/lotm/lotm_core_de.html
   homepage/input/lotm/lotm_core_ru.html
Log:
Homepage:
- fix HTML

Modified: homepage/input/lotm/lotm_core.html
===================================================================
--- homepage/input/lotm/lotm_core.html	2007-09-03 22:06:04 UTC (rev 859)
+++ homepage/input/lotm/lotm_core.html	2007-09-04 11:14:46 UTC (rev 860)
@@ -35,7 +35,7 @@
   <div class="lotmhistory">
     <a href="$$imagedir$$/lotm/lotm-history.png">
     <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">
-    <div class="imagetitle">$$lotm_history$$</div>
+    $$lotm_history$$
     </a>
   </div>
 

Modified: homepage/input/lotm/lotm_core_de.html
===================================================================
--- homepage/input/lotm/lotm_core_de.html	2007-09-03 22:06:04 UTC (rev 859)
+++ homepage/input/lotm/lotm_core_de.html	2007-09-04 11:14:46 UTC (rev 860)
@@ -37,7 +37,7 @@
   <div class="lotmhistory">
     <a href="$$imagedir$$/lotm/lotm-history.png">  
     <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">
-    <div class="imagetitle">$$lotm_history$$</div>
+    $$lotm_history$$
     </a>
   </div>
 

Modified: homepage/input/lotm/lotm_core_ru.html
===================================================================
--- homepage/input/lotm/lotm_core_ru.html	2007-09-03 22:06:04 UTC (rev 859)
+++ homepage/input/lotm/lotm_core_ru.html	2007-09-04 11:14:46 UTC (rev 860)
@@ -32,7 +32,7 @@
   <div class="lotmhistory">
     <a href="$$imagedir$$/lotm/lotm-history.png">
     <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">
-    <div class="imagetitle">$$lotm_history$$</div>
+    $$lotm_history$$
     </a>
   </div>
   



From andreasl at mail.berlios.de  Tue Sep  4 21:08:34 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Tue, 4 Sep 2007 21:08:34 +0200
Subject: [Enigma-game-svn] r861 - homepage/input/lotm
Message-ID: <200709041908.l84J8Y7e028380@sheep.berlios.de>

Author: andreasl
Date: 2007-09-04 21:08:34 +0200 (Tue, 04 Sep 2007)
New Revision: 861

Added:
   homepage/input/lotm/lotm_200709_ru.html
Log:
Homepage:
 - Russian LotM 9/07, thanks to ged!
Todo:
 - html-validation


Added: homepage/input/lotm/lotm_200709_ru.html
===================================================================
--- homepage/input/lotm/lotm_200709_ru.html	2007-09-04 11:14:46 UTC (rev 860)
+++ homepage/input/lotm/lotm_200709_ru.html	2007-09-04 19:08:34 UTC (rev 861)
@@ -0,0 +1,244 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">???????? 2007: </span>
+    &quot;Tool Time&quot; ?? Barry ? Lori Mead
+  </h3>
+
+  <p>?? ?????? ?? ????? ?? ? ????? ????????????? ??????, ??? ???????? ??????????? ??????? ?????? ?????? ?? ???,
+  ??????? ???? ????? ?? ?????? ????? ? ???? ??? ??????????? ??????,
+  ????????? ???????????? ?????? oxyd ????? ???? ? ????????
+  ??????; ? ?????? ???? ?????? ?????? ??? ??? ??????? ????: &quot;???? ? ???????
+  ????????&quot; ??, ??? &quot;Tool Time&quot;!</p>
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200709_a.png" alt="Level of the month" border="0">
+    <div class="imagetitle">Enigma II # 97</div>
+  </div>
+
+  <table cellpadding="0" cellspacing="1" class="statistics">
+    <caption class="normalcaption">????????? ???????? ??????? 2007</caption>
+    <colgroup>
+       <col width="80">
+       <col width="160">
+    </colgroup>
+    <tr><td class="num">2:37</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">3:47</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">4:48</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">6:16</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">6:17</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">6:28</td>
+        <td class="left">Johannes</td></tr>
+    <tr><td class="num">7:15</td>
+        <td class="left">Alexandros+mrduke</td></tr>
+    <tr><td class="num">7:22</td>
+        <td class="left">Mark P.</td></tr>
+    <tr><td class="num">7:32</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">7:33</td>
+        <td class="left">hdwow</td></tr>
+    <tr><td class="num">7:53</td>
+        <td class="left">Tobias</td></tr>
+    <tr><td class="num">8:26</td>
+        <td class="left">para_doks</td></tr>
+    <tr><td class="num">8:27</td>
+        <td class="left">HuB34</td></tr>
+    <tr><td class="num">8:30</td>
+        <td class="left">Alex</td></tr>
+    <tr><td class="num">8:41</td>
+        <td class="left">Django</td></tr>
+    <tr><td class="num">8:43</td>
+        <td class="left">fabian</td></tr>
+    <tr><td class="num">9:08</td>
+        <td class="left">ShadowPhrogg32642342</td></tr>
+    <tr><td class="num">9:10</td>
+        <td class="left">JuSt</td></tr>
+    <tr><td class="num">9:24</td>
+        <td class="left">Marc-Hendrik</td></tr>
+    <tr><td class="num">9:30</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">9:43</td>
+        <td class="left">redsantz</td></tr>
+    <tr><td class="num">10:06</td>
+        <td class="left">shoki</td></tr>
+    <tr><td class="num">10:27</td>
+        <td class="left">Melanie</td></tr>
+    <tr><td class="num">10:45</td>
+        <td class="left">Ghatotkacha</td></tr>
+    <tr><td class="num">10:48</td>
+        <td class="left">Klaus</td></tr>
+    <tr><td class="num">10:58</td>
+        <td class="left">Tarim</td></tr>
+    <tr><td class="num">11:17</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">11:19</td>
+        <td class="left">Sim_Ed</td></tr>
+    <tr><td class="num">11:36</td>
+        <td class="left">Valkyrie2</td></tr>
+    <tr><td class="num">12:23</td>
+        <td class="left">Adonica</td></tr>
+    <tr><td class="num">12:56</td>
+        <td class="left">Jeffrey S</td></tr>
+    <tr><td class="num">13:53</td>
+        <td class="left">Duffy</td></tr>
+    <tr><td class="num">17:09</td>
+        <td class="left">WP319</td></tr>
+    <tr><td class="num">18:23</td>
+        <td class="left">Breezy</td></tr>
+    <tr><td class="num">32:15</td>
+        <td class="left">biotopa</td></tr>
+  </table>
+  
+  <p>?? ????? ?????? ? ???? 13 ????????????? ????????????? ?? &quot;Tool Time&quot,
+  ? ??????? <b>8.46</b>, ??? ?????????? &quot;Tool Time&quot; 6 ?????
+  ? ????? <a href="$$lotm$$">???????? ????</a>, ?? ????? ? 
+  &quot;Elaborate&quot;, ??????? ??????? ???? ???????????? ????????? ??? &quot;Labyrinth of
+  Puzzles&quot; ?? ????????? ??? ??????. ? ?????? ????????????? ???????? ????????:
+  ????? ????????????? ?????????? ?? ?????? ????? ????? &quot;Island Labyrinth&quot;,
+  &quot;The Aztec Temple&quot; ?????? ????? ??????????? ??????, ? ?????? ????? ???????????: 
+  9.17 ?????? 9.13!</p>
+  
+  <h4>&quot;???? ??????? ??????????, ??? ???????? ??????????? ????????????&quot;</h4>
+  
+  <p>? ?????????, ? ???? ?????? ?????? ???? ?? ???? ???????, ??????? ?? ????????? 
+  ???????? ???????????, ?????????? ?? ???? ???????????; ????????? ????? ???????, 
+  ??? ? ???? ??? ???????. ??-?? ????, ??? ??? ?? ?????????? ??????? ????????? 
+  ????????? ???????? ???? ?????? (? ?? ?? ????, ??????), ?????? ????? ??????
+  ????? ??????, ??? ??????. ? ????? ??? ????????? ?? ????
+  ???, ??????? ?? ??? ???????????, ?? ??? ??, Harry?</p>
+  
+  <p><i>?????, Andreas, ?????? ? ????????? ?? ? &quot;Houdini&quot;
+  ?????????? ???? ???????? ??????? ???, ?? ????? ?? ??????? ????? ? ????? ?????? ? ?????????????
+  ??????? Enigma ?????? ?????? ? ??????? ????? ??????? ??? ??? ???
+  ?? ??????? ?????? ?????? ??????? &quot;Tool Time&quot; ???
+  ??? ????? ??????? ????????? ?????????? ???????. ??? ?? ?? ????????, Andreas? ?????? ??
+  ?? ??????? ??-?? ?????????? ?????????, ??? ??????? ?????? ?? ????
+  ???????, ????????? ?????????? ? ????? ???-?????? ??????, ??? ????????? ?????? ????????
+  ???? ? ?????? ???? ?????? ?????? ? &quot;Houdini&quot; ? ??? ??? ?
+  &quot;Tool Time&quot;, ????????? ????????????? ??????? ?????? ?????????. ?? ?? ????? ????,
+  ????? ??????? ?????? ??? ????, ??????????? ??? ????????????? ?????? ????? ????????? ?????.
+  ?, ?????? ???????? ?? ??? ????????????? ?????, Andreas(??. ???????? ? ?????????? ???????? ??????, 
+  ? ????????? ????????? ????? ? ???????? ?? ???????)! ???? ?? ???????, ??? ? ??????????
+  ??????? ???????</i></p>
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200709_b.png" alt="Level of the month" border="0">
+    <div class="imagetitle">&quot;????????, ????????? ?????????,
+    <br> ?????? ? ????? ????????? ???
+  &hellip;&quot; </div>
+  </div>
+  
+  <p>? ? ????? ????????, Harry. ?? ? ?? ???????????, ??? ?? ?????????? ????????? ???? ?????????????? ???????
+  ?????? ? ???????? ??? ????????? ;-) ??? ???????? ??????????? ???, ??????????
+  &quot;Tool Time&quot; ?????????? ???????, ? ????? ??????????? ? ?????? ???????, ?? ???????
+  &quot;Set Me Free&quot; ??? &quot;Laser Paradise&quot;. ?? ?? ???????? ??????????? ???????
+  &quot;Disk Royal&quot;. ? ????? ??? ????? ???????
+  &quot;?????????? ? ????? illmind&quot;, ? ?? ??? ???????, Harry?</p>
+
+  <p><i>????? ??? ??, Andreas, ?? ?? ??????? ?? ??? ??????, ??????? ?? ????????? 
+  &quot;?????????? ? ????? illmind&quot; ?? ??? ???? ?? ??????? 
+  &quot;Tool Time&quot;?. ??????? ?? ???? ????? ??? ????? ????????? ?????????? st-rock1 ? fl-black,
+  ??????? ??????? ?????? ??????? ???????? ?? ?????????? ????? ???????
+  ?????????????, ?????? ??????? ???????? ????????? ??? ?????????? ?????? ? ????
+  ? ?? ????? ?????? ?????? ?????! ???? ??? ???????????? ?? ????? ???????, ???????? ????????? ? ???? ?????? Grep,
+  ???? ????????? ????? Barry & Lori Mead
+  ??????? ??????????????? ???? ?????????? ??????/???????????? ? ?????? ???? ?? ???????
+  ??? ??????????? Mead-??????????. ???? ???, Andreas? </i></p>
+  
+  <p>? ????? ??, Harry. ? &quot;Tool Time&quot; ?????? ? ??? ????? ?????????:
+  ??? ??? ?????? ??????? ??????, ??????? ??????????????? ?????????? ?????
+  ?????????? ????????. ??? ?? ???????? ?????? - ?????? ???????????????? ????????????,
+  ?? ???????? ???????? ??? ???????????. ??? ???????? ?????????????, ???????? ?? 
+  ???????????????? - ?????? ?????????????? ?????? ????? ??????, ? ??????? ????? 
+  ???????????? ??? ??????????. ?????? ???????? ?? ???:</p>
+
+  <div class="quote">
+  ? ?????? ??????? ?????? ????????????? ? ????????? ????????????? ?????????. ?????? ????????? ???????
+  ???????????? ? ??????, ? ???? ??????? ??????????, ??? ???????? ??????????? ????????????
+  ?? ????????? ?????????, ??? ????? ??? ?????? ????????? ? ????????????.</div>
+
+  <div class="quote">
+  ? ????? ?????????????, ????? ?????????? ??? ??????. ? ???? 
+  ???? ????????? ???????, ?????? ????????????? ?????????????? ???????, ????? ??????? ????? 
+  ?????? ? ?????? ??????? ???? ? ??????? oxyd, ????? ????? ????
+  ??????, ????????? ? ?????? ?????? ????? ????? ????????? ??????? -
+  ?????? ??? ????, ????? ??????? ????????, ??? ???? ????? ??????? ????, ??? ??? ??? ? ??? ?????.</div>
+  <div class="author">Mark Pulley</div>
+
+  <p><i> ???? ?????? ? ????? ?????? ?????? ????????, ?? ????? ???????? ?? ????? ? ???
+  ??? ???????? ?? ????? ??????? ??????? ????? Binford 6100. ??????????? ?????
+  ? ?????? ?????? ??????? ????? ? ????? ????????????! ????? ?? ??????? ?????????? ??????????,
+  ??? ??????? ??????? Julie ?? Yorkshire, ?? ? ???? ????????, Andreas?</i>
+
+  <p>? ??? ?? ?????, Harry. ????? ???????? ????? 1-?? ????. ???? ?? ??? ???? 3-?? ????, ??? ?? 
+  ?????????. ?? Mark ??????? ?????? ?????? ????.</p>
+
+  <h4>&quot;?? ??????? ????????? ???????, ??????? ???? ?? ??????????? ?????????
+  ??????&quot;</h4>
+
+  <p>Barry ? Lori - ???? ?? ????? ????????? ??????? ? ? ????? ???, ???
+  ???? ?? ?? ???? ?????????? ??????? ??????? ???? ??. ????? ???????? ???????
+  &quot;Tool Time&quot;, ? ??? ????, ? ????? Barry ??????? ?? ???:</p>
+
+  <div class="quote">
+  ? ???????? ???? ? ??? ???? ????????? ?? ??? ??? ???? ? ???. ????? Lori
+  ???????? ????, ?? ????? ?????? ? ???????????? ???? ? ?? ????? ?????? ????,
+  ? ??????? ???? ??????? ???????????. ? ???????????? ? Enigma, ????? ???? ?
+  google &quot;Puzzle Games&quot; ? ?? ?????? ?????? ?? ???????.</div>
+
+  <div class="quote">
+  ????? ????, ??? ?? ?????? ????? 95% ???????, ?? ?????? ???????? ????? 
+  ?????? ??? ???????? ? ? ????? ???? ???????? ????????? ? 
+  &quot;????-?-???&quot;. ?? ????????, ??? &quot;???&quot; ????????
+  ??????????, ??????? ?????????? ??? ??????????? ? ??????. ??? ?? ???????? ??????????, ??????? ?????????? ???
+  ????? ??? ????? ??????????.</div>
+
+  <div class="quote">
+  ? 25 ??? ??????? ??????? ????????? ?? ???????????/???????????? ???????????, ??????? 
+  ???? ????????? ??????? Enigma ?? ??? ??? ???? ???????, ? ??? ????
+  Lori ?????????? ??????????? ??????????? ???????? ?????? ????????, ? ????????? ?????? ???????????.</div>
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200709_c.png" alt="Level of the month" border="0">
+    <div class="imagetitle">??????? Mead</div>
+  </div>
+  
+  <div class="quote">
+  ???????????? ????, ??????? ?? ??????? ?????? ?? ?????? ?? ? ????? ??????, ???????? ? ???
+  ??? ? ??? ???? &quot;????&quot; ????????????, ????? ????????? ?? ???????, ? ???????
+  ?? ??????. ?? ?????????????? ????????? ???????, ?????????
+  &quot;? ???, ? ???????&quot;, ????? ????????, ? ??? ??? ??????????? ???????
+  ??????.</div>
+
+  <div class="quote">
+  ??? ????? ??????????? ???? ? ?????? ??????????? ?????, ??????? ?????? ???? ??????? ??? ???????? ?????,
+  ????? ?????????? ??? ????????????? ?? ???? ???? ????????? ?????. ?????????? ????
+  &quot;1. ????????? ??????? ?????????????, 2. ???????? ??????? ??????, ? 3. ??????? ????
+  ????? ??????&quot;.</div>
+
+  <div class="quote"> ????? ?? ??????? ?? ??????, ????? ???-?? ?????? ???????? ??? ????????? 
+  ????????? ???????, ??? ?? ?????? ???????????? ?????????? ????????, ????? ????? ???????.</div>
+
+  <div class="quote"> ? ????? ?? ???????? ????? ?????? ??? ????????? ???? ???? ?? ???? ???????
+  ?????? 0.82, ??????????? ? ??????? ? ????????????.</div>
+
+  <div class="author">
+  ???????? ????, Barry Mead ? ???? Lori</div>
+
+  <p>??? ?????? ?? ?? <a href="lotm_200704.html">&quot;Pneumatic
+  Delivery&quot;</a> Manuel'?, ??????? ?? ?????? ??? ?????? ????. ? &quot;Tool
+  Time&quot; ?????????? ?????? ???? ? ??????. ??????? ??????, ??? 
+  Enigma ?????????? ????????? ? ?????, ???? ??? ??????? ????.
+  Barry, Lori, ???????? ??? ??????? ?? ???? ?????? ????, ? ??????? ???????,
+  ??????? ?? ? ???? ??????????!</p>
+
+  <p>? ?????????,<br/>
+  <i>Harry ? Andreas</i></p>
+
+</div>



From andreasl at mail.berlios.de  Wed Sep  5 20:33:16 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Wed, 5 Sep 2007 20:33:16 +0200
Subject: [Enigma-game-svn] r862 - homepage/input/lotm
Message-ID: <200709051833.l85IXGOF006937@sheep.berlios.de>

Author: andreasl
Date: 2007-09-05 20:33:16 +0200 (Wed, 05 Sep 2007)
New Revision: 862

Modified:
   homepage/input/lotm/lotm_core.html
   homepage/input/lotm/lotm_core_de.html
   homepage/input/lotm/lotm_core_ru.html
Log:
Homepage:
 - corrected alignment of lotm-history caption


Modified: homepage/input/lotm/lotm_core.html
===================================================================
--- homepage/input/lotm/lotm_core.html	2007-09-04 19:08:34 UTC (rev 861)
+++ homepage/input/lotm/lotm_core.html	2007-09-05 18:33:16 UTC (rev 862)
@@ -35,6 +35,9 @@
   <div class="lotmhistory">
     <a href="$$imagedir$$/lotm/lotm-history.png">
     <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">
+    </a>
+    <br/>
+    <a href="$$imagedir$$/lotm/lotm-history.png">
     $$lotm_history$$
     </a>
   </div>

Modified: homepage/input/lotm/lotm_core_de.html
===================================================================
--- homepage/input/lotm/lotm_core_de.html	2007-09-04 19:08:34 UTC (rev 861)
+++ homepage/input/lotm/lotm_core_de.html	2007-09-05 18:33:16 UTC (rev 862)
@@ -35,8 +35,11 @@
   </table>
 
   <div class="lotmhistory">
-    <a href="$$imagedir$$/lotm/lotm-history.png">  
+    <a href="$$imagedir$$/lotm/lotm-history.png">
     <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">
+    </a>
+    <br/>
+    <a href="$$imagedir$$/lotm/lotm-history.png">
     $$lotm_history$$
     </a>
   </div>

Modified: homepage/input/lotm/lotm_core_ru.html
===================================================================
--- homepage/input/lotm/lotm_core_ru.html	2007-09-04 19:08:34 UTC (rev 861)
+++ homepage/input/lotm/lotm_core_ru.html	2007-09-05 18:33:16 UTC (rev 862)
@@ -32,6 +32,9 @@
   <div class="lotmhistory">
     <a href="$$imagedir$$/lotm/lotm-history.png">
     <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">
+    </a>
+    <br/>
+    <a href="$$imagedir$$/lotm/lotm-history.png">
     $$lotm_history$$
     </a>
   </div>



From andreasl at mail.berlios.de  Wed Sep  5 20:58:44 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Wed, 5 Sep 2007 20:58:44 +0200
Subject: [Enigma-game-svn] r863 - in homepage/input: lotm news
Message-ID: <200709051858.l85Iwiuv008189@sheep.berlios.de>

Author: andreasl
Date: 2007-09-05 20:58:43 +0200 (Wed, 05 Sep 2007)
New Revision: 863

Modified:
   homepage/input/lotm/lotm_core_de.html
   homepage/input/news/news_issue12_de.html
   homepage/input/news/news_issue15_de.html
   homepage/input/news/news_issue16_de.html
   homepage/input/news/news_issue19_de.html
   homepage/input/news/news_issue1_de.html
   homepage/input/news/news_issue21_de.html
   homepage/input/news/news_issue22_de.html
   homepage/input/news/news_issue2_de.html
   homepage/input/news/news_issue8_de.html
Log:
Homepage:
 - corrected small bug in German LotM archive page
 - typos in several German news


Modified: homepage/input/lotm/lotm_core_de.html
===================================================================
--- homepage/input/lotm/lotm_core_de.html	2007-09-05 18:33:16 UTC (rev 862)
+++ homepage/input/lotm/lotm_core_de.html	2007-09-05 18:58:43 UTC (rev 863)
@@ -13,8 +13,8 @@
   ist die aktuelle Bewertung durch Spieler, die Zahl in Klammern gibt an,
   wieviele Spieler diesen Level bereits bewertet haben.</p>
 
-  <p>Die Daten sind vom <b>$$lotm_archive_data_from$$</b>, geordnet nach
-  <b>Bewertung</b>:</p> 
+  <p>Die Daten sind vom <b>$$lotm_archive_data_from$$</b>,
+  $$kind_of_order$$:</p>
 
   <table>
     <colgroup>

Modified: homepage/input/news/news_issue12_de.html
===================================================================
--- homepage/input/news/news_issue12_de.html	2007-09-05 18:33:16 UTC (rev 862)
+++ homepage/input/news/news_issue12_de.html	2007-09-05 18:58:43 UTC (rev 863)
@@ -8,7 +8,7 @@
 
 <ul>
     <li>Falls Sie die 640x512-Aufl&ouml;sung in Enigma 0.81 verwendet haben,
-        betritt das Spiel nun nicht mehr in eine Endlosschleife nach dem Laden
+        betritt das Spiel nun nicht mehr eine Endlosschleife nach dem Laden
         der Spieldaten.</li>
     <li>Alle Levelpakete sind aus dem Men&uuml; heraus sichtbar, statt nur
         &quot;Tutorial&quot; und &quot;Sokoban&quot;.</li>

Modified: homepage/input/news/news_issue15_de.html
===================================================================
--- homepage/input/news/news_issue15_de.html	2007-09-05 18:33:16 UTC (rev 862)
+++ homepage/input/news/news_issue15_de.html	2007-09-05 18:58:43 UTC (rev 863)
@@ -4,7 +4,7 @@
 
 <p>Ich freue mich, nach einer langen Pause das erste &ouml;ffentliche
     Test-Release von Enigma seit mehr als einem Jahr anzuk&uuml;ndigen. Es ist
-    verf&uuml;gbar aud der <a
+    verf&uuml;gbar auf der <a
     href="$$download$$">Download-Seite</a>. Da der Zweck eines
     Test-Releases das Finden und Reparieren von m&ouml;glichst vielen Fehlern
     ist, berichten Sie bitte alle Fehler, die Sie finden, an die <a
@@ -14,6 +14,7 @@
 <p>Gleichzeitig erf&uuml;llt diese Version den Zweck, Spielergebnisse f&uuml;r
     die Auswertung unserer Statistiken einzusammeln und die Weltrekordliste
     auf neuestem Stand zu halten. Bitte senden Sie uns Ihre Score-Datei nach
-    einem Update zu 1.00 Beta wie beschrieben in <a
-    href="$$support$$#score">Spielergebnisse einsenden</a> zu.
+    einem Update zu 1.00 Beta wie in <a
+    href="$$support$$#score">&quot;Spielergebnisse einsenden&quot;</a>
+    beschrieben zu.
 </p>

Modified: homepage/input/news/news_issue16_de.html
===================================================================
--- homepage/input/news/news_issue16_de.html	2007-09-05 18:33:16 UTC (rev 862)
+++ homepage/input/news/news_issue16_de.html	2007-09-05 18:58:43 UTC (rev 863)
@@ -11,7 +11,7 @@
     <li> 200 neue Level (inzwischen insgesamt mehr als 970!)</li>
     <li> Neue Gruppierung der Levelpacks</li>
     <li> Drop & play von neuen Levels und Levelpacks</li>
-    <li> Levelinspector mit Bewertungen und Statistiken f&uuml;r jedes Level</li>
+    <li> Levelinspector mit Bewertungen und Statistiken f&uuml;r jeden Level</li>
     <li> Screenshot Betrachter</li>
     <li> Pers&ouml;nliche Bemerkungen und Bewertungen von Levels m&ouml;glich</li>
     <li> &Uuml;bersetzungen der Leveltitel und Dokumente</li>
@@ -21,10 +21,10 @@
   
 <p>Mit 1.00 besitzt jeder Level neben dem Weltrekord Statistiken u.a. zum durchschnittlichen
     Rating und der Zahl der Spieler, die es gel&ouml;st haben. Diese Daten sind von Ihrem
-    Feedback abh&auml;ngig. Bitte unterst&uuml;tzten sie dieses neue Feature, indem
+    Feedback abh&auml;ngig. Bitte unterst&uuml;tzen sie dieses neue Feature, indem
     Sie uns Ihre Spieldaten wie in <a href="$$support$$#score">Spielergebnisse einsenden</a>
     beschrieben zur&uuml;ckschicken.</p>
   
 <p>Wie &uuml;blich ist die neue Version auf der <a href="$$download$$">Downloadseite</a> erh&auml;ltlich. (<font color="red">Mac OS X nun auch verf&uuml;gbar!</font>).</p>
 
-<p>Viel Spass!</p>
+<p>Viel Spa&szlig;!</p>

Modified: homepage/input/news/news_issue19_de.html
===================================================================
--- homepage/input/news/news_issue19_de.html	2007-09-05 18:33:16 UTC (rev 862)
+++ homepage/input/news/news_issue19_de.html	2007-09-05 18:58:43 UTC (rev 863)
@@ -2,7 +2,7 @@
     <span class="date">M&auml;r 9 2007: </span> Homepage Neugestaltung
 </h3>
 
-<p>Wundern Sie sich warum diese Seite so ver&auml;ndert aussieht? Wir haben sie
+<p>Wundern Sie sich, warum diese Seite so ver&auml;ndert aussieht? Wir haben sie
 von Grund auf neugestaltet. Die &Auml;nderungen umfassen:</p>
 
 <ul>

Modified: homepage/input/news/news_issue1_de.html
===================================================================
--- homepage/input/news/news_issue1_de.html	2007-09-05 18:33:16 UTC (rev 862)
+++ homepage/input/news/news_issue1_de.html	2007-09-05 18:58:43 UTC (rev 863)
@@ -8,10 +8,10 @@
 
 <ul>
     <li>Geschwindigkeitsverbesserungen</li>
-    <li>Stereo sound</li>
+    <li>Stereo-Sound</li>
     <li>Mehr als 70 neue Levels</li>
     <li>Stark verbesserte Maussteuerung</li>
-    <li>Support der originalen Soundfiles von Oxyd (see the README file that
-        comes with Enigma for details</li>
-    <li>Neue Spielobjekte wie Gummib&#228;nder, Wurml&#246;cher, bewegliche Platformen</li>
+    <li>Support der originalen Soundfiles von Oxyd (lesen Sie f&uuml;r Details die
+        README Datei, die Enigma beiliegt)</li>
+    <li>Neue Spielobjekte wie Gummib&#228;nder, Wurml&#246;cher, bewegliche Plattformen</li>
 </ul>

Modified: homepage/input/news/news_issue21_de.html
===================================================================
--- homepage/input/news/news_issue21_de.html	2007-09-05 18:33:16 UTC (rev 862)
+++ homepage/input/news/news_issue21_de.html	2007-09-05 18:58:43 UTC (rev 863)
@@ -12,7 +12,7 @@
     <li> Hinzuf&uuml;gung eines einfachen Modus f&uuml;r einige bestehende Level </li>
     <li> Korrektur aller Level mit bekanntgewordenen Abk&uuml;rzungen</li>
     <li> Finnische &Uuml;bersetzung, franz&ouml;sisches und russisches Handbuch</li>
-    <li> Unterst&uuml;rzung von Levelpacketen, die &uuml;ber das Internet aktualisiert werden</li>
+    <li> Unterst&uuml;tzung von Levelpaketen, die &uuml;ber das Internet aktualisiert werden</li>
     <li> Ger&auml;uschd&auml;mpfung f&uuml;r laute Level</li>
     <li> Neue Windows Installation mit moderner Oberfl&auml;che</li>
     <li> Viele kleinere Verbesserungen</li>
@@ -20,10 +20,10 @@
   
 <p>Mit 1.01 k&ouml;nnen Sie Level, die verbessert worden sind, abweichend zur alten
     Version bewerten. Bitte fahren Sie fort uns Ihren Feedback in Form Ihrer 
-    Spieldaten, wie in <a href="$$support$$#score">Spielergebnisse einsenden</a>
-    beschrieben, zur&uuml;ckzusenden.</p>
+    Spieldaten, wie in <a href="$$support$$#score">&quot;Spielergebnisse
+    einsenden&quot;</a> beschrieben, zur&uuml;ckzusenden.</p>
   
 <p>Wie &uuml;blich ist die neue Version auf der <a href="$$download$$">Downloadseite</a> erh&auml;ltlich.
     (<font color="red">Mac OS X nun auch verf&uuml;gbar!</font>).</p>
 
-<p>Viel Spass!</p>
+<p>Viel Spa&szlig;!</p>

Modified: homepage/input/news/news_issue22_de.html
===================================================================
--- homepage/input/news/news_issue22_de.html	2007-09-05 18:33:16 UTC (rev 862)
+++ homepage/input/news/news_issue22_de.html	2007-09-05 18:58:43 UTC (rev 863)
@@ -1,7 +1,7 @@
 <h3 class="news">
-    <span class="date">Sep 1 2007: </span> Russisches &Uuml;bersetzung der Homepage
+    <span class="date">Sep 1 2007: </span> Russische &Uuml;bersetzung der Homepage
 </h3>
 
 <p>Die Homepage wurde weitgehend ins Russische &uuml;bersetzt. Selektieren Sie
-Ihre bevorzugte Sprache durch klicken auf das Flaggensymbol in der rechten oberen
+Ihre bevorzugte Sprache durch Klicken auf das Flaggensymbol in der rechten oberen
 Ecke.</p>

Modified: homepage/input/news/news_issue2_de.html
===================================================================
--- homepage/input/news/news_issue2_de.html	2007-09-05 18:33:16 UTC (rev 862)
+++ homepage/input/news/news_issue2_de.html	2007-09-05 18:58:43 UTC (rev 863)
@@ -3,6 +3,6 @@
     Neue Installationspackete
 </h3>
 
-<p class="news">Neue RPM Packete sind auf der
+<p class="news">Neue RPM Pakete sind auf der
     <a href="$$download$$">download page</a> zu finden.
 </p>

Modified: homepage/input/news/news_issue8_de.html
===================================================================
--- homepage/input/news/news_issue8_de.html	2007-09-05 18:33:16 UTC (rev 862)
+++ homepage/input/news/news_issue8_de.html	2007-09-05 18:58:43 UTC (rev 863)
@@ -7,7 +7,7 @@
 Test-Release von Enigma seit mehr als einem Jahr ank&uuml;ndigen zu
 k&ouml;nnen. Es ist verf&uuml;gbar auf der <a
 href="$$download$$">Download-Seite</a>. 
-Da der Zweck eines Test-Releases das Finden und Reparieren von m&ouml;glichst
+Da der Zweck eines Test-Releases das Finden und Reparieren von so
 vielen Fehlern wie m&ouml;glich ist, berichten Sie bitte alle Fehler, die Sie
 finden auf der <a href="mailto:enigma-devel at nongnu.org">Enigma-Mailingliste
 </a>.  Viel Spa&szlig;!



From ral at mail.berlios.de  Wed Sep  5 21:06:09 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 5 Sep 2007 21:06:09 +0200
Subject: [Enigma-game-svn] r864 - in homepage: . input/lotm
Message-ID: <200709051906.l85J69uX008857@sheep.berlios.de>

Author: ral
Date: 2007-09-05 21:06:08 +0200 (Wed, 05 Sep 2007)
New Revision: 864

Modified:
   homepage/enigma.css
   homepage/input/lotm/lotm_core.html
   homepage/input/lotm/lotm_core_de.html
   homepage/input/lotm/lotm_core_ru.html
Log:
Homepage:
- LotM history image link coloring

Modified: homepage/enigma.css
===================================================================
--- homepage/enigma.css	2007-09-05 18:58:43 UTC (rev 863)
+++ homepage/enigma.css	2007-09-05 19:06:08 UTC (rev 864)
@@ -462,8 +462,8 @@
 .lotmhistory {
     text-align: center;
     padding-top: 5em;
-    padding-left: 2em;
-    padding-bottom: 1em;
+    padding-left: 0em;
+    padding-bottom: 0em;
 }
 
 .lotmhistory img {

Modified: homepage/input/lotm/lotm_core.html
===================================================================
--- homepage/input/lotm/lotm_core.html	2007-09-05 18:58:43 UTC (rev 863)
+++ homepage/input/lotm/lotm_core.html	2007-09-05 19:06:08 UTC (rev 864)
@@ -36,7 +36,8 @@
     <a href="$$imagedir$$/lotm/lotm-history.png">
     <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">
     </a>
-    <br/>
+  </div>
+  <div class="imagetitle">
     <a href="$$imagedir$$/lotm/lotm-history.png">
     $$lotm_history$$
     </a>

Modified: homepage/input/lotm/lotm_core_de.html
===================================================================
--- homepage/input/lotm/lotm_core_de.html	2007-09-05 18:58:43 UTC (rev 863)
+++ homepage/input/lotm/lotm_core_de.html	2007-09-05 19:06:08 UTC (rev 864)
@@ -38,7 +38,8 @@
     <a href="$$imagedir$$/lotm/lotm-history.png">
     <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">
     </a>
-    <br/>
+  </div>
+  <div class="imagetitle">
     <a href="$$imagedir$$/lotm/lotm-history.png">
     $$lotm_history$$
     </a>

Modified: homepage/input/lotm/lotm_core_ru.html
===================================================================
--- homepage/input/lotm/lotm_core_ru.html	2007-09-05 18:58:43 UTC (rev 863)
+++ homepage/input/lotm/lotm_core_ru.html	2007-09-05 19:06:08 UTC (rev 864)
@@ -33,7 +33,8 @@
     <a href="$$imagedir$$/lotm/lotm-history.png">
     <img src="$$imagedir$$/lotm/lotm-thumbnail.png" alt="$$lotm_history$$" border="0">
     </a>
-    <br/>
+  </div>
+  <div class="imagetitle">
     <a href="$$imagedir$$/lotm/lotm-history.png">
     $$lotm_history$$
     </a>



From andreasl at mail.berlios.de  Fri Sep  7 00:46:55 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Fri, 7 Sep 2007 00:46:55 +0200
Subject: [Enigma-game-svn] r866 - in homepage/input: . news
Message-ID: <200709062246.l86Mkt24008988@sheep.berlios.de>

Author: andreasl
Date: 2007-09-07 00:46:49 +0200 (Fri, 07 Sep 2007)
New Revision: 866

Added:
   homepage/input/news/news_issue23_de.html
   homepage/input/news/news_issue23_en.html
Modified:
   homepage/input/download.html
   homepage/input/download_de.html
   homepage/input/output-files.lua
Log:
Homepage:
 - preparing 64-bit-release of 1.01 source code:
    - news_issue23 (English and German)
    - download section (tagged old sourcecode as "32-bit")
 - removed three news from main page, particularly "1.00 Released"
Todo:
 - md5/sha256-checksums of new file
 - Russian translation

Wait for LotM 9/07 proofreading before upload.


Modified: homepage/input/download.html
===================================================================
--- homepage/input/download.html	2007-09-06 21:04:31 UTC (rev 865)
+++ homepage/input/download.html	2007-09-06 22:46:49 UTC (rev 866)
@@ -53,13 +53,20 @@
     <li>sha256 - e2822599dfc8e0a888d729f5ad2ce7cdbf2e1e87bca508c8da76c48fbb0023ab</li>
     </ul></li>
 
-  <li><ul style="list-style-type:none"><li><b>Source Code</b>
+  <li><ul style="list-style-type:none"><li><b>Source Code 32-bit</b>
     <a href="http://download.berlios.de/enigma-game/enigma-1.01.tar.gz">
 	tar.gz (1.01)</a> appr. 10 MB</li>
     <li>md5 - d3804534ac03425051ebfd383ed1b4ee</li>
     <li>sha256 - e704737676e89c509b19f1071284a6df7335a001da08bd116afded4c5e724fbb</li>
     </ul></li>
 
+  <li><ul style="list-style-type:none"><li><b>Source Code 64-bit</b>
+    <a href="http://download.berlios.de/enigma-game/enigma-1.01-64bit.tar.gz">
+	tar.gz (1.01)</a> appr. 10 MB</li>
+    <li>md5 - not yet available</li>
+    <li>sha256 - not yet available</li>
+    </ul></li>
+
   <li><ul style="list-style-type:none"><li><b>Previews</b>
     <a href="http://download.berlios.de/enigma-game/enigma-1.01-previews.zip">
 	Zip (1.01)</a> appr. 4 MB</li>

Modified: homepage/input/download_de.html
===================================================================
--- homepage/input/download_de.html	2007-09-06 21:04:31 UTC (rev 865)
+++ homepage/input/download_de.html	2007-09-06 22:46:49 UTC (rev 866)
@@ -59,13 +59,20 @@
     <li>sha256 - e2822599dfc8e0a888d729f5ad2ce7cdbf2e1e87bca508c8da76c48fbb0023ab</li>
     </ul></li>
 
-  <li><ul style="list-style-type:none"><li><b>Quellcode</b>
+  <li><ul style="list-style-type:none"><li><b>Quellcode 32-Bit</b>
     <a href="http://download.berlios.de/enigma-game/enigma-1.01.tar.gz">
 	tar.gz (1.01)</a> etwa 10 MB</li>
     <li>md5 - d3804534ac03425051ebfd383ed1b4ee</li>
     <li>sha256 - e704737676e89c509b19f1071284a6df7335a001da08bd116afded4c5e724fbb</li>
     </ul></li>
 
+  <li><ul style="list-style-type:none"><li><b>Quellcode 64-Bit</b>
+    <a href="http://download.berlios.de/enigma-game/enigma-1.01-64bit.tar.gz">
+	tar.gz (1.01)</a> etwa 10 MB</li>
+    <li>md5 - noch nicht verf&uuml;gbar</li>
+    <li>sha256 - noch nicht verf&uuml;gbar</li>
+    </ul></li>
+  
   <li><ul style="list-style-type:none"><li><b>Levelvorschau-Bilder</b>
     <a href="http://download.berlios.de/enigma-game/enigma-1.01-previews.zip">
 	Zip (1.01)</a> etwa 4 MB</li>

Added: homepage/input/news/news_issue23_de.html
===================================================================
--- homepage/input/news/news_issue23_de.html	2007-09-06 21:04:31 UTC (rev 865)
+++ homepage/input/news/news_issue23_de.html	2007-09-06 22:46:49 UTC (rev 866)
@@ -0,0 +1,10 @@
+<h3 class="news">
+    <span class="date">Sep 8 2007: </span> Enigma 1.01 f&uuml;r 64-Bit
+    Linux-Versionen
+</h3>
+
+<p>Einige Nutzer k&ouml;nnen Probleme beim Start von Enigma bekommen, wenn sie
+auf einem 64-Bit-System arbeiten. Wenn Sie diese Fehlermeldung sehen:
+&quot;Cannot load application score file [...] Invalid document structure&quot;,
+kompilieren Sie den fehlerbereinigten Release &quot;Quellcode 64-Bit&quot; von
+unserer <a href="$$download$$#stable">Downloadseite</a>.</p>

Added: homepage/input/news/news_issue23_en.html
===================================================================
--- homepage/input/news/news_issue23_en.html	2007-09-06 21:04:31 UTC (rev 865)
+++ homepage/input/news/news_issue23_en.html	2007-09-06 22:46:49 UTC (rev 866)
@@ -0,0 +1,9 @@
+<h3 class="news">
+    <span class="date">Sep 8 2007: </span> Enigma 1.01 for 64-bit Linux versions
+</h3>
+
+<p>Some users might run into problems when they start Enigma on a 64-bit system.
+If you see this error message: &quot;Cannot load application score file [...]
+Invalid document structure&quot;, compile the bugfixed release &quot;Source
+Code 64-bit&quot; from our <a href="$$download$$#stable">download
+section</a>.</p>

Modified: homepage/input/output-files.lua
===================================================================
--- homepage/input/output-files.lua	2007-09-06 21:04:31 UTC (rev 865)
+++ homepage/input/output-files.lua	2007-09-06 22:46:49 UTC (rev 866)
@@ -10,7 +10,7 @@
 
 -- The newsfield declares the news (by number) to be shown on the main page.
 
-newsfield = {16, 17, 18, 19, 20, 21, 22}
+newsfield = {19, 20, 21, 22, 23}
 
 -- General $$mystring$$-macros. Strings are taken as-is, tables are
 -- constellations of html input files, functions are executed, with the



From raoul at mail.berlios.de  Fri Sep  7 01:11:34 2007
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Fri, 7 Sep 2007 01:11:34 +0200
Subject: [Enigma-game-svn] r867 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 src
Message-ID: <200709062311.l86NBYEb029165@sheep.berlios.de>

Author: raoul
Date: 2007-09-07 01:11:32 +0200 (Fri, 07 Sep 2007)
New Revision: 867

Removed:
   trunk/data/gfx32/st-blue-sand.png
   trunk/data/gfx32/st-brick.png
   trunk/data/gfx40/st-blue-sand.png
   trunk/data/gfx40/st-brick.png
   trunk/data/gfx48/st-blue-sand.png
   trunk/data/gfx48/st-brick.png
Modified:
   trunk/data/models-2d.lua
   trunk/data/startup.lua
   trunk/src/items.cc
   trunk/src/stones_complex.cc
   trunk/src/world.cc
Log:
-> New stone st-panel with the gfx of st-wood_001.
-> New BigStone st-bigpanel for building blocks of st-panel.
-> Some models/gfx cleanup with brick/bigbrick and blue-sand/big-blue-sand.
-> Some cleanup in startup.lua.
-> Bugfix for crash on zerolength rubberbands.

TODO:
-> Remove st-wood_001 and replace it by st-panel in all levels.



Deleted: trunk/data/gfx32/st-blue-sand.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-brick.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-blue-sand.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-brick.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-blue-sand.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-brick.png
===================================================================
(Binary files differ)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2007-09-06 22:46:49 UTC (rev 866)
+++ trunk/data/models-2d.lua	2007-09-06 23:11:32 UTC (rev 867)
@@ -667,10 +667,7 @@
     DefStone("st-blackballs")
     DefStone("st-block")
     DefStone("st-bluegray", "sh-round")
-    DefStone("st-blue-sand")
     DefStone("st-brake", "sh-brake")
-    DefStone("st-brick")
-    DefStone("st-brick_magic", nil, {filename="st-brick"})
     DefStone("st-brownie", "sh-round")
     DefStone("st-bug")
     DefStone("st-bumps")
@@ -741,19 +738,23 @@
 do
     DefSubimages("st-bigbluesand", {modelname="st-bigbluesandx",w=4,h=4})
     for i=1,16 do DefSolidStone("st-bigbluesand"..i, "st-bigbluesandx"..i) end
+    DefSolidStone("st-blue-sand", "st-bigbluesandx1")
 end
 
 -- st-bigbrick --
 do
     DefSubimages("st-bigbrick", {modelname="st-bigbrickx",w=4,h=4})
     for i=1,16 do DefSolidStone("st-bigbrick"..i, "st-bigbrickx"..i) end
+    DefSolidStone("st-brick", "st-bigbrickx1")
+    DefSolidStone("st-brick_magic", "st-bigbrickx1")
 end
 
 -- st-bigpanel --
 do
     DefSubimages("st-bigpanel", {modelname="st-bigpanelx",w=4,h=4})
     for i=1,16 do DefSolidStone("st-bigpanel"..i, "st-bigpanelx"..i) end
-    -- Alias for st-wood_001. Remove when it's time!
+    DefSolidStone("st-panel", "st-bigpanelx1")
+    -- st-wood_001. Remove when it's time!
     DefSolidStone("st-wood_001", "st-bigpanelx1")
 end
 

Modified: trunk/data/startup.lua
===================================================================
--- trunk/data/startup.lua	2007-09-06 22:46:49 UTC (rev 866)
+++ trunk/data/startup.lua	2007-09-06 23:11:32 UTC (rev 867)
@@ -35,7 +35,7 @@
     Difficulty        = 2,                  -- hard
     Tournament        = 0,                  -- tournament mode off
     VideoMode         = 0,
-    Gamma             = 1.0,  
+    Gamma             = 1.0,
     LevelMenuPosition = 0.0,
 
     SoundSet          = 0,
@@ -82,8 +82,8 @@
     if stat[3] < 0 then stat[3] = 0 end
 
     stat[4] = stat[4] or 0
-    if stat[4] > 0 then 
-        stat[4] = 1 
+    if stat[4] > 0 then
+        stat[4] = 1
     end -- level status has 'solved_at' time -> default to revision 1
 
     gsub(key, "([^#]*)#(.+)", function (pack,lev) stats[lev] = stat end)
@@ -93,34 +93,46 @@
     dofile(filename)
 end
 
-
-----------------------------------
--- Define some new object types --
-----------------------------------
+------------------------------
+-- Define the simple stones --
+------------------------------
 function def_stone(name, sound)
     world.DefineSimpleStone(name,sound or "stone",0,0)
 end
 function def_stone_hollow(name)
     world.DefineSimpleStone(name,"",1,0)
 end
+function def_stone_movable(name, sound)
+    world.DefineSimpleStoneMovable(name,sound or "stone",0)
+end
 function def_stone_glass(name, sound)
     world.DefineSimpleStone(name,sound or "stone",0,1)
 end
 function def_stone_movable_glass(name, sound)
     world.DefineSimpleStoneMovable(name,sound or "stone",1)
 end
-function def_stone_movable(name, sound)
-    world.DefineSimpleStoneMovable(name,sound or "stone",0)
-end
-function def_floor(name, frict, mfactor, burnable, firetransform)
-    world.DefineSimpleFloor(name, frict, mfactor, burnable, firetransform)
-end
 
+def_stone("st-beads")
+def_stone("st-bluegray")
+def_stone_hollow("st-bluegray_hole")
+def_stone("st-blue-sand")
+def_stone("st-brick")
 def_stone_movable("st-brownie", "cloth")
+def_stone("st-bumps")
+def_stone("st-camouflage", "cloth")
+def_stone_movable("st-camouflage_move", "cloth")
+def_stone_hollow("st-camouflage_hole")
+def_stone("st-greenbrown")
+def_stone_movable("st-greenbrown_move", "cloth")
+def_stone_hollow("st-greenbrown_hole")
 def_stone("st-invisible")
 def_stone("st-marble")
 def_stone_movable("st-marble_move")
 def_stone_hollow("st-marble_hole")
+def_stone("st-metal")
+def_stone_hollow("st-metal_hole")
+def_stone("st-panel")
+def_stone("st-redrock")
 def_stone("st-rock1")
 def_stone_movable("st-rock1_move")
 def_stone_hollow("st-rock1_hole")
@@ -136,36 +148,12 @@
 def_stone("st-rock8")
 def_stone("st-rock9")
 def_stone("st-rock10")
-def_stone("st-redrock")
-def_stone("st-camouflage", "cloth")
-def_stone_movable("st-camouflage_move", "cloth")
-def_stone_hollow("st-camouflage_hole")
-def_stone("st-greenbrown")
-def_stone_movable("st-greenbrown_move", "cloth")
-def_stone_hollow("st-greenbrown_hole")
-def_stone("st-brick")
+def_stone("st-stone1")
+def_stone("st-stone2")
 def_stone("st-woven")
 def_stone("st-wood_001")
-def_stone("st-bluegray")
-def_stone_hollow("st-bluegray_hole")
-def_stone("st-stone1")
-def_stone("st-stone2")
-def_stone("st-bumps")
-def_stone("st-beads")
-def_stone("st-metal")
-def_stone_hollow("st-metal_hole")
-def_stone("st-blue-sand")
 def_stone("st-yellow")
 
-function mkoxydlikes(flavor)
-   def_stone("st-likeoxyd"..flavor)
-   def_stone("st-likeoxyd"..flavor.."-open")
-end
-mkoxydlikes("a")
-mkoxydlikes("b")
-mkoxydlikes("c")
-mkoxydlikes("d")
-
 def_stone_glass("st-glass")
 def_stone_movable_glass("st-glass_move")
 def_stone_glass("st-glass1")
@@ -176,6 +164,22 @@
 def_stone_hollow("st-glass2_hole")
 def_stone_glass("st-glass3")
 
+function mkoxydlikes(flavor)
+   def_stone("st-likeoxyd"..flavor)
+   def_stone("st-likeoxyd"..flavor.."-open")
+end
+mkoxydlikes("a")
+mkoxydlikes("b")
+mkoxydlikes("c")
+mkoxydlikes("d")
+
+------------------------------
+-- Define the simple floors --
+------------------------------
+function def_floor(name, frict, mfactor, burnable, firetransform)
+    world.DefineSimpleFloor(name, frict, mfactor, burnable, firetransform)
+end
+
 -- Floor(kind, friction, mousefactor, burnable, firetransform)
 def_floor("fl-bluegray",     4.5,   1.5,    true,   "")
 def_floor("fl-bluegreen",    6.0,   2.0,    true,   "")

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2007-09-06 22:46:49 UTC (rev 866)
+++ trunk/src/items.cc	2007-09-06 23:11:32 UTC (rev 867)
@@ -3549,7 +3549,6 @@
             double strength = getAttr("strength", 10.0);
             double length = getAttr("length", 1.0);
             double minlength = getAttr("minlength", 0.0);
-            
 
             world::RubberBandData rbd;
             rbd.strength = strength;
@@ -3578,8 +3577,12 @@
                 world::KillRubberBands (a);
 
             sound_event ("rubberband");
-            if (target_actor)
-                world::AddRubberBand (a,target_actor,rbd);
+            if (target_actor) {
+                // It's not allowed to connect a rubberband to self.
+                if (target_actor != a)
+                    world::AddRubberBand (a,target_actor,rbd);
+                else
+                    return ITEM_DROP; }
             else
                 world::AddRubberBand (a,target_stone,rbd);
 

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2007-09-06 22:46:49 UTC (rev 866)
+++ trunk/src/stones_complex.cc	2007-09-06 23:11:32 UTC (rev 867)
@@ -778,7 +778,7 @@
 
 /* -------------------- BigBrick -------------------- */
 
-// BigBricks allow to build stones of any size.
+// BigBricks allow to build stones of any size based on st-brick.
 
 namespace 
 {
@@ -3602,7 +3602,7 @@
     Register("st-bigbluesand-esw", new BigBlueSand(8));
     Register("st-bigbluesand-nesw", new BigBlueSand(16));
     
-    Register("st-panel", new BigPanel(1));  // was st-wood_001 before Enigma 1.10
+    //Register("st-bigpanel", new BigPanel(1));  // use st-panel instead was; st-wood_001 before Enigma 1.10
     Register("st-bigpanel-n", new BigPanel(9));
     Register("st-bigpanel-e", new BigPanel(5));
     Register("st-bigpanel-s", new BigPanel(3));

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2007-09-06 22:46:49 UTC (rev 866)
+++ trunk/src/world.cc	2007-09-06 23:11:32 UTC (rev 867)
@@ -201,6 +201,7 @@
 {
     ASSERT(actor, XLevelRuntime, "RubberBand: no actor defined");
     ASSERT(d.length >= 0, XLevelRuntime, "RubberBand: length negative");
+	ASSERT(d.length >= d.minlength, XLevelRuntime, "RubberBand: minlength > length");
 }
 
 RubberBand::RubberBand (Actor *a1, Stone *st, const RubberBandData &d)
@@ -209,6 +210,7 @@
 {
     ASSERT(actor, XLevelRuntime, "RubberBand: no actor defined");
     ASSERT(d.length >= 0, XLevelRuntime, "RubberBand: length negative");
+    ASSERT(d.length >= d.minlength, XLevelRuntime, "RubberBand: minlength > length");
     model = display::AddRubber(get_p1(), get_p2());
 }
 
@@ -220,22 +222,21 @@
 {
     V2 v = get_p2()-get_p1();
     double vv = ecl::length(v);
-
-    if (vv > data.length) {
-        V2 force = v * data.strength*(vv-data.length)/vv;
+    V2 force;
+    
+    if (vv == 0) {
+        force = V2(0, 0);
+    } else if (vv < data.minlength) {
+        force = v*data.strength*(vv-data.minlength)/vv;
         force /= 6;
-        actor->add_force(force);
-        if (actor2)
-            actor2->add_force(-force);
-    } 
-    else if (vv < data.minlength) {
-        V2 force = v * data.strength * (vv-data.minlength) / vv;
+    } else if (vv > data.length) {
+        force = v*data.strength*(vv-data.length)/vv;
         force /= 6;
-        actor->add_force(force);
-        if (actor2)
-            actor2->add_force(-force);
     }
-
+    
+    actor->add_force(force);
+    if (actor2)
+        actor2->add_force(-force);
 }
 
 V2 RubberBand::get_p1() const
@@ -2587,4 +2588,3 @@
 Item * world::MakeItem(const char *kind) {
     return dynamic_cast<Item*>(MakeObject(kind));
 }
-



From raoul at mail.berlios.de  Fri Sep  7 14:49:13 2007
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Fri, 7 Sep 2007 14:49:13 +0200
Subject: [Enigma-game-svn] r868 - trunk/src
Message-ID: <200709071249.l87CnDnG026970@sheep.berlios.de>

Author: raoul
Date: 2007-09-07 14:49:12 +0200 (Fri, 07 Sep 2007)
New Revision: 868

Modified:
   trunk/src/world.cc
Log:
-> Hotfix for Bug #011942



Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2007-09-06 23:11:32 UTC (rev 867)
+++ trunk/src/world.cc	2007-09-07 12:49:12 UTC (rev 868)
@@ -195,18 +195,16 @@
 /* -------------------- RubberBand -------------------- */
 
 RubberBand::RubberBand (Actor *a1, Actor *a2, const RubberBandData &d)
-: actor(a1), actor2(a2), stone(0),
-  model(display::AddRubber(get_p1(),get_p2())),
-  data (d)
+: actor(a1), actor2(a2), stone(0), model(0), data (d)
 {
     ASSERT(actor, XLevelRuntime, "RubberBand: no actor defined");
     ASSERT(d.length >= 0, XLevelRuntime, "RubberBand: length negative");
 	ASSERT(d.length >= d.minlength, XLevelRuntime, "RubberBand: minlength > length");
+    model = display::AddRubber(get_p1(),get_p2());
 }
 
 RubberBand::RubberBand (Actor *a1, Stone *st, const RubberBandData &d)
-: actor(a1), actor2(0), stone(st), model(0),
-  data (d)
+: actor(a1), actor2(0), stone(st), model(0), data (d)
 {
     ASSERT(actor, XLevelRuntime, "RubberBand: no actor defined");
     ASSERT(d.length >= 0, XLevelRuntime, "RubberBand: length negative");



From ral at mail.berlios.de  Sat Sep  8 00:56:45 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 8 Sep 2007 00:56:45 +0200
Subject: [Enigma-game-svn] r869 - in trunk: doc/reference src
Message-ID: <200709072256.l87MujxG024931@sheep.berlios.de>

Author: ral
Date: 2007-09-08 00:56:44 +0200 (Sat, 08 Sep 2007)
New Revision: 869

Modified:
   trunk/doc/reference/enigma-ref.texi
   trunk/src/items.cc
Log:
Trunk 1.1:
- it-bag fix missing pickup sound and inventory redraws
- refman documentation of bag item pickup rules


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2007-09-07 12:49:12 UTC (rev 868)
+++ trunk/doc/reference/enigma-ref.texi	2007-09-07 22:56:44 UTC (rev 869)
@@ -3308,6 +3308,39 @@
 full (13 items). The player can drop @code{it-bag} anytime.  When picked up again,
 items from the bag are put back into the inventory (until it is full).
 
+The quite complex rules in detail:
+
+ at enumerate
+ at item 
+Inventory and bag are limited concerning pickups to 13 items.
+
+ at item
+Both are LIFO (last item picked up is first item out) - besides inventory rotation.
+
+ at item
+If you pick up any item besides a bag and your first inventory item is not a bag
+the item is added to the inventory.
+
+ at item
+If you pick up any item besides a non-empty bag and your first inventory item is
+a bag the item is added to the first inventroy bag (this includes non-empty bags
+into bags!)
+
+ at item
+You empty a bag by picking it up with any item at the first inventory position
+but a bag. As many items as possible are taken from the bag and added to the
+inventory.
+
+ at item
+Empty bags are never put into other bags (this would cause unresolvable recursion
+problems - see below). They will only be added to the inventory.
+
+ at item
+If the touched bag cannot empty its contents to the inventory or a bag at the
+inventory position is full the bag is not picked up and keeps the remaining items.
+
+ at end enumerate
+
 @code{it-bag} is created by @ref{st-thief} and @ref{fl-thief} when
 they're captured by @ref{st-chess_[black/white]}.
 

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2007-09-07 12:49:12 UTC (rev 868)
+++ trunk/src/items.cc	2007-09-07 22:56:44 UTC (rev 869)
@@ -3210,7 +3210,7 @@
                 if (Inventory *inv = player::MayPickup(a, NULL)) {
                     std::vector<Item *>::size_type oldSize = m_contents.size();
                     inv->takeItemsFrom(this);
-                    if (oldSize != m_contents.size() && inv->is_full()) {
+                    if (oldSize != m_contents.size() && !inv->willAddItem(this)) {
                         // some items have been picked up but the bag will not
                         // be picked up (and cause the following actions)
                         player::RedrawInventory (inv);



From ral at mail.berlios.de  Sat Sep  8 14:02:26 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 8 Sep 2007 14:02:26 +0200
Subject: [Enigma-game-svn] r870 - branches/1.0/lib-src/zipios++/zipios++
Message-ID: <200709081202.l88C2QfT030686@sheep.berlios.de>

Author: ral
Date: 2007-09-08 14:02:26 +0200 (Sat, 08 Sep 2007)
New Revision: 870

Modified:
   branches/1.0/lib-src/zipios++/zipios++/zipios_defs.h
Log:
Branch 1.0
- zipios++ min. fix for 64 bit compatibility


Modified: branches/1.0/lib-src/zipios++/zipios++/zipios_defs.h
===================================================================
--- branches/1.0/lib-src/zipios++/zipios++/zipios_defs.h	2007-09-07 22:56:44 UTC (rev 869)
+++ branches/1.0/lib-src/zipios++/zipios++/zipios_defs.h	2007-09-08 12:02:26 UTC (rev 870)
@@ -1,10 +1,13 @@
 #ifndef ZIPIOS_DEFS_H
 #define ZIPIOS_DEFS_H
 
+#include "zipios++/zipios-config.h"
+#include <stdint.h>
+
 namespace zipios {
 
-typedef unsigned short uint16 ;
-typedef unsigned long  uint32 ;
+typedef uint16_t uint16 ;
+typedef uint32_t uint32 ;
 
 } // namespace
 



From ral at mail.berlios.de  Sat Sep  8 14:12:17 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 8 Sep 2007 14:12:17 +0200
Subject: [Enigma-game-svn] r871 - branches
Message-ID: <200709081212.l88CCHPf009462@sheep.berlios.de>

Author: ral
Date: 2007-09-08 14:12:14 +0200 (Sat, 08 Sep 2007)
New Revision: 871

Added:
   branches/1.01/
Log:
create branch for 1.01 compatibility fixes

Copied: branches/1.01 (from rev 870, tags/1.01)



From raoul at mail.berlios.de  Sat Sep  8 15:31:53 2007
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sat, 8 Sep 2007 15:31:53 +0200
Subject: [Enigma-game-svn] r872 - branches/1.0/src
Message-ID: <200709081331.l88DVrrV001157@sheep.berlios.de>

Author: raoul
Date: 2007-09-08 15:31:52 +0200 (Sat, 08 Sep 2007)
New Revision: 872

Modified:
   branches/1.0/src/items.cc
   branches/1.0/src/world.cc
Log:
-> Rubberband fixes from trunk (rev. 867/868)



Modified: branches/1.0/src/items.cc
===================================================================
--- branches/1.0/src/items.cc	2007-09-08 12:12:14 UTC (rev 871)
+++ branches/1.0/src/items.cc	2007-09-08 13:31:52 UTC (rev 872)
@@ -3587,8 +3587,12 @@
                 world::KillRubberBands (a);
 
             sound_event ("rubberband");
-            if (target_actor)
-                world::AddRubberBand (a,target_actor,rbd);
+            if (target_actor) {
+                // It's not allowed to connect a rubberband to self.
+                if (target_actor != a)
+                    world::AddRubberBand (a,target_actor,rbd);
+                else
+                    return ITEM_DROP; }
             else
                 world::AddRubberBand (a,target_stone,rbd);
 

Modified: branches/1.0/src/world.cc
===================================================================
--- branches/1.0/src/world.cc	2007-09-08 12:12:14 UTC (rev 871)
+++ branches/1.0/src/world.cc	2007-09-08 13:31:52 UTC (rev 872)
@@ -234,20 +234,20 @@
 /* -------------------- RubberBand -------------------- */
 
 RubberBand::RubberBand (Actor *a1, Actor *a2, const RubberBandData &d)
-: actor(a1), actor2(a2), stone(0),
-  model(display::AddRubber(get_p1(),get_p2())),
-  data (d)
+: actor(a1), actor2(a2), stone(0), model(0), data (d)
 {
     ASSERT(actor, XLevelRuntime, "RubberBand: no actor defined");
     ASSERT(d.length >= 0, XLevelRuntime, "RubberBand: length negative");
+    ASSERT(d.length >= d.minlength, XLevelRuntime, "RubberBand: minlength > length");
+    model = display::AddRubber(get_p1(),get_p2());
 }
 
 RubberBand::RubberBand (Actor *a1, Stone *st, const RubberBandData &d)
-: actor(a1), actor2(0), stone(st), model(0),
-  data (d)
+: actor(a1), actor2(0), stone(st), model(0), data (d)
 {
     ASSERT(actor, XLevelRuntime, "RubberBand: no actor defined");
     ASSERT(d.length >= 0, XLevelRuntime, "RubberBand: length negative");
+    ASSERT(d.length >= d.minlength, XLevelRuntime, "RubberBand: minlength > length");
     model = display::AddRubber(get_p1(), get_p2());
 }
 
@@ -259,22 +259,21 @@
 {
     V2 v = get_p2()-get_p1();
     double vv = ecl::length(v);
-
-    if (vv > data.length) {
-        V2 force = v * data.strength*(vv-data.length)/vv;
+    V2 force;
+    
+    if (vv == 0) {
+        force = V2(0, 0);
+    } else if (vv < data.minlength) {
+        force = v*data.strength*(vv-data.minlength)/vv;
         force /= 6;
-        actor->add_force(force);
-        if (actor2)
-            actor2->add_force(-force);
-    } 
-    else if (vv < data.minlength) {
-        V2 force = v * data.strength * (vv-data.minlength) / vv;
+    } else if (vv > data.length) {
+        force = v*data.strength*(vv-data.length)/vv;
         force /= 6;
-        actor->add_force(force);
-        if (actor2)
-            actor2->add_force(-force);
     }
-
+    
+    actor->add_force(force);
+    if (actor2)
+        actor2->add_force(-force);
 }
 
 V2 RubberBand::get_p1() const
@@ -2111,4 +2110,3 @@
 Item * world::MakeItem(const char *kind) {
     return dynamic_cast<Item*>(MakeObject(kind));
 }
-



From ral at mail.berlios.de  Sat Sep  8 15:33:27 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 8 Sep 2007 15:33:27 +0200
Subject: [Enigma-game-svn] r873 - branches/1.01/lib-src/zipios++/zipios++
Message-ID: <200709081333.l88DXRJ1001268@sheep.berlios.de>

Author: ral
Date: 2007-09-08 15:33:27 +0200 (Sat, 08 Sep 2007)
New Revision: 873

Modified:
   branches/1.01/lib-src/zipios++/zipios++/zipios_defs.h
Log:
Branch 1.01
- zipios 64 bit compatibility min fix



Modified: branches/1.01/lib-src/zipios++/zipios++/zipios_defs.h
===================================================================
--- branches/1.01/lib-src/zipios++/zipios++/zipios_defs.h	2007-09-08 13:31:52 UTC (rev 872)
+++ branches/1.01/lib-src/zipios++/zipios++/zipios_defs.h	2007-09-08 13:33:27 UTC (rev 873)
@@ -1,10 +1,13 @@
 #ifndef ZIPIOS_DEFS_H
 #define ZIPIOS_DEFS_H
 
+#include "zipios++/zipios-config.h"
+#include <stdint.h>
+
 namespace zipios {
 
-typedef unsigned short uint16 ;
-typedef unsigned long  uint32 ;
+typedef uint16_t uint16 ;
+typedef uint32_t uint32 ;
 
 } // namespace
 
@@ -16,7 +19,7 @@
 
 /*
   Zipios++ - a small C++ library that provides easy access to .zip files.
-  Copyright (C) 2000  Thomas S?ndergaard
+  Copyright (C) 2000  Thomas S???ndergaard
   
   This library is free software; you can redistribute it and/or
   modify it under the terms of the GNU Lesser General Public



From ral at mail.berlios.de  Sat Sep  8 18:53:54 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 8 Sep 2007 18:53:54 +0200
Subject: [Enigma-game-svn] r874 - in trunk: lib-src/enigma-core src src/gui
Message-ID: <200709081653.l88Grs22020740@sheep.berlios.de>

Author: ral
Date: 2007-09-08 18:53:53 +0200 (Sat, 08 Sep 2007)
New Revision: 874

Modified:
   trunk/lib-src/enigma-core/ecl_video.hh
   trunk/src/gui/MainMenu.cc
   trunk/src/gui/OptionsMenu.cc
   trunk/src/gui/OptionsMenu.hh
   trunk/src/gui/ScreenshotViewer.cc
   trunk/src/gui/widgets.cc
   trunk/src/gui/widgets.hh
   trunk/src/main.cc
   trunk/src/main.hh
   trunk/src/video.cc
   trunk/src/video.hh
Log:
Trunk 1.1: 
- replaced video modes:
   960x768   = 5,   // 48 bit grid linear strechable to 1280x1024
   1152x720  = 6,   // 48 bit grid lineas strechable to 1680x1050
  by
   1280x720  = 5,   // 48 bit embedded - 16:9  - HD720
   1440x960  = 7,   // 64 bit embedded -  3:2  - none
  to provide modes for all common h/w ratios
- limit modes in option menu to those that are available on given hardware
- different resolution mode user prefs for fullscreen and window mode
- add mouse scroll on options menu screen resolution mode
- mode prefs made extendable in future versions without causing problems
  on current enigma versions due to a new fallback strategy
- limit screenshot to display area
- redisplay screenshots just in display area to avoid distortions
Note:
- .enigmarc.xml prefs FullScreen1.1 and VideoMode1.1 added with r840 are
  obsolete and can be manually removed.
ToDo:
- fine tuning of some menus
- 64 bit images


Modified: trunk/lib-src/enigma-core/ecl_video.hh
===================================================================
--- trunk/lib-src/enigma-core/ecl_video.hh	2007-09-08 13:33:27 UTC (rev 873)
+++ trunk/lib-src/enigma-core/ecl_video.hh	2007-09-08 16:53:53 UTC (rev 874)
@@ -134,11 +134,11 @@
 
 	Surface *zoom(int w, int h);
 
-	void set_color_key (int r, int g, int b);
+        void set_color_key (int r, int g, int b);
         void set_alpha (int a);
 
         void lock();
-	void unlock();
+        void unlock();
 
         int bypp() const { return m_surface->format->BytesPerPixel; }
         int bipp() const { return m_surface->format->BitsPerPixel; }

Modified: trunk/src/gui/MainMenu.cc
===================================================================
--- trunk/src/gui/MainMenu.cc	2007-09-08 13:33:27 UTC (rev 873)
+++ trunk/src/gui/MainMenu.cc	2007-09-08 16:53:53 UTC (rev 874)
@@ -289,8 +289,9 @@
     
     void MainMenu::tick(double /* dtime */) 
     {
-        if (app.prefs->getInt("VideoMode1.1") != video::GetVideoMode()
-                || app.prefs->getBool("FullScreen1.1") != video::IsFullScreen())
+        bool isFullScreen = app.prefs->getBool("FullScreen");
+        if (app.selectedVideoMode != video::GetVideoMode()
+                || isFullScreen != video::IsFullScreen())
         {
             ChangeVideoMode();
             clear();

Modified: trunk/src/gui/OptionsMenu.cc
===================================================================
--- trunk/src/gui/OptionsMenu.cc	2007-09-08 13:33:27 UTC (rev 873)
+++ trunk/src/gui/OptionsMenu.cc	2007-09-08 16:53:53 UTC (rev 874)
@@ -123,37 +123,45 @@
         RatingsUpdateButton() : BoolOptionButton("RatingsAutoUpdate", N_("Auto"), N_("Never"), this) {}
     };
 
-    class VideoModeButton : public TextButton {
 
-        video::VideoModes get_mode() const {
-            int mode = Clamp(app.prefs->getInt("VideoMode1.1"), 0, int(video::VM_COUNT));
-            return static_cast<video::VideoModes>(mode);
-        }
-        string get_text() const {
-            return video::GetInfo(get_mode())->name;
-        }
-        void on_action(Widget *) {
-            int mode = get_mode();
 
-            // cycle at most once through all available video modes
-            do {
-                mode += 1;
-                if (mode >= video::VM_COUNT) 
-                    mode = 0;
+    /* -------------------- VideoModeButton -------------------- */
+    
+    VideoModeButton::VideoModeButton() : ValueButton(0, 1) {
+        bool isFullScreen = app.prefs->getBool("FullScreen");
+        setMaxValue(video::GetNumAvailableModes(isFullScreen) - 1);
+        init();
+    }
+    
+    void VideoModeButton::reinit() {
+        bool isFullScreen = app.prefs->getBool("FullScreen");
+        ValueButton::setMaxValue(video::GetNumAvailableModes(isFullScreen) - 1);
+    }
 
-                const video::VMInfo *vminfo = video::GetInfo (static_cast<video::VideoModes>(mode));
-                if (vminfo->available) {
-                    app.prefs->setProperty("VideoMode1.1", mode);
-                    invalidate();
-                    break;
-                }
-            } while (mode != get_mode());
+    int VideoModeButton::get_value() const {
+        bool isFullScreen = app.prefs->getBool("FullScreen");        
+        return video::GetModeNumber(static_cast<video::VideoModes>(app.selectedVideoMode), isFullScreen);
+    }
+
+    void VideoModeButton::set_value(int value) {
+        bool isFullScreen = app.prefs->getBool("FullScreen");
+        video::VideoModes vm = video::GetVideoMode(value, isFullScreen);
+        app.selectedVideoMode = vm;
+
+        if (vm != video::GetBestUserMode(isFullScreen)) {
+            const video::VMInfo * info = video::GetInfo(vm);
+            app.prefs->setProperty(isFullScreen ? "VideoModesFullscreen" : "VideoModesWindow",
+                    isFullScreen ? info->fallback_fullscreen : info->fallback_window);
         }
-    public:
-        VideoModeButton() : TextButton(this) { }
-    };
+    }
 
+    string VideoModeButton::get_text(int value) const {
+        bool isFullScreen = app.prefs->getBool("FullScreen");        
+        const video::VMInfo * vi = video::GetInfo(video::GetVideoMode(value, isFullScreen));
+        return vi->name;
+    }
 
+
     /* -------------------- SoundSetButton -------------------- */
     
     SoundSetButton::SoundSetButton() : ValueButton(0, 1) {
@@ -215,7 +223,7 @@
     /* -------------------- FullscreenButton -------------------- */
     
     FullscreenButton::FullscreenButton()
-        : BoolOptionButton("FullScreen1.1", N_("Yes"), N_("No"), this)
+        : BoolOptionButton("FullScreen", N_("Yes"), N_("No"))
     {
     }
     
@@ -314,7 +322,6 @@
     
     OptionsMenu::OptionsMenu(ecl::Surface *background_)
     : back(new StaticTextButton(N_("Back"), this)),
-      fullscreen(new FullscreenButton),
       m_restartinfo (new Label("")),
       background(background_),
       previous_caption(video::GetCaption())
@@ -340,8 +347,11 @@
     
         language = new LanguageButton(this);
         left.add (language);
+        fullscreen = new FullscreenButton();
+        fullscreen->set_listener(this);
         left.add (fullscreen);
-        left.add (new VideoModeButton);
+        videomode = new VideoModeButton();
+        left.add (videomode);
         left.add (new GammaButton);
         left.add (new MouseSpeedButton);
     
@@ -448,6 +458,14 @@
         else if (w == language)
             // language changed - retranslate and redraw everything
             invalidate_all();
+        else if (w == fullscreen) {
+            // switch the fullscreen button and option
+            fullscreen->on_action(fullscreen);
+            app.selectedVideoMode = video::GetBestUserMode(app.prefs->getBool("FullScreen"));
+            // update the video mode button to the modes available
+            videomode->reinit();
+            invalidate_all();
+        }
     }
     
     void OptionsMenu::tick (double)

Modified: trunk/src/gui/OptionsMenu.hh
===================================================================
--- trunk/src/gui/OptionsMenu.hh	2007-09-08 13:33:27 UTC (rev 873)
+++ trunk/src/gui/OptionsMenu.hh	2007-09-08 16:53:53 UTC (rev 874)
@@ -23,6 +23,8 @@
 #include "gui/TextField.hh"
 
 namespace enigma { namespace gui {
+    class VideoModeButton;
+    
 /* -------------------- OptionsMenu -------------------- */
 
     class OptionsMenu : public Menu {
@@ -42,7 +44,9 @@
         void tick(double dtime);
 
         // Variables.
-        gui::Widget *back, *fullscreen, *language;
+        gui::Widget *back, *language;
+        gui::BoolOptionButton *fullscreen;
+        gui::VideoModeButton *videomode;
         gui::TextField *userNameTF;
         gui::TextField *userPathTF;
         gui::TextField *userImagePathTF;
@@ -58,6 +62,15 @@
     };
 
 
+    class VideoModeButton : public ValueButton {
+        int get_value() const;
+        void set_value(int value);
+        std::string get_text(int value) const;
+    public:
+        VideoModeButton();
+        void reinit();
+    };
+
     class StereoButton : public ValueButton {
         int get_value() const;
         void set_value(int value);

Modified: trunk/src/gui/ScreenshotViewer.cc
===================================================================
--- trunk/src/gui/ScreenshotViewer.cc	2007-09-08 13:33:27 UTC (rev 873)
+++ trunk/src/gui/ScreenshotViewer.cc	2007-09-08 16:53:53 UTC (rev 874)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2006 Ronald Lamprecht
+ * Copyright (C) 2006, 2007 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -92,10 +92,12 @@
         if (app.resourceFS->findFile(filename, fullPath)) {
             ecl::Surface * image = ecl::LoadImage(fullPath.c_str());
             if (image->width() == vminfo->width && image->height() == vminfo->height) {
-                blit(gc, 0,0, image);
+                ecl::blit(gc, 0,0, image);
             } else {
-                ecl::Surface * imageZoomed = image->zoom(vminfo->width, vminfo->height);
-                blit(gc, 0,0, imageZoomed);
+                ecl::set_color(gc, 0, 0, 0);
+                ecl::box(gc, 0, 0, vminfo->width, vminfo->height);
+                ecl::Surface * imageZoomed = image->zoom(vminfo->area.w, vminfo->area.h);
+                ecl::blit(gc, vminfo->area.x, vminfo->area.y, imageZoomed);
                 delete imageZoomed;
             }
             delete image;

Modified: trunk/src/gui/widgets.cc
===================================================================
--- trunk/src/gui/widgets.cc	2007-09-08 13:33:27 UTC (rev 873)
+++ trunk/src/gui/widgets.cc	2007-09-08 16:53:53 UTC (rev 874)
@@ -842,8 +842,7 @@
 string BoolOptionButton::get_text() const {
     return enigma_options::GetBool(optionName) ? _(trueText.c_str()) : _(falseText.c_str());
 }
-    
-
+
 /* -------------------- ValueButton -------------------- */
 
 ValueButton::ValueButton(int min_value_, int max_value_)
@@ -911,7 +910,6 @@
 bool ValueButton::soundOk() {
     return false;
 }
-
 
 /* -------------------- ImageButton -------------------- */
 

Modified: trunk/src/gui/widgets.hh
===================================================================
--- trunk/src/gui/widgets.hh	2007-09-08 13:33:27 UTC (rev 873)
+++ trunk/src/gui/widgets.hh	2007-09-08 16:53:53 UTC (rev 874)
@@ -409,7 +409,7 @@
                          ActionListener     *al = 0);
 
         bool toggle(); // returns new value
-        void on_action(Widget *);
+        virtual void on_action(Widget *);
 
         // TextButton interface.
         std::string get_text() const;

Modified: trunk/src/main.cc
===================================================================
--- trunk/src/main.cc	2007-09-08 13:33:27 UTC (rev 873)
+++ trunk/src/main.cc	2007-09-08 16:53:53 UTC (rev 874)
@@ -285,10 +285,11 @@
     prefs = PreferenceManager::instance();
     
     if (ap.force_window) {
-        app.prefs->setProperty("FullScreen1.1", false);
+        app.prefs->setProperty("FullScreen", false);
     }
     if (isMakePreviews) {
-        app.prefs->setProperty("VideoMode1.1", 0);  // we will not save the prefs!
+        app.prefs->setProperty("VideoModesFullscreen", "-0-");
+        app.prefs->setProperty("VideoModesWindow", "-0-");     // we will not save the prefs!
     }
 
     // initialize user data paths -- needs preferences, system datapaths

Modified: trunk/src/main.hh
===================================================================
--- trunk/src/main.hh	2007-09-08 13:33:27 UTC (rev 873)
+++ trunk/src/main.hh	2007-09-08 16:53:53 UTC (rev 874)
@@ -28,6 +28,7 @@
 #include "StateManager.hh"
 #include "DOMErrorReporter.hh"
 #include "DOMSchemaResolver.hh"
+#include "video.hh"
 #include <string>
 #include <vector>
 #include <memory>
@@ -208,13 +209,14 @@
         DOMErrorReporter *domSerErrorHandler;
         bool errorInit;
         bool isMakePreviews;
+        video::VideoModes selectedVideoMode;
 
     private:
         void initSysDatapaths(const std::string &prefFilename);
         void initXerces();
         void initUserDatapaths();
         void updateMac1_00();
-	double enigmaVersion;
+        double enigmaVersion;
         std::string systemAppDataPath;    // dir path to the apps data
         std::string systemCmdDataPath;    // commandline override of systemAppDataPath
         std::string userStdPath;          // standard user data path

Modified: trunk/src/video.cc
===================================================================
--- trunk/src/video.cc	2007-09-08 13:33:27 UTC (rev 873)
+++ trunk/src/video.cc	2007-09-08 16:53:53 UTC (rev 874)
@@ -40,6 +40,7 @@
 #include <cassert>
 #include <cstdio>
 #include <fstream>
+#include <sstream>
 #include "config.h"
 
 #define SCREEN ecl::Screen::get_instance()
@@ -99,9 +100,9 @@
 
         int      x, y;
         int      oldx, oldy;
-	int      hotx, hoty;    // Coordinates of hotspot inside cursor image
-	int      visible;
-	bool     changedp;
+        int      hotx, hoty;    // Coordinates of hotspot inside cursor image
+        int      visible;
+        bool     changedp;
     };
 }
 
@@ -132,10 +133,13 @@
 {
     static bool firstInit = true;
     
+#ifndef MACOSX
     if (firstInit) {
-        // set the caption icon -- usually it is taken without this init from
-        // the app -- but XP in WindowsXP Design fails.
-        // This init has to take place before the first SDL_SetVideoMode() !!
+        // Set the caption icon -- due to SDL doc it has to be set before first SDL_SetVideoMode() !!
+        // In praxis this SetIcon does not work for Linux, nor is it necessary for OSX.
+        // Just XP with selected "WindowsXP Design" needs this SetIcon.
+        // See video::Init() for icon set for Linux and other Windows versions
+        // Mac icon is set via Makefile 
         firstInit = false;
         std::string iconpath;
         ecl::Surface *es = NULL;
@@ -146,6 +150,7 @@
             }
         }
     }
+#endif
 
     SDL_WM_SetCaption(caption.c_str(), 0);
 
@@ -328,7 +333,7 @@
         { 
             VM_640x480, 640, 480,            // id, w, h
             32, VTS_32,                      // tilesize, tiletype
-            "640x480", "640x480", false,     // name, fsname, fs only
+            "640x480", "VGA", "4:3",         // name, fsname, fs only
             "models-32.lua", "gfx32/",       // initscript, dir
             Rect (0, 0, 640, 480),           // display area
             0, 0,                            // menu background image offsets 
@@ -339,12 +344,13 @@
             Rect (100, 425, 30, 43),         // moves area
             Rect (152, 433, 490, 52),        // inventory area
             Rect (150, 434, 475, 35),        // text area
-            VM_None, true,                   // fallback, available
+            true, true,                      // available window, fullscreen
+            "-0-","-0-"                      // fallback modes window, fullscreen
         },
         { 
             VM_640x512, 640, 512,            // id, w, h
             32, VTS_32,                      // tilesize, tiletype
-            "640x512", "640x512", false,     // name, fsname, fs only
+            "640x512", "640x512", "5:4",     // name, fsname, fs only
             "models-32.lua", "gfx32/",       // initscript, dir
             Rect (0, 0, 640, 480),           // display area
             0, 0,                            // menu background image offsets 
@@ -355,12 +361,13 @@
             Rect (100, 420, 30, 40),         // moves area
             Rect (152, 433, 490, 52),        // inventory area
             Rect (150, 434, 475, 35),        // text area
-            VM_640x480, false,               // 640x512 is deprecated!
+            false, false,                    // 640x512 is deprecated!
+            "-0-","-0-"                      // fallback modes window, fullscreen
         },
         { 
             VM_800x600, 800, 600,            // id, w, h
             40, VTS_40,                      // tilesize, tiletype
-            "800x600", "800x600", false,     // name, fsname, fs only
+            "800x600", "SVGA", "4:3",        // name, fsname, fs only
             "models-40.lua", "gfx40/",       // initscript, dir
             Rect (0, 0, 800, 600),           // display area
             0, 0,                            // menu background image offsets 
@@ -371,12 +378,13 @@
             Rect (125, 540, 30, 40),         // moves area
             Rect (192, 539, 610, 46),        // inventory area
             Rect (185, 545, 600, 39),        // text area
-            VM_640x480, true,                // fallback, available
+            true, true,                      // available window, fullscreen
+            "-2-0-","-2-0-"                  // fallback modes window, fullscreen
         },
         { 
             VM_1024x768, 1024, 768,          // id, w, h
             48, VTS_48,                      // tilesize, tiletype
-            "1024x768", "1024x768", false,   // name, fsname, fs only
+            "1024x768", "XGA", "4:3",        // name, fsname, fs only
             "models-48.lua", "gfx48/",       // initscript, dir
             Rect (32, 0, 960, 720),          // display area
             -128, -96,                       // menu background image offsets 
@@ -387,12 +395,13 @@
             Rect (185, 640, 30, 60),         // moves area
             Rect (260, 650, 710, 46),        // inventory area
             Rect (260, 655, 710, 40),        // text area
-            VM_640x480, true,                // fallback, available
+            true, true,                      // available window, fullscreen
+            "-3-2-0-","-3-2-0-"              // fallback modes window, fullscreen
         },
         { 
             VM_960x720, 960, 720,            // id, w, h
             48, VTS_48,                      // tilesize, tiletype
-            "960x720", "960x720", false,     // name, fsname, fs only
+            "960x720", "960x720", "4:3",     // name, fsname, fs only
             "models-48.lua", "gfx48/",       // initscript, dir
             Rect (0, 0, 960, 720),           // display area
             -192, -144,                      // menu background image offsets 
@@ -403,44 +412,30 @@
             Rect (153, 640, 30, 60),         // moves area
             Rect (228, 650, 710, 46),        // inventory area
             Rect (228, 655, 710, 40),        // text area
-            VM_640x480, true,                // fallback, available
+            true, true,                      // available window, fullscreen
+            "-4-2-0-","-4-2-0-"              // fallback modes window, fullscreen
         },
         { 
-            VM_960x768, 960, 768,            // id, w, h
+            VM_1280x720, 1280, 720,          // id, w, h
             48, VTS_48,                      // tilesize, tiletype
-            "960x768", "1280x1024", true,    // name, fsname, fs only
+            "1280x720", "HD720", "16:10",    // name, fsname, fs only
             "models-48.lua", "gfx48/",       // initscript, dir
-            Rect (0, 0, 960, 720),           // display area
+            Rect (160, 0, 960, 720),         // display area
             -192, -96,                       // menu background image offsets 
             120, 78, "",                     // thumbnail size/extension
-            Rect (0, 0, 960, 624),           // game area
-            Rect (0, 624, 960, 96),          // statusbar area
-            Rect (18, 640, 170, 60),         // time area
-            Rect (153, 640, 30, 60),         // moves area
-            Rect (228, 650, 710, 46),        // inventory area
-            Rect (228, 655, 710, 40),        // text area
-            VM_640x480, true,                // fallback, available
+            Rect (160, 0, 960, 624),         // game area
+            Rect (160, 624, 960, 96),        // statusbar area
+            Rect (178, 640, 170, 60),        // time area
+            Rect (313, 640, 30, 60),         // moves area
+            Rect (388, 650, 710, 46),        // inventory area
+            Rect (388, 655, 710, 40),        // text area
+            false, true,                     // available window, fullscreen
+            "-0-","-5-0-"                    // fallback modes window, fullscreen
         },
         { 
-            VM_1152x720, 1152, 720,          // id, w, h
-            48, VTS_48,                      // tilesize, tiletype
-            "1152x720", "1680x1050", true,   // name, fsname, fs only
-            "models-48.lua", "gfx48/",       // initscript, dir
-            Rect (96, 0, 960, 720),          // display area
-            0, -144,                         // menu background image offsets 
-            120, 78, "",                     // thumbnail size/extension
-            Rect (96, 0, 960, 624),          // game area
-            Rect (96, 624, 960, 96),         // statusbar area
-            Rect (114, 640, 170, 60),        // time area
-            Rect (249, 640, 30, 60),         // moves area
-            Rect (324, 650, 710, 46),        // inventory area
-            Rect (324, 655, 710, 40),        // text area
-            VM_640x480, true,                // fallback, available
-        },
-        { 
             VM_1280x960, 1280, 960,          // id, w, h
             64, VTS_64,                      // tilesize, tiletype
-            "1280x960", "1280x960", false,   // name, fsname, fs only
+            "1280x960", "1280x960", "4:3",   // name, fsname, fs only
             "models-64.lua", "gfx64/",       // initscript, dir
             Rect (0, 0, 1280, 960),          // display area
             -400, -90,                       // menu background image offsets 
@@ -451,12 +446,30 @@
             Rect (204, 853, 40, 80),         // moves area //TODO
             Rect (304, 867, 947, 61),        // inventory area //TODO
             Rect (304, 873, 947, 53),        // text area //TODO
-            VM_640x480, true,                // fallback, available
+            true, true,                      // available window, fullscreen
+            "-6-4-2-0-","-6-4-2-0-"          // fallback modes window, fullscreen
         },
         { 
+            VM_1440x960, 1440, 960,          // id, w, h
+            64, VTS_64,                      // tilesize, tiletype
+            "1440x960", "1440x960", "3:2",   // name, fsname, fs only
+            "models-64.lua", "gfx64/",       // initscript, dir
+            Rect (80, 0, 1280, 960),         // display area
+            -400, -90,                       // menu background image offsets 
+            160, 104, "-160x104",            // thumbnail size/extension
+            Rect (80, 0, 1280, 832),         // game area
+            Rect (80, 832, 1280, 128),       // statusbar area
+            Rect (104, 853, 227, 80),        // time area //TODO
+            Rect (284, 853, 40, 80),         // moves area //TODO
+            Rect (384, 867, 947, 61),        // inventory area //TODO
+            Rect (384, 873, 947, 53),        // text area //TODO
+            false, true,                     // available window, fullscreen
+            "-0-","-7-0-"                    // fallback modes window, fullscreen
+        },
+        { 
             VM_1280x1024, 1280, 1024,        // id, w, h
             64, VTS_64,                      // tilesize, tiletype
-            "1280x1024", "1280x1024", true,  // name, fsname, fs only
+            "1280x1024", "SXGA", "5:4",      // name, fsname, fs only
             "models-64.lua", "gfx64/",       // initscript, dir
             Rect (0, 0, 1280, 960),          // display area
             -400, -26,                       // menu background image offsets 
@@ -467,12 +480,13 @@
             Rect (153, 640, 30, 60),         // moves area //TODO
             Rect (228, 650, 710, 46),        // inventory area //TODO
             Rect (228, 655, 710, 40),        // text area //TODO
-            VM_640x480, true,                // fallback, available
+            false, true,                     // available window, fullscreen
+            "-0-","-8-0-"                    // fallback modes window, fullscreen
         },
         { 
             VM_1680x1050, 1680, 1050,        // id, w, h
             64, VTS_64,                      // tilesize, tiletype
-            "1680x1050", "1680x1050", false, // name, fsname, fs only
+            "1680x1050", "WSXGA+", "16:10",  // name, fsname, fs only
             "models-64.lua", "gfx64/",       // initscript, dir
             Rect (200, 0, 1280, 960),        // display area
             -0, -0,                          // menu background image offsets 
@@ -483,8 +497,9 @@
             Rect (404, 853, 40, 80),         // moves area //TODO
             Rect (504, 867, 947, 61),        // inventory area //TODO
             Rect (504, 873, 947, 53),        // text area //TODO
-            VM_640x480, true,                // fallback, available
-        },
+            false, true,                     // available window, fullscreen
+            "-0-","-9-0-"                    // fallback modes window, fullscreen
+        }
     };
 
     VideoModes current_video_mode = VM_None;
@@ -494,7 +509,7 @@
 
 namespace
 {
-    bool vm_available (int w, int h, int &bpp, bool &fullscreen)
+    bool vm_available (int w, int h, int &bpp, bool fullscreen)
     {
         Uint32 flags = SDL_HWSURFACE;
         if (fullscreen)
@@ -609,53 +624,126 @@
     video_modes[current_video_mode].thumbsext = extension;
 }
 
+int video::GetNumAvailableModes(bool isFullscreen) {
+    int avail = 0;
+    for (int i = VM_None + 1; i < VM_COUNT; i++)
+        if (isFullscreen ? video_modes[i].f_available : video_modes[i].w_available)
+            avail++;
+            
+    return avail;
+}
+
+VideoModes video::GetVideoMode(int number, bool isFullscreen) {
+    int avail = 0;
+    for (int i = VM_None + 1; i < VM_COUNT; i++)
+        if (isFullscreen ? video_modes[i].f_available : video_modes[i].w_available) {
+            if (avail == number)
+                return static_cast<video::VideoModes>(i);
+            else
+                avail++;
+        }
+    return VM_None;
+}
+
+VideoModes video::GetBestUserMode(bool isFullscreen, int seq) {
+    std::string modes = app.prefs->getString(isFullscreen ? "VideoModesFullscreen" : "VideoModesWindow");
+    if (modes.length() > 1) {
+        std::istringstream ms(modes);
+        int m = VM_None;
+        ms.ignore();  // leading '-'
+        while (ms && seq > 0) {
+            ms >> std::dec >> m;
+            ms.ignore();
+            if (m <= VM_COUNT && ((!isFullscreen && video_modes[m].w_available) ||
+                    (isFullscreen && video_modes[m].f_available))) {
+                if (seq == 1) {
+                    return static_cast<video::VideoModes>(m);
+                }
+                --seq; 
+            }
+        }
+    }
+    return VM_None;
+}
+
+
+int video::GetModeNumber(VideoModes mode, bool isFullscreen) {
+    int avail = 0;
+    for (int i = VM_None + 1; i < mode; i++)
+        if (isFullscreen ? video_modes[i].f_available : video_modes[i].w_available)
+            avail++;
+    return avail;
+}
+
+
 bool video::ModeAvailable (VideoModes vm)
 {
     const VMInfo *vminfo = GetInfo (vm);
     string fname;
-    return (vminfo->available && app.systemFS->findFile (vminfo->initscript, fname));
+    return (vminfo->w_available && app.systemFS->findFile (vminfo->initscript, fname));
 }
 
 
 void video::Init() 
 {
-    assert (NUMENTRIES(video_modes) == VM_COUNT);
+    static bool isInit = false;
+    static int bpp_default = 16;
+    int bpp = bpp_default; //options::BitsPerPixel;
 
+    
+    if (!isInit) {
+        assert (NUMENTRIES(video_modes) == VM_COUNT);
+        isInit = true;
+        for (int i = VM_None + 1; i < VM_COUNT; i++) {
+            bpp = bpp_default;
+            if (video_modes[i].w_available && !vm_available(video_modes[i].width, video_modes[i].height, bpp, false)) {
+                video_modes[i].w_available = false;
+                Log << "Video mode " << video_modes[i].width << " x " << video_modes[i].height << " window not available\n";
+            }
+            if (bpp != bpp_default)
+                Log << "Video mode " << video_modes[i].width << " x " << video_modes[i].height << " window available with bpp " << bpp << "\n";
+            bpp = bpp_default;
+            if (video_modes[i].f_available && !vm_available(video_modes[i].width, video_modes[i].height, bpp, true)) {
+                video_modes[i].f_available = false;
+                Log << "Video mode " << video_modes[i].width << " x " << video_modes[i].height << " fullscreen not available\n";
+            }
+            if (bpp != bpp_default)
+                Log << "Video mode " << video_modes[i].width << " x " << video_modes[i].height << " fullscreen available with bpp " << bpp << "\n";
+        }
+    }
+
+    bool isFullScreen = app.prefs->getBool("FullScreen");
     int vidmode = -1;
-    app.prefs->getProperty("VideoMode1.1", vidmode);
-    if (vidmode == -1) {
+    if (app.prefs->getString("VideoModesFullscreen").empty()) {
         // initialize from 1.0 mode if never set before
         vidmode = app.prefs->getInt("VideoMode");
-        app.prefs->setProperty("VideoMode1.1", vidmode);
-        app.prefs->setProperty("FullScreen1.1", app.prefs->getBool("FullScreen"));
+        app.prefs->setProperty("VideoModesFullscreen", video_modes[vidmode].fallback_fullscreen);
+        app.prefs->setProperty("VideoModesWindow", video_modes[vidmode].fallback_window);
     }
-    if (vidmode >= VM_COUNT) {
-        // TODO
-    }
-    vidmode = ecl::Clamp(vidmode, 0, VM_COUNT-1);
+    vidmode = video::GetBestUserMode(isFullScreen);
+    
     int oldvidmode = vidmode;
 
     video_engine = new Video_SDL();
 
-    int bpp = 16; //options::BitsPerPixel;
+
     assert(bpp==16 || bpp==32);
-
+    int fallback_sequence = 1;
     while (true) {
         VMInfo *vminfo     = &video_modes[vidmode];
         int     w          = vminfo->width;
         int     h          = vminfo->height;
-        bool    fullscreen = app.prefs->getBool("FullScreen1.1");
 
         if (ModeAvailable (static_cast<VideoModes> (vidmode))
-            && vm_available (w, h, bpp, fullscreen)
-            && video_engine->init (w, h, bpp, fullscreen)) 
+            && vm_available (w, h, bpp, isFullScreen)
+            && video_engine->init (w, h, bpp, isFullScreen)) 
         {
             // Success!
             break;
         }
 
-        // Video mode not available? Try the fallback video mode
-        vidmode = vminfo->fallback_videomode;
+        // Video mode not available? Try the next fallback video mode
+        vidmode =  video::GetBestUserMode(isFullScreen, ++fallback_sequence); 
         if (vidmode == VM_None) {
             // Give up :-(
             fprintf(stderr, "Couldn't open screen: %s\n", SDL_GetError());
@@ -664,11 +752,12 @@
     }
 
     current_video_mode = static_cast<VideoModes>(vidmode);
-    if (vidmode != app.prefs->getInt("VideoMode1.1")) {
-        app.prefs->setProperty("VideoMode1.1", vidmode);
-    }
+    app.selectedVideoMode = current_video_mode;
 
-
+    // Set the caption icon -- this position after SDL_SetVideoMode() contradicts SDL doc!!
+    // But it proves to be the only working position for Linux.
+    // It works for Windows besides XP with selected "WindowsXP Design", too.
+    // Mac icon is set via Makefile 
 #ifndef MACOSX
     Surface *icn = enigma::GetImage("enigma_marble");
     if(icn)
@@ -724,14 +813,17 @@
     return SCREEN->get_surface()->bipp();
 }
 
-bool video::SetFullscreen(bool onoff) 
+bool video::SetFullscreen(bool on) 
 {
-    video_engine->set_fullscreen(onoff);
-    bool is_fullscreen = video_engine->is_fullscreen();
-    if (onoff == is_fullscreen) {
-        app.prefs->setProperty("FullScreen1.1", is_fullscreen);
+    if ((on && video_modes[current_video_mode].f_available) || 
+            (!on && video_modes[current_video_mode].w_available)) {
+        video_engine->set_fullscreen(on);
+        bool is_fullscreen = video_engine->is_fullscreen();
+        if (on == is_fullscreen) {
+            app.prefs->setProperty("FullScreen", is_fullscreen);
+        }
     }
-    return is_fullscreen;
+    return video::IsFullScreen();
 }
 
 bool video::ToggleFullscreen() 
@@ -763,7 +855,7 @@
         ecl::FolderCreate (directory);
     }
 
-    ecl::SavePNG (SCREEN->get_surface(), fname);
+    ecl::SavePNG (ecl::Grab(SCREEN->get_surface(), video_modes[current_video_mode].area), fname);
     enigma::Log << "Wrote screenshot to '" << fname << "\n";
 }
 

Modified: trunk/src/video.hh
===================================================================
--- trunk/src/video.hh	2007-09-08 13:33:27 UTC (rev 873)
+++ trunk/src/video.hh	2007-09-08 16:53:53 UTC (rev 874)
@@ -31,16 +31,16 @@
 
     enum VideoModes {
         VM_None      = -1,
-        VM_640x480   = 0,   // 32 bit basic
-        VM_640x512   = 1,
-        VM_800x600   = 2,   // 40 bit basic
-        VM_1024x768  = 3,   // 48 bit embedded
-        VM_960x720   = 4,   // 48 bit basic
-        VM_960x768   = 5,   // 48 bit grid linear strechable to 1280x1024
-        VM_1152x720  = 6,   // 48 bit grid lineas strechable to 1680x1050
-        VM_1280x960  = 7,   // 64 bit basic
-        VM_1280x1024 = 8,   // 64 bit embedded 
-        VM_1680x1050 = 9,   // 64 bit embedded
+        VM_640x480   = 0,   ///< 32 bit basic    -  4:3  - VGA
+        VM_640x512   = 1,   ///< 32 bit embedded -  5:4  - none
+        VM_800x600   = 2,   ///< 40 bit basic    -  4:3  - SVGA
+        VM_1024x768  = 3,   ///< 48 bit embedded -  4:3  - XGA
+        VM_960x720   = 4,   ///< 48 bit basic    -  4:3  - none
+        VM_1280x720  = 5,   ///< 48 bit embedded - 16:9  - HD720
+        VM_1280x960  = 6,   ///< 64 bit basic    -  4:3  - none
+        VM_1440x960  = 7,   ///< 64 bit embedded -  3:2  - none
+        VM_1280x1024 = 8,   ///< 64 bit embedded -  5:4  - SXGA
+        VM_1680x1050 = 9,   ///< 64 bit embedded - 16:10 - WSXGA+
         VM_COUNT
     };
     
@@ -56,9 +56,9 @@
         int            width, height;    // Screen width and height in pixels
         int            tile_size;        // Tile size in pixels
         VideoTileType  tt;               // Tile type
-        const char    *name;             // Menu text 
-        const char    *fullscreen_name;  // Menu text 
-        bool           isFullscreenOnly;
+        const char    *name;             // Menu text resolution
+        const char    *std_name;         // Menu text svg standard
+        const char    *relation_name;    // Menu text relation width : height
         const char    *initscript;       // Lua initialization script
         const char    *gfxdir;           // Directory that contains the graphics
         ecl::Rect      area;             // Area that is used for display
@@ -71,8 +71,10 @@
         ecl::Rect      sb_movesarea;
         ecl::Rect      sb_itemarea;
         ecl::Rect      sb_textarea;
-        VideoModes     fallback_videomode;
-        bool           available;        // Is this video mode available?
+        bool           w_available;        // Is this video mode available?
+        bool           f_available;        // Is this video mode available?
+        std::string    fallback_window;    // hyphen seperated list of modes e.g. "-7-4-2-0-"
+        std::string    fallback_fullscreen;
     };
 
     void Init();
@@ -91,11 +93,48 @@
     const VMInfo *GetInfo (VideoModes vm);
 
     /*! Return information about current video mode. */
-    const VMInfo *GetInfo ();
+    const VMInfo *GetInfo();
 
     // just for main batch thumb generation in wrong videomode
     void SetThumbInfo(int width, int height, std::string extension);
 
+    /**
+     * Count number of available modes for the current configuration.
+     * @arg  isFullScreen   video mode for fullscreen or window mode
+     * @return   number of modes
+     */
+    int GetNumAvailableModes(bool isFullscreen);
+    
+    /**
+     * Get the video mode by the sequence number of available modes for the
+     * current configuration
+     * @arg  number         desired sequence number within the list of available modes
+     * @arg  isFullScreen   video mode for fullscreen or window mode
+     * @return   the requested video mode
+     */
+    VideoModes GetVideoMode(int number, bool isFullscreen);
+    
+    /**
+     * Calulate the sequence number for a given mode within the number of
+     * available modes for the current configuration.
+     * @arg  mode           the video mode to locate
+     * @arg  isFullScreen   video mode for fullscreen or window mode
+     * @return   the sequence number of the mode
+     */
+    int GetModeNumber(VideoModes mode, bool isFullScreen);
+    
+    /**
+     * Calculate the best video mode out of the users preferences that is
+     * available for the current configuration. As the user preference 
+     * state a sequence of fallback modes this function returns a useful 
+     * mode even if the user did run previously a future version of Enigma
+     * and selected a mode that is not available in this Enigma version.
+     * @arg  isFullScreen   video mode for fullscreen or window mode
+     * @arg  seq            sequence number of best available mode, default to 1
+     * @return   the preferable video mode 
+     */
+    VideoModes GetBestUserMode(bool isFullScreen, int seq = 1);
+    
     bool ModeAvailable (VideoModes vm);
 
     //! Return the current video mode



From ral at mail.berlios.de  Sun Sep  9 00:18:13 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 9 Sep 2007 00:18:13 +0200
Subject: [Enigma-game-svn] r875 - trunk/src
Message-ID: <200709082218.l88MIDHT011195@sheep.berlios.de>

Author: ral
Date: 2007-09-09 00:18:13 +0200 (Sun, 09 Sep 2007)
New Revision: 875

Modified:
   trunk/src/stones_complex.cc
Log:
Trunk 1.1: 
- fix st-pull causing assertions when pulled outside of level by rotator
- fix st-pull being unable to move stones on border in ENIGMA mode


Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2007-09-08 16:53:53 UTC (rev 874)
+++ trunk/src/stones_complex.cc	2007-09-08 22:18:13 UTC (rev 875)
@@ -282,8 +282,8 @@
     GridPos         newPos      = move(oldPos, move_dir);
     Stone          *other_stone = GetStone(newPos);
 
-    if (other_stone &&
-        (!other_stone->is_removable() || IsLevelBorder(newPos))) {
+    if (!IsInsideLevel(newPos) || (other_stone && (!other_stone->is_removable() || 
+        (IsLevelBorder(newPos) && server::GameCompatibility != GAMET_ENIGMA)))) {
         return;                 // avoid unremoveable and border stones
     }
 



From ral at mail.berlios.de  Sun Sep  9 21:32:36 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 9 Sep 2007 21:32:36 +0200
Subject: [Enigma-game-svn] r876 - in homepage/input: . news
Message-ID: <200709091932.l89JWaJj027289@sheep.berlios.de>

Author: ral
Date: 2007-09-09 21:32:36 +0200 (Sun, 09 Sep 2007)
New Revision: 876

Modified:
   homepage/input/download.html
   homepage/input/download_de.html
   homepage/input/download_ru.html
   homepage/input/news/news_issue23_de.html
   homepage/input/news/news_issue23_en.html
Log:
Homepage:
- corrections to the 1.01 64 bit source package announcement


Modified: homepage/input/download.html
===================================================================
--- homepage/input/download.html	2007-09-08 22:18:13 UTC (rev 875)
+++ homepage/input/download.html	2007-09-09 19:32:36 UTC (rev 876)
@@ -53,18 +53,11 @@
     <li>sha256 - e2822599dfc8e0a888d729f5ad2ce7cdbf2e1e87bca508c8da76c48fbb0023ab</li>
     </ul></li>
 
-  <li><ul style="list-style-type:none"><li><b>Source Code 32-bit</b>
-    <a href="http://download.berlios.de/enigma-game/enigma-1.01.tar.gz">
-	tar.gz (1.01)</a> appr. 10 MB</li>
-    <li>md5 - d3804534ac03425051ebfd383ed1b4ee</li>
-    <li>sha256 - e704737676e89c509b19f1071284a6df7335a001da08bd116afded4c5e724fbb</li>
-    </ul></li>
-
-  <li><ul style="list-style-type:none"><li><b>Source Code 64-bit</b>
+  <li><ul style="list-style-type:none"><li><b>Source Code 32/64-bit compatible</b>
     <a href="http://download.berlios.de/enigma-game/enigma-1.01-64bit.tar.gz">
 	tar.gz (1.01)</a> appr. 10 MB</li>
-    <li>md5 - not yet available</li>
-    <li>sha256 - not yet available</li>
+    <li>md5 - d58af8a7201601dabc45dcedae5e2e91</li>
+    <li>sha256 - ae87ecf635bd89bec143a8011e30a4a3b546edb3fe2ed2fca243d366bb599736</li>
     </ul></li>
 
   <li><ul style="list-style-type:none"><li><b>Previews</b>

Modified: homepage/input/download_de.html
===================================================================
--- homepage/input/download_de.html	2007-09-08 22:18:13 UTC (rev 875)
+++ homepage/input/download_de.html	2007-09-09 19:32:36 UTC (rev 876)
@@ -59,18 +59,11 @@
     <li>sha256 - e2822599dfc8e0a888d729f5ad2ce7cdbf2e1e87bca508c8da76c48fbb0023ab</li>
     </ul></li>
 
-  <li><ul style="list-style-type:none"><li><b>Quellcode 32-Bit</b>
-    <a href="http://download.berlios.de/enigma-game/enigma-1.01.tar.gz">
-	tar.gz (1.01)</a> etwa 10 MB</li>
-    <li>md5 - d3804534ac03425051ebfd383ed1b4ee</li>
-    <li>sha256 - e704737676e89c509b19f1071284a6df7335a001da08bd116afded4c5e724fbb</li>
-    </ul></li>
-
-  <li><ul style="list-style-type:none"><li><b>Quellcode 64-Bit</b>
+  <li><ul style="list-style-type:none"><li><b>Quellcode 32/64-Bit kompatibel</b>
     <a href="http://download.berlios.de/enigma-game/enigma-1.01-64bit.tar.gz">
 	tar.gz (1.01)</a> etwa 10 MB</li>
-    <li>md5 - noch nicht verf&uuml;gbar</li>
-    <li>sha256 - noch nicht verf&uuml;gbar</li>
+    <li>md5 - d58af8a7201601dabc45dcedae5e2e91</li>
+    <li>sha256 - ae87ecf635bd89bec143a8011e30a4a3b546edb3fe2ed2fca243d366bb599736</li>
     </ul></li>
   
   <li><ul style="list-style-type:none"><li><b>Levelvorschau-Bilder</b>

Modified: homepage/input/download_ru.html
===================================================================
--- homepage/input/download_ru.html	2007-09-08 22:18:13 UTC (rev 875)
+++ homepage/input/download_ru.html	2007-09-09 19:32:36 UTC (rev 876)
@@ -52,11 +52,11 @@
     <li>sha256 - e2822599dfc8e0a888d729f5ad2ce7cdbf2e1e87bca508c8da76c48fbb0023ab</li>
     </ul></li>
 
-  <li><ul style="list-style-type:none"><li><b>???????? ????</b>
-    <a href="http://download.berlios.de/enigma-game/enigma-1.01.tar.gz">
+  <li><ul style="list-style-type:none"><li><b>???????? ???? 32/64-bit compatible</b>
+    <a href="http://download.berlios.de/enigma-game/enigma-1.01-64bit.tar.gz">
 	tar.gz (1.01)</a> ?????. 10 MB</li>
-    <li>md5 - d3804534ac03425051ebfd383ed1b4ee</li>
-    <li>sha256 - e704737676e89c509b19f1071284a6df7335a001da08bd116afded4c5e724fbb</li>
+    <li>md5 - d58af8a7201601dabc45dcedae5e2e91</li>
+    <li>sha256 - ae87ecf635bd89bec143a8011e30a4a3b546edb3fe2ed2fca243d366bb599736</li>
     </ul></li>
 
   <li><ul style="list-style-type:none"><li><b>??????</b>

Modified: homepage/input/news/news_issue23_de.html
===================================================================
--- homepage/input/news/news_issue23_de.html	2007-09-08 22:18:13 UTC (rev 875)
+++ homepage/input/news/news_issue23_de.html	2007-09-09 19:32:36 UTC (rev 876)
@@ -1,10 +1,13 @@
 <h3 class="news">
-    <span class="date">Sep 8 2007: </span> Enigma 1.01 f&uuml;r 64-Bit
+    <span class="date">Sep 9 2007: </span> Enigma 1.01 f&uuml;r 64-Bit
     Linux-Versionen
 </h3>
 
-<p>Einige Nutzer k&ouml;nnen Probleme beim Start von Enigma bekommen, wenn sie
-auf einem 64-Bit-System arbeiten. Wenn Sie diese Fehlermeldung sehen:
-&quot;Cannot load application score file [...] Invalid document structure&quot;,
-kompilieren Sie den fehlerbereinigten Release &quot;Quellcode 64-Bit&quot; von
-unserer <a href="$$download$$#stable">Downloadseite</a>.</p>
+<p>Leider hat sich die in Enigma enthaltene zipios++ Library Version als
+inkompatibel zu 64-Bit herausgestellt. Weder Windows noch Mac OSX noch Debian
+basierte Compilationen sind von diesem Problem betroffen. Alle anderen Unix
+Systeme die direkt unsere Source Releases compilieren bieten wir eine
+&uuml;berarbeitetes Source Packet an, dass sowohl 32-Bit als auch 64-Bit
+Prozessoren gerecht wird. Bitte compilieren Sie das fehlerbereinigte Release
+&quot;Quellcode 32/64-Bit&quot; von unserer <a href="$$download$$#stable">
+Downloadseite</a>.</p>

Modified: homepage/input/news/news_issue23_en.html
===================================================================
--- homepage/input/news/news_issue23_en.html	2007-09-08 22:18:13 UTC (rev 875)
+++ homepage/input/news/news_issue23_en.html	2007-09-09 19:32:36 UTC (rev 876)
@@ -2,8 +2,10 @@
     <span class="date">Sep 8 2007: </span> Enigma 1.01 for 64-bit Linux versions
 </h3>
 
-<p>Some users might run into problems when they start Enigma on a 64-bit system.
-If you see this error message: &quot;Cannot load application score file [...]
-Invalid document structure&quot;, compile the bugfixed release &quot;Source
-Code 64-bit&quot; from our <a href="$$download$$#stable">download
-section</a>.</p>
+<p>Unfortunatly the Enigma included zipios++ library version proved to be
+incompatible to 64 bit. Neither Windows nor Mac OSX nor Debian based compilations
+have been influenced by this problem. For all remaining Unix systems that compile
+directly from our released sources we provide an updated source package that fits
+32 bit as well as 64 bit processors. Please compile the bugfixed release 
+&quot;Source Code 32/64-bit compatible&quot; from our <a href="$$download$$#stable">
+download section</a>.</p>



From ral at mail.berlios.de  Mon Sep 10 00:08:15 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 10 Sep 2007 00:08:15 +0200
Subject: [Enigma-game-svn] r877 - trunk/src
Message-ID: <200709092208.l89M8FQQ005319@sheep.berlios.de>

Author: ral
Date: 2007-09-10 00:08:15 +0200 (Mon, 10 Sep 2007)
New Revision: 877

Modified:
   trunk/src/d_engine.hh
   trunk/src/display.cc
Log:
Trunk 1.1:
- final fix for undeleted Rubberband models Bug #011942 see Hotfix rev 868

Modified: trunk/src/d_engine.hh
===================================================================
--- trunk/src/d_engine.hh	2007-09-09 19:32:36 UTC (rev 876)
+++ trunk/src/d_engine.hh	2007-09-09 22:08:15 UTC (rev 877)
@@ -316,6 +316,7 @@
         void set_startpoint (unsigned id, const V2 &p1);
         void set_endpoint (unsigned id, const V2 &p2);
         void kill_line (unsigned id);
+        void new_world (int w, int h);
 
     private:
         // Private methods.

Modified: trunk/src/display.cc
===================================================================
--- trunk/src/display.cc	2007-09-09 19:32:36 UTC (rev 876)
+++ trunk/src/display.cc	2007-09-09 22:08:15 UTC (rev 877)
@@ -1162,6 +1162,11 @@
         m_rubbers.erase(i);
 }
 
+void DL_Lines::new_world (int w, int h) {
+    m_rubbers.clear();
+    m_id = 1;
+}
+
 RubberHandle::RubberHandle(DL_Lines *ll, unsigned id_)
 : line_layer (ll), id(id_)
 {



From andreasl at mail.berlios.de  Mon Sep 10 01:13:29 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Mon, 10 Sep 2007 01:13:29 +0200
Subject: [Enigma-game-svn] r878 - in homepage/input: . lotm
Message-ID: <200709092313.l89NDTb6023823@sheep.berlios.de>

Author: andreasl
Date: 2007-09-10 01:13:29 +0200 (Mon, 10 Sep 2007)
New Revision: 878

Modified:
   homepage/input/infobox_de.html
   homepage/input/lotm/lotm_200709.html
Log:
Homepage:
 - proofread of English LotM 9/07 by Clifford
 - typos in German infobox


Modified: homepage/input/infobox_de.html
===================================================================
--- homepage/input/infobox_de.html	2007-09-09 22:08:15 UTC (rev 877)
+++ homepage/input/infobox_de.html	2007-09-09 23:13:29 UTC (rev 878)
@@ -1,8 +1,8 @@
     <div class="infobody">
        <div class="info">
          <h3>100 Einsender von Ergebnissen</h3>
-         Wir heissen den Spieler &quot;dpl&quot; willkommen, der wir als 100sten
-	 aktiven Einsender von Spielergebnissen registriert haben.
+         Wir hei&szlig;en den Spieler &quot;dpl&quot; willkommen, den wir als
+         100sten aktiven Einsender von Spielergebnissen registriert haben.
          <h3>Level des Monats</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>
@@ -19,7 +19,7 @@
 	 Statistikseite</a> sehen kann.
          <h3>Unterst&uuml;tzung</h3>
          Level schreiben, &Uuml;bersetzen, Fehlermeldungen, Coden.<br>
-	 Wir brauchen Ihre Hilfe. Siehe <a href="$$development$$">Development</a>.
+	 Wir brauchen Ihre Hilfe. Siehe <a href="$$development$$">Entwicklung</a>.
          <!--<h3>Spenden</h3>
          Helfen Sie uns, dieses Projekt am Leben zu halten.-->
        </div>

Modified: homepage/input/lotm/lotm_200709.html
===================================================================
--- homepage/input/lotm/lotm_200709.html	2007-09-09 22:08:15 UTC (rev 877)
+++ homepage/input/lotm/lotm_200709.html	2007-09-09 23:13:29 UTC (rev 878)
@@ -6,9 +6,9 @@
     &quot;Tool Time&quot; by Barry and Lori Mead
   </h3>
 
-  <p>You know this? You are standing in your crammed garage, your long-serving
+  <p>Is this familiar? You are standing in your cluttered garage, your long-serving
   laser-driven lathe to your right, some hot coffee standing on a small rack in
-  a corner of said garage, a totally incrusted oxyd stone before you, waiting
+  a corner, a totally encrusted oxyd stone before you, waiting
   for an overhaul; and the only question on your mind is: &quot;Where did I put
   the hammer?&quot; Yes, it's &quot;Tool Time&quot;!</p>
 
@@ -96,61 +96,63 @@
   </table>
   
   <p>As of our data from July, 13 users voted for &quot;Tool Time&quot,
-  averaging to <b>8.46</b> which establishes &quot;Tool Time&quot; at position 6
-  in our <a href="$$lotm$$">LotM-highscore</a>, head-to-head with
+  with an average of <b>8.46</b> which establishes &quot;Tool Time&quot; at
+  position 6 in our <a href="$$lotm$$">LotM-highscore</a>, head-to-head with
   &quot;Elaborate&quot;, which lost its slight lead over &quot;Labyrinth of
   Puzzles&quot; in the last two months. And another surprise from the current
   ratings: After it was second to &quot;Island Labyrinth&quot; for two months,
   &quot;The Aztec Temple&quot; now tops the list again, with a really marginal
   advance: 9.17 versus 9.13!</p>
-  
+
   <h4>&quot;It was clever how most of the tools had to be made&quot;</h4>
-  
-  <p>Unfortunately, this month only one of the three gamers we asked for a
-  comment, kindly answered our request; a fourth one at least was so kind to
-  promptly answer that he has no time. As it would've been too late to ask
-  others for comments (and we're no babysitters, by the way), this month's
-  article will be shorter than traditionally. I think they'd call it the peak
-  of LotM we just transgressed, don't you agree, Harry?</p>
-  
+
+  <p>Unfortunately, this month only one of the three
+  gamers we asked for a comment kindly answered our request; a fourth one was
+  kind enough at least to answer that he had no time to answer. As it would've
+  been too late to ask others for comments (and we're no babysitters, by the
+  way), this month's article will be shorter than traditionally. I think they'd
+  call it the peak of LotM we just crossed, don't you agree, Harry?</p> 
+
   <p><i>Well, Andreas, last month's LotM article about &quot;Houdini&quot;
   surely was a peak in Lotm History but isn't it a joy to write about excellent
-  Enigma levels each month again? With or without the support of our fellow
-  players we surely will be able to pay tribute to &quot;Tool Time&quot; as
-  another peak of level designing arts. Or would you disagree, Andreas? Should
+  Enigma levels every single month? With or without the support of our fellow
+  players we will still be able to pay tribute to &quot;Tool Time&quot; as
+  another paragon of level designing arts. You would not disagree, Andreas? Should
   we surrender due to the lack of supporters like the Titanic surrendered due to
   the leaks supported by icebergs? And don't they say that brevity is the soul
   of wit? If i compare my personal record of &quot;Houdini&quot; to the one of
   &quot;Tool Time&quot; the latter one indeed seems rather brief. But it really
   takes some time to gather together all the things you need to finally succeed.
   Oh, just have a look at this lovely rhyme, Andreas! Don't you think i would
-  have become a good poet?</i></p>
+  have made a good poet?</i></p>
 
+
   <div class="lotmpic">
     <img src="$$imagedir$$/lotm/lotm_200709_b.png" alt="Level of the month" border="0">
-    <div class="imagetitle">&quot;Listen, tin soldiers, once I find my tin opener
+    <div class="imagetitle">&quot;Listen, tin soldiers, once I find my can opener
     &hellip;&quot; </div>
   </div>
   
-  <p>One could think so, Harry. But I wonder how you plan to port this pretty
+  <p>One would think so, Harry. But I wonder how you plan to port this pretty
   piece of poetry to plain German? ;-) Speaking of artists, the design of
   &quot;Tool Time&quot; is quite familiar, and often seen in other levels like
   &quot;Set Me Free&quot; or &quot;Laser Paradise&quot;. Particularly the
   similarity to &quot;Disk Royal&quot; comes to mind. I think they'd call it
   &quot;illmind-inspired design&quot;, don't you agree, Harry?</p>
 
-  <p><i>One could think so, Andreas, but wasn't that period which you call
+  <p><i>One would think so, Andreas, but wasn't that period which you call
   &quot;illmind-inspired design&quot; two years after the publishing of
   &quot;Tool Time&quot;?. Surely you mean this mixture of st-rock1 and fl-black
   that gives you an uncanny sensation like walking in the abandoned castle of Dr
-  Frankenstein, every moment expecting his creature to sneak around the corner
-  makes your hair stand on end! If my investigations on this matter by
-  assistance of my servant Grep had been carried out correctly Barry & Lori Mead
-  had been the first to use this stone/floor-combination and so it would be fair
-  to call this arrangement Mead-Design. Wouldn't you agree, Andreas? </i></p>
-  
-  <p>I think so, Harry. And, &quot;Tool Time&quot; is first in yet another
-  respect: It's our first Level of the Month, which makes deep use of hiding
+  Frankenstein, with your hair standing on end, expecting at every moment for
+  his creature to sneak around the corner! If my investigations into this matter
+  by assistance of my servant Grep had been carried out correctly Barry & Lori
+  Mead had been the first to use this stone/floor-combination and so it would be
+  fair to call this arrangement Mead-Design. Wouldn't you agree, Andreas?
+  </i></p>
+
+  <p>I'm sure of it, Harry. And, &quot;Tool Time&quot; is first in yet another
+  respect: It's our first Level of the Month, which makes wide use of hidden
   objects. It's not the evil kind of hiding - it's more a frame of exploration
   in which this feature is woven. Speaking about Frankenstein, hiding behind
   transformations is another wonderful aspect of this level, and surely the most
@@ -176,8 +178,8 @@
   right tool, as Aunt Julie from Yorkshire used to say, don't you agree to that,
   Andreas? don't you agree, Andreas?</i>
 
-  <p>I don't think so, Harry. This is solid rock type 1. If it was type 3, this
-  could work. But Mark surely meant another way.</p>
+  <p>I don't think so, Harry. It's made of solid rock type 1. If it were type 3,
+  it could work. But Mark surely meant another way.</p>
 
   <h4>&quot;We designed a little trap, that was the centerpiece of the
   level&quot;</h4>
@@ -239,7 +241,7 @@
   Time&quot; is a joint project of father and daughter. It's great to see how
   Enigma brings together parents and children, even without network gaming.
   Barry, Lori, thank you very much for this important lesson, and the great
-  level you shared with us!</p>
+  level you have shared with us!</p>
 
   <p>Greets,<br/>
   <i>Harry and Andreas</i></p>



From raoul at mail.berlios.de  Mon Sep 10 23:14:32 2007
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Mon, 10 Sep 2007 23:14:32 +0200
Subject: [Enigma-game-svn] r879 - homepage/input
Message-ID: <200709102114.l8ALEWdi020119@sheep.berlios.de>

Author: raoul
Date: 2007-09-10 23:14:32 +0200 (Mon, 10 Sep 2007)
New Revision: 879

Modified:
   homepage/input/faq_core_ru.html
Log:
-> Corrected 1 byte that prevented the russian faq from being valid html ... 


Modified: homepage/input/faq_core_ru.html
===================================================================
--- homepage/input/faq_core_ru.html	2007-09-09 23:13:29 UTC (rev 878)
+++ homepage/input/faq_core_ru.html	2007-09-10 21:14:32 UTC (rev 879)
@@ -562,7 +562,7 @@
 ?????????? ?? ????? ?????? ?????? ???????? ??????.</p>
 
 
-<h4><a name="s6q1">?????????? ?? ???-?? ????????? ??????? Enigma ??? ?????? Enigma?</p></h4>
+<h4><a name="s6q1">?????????? ?? ???-?? ????????? ??????? Enigma ??? ?????? Enigma?</a></h4>
 <p>???? ???, ?? ????? ???? ?? ?????? ???????????? ????? ?????????</p>
 
 <h4><a name="s6q2">???? ?? ??????? ?????</a></h4>



From andreasl at mail.berlios.de  Wed Sep 12 17:33:56 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Wed, 12 Sep 2007 17:33:56 +0200
Subject: [Enigma-game-svn] r880 - in homepage/input: . news
Message-ID: <200709121533.l8CFXuCm023003@sheep.berlios.de>

Author: andreasl
Date: 2007-09-12 17:33:56 +0200 (Wed, 12 Sep 2007)
New Revision: 880

Modified:
   homepage/input/navbar.html
   homepage/input/navbar_de.html
   homepage/input/navbar_ru.html
   homepage/input/news/news_issue23_de.html
   homepage/input/news/news_issue23_en.html
   homepage/input/output-files.lua
Log:
Homepage:
 - preparations for Spanish translation (incl. button)
 - typos in news_issue23_de and _en


Modified: homepage/input/navbar.html
===================================================================
--- homepage/input/navbar.html	2007-09-10 21:14:32 UTC (rev 879)
+++ homepage/input/navbar.html	2007-09-12 15:33:56 UTC (rev 880)
@@ -26,6 +26,10 @@
                 <img src="$$imagedir$$/flags25x15/ru.png" border="0" width="25"
                   height="15" alt="Russian" title="This page in Russian">
           </a></td>
+          <td><a href="$$same_es$$">
+                <img src="$$imagedir$$/flags25x15/es.png" border="0" width="25"
+                  height="15" alt="Spanish" title="This page in Spanish">
+          </a></td>
           <!-- <td><a href="$$same_fr$$"><img src="$$imagedir$$/flags25x15/fr.png" border="0" width="25" height="15" alt="French" title="Cette page en fran&ccedil;ais"></a></td> -->
         </tr>
       </table>

Modified: homepage/input/navbar_de.html
===================================================================
--- homepage/input/navbar_de.html	2007-09-10 21:14:32 UTC (rev 879)
+++ homepage/input/navbar_de.html	2007-09-12 15:33:56 UTC (rev 880)
@@ -26,6 +26,10 @@
                 <img src="$$imagedir$$/flags25x15/ru.png" border="0" width="25"
                   height="15" alt="Russian" title="This page in Russian">
           </a></td>
+          <td><a href="$$same_es$$">
+                <img src="$$imagedir$$/flags25x15/es.png" border="0" width="25"
+                  height="15" alt="Spanish" title="This page in Spanish">
+          </a></td>
           <!-- <td><a href="$$same_fr$$"><img src="$$imagedir$$/flags25x15/fr.png" border="0" width="25" height="15" alt="French" title="Cette page en fran&ccedil;ais"></a></td> -->
         </tr>
       </table>

Modified: homepage/input/navbar_ru.html
===================================================================
--- homepage/input/navbar_ru.html	2007-09-10 21:14:32 UTC (rev 879)
+++ homepage/input/navbar_ru.html	2007-09-12 15:33:56 UTC (rev 880)
@@ -26,6 +26,10 @@
                 <img src="$$imagedir$$/flags25x15/ru.png" border="0" width="25"
                   height="15" alt="Russian" title="??? ???????? ?? ???????">
           </a></td>
+          <td><a href="$$same_es$$">
+                <img src="$$imagedir$$/flags25x15/es.png" border="0" width="25"
+                  height="15" alt="Spanish" title="This page in Spanish">
+          </a></td>
           <!-- <td><a href="$$same_fr$$"><img src="$$imagedir$$/flags25x15/fr.png" border="0" width="25" height="15" alt="French" title="Cette page en fran&ccedil;ais"></a></td> -->
         </tr>
       </table>

Modified: homepage/input/news/news_issue23_de.html
===================================================================
--- homepage/input/news/news_issue23_de.html	2007-09-10 21:14:32 UTC (rev 879)
+++ homepage/input/news/news_issue23_de.html	2007-09-12 15:33:56 UTC (rev 880)
@@ -1,13 +1,13 @@
 <h3 class="news">
-    <span class="date">Sep 9 2007: </span> Enigma 1.01 f&uuml;r 64-Bit
+    <span class="date">Sep 10 2007: </span> Enigma 1.01 f&uuml;r 64-Bit
     Linux-Versionen
 </h3>
 
 <p>Leider hat sich die in Enigma enthaltene zipios++ Library Version als
 inkompatibel zu 64-Bit herausgestellt. Weder Windows noch Mac OSX noch Debian
-basierte Compilationen sind von diesem Problem betroffen. Alle anderen Unix
-Systeme die direkt unsere Source Releases compilieren bieten wir eine
-&uuml;berarbeitetes Source Packet an, dass sowohl 32-Bit als auch 64-Bit
-Prozessoren gerecht wird. Bitte compilieren Sie das fehlerbereinigte Release
-&quot;Quellcode 32/64-Bit&quot; von unserer <a href="$$download$$#stable">
-Downloadseite</a>.</p>
+basierte Kompilationen sind von diesem Problem betroffen. F&uuml;r alle anderen
+Unix-Systeme, die direkt unsere Source-Releases kompilieren, bieten wir ein
+&uuml;berarbeitetes Source-Paket an, das sowohl 32-Bit als auch
+64-Bit-Prozessoren gerecht wird. Bitte kompilieren Sie das fehlerbereinigte
+Release &quot;Quellcode 32/64-Bit&quot; von unserer <a
+href="$$download$$#stable">Downloadseite</a>.</p>

Modified: homepage/input/news/news_issue23_en.html
===================================================================
--- homepage/input/news/news_issue23_en.html	2007-09-10 21:14:32 UTC (rev 879)
+++ homepage/input/news/news_issue23_en.html	2007-09-12 15:33:56 UTC (rev 880)
@@ -1,11 +1,11 @@
 <h3 class="news">
-    <span class="date">Sep 8 2007: </span> Enigma 1.01 for 64-bit Linux versions
+    <span class="date">Sep 10 2007: </span> Enigma 1.01 for 64-bit Linux versions
 </h3>
 
-<p>Unfortunatly the Enigma included zipios++ library version proved to be
+<p>Unfortunately the Enigma included zipios++ library version proved to be
 incompatible to 64 bit. Neither Windows nor Mac OSX nor Debian based compilations
 have been influenced by this problem. For all remaining Unix systems that compile
 directly from our released sources we provide an updated source package that fits
-32 bit as well as 64 bit processors. Please compile the bugfixed release 
+32-bit as well as 64-bit processors. Please compile the bugfixed release 
 &quot;Source Code 32/64-bit compatible&quot; from our <a href="$$download$$#stable">
 download section</a>.</p>

Modified: homepage/input/output-files.lua
===================================================================
--- homepage/input/output-files.lua	2007-09-10 21:14:32 UTC (rev 879)
+++ homepage/input/output-files.lua	2007-09-12 15:33:56 UTC (rev 880)
@@ -6,7 +6,7 @@
 newsdir = "input/news/"
 suffix = ".html"
 
-language_list = {"", "_de", "_ru"} -- "_fr"
+language_list = {"", "_de", "_ru", "_es"} -- "_fr"
 
 -- The newsfield declares the news (by number) to be shown on the main page.
 
@@ -28,10 +28,12 @@
     lang_de = "_de",
     lang_fr = "_fr",
     lang_ru = "_ru",
+    lang_es = "_es",
     title = "Enigma Homepage",
     title_de = "Enigma Hauptseite",
     --fr-- title_fr = "Enigma Homepage",
     title_ru = "???????? ???????? Enigma",
+    --sp-- title_es = "Enigma Homepage",
     refman = "manual/enigma-ref.html",
     manual = "manual/enigma.html",
     manual_de = "manual/enigma_de.html",
@@ -46,6 +48,7 @@
     same_de = function(v,s,l0)  return add_lang_to_filename(v.outfile, "_de")  end,
     same_fr = function(v,s,l0)  return add_lang_to_filename(v.outfile, "_fr")  end,
     same_ru = function(v,s,l0)  return add_lang_to_filename(v.outfile, "_ru")  end,
+    same_es = function(v,s,l0)  return add_lang_to_filename(v.outfile, "_es")  end,
     navbar = {"navbar"},
     leftcolumn = {"menu","validation"},
     rightcolumn = {},
@@ -76,6 +79,7 @@
     lotm_expansion = "Level of the Month",
     lotm_expansion_de = "Level des Monats",
     lotm_expansion_ru = "??????? ??????",
+    --es-- lotm_expansion_es = "",
 
     lotm_anchor_rating   = "<a href=\"$$lotm$$\">Rating</a>",
     lotm_anchor_month    = "<a href=\"$$lotm_chronological$$\">Month</a>",
@@ -127,6 +131,7 @@
     imagedir_de = "images",
     imagedir_fr = "images",
     imagedir_ru = "images",
+    imagedir_es = "images",
     lastupdate = "$Date$",
     lastauthor = "$Author$",
     lastrev = "$Rev$"



From ged at mail.berlios.de  Wed Sep 12 19:24:38 2007
From: ged at mail.berlios.de (ged at mail.berlios.de)
Date: Wed, 12 Sep 2007 19:24:38 +0200
Subject: [Enigma-game-svn] r881 - homepage/input/news
Message-ID: <200709121724.l8CHOcPL012170@sheep.berlios.de>

Author: ged
Date: 2007-09-12 19:24:17 +0200 (Wed, 12 Sep 2007)
New Revision: 881

Added:
   homepage/input/news/news_issue22_ru.html
   homepage/input/news/news_issue23_ru.html
Log:
Homepage: added 2 last news in Russian

Added: homepage/input/news/news_issue22_ru.html
===================================================================
--- homepage/input/news/news_issue22_ru.html	2007-09-12 15:33:56 UTC (rev 880)
+++ homepage/input/news/news_issue22_ru.html	2007-09-12 17:24:17 UTC (rev 881)
@@ -0,0 +1,7 @@
+<h3 class="news">
+    <span class="date">1 ???????? 2007: </span> ??????? ??????? ???????? ????????
+</h3>
+
+<p>???????? ???????? ?????? ????? ????????? ?????????? ?? ???????. ?????? ???????? 
+??? ??????? ???? ????? ????? ?? ?????? ????? ?
+??????? ?????? ????.</p>


Property changes on: homepage/input/news/news_issue22_ru.html
___________________________________________________________________
Name: svn:eol-style
   + native

Added: homepage/input/news/news_issue23_ru.html
===================================================================
--- homepage/input/news/news_issue23_ru.html	2007-09-12 15:33:56 UTC (rev 880)
+++ homepage/input/news/news_issue23_ru.html	2007-09-12 17:24:17 UTC (rev 881)
@@ -0,0 +1,11 @@
+<h3 class="news">
+    <span class="date">10 ???????? 2007: </span> Enigma 1.01 ??? 64-????????? ?????? Linux
+</h3>
+
+<p>? ????????? Enigma ???????? ?????? ?????????? zipios++, ??????? ?? ?????????? ? 
+64 ?????????. ?? Windows, ?? Mac OSX, ?? Debian-?????????? ??????
+?? ?????????? ???? ????????. ??? ???? ????????? ?????? Unix, ??????? ???????
+??????????????? ?? ?????????? ???? ???????? ?????, ?? ?????????? ??????????? ????? ???????? ?????, ??????? ????????? ? 
+64-?????????? ???????????? ??? ?? ?????? ??? ? ? 32-??????????. ?????????? ???????? ?????? ? ????????????? 
+&quot;????????????? ????????? ???? ? 32/64 ?????????&quot; ?? ?????? <a href="$$download$$#stable">
+??????? ????????</a>.</p>


Property changes on: homepage/input/news/news_issue23_ru.html
___________________________________________________________________
Name: svn:eol-style
   + native



From andreasl at mail.berlios.de  Fri Sep 14 17:11:51 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Fri, 14 Sep 2007 17:11:51 +0200
Subject: [Enigma-game-svn] r882 - trunk/doc/reference
Message-ID: <200709141511.l8EFBp4l032564@sheep.berlios.de>

Author: andreasl
Date: 2007-09-14 17:11:51 +0200 (Fri, 14 Sep 2007)
New Revision: 882

Modified:
   trunk/doc/reference/enigma-ref.texi
Log:
Reference Manual:
 - added st-camouflage_hole, _move and st-metal_hole
   (pointed out by Raoul)
 - it-dynamite creates it-crack2 on fl-ice and it-hollow on fl-space
   (pointed out by Harry)

Please, always update the refman as soon as you change the
game objects, otherwise it gets out-of-date in no time!


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2007-09-12 17:24:17 UTC (rev 881)
+++ trunk/doc/reference/enigma-ref.texi	2007-09-14 15:11:51 UTC (rev 882)
@@ -3657,9 +3657,16 @@
 @code{it-dynamite} can be ignited by dropping it, by lasers, fire,
 other explosions (@ref{it-blackbomb}, @ref{it-whitebomb}, other
 @code{it-dynamite} and @ref{st-bombs}).  While burning, it can't be
-picked up.  During explosion, it ignites neighboring items and leaves
-an @code{it-hollow} behind (see @ref{Hills and Hollows}).
+picked up.  During explosion (@code{it-explosion2}, see
+ at ref{System and Debug Items}), it ignites neighboring items and
+leaves an @code{it-hollow} behind (see @ref{Hills and Hollows}). On
+ at ref{fl-ice}, it creates @code{it-crack2} instead (see @ref{it-crack}).
 
+On @ref{fl-space}, dynamite is supposed to result in shards. This is
+not implemented yet: It creates @code{it-hollow} without explosion.
+Note that this and the exact implementation of explosions might change
+in future versions.
+
 @strong{Messages}
 
 @table @code
@@ -4445,6 +4452,8 @@
 st-brownie
 st-bumps
 st-camouflage
+st-camouflage_hole
+st-camouflage_move
 st-dummy
 st-fakeoxyd( blinking )
 st-glass
@@ -4461,6 +4470,7 @@
 st-marble_hole
 st-marble_move
 st-metal
+st-metal_hole
 st-redrock
 st-rock@{1..10@}
 st-rock[123]_hole



From raoul at mail.berlios.de  Sun Sep 16 23:58:43 2007
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sun, 16 Sep 2007 23:58:43 +0200
Subject: [Enigma-game-svn] r883 - in trunk/data: gfx32 gfx40
Message-ID: <200709162158.l8GLwhLu018266@sheep.berlios.de>

Author: raoul
Date: 2007-09-16 23:58:42 +0200 (Sun, 16 Sep 2007)
New Revision: 883

Modified:
   trunk/data/gfx32/fg-whiteball.png
   trunk/data/gfx40/fg-whiteball.png
Log:
-> Fixed flickering whiteball in gfx{32,40}


Modified: trunk/data/gfx32/fg-whiteball.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/fg-whiteball.png
===================================================================
(Binary files differ)



From andreasl at mail.berlios.de  Tue Sep 18 01:37:00 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Tue, 18 Sep 2007 01:37:00 +0200
Subject: [Enigma-game-svn] r884 - in trunk: data/levels/lib doc/reference src
Message-ID: <200709172337.l8HNb0F8028003@sheep.berlios.de>

Author: andreasl
Date: 2007-09-18 01:36:58 +0200 (Tue, 18 Sep 2007)
New Revision: 884

Modified:
   trunk/data/levels/lib/libsoko.xml
   trunk/doc/reference/enigma-ref.texi
   trunk/src/floors.cc
   trunk/src/floors.hh
   trunk/src/laser.cc
   trunk/src/laser.hh
   trunk/src/stones.cc
   trunk/src/stones.hh
   trunk/src/stones_complex.cc
   trunk/src/stones_internal.hh
   trunk/src/stones_simple.cc
   trunk/src/world.cc
   trunk/src/world.hh
Log:
Stone-Traits / Freeze Check:
 - added stone traits for many stones
 - to do this, added name-free constructors for ConnectiveStone
   and PhotoStone
 - replaced is_movable()-definitions by special traits for movable
   and irregular stones, is_movable() now evaluates these traits
 - C++ freeze check routines for stones
 - description in reference manual
 - typos in refman and libsoko
Note:
 - is_movable() does not check for conditions like "state == IDLE"
   anymore. These checks are to happen in actor_hit and on_impulse.
   This concerns stones with move-animations, like st-swap, st-pull
   and st-chess. However, most of them already checked their state
   twice, so is_movable() could be standardized without adaptions.
Todo:
 - more tests with irregular stones
 - replace libsoko's freeze check routines
 - maybe rename MOVABLE_* and FREEZEBIT_* constants, as
   MOVABLE_BREAKABLE and FREEZEBIT_STANDARD don't fit their
   meaning.


Modified: trunk/data/levels/lib/libsoko.xml
===================================================================
--- trunk/data/levels/lib/libsoko.xml	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/data/levels/lib/libsoko.xml	2007-09-17 23:36:58 UTC (rev 884)
@@ -44,7 +44,7 @@
 -- place spaces between stones/items.
 --
 -- The table might hold additional flags. Currently, only "white"
--- is implemented, which turns the marble and st-chess_knight white.
+-- is implemented, which turns the marble and chess-knights white.
 -- If an entry is missing, the corresponding entry from default_design
 -- will be used.
 --
@@ -637,14 +637,25 @@
   oxyd_shuffle()
 end
 
+-- The 75 first designs use the following boxes:
+--  st-block  ->  st-black, st-blocker, st-brake, st-laser, fl-swamp
+--  st-brownie  ->  st-coinslot, st-pull
+--  st-glass_move  ->  cherry
+--  st-greenbrown_move  ->  hole
+--  st-marble_move  ->  hole
+--  st-rock3_move  ->  *
+--  st-shogun  ->  st-shogun-m (not completely!)
+--  st-wood[-growing]  ->  fl-swamp
+
+
 ------------------------------------------------------------------------
 -- Main function
 ------------------------------------------------------------------------
 
--- create_sokoball creates a sokoball-level from the strinfg LEVEL.
+-- create_sokoball creates a sokoball-level from the string LEVEL.
 -- The design can be chosen by the DESIGN variable. This is either
 -- a number (see section "Designs") or a table with the correspondinfg
--- design entries. A missinfg entry will be interpreted as the entry
+-- design entries. A missing entry will be interpreted as the entry
 -- from default_design. If the DESIGN variable is omitted, a check-
 -- number is created from LEVEL which uniquely* determines a design
 -- from the design list. *Uniquely means: The design might change
@@ -715,6 +726,7 @@
         obj = set_element(x+dx, y+dy, chosen_design.box, default_design.box)
         if obj.st then
           enigma.SetAttrib(obj.st, "soko_kind", "box")
+--          enigma.SetAttrib(obj.st, "freeze_check", true)
         end
       end
       if (ch == "n") or (ch == "N") then

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/doc/reference/enigma-ref.texi	2007-09-17 23:36:58 UTC (rev 884)
@@ -2635,6 +2635,7 @@
 * Actors::                      
 * General object attributes::
 * The 1.0-Fire System::
+* Freeze Checking::
 * Differences between Compatibility Modes::
 @end menu
 
@@ -2675,6 +2676,8 @@
 Define horizontal and vertical flat forces on the floor. On
 @ref{fl-gradient}, @code{force_x} and @code{force_y} are additive to
 the gradient's standard force.
+ at item freeze_check
+See @ref{Freeze Checking}.
 @end table
 
 Attributes connected to @ref{The 1.0-Fire System} (all boolean):
@@ -4431,6 +4434,8 @@
 * st-yinyang::                  Yin-Yang Stones
 @end menu
 
+For the common stone attribute @code{freeze_check}, see @ref{Freeze Checking}.
+
 @node Stone List, Breakable Stones, Stones, Stones
 @subsection Stone List
 
@@ -4697,7 +4702,7 @@
 @item st-laserbreak
 laser, pyro
 @item st-rock3_movebreak
-hammer, pyro; this stone is movable
+hammer, pyro; this stone is movable by impulses (not actors)
 @item st-plain_break
 hammer, laser, pyro; falls into @ref{fl-abyss}
 @item st-plain_cracked
@@ -5996,6 +6001,11 @@
 
 Shogun stones don't ignite bombs when pushed over them.
 
+ at code{st-shogun-s} is handled differently in a @ref{Freeze Checking} than
+the other shogun stones. This allows to use @code{st-shogun-s} to use in a
+Sokoban and avoids false freeze checks when used together with other shogun
+stones (which are handled as non-existent during a freeze check).
+
 @strong{Attributes}
 
 @table @code
@@ -6607,7 +6617,7 @@
 
 
 @c ----------------------------------------------------------------------
- at node General object attributes,  , Actors, Objects
+ at node General object attributes, The 1.0-Fire System, Actors, Objects
 @section General object attributes
 
 @table @code
@@ -6617,7 +6627,7 @@
 @end table
 
 @c ----------------------------------------------------------------------
- at node The 1.0-Fire System,  , Actors, Objects
+ at node The 1.0-Fire System, Freeze Checking, General object attributes, Objects
 @section The 1.0-Fire System
 
 The 1.0-version of Enigma introduces a new fire system, making use of
@@ -6806,7 +6816,91 @@
 
 
 @c ----------------------------------------------------------------------
- at node Differences between Compatibility Modes,  , Actors, Objects
+ at node Freeze Checking, Differences between Compatibility Modes, The 1.0-Fire System, Objects
+ at section Freeze Checking
+
+With Enigma 1.1 and above, you can use a special feature to support Sokoban
+levels and Sokoban parts of levels: Whenever a movable stone is pushed into
+some unmovable position, this feature automatically transforms the stone into
+ at ref{st-death}, to demonstrate that the game is lost and provide a simple way
+for the player to restart.
+
+The feature is called ``Freeze Checking''. It applies to each stone with
+attribute @code{freeze_check = true} which is pushed onto a floor with
+attribute @code{freeze_check = true}. This way you can restrict the freeze
+check to a bounded area. For a true Sokoban the goal tiles should not be marked
+with @code{freeze_check = true}, as a frozen box on a goal is not considered
+harmful. On the other hand, you can specify which boxes are freeze-checked. This
+gives further freedom to use other stones inside your Sokoban area: Floor and
+stone both need the @code{freeze_check}-attribute activated.
+
+The freeze check recognizes three basic constellations of stones that lead to a
+freeze of a standard movable stone. With @code{B} as box (movable or
+persistent) and @code{#} as wall (persistent):
+ at example
+BB   #B   #B
+BB    #    B#
+ at end example
+There are more freeze constellations which are not recognized, the simplest
+would be:
+ at example
+#B
+ BB
+  #
+ at end example
+Don't rely on this fact, it might be changed in future versions.
+
+Please bear in mind: The freeze check is not intelligent. It can't foresee that
+one of your functions might remove a stone, it can't foresee that some door
+will never open up again (doors are considered as not existent), it doesn't
+recognize when you put an @ref{it-puller}, @ref{it-cherry}, or @ref{st-swap} in
+your level. It handles special stones in a way to minimize false-positive freeze
+checks.
+
+Floating stones (like @ref{st-grate}) create completely new frozen
+constellations. From the following two examples, only the right example is
+frozen (@code{G} is @code{st-grate1}):
+ at example
+G    G
+BB   BB
+GB   GBG
+ at end example
+At present, none of these are recognized as frozen by Enigma, floating stones
+are considered as not existing during a freeze check. To demonstrate the
+difficulty, you may analyze yourself which of the following constellations is
+frozen:
+ at example
+G      G      GBG   GB#    G G#G
+B#    BBB     BB    GB G   BBBBB
+G    #B B#   #B      G     G#G G
+      G G     G
+ at end example
+
+In some cases, stones are even handled differently although they have similar
+properties: @ref{st-wood} and @code{st-firebreak_move} (see
+ at ref{st-firebreak[_move]}) are both movable and both destroyed by fire (see
+ at ref{The 1.0-Fire System}). There would never be frozen stones, as they can
+easily be burned away. Yet, @code{st-wood} uses the default freeze checking,
+whereas @code{st-firebreak_move} is considered as not existing. This is because
+ at code{st-wood} is often used without fire, whereas @code{st-firebreak_move} is
+primarily used in combination with fire.
+
+Another example is @code{st-shogun-s}, which is considered as a default
+movable stone, in contrast to the remaining shogun stones (see
+ at ref{st-shogun-<sml>}). This way you can use @code{st-shogun-s} with goal
+ at code{it-shogun-s}, but don't have to fear false-positive freeze checks from
+the non-standard way in which shogun stones move.
+
+As a concluding remark, the freeze checking is to be used as a support for the
+gamer only. It's not meant to be exploited as special feature to make movable
+stones unmovable or to provide a way to jump back to the starting position. It
+is subject to changes in future versions. And versions before 1.1 won't make a
+freeze check at all - so you can't rely on it to happen. It should really be
+used in Sokoban-kind parts of a level only, for which it is designed.
+
+
+ at c ----------------------------------------------------------------------
+ at node Differences between Compatibility Modes,  , Freeze Checking, Objects
 @section Differences between Compatibility Modes
 
 Although Enigma was inspired by the original Oxyd-series, there are

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/src/floors.cc	2007-09-17 23:36:58 UTC (rev 884)
@@ -117,6 +117,11 @@
     return true;
 }
 
+bool Floor::is_freeze_check() const 
+{
+    return to_bool(this->getAttr("freeze_check"));
+}
+
 void Floor::set_model (const std::string &mname) 
 {
     display::SetModel (GridLoc(GRID_FLOOR, get_pos()), mname);

Modified: trunk/src/floors.hh
===================================================================
--- trunk/src/floors.hh	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/src/floors.hh	2007-09-17 23:36:58 UTC (rev 884)
@@ -107,6 +107,7 @@
 
         virtual void get_sink_speed (double &sinkspeed, double &raisespeed) const;
         virtual bool is_destructible() const;
+        virtual bool is_freeze_check() const;
 
         virtual void animcb();
         void on_burnable_animcb(bool justIgnited);  // Called by burnable-items on it.

Modified: trunk/src/laser.cc
===================================================================
--- trunk/src/laser.cc	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/src/laser.cc	2007-09-17 23:36:58 UTC (rev 884)
@@ -206,6 +206,11 @@
     illuminated = false;
 }
 
+PhotoStone::PhotoStone()
+{
+    illuminated = false;
+}
+
 void PhotoStone::on_recalc_start() 
 {}
 
@@ -449,7 +454,6 @@
         MirrorStone(const char *name, bool movable=false, bool transparent=false);
 
         bool is_transparent() const { return getAttr("transparent") != 0; }
-        bool is_movable() const { return getAttr("movable") != 0; }
 
         void set_orientation(int o) { set_attrib("orientation", o); }
         int get_orientation() { return getAttr("orientation"); }
@@ -464,6 +468,9 @@
 
         void init_model();
     private:
+
+        StoneTraits traits;
+
 	// Object interface.
         virtual Value message(const string &m, const Value &);
 
@@ -484,9 +491,11 @@
 
         // Private methods
         void rotate_right();
-
+        
+        const StoneTraits &get_traits() const { return traits; }
+        
         // Variables
-        DirectionBits outdirs;
+        DirectionBits outdirs;    
     };
 }
 
@@ -496,6 +505,12 @@
     set_attrib("transparent", transparent);
     set_attrib("movable", movable);
     set_attrib("orientation", Value(1));
+    traits.name = "INVALID";
+    traits.id = st_INVALID;
+    traits.flags = stf_none;
+    traits.material = material_stone;
+    traits.restitution = 1.0;
+    traits.movable = movable ? MOVABLE_STANDARD : MOVABLE_PERSISTENT;
 }
 
 void MirrorStone::init_model() {
@@ -565,7 +580,6 @@
     sound_event ("mirrorturn");
 }
 
-
 
 /* -------------------- Plane Mirror -------------------- */
 namespace

Modified: trunk/src/laser.hh
===================================================================
--- trunk/src/laser.hh	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/src/laser.hh	2007-09-17 23:36:58 UTC (rev 884)
@@ -87,7 +87,8 @@
 
     class PhotoStone : public Stone, public PhotoCell {
     protected:
-        PhotoStone (const char *kind);
+        PhotoStone();
+        PhotoStone(const char *kind);
 
     private:
         bool illuminated;

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/src/stones.cc	2007-09-17 23:36:58 UTC (rev 884)
@@ -109,10 +109,11 @@
 */
 
 Stone::Stone()
+: freeze_check_running (false)
 {}
 
 Stone::Stone(const char * kind)
-: GridObject (kind)
+: GridObject (kind), freeze_check_running (false)
 {}
 
 Stone::~Stone() { revokeDelayedImpulses(this); }
@@ -120,7 +121,7 @@
 const StoneTraits &Stone::get_traits() const
 {
     static StoneTraits default_traits = {
-        "INVALID", st_INVALID, stf_none, material_stone, 1.0
+        "INVALID", st_INVALID, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT
     };
     return default_traits;
 }
@@ -202,6 +203,91 @@
     return newvel * factor;
 }
 
+/* -------------------- Freeze check routines -------------------- */
+
+FreezeStatusBits Stone::get_freeze_bits() {
+    if(is_floating())
+        return FREEZEBIT_HOLLOW;
+    switch(get_traits().movable) {
+        case MOVABLE_PERSISTENT:  return FREEZEBIT_PERSISTENT;
+        case MOVABLE_BREAKABLE:   return FREEZEBIT_NO_STONE;
+        case MOVABLE_STANDARD:    return FREEZEBIT_STANDARD;
+        default:                  return FREEZEBIT_IRREGULAR;
+    }
+}
+
+FreezeStatusBits Stone::get_freeze_bits(GridPos p) {
+    Stone *st = GetStone(p);
+    if(st == NULL) 
+        return FREEZEBIT_NO_STONE;
+    return st->get_freeze_bits();
+}
+
+bool Stone::freeze_check() {
+    // Check if stone and floor ask for freeze_check
+    if (!to_bool(this->getAttr("freeze_check")))
+        return false;
+    if (freeze_check_running)
+        return true;
+    GridPos this_pos = this->get_pos();
+    Floor *fl = GetFloor(this_pos);
+    if ((fl == NULL) || (!fl->is_freeze_check()))
+        return false;
+
+    // Query movable status of neighboring stones
+
+    FreezeStatusBits ms_n  = get_freeze_bits(move(this_pos, NORTH));
+    FreezeStatusBits ms_nw = get_freeze_bits(move(move(this_pos, NORTH), WEST));
+    FreezeStatusBits ms_ne = get_freeze_bits(move(move(this_pos, NORTH), EAST));
+    FreezeStatusBits ms_w  = get_freeze_bits(move(this_pos, WEST));
+    FreezeStatusBits ms_e  = get_freeze_bits(move(this_pos, EAST));
+    FreezeStatusBits ms_s  = get_freeze_bits(move(this_pos, SOUTH));
+    FreezeStatusBits ms_sw = get_freeze_bits(move(move(this_pos, SOUTH), WEST));
+    FreezeStatusBits ms_se = get_freeze_bits(move(move(this_pos, SOUTH), EAST));
+
+    // First check: Diagonals with persistent stones
+    // Second check: Squares of arbitrary stones
+    // Third check: Two movables, encased by two persistent
+    int p = FREEZEBIT_PERSISTENT;
+    int pm = FREEZEBIT_PERSISTENT | FREEZEBIT_STANDARD;
+    if(   ((ms_n & p) && (ms_e & p))
+       || ((ms_n & p) && (ms_w & p))
+       || ((ms_s & p) && (ms_e & p))
+       || ((ms_s & p) && (ms_w & p))
+       
+       || ((ms_n & pm) && (ms_nw & pm) && (ms_w & pm))
+       || ((ms_n & pm) && (ms_ne & pm) && (ms_e & pm))
+       || ((ms_s & pm) && (ms_sw & pm) && (ms_w & pm))
+       || ((ms_s & pm) && (ms_se & pm) && (ms_e & pm))
+       
+       || ((ms_n & pm) && (ms_e & p) && (ms_nw & p))
+       || ((ms_n & pm) && (ms_w & p) && (ms_ne & p))
+       || ((ms_s & pm) && (ms_e & p) && (ms_sw & p))
+       || ((ms_s & pm) && (ms_w & p) && (ms_se & p))
+       || ((ms_w & pm) && (ms_n & p) && (ms_sw & p))
+       || ((ms_w & pm) && (ms_s & p) && (ms_nw & p))
+       || ((ms_e & pm) && (ms_n & p) && (ms_se & p))
+       || ((ms_e & pm) && (ms_s & p) && (ms_ne & p)))
+    {
+        ReplaceStone(this_pos, MakeStone("st-death"));
+        // recheck neighboring stones
+        // avoid endless loop with bool freeze_check_running
+        if (Stone *st = GetStone(this_pos))
+            st->freeze_check_running = true;
+        if (Stone *st = GetStone(move(this_pos, NORTH)))
+            st->freeze_check();
+        if (Stone *st = GetStone(move(this_pos, SOUTH)))
+            st->freeze_check();
+        if (Stone *st = GetStone(move(this_pos, EAST)))
+            st->freeze_check();
+        if (Stone *st = GetStone(move(this_pos, WEST)))
+            st->freeze_check();
+        if (Stone *st = GetStone(this_pos))
+            st->freeze_check_running = false;
+    }
+}
+
+
 
 
 // *******************************************************************************
@@ -214,6 +300,7 @@
 {
     class ExplosionStone : public Stone {
         CLONEOBJ(ExplosionStone);
+        DECL_TRAITS;
 
         StoneResponse collision_response(const StoneContact &) {
             return STONE_PASS;
@@ -229,10 +316,12 @@
         void animcb() {
             KillStone(get_pos());
         }
+
     public:
-        ExplosionStone(): Stone("st-explosion")
+        ExplosionStone()
         {}
     };
+    DEF_TRAITSM(ExplosionStone, "st-explosion", st_explosion, MOVABLE_BREAKABLE);
 }
 
 
@@ -375,8 +464,9 @@
        knows... */
     class Peroxyd_0xb8 : public Stone {
         CLONEOBJ(Peroxyd_0xb8);
+        DECL_TRAITS;
     public:
-        Peroxyd_0xb8() : Stone("st-peroxyd-0xb8")
+        Peroxyd_0xb8()
         {}
 
         void on_creation (GridPos p) {
@@ -384,11 +474,13 @@
             KillStone(p);
         }
     };
-
+    DEF_TRAITSM(Peroxyd_0xb8, "st-peroxyd-0xb8", st_peroxyd_0xb8, MOVABLE_BREAKABLE);
+    
     class Peroxyd_0xb9 : public Stone {
         CLONEOBJ(Peroxyd_0xb9);
+        DECL_TRAITS;
     public:
-        Peroxyd_0xb9() : Stone("st-peroxyd-0xb9")
+        Peroxyd_0xb9()
         {}
 
         void on_creation (GridPos p) {
@@ -396,16 +488,20 @@
             KillStone(p);
         }
     };
-
+    DEF_TRAITSM(Peroxyd_0xb9, "st-peroxyd-0xb9", st_peroxyd_0xb9, MOVABLE_BREAKABLE);
+    
     class Oxyd_0x18 : public Stone {
         CLONEOBJ(Oxyd_0x18);
+        DECL_TRAITS;
     public:
-        Oxyd_0x18() : Stone("st-oxyd-0x18") {
-        }
+        Oxyd_0x18()
+        {}
+        
         void on_creation (GridPos p) {
             KillStone (p);
         }
     };
+    DEF_TRAITSM(Oxyd_0x18, "st-oxyd-0x18", st_oxyd_0x18, MOVABLE_BREAKABLE);
 }
 
 
@@ -433,8 +529,9 @@
 {
     class SurpriseStone : public Stone {
         CLONEOBJ (SurpriseStone);
+        DECL_TRAITS;
     public:
-        SurpriseStone() : Stone("st-surprise")
+        SurpriseStone()
         {}
 
         void actor_hit (const StoneContact &) {
@@ -453,7 +550,10 @@
             sound_event ("stonetransform");
             ReplaceStone (get_pos(), MakeStone (stonename[idx]));
         }
+    private:
+        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_IRREGULAR; }
     };
+    DEF_TRAITS(SurpriseStone, "st-surprise", st_surprise);
 }
 
 
@@ -462,15 +562,19 @@
 {
     class CoffeeStone : public Stone {
         CLONEOBJ(CoffeeStone);
+        DECL_TRAITS;
     public:
-        CoffeeStone() : Stone ("st-coffee") {
-        }
+        CoffeeStone()
+        {}
 
         void actor_hit (const StoneContact &) {
             sound_event ("stonetransform");
             ReplaceStone(get_pos(), MakeStone("st-glass_move"));
         }
+    private:
+        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_STANDARD; }
     };
+    DEF_TRAITS(CoffeeStone, "st-coffee", st_coffee);
 }
 
 
@@ -479,6 +583,7 @@
 {
     class BreakingStone : public Stone {
         CLONEOBJ(BreakingStone);
+        DECL_TRAITS;
 
         void init_model() {
             sound_event("stonedestroy");
@@ -489,9 +594,10 @@
             KillStone(get_pos());
         }
     public:
-        BreakingStone() : Stone("st-breaking") {
-        }
+        BreakingStone()
+        {}
     };
+    DEF_TRAITSM(BreakingStone, "st-breaking", st_breaking, MOVABLE_BREAKABLE);
 }
 
 
@@ -500,9 +606,10 @@
 {
     class BugStone : public Stone {
         CLONEOBJ(BugStone);
+        DECL_TRAITS;
     public:
-        BugStone() : Stone("st-bug") {
-        }
+        BugStone()
+        {}
 
         void actor_hit (const StoneContact &sc) {
             if (get_id(sc.actor) == ac_bug) {
@@ -510,6 +617,7 @@
             }
         }
     };
+    DEF_TRAITSM(BugStone, "st-bug", st_bug, MOVABLE_BREAKABLE);
 }
 
 
@@ -521,8 +629,8 @@
 {
     class PlainStone : public Stone {
         CLONEOBJ(PlainStone);
+        DECL_TRAITS;
 
-
         void on_laserhit (Direction) {
             ReplaceStone (get_pos(), MakeStone("st-plain_cracked"));
         }
@@ -548,11 +656,16 @@
                 Stone::actor_hit(sc);
         }
     public:
-        PlainStone() : Stone("st-plain") {}
+        PlainStone()
+        {}
+    private:
+        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_PERSISTENT; }
     };
-
+    DEF_TRAITSM(PlainStone, "st-plain", st_plain, MOVABLE_BREAKABLE);
+    
     class PlainStone_Hollow : public Stone {
         CLONEOBJ(PlainStone_Hollow);
+        DECL_TRAITS;
 
         virtual Value message (const string &msg, const Value &) {
             if (msg == "trigger" || msg == "signal") {
@@ -566,12 +679,14 @@
 
         bool is_floating() const { return true; }
     public:
-        PlainStone_Hollow() : Stone("st-plain_hole") {
-        }
+        PlainStone_Hollow()
+        {}
     };
+    DEF_TRAITSM(PlainStone_Hollow, "st-plain_hole", st_plain_hole, MOVABLE_PERSISTENT);
 
     class PlainStone_Breaking : public Stone {
         CLONEOBJ(PlainStone_Breaking);
+        DECL_TRAITS;
 
         void init_model() {
             set_anim("st-plain_breaking");
@@ -581,12 +696,15 @@
         }
         const char *collision_sound() {return "metal";}
     public:
-        PlainStone_Breaking() : Stone ("st-plain_breaking") {
-        }
+        PlainStone_Breaking()
+        {}
     };
-
+    DEF_TRAITSM(PlainStone_Breaking, "st-plain_breaking", st_plain_breaking,
+                MOVABLE_BREAKABLE);
+    
     class PlainStone_Breakable : public Stone {
         CLONEOBJ(PlainStone_Breakable);
+        DECL_TRAITS;
 
         const char *collision_sound() {return "metal";}
 
@@ -615,12 +733,15 @@
         }
 
     public:
-        PlainStone_Breakable() : Stone("st-plain_break") {
-        }
+        PlainStone_Breakable()
+        {}
     };
-
+    DEF_TRAITSM(PlainStone_Breakable, "st-plain_break", st_plain_break,
+                MOVABLE_BREAKABLE);
+    
     class PlainStone_Cracked : public Stone {
         CLONEOBJ(PlainStone_Cracked);
+        DECL_TRAITS;
 
         void break_me() {
             sound_event ("stonedestroy");
@@ -640,12 +761,15 @@
         }
         const char *collision_sound() {return "metal";}
     public:
-        PlainStone_Cracked() : Stone("st-plain_cracked") {
-        }
+        PlainStone_Cracked()
+        {}
     };
-
+    DEF_TRAITSM(PlainStone_Cracked, "st-plain_cracked", st_plain_cracked,
+                MOVABLE_BREAKABLE);
+    
     class PlainStone_Falling : public Stone {
         CLONEOBJ(PlainStone_Falling);
+        DECL_TRAITS;
 
         void init_model() {
             set_anim("st-plain_falling");
@@ -656,12 +780,15 @@
             KillStone(get_pos());
         }
     public:
-        PlainStone_Falling() : Stone("st-plain_falling") {
-        }
+        PlainStone_Falling()
+        {}
     };
+    DEF_TRAITSM(PlainStone_Falling, "st-plain_falling", st_plain_falling,
+                MOVABLE_BREAKABLE);
 
     class PlainStone_Movable : public Stone {
         CLONEOBJ(PlainStone_Movable);
+        DECL_TRAITS;
 
         void break_me() {
             sound_event ("stonedestroy");
@@ -687,8 +814,6 @@
             }
         }
 
-        bool is_movable () const { return true; }
-
         void actor_hit (const StoneContact &sc) {
             if (player::WieldedItemIs (sc.actor, "it-pencil")) {
                 enigma::Inventory *inv = player::GetInventory(sc.actor);
@@ -703,9 +828,11 @@
         }
 
     public:
-        PlainStone_Movable() : Stone("st-plain_move") {
-        }
+        PlainStone_Movable()
+        {}
     };
+    DEF_TRAITSM(PlainStone_Movable, "st-plain_move", st_plain_move,
+                MOVABLE_STANDARD);
 }
 
 
@@ -778,16 +905,19 @@
 {
     class FakeOxydA : public Stone {
         CLONEOBJ(FakeOxydA);
+        DECL_TRAITS;
     public:
+        FakeOxydA()
+        {}
 
-        FakeOxydA() : Stone("st-fakeoxyda") {
-        }
-
         void actor_hit (const StoneContact &) {
             sound_event ("stonetransform");
             ReplaceStone(get_pos(), MakeStone("st-glass1_move"));
         }
+    private:
+        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_STANDARD; }
     };
+    DEF_TRAITS(FakeOxydA, "st-fakeoxyda", st_fakeoxyda);
 }
 
 

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/src/stones.hh	2007-09-17 23:36:58 UTC (rev 884)
@@ -35,24 +35,73 @@
         st_black2,
         st_black3,
         st_black4,
+        st_block,
+        st_bolder,
+        st_brake,
+        st_break_acblack,
+        st_break_acwhite,
+        st_break_bolder,
+        st_break_invisible,
+        st_breaking,
+        st_bug,
         st_chameleon,
+        st_chess,
+        st_coffee,
         st_death,
         st_death_invisible,
         st_easymode,
+        st_explosion,
+        st_fakeoxyda,
         st_fart,
+        st_firebreak,
+        st_firebreak_move,
+        st_greenbrown_growing,
         st_knight,
+        st_laserbreak,
         st_magic,
+        st_movebreak,
+        st_oneway,
+        st_oneway_black,
+        st_oneway_white,
+        st_oxyd_0x18,
+        st_peroxyd_0xb8,
+        st_peroxyd_0xb9,
+        st_plain,
+        st_plain_break,
+        st_plain_breaking,
+        st_plain_cracked,
+        st_plain_falling,
+        st_plain_hole,
+        st_plain_move,
+        st_pull,
+        st_puzzle,
+        st_rotator,
         st_rubberband,
         st_scissors,
+        st_shogun,
+        st_stoneimpulse,
+        st_stoneimpulse_hollow,
+        st_stoneimpulse_movable,
+        st_surprise,
+        st_swap,
         st_thief,
+        st_turnstile,
+        st_turnstile_e,
+        st_turnstile_green,
+        st_turnstile_n,
+        st_turnstile_s,
+        st_turnstile_w,
+        st_volcano,
         st_white1,
         st_white2,
         st_white3,
         st_white4,
         st_window,
+        st_wood_growing,
         st_lightpassenger,
         st_camouflage,
         st_polarswitch,
+        st_volcano_growing,
 
         st_LAST,
         st_COUNT = st_LAST
@@ -73,12 +122,20 @@
         material_LAST
     };
 
+    enum StoneMovableStatus {
+        MOVABLE_PERSISTENT, // Stone is unmovable
+        MOVABLE_BREAKABLE,  // Stone is breakable
+        MOVABLE_STANDARD,   // Stone is movable in st-wood-way
+        MOVABLE_IRREGULAR   // Stone moves in non-standard way
+    };        
+
     struct StoneTraits {
-        const char *name;
-        StoneID     id;
-        int         flags;
-        Material    material;
-        double      restitution;
+        const char         *name;
+        StoneID             id;
+        int                 flags;
+        Material            material;
+        double              restitution;
+        StoneMovableStatus  movable;
         // Note that many properties of stones are implemented as functions.
     };
 
@@ -88,6 +145,15 @@
         STONE_REBOUND           // Actor bounces off the stone
     };
 
+    /*! Combined status bits, used in the freeze check routines. */
+    enum FreezeStatusBits {
+        FREEZEBIT_NO_STONE   =  1, // Stone is NULL or easily breakable
+        FREEZEBIT_HOLLOW     =  2, // Stone is hollow (no cherry)
+        FREEZEBIT_PERSISTENT =  4, // Stone is unmovable
+        FREEZEBIT_STANDARD   =  8, // Stone is movable in st-wood-way
+        FREEZEBIT_IRREGULAR  = 16  // Stone moves in non-standard way
+    };
+        
     class Stone : public GridObject {
     public:
         Stone();
@@ -110,7 +176,9 @@
         virtual StoneResponse collision_response(const StoneContact &sc);
 
         /*! Is this stone movable? Affects impulse-stones, fire, ordinary pushes... */
-        virtual bool   is_movable() const { return false;}
+        virtual bool   is_movable() const {
+            return get_traits().movable >= MOVABLE_STANDARD;
+        }
 
         /*! Can a swap-stone or pull-stone swap this stone? */
         virtual bool   is_removable() const { return true; }
@@ -135,6 +203,8 @@
         virtual void   actor_inside (Actor * /*a*/) {}
         virtual void   actor_contact (Actor * /*a*/) {}
 
+        virtual bool   freeze_check();
+        
         virtual void   on_move();
         virtual void   on_floor_change() {}
         virtual void   on_impulse(const Impulse& impulse);
@@ -157,6 +227,12 @@
         virtual void kill_model (GridPos p) {
             display::KillModel (GridLoc (GRID_STONES, p));
         }
+
+    private:
+        // Help structure and routine for freeze_check()
+        bool freeze_check_running;
+        virtual FreezeStatusBits get_freeze_bits();  // own freeze bits
+        virtual FreezeStatusBits get_freeze_bits(GridPos p);  // foreign freeze bits
     };
 
     inline StoneID get_id(Stone *st) {

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/src/stones_complex.cc	2007-09-17 23:36:58 UTC (rev 884)
@@ -43,8 +43,15 @@
     class RotatorStone : public PhotoStone {
     public:
         RotatorStone(bool clockwise_, bool movable_)
-        : PhotoStone("st-rotator"), clockwise(clockwise_), movable(movable_)
-        {}
+        : clockwise(clockwise_), movable(movable_)
+        {
+            traits.name = "st-rotator";
+            traits.id = st_rotator;
+            traits.flags = stf_none;
+            traits.material = material_stone;
+            traits.restitution = 1.0;
+            traits.movable = movable_ ? MOVABLE_STANDARD : MOVABLE_PERSISTENT;
+        }
 
     private:
         static const double RATE;
@@ -52,6 +59,7 @@
 
         bool clockwise;
         bool movable;
+        StoneTraits traits;
 
         Stone *clone() { return new RotatorStone(clockwise, movable); }
         void dispose() { delete this; }
@@ -91,8 +99,6 @@
             send_impulses();
         }
 
-        bool is_movable () const { return movable; }
-
         void actor_hit (const StoneContact &sc) {
             if (player::WieldedItemIs (sc.actor, "it-wrench")) {
                 clockwise = !clockwise;
@@ -114,8 +120,16 @@
             init_model();
         }
         void notify_laseroff() {}
+
+        const StoneTraits &get_traits() const
+        {
+            return traits;
+        }
+
+    private:
+        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_IRREGULAR; }    
     };
-
+    
     const double RotatorStone::RATE          = 1.0;
     const double RotatorStone::IMPULSE_DELAY = 0.1;
 }
@@ -163,6 +177,7 @@
 
 
     class PullStone : public Stone, public TimeHandler {
+        DECL_TRAITS;
         // Variables.
         enum State { IDLE, MOVING, VANISHED } state;
         Direction  m_movedir;
@@ -178,9 +193,6 @@
         void       dispose();
         
         // Stone interface.
-        bool is_movable () const {
-            return state == IDLE;
-        }
         void actor_hit(const StoneContact &sc) {
             if (state == IDLE)
                 maybe_push_stone(sc);
@@ -198,10 +210,11 @@
         void set_move_state(bool appearing, Direction move_dir);
 
     };
+    DEF_TRAITSM(PullStone, "st-pull", st_pull, MOVABLE_IRREGULAR);    
 }
 
 PullStone::PullStone()
-: Stone("st-pull"), state(IDLE), m_movedir(NODIR) , pull_info(0)
+: state(IDLE), m_movedir(NODIR) , pull_info(0)
 {}
 
 PullStone::~PullStone() {
@@ -334,7 +347,7 @@
 {
     class OneWayBase : public Stone {
     protected:
-        OneWayBase(const char *kind, Direction dir);
+        OneWayBase(Direction dir);
 
         void init_model();
         virtual Value message(const string& msg, const Value &val);
@@ -355,19 +368,21 @@
 
     class OneWayStone : public OneWayBase {
     public:
-        OneWayStone(Direction dir=SOUTH) : OneWayBase("st-oneway", dir) {}
+        OneWayStone(Direction dir=SOUTH) : OneWayBase(dir) {}
     private:
         CLONEOBJ(OneWayStone);
+        DECL_TRAITS;
         virtual bool actor_may_pass (Actor * /*a*/) { return true; }
     };
+    DEF_TRAITS(OneWayStone, "st-oneway", st_oneway);
 
-
     class OneWayStone_black : public OneWayBase {
     public:
         OneWayStone_black(Direction dir=SOUTH)
-            : OneWayBase("st-oneway_black",dir) {}
+            : OneWayBase(dir) {}
     private:
         CLONEOBJ(OneWayStone_black);
+        DECL_TRAITS;
         virtual bool actor_may_pass (Actor *a) {
             return a->getAttr("blackball") != 0;
         }
@@ -375,13 +390,15 @@
             // do nothing if hit by actor
         }
     };
+    DEF_TRAITS(OneWayStone_black, "st-oneway_black", st_oneway_black);
 
     class OneWayStone_white : public OneWayBase {
     public:
         OneWayStone_white(Direction dir=SOUTH)
-            : OneWayBase("st-oneway_white", dir) {}
+            : OneWayBase(dir) {}
     private:
         CLONEOBJ(OneWayStone_white);
+        DECL_TRAITS;
         virtual bool actor_may_pass (Actor *a) {
             return a->getAttr("whiteball") != 0;
         }
@@ -389,10 +406,10 @@
             // do nothing if hit by actor
         }
     };
+    DEF_TRAITS(OneWayStone_white, "st-oneway_white", st_oneway_white);
 }
 
-OneWayBase::OneWayBase(const char *kind, Direction dir) 
-: Stone(kind)
+OneWayBase::OneWayBase(Direction dir)
 {
     set_orientation(dir);
 }
@@ -457,9 +474,10 @@
 {
     class BolderStone : public Stone {
         CLONEOBJ(BolderStone);
+        DECL_TRAITS;
     public:
         BolderStone(Direction dir=NORTH)
-        : Stone("st-bolder"), state(IDLE)
+        : state(IDLE)
         {
             set_attrib("direction", dir);
             // do not use set_dir, because this will set the state to ACTIVE
@@ -545,9 +563,10 @@
             }
         }
 
-        bool is_movable() const { return state != FALLING; }
+        void actor_hit(const StoneContact &sc) {
+            if (state == FALLING)
+                return;
 
-        void actor_hit(const StoneContact &sc) {
             if (player::WieldedItemIs (sc.actor, "it-magicwand")) {
                 set_dir(reverse(get_dir()));
                 init_model();
@@ -581,6 +600,7 @@
             return Value();
         }
     };
+    DEF_TRAITSM(BolderStone, "st-bolder", st_bolder, MOVABLE_IRREGULAR);
 }
 
 
@@ -597,6 +617,7 @@
 {
     class BlockerStone : public Stone {
         CLONEOBJ(BlockerStone);
+        DECL_TRAITS;
     public:
         BlockerStone(bool solid)
         : Stone(solid ? "st-blocker" : "st-blocker-growing"), 
@@ -704,6 +725,7 @@
             }
         }
     };
+    DEF_TRAITSM(BlockerStone, "INVALID", st_INVALID, MOVABLE_BREAKABLE);
 }
 
 
@@ -712,9 +734,10 @@
 {
     class VolcanoStone : public Stone {
         CLONEOBJ(VolcanoStone);
+        DECL_TRAITS;
     public:
         enum State {INACTIVE, ACTIVE, FINISHED, BREAKING};
-        VolcanoStone( State initstate=INACTIVE) : Stone("st-volcano"), state( initstate) {}
+        VolcanoStone( State initstate=INACTIVE) : state( initstate) {}
     private:
         enum State state;
 
@@ -773,6 +796,7 @@
             }
         }
     };
+    DEF_TRAITSM(VolcanoStone, "st-volcano", st_volcano, MOVABLE_BREAKABLE);    
 }
 
 
@@ -886,7 +910,7 @@
         }
 
     public:
-        Window(int connections) : ConnectiveStone("st-window", connections),
+        Window(int connections) : ConnectiveStone(connections),
                 state(IDLE), breakingFaces(NODIRBIT) {
         }
         virtual bool is_sticky(const Actor *a) const;
@@ -896,7 +920,7 @@
         DirectionBits breakingFaces;
         bool tryInnerPull(Direction dir);
     };
-    DEF_TRAITS(Window, "st-window", st_window);
+    DEF_TRAITSM(Window, "st-window", st_window, MOVABLE_BREAKABLE);
 
     bool Window::is_sticky(const Actor *a) const  {
         return false;
@@ -1010,6 +1034,7 @@
 {
     class PuzzleStone : public ConnectiveStone, public TimeHandler, public world::PhotoCell {
         INSTANCELISTOBJ(PuzzleStone);
+        DECL_TRAITS;
     public:
         PuzzleStone(int connections, bool oxyd1_compatible_);  
     protected:
@@ -1076,12 +1101,13 @@
         enum { IDLE, EXPLODING } state;
         DirectionBits illumination; // last state of surrounding laser beams
     };
+    DEF_TRAITSM(PuzzleStone, "st-puzzle", st_puzzle, MOVABLE_IRREGULAR);
 }
 
 PuzzleStone::InstanceList PuzzleStone::instances;
 
 PuzzleStone::PuzzleStone(int connections, bool oxyd1_compatible_)
-: ConnectiveStone("st-puzzle", connections), 
+: ConnectiveStone(connections), 
   state (IDLE), 
   illumination (NODIRBIT)
 {
@@ -1644,6 +1670,9 @@
 
         virtual bool is_sticky (const Actor *) const
         { return false; }
+
+    private:
+        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_NO_STONE; }   
     };
 }
 
@@ -1816,13 +1845,14 @@
 {
     class ShogunStone : public Stone {
         CLONEOBJ(ShogunStone);
+        DECL_TRAITS;
 
         enum Holes { SMALL = 1, MEDIUM = 2, LARGE = 4};
         static Holes smallest_hole(Holes s);
         void set_holes(Holes h) { set_attrib("holes", h); }
 
     public:
-        ShogunStone(int holes=SMALL) : Stone("st-shogun") {
+        ShogunStone(int holes=SMALL) {
             set_holes(static_cast<Holes>(holes));
         }
     private:
@@ -1853,12 +1883,15 @@
             set_model(ecl::strf("st-shogun%d", int(get_holes())));
         }
 
-        bool is_movable() const { return false; }
-
         void actor_hit (const StoneContact &sc) {
             maybe_push_stone (sc);
         }
+
+        FreezeStatusBits get_freeze_bits() {
+            return (get_holes() == SMALL) ? FREEZEBIT_STANDARD : FREEZEBIT_NO_STONE;
+        }
     };
+    DEF_TRAITSM(ShogunStone, "st-shogun", st_shogun, MOVABLE_IRREGULAR);
 }
 
 ShogunStone::Holes ShogunStone::get_holes() const {
@@ -1955,7 +1988,7 @@
 {
     class StoneImpulse_Base : public Stone {
     protected:
-        StoneImpulse_Base(const char *kind) : Stone(kind), state(IDLE), incoming(NODIR)
+        StoneImpulse_Base() : state(IDLE), incoming(NODIR)
         {}
 
         enum State { IDLE, PULSING, CLOSING };
@@ -1999,8 +2032,9 @@
             incoming = dir;
             change_state(PULSING);
         }
+
+        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_NO_STONE; }
     };
-
 }
 
 void StoneImpulse_Base::change_state(State new_state) {
@@ -2054,8 +2088,9 @@
 {
     class StoneImpulseStone : public StoneImpulse_Base {
         CLONEOBJ(StoneImpulseStone);
+        DECL_TRAITS;
     public:
-        StoneImpulseStone() : StoneImpulse_Base("st-stoneimpulse")
+        StoneImpulseStone()
         {}
 
     private:
@@ -2076,15 +2111,15 @@
         void actor_hit(const StoneContact &/*sc*/) {
             change_state(PULSING);
         }
-
     };
+    DEF_TRAITS(StoneImpulseStone, "st-stoneimpulse", st_stoneimpulse);
 
-
     class HollowStoneImpulseStone : public StoneImpulse_Base {
         CLONEOBJ(HollowStoneImpulseStone);
+        DECL_TRAITS;
     public:
         HollowStoneImpulseStone()
-        : StoneImpulse_Base("st-stoneimpulse-hollow") {}
+        {}
     private:
         void notify_state(State st) {
             switch (st) {
@@ -2118,16 +2153,16 @@
             // hollow StoneImpulseStones cannot be activated using lasers
         }
     };
+    DEF_TRAITS(HollowStoneImpulseStone, "st-stoneimpulse-hollow",
+               st_stoneimpulse_hollow);
 
-
     class MovableImpulseStone : public StoneImpulse_Base {
         CLONEOBJ(MovableImpulseStone);
+        DECL_TRAITS;
     public:
         MovableImpulseStone()
-        : StoneImpulse_Base("st-stoneimpulse_movable"), 
-          repulse(false)
-        {
-        }
+        : repulse(false)
+        {}
 
     private:
 
@@ -2194,6 +2229,8 @@
         // Variables.
         bool repulse;
     };
+    DEF_TRAITSM(MovableImpulseStone, "st-stoneimpulse_movable",
+                st_stoneimpulse_movable, MOVABLE_STANDARD);
 }
 
 
@@ -2477,7 +2514,7 @@
     */
     class Turnstile_Pivot_Base : public Stone {
     public:
-        Turnstile_Pivot_Base(const char *kind);
+        Turnstile_Pivot_Base();
 
     protected:
         bool rotate(bool clockwise, Object *impulse_sender);
@@ -2508,23 +2545,27 @@
 
     class Turnstile_Pivot : public Turnstile_Pivot_Base {
         CLONEOBJ(Turnstile_Pivot);
+        DECL_TRAITS;
     public:
-        Turnstile_Pivot() : Turnstile_Pivot_Base(model()) {}
+        Turnstile_Pivot() {}
 
         const char *model() const { return "st-turnstile"; }
         const char *anim() const  { return "st-turnstile-anim"; }
         bool oxyd_compatible() const { return true; }
     };
+    DEF_TRAITS(Turnstile_Pivot, "st-turnstile", st_turnstile);
 
     class Turnstile_Pivot_Green : public Turnstile_Pivot_Base {
         CLONEOBJ(Turnstile_Pivot_Green);
+        DECL_TRAITS;
     public:
-        Turnstile_Pivot_Green() : Turnstile_Pivot_Base(model()) {}
+        Turnstile_Pivot_Green() {}
 
         const char *model() const { return "st-turnstile-green"; }
         const char *anim() const  { return "st-turnstile-green-anim"; }
         bool oxyd_compatible() const { return false; }
     };
+    DEF_TRAITS(Turnstile_Pivot_Green, "st-turnstile-green", st_turnstile_green);    
 
     /*
     ** The base class for any of the four arms of the turnstile
@@ -2540,39 +2581,45 @@
             return dynamic_cast<Turnstile_Pivot_Base*>(st);
         }
 
-        bool is_movable () const { return true; }
     protected:
-        Turnstile_Arm (const char *kind) : Stone(kind)
-        {}
+        Turnstile_Arm() {}
     };
 
     class Turnstile_N : public Turnstile_Arm {
         CLONEOBJ(Turnstile_N);
+        DECL_TRAITS;
     public:
-        Turnstile_N(): Turnstile_Arm("st-turnstile-n") {}
+        Turnstile_N() {}
         Direction get_dir () const { return NORTH; }
     };
-
+    DEF_TRAITSM(Turnstile_N, "st-turnstile-n", st_turnstile_n, MOVABLE_IRREGULAR);
+    
     class Turnstile_S : public Turnstile_Arm {
         CLONEOBJ(Turnstile_S);
+        DECL_TRAITS;
         Direction get_dir () const { return SOUTH; }
     public:
-        Turnstile_S(): Turnstile_Arm("st-turnstile-s") {}
+        Turnstile_S() {}
     };
+    DEF_TRAITSM(Turnstile_S, "st-turnstile-s", st_turnstile_s, MOVABLE_IRREGULAR);
 
     class Turnstile_E : public Turnstile_Arm {
         CLONEOBJ(Turnstile_E);
+        DECL_TRAITS;
         Direction get_dir () const { return EAST; }
     public:
-        Turnstile_E(): Turnstile_Arm("st-turnstile-e") {}
+        Turnstile_E() {}
     };
+    DEF_TRAITSM(Turnstile_E, "st-turnstile-e", st_turnstile_e, MOVABLE_IRREGULAR);
 
     class Turnstile_W : public Turnstile_Arm {
         CLONEOBJ(Turnstile_W);
+        DECL_TRAITS;
         Direction get_dir () const { return WEST; }
     public:
-        Turnstile_W(): Turnstile_Arm("st-turnstile-w") {}
+        Turnstile_W() {}
     };
+    DEF_TRAITSM(Turnstile_W, "st-turnstile-w", st_turnstile_w, MOVABLE_IRREGULAR);
 }
 
 
@@ -2610,9 +2657,8 @@
 //      Turnstile_Pivot_Base implementation
 // --------------------------------------------
 
-Turnstile_Pivot_Base::Turnstile_Pivot_Base(const char *kind) 
-: Stone (kind),
-  active (false)
+Turnstile_Pivot_Base::Turnstile_Pivot_Base()
+: active (false)
 {}
 
 void Turnstile_Pivot_Base::animcb() 
@@ -3024,8 +3070,9 @@
 {
     class ChessStone : public Stone, public TimeHandler {
         CLONEOBJ(ChessStone);
+        DECL_TRAITS;
     public:
-        ChessStone (int color) : Stone("st-chess") {
+        ChessStone (int color) {
             newcolor = color;
             Stone::set_attrib("color", color);
             destination = GridPos(0,0);
@@ -3042,6 +3089,7 @@
         void set_attrib(const string& key, const Value &val);
         virtual Value message(const string &msg, const Value &v);
         void actor_hit(const StoneContact &sc);
+        void on_impulse(const Impulse& impulse) {}
         void alarm();
     private:
         // Variables and Constants
@@ -3067,6 +3115,8 @@
         // Interface for st-swap and st-pull
         bool is_removable() const { return state == IDLE; }
     };
+    DEF_TRAITSM(ChessStone, "st-chess", st_chess, MOVABLE_IRREGULAR);
+    
     double ChessStone::capture_interval = 0.1;
     double ChessStone::hit_threshold = 3.0;
 
@@ -3473,10 +3523,9 @@
                 init_model();
             }
         }
-        bool is_movable () const { return false; }
     };
-    
-    DEF_TRAITS(LightPassengerStone,"st-lightpassenger", st_lightpassenger);
+    DEF_TRAITSM(LightPassengerStone,"st-lightpassenger", st_lightpassenger,
+                MOVABLE_IRREGULAR);
 }
 
 // --------------------------------------------------------------------------------

Modified: trunk/src/stones_internal.hh
===================================================================
--- trunk/src/stones_internal.hh	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/src/stones_internal.hh	2007-09-17 23:36:58 UTC (rev 884)
@@ -30,10 +30,13 @@
         const StoneTraits &get_traits() const { return traits[subtype_expr]; }
 
 #define DEF_TRAITS(classname, name, id)         \
-    StoneTraits classname::traits = { name, id, stf_none, material_stone, 1.0 }
+    StoneTraits classname::traits = { name, id, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT }
 
+#define DEF_TRAITSM(classname, name, id, movable)         \
+    StoneTraits classname::traits = { name, id, stf_none, material_stone, 1.0, movable }
 
 
+
 namespace stones
 {
     using namespace world;
@@ -125,6 +128,9 @@
         ConnectiveStone(const char *kind, int connections): Stone(kind) {
             set_attrib("connections", connections);
         }
+        ConnectiveStone(int connections) {
+            set_attrib("connections", connections);
+        }
 
         DirectionBits get_connections() const {
             int conn = (int)getAttr("connections") - 1;

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/src/stones_simple.cc	2007-09-17 23:36:58 UTC (rev 884)
@@ -202,9 +202,16 @@
             return Stone::is_transparent(dir);
         }
 
-        bool is_movable() const { return true; }
+        const SimpleStoneTraits *traits; // owned by simple_stone_traits
 
-        const SimpleStoneTraits *traits; // owned by simple_stone_traits
+        const StoneTraits &get_traits() const
+        {
+            static StoneTraits simple_stone_movable_traits = {
+                "INVALID", st_INVALID, stf_none, material_stone, 1.0,
+                MOVABLE_STANDARD
+            };
+            return simple_stone_movable_traits;
+        }    
     };
 }
 
@@ -274,7 +281,7 @@
         EasyModeStone() 
         {}
     };
-    DEF_TRAITS(EasyModeStone, "st-easymode", st_easymode);
+    DEF_TRAITSM(EasyModeStone, "st-easymode", st_easymode, MOVABLE_BREAKABLE);
 }
 
 
@@ -362,6 +369,7 @@
 namespace
 {
     class SwapStone : public Stone, public TimeHandler {
+        DECL_TRAITS;    
     public:
         SwapStone();
         ~SwapStone();
@@ -387,11 +395,11 @@
         YieldedGridStone *in_exchange_with;
         Direction         move_dir;
     };
+    DEF_TRAITSM(SwapStone, "st-swap", st_swap, MOVABLE_IRREGULAR);
 }
 
 SwapStone::SwapStone()
-: Stone("st-swap"),
-  state(IDLE),
+: state(IDLE),
   in_exchange_with(0),
   move_dir(NODIR)
 {}
@@ -496,8 +504,10 @@
 {
     class BlockStone : public Stone {
         CLONEOBJ(BlockStone);
+        DECL_TRAITS;
     public:
-        BlockStone() : Stone("st-block") {}
+        BlockStone()
+        {}
     private:
         V2 get_center() const {
             return get_pos().center();
@@ -512,9 +522,9 @@
                 }
             }
         }
-        bool is_movable () const { return true; }
     };
-
+    DEF_TRAITSM(BlockStone, "st-block", st_block, MOVABLE_STANDARD);
+    
 };
 
 
@@ -532,6 +542,7 @@
     class BreakableStone : public Stone {
     public:
         BreakableStone(const char *kind) : Stone(kind), state(IDLE) {}
+        BreakableStone() : state(IDLE) {}
     protected:
         void break_me() {
             if (state == IDLE) {
@@ -591,6 +602,7 @@
 {
     class Stone_break : public BreakableStone {
         CLONEOBJ(Stone_break);
+        DECL_TRAITS;
     public:
         Stone_break(const char *kind) : BreakableStone(kind) { }
     private:
@@ -598,9 +610,11 @@
             return player::WieldedItemIs (a, "it-hammer");
         }
     };
-
+    DEF_TRAITSM(Stone_break, "INVALID", st_INVALID, MOVABLE_BREAKABLE);
+    
     class LaserBreakable : public BreakableStone {
         CLONEOBJ (LaserBreakable);
+        DECL_TRAITS;
 
         void actor_hit(const StoneContact &) {
         }
@@ -608,10 +622,10 @@
             return false;
         }
     public:
-
-        LaserBreakable(): BreakableStone("st-laserbreak") {
-        }
+        LaserBreakable()
+        {}
     };
+    DEF_TRAITSM(LaserBreakable, "st-laserbreak", st_laserbreak, MOVABLE_BREAKABLE);
 }
 
 
@@ -635,8 +649,10 @@
 {
     class Break_bolder : public BreakableStone {
         CLONEOBJ(Break_bolder);
+        DECL_TRAITS;
     public:
-        Break_bolder() : BreakableStone("st-break_bolder") {}
+        Break_bolder()
+        {}
     private:
         bool may_be_broken_by(Actor *a) const {
             return player::WieldedItemIs (a, "it-hammer");
@@ -647,6 +663,7 @@
             return Value();
         }
     };
+    DEF_TRAITSM(Break_bolder, "st-break_bolder", st_break_bolder, MOVABLE_BREAKABLE);
 }
 
 //----------------------------------------
@@ -669,9 +686,10 @@
 {
     class Stone_movebreak : public BreakableStone {
         CLONEOBJ(Stone_movebreak);
+        DECL_TRAITS;
     public:
-        Stone_movebreak() : BreakableStone("st-rock3_movebreak") {}
-    private:
+        Stone_movebreak()
+        {}
 
         void on_laserhit(Direction) {
         }
@@ -683,8 +701,6 @@
             return player::WieldedItemIs (a, "it-hammer");
         }
 
-        bool is_movable() const { return true; }
-
         void actor_hit(const StoneContact &sc) {
             if (may_be_broken_by(sc.actor))
                 break_me();
@@ -695,7 +711,10 @@
             move_stone(impulse.dir);
         }
 
+    private:
+        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_NO_STONE; }
     };
+    DEF_TRAITSM(Stone_movebreak, "st-rock3_movebreak", st_movebreak, MOVABLE_STANDARD);
 }
 
 //----------------------------------------
@@ -718,14 +737,17 @@
 {
     class Break_acwhite : public BreakableStone {
         CLONEOBJ(Break_acwhite);
+        DECL_TRAITS;
     public:
-        Break_acwhite() : BreakableStone("st-break_acwhite") {}
+        Break_acwhite()
+        {}
     private:
         bool may_be_broken_by(Actor *a) const {
             return (a->getAttr("whiteball") != 0) &&
                 player::WieldedItemIs (a, "it-hammer");
         }
     };
+    DEF_TRAITSM(Break_acwhite, "st-break_acwhite", st_break_acwhite, MOVABLE_BREAKABLE);
 }
 
 //----------------------------------------
@@ -748,14 +770,17 @@
 {
     class Break_acblack : public BreakableStone {
         CLONEOBJ(Break_acblack);
+        DECL_TRAITS;
     public:
-        Break_acblack() : BreakableStone("st-break_acblack") {}
+        Break_acblack()
+        {}
     private:
         bool may_be_broken_by(Actor *a) const {
             return (a->getAttr("blackball") != 0) &&
                 player::WieldedItemIs (a, "it-hammer");
         }
     };
+    DEF_TRAITSM(Break_acblack, "st-break_acblack", st_break_acblack, MOVABLE_BREAKABLE);
 }
 
 
@@ -854,9 +879,10 @@
 {
     class Break_invisible : public Stone {
         CLONEOBJ(Break_invisible);
+        DECL_TRAITS;
         const char *collision_sound() {return "stone";}
     public:
-        Break_invisible() : Stone("st-break_invisible"), state(INVISIBLE) {}
+        Break_invisible() : state(INVISIBLE) {}
     private:
         enum State { INVISIBLE, BRUSH, DESTROY };
         State state;
@@ -881,6 +907,8 @@
                 KillStone(get_pos());
         }
     };
+    DEF_TRAITSM(Break_invisible, "st-break_invisible", st_break_invisible,
+                MOVABLE_BREAKABLE);
 }
 
 //----------------------------------------
@@ -949,6 +977,7 @@
 {
     class WoodenStone : public Stone {
         CLONEOBJ(WoodenStone);
+        DECL_TRAITS;
     public:
         WoodenStone(const char *kind, const char *floorkind_, bool blockfire_ = false) :
             Stone(kind), floorkind(floorkind_), blockfire(blockfire_) {}
@@ -995,8 +1024,8 @@
             if (server::GameCompatibility != GAMET_OXYD1)
                 maybe_fall_or_stopfire();
         }
-        bool is_movable () const { return true; }
     };
+    DEF_TRAITSM(WoodenStone, "INVALID", st_INVALID, MOVABLE_STANDARD);
 
     /*! When st-wood is created it randomly becomes st-wood1 or
       st-wood2. */
@@ -1021,8 +1050,10 @@
 {
     class WoodenStone_Growing : public Stone {
         CLONEOBJ(WoodenStone_Growing);
+        DECL_TRAITS;
     public:
-        WoodenStone_Growing() : Stone("st-wood-growing") {}
+        WoodenStone_Growing()
+        {}
     private:
         void init_model() { set_anim("st-wood-growing"); }
         void animcb() {
@@ -1033,12 +1064,17 @@
         void actor_contact(Actor *a) {SendMessage(a, "shatter");}
         void actor_inside(Actor *a) {SendMessage(a, "shatter");}
         void actor_hit(const StoneContact &sc) {SendMessage(sc.actor, "shatter");}
+
+        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_STANDARD; }
     };
-
+    DEF_TRAITS(WoodenStone_Growing, "st-wood-growing", st_wood_growing);
+    
     class GreenbrownStone_Growing : public Stone {
         CLONEOBJ(GreenbrownStone_Growing);
+        DECL_TRAITS;
     public:
-        GreenbrownStone_Growing() : Stone("st-greenbrown-growing") {}
+        GreenbrownStone_Growing()
+        {}
     private:
         void init_model() { set_anim("st-greenbrown-growing"); }
         void animcb() {
@@ -1049,11 +1085,14 @@
         void actor_inside(Actor *a) {SendMessage(a, "shatter");}
         void actor_hit(const StoneContact &sc) {SendMessage(sc.actor, "shatter");}
     };
+    DEF_TRAITS(GreenbrownStone_Growing, "st-greenbrown-growing", st_greenbrown_growing);
 
     class VolcanoStone_Growing : public Stone {
         CLONEOBJ(VolcanoStone_Growing);
+        DECL_TRAITS;
     public:
-        VolcanoStone_Growing() : Stone("st-volcano-growing") {}
+        VolcanoStone_Growing()
+        {}
     private:
         void init_model() { set_anim("st-volcano-growing"); }
         void animcb() {
@@ -1063,7 +1102,10 @@
         void actor_contact(Actor *a) {SendMessage(a, "shatter");}
         void actor_inside(Actor *a) {SendMessage(a, "shatter");}
         void actor_hit(const StoneContact &sc) {SendMessage(sc.actor, "shatter");}
+
+        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_NO_STONE; }
     };
+    DEF_TRAITS(VolcanoStone_Growing, "st-volcano-growing", st_volcano_growing);
 }
 
 
@@ -1158,7 +1200,7 @@
             set_attrib("strength", 10.0);
         }
     };
-    DEF_TRAITS(RubberBandStone, "st-rubberband", st_rubberband);
+    DEF_TRAITSM(RubberBandStone, "st-rubberband", st_rubberband, MOVABLE_STANDARD);
 }
 
 
@@ -1303,7 +1345,7 @@
         FartStone() : state(IDLE), rememberBreaking(false) 
         {}
     };
-    DEF_TRAITS(FartStone, "st-fart", st_fart);
+    DEF_TRAITSM(FartStone, "st-fart", st_fart, MOVABLE_BREAKABLE);
 }
 
 void FartStone::change_state(State newstate) 
@@ -1392,7 +1434,7 @@
         const char *collision_sound() { return "cloth"; }
         int affected_player;
     };
-    DEF_TRAITS(ThiefStone, "st-thief", st_thief);
+    DEF_TRAITSM(ThiefStone, "st-thief", st_thief, MOVABLE_BREAKABLE);
 }
 
 ThiefStone::ThiefStone() 
@@ -1642,14 +1684,14 @@
     };
 
     StoneTraits BlackWhiteStone::traits[8] = {
-        {"st-black1", st_black1, stf_transparent},
-        {"st-black2", st_black2, stf_transparent},
-        {"st-black3", st_black3, stf_transparent},
-        {"st-black4", st_black4, stf_transparent},
-        {"st-white1", st_white1, stf_transparent},
-        {"st-white2", st_white2, stf_transparent},
-        {"st-white3", st_white3, stf_transparent},
-        {"st-white4", st_white4, stf_transparent},
+        {"st-black1", st_black1, stf_transparent, material_stone, MOVABLE_PERSISTENT},
+        {"st-black2", st_black2, stf_transparent, material_stone, MOVABLE_PERSISTENT},
+        {"st-black3", st_black3, stf_transparent, material_stone, MOVABLE_PERSISTENT},
+        {"st-black4", st_black4, stf_transparent, material_stone, MOVABLE_PERSISTENT},
+        {"st-white1", st_white1, stf_transparent, material_stone, MOVABLE_PERSISTENT},
+        {"st-white2", st_white2, stf_transparent, material_stone, MOVABLE_PERSISTENT},
+        {"st-white3", st_white3, stf_transparent, material_stone, MOVABLE_PERSISTENT},
+        {"st-white4", st_white4, stf_transparent, material_stone, MOVABLE_PERSISTENT},
     };
 
 }
@@ -1672,6 +1714,8 @@
             sound_event("yinyang");
             ReplaceStone (get_pos(), MakeStone(stonename));
         }
+        
+        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_HOLLOW; }
     };
 
     class YinYangStone1 : public YinYangStone {
@@ -1726,6 +1770,7 @@
     /*! This stone add a bomb to the player's inventory when touched. */
     class BombStone : public Stone {
         CLONEOBJ(BombStone);
+        DECL_TRAITS;
         const char *collision_sound() {return "stone";}
     public:
         BombStone(const char* kind_, const char* itemkind_) :
@@ -1740,7 +1785,8 @@
         virtual Value message (const string &msg, const Value &);
     };
 }
-
+DEF_TRAITSM(BombStone, "INVALID", st_INVALID, MOVABLE_BREAKABLE);
+    
 void BombStone::change_state (State newstate) 
 {
     if (state == IDLE && newstate==BREAK) {
@@ -1800,7 +1846,7 @@
         MagicStone()
         {}
     };
-    DEF_TRAITS(MagicStone, "st-magic", st_magic);
+    DEF_TRAITSM(MagicStone, "st-magic", st_magic, MOVABLE_BREAKABLE);
 }
 
 
@@ -1904,8 +1950,10 @@
 {
     class BrakeStone : public Stone {
         CLONEOBJ(BrakeStone);
+        DECL_TRAITS;
     public:
-        BrakeStone() : Stone("st-brake") {}
+        BrakeStone()
+        {}
 
         void on_creation (GridPos p) {
             Stone::on_creation(p);
@@ -1951,6 +1999,7 @@
         bool is_sticky(const Actor *) const 
         { return false; }
     };
+    DEF_TRAITSM(BrakeStone, "st-brake", st_brake, MOVABLE_BREAKABLE);
 }
 
 
@@ -2082,7 +2131,7 @@
     public:
         Knight() : subtype (MIN_SUBTYPE) {}
     };
-    DEF_TRAITS(Knight, "st-knight", st_knight);
+    DEF_TRAITSM(Knight, "st-knight", st_knight, MOVABLE_BREAKABLE);
 }
 
 
@@ -2120,6 +2169,7 @@
 {
     class Stone_firebreak : public Stone {
         CLONEOBJ(Stone_firebreak);
+        DECL_TRAITS;
 
         const char *collision_sound() {return "stone";}
 
@@ -2145,11 +2195,14 @@
         }
 
     public:
-        Stone_firebreak() : Stone("st-firebreak") { }
+        Stone_firebreak()
+        {}
     };
+    DEF_TRAITSM(Stone_firebreak, "st-firebreak", st_firebreak, MOVABLE_BREAKABLE);
 
     class Stone_movefirebreak : public Stone {
         CLONEOBJ(Stone_movefirebreak);
+        DECL_TRAITS;
 
         void break_me() {
             sound_event("stonedestroy");
@@ -2184,11 +2237,14 @@
             }
         }
 
-        bool is_movable () const { return true; }
-
     public:
-        Stone_movefirebreak() : Stone("st-firebreak_move") { }
+        Stone_movefirebreak() : Stone("st-firebreak") { }
+        
+    private:
+        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_NO_STONE; }        
     };
+    DEF_TRAITSM(Stone_movefirebreak, "st-firebreak_move", st_firebreak_move,
+                MOVABLE_STANDARD);
 }
 
 

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/src/world.cc	2007-09-17 23:36:58 UTC (rev 884)
@@ -1584,8 +1584,16 @@
 {
     if (const Field *f = GetField (p)) {
         Stone *st = f->stone;
-        if (st)
+        if (st) {
             st->on_floor_change();
+            // Perhaps the stone was destroyed - get the new one.
+            st = f->stone;
+        }
+        
+        if (st) {
+            st->freeze_check();
+            st = f->stone;
+        }
 
         if (Item *it = f->item)
             it->stone_change(st);

Modified: trunk/src/world.hh
===================================================================
--- trunk/src/world.hh	2007-09-16 21:58:42 UTC (rev 883)
+++ trunk/src/world.hh	2007-09-17 23:36:58 UTC (rev 884)
@@ -331,9 +331,8 @@
     Stone *GetStone(GridPos p);
     Stone *YieldStone(GridPos p);
     void   KillStone(GridPos p);
+    void   MoveStone(GridPos oldPos, GridPos newPos);
 
-    void MoveStone(GridPos oldPos, GridPos newPos);
-
 /* -------------------- Items -------------------- */
 
     void  SetItem (GridPos p, Item* it);



From ged at mail.berlios.de  Sun Sep 23 14:30:31 2007
From: ged at mail.berlios.de (ged at mail.berlios.de)
Date: Sun, 23 Sep 2007 14:30:31 +0200
Subject: [Enigma-game-svn] r885 - homepage/input/lotm
Message-ID: <200709231230.l8NCUVeZ032710@sheep.berlios.de>

Author: ged
Date: 2007-09-23 14:30:23 +0200 (Sun, 23 Sep 2007)
New Revision: 885

Added:
   homepage/input/lotm/lotm_200704_ru.html
   homepage/input/lotm/lotm_200705_ru.html
Modified:
   homepage/input/lotm/lotm_core_ru.html
   homepage/input/lotm/lotm_header_ru.html
Log:
Homepage: added Russian version of April and May lotm. Thanks for help to capkoh.

Added: homepage/input/lotm/lotm_200704_ru.html
===================================================================
--- homepage/input/lotm/lotm_200704_ru.html	2007-09-17 23:36:58 UTC (rev 884)
+++ homepage/input/lotm/lotm_200704_ru.html	2007-09-23 12:30:23 UTC (rev 885)
@@ -0,0 +1,165 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">?????? 2007: </span>
+    &quot;Pneumatic Delivery&quot; ?? Manuel K&ouml;nig
+  </h3>
+
+  <p>? ???? ??? ?? ?????????? ????????? ? ???????, ?????? ? ???????? ?????,
+  ??????????? ? <i>?????????</i> ??????????? ? ??????? ????????? ? <b>8.80</b> ?? ?????? 5
+  ??????????????? -- ??, ????? ????? ??? &quot;Pneumatic Delivery&quot;!</p>
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200704_a.png" alt="Level of the month" border="0">
+    <div class="imagetitle">Enigma V # 59</div>
+  </div>
+
+  <table cellpadding="0" cellspacing="1" class="statistics">
+    <caption class="normalcaption">????????? ???????? ????? 2007</caption>
+    <colgroup>
+       <col width="80">
+       <col width="160">
+    </colgroup>
+    <tr><td class="num">4:23</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">6:08</td>
+        <td class="left">HuB34</td></tr>
+    <tr><td class="num">7:15</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">7:20</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">10:25</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">12:25</td>
+        <td class="left">JuSt</td></tr>
+    <tr><td class="num">15:24</td>
+        <td class="left">Taztunes</td></tr>
+  </table>
+
+  <p>????? ? ??????? ???????? &quot;Pneumatic Delivery&quot;, ? ?????? ??? ???? ? ?????.
+  ??? ???? ??? ?????? ?????????? ?? ?????????; ? 90-? ? ? ?????? ????????? ? Oxyd 1,
+  ?? ?? ???????? ??? ???????. ? ??????? ??? ? ???????
+  ? ????????? ?????? ?????? ??????, ???? ? ???? ?????????? ???? ?? ?????, ???
+  ???? ????????????? ???????. ????????? ?????? ?????? ? ????? ????????? ?? ??????? Manuel'?
+  ? ? ???? ??? ???? ??????, ????????????? ??????!</p>
+
+  <p class="quote">Pneumatic Delivery ???? ?? ???? ??????? ???????, ????? ????????? ??
+  ????????? ????????????, ?? ??????? ? ??? ?????? ???? ??????. ??? ???????? ??????, ? ???????
+  ??? ????? ??? ?????, ?? ??? ?? ????? ?????????? ????? ?????? ???? ???????????????,
+  ? ????? ??? ???????? ???????????. ????????? ????? ? ??????????,
+  ??? ??????? ????????? ??? ?????? ????????, ????????? ????????, ??? ?????? ?? ? ????
+  ??????????. ?????????? ???????????? ??? ????????? ??????????? ? ?????-???????,
+  ???? ??????? ? ???? ?? ??????. ??????? ?????? ???? ??????? ? ??????? ????,
+  ?? ???? ????? ? ???????? ???????.</p>
+  <p class="author">Andreas Geldmacher</p>
+
+  <p>??, ??? ??????????? ???? ??????? ???? ????? ??????????; ?? ??????? ?? ????????, ? ???????? ????????? ??!
+  ???? ? ????-?? ???????? ? ????????? ??????, 
+  ????? ????????? ?? &quot;The Enigmhanoi Towers&quot;.</p>
+
+  <h4>&quot;???? ?? ???????? ??? ?????? ? ???? ????? ? ?????&quot;</h4>
+
+  <p class="quote">
+  ???? ? ? ?? ?????? ?? ?????? ?????? ???? ?? ????? Pneumatic
+  Delivery, ?? ??? ??????????. ??? ? ?????? ????? ???? ? ???? ?????? ??? ??? ??, ???
+  ?? ?????????? ??? ??????????? ? ????? ???????????? ?????. ?
+  ??????, ??? ????? ????, ??? ? ???? ?????? ??? ????????? ???????, ? ??? ???? ? ????????? ???????.
+  ? ????????? ????? ?? ????? ???? ?? ?????? ???? ???????, ???
+  ?? ?????? ???????? ? ?? ???????? ? ???????, ??? ????????
+  ??? ?????? ? ???? ????? ? ?????.</p>
+
+  <p class="quote">
+  ???? ?? ?????-???? ?????????? ??????? Enigma, ?? ??????? ??????, ??? ??? ??????? ??????
+  ??? ?????? ???????????. ??????? ?????????? ??????? ??? ?????????? ????? ????,
+  ????? ????, ????? ??????????? ???? ???????. ?? ????? ? ????? ?????? ????????? ????
+  ??? ?????-?? ??????????, ??????? ?? ?????? ?????????? ? ??????, ?? ????? ?????????, ??? ?????? ???????.
+  ?? ?????? ?????? ???, ??? ????????. ??????, ??? ?????? ?? ??????????? ??
+  ???????, ??? ????? ????? ? ???????? ????? ???? ????????. ?????????,
+  ?????? ??????? ??????? ?? ?????? ???? ?? ?????? ????, ?? ????
+  ? ???? ?????????????????? ???? ?????? ? ??? ???-?? ??????, ?? ??? ???????. ??????? ?? ????????? ?????? ??
+  ???????????? ? ?? ??????? ?????? ?? ?????? ???? ?? ????????? ???????? ????.
+  ?? ???? ??????? ????? ??? ?????? ???????????? ???? ????? ??????? ??????? ????? ?????????, ??? ?????????.</p>
+
+  <p class="quote">
+  ? ?? ???? ???????, ??? Pneumatic Delivery ??? ??????? ???????, ?? ??????, ???
+  ?? ?????? ???????????, ? ??? ???? ???? ?????????????? ???????????, ???? ?? ?
+  ?? ?????? ???? ???????. ?????? ?????? ??????????? ?????? ?????????? ? ?????????,
+  ??????? ?????????? ?? ????????, ? ?????? ?? ?? ?????? ????????? ??????? - ???
+  ??? ?????? ??? ????? ?????????. ??????, ???? ?????????, ???
+  Manuel ???????? ???? ??????? ?????? ????.</p>
+  <p class="author">Hubai Andr&aacute;s</p>
+
+  <p>Andr&aacute;s ???? ??????? ???????? ? ?????? &quot;Gods of Enigma&quot;,
+  &quot;Doors Forever&quot; (&quot;?? ? ??? ???? ?????
+  ??? ????????? ????????&quot;) ? &quot;Automaton&quot;, ??????? ???????? ??? ?? ??????.
+  ??????? ????????? ???? Oxyd Magnum 82 &quot;Puller Mailing&quot;,
+  ? ?????????? ?????? ??????? ???????????, ?? ?? ?????? ??????, ?????????? ??? ?????-????
+  ????????? ???????? &hellip;</p>
+
+  <h4>&quot;? ???? ?? ???? ????? ???????? ???????&quot;</h4>
+
+  <p>???????????? ?????? ???????, ??? ?????? Manuel'? ?????????.
+  ?????? ????????, ??? ???? ?????? - ??? ???????? ??????!</p>
+
+  <p class="quote">
+  ?? ????? ????, &quot;Pneumatic Delivery&quot; ??? ???? ????? ?????? ???????. ? ???? ?? ???? ????? ???????? ???????.
+  ??? ?? ????? ? ????? ?????????????? ??????? ??? ????? ????,
+  ????? ?????? Oxyd ? Enigma. ??????? ??????
+  &quot;????????&quot; ? ?????? ? BlackBallEd, ? ?????
+  ????????? ??? ? ??????? Lua. ????? ?????? ??????? ? ????? ???????? ????? ???????
+  &quot;?????????&quot; ? ???????? ??? [???????? ????] (???????? ?????? 
+  28-?? ???????? 2004 ????). ??? ????? ????? ????????, ??????? ????? ???????? ? ????? ???????,
+  ?? ????? ??????? - ? ?????? ????? ? ???????????
+  - ??? ????. ?????? ??????????????, ??? ??? ???????????, ??? ? ???????
+  ????? ?????? ? ????????? ????????????, ? ??? ??? ? ??????? ?? ??????? ?????,
+  ? ?????? ??????.</p>
+  <p class="author">Manuel K&ouml;nig</p>
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200704_b.png" alt="A draft version" border="0">
+    <div class="imagetitle">???????? ?????? 2004 ????</div>
+  </div>
+
+  <p>??? ?????????, ?????? ?????? ?????????? ? ???????? ??????! ? ??????????? ???????
+  ?????? ?????????? ? ?????? ????, ?????? ??? ?????? ?????? ?????? &hellip; 
+  ? ???? ?????? ??????? &quot;??? ?????? ?????? 
+  ???????&quot;. ??? ???? ??????????? ????????, ??? ?? ??? ? ???????? ????.
+  ???????? ???????? ? &quot;Teamplay Doors&quot; ???
+  &quot;Doors Forever&quot;.</p>
+
+  <h4>?????????? ??????</h4>
+
+  <p class="quote">
+  ?? ?????? ?????? ?????? [??????????? ?? mag-heut.net] ? ?????? ????
+  &quot;?????????? ?????&quot;. ? ??????? ??? ?????, ?????? ??? ??????, ??? ????? ??????? Enigma
+  ??????? ?????? ??? ?????????? ? ??? ??????? ? ????????? ?? ??????????.
+  ??????, ?? ??? ????? ???? ????????? ???????, ??? ??????? ??? ?????????. ? ????????? ??????
+  ????????? ????? ? ?? ?? ????? ?????????? ????????? ????????.
+  ???????, ??? ????????? ?????? ????? ?????? ??????????? &quot;Pneumatic
+  Delivery&quot;.</p>
+  <p class="author">Manuel K&ouml;nig</p>
+
+  <p>?????????? ?????????? ??????! ?????, ? ???? ?? ???? ?? ????, ???? Manuel ?? ???????? ???.
+  ?? ????? ???? ? Enigma ?????? 1.00 ???? ?????????? ?????,
+  ?? ?? ?????? ??? ???????? &hellip; ? ?????????, ?? ?? ????? ?????? ???? ?? ???????? ?????????????
+  ???? ??????? ? ??????? ??? ? ?????????? ??????.
+  ??????? ??? ????? ????, ??? ??????????? ???????? ?? ?????????? &quot;Pneumatic Delivery&quot;
+  ? Enigma ?????? 1.01 ? ???????????? ??????????? ??????, ??? ??????? ??? ?????????? ??????? PD
+  ???????????. ?????????? ???????? ???, ???? ?? ??????? ??? ?????-?? ??????, ?????????? ?????????? ?????,
+  ?? ?? ?????????? ??? ??????? ????? ?????.</p>
+
+  <p class="quote">
+  ????? ? ?????, ??? ?????? ?????? ???????? ???????, ?? ??? ????? ?????:
+  ?? ???????? ????? ????. ??? ????????????? ?????? (??? ???? ???????),
+  ????? ?????? ???. ????? ? ??????? ??????????? ???? ???????, ????????? ??????????? ?????? ??? ???? ?????? ?????? -
+  ? ??????? ????????? ?????? ??????????? ?? ?? ?????. ;-)</p>
+  <p class="author">Manuel K&ouml;nig</p>
+
+  <p>??????? ????, Manuel, ?? ??? ?????????????? ??????????? ??????????? ? ???????,
+  ??????? ?? ?????? ????? ? ??? ???????!</p>
+
+  <p>? ?????????,<br/>
+  <i>Andreas</i></p>
+
+</div>


Property changes on: homepage/input/lotm/lotm_200704_ru.html
___________________________________________________________________
Name: svn:eol-style
   + native

Added: homepage/input/lotm/lotm_200705_ru.html
===================================================================
--- homepage/input/lotm/lotm_200705_ru.html	2007-09-17 23:36:58 UTC (rev 884)
+++ homepage/input/lotm/lotm_200705_ru.html	2007-09-23 12:30:23 UTC (rev 885)
@@ -0,0 +1,229 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">??? 2007: </span>
+    &quot;The Aztec Temple&quot; ?? Dominik Lehmann
+  </h3>
+
+  <p>&quot;????? ?????????? ? ????! ?????? ????? ????? ??? ??????? ?????? ? ????????
+   &#39;Llamas&#39;, ??????? ?????????? ? ????????? ?????????, ? ????????? 
+  ??????????????? ????????. ?? ?????????????, ??? ?????????? ????? ???????????? ??????,
+  ??????? ????? ?? ??????? ????????? ?????? ???????. ?? ????
+  ? ???????????? ??????? ????????? &hellip;&quot; ????? ?????????? ? ??????? ??????!
+  ??????? ?????? ? &quot;The Aztec Temple&quot;!</p>
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200705_a.png" alt="Level of the month" border="0">
+    <div class="imagetitle">Enigma VI # 39</div>
+  </div>
+
+  <table cellpadding="0" cellspacing="1" class="statistics">
+    <caption class="normalcaption">????????? ???????? ?????? 2007</caption>
+    <colgroup>
+       <col width="80">
+       <col width="160">
+    </colgroup>
+    <tr><td class="num">11:39</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">24:32</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">29:45</td>
+        <td class="left">Duffy</td></tr>
+    <tr><td class="num">36:16</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">41:10</td>
+        <td class="left">Tarim</td></tr>
+  </table>
+
+  <p>3 ??????, ?????????? ? ?????????? 9.33 ? ??????. ??? ?????? ??????, ??????? ????????? ???????????? 
+  Enigma ?? ??? ??????, ??? ??? ?????? &quot;The Aztec
+  Temple&quot;. ????????????? ?????, ???????????? ??????????? ????????? ???????
+  ??????????? ????????????? ????????? ? ???????????? ??????????????. ??????
+  ?????????? ??????? ????????? ????????? ?? ?????? mag-heut.net <a 
+  href="http://www.mag-heut.net/blackball/index.php?act=ST&amp;f=8&amp;t=574&amp;st=0"
+  >?????</a>;
+  ??? ???????? ???? ????????? ????????????? ?????????? ? ???????!</p>
+
+  <h4>&quot;??? ????????? ???????? ????????? ? ?????????? ??? ???????????&quot;</h4>
+
+  <p class="quote">? Enigma ???? ????????? ???????, ????????? ?? ??????? ?? ??????
+  ????? ????? ???????, ??? ??? ????? ???????, ????? ?????? ??. ? ???? ??????? ???????
+  ??? ?? ?????????. ? ??????????? ??????, ??????? ??????? ???????????? ? ????????
+  - ??????? ?????????? ???? ????? ????? ??????? ???? ? ??????
+  - ??????? ?????????? ??? ?????????? ????????? ???????.
+  &quot;Aztec Temple&quot; ???? ?? ???. ???? ??????? - ????????? ????? ??? ??????.. ?? ??????
+  ????????? ???????????? ???????? ????????? ????? ??? ????????? ??????? ? ?????? ??????.</p>
+
+  <p class="quote">? ??? ???? ???????? ?????? (?? ??????? ???? ??? ????), ??? ??
+  ?????? ???????? ?????????? ???? ?????? ?? ???, ????? ???????? ?????? ??????????? ?????
+  ? ???????? ???? ????? ?????????? ??????????? ??????. ????????????
+  ????? ?? ?????? ??????? ????????? ???????? ???????? ? ????????. ? ??? ????
+  ??????, ??????? ????? ????????.</p>
+
+  <p class="quote">???????? ???????? ??????? Dominik'? Lehmann'?, ??? ?????? - ?????????? ???,
+  ?????????? ????. ???? ?? ??? ????? ????????????? ????????????? ????????? ???
+  (? ???????, ?????? ???? ??? ????? ??????? ??????? ?? ???? ???????),
+  ??? ??????? ????????????? ???????????? ????? ??????. ??? ????????? ?????????? ? 
+  ????????? ????????? ??????, ????????????? ?? ??????, ???????????? ????????????
+  (??????? ???????? ??? ?????????? ???????, ??????????? ??????), ????????? ???, ?????????? ?????? ?
+  ????????? ????? ? ???? ??? ??????????. ? ?????? ???????, ??? 
+  ???? ? ? ????? ???? ????? ?? ??????? ? ???????, ??? ???? ?????!</p>
+
+  <p class="quote">?? ????? ???? ? &quot;Aztec Temple&quot;, ? ????? ? ????? ?????????? ???????????,
+  ?? ??? ?? ?????????? ??????? ?????? ??????? ? ?????????? ????????????, ???????????? ?????? ?????
+  ??????? ??? ?????? ??????? ???????????.
+  ? ????????? ??? ????????? ?? ?????????, ?????? ??? ?????? ??? ???? ????????? ? ???? ???????????
+  ????? ?????????, ??????? ???????? ??????? ??????, ????????? ?????.</p>
+
+  <p class="quote">&quot;Aztec Temple&quot; ?? ??? ?????? ?????, ? 
+  ???????? ??????????? ? ????????, ??????? ???????? ??? ?? ????. ?????? ???????????,
+  ? ??????? ???? ? ?????!</p>
+  <p class="author">Taztunes</p>
+
+  <p>??? ????????? ?????????: ??????? Dominik'? ?????????????? ??? ?? ?????????? ????? ??????,
+  ?????-?? ??????? ????? ??? ??????.
+  ??? ??????????? ??? ? ???? ?????????? ????????????,
+  ?? ????? ???? ?????????? ???????????. ??????????? ??? ?????? ?????????? ??
+  ?????????????? ?????? ? ????????? ?????????? ???????, ? ?????
+  ???????? ?????? ? ???????, ????? ?????? ???. ???? ?????? ???????????
+  ?????? ???????? ? ???????????? ???? Enigma.
+  &quot;The Aztec Temple&quot; ????????? ???? ??????.</p>
+
+  <h4>&quot;???????? ???? ????????? ?????&quot;</h4>
+
+  <p>Tarim ????? ?????? ???????????? ?????? ??????:</p>
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200705_b.png" alt="Level of the month" border="0">
+    <div class="imagetitle">???????? Xila</div>
+  </div>
+
+  <p class="quote">Aztec Temple ??? ??????, ??? ??????? ??????? ??????
+  ?????? ?? ?????; ??? ?????? ???????????? ?????????? ? ????????? ?????????? ????.
+  ?????? ? ????; ?? ????????? - ??????????, ? ?? - ?????? ?????,
+  ????????? ???? ????? ???????. ????? ???? ????????? ????? ???????????, ??????? ???????????
+  ???? ? ??????, ??? ???????????? ???????, ??? ??? ? ??????????.
+  ???? ???? ???-?? ? ?? ??????? ?????? (???? ?????? ? ????? ????? ?????? Shift-F3),
+  ??? ?????? ?????????? ? ????? ?????????. ?? ?????? ????? ??????????
+  ? ???, ??? ?? ?????? ??????, ?? ???? ?? ???????? - ??????? ?? ????;
+  ??????? Gerald Gregory Goshers ???????, ? ?? ??????? ?? ???????? ???? ?????????????
+  ?? ??????????????? Xila &hellip;</p>
+
+  <p class="quote">????? ???? ??? ?????? ????? - ???????? ???? ????????? ????? - ???
+  ?????? ? ??????, ??????? ?? ??????? ?????????? ?? ????? ? ?????
+  ???????, ??? ????? ?? ?????? ????? Aztec Temple (?????
+  Dominik, ?? ?????? ??? ???????).</p>
+  <p class="author">Tarim</p>
+
+  <p>? ???? ?? ??? ???????!</p>
+
+  <h4>&quot;&#39;Aztec Temple&#39; ??????????? ???, ??? ?? ??????&quot;</h4>
+
+  <p>? ??? ??????? ? ????????, ??????? ?????? &quot;Aztec Temple&quot; ? ??????????.
+  ??????? ?????????? ???, ??????? ?????????? ? ? ???? ????????????? &hellip;</p>
+
+  <p class="quote">?????????? Aztec Temple ??? ?????? (? ??????????) ???????,
+  ??????? ?????? ????? ???????????? ?????? ???? ???????. ??????, ???????
+  ?????????? ????????? ?? ?????? ??? ????, ????? ???? ?????? ?????????. ???, ?? ???????? ????????? ??????
+  ? ????????????? ????????? ?????? ? ???? ?????????? ???. ? ?????,
+  ? ???? ?????? ?????? ????? &quot;it-documents(???????? ???? "????????")&quot :-)</p>
+
+  <p class="quote">??????? ????????? ? ?????? ? ????? ????????????? ????????? ???????,
+  ??????? ??? ???????? ?? ??????? &quot;??????-???????????&quot; ??? ?????
+  &quot;?????? ? ????????&quot;.</p>
+
+  <p class="quote">??? ???????, ??????? ????????? ??? ? ????????????? ?????????? ??
+  ?????????? ????????? ? ??????? ??????????? ??????. ???????, ????
+  ??????, ??????? ????? ???????? ?????? ????????? ????? ?? ????????, ????????
+  &quot;Gods of Enigma&quot;. ??????, &quot;Aztec Temple&quot; ??????????? ???, ??? ?? ??????.</p>
+
+  <p class="quote">?????????? ????????, ?????? ??????? ????????? ?????????? ?? ??????????
+  ?????? ?????? ????? ??????? Enigma 1.00. ? ?? ???????? ????, ????????????? ?? ?? ??? ???????
+  ? ???????, &quot;Moneymaker&quot; ????? ??? ???????.
+  ??????, ?? ???????????? ???, ?????? ????????? ??????? ?????? ??????
+  &quot;Aztec Temple&quot;. ? ???? ???? ?? ?????.</p>
+
+  <p class="quote">????? ??????? ??????? ??????????? ?????? ?????, ??????? ?? ???????? ???,
+  ?? ??? ?????? &quot;???????????????&quot; ??????? ? ?????? ?????? ???????.
+  ??, ? ??????? Enigma ?????? 1.01 ?? ?????????? ???? ??????? ???????
+  ??????? ?????? ???????, ??????? ??? ??????? 100.</p>
+  <p class="author">Raoul Bourquin</p>
+
+  <p>?????????????, &quot;The Aztec Temple&quot; ??? ????????? ? 39 ????? ??
+  100. ????? ?? ??? ??? ?????????? ????? ??????? ?????-???????? ??????????????? ???????
+  ?, ? ????? ???????? ??????, ????? ??????? ???????.
+  ????????? ?????, ??????????? ? ?????????????? ???????, ???? ????????? ????? ??????
+  ???????, ??????? ?? ???????? ????? ???????? ? Enigma 0.70, ?? ????? ???????? ??????.
+  ????? ?????? ???????????? ???????????, ??????? ????? ???????? ?????. ?? ??? ?????? ?????? ???????! ;-)</p>
+
+  <h4>&quot;? ?? ????????? ??????? ????? ???????&quot;</h4>
+
+  <p>???? ?????? ?? ?????? ???????? ? ?????, ? Dominik'? ??????? ?????
+  ???????? ??? ???? ????? ?? Enigma, ???????? ??????? ? ?????? ??? ???????? ?????:</p>
+
+  <p class="quote">? ?????, Enigma ??????? ????? ? ??? ????? ? ???????
+  0.70. ??? ???? ????? 4 ??? ?????. ?? ????? ? ??????? ?? ????? ???????? ?? ??? (????? Oxyd).
+  ??? ???? ???? ???????????? ???????, ?????? ????? ? ???? ????????????? ???? ?????????????,
+  ???????? ??????. ????? ????? ????, ??? ? ????? ?????? ?
+  Enigma, ? ???? ??????? ??????? ???? ???????. ? ??? ??????????? ?????????? ??????? ????,
+  ???????? ???????? ???????? ?? ??? ?????? ??????..</p>
+
+  <p class="quote"> ? ?????????, ? ???? ???????? ??????? ?? ???, ? ?
+  ????? ?????????? ?? ????? ???????. ?????? ??????? ???????? ?????, ? ??? ?????? ???????,
+  ????? ????????? ? ????? hex-????????? ?????????? ????, ??????? ??? ??????? ??????.
+  ????? ????? ? ?????? ???????????? Enigma, ??????? ? ?? ????? ???? ??? ?????? ????????.
+  ? ??? ??? ?????? Lua ??????? ?????????, ? ????? ???????????? ?????????
+  ?? ?????? ?????????, ?? ? ???????????. ????, ? ??????? ??
+  mag-heut.net ? ????? BlackBallED. ? ??????? ????? ????????? ? ??????? ?????? ???
+  &quot;The Aztec Temple&quot;. ????? ????, ??? ? ????????????? ?????? ???????, ???????? ??????????
+  ????? (???????? ? ?????? ??????????) ????????? ???????? ???? ???, ??? ? ????? ???????? ???????????.</p>
+
+  <p class="quote">? ??????? ??? ??? ???????? ????? (???-?? 3 ??????), ???? ?? ???????? ????
+  ???????? ?? VB(Visual Basic). ????? ??????? ? ???????? ???????????????? ????????? ???, ??? ??? ?????????.
+  ???????????????? ???? ?????????? ? ? ???????? &quot;The Aztec
+  Temple&quot;.</p>
+
+  <p class="quote">?? ????? ????, ? ?? ????????? ??????? ????? ???????.
+  ?? ? ???? ?????? ???? ????? ????, ? ? ????? ?? ??? ????????? ? ?????,
+  ?? ????, ??? ??? ??? ??????? ??????? ????? ? ????? ??????? ? ??????????????????.
+  ? ?????????? ????????? ???????? ?????? ? ??? ??????????????????, ? ??????? ??? ???????? ? ??????? ??????.</p>
+
+  <p class="quote">????? ? ???????? ?????? ??? ???????, ? ?????? ????
+  &quot;??????, ????? ???????????? ?? ???? ???????, ?? ??????? ?????&quot;. ?????
+  ? ???????, ??? ???? ????? ?????? ?????? ???? ?? ??????????? ???????????,
+  ???? ??? ??????? ?????? ???-?? ????????; ?????? ?????? ??? ??? ????????
+  ??????????. ? ???????, ??? ????? ?????? ???????, ????????? ??????? ?? ???????, ??????? ? ???
+  ????????. ????? ? ??????? ?????????????, ??? ?? ??????, ?? ??????,
+  ? ?????? ??????? ??? ??? ????. ? ??? ???? ?????
+  ?? ??????????? ??? ??? ????????? ????????.</p>
+
+  <p class="quote">? ???????, ??????? ?????????????? ?? ?????????? ????? ??????,
+  ?? ????? ???? ??? ??????? ???????????. ????? ? ???????? ?????? ???????,
+  ? ???????, ??? ???? ?? ??????? ????????? ??????, ??? ?? ?????
+  (??? ??? ?? ??????????? ?????? ???? ??????????, ??? ??? ??????? ? ????).
+  ??????? ? ????????? ??? ??????? ???????? ??????????? ?????????, ??? ?? ??????.
+  ????? ? ?????????? ? ??????????? ?????????????? ???????? ?????? ??????????? ????,
+  ?????????? ???????? ?????? ???? ?????? ?????????? ??????????.
+  ???????, ? ??????? ?????????? ????? ?????, ???????? ????????
+  &quot;Wild's Cage&quot;(&quot;????? ??????&quot;) ???? ?? ????. ? ???????
+  &quot;it-document&quot; ????? ? ??????????????? ?????????????? ??? ?????? ? ????????.</p>
+
+  <p class="quote">?????, ??? ? ??????? ??????? ????????????? ????????????????? ??????;
+  ??????, ? ???? ??? ?????? ??? ??? ????????? ??? ????????????
+  ???? ??? ?????????. ????? (??????? ????? ??????????? ??
+  mag-heut.net) ???? ???-?? ????? ??????? ??????????. ?? ??????????
+  ???????????, ??????? ?? ????? ?????, ???? ????????????.</p>
+  <p class="author">Dominik Lehmann</p>
+
+  <p>Dominik ????????? ?????? ?????? ??? ???????? ? ????????? ???? ??
+  ?????? ??????????? ??????. ?? ??????? ??? ? ?????? ????? ?????? ???????
+  - ???? ? ?? ? ?????? 1.01. ?? ?? ?????? ??????? ? ?????????? ???????,
+  ???? ?? ??????, ??? ??????? ?? ???????????? ??? ??????????? ???????????.
+  ??? ???????? ???????, ????????? ?????? ?? ??? ???????, ? ????? ???????? ????????????!
+  ??????? ???? ???????? Dominik ?? ????? ?????? ???????!</p>
+
+  <p>? ?????????,<br/>
+  <i>Andreas</i></p>
+
+</div>


Property changes on: homepage/input/lotm/lotm_200705_ru.html
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: homepage/input/lotm/lotm_core_ru.html
===================================================================
--- homepage/input/lotm/lotm_core_ru.html	2007-09-17 23:36:58 UTC (rev 884)
+++ homepage/input/lotm/lotm_core_ru.html	2007-09-23 12:30:23 UTC (rev 885)
@@ -2,8 +2,8 @@
 <h2>?????? ?????? -- ?????</h2>
 
   <p>?? ????? ?????? ????? ????? ?????????? ??????????????? 
-  ? ???????????? ???????. ???????????? ?????? ??? ??, ? ??????? ????????? ??????? ?????? ????????????
-  ? ?????? ????? ??????. ????????????? ??? ??? ?????. ??????? ?????????? ?????????? ??????,
+  ? ???????????? ???????. ???????????? ?????? ??? ??, ? ??????? ????????? ??????? ?????? ???????????? ? ??????
+  ????? ??????. ????????????? ??? ??? ?????. ??????? ?????????? ?????????? ??????,
   ?? ??????? ?? ??????? ? ?? ????????? ????????? ???? ?????? ?????? ? ???????????? ? ????? ??????? ??????.</p>
 
   <p>????? ??????????? ?????? ??????. ? ?????? ???? ??????? ???????? ???????? ?????????????,

Modified: homepage/input/lotm/lotm_header_ru.html
===================================================================
--- homepage/input/lotm/lotm_header_ru.html	2007-09-17 23:36:58 UTC (rev 884)
+++ homepage/input/lotm/lotm_header_ru.html	2007-09-23 12:30:23 UTC (rev 885)
@@ -1,7 +1,7 @@
 <h2>$$lotm_expansion$$</h2>
 
   <p>?? ????? ?????? ????? ????? ?????????? ??????????????? 
-  ? ???????????? ???????. ???????????? ?????? ??? ??, ? ??????? ????????? ??????? ?????? ????????????
-  ? ?????? ????? ??????. ????????????? ??? ??? ?????. ??????? ?????????? ?????????? ??????,
+  ? ???????????? ???????. ???????????? ?????? ??? ??, ? ??????? ??????? ?????? ????????????? ?????????
+  ? ?????? ????? ??????. ????????????? ??? ??? ?????. ??????? ?????????? ?????????? ??????,
   ?? ??????? ?? ??????? ? ?? ????????? ????????? ???? ?????? ?????? ? ???????????? ? ????? ??????? ??????. ?? ?????? ????? ???
   ?????????? ?????? ?????? ? ????? <a href="$$lotm$$">??????</a>.</p>



From andreasl at mail.berlios.de  Mon Sep 24 02:29:44 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Mon, 24 Sep 2007 02:29:44 +0200
Subject: [Enigma-game-svn] r886 - in trunk: data/levels/lib src
Message-ID: <200709240029.l8O0TiC7008293@sheep.berlios.de>

Author: andreasl
Date: 2007-09-24 02:29:43 +0200 (Mon, 24 Sep 2007)
New Revision: 886

Modified:
   trunk/data/levels/lib/libsoko.xml
   trunk/src/stones.cc
   trunk/src/stones.hh
   trunk/src/stones_complex.cc
   trunk/src/stones_simple.cc
Log:
freezechecks:
 - use freeze check for standard movables only
 - more comments
 - is_movable isn't virtual anymore
 - corrections to traits of two stones   
libsoko:
 - cleanup of set_element
 - use "create_sokoball" to create a complete level,
   and "draw_sokoball" to draw a sokoball into an
   existing level
 - libsoko now uses the C++-freeze check
   Note: Some stones are not working properly yet,
         like st-wood-growing or st-shogun-s.
 - support of multilevel files: Levels can be separated
   by comments as well as empty lines or lines filled
   with spaces.
 - better but still inappropriate end phase: 12 oxyds
   instead of 4, plus st-fart
 - padding of levels


Modified: trunk/data/levels/lib/libsoko.xml
===================================================================
--- trunk/data/levels/lib/libsoko.xml	2007-09-23 12:30:23 UTC (rev 885)
+++ trunk/data/levels/lib/libsoko.xml	2007-09-24 00:29:43 UTC (rev 886)
@@ -166,6 +166,8 @@
 endphase_started = false
 levelw = 0
 levelh = 0
+level_array = {}
+chosen_design = default_design
 
 ------------------------------------------------------------------------
 -- Tools
@@ -188,6 +190,29 @@
 function is_friction(s)   return string.sub(s, 1, 3) == "fr:"  end
 function is_mouseforce(s) return string.sub(s, 1, 3) == "mf:"  end
 
+-- combine_tables returns a table consisting of all entries of the
+-- entries of OVER_TABLE: OVER_TABLE is a table of tables, say
+-- {T1, T2, T3, ...}. The result of combine_tables will be a new
+-- table with all entries of T1, T2, T3 etc., with the first table
+-- having highest priority etc.
+function combine_tables(over_table)
+  if type(over_table) ~= "table" then
+    myerror("libsoko.combine_tables: Argument is no table!")
+  end
+  local result = {}
+  for j,t in pairs(over_table) do
+    if type(t) ~= "table" then
+      myerror("libsoko.combine_tables: Argument does not consist of tables alone!")
+    end
+    for k,v in pairs(t) do
+      result[k] = result[k] or v
+    end
+  end
+  return result
+end
+
+-- choose_among_multiples selects a number between 1 and COUNT
+-- based on the coordinates X and Y and the algorithm's name ALG.
 function choose_among_multiples(x, y, count, alg)
   if alg == "checkerboard" then
     return math.mod(mod(x,2)+mod(y,2), count) + 1
@@ -200,42 +225,26 @@
   end
 end
 
--- set_element sets element EL over the base ELFLOOR at x, y.
--- ELFLOOR may be nil, then it's considered to be default_design.outf
-function set_element(x, y, el, elFloor)
-  local elf = elFloor or default_design.outf
-  local ela = el or elf
-  
+-- set_element sets element name EL_STR of design DESIGN at x, y.
+function set_element(x, y, design, el_str)
+  local el = design[el_str]
+
   if (type(x) ~= "number") or (type(y) ~= "number") then
-    myerror("set_element: Coordinates are not numbers!")
+    myerror("libsoko.set_element: Coordinates are not numbers!")
     return
   end
-  
-  if type(ela) == "string"  then  ela = {ela}  end
-  if type(elf) == "string"  then  elf = {elf}  end
-  
-  local fl = {}     local fl0 = {}
-  local st = {}     local st0 = {}
-  local it = {}     local it0 = {}
+
+  if type(el) == "string"  then  el = {el}  end
+
+  local fl = {}
+  local st = {}
+  local it = {}
   local multiple_alg = "checkerboard"
   local friction = nil
   local mousefactor = nil
 
-  -- Analyse ELFLOOR first: Decompose its entries into fl0,st0,it0.
-  for j, s in pairs(elf) do
-        if is_floor(s)       then  table.insert(fl0, s)
-    elseif is_stone(s)       then  table.insert(st0, s)
-    elseif is_item(s)        then  table.insert(it0, s)
-    elseif is_algorithm(s)   then  multiple_alg = string.sub(s, 4, -1)
-    elseif is_friction(s)    then  friction = tonumber(string.sub(s, 4, -1))
-    elseif is_mousefactor(s) then  mousefactor = tonumber(string.sub(s, 4, -1))
-    else
-      mywarning("Unknown entry "..s.." in design element.")
-    end    
-  end
-  
   -- Now analyse EL: Decompose its entries into fl,st,it.
-  for j, s in pairs(ela) do
+  for j, s in pairs(el) do
         if is_floor(s)       then  table.insert(fl, s)
     elseif is_stone(s)       then  table.insert(st, s)
     elseif is_item(s)        then  table.insert(it, s)
@@ -244,13 +253,8 @@
     elseif is_mousefactor(s) then  mousefactor = tonumber(string.sub(s, 4, -1))
     else
       mywarning("Unknown entry "..s.." in design element.")
-    end    
+    end
   end
-  
-  -- If fl,st,it is empty, replace it with fl0,st0,it0, respectively.
-  if  table.getn(fl) == 0  then  fl = fl0  end
-  if  table.getn(st) == 0  then  st = st0  end
-  if  table.getn(it) == 0  then  it = it0  end
 
   local created_objects = {}
 
@@ -265,7 +269,7 @@
       enigma.SetAttrib(created_objects.fl, "mousefactor", mousefactor)
     end
   end
-  
+
   ----------- stone ---------------
   if table.getn(st) > 0 then
     local stkind = st[choose_among_multiples(x, y, table.getn(st), multiple_alg)]
@@ -280,11 +284,81 @@
     if itkind ~= "it-none" then
       created_objects.it = set_item(itkind, x, y)
     end
-  end  
+    if created_objects.it then
+      enigma.SetAttrib(created_objects.it, "action", "callback")
+      enigma.SetAttrib(created_objects.it, "target", "goal_trigger")
+      enigma.SetAttrib(created_objects.it, "box", 0)
+      number_goals = number_goals + 1
+    end
+  end
   
   return created_objects
 end
 
+-- draw_level_array draws a sokoball level from global variable LEVEL_ARRAY
+-- with design CHOSEN_DESIGN (global var, a ready-for-use design table)
+-- at offset DX, DY. If OUTSIDE is true, the outside will be drawn as well.
+-- draw_level_array will NOT
+--  - create the world
+--  - set global variables
+--  - prepare oxyds
+--  - solve the level
+-- This function is not intended to be used in level programming
+-- directly, use "draw_sokoball" instead.
+function draw_level_array(dx, dy, outside)
+  local array_width = table.getn(level_array[1])
+  local array_height = table.getn(level_array)
+
+  -- create level
+  for y = 0, array_height - 1 do
+    for x = 0, array_width - 1 do
+      local ch = level_array[y+1][x+1]
+      local obj = {}
+      
+      -- set floor outside or floor inside
+      if (ch == " ") then -- note: space stands for outside, "-" for inside!
+        if outside then
+          kill_stone(x+dx, y+dy)
+          kill_item(x+dx, y+dy)
+          set_element(x+dx, y+dy, chosen_design, "outf")
+        end
+      else
+        kill_stone(x+dx, y+dy)
+        kill_item(x+dx, y+dy)
+        obj = set_element(x+dx, y+dy, chosen_design, "inf")
+        enigma.SetAttrib(obj.fl, "freeze_check", true)
+      end
+      
+      -- Walls
+      if (ch == "#") then
+        obj = set_element(x+dx, y+dy, chosen_design, "wall")
+      end
+      
+      -- Goals
+      if (ch == "+") or (ch == "*") or (ch == ".") or (ch == "N") then
+        obj = set_element(x+dx, y+dy, chosen_design, "goal")
+        enigma.SetAttrib(enigma.GetFloor(x+dx, y+dy), "freeze_check", false)
+      end
+      
+      -- Boxes
+      if (ch == "$") or (ch == "*") then
+        obj = set_element(x+dx, y+dy, chosen_design, "box")
+        enigma.SetAttrib(obj.st, "freeze_check", true)
+      end
+      
+      -- Chess-Stones
+      if (ch == "n") or (ch == "N") then
+        set_stone("st-chess_black", x, y)
+      end
+      
+      -- Actors
+      if (ch == "@") or (ch == "+") then
+        set_actor("ac-blackball", x + 0.5 + dx, y + 0.5 + dy, { name = "marble" })
+      end
+    end
+  end  
+end
+
 -- Sokoban level strings are typically a string with the following characters:
 --        # = Wall
 --        @ = Player
@@ -301,17 +375,54 @@
 --        N = st-chess_black/white on goal square
 --
 -- This format has to be transcoded to an array, which is done by unpack_level.
+-- Furthermore the string LEVEL can hold several levels (it's a multilevel),
+-- in which case SUBLEVEL determines the number of the level to unpack.
+-- Default of SUBLEVEL is 1.
 --
-function unpack_level(level)
-  if type(level) ~= "string" then
+function unpack_level(multilevel, sublevel_number)
+  if type(multilevel) ~= "string" then
     myerror("Can't make sense of level type "..type(level)..".")
   end
-  local level_array = {}
+  local current_level = 0
+  local level = ""
+
+  -- search the correct sublevel by pattern matching, line for line
+  local level_line_match = 
+      "[ \-\#\_\$\.@\*0-9Nn\+]*"  -- all allowed characters except line ending
+    .."[\#\$\.@\*Nn\+]+"          -- at least one non-space character
+    .."[ \-\#\_\$\.@\*0-9Nn\+]*"  -- again all allowed characters except line ending
+  local in_level = false
+  for line in string.gfind(multilevel, "[^\n\|]+") do
+    if string.match(line, level_line_match) == line then
+      if in_level then
+        if current_level == (sublevel_number or 1) then
+          level = level..line.."\n"
+        end
+      else
+        -- we just entered a new level
+        in_level = true
+        current_level = current_level + 1
+        if current_level == (sublevel_number or 1) then
+          level = line.."\n"
+        end
+      end
+    else
+      in_level = false
+    end
+  end
   
+  mydebug(level)
+  
+  if level == "" then
+    myerror("libsoko.unpack_level: Multilevel holds less than "
+            ..sublevel_number.." levels!")
+  end
+
   -- parse the string LEVEL
+  level_array = {}
   local line = 1
   level_array[line] = {}
-  local count = 0
+  local count = 0   -- (a simple counter for runlength encoding)
   for j = 1, string.len(level) do
     local ch = string.sub(level, j, j)
     if tonumber(ch) then
@@ -326,8 +437,12 @@
       end
     else
       -- unify format: "_" and space become "-"
-      if (ch == "_") or (ch == " ")  then  ch = "-"  end
-      if count < 1  then  count = 1  end
+      if (ch == "_") or (ch == " ") then
+        ch = "-"
+      end
+      if count < 1 then
+        count = 1
+      end
       for j = 1, count do
         table.insert(level_array[line], ch)
       end
@@ -357,7 +472,7 @@
   if lastline < 2 then
     myerror("Length of sokoball level is only "..lastline.."!")
   end
-  mywarning("Sokoball level height: "..lastline)
+  mydebug("Sokoball level height: "..lastline)
   
   -- normalize level width
   local maxwidth = 0
@@ -392,6 +507,8 @@
   return level_array
 end
 
+
+
 ------------------------------------------------------------------------
 -- Choosing the Designnumber
 ------------------------------------------------------------------------
@@ -529,79 +646,28 @@
   return design_list[number_from_level(level_array, table.getn(design_list))]
 end
 
-------------------------------------------------------------------------
--- Determining Lethal Positions
-------------------------------------------------------------------------
-
--- maybe_stdeath checks the stone at position x,y. If it is a box
--- and not standing on a goal, it becomes st-death, counted as a wall.
-function maybe_stdeath(x, y)
-  local st = enigma.GetStone(x, y)
-  if st and (enigma.GetAttrib(st, "soko_kind") == "box") then
-    local it = enigma.GetItem(x, y)
-    if (not it) or (enigma.GetAttrib(it, "soko_kind") ~= "goal") then
-      st = set_stone("st-death", x, y, { soko_kind = "wall" })
-      enigma.EmitSound(st, "stonetransform")
-    end
+-- design_from_description takes a description of the design as argument
+-- and returns the corresponding table. A description can be:
+--  - a table specifying the design by itself
+--  - a number specifying the number of the design in the design list
+--  - "nil" plus a level_array from which a design from the design
+--    list will be chosen.
+function design_from_description(design, level_array)
+  -- choose design
+  local chosen_design = {}
+  if type(design) == "number" then
+    chosen_design = design_list[design]
+  elseif type(design) == "table" then
+    chosen_design = design
+  elseif (type(design) == "nil") and (type(level_array) == "table") then
+    chosen_design = design_from_level(level_array)
+  else
+    myerror("Can't make sense of design type "..type(design)..".")
   end
+  -- fill chosen design with default values where neccessary, and return
+  return combine_tables({chosen_design, default_design})
 end
 
--- check_lethal searchs the level for lethal formations of walls
--- and boxes (excluding st-chess), and transforms involved boxes
--- into st-death. Lethal are quadrats and formations of the kind
---   Box   Wall
---   Wall  ?
--- ("diagonal death").
-function check_lethal(onoff, sender)
-  local x1 = enigma.GetAttrib(sender, "x1")
-  local x2 = enigma.GetAttrib(sender, "x2") - 1
-  local y1 = enigma.GetAttrib(sender, "y1")
-  local y2 = enigma.GetAttrib(sender, "y2") - 1
-  -- Note: Coordinates are reduced by 1 as we search 2x2-combinations.
-  for x = x1, x2 do
-    for y = y1, y2 do    
-      local st = {}
-      local sk = {}
-      st[1] = enigma.GetStone(x, y)
-      st[2] = enigma.GetStone(x + 1, y)
-      st[3] = enigma.GetStone(x, y + 1)
-      st[4] = enigma.GetStone(x + 1, y + 1)
-      for j = 1, 4 do
-        if st[j] then
-          sk[j] = enigma.GetAttrib(st[j], "soko_kind")
-        else
-          sk[j] = "empty"
-        end
-      end
-      -- Test for squares
-      if st[1] and st[2] and st[3] and st[4] then
-        local is_square = true
-        for j = 1, 4 do
-          is_square = is_square and ((sk[j] == "box") or (sk[j] == "wall"))
-        end
-        if is_square then
-          maybe_stdeath(x, y)
-          maybe_stdeath(x + 1, y)
-          maybe_stdeath(x, y + 1)
-          maybe_stdeath(x + 1, y + 1)
-        end
-      end
-      -- Test for diagonal death
-      -- Note: sk[j] might not be correct anymore. However, the only
-      --       change is in that "box" might have turned into "wall",
-      --       which can't impair diagonal death.
-      if (sk[1] == "wall") and (sk[4] == "wall") then
-        maybe_stdeath(x + 1, y)
-        maybe_stdeath(x, y + 1)
-      end
-      if (sk[2] == "wall") and (sk[3] == "wall") then
-        maybe_stdeath(x, y)
-        maybe_stdeath(x + 1, y + 1)
-      end      
-    end
-  end  
-end
-
 ------------------------------------------------------------------------
 -- Goal Trigger and Oxyd Opening (Endphase)
 ------------------------------------------------------------------------
@@ -612,12 +678,10 @@
     if enigma.GetStone(x,y) then
       enigma.SetAttrib(sender, "box", 1)
       goals_filled = goals_filled + 1
-      mydebug(goals_filled)
     end
   else
     enigma.SetAttrib(sender, "box", 0)
     goals_filled = goals_filled - 1
-    mydebug(goals_filled)  
   end
   if (goals_filled == number_goals) and not endphase_started then
     endphase_started = true
@@ -630,10 +694,24 @@
 
 function endphase()
   local x, y = enigma.GetPos(enigma.GetNamedObject("marble"))
-  oxyd(x+1, y)
-  oxyd(x-1, y)
-  oxyd(x, y+1)
-  oxyd(x, y-1)
+  if x > 10 then
+    x = x - 2
+  end
+  if y > 6 then
+    y = y - 2
+  end
+  for j = 0, 2 do
+    oxyd(x+j, y-1)
+    oxyd(x-1, y+j)
+    oxyd(x+j, y+3)
+    oxyd(x+3, y+j)
+    for k = 0, 2 do
+      kill_stone(x+j, y+k)
+      kill_item(x+j, y+k)
+      set_element(x+j, y+k, chosen_design, "inf")
+    end
+  end
+  set_stone("st-fart", x+1, y+1)
   oxyd_shuffle()
 end
 
@@ -649,111 +727,86 @@
 
 
 ------------------------------------------------------------------------
--- Main function
+-- Interface functions
 ------------------------------------------------------------------------
 
 -- create_sokoball creates a sokoball-level from the string LEVEL.
+-- This string can be a multilevel, in which case SUBLEVEL determines
+-- the number of the level, starting with 1. Default is 1.
 -- The design can be chosen by the DESIGN variable. This is either
--- a number (see section "Designs") or a table with the correspondinfg
+-- a number (see section "Designs") or a table with the corresponding
 -- design entries. A missing entry will be interpreted as the entry
 -- from default_design. If the DESIGN variable is omitted, a check-
 -- number is created from LEVEL which uniquely* determines a design
 -- from the design list. *Uniquely means: The design might change
 -- when the design list is enlarged.
-
-function create_sokoball(level, design)
+--
+function create_sokoball(level, sublevel, design)
   -- unpack level
-  local level_array = unpack_level(level)
+  level_array = unpack_level(level, sublevel)
 
   -- calculate screen position
   -- Important Note: level_array is reversely indexed, i.e.
   --                 level_array[y-coordinate][x-coordinate]
-  array_width = table.getn(level_array[1])
-  array_height = table.getn(level_array)
+  local array_width = table.getn(level_array[1])
+  local array_height = table.getn(level_array)
   levelw = math.max(array_width, 20)
   levelh = math.max(array_height, 13)
   create_world(levelw, levelh)
+  
+  -- Calculate padding
   local dx = 0
   local dy = 0
+  if levelw > array_width then
+    dx = math.floor((levelw - array_width) / 2)
+  end
+  if levelh > array_height then
+    dy = math.floor((levelh - array_height) / 2)
+  end
   
-  -- choose design
-  local chosen_design = {}
-  if type(design) == "number" then
-    chosen_design = design_list[design]
-  elseif type(design) == "table" then
-    chosen_design = design
-  elseif type(design) == "nil" then
-    chosen_design = design_from_level(level_array)
-  else
-    myerror("Can't make sense of design type "..type(design)..".")
-  end
+  chosen_design = design_from_description(design, level_array)
 
-  -- determine oxop (way to open oxyds)
-  local oxop = chosen_design.oxop or default_design.oxop
-
-  -- create level
-  for y = 0, levelh - 1 do
-    for x = 0, levelw - 1 do
-      set_element(x, y, chosen_design.outf, default_design.outf)
+  for x = 0, levelw - 1 do
+    for y = 0, levelh - 1 do
+      set_element(x, y, chosen_design, "outf")
     end
   end
   
-  for y = 0, array_height - 1 do
-    for x = 0, array_width - 1 do
-      local ch = level_array[y+1][x+1]
-      local obj = {}
-      if (ch ~= " ") then  --- note: space stands for outside, "-" for inside!
-        kill_stone(x + dx, y + dy)
-        set_element(x + dx, y + dy, chosen_design.inf, default_design.inf)
-      end
-      if (ch == "#") then
-        obj = set_element(x+dx, y+dy, chosen_design.wall, default_design.wall)
-        if obj.st then
-          enigma.SetAttrib(obj.st, "soko_kind", "wall")
-        end
-      end
-      if (ch == "+") or (ch == "*") or (ch == ".") or (ch == "N") then
-        obj = set_element(x+dx, y+dy, chosen_design.goal, default_design.goal)
-        if obj.it then
-          enigma.SetAttrib(obj.it, "soko_kind", "goal")
-          enigma.SetAttrib(obj.it, "action", "callback")
-          enigma.SetAttrib(obj.it, "target", "goal_trigger")
-          enigma.SetAttrib(obj.it, "box", 0)
-          number_goals = number_goals + 1
-        end
-      end
-      if (ch == "$") or (ch == "*") then
-        obj = set_element(x+dx, y+dy, chosen_design.box, default_design.box)
-        if obj.st then
-          enigma.SetAttrib(obj.st, "soko_kind", "box")
---          enigma.SetAttrib(obj.st, "freeze_check", true)
-        end
-      end
-      if (ch == "n") or (ch == "N") then
-        set_stone("st-chess_black", x, y, { soko_kind = "st-chess" })
-      end
-      if (ch == "@") or (ch == "+") then
-        set_actor("ac-blackball", x + 0.5 + dx, y + 0.5 + dy, { name = "marble" })
-      end
-    end
-  end
+  draw_level_array(dx, dy, true)
 
   if number_goals < 1 then
     myerror("No goals defined!\n")
   end
 
+  -- determine oxop (way to open oxyds)
+  local oxop = chosen_design.oxop
   prepare_oxyds(oxop)
-  
-  set_stone("st-timer", 0, 0, {invisible = true, interval = 0.5,
-                               action = "callback", target = "check_lethal",
-                               x1 = dx, x2 = array_width - 1 + dx,
-                               y1 = dy, y2 = array_height - 1 + dy})
-  
+
   enigma.ShowMoves = TRUE
-  enigma.SetFollowMode = (display.FOLLOW_SMOOTH)
+  display.SetFollowMode(display.FOLLOW_SMOOTH)
   enigma.ConserveLevel = FALSE
 end
 
+-- draw_sokoball draws a sokoball level from argument LEVEL with design
+-- DESIGN (see create_sokoball) at offset DX, DY. It's arguments are
+-- identical to those of create_sokoball. Whereas create_sokoball should
+-- be used for sokoball-only levels, draw_sokoball can be used to add a
+-- sokoban type area to a larger level. The difference is as follows:
+-- draw_sokoball will NOT:
+--  - create the world before drawing to it
+--  - draw the outside, such that it doesn't overwrite the rest of your
+--    level
+--  - solve the level when all triggers are activated.
+-- Note: Overwriting one sokoball part by another creates problems
+--       with the triggers.
+--
+function draw_sokoball(dx, dy, level, sublevel, design)
+  -- unpack level
+  level_array = unpack_level(level, sublevel)
+  chosen_design = design_from_description(design, level_array)
+  draw_level_array(dx, dy, false)
+end
+
     ]]></el:luamain>
     <el:i18n>
     </el:i18n>

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2007-09-23 12:30:23 UTC (rev 885)
+++ trunk/src/stones.cc	2007-09-24 00:29:43 UTC (rev 886)
@@ -233,9 +233,11 @@
     Floor *fl = GetFloor(this_pos);
     if ((fl == NULL) || (!fl->is_freeze_check()))
         return false;
+    // Do freeze checks only with standard movables
+    if (this->get_freeze_bits() != FREEZEBIT_STANDARD)
+        return false;
 
-    // Query movable status of neighboring stones
-
+    // Query persistence status of neighboring stones
     FreezeStatusBits ms_n  = get_freeze_bits(move(this_pos, NORTH));
     FreezeStatusBits ms_nw = get_freeze_bits(move(move(this_pos, NORTH), WEST));
     FreezeStatusBits ms_ne = get_freeze_bits(move(move(this_pos, NORTH), EAST));
@@ -245,9 +247,27 @@
     FreezeStatusBits ms_sw = get_freeze_bits(move(move(this_pos, SOUTH), WEST));
     FreezeStatusBits ms_se = get_freeze_bits(move(move(this_pos, SOUTH), EAST));
 
-    // First check: Diagonals with persistent stones
-    // Second check: Squares of arbitrary stones
-    // Third check: Two movables, encased by two persistent
+    // The following if-construction searches for freeze-patterns.
+    // Each block is one pattern, each line represents one
+    // orientation of this pattern.
+    //
+    // First block: #    Centered at the box "$", there are four orientations
+    //              $#   of this pattern.
+    // 
+    // Second block: $$  Each of the "$" can be movable or persistent.
+    //               $$  Centered at one of them, there are again four
+    //                   different orientation.
+    //
+    // Third block: #$   This pattern has eight orientations: Fix one of
+    //               $#  the boxes. The adjacent persistent stone has four
+    //                   possibilities, the adjacent movable has two choices
+    //                   for each position of the persistent. The final
+    //                   persistent is fixed in its position by the other
+    //                   two stones.
+    //
+    // The variables P and PM are abbreviations for "persistent"
+    // and "persistent or movable". Example: "ms_e & p" checks
+    // if the stone east of THIS is persistent.
     int p = FREEZEBIT_PERSISTENT;
     int pm = FREEZEBIT_PERSISTENT | FREEZEBIT_STANDARD;
     if(   ((ms_n & p) && (ms_e & p))
@@ -284,7 +304,9 @@
             st->freeze_check();
         if (Stone *st = GetStone(this_pos))
             st->freeze_check_running = false;
+        return true;
     }
+    return false;
 }
 
 

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2007-09-23 12:30:23 UTC (rev 885)
+++ trunk/src/stones.hh	2007-09-24 00:29:43 UTC (rev 886)
@@ -176,7 +176,7 @@
         virtual StoneResponse collision_response(const StoneContact &sc);
 
         /*! Is this stone movable? Affects impulse-stones, fire, ordinary pushes... */
-        virtual bool   is_movable() const {
+        bool   is_movable() const {
             return get_traits().movable >= MOVABLE_STANDARD;
         }
 

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2007-09-23 12:30:23 UTC (rev 885)
+++ trunk/src/stones_complex.cc	2007-09-24 00:29:43 UTC (rev 886)
@@ -2221,11 +2221,6 @@
             Stone::on_move();
         }
 
-        bool is_movable() const {
-            // moving the stone is handled explicitly in actor_hit()
-            return false; //true;
-        }
-
         // Variables.
         bool repulse;
     };

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2007-09-23 12:30:23 UTC (rev 885)
+++ trunk/src/stones_simple.cc	2007-09-24 00:29:43 UTC (rev 886)
@@ -714,7 +714,7 @@
     private:
         FreezeStatusBits get_freeze_bits() { return FREEZEBIT_NO_STONE; }
     };
-    DEF_TRAITSM(Stone_movebreak, "st-rock3_movebreak", st_movebreak, MOVABLE_STANDARD);
+    DEF_TRAITSM(Stone_movebreak, "st-rock3_movebreak", st_movebreak, MOVABLE_IRREGULAR);
 }
 
 //----------------------------------------
@@ -2244,7 +2244,7 @@
         FreezeStatusBits get_freeze_bits() { return FREEZEBIT_NO_STONE; }        
     };
     DEF_TRAITSM(Stone_movefirebreak, "st-firebreak_move", st_firebreak_move,
-                MOVABLE_STANDARD);
+                MOVABLE_IRREGULAR);
 }
 
 



From andreasl at mail.berlios.de  Mon Sep 24 23:31:06 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Mon, 24 Sep 2007 23:31:06 +0200
Subject: [Enigma-game-svn] r887 - in homepage: . images/lotm input input/lotm
Message-ID: <200709242131.l8OLV65h001181@sheep.berlios.de>

Author: andreasl
Date: 2007-09-24 23:31:04 +0200 (Mon, 24 Sep 2007)
New Revision: 887

Added:
   homepage/input/lotm/lotm_200710.html
Modified:
   homepage/images/lotm/lotm-history.png
   homepage/input/lotm/lotm_archive_data.lua
   homepage/input/lotm/read_lotm.lua
   homepage/input/lotm/transform_scores.lua
   homepage/input/output-files.lua
   homepage/main.lua
Log:
Homepage:
 - entered spanish strings into output-files.lua (from Xabier)
 - special date structure for Spanish months, like "Agusto del '07"
     (implement such specifics in main.lua -> translate_month)
 - corrected typo: Impressum -> Imprint
 - separated static and variable data in lotm-archive-data.lua:
     Ratings, votes and additional text are now located in a common
     structure at the end of the file to easily update them.
 - preparations for LotM October 2007:
    - archive data
    - English article stub
 - adapted "transform_scores"-script to new Java-output.


Modified: homepage/images/lotm/lotm-history.png
===================================================================
(Binary files differ)

Added: homepage/input/lotm/lotm_200710.html
===================================================================
--- homepage/input/lotm/lotm_200710.html	2007-09-24 00:29:43 UTC (rev 886)
+++ homepage/input/lotm/lotm_200710.html	2007-09-24 21:31:04 UTC (rev 887)
@@ -0,0 +1,58 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">October 2007: </span>
+    &quot;Quadropolis&quot;, Community Efforts Level I
+  </h3>
+
+  <h4>
+    by Johannes Laire, Jacob Scott, Raoul Bourquin and Andreas Lochmann
+  </h4>
+  
+  <p>I</p>
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200710_a.png" alt="Level of the month" border="0">
+    <div class="imagetitle">Enigma VI # 79</div>
+  </div>
+
+  <table cellpadding="0" cellspacing="1" class="statistics">
+    <caption class="normalcaption">Some records of August 2007</caption>
+    <colgroup>
+       <col width="80">
+       <col width="160">
+    </colgroup>
+    <tr><td class="num">12:05</td>
+        <td class="left">Duffy</td></tr>
+    <tr><td class="num">15:45</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">16:56</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">28:13</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">39:04</td>
+        <td class="left">shoki</td></tr>  
+  </table>
+  
+  <p>A</p>
+
+  <h4>&quot;I&quot;</h4>
+
+  <p>U</p>
+
+  <div class="lotmpic">
+    <img src="$$imagedir$$/lotm/lotm_200710_b.png" alt="Level of the month" border="0">
+    <div class="imagetitle">L</div>
+  </div>
+  
+  <p>O</p>
+
+  <div class="quote">
+  I</div>
+  <div class="author">M</div>
+
+  <p>Greets,<br/>
+  <i>Harry</i></p>
+
+</div>

Modified: homepage/input/lotm/lotm_archive_data.lua
===================================================================
--- homepage/input/lotm/lotm_archive_data.lua	2007-09-24 00:29:43 UTC (rev 886)
+++ homepage/input/lotm/lotm_archive_data.lua	2007-09-24 21:31:04 UTC (rev 887)
@@ -1,93 +1,97 @@
 
+-- LotM standing data
+-- (no need to change these)
+
 lotm_archive_data = {}
 
 lotm_archive_data[1] = {
-  current_rating = 9.13,
-  current_votes  = 8,
   date           = { month = 3, year = 2007 },
   chronological  = 1,
   name           = "Island Labyrinth",
-  addition       = "(1 down)",
   author         = "Jacob Scott",
   position       = "V/100",
   position_num   = "5100"
 }
 
 lotm_archive_data[2] = {
-  current_rating = 7.78,
-  current_votes  = 17,
   date           = { month = 4, year = 2007 },
   chronological  = 2,
   name           = "Pneumatic Delivery",
-  addition       = "",
   author         = "Manuel K&ouml;nig",
   position       = "V/59",
   position_num   = "5059"
 }
 
 lotm_archive_data[3] = {
-  current_rating = 9.17,
-  current_votes  = 6,
   date           = { month = 5, year = 2007 },
   chronological  = 3,
   name           = "The Aztec Temple",
-  addition       = "(1 up)",
   author         = "Dominik Lehmann",
   position       = "VI/100",
   position_num   = "6100"
 }
 
 lotm_archive_data[4] = {
-  current_rating = 8.83,
-  current_votes  = 12,
   date           = { month = 6, year = 2007 },
   chronological  = 4,
   name           = "Labyrinth of Puzzles",
-  addition       = "",
   author         = "Jacob Scott",
   position       = "IV/19",
   position_num   = "4019"
 }
 
 lotm_archive_data[5] = {
-  current_rating = 8.57,
-  current_votes  = 7,
   date           = { month = 7, year = 2007 },
   chronological  = 5,
   name           = "Elaborate",
-  addition       = "",
   author         = "Jacob Scott",
   position       = "V/65",
   position_num   = "5065"
 }
 
 lotm_archive_data[6] = {
-  current_rating = 8.89,
-  current_votes  = 9,
   date           = { month = 8, year = 2007 },
   chronological  = 6,
   name           = "Houdini",
-  addition       = "",
   author         = "Ronald Lamprecht",
   position       = "VI/74",
   position_num   = "6074"
 }
 
 lotm_archive_data[7] = {
-  current_rating = 8.46,
-  current_votes  = 13,
   date           = { month = 9, year = 2007 },
   chronological  = 7,
   name           = "Tool Time",
-  addition       = "<b>(newcomer)</b>",
   author         = "Barry &amp; Lori Mead",
   position       = "II/97",
   position_num   = "2097"
 }
 
+lotm_archive_data[8] = {
+  date           = { month = 10, year = 2007 },
+  chronological  = 8,
+  name           = "Quadropolis",
+  author         = "J.Laire, J.Scott, R.Bourquin, A.Lochmann",
+  position       = "VI/79",
+  position_num   = "6079"
+}
+
+-- LotM variable data
+-- format: Level Title, current_rating, current_votes, additional text
+
+lotm_rating(    "Island Labyrinth",  9.25,   8,  "(1 up)")
+lotm_rating(  "Pneumatic Delivery",  7.58,  24,  "")
+lotm_rating(    "The Aztec Temple",  9.14,   7,  "(1 down)")
+lotm_rating("Labyrinth of Puzzles",  8.92,  13,  "(1 up)")
+lotm_rating(           "Elaborate",  8.50,   8,  "")
+lotm_rating(             "Houdini",  8.86,  11,  "(1 down)")
+lotm_rating(           "Tool Time",  8.43,  14,  "")
+lotm_rating(         "Quadropolis",  9.40,   5,  "<b>(newcomer)</b>")
+
 -- Don't forget to adjust the archive dates:
 
-lotm_archive_data_from = { month = 7, year = 2007 }
+lotm_archive_data_from = { month = 8, year = 2007 }
 
 lotm_current = lotm_archive_data[table.getn(lotm_archive_data)]
 
+

Modified: homepage/input/lotm/read_lotm.lua
===================================================================
--- homepage/input/lotm/read_lotm.lua	2007-09-24 00:29:43 UTC (rev 886)
+++ homepage/input/lotm/read_lotm.lua	2007-09-24 21:31:04 UTC (rev 887)
@@ -77,3 +77,20 @@
   end
 end
 
+-- Add ratings and additional texts to LotM-entries
+function lotm_rating(title, rating, votes, addition)
+  local found = false
+  for k, v in pairs(lotm_archive_data) do
+    if v.name == title then
+      if found then
+        error ("Name collision for LotM article "..title.."!")
+      else
+        v.current_rating = rating
+        v.current_votes = votes
+        v.addition = (v.addition or "")..(addition or "")
+        found = true
+      end
+    end
+  end
+end
+

Modified: homepage/input/lotm/transform_scores.lua
===================================================================
--- homepage/input/lotm/transform_scores.lua	2007-09-24 00:29:43 UTC (rev 886)
+++ homepage/input/lotm/transform_scores.lua	2007-09-24 21:31:04 UTC (rev 887)
@@ -1,7 +1,8 @@
 -- Transforms the java-generated score list into
 -- an html-compliant form for LotM articles.
 
--- The lines are constructed as "SECONDS  NAME", with *two* spaces.
+-- The lines are constructed as "SECONDS  MINUTES:SECONDS  NAME",
+-- with *two* spaces each time.
 -- Output is:
 --  "    <tr><td class="num">MINUTES:SECONDS</td>"
 --  "        <td class="left">NAME</td></tr>"
@@ -13,13 +14,28 @@
 repeat
   line = io.read("*l")
   if line then
+    -- remove leading spaces
+    while string.sub(line, 1, 1) == " " do
+      line = string.sub(line, 2)
+    end
+    -- decompose line
     local space_position = string.find(line, " ")
-    local number = tonumber(string.sub(line, 1, space_position - 1))
-    local name = string.sub(line, space_position + 2)
+    local number_str = string.sub(line, 1, space_position - 1)
+    local remaining = string.sub(line, space_position + 2)
+          space_position = string.find(remaining, " ")
+    local time_str = string.sub(remaining, 1, space_position - 1)
+    local name = string.sub(remaining, space_position + 2)      
+    -- calculate time string from first number
+    local number = tonumber(number_str)
     local seconds = mod(number, 60)
     local minutes = (number - seconds) / 60
     local sec_str = string.format("%02d", seconds)
-    io.write("    <tr><td class=\"num\">"..minutes..":"..sec_str.."</td>\n")
+    local other_time_str = minutes..":"..sec_str
+    -- if time strings are not equal, throw an error
+    if time_str ~= other_time_str then
+      error("Times don't match in line: "..line)
+    end
+    io.write("    <tr><td class=\"num\">"..time_str.."</td>\n")
     io.write("        <td class=\"left\">"..name.."</td></tr>\n")
   end
 until line == nil

Modified: homepage/input/output-files.lua
===================================================================
--- homepage/input/output-files.lua	2007-09-24 00:29:43 UTC (rev 886)
+++ homepage/input/output-files.lua	2007-09-24 21:31:04 UTC (rev 887)
@@ -33,7 +33,7 @@
     title_de = "Enigma Hauptseite",
     --fr-- title_fr = "Enigma Homepage",
     title_ru = "???????? ???????? Enigma",
-    --sp-- title_es = "Enigma Homepage",
+    title_es = "P&aacute;gina principal de Enigma",
     refman = "manual/enigma-ref.html",
     manual = "manual/enigma.html",
     manual_de = "manual/enigma_de.html",
@@ -79,6 +79,7 @@
     lotm_expansion = "Level of the Month",
     lotm_expansion_de = "Level des Monats",
     lotm_expansion_ru = "??????? ??????",
+    lotm_expansion_es = "Nivel de este mes",
     --es-- lotm_expansion_es = "",
 
     lotm_anchor_rating   = "<a href=\"$$lotm$$\">Rating</a>",
@@ -99,9 +100,16 @@
     lotm_anchor_author_ru   = "?????",
     lotm_anchor_position_ru = "<a href=\"$$lotm_by_position$$\">?????????? (1.01)</a>",
 
+    lotm_anchor_rating_es   = "<a href=\"$$lotm$$\">Clasificaci&oacute;n</a>",
+    lotm_anchor_month_es    = "<a href=\"$$lotm_chronological$$\">Mes</a>",
+    lotm_anchor_title_es    = "T&iacute;tulo",
+    lotm_anchor_author_es   = "Autor",
+    lotm_anchor_position_es = "<a href=\"$$lotm_by_position$$\">Posici&oacute;n (1.01)</a>",
+    
     lotm_history = "History of LotM",
     lotm_history_de = "Geschichte des LdM",
     --ru-- lotm_history_ru = "History of LotM",
+    lotm_history_es = "Historia de LotM",
 
     lotm_current = function(v,s,l0)
         return parse_text(v, "$$"..lotm_macro_name(lotm_current).."$$", l0,
@@ -148,6 +156,8 @@
     "Juli", "August", "September", "Oktober", "November", "Dezember"},
   months_ru = {"??????", "???????", "????", "??????", "???", "????",
     "????", "??????", "????????", "???????", "??????", "???????"},
+  months_es = {"Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
+    "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"}
 }
 
 --------------------------------------------------------------------------------
@@ -160,6 +170,7 @@
     title = "Enigma Homepage",
     title_de = "Enigma Hauptseite",
     title_ru = "???????? ???????? Enigma",
+    title_es = "P&aacute;gina principal de Enigma",
     rightcolumn = {"infobox"},
     body = {"introduction", "intro-links", "news1", "powered-by"}
 }
@@ -172,6 +183,7 @@
     title = "About Enigma",
     title_de = "&Uuml;ber Enigma",
     title_ru = "?? Enigma",
+    title_es = "Acerca de Enigma",
     body = {"about", "features", "testimonials", "press"}
 }
 
@@ -183,6 +195,7 @@
     title = "News and Olds",
     title_de = "Neues und Altes",
     title_ru = "??????? ? ?????",
+    title_es = "Noticias y art&iacute;culos anteriores",
     rightcolumn = {},
     body = {"news2"}
 }
@@ -195,6 +208,7 @@
     title = "Screenshots of Enigma",
     title_de = "Screenshots von Enigma",
     title_ru = "????????? Enigma",
+    title_es = "Pantallazos de Enigma",
     body = {"screenshots"}
 }
 
@@ -206,6 +220,7 @@
     title = "Credits",
     title_de = "Credits",
     title_ru = "?????????????",
+    title_es = "Cr&eacute;ditos",
     body = {"credits"}
 }
 
@@ -218,6 +233,7 @@
     title = "Download Enigma",
     title_de = "Enigma herunterladen",
     title_ru = "???????? Enigma",
+    title_es = "Desc&aacute;rgate Enigma",
     body = {"download"}
 }
 
@@ -230,6 +246,7 @@
     title = "User-Support",
     title_de = "Spieler-Support",
     title_ru = "????????? ????????????",
+    title_es = "Soporte para usuarios",
     body = {"support"} --{"scores", "documentation"}
 }
 
@@ -242,6 +259,7 @@
     title = "Frequently Asked Questions",
     title_de = "H&auml;ufig gestellte Fragen",
     title_ru = "????? ?????????? ???????",
+    title_es = "Preguntas de Uso Frecuente",
     body = {"faq_core", "faq_questions"}
 }
 
@@ -253,66 +271,87 @@
     title = "User Statistics",
     title_de = "Spieler-Statistiken",
     title_ru = "?????????? ?????????????",
+    title_es = "Estadisticas de Usuario",
     average = "average",
     average_de = "Durchschnitt",
     average_ru = "? ???????",
+    average_es = "Promedio",
     count = "count",
     count_de = "Anzahl",
     count_ru = "???????",
+    count_es = "Cuenta",
     user = "user",
     user_de = "Spieler",
     user_ru = "????????????",
+    user_es = "Usuario",
     solved_hcp = "solved hcp",
     solved_hcp_de = "gel&ouml;stes hcp",
     solved_hcp_ru = "???????? ????????",
+    solved_hcp_es = "hcp resuelto",
     difficult = "difficult",
     difficult_de = "schwer",
     difficult_ru = "???????",
+    difficult_es = "Dificultad",
     easy = "easy",
     easy_de = "leicht",
     easy_ru = "???????",
+    easy_es = "F&aacute;cil",
     total = "total",
     total_de = "gesamt",
     total_ru = "?????",
+    total_es = "total",
     shared = "shared",
     shared_de = "geteilt",
     shared_ru = "??????????",
+    shared_es = "Compartido",
     rating = "rating",
     rating_de = "Bewertung",
     rating_ru = "???????",
+    rating_es = "Clasificaci&oacute;n",
     Handicap_Statistics = "Handicap Statistics of",
     Handicap_Statistics_de = "Handicap-Statistiken vom",
-    Handicap_Statistics_ru = "?????????? ?????????? ??", -- (month)
+    Handicap_Statistics_ru = "?????????? ?????????? ??",
+    Handicap_Statistics_es = "Estad&iacute;sticas de Handicap de",
     Rating_Statistics = "Rating Statistics of",
     Rating_Statistics_de = "Bewertungs-Statistiken vom",
-    Rating_Statistics_ru = "?????????? ?????? ??", -- (month)
+    Rating_Statistics_ru = "?????????? ?????? ??",
+    Rating_Statistics_es = "Estad&iacute;sticas de clasificaci&oacute;n de",    
     Solved_Level_Statistics = "Solved Level Statistics of",
     Solved_Level_Statistics_de = "Statistik der gel&ouml;sten Levels vom",
-    Solved_Level_Statistics_ru = "?????????? ???????? ??????? ??", -- (month)
+    Solved_Level_Statistics_ru = "?????????? ???????? ??????? ??",
+    Solved_Level_Statistics_es = "Estad&iacute;sticas de niveles resueltos de",
     Worldrecord_Statistics = "Worldrecord Statistics of",
     Worldrecord_Statistics_de = "Weltrekord-Statistik vom",
-    Worldrecord_Statistics_ru = "?????????? ??????? ???????? ??", -- (month)
+    Worldrecord_Statistics_ru = "?????????? ??????? ???????? ??",
+    Worldrecord_Statistics_es = "Estad&iacute;sticas de Records mundiales de",        
     Other_Statistics = "Other Statistics",
     Other_Statistics_de = "Weitere Statistiken",
     Other_Statistics_ru = "?????? ??????????",
+    Other_Statistics_es = "Otras estad&iacute;sticas",
     Scores = "Scores",
     Scores_de = "Ergebnisse",
     Scores_ru = "??????????",
+    Scores_es = "Resultados",
     Ratings = "Ratings",
     Ratings_de = "Bewertungen",
     Ratings_ru = "??????",
+    Ratings_es = "Clasificaci&oacute;nes",
     single_level_scores = "single level scores have been registered.",
     single_level_scores_de = "einzelne Levelscores wurden registriert.",
     single_level_scores_ru = "??????????? ??????????? ??????? ????????????????.",
+    single_level_scores_es = "Han sido registrados resultados de niveles sueltos",
     single_level_ratings = "single level ratings have been registered with an average of",
     single_level_ratings_de = "einzelne Levelbewertungen wurden registriert, mit einem Durchschnitt von",
     single_level_ratings_ru = "?????? ??????? ???????????????? ?? ??????? ???????",
+    single_level_ratings_es = "Han sido registradas clasificaci&oacute;nes de niveles sueltos con promedio de",
     and_distribution = "and the following distribution:",
     and_distribution_de = "und der folgenden Verteilung:",
     and_distribution_ru = "? ????????? ?????????:",
+    and_distribution_es = "y la siguiente distribuci&oacute;n:",
     names_in_use = "Names in use:",
     names_in_use_de = "Vergebene Namen:",
     names_in_use_ru = "??? ???????????? ?????:",
+    names_in_use_es = "Nombre en uso",
     leftcolumn = {"menu", "validation", "userlist"},
     rightcolumn = {},
     body = {"stat-head", "table-wr", "table-solved", "stat-help",
@@ -328,6 +367,7 @@
     title = "Development",
     title_de = "Entwicklung",
     title_ru = "??????????",
+    title_es = "Desarrollo",
     body = {"development"}
 }
 
@@ -340,6 +380,7 @@
     title = "Links",
     title_de = "Links",
     title_ru = "??????",
+    title_es = "Enlaces",
     body = {"links"}
 }
 
@@ -348,9 +389,10 @@
 ----------------------------------------------------------------------
 html.impressum = {
     outfile = "impressum.html",
-    title = "Impressum",
+    title = "Imprint",
     title_de = "Impressum",
     title_ru = "????????? ?????",
+    title_es = "Impreso",
     body = {"impressum", "longline"}
 }
 
@@ -368,11 +410,13 @@
     kind_of_order = "by <b>rating</b>",
     kind_of_order_de = "geordnet nach <b>Bewertung</b>",
     kind_of_order_ru = "<b>????????</b>",
+    kind_of_order_es = "por clasificaci&oacute;n:",
     parse_lotm = "$$parse_lotm_by_rating$$",
     lotm_anchor_rating = "<b>Rating</b>",
     lotm_anchor_rating_de = "<b>Bewertung</b>",
     lotm_anchor_rating_ru = "<b>???????</b>",
-}
+    lotm_anchor_rating_es = "<b>Clasificaci&oacute;n</b>",
+}    
 
 html.lotm_chronological = {
     outfile = "lotm_chronological.html",
@@ -384,10 +428,12 @@
     kind_of_order = "<b>chronologically</b>",
     kind_of_order_de = "<b>chronologisch</b> geordnet",
     kind_of_order_ru = "<b>??????????</b>",
+    kind_of_order_es = "<b>cronologicamente</b>",
     parse_lotm = "$$parse_lotm_chronological$$",
     lotm_anchor_month = "<b>Month</b>",
     lotm_anchor_month_de = "<b>Monat</b>",
     lotm_anchor_month_ru = "<b>?????</b>",
+    lotm_anchor_month_es = "<b>Mes</b>",
 }
 
 html.lotm_by_position = {
@@ -400,8 +446,10 @@
     kind_of_order = "by <b>position</b>",
     kind_of_order_de = "geordnet nach <b>Position</b>",
     kind_of_order_ru = "<b>??????????</b>",
+    kind_of_order_es = "<b>por posici&oacute;n</b>",
     parse_lotm = "$$parse_lotm_by_position$$",
     lotm_anchor_position = "<b>Position (1.01)</b>",
     lotm_anchor_position_de = "<b>Position (1.01)</b>",
     lotm_anchor_position_ru = "<b>?????????? (1.01)</b>",
+    lotm_anchor_position_es = "<b>Posici&oacute;n (1.01)</b>",
 }

Modified: homepage/main.lua
===================================================================
--- homepage/main.lua	2007-09-24 00:29:43 UTC (rev 886)
+++ homepage/main.lua	2007-09-24 21:31:04 UTC (rev 887)
@@ -52,8 +52,8 @@
     end
 end
 
--- translate_month returns a translated string of the month number
--- MONTH in the year YEAR. If year is nil, no year is appended.
+-- translate_month returns a translated string of the month and
+-- year in the DATE_TABLE. If year is nil, no year is appended.
 -- Data for translation is provided in output-files.lua.
 function translate_month(lang, date_table)
   if type(date_table) ~= "table" then
@@ -80,7 +80,11 @@
       year = year - 1900
     end
     year = string.format("%02d", year)
-    return month.." '"..year
+    if lang == "_es" then
+      return month.." del '"..year
+    else
+      return month.." '"..year
+    end
   end
 end
 
@@ -182,16 +186,16 @@
 -- Main Routine
 ----------------------------------------------------------------------
 
+-- Add functions for parsing the news and LotM archive
+
+dofile("input/news/read_news.lua")
+dofile("input/lotm/read_lotm.lua")
+
 -- Get general data and LotM archive data
 
 dofile("input/output-files.lua")
 dofile("input/lotm/lotm_archive_data.lua")
 
--- Add functions for parsing the news and LotM archive
-
-dofile("input/news/read_news.lua")
-dofile("input/lotm/read_lotm.lua")
-
 -- Autogenerate LotM-entries into the html-field (see read_lotm.lua)
 
 generate_lotm_entries(html)



From andreasl at mail.berlios.de  Wed Sep 26 01:20:09 2007
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Wed, 26 Sep 2007 01:20:09 +0200
Subject: [Enigma-game-svn] r888 - in trunk/data/levels: enigma_experimental
	lib
Message-ID: <200709252320.l8PNK9f1020868@sheep.berlios.de>

Author: andreasl
Date: 2007-09-26 01:20:08 +0200 (Wed, 26 Sep 2007)
New Revision: 888

Added:
   trunk/data/levels/enigma_experimental/test_libsoko.xml
Modified:
   trunk/data/levels/enigma_experimental/index.xml
   trunk/data/levels/lib/libsoko.xml
Log:
Sokoban:
 - 75 new designs (150 in total)
 - implemented "white"-attribute (libsoko)
 - (hopefully) fixed line matching to recognise empty lines
 - new function "recreate_sokoball" for developmental purposes
 - typos in libsoko
 - added test/demo-level "test_libsoko":
     The two switches at the top change the design number,
     the left decreases the right increases. Currently, only
     new designs are shown. It also demonstrates the use of
     multilevels and chessobans.   


Modified: trunk/data/levels/enigma_experimental/index.xml
===================================================================
--- trunk/data/levels/enigma_experimental/index.xml	2007-09-24 21:31:04 UTC (rev 887)
+++ trunk/data/levels/enigma_experimental/index.xml	2007-09-25 23:20:08 UTC (rev 888)
@@ -17,10 +17,11 @@
     <level _seq="9" _title="Glassstones" _xpath="./glassstones_1" author="Raoul Bourquin" ctrl="force" easy="false" id="glassstones_testlevel" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="10" _title="Impulstest" _xpath="./testimpulses" author="Enigma Team" ctrl="force" easy="false" id="testimpulses" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="11" _title="Wolf Among Sheep" _xpath="./wolfamongsheep" author="illmind" ctrl="force" easy="false" id="wolfamongsheep" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="12" _title="Puzzle Labor" _xpath="./puzzle_testarea_1" author="Raoul Bourquin" ctrl="force" easy="false" id="puzzle_testarea" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="13" _title="Puzzle Demo" _xpath="./puzzle_demo_2" author="Raoul Bourquin" ctrl="force" easy="false" id="puzzle_demo" rel="2" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="12" _title="Puzzle Labor" _xpath="./puzzle_testarea_1" author="Raoul Bourquin" ctrl="force" easy="false" id="puzzle_testarea" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="13" _title="Puzzle Demo" _xpath="./puzzle_demo_2" author="Raoul Bourquin" ctrl="force" easy="false" id="puzzle_demo" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="14" _title="Flood Demo" _xpath="./flood_demo_1" author="Raoul Bourquin" ctrl="force" easy="false" id="flood_demo" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="15" _title="Impossible?" _xpath="./wb2" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb2_exp" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="16" _title="Libsoko - Test" _xpath="./test_libsoko" author="Andreas Lochmann" ctrl="force" easy="true" id="test_libsoko" rel="1" rev="0" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Added: trunk/data/levels/enigma_experimental/test_libsoko.xml
===================================================================
--- trunk/data/levels/enigma_experimental/test_libsoko.xml	2007-09-24 21:31:04 UTC (rev 887)
+++ trunk/data/levels/enigma_experimental/test_libsoko.xml	2007-09-25 23:20:08 UTC (rev 888)
@@ -0,0 +1,350 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Libsoko - Test" el:subtitle="" el:id="test_libsoko"/>
+      <el:version el:score="1" el:release="1" el:revision="0" el:status="experimental"/>
+      <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2007 Andreas Lochmann</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.00">
+        <el:dependency el:path="lib/libsoko" el:id="lib/libsoko" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+level =   "  ###  ###\n"
+        .."###.####.#\n"
+        .."#    $   # ###\n"
+        .."# # ###* # #  #\n"
+        .."# @  $   #  ##\n"
+        .."#######  #\n"
+        .."      ####"
+
+level2 =  "    ####            |"
+       .."    #  ####         |"
+       .."    # $   ######### |"
+       .."    # .#    $ ##  # |"
+       .."    # $# .## $    ##|"
+       .." #### .###   #$    #|"
+       .."##  ## #  .. # $$  #|"
+       .."#  $      ...#   $ #|"
+       .."# $  #####... #   ##|"
+       .."#  $#   #  .**@#### |"
+       .."###   # #    # #    |"
+       .."  #####  ####  # #  |"
+       .."      ##      ##    |"
+       .."       ########     |"
+  
+multilevel =
+  "\n"
+.."\n"
+.."     #####\n"
+.."     #   #\n"
+.."     #   #\n"
+.."   ###   ##\n"
+.."   #  $   #\n"
+.."#### # ## #   ######\n"
+.." #   # ## #####   .#\n"
+.." #    $            #\n"
+.." ##### ### #@##   .#\n"
+.."     #     #########\n"
+.."     #######\n"
+.."> 2\n"
+.."Hier steht etwas Text.\n"
+.."\n"
+.."Hier steht mehr Text.\n"
+.."    \n"
+.."N?chster Level:\n"
+.."############\n"
+.."#..  #     ###\n"
+.."#..  # $  $  #\n"
+.."#..  #$####  #\n"
+.."#..    @ ##  #\n"
+.."#..  # #  $ ##\n"
+.."###### ##$ $ #\n"
+.."  # $  $ $ $ #\n"
+.."  #    #     #\n"
+.."  ############\n"
+.."              \n"
+.."        ########\n"
+.."        #     @#\n"
+.."        # $#$ ##\n"
+.."        # $  $#\n"
+.."        ##$ $ #\n"
+.."######### $ # ###\n"
+.."#....  ## $  $  #\n"
+.."##...    $  $   #\n"
+.."#....  ##########\n"
+.."########\n"
+
+multilevel2 =
+  "> 1\n"
+.."###################\n"
+.."###################\n"
+.."###          ######\n"
+.."## $######## ######\n"
+.."##  $     #......##\n"
+.."##  $@$ # $.*.#..##\n"
+.."### ###$$ #......##\n"
+.."######    #......##\n"
+.."######$ ###.#######\n"
+.."###     $      ####\n"
+.."#### $ ####$ # ####\n"
+.."###  $$ # $  $ ####\n"
+.."### $$  # $#$  ####\n"
+.."###  $$ #  $ $ ####\n"
+.."####    ##     ####\n"
+.."###################\n"
+.."###################\n"
+.."> 2\n"
+.."###################\n"
+.."###################\n"
+.."##   #     ########\n"
+.."##     $ $ ###  ..#\n"
+.."###  ## # #### ...#\n"
+.."#### ## $  ###$ #.#\n"
+.."##    #$$$ ### ...#\n"
+.."## $$ #    ###$ #.#\n"
+.."##  $  ##  ##  ...#\n"
+.."##   $ ##   $  $#.#\n"
+.."### $######### ...#\n"
+.."###     $ $ ##$$#.#\n"
+.."###  $$ #   ## ...#\n"
+.."#####  ##$$@##$ #.#\n"
+.."#####      ###  ..#\n"
+.."###################\n"
+.."###################\n"
+.."> 3\n"
+.."###################\n"
+.."###################\n"
+.."#    ##...$...#   #\n"
+.."# $$ ##$# ##..$ $ #\n"
+.."###  #......... $ #\n"
+.."#   ##....@####$  #\n"
+.."# $$ ##...#####   #\n"
+.."# #  ###.#######$ #\n"
+.."# $ $     #       #\n"
+.."#   #  $$ # $$ $$ #\n"
+.."# ### ##  #  # # ##\n"
+.."#   #  ## #    $ ##\n"
+.."##     ##### # # ##\n"
+.."####$$ ##### $$$  #\n"
+.."####   #####      #\n"
+.."###################\n"
+.."###################\n"
+.."> 4\n"
+.."###################\n"
+.."#  *....#       ###\n"
+.."# $**....*  $ #@###\n"
+.."# #.#...## #$$# ###\n"
+.."# $.**##   #    ###\n"
+.."# #.#.## $$# ######\n"
+.."#  ....###   ######\n"
+.."# $ # $# # $#######\n"
+.."# # #    #  #######\n"
+.."#    $ $ ##########\n"
+.."# $##$# ## ########\n"
+.."#   # # #  ########\n"
+.."# $      $ ########\n"
+.."# ## ## #$ ########\n"
+.."# $  ##$   ########\n"
+.."#         #########\n"
+.."###################\n"
+.."> 5\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."#####   ###   #####\n"
+.."#####  $  $ # #####\n"
+.."###### ##   $ #####\n"
+.."###### #  # .######\n"
+.."##### $#  ##.######\n"
+.."#####  @$ *..######\n"
+.."##### #$ *.*.######\n"
+.."#####   ###########\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."> 6\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."######  ###########\n"
+.."####.. $###########\n"
+.."####*.  ###########\n"
+.."####.$$ #   #######\n"
+.."####.# $$   #######\n"
+.."####.$  # # #######\n"
+.."####.##@$   #######\n"
+.."####. $ ##$ #######\n"
+.."####.   ##  #######\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."> 7\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."######  ###########\n"
+.."###### $##   ######\n"
+.."###### .  $@*######\n"
+.."######  #..# ######\n"
+.."#######  $ # ######\n"
+.."####### #*.$ ######\n"
+.."#######$# $#  #####\n"
+.."###### .    . #####\n"
+.."######   ##########\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."###################\n"
+.."> 8\n"
+.."#################\n"
+.."#  *....#       #\n"
+.."# $**....*  $ #@#\n"
+.."# #.#...## #$$# #\n"
+.."# $.**##   #    ##\n"
+.."# #.#.## $$# ##  #\n"
+.."# .....###     $ #\n"
+.."# $ #.*# # $#$$ $##\n"
+.."# #.#... #      $ #\n"
+.."# ...$ $ ###$$$   #\n"
+.."# $## # ## #   $ ##\n"
+.."#   # # #  # #$  #\n"
+.."# $      $ #    ##\n"
+.."# ##$## #$ ######\n"
+.."# $  ##$   #\n"
+.."#         ##\n"
+.."###########\n"
+.."> 9\n"
+.." ########\n"
+.." #  #   #\n"
+.."##  .$  #\n"
+.."# $#.#$##\n"
+.."#@ . . #\n"
+.."# $$.###\n"
+.."## # #\n"
+.." #   #\n"
+.." #####\n"
+.."> 10\n"
+.."#####\n"
+.."# #####\n"
+.."# # . #\n"
+.."# # * ##\n"
+.."### *###\n"
+.."##  $@ #\n"
+.."## # # #\n"
+.."##     #\n"
+.."########\n"
+.."> 11\n"
+.." #####\n"
+.."##   #\n"
+.."#  #$####\n"
+.."# .. .$ #\n"
+.."#  # ## #\n"
+.."# $ $ # #\n"
+.."##@* .  #\n"
+.." ###  ###\n"
+.."   ####\n"
+.."> 12\n"
+.." #######\n"
+.." #   * #\n"
+.." #$# # ##\n"
+.."## . $. #\n"
+.."# @#..  #\n"
+.."# $$  ###\n"
+.."##   ##\n"
+.." #####\n"
+.."> 13\n"
+.."  #####\n"
+.."  #   #\n"
+.."  # $ #\n"
+.." ## #$#\n"
+.."##   @##\n"
+.."#  .#$ #\n"
+.."#.#*.. #\n"
+.."#  . # #\n"
+.."# $# $ #\n"
+.."##   ###\n"
+.." #####\n"
+
+level13_no_actor =
+ "> 13\n"
+.."  #####\n"
+.."  #   #\n"
+.."  # $ #\n"
+.." ## #$#\n"
+.."##    ##\n"
+.."#  .#$ #\n"
+.."#.#*.. #\n"
+.."#  . # #\n"
+.."# $# $ #\n"
+.."##   ###\n"
+.." #####\n"
+
+chessoban =
+  "########\n"
+.."#  NN@ #\n"
+.."#  ##  #\n"
+.."##    ##\n"
+.."#  ##  #\n"
+.."# #  # #\n"
+.."#      #\n"
+.."########\n"
+.."\n\n"
+.."#######\n"
+.."#     #\n"
+.."#  #  #\n"
+.."##n#n##\n"
+.."#  @  #\n"
+.."#.   .#\n"
+.."#######\n"
+
+
+
+design_min = 76
+design_max = table.getn(design_list)
+
+design_number = design_max
+
+create_sokoball(multilevel2, 13, design_number)
+--create_sokoball(chessoban, 2)
+set_stone("st-switch", 9, 1, {action="callback", target="design_minus_one"})
+set_stone("st-switch", 10, 1, {action="callback", target="design_plus_one"})
+
+function design_minus_one()
+  design_number = design_number - 1
+  if design_number < design_min then
+    design_number = design_max
+  end
+  recreate_sokoball(design_number)
+  set_stone("st-switch", 9, 1, {action="callback", target="design_minus_one"})
+  set_stone("st-switch", 10, 1, {action="callback", target="design_plus_one"})
+end
+function design_plus_one()
+  design_number = design_number + 1
+  if design_number > design_max then
+    design_number = design_min
+  end
+  recreate_sokoball(design_number)
+  set_stone("st-switch", 9, 1, {action="callback", target="design_minus_one"})
+  set_stone("st-switch", 10, 1, {action="callback", target="design_plus_one"})
+end
+
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/lib/libsoko.xml
===================================================================
--- trunk/data/levels/lib/libsoko.xml	2007-09-24 21:31:04 UTC (rev 887)
+++ trunk/data/levels/lib/libsoko.xml	2007-09-25 23:20:08 UTC (rev 888)
@@ -26,7 +26,7 @@
 
 -- This section holds a table with all default designs. Each design
 -- is again a table consisting of the following entries:
---    wall, inf, outf, box, goal, oxyd, endk
+--    wall, inf, outf, box, goal, oxyd, oxop
 -- Each of these entries is either a string representing the objects to
 -- be used, or a table if several objects shall be used. Such a
 -- combination of objects will be called "element".
@@ -51,12 +51,12 @@
 -- Example:
 --
 --   [5] = { outf = "fl-leaves", inf = "fl-leavesb", box = "st-wood"
---           wall = {"st-glass", "fl-wood", "fl-leaves", "al-random"},
---           oxyd ="a" }
+--           wall = {"st-glass", "fl-wood", "fl-leaves", "al:random"},
+--           oxyd = "a", white = true }
 --
 --   will define design 5. The walls will alternate between
 --   st-glass/fl-wood and st-glass/fl-leaves. The goal will be
---   it-trigger by default.
+--   it-trigger by default. The actor will be ac-whiteball.
 --
 -- Possible flags:
 --
@@ -80,6 +80,8 @@
   oxop = 1 }
 
 design_list = {
+
+-- Ralf's designs
 [1]={box="st-brownie", wall="st-bluegray", inf="fl-bluegray", outf="fl-space", door="st-door_a", oxyd="a"},
 [2]={box="st-glass_move", wall="st-bluegray", inf="fl-bluegray", outf="fl-water", door="st-door_b", oxyd="a"},
 [3]={box="st-wood-growing", wall="st-bluegray", inf="fl-bluegray", outf="fl-abyss", door="st-door_c", oxyd="a"},
@@ -154,9 +156,139 @@
 [72]={box="st-block", wall="st-rock6", inf="fl-acblack", outf="fl-leaves", door="st-blocker", oxyd="d"},
 [73]={box="st-shogun", wall="st-rock6", inf="fl-acblack", outf="fl-leaves", door="st-door_a", oxyd="d"},
 [74]={box="st-shogun", wall="st-rock6", inf="fl-tigris", outf="fl-rough-blue", door="st-blocker", oxyd="b"},
-[75]={box="st-shogun", wall="st-rock6", inf="fl-tigris", outf="fl-water",door="st-door_a", oxyd="b"}
+[75]={box="st-shogun", wall="st-rock6", inf="fl-tigris", outf="fl-water", door="st-door_a", oxyd="b"},
+
+-- New designs
+[76]={box="st-glass1_move", wall="st-glass2", inf="fl-lightgray", outf="fl-abyss", door="st-door_a", oxyd="b"},
+[77]={box="st-rock3_move", wall="st-brick", inf="fl-darkgray", outf="fl-leavesb", door="st-door_a", oxyd="a"},
+[78]={box="st-rock3_move", wall="st-bumps", inf="fl-dunes", outf="fl-sand", door="st-door_a", oxyd="d"},
+[79]={box="st-flrock", wall="st-camouflage", inf="fl-gravel", outf={"fl-gravel", "st-disco-medium"}, door="st-door_a", oxyd="d"},
+[80]={box="st-flhay", wall="st-camouflage", inf="fl-leaves", outf="fl-water", door="st-door_a", oxyd="d"},
+[81]={box="st-glass2_move", wall={"st-glass1", "fl-lightgray"}, inf="fl-black", outf="fl-white", door="st-door_a", oxyd="c"},
+[82]={box="st-wood", wall={"st-glass1", "fl-water"}, inf="fl-sand", outf="fl-water", door="st-door_a", oxyd="c"},
+[83]={box="st-camouflage_move", wall="st-glass2", inf="fl-lightgray", outf={"fl-leavesb", "st-disco-medium"}, door="st-door_a", oxyd="b"},
+[84]={box="st-flrock", wall="st-glass2", inf="fl-sand", outf={"fl-water", "st-disco-medium"}, door="st-door_a", oxyd="b"},
+[85]={box="st-flrock", wall="st-brick", inf="fl-sand", outf={"fl-water", "st-disco-medium"}, door="st-door_a", oxyd="a"},
+[86]={box="st-glass1_move", wall={"st-glass3", "fl-abyss_fake"}, inf="fl-red", outf="fl-space", door="st-door_a", oxyd="a"},
+[87]={box="st-rock3_move", wall={"st-glass3", "fl-rough-blue"}, inf="fl-plank", outf="fl-water", door="st-door_a", oxyd="a"},
+[88]={box="st-glass1_move", wall="st-likeoxyda", inf="fl-black", outf="fl-abyss", door="st-door_a", oxyd="a"},
+[89]={box="st-greenbrown_move", wall="st-likeoxyda-open", inf="fl-brick", outf={"fl-mortar", "st-disco-medium"}, door="st-door_a", oxyd="a"},
+[90]={box="st-rock3_move", wall="st-likeoxydb", inf="fl-rough-red", outf="fl-space", door="st-door_a", oxyd="b"},
+[91]={box="st-flhay", wall="st-likeoxydb-open", inf="fl-rough-blue", outf={"fl-swamp", "st-disco-light"}, door="st-door_a", oxyd="b"},
+[92]={box="st-glass2_move", wall="st-likeoxydc", inf="fl-sahara", outf={"fl-water", "st-disco-light"}, door="st-door_a", oxyd="c"},
+[93]={box="st-glass_move", wall="st-likeoxydc-open", inf="fl-red", outf={"st-blackballs", "fl-abyss"}, door="st-door_a", oxyd="c"},
+[94]={box="st-glass2_move", wall="st-likeoxydd", inf="fl-concrete", outf="fl-sand", door="st-door_a", oxyd="d"},
+[95]={box="st-flrock", wall="st-likeoxydd-open", inf="fl-marble", outf="fl-water", door="st-door_a", oxyd="d"},
+[96]={box="st-flrock", wall="st-marble", inf="fl-marble", outf={"fl-leavesc3", "fl-leavesd3"}, door="st-door_a", oxyd="a"},
+[97]={box="st-camouflage_move", wall="st-marble", inf="fl-leaves", outf={"fl-leaves", "st-marble"}, door="st-door_a", oxyd="a"},
+[98]={box="st-rock1_move", wall="st-redrock", inf="fl-acblack", outf={"fl-acblack", "st-redrock"}, door="st-door_a", oxyd="b"},
+[99]={box="st-glass1_move", wall="st-redrock", inf="fl-mortar", outf="fl-brick", door="st-door_a", oxyd="b"},
+[100]={box="st-block", wall="st-redrock", inf="fl-mortar", outf="fl-water", door="st-door_a", oxyd="b"},
+[101]={box="st-glass2_move", wall="st-redrock", inf="fl-leavesb", outf={"fl-leavesc3", "fl-leavesd4"}, door="st-door_a", oxyd="a"},
+[102]={box="st-camouflage_move", wall="st-rock2", inf="fl-rock", outf={"fl-rock", "st-disco-medium"}, door="st-door_a", oxyd="b"},
+[103]={box="st-glass2_move", wall="st-rock2", inf="fl-stone", outf={"fl-water", "st-disco-medium"}, door="st-door_a", oxyd="b"},
+[104]={box="st-wood", wall="st-rock2", inf="fl-lightgray", outf="fl-space", door="st-door_a", oxyd="b"},
+[105]={box="st-camouflage_move", wall="st-rock7", inf="fl-woven", outf="fl-gravel", door="st-door_a", oxyd="a"},
+[106]={box="st-brownie", wall="st-rock7", inf="fl-black", outf="fl-abyss", door="st-door_a", oxyd="b"},
+[107]={box="st-glass_move", wall="st-rock8", inf="fl-plank", outf={"fl-plank", "st-rock8"}, door="st-door_a", oxyd="d"},
+[108]={box="st-glass2_move", wall={"st-rock8", "fl-water"}, inf="fl-leaves", outf="fl-water", door="st-door_a", oxyd="c"},
+[109]={box="st-marble_move", wall={"st-rock8", "fl-abyss_fake"}, inf="fl-stone", outf="fl-space", door="st-door_a", oxyd="c"},
+[110]={box="st-greenbrown_move", wall="st-rock9", inf="fl-rock", outf={"fl-rock", "st-rock9"}, door="st-door_a", oxyd="a"},
+[111]={box="st-glass_move", wall="st-rock9", inf="fl-sand", outf="fl-water", door="st-door_a", oxyd="c"},
+[112]={box="st-camouflage_move", wall="st-rock9", inf="fl-stone", outf="fl-swamp", door="st-door_a", oxyd="d"},
+[113]={box="st-block", wall="st-rock10", inf="fl-bluegreen", outf="fl-abyss", door="st-door_a", oxyd="a"},
+[114]={box="st-wood", wall="st-rock10", inf="fl-sand", outf={"fl-sand", "st-rock10"}, door="st-door_a", oxyd="b"},
+[115]={box="st-glass2_move", wall="st-stone1", inf={"fl-lightgray", "fl-white"}, outf={"fl-space", "fl-abyss"}, door="st-door_a", oxyd="d"},
+[116]={box="st-rock1_move", wall="st-stone1", inf="fl-stwood", outf="fl-water", door="st-door_a", oxyd="d"},
+[117]={box="st-glass_move", wall="st-stone1", inf="fl-black", outf="st-stone1", door="st-door_a", oxyd="d"},
+[118]={box="st-glass_move", wall="st-stone2", inf="fl-black", outf="fl-gravel", door="st-door_a", oxyd="b"},
+[119]={box="st-block", wall="st-stone2", inf="fl-rough-red", outf={"fl-rough-blue", "st-disco-light"}, door="st-door_a", oxyd="d"},
+[120]={box="st-rock3_move", wall={"st-marble", "st-stone2"}, inf="fl-black", outf={"st-marble", "st-stone2"}, door="st-door_a", oxyd="b"},
+[121]={box="st-wood", wall="st-panel", inf="fl-wood", outf={"fl-leavesd3", "fl-leavesd2"}, door="st-door_a", oxyd="a"},
+[122]={box="st-block", wall="st-panel", inf="fl-leaves", outf="fl-leavesb", door="st-door_a", oxyd="a"},
+[123]={box="st-glass1_move", wall="st-woven", inf="fl-dunes", outf="fl-bluegreen", door="st-door_a", oxyd="a"},
+[124]={box="st-marble_move", wall="st-woven", inf="fl-hay", outf="fl-water", door="st-door_a", oxyd="a"},
+[125]={box="st-rock3_move", wall="st-yellow", inf="fl-leavesb", outf="fl-leaves", door="st-door_a", oxyd="a"},
+[126]={box="st-glass_move", wall="st-yellow", inf="fl-rough-blue", outf="fl-abyss", door="st-door_a", oxyd="d"},
+[127]={box="st-block", wall="st-yellow", inf="fl-lightgray", outf="fl-space", door="st-door_a", oxyd="d"},
+[128]={box="st-glass1_move", wall="st-rock7", inf="fl-himalaya", outf={"fl-himalaya", "st-rock8", "st-rock7"}, door="st-door_a", oxyd="d"},
+[129]={box="st-camouflage_move", wall={"st-rock9", "fl-leavesb"}, inf="fl-dunes",
+       outf={"fl-leavese1", "fl-leavese2", "fl-leavese3", "fl-leavese4", "al:waves"}, door="st-door_a", oxyd="d"},
+[130]={box="st-glass1_move", wall="st-redrock", inf="fl-darkgray",
+       outf={"fl-black", "st-redrock", "st-invisible", "st-invisible", "st-invisible", "al:waves"},
+       door="st-door_a", oxyd="a"},
+[131]={box="st-glass1_move", wall={"st-yellow", "st-yellow", "st-redrock", "st-redrock", "al:waves"}, inf="fl-wood",
+       outf={"st-yellow", "st-yellow", "st-redrock", "st-redrock", "al:waves"}, door="st-door_a", oxyd="d"},
+[132]={box="st-wood", wall="st-camouflage", inf="fl-leavesb",
+       outf={"fl-water", "fl-swamp", "fl-water", "fl-water", "al:random"}, door="st-door_a", oxyd="b"},
+[133]={box="st-glass2_move", wall="st-metal", inf="fl-metal",
+       outf={"fl-space", "fl-abyss", "fl-abyss", "fl-abyss", "al:random"}, door="st-door_a", oxyd="d"},
+[134]={box="st-marble_move", wall="st-metal", inf="fl-white",
+       outf={"fl-abyss", "st-grate1", "st-invisible", "st-invisible", "st-invisible", "al:waves"}, door="st-door_a", oxyd="d"},
+[135]={box="st-glass_move", wall="st-likeoxydc", inf="fl-white",
+       outf={"fl-white", "st-rock1", "st-invisible", "st-invisible", "st-invisible", "al:random"}, door="st-door_a", oxyd="c"},
+[136]={box="st-block", wall={"st-oneway_white-n", "st-oneway_white-s", "st-oneway_white-e", "st-oneway_white-w", "al:random"}, inf="fl-rough",
+       outf={"st-oneway_white-n", "st-oneway_white-s", "st-oneway_white-e", "st-oneway_white-w", "al:random"}, door="st-door_a", oxyd="d"},
+[137]={box={"st-mirror-p-m", "st-mirror-p/m", "st-mirror-p\\m", "st-mirror-p|m", "al:random"},
+       --wall={"st-laser-n", "st-laser-s", "st-laser-e", "laser-w", "al:random"},
+       wall={"st-glass3", "fl-abyss"}, inf="fl-metal",
+       --wall={"st-mirror-p-", "st-mirror-p/", "st-mirror-p\\", "st-mirror-p|", "al:random"},
+       outf={"st-mirror-p-", "st-mirror-p/", "st-mirror-p|", "st-mirror-p\\", "al:random"}, door="st-door_a", oxyd="b"},
+[138]={box="st-shogun-s", wall="st-panel", inf="fl-stwood", outf="fl-water", door="st-door_a", oxyd="d"},
+[139]={box="st-shogun-s", wall={"st-white4", "fl-springboard", "fl-abyss_fake"}, inf={"fl-springboard", "fl-abyss_fake"},
+       outf={"st-white1", "st-black1", "fl-springboard", "fl-abyss_fake"}, door="st-door_a", oxyd="b"},
+[140]={box="st-brownie", wall={"st-stone1", "fl-leavesb"}, inf={"fl-floor_001", "fr:3.0"},
+       outf={"fl-leavese4", "fl-leavese2", "fl-leavese1", "fl-leavese3", "al:waves"}, door="st-door_a", oxyd="d"},
+[141]={box="st-brownie", wall={"st-rock4", "fl-leavesb"}, inf={"fl-bluegreenx", "mf:1.0", "fr:3.0"},
+       outf={"fl-water", "st-rock10", "st-invisible", "st-invisible", "st-invisible", "al:waves"}, door="st-door_a", oxyd="d"},
+[142]={box="st-glass2_move", wall={"st-glass1", "fl-leavesb"}, inf="fl-leavesb",
+       outf={"fl-leavesc4", "fl-leavesd2", "fl-leavesc2", "fl-leavese3", "al:waves"}, door="st-door_a", oxyd="d"},
+[143]={box="st-block", wall={"st-rock5", "fl-stwood"}, inf="fl-wood",
+       outf={"st-disco-light", "fl-wood1", "fl-wood1", "fl-wood1", "fl-wood2", "al:waves"}, door="st-door_a", oxyd="a"},
+[144]={box="st-wood", wall="st-rock6", inf="fl-bluegreen",
+       outf={"fl-space", "it-squashed", "it-sensor", "it-sensor", "it-sensor", "al:random"}, door="st-door_a", oxyd="d"},
+[145]={box="st-glass1_move", wall={"st-greenbrown", "fl-sand"}, inf="fl-dunes",
+       outf={"fl-sand", "it-landmine", "it-booze-broken", "it-none", "it-none", "it-none", "it-none", "it-none", "it-none", "al:random"},
+       door="st-door_a", oxyd="a"},
+[146]={box="st-wood", wall="st-rock1", inf="fl-black",
+       outf={"fl-abyss", "st-grate1", "st-none", "st-none", "st-none", "st-none", "st-none", "st-none",
+       "st-none", "st-none", "st-none", "st-none", "al:random"}, door="st-door_a", oxyd="c", white = true},
+[147]={box="st-wood", wall="st-whiteballs", inf="fl-gray", white = true,
+       outf={"fl-gradient5", "fl-gradient6", "fl-gradient7", "fl-gradient8", "al:waves"}, door="st-door_a", oxyd="a"},
+[148]={box="st-shogun-s", wall="st-metal", inf="fl-rough-blue", white = true,
+       outf={"fl-rough-red", "fl-rough-blue", "st-disco-light"}, door="st-door_a", oxyd="a"},
+[149]={box="st-shogun-s", wall="st-yellow", inf="fl-wood", outf="fl-swamp", door="st-door_a",
+       oxyd="c", goal="it-shogun-s", white = true},
+[150]={box="st-flrock", wall="st-redrock", inf="fl-brick", outf="fl-space", door="st-door_a", oxyd="c", white = true},
 }
 
+--
+-- Remaining walls:
+--  st-beads, st-brick, st-bumps, st-camouflage, st-fakeoxyd,
+--  st-glass1/2/3, st-likeoxyda/b/c/d[-open], [st-marble],
+--  st-redrock, st-rock2/7/8/9/10, st-stone1/2, st-panel,
+--  st-woven, st-yellow
+--
+-- Remaining boxes:
+--  st-camouflage_move, st-glass1/2_move, st-rock1_move, st-flhay,
+--  st-flrock
+--
+-- Remaining floors (inside):
+--  fl-abyss_fake, fl-black, fl-bluegreen[x], fl-brick, fl-bumps,
+--  fl-concrete, fl-darkgray, fl-dunes, [fl-floor_001], fl-gravel,
+--  fl-gray, fl-hay, fl-leavesb/c/d/e*, fl-lightgray, fl-marble,
+--  fl-metal, fl-mortar, [fl-normal[_x]], fl-plank, fl-red,
+--  fl-rock, fl-rough-blue, fl-sahara, fl-sand, fl-springboard,
+--  fl-stone, fl-stwood, [fl-trigger], fl-woven
+--
+-- have: fl-acblack, fl-bluegray, fl-himalaya, fl-leaves,
+--       fl-light, fl-rough, fl-rough-red, fl-samba, fl-tigris,
+--       fl-white, fl-wood
+--
+-- outside (have): fl-abyss, fl-leaves, fl-rough-blue, fl-sahara,
+--                 fl-space, fl-water
+--
+
 ------------------------------------------------------------------------
 -- Global variables
 ------------------------------------------------------------------------
@@ -183,12 +315,12 @@
   error(st)
 end
 
-function is_floor(s)      return string.sub(s, 1, 3) == "fl-"  end
-function is_stone(s)      return string.sub(s, 1, 3) == "st-"  end
-function is_item(s)       return string.sub(s, 1, 3) == "it-"  end
-function is_algorithm(s)  return string.sub(s, 1, 3) == "al:"  end
-function is_friction(s)   return string.sub(s, 1, 3) == "fr:"  end
-function is_mouseforce(s) return string.sub(s, 1, 3) == "mf:"  end
+function is_floor(s)       return string.sub(s, 1, 3) == "fl-"  end
+function is_stone(s)       return string.sub(s, 1, 3) == "st-"  end
+function is_item(s)        return string.sub(s, 1, 3) == "it-"  end
+function is_algorithm(s)   return string.sub(s, 1, 3) == "al:"  end
+function is_friction(s)    return string.sub(s, 1, 3) == "fr:"  end
+function is_mousefactor(s) return string.sub(s, 1, 3) == "mf:"  end
 
 -- combine_tables returns a table consisting of all entries of the
 -- entries of OVER_TABLE: OVER_TABLE is a table of tables, say
@@ -298,6 +430,7 @@
 -- draw_level_array draws a sokoball level from global variable LEVEL_ARRAY
 -- with design CHOSEN_DESIGN (global var, a ready-for-use design table)
 -- at offset DX, DY. If OUTSIDE is true, the outside will be drawn as well.
+-- DRAW_ACTOR determines whether the actor should be placed.
 -- draw_level_array will NOT
 --  - create the world
 --  - set global variables
@@ -305,7 +438,7 @@
 --  - solve the level
 -- This function is not intended to be used in level programming
 -- directly, use "draw_sokoball" instead.
-function draw_level_array(dx, dy, outside)
+function draw_level_array(dx, dy, outside, draw_actor)
   local array_width = table.getn(level_array[1])
   local array_height = table.getn(level_array)
 
@@ -348,12 +481,20 @@
       
       -- Chess-Stones
       if (ch == "n") or (ch == "N") then
-        set_stone("st-chess_black", x, y)
+        if chosen_design["white"] then
+          set_stone("st-chess_white", x + dx, y + dy)
+        else
+          set_stone("st-chess_black", x + dx, y + dy)
+        end
       end
       
       -- Actors
-      if (ch == "@") or (ch == "+") then
-        set_actor("ac-blackball", x + 0.5 + dx, y + 0.5 + dy, { name = "marble" })
+      if ((ch == "@") or (ch == "+")) and draw_actor then
+        if chosen_design["white"] then
+          set_actor("ac-whiteball", x + 0.5 + dx, y + 0.5 + dy, { name = "marble", controllers = 1, player = 0 })
+        else
+          set_actor("ac-blackball", x + 0.5 + dx, y + 0.5 + dy, { name = "marble" })
+        end
       end
     end
   end  
@@ -392,8 +533,9 @@
     .."[\#\$\.@\*Nn\+]+"          -- at least one non-space character
     .."[ \-\#\_\$\.@\*0-9Nn\+]*"  -- again all allowed characters except line ending
   local in_level = false
-  for line in string.gfind(multilevel, "[^\n\|]+") do
+  for line in string.gfind(multilevel, "([^\n\|]*)[\n\|]") do
     if string.match(line, level_line_match) == line then
+      mydebug("Level "..current_level.." : |"..line.."|")
       if in_level then
         if current_level == (sublevel_number or 1) then
           level = level..line.."\n"
@@ -772,7 +914,7 @@
     end
   end
   
-  draw_level_array(dx, dy, true)
+  draw_level_array(dx, dy, true, true)
 
   if number_goals < 1 then
     myerror("No goals defined!\n")
@@ -787,6 +929,53 @@
   enigma.ConserveLevel = FALSE
 end
 
+-- recreate_sokoball is used for design development only.
+-- It redraws the current level from scratch, but not the world
+-- and doesn't add another actor.
+function recreate_sokoball(design)
+  -- calculate screen position
+  -- Important Note: level_array is reversely indexed, i.e.
+  --                 level_array[y-coordinate][x-coordinate]
+  local array_width = table.getn(level_array[1])
+  local array_height = table.getn(level_array)
+  levelw = math.max(array_width, 20)
+  levelh = math.max(array_height, 13)
+  
+  -- Calculate padding
+  local dx = 0
+  local dy = 0
+  if levelw > array_width then
+    dx = math.floor((levelw - array_width) / 2)
+  end
+  if levelh > array_height then
+    dy = math.floor((levelh - array_height) / 2)
+  end
+  
+  chosen_design = design_from_description(design, level_array)
+
+  for x = 0, levelw - 1 do
+    for y = 0, levelh - 1 do
+      kill_stone(x, y)
+      kill_item(x, y)
+      set_element(x, y, chosen_design, "outf")
+    end
+  end
+  
+  draw_level_array(dx, dy, true, false)
+
+  if number_goals < 1 then
+    myerror("No goals defined!\n")
+  end
+
+  -- determine oxop (way to open oxyds)
+  local oxop = chosen_design.oxop
+  prepare_oxyds(oxop)
+
+  enigma.ShowMoves = TRUE
+  display.SetFollowMode(display.FOLLOW_SMOOTH)
+  enigma.ConserveLevel = FALSE
+end
+
 -- draw_sokoball draws a sokoball level from argument LEVEL with design
 -- DESIGN (see create_sokoball) at offset DX, DY. It's arguments are
 -- identical to those of create_sokoball. Whereas create_sokoball should
@@ -797,14 +986,15 @@
 --  - draw the outside, such that it doesn't overwrite the rest of your
 --    level
 --  - solve the level when all triggers are activated.
+-- DRAW_ACTOR determines if an actor should be placed.
 -- Note: Overwriting one sokoball part by another creates problems
 --       with the triggers.
 --
-function draw_sokoball(dx, dy, level, sublevel, design)
+function draw_sokoball(dx, dy, level, sublevel, design, draw_actor)
   -- unpack level
   level_array = unpack_level(level, sublevel)
   chosen_design = design_from_description(design, level_array)
-  draw_level_array(dx, dy, false)
+  draw_level_array(dx, dy, false, draw_actor)
 end
 
     ]]></el:luamain>



From ral at mail.berlios.de  Sat Sep 29 23:35:18 2007
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 29 Sep 2007 23:35:18 +0200
Subject: [Enigma-game-svn] r889 - in trunk: lib-src/enigma-core src src/lev
Message-ID: <200709292135.l8TLZIax002227@sheep.berlios.de>

Author: ral
Date: 2007-09-29 23:35:15 +0200 (Sat, 29 Sep 2007)
New Revision: 889

Added:
   trunk/src/WorldProxy.cc
   trunk/src/WorldProxy.hh
Modified:
   trunk/lib-src/enigma-core/ecl_util.cc
   trunk/lib-src/enigma-core/ecl_util.hh
   trunk/src/Inventory.cc
   trunk/src/Makefile.am
   trunk/src/actors.hh
   trunk/src/floors.hh
   trunk/src/items.cc
   trunk/src/items.hh
   trunk/src/lev/Proxy.cc
   trunk/src/lua.cc
   trunk/src/lua.hh
   trunk/src/objects.cc
   trunk/src/objects_decl.hh
   trunk/src/player.cc
   trunk/src/player.hh
   trunk/src/server.cc
   trunk/src/server.hh
   trunk/src/stones.hh
   trunk/src/stones_complex.cc
   trunk/src/world.cc
   trunk/src/world.hh
   trunk/src/world_internal.hh
Log:
Trunk 1.1: Lua API Reengineering part I
- new API as of draft 0.4
- Lua object references made crash safe and persitence capable 
- namespace lua shifted to enigma::lua
- object naming extended to autonaming of groups - limited to 1.10++
- named object search with wildcards - limited to 1.10++
- oxyd autocoloring - limited to 1.10++
Note:
- the new API is only fully available for levels with compatibility >= 1.10
- all levels with compatibility < 1.10 can have 100% compatibility in
  using the old API
- both API are currently available in parallel for testing purposes
  but mixed usage can cause unwanted sideeffects and will be switched off
  lateron


Modified: trunk/lib-src/enigma-core/ecl_util.cc
===================================================================
--- trunk/lib-src/enigma-core/ecl_util.cc	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/lib-src/enigma-core/ecl_util.cc	2007-09-29 21:35:15 UTC (rev 889)
@@ -89,8 +89,7 @@
     }
 }
 
-string ecl::strf(const char *format, ...)
-{
+string ecl::strf(const char *format, ...) {
     va_list argPtr;
     va_start(argPtr, format);
     string result = vstrf(format, argPtr);
@@ -99,3 +98,38 @@
     return result;
 }
 
+    // string_match accepts simple wildcards
+    // '?' means 'any character'
+    // '*' means '0 or more characters'
+bool ecl::string_match(const char *str, const char *templ) {
+    while (true) {
+        char t = *templ++;
+        char s = *str++;
+
+        if (t == s) {
+            if (!t) return true;
+            continue;
+        }
+        else { // mismatch
+            if (t == '?') continue;
+            if (t != '*') break;
+
+            t = *templ++;
+            if (!t) return true; // '*' at EOS
+
+            while (1) {
+                if (!s) break;
+                if (s == t) {
+                    if (string_match(str, templ))
+                        return true;
+                }
+                s = *str++;
+            }
+        }
+    }
+    return false;
+}
+
+bool ecl::string_match(std::string str, std::string templ) {
+    return string_match(str.c_str(), templ.c_str());
+}

Modified: trunk/lib-src/enigma-core/ecl_util.hh
===================================================================
--- trunk/lib-src/enigma-core/ecl_util.hh	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/lib-src/enigma-core/ecl_util.hh	2007-09-29 21:35:15 UTC (rev 889)
@@ -263,7 +263,26 @@
      *                       path separator was found just false will be returned
      *                       without modification of the return strings.
      */
-    bool        split_path(const std::string& path, std::string* dir_part, std::string* filename_part);
+    bool split_path(const std::string& path, std::string* dir_part, std::string* filename_part);
+    
+    
+    /**
+     * Check a string against a given template that may contain wildcards of '*' and
+     * '?'. A '?' in the template means 'any single character'. A '*' means '0 or more characters'.
+     * @param str     string to be analysed
+     * @param templ   template with wildcards
+     * @return        true if string matches template, false otherwise
+     */
+    bool string_match(const char *str, const char *templ);
+    
+    /**
+     * Check a string against a given template that may contain wildcards of '*' and
+     * '?'. A '?' in the template means 'any single character'. A '*' means '0 or more characters'.
+     * @param str     string to be analysed
+     * @param templ   template with wildcards
+     * @return        true if string matches template, false otherwise
+     */
+    bool string_match(std::string str, std::string templ);
 
 }
 

Modified: trunk/src/Inventory.cc
===================================================================
--- trunk/src/Inventory.cc	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/Inventory.cc	2007-09-29 21:35:15 UTC (rev 889)
@@ -36,7 +36,7 @@
 
 Inventory::~Inventory() 
 {
-    clear();
+    ecl::delete_sequence (m_items.begin(), m_items.end());
 }
 
 

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/Makefile.am	2007-09-29 21:35:15 UTC (rev 889)
@@ -122,6 +122,8 @@
 	utilXML.hh		\
 	video.cc 		\
 	video.hh		\
+	WorldProxy.cc	\
+	WorldProxy.hh	\
 	world.cc 		\
 	world.hh 		\
 	world_internal.hh	\

Added: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/WorldProxy.cc	2007-09-29 21:35:15 UTC (rev 889)
@@ -0,0 +1,127 @@
+/*
+ * Copyright (C) 2007 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "WorldProxy.hh"
+#include "server.hh"
+
+using namespace enigma;
+
+namespace world {
+ 
+    WorldProxy *WorldProxy::theSingleton = 0;
+    
+    WorldProxy* WorldProxy::instance() {
+        if (theSingleton == 0) {
+            theSingleton = new WorldProxy();
+        }
+        return theSingleton;
+    }
+    
+    void WorldProxy::shutdown() {
+        delete theSingleton;
+    }
+    
+    WorldProxy::WorldProxy() {
+    }
+
+    Value WorldProxy::getAttr(const string& key) const {
+        if (key == "AllowTogglePlayer") {
+            return server::AllowTogglePlayer;
+        } else if (key == "CreatingPreview") {
+            return server::CreatingPreview;  // read only
+        } else if (key == "IsDifficult") {
+            return (server::GetDifficulty() == DIFFICULTY_HARD);  // read only
+        } else if (key == "LevelTime") {   
+            return server::LevelTime;    // read only
+        } else if (key == "ShowMoves") {
+            return server::ShowMoves;
+        } else if (key == "ShowMoves") {
+            return server::ShowMoves;
+        } else if (key == "Brittleness") {
+            return server::Brittleness;
+        } else if (key == "BumperForce") {
+            return server::BumperForce;
+        } else if (key == "ElectricForce") {
+            return server::ElectricForce;
+        } else if (key == "FlatForce") {
+            return server::FlatForce;
+        } else if (key == "FrictionFactor") {
+            return server::FrictionFactor;
+        } else if (key == "HoleForce") {
+            return server::HoleForce;
+        } else if (key == "IceFriction") {
+            return server::IceFriction;
+        } else if (key == "MagnetForce") {
+            return server::MagnetForce;
+        } else if (key == "MagnetRange") {
+            return server::MagnetRange;
+        } else if (key == "SlopeForce") {
+            return server::SlopeForce;
+        } else if (key == "SwampSinkSpeed") {
+            return server::SwampSinkSpeed;
+        } else if (key == "WaterSinkSpeed") {
+            return server::WaterSinkSpeed;
+        } else if (key == "WormholeForce") {
+            return server::WormholeForce;
+        } else if (key == "WormholeRange") {
+            return server::WormholeRange;
+        }
+        return Value(Value::DEFAULT);
+    }  
+
+    void WorldProxy::set_attrib(const string& key, const Value &val) {
+        if (key == "AllowTogglePlayer") {
+            server::AllowTogglePlayer = val;
+        } else if (key == "ConserveLevel") {
+            server::ConserveLevel = val.to_bool();
+        } else if (key == "ShowMoves") {
+            server::ShowMoves = val.to_bool();
+            STATUSBAR->show_move_counter (server::ShowMoves);
+        } else if (key == "Brittleness") {
+            server::Brittleness = val;
+        } else if (key == "BumperForce") {
+            server::BumperForce = val;
+        } else if (key == "ElectricForce") {
+            server::ElectricForce = val;
+        } else if (key == "FlatForce") {
+            server::FlatForce = val;
+        } else if (key == "FrictionFactor") {
+            server::FrictionFactor = val;
+        } else if (key == "HoleForce") {
+            server::HoleForce = val;
+        } else if (key == "IceFriction") {
+            server::IceFriction = val;
+        } else if (key == "MagnetForce") {
+            server::MagnetForce = val;
+        } else if (key == "MagnetRange") {
+            server::MagnetRange = val;
+        } else if (key == "SlopeForce") {
+            server::SlopeForce = val;
+        } else if (key == "SwampSinkSpeed") {
+            server::SwampSinkSpeed = val;
+        } else if (key == "WaterSinkSpeed") {
+            server::WaterSinkSpeed = val;
+        } else if (key == "WormholeForce") {
+            server::WormholeForce = val;
+        } else if (key == "WormholeRange") {
+            server::WormholeRange = val;
+        }
+    }
+
+} // namespace world


Property changes on: trunk/src/WorldProxy.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/WorldProxy.hh
===================================================================
--- trunk/src/WorldProxy.hh	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/WorldProxy.hh	2007-09-29 21:35:15 UTC (rev 889)
@@ -0,0 +1,42 @@
+/*
+ * Copyright (C) 2007 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef WORLDPROXY_HH_INCLUDED
+#define WORLDPROXY_HH_INCLUDED
+
+#include "objects_decl.hh"
+
+namespace world {
+
+    class WorldProxy : public Object {
+    public:
+        static WorldProxy *instance();
+        static void shutdown();
+        virtual Value getAttr(const string& key) const;
+        virtual void set_attrib(const string& key, const Value &val);
+        
+    protected:
+        WorldProxy();
+        virtual Object *clone() {return this;}; // dummy implementation
+        virtual void dispose() {};             // dummy implementation
+    private:
+        static WorldProxy *theSingleton;
+    };
+} // namespace world
+
+#endif


Property changes on: trunk/src/WorldProxy.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/actors.hh
===================================================================
--- trunk/src/actors.hh	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/actors.hh	2007-09-29 21:35:15 UTC (rev 889)
@@ -184,6 +184,8 @@
         const GridPos &get_gridpos() const { return m_actorinfo.gridpos; }
 
     protected:
+        virtual Object::ObjectType getObjectType() const {return Object::ACTOR;}
+        
         Actor(const ActorTraits &tr);
         void set_model (const string &modelname);
         void set_anim (const string &modelname);

Modified: trunk/src/floors.hh
===================================================================
--- trunk/src/floors.hh	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/floors.hh	2007-09-29 21:35:15 UTC (rev 889)
@@ -113,6 +113,8 @@
         void on_burnable_animcb(bool justIgnited);  // Called by burnable-items on it.
 
     protected:
+         virtual Object::ObjectType getObjectType() const {return Object::FLOOR;}
+        
         // GridObject interface
         void set_model (const std::string &mname);
         display::Model *get_model ();

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/items.cc	2007-09-29 21:35:15 UTC (rev 889)
@@ -3231,8 +3231,8 @@
 	virtual void dispose() {
 	    Item * it = yield_first();
 	    while (it != NULL) {
-		DisposeObject(it);
-		it = yield_first();
+            DisposeObject(it);
+            it = yield_first();
 	    }
 	    delete this;
 	}
@@ -3263,7 +3263,9 @@
         {}
 
         ~Bag() {
-//            ecl::delete_sequence (m_contents.begin(), m_contents.end());
+            // Bags on the grid are disposed, but bags in the inventory need to be
+            // delete their contents on the destructor
+            ecl::delete_sequence (m_contents.begin(), m_contents.end());
         }
     };
     DEF_TRAITS(Bag, "it-bag", it_bag);

Modified: trunk/src/items.hh
===================================================================
--- trunk/src/items.hh	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/items.hh	2007-09-29 21:35:15 UTC (rev 889)
@@ -222,6 +222,8 @@
         /* Called when item is activated by the owner of `a'. */
         virtual ItemAction activate(Actor* a, GridPos p);
     protected:
+        virtual Object::ObjectType getObjectType() const {return Object::ITEM;}
+        
         // GridObject interface
         virtual void set_model (const std::string &mname) {
             display::SetModel(GridLoc(GRID_ITEMS, get_pos()), mname);

Modified: trunk/src/lev/Proxy.cc
===================================================================
--- trunk/src/lev/Proxy.cc	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/lev/Proxy.cc	2007-09-29 21:35:15 UTC (rev 889)
@@ -614,9 +614,10 @@
         if (getEnigmaCompatibility() > ENIGMACOMPATIBITLITY)
             throw XLevelLoading(ecl::strf("Level is incompatible: %s requires Enigma %.2f or above", 
                     absLevelPath.c_str(), getEnigmaCompatibility()));
-	if (this == currentLevel) {
-	    server::SetCompatibility(this);
-	}
+        if (this == currentLevel) {    // just level - no libs
+            server::SetCompatibility(this);
+            server::EnigmaCompatibility = getEnigmaCompatibility();
+        }
         processDependencies();
         loadLuaCode();
     }

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/lua.cc	2007-09-29 21:35:15 UTC (rev 889)
@@ -1,5 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2007 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -27,6 +28,8 @@
 #include "options.hh"
 #include "lev/Index.hh"
 #include "lev/Proxy.hh"
+#include "WorldProxy.hh"
+#include <list>
 
 #ifndef CXXLUA
 extern "C" {
@@ -48,9 +51,16 @@
 
 #include "nls.hh"
 
+// Lua Registry keys of metatables for user objects
+#define LUA_ID_OBJECT   "_ENIGMAOBJECT"
+#define LUA_ID_POSITION "_POSITION"
+#define LUA_ID_WORLD    "_WORLDOBJECT"
+#define LUA_ID_NAMEOBJ  "_NAMEDOBJECTS"
+#define LUA_ID_GROUP    "_GROUP"
+#define LUA_ID_TILES    "_TILES"
+#define LUA_ID_TILE     "_TILE"
+
 using namespace std;
-using namespace enigma;
-using namespace lua;
 
 using ecl::round_down;
 using ecl::strf;
@@ -59,16 +69,10 @@
 using world::Object;
 using world::GridObject;
 using world::ForceField;
+using world::WorldProxy;
 
-namespace lua
-{
-    int EmitSound (lua_State *L);
-    int EmitSoundGlobal (lua_State *L);
-    int MakeObject (lua_State *L);
-}
-
-namespace 
-{
+namespace enigma { namespace lua {
+     
     lua_State *level_state = 0;  // level-local state
     lua_State *global_state = 0; // global Lua state
 
@@ -118,13 +122,13 @@
         luaL_error(L, backtrace.c_str());
         
     }
-}
 
+
 /* -------------------- Helper routines -------------------- */
 
 using enigma::Value;
 
-void lua::SetTableVar (lua_State *L,
+void SetTableVar (lua_State *L,
                        const char *tablename, 
                        const char *name, 
                        double value)
@@ -136,9 +140,7 @@
     lua_pop (L, 1);
 }
 
-static void
-push_value(lua_State *L, const Value &val)
-{
+static void push_value(lua_State *L, const Value &val) {
     switch (val.getType()) {
         case Value::NIL:
         case Value::DEFAULT :
@@ -153,59 +155,101 @@
     }
 }
 
-static Value
-to_value(lua_State *L, int idx)
-{
+static Value to_value(lua_State *L, int idx) {
     switch (lua_type(L, idx)) {
-    case LUA_TNIL: return Value();
-    case LUA_TNUMBER: return Value(lua_tonumber(L,idx));
-    case LUA_TSTRING: return Value(lua_tostring(L,idx));
-    case LUA_TBOOLEAN: return (lua_toboolean(L,idx)) ? Value(1) : Value();
-    default: throwLuaError(L,"Cannot convert type to Value.");
+        case LUA_TNIL: return Value();
+        case LUA_TNUMBER: return Value(lua_tonumber(L,idx));
+        case LUA_TSTRING: return Value(lua_tostring(L,idx));
+        case LUA_TBOOLEAN: return (lua_toboolean(L,idx)) ? Value(1) : Value();
+        default: throwLuaError(L,"Cannot convert type to Value.");
     }
     return Value();
 }
 
-static bool
-is_object(lua_State *L, int idx)
-{
-    return lua_isuserdata(L,idx) && luaL_checkudata(L,idx,"_ENIGMAOBJECT");
+static bool checkMetadata (lua_State *L, int idx, const char *name) {
+    bool result = false;
+    if (lua_getmetatable(L, idx)) {  // does it have a metatable?
+        lua_getfield(L, LUA_REGISTRYINDEX, name);  // get correct metatable
+        if (lua_rawequal(L, -1, -2)) {  // does it have the correct mt?
+            result = true;
+        } else {  // check if it is dynamic metatable
+            lua_getfield(L, -2, "_id");
+            if (lua_isstring(L, -1) && (strcmp(lua_tostring(L, -1), name) == 0))
+                result = true;
+            lua_pop(L, 1);
+        }
+        lua_pop(L, 2);  // remove both metatables
+    }
+    return result;
 }
 
-static Object *
-to_object(lua_State *L, int idx)
-{
-    if (lua_isnil(L,idx))
-        return 0;
+static bool is_table(lua_State *L, int idx) {
+    return lua_istable(L,idx);
+}
 
+static bool is_object(lua_State *L, int idx) {
+    return lua_isuserdata(L,idx) && checkMetadata(L, idx, LUA_ID_OBJECT);
+}
+
+static bool is_position(lua_State *L, int idx) {
+    return lua_isuserdata(L,idx) && checkMetadata(L, idx, LUA_ID_POSITION);
+}
+
+static bool is_tile(lua_State *L, int idx) {
+    return lua_isuserdata(L,idx) && checkMetadata(L, idx, LUA_ID_TILE);
+}
+
+static bool is_tiles(lua_State *L, int idx) {
+    return lua_isuserdata(L,idx) && checkMetadata(L, idx, LUA_ID_TILES);
+}
+
+static bool is_group(lua_State *L, int idx) {
+    return lua_isuserdata(L,idx) && checkMetadata(L, idx, LUA_ID_GROUP);
+}
+
+static bool is_world(lua_State *L, int idx) {
+    return lua_isuserdata(L,idx) && checkMetadata(L, idx, LUA_ID_WORLD);
+}
+
+static Object *to_object(lua_State *L, int idx) {
+    
+    if (lua_isnil(L,idx) && server::EnigmaCompatibility < 1.10)
+        return NULL;
+
     if (!is_object(L,idx)) {
         throwLuaError(L, "Cannot convert type to an Object");
-        return 0;
+        return NULL;
     }
-    return static_cast<Object*>(*(static_cast<void**>(lua_touserdata(L,idx))));
+    int id = *(static_cast<int *>(lua_touserdata(L,idx)));
+    Object *obj = NULL;
+    if (id != -1)
+       obj = world::Object::getObject(id);
+
+    return obj;  // NULL if object does no longer exist
 }
 
-static void
-pushobject (lua_State *L, Object *obj)
-{
-    Object **udata;
+static void pushobject (lua_State *L, Object *obj) {
+    int *udata;
     /* Lua does not allow NULL pointers in userdata variables, so
        convert them manually to `nil' values. */
-    if (obj == 0)
-        lua_pushnil(L);
-    else
-      {
-        udata=(Object**)lua_newuserdata(L,sizeof(int));
-	*udata=obj;
-        luaL_getmetatable(L, "_ENIGMAOBJECT");
+    if (obj == NULL && server::EnigmaCompatibility < 1.10) {
+        lua_pushnil(L);   // nil as not existing object
+    } else {
+        udata=(int *)lua_newuserdata(L,sizeof(int));
+        if (obj != NULL)
+            *udata = obj->getId();
+        else
+            *udata = -1;  // object with id 0 as not existing object
+        luaL_getmetatable(L, LUA_ID_OBJECT);
         lua_setmetatable(L, -2);
-      }
+    }
 }
 
-
+
 /* -------------------- Interface routines -------------------- */
 
-int lua::MakeObject (lua_State *L)
+
+int MakeObject (lua_State *L)
 {
     const char *name = lua_tostring(L, 1);
     if (!name) {
@@ -238,24 +282,19 @@
     return 0;
 }
 
-static int
-en_get_attrib(lua_State *L)
-{
+static int en_get_attrib(lua_State *L) {
     Object *obj = to_object(L,1);
     const char *key = lua_tostring(L,2);
 
     if (!obj) {
         throwLuaError(L, "GetAttrib: invalid object");
         return 0;
-    }
-    if (!key) {
+    } else if (!key) {
         throwLuaError(L, "GetAttrib: invalid key");
         return 0;
-    }
-
-    if (0 == strcmp(key, "kind")) {
+    } else if (0 == strcmp(key, "kind")) {
         throwLuaError(L, "GetAttrib: illegal attribute, use GetKind()");
-        return 0;
+        return 0;        
     }
 
     push_value(L, obj->getAttr(key));
@@ -385,7 +424,7 @@
     return 0;
 }
 
-int lua::EmitSound (lua_State *L)
+int EmitSound (lua_State *L)
 {
     Object     *obj       = to_object(L, 1);
     const char *soundname = lua_tostring(L, 2);
@@ -414,7 +453,7 @@
     return 0;
 }
 
-int lua::EmitSoundGlobal (lua_State *L)
+int EmitSoundGlobal (lua_State *L)
 {
     const char *soundname = lua_tostring(L, 1);
     double vol = 1.0;
@@ -624,6 +663,1284 @@
     return 1;
 }
 
+
+/* -------------------- new functions -------------------- */
+
+static int pushNewPosition(lua_State *L) {
+    // x at -2, y at -1
+    int *udata;
+    udata=(int *)lua_newuserdata(L,sizeof(int));   // position user object
+    *udata = 1;
+    
+    lua_newtable(L);  // individual metatable copy
+    luaL_getmetatable(L, LUA_ID_POSITION);
+    // copy metatable template
+    lua_pushnil(L);  // first key
+    while (lua_next(L, -2) != 0) {
+         // key is at index -2 and value at index -1
+         lua_pushvalue(L, -2);   // copy key
+         lua_insert(L, -2);      // insert key copy below value
+         lua_settable(L, -5);    // individual metatable
+    }    
+    lua_pop(L, 1);  // remove metatable template
+
+    lua_pushvalue(L, -4);
+    lua_rawseti(L, -2, 1);
+    lua_pushvalue(L, -3);
+    lua_rawseti(L, -2, 2);
+
+    lua_setmetatable(L, -2);    
+    return 1;
+}
+
+static int newPosition(lua_State *L) {
+    // (pos|obj|table|(num,num))
+    if (is_table(L, 1)) {  // table 
+        lua_rawgeti(L, 1, 1);
+        lua_rawgeti(L, 1, 2);
+    } else if (is_position(L, 1)) {
+        lua_getmetatable(L, 1);
+        lua_rawgeti(L, 2, 1);
+        lua_rawgeti(L, 2, 2);
+    } else if (is_object(L, 1)) {
+        lua_pushstring(L, "x");
+        lua_gettable(L, 1); 
+        lua_pushstring(L, "y");
+        lua_gettable(L, 1); 
+    }
+    
+    if ((lua_type(L, -2) != LUA_TNUMBER) || (lua_type(L, -1) != LUA_TNUMBER)) {
+        throwLuaError(L, "Invalid new position value type");
+        return 0;
+    }    
+
+    return pushNewPosition(L);
+}
+
+static int addPositionsBase(lua_State *L, int factorArg2) {
+    // (pos|obj|table) +|- (pos|obj|table)
+    double x = 0;
+    double y = 0;
+    for (int i = 1; i<=2; i++) {
+        if (is_table(L, i)) {  // table
+            lua_rawgeti(L, i, 1);
+            lua_rawgeti(L, i, 2);
+        } else if (is_position(L, i)) {
+            lua_getmetatable(L, i);
+            lua_rawgeti(L, -1, 1);
+            lua_rawgeti(L, -2, 2);
+            lua_remove(L, -3);
+        } else if (is_object(L, i)) {
+            lua_pushstring(L, "x");
+            lua_gettable(L, i); 
+            lua_pushstring(L, "y");
+            lua_gettable(L, i); 
+        } else {
+            throwLuaError(L, "Invalid add position value type");
+        }
+        if ((lua_type(L, -2) != LUA_TNUMBER) || (lua_type(L, -1) != LUA_TNUMBER)) {
+            throwLuaError(L, "Invalid add position value type");
+            return 0;
+        }            
+        x += (i == 1 ? 1 : factorArg2) *  lua_tonumber(L, -2);
+        y += (i == 1 ? 1 : factorArg2) *  lua_tonumber(L, -1);
+        lua_pop(L, 2);
+    }
+
+    lua_pushnumber(L, x);
+    lua_pushnumber(L, y);
+    return pushNewPosition(L);
+}
+
+static int addPositions(lua_State *L) {
+    // (pos|obj|table) + (pos|obj|table)
+    return addPositionsBase(L, 1);
+}
+    
+static int subPositions(lua_State *L) {
+    // (pos|obj|table) - (pos|obj|table)
+    return addPositionsBase(L, -1);
+}
+
+static int centerPosition(lua_State *L) {
+    // #(pos|obj)
+    if (is_position(L, 1)) {  // position
+        lua_getmetatable(L, 1);
+        lua_rawgeti(L, -1, 1);
+        lua_rawgeti(L, -2, 2);
+        lua_remove(L, -3);
+    } else if (is_object(L, 1)) {
+        lua_pushstring(L, "x");
+        lua_gettable(L, 1); 
+        lua_pushstring(L, "y");
+        lua_gettable(L, 1); 
+    } else {
+        throwLuaError(L, "Invalid center position value type");
+    }
+    if ((lua_type(L, -2) != LUA_TNUMBER) || (lua_type(L, -1) != LUA_TNUMBER)) {
+        throwLuaError(L, "Invalid center position value type");
+        return 0;
+    }            
+    double x = round_down<int>(lua_tonumber(L, -2)) + 0.5;
+    double y = round_down<int>(lua_tonumber(L, -1)) + 0.5;
+    lua_pop(L, 2);
+    
+    lua_pushnumber(L, x);
+    lua_pushnumber(L, y);
+    return pushNewPosition(L);
+}
+
+static int multiplyPositionsBase(lua_State *L, bool isDiv = false) {
+    // (pos|num) (*|/) (pos|num)
+    double x = 0;
+    double y = 0;
+    double f = 1;
+    for (int i = 1; i<=2; i++) {
+        if (is_position(L, i)) {
+            lua_getmetatable(L, i);
+            lua_rawgeti(L, -1, 1);
+            x = lua_tonumber(L, -1);
+            lua_rawgeti(L, -2, 2);
+            y = lua_tonumber(L, -1);
+            lua_pop(L, 3);
+        } else if (lua_isnumber(L, i)) {
+            f = lua_tonumber(L, i);
+        } else {
+            throwLuaError(L, "Invalid multiplication position value type");
+            return 0;
+        }
+    }
+
+    if (isDiv) {
+        x /= f;
+        y /= f;
+    } else {
+        x *= f;
+        y *= f;
+    }
+    lua_pushnumber(L, x);
+    lua_pushnumber(L, y);
+    return pushNewPosition(L);
+}
+
+static int multiplyPositions(lua_State *L) {
+    // (pos|num) * (pos|num)
+    if (is_position(L, 1) && is_position(L, 2)) {
+        throwLuaError(L, "Multiplication of two positions not allowed");
+        return 0;        
+    }
+    return multiplyPositionsBase(L);
+}
+ 
+static int dividePositions(lua_State *L) {
+    // (pos|num) * (pos|num)
+    if (!is_position(L, 1) || !lua_isnumber(L, 2)) {
+        throwLuaError(L, "Division of position with wrong types");
+        return 0;        
+    }
+    return multiplyPositionsBase(L, true);
+}
+
+static int gridAlignPosition(lua_State *L) {
+    // position guaranteed
+    lua_getmetatable(L, 1);
+    lua_rawgeti(L, -1, 1);
+    lua_rawgeti(L, -2, 2);
+    double x = round_down<int>(lua_tonumber(L, -2));
+    double y = round_down<int>(lua_tonumber(L, -1));
+    lua_pushnumber(L, x);
+    lua_pushnumber(L, y);
+    pushNewPosition(L);
+    return 1;
+}
+
+static int pushNewTile(lua_State *L, int numArgs) {
+    // numArgs 1 or 2 of type (table|tile)
+    int *udata;
+    udata=(int *)lua_newuserdata(L,sizeof(int));   // position user object
+    *udata = 1;
+    
+    lua_newtable(L);  // individual metatable copy
+    luaL_getmetatable(L, LUA_ID_TILE);
+    // copy metatable template
+    lua_pushnil(L);  // first key
+    while (lua_next(L, -2) != 0) {
+         // key is at index -2 and value at index -1
+         lua_pushvalue(L, -2);   // copy key
+         lua_insert(L, -2);      // insert key copy below value
+         lua_settable(L, -5);    // individual metatable
+    }    
+    lua_pop(L, 1);  // remove metatable template
+
+    lua_pushvalue(L, -2 - numArgs);
+    lua_rawseti(L, -2, 1);
+    if (numArgs == 2) {
+        lua_pushvalue(L, -3);
+        lua_rawseti(L, -2, 2);
+    }
+    lua_setmetatable(L, -2);    
+    return 1;
+}
+
+
+
+static void setObjectAttributes(Object *obj, lua_State *L) {
+    // L, -1 is table with key, values
+    if (obj == NULL || !lua_istable(L, -1)) 
+        return;
+    // process all table entries
+    lua_pushnil(L);  // first key
+    while (lua_next(L, -2) != 0) {
+         // key is at index -2 and value at index -1
+         // ignore all keys besides strings - ignore key 1, the object type
+         lua_pushvalue(L, -2); // a copy of key for work
+         if (!lua_isnumber(L, -1) && lua_isstring(L, -1)) {
+            std::string key = lua_tostring(L, -1);
+            if (key == "name") {
+                if (lua_isstring(L, -2))
+                    world::NameObject(obj, lua_tostring(L, -2));
+            } else {
+                obj->set_attrib(key, to_value(L, -2));
+            }
+         }
+         lua_pop(L, 2);  // remove copy key + value, leave original key for loop
+    }    
+}
+
+static int setAttributes(lua_State *L) {
+    // 
+    Object *obj = to_object(L, 1);
+    setObjectAttributes(obj, L);
+    return 0;
+}
+
+static int getFloor(lua_State *L) {
+    // position|table|obj|(num,num)
+    if (is_world(L, 1))      // world method?
+        lua_remove(L, 1);    // no need of context
+    newPosition(L);          // unify all arg types to a position
+    lua_getmetatable(L, -1);            
+    lua_rawgeti(L, -1, 1);
+    int x = round_down<int>(lua_tonumber(L, -1));
+    lua_rawgeti(L, -2, 2);
+    int y = round_down<int>(lua_tonumber(L, -1));
+    Object *o = world::GetFloor(GridPos(x, y));
+    pushobject(L, o);
+    return 1;
+}
+
+static int getItem(lua_State *L) {
+    // position|table|obj|(num,num)
+    if (is_world(L, 1))      // world method?
+        lua_remove(L, 1);    // no need of context
+    newPosition(L);          // unify all arg types to a position
+    lua_getmetatable(L, -1);            
+    lua_rawgeti(L, -1, 1);
+    int x = round_down<int>(lua_tonumber(L, -1));
+    lua_rawgeti(L, -2, 2);
+    int y = round_down<int>(lua_tonumber(L, -1));
+    Object *o = world::GetItem(GridPos(x, y));
+    pushobject(L, o);
+    return 1;
+}
+
+static int getStone(lua_State *L) {
+    // position|table|obj|(num,num)
+    if (is_world(L, 1))      // world method?
+        lua_remove(L, 1);    // no need of context
+    newPosition(L);          // unify all arg types to a position
+    lua_getmetatable(L, -1);            
+    lua_rawgeti(L, -1, 1);
+    int x = round_down<int>(lua_tonumber(L, -1));
+    lua_rawgeti(L, -2, 2);
+    int y = round_down<int>(lua_tonumber(L, -1));
+    Object *o = world::GetStone(GridPos(x, y));
+    pushobject(L, o);
+    return 1;
+}
+
+static int killObjectBase(lua_State *L) {
+    Object *obj = to_object(L, -1);
+    if (obj) {   // ignore not existing object
+        GridObject *gobj;
+        switch (obj->getObjectType()) {
+            case Object::FLOOR :
+                gobj = dynamic_cast<GridObject*>(obj);
+                world::KillFloor(gobj->get_pos());
+                break;
+            case Object::STONE :
+                gobj = dynamic_cast<GridObject*>(obj);
+                world::KillStone(gobj->get_pos());
+                break;
+            case Object::ITEM  :
+                gobj = dynamic_cast<GridObject*>(obj);
+                world::KillItem(gobj->get_pos());
+                break;
+            case Object::ACTOR :
+            default :
+                throwLuaError(L, "Kill of object type not allowed");
+        }
+    }
+    return 0;
+}
+
+static int killObject(lua_State *L) {
+    if (lua_gettop(L) != 1) {
+         throwLuaError(L, "Kill of object allows no arguments");
+         return 0;
+    }
+    if (is_group(L, 1)) {
+        lua_getmetatable(L, 1);
+        int numObjects = lua_objlen(L, -1);
+        for (int i = 1; i <= numObjects; ++i) {
+            lua_rawgeti(L, -1, i);  // the object
+            killObjectBase(L);
+            lua_pop(L, 1);  // the object
+        }
+    } else {
+        killObjectBase(L);
+    }
+    return 0;
+}
+
+static int xyObject(lua_State *L) {
+    // object guaranteed
+    Object *obj = to_object(L,1);
+    GridPos  p;
+    if (GridObject *gobj = dynamic_cast<GridObject*>(obj)) {
+        p = gobj->get_pos();
+    } else if (Actor *a = dynamic_cast<Actor*>(obj)) {
+        p = GridPos(a->get_pos());
+    } else {
+        throwLuaError(L, "xy access to not existing object");
+        return 0;
+    }
+    lua_pushnumber(L, double(p.x));
+    lua_pushnumber(L, double(p.y));
+    return 2;    
+}
+
+static int objectEquality(lua_State *L) {
+    Object *obj1 = to_object(L,1);
+    Object *obj2 = to_object(L,2);
+
+    lua_pushboolean(L, (obj1 == obj2) && obj1);
+    return 1;
+}
+
+static int objectExistance(lua_State *L) { 
+    // object type is guaranteed
+    Object * obj = to_object(L, 1);
+    lua_pushboolean(L, (obj != NULL));
+    return 1;
+}
+
+static int objectMessageBase(lua_State *L) {
+    // (object, string , value)
+    Object     *obj = to_object(L, -3);
+    if (!lua_isstring(L, -2)) {
+        throwLuaError(L,"Illegal message - no string");
+        return 0;
+    }
+    std::string msg = lua_tostring(L, -2);
+    
+    Value answer;
+    Value val = to_value(L, -1);
+    
+    if (obj) {   // ignore not existing objects
+        try {
+            answer = world::SendMessage (obj, msg, val);
+        }
+        catch (const XLevelRuntime &e) {
+            throwLuaError (L, e.what());
+        }
+        catch (...) {
+            throwLuaError (L, "uncaught exception");
+        }
+    }
+    push_value(L, answer);
+    return 1;
+}
+
+static int objectMessage(lua_State *L) {
+    if (lua_gettop(L) < 2) {
+        throwLuaError (L, "Message missing");
+        return 0;
+    } else if (lua_gettop(L) == 2) {
+        lua_pushnil(L);
+    }
+    return objectMessageBase(L);
+}
+
+static int groupMessage(lua_State *L) {
+    if (lua_gettop(L) < 2) {
+        throwLuaError (L, "Message missing");
+        return 0;
+    } else if (lua_gettop(L) == 2) {
+        lua_pushnil(L);
+    }
+    
+    lua_getmetatable(L, 1);
+    int numObjects = lua_objlen(L, -1);
+    lua_settop(L, 8);   // add 4 nil - simulate previous loop run
+    for (int i = 1; i <= numObjects; ++i) {
+        lua_pop(L, 4);          // pop args and return value from last loop
+        lua_rawgeti(L, -1, i);  // the object
+        lua_pushvalue(L, 2);    // copy the message
+        lua_pushvalue(L, 3);    // copy message value
+        objectMessageBase(L);   // end up with return value on top
+    }
+    return numObjects >= 1 ? 1 : 0;  // return last message value if group was not empty
+}
+
+std::vector<std::string> messageLIFO;
+
+static int objectDirectMessage(lua_State *L) {
+    std::string message = messageLIFO.back();
+    messageLIFO.pop_back();
+    lua_pushstring(L, message.c_str());
+    lua_insert(L, 2);    // message below optional value
+    return objectMessage(L);
+}
+
+static int groupDirectMessage(lua_State *L) {
+    std::string message = messageLIFO.back();
+    messageLIFO.pop_back();
+    lua_pushstring(L, message.c_str());
+    lua_insert(L, 2);    // message below optional value
+    return groupMessage(L);
+}
+
+static int pushNewGroup(lua_State *L, std::list<Object *> objects) {
+    // NULL objects and duplicates entries in the list will be eliminated
+    int *udata;
+    udata=(int *)lua_newuserdata(L,sizeof(int));   // group user object
+    *udata = 1;
+    
+    lua_newtable(L);  // individual metatable copy
+    luaL_getmetatable(L, LUA_ID_GROUP);
+    // copy metatable template
+    lua_pushnil(L);  // first key
+    while (lua_next(L, -2) != 0) {
+         // key is at index -2 and value at index -1
+         lua_pushvalue(L, -2);   // copy key
+         lua_insert(L, -2);      // insert key copy below value
+         lua_settable(L, -5);    // individual metatable
+    }    
+    lua_pop(L, 1);  // remove metatable template
+
+    std::set<Object *> unique;
+    std::list<Object *>::iterator it = objects.begin();
+    for (int i = 1; it != objects.end(); ++it, ++i) {
+        if (*it) {  // existing object not NULL
+            if (unique.find(*it) == unique.end()) {
+                unique.insert(*it);
+                pushobject(L, *it);
+                lua_rawseti(L, -2, i);
+            }
+        }
+    }
+
+    lua_setmetatable(L, -2);    
+    return 1;
+}
+
+static int newGroup(lua_State *L) {
+    // (table | (obj[,obj]))
+    std::list<Object *> objects;
+    if (is_table(L, 1)) {
+       if (lua_gettop(L) > 1) {
+            throwLuaError(L, "New Group - more arguments than table of objects");
+            return 0;
+       }
+       lua_pushnil(L);  // first key
+       while (lua_next(L, 1) != 0) {
+           // key at -2, value at -1
+           objects.push_back(to_object(L, -1));
+           lua_pop(L, 1);  // remove value; keep key for next iteration
+       }
+    } else if (is_object(L, 1)) {
+        for (int i = 1; i <= lua_gettop(L); i++) {
+            objects.push_back(to_object(L, i));
+        }
+    } else {
+        throwLuaError(L, "New Group - argument is no object");
+        return 0;
+    }
+    return pushNewGroup(L, objects);
+}
+
+static int joinGroup(lua_State *L) {
+    // (grp|obj) + (grp|obj)
+    if (!((is_group(L, 1) || is_object(L, 1)) &&  (is_group(L, 2) || is_object(L, 2)))) {
+        throwLuaError(L, "Join Group - argument is no object or group");
+        return 0;
+    }
+    std::list<Object *> objects;
+    for (int j = 1; j <= 2; j++) {
+        if (is_group(L, j)) {
+            lua_getmetatable(L, j);
+            int numObjects = lua_objlen(L, -1);
+            for (int i = 1; i <= numObjects; ++i) {
+                lua_rawgeti(L, -1, i);  // the object
+                objects.push_back(to_object(L, -1));
+                lua_pop(L, 1);          // the object        
+            }
+            lua_pop(L, 1);          // the metatable        
+        } else {
+            objects.push_back(to_object(L, j));
+        }
+    }
+    return pushNewGroup(L, objects);    
+}
+
+static int intersectGroupBase(lua_State *L, bool isIntersect) {
+    // (grp|obj) (*|-) (grp|obj)
+    if (!((is_group(L, 1) || is_object(L, 1)) &&  (is_group(L, 2) || is_object(L, 2)))) {
+        throwLuaError(L, "Intersect or Diff Group - argument is no object or group");
+        return 0;
+    }
+    std::list<Object *> objects;
+    std::set<Object *> objSet;
+    
+    if (is_group(L, 2)) {
+        lua_getmetatable(L, 2);
+        int numObjects = lua_objlen(L, -1);
+        for (int i = 1; i <= numObjects; ++i) {
+            lua_rawgeti(L, -1, i);  // the object
+            objSet.insert(to_object(L, -1));
+            lua_pop(L, 1);          // the object        
+        }
+        lua_pop(L, 1);          // the metatable        
+    } else {
+        objSet.insert(to_object(L, 2));
+    }
+    
+    if (is_group(L, 1)) {
+        lua_getmetatable(L, 1);
+        int numObjects = lua_objlen(L, -1);
+        for (int i = 1; i <= numObjects; ++i) {
+            lua_rawgeti(L, -1, i);  // the object
+            Object * obj = to_object(L, -1);
+            if ((isIntersect && objSet.find(obj) != objSet.end()) ||
+                    (!isIntersect && objSet.find(obj) == objSet.end()))
+                objects.push_back(obj);
+            lua_pop(L, 1);          // the object        
+        }
+        lua_pop(L, 1);          // the metatable        
+    } else {
+        Object * obj = to_object(L, 2);
+        if ((isIntersect && objSet.find(obj) != objSet.end()) ||
+                (!isIntersect && objSet.find(obj) == objSet.end()))
+            objects.push_back(obj);
+    }
+    return pushNewGroup(L, objects);    
+}
+
+static int intersectGroup(lua_State *L) {
+    // (grp|obj) * (grp|obj)
+    return intersectGroupBase(L, true);    
+}
+
+static int differenzGroup(lua_State *L) {
+    // (grp|obj) - (grp|obj)
+    return intersectGroupBase(L, false);    
+}
+
+MethodMap objectMethodeMap;
+
+static int dispatchObjectReadAccess(lua_State *L) {
+    int keyType = lua_type(L, 2);
+    
+    std::string keyStr;
+    MethodMap::iterator iter;
+    double keyNum = 0;
+    
+    switch (keyType) {
+        case LUA_TSTRING:
+            keyStr = lua_tostring(L, 2); 
+            iter = objectMethodeMap.find(keyStr);
+            break;
+        case LUA_TNUMBER:
+            keyNum = lua_tonumber(L, 2); break;
+        default:
+            throwLuaError(L, "Invalid object read index type");
+            return 0;
+    }
+    
+    if (keyType == LUA_TSTRING && iter != objectMethodeMap.end()) {
+        // call method -- the existance of the object is not guaranteed!
+        lua_pushcfunction(L, iter->second);
+        return 1;
+    } 
+    
+    Object *obj = to_object(L,1);
+
+    if (obj && (keyType == LUA_TSTRING) && ((keyStr == "x") || (keyStr == "y"))) {
+//    if (obj && (((keyType == LUA_TSTRING) &&
+//            ((keyStr == "x") || (keyStr == "y"))) || 
+//            ((keyType == LUA_TNUMBER) && ((keyNum == 1) || (keyNum == 2))))) {
+        GridPos  p;
+        if (GridObject *gobj = dynamic_cast<GridObject*>(obj)) {
+            p = gobj->get_pos();
+        } else if (Actor *a = dynamic_cast<Actor*>(obj)) {
+            p = GridPos(a->get_pos());
+        } else {
+            p = GridPos(-1, -1);
+        }
+        
+        if (keyStr == "x")  {
+//        if (((keyType == LUA_TSTRING) && (keyStr == "x")) ||
+//                 ((keyType == LUA_TNUMBER) && (keyNum == 1))) {
+            lua_pushnumber(L, double(p.x));
+            return 1;
+        } else {
+            lua_pushnumber(L, double(p.y));
+            return 1;
+        }
+    } else {
+        // attribute
+        Value val;  // nil
+        if (obj) 
+            val = obj->getAttr(keyStr);
+        if ((keyStr.find('_') != 0) && val.isDefault()) {
+            // object exists and no user attribute - no existing system attribute
+            // try to send message
+            messageLIFO.push_back(keyStr);
+            lua_pushcfunction(L, objectDirectMessage);
+        } else {
+            // user attribute, existing system attribute or nil if no object
+            push_value(L, val);
+        }
+        return 1;
+    }
+    return 0;
+}
+
+static int dispatchObjectWriteAccess(lua_State *L){
+    Object *obj = to_object(L,1);
+    const char *key = lua_tostring(L,2);
+    if (obj && key)
+        obj->set_attrib(key, to_value(L, 3));
+    else if (obj)  // ignore NULL objects
+        throwLuaError(L, strf("SetAttrib: invalid object or attribute name '%s'", key).c_str());
+    return 0;
+}
+
+
+
+static int xyPosition(lua_State *L) {
+    // position guaranteed
+    lua_getmetatable(L, 1);            
+    lua_rawgeti(L, -1, 1);
+    lua_rawgeti(L, -2, 2);
+    return 2;    
+}
+
+static int positionEquality(lua_State *L) {
+    // position type is guaranteed
+    lua_getmetatable(L, 1);
+    lua_rawgeti(L, -1, 1);
+    lua_rawgeti(L, -2, 2);
+    lua_getmetatable(L, 2);
+    lua_rawgeti(L, -1, 1);
+    lua_rawgeti(L, -2, 2);
+
+    lua_pushboolean(L, lua_equal(L, -5, -2) && lua_equal(L, -4, -1));
+    return 1;
+}
+
+
+MethodMap positionMethodeMap;
+
+
+static int dispatchPositionReadAccess(lua_State *L) {
+    // L,1 is a table
+    int keyType = lua_type(L, 2);
+    
+    std::string keyStr;
+    MethodMap::iterator iter;
+    double keyNum = 0;
+    
+    switch (keyType) {
+        case LUA_TSTRING:
+            keyStr = lua_tostring(L, 2); 
+            iter = positionMethodeMap.find(keyStr);
+            break;
+        case LUA_TNUMBER:
+            keyNum = lua_tonumber(L, 2); break;
+        default:
+            throwLuaError(L, "Invalid position read index type");
+            return 0;
+    }
+    
+    if (keyType == LUA_TSTRING && iter != positionMethodeMap.end()) {
+        // call method
+        lua_pushcfunction(L, iter->second);
+        return 1;
+    } 
+    
+    if ((keyType == LUA_TSTRING) && ((keyStr == "x") || (keyStr == "y"))) {
+//    if (((keyType == LUA_TSTRING) &&
+//            ((keyStr == "x") || (keyStr == "y"))) || 
+//            ((keyType == LUA_TNUMBER) && ((keyNum == 1) || (keyNum == 2)))) {
+        
+        lua_getmetatable(L, 1);
+        if (keyStr == "x") {
+//        if (((keyType == LUA_TSTRING) && (keyStr == "x")) ||
+//                 ((keyType == LUA_TNUMBER) && (keyNum == 1))) {
+            lua_rawgeti(L, -1, 1);
+        } else {
+            lua_rawgeti(L, -1, 2);
+        }
+        return 1;
+    }
+    
+    throwLuaError(L, "Invalid position index");
+    return 0;
+}
+
+static int dispatchPositionWriteAccess(lua_State *L) {
+    // L,1 is a table
+    int keyType = lua_type(L, 2);
+    // L,3 is value
+    
+    std::string keyStr;
+    double keyNum = 0;
+    
+    switch (keyType) {
+        case LUA_TSTRING:
+            keyStr = lua_tostring(L, 2);  break;
+        case LUA_TNUMBER:
+            keyNum = lua_tonumber(L, 2); break;
+        default:
+            throwLuaError(L, "Invalid position write index type");
+            return 0;
+    }
+    
+    if (lua_type(L, 3) != LUA_TNUMBER) {
+            throwLuaError(L, "Invalid position write value type");
+            return 0;
+    }
+     
+    if ((keyType == LUA_TSTRING) && ((keyStr == "x") || (keyStr == "y"))) {
+//    if (((keyType == LUA_TSTRING) &&
+//            ((keyStr == "x") || (keyStr == "y"))) || 
+//            ((keyType == LUA_TNUMBER) && ((keyNum == 1) || (keyNum == 2)))) {
+        lua_getmetatable(L, 1);
+        lua_pushvalue(L, -2);
+        if (keyStr == "x") {
+//        if (((keyType == LUA_TSTRING) && (keyStr == "x")) ||
+//                 ((keyType == LUA_TNUMBER) && (keyNum == 1))) {
+            lua_rawseti(L, -2, 1);
+            return 0;
+        } else {
+            lua_rawseti(L, -2, 2);
+            return 0;
+        }
+    }
+    
+    throwLuaError(L, "Invalid position index");
+    return 0;
+}
+
+MethodMap namedObjMethodeMap;
+
+
+static int dispatchNamedObjReadAccess(lua_State *L) {
+    // string with *,? wildcards are groups, rest is single object
+    if (!lua_isstring(L, 2)) {
+        throwLuaError(L, "Named object access without giving a name");
+        return 0;
+    }
+    std::string name = lua_tostring(L, 2);
+    
+    if (name.find_first_of("*?") != std::string::npos) {
+        // search all objects that match the template
+        std::list<Object *> group = world::GetNamedGroup(name);
+        return pushNewGroup(L, group);
+    } else {    
+        // search for a unique object
+        Object *obj = world::GetNamedObject(name);
+        pushobject(L, obj);
+    }
+    return 1;
+}
+
+static int dispatchNamedObjWriteAccess(lua_State *L) {
+    // $string -- is reserved
+    Object *obj  = to_object(L, 3);
+    if (!obj) {   // no need to name not existing object
+        return 0;
+    } else if (!lua_isstring(L, 2)) {
+        throwLuaError(L, "NameObject: Illegal name");
+        return 0;
+    }
+    std::string name = lua_tostring(L, 2);
+    if (name.find('$') == 0) {
+        throwLuaError(L, "NameObject: names with leading '$' are reserved");
+        return 0;
+    }
+    world::NameObject(obj, name);
+    return 0;
+}
+
+static int pushNewNamedObj(lua_State *L) {
+    // x at -2, y at -1
+    int *udata;
+    udata=(int *)lua_newuserdata(L,sizeof(int));   // position user object
+    *udata = 1;
+    
+    luaL_getmetatable(L, LUA_ID_NAMEOBJ);
+    lua_setmetatable(L, -2);
+    return 1;
+}
+
+
+MethodMap worldMethodeMap;
+
+
+static int dispatchWorldReadAccess(lua_State *L) {
+    // 
+    if (lua_isstring(L, 2)) {
+        std::string keyStr = lua_tostring(L, 2);
+        // TODO check string
+        MethodMap::iterator iter = worldMethodeMap.find(keyStr);
+        if (iter != positionMethodeMap.end()) {
+            // call method
+            lua_pushcfunction(L, iter->second);
+        } else {
+            Value v = WorldProxy::instance()->getAttr(keyStr);
+            push_value(L, v);
+        }
+        return 1;
+    } else {
+        throwLuaError(L, "Named object access without giving a name");
+        return 0;
+    }
+}
+
+
+static int setObjectByTable(lua_State *L, double x, double y) {
+    // table at -1 
+    int xi = round_down<int>(x);
+    int yi = round_down<int>(y);
+    Object *obj = NULL;
+    lua_rawgeti(L, -1, 1);
+    if (!lua_isstring(L, -1)) {
+        throwLuaError(L, "World: object type string missing");
+        return 0;
+    }
+    std::string name = lua_tostring(L, -1);
+    if (name.find('#') == 0 ) {
+        // position to be centered
+        x = xi + 0.5;
+        y = yi + 0.5;
+        name = name.substr(1);
+    }
+    
+    if (name == "fl-nil") {
+        world::KillFloor(GridPos(xi, yi));
+        return 0;
+    } else if (name == "st-nil") {
+        world::KillStone(GridPos(xi, yi));
+        return 0;
+    } else if (name == "it-nil") {
+        world::KillItem(GridPos(xi, yi));
+        return 0;
+    }
+    
+    obj = world::MakeObject(name.c_str());
+    if (obj == NULL) {
+        throwLuaError(L, ecl::strf("World: unknown object name '%s'", name.c_str()).c_str());
+        return 0;
+    }
+    lua_pop(L, 1);   // object type
+    setObjectAttributes(obj, L);
+    switch (obj->getObjectType()) {
+        case Object::FLOOR :
+            world::SetFloor(GridPos(xi,yi), dynamic_cast<Floor *>(obj));
+            break;
+        case Object::STONE :
+            world::SetStone(GridPos(xi,yi), dynamic_cast<Stone *>(obj));
+            break;
+        case Object::ITEM  :
+            world::SetItem(GridPos(xi,yi), dynamic_cast<Item *>(obj));
+            break;
+        case Object::ACTOR :
+            lua_rawgeti(L, -1, 2);
+            if (lua_isnumber(L, -1))
+                x += lua_tonumber(L, -1);
+            lua_rawgeti(L, -2, 3);
+            if (lua_isnumber(L, -1))
+                y += lua_tonumber(L, -1);
+            lua_pop(L, 2);               
+            if (world::IsInsideLevel(GridPos(round_down<int>(x), round_down<int>(y)))) 
+                world::AddActor(x, y, dynamic_cast<Actor *>(obj));
+            else
+                throwLuaError(L, "World: actor addition to position outside of world");
+            break;
+        default :
+            throwLuaError(L, "World set of unknown object");
+    }
+    return 0;
+}
+
+static int setObjectByTile(lua_State *L, double x, double y) {
+    // tile at -1
+    
+    // this is a recursive function - ensure enough space on the stack
+    if (lua_gettop(L) >  LUA_MINSTACK - 5)
+        lua_checkstack(L, 10);         // guarantee another 10 free slots
+        
+    lua_getmetatable(L, -1);
+    lua_rawgeti(L, -1, 1);    // first tile part
+    if (is_tile(L, -1))
+        setObjectByTile(L, x, y);
+    else
+        setObjectByTable(L, x, y);
+    lua_pop(L, 1);  // tile or table
+    lua_rawgeti(L, -1, 2);    // second optional tile part
+    if (!lua_isnil(L, -1)) {
+        if (is_tile(L, -1))
+            setObjectByTile(L, x, y);
+        else
+            setObjectByTable(L, x, y);
+    }
+    lua_pop(L, 2);  // tile or table or nil + metatable
+    return 0;
+}
+
+static int initWorld(lua_State *L) {
+    // (ti|function), string, table
+    if (server::WorldInitialized) {
+        throwLuaError(L, "World reinitialization not allowed");
+        return 0;
+    }
+    
+    int width = 0;
+    int height = 0;
+    int keyLength = 1;
+    std::string defaultKey;
+    if (!(is_tiles(L, 2) && lua_isstring(L, 3) && is_table(L, 4))) {
+        throwLuaError(L, "World init with false argument types");
+        return 0;
+    }
+    defaultKey = lua_tostring(L, 3);
+    keyLength = defaultKey.length();
+    height = lua_objlen(L, 4);
+    std::vector<std::string> lines;
+    Log << "initWorld  keyLength " << keyLength <<"\n";
+    for (int i = 1; i <= height; i++) {
+        lua_pushinteger(L, i);
+        lua_gettable(L, -2);
+        if (!lua_isstring(L, -1)) {
+            throwLuaError(L, "World init table has enties that are no strings");
+            return 0;
+        }
+        lines.push_back(lua_tostring(L, -1));
+        lua_pop(L, 1);
+        width = ecl::Max(width, (int)lines.back().length());
+    }
+    if (width % keyLength != 0) {
+        throwLuaError(L, "World init table row with odd length");
+        return 0;
+    }
+    width = width/keyLength;
+    Log << "initWorld  - w " << width << "  - h " << height << "\n";
+
+    world::Resize(width, height);
+    
+    luaL_getmetatable(L, LUA_ID_TILES);
+    lua_rawgeti(L, -1, 1);               // tiles content table
+    for (int i = 0; i < height; i++) {
+        std::string &line = lines[i];
+        int lineLength = line.length();
+        if (lineLength % keyLength != 0) {
+            throwLuaError(L, "World init table row with odd length");
+            return 0;
+        }
+        lineLength = lineLength / keyLength;
+        for (int j = 0; j < width; j++) {
+            std::string key;
+            if (j < lineLength) {
+                key = line.substr(j*keyLength, keyLength);  // tiles key
+            } else {
+                key = defaultKey;
+            }
+            lua_pushstring(L, key.c_str());
+            lua_rawget(L, -2);        // get tile entry in table
+            if (lua_isnil(L, -1)) {
+                throwLuaError(L, ecl::strf("World init undefined tile '%s' at %d, %d", 
+                        key.c_str(), j, i).c_str());
+                return 0;
+            }
+            setObjectByTile(L, j, i);
+            lua_pop(L, 1);  // tile
+        }
+    }
+    lua_pushinteger(L, width);
+    lua_pushinteger(L, height);
+    return 2;
+}
+
+static int dispatchWorldWriteAccess(lua_State *L) {
+    // [object|position|table] = table|tile
+    // [string] = value
+    if (lua_isstring(L, 2)) {
+        std::string name = lua_tostring(L, 2);
+        // TODO check string
+        
+        WorldProxy::instance()->set_attrib(name, to_value(L, 3));
+        return 0;
+    } else if ((is_object(L, 2) || is_position(L, 2) || is_table(L, 2) || is_group(L, 2)) && 
+            ((is_table(L, 3)) || is_tile(L, 3))) {
+        // set object
+        double x = -1;
+        double y = -1;
+        if (is_table(L,2)) {
+            lua_rawgeti(L, 2, 1);
+            lua_rawgeti(L, 2, 2);
+            if ((lua_type(L, -2) != LUA_TNUMBER) || (lua_type(L, -1) != LUA_TNUMBER)) {
+                throwLuaError(L, "Invalid position value type");
+                return 0;
+            }
+            x = lua_tonumber(L, -2);
+            y = lua_tonumber(L, -1);
+            lua_pop(L, 2);
+        } else if (is_position(L, 2)) {  // position
+            lua_getmetatable(L, 2);
+            lua_rawgeti(L, -1, 1);
+            x = lua_tonumber(L, -1);
+            lua_rawgeti(L, -2, 2);
+            y = lua_tonumber(L, -1);
+            lua_remove(L, -3);
+        } else if (is_object(L, 2)) {
+            Object *obj = to_object(L, 2);
+            GridPos  p;
+            if (GridObject *gobj = dynamic_cast<GridObject*>(obj)) {
+                p = gobj->get_pos();
+            } else if (Actor *a = dynamic_cast<Actor*>(obj)) {
+                p = GridPos(a->get_pos());
+            } else {  // NULL object
+                // ignore not existing objects
+                return 0;                
+            }
+            x = p.x;
+            y = p.y;
+        } else if (is_group(L, 2)) {
+            lua_getmetatable(L, 2);
+            int numObjects = lua_objlen(L, -1);
+            for (int i = 1; i <= numObjects; ++i) {
+                lua_rawgeti(L, -1, i);  // the object
+                Object *obj = to_object(L, -1);
+                if (obj) {              // ignore not existing objects
+                    GridPos  p;
+                    if (GridObject *gobj = dynamic_cast<GridObject*>(obj)) {
+                        p = gobj->get_pos();
+                    } else if (Actor *a = dynamic_cast<Actor*>(obj)) {
+                        p = GridPos(a->get_pos());
+                    }
+                    x = p.x;
+                    y = p.y;
+                    lua_pushvalue(L, 3);
+                    if (is_table(L, -1))
+                        setObjectByTable(L, x, y);
+                    else // is tile
+                        setObjectByTile(L, x, y);
+
+                    lua_pop(L, 1);          // the tile/table        
+                }
+                lua_pop(L, 1);          // the object        
+            }
+            return 0;
+        }
+        
+        lua_pushvalue(L, 3);
+        if (is_table(L, -1))
+            setObjectByTable(L, x, y);
+        else // is tile
+            setObjectByTile(L, x, y);
+        return 0;
+    } else {
+        throwLuaError(L, "World write access with bad index");
+        return 0;
+    }
+}
+
+
+static int pushNewWorld(lua_State *L) {
+    int *udata;
+    udata=(int *)lua_newuserdata(L,sizeof(int));   // position user object
+    *udata = 1;
+    
+    luaL_getmetatable(L, LUA_ID_WORLD);
+    lua_setmetatable(L, -2);
+    return 1;
+}
+
+MethodMap tileMethodeMap;
+
+static int dispatchTileWriteAccess(lua_State *L) {
+    throwLuaError(L, "Tile: illegal write access");
+    return 0;
+}
+
+static int dispatchTileReadAccess(lua_State *L) {
+    throwLuaError(L, "Tile: illegal read access");
+    return 0;
+}
+
+static int appendTile(lua_State *L) {
+    // (tile|table) .. (tile|table)
+    if (!((is_tile(L, 1)||is_table(L, 1)) && (is_tile(L, 1)||is_table(L, 1)))) {
+        throwLuaError(L, "Tile concat of unsupported types");
+        return 0;
+    }
+    // TODO check tables for position content
+    
+    // Lua currently does not provide a default metatable for tables - thus we cannot define
+    // a concat of new tables like  "{"fl-hay"} .. {"it-seed"}"
+    // If this feature is added to Lua we would have to add:
+//    if (is_table(L, 1) && is_table(L, 2)) {
+//        pushNewTile(L, 1);  // wrap second table into a tile;
+//        lua_remove(L, 2);   // replace table by tile
+//    }
+    pushNewTile(L, 2);   // wrap both arguments into a new tile
+    return 1;
+}
+
+MethodMap tilesMethodeMap;
+
+static int dispatchTilesReadAccess(lua_State *L) {
+//    Log << "Tiles read key - " << lua_tostring(L, 2) << "\n";
+    if (!lua_isstring(L, 2)) {     // sideeffect: numbers are converted to string
+        throwLuaError(L, "Tiles: key is not a string");
+        return 0;
+    }
+    lua_getmetatable(L, 1);
+    lua_rawgeti(L, -1, 1);   // content table
+    lua_pushvalue(L, 2);      // copy key
+    lua_rawget(L, -2);        // check for existing entry in table
+    return 1;
+}
+
+static int dispatchTilesWriteAccess(lua_State *L) {
+//    Log << "Tiles write key - " << lua_tostring(L, 2) << "\n";
+    if (!lua_isstring(L, 2)) {     // sideeffect: numbers are converted to string
+        throwLuaError(L, "Tiles: key is not a string");
+        return 0;
+    }
+    if (is_table(L, 3)) {
+        // convert table to a tile
+        pushNewTile(L, 1);
+        lua_remove(L, 3);   
+    } else if (!is_tile(L, 3)) {
+        throwLuaError(L, "Tiles: value is not a tile or table");
+        return 0;
+    }
+    lua_getmetatable(L, 1);
+    lua_rawgeti(L, -1, 1);   // content table
+    lua_pushvalue(L, 2);      // copy key
+    lua_rawget(L, -2);        // check for existing entry in table
+    if (!lua_isnil(L, -1)) {
+        throwLuaError(L, ecl::strf("Tiles: redefinition of key '%s'", lua_tostring(L, 2)).c_str());
+        return 0;
+    }
+    lua_pop(L, 1);            // remove nil
+    lua_pushvalue(L, 2);
+    lua_pushvalue(L, 3);
+    lua_rawset(L, -3);        // store tile value for key
+    return 0;
+}
+
+static int pushNewTiles(lua_State *L) {
+    // tiles is a singleton
+    
+    int *udata;
+    udata=(int *)lua_newuserdata(L,sizeof(int));   // position user object
+    *udata = 1;
+    
+    luaL_getmetatable(L, LUA_ID_TILES);
+    lua_rawgeti(L, -1, 1);
+    if (lua_isnil(L, -1)) {
+        lua_newtable(L);            // this is the contents table that stores the data
+        lua_rawseti(L, -3, 1);
+    }
+    lua_pop(L, 1); //nil or content table
+    lua_setmetatable(L, -2);
+    return 1;
+}
+
+static int newTile(lua_State *L) {
+    // ti(table)
+    if (!(is_table(L, 2) && lua_gettop(L) == 2)) {
+        throwLuaError(L, "New tile with wrong arguments");
+        return 0;
+    }
+    
+    pushNewTile(L, 1);
+    return 1;
+}
+
+MethodMap groupMethodeMap;
+
+static int dispatchGroupWriteAccess(lua_State *L) {
+    if (!(lua_isstring(L, 2))) {
+        throwLuaError(L, "Group: illegal attribute write access");
+        return 0;
+    }
+    std::string name = lua_tostring(L, 2);
+    lua_getmetatable(L, 1);
+    int numObjects = lua_objlen(L, -1);
+    for (int i = 1; i <= numObjects; ++i) {
+        lua_rawgeti(L, -1, i);  // the object
+        Object *obj = to_object(L, -1);
+        if (obj)                // ignore not existing objects
+            obj->set_attrib(name, to_value(L, 3));
+        lua_pop(L, 1);          // the object        
+    }
+    return 0;
+}
+
+static int dispatchGroupReadAccess(lua_State *L) {
+    if (!(lua_isnumber(L, 2) || lua_isstring(L, 2))) {
+        throwLuaError(L, "Group: illegal read access");
+        return 0;
+    }
+    
+    if (lua_isnumber(L, 2)) {
+        int i = lua_tointeger(L, 2);
+        lua_getmetatable(L, 1);
+        int size = lua_objlen(L, -1);
+        if (i >= 1 && i <= size)
+            lua_rawgeti(L, -1, i);
+        else
+            pushobject(L, NULL);
+    } else if(lua_isstring(L, 2)) {
+        std::string keyStr = lua_tostring(L, 2); 
+        MethodMap::iterator iter;
+        iter = groupMethodeMap.find(keyStr);
+        if (iter != groupMethodeMap.end()) {
+            // call method
+            lua_pushcfunction(L, iter->second);
+        } else {
+            // try to send message to all objects
+            messageLIFO.push_back(keyStr);
+            lua_pushcfunction(L, groupDirectMessage);
+        }
+    }
+    return 1;
+}
+
+static int lengthGroup(lua_State *L) {
+    lua_getmetatable(L, 1);
+    int size = lua_objlen(L, -1);
+//    Log << "Length Group " << size << "\n";
+    lua_pushinteger(L, size);
+    return 1;
+}
+
 static CFunction globalfuncs[] = {
     {FindDataFile,          "FindDataFile"},
 //    {lua::PlaySoundGlobal,  "PlaySoundGlobal"},
@@ -690,14 +2007,124 @@
     {en_add_scramble,           "AddScramble"},
     {en_set_scramble_intensity, "SetScrambleIntensity"},
 
+    {0,0}
+};
 
+static CFunction levelFuncs[] = {
+    {newGroup,                      "grp"},
+    {newPosition,                   "po"},
+    {getFloor,                      "fl"},
+    {getItem,                       "it"},
+    {getStone,                      "st"},
     {0,0}
 };
 
-
+
+static CFunction objectOperations[] = {
+    {dispatchObjectWriteAccess,     "__newindex"}, //  obj[key]=value
+    {dispatchObjectReadAccess,      "__index"},    //  obj[key]
+    {objectEquality,                "__eq"},       //  ==
+    {addPositions,                  "__add"},      //  obj + obj
+    {subPositions,                  "__sub"},      //  obj - obj
+    {centerPosition,                "__len"},      //  #obj
+    {objectExistance,               "__unm"},      //  -obj
+    {0,0}
+};
+
+static CFunction objectMethods[] = {
+    {objectExistance,               "exists"},
+    {killObject,                    "kill"},
+    {objectMessage,                 "message"},
+    {setAttributes,                 "set"},
+    {xyObject,                      "xy"},
+    {0,0}
+};
+
+static CFunction positionOperations[] = {
+    {dispatchPositionWriteAccess,   "__newindex"}, //  obj[key]=value
+    {dispatchPositionReadAccess,    "__index"},    //  obj[key]
+    {positionEquality,              "__eq"},       //  ==
+    {addPositions,                  "__add"},      //  obj + obj
+    {subPositions,                  "__sub"},      //  obj - obj
+    {multiplyPositions,             "__mul"},      //  obj * obj
+    {dividePositions,               "__div"},      //  obj / obj
+    {centerPosition,                "__len"},      //  #obj
+    {0,0}
+};
+
+static CFunction positionMethods[] = {
+    {xyPosition,                    "xy"},
+    {gridAlignPosition,             "grid"},
+    {0,0}
+};
+
+static CFunction namedObjOperations[] = {
+    {dispatchNamedObjWriteAccess,   "__newindex"}, //  obj[key]=value
+    {dispatchNamedObjReadAccess,    "__index"},    //  obj[key]
+    {0,0}
+};
+
+static CFunction namedObjMethods[] = {
+    {0,0}
+};
+
+static CFunction worldOperations[] = {
+    {dispatchWorldWriteAccess,      "__newindex"}, //  obj[key]=value
+    {dispatchWorldReadAccess,       "__index"},    //  obj[key]
+    {initWorld,                     "__call"},
+    {0,0}
+};
+
+static CFunction worldMethods[] = {
+    {initWorld,                     "init"},
+    {getFloor,                      "fl"},
+    {getItem,                       "it"},
+    {getStone,                      "st"},
+    {0,0}
+};
+
+static CFunction tileOperations[] = {
+    {dispatchTileWriteAccess,       "__newindex"}, //  obj[key]=value
+    {dispatchTileReadAccess,        "__index"},    //  obj[key]
+    {appendTile,                    "__concat"},   //  obj .. obj
+    {0,0}
+};
+
+static CFunction tileMethods[] = {
+    {0,0}
+};
+
+static CFunction tilesOperations[] = {
+    {dispatchTilesWriteAccess,      "__newindex"}, //  obj[key]=value
+    {dispatchTilesReadAccess,       "__index"},    //  obj[key]
+    {newTile,                       "__call"},
+    {0,0}
+};
+
+static CFunction tilesMethods[] = {
+    {0,0}
+};
+
+static CFunction groupOperations[] = {
+    {dispatchGroupWriteAccess,      "__newindex"}, //  obj[key]=value
+    {dispatchGroupReadAccess,       "__index"},    //  obj[key]
+    {lengthGroup,                   "__len"},      //  #obj
+    {joinGroup,                     "__add"},      //  obj + obj
+    {intersectGroup,                "__mul"},      //  obj * obj
+    {differenzGroup,                "__sub"},      //  obj - obj
+    {0,0}
+};
+
+static CFunction groupMethods[] = {
+    {groupMessage,                  "message"},
+    {killObject,                    "kill"},
+    {0,0}
+};
+
+
 /* -------------------- lua:: functions -------------------- */
 
-int lua::FindDataFile (lua_State *L) 
+int FindDataFile (lua_State *L) 
 {
     const char *filename = lua_tostring(L, 1);
     string absfile;
@@ -708,7 +2135,7 @@
     return 1;
 }
 
-void lua::RegisterFuncs(lua_State *L, CFunction *funcs) 
+void RegisterFuncs(lua_State *L, CFunction *funcs) 
 {
     lua_getglobal(L, "enigma");
     for (unsigned i=0; funcs[i].func; ++i) {
@@ -719,38 +2146,83 @@
     lua_pop(L, 1);
 }
 
-Error lua::CallFunc(lua_State *L, const char *funcname, const Value& arg, world::Object *obj) {
+void RegisterFuncs2(lua_State *L, CFunction *funcs) {
+    lua_newtable(L);    // create Namespace "en" 
+    for (unsigned i=0; funcs[i].func; ++i) {
+        // function within namspace
+        lua_pushstring(L, funcs[i].name);
+        lua_pushcfunction(L, funcs[i].func);
+        lua_settable(L, -3);
+        
+        // function in global space 
+        lua_pushcfunction(L, funcs[i].func);
+        lua_setglobal(L, funcs[i].name);
+    }
+    lua_setglobal(L, "en");
+}
+
+void RegisterObject(lua_State *L, std::string name) {
+    lua_pushvalue(L, -1);  // make a copy
+    lua_setglobal(L, name.c_str());
+    
+    lua_getglobal(L, "en");
+    lua_pushstring(L, name.c_str());
+    lua_pushvalue(L, -3);
+    lua_settable(L, -3);
+    lua_pop(L, 2);
+}
+
+void RegisterLuaType(lua_State *L, std::string registryKey, CFunction *ops,
+        CFunction *methods, MethodMap &methodMap) {
+
+    luaL_newmetatable(L, registryKey.c_str());
+    lua_pushstring(L, "_id");
+    lua_pushstring(L, registryKey.c_str());
+    lua_settable(L, -3);
+    for (unsigned i=0; ops[i].func; ++i) {
+        lua_pushstring(L, ops[i].name);
+        lua_pushcfunction(L, ops[i].func);
+        lua_settable(L, -3);
+    }
+    lua_pop(L, 1);  // remove mt pointer
+    
+    for (unsigned i=0; methods[i].func; ++i) {
+        methodMap[methods[i].name] = methods[i].func;
+    }
+}
+
+Error CallFunc(lua_State *L, const char *funcname, const Value& arg, world::Object *obj) {
     int retval;
     lua_getglobal(L, funcname);
     push_value(L, arg);
     pushobject(L, obj);
     retval=lua_pcall(L,2,0,0);
     if (retval!=0) // error
-      {
-	lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
-      }
+    {
+        lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
+    }
     return _lua_err_code(retval);
 }
 
-Error lua::CallFunc(lua_State *L, const char *funcname, const ByteVec& arg) {
+Error CallFunc(lua_State *L, const char *funcname, const ByteVec& arg) {
   int retval;
     lua_getglobal(L, funcname);
     lua_pushlstring (L, &arg[0], arg.size());
     retval=lua_pcall(L,1,0,0);
     if (retval!=0) // error
-      {
-	lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
-      }
+    {
+        lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
+    }
     return _lua_err_code(retval);
 }
 
-Error lua::DoAbsoluteFile(lua_State *L, const string &filename)
+Error DoAbsoluteFile(lua_State *L, const string &filename)
 {
     int oldtop = lua_gettop(L);
     int retval = luaL_loadfile(L, filename.c_str());
     if (retval!=0) // error
     {
-      lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
+        lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
     }
     else 
     {
@@ -764,7 +2236,7 @@
     return _lua_err_code(retval);
 }
     
-Error lua::DoGeneralFile(lua_State *L, GameFS * fs, const string &filename)
+Error DoGeneralFile(lua_State *L, GameFS * fs, const string &filename)
 {
     string completefn;
     if (fs->findFile(filename, completefn)) {
@@ -775,17 +2247,17 @@
     }
 }
 
-Error lua::Dofile(lua_State *L, const string &filename) 
+Error Dofile(lua_State *L, const string &filename) 
 {
     return lua::DoGeneralFile(L, app.resourceFS, filename);
 }
 
-Error lua::DoSysFile(lua_State *L, const string &filename) 
+Error DoSysFile(lua_State *L, const string &filename) 
 {
     return lua::DoGeneralFile(L, app.systemFS, filename);
 }
 
-void lua::CheckedDoFile (lua_State *L, GameFS * fs, std::string const& fname)
+void CheckedDoFile (lua_State *L, GameFS * fs, std::string const& fname)
 {
     string completefn;
     if (!fs->findFile(fname, completefn))
@@ -799,70 +2271,60 @@
     if (status != lua::NO_LUAERROR) {
         fprintf(stderr, _("There was an error loading '%s'.\n"), completefn.c_str());
         fprintf(stderr, _("Your installation may be incomplete or invalid.\n"));
-	fprintf(stderr, _("Error: '%s'\n"), lua::LastError(L).c_str());
+        fprintf(stderr, _("Error: '%s'\n"), lua::LastError(L).c_str());
         exit (1);
     }
 }
 
 
-Error lua::Dobuffer (lua_State *L, const ByteVec &luacode) {
-  int retval;
+Error Dobuffer (lua_State *L, const ByteVec &luacode) {
+    int retval;
     const char *buffer = reinterpret_cast<const char *>(&luacode[0]);
-    
+
     retval=luaL_loadbuffer(L, buffer, luacode.size(), "buffer");
-    if (retval!=0) // error
-      {
-	lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
-      }
-      else 
-	{
-	  retval= lua_pcall(L, 0, 0, 0);
-	  if (retval!=0) // error
-          {
-	    lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
-          }
-	}
+    if (retval!=0) { // error
+        lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
+    } else {
+        retval= lua_pcall(L, 0, 0, 0);
+        if (retval!=0) { // error
+            lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
+        }
+    }
     return _lua_err_code(retval);
 }
 
-string lua::LastError (lua_State *L)
-{
+string LastError (lua_State *L) {
     lua_getglobal (L, "_LASTERROR");
-    if (lua_isstring(L,-1)){
-      return string (lua_tostring (L, -1));
+    if (lua_isstring(L,-1)) {
+        return string (lua_tostring (L, -1));
+    } else {
+        return "Lua Error. No error message available.";
     }
-    else {
-      return "Lua Error. No error message available.";
-    }
 }
 
 
-Error lua::DoSubfolderfile(lua_State *L, const string &basefolder, const string &filename) {
+Error DoSubfolderfile(lua_State *L, const string &basefolder, const string &filename) {
     std::list <string> fnames = app.resourceFS->findSubfolderFiles(basefolder, filename);
     int retval = 0;
     while (fnames.size() > 0) {
         int oldtop = lua_gettop(L);
-	string fname = fnames.front();
+        string fname = fnames.front();
         retval = luaL_loadfile(L, fname.c_str());
-        if (retval!=0) // error
-        {
-	  lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
+        if (retval!=0)  { // error
+            lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
+        } else {
+            retval= lua_pcall(L, 0, 0, 0);
+            if (retval!=0) { // error
+                lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
+            }
         }
-	else 
-	{
-	  retval= lua_pcall(L, 0, 0, 0);
-	  if (retval!=0) // error
-          {
-	    lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
-          }
-	}
-	fnames.pop_front();
+        fnames.pop_front();
         lua_settop(L, oldtop);
     }
     return _lua_err_code(retval);
 }
 
-lua_State *lua::GlobalState() 
+lua_State *GlobalState() 
 {
     if (global_state == 0) {
         lua_State *L = global_state = lua_open();
@@ -878,7 +2340,7 @@
     return global_state;
 }
 
-void lua::ShutdownGlobal() 
+void ShutdownGlobal() 
 {
     assert (global_state);
     lua_close(global_state);
@@ -891,7 +2353,7 @@
 
 
 
-lua_State *lua::InitLevel() 
+lua_State *InitLevel() 
 {
     char buffer[255];
 
@@ -908,22 +2370,41 @@
     tolua_px_open(L);
     tolua_display_open(L);
 
+    
     RegisterFuncs(L, levelfuncs);
+    RegisterFuncs2(L, levelFuncs);
 
     // Create a new metatable for world::Object objects
-    luaL_newmetatable(L,"_ENIGMAOBJECT");
+    RegisterLuaType(L, LUA_ID_OBJECT, objectOperations, objectMethods, objectMethodeMap);
+    RegisterLuaType(L, LUA_ID_POSITION, positionOperations, positionMethods, positionMethodeMap);
+    RegisterLuaType(L, LUA_ID_NAMEOBJ, namedObjOperations, namedObjMethods, namedObjMethodeMap);
+    RegisterLuaType(L, LUA_ID_WORLD, worldOperations, worldMethods, worldMethodeMap);
+    RegisterLuaType(L, LUA_ID_TILE, tileOperations, tileMethods, tileMethodeMap);
+    RegisterLuaType(L, LUA_ID_TILES, tilesOperations, tilesMethods, tilesMethodeMap);
+    RegisterLuaType(L, LUA_ID_GROUP, groupOperations, groupMethods, groupMethodeMap);
+    
+    pushNewNamedObj(L);
+    RegisterObject(L, "no");
+    
+    pushNewWorld(L);
+    RegisterObject(L, "wo");
+    
+    pushNewTiles(L);
+    RegisterObject(L, "ti");
+    
     return L;
 }
 
-lua_State *lua::LevelState ()
+lua_State *LevelState ()
 {
     return level_state;
 }
 
-void lua::ShutdownLevel() {
+void ShutdownLevel() {
     if (level_state) {
         lua_close(level_state);
         level_state = 0;
     }
 }
 
+}} // namespace enigma::lua

Modified: trunk/src/lua.hh
===================================================================
--- trunk/src/lua.hh	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/lua.hh	2007-09-29 21:35:15 UTC (rev 889)
@@ -22,6 +22,7 @@
 #include "enigma.hh"
 #include "ecl_geom.hh"
 #include "objects_decl.hh"
+#include <map>
 
 #ifdef CXXLUA
 struct lua_State;
@@ -30,9 +31,7 @@
 #endif
 
 
-namespace lua
-{
-    using namespace enigma;
+namespace enigma { namespace lua {
 
 /* -------------------- Data structures -------------------- */
 
@@ -40,14 +39,17 @@
         int (*func) (lua_State *); // lua_CFunction func;
         const char *name;
     };
-
+    
+    
+    typedef std::map<std::string, int (*) (lua_State *)> MethodMap;
+    
     enum Error {
         NO_LUAERROR = 0,
         ERRRUN,
-	ERRFILE,
-	ERRSYNTAX,
-	ERRMEM,
-	ERRERR
+        ERRFILE,
+        ERRSYNTAX,
+        ERRMEM,
+        ERRERR
     };
 
 /* -------------------- Lua states for Enigma -------------------- */
@@ -74,6 +76,10 @@
 
 /* -------------------- Helper routines -------------------- */
 
+    void RegisterLuaType(lua_State *L, std::string registryKey, CFunction *ops,
+        CFunction *methods, MethodMap &methodMap);
+
+
     /*! Register the C functions in `funcs'.  The end of the array is
       denoted by an entry with func==0. */
     void RegisterFuncs (lua_State *L, CFunction funcs[]);
@@ -117,6 +123,7 @@
     Error DoSubfolderfile(lua_State *L, 
                         const std::string & basefolder, 
                         const std::string & filename);
-}
+
+}} // namespace enigma::lua
 #endif
 

Modified: trunk/src/objects.cc
===================================================================
--- trunk/src/objects.cc	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/objects.cc	2007-09-29 21:35:15 UTC (rev 889)
@@ -1,5 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004,2005 Daniel Heck
+ * Copyright (C) 2007 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -32,6 +33,7 @@
 #include <iostream>
 #include <iomanip>
 
+
 using namespace std;
 using namespace enigma;
 using namespace world;
@@ -40,52 +42,51 @@
 // note: VERBOSE_MESSAGES is defined in multiple source files!
 // #define VERBOSE_MESSAGES
 
-
-/* -------------------- Helper routines -------------------- */
+/* -------------------- Object implementation -------------------- */
 
-namespace
-{
-    // string_match accepts simple wildcards
-    // '?' means 'any character'
-    // '*' means '0 or more characters'
-    bool string_match(const char *str, const char *templ) {
-        while (true) {
-            char t = *templ++;
-            char s = *str++;
+int Object::next_id = 1;
+std::map<int, Object *> Object::objects;
 
-            if (t == s) {
-                if (!t) return true;
-                continue;
-            }
-            else { // mismatch
-                if (t == '?') continue;
-                if (t != '*') break;
+int Object::getNextId(Object *obj) {
+    objects[next_id] = obj;
+    return next_id++;
+}
 
-                t = *templ++;
-                if (!t) return true; // '*' at EOS
+void Object::freeId(int id) {
+    objects.erase(id);
+}
 
-                while (1) {
-                    if (!s) break;
-                    if (s == t) {
-                        if (string_match(str, templ))
-                            return true;
-                    }
-                    s = *str++;
-                }
-            }
-        }
-        return false;
-    }
+Object * Object::getObject(int id) {
+    std::map<int, Object *>::iterator it = objects.find(id);
+    if (it == objects.end())
+        return NULL;
+    else
+        return it->second;
 }
 
-
-/* -------------------- Object implementation -------------------- */
+Object::Object() {
+    id = getNextId(this);
+}
 
 Object::Object(const char *kind) {
     set_attrib("kind", Value(kind));
+    id = getNextId(this);
 }
 
+Object::Object(const Object &src_obj) {
+    id = getNextId(this);
+    attribs = src_obj.attribs;
+}
 
+Object::~Object() {
+    freeId(id);
+//cerr << "obj del " << id << " - " << this->get_kind() <<"\n";
+}
+
+int Object::getId() const {
+    return id;
+}
+
 Value Object::on_message (const world::Message &m)
 {
     return message (m.message, m.value);
@@ -110,11 +111,11 @@
 // check kind of object
 // kind_templ may contain wildcards ( ? and * )
 bool Object::is_kind(const char *kind_templ) const {
-    return string_match(get_kind(), kind_templ);
+    return ecl::string_match(get_kind(), kind_templ);
 }
 
 bool Object::is_kind(const string& kind_templ) const {
-    return string_match(get_kind(), kind_templ.c_str());
+    return ecl::string_match(get_kind(), kind_templ.c_str());
 }
 
 void Object::set_attrib(const string& key, const Value& val) {
@@ -188,7 +189,9 @@
     va_end(arg_ptr);
 }
 
-
+Object::ObjectType Object::getObjectType() const {
+    return OTHER;
+}
 /* -------------------- GridObject implementation -------------------- */
 
 display::Model *GridObject::set_anim (const std::string &mname) 
@@ -217,4 +220,3 @@
 
     va_end(arg_ptr);
 }
-

Modified: trunk/src/objects_decl.hh
===================================================================
--- trunk/src/objects_decl.hh	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/objects_decl.hh	2007-09-29 21:35:15 UTC (rev 889)
@@ -1,5 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2007 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -21,13 +22,13 @@
 
 #include "display.hh"
 #include "ecl_alist.hh"
+#include <map>
 
 namespace world
 {
     using std::string;
     using namespace enigma;
 
-
 /* -------------------- Objects -------------------- */
 
     /*! Object is the base class for all ``objects'' in the world.
@@ -49,10 +50,22 @@
      */
     class Object {
     public:
-        Object() {}
+        enum ObjectType { 
+            OTHER,
+            STONE,
+            FLOOR,
+            ITEM,
+            ACTOR
+            };
+            
+        Object();
         Object(const char *kind);
-        virtual ~Object() {}
+        Object(const Object &src_obj); 
+        virtual ~Object();
 
+        static Object * getObject(int id);
+        int getId() const;
+        
         /* ---------- Attributes ---------- */
 
         typedef ecl::AssocList<std::string, Value> AttribMap;
@@ -115,15 +128,20 @@
         virtual void on_levelinit();
 
         virtual void warning(const char *format, ...) const;
+        virtual ObjectType getObjectType() const;
 
     protected:
         virtual Value getDefaultValue(const string &key) const;
     private:
+        static int next_id;
+        static std::map<int, Object *> objects;
+        int id;
+        AttribMap attribs;
+        static int getNextId(Object *obj);
+        static void freeId(int id);
         const Value* get_attrib(const string& key) const;
-        AttribMap attribs;
     };
 
-
 /* -------------------- GridObject -------------------- */
 
     /*! GridObject is the base class for everything that can only be
@@ -140,13 +158,13 @@
             on_creation (p);
         }
         void removal(GridPos p) { on_removal(p); }
+        GridPos get_pos() const {return pos;}
 
         // GridObject interface
         virtual void on_laserhit (Direction) {}
         virtual void actor_enter (Actor *) {}
         virtual void actor_leave (Actor *) {}
 
-        GridPos get_pos() const { return pos; }
 
         void warning(const char *format, ...) const;
 

Modified: trunk/src/player.cc
===================================================================
--- trunk/src/player.cc	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/player.cc	2007-09-29 21:35:15 UTC (rev 889)
@@ -71,6 +71,7 @@
         void respawn_dead_actors(double dtime);
         void resurrect_actor (Actor *a);
         bool remove_extralife (Actor *a);
+        void reset();
 
         // Variables
         vector<RespawnInfo> respawn_list;
@@ -133,7 +134,10 @@
     }
 }
 
-
+void LevelLocalData::reset() {
+    respawn_list.clear();
+}
+
 /* -------------------- Local variables -------------------- */
 
 namespace
@@ -144,7 +148,11 @@
     std::vector<Actor *> unassignedActors;
 }
 
-
+
+void player::PlayerShutdown() {
+    players.clear();    // release objects of inventories
+}
+
 /* -------------------- Functions -------------------- */
 
 void player::NewGame (bool isRestart) {
@@ -178,6 +186,7 @@
     }
     
     unassignedActors.clear();
+    leveldat.reset();
 }
 
 void player::AddYinYang ()

Modified: trunk/src/player.hh
===================================================================
--- trunk/src/player.hh	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/player.hh	2007-09-29 21:35:15 UTC (rev 889)
@@ -95,6 +95,7 @@
         world::ItemAction ActivateItem (Item *it);
 
         void Tick (double dtime);
+        void PlayerShutdown();
 
     } // namespace player
 } // namespace enigma

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/server.cc	2007-09-29 21:35:15 UTC (rev 889)
@@ -72,37 +72,37 @@
 
 }
 
-
 /* -------------------- Global variables -------------------- */
 
 
-bool           server::CreatingPreview = false;
 
 bool server::NoCollisions = false;
 
-double   server::LevelTime;
+bool     server::AllowTogglePlayer;
+bool     server::CreatingPreview = false;   // read only for Lua
 bool     server::ConserveLevel;
-bool     server::TwoPlayerGame;
-bool     server::SingleComputerGame;
-bool     server::AllowTogglePlayer;
+double   server::LevelTime;                 // read only for Lua (> 1.10)
 bool     server::ShowMoves;
-GameType server::GameCompatibility;
+bool     server::SingleComputerGame;        // no Lua access
+bool     server::TwoPlayerGame;             // no Lua access
+GameType server::GameCompatibility;         // no Lua access
+bool     server::WorldInitialized;          // no Lua access
 double   server::Brittleness;
-double   server::SlopeForce;
+double   server::BumperForce;
+double   server::ElectricForce;
+double   server::EnigmaCompatibility;       // no Lua access
 double   server::FlatForce;
 double   server::FrictionFactor;
+double   server::HoleForce;
 double   server::IceFriction;
-double   server::ElectricForce;
-double   server::BumperForce;
-double   server::WaterSinkSpeed;
-double   server::SwampSinkSpeed;
 double   server::MagnetForce;
 double   server::MagnetRange;
+double   server::SlopeForce;
+double   server::SwampSinkSpeed;
+double   server::WaterSinkSpeed;
 double   server::WormholeForce;
 double   server::WormholeRange;
-double   server::HoleForce;
 
-
 /* -------------------- Local variables -------------------- */
 
 namespace
@@ -195,7 +195,7 @@
     world::TickFinished ();
 }
 
-
+
 /* -------------------- Functions -------------------- */
 
 void server::Init()
@@ -252,6 +252,8 @@
     move_counter = 0;
 
     world::PrepareLevel ();
+    server::WorldInitialized = false;
+
     player::PrepareLevel();
 
     /* Restart the Lua environment so symbol definitions from

Modified: trunk/src/server.hh
===================================================================
--- trunk/src/server.hh	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/server.hh	2007-09-29 21:35:15 UTC (rev 889)
@@ -68,6 +68,12 @@
     // Behave like Oxyd/Enigma version
     extern GameType GameCompatibility;
 
+    // Detect double initialization (resize) attempts
+    extern bool     WorldInitialized;
+    
+    // level compatibility
+    extern double   EnigmaCompatibility;
+   
     // Default brittleness of the floor: 0 = stable..1=unstable.
     // Really: probability that a floor tile will crack when an actor
     // enters or leaves it.

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/stones.hh	2007-09-29 21:35:15 UTC (rev 889)
@@ -210,6 +210,8 @@
         virtual void   on_impulse(const Impulse& impulse);
 
     protected:
+        virtual Object::ObjectType getObjectType() const {return Object::STONE;}
+        
         bool move_stone(GridPos newPos, const char *soundevent);
         bool move_stone(Direction dir);
         ecl::V2 distortedVelocity (ecl::V2 vel, double defaultfactor);

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/stones_complex.cc	2007-09-29 21:35:15 UTC (rev 889)
@@ -2264,7 +2264,14 @@
 namespace
 {
     class OxydStone : public PhotoStone {
-        INSTANCELISTOBJ(OxydStone);
+        typedef std::vector<OxydStone *> InstanceList;
+        static InstanceList instances;
+        OxydStone * clone();
+        void dispose() {
+            instances.erase(find(instances.begin(), instances.end(), this));
+            delete this;
+        }
+
     public:
         OxydStone();
 
@@ -2309,6 +2316,16 @@
 
 OxydStone::InstanceList OxydStone::instances;
 
+OxydStone * OxydStone::clone() { 
+    OxydStone *o = new OxydStone(*this); 
+    instances.push_back(o);
+    if (server::EnigmaCompatibility >= 1.10) {
+        int color = ((instances.size() -1) / 2) % 8;
+        o->set_attrib("color", ecl::strf("%d", color));
+    }
+    return o;
+}
+
 OxydStone::OxydStone()
 : PhotoStone("st-oxyd"),
   state(CLOSED)

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/world.cc	2007-09-29 21:35:15 UTC (rev 889)
@@ -27,6 +27,7 @@
 #include "client.hh"
 #include "main.hh"
 #include "stones_internal.hh"
+#include "WorldProxy.hh"
 
 #include <iostream>
 #include <algorithm>
@@ -416,19 +417,36 @@
         forces.erase(i);
 }
 
-Object *World::get_named (const string &name)
+Object * World::get_named(const string &name)
 {
     ecl::Dict<Object*>::iterator found = m_objnames.find(name);
     if (found != m_objnames.end()) 
         return found->second;
-    Log << "Did not find named object: " << name << '\n';
-    return 0;
+//    Log << "Did not find named object: " << name << '\n';
+    return NULL;
 }
 
-void World::name_object (Object *obj, const std::string &name)
+std::list<Object *> World::get_group(const std::string &tmpl) {
+    std::list<Object *> result;
+    ecl::Dict<Object *>::iterator it = m_objnames.begin();
+    for (; it != m_objnames.end(); ++it) {
+        if (string_match(it->first, tmpl))
+            result.push_back(it->second);
+    }
+    return result;
+}
+
+void World::name_object(Object *obj, const std::string &name)
 {
-    m_objnames.insert(name, obj); // [name] = obj;
-    obj->set_attrib("name", name);
+    std::string unique_name = name;
+    if (server::EnigmaCompatibility >= 1.10 && name.size() > 0 && name[name.size() - 1] == '#') {
+        // auto name object with a unique name
+        int i;
+        for (i = 1; get_named(name + ecl::strf("%d",i)) != NULL; i++);
+        unique_name = name + ecl::strf("%d",i);
+    }
+    m_objnames.insert(unique_name, obj); // [name] = obj;
+    obj->set_attrib("name", unique_name);
 }
 
 void World::unname (Object *obj)
@@ -1614,6 +1632,7 @@
 {
     level.reset (new World(w,h));
     display::NewWorld(w, h);
+    server::WorldInitialized = true;
 }
 
 void world::PrepareLevel ()
@@ -1707,6 +1726,10 @@
     return level->get_named (name);
 }
 
+std::list<Object *> world::GetNamedGroup(const std::string &name) {
+    return level->get_group(name);
+}
+
 bool world::IsLevelBorder(GridPos p)
 {
     return level->is_border(p);
@@ -2346,10 +2369,11 @@
 void world::Shutdown()
 {
     level.reset();
+    player::PlayerShutdown();
     Repos_Shutdown();
+    WorldProxy::shutdown();
 }
 
-
 /* -------------------- Object repository -------------------- */
 namespace
 {

Modified: trunk/src/world.hh
===================================================================
--- trunk/src/world.hh	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/world.hh	2007-09-29 21:35:15 UTC (rev 889)
@@ -174,6 +174,7 @@
     void    UnnameObject (Object *obj);
     void    TransferObjectName(Object *source, Object *target);
     Object *GetNamedObject (const string &name);
+    std::list<Object *> GetNamedGroup(const std::string &templ);
 
 /* -------------------- Force Fields -------------------- */
 

Modified: trunk/src/world_internal.hh
===================================================================
--- trunk/src/world_internal.hh	2007-09-25 23:20:08 UTC (rev 888)
+++ trunk/src/world_internal.hh	2007-09-29 21:35:15 UTC (rev 889)
@@ -292,6 +292,7 @@
         void    name_object (Object *obj, const string &name);
         void    unname (Object *);
         Object *get_named (const string &);
+        std::list<Object *> get_group(const std::string &tmpl);
 
         void tick (double dtime);
         void remove (ForceField *ff);



