<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r577 - in branches/1.0/data/levels:	enigma_experimental enigma_v lib
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2007-January/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r577%20-%20in%20branches/1.0/data/levels%3A%0A%09enigma_experimental%20enigma_v%20lib&In-Reply-To=%3C200701151637.l0FGb3kj029476%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000016.html">
   <LINK REL="Next"  HREF="000018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r577 - in branches/1.0/data/levels:	enigma_experimental enigma_v lib</H1>
    <B>raoul at BerliOS</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r577%20-%20in%20branches/1.0/data/levels%3A%0A%09enigma_experimental%20enigma_v%20lib&In-Reply-To=%3C200701151637.l0FGb3kj029476%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r577 - in branches/1.0/data/levels:	enigma_experimental enigma_v lib">raoul at mail.berlios.de
       </A><BR>
    <I>Mon Jan 15 17:37:03 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000016.html">[Enigma-game-svn] r576 - in branches/1.0/data/levels:	enigma_experimental enigma_oxyd enigma_peroxyd enigma_v	enigma_vi lib
</A></li>
        <LI>Next message: <A HREF="000018.html">[Enigma-game-svn] r578 - in branches/1.0/data/levels:	enigma_experimental enigma_peroxyd
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17">[ date ]</a>
              <a href="thread.html#17">[ thread ]</a>
              <a href="subject.html#17">[ subject ]</a>
              <a href="author.html#17">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: raoul
Date: 2007-01-15 17:37:02 +0100 (Mon, 15 Jan 2007)
New Revision: 577

Modified:
   branches/1.0/data/levels/enigma_experimental/index.xml
   branches/1.0/data/levels/enigma_experimental/puzzle_demo_2.xml
   branches/1.0/data/levels/enigma_experimental/puzzle_testarea_1.xml
   branches/1.0/data/levels/enigma_v/index.xml
   branches/1.0/data/levels/enigma_v/raoul05_1.xml
   branches/1.0/data/levels/enigma_v/raoul12_1.xml
   branches/1.0/data/levels/lib/libpuzzle_2.xml
Log:
-&gt; raoul05 and raoul12 changes to use libpuzzle v2
-&gt; Added a feature to libpuzzle v2 to make it suitable for andreas34



Modified: branches/1.0/data/levels/enigma_experimental/index.xml
===================================================================
--- branches/1.0/data/levels/enigma_experimental/index.xml	2007-01-14 21:50:47 UTC (rev 576)
+++ branches/1.0/data/levels/enigma_experimental/index.xml	2007-01-15 16:37:02 UTC (rev 577)
@@ -13,7 +13,7 @@
     &lt;level _seq=&quot;5&quot; _title=&quot;Template 3&quot; _xpath=&quot;./template3&quot; author=&quot;AUTHOR&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;template3&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;6&quot; _title=&quot;Impulstest&quot; _xpath=&quot;./testimpulses&quot; author=&quot;Enigma Team&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;testimpulses&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;7&quot; _title=&quot;Wolf Among Sheep&quot; _xpath=&quot;./wolfamongsheep&quot; author=&quot;illmind&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;wolfamongsheep&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
-    &lt;level _seq=&quot;8&quot; _title=&quot;Puzzle Labor&quot; _xpath=&quot;./puzzle_testarea_1&quot; author=&quot;Raoul Bourquin&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;puzzle_testarea&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
+    &lt;level _seq=&quot;8&quot; _title=&quot;Puzzle Labor&quot; _xpath=&quot;./puzzle_testarea_1&quot; author=&quot;Raoul Bourquin&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;puzzle_testarea&quot; rel=&quot;1&quot; rev=&quot;1&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;9&quot; _title=&quot;Puzzle Demo&quot; _xpath=&quot;./puzzle_demo_2&quot; author=&quot;Raoul Bourquin&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;puzzle_demo&quot; rel=&quot;2&quot; rev=&quot;2&quot; score=&quot;2&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;10&quot; _title=&quot;All Items&quot; _xpath=&quot;./items&quot; author=&quot;Raoul Bourquin&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;items&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;11&quot; _title=&quot;Impossible?&quot; _xpath=&quot;./wb2&quot; author=&quot;Jon 'WB' Sneyers&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;wb2_exp&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;

Modified: branches/1.0/data/levels/enigma_experimental/puzzle_demo_2.xml
===================================================================
--- branches/1.0/data/levels/enigma_experimental/puzzle_demo_2.xml	2007-01-14 21:50:47 UTC (rev 576)
+++ branches/1.0/data/levels/enigma_experimental/puzzle_demo_2.xml	2007-01-15 16:37:02 UTC (rev 577)
@@ -86,6 +86,8 @@
 set_item(&quot;it-document&quot;, 11, 7, {text=&quot;Room 1: Some general things you can do with libpuzzle&quot;})
 set_item(&quot;it-document&quot;, 8, 18, {text=&quot;The red puzzles, generated with permutations, are ALL solvable.&quot;})
 set_item(&quot;it-document&quot;, 11, 18, {text=&quot;The blue ones, generated with random, aren't!&quot;})
+set_item(&quot;it-document&quot;, 2, 22, {text=&quot;This figure is solvable with max. 3 hits!&quot;})
+set_item(&quot;it-document&quot;, 17, 14, {text=&quot;This figure is solvable with max. 4 hits!&quot;})
 set_item(&quot;it-document&quot;, 28, 8, {text=&quot;Room 2: Every figure in here, the +/T/L, all are solvable because they are generated  from the solved puzzle with permutations.&quot;})
 set_item(&quot;it-document&quot;, 23, 16, {text=&quot;Room 4: Some things, you can do with pseude pieces: open puzzle clusters ...&quot;})
 set_item(&quot;it-document&quot;, 8, 30, {text=&quot;Room 5: Some things, you can do with Bigbricks ...&quot;})
@@ -144,6 +146,7 @@
 
 -- Third room:
 -- Shows the difference between random and permutation shuffle.
+-- And with specify the num_shuffles parameter
 
   puzzle({&quot;#&quot;,&quot;#&quot;,&quot;#&quot;},{11,20},&quot;bluepuzzle&quot;,&quot;random&quot;)
   puzzle({&quot;#&quot;,&quot;#&quot;,&quot;#&quot;,&quot;#&quot;},{13,19},&quot;bluepuzzle&quot;,&quot;random&quot;)
@@ -155,6 +158,14 @@
   puzzle({&quot;#&quot;,&quot;#&quot;,&quot;#&quot;,&quot;#&quot;,&quot;#&quot;},{4,14},&quot;redpuzzle&quot;,&quot;permutation&quot;)
   puzzle({&quot;#&quot;,&quot;#&quot;,&quot;#&quot;,&quot;#&quot;,&quot;#&quot;,&quot;#&quot;},{2,14},&quot;redpuzzle&quot;,&quot;permutation&quot;)
 
+  puzzle({&quot;## ##&quot;,
+          &quot; ### &quot;,
+          &quot;## ##&quot;},{11,14},&quot;redpuzzle&quot;,&quot;permutation&quot;,4)
+
+  puzzle({&quot;## ##&quot;,
+          &quot; ### &quot;,
+          &quot;## ##&quot;},{4,20},&quot;bluepuzzle&quot;,&quot;permutation&quot;,3)
+
 -- Fourth room:
 -- Shows the wonderfull possibilities of pseudo_pieces.
 

Modified: branches/1.0/data/levels/enigma_experimental/puzzle_testarea_1.xml
===================================================================
--- branches/1.0/data/levels/enigma_experimental/puzzle_testarea_1.xml	2007-01-14 21:50:47 UTC (rev 576)
+++ branches/1.0/data/levels/enigma_experimental/puzzle_testarea_1.xml	2007-01-15 16:37:02 UTC (rev 577)
@@ -3,7 +3,7 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;level&quot;&gt;
       &lt;el:identity el:title=&quot;Puzzle Labor&quot; el:subtitle=&quot;Testlevel to examine new puzzles&quot; el:id=&quot;puzzle_testarea&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;0&quot; el:status=&quot;stable&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;1&quot; el:status=&quot;stable&quot;/&gt;
       &lt;el:author  el:name=&quot;Raoul Bourquin&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2005, 2007 Raoul Bourquin&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
@@ -43,12 +43,15 @@
 set_item(&quot;it-yinyang&quot;,1,1)
 set_item(&quot;it-yinyang&quot;,21,2)
 
+set_item(&quot;it-document&quot;,2,7,{text=&quot;Increment the num_permutation, beginning with 1.&quot;})
+set_item(&quot;it-document&quot;,2,8,{text=&quot;Reset the num_permutation to nil (random default).&quot;})
+
 set_item(&quot;it-document&quot;,17,11,{text=&quot;Clear&quot;})
 
 set_item(&quot;it-document&quot;,21,5,{text=&quot;With the switches at the right, you can determine the layout of the desired puzzle.&quot;})
 set_item(&quot;it-document&quot;,21,6,{text=&quot;Switch up means stone, switch down means no stone at that position.&quot;})
 set_item(&quot;it-document&quot;,21,7,{text=&quot;After you set up the layout, hit the switch at the top and return to the left screen.&quot;})
-set_item(&quot;it-document&quot;,21,1,{text=&quot;Store the figure the draw it.&quot;})
+set_item(&quot;it-document&quot;,21,1,{text=&quot;Store the figure to draw it.&quot;})
 set_item(&quot;it-document&quot;,21,11,{text=&quot;Reset all switches.&quot;})
 
 set_item(&quot;it-document&quot;,1,10,{text=&quot;Which Stonetype? Possible are: \&quot;st-puzzle\&quot;, \&quot;st-puzzle2\&quot;, \&quot;st-bigbrick\&quot; or \&quot;st-bigbluesand\&quot;.&quot;})
@@ -67,6 +70,8 @@
 -- Clear the canvas:
 set_stone(&quot;st-switch&quot;, 18, 11, {action=&quot;callback&quot;,target=&quot;remove_puzzle&quot;,name=&quot;clear&quot;})
 
+set_stone(&quot;st-switch&quot;, 1, 7, {action=&quot;callback&quot;,target=&quot;increment_num_permutations&quot;,name=&quot;num&quot;})
+set_stone(&quot;st-switch&quot;, 1, 8, {action=&quot;callback&quot;,target=&quot;reset_num_permutations&quot;,name=&quot;rnum&quot;})
 set_stone(&quot;st-switch&quot;, 1, 11, {action=&quot;callback&quot;,target=&quot;stone_kind_switch&quot;,name=&quot;kind&quot;})
 
 -- Right room:
@@ -98,17 +103,18 @@
 
 charmap = defaultmap
 
+local num_permutations = nil
 -- Functions to draw the puzzle:
 function draw_none()
     puzzle(charmap,{7,3},stone_kind[kind_pointer],&quot;none&quot;)
 end
 
 function draw_random()
-    puzzle(charmap,{7,3},stone_kind[kind_pointer],&quot;random&quot;)
+    puzzle(charmap,{7,3},stone_kind[kind_pointer],&quot;random&quot;,num_permutations)
 end
 
 function draw_permutation()
-    puzzle(charmap,{7,3},stone_kind[kind_pointer],&quot;permutation&quot;)
+    puzzle(charmap,{7,3},stone_kind[kind_pointer],&quot;permutation&quot;,num_permutations)
 end
 
 -- Clear:
@@ -128,6 +134,20 @@
     end
     set_item(&quot;it-document&quot;,2,11,{text=&quot;Stonekind set to: &quot;..stone_kind[kind_pointer]})
 end
+
+function increment_num_permutations()
+    if num_permutations == nil then
+        num_permutations = 1
+    else
+        num_permutations = num_permutations +1
+    end
+    set_item(&quot;it-document&quot;,2,7,{text=&quot;Num_Permutations set to: &quot;..tostring(num_permutations)})
+end
+
+function reset_num_permutations()
+    num_permutations = nil
+    set_item(&quot;it-document&quot;,2,7,{text=&quot;Num_Permutations set to: &quot;..tostring(num_permutations)})
+end
 --------------------------------------------------------------------------------
 -- Reset the switches
 function clear_values()

Modified: branches/1.0/data/levels/enigma_v/index.xml
===================================================================
--- branches/1.0/data/levels/enigma_v/index.xml	2007-01-14 21:50:47 UTC (rev 576)
+++ branches/1.0/data/levels/enigma_v/index.xml	2007-01-15 16:37:02 UTC (rev 577)
@@ -27,7 +27,7 @@
     &lt;level _seq=&quot;19&quot; _title=&quot;Oxyd-Puzzle&quot; _xpath=&quot;./raoul05_1&quot; author=&quot;Raoul Bourquin&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;raoul05&quot; rel=&quot;1&quot; rev=&quot;1&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;20&quot; _title=&quot;- Meditation -&quot; _xpath=&quot;./ralf12_1&quot; author=&quot;Ralf Westram&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;ralf12&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;21&quot; _title=&quot;Plan Ahead&quot; _xpath=&quot;./duffy114_1&quot; author=&quot;Jacob Scott&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;duffy114&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
-    &lt;level _seq=&quot;22&quot; _title=&quot;Keystone&quot; _xpath=&quot;./raoul12_1&quot; author=&quot;Raoul Bourquin&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;raoul12&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
+    &lt;level _seq=&quot;22&quot; _title=&quot;Keystone&quot; _xpath=&quot;./raoul12_1&quot; author=&quot;Raoul Bourquin&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;raoul12&quot; rel=&quot;1&quot; rev=&quot;1&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;23&quot; _title=&quot;Print 23&quot; _xpath=&quot;./richi07_1&quot; author=&quot;Richi B&#252;tzer&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;richi07&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;24&quot; _title=&quot;Space Pirates&quot; _xpath=&quot;./siegfried19_2&quot; author=&quot;Siegfried Fennig&quot; ctrl=&quot;force&quot; easy=&quot;false&quot; id=&quot;level6a&quot; rel=&quot;2&quot; rev=&quot;0&quot; score=&quot;2&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;
     &lt;level _seq=&quot;25&quot; _title=&quot;Laser Crossing&quot; _xpath=&quot;./luc24_1&quot; author=&quot;Lukas Sch&#252;ller&quot; ctrl=&quot;force&quot; easy=&quot;true&quot; id=&quot;luc24&quot; rel=&quot;1&quot; rev=&quot;0&quot; score=&quot;1&quot; target=&quot;time&quot; unit=&quot;duration&quot;/&gt;

Modified: branches/1.0/data/levels/enigma_v/raoul05_1.xml
===================================================================
--- branches/1.0/data/levels/enigma_v/raoul05_1.xml	2007-01-14 21:50:47 UTC (rev 576)
+++ branches/1.0/data/levels/enigma_v/raoul05_1.xml	2007-01-15 16:37:02 UTC (rev 577)
@@ -7,7 +7,7 @@
       &lt;el:author  el:name=&quot;Raoul Bourquin&quot; el:email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">raoul at users.berlios.de</A>&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2005,2006 Raoul Bourquin&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
-      &lt;el:compatibility el:enigma=&quot;1.00&quot;&gt;
+      &lt;el:compatibility el:enigma=&quot;0.92&quot;&gt;
        &lt;el:dependency el:path=&quot;lib/libpuzzle_2&quot; el:id=&quot;lib/libpuzzle&quot; el:release=&quot;2&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;false&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
@@ -70,114 +70,150 @@
 oxyd_default_flavor = &quot;b&quot;
 
 --RANDOM TILES FOR UPPER ROW:
-tiles={{&quot;## &quot;,&quot; # &quot;,&quot; ##&quot;},{&quot; ##&quot;,&quot; # &quot;,&quot;## &quot;},{&quot; ##&quot;,&quot;## &quot;,&quot;#  &quot;},{&quot;## &quot;,&quot; ##&quot;,&quot;  #&quot;},{&quot; # &quot;,&quot;###&quot;,&quot; # &quot;},{&quot;###&quot;,&quot; # &quot;,&quot; # &quot;},{&quot; # &quot;,&quot; # &quot;,&quot;###&quot;},{&quot;###&quot;,&quot;#  &quot;,&quot;#  &quot;},{&quot;###&quot;,&quot;  #&quot;,&quot;  #&quot;},{&quot; # &quot;,&quot;###&quot;,&quot;#  &quot;},{&quot; # &quot;,&quot;###&quot;,&quot;  #&quot;},{&quot;## &quot;,&quot; ##&quot;,&quot; # &quot;},{&quot; ##&quot;,&quot;## &quot;,&quot; # &quot;}}
-chosen_tiles_up={}    
-leftcorners={{4,1},{9,1},{14,1}}
+tiles={{{1,1,0},{0,1,0},{0,1,1}},{{0,1,1},{0,1,0},{1,1,0}},{{0,1,1},{1,1,0},{1,0,0}},{{1,1,0},{0,1,1},{0,0,1}},{{0,1,0},{1,1,1},{0,1,0}},{{1,1,1},{0,1,0},{0,1,0}},{{0,1,0},{0,1,0},{1,1,1}},{{1,1,1},{1,0,0},{1,0,0}},{{1,1,1},{0,0,1},{0,0,1}},{{0,1,0},{1,1,1},{1,0,0}},{{0,1,0},{1,1,1},{0,0,1}},{{1,1,0},{0,1,1},{0,1,0}},{{0,1,1},{1,1,0},{0,1,0}}}
+chosen_tiles_up = {}    
+leftcorners_up = {{4,1},{9,1},{14,1}}
 
 --chose tiles:
 ct=1
 for t=1,3 do
- local r=random(1,13)
- local f=tiles[r] 
- chosen_tiles_up[ct]=f
- ct=ct+1
+    local r=random(1,13)
+    local f=tiles[r] 
+    chosen_tiles_up[ct]=f
+    ct=ct+1
 end
 
 --Draw black stones:
 for fields=1,3 do
- for i=1,3 do
-  for j=1,3 do
-    set_stone(&quot;st-glass2_hole&quot;,leftcorners[fields][1]+j-1,leftcorners[fields][2]+i-1)
-  end
- end
+    for i=1,3 do
+        for j=1,3 do
+            if chosen_tiles_up[fields][i][j]==0 then
+                set_stone(&quot;st-glass2_hole&quot;,leftcorners_up[fields][1]+j-1,leftcorners_up[fields][2]+i-1)
+            end
+        end
+    end
 end
 
 --RANDOM TILES FOR LOWER ROW:
-tiles={{&quot;## &quot;,&quot; # &quot;,&quot; ##&quot;},{&quot; ##&quot;,&quot; # &quot;,&quot;## &quot;},{&quot;#  &quot;,&quot;## &quot;,&quot; ##&quot;},{&quot;  #&quot;,&quot; ##&quot;,&quot;## &quot;},{&quot; # &quot;,&quot;###&quot;,&quot; # &quot;},{&quot;###&quot;,&quot; # &quot;,&quot; # &quot;},{&quot; # &quot;,&quot; # &quot;,&quot;###&quot;},{&quot;#  &quot;,&quot;#  &quot;,&quot;###&quot;},{&quot;  #&quot;,&quot;  #&quot;,&quot;###&quot;},{&quot;#  &quot;,&quot;###&quot;,&quot; # &quot;},{&quot;  #&quot;,&quot;###&quot;,&quot; # &quot;},{&quot;## &quot;,&quot; ##&quot;,&quot; # &quot;},{&quot; ##&quot;,&quot;## &quot;,&quot; # &quot;}}
-chosen_tiles_lo={}
-leftcorners={{3,9},{8,9},{13,9}}
+tiles={{{1,1,0},{0,1,0},{0,1,1}},{{0,1,1},{0,1,0},{1,1,0}},{{1,0,0},{1,1,0},{0,1,1}},{{0,0,1},{0,1,1},{1,1,0}},{{0,1,0},{1,1,1},{0,1,0}},{{1,1,1},{0,1,0},{0,1,0}},{{0,1,0},{0,1,0},{1,1,1}},{{1,0,0},{1,0,0},{1,1,1}},{{0,0,1},{0,0,1},{1,1,1}},{{1,0,0},{1,1,1},{0,1,0}},{{0,0,1},{1,1,1},{0,1,0}},{{1,1,0},{0,1,1},{0,1,0}},{{0,1,1},{1,1,0},{0,1,0}}}
+chosen_tiles_lo = {}
+leftcorners_lo = {{3,9},{8,9},{13,9}}
 
 --chose tiles:
 ct=1
 for t=1,3 do
- local r=random(1,13)
- local f=tiles[r] 
- chosen_tiles_lo[ct]=f
- ct=ct+1
+    local r=random(1,13)
+    local f=tiles[r] 
+    chosen_tiles_lo[ct]=f
+    ct=ct+1
 end
 
 --Draw black stones:
 for fields=1,3 do
- for i=1,3 do
-  for j=1,3 do
-    set_stone(&quot;st-glass2_hole&quot;,leftcorners[fields][1]+j-1,leftcorners[fields][2]+i-1)
-  end
- end
+    for i=1,3 do
+        for j=1,3 do
+            if chosen_tiles_lo[fields][i][j]==0 then
+                set_stone(&quot;st-glass2_hole&quot;,leftcorners_lo[fields][1]+j-1,leftcorners_lo[fields][2]+i-1)
+            end
+        end
+    end
 end
 
 --set the oxyds
 function set_oxyd()
- if onemal==0 then
- onemal=1
-  for o=0,2 do
-   oxyd(5+o*5,0)
-  end
-  for o=0,2 do
-   oxyd(4+o*5,12)
-  end
-  oxyd_shuffle()
- end
+    if onemal==0 then
+        onemal=1
+        for o=0,2 do
+            oxyd(5+o*5,0)
+        end
+        for o=0,2 do
+            oxyd(4+o*5,12)
+        end
+        oxyd_shuffle()
+    end
 end
 
 --test if all puzzles set, if yes, set the oxyds
-da={0,0,0,0,0,0}
+da = {0,0,0,0,0,0}
 
 function do_test()
- ist=0
- for l=1,6 do
-  ist=ist+da[l]
- end
- if ist==6 then
-  da={0,0,0,0,0,0}
-  set_oxyd()
- end
+    local ist=0
+    for l=1,6 do
+        ist=ist+da[l]
+    end
+    if ist==6 then
+        da={0,0,0,0,0,0}
+        set_oxyd()
+    end
 end
 
 --Wrap-Funktionen
+function generate_charmap(row,puzzle)
+    local charmap = {}
+    local i,j = 0, 0
+    for i=1,3 do
+        charmap[i] = {}
+        local buffer = &quot;&quot;
+        for j=1,3 do
+            if row == 1 then
+                if chosen_tiles_up[puzzle][i][j]==0 then
+                    buffer = buffer..&quot; &quot;
+                else
+                    buffer = buffer..&quot;#&quot;
+                end
+            else
+                if chosen_tiles_lo[puzzle][i][j]==0 then
+                    buffer = buffer..&quot; &quot;
+                else
+                    buffer = buffer..&quot;#&quot;
+                end
+            end
+        end
+        charmap[i] = buffer
+    end
+    return charmap
+end
+
 function wrap1()
- puzzle(chosen_tiles_up[1],{4,1},&quot;redpuzzle&quot;,&quot;permutation&quot;)
- da[1]=1
- do_test()
+    local map = generate_charmap(1,1)
+    puzzle(map,leftcorners_up[1],&quot;redpuzzle&quot;,&quot;permutation&quot;)
+    da[1]=1
+    do_test()
 end
 
 function wrap2()
- puzzle(chosen_tiles_up[2],{9,1},&quot;redpuzzle&quot;,&quot;permutation&quot;)
- da[2]=1
- do_test()
+    local map = generate_charmap(1,2)
+    puzzle(map,leftcorners_up[2],&quot;redpuzzle&quot;,&quot;permutation&quot;)
+    da[2]=1
+    do_test()
 end
 
 function wrap3()
- puzzle(chosen_tiles_up[3],{14,1},&quot;redpuzzle&quot;,&quot;permutation&quot;)
- da[3]=1
- do_test()
+    local map = generate_charmap(1,3)
+    puzzle(map,leftcorners_up[3],&quot;redpuzzle&quot;,&quot;permutation&quot;)
+    da[3]=1
+    do_test()
 end
 
 function wrap4()
- puzzle(chosen_tiles_lo[1],{3,9},&quot;redpuzzle&quot;,&quot;permutation&quot;)
- da[4]=1
- do_test()
+    local map = generate_charmap(2,1)
+    puzzle(map,leftcorners_lo[1],&quot;redpuzzle&quot;,&quot;permutation&quot;)
+    da[4]=1
+    do_test()
 end
 
 function wrap5()
- puzzle(chosen_tiles_lo[2],{8,9},&quot;redpuzzle&quot;,&quot;permutation&quot;)
- da[5]=1
- do_test()
+    local map = generate_charmap(2,2)
+    puzzle(map,leftcorners_lo[2],&quot;redpuzzle&quot;,&quot;permutation&quot;)
+    da[5]=1
+    do_test()
 end
 
 function wrap6()
- puzzle(chosen_tiles_lo[3],{13,9},&quot;redpuzzle&quot;,&quot;permutation&quot;)
- da[6]=1
- do_test()
+    local map = generate_charmap(2,3)
+    puzzle(map,leftcorners_lo[3],&quot;redpuzzle&quot;,&quot;permutation&quot;)
+    da[6]=1
+    do_test()
 end
     ]]&gt;&lt;/el:luamain&gt;
     &lt;el:i18n&gt;

Modified: branches/1.0/data/levels/enigma_v/raoul12_1.xml
===================================================================
--- branches/1.0/data/levels/enigma_v/raoul12_1.xml	2007-01-14 21:50:47 UTC (rev 576)
+++ branches/1.0/data/levels/enigma_v/raoul12_1.xml	2007-01-15 16:37:02 UTC (rev 577)
@@ -3,12 +3,12 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;level&quot;&gt;
       &lt;el:identity el:title=&quot;Keystone&quot; el:subtitle=&quot;&quot; el:id=&quot;raoul12&quot;/&gt;
-      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;0&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;1&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author  el:name=&quot;Raoul Bourquin&quot; el:email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">raoul at users.berlios.de</A>&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2006 Raoul Bourquin&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
       &lt;el:compatibility el:enigma=&quot;0.92&quot;&gt;
-       &lt;el:dependency el:path=&quot;lib/libpuzzle&quot; el:id=&quot;lib/libpuzzle&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
+       &lt;el:dependency el:path=&quot;lib/libpuzzle_2&quot; el:id=&quot;lib/libpuzzle&quot; el:release=&quot;2&quot; el:preload=&quot;true&quot;/&gt;
       &lt;/el:compatibility&gt;
       &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
       &lt;el:comments&gt;
@@ -56,16 +56,6 @@
 set_stone(&quot;st-switch_white&quot;, 12, 31, {action=&quot;callback&quot;,target=&quot;per1&quot;,name=&quot;rot7&quot;})
 end
 
--- PUZZLES --
---blaue:
-puzzle({{1,0,0,1,0},{1,1,1,1,1},{1,0,1,0,0}},4,5,&quot;blue&quot;,&quot;no&quot;)
-
-puzzle({{0,1,0,0,1},{1,1,1,1,1},{0,1,0,0,1}},12,5,&quot;blue&quot;,&quot;no&quot;)
-
-puzzle({{1,1,1},{0,1,0},{1,1,1},{0,1,0},{0,1,0}},9,1,&quot;blue&quot;,&quot;no&quot;)
-
-puzzle({{0,1,0},{0,1,1},{1,1,0},{0,1,0},{1,1,1}},9,7,&quot;blue&quot;,&quot;no&quot;)
-
 -- ACTORS --
 set_actor(&quot;ac-blackball&quot;, 15.5,10.5, {player=0})
 set_actor(&quot;ac-whiteball&quot;, 7.5,28.5, {player=1})
@@ -80,69 +70,53 @@
 oxyd_default_flavor = &quot;d&quot;
 oxyd_shuffle()
 
--- LUA-FUNCTIONS --
---Overwrite the PUZZLE_SHUFFLE() in libpuzzle.lua:
-waswo={&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;}
+-- Oranges Puzzleteil:
+puzzle({&quot;## ##&quot;,
+        &quot; ### &quot;,
+        &quot;## ##&quot;},{8,5},&quot;redpuzzle&quot;,&quot;permutation&quot;)
 
-function puzzle_shuffle(teile)
- 
- shuffled_pieces={}
+-- shift_helper_functions --
+waswo = {&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;}
+nr = 1
 
- local restteile={}
- local anz=anz_stones
- local zyklen=anz
- local i,j,k
- local counter=1
+function translate_type(type)
+    local translate_table = {&quot;&quot;,&quot;w&quot;,&quot;s&quot;,&quot;sw&quot;,&quot;e&quot;,&quot;ew&quot;,&quot;es&quot;,&quot;esw&quot;,&quot;n&quot;,&quot;nw&quot;,&quot;ns&quot;,&quot;nsw&quot;,&quot;ne&quot;,&quot;new&quot;,&quot;nes&quot;,&quot;nesw&quot;}
+    return translate_table[type]
+end
 
- for i=1,zyklen do
+local i, j = 0, 0
+for i=1, 3 do
+    for j=1, 5 do
+        local this_stone = enigma.GetStone(8+j-1,5+i-1)
+        if this_stone ~= nil then
+            local temp = translate_type(enigma.GetAttrib(this_stone,&quot;connections&quot;))
+            waswo[nr] = &quot;st-puzzle2-&quot;..tostring(temp)
+            nr = nr+1
+        end
+    end
+end
 
-  --shuffle pieces:
-  t=random(1,anz)
-  
-  aktteil=teile[t]
-  shuffled_pieces[counter]=aktteil
-  counter=counter+1
-  
- --add this line for this level:
-  waswo[i]=aktteil
+-- Blaue Puzzleteile:
+puzzle({&quot;#  # &quot;,
+        &quot;#####&quot;,
+        &quot;# #  &quot;},{4,5},&quot;bluepuzzle&quot;,&quot;none&quot;)
 
-  --prepare the teile array for next cycle
-  local restteile={}
-  local schogse=0
+puzzle({&quot; #  #&quot;,
+        &quot;#####&quot;,
+        &quot; #  #&quot;},{12,5},&quot;bluepuzzle&quot;,&quot;none&quot;)
 
-  --copy the teile array, mark the piece we just have used with &quot;0&quot;
-  for k=1,anz do
-   if teile[k]==aktteil and schogse==0 then
-    restteile[k]=&quot;0&quot;
-    schogse=1
-   else
-    restteile[k]=teile[k]
-   end
-  end
+puzzle({&quot;###&quot;,
+        &quot; # &quot;,
+        &quot;###&quot;,
+        &quot; # &quot;,
+        &quot; # &quot;},{9,1},&quot;bluepuzzle&quot;,&quot;none&quot;)
 
-  --clear teile array:
-  teile={}
-  local t=1
+puzzle({&quot; # &quot;,
+        &quot; ##&quot;,
+        &quot;## &quot;,
+        &quot; # &quot;,
+        &quot;###&quot;},{9,7},&quot;bluepuzzle&quot;,&quot;none&quot;)
 
-  for j=1,anz do
-   if restteile[j]~=&quot;0&quot; then
-    teile[t]=restteile[j]
-    t=t+1
-   end 
-  end
-  
-  --we have used one piece:
-  anz=anz-1
- end
-
- return shuffled_pieces
-
-end
-
---Oranges Puzzleteil
-shuffle_method=&quot;random&quot;
-puzzle({{1,1,0,1,1},{0,1,1,1,0},{1,1,0,1,1}},8,5,&quot;red&quot;,&quot;yes&quot;)
-
 ---------------
 function per1()
  localram={&quot;&quot;,&quot;&quot;}
@@ -153,8 +127,8 @@
  localram[1]=tmp
  waswo[1]=localram[1]
  waswo[2]=localram[2]
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[1],8,5)
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[2],9,5)
+ set_stone(localram[1],8,5)
+ set_stone(localram[2],9,5)
 end
 ---------------
 function per2()
@@ -166,8 +140,8 @@
  localram[1]=tmp 
  waswo[8]=localram[1]
  waswo[9]=localram[2]
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[1],8,7)
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[2],9,7)
+ set_stone(localram[1],8,7)
+ set_stone(localram[2],9,7)
 end
 ---------------
 function per3()
@@ -182,9 +156,9 @@
  waswo[2]=localram[1]
  waswo[5]=localram[2]
  waswo[9]=localram[3]
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[1],9,5)
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[2],9,6)
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[3],9,7)
+ set_stone(localram[1],9,5)
+ set_stone(localram[2],9,6)
+ set_stone(localram[3],9,7)
 end
 ---------------
 function per4()
@@ -199,9 +173,9 @@
  waswo[5]=localram[1]
  waswo[6]=localram[2]
  waswo[7]=localram[3]
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[1],9,6)
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[2],10,6)
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[3],11,6)
+ set_stone(localram[1],9,6)
+ set_stone(localram[2],10,6)
+ set_stone(localram[3],11,6)
 end
 ---------------
 function per5()
@@ -216,9 +190,9 @@
  waswo[3]=localram[1]
  waswo[7]=localram[2]
  waswo[10]=localram[3]
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[1],11,5)
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[2],11,6)
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[3],11,7)
+ set_stone(localram[1],11,5)
+ set_stone(localram[2],11,6)
+ set_stone(localram[3],11,7)
 end
 ---------------
 function per6()
@@ -230,8 +204,8 @@
  localram[1]=tmp
  waswo[3]=localram[1]
  waswo[4]=localram[2]
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[1],11,5)
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[2],12,5)
+ set_stone(localram[1],11,5)
+ set_stone(localram[2],12,5)
 end
 ---------------
 function per7()
@@ -243,8 +217,8 @@
  localram[1]=tmp
  waswo[10]=localram[1]
  waswo[11]=localram[2]
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[1],11,7)
- set_stone(&quot;st-puzzle&quot;..&quot;2&quot;..&quot;-&quot;..localram[2],12,7)
+ set_stone(localram[1],11,7)
+ set_stone(localram[2],12,7)
 end
     ]]&gt;&lt;/el:luamain&gt;
     &lt;el:i18n&gt;

Modified: branches/1.0/data/levels/lib/libpuzzle_2.xml
===================================================================
--- branches/1.0/data/levels/lib/libpuzzle_2.xml	2007-01-14 21:50:47 UTC (rev 576)
+++ branches/1.0/data/levels/lib/libpuzzle_2.xml	2007-01-15 16:37:02 UTC (rev 577)
@@ -3,7 +3,7 @@
   &lt;el:protected&gt;
     &lt;el:info el:type=&quot;library&quot;&gt;
       &lt;el:identity el:title=&quot;&quot; el:id=&quot;lib/libpuzzle&quot;/&gt;
-      &lt;el:version el:score=&quot;2&quot; el:release=&quot;2&quot; el:revision=&quot;2&quot; el:status=&quot;released&quot;/&gt;
+      &lt;el:version el:score=&quot;2&quot; el:release=&quot;2&quot; el:revision=&quot;3&quot; el:status=&quot;released&quot;/&gt;
       &lt;el:author  el:name=&quot;Raoul Bourquin&quot; el:email=&quot;&quot; el:homepage=&quot;&quot;/&gt;
       &lt;el:copyright&gt;Copyright &#169; 2005, 2006, 2007 Raoul Bourquin&lt;/el:copyright&gt;
       &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
@@ -22,7 +22,10 @@
 -- map: a charmap with the puzzle
 -- corner: top left corner, array {x,y}
 -- type: type of stone to use, one of these: &quot;redpuzzle&quot;,&quot;bluepuzzle&quot;,&quot;bigbrick&quot; or &quot;bigbluesand&quot;
--- shuffle: shuffle method, one of these: &quot;none&quot;,&quot;random&quot; or &quot;permutation&quot;
+-- shuffle_method: shuffle method, one of these: &quot;none&quot;,&quot;random&quot; or &quot;permutation&quot;
+-- num_shuffles: Given number of shuffles to do. If not set, it will be a random number:
+--  -&gt; in the intervall [num_pieces; num_pieces+random(1,num_pieces)] for the random shuffle method
+--  -&gt; in the intervall [num_permutations; num_permutations + math.random(1,num_pieces)] for the permutation shuffle method
 --
 -- Globals:
 -- puzzle_map: the arraymap with the puzzle layout.
@@ -41,10 +44,11 @@
 -- 
 -- shuffle = &quot;none&quot;
 --
+-- num_shuffles = nil (-&gt; random number will be determined!)
 --------------------------------------------------------------------------------
 --------------------------------------------------------------------------------
 -- Wrapper to set a puzzle
-function puzzle(map, corner, type, shuffle)
+function puzzle(map, corner, type, shuffle_method, num_shuffles)
     -- Are all parameters set?
     -- If no, set the default for the missing ones.
     if map == nil then
@@ -59,25 +63,29 @@
     if shuffle == nil then
         shuffle = &quot;none&quot;
     end
+    -- Default (random) values for num_shuffles is set in the shuffle-functions.
 
     -- IS THE map VALID?
     -- Is the map bigger than 0 x 0 ?
     local x, y = get_charmap_size(map)
     if x &lt; 1 or y &lt; 1 then
-        error(&quot;puzzle(map, corner, type, shuffle): Map &quot;..tostring(x)..&quot; x &quot;..tostring(y)..&quot; is too small!\n&quot;)
+        error(&quot;puzzle(map, corner, type, shuffle_method, num_shuffles): Map &quot;..tostring(x)..&quot; x &quot;..tostring(y)..&quot; is too small!\n&quot;)
     end
     -- Is the map rectangular?
     is_rectangular(map)
     -- If there is no error until here, the map is ok
     -- IS THE corner VALID?
     if corner[1] &lt; 0 or corner[2] &lt; 0 then
-        error(&quot;puzzle(map, corner, type, shuffle): Invalid value for top left map corner! &quot;..tostring(corner[1])..&quot;;&quot;..tostring(corner[2])..&quot;. It has to be &gt;= (0;0).\n&quot;)
+        error(&quot;puzzle(map, corner, type, shuffle_method, num_shuffles): Invalid value for top left map corner! &quot;..tostring(corner[1])..&quot;;&quot;..tostring(corner[2])..&quot;. It has to be &gt;= (0;0).\n&quot;)
     end
     -- IS THE type VALID?
     local stone_type = is_valid_type(type)
     -- IS VALID shuffle?
-    local shuffle_method = is_valid_shuffle(shuffle)
-
+    local method = is_valid_shuffle(shuffle_method)
+    -- IS num_shuffle VALID?
+    if num_shuffles ~= nil and num_shuffles &lt; 1 then
+        error(&quot;puzzle(map, corner, type, shuffle_method, num_shuffles): num_shuffles has illegal value &quot;..tostring(num_shuffles)..&quot;! It has to be &gt;= 1 or nil.\n&quot;) 
+    end
     -- If there is no error until here, all parameters are ok
     -- Beginn with the work.
 
@@ -88,12 +96,12 @@
     get_parts(puzzle_map)
 
     -- Determine the shuffle method to use.
-    if shuffle_method == 1 then
+    if method == 1 then
         shuffle_parts_with_noshuffle()
-    elseif shuffle_method == 2 then
-        shuffle_parts_with_random()
-    elseif shuffle_method == 3 then
-        shuffle_parts_with_permutation()
+    elseif method == 2 then
+        shuffle_parts_with_random(num_shuffles)
+    elseif method == 3 then
+        shuffle_parts_with_permutation(num_shuffles)
     end
 
     plot_puzzle(corner,stone_type)
@@ -140,7 +148,7 @@
     for i=1, y_size do
         local temp = string.len(map[i])
         if temp ~= buffer then
-            error(&quot;puzzle(map, corner, type, shuffle): Map in not rectangular!\n&quot;)
+            error(&quot;puzzle(map, corner, type, shuffle_method, num_shuffles): Map in not rectangular!\n&quot;)
         end
     end
     return 0
@@ -157,7 +165,7 @@
     elseif type == &quot;bigbluesand&quot; then
         stone = &quot;st-bigbluesand&quot;
     else
-        error(&quot;puzzle(map, corner, type, shuffle): Invald type \&quot;&quot;..tostring(type)..&quot;\&quot;! It has to be one of these types: \&quot;redpuzzle\&quot;,\&quot;bluepuzzle\&quot;,\&quot;bigbrick\&quot; or \&quot;bigbluesand\&quot;.&quot;)
+        error(&quot;puzzle(map, corner, type, shuffle_method, num_shuffles): Invald type \&quot;&quot;..tostring(type)..&quot;\&quot;! It has to be one of these types: \&quot;redpuzzle\&quot;,\&quot;bluepuzzle\&quot;,\&quot;bigbrick\&quot; or \&quot;bigbluesand\&quot;.&quot;)
     end
     return stone
 end
@@ -171,7 +179,7 @@
     elseif shufflemethod == &quot;permutation&quot; then
         method = 3
     else
-        error(&quot;puzzle(map, corner, type, shuffle): Invald shuffle \&quot;&quot;..tostring(shufflemethod)..&quot;\&quot;! It has to be one of these methodes: \&quot;none\&quot;,\&quot;random\&quot; or \&quot;permutation\&quot;.&quot;)
+        error(&quot;puzzle(map, corner, type, shuffle_method, num_shuffles): Invald shuffle \&quot;&quot;..tostring(shufflemethod)..&quot;\&quot;! It has to be one of these methodes: \&quot;none\&quot;,\&quot;random\&quot; or \&quot;permutation\&quot;.&quot;)
     end
     return method
 end
@@ -397,11 +405,18 @@
     return 0
 end
 
-function shuffle_parts_with_random()
+function shuffle_parts_with_random(num_swaps)
+    -- How many swaps we will do?
+    local number_swaps = 0
 
-    local number_swaps = 0
     local number_parts = get_array_size(parttable)
-    number_swaps = number_parts + math.random(1,number_parts)
+    -- Is there a number of swaps to do given?
+    if num_swaps == nil then
+        -- If not, determine a random number:
+        number_swaps = number_parts + math.random(1,number_parts)
+    else
+        number_swaps = num_swaps
+    end
 
     local i = 0
     for i=1, number_swaps do
@@ -571,7 +586,7 @@
     return 0
 end
 --------------------------------------------------------------------------------
-function shuffle_parts_with_permutation()
+function shuffle_parts_with_permutation(num_permutations)
     -- New map with the parts in their proper location.
     new_partmap()
 
@@ -579,13 +594,22 @@
     scan_puzzle_for_permutations()
 
     -- How many puzzlestones are in the current cluster?
-    local anz_pieces = table.getn(parttable)
+    local num_pieces = table.getn(parttable)
 
-    -- How many permutation we have?
+    -- How many possible permutation we have?
     local anz_permutations = table.getn(permutations)
 
     if anz_permutations &gt; 0 then
-        local num_permutations_to_do = anz_permutations + math.random(1,anz_pieces)
+        -- The number of permutations we will use
+        local num_permutations_to_do
+
+        if num_permutations == nil then
+        -- If there is no number of permutations to do given, determine a random one:
+            num_permutations_to_do = anz_permutations + math.random(1,num_pieces)
+        else
+            num_permutations_to_do = num_permutations
+        end
+
         local i = 0
         for i=1, num_permutations_to_do do
             r = math.random(1,anz_permutations)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000016.html">[Enigma-game-svn] r576 - in branches/1.0/data/levels:	enigma_experimental enigma_oxyd enigma_peroxyd enigma_v	enigma_vi lib
</A></li>
	<LI>Next message: <A HREF="000018.html">[Enigma-game-svn] r578 - in branches/1.0/data/levels:	enigma_experimental enigma_peroxyd
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17">[ date ]</a>
              <a href="thread.html#17">[ thread ]</a>
              <a href="subject.html#17">[ subject ]</a>
              <a href="author.html#17">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
