<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1691 - in trunk: data data/gfx32 data/gfx40	data/gfx48 src src/items src/stones
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2009-May/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1691%20-%20in%20trunk%3A%20data%20data/gfx32%20data/gfx40%0A%09data/gfx48%20src%20src/items%20src/stones&In-Reply-To=%3C200905292025.n4TKPD5P030584%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001119.html">
   <LINK REL="Next"  HREF="001121.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1691 - in trunk: data data/gfx32 data/gfx40	data/gfx48 src src/items src/stones</H1>
    <B>ral at BerliOS</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1691%20-%20in%20trunk%3A%20data%20data/gfx32%20data/gfx40%0A%09data/gfx48%20src%20src/items%20src/stones&In-Reply-To=%3C200905292025.n4TKPD5P030584%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1691 - in trunk: data data/gfx32 data/gfx40	data/gfx48 src src/items src/stones">ral at mail.berlios.de
       </A><BR>
    <I>Fri May 29 22:25:13 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001119.html">[Enigma-game-svn] r1690 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/levels/lib src src/gui src/items src/stones
</A></li>
        <LI>Next message: <A HREF="001121.html">[Enigma-game-svn] r1692 - in trunk/doc/reference: . images
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1120">[ date ]</a>
              <a href="thread.html#1120">[ thread ]</a>
              <a href="subject.html#1120">[ subject ]</a>
              <a href="author.html#1120">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ral
Date: 2009-05-29 22:25:11 +0200 (Fri, 29 May 2009)
New Revision: 1691

Added:
   trunk/data/gfx32/it_explosion.png
   trunk/data/gfx32/sh_brake.png
   trunk/data/gfx32/st_brake.png
   trunk/data/gfx40/it_explosion.png
   trunk/data/gfx40/sh_brake.png
   trunk/data/gfx40/st_brake.png
   trunk/data/gfx48/it_explosion.png
   trunk/data/gfx48/sh_brake.png
   trunk/data/gfx48/st_brake.png
Removed:
   trunk/data/gfx32/expl.png
   trunk/data/gfx32/sh-brake.png
   trunk/data/gfx32/st-brake.png
   trunk/data/gfx40/expl.png
   trunk/data/gfx40/sh-brake.png
   trunk/data/gfx40/st-brake.png
   trunk/data/gfx48/expl.png
   trunk/data/gfx48/sh-brake.png
   trunk/data/gfx48/st-brake.png
Modified:
   trunk/data/models-2d.lua
   trunk/src/d_models.cc
   trunk/src/items.hh
   trunk/src/items/BrakeItem.cc
   trunk/src/items/SeedItem.cc
   trunk/src/items/SeedItem.hh
   trunk/src/stones/BoxStone.cc
   trunk/src/stones/BrakeStone.cc
   trunk/src/stones/GreenBrownStone.cc
   trunk/src/stones/VolcanoStone.cc
Log:
Trunk 1.1:
- fix volcano missing seed image renaming
- fix potential crash on it_seed_hay
- rename images expl, st-brake
- fix crash on DefAlias with two identical names
- separate seed growing models in C++, temp. usage of DefAlias


Deleted: trunk/data/gfx32/expl.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/it_explosion.png (from rev 1689, trunk/data/gfx32/expl.png)

Deleted: trunk/data/gfx32/sh-brake.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/sh_brake.png (from rev 1689, trunk/data/gfx32/sh-brake.png)

Deleted: trunk/data/gfx32/st-brake.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/st_brake.png (from rev 1689, trunk/data/gfx32/st-brake.png)

Deleted: trunk/data/gfx40/expl.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/it_explosion.png (from rev 1689, trunk/data/gfx40/expl.png)

Deleted: trunk/data/gfx40/sh-brake.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/sh_brake.png (from rev 1689, trunk/data/gfx40/sh-brake.png)

Deleted: trunk/data/gfx40/st-brake.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/st_brake.png (from rev 1689, trunk/data/gfx40/st-brake.png)

Deleted: trunk/data/gfx48/expl.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/it_explosion.png (from rev 1689, trunk/data/gfx48/expl.png)

Deleted: trunk/data/gfx48/sh-brake.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/sh_brake.png (from rev 1689, trunk/data/gfx48/sh-brake.png)

Deleted: trunk/data/gfx48/st-brake.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/st_brake.png (from rev 1689, trunk/data/gfx48/st-brake.png)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2009-05-28 22:35:28 UTC (rev 1690)
+++ trunk/data/models-2d.lua	2009-05-29 20:25:11 UTC (rev 1691)
@@ -525,7 +525,7 @@
 
     DefImages(itemlist)
 
-    DefImage(&quot;it_brake&quot;, {filename=&quot;st-brake&quot;})
+    DefImage(&quot;it_brake&quot;, {filename=&quot;st_brake&quot;})
     DefImage(&quot;it_meditation_hollow&quot;, {filename=&quot;it_meditation_hollow&quot;})
     DefImage(&quot;it_meditation_hill&quot;, {filename=&quot;it_meditation_hill&quot;})
     DefImage(&quot;it_meditation_dent&quot;, {filename=&quot;it_meditation_dent&quot;})
@@ -667,8 +667,7 @@
 
 -- Explosion --
 do
-    DefAnimImages(&quot;expl&quot;, {{&quot;expl&quot;, 50}})
-    DefAlias(&quot;it_explosion&quot;, &quot;expl&quot;)
+    DefAnimImages(&quot;it_explosion&quot;, {{&quot;it_explosion&quot;, 50}})
 end
 
 -- it_magnet --
@@ -771,7 +770,7 @@
     DefImage(&quot;sh_passage_slash&quot;)
     DefImage(&quot;sh_passage_cross&quot;)
     DefImage(&quot;sh-puzzle1&quot;)
-    DefImage(&quot;sh-brake&quot;)
+    DefImage(&quot;sh_brake&quot;)
     DefImage(&quot;sh-floating&quot;)
     -- Note: Window shadows are defined where needed.
 end
@@ -788,7 +787,7 @@
     DefStone(&quot;st_jamb_black&quot;)
     DefStone(&quot;st_plop_slate&quot;)
     DefStone(&quot;st_bluegray&quot;, &quot;sh-round&quot;)
-    DefStone(&quot;st-brake&quot;, &quot;sh-brake&quot;)
+    DefStone(&quot;st_brake&quot;, &quot;sh_brake&quot;)
     DefStone(&quot;st_brownie&quot;, &quot;sh-round&quot;)
     DefStone(&quot;st-bug&quot;)
     DefStone(&quot;st_pinkbumps&quot;)
@@ -1312,7 +1311,7 @@
       local n=DefSubimages(&quot;st-wood-growing&quot;, {h=3})
       DefAnim(&quot;wood-growing-fg&quot;, BuildFrames(n, 130))
       DefAnim(&quot;wood-growing-bg&quot;, BuildFrames(sh, 130))
-      DefShModel(&quot;st-wood-growing&quot;, &quot;wood-growing-fg&quot;, &quot;wood-growing-bg&quot;)
+      DefShModel(&quot;st_wood_growing&quot;, &quot;wood-growing-fg&quot;, &quot;wood-growing-bg&quot;)
    end
 
    -- Blocker stone --
@@ -1333,7 +1332,9 @@
 end
 
 do
-    DefAlias(&quot;st-volcano-growing&quot;, &quot;st-blocker-growing&quot;)
+    DefAlias(&quot;st_flhay_growing&quot;, &quot;st_wood_growing&quot;)
+    DefAlias(&quot;st_greenbrown_growing&quot;, &quot;st_wood_growing&quot;)
+    DefAlias(&quot;st_volcano_growing&quot;, &quot;st-blocker-growing&quot;)
 end
 
 -- st-window --

Modified: trunk/src/d_models.cc
===================================================================
--- trunk/src/d_models.cc	2009-05-28 22:35:28 UTC (rev 1690)
+++ trunk/src/d_models.cc	2009-05-29 20:25:11 UTC (rev 1691)
@@ -20,6 +20,7 @@
 #include &quot;display_internal.hh&quot;
 #include &quot;d_models.hh&quot;
 
+//#include &quot;errors.hh&quot;
 #include &quot;lua.hh&quot;
 #include &quot;options.hh&quot;
 #include &quot;d_engine.hh&quot;
@@ -31,6 +32,7 @@
 #include &quot;SDL_image.h&quot;
 
 #include &lt;cstdio&gt;
+#include &lt;cstring&gt;
 #include &lt;iostream&gt;
 
 using namespace enigma;
@@ -368,7 +370,8 @@
 
 void display::DefineAlias (const char *name, const char *othername)
 {
-    DefineModel(name, new AliasModel(othername));
+    if (std::strcmp(name, othername) != 0)
+        DefineModel(name, new AliasModel(othername));
 }
 
 

Modified: trunk/src/items/BrakeItem.cc
===================================================================
--- trunk/src/items/BrakeItem.cc	2009-05-28 22:35:28 UTC (rev 1690)
+++ trunk/src/items/BrakeItem.cc	2009-05-29 20:25:11 UTC (rev 1691)
@@ -33,7 +33,7 @@
     }
     
     std::string BrakeItem::get_inventory_model() {
-        return &quot;st-brake&quot;;
+        return &quot;st_brake&quot;;
     }
     
     ItemAction BrakeItem::activate(Actor* a, GridPos p) {

Modified: trunk/src/items/SeedItem.cc
===================================================================
--- trunk/src/items/SeedItem.cc	2009-05-28 22:35:28 UTC (rev 1690)
+++ trunk/src/items/SeedItem.cc	2009-05-29 20:25:11 UTC (rev 1691)
@@ -151,10 +151,11 @@
     }
     
 
-    ItemTraits SeedItem::traits[3] = {
+    ItemTraits SeedItem::traits[4] = {
         {&quot;it_seed_wood&quot;, it_seed_wood, itf_static, 0.2},
         {&quot;it_seed_greenbrown&quot;, it_seed_fake, itf_static, 0.2},
-        {&quot;it_seed_volcano&quot;, it_seed_volcano, itf_static, 0.2}
+        {&quot;it_seed_volcano&quot;, it_seed_volcano, itf_static, 0.2},
+        {&quot;it_seed_hay&quot;, it_seed_hay, itf_static, 0.2}
     };
 
     BOOT_REGISTER_START

Modified: trunk/src/items/SeedItem.hh
===================================================================
--- trunk/src/items/SeedItem.hh	2009-05-28 22:35:28 UTC (rev 1690)
+++ trunk/src/items/SeedItem.hh	2009-05-29 20:25:11 UTC (rev 1691)
@@ -28,7 +28,7 @@
      */
     class SeedItem : public Item {
         CLONEOBJ(SeedItem);
-        DECL_ITEMTRAITS_ARRAY(3, traitsIdx());
+        DECL_ITEMTRAITS_ARRAY(4, traitsIdx());
 
     private:
         enum iState {

Modified: trunk/src/items.hh
===================================================================
--- trunk/src/items.hh	2009-05-28 22:35:28 UTC (rev 1690)
+++ trunk/src/items.hh	2009-05-29 20:25:11 UTC (rev 1691)
@@ -111,6 +111,7 @@
         it_seed_wood,
         it_seed_fake,
         it_seed_volcano,
+        it_seed_hay,
         it_sensor,
         it_shogun_s,
         it_shogun_m,

Modified: trunk/src/stones/BoxStone.cc
===================================================================
--- trunk/src/stones/BoxStone.cc	2009-05-28 22:35:28 UTC (rev 1690)
+++ trunk/src/stones/BoxStone.cc	2009-05-29 20:25:11 UTC (rev 1691)
@@ -107,19 +107,19 @@
                 ASSERT(false, XLevelRuntime, &quot;Wood stone init model state error&quot;);
             case WOOD1:
                 if (state == GROWING)
-                    set_anim(&quot;st-wood-growing&quot;);
+                    set_anim(&quot;st_wood_growing&quot;);
                 else
                     set_model(&quot;st-wood1&quot;);
                 break;
             case WOOD2:
                 if (state == GROWING)
-                    set_anim(&quot;st-wood-growing&quot;);
+                    set_anim(&quot;st_wood_growing&quot;);
                 else
                     set_model(&quot;st-wood2&quot;);
                 break;
             case HAY:
                 if (state == GROWING)
-                    set_anim(&quot;st-wood-growing&quot;);
+                    set_anim(&quot;st_flhay_growing&quot;);
                 else
                     set_model(&quot;st-flhay&quot;); break;
                 break;

Modified: trunk/src/stones/BrakeStone.cc
===================================================================
--- trunk/src/stones/BrakeStone.cc	2009-05-28 22:35:28 UTC (rev 1690)
+++ trunk/src/stones/BrakeStone.cc	2009-05-29 20:25:11 UTC (rev 1691)
@@ -40,7 +40,7 @@
     }
 
     void BrakeStone::init_model() {
-        set_model(&quot;st-brake&quot;);
+        set_model(&quot;st_brake&quot;);
     }
     
     void BrakeStone::on_creation (GridPos p) {

Modified: trunk/src/stones/GreenBrownStone.cc
===================================================================
--- trunk/src/stones/GreenBrownStone.cc	2009-05-28 22:35:28 UTC (rev 1690)
+++ trunk/src/stones/GreenBrownStone.cc	2009-05-29 20:25:11 UTC (rev 1691)
@@ -67,7 +67,7 @@
         if (objFlags &amp; OBJBIT_GLASSES)
             set_model(&quot;invisible&quot;);
         else if (state == GROWING)
-            set_anim(&quot;st-wood-growing&quot;);   // missing model
+            set_anim(&quot;st_greenbrown_growing&quot;);
         else
             set_model(getClass());
     }

Modified: trunk/src/stones/VolcanoStone.cc
===================================================================
--- trunk/src/stones/VolcanoStone.cc	2009-05-28 22:35:28 UTC (rev 1690)
+++ trunk/src/stones/VolcanoStone.cc	2009-05-29 20:25:11 UTC (rev 1691)
@@ -79,8 +79,8 @@
             case INACTIVE: set_model(&quot;st_flat&quot;); break;
             case ACTIVE:   set_anim(&quot;st_quaking&quot;); break;
             case BREAKING: set_anim(&quot;st_quakebreak_anim&quot;); break;
-            case NEW:      set_anim(&quot;it-seed-growing&quot;); break;
-            case GROWING:  set_anim(&quot;st-volcano-growing&quot;); break;
+            case NEW:      set_anim(&quot;it_seed_growing&quot;); break;
+            case GROWING:  set_anim(&quot;st_volcano_growing&quot;); break;
         }
     }
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001119.html">[Enigma-game-svn] r1690 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/levels/lib src src/gui src/items src/stones
</A></li>
	<LI>Next message: <A HREF="001121.html">[Enigma-game-svn] r1692 - in trunk/doc/reference: . images
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1120">[ date ]</a>
              <a href="thread.html#1120">[ thread ]</a>
              <a href="subject.html#1120">[ subject ]</a>
              <a href="author.html#1120">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
