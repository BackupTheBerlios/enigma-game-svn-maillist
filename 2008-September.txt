From ral at mail.berlios.de  Tue Sep  2 22:40:21 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Tue, 2 Sep 2008 22:40:21 +0200
Subject: [Enigma-game-svn] r1299 - team_levelpacks/team_test_new_api
Message-ID: <200809022040.m82KeLUk010778@sheep.berlios.de>

Author: ral
Date: 2008-09-02 22:40:09 +0200 (Tue, 02 Sep 2008)
New Revision: 1299

Added:
   team_levelpacks/team_test_new_api/ralT065_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT014_1.xml
   team_levelpacks/team_test_new_api/ralT057_1.xml
Log:
Test Level new API:
- meditation test level added, other levels updated



Modified: team_levelpacks/team_test_new_api/ralT014_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT014_1.xml	2008-08-31 21:18:10 UTC (rev 1298)
+++ team_levelpacks/team_test_new_api/ralT014_1.xml	2008-09-02 20:40:09 UTC (rev 1299)
@@ -117,7 +117,7 @@
         crazy_group = no.buggy["opendoors"]
         --crazy_group:kill()
         crazy_group:close()
-        wo[no.buggy["mypos"]] = {"it-hollow"}
+        wo[no.buggy["mypos"]] = {"it_meditation"}
         chess_grp2 = grp({no.money, no["chess#1"], no.money})
         chess_special = chess_grp * chess_grp2
         chess_special:kill()

Modified: team_levelpacks/team_test_new_api/ralT057_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT057_1.xml	2008-08-31 21:18:10 UTC (rev 1298)
+++ team_levelpacks/team_test_new_api/ralT057_1.xml	2008-09-02 20:40:09 UTC (rev 1299)
@@ -59,8 +59,8 @@
 ti["F"] = {"st_fourswitch", "orientationFourswitch"}
 ti["f"] = {"st_switch", target="doSync"}
 
-ti["h"] = {"it-tinyhollow"}
-ti["H"] = {"it-hollow"}
+ti["h"] = {"it_meditation_dent"}
+ti["H"] = {"it_meditation"}
 
 
 ti["1"] = ti["y"] .. {"#ac-blackball"}

Added: team_levelpacks/team_test_new_api/ralT065_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT065_1.xml	2008-08-31 21:18:10 UTC (rev 1298)
+++ team_levelpacks/team_test_new_api/ralT065_1.xml	2008-09-02 20:40:09 UTC (rev 1299)
@@ -0,0 +1,62 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Meditation new API" el:subtitle="" el:id="20080829ral370"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 1278 $" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+wo["MeditationForce"] = 2.0
+
+ti[" "] = {"fl-sahara"}
+
+ti["."] = {"it_meditation", essential=INDISPENSIBLE}
+ti[";"] = {"it_meditation", essential=DISPENSIBLE}
+
+ti["-"] = {"it_meditation_hill", "hilli#", essential=INDISPENSIBLE}
+ti["="] = {"it_meditation_bump", "bumpd#", essential=DISPENSIBLE}
+
+ti["w"] = {"st-wood"}
+ti["d"] = {"it-dynamite"}
+ti["?"] = {"it-spade"}
+ti["S"] = {"st_switch", target="hilli#*", action="flip"}
+ti["s"] = {"st_switch", target="bumpd#*", action="signal"}
+
+ti["@"] = {"#ac-whiteball-small", player=0} 
+ti["1"] = {"#ac-blackball"} 
+
+w, h = wo(ti, " ", {
+"                    ",
+"                    ",
+"                    ",
+"     .    ;    ;    ",
+"                    ",
+"                    ",
+"       @  ?  @      ",
+"                -   ",
+"    @     @       S ",
+"    .w    d     -   ",
+"                    ",
+"         s  =  =  s ",
+"                    "
+})
+
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: team_levelpacks/team_test_new_api/ralT065_1.xml
___________________________________________________________________
Name: Revision
   + 
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Thu Sep  4 00:28:07 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Thu, 4 Sep 2008 00:28:07 +0200
Subject: [Enigma-game-svn] r1300 - homepage/input
Message-ID: <200809032228.m83MS7nF005545@sheep.berlios.de>

Author: ral
Date: 2008-09-04 00:27:59 +0200 (Thu, 04 Sep 2008)
New Revision: 1300

Modified:
   homepage/input/stat-other.html
   homepage/input/table-hcp.html
   homepage/input/table-rat.html
   homepage/input/table-solved.html
   homepage/input/table-wr.html
   homepage/input/userlist.html
Log:
Homepage:
- statistics August 2008


Modified: homepage/input/stat-other.html
===================================================================
--- homepage/input/stat-other.html	2008-09-02 20:40:09 UTC (rev 1299)
+++ homepage/input/stat-other.html	2008-09-03 22:27:59 UTC (rev 1300)
@@ -1,22 +1,22 @@
   <div class="stat-help">
     <h3>$$Other_Statistics$$</h3>
     <h4>$$Scores$$</h4>
-      81371 $$single_level_scores$$.
+      82658 $$single_level_scores$$.
     <h4>$$Ratings$$</h4>
-      14852 $$single_level_ratings$$ 4.92 $$and_distribution$$: 
+      16041 $$single_level_ratings$$ 4.92 $$and_distribution$$: 
       <table>
         <colgroup><col width="80"><col width="80"></colgroup>
         <tr><th>$$rating$$</th><th>$$count$$</th></tr>
-        <tr><td class="num">0</td><td class="num">99</td></tr>
-        <tr><td class="num">1</td><td class="num">286</td></tr>
-        <tr><td class="num">2</td><td class="num">799</td></tr>
-        <tr><td class="num">3</td><td class="num">2077</td></tr>
-        <tr><td class="num">4</td><td class="num">2786</td></tr>
-        <tr><td class="num">5</td><td class="num">3513</td></tr>
-        <tr><td class="num">6</td><td class="num">2468</td></tr>
-        <tr><td class="num">7</td><td class="num">1714</td></tr>
-        <tr><td class="num">8</td><td class="num">687</td></tr>
-        <tr><td class="num">9</td><td class="num">278</td></tr>
-        <tr><td class="num">10</td><td class="num">145</td></tr>
+        <tr><td class="num">0</td><td class="num">100</td></tr>
+        <tr><td class="num">1</td><td class="num">289</td></tr>
+        <tr><td class="num">2</td><td class="num">841</td></tr>
+        <tr><td class="num">3</td><td class="num">2239</td></tr>
+        <tr><td class="num">4</td><td class="num">3056</td></tr>
+        <tr><td class="num">5</td><td class="num">3839</td></tr>
+        <tr><td class="num">6</td><td class="num">2712</td></tr>
+        <tr><td class="num">7</td><td class="num">1814</td></tr>
+        <tr><td class="num">8</td><td class="num">715</td></tr>
+        <tr><td class="num">9</td><td class="num">290</td></tr>
+        <tr><td class="num">10</td><td class="num">146</td></tr>
       </table>
   </div>

Modified: homepage/input/table-hcp.html
===================================================================
--- homepage/input/table-hcp.html	2008-09-02 20:40:09 UTC (rev 1299)
+++ homepage/input/table-hcp.html	2008-09-03 22:27:59 UTC (rev 1300)
@@ -1,138 +1,140 @@
   <table>
-    <caption>$$Handicap_Statistics$$ $$July$$ 2008</caption>
+    <caption>$$Handicap_Statistics$$ $$August$$ 2008</caption>
     <colgroup><col width="130"><col width="220"></colgroup>
     <tr><th>$$solved_hcp$$</th><th class="left">$$user$$</th></tr>
-     <tr><td class="num">-144.9</td><td class="left">'Moneymaker'</td></tr>
-     <tr><td class="num"> -81.1</td><td class="left">'Johannes'</td></tr>
-     <tr><td class="num"> -81.0</td><td class="left">'Stupid'</td></tr>
-     <tr><td class="num"> -77.5</td><td class="left">'daydreamer'</td></tr>
-     <tr><td class="num"> -69.8</td><td class="left">'Great Scott'</td></tr>
-     <tr><td class="num"> -59.6</td><td class="left">'Duffy'</td></tr>
-     <tr><td class="num"> -58.2</td><td class="left">'Malla'</td></tr>
-     <tr><td class="num"> -56.1</td><td class="left">'dev0'</td></tr>
-     <tr><td class="num"> -55.1</td><td class="left">'ryujun'</td></tr>
-     <tr><td class="num"> -50.5</td><td class="left">'Alexandros'</td></tr>
-     <tr><td class="num"> -47.7</td><td class="left">'Django'</td></tr>
-     <tr><td class="num"> -42.2</td><td class="left">'Gloop'</td></tr>
-     <tr><td class="num"> -38.9</td><td class="left">'Taztunes'</td></tr>
-     <tr><td class="num"> -35.8</td><td class="left">'Safalra'</td></tr>
-     <tr><td class="num"> -35.7</td><td class="left">'Emmanuel'</td></tr>
-     <tr><td class="num"> -31.8</td><td class="left">'Ludmian'</td></tr>
-     <tr><td class="num"> -30.5</td><td class="left">'B-Huff'</td></tr>
-     <tr><td class="num"> -27.8</td><td class="left">'Zekobah'</td></tr>
-     <tr><td class="num"> -26.0</td><td class="left">'bojster'</td></tr>
-     <tr><td class="num"> -23.7</td><td class="left">'ged'</td></tr>
-     <tr><td class="num"> -21.9</td><td class="left">'hendrik'</td></tr>
-     <tr><td class="num"> -20.5</td><td class="left">'dpl'</td></tr>
-     <tr><td class="num"> -20.5</td><td class="left">'ABS'</td></tr>
-     <tr><td class="num"> -18.4</td><td class="left">'Raoul'</td></tr>
-     <tr><td class="num"> -16.3</td><td class="left">'Daisy'</td></tr>
-     <tr><td class="num"> -15.0</td><td class="left">'Ronald'</td></tr>
-     <tr><td class="num"> -14.8</td><td class="left">'Ghatotkacha'</td></tr>
-     <tr><td class="num"> -11.4</td><td class="left">'Lukas'</td></tr>
-     <tr><td class="num"> -10.5</td><td class="left">'HuB34'</td></tr>
-     <tr><td class="num">  -7.7</td><td class="left">'joseba'</td></tr>
-     <tr><td class="num">  -7.3</td><td class="left">'Iceshark7'</td></tr>
-     <tr><td class="num">  -3.4</td><td class="left">'Daniel'</td></tr>
-     <tr><td class="num">  -2.1</td><td class="left">'fabian'</td></tr>
+     <tr><td class="num">-144.6</td><td class="left">'Moneymaker'</td></tr>
+     <tr><td class="num"> -80.8</td><td class="left">'Stupid'</td></tr>
+     <tr><td class="num"> -80.8</td><td class="left">'Johannes'</td></tr>
+     <tr><td class="num"> -80.4</td><td class="left">'daydreamer'</td></tr>
+     <tr><td class="num"> -69.5</td><td class="left">'Great Scott'</td></tr>
+     <tr><td class="num"> -59.4</td><td class="left">'Duffy'</td></tr>
+     <tr><td class="num"> -58.0</td><td class="left">'Malla'</td></tr>
+     <tr><td class="num"> -57.7</td><td class="left">'dev0'</td></tr>
+     <tr><td class="num"> -54.9</td><td class="left">'ryujun'</td></tr>
+     <tr><td class="num"> -50.3</td><td class="left">'Alexandros'</td></tr>
+     <tr><td class="num"> -47.5</td><td class="left">'Django'</td></tr>
+     <tr><td class="num"> -42.1</td><td class="left">'Gloop'</td></tr>
+     <tr><td class="num"> -38.7</td><td class="left">'Taztunes'</td></tr>
+     <tr><td class="num"> -35.7</td><td class="left">'Safalra'</td></tr>
+     <tr><td class="num"> -35.6</td><td class="left">'Emmanuel'</td></tr>
+     <tr><td class="num"> -32.6</td><td class="left">'Ludmian'</td></tr>
+     <tr><td class="num"> -30.3</td><td class="left">'B-Huff'</td></tr>
+     <tr><td class="num"> -27.6</td><td class="left">'Zekobah'</td></tr>
+     <tr><td class="num"> -25.9</td><td class="left">'bojster'</td></tr>
+     <tr><td class="num"> -23.6</td><td class="left">'ged'</td></tr>
+     <tr><td class="num"> -23.0</td><td class="left">'dpl'</td></tr>
+     <tr><td class="num"> -21.7</td><td class="left">'hendrik'</td></tr>
+     <tr><td class="num"> -20.3</td><td class="left">'ABS'</td></tr>
+     <tr><td class="num"> -19.1</td><td class="left">'Raoul'</td></tr>
+     <tr><td class="num"> -17.4</td><td class="left">'Daisy'</td></tr>
+     <tr><td class="num"> -14.9</td><td class="left">'Ronald'</td></tr>
+     <tr><td class="num"> -14.6</td><td class="left">'Ghatotkacha'</td></tr>
+     <tr><td class="num"> -11.2</td><td class="left">'Lukas'</td></tr>
+     <tr><td class="num"> -10.4</td><td class="left">'HuB34'</td></tr>
+     <tr><td class="num">  -7.8</td><td class="left">'Crystalicum'</td></tr>
+     <tr><td class="num">  -7.4</td><td class="left">'joseba'</td></tr>
+     <tr><td class="num">  -7.2</td><td class="left">'Iceshark7'</td></tr>
+     <tr><td class="num">  -3.2</td><td class="left">'Daniel'</td></tr>
+     <tr><td class="num">  -1.9</td><td class="left">'fabian'</td></tr>
      <tr><td class="num">  -1.7</td><td class="left">'Hairball'</td></tr>
-     <tr><td class="num">  -0.6</td><td class="left">'Craven'</td></tr>
-     <tr><td class="num">  -0.4</td><td class="left">'Wuzzy'</td></tr>
-     <tr><td class="num">  -0.4</td><td class="left">'JuSt'</td></tr>
-     <tr><td class="num">   0.0</td><td class="left">'U-Punkt'</td></tr>
+     <tr><td class="num">  -0.5</td><td class="left">'Craven'</td></tr>
+     <tr><td class="num">  -0.3</td><td class="left">'Wuzzy'</td></tr>
+     <tr><td class="num">  -0.3</td><td class="left">'JuSt'</td></tr>
+     <tr><td class="num">   0.1</td><td class="left">'U-Punkt'</td></tr>
      <tr><td class="num">   0.3</td><td class="left">'Freshman'</td></tr>
-     <tr><td class="num">   1.0</td><td class="left">'mrduke'</td></tr>
-     <tr><td class="num">   2.1</td><td class="left">'para_doks'</td></tr>
-     <tr><td class="num">   2.4</td><td class="left">'Tobias'</td></tr>
-     <tr><td class="num">   3.5</td><td class="left">'Guglielmo'</td></tr>
+     <tr><td class="num">   1.1</td><td class="left">'mrduke'</td></tr>
+     <tr><td class="num">   2.2</td><td class="left">'para_doks'</td></tr>
+     <tr><td class="num">   2.5</td><td class="left">'Tobias'</td></tr>
+     <tr><td class="num">   3.6</td><td class="left">'Guglielmo'</td></tr>
      <tr><td class="num">   3.7</td><td class="left">'Kevin'</td></tr>
-     <tr><td class="num">   4.7</td><td class="left">'serpent'</td></tr>
-     <tr><td class="num">   4.8</td><td class="left">'Andy'</td></tr>
+     <tr><td class="num">   4.9</td><td class="left">'Andy'</td></tr>
+     <tr><td class="num">   5.0</td><td class="left">'serpent'</td></tr>
      <tr><td class="num">   7.3</td><td class="left">'Austin'</td></tr>
-     <tr><td class="num">   8.7</td><td class="left">'shoki'</td></tr>
-     <tr><td class="num">  10.2</td><td class="left">'Tiza'</td></tr>
-     <tr><td class="num">  11.4</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+     <tr><td class="num">   8.8</td><td class="left">'shoki'</td></tr>
+     <tr><td class="num">  10.3</td><td class="left">'Tiza'</td></tr>
+     <tr><td class="num">  11.5</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+     <tr><td class="num">  13.0</td><td class="left">'mecke'</td></tr>
      <tr><td class="num">  13.1</td><td class="left">'Andreas'</td></tr>
-     <tr><td class="num">  13.6</td><td class="left">'alfred69'</td></tr>
-     <tr><td class="num">  14.0</td><td class="left">'Chocolate Zero'</td></tr>
-     <tr><td class="num">  14.4</td><td class="left">'Mark P.'</td></tr>
-     <tr><td class="num">  14.7</td><td class="left">'AlephD'</td></tr>
-     <tr><td class="num">  14.9</td><td class="left">'Sim_Ed'</td></tr>
-     <tr><td class="num">  15.2</td><td class="left">'Agnieszka'</td></tr>
-     <tr><td class="num">  15.6</td><td class="left">'Angolino'</td></tr>
-     <tr><td class="num">  19.7</td><td class="left">'Alex'</td></tr>
-     <tr><td class="num">  21.6</td><td class="left">'Antonio EE'</td></tr>
-     <tr><td class="num">  22.4</td><td class="left">'Klaus'</td></tr>
-     <tr><td class="num">  22.7</td><td class="left">'Marc-Hendrik'</td></tr>
+     <tr><td class="num">  13.8</td><td class="left">'alfred69'</td></tr>
+     <tr><td class="num">  13.9</td><td class="left">'Mark P.'</td></tr>
+     <tr><td class="num">  14.2</td><td class="left">'Chocolate Zero'</td></tr>
+     <tr><td class="num">  14.8</td><td class="left">'AlephD'</td></tr>
+     <tr><td class="num">  15.0</td><td class="left">'Sim_Ed'</td></tr>
+     <tr><td class="num">  15.4</td><td class="left">'Angolino'</td></tr>
+     <tr><td class="num">  15.4</td><td class="left">'Agnieszka'</td></tr>
+     <tr><td class="num">  19.8</td><td class="left">'Alex'</td></tr>
+     <tr><td class="num">  21.7</td><td class="left">'Antonio EE'</td></tr>
+     <tr><td class="num">  22.5</td><td class="left">'Klaus'</td></tr>
+     <tr><td class="num">  22.8</td><td class="left">'Marc-Hendrik'</td></tr>
      <tr><td class="num">  23.0</td><td class="left">'Chris'</td></tr>
      <tr><td class="num">  23.9</td><td class="left">'Thomas'</td></tr>
      <tr><td class="num">  24.2</td><td class="left">'Feynman'</td></tr>
-     <tr><td class="num">  24.4</td><td class="left">'Bent'</td></tr>
-     <tr><td class="num">  24.6</td><td class="left">'hdwow'</td></tr>
-     <tr><td class="num">  25.1</td><td class="left">'Gottseinsohn'</td></tr>
-     <tr><td class="num">  25.8</td><td class="left">'Ale'</td></tr>
-     <tr><td class="num">  25.8</td><td class="left">'Hans-HD'</td></tr>
+     <tr><td class="num">  24.7</td><td class="left">'hdwow'</td></tr>
+     <tr><td class="num">  24.7</td><td class="left">'Bent'</td></tr>
+     <tr><td class="num">  25.2</td><td class="left">'Gottseinsohn'</td></tr>
+     <tr><td class="num">  25.4</td><td class="left">'Ale'</td></tr>
+     <tr><td class="num">  25.9</td><td class="left">'Hans-HD'</td></tr>
      <tr><td class="num">  26.9</td><td class="left">'un_guru'</td></tr>
-     <tr><td class="num">  27.4</td><td class="left">'Little_Mole'</td></tr>
-     <tr><td class="num">  27.5</td><td class="left">'J3FF'</td></tr>
-     <tr><td class="num">  28.5</td><td class="left">'GiannuzzITA'</td></tr>
+     <tr><td class="num">  27.5</td><td class="left">'Little_Mole'</td></tr>
+     <tr><td class="num">  27.6</td><td class="left">'J3FF'</td></tr>
+     <tr><td class="num">  28.6</td><td class="left">'GiannuzzITA'</td></tr>
      <tr><td class="num">  28.8</td><td class="left">'biotopa'</td></tr>
-     <tr><td class="num">  29.4</td><td class="left">'oblo'</td></tr>
+     <tr><td class="num">  28.8</td><td class="left">'Vinksu'</td></tr>
+     <tr><td class="num">  29.5</td><td class="left">'oblo'</td></tr>
      <tr><td class="num">  29.7</td><td class="left">'redsantz'</td></tr>
-     <tr><td class="num">  30.0</td><td class="left">'geembo_90'</td></tr>
-     <tr><td class="num">  30.9</td><td class="left">'Edgar_Flesk'</td></tr>
-     <tr><td class="num">  31.2</td><td class="left">'Melanie'</td></tr>
-     <tr><td class="num">  31.5</td><td class="left">'IChrisI'</td></tr>
-     <tr><td class="num">  31.6</td><td class="left">'Vinksu'</td></tr>
-     <tr><td class="num">  31.8</td><td class="left">'NorthForty'</td></tr>
+     <tr><td class="num">  30.2</td><td class="left">'geembo_90'</td></tr>
+     <tr><td class="num">  31.0</td><td class="left">'Edgar_Flesk'</td></tr>
+     <tr><td class="num">  31.3</td><td class="left">'Melanie'</td></tr>
+     <tr><td class="num">  31.6</td><td class="left">'IChrisI'</td></tr>
+     <tr><td class="num">  31.9</td><td class="left">'NorthForty'</td></tr>
      <tr><td class="num">  32.1</td><td class="left">'erich'</td></tr>
      <tr><td class="num">  32.1</td><td class="left">'Gorn'</td></tr>
-     <tr><td class="num">  32.3</td><td class="left">'Davacardo'</td></tr>
-     <tr><td class="num">  34.9</td><td class="left">'niebie'</td></tr>
+     <tr><td class="num">  32.4</td><td class="left">'Davacardo'</td></tr>
+     <tr><td class="num">  35.0</td><td class="left">'niebie'</td></tr>
      <tr><td class="num">  35.0</td><td class="left">'MicWa'</td></tr>
-     <tr><td class="num">  35.1</td><td class="left">'WP319'</td></tr>
+     <tr><td class="num">  35.2</td><td class="left">'WP319'</td></tr>
      <tr><td class="num">  35.6</td><td class="left">'Kosby'</td></tr>
-     <tr><td class="num">  37.2</td><td class="left">'Rugby4ever'</td></tr>
-     <tr><td class="num">  37.2</td><td class="left">'mecke'</td></tr>
+     <tr><td class="num">  36.5</td><td class="left">'alain'</td></tr>
+     <tr><td class="num">  37.3</td><td class="left">'Rugby4ever'</td></tr>
      <tr><td class="num">  38.5</td><td class="left">'WesleyCrusher'</td></tr>
      <tr><td class="num">  38.6</td><td class="left">'Drotten'</td></tr>
      <tr><td class="num">  39.0</td><td class="left">'Archcorenth'</td></tr>
      <tr><td class="num">  39.2</td><td class="left">'Harry Lim'</td></tr>
-     <tr><td class="num">  39.5</td><td class="left">'B-man'</td></tr>
+     <tr><td class="num">  39.6</td><td class="left">'B-man'</td></tr>
      <tr><td class="num">  39.8</td><td class="left">'Nfol'</td></tr>
-     <tr><td class="num">  40.8</td><td class="left">'Tiger'</td></tr>
+     <tr><td class="num">  40.9</td><td class="left">'Tiger'</td></tr>
      <tr><td class="num">  41.2</td><td class="left">'gringer'</td></tr>
      <tr><td class="num">  41.4</td><td class="left">'Snaily'</td></tr>
-     <tr><td class="num">  41.6</td><td class="left">'Vlad'</td></tr>
+     <tr><td class="num">  41.7</td><td class="left">'Vlad'</td></tr>
      <tr><td class="num">  42.7</td><td class="left">'Momcat'</td></tr>
-     <tr><td class="num">  42.8</td><td class="left">'Liam Sheehan'</td></tr>
-     <tr><td class="num">  43.4</td><td class="left">'Uli'</td></tr>
-     <tr><td class="num">  43.4</td><td class="left">'Breezy'</td></tr>
-     <tr><td class="num">  45.1</td><td class="left">'Tarim'</td></tr>
-     <tr><td class="num">  45.8</td><td class="left">'IntKecsk'</td></tr>
-     <tr><td class="num">  46.0</td><td class="left">'tjRaven'</td></tr>
-     <tr><td class="num">  47.1</td><td class="left">'ntaeijr'</td></tr>
-     <tr><td class="num">  47.2</td><td class="left">'mhatta'</td></tr>
+     <tr><td class="num">  42.9</td><td class="left">'Liam Sheehan'</td></tr>
+     <tr><td class="num">  43.5</td><td class="left">'Uli'</td></tr>
+     <tr><td class="num">  43.5</td><td class="left">'Breezy'</td></tr>
+     <tr><td class="num">  45.2</td><td class="left">'Tarim'</td></tr>
+     <tr><td class="num">  45.9</td><td class="left">'IntKecsk'</td></tr>
+     <tr><td class="num">  46.1</td><td class="left">'tjRaven'</td></tr>
+     <tr><td class="num">  47.2</td><td class="left">'ntaeijr'</td></tr>
+     <tr><td class="num">  47.3</td><td class="left">'mhatta'</td></tr>
      <tr><td class="num">  48.9</td><td class="left">'Zak'</td></tr>
-     <tr><td class="num">  49.3</td><td class="left">'Valkyrie2'</td></tr>
      <tr><td class="num">  49.4</td><td class="left">'rima'</td></tr>
+     <tr><td class="num">  49.4</td><td class="left">'Valkyrie2'</td></tr>
      <tr><td class="num">  49.7</td><td class="left">'Sandra'</td></tr>
-     <tr><td class="num">  50.3</td><td class="left">'ReasonAnce'</td></tr>
+     <tr><td class="num">  50.2</td><td class="left">'ReasonAnce'</td></tr>
      <tr><td class="num">  50.7</td><td class="left">'jdcampo'</td></tr>
-     <tr><td class="num">  51.1</td><td class="left">'Jeffrey S'</td></tr>
+     <tr><td class="num">  51.2</td><td class="left">'Jeffrey S'</td></tr>
      <tr><td class="num">  51.5</td><td class="left">'brynn'</td></tr>
      <tr><td class="num">  51.5</td><td class="left">'AkRa'</td></tr>
-     <tr><td class="num">  51.9</td><td class="left">'Slav'</td></tr>
+     <tr><td class="num">  51.8</td><td class="left">'Slav'</td></tr>
      <tr><td class="num">  52.0</td><td class="left">'Vaily'</td></tr>
      <tr><td class="num">  52.2</td><td class="left">'Pascal'</td></tr>
      <tr><td class="num">  53.2</td><td class="left">'Turbogurk'</td></tr>
-     <tr><td class="num">  53.3</td><td class="left">'Neophilus'</td></tr>
-     <tr><td class="num">  53.3</td><td class="left">'Cyphase'</td></tr>
-     <tr><td class="num">  55.6</td><td class="left">'krazy62'</td></tr>
-     <tr><td class="num">  56.4</td><td class="left">'Adonica'</td></tr>
+     <tr><td class="num">  53.2</td><td class="left">'Neophilus'</td></tr>
+     <tr><td class="num">  53.2</td><td class="left">'Cyphase'</td></tr>
+     <tr><td class="num">  55.7</td><td class="left">'krazy62'</td></tr>
+     <tr><td class="num">  56.5</td><td class="left">'Adonica'</td></tr>
      <tr><td class="num">  56.8</td><td class="left">'Kadu'</td></tr>
      <tr><td class="num">  59.0</td><td class="left">'Mecki'</td></tr>
-     <tr><td class="num">  59.7</td><td class="left">'Sopoforic'</td></tr>
+     <tr><td class="num">  59.6</td><td class="left">'Sopoforic'</td></tr>
      <tr><td class="num">  61.7</td><td class="left">'Asbel'</td></tr>
      <tr><td class="num">  63.5</td><td class="left">'tasker'</td></tr>
      <tr><td class="num">  63.8</td><td class="left">'Meeve'</td></tr>
@@ -140,24 +142,24 @@
      <tr><td class="num">  66.3</td><td class="left">'Fred_the_wise'</td></tr>
      <tr><td class="num">  66.5</td><td class="left">'Samuel'</td></tr>
      <tr><td class="num">  66.8</td><td class="left">'schmusi20'</td></tr>
-     <tr><td class="num">  67.2</td><td class="left">'Sparkey'</td></tr>
-     <tr><td class="num">  67.4</td><td class="left">'Alf'</td></tr>
+     <tr><td class="num">  67.1</td><td class="left">'Sparkey'</td></tr>
+     <tr><td class="num">  67.5</td><td class="left">'Alf'</td></tr>
      <tr><td class="num">  69.1</td><td class="left">'Magnus and Susi'</td></tr>
-     <tr><td class="num">  69.9</td><td class="left">'Zhura'</td></tr>
+     <tr><td class="num">  69.8</td><td class="left">'Zhura'</td></tr>
      <tr><td class="num">  70.2</td><td class="left">'xmouse'</td></tr>
      <tr><td class="num">  71.7</td><td class="left">'Joona'</td></tr>
-     <tr><td class="num">  72.1</td><td class="left">'AQZ'</td></tr>
-     <tr><td class="num">  73.5</td><td class="left">'crypto_rsa'</td></tr>
-     <tr><td class="num">  74.0</td><td class="left">'Dvorhagen'</td></tr>
-     <tr><td class="num">  74.8</td><td class="left">'Eselchen'</td></tr>
-     <tr><td class="num">  75.0</td><td class="left">'Nicol?s'</td></tr>
-     <tr><td class="num">  75.0</td><td class="left">'jojo'</td></tr>
-     <tr><td class="num">  75.1</td><td class="left">'AsuCaga'</td></tr>
-     <tr><td class="num">  78.4</td><td class="left">'colonel crayon'</td></tr>
+     <tr><td class="num">  72.0</td><td class="left">'AQZ'</td></tr>
+     <tr><td class="num">  73.4</td><td class="left">'crypto_rsa'</td></tr>
+     <tr><td class="num">  73.9</td><td class="left">'Dvorhagen'</td></tr>
+     <tr><td class="num">  74.7</td><td class="left">'Eselchen'</td></tr>
+     <tr><td class="num">  74.9</td><td class="left">'Nicol?s'</td></tr>
+     <tr><td class="num">  74.9</td><td class="left">'jojo'</td></tr>
+     <tr><td class="num">  75.0</td><td class="left">'AsuCaga'</td></tr>
+     <tr><td class="num">  78.3</td><td class="left">'colonel crayon'</td></tr>
      <tr><td class="num">  79.3</td><td class="left">'Kroetchen'</td></tr>
      <tr><td class="num">  80.2</td><td class="left">'Agares'</td></tr>
      <tr><td class="num">  84.8</td><td class="left">'Miel56'</td></tr>
      <tr><td class="num">  90.0</td><td class="left">'The red O'</td></tr>
      <tr><td class="num">  90.1</td><td class="left">'Sequoyah'</td></tr>
-     <tr><td class="num">  92.3</td><td class="left">'Michael'</td></tr>
+     <tr><td class="num">  92.2</td><td class="left">'Michael'</td></tr>
   </table>

Modified: homepage/input/table-rat.html
===================================================================
--- homepage/input/table-rat.html	2008-09-02 20:40:09 UTC (rev 1299)
+++ homepage/input/table-rat.html	2008-09-03 22:27:59 UTC (rev 1300)
@@ -1,24 +1,25 @@
   <table>
-    <caption>$$Rating_Statistics$$ $$July$$ 2008</caption>
+    <caption>$$Rating_Statistics$$ $$August$$ 2008</caption>
     <colgroup><col width="80"><col width="80"><col width="220"></colgroup>
     <tr><th>$$count$$</th><th>$$average$$</th><th class="left">$$user$$</th></tr>    <tr><td class="num">1062</td><td class="num"> 5.06</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1056</td><td class="num"> 4.83</td><td class="left">'Taztunes'</td></tr>
-    <tr><td class="num">1006</td><td class="num"> 5.04</td><td class="left">'dev0'</td></tr>
-    <tr><td class="num">887</td><td class="num"> 4.80</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num">1045</td><td class="num"> 4.93</td><td class="left">'Crystalicum'</td></tr>
+    <tr><td class="num">1008</td><td class="num"> 5.03</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num">891</td><td class="num"> 4.80</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">871</td><td class="num"> 5.09</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num">653</td><td class="num"> 5.01</td><td class="left">'Duffy'</td></tr>
-    <tr><td class="num">632</td><td class="num"> 4.78</td><td class="left">'U-Punkt'</td></tr>
+    <tr><td class="num">639</td><td class="num"> 4.79</td><td class="left">'U-Punkt'</td></tr>
     <tr><td class="num">628</td><td class="num"> 5.00</td><td class="left">'Moneymaker'</td></tr>
     <tr><td class="num">622</td><td class="num"> 4.22</td><td class="left">'shoki'</td></tr>
+    <tr><td class="num">564</td><td class="num"> 5.17</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">562</td><td class="num"> 4.48</td><td class="left">'Alexandros'</td></tr>
-    <tr><td class="num">552</td><td class="num"> 5.14</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">534</td><td class="num"> 4.97</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num">511</td><td class="num"> 5.30</td><td class="left">'Lukas'</td></tr>
     <tr><td class="num">487</td><td class="num"> 5.02</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num">482</td><td class="num"> 4.04</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num">448</td><td class="num"> 5.08</td><td class="left">'Johannes'</td></tr>
     <tr><td class="num">433</td><td class="num"> 4.36</td><td class="left">'ged'</td></tr>
     <tr><td class="num">388</td><td class="num"> 4.86</td><td class="left">'Gloop'</td></tr>
-    <tr><td class="num">369</td><td class="num"> 4.04</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num">307</td><td class="num"> 4.01</td><td class="left">'Sim_Ed'</td></tr>
     <tr><td class="num">285</td><td class="num"> 4.60</td><td class="left">'ABS'</td></tr>
     <tr><td class="num">254</td><td class="num"> 4.91</td><td class="left">'JuSt'</td></tr>
@@ -49,14 +50,14 @@
     <tr><td class="num"> 30</td><td class="num"> 6.93</td><td class="left">'un_guru'</td></tr>
     <tr><td class="num"> 25</td><td class="num"> 4.88</td><td class="left">'Drotten'</td></tr>
     <tr><td class="num"> 25</td><td class="num"> 7.16</td><td class="left">'Mark P.'</td></tr>
+    <tr><td class="num"> 22</td><td class="num"> 6.45</td><td class="left">'Ale'</td></tr>
     <tr><td class="num"> 19</td><td class="num"> 3.74</td><td class="left">'Eselchen'</td></tr>
-    <tr><td class="num"> 17</td><td class="num"> 7.18</td><td class="left">'Ale'</td></tr>
     <tr><td class="num"> 17</td><td class="num"> 5.53</td><td class="left">'Jeffrey S'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 3.25</td><td class="left">'tasker'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 7.63</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 3.88</td><td class="left">'Mecki'</td></tr>
     <tr><td class="num"> 13</td><td class="num"> 5.23</td><td class="left">'Samuel'</td></tr>
-    <tr><td class="num"> 12</td><td class="num"> 8.08</td><td class="left">'Ludmian'</td></tr>
+    <tr><td class="num"> 13</td><td class="num"> 8.15</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 11</td><td class="num"> 6.36</td><td class="left">'ShadowPhrogg32642342'</td></tr>
     <tr><td class="num"> 10</td><td class="num"> 7.80</td><td class="left">'hdwow'</td></tr>
     <tr><td class="num">  8</td><td class="num"> 3.25</td><td class="left">'Vlad'</td></tr>

Modified: homepage/input/table-solved.html
===================================================================
--- homepage/input/table-solved.html	2008-09-02 20:40:09 UTC (rev 1299)
+++ homepage/input/table-solved.html	2008-09-03 22:27:59 UTC (rev 1300)
@@ -1,5 +1,5 @@
   <table>
-    <caption>$$Solved_Level_Statistics$$ $$July$$ 2008</caption>
+    <caption>$$Solved_Level_Statistics$$ $$August$$ 2008</caption>
     <colgroup><col width="130"><col width="130"><col width="130"><col width="240"></colgroup>
     <tr><th>$$difficult$$</th><th>$$easy$$</th><th>$$total$$</th><th class="left">$$user$$</th></tr>
     <tr><td class="num">1045/1045</td><td class="num">189/189</td><td class="num">100.00%</td><td class="left">'ryujun'</td></tr>
@@ -7,15 +7,15 @@
     <tr><td class="num">1029/1045</td><td class="num">185/189</td><td class="num"> 98.38%</td><td class="left">'Freshman'</td></tr>
     <tr><td class="num">1029/1045</td><td class="num">183/189</td><td class="num"> 98.22%</td><td class="left">'Craven'</td></tr>
     <tr><td class="num">1031/1045</td><td class="num">179/189</td><td class="num"> 98.06%</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">1019/1045</td><td class="num">183/189</td><td class="num"> 97.41%</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">1016/1045</td><td class="num">182/189</td><td class="num"> 97.08%</td><td class="left">'Ronald'</td></tr>
-    <tr><td class="num">1015/1045</td><td class="num">183/189</td><td class="num"> 97.08%</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">1021/1045</td><td class="num">177/189</td><td class="num"> 97.08%</td><td class="left">'Malla'</td></tr>
-    <tr><td class="num">1009/1045</td><td class="num">182/189</td><td class="num"> 96.52%</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num">1011/1045</td><td class="num">182/189</td><td class="num"> 96.68%</td><td class="left">'dev0'</td></tr>
     <tr><td class="num">1014/1045</td><td class="num">175/189</td><td class="num"> 96.35%</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num"> 999/1045</td><td class="num">177/189</td><td class="num"> 95.30%</td><td class="left">'biotopa'</td></tr>
     <tr><td class="num"> 970/1045</td><td class="num">166/189</td><td class="num"> 92.06%</td><td class="left">'Andy'</td></tr>
-    <tr><td class="num"> 951/1045</td><td class="num">171/189</td><td class="num"> 90.92%</td><td class="left">'mecke'</td></tr>
-    <tr><td class="num"> 947/1045</td><td class="num">174/189</td><td class="num"> 90.84%</td><td class="left">'Daisy'</td></tr>
+    <tr><td class="num"> 951/1045</td><td class="num">172/189</td><td class="num"> 91.00%</td><td class="left">'mecke'</td></tr>
+    <tr><td class="num"> 947/1045</td><td class="num">175/189</td><td class="num"> 90.92%</td><td class="left">'Daisy'</td></tr>
     <tr><td class="num"> 949/1045</td><td class="num">170/189</td><td class="num"> 90.68%</td><td class="left">'para_doks'</td></tr>
     <tr><td class="num"> 922/1045</td><td class="num">154/189</td><td class="num"> 87.20%</td><td class="left">'mrduke'</td></tr>
     <tr><td class="num"> 933/1045</td><td class="num">125/189</td><td class="num"> 85.74%</td><td class="left">'Alex'</td></tr>
@@ -29,14 +29,14 @@
     <tr><td class="num"> 846/1045</td><td class="num">144/189</td><td class="num"> 80.23%</td><td class="left">'Gorn'</td></tr>
     <tr><td class="num"> 854/1045</td><td class="num">131/189</td><td class="num"> 79.82%</td><td class="left">'shoki'</td></tr>
     <tr><td class="num"> 874/1045</td><td class="num">103/189</td><td class="num"> 79.17%</td><td class="left">'Melanie'</td></tr>
+    <tr><td class="num"> 974/1045</td><td class="num">  1/189</td><td class="num"> 79.01%</td><td class="left">'Ale'</td></tr>
     <tr><td class="num"> 950/1045</td><td class="num">  0/189</td><td class="num"> 76.99%</td><td class="left">'Tarim'</td></tr>
-    <tr><td class="num"> 946/1045</td><td class="num">  1/189</td><td class="num"> 76.74%</td><td class="left">'Ale'</td></tr>
     <tr><td class="num"> 804/1045</td><td class="num">142/189</td><td class="num"> 76.66%</td><td class="left">'Safalra'</td></tr>
     <tr><td class="num"> 782/1045</td><td class="num">132/189</td><td class="num"> 74.07%</td><td class="left">'AlephD'</td></tr>
-    <tr><td class="num"> 775/1045</td><td class="num">118/189</td><td class="num"> 72.37%</td><td class="left">'U-Punkt'</td></tr>
-    <tr><td class="num"> 758/1045</td><td class="num">123/189</td><td class="num"> 71.39%</td><td class="left">'Ludmian'</td></tr>
+    <tr><td class="num"> 784/1045</td><td class="num">128/189</td><td class="num"> 73.91%</td><td class="left">'dpl'</td></tr>
+    <tr><td class="num"> 776/1045</td><td class="num">125/189</td><td class="num"> 73.01%</td><td class="left">'Ludmian'</td></tr>
+    <tr><td class="num"> 779/1045</td><td class="num">118/189</td><td class="num"> 72.69%</td><td class="left">'U-Punkt'</td></tr>
     <tr><td class="num"> 739/1045</td><td class="num">131/189</td><td class="num"> 70.50%</td><td class="left">'ABS'</td></tr>
-    <tr><td class="num"> 740/1045</td><td class="num">123/189</td><td class="num"> 69.94%</td><td class="left">'dpl'</td></tr>
     <tr><td class="num"> 728/1045</td><td class="num">126/189</td><td class="num"> 69.21%</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num"> 755/1045</td><td class="num"> 96/189</td><td class="num"> 68.96%</td><td class="left">'brynn'</td></tr>
     <tr><td class="num"> 762/1045</td><td class="num"> 73/189</td><td class="num"> 67.67%</td><td class="left">'redsantz'</td></tr>
@@ -47,11 +47,12 @@
     <tr><td class="num"> 681/1045</td><td class="num"> 78/189</td><td class="num"> 61.51%</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 659/1045</td><td class="num"> 95/189</td><td class="num"> 61.10%</td><td class="left">'Marc-Hendrik'</td></tr>
     <tr><td class="num"> 633/1045</td><td class="num">110/189</td><td class="num"> 60.21%</td><td class="left">'Raoul'</td></tr>
+    <tr><td class="num"> 665/1045</td><td class="num"> 64/189</td><td class="num"> 59.08%</td><td class="left">'alain'</td></tr>
     <tr><td class="num"> 643/1045</td><td class="num"> 83/189</td><td class="num"> 58.83%</td><td class="left">'Great Scott'</td></tr>
     <tr><td class="num"> 714/1045</td><td class="num">  0/189</td><td class="num"> 57.86%</td><td class="left">'Gottseinsohn'</td></tr>
     <tr><td class="num"> 620/1045</td><td class="num"> 72/189</td><td class="num"> 56.08%</td><td class="left">'Breezy'</td></tr>
     <tr><td class="num"> 636/1045</td><td class="num"> 55/189</td><td class="num"> 56.00%</td><td class="left">'fabian'</td></tr>
-    <tr><td class="num"> 569/1045</td><td class="num">114/189</td><td class="num"> 55.35%</td><td class="left">'Mark P.'</td></tr>
+    <tr><td class="num"> 574/1045</td><td class="num">115/189</td><td class="num"> 55.83%</td><td class="left">'Mark P.'</td></tr>
     <tr><td class="num"> 588/1045</td><td class="num"> 93/189</td><td class="num"> 55.19%</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 599/1045</td><td class="num"> 80/189</td><td class="num"> 55.02%</td><td class="left">'serpent'</td></tr>
     <tr><td class="num"> 577/1045</td><td class="num">100/189</td><td class="num"> 54.86%</td><td class="left">'Zekobah'</td></tr>
@@ -68,6 +69,7 @@
     <tr><td class="num"> 504/1045</td><td class="num"> 62/189</td><td class="num"> 45.87%</td><td class="left">'Hans-HD'</td></tr>
     <tr><td class="num"> 519/1045</td><td class="num"> 37/189</td><td class="num"> 45.06%</td><td class="left">'Valkyrie2'</td></tr>
     <tr><td class="num"> 492/1045</td><td class="num"> 63/189</td><td class="num"> 44.98%</td><td class="left">'Antonio EE'</td></tr>
+    <tr><td class="num"> 541/1045</td><td class="num">  6/189</td><td class="num"> 44.33%</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num"> 516/1045</td><td class="num"> 24/189</td><td class="num"> 43.76%</td><td class="left">'niebie'</td></tr>
     <tr><td class="num"> 508/1045</td><td class="num"> 26/189</td><td class="num"> 43.27%</td><td class="left">'Feynman'</td></tr>
     <tr><td class="num"> 494/1045</td><td class="num"> 26/189</td><td class="num"> 42.14%</td><td class="left">'Daniel'</td></tr>
@@ -76,7 +78,6 @@
     <tr><td class="num"> 503/1045</td><td class="num">  7/189</td><td class="num"> 41.33%</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num"> 397/1045</td><td class="num"> 93/189</td><td class="num"> 39.71%</td><td class="left">'Hairball'</td></tr>
     <tr><td class="num"> 440/1045</td><td class="num"> 50/189</td><td class="num"> 39.71%</td><td class="left">'ged'</td></tr>
-    <tr><td class="num"> 467/1045</td><td class="num">  6/189</td><td class="num"> 38.33%</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num"> 438/1045</td><td class="num">  3/189</td><td class="num"> 35.74%</td><td class="left">'oblo'</td></tr>
     <tr><td class="num"> 392/1045</td><td class="num"> 40/189</td><td class="num"> 35.01%</td><td class="left">'hendrik'</td></tr>
     <tr><td class="num"> 391/1045</td><td class="num"> 36/189</td><td class="num"> 34.60%</td><td class="left">'Iceshark7'</td></tr>
@@ -95,6 +96,7 @@
     <tr><td class="num"> 323/1045</td><td class="num"> 52/189</td><td class="num"> 30.39%</td><td class="left">'Kevin'</td></tr>
     <tr><td class="num"> 277/1045</td><td class="num"> 90/189</td><td class="num"> 29.74%</td><td class="left">'gringer'</td></tr>
     <tr><td class="num"> 347/1045</td><td class="num"> 15/189</td><td class="num"> 29.34%</td><td class="left">'WesleyCrusher'</td></tr>
+    <tr><td class="num"> 298/1045</td><td class="num"> 60/189</td><td class="num"> 29.01%</td><td class="left">'Crystalicum'</td></tr>
     <tr><td class="num"> 331/1045</td><td class="num"> 14/189</td><td class="num"> 27.96%</td><td class="left">'Archcorenth'</td></tr>
     <tr><td class="num"> 281/1045</td><td class="num"> 63/189</td><td class="num"> 27.88%</td><td class="left">'erich'</td></tr>
     <tr><td class="num"> 295/1045</td><td class="num"> 29/189</td><td class="num"> 26.26%</td><td class="left">'Tiger'</td></tr>

Modified: homepage/input/table-wr.html
===================================================================
--- homepage/input/table-wr.html	2008-09-02 20:40:09 UTC (rev 1299)
+++ homepage/input/table-wr.html	2008-09-03 22:27:59 UTC (rev 1300)
@@ -1,50 +1,51 @@
   <table>
-    <caption>$$Worldrecord_Statistics$$ $$July$$ 2008</caption>
+    <caption>$$Worldrecord_Statistics$$ $$August$$ 2008</caption>
     <colgroup><col width="80"><col width="80"><col width="470"></colgroup>
     <tr><th>$$total$$</th><th>$$shared$$</th><th class="left">$$user$$</th></tr>
-    <tr><td class="num">985</td><td class="num">239</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">154</td><td class="num"> 90</td><td class="left">'Stupid'</td></tr>
+    <tr><td class="num">963</td><td class="num">240</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">152</td><td class="num"> 90</td><td class="left">'Stupid'</td></tr>
+    <tr><td class="num">123</td><td class="num"> 89</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">108</td><td class="num">101</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num"> 98</td><td class="num"> 76</td><td class="left">'daydreamer'</td></tr>
-    <tr><td class="num"> 63</td><td class="num"> 52</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num"> 83</td><td class="num"> 73</td><td class="left">'Crystalicum'</td></tr>
+    <tr><td class="num"> 69</td><td class="num"> 59</td><td class="left">'dev0'</td></tr>
     <tr><td class="num"> 56</td><td class="num"> 39</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num"> 44</td><td class="num"> 31</td><td class="left">'Malla'</td></tr>
     <tr><td class="num"> 44</td><td class="num"> 43</td><td class="left">'Great Scott'</td></tr>
-    <tr><td class="num"> 43</td><td class="num"> 30</td><td class="left">'Alexandros'</td></tr>
-    <tr><td class="num"> 40</td><td class="num"> 32</td><td class="left">'ryujun'</td></tr>
-    <tr><td class="num"> 32</td><td class="num"> 26</td><td class="left">'Zekobah'</td></tr>
+    <tr><td class="num"> 42</td><td class="num"> 29</td><td class="left">'Alexandros'</td></tr>
+    <tr><td class="num"> 39</td><td class="num"> 31</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num"> 32</td><td class="num"> 30</td><td class="left">'Django'</td></tr>
     <tr><td class="num"> 31</td><td class="num"> 27</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 30</td><td class="num"> 20</td><td class="left">'Emmanuel'</td></tr>
+    <tr><td class="num"> 29</td><td class="num"> 26</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 28</td><td class="num"> 27</td><td class="left">'joseba'</td></tr>
     <tr><td class="num"> 26</td><td class="num"> 25</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 23</td><td class="num"> 19</td><td class="left">'ged'</td></tr>
-    <tr><td class="num"> 18</td><td class="num"> 16</td><td class="left">'B-Huff'</td></tr>
-    <tr><td class="num"> 17</td><td class="num"> 16</td><td class="left">'Safalra'</td></tr>
-    <tr><td class="num"> 16</td><td class="num"> 14</td><td class="left">'Ludmian'</td></tr>
+    <tr><td class="num"> 18</td><td class="num"> 16</td><td class="left">'Ludmian'</td></tr>
+    <tr><td class="num"> 17</td><td class="num"> 15</td><td class="left">'B-Huff'</td></tr>
+    <tr><td class="num"> 16</td><td class="num"> 15</td><td class="left">'Safalra'</td></tr>
     <tr><td class="num"> 15</td><td class="num"> 14</td><td class="left">'HuB34'</td></tr>
-    <tr><td class="num"> 15</td><td class="num"> 15</td><td class="left">'bojster'</td></tr>
-    <tr><td class="num"> 13</td><td class="num"> 13</td><td class="left">'ABS'</td></tr>
-    <tr><td class="num"> 12</td><td class="num">  6</td><td class="left">'Ronald'</td></tr>
-    <tr><td class="num"> 10</td><td class="num">  7</td><td class="left">'Chocolate Zero'</td></tr>
+    <tr><td class="num"> 14</td><td class="num"> 14</td><td class="left">'bojster'</td></tr>
+    <tr><td class="num"> 12</td><td class="num"> 12</td><td class="left">'ABS'</td></tr>
+    <tr><td class="num"> 11</td><td class="num">  5</td><td class="left">'Ronald'</td></tr>
+    <tr><td class="num"> 11</td><td class="num"> 11</td><td class="left">'dpl'</td></tr>
+    <tr><td class="num"> 10</td><td class="num">  8</td><td class="left">'Chocolate Zero'</td></tr>
     <tr><td class="num">  9</td><td class="num">  5</td><td class="left">'ShadowPhrogg32642342'</td></tr>
     <tr><td class="num">  9</td><td class="num">  9</td><td class="left">'fabian'</td></tr>
     <tr><td class="num">  8</td><td class="num">  6</td><td class="left">'Gloop'</td></tr>
-    <tr><td class="num">  8</td><td class="num">  8</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">  7</td><td class="num">  5</td><td class="left">'Taztunes' + 'Angolino'</td></tr>
     <tr><td class="num">  7</td><td class="num">  6</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num">  6</td><td class="num">  3</td><td class="left">'para_doks' + 'Breezy' + 'Daisy'</td></tr>
     <tr><td class="num">  6</td><td class="num">  5</td><td class="left">'Guglielmo'</td></tr>
     <tr><td class="num">  6</td><td class="num">  6</td><td class="left">'Tobias'</td></tr>
     <tr><td class="num">  5</td><td class="num">  4</td><td class="left">'Lukas'</td></tr>
-    <tr><td class="num">  5</td><td class="num">  5</td><td class="left">'Thomas' + 'Chris' + 'Wuzzy' + 'Ralf'</td></tr>
+    <tr><td class="num">  5</td><td class="num">  5</td><td class="left">'Raoul' + 'Thomas' + 'Chris' + 'Wuzzy' + 'Ralf'</td></tr>
     <tr><td class="num">  4</td><td class="num">  2</td><td class="left">'Hairball'</td></tr>
-    <tr><td class="num">  4</td><td class="num">  4</td><td class="left">'U-Punkt' + 'Raoul' + 'J3FF' + 'Cyphase' + 'GiannuzzITA'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'mrduke' + 'Bent' + 'Stephanie'</td></tr>
+    <tr><td class="num">  4</td><td class="num">  4</td><td class="left">'U-Punkt' + 'J3FF' + 'Cyphase' + 'GiannuzzITA'</td></tr>
+    <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'mrduke' + 'Bent' + 'mecke' + 'Stephanie'</td></tr>
     <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'geembo_90' + 'Tiza' + 'Neophilus' + 'Nicol?s' + 'Andy' + 'Sopoforic'</td></tr>
-    <tr><td class="num">  2</td><td class="num">  1</td><td class="left">'Daniel' + 'colonel crayon'</td></tr>
+    <tr><td class="num">  2</td><td class="num">  1</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'ReasonAnce' + 'Drotten' + 'tjRaven' + 'Sim_Ed' + 'hendrik' + 'Austin' + 'Snaily' + 'Craven' + 'Ingo' + 'serpent'</td></tr>
-    <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'Ale' + 'Feynman' + 'Gorn' + 'Nat'</td></tr>
+    <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'Ale' + 'Feynman' + 'alain' + 'colonel crayon' + 'Gorn' + 'Nat'</td></tr>
     <tr><td class="num">  1</td><td class="num">  1</td><td class="left">'alfred69' + 'Agares' + 'Tiger' + 'Zak' + 'Slav' + 'niebie' + 'Andreas' + 'AlephD' + 'Samuel' + 'Mark P.' + 'oblo' + 'Pascal' + 'hdwow' + 'B-man' + 'Asbel' + 'Vlad' + 'Vaily' + 'Antonio EE' + 'JuSt'</td></tr>
-    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'tasker' + 'Miel56' + 'Zhura' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'ntaeijr' + 'Eselchen' + 'ael' + 'biotopa' + 'brynn' + 'IntKecsk' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'Fred_the_wise' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'Kroetchen' + 'crypto_rsa' + 'Harry Lim' + 'Sequoyah' + 'AkRa' + 'Momcat' + 'NorthForty' + 'Mecki' + 'The red O' + 'gringer' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'Kadu' + 'shoki' + 'jojo' + 'WesleyCrusher' + 'rima' + 'Klaus' + 'Valkyrie2' + 'MicWa' + 'AsuCaga' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'mecke' + 'un_guru' + 'krazy62' + 'Dvorhagen' + 'Sparkey' + 'Holger' + 'Ingo_K' + 'Ant' + 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Liam Sheehan' + 'Michael' + 'Tarim' + 'Agnieszka'</td></tr>
+    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'tasker' + 'Miel56' + 'Zhura' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'ntaeijr' + 'Eselchen' + 'ael' + 'biotopa' + 'brynn' + 'IntKecsk' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'Fred_the_wise' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'Kroetchen' + 'crypto_rsa' + 'Harry Lim' + 'Sequoyah' + 'AkRa' + 'Momcat' + 'NorthForty' + 'Mecki' + 'The red O' + 'gringer' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'Kadu' + 'shoki' + 'jojo' + 'WesleyCrusher' + 'rima' + 'Klaus' + 'Valkyrie2' + 'MicWa' + 'AsuCaga' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'un_guru' + 'krazy62' + 'Dvorhagen' + 'Sparkey' + 'Holger' + 'Ingo_K' + 'Ant' + 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Liam Sheehan' + 'Michael' + 'Tarim' + 'Agnieszka'</td></tr>
   </table>

Modified: homepage/input/userlist.html
===================================================================
--- homepage/input/userlist.html	2008-09-02 20:40:09 UTC (rev 1299)
+++ homepage/input/userlist.html	2008-09-03 22:27:59 UTC (rev 1300)
@@ -7,6 +7,7 @@
     <li>Agares</li>
     <li>Agnieszka</li>
     <li>AkRa</li>
+    <li>alain</li>
     <li>Ale</li>
     <li>AlephD</li>
     <li>Alex</li>
@@ -35,6 +36,7 @@
     <li>colonel crayon</li>
     <li>Craven</li>
     <li>crypto_rsa</li>
+    <li>Crystalicum</li>
     <li>Cyphase</li>
     <li>Daisy</li>
     <li>Daniel</li>



From andreasl at mail.berlios.de  Thu Sep  4 13:50:47 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Thu, 4 Sep 2008 13:50:47 +0200
Subject: [Enigma-game-svn] r1301 - in trunk: data
	data/levels/enigma_experimental data/levels/lib data/schemas
	src src/stones
Message-ID: <200809041150.m84BoliT020923@sheep.berlios.de>

Author: andreasl
Date: 2008-09-04 13:50:38 +0200 (Thu, 04 Sep 2008)
New Revision: 1301

Modified:
   trunk/data/api2init.lua
   trunk/data/levels/enigma_experimental/test_libsoko.xml
   trunk/data/levels/lib/liblua.xml
   trunk/data/levels/lib/libmap.xml
   trunk/data/levels/lib/libsoko-designlist.xml
   trunk/data/levels/lib/libsoko-endphase.xml
   trunk/data/levels/lib/libsoko.xml
   trunk/data/schemas/objects.xml
   trunk/src/stones.cc
   trunk/src/stones/BoulderStone.cc
   trunk/src/stones/LightPassengerStone.cc
   trunk/src/stones/PullStone.cc
   trunk/src/stones/RotatorStone.cc
   trunk/src/stones/RubberbandStone.cc
   trunk/src/stones/ShogunStone.cc
   trunk/src/stones/SwapStone.cc
   trunk/src/stones/Turnstile.cc
Log:
Trunk:
 - Adapt/repair liksoko (part I)
    - Switch to API 2.
    - Switch to current naming of objects.
    - Use of positions instead of coordinates, where feasible.
    - For endphase "knock" no item below the doors are neccessary
      anymore.
    - Repair freeze-checks, allowing attribute "freeze_check"
      for all stones.
    - Repair friction/adhesion-attributes.
    - Harden several stones against segfaults by self-induced
      kills (currently neccessary for libsoko for shogun stones,
      but did it for other stones as well).
    - Reduce magnet strength.
    - Adapt test level enigma_experimental/test_libsoko
 - libmap:
    - Fix libmap.sub.
    - Fix recognition of maps in api2init.
 - liblua:
    - lib.lua.print_table now recognizes positions and objects.
Note:
 - There is no resolver defined for Sokobans.
Todo:
 - Further beautifications, like use of groups.
 - Switch to namespace lib.soko.*.
 - Finetuning of designs.
 - Refman.


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/api2init.lua	2008-09-04 11:50:38 UTC (rev 1301)
@@ -181,11 +181,11 @@
         local ignore = ignorearg
         local map = maparg
         local readdir = readarg or MAP_IDENT
-        if (ignorearg.type == "map") then
+        if (type(ignore) == "table") and (type(ignore.defaultkey) == "string") then
             map = ignorearg
             ignore = map.defaultkey
             readdir = maparg or MAP_IDENT
-        elseif     (type(map.defaultkey) == "string")
+        elseif (type(map) == "table") and (type(map.defaultkey) == "string")
                and (string.len(map.defaultkey) ~= string.len(ignore)) then
             error("drawmap: Ignore key and default key differ in length.", 2)
         end

Modified: trunk/data/levels/enigma_experimental/test_libsoko.xml
===================================================================
--- trunk/data/levels/enigma_experimental/test_libsoko.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/levels/enigma_experimental/test_libsoko.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -3,12 +3,13 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Libsoko - Test" el:subtitle="" el:id="test_libsoko"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="experimental"/>
       <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Andreas Lochmann</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="1.00">
+      <el:compatibility el:enigma="1.10">
         <el:dependency el:path="lib/libsoko" el:id="lib/libsoko" el:release="1" el:preload="true"/>
+        <el:dependency el:path="lib/liblua" el:id="lib/liblua" el:release="1" el:preload="true"/>
       </el:compatibility>
       <el:modes el:easy="true" el:single="true" el:network="false"/>
       <el:score el:easy="-" el:difficult="-"/>
@@ -314,15 +315,15 @@
 design_min = 1 --76
 design_max = table.getn(design_list)
 
-design_number = design_max
+design_number = 77 --design_max
 
 --create_sokoball(multilevel2, 1, 1)
 create_sokoball(multilevel2, 13, design_number)
 --create_sokoball(chessoban, 2)
 --draw_sokoball(0, 0, chessoban, 2, nil, true) --leftending)
-set_stone("st-switch", 9, 1, {action="callback", target="design_minus_one"})
-set_stone("st-switch", 10, 1, {action="callback", target="design_plus_one"})
-design_statistics()
+wo[{9,1}] = {"st_switch", target="design_minus_one"}
+wo[{10,1}] = {"st_switch", target="design_plus_one"}
+--design_statistics()
 
 function leftending(nr)
   if nr == 2 then
@@ -339,8 +340,8 @@
     design_number = design_max
   end
   recreate_sokoball(design_number)
-  set_stone("st-switch", 9, 1, {action="callback", target="design_minus_one"})
-  set_stone("st-switch", 10, 1, {action="callback", target="design_plus_one"})
+  wo[{9,1}] = {"st_switch", target="design_minus_one"}
+  wo[{10,1}] = {"st_switch", target="design_plus_one"}
 end
 function design_plus_one()
   design_number = design_number + 1
@@ -348,11 +349,10 @@
     design_number = design_min
   end
   recreate_sokoball(design_number)
-  set_stone("st-switch", 9, 1, {action="callback", target="design_minus_one"})
-  set_stone("st-switch", 10, 1, {action="callback", target="design_plus_one"})
+  wo[{9,1}] = {"st_switch", target="design_minus_one"}
+  wo[{10,1}] = {"st_switch", target="design_plus_one"}
 end
 
-
     ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Modified: trunk/data/levels/lib/liblua.xml
===================================================================
--- trunk/data/levels/lib/liblua.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/levels/lib/liblua.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -124,7 +124,7 @@
     if type(value) == "number" then
       print((prefix or "") .. "|" .. key_s .. " = " .. value)
     elseif type(value) == "string" then
-      print((prefix or "").. "|" .. key_s .. " = \"" .. value .. "\"")
+      print((prefix or "") .. "|" .. key_s .. " = \"" .. value .. "\"")
     elseif type(value) == "table" then
       if (depth or 0) < 5 then
         print((prefix or "") .. "|" .. key_s .. " = |")
@@ -135,8 +135,15 @@
       else
         print((prefix or "") .. "|" .. key_s .. " = | ...")
       end
+    elseif (type(value) == "userdata") and (usertype(value) == "position") then
+      print((prefix or "") .. "|" .. key_s .. " = position " .. value.x
+            .. "/" .. value.y)
+    elseif (type(value) == "userdata") and (usertype(value) == "object") then
+      print((prefix or "") .. "|" .. key_s .. " = object of name '"
+            .. (value.name or "") .. "'")
     else
-      print((prefix or "").. "|" .. key_s .. " of type " .. type(value))
+      print((prefix or "") .. "|" .. key_s .. " of type " .. type(value)
+            .. " (usertype '" .. usertype(value) .. "')")
     end
   end
 end

Modified: trunk/data/levels/lib/libmap.xml
===================================================================
--- trunk/data/levels/lib/libmap.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/levels/lib/libmap.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -141,17 +141,17 @@
   if (type(map) ~= "table") or (map.type ~= "map") then
     error("lib.map.sub: Can only work on maps.", 2)
   end
-  local pos1, pos2 = arg1, arg2
-  if type(arg2) == "number" and type(arg3) == "number" then
-    -- arg2 and arg3 are width and height
-    pos2 = po(pos1.x + arg2 - 1, pos1.y + arg3 - 1)
-  end
-  if type(pos1) == "table" then
+  local pos1, pos2 = origin, arg2
+  if (type(pos1) == "table") or (usertype(pos1) == "object") then
     pos1 = po(pos1)
   end
-  if type(pos2) == "table" then
+  if (type(pos2) == "table") or (usertype(pos2) == "object") then
     pos2 = po(pos2)
   end
+  if type(arg2) == "number" and type(arg3) == "number" then
+    -- arg2 and arg3 are width and height
+    pos2 = po(pos1.x + arg2 - 1, pos1.y + arg3 - 1)
+  end
   pos1 = pos1:grid()
   pos2 = pos2:grid()
   if (pos2.x < pos1.x) or (pos2.y < pos1.y) then
@@ -159,11 +159,11 @@
         .. "is not top left-hand corner).", 2)
   end
   local result = {}
-  for y = pos1.y, pos2.y do
+  local kl = map.keylength
+  for y = pos1.y + 1, pos2.y + 1 do
     if y < map.height then
-      result[y] = string.sub(rawget(map, y) or "",
-                    pos1.x * map.keylength + 1,
-                    (pos2.x + 1) * map.keylength) or ""
+      result[y-pos1.y] = string.sub(rawget(map, y) or "",
+                             pos1.x * kl + 1, (pos2.x + 1) * kl) or ""
     end
   end
   return wo:newMap(map.defaultkey, result)  
@@ -179,7 +179,6 @@
   if (usertype(posarg) == "object") or (usertype(posarg) == "position") then
     local kl = rawget(map2, "__keylength")
     local dk = rawget(map2, "__defaultkey")
-    print(posarg.x..", "..posarg.y)
     for y = 1, map2.height do
       local line = rawget(map2, y)
       for x = 1, map2.width do

Modified: trunk/data/levels/lib/libsoko-designlist.xml
===================================================================
--- trunk/data/levels/lib/libsoko-designlist.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/levels/lib/libsoko-designlist.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -3,11 +3,11 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libsoko-designlist"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="experimental"/>
       <el:author el:name="Enigma Team" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2007 Enigma Team</el:copyright>
+      <el:copyright>Copyright ? 2007, 2008 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="1.00">
+      <el:compatibility el:enigma="1.10">
       </el:compatibility>
       <el:modes el:easy="false" el:single="false" el:network="false"/>
       <el:comments>
@@ -34,13 +34,13 @@
 -- If object types (like floors) repeat in the table, they are used in
 -- a checkerboard pattern. You can change this pattern by adding an
 -- element of the form "al:ALGORITHM", where ALGORITHM is one of the
--- algorithms listed below. Same for "fr:1.23" and "mf:4.5" for friction
+-- algorithms listed below. Same for "fr:1.23" and "ad:4.5" for friction
 -- and mouseforce. From all these attributes, only the last one will
 -- be used, all others ignored. This contrasts with the situation of
--- the gaming objects ("fl-", "st-", "it-"), whose order doesn't matter.
+-- the gaming objects ("fl_", "st_", "it_"), whose order doesn't matter.
 --
 -- "oxyd" only holds the oxyd's flavor, "endp" the way of resolving the
--- level from Sokoban to opening oxyds. Use "st-none" and "it-none" to
+-- level from Sokoban to opening oxyds. Use "st_nil" and "it_nil" to
 -- place spaces between stones/items.
 --
 -- The table might hold additional flags. Currently, only "white"
@@ -53,17 +53,17 @@
 --   [5] = { outf = "fl-leaves", inf = "fl-leavesb", box = "st-wood"
 --           wall = {"st-glass", "fl-wood", "fl-leaves", "al:random"},
 --           oxyd = "a", white = true,
---           endp = {goal = {"fl-abyss", "it-none"}, give = "it-hammer",
+--           endp = {goal = {"fl-abyss", "it_nil"}, give = "it_hammer",
 --                   alg = "block:st-break_acwhite"}}
 --
 --   will define design 5. The walls will alternate between
 --   st-glass/fl-wood and st-glass/fl-leaves. The goal will be
---   it-trigger by default. The actor will be ac-whiteball.
+--   it_trigger by default. The actor will be ac-whiteball.
 --   The boxes will be "st-wood". There will be oxyds visible
 --   from the beginning, but they are blocked by st-break_acwhite.
 --   When all goals are filled, the st-wood are removed by setting
 --   fl-abyss (by which they become fl-stwood), the goal-item is
---   removed. The player is finally given an it-hammer.
+--   removed. The player is finally given an it_hammer.
 --
 -- Possible flags:
 --
@@ -96,7 +96,7 @@
    inf = { "fl-wood" },
   outf = { "fl-water" },
    box = { "st-brownie" },
-  goal = { "it-trigger" },
+  goal = { "it_trigger" },
   oxyd = "a",
   endp = { alg = "circle" },
   outf_default_stone = "st-invisible"
@@ -105,7 +105,7 @@
 -- outf_default_stone has the following meaning: When outf is drawn
 -- by set_element, but no stone is set, outf_default_stone is used
 -- instead. You can suppress this behaviour by explicitly setting
--- outf = { "fl-myfloor", "st-none" }.
+-- outf = { "fl-myfloor", "st_nil" }.
 -- This is done to avoid a chess-stone from jumping into the void,
 -- as a present to the gamer.
 
@@ -116,510 +116,510 @@
 
 -- Ralf's designs
 [1]={box="st-brownie", wall="st-bluegray", inf="fl-bluegray",
-     outf="fl-space", door="st-door_a", oxyd="a",
-     endp={goal="st-none", alg="circle"}},
+     outf="fl-space", door="st_door_a", oxyd="a",
+     endp={goal="st_nil", alg="circle"}},
 [2]={box="st-glass_move", wall="st-bluegray", inf="fl-bluegray",
-     outf="fl-water", door="st-door_b", oxyd="a",
+     outf="fl-water", door="st_door_b", oxyd="a",
      endp={goal="st-glass1_hole", alg="ralf"}},
 [3]={box="st-wood-growing", wall="st-bluegray", inf="fl-bluegray",
-     outf="fl-abyss", door="st-door_c", oxyd="a",
-     endp={goal={"st-none", "fl-stwood", "it-none"}, wall="st-thief", give="it-hammer",
+     outf="fl-abyss", door="st_door_c", oxyd="a",
+     endp={goal={"st_nil", "fl-stwood", "it_nil"}, wall="st-thief", give="it_hammer",
            alg="block:st-plain_cracked"}},
 [4]={box="st-brownie", wall="st-bluegray", inf="fl-white",
-     outf="fl-sahara", door="st-door_a", oxyd="c",
-     endp={goal="st-none", wall={"st-none", "fl-bluegray"}, alg="outside"}},
+     outf="fl-sahara", door="st_door_a", oxyd="c",
+     endp={goal="st_nil", wall={"st_nil", "fl-bluegray"}, alg="outside"}},
 [5]={box="st-wood", wall="st-bluegray", inf="fl-white",
-     outf="fl-space", door="st-door_c", oxyd="c",
-     endp={goal={"st-none", "fl-stwood", "it-none"}, wall={"st-bluegray_hole"}, alg="outside:3"}},
+     outf="fl-space", door="st_door_c", oxyd="c",
+     endp={goal={"st_nil", "fl-stwood", "it_nil"}, wall={"st-bluegray_hole"}, alg="outside:3"}},
 [6]={box="st-greenbrown_move", wall="st-bluegray", inf="fl-white",
-     outf="fl-space", door="st-door_b", oxyd="c",
-     endp={goal="st-greenbrown_hole", wall="st-thief", give="it-sword",
-           alg="block:st-knight"}},
+     outf="fl-space", door="st_door_b", oxyd="c",
+     endp={goal="st-greenbrown_hole", wall="st-thief", give="it_sword",
+           alg="block:st_knight"}},
 [7]={box="st-wood", wall="st-bluegray", inf="fl-white",
-     outf="fl-space", door="st-door_c", oxyd="c",
-     endp={goal={"st-none", "fl-stwood", "it-none"}, alg="fourswitch"}},
+     outf="fl-space", door="st_door_c", oxyd="c",
+     endp={goal={"st_nil", "fl-stwood", "it_nil"}, alg="fourswitch"}},
 
-[8]={box="st-rock3_move", wall="st-blue-sand", inf="fl-light",
-     outf="fl-rough-blue", door="st-door_b", oxyd="d",
-     endp={goal="st-rock3_break", give="it-hammer", alg="ralf"}},
-[9]={box="st-block", wall="st-blue-sand", inf="fl-light",
-     outf="fl-rough-blue", door="st-blocker", oxyd="d",
-     endp={goal="st-none", alg="circle"}},
-[10]={box="st-shogun", wall="st-blue-sand", inf="fl-rough",
-      outf="fl-space", door="st-door_a", oxyd="b", goal="it-shogun-s",
-      endp={goal="st-none", alg="magnets"}},
-[11]={box="st-marble_move", wall="st-blue-sand", inf="fl-rough",
-      outf="fl-abyss", door="st-door_b", oxyd="b",
+[8]={box="st-rock3_move", wall="st_bluesand", inf="fl-light",
+     outf="fl-rough-blue", door="st_door_b", oxyd="d",
+     endp={goal="st-rock3_break", give="it_hammer", alg="ralf"}},
+[9]={box="st-block", wall="st_bluesand", inf="fl-light",
+     outf="fl-rough-blue", door="st_blocker", oxyd="d",
+     endp={goal="st_nil", alg="circle"}},
+[10]={box="st_shogun", wall="st_bluesand", inf="fl-rough",
+      outf="fl-space", door="st_door_a", oxyd="b", goal="it_shogun_s",
+      endp={goal="st_nil", alg="magnets"}},
+[11]={box="st-marble_move", wall="st_bluesand", inf="fl-rough",
+      outf="fl-abyss", door="st_door_b", oxyd="b",
       endp={goal="st-marble", alg="vortex"}},
-[12]={box="st-shogun", wall="st-blue-sand", inf="fl-rough",
-      outf="fl-space", door="st-door_a", oxyd="b", goal="it-shogun-s",
-      endp={goal="st-none", give="it-hammer", alg="block:st-stone_break"}},
-[13]={box="st-block", wall="st-blue-sand", inf="fl-rough",
-      outf="fl-leaves", door="st-blocker", oxyd="b",
-      endp={goal={"fl-swamp", "it-none"}, alg="ralf"}},
+[12]={box="st_shogun", wall="st_bluesand", inf="fl-rough",
+      outf="fl-space", door="st_door_a", oxyd="b", goal="it_shogun_s",
+      endp={goal="st_nil", give="it_hammer", alg="block:st-stone_break"}},
+[13]={box="st-block", wall="st_bluesand", inf="fl-rough",
+      outf="fl-leaves", door="st_blocker", oxyd="b",
+      endp={goal={"fl-swamp", "it_nil"}, alg="ralf"}},
 
 [14]={box="st-brownie", wall={"st-glass", "fl-himalaya", "fl-water"},
-      inf="fl-himalaya", outf="fl-water", door="st-door_a", oxyd="a",
-      endp={goal="st-pull", alg="magnets"}},
+      inf="fl-himalaya", outf="fl-water", door="st_door_a", oxyd="a",
+      endp={goal="st_pull", alg="magnets"}},
 [15]={box="st-brownie", wall={"st-glass", "fl-himalaya", "fl-water"},
-      inf="fl-himalaya", outf="fl-water", door="st-door_a", oxyd="a",
-      endp={goal="st-none", alg="fourswitch"}},
-[16]={box="st-shogun", wall={"st-glass", "fl-rough-red", "fl-abyss"},
-      inf="fl-rough-red", outf="fl-abyss", door="st-door_b", oxyd="c",
-      goal="it-shogun-s",
+      inf="fl-himalaya", outf="fl-water", door="st_door_a", oxyd="a",
+      endp={goal="st_nil", alg="fourswitch"}},
+[16]={box="st_shogun", wall={"st-glass", "fl-rough-red", "fl-abyss"},
+      inf="fl-rough-red", outf="fl-abyss", door="st_door_b", oxyd="c",
+      goal="it_shogun_s",
       endp={alg="circle"}},
 [17]={box="st-brownie", wall={"st-glass", "fl-rough-red", "fl-sahara"},
-      inf="fl-rough-red", outf="fl-sahara", door="st-door_a", oxyd="c",
+      inf="fl-rough-red", outf="fl-sahara", door="st_door_a", oxyd="c",
       endp={goal="st-grate2", wall="st-grate2", alg="outside"}},
 [18]={box="st-greenbrown_move", wall={"st-glass", "fl-wood", "fl-water"},
-      inf="fl-wood", outf="fl-water", door="st-door_b", oxyd="c",
+      inf="fl-wood", outf="fl-water", door="st_door_b", oxyd="c",
       endp={goal="st-greenbrown_hole", alg="ralf"}},
 [19]={box="st-block", wall={"st-glass", "fl-wood", "fl-abyss"},
-      inf="fl-wood", outf="fl-abyss", door="st-blocker", oxyd="d",
-      endp={goal={"fl-abyss", "it-none"}, alg="vortex"}},
+      inf="fl-wood", outf="fl-abyss", door="st_blocker", oxyd="d",
+      endp={goal={"fl-abyss", "it_nil"}, alg="vortex"}},
 [20]={box="st-wood-growing", wall={"st-glass", "fl-wood", "fl-abyss"},
-      inf="fl-wood", outf="fl-abyss", door="st-door_c", oxyd="a",
-      endp={goal={"fl-swamp", "it-none"}, alg="magnets"}},
+      inf="fl-wood", outf="fl-abyss", door="st_door_c", oxyd="a",
+      endp={goal={"fl-swamp", "it_nil"}, alg="magnets"}},
 [21]={box="st-wood", wall={"st-glass", "fl-wood", "fl-sahara"},
-      inf="fl-wood", outf="fl-sahara", door="st-door_c", oxyd="c",
-      endp={goal={"fl-swamp", "it-none"}, give="ac-bug", alg="block:st-bug"}},
-[22]={box="st-shogun", wall={"st-glass", "fl-wood", "fl-leaves"}, inf="fl-wood",
-      outf="fl-leaves", door="st-door_a", oxyd="b", goal="it-shogun-s",
-      endp={goal="st-none", give="it-sword", alg="block:st-knight"}},
+      inf="fl-wood", outf="fl-sahara", door="st_door_c", oxyd="c",
+      endp={goal={"fl-swamp", "it_nil"}, give="ac-bug", alg="block:st-bug"}},
+[22]={box="st_shogun", wall={"st-glass", "fl-wood", "fl-leaves"}, inf="fl-wood",
+      outf="fl-leaves", door="st_door_a", oxyd="b", goal="it_shogun_s",
+      endp={goal="st_nil", give="it_sword", alg="block:st_knight"}},
 [23]={box="st-block", wall={"st-glass", "fl-wood", "fl-abyss"},
-      inf="fl-wood", outf="fl-abyss", door="st-blocker", oxyd="d",
-      endp={goal={"st-none", "it-none"}, alg="allcrack:1"}},
+      inf="fl-wood", outf="fl-abyss", door="st_blocker", oxyd="d",
+      endp={goal={"st_nil", "it_nil"}, alg="allcrack:1"}},
 [24]={box="st-brownie", wall={"st-glass", "fl-wood", "fl-sahara"},
-      inf="fl-wood", outf="fl-sahara", door="st-door_a", oxyd="c",
-      endp={goal="st-none", give="ac-bug", alg="block:st-bug"}},
+      inf="fl-wood", outf="fl-sahara", door="st_door_a", oxyd="c",
+      endp={goal="st_nil", give="ac-bug", alg="block:st-bug"}},
 [25]={box="st-brownie", wall={"st-glass", "fl-wood", "fl-leaves", "it-cherry"},
-      inf="fl-wood", outf="fl-leaves", door="st-door_a", oxyd="a",
+      inf="fl-wood", outf="fl-leaves", door="st_door_a", oxyd="a",
       endp={goal={"st-glass", "fl-wood", "fl-leaves", "it-cherry"},
             give="it-cherry", alg="outside"}},
 
 [26]={box="st-brownie", wall="st-likeoxydc-open", inf="fl-acblack",
-      outf="fl-water", door="st-door_a", oxyd="c",
+      outf="fl-water", door="st_door_a", oxyd="c",
       endp={goal="st-grate1", alg="ralf"}},
 [27]={box="st-greenbrown_move", wall="st-likeoxydc-open", inf="fl-acblack",
-      outf="fl-water", door="st-door_b", oxyd="c",
+      outf="fl-water", door="st_door_b", oxyd="c",
       endp={goal="st-greenbrown_hole", alg="hide"}},
 [28]={box="st-wood-growing", wall="st-likeoxydc-open", inf="fl-tigris",
-      outf="fl-sahara", door="st-door_c", oxyd="a",
-      endp={goal={"fl-swamp", "it-none"}, alg="fourswitch"}},
+      outf="fl-sahara", door="st_door_c", oxyd="a",
+      endp={goal={"fl-swamp", "it_nil"}, alg="fourswitch"}},
 [29]={box="st-brownie", wall="st-likeoxydc-open", inf="fl-tigris",
-      outf="fl-leaves", door="st-door_a", oxyd="a",
-      endp={goal="st-pull", give="it-sword", alg="block:st-knight"}},
+      outf="fl-leaves", door="st_door_a", oxyd="a",
+      endp={goal="st_pull", give="it_sword", alg="block:st_knight"}},
 [30]={box="st-wood-growing", wall="st-likeoxydc-open", inf="fl-tigris",
-      outf="fl-sahara", door="st-door_c", oxyd="a",
-      endp={goal={"st-none", "fl-stwood", "it-none"}, give="it-hammer", alg="block:st-stone_break"}},
+      outf="fl-sahara", door="st_door_c", oxyd="a",
+      endp={goal={"st_nil", "fl-stwood", "it_nil"}, give="it_hammer", alg="block:st-stone_break"}},
 [31]={box="st-glass_move", wall="st-likeoxydc-open", inf="fl-tigris",
-      outf="fl-space", door="st-door_b", oxyd="a",
+      outf="fl-space", door="st_door_b", oxyd="a",
       endp={wall="st-grate1", give="it-cherry", alg="outside:3"}},
 
 [32]={box="st-block", wall="st-metal", inf="fl-bluegray",
-      outf="fl-space", door="st-blocker", oxyd="d",
-      endp={goal={"fl-abyss", "it-none"}, alg="vortex"}},
-[33]={box="st-shogun", wall="st-metal", inf="fl-bluegray",
-      outf="fl-rough-blue", door="st-door_a", oxyd="d", goal="it-shogun-s",
+      outf="fl-space", door="st_blocker", oxyd="d",
+      endp={goal={"fl-abyss", "it_nil"}, alg="vortex"}},
+[33]={box="st_shogun", wall="st-metal", inf="fl-bluegray",
+      outf="fl-rough-blue", door="st_door_a", oxyd="d", goal="it_shogun_s",
       endp={goal="st-metal_hole", alg="magnets"}},
-[34]={box="st-shogun", wall="st-metal", inf="fl-white",
-      outf="fl-abyss", door="st-door_a", oxyd="b", goal="it-shogun-s",
-      endp={goal="st-none", alg="gradients"}},
+[34]={box="st_shogun", wall="st-metal", inf="fl-white",
+      outf="fl-abyss", door="st_door_a", oxyd="b", goal="it_shogun_s",
+      endp={goal="st_nil", alg="gradients"}},
 [35]={box="st-block", wall="st-metal", inf="fl-white",
-      outf="fl-abyss", door="st-blocker", oxyd="b",
+      outf="fl-abyss", door="st_blocker", oxyd="b",
       endp={box="fl-swamp", alg="ralf"}},
-[36]={box="st-shogun", wall="st-metal", inf="fl-white",
-      outf="fl-abyss", door="st-door_a", oxyd="b", goal="it-shogun-s",
+[36]={box="st_shogun", wall="st-metal", inf="fl-white",
+      outf="fl-abyss", door="st_door_a", oxyd="b", goal="it_shogun_s",
       endp={alg="circle"}},
 
 [37]={box="st-wood-growing", wall="st-rock1", inf="fl-light",
-      outf="fl-leaves", door="st-door_c", oxyd="a",
-      endp={goal={"fl-swamp", "it-none"}, wall="st-grate2", alg="outside"}},
+      outf="fl-leaves", door="st_door_c", oxyd="a",
+      endp={goal={"fl-swamp", "it_nil"}, wall="st-grate2", alg="outside"}},
 [38]={box="st-glass_move", wall="st-rock1", inf="fl-light",
-      outf="fl-abyss", door="st-door_b", oxyd="a",
+      outf="fl-abyss", door="st_door_b", oxyd="a",
       endp={give="it-cherry", alg="ralf"}},
 [39]={box="st-brownie", wall="st-rock1", inf="fl-light",
-      outf="fl-abyss", door="st-door_a", oxyd="a",
+      outf="fl-abyss", door="st_door_a", oxyd="a",
       endp={goal="st-grate2", alg="fourswitch"}},
 [40]={box="st-glass_move", wall="st-rock1", inf="fl-light",
-      outf="fl-abyss", door="st-door_b", oxyd="a",
-      endp={goal="st-glass1_hole", give="it-sword", alg="block:st-knight"}},
+      outf="fl-abyss", door="st_door_b", oxyd="a",
+      endp={goal="st-glass1_hole", give="it_sword", alg="block:st_knight"}},
 [41]={box="st-brownie", wall="st-rock1", inf="fl-rough",
-      outf="fl-space", door="st-door_a", oxyd="c",
-      endp={goal={"st-none", "it-none", "fl-hay"}, wall="st-rock1_hole",
+      outf="fl-space", door="st_door_a", oxyd="c",
+      endp={goal={"st_nil", "it_nil", "fl-hay"}, wall="st-rock1_hole",
             alg="outside:3"}},
 [42]={box="st-greenbrown_move", wall="st-rock1", inf="fl-rough",
-      outf="fl-sahara", door="st-door_b", oxyd="c",
+      outf="fl-sahara", door="st_door_b", oxyd="c",
       endp={goal="st-greenbrown", alg="vortex"}},
 
 [43]={box="st-brownie", wall="st-rock3", inf="fl-leaves",
-      outf="fl-space", door="st-door_a", oxyd="a",
+      outf="fl-space", door="st_door_a", oxyd="a",
       endp={goal="st-rock3_hole", wall="st-rock3_hole", alg="outside:3"}},
 [44]={box="st-marble_move", wall="st-rock3", inf="fl-leaves",
-      outf="fl-rough-blue", door="st-door_b", oxyd="b",
+      outf="fl-rough-blue", door="st_door_b", oxyd="b",
       endp={"st-marble_hole", alg="ralf"}},
 [45]={box="st-wood-growing", wall="st-rock3", inf="fl-leaves",
-      outf="fl-leaves", door="st-door_c", oxyd="a",
-      endp={goal={"fl-swamp", "it-none"}, give="ac-bug", alg="block:st-bug"}},
-[46]={box="st-shogun", wall="st-rock3", inf="fl-leaves",
-      outf="fl-abyss", door="st-door_a", oxyd="d", goal="it-shogun-s",
-      endp={goal="st-none", give="it-hammer", alg="block:st-plain_cracked"}},
+      outf="fl-leaves", door="st_door_c", oxyd="a",
+      endp={goal={"fl-swamp", "it_nil"}, give="ac-bug", alg="block:st-bug"}},
+[46]={box="st_shogun", wall="st-rock3", inf="fl-leaves",
+      outf="fl-abyss", door="st_door_a", oxyd="d", goal="it_shogun_s",
+      endp={goal="st_nil", give="it_hammer", alg="block:st-plain_cracked"}},
 [47]={box="st-greenbrown_move", wall="st-rock3", inf="fl-leaves",
-      outf="fl-sahara", door="st-door_b", oxyd="c",
+      outf="fl-sahara", door="st_door_b", oxyd="c",
       endp={goal="st-greenbrown_hole", give="ac-bug", alg="block:st-bug"}},
 [48]={box="st-glass_move", wall="st-rock3", inf="fl-leaves",
-      outf="fl-leaves", door="st-door_b", oxyd="a",
+      outf="fl-leaves", door="st_door_b", oxyd="a",
       endp={give="it-cherry", alg="ralf"}},
 [49]={box="st-marble_move", wall="st-rock3", inf="fl-leaves",
-      outf="fl-rough-blue", door="st-door_b", oxyd="b",
-      endp={goal="st-marble_hole", give="it-hammer", alg="block:st-plain_cracked"}},
-[50]={box="st-shogun", wall="st-rock3", inf="fl-leaves",
-      outf="fl-leaves", door="st-door_c", oxyd="a", goal="it-shogun-s",
+      outf="fl-rough-blue", door="st_door_b", oxyd="b",
+      endp={goal="st-marble_hole", give="it_hammer", alg="block:st-plain_cracked"}},
+[50]={box="st_shogun", wall="st-rock3", inf="fl-leaves",
+      outf="fl-leaves", door="st_door_c", oxyd="a", goal="it_shogun_s",
       endp={alg="circle"}},
 [51]={box="st-wood-growing", wall="st-rock3", inf="fl-leaves",
-      outf="fl-leaves", door="st-door_c", oxyd="a",
-      endp={goal={"fl-swamp", "it-none"},
+      outf="fl-leaves", door="st_door_c", oxyd="a",
+      endp={goal={"fl-swamp", "it_nil"},
             wall={"st-plain_breaking", "fl-sahara"}, alg="outside"}},
 [52]={box="st-wood", wall="st-rock3", inf="fl-leaves",
-      outf="fl-water", door="st-door_c", oxyd="c",
-      endp={goal={"st-grate1", "it-none"}, alg="ralf"}},
-[53]={box="st-shogun", wall="st-rock3", inf="fl-leaves",
-      outf="fl-space", door="st-door_b", oxyd="d", goal="it-shogun-s",
-      endp={goal={"st-none", "fl-swamp"}, alg="fourswitch"}},
+      outf="fl-water", door="st_door_c", oxyd="c",
+      endp={goal={"st-grate1", "it_nil"}, alg="ralf"}},
+[53]={box="st_shogun", wall="st-rock3", inf="fl-leaves",
+      outf="fl-space", door="st_door_b", oxyd="d", goal="it_shogun_s",
+      endp={goal={"st_nil", "fl-swamp"}, alg="fourswitch"}},
 
-[54]={box="st-shogun", wall="st-rock4", inf="fl-himalaya",
-      outf="fl-water", door="st-door_a", oxyd="b", goal="it-shogun-s",
+[54]={box="st_shogun", wall="st-rock4", inf="fl-himalaya",
+      outf="fl-water", door="st_door_a", oxyd="b", goal="it_shogun_s",
       endp={alg="vortex"}},
 [55]={box="st-marble_move", wall="st-rock4", inf="fl-himalaya",
-      outf="fl-abyss", door="st-door_b", oxyd="b",
+      outf="fl-abyss", door="st_door_b", oxyd="b",
       endp={goal="st-marble_hole", alg="ralf"}},
-[56]={box="st-shogun", wall="st-rock4", inf="fl-himalaya",
-      outf="fl-abyss", door="st-door_b", oxyd="b", goal="it-shogun-s",
+[56]={box="st_shogun", wall="st-rock4", inf="fl-himalaya",
+      outf="fl-abyss", door="st_door_b", oxyd="b", goal="it_shogun_s",
       endp={alg="circle"}},
 [57]={box="st-block", wall="st-rock4", inf="fl-rough-red",
-      outf="fl-rough-blue", door="st-blocker", oxyd="d",
+      outf="fl-rough-blue", door="st_blocker", oxyd="d",
       endp={goal="st-explosion", wall="st-explosion", alg="outside"}},
 [58]={box="st-rock3_move", wall="st-rock4", inf="fl-rough-red",
-      outf="fl-space", door="st-door_b", oxyd="d",
-      endp={goal="st-plain_cracked", give="it-hammer", alg="block:st-plain_cracked"}},
-[59]={box="st-shogun", wall="st-rock4", inf="fl-rough-red",
-      outf="fl-space", door="st-door_a", oxyd="d", goal="it-shogun-s",
-      endp={goal="st-none", alg="ralf"}},
+      outf="fl-space", door="st_door_b", oxyd="d",
+      endp={goal="st-plain_cracked", give="it_hammer", alg="block:st-plain_cracked"}},
+[59]={box="st_shogun", wall="st-rock4", inf="fl-rough-red",
+      outf="fl-space", door="st_door_a", oxyd="d", goal="it_shogun_s",
+      endp={goal="st_nil", alg="ralf"}},
 [60]={box="st-rock3_move", wall="st-rock4", inf="fl-rough-red",
-      outf="fl-space", door="st-door_b", oxyd="d",
+      outf="fl-space", door="st_door_b", oxyd="d",
       endp={goal="st-bug", give="ac-bug", alg="block:st-bug"}},
 
 [61]={box="st-greenbrown_move", wall="st-rock5", inf="fl-samba",
-      outf="fl-leaves", door="st-door_b", oxyd="c",
+      outf="fl-leaves", door="st_door_b", oxyd="c",
       endp={goal="st-greenbrown_hole", alg="fourswitch"}},
 [62]={box="st-block", wall="st-rock5", inf="fl-samba",
-      outf="fl-water", door="st-blocker", oxyd="b",
-      endp={goal={"fl-water", "it-none"}, alg="vortex"}},
+      outf="fl-water", door="st_blocker", oxyd="b",
+      endp={goal={"fl-water", "it_nil"}, alg="vortex"}},
 [63]={box="st-rock3_move", wall="st-rock5", inf="fl-samba",
-      outf="fl-leaves", door="st-door_b", oxyd="d",
-      endp={goal="st-plain_cracked", give="it-hammer",
+      outf="fl-leaves", door="st_door_b", oxyd="d",
+      endp={goal="st-plain_cracked", give="it_hammer",
             alg="block:st-plain_cracked"}},
 [64]={box="st-marble_move", wall="st-rock5", inf="fl-samba",
-      outf="fl-water", door="st-door_b", oxyd="b",
+      outf="fl-water", door="st_door_b", oxyd="b",
       endp={goal="st-marble_hole", alg="gradients"}},
 [65]={box="st-wood-growing", wall="st-rock5", inf="fl-samba",
-      outf="fl-space", door="st-door_c", oxyd="a",
-      endp={goal={"st-none", "fl-stwood", "it-none"}, alg="ralf"}},
+      outf="fl-space", door="st_door_c", oxyd="a",
+      endp={goal={"st_nil", "fl-stwood", "it_nil"}, alg="ralf"}},
 [66]={box="st-greenbrown_move", wall="st-rock5", inf="fl-samba",
-      outf="fl-leaves", door="st-door_b", oxyd="c",
+      outf="fl-leaves", door="st_door_b", oxyd="c",
       endp={goal="st-greenbrown", alg="vortex"}},
 [67]={box="st-block", wall="st-rock5", inf="fl-samba",
-      outf="fl-water", door="st-blocker", oxyd="b",
+      outf="fl-water", door="st_blocker", oxyd="b",
       endp={alg="circle"}},
 [68]={box="st-brownie", wall="st-rock5", inf="fl-samba",
-      outf="fl-space", door="st-door_a", oxyd="a",
-      endp={goal="st-none", alg="allcrack:1"}},
+      outf="fl-space", door="st_door_a", oxyd="a",
+      endp={goal="st_nil", alg="allcrack:1"}},
 [69]={box="st-block", wall="st-rock5", inf="fl-samba",
-      outf="fl-space", door="st-blocker", oxyd="d",
-      endp={goal={"fl-swamp", "it-none"}, alg="ralf"}},
+      outf="fl-space", door="st_blocker", oxyd="d",
+      endp={goal={"fl-swamp", "it_nil"}, alg="ralf"}},
 
 [70]={box="st-rock3_move", wall="st-rock6", inf="fl-acblack",
-      outf="fl-space", door="st-door_b", oxyd="d",
+      outf="fl-space", door="st_door_b", oxyd="d",
       endp={goal="st-plain_breaking", alg="ralf"}},
-[71]={box="st-shogun", wall="st-rock6", inf="fl-acblack",
-      outf="fl-leaves", door="st-door_a", oxyd="d", goal="it-shogun-s",
+[71]={box="st_shogun", wall="st-rock6", inf="fl-acblack",
+      outf="fl-leaves", door="st_door_a", oxyd="d", goal="it_shogun_s",
       endp={goal="st-explosion", wall="st-explosion", alg="outside"}},
 [72]={box="st-block", wall="st-rock6", inf="fl-acblack",
-      outf="fl-leaves", door="st-blocker", oxyd="d",
-      endp={goal={"fl-swamp", "it-none"}, alg="magnets"}},
-[73]={box="st-shogun", wall="st-rock6", inf="fl-acblack",
-      outf="fl-leaves", door="st-door_a", oxyd="d", goal="it-shogun-s",
-      endp={goal="st-knight", give="it-sword", alg="block:st-knight"}},
-[74]={box="st-shogun", wall="st-rock6", inf="fl-tigris",
-      outf="fl-rough-blue", door="st-blocker", oxyd="b", goal="it-shogun-s",
-      endp={goal="st-none", alg="fourswitch"}},
-[75]={box="st-shogun", wall="st-rock6", inf="fl-tigris",
-      outf="fl-water", door="st-door_a", oxyd="b", goal="it-shogun-s",
+      outf="fl-leaves", door="st_blocker", oxyd="d",
+      endp={goal={"fl-swamp", "it_nil"}, alg="magnets"}},
+[73]={box="st_shogun", wall="st-rock6", inf="fl-acblack",
+      outf="fl-leaves", door="st_door_a", oxyd="d", goal="it_shogun_s",
+      endp={goal="st_knight", give="it_sword", alg="block:st_knight"}},
+[74]={box="st_shogun", wall="st-rock6", inf="fl-tigris",
+      outf="fl-rough-blue", door="st_blocker", oxyd="b", goal="it_shogun_s",
+      endp={goal="st_nil", alg="fourswitch"}},
+[75]={box="st_shogun", wall="st-rock6", inf="fl-tigris",
+      outf="fl-water", door="st_door_a", oxyd="b", goal="it_shogun_s",
       endp={goal="st-explosion", alg="gradients"}},
 
 -- New designs
 [76]={box="st-glass1_move", wall="st-glass2", inf="fl-lightgray",
-      outf="fl-abyss", door="st-door_a", oxyd="b",
-      endp={goal="st-pull", alg="hide"}},
-[77]={box="st-rock3_move", wall="st-brick", inf="fl-darkgray",
-      outf="fl-leavesb", door="st-door", oxyd="a",
-      endp={goal="st-plain_cracked", give="it-hammer", alg="knock"}},
+      outf="fl-abyss", door="st_door_a", oxyd="b",
+      endp={goal="st_pull", alg="hide"}},
+[77]={box="st-rock3_move", wall="st_brick", inf="fl-darkgray",
+      outf="fl-leavesb", door="st_door_d", oxyd="a",
+      endp={goal="st-plain_cracked", give="it_hammer", alg="knock"}},
 [78]={box="st-rock3_move", wall="st-bumps", inf="fl-dunes",
-      outf="fl-sand", door="st-door_a", oxyd="a",
-      endp={goal="st-plain_break", give="it-hammer", alg="block:st-plain_cracked"}},
+      outf="fl-sand", door="st_door_a", oxyd="a",
+      endp={goal="st-plain_break", give="it_hammer", alg="block:st-plain_cracked"}},
 [79]={box="st-flrock", wall="st-camouflage", inf="fl-gravel",
       outf={"fl-gravel", "st-disco-medium"}, door="st-camouflage", oxyd="b",
-      endp={goal="st-camouflage", open_door={"st-none", "fl-leavesb"}, alg="vortex"}},
+      endp={goal="st-camouflage", open_door={"st_nil", "fl-leavesb"}, alg="vortex"}},
 [80]={box="st-flhay", wall="st-camouflage", inf="fl-leaves",
-      outf={"fl-water:5", "fl-swamp", "al:random"}, door="st-door_a", oxyd="d",
-      endp={goal={"fl-swamp", "it-none"},
-            wall={"st-camouflage_hole", "st-none:2", "fl-swamp", "al:random"},
-            give="it-umbrella", alg="outside:1"}},
+      outf={"fl-water:5", "fl-swamp", "al:random"}, door="st_door_a", oxyd="d",
+      endp={goal={"fl-swamp", "it_nil"},
+            wall={"st-camouflage_hole", "st_nil:2", "fl-swamp", "al:random"},
+            give="it_umbrella", alg="outside:1"}},
 [81]={box="st-glass2_move", wall={"st-glass1", "fl-lightgray"}, inf="fl-black",
       outf="fl-white", door="st-black4", oxyd="c", white=true,
       endp={goal="st-yinyang2", open_door="st-white4", alg="ralf"}},
 [82]={box="st-wood", wall={"st-glass1", "fl-water"}, inf="fl-sand",
-      outf="fl-water", door="st-door_a", oxyd="c",
-      endp={goal={"st-none", "fl-stwood", "it-none"}, alg="fourswitch"}},
+      outf="fl-water", door="st_door_a", oxyd="c",
+      endp={goal={"st_nil", "fl-stwood", "it_nil"}, alg="fourswitch"}},
 [83]={box="st-camouflage_move", wall="st-glass2", inf="fl-lightgray",
       outf={"fl-leavesb", "st-disco-medium"}, door="st-glass2", oxyd="b",
       endp={goal="st-camouflage_hole", open_door="st-glass1_hole",
-            outf="st-none", alg="ralf"}},
+            outf="st_nil", alg="ralf"}},
 [84]={box="st-flrock", wall="st-glass2", inf="fl-sand",
-      outf={"fl-water", "st-disco-medium"}, door="st-door", oxyd="b",
-      endp={goal={"fl-swamp", "it-none"}, alg="knock"}},
-[85]={box="st-flrock", wall="st-brick", inf="fl-sand",
-      outf={"fl-water", "st-disco-medium"}, door="st-door", oxyd="a",
+      outf={"fl-water", "st-disco-medium"}, door="st_door_d", oxyd="b",
+      endp={goal={"fl-swamp", "it_nil"}, alg="knock"}},
+[85]={box="st-flrock", wall="st_brick", inf="fl-sand",
+      outf={"fl-water", "st-disco-medium"}, door="st_door_d", oxyd="a",
       endp={goal="st-black4", alg="ralf"}},
 [86]={box="st-glass1_move", wall={"st-glass3", "fl-abyss_fake"}, inf="fl-red",
-      outf="fl-space", door={"st-none", "fire"}, oxyd="a",
+      outf="fl-space", door={"st_nil", "fire"}, oxyd="a",
       endp={goal="st-explosion", open_door="nofire", alg="ralf"}},
 [87]={box="st-rock3_move", wall={"st-glass3", "fl-rough-blue"}, inf="fl-plank",
       outf="fl-water", door="st-glass3", oxyd="a",
       endp={goal="st-rock7", open_door="st-glass1_hole", alg="vortex"}},
 [88]={box="st-glass1_move", wall="st-likeoxyda", inf="fl-black",
-      outf="fl-abyss", door="st-door_a", oxyd="a",
+      outf="fl-abyss", door="st_door_a", oxyd="a",
       endp={goal="st-glass1_hole", alg="hide"}},
 [89]={box="st-greenbrown_move", wall="st-likeoxyda-open", inf="fl-brick",
-      outf={"fl-mortar", "st-disco-medium"}, door="st-door", oxyd="a",
+      outf={"fl-mortar", "st-disco-medium"}, door="st_door_d", oxyd="a",
       endp={goal="st-grate2", alg="knock"}},
 [90]={box="st-rock3_move", wall="st-likeoxydb", inf="fl-rough-red",
-      outf="fl-space", door="st-door_a", oxyd="b",
+      outf="fl-space", door="st_door_a", oxyd="b",
       endp={goal="st-plain_breaking", alg="hide"}},
 [91]={box="st-flhay", wall="st-likeoxydb-open", inf="fl-rough-blue",
-      outf={"fl-swamp", "st-disco-light"}, door="st-door_a", oxyd="b",
-      endp={goal="st-break_gray", give="it-hammer", alg="block:st-break_gray"}},
+      outf={"fl-swamp", "st-disco-light"}, door="st_door_a", oxyd="b",
+      endp={goal="st-break_gray", give="it_hammer", alg="block:st-break_gray"}},
 [92]={box="st-glass2_move", wall="st-likeoxydc", inf="fl-sahara",
-      outf={"fl-water", "st-disco-light"}, door="st-door_a", oxyd="c",
+      outf={"fl-water", "st-disco-light"}, door="st_door_a", oxyd="c",
       endp={goal="st-glass1_hole", alg="hide"}},
 [93]={box="st-glass_move", wall="st-likeoxydc-open", inf="fl-red",
       outf={"st-blackballs", "st-whiteballs", "fl-abyss", "al:random"},
-      door="st-door_a", oxyd="c",
+      door="st_door_a", oxyd="c",
       endp={goal="st-black4", alg="fourswitch"}},
 [94]={box="st-glass2_move", wall="st-likeoxydd", inf="fl-concrete",
-      outf="fl-sand", door="st-door_a", oxyd="d",
+      outf="fl-sand", door="st_door_a", oxyd="d",
       endp={goal="st-glass1_hole", alg="hide"}},
 [95]={box="st-flrock", wall="st-likeoxydd-open", inf="fl-marble",
-      outf="fl-water", door="st-door_a", oxyd="b",
-      endp={goal={"fl-swamp", "it-none"}, outf="fl-swamp",
-            give="it-hammer", wall="st-break_gray", alg="outside"}},
+      outf="fl-water", door="st_door_a", oxyd="b",
+      endp={goal={"fl-swamp", "it_nil"}, outf="fl-swamp",
+            give="it_hammer", wall="st-break_gray", alg="outside"}},
 [96]={box="st-flrock", wall="st-marble", inf="fl-marble",
-      outf={"fl-leavesc3", "fl-leavesd3"}, door="st-door", oxyd="a",
-      endp={goal={"st-grate2", "it-none"}, alg="knock"}},
+      outf={"fl-leavesc3", "fl-leavesd3"}, door="st_door_d", oxyd="a",
+      endp={goal={"st-grate2", "it_nil"}, alg="knock"}},
 [97]={box="st-camouflage_move", wall="st-marble", inf="fl-leaves",
-      outf={"fl-leaves", "st-marble"}, door="st-door_a", oxyd="a",
+      outf={"fl-leaves", "st-marble"}, door="st_door_a", oxyd="a",
       endp={goal="st-camouflage_hole", wall="st-marble_hole",
             outf="st-marble_hole", alg="outside"}},
 [98]={box="st-rock1_move", wall="st-redrock", inf="fl-acblack",
       outf={"fl-acblack", "st-redrock"}, door="st-rock6", oxyd="b",
-      endp={goal="st-rock6", open_door="st-none", alg="vortex"}},
+      endp={goal="st-rock6", open_door="st_nil", alg="vortex"}},
 [99]={box="st-glass1_move", wall="st-redrock", inf="fl-mortar",
-      outf="fl-brick", door="st-door_a", oxyd="b",
+      outf="fl-brick", door="st_door_a", oxyd="b",
       endp={goal="st-glass1_hole", wall={"st-glass1_hole", "fl-tigris"}, alg="outside"}},
 [100]={box="st-block", wall="st-redrock", inf="fl-mortar",
-       outf="fl-water", door="st-door", oxyd="b",
-       endp={goal={"fl-swamp", "it-none"}, alg="ralf"}},
+       outf="fl-water", door="st_door_d", oxyd="b",
+       endp={goal={"fl-swamp", "it_nil"}, alg="ralf"}},
 [101]={box="st-glass2_move", wall="st-redrock", inf="fl-leavesb",
-       outf={"fl-leavesc3", "fl-leavesd4"}, door="st-door_a", oxyd="a",
+       outf={"fl-leavesc3", "fl-leavesd4"}, door="st_door_a", oxyd="a",
        endp={goal="st-glass1_hole", alg="hide"}},
 [102]={box="st-camouflage_move", wall="st-rock2", inf="fl-rock",
-       outf={"fl-rock", "st-disco-medium"}, door="st-door_a", oxyd="b",
-       endp={goal={"it-none", "st-disco-light", "fl-leavesb"},
+       outf={"fl-rock", "st-disco-medium"}, door="st_door_a", oxyd="b",
+       endp={goal={"it_nil", "st-disco-light", "fl-leavesb"},
              wall={"st-disco-light", "fl-gray"}, alg="outside:3"}},
 [103]={box="st-glass2_move", wall="st-rock2", inf="fl-stone",
-       outf={"fl-water", "st-disco-medium"}, door="st-door_a", oxyd="b",
-       endp={goal={"st-pull", "it-none", "fl-black"}, alg="fourswitch"}},
+       outf={"fl-water", "st-disco-medium"}, door="st_door_a", oxyd="b",
+       endp={goal={"st_pull", "it_nil", "fl-black"}, alg="fourswitch"}},
 [104]={box="st-wood", wall="st-rock2", inf="fl-lightgray",
-       outf="fl-space", door="st-door", oxyd="b",
-       endp={goal={"st-none", "fl-marble", "it-none"}, alg="knock"}},
+       outf="fl-space", door="st_door_d", oxyd="b",
+       endp={goal={"st_nil", "fl-marble", "it_nil"}, alg="knock"}},
 [105]={box="st-camouflage_move", wall="st-rock7", inf="fl-woven",
-       outf="fl-gravel", door="st-door_a", oxyd="a",
-       endp={goal={"fl-bluegreenx", "it-none", "st-none"}, alg="magnets"}},
+       outf="fl-gravel", door="st_door_a", oxyd="a",
+       endp={goal={"fl-bluegreenx", "it_nil", "st_nil"}, alg="magnets"}},
 [106]={box="st-brownie", wall="st-rock7", inf="fl-black",
-       outf="fl-abyss", door="st-door_a", oxyd="b",
-       endp={goal="st-bug", give={"ac-bug", "it-hammer"}, alg="block:st-plain_cracked"}},
+       outf="fl-abyss", door="st_door_a", oxyd="b",
+       endp={goal="st-bug", give={"ac-bug", "it_hammer"}, alg="block:st-plain_cracked"}},
 [107]={box="st-glass_move", wall="st-rock8", inf="fl-plank",
-       outf={"fl-plank", "st-rock8"}, door="st-door", oxyd="d",
+       outf={"fl-plank", "st-rock8"}, door="st_door_d", oxyd="d",
        endp={goal="st-explosion", alg="knock"}},
 [108]={box="st-glass2_move", wall={"st-rock8", "fl-water"}, inf="fl-leaves",
-       outf="fl-water", door="st-door_a", oxyd="c",
-       endp={goal="st-pull", give="it-hammer", alg="block:st-break_gray"}},
+       outf="fl-water", door="st_door_a", oxyd="c",
+       endp={goal="st_pull", give="it_hammer", alg="block:st-break_gray"}},
 [109]={box="st-marble_move", wall={"st-rock8", "fl-abyss_fake"}, inf="fl-stone",
-       outf="fl-space", door="st-door_a", oxyd="c",
-       endp={goal={"st-none", "it-none", "fl-hay"}, wall={"st-none", "fl-darkgray"},
+       outf="fl-space", door="st_door_a", oxyd="c",
+       endp={goal={"st_nil", "it_nil", "fl-hay"}, wall={"st_nil", "fl-darkgray"},
              alg="outside:3"}},
 [110]={box="st-greenbrown_move", wall="st-rock9", inf="fl-rock",
        outf={"fl-rock", "st-rock9"}, door="st-rock9", oxyd="b",
-       endp={goal="st-rock9", open_door="st-none", alg="vortex"}},
+       endp={goal="st-rock9", open_door="st_nil", alg="vortex"}},
 [111]={box="st-glass_move", wall="st-rock9", inf="fl-sand",
-       outf="fl-water", door="st-door_c", oxyd="c",
+       outf="fl-water", door="st_door_c", oxyd="c",
        endp={goal="st-grate2", alg="ralf"}},
 [112]={box="st-camouflage_move", wall="st-rock9", inf="fl-stone",
-       outf="fl-swamp", door="st-door", oxyd="a",
+       outf="fl-swamp", door="st_door_d", oxyd="a",
        endp={goal="st-camouflage_hole", alg="knock"}},
 [113]={box="st-block", wall="st-rock10", inf="fl-bluegreen",
-       outf="fl-abyss", door="st-door_a", oxyd="a",
-       endp={goal={"st-explosion", "it-none", "fl-bluegreenx"},
-             wall={"st-explosion", "fl-marble"}, give="it-umbrella", alg="outside:1"}},
+       outf="fl-abyss", door="st_door_a", oxyd="a",
+       endp={goal={"st-explosion", "it_nil", "fl-bluegreenx"},
+             wall={"st-explosion", "fl-marble"}, give="it_umbrella", alg="outside:1"}},
 [114]={box="st-wood", wall="st-rock10", inf="fl-sand",
-       outf={"fl-sand", "st-rock10"}, door="st-door_a", oxyd="b",
-       endp={goal={"fl-swamp", "it-none"}, give="it-sword", alg="block:st-knight"}},
+       outf={"fl-sand", "st-rock10"}, door="st_door_a", oxyd="b",
+       endp={goal={"fl-swamp", "it_nil"}, give="it_sword", alg="block:st_knight"}},
 [115]={box="st-glass2_move", wall="st-stone1", inf={"fl-lightgray", "fl-white"},
-       outf={"fl-space", "fl-abyss"}, door="st-door_a", oxyd="a",
-       endp={goal="st-glass1_hole", wall="st-grate1", give="it-umbrella",
+       outf={"fl-space", "fl-abyss"}, door="st_door_a", oxyd="a",
+       endp={goal="st-glass1_hole", wall="st-grate1", give="it_umbrella",
              open_door="st-grate1", alg="block:st-stone1"}},
 [116]={box="st-rock1_move", wall="st-stone1", inf="fl-stwood",
        outf="fl-water", door="st-stone1", oxyd="b",
        endp={goal="st-rock1_hole", open_door="st-grate1", alg="ralf"}},
 [117]={box="st-glass_move", wall="st-stone1", inf="fl-black",
-       outf="st-stone1", door="st-door_a", oxyd="d",
+       outf="st-stone1", door="st_door_a", oxyd="d",
        endp={outf="st-likeoxydd", wall="st-likeoxydd", inf="fl-ice",
-             goal={"st-none", "it-none", "fl-ice"}, alg="hide:1"}},
+             goal={"st_nil", "it_nil", "fl-ice"}, alg="hide:1"}},
 [118]={box="st-glass_move", wall="st-stone2", inf="fl-black",
-       outf="fl-gravel", door="st-door_a", oxyd="b",
+       outf="fl-gravel", door="st_door_a", oxyd="b",
        endp={goal="st-glass", alg="vortex"}},
 [119]={box="st-block", wall="st-stone2", inf="fl-rough-red",
-       outf={"fl-rough-blue", "st-disco-light"}, door="st-door_a", oxyd="d",
-       endp={goal="st-none", alg="allcrack:1"}},
+       outf={"fl-rough-blue", "st-disco-light"}, door="st_door_a", oxyd="d",
+       endp={goal="st_nil", alg="allcrack:1"}},
 [120]={box="st-rock3_move", wall={"st-marble", "st-stone2"}, inf="fl-black",
        outf={"st-marble", "st-stone2"}, oxyd="b",
-       endp={goal="st-plain_cracked", give="it-hammer", open_door="st-none",
+       endp={goal="st-plain_cracked", give="it_hammer", open_door="st_nil",
              alg="ralf"}},
 [121]={box="st-wood", wall="st-panel", inf="fl-wood",
-       outf={"fl-leavesd3", "fl-leavesd2"}, door="st-door_a", oxyd="a",
-       endp={goal={"it-none", "fl-swamp"}, open_door="fl-swamp", alg="block:st-wood"}},
+       outf={"fl-leavesd3", "fl-leavesd2"}, door="st_door_a", oxyd="a",
+       endp={goal={"it_nil", "fl-swamp"}, open_door="fl-swamp", alg="block:st-wood"}},
 [122]={box="st-block", wall="st-panel", inf="fl-leaves",
-       outf="fl-leavesb", door="st-door_a", oxyd="a",
-       endp={goal={"it-none", "fl-swamp"}, alg="fourswitch"}},
+       outf="fl-leavesb", door="st_door_a", oxyd="a",
+       endp={goal={"it_nil", "fl-swamp"}, alg="fourswitch"}},
 [123]={box="st-glass1_move", wall="st-woven", inf="fl-dunes",
        outf="fl-bluegreen", door="st-glass1", oxyd="a",
-       endp={goal="st-pull", open_door="st-pull", alg="ralf"}},
+       endp={goal="st_pull", open_door="st_pull", alg="ralf"}},
 [124]={box="st-marble_move", wall="st-woven", inf="fl-hay",
-       outf="fl-water", door="st-door_a", oxyd="a",
-       endp={goal="st-marble_hole", wall={"st-none", "fl-woven"},
-       give="it-umbrella", alg="outside:1"}},
+       outf="fl-water", door="st_door_a", oxyd="a",
+       endp={goal="st-marble_hole", wall={"st_nil", "fl-woven"},
+       give="it_umbrella", alg="outside:1"}},
 [125]={box="st-rock3_move", wall="st-yellow", inf="fl-leavesb",
-       outf="fl-leaves", door="st-door_c", oxyd="a",
+       outf="fl-leaves", door="st_door_c", oxyd="a",
        endp={goal="st-grate2", alg="ralf"}},
 [126]={box="st-glass_move", wall="st-yellow", inf="fl-rough-blue",
-       outf="fl-abyss", door="st-door_a", oxyd="d",
-       endp={goal={"st-none", "it-none", "fl-ice"}, give="ac-bug", alg="block:st-bug"}},
+       outf="fl-abyss", door="st_door_a", oxyd="d",
+       endp={goal={"st_nil", "it_nil", "fl-ice"}, give="ac-bug", alg="block:st-bug"}},
 [127]={box="st-block", wall="st-yellow", inf="fl-lightgray",
-       outf="fl-space", door="st-door_a", oxyd="d",
-       endp={goal={"fl-abyss", "it-none"}, alg="vortex"}},
+       outf="fl-space", door="st_door_a", oxyd="d",
+       endp={goal={"fl-abyss", "it_nil"}, alg="vortex"}},
 [128]={box="st-glass1_move", wall="st-rock7", inf="fl-himalaya",
-       outf={"fl-himalaya", "st-rock8", "st-rock7"}, door="st-door_a", oxyd="d",
+       outf={"fl-himalaya", "st-rock8", "st-rock7"}, door="st_door_a", oxyd="d",
        endp={goal="st-explosion", alg="magnets"}},
 [129]={box="st-camouflage_move", wall={"st-rock9", "fl-leavesb"}, inf="fl-dunes",
        outf={"fl-leavese1", "fl-leavese2", "fl-leavese3", "fl-leavese4", "al:waves"},
-       door={"fl-bridge_x", "fl-bridge_y", "al:random", "st-none"}, oxyd="d",
+       door={"fl-bridge_x", "fl-bridge_y", "al:random", "st_nil"}, oxyd="d",
        endp={goal="st-camouflage_hole", alg="ralf"}},
 [130]={box="st-glass1_move", wall="st-redrock", inf="fl-darkgray",
        outf={"fl-black", "st-redrock", "st-invisible:3", "al:waves"},
-       door="st-door_a", oxyd="a",
-       endp={goal="st-none", alg="gradients"}},
+       door="st_door_a", oxyd="a",
+       endp={goal="st_nil", alg="gradients"}},
 [131]={box="st-glass1_move", wall={"st-yellow", "st-yellow", "st-redrock", "st-redrock", "al:waves"},
        inf="fl-wood",
        outf={"fl-wood", "st-yellow", "st-yellow", "st-redrock", "st-redrock", "al:waves"},
-       door="st-door_a", oxyd="d",
-       endp={goal={"st-glass1_hole"}, give="it-hammer", alg="block:st-plain_break"}},
+       door="st_door_a", oxyd="d",
+       endp={goal={"st-glass1_hole"}, give="it_hammer", alg="block:st-plain_break"}},
 [132]={box="st-wood", wall="st-camouflage", inf="fl-leavesb", oxyd="d",
        outf={"fl-water:3", "fl-swamp","al:random"}, door={"fl-water", "st-glass1_hole"},
-       endp={goal={"fl-swamp", "it-none"}, inf={"fl-leavesb", "fl-swamp", "al:random"}, 
+       endp={goal={"fl-swamp", "it_nil"}, inf={"fl-leavesb", "fl-swamp", "al:random"}, 
              open_door="fl-swamp", alg="ralf"}},
 [133]={box="st-glass2_move", wall="st-metal", inf="fl-metal",
-       outf={"fl-space", "fl-abyss:3", "al:random"}, door="st-door_a", oxyd="d",
-       endp={goal="st-glass1_hole", give="it-sword", alg="block:st-knight"}},
+       outf={"fl-space", "fl-abyss:3", "al:random"}, door="st_door_a", oxyd="d",
+       endp={goal="st-glass1_hole", give="it_sword", alg="block:st_knight"}},
 [134]={box="st-marble_move", wall="st-metal", inf="fl-white",
        outf={"fl-abyss", "st-grate1", "st-invisible:3", "al:waves"},
-       door="st-door_a", oxyd="d",
+       door="st_door_a", oxyd="d",
        endp={goal="st-marble_hole", alg="fourswitch"}},
 [135]={box="st-glass_move", wall="st-likeoxydc", inf="fl-white",
        outf={"fl-white", "st-rock1", "st-invisible:3", "al:random"},
-       door="st-door_a", oxyd="c",
-       endp={goal={"st-glass1_hole", "it-none"}, alg="hide"}},
-[136]={box="st-block", wall={"st-oneway_white-n", "st-oneway_white-s", "st-oneway_white-e", "st-oneway_white-w", "al:random"},
+       door="st_door_a", oxyd="c",
+       endp={goal={"st-glass1_hole", "it_nil"}, alg="hide"}},
+[136]={box="st-block", wall={"st_oneway_white_n", "st_oneway_white_s", "st_oneway_white_e", "st_oneway_white_w", "al:random"},
        inf="fl-rough", oxyd="b",
-       outf={"st-oneway_white-n", "st-oneway_white-s", "st-oneway_white-e", "st-oneway_white-w", "al:random"},
+       outf={"st_oneway_white_n", "st_oneway_white_s", "st_oneway_white_e", "st_oneway_white_w", "al:random"},
        endp={alg="circle"}},
-[137]={box={"st-mirror-p-m", "st-mirror-p/m", "st-mirror-p\\m", "st-mirror-p|m", "al:random"},
+[137]={box={"st_mirror_slab_nm", "st_mirror_slab_em", "st_mirror_slab_sm", "st_mirror_slab_wm", "al:random"},
        wall={"st-glass3", "fl-abyss"}, inf="fl-metal", oxyd="b",
-       outf={"st-mirror-p-", "st-mirror-p/", "st-mirror-p|", "st-mirror-p\\", "al:random"},
+       outf={"st_mirror_slab_n", "st_mirror_slab_e", "st_mirror_slab_s", "st_mirror_slab_w", "al:random"},
        door="st-glass3",
-       endp={goal={"st-none", "it-none", "fl-darkgray"},
+       endp={goal={"st_nil", "it_nil", "fl-darkgray"},
              open_door="st-glass1_hole", alg="ralf"}},
-[138]={box="st-shogun-s", wall="st-panel", inf="fl-stwood", goal="it-shogun-s",
+[138]={box="st_shogun_s", wall="st-panel", inf="fl-stwood", goal="it_shogun_s",
        outf="fl-water", oxyd="a",
-       endp={goal="st-none", alg="ralf", open_door="st-none"}},
-[139]={box="st-shogun-s", wall="st-blocker", inf="fl-black",
+       endp={goal="st_nil", alg="ralf", open_door="st_nil"}},
+[139]={box="st_shogun_s", wall="st_blocker", inf="fl-black",
        outf={"st-white1", "st-black1", "fl-springboard", "fl-abyss_fake"},
-       door="st-blocker", oxyd="b",
-       endp={goal={"st-none", "it-none"}, inf={"fl-springboard", "fl-abyss_fake"},
+       door="st_blocker", oxyd="b",
+       endp={goal={"st_nil", "it_nil"}, inf={"fl-springboard", "fl-abyss_fake"},
              alg="ralf"}},
 [140]={box="st-brownie", wall={"st-stone1", "fl-leavesb"}, inf={"fl-floor_001", "fr:3.0"},
        outf={"fl-leavese4", "fl-leavese2", "fl-leavese1", "fl-leavese3", "al:waves"},
-       door="st-door_a", oxyd="d",
-       endp={goal={"st-grate1", "it-none"}, alg="fourswitch"}},
-[141]={box="st-brownie", wall={"st-rock4", "fl-leavesb"}, inf={"fl-bluegreenx", "mf:1.0", "fr:3.0"},
+       door="st_door_a", oxyd="d",
+       endp={goal={"st-grate1", "it_nil"}, alg="fourswitch"}},
+[141]={box="st-brownie", wall={"st-rock4", "fl-leavesb"}, inf={"fl-bluegreenx", "ad:1.0", "fr:3.0"},
        outf={"fl-water", "st-rock10", "st-invisible:3", "al:waves"},
-       door="st-door_a", oxyd="d",
-       endp={goal="st-none", give="it-sword", alg="block:st-knight"}},
+       door="st_door_a", oxyd="d",
+       endp={goal="st_nil", give="it_sword", alg="block:st_knight"}},
 [142]={box="st-glass2_move", wall={"st-glass1", "fl-leavesb"}, inf="fl-leavesb",
        outf={"fl-leavesc4", "fl-leavesd2", "fl-leavesc2", "fl-leavese3", "al:waves"},
-       door="st-door_a", oxyd="d",
+       door="st_door_a", oxyd="d",
        endp={goal="st-glass1_hole", alg="hide"}},
 [143]={box="st-block", wall={"st-rock5", "fl-stwood"}, inf="fl-wood",
        outf={"st-disco-light", "fl-wood1:3", "fl-wood2", "al:waves"},
-       door="st-door_a", oxyd="a",
-       endp={goal={"fl-abyss", "it-none"}, alg="vortex"}},
+       door="st_door_a", oxyd="a",
+       endp={goal={"fl-abyss", "it_nil"}, alg="vortex"}},
 [144]={box="st-wood", wall="st-rock6", inf="fl-bluegreen",
-       outf={"fl-space", "it-squashed", "it-none:3", "al:random"},
-       door="st-door_a", oxyd="d",
+       outf={"fl-space", "it-squashed", "it_nil:3", "al:random"},
+       door="st_door_a", oxyd="d",
        endp={goal="st-glass2_hole", wall="st-glass1_hole", alg="outside:3"}},
 [145]={box="st-glass1_move", wall={"st-greenbrown", "fl-sand"}, inf="fl-dunes",
-       outf={"fl-sand", "it-landmine:3", "it-booze-broken", "it-none:15", "al:random"},
-       door="st-door_a", oxyd="a",
+       outf={"fl-sand", "it_landmine:3", "it-booze-broken", "it_nil:15", "al:random"},
+       door="st_door_a", oxyd="a",
        endp={goal="st-glass1_hole", alg="allcrack:1"}},
 [146]={box="st-wood", wall="st-rock1", inf="fl-black",
-       outf={"fl-abyss", "st-grate1", "st-none:10", "al:random"},
-       door="st-door_a", oxyd="b", white = true,
-       endp={goal={"st-grate1", "it-none"}, alg="magnets"}},
+       outf={"fl-abyss", "st-grate1", "st_nil:10", "al:random"},
+       door="st_door_a", oxyd="b", white = true,
+       endp={goal={"st-grate1", "it_nil"}, alg="magnets"}},
 [147]={box="st-wood", wall="st-whiteballs", inf="fl-gray", white = true,
        outf={"fl-gradient5", "fl-gradient6", "fl-gradient7", "fl-gradient8", "al:waves"},
-       door="st-door_a", oxyd="a",
-       endp={goal={"st-none", "it-none"}, alg="gradients"}},
-[148]={box="st-shogun-s", wall="st-metal", inf="fl-rough-blue", white = true,
+       door="st_door_a", oxyd="a",
+       endp={goal={"st_nil", "it_nil"}, alg="gradients"}},
+[148]={box="st_shogun_s", wall="st-metal", inf="fl-rough-blue", white = true,
        outf={"fl-rough-red", "fl-rough-blue", "st-disco-light"},
-       door="st-door_a", oxyd="a",
-       endp={goal="st-break_acblack", give="it-hammer", alg="block:st-break_acblack"}},
-[149]={box="st-shogun-s", wall="st-yellow", inf="fl-samba",
-       outf="fl-swamp", door="st-door_a",
-       oxyd="c", goal="it-shogun-s", white = true,
+       door="st_door_a", oxyd="a",
+       endp={goal="st-break_acblack", give="it_hammer", alg="block:st-break_acblack"}},
+[149]={box="st_shogun_s", wall="st-yellow", inf="fl-samba",
+       outf="fl-swamp", door="st_door_a",
+       oxyd="c", goal="it_shogun_s", white = true,
        endp={goal="st-explosion", wall={"st-explosion", "fl-tigris"}, alg="outside"}},
 
 [150]={box="st-flrock", wall="st-redrock", inf="fl-brick",
-       outf="fl-space", door="st-blocker", oxyd="a", white=true,
-       endp={goal={"st-none", "fl-rock", "it-none"}, alg="ralf"}},
+       outf="fl-space", door="st_blocker", oxyd="a", white=true,
+       endp={goal={"st_nil", "fl-rock", "it_nil"}, alg="ralf"}},
 }
 
 -- endp-algs: circle, ralf, hide, outside, allcrack, block, fourswitch
@@ -627,13 +627,13 @@
 
 
 -- The 75 first designs use the following boxes:
---  st-block  ->  st-black, st-blocker, st-brake, st-laser, fl-swamp
---  st-brownie  ->  st-coinslot, st-pull
+--  st-block  ->  st-black, st_blocker, st-brake, st-laser, fl-swamp
+--  st-brownie  ->  st-coinslot, st_pull
 --  st-glass_move  ->  cherry
 --  st-greenbrown_move  ->  hole
 --  st-marble_move  ->  hole
 --  st-rock3_move  ->  *
---  st-shogun  ->  st-shogun-m (not completely!)
+--  st_shogun  ->  st_shogun-m (not completely!)
 --  st-wood[-growing]  ->  fl-swamp
 
 -- Next follows a table to convert the codes Ralf used in his levels

Modified: trunk/data/levels/lib/libsoko-endphase.xml
===================================================================
--- trunk/data/levels/lib/libsoko-endphase.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/levels/lib/libsoko-endphase.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -3,11 +3,11 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libsoko-endphase"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="experimental"/>
       <el:author el:name="Enigma Team" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2007 Enigma Team</el:copyright>
+      <el:copyright>Copyright ? 2007, 2008 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="1.00">
+      <el:compatibility el:enigma="1.10">
       </el:compatibility>
       <el:modes el:easy="false" el:single="false" el:network="false"/>
       <el:comments>
@@ -26,17 +26,16 @@
 ------------------------------------------------------------------------
 
 function goal_trigger(onoff, sender)
-  local x, y = enigma.GetPos(sender)
-  local nr = enigma.GetAttrib(sender, "_sokoarea")
+  local nr = sender._sokoarea
   local more_boxes = false  -- memorizes whether a box was added or removed
   if sokoarea[nr].endphase_started then
     return
   end
 
   -- A new stone? Or has a stone been removed?
-  if(enigma.GetAttrib(sender, "_box") == 0) then
-    if enigma.GetStone(x,y) then
-      enigma.SetAttrib(sender, "_box", 1)
+  if(sender._box == 0) then
+    if -wo:st(sender) then
+      sender._box = 1
       sokoarea[nr].goals_filled = sokoarea[nr].goals_filled + 1
       more_boxes = true
     else
@@ -44,7 +43,7 @@
       return
     end
   else
-    enigma.SetAttrib(sender, "_box", 0)
+    sender._box = 0
     sokoarea[nr].goals_filled = sokoarea[nr].goals_filled - 1
   end
 
@@ -110,7 +109,7 @@
       or (alg == "allcrack")
       or (alg == "vortex") then
     endphase_set_block_oxyds(nr, (sokoarea[nr].design.door or
-        sokoarea[nr].design.wall or "st-none"), param)
+        sokoarea[nr].design.wall or "st_nil"), param)
     sokoarea[nr].goal_hook = endphase_goal_hook_ralf
   elseif (alg == "block") then
     endphase_set_block_oxyds(nr, param)
@@ -134,8 +133,8 @@
   local endp = lib.lua.deep_copy(sokoarea[sokoarea_number].design.endp)
   local alg = endp.alg
   local param = ""
-  local px, py = enigma.GetPos(enigma.GetNamedObject("marble_"..sokoarea_number.."_1"))
-  
+  local marble = po(no["marble_"..sokoarea_number.."_1"])
+
   -- decompose alg into algorithm name and additional parameter
   local sep = string.find(alg, ":")
   if sep then
@@ -157,17 +156,19 @@
   if type(give) == "table" then
     for k, v in pairs(give) do
       if is_item(v) or is_stone(v) or is_floor(v) then
-        set_element(px, py, sokoarea_number, "", v)
+        set_element(marble, sokoarea_number, "", v)
       elseif is_actor(v) then
-        set_actor(v, px + 0.5, py + 0.5)
+        wo[marble] = {v, 0.5, 0.5}
       elseif v == "rubberball" then
-        local old_actor = enigma.GetNamedObject("marble_"..sokoarea_number.."_1")
+        local old_actor = no["marble_"..sokoarea_number.."_1"]
         local actor_kind = "ac-whiteball"
         if sokoarea[sokoarea_number].design.white then
           actor_kind = "ac-blackball"
         end
-        local new_actor = set_actor(actor_kind, px+0.5, py+0.5, {controllers=0})
-        AddRubberBand(old_actor, new_actor, 50, 0)
+        wo[marble] = {actor_kind, "rubberball_sokoarea_"..sokoarea_number,
+                        0.5, 0.5, controllers = 0}
+        wo:add({"ot_rubberband", anchor1 = no["marble_"..sokoarea_number],
+            anchor2 = no["rubberball_sokoarea_"..sokoarea_number], strength = 50})
       else
         myerror("Can't give "..v..".")
       end
@@ -200,7 +201,7 @@
     endphase_set_hide_oxyds(sokoarea_number)
     endphase_magnets(sokoarea_number, param)
   elseif alg == "knock" then
-    -- don't do anything; endphase_call_knock_item
+    -- don't do anything; endphase_call_knocking
     -- queries endphase_started.
   else
     -- use default: "circle"
@@ -211,9 +212,8 @@
 function endphase_redraw_level_array(sokoarea_number)
   local nr = sokoarea_number or 1
   local endp = lib.lua.deep_copy(sokoarea[nr].design.endp)
-  local dx = sokoarea[nr].offset.x
-  local dy = sokoarea[nr].offset.y
-
+  local offset = sokoarea[nr].offset
+  
   -- small routine to check the walls and outside
   local function is_oxyd_or_blocker(x,y)
     if sokoarea[nr].list_oxyd[x.."/"..y] then
@@ -226,21 +226,21 @@
   
   -- redraw outside
   for p, v in pairs(sokoarea[nr].list_outside) do
-    if not is_oxyd_or_blocker(v.lx, v.ly) then
-      set_element(v.lx, v.ly, nr, k, endp.outf)
+    if not is_oxyd_or_blocker(v.abs.x, v.abs.y) then
+      set_element(v.abs, nr, k, endp.outf)
     end
   end
   
   -- redraw the rest inside level_array:
   for y = 0, sokoarea[nr].array_height - 1 do
     for x = 0, sokoarea[nr].array_width - 1 do
-      if not is_oxyd_or_blocker(x+dx, y+dy) then
+      if not is_oxyd_or_blocker(x + offset.x, y + offset.y) then
         local ch = sokoarea[nr].level_array[y+1][x+1]
         for k, v in pairs(endp) do
           if    ((k == "inf")  and char_is_inf(ch))
              or ((k == "wall") and char_is_wall(ch))
              or ((k == "goal") and char_is_goal(ch)) then
-            set_element(x+dx, y+dy, nr, k, v)
+            set_element(offset + {x,y}, nr, k, v)
           end
         end
       end
@@ -250,7 +250,7 @@
   -- if existent, redraw blocker floors
   if (sokoarea[nr].list_blocker) and (endp.inf) then
     for p, v in pairs(sokoarea[nr].list_blocker) do
-      set_element(v.lx, v.ly, nr, "inf", endp.inf)
+      set_element(v.abs, nr, "inf", endp.inf)
     end
   end 
 end
@@ -260,36 +260,34 @@
 ------------------------------------------------------------------------
 
 function endphase_circle(sokoarea_number)
-  local acname = "marble_"..sokoarea_number.."_1"
   local flavor = sokoarea[sokoarea_number].design.oxyd or "b"
-  local actor = enigma.GetNamedObject(acname)
-  if not actor then
-    acname = "marble"
-    actor = enigma.GetNamedObject(acname)
-    if not actor then
+  local actor = no["marble_"..sokoarea_number.."_1"]
+  if not -actor then
+    actor = no["marble"]
+    if not -actor then
       myerror("No marble found. Please name it 'marble'.")  
     end
   end
-  local x, y = enigma.GetPos(actor)
-  if x > 10 then
-    x = x - 2
+  local abs = po(actor)
+  if abs.x > 10 then
+    abs = abs + {-2,0}
   end
-  if y > 6 then
-    y = y - 2
+  if abs.y > 6 then
+    abs = abs + {0,-2}
   end
   for j = 0, 2 do
-    set_oxyd(sokoarea_number, {lx = x+j, ly = y-1}, flavor, 2*j)
-    set_oxyd(sokoarea_number, {lx = x-1, ly = y+j}, flavor, 2*j)
-    set_oxyd(sokoarea_number, {lx = x+j, ly = y+3}, flavor, 2*j+1)
-    set_oxyd(sokoarea_number, {lx = x+3, ly = y+j}, flavor, 2*j+1)
+    set_oxyd(sokoarea_number, {abs = abs + {j,-1}}, flavor, 2*j)
+    set_oxyd(sokoarea_number, {abs = abs + {-1,j}}, flavor, 2*j)
+    set_oxyd(sokoarea_number, {abs = abs + {j,3}},  flavor, 2*j+1)
+    set_oxyd(sokoarea_number, {abs = abs + {3,j}},  flavor, 2*j+1)
     for k = 0, 2 do
-      kill_stone(x+j, y+k)
-      kill_item(x+j, y+k)
-      set_element(x+j, y+k, sokoarea_number, "inf")
+      wo:st(abs + {j,k}):kill()
+      wo:it(abs + {j,k}):kill()
+      set_element(abs + {j,k}, sokoarea_number, "inf")
     end
   end
-  set_stone("st-fart", x+1, y+1, {_sokoarea = sokoarea_number})
-  oxyd_shuffle()
+  wo[abs + {1,1}] = {"st_fart", _sokoarea = sokoarea_number}
+  wo:shuffleOxyd()
 end
 
 -- endphase_set_outside_oxyds distributes oxyds over the outside and
@@ -299,8 +297,7 @@
 function endphase_set_outside_oxyds(sokoarea_number, param)
   local places = {}
   local nr = sokoarea_number or 1
-  local dx = sokoarea[nr].offset.x
-  local dy = sokoarea[nr].offset.y
+  local offset = sokoarea[nr].offset
   local mx = sokoarea[nr].array_width
   local my = sokoarea[nr].array_height
   local flavor = sokoarea[nr].design.oxyd or "b"
@@ -309,7 +306,7 @@
   -- for the marble.
   for p, v in pairs(lib.lua.combine_tables(sokoarea[nr].list_outside,
                 sokoarea[nr].list_wall_two)) do
-    if (mod(v.lx, 2) == 0) and (mod(v.ly, 2) == 0) then
+    if (v.abs.x % 2 == 0) and (v.abs.y % 2 == 0) then
       table.insert(places, v)
     end
   end
@@ -321,10 +318,10 @@
     -- Not enough places? Then choose corners of level_array.
     -- They should always be at least wall_two and far enough
     -- away from each other.
-    places = { {lx = dx,           ly = dy},
-               {lx = dx + mx - 1,  ly = dy},
-               {lx = dx,           ly = dy + my - 1},
-               {lx = dx + mx - 1,  ly = dy + my - 1} }
+    places = { {abs = offset},
+               {abs = offset + {mx - 1, 0}},
+               {abs = offset + {0, my - 1}},
+               {abs = offset + {mx - 1, my - 1}}}
   elseif max <  20 then  number_pairs = 2
   elseif max <  50 then  number_pairs = 3
   elseif max < 100 then  number_pairs = 4
@@ -340,10 +337,10 @@
   lib.lua.shuffle_table(places)
 
   for j = 1, number_pairs do
-    set_oxyd(sokoarea_number, lib.lua.deep_copy(places[2*j-1]), flavor, j - 1)
-    set_oxyd(sokoarea_number, lib.lua.deep_copy(places[2*j]), flavor, j - 1)
+    set_oxyd(sokoarea_number, places[2*j-1], flavor, j - 1)
+    set_oxyd(sokoarea_number, places[2*j], flavor, j - 1)
   end
-  oxyd_shuffle()
+  wo:shuffleOxyd()
 end
 
 function endphase_set_block_oxyds(sokoarea_number, blocker, max_pairs)
@@ -355,34 +352,32 @@
   -- and the opposite position as oxyd, if it is of type wall_two.
   -- Make sure that each possible oxyd position is assigned at most once,
   -- and that no other oxyds or blockers are near.
-  local function opposite_as_oxyd(x, y, dx, dy)
-    if     sokoarea[nr].list_way[(x+dx).."/"..(y+dy)]
-       and sokoarea[nr].list_wall_two[(x-dx).."/"..(y-dy)] then
+  local function opposite_as_oxyd(xy, dxy)
+    if     sokoarea[nr].list_way[(xy.x+dxy.x).."/"..(xy.y+dxy.y)]
+       and sokoarea[nr].list_wall_two[(xy.x-dxy.x).."/"..(xy.y-dxy.y)] then
       -- Check that no oxyd has been set on this position before
       -- and no other oxyd or blocker is near the new oxyd or its
       -- blocker.
       for j, w in pairs(oxyds) do
-        if    (lib.math.manhattan_distance(w.blocker.lx, w.blocker.ly, x, y) <= 1)
-           or (lib.math.manhattan_distance(w.lx, w.ly, x, y) <= 1)
-           or (lib.math.manhattan_distance(w.blocker.lx, w.blocker.ly, x-dx, y-dy) <= 1)
-           or (lib.math.manhattan_distance(w.lx, w.ly, x-dx, y-dy) <= 1) then
-          return false
+        if    (lib.math.manhattan_distance(w.blocker.abs, xy) <= 1)
+           or (lib.math.manhattan_distance(w.abs, xy) <= 1)
+           or (lib.math.manhattan_distance(w.blocker.abs, xy - dxy) <= 1)
+           or (lib.math.manhattan_distance(w.abs, xy - dxy) <= 1) then
+          return
         end
       end
-      table.insert(oxyds,
-         {lx = x-dx, ly = y-dy,
-          blocker = {lx = x, ly = y, oxyd = {lx = x-dx, ly = y-dy}},
-          way = {lx = x+dx, ly = y+dy}})
-      return true
+      table.insert(oxyds, {abs = xy - dxy,
+          blocker = {abs = xy, oxyd = {abs = xy - dxy}}, way = {abs = xy + dxy}})
+      return
     end
-    return false
+    return
   end
+  local directions = {po({-1,0}), po({1,0}), po({0,-1}), po({0,1})}
   for p, v in pairs(sokoarea[nr].list_wall_one) do
     if v.count == 1 then
-      opposite_as_oxyd(v.lx, v.ly, -1,  0)
-      opposite_as_oxyd(v.lx, v.ly,  1,  0)
-      opposite_as_oxyd(v.lx, v.ly,  0, -1)
-      opposite_as_oxyd(v.lx, v.ly,  0,  1)
+      for _, dir in ipairs(directions) do
+        opposite_as_oxyd(v.abs, dir)
+      end
     end
   end
 
@@ -391,7 +386,7 @@
   local number_pairs = 2
   if max < 4 then
     -- Not enough places? Choose "circle"-algorithm instead.
-    sokoarea[nr].endp.alg = "circle"
+    sokoarea[nr].design.endp.alg = "circle"
     return
   elseif max <  8 then  number_pairs = 2
   elseif max < 16 then  number_pairs = 3
@@ -409,31 +404,31 @@
   -- set oxyds and blockers
   local function set_block(w)
     local myblocker = lib.lua.deep_copy(blocker)
-    -- if there's an entry "st-door", choose between st-door-h and st-door-v.
+    -- If there's an entry "st_door_d", choose the faces.
     if type(myblocker) == "string" then
       myblocker = {myblocker}
     end
     for j, v in pairs(myblocker) do
-      if v == "st-door" then
-        if w.lx == w.oxyd.lx then
-          myblocker[j] = "st-door-h"
+      if v == "st_door_d" then
+        if w.abs.x == w.oxyd.abs.x then
+          myblocker[j] = "st_door_d"
         else
-          myblocker[j] = "st-door-v"
+          myblocker[j] = "st_door_d_ew"
         end        
       end
     end
     -- now set in-floor and blocker, and add to list_blocker.
-    set_element(w.lx, w.ly, nr, "inf")
-    set_element(w.lx, w.ly, nr, "", myblocker)
-    sokoarea[nr].list_blocker[(w.lx).."/"..(w.ly)] = lib.lua.deep_copy(w)
+    set_element(w.abs, nr, "inf")
+    set_element(w.abs, nr, "", myblocker)
+    sokoarea[nr].list_blocker[(w.abs.x).."/"..(w.abs.y)] = lib.lua.deep_copy(w)
   end
   for j = 1, number_pairs do   -- Testlevel: 14
-    set_oxyd(nr, lib.lua.deep_copy(oxyds[2*j-1]), flavor, j - 1)
-    set_oxyd(nr, lib.lua.deep_copy(oxyds[2*j]), flavor, j - 1)
+    set_oxyd(nr, oxyds[2*j-1], flavor, j - 1)
+    set_oxyd(nr, oxyds[2*j], flavor, j - 1)
     set_block(oxyds[2*j-1].blocker)
     set_block(oxyds[2*j].blocker)
   end
-  oxyd_shuffle()
+  wo:shuffleOxyd()
 
   -- assign goals to blockers
   -- Note: There might be more goals as blockers, and, vice versa,
@@ -484,26 +479,26 @@
     set_oxyd(sokoarea_number, places[2*j-1], flavor, j - 1)
     set_oxyd(sokoarea_number, places[2*j], flavor, j - 1)
   end
-  oxyd_shuffle()  
+  wo:shuffleOxyd()
 end
 
 function endphase_gradients(sokoarea_number, param)
   local force = tonumber(param) or 25.0
   for p, v in pairs(sokoarea[sokoarea_number].list_way) do
     local grad_type = random(1,12)
-    set_floor("fl-gradient", v.lx, v.ly, {type = grad_type, force = force})
+    wo[v.abs] = {"fl-gradient", type = grad_type, force = force}
   end
 end
 
 function endphase_magnets(sokoarea_number, param)
-  local force = tonumber(param) or 50.0
+  local force = tonumber(param) or 30.0
   local places = {}
   local nr = sokoarea_number or 1
   local flavor = sokoarea[nr].design.oxyd or "b"
 
   -- add all way-elements which are not goals
   for p, v in pairs(sokoarea[nr].list_way) do
-    if not char_is_goal(sokoarea[nr].level_array[v.ay][v.ax]) then
+    if not char_is_goal(sokoarea[nr].level_array[v.rel.y][v.rel.x]) then
       table.insert(places, v)
     end
   end
@@ -515,8 +510,7 @@
 
   -- set magnets
   for j = 1, number_magnets do
-    set_item("it-magnet-on", places[j].lx, places[j].ly,
-             {range = 5, strength = force})
+    wo[places[j].abs] = {"it_magnet_on", range = 5, strength = force}
   end
 end
 
@@ -544,9 +538,9 @@
   
   -- set fourswitchs
   for j = 1, 2*number_pairs do
-    set_stone("st-fourswitch", places[j].lx, places[j].ly,
-        {action="callback", target="endphase_call_fourswitch", _number=j,
-         _sokoarea = sokoarea_number})
+    wo[places[j].abs] =
+        {"st_fourswitch", target = "endphase_call_fourswitch", _number = j,
+         _sokoarea = sokoarea_number}
     places[j].current = 4
     places[j].solve = random(1,4)
     places[j].correct = false
@@ -556,8 +550,8 @@
 end
 
 function endphase_call_fourswitch(onoff, sender)
-  local j = enigma.GetAttrib(sender, "_number")
-  local nr = enigma.GetAttrib(sender, "_sokoarea")
+  local j = sender._number
+  local nr = sender._sokoarea
   local places = sokoarea[nr].places
 
   -- When fourswitch is knocked, count it.
@@ -569,8 +563,7 @@
   -- When count is correct, make it "st-likeoxyda-open".
   if places[j].current == places[j].solve then
     places[j].correct = true
-    set_stone("st-likeoxyda-open", places[j].lx, places[j].ly,
-        {_number = 0, _sokoarea = sokoarea_number})
+    wo[places[j].abs] = {"st-likeoxyda-open", _number = 0, _sokoarea = sokoarea_number}
   end
 
   -- Now the difficult part: If it's the first fourswitch (the one
@@ -581,20 +574,18 @@
   -- time (making it show the new number). This means: Recursion!
   if j ~= 1 then
     -- Trigger all lower fourswitchs
-    local x = places[j-1].lx
-    local y = places[j-1].ly
+    local xy = places[j-1].abs
     if places[j-1].correct then
       -- reset the fourswitch
-      mystone = set_stone("st-fourswitch", x, y,
-        {_number = j - 1, _sokoarea = sokoarea_number})
+      wo[xy] = {"st_fourswitch", _number = j - 1, _sokoarea = sokoarea_number}
+      mystone = wo:st(xy)
       for k = 1, places[j-1].current do
-        SendMessage(mystone, "trigger")
+        mystone:toggle()
       end
-      enigma.SetAttrib(mystone, "action", "callback")
-      enigma.SetAttrib(mystone, "target", "endphase_call_fourswitch")
+      mystone.target = "endphase_call_fourswitch"
       places[j-1].correct = false
     end
-    SendMessage(enigma.GetStone(x, y), "trigger")
+    wo:st(xy):toggle()
   else
     -- Check all fourswitchs
     local correct = true
@@ -607,7 +598,7 @@
         set_oxyd(sokoarea_number, places[2*k-1], flavor, k - 1)
         set_oxyd(sokoarea_number, places[2*k], flavor, k - 1)
       end
-      oxyd_shuffle()
+      wo:shuffleOxyd()
     end
   end  
 end
@@ -615,8 +606,8 @@
 
 function endphase_allcrack(sokoarea_number)
   for p, v in pairs(sokoarea[sokoarea_number].list_way) do
-    if not enigma.GetItem(v.lx, v.ly) then
-      set_item("it-crack3", v.lx, v.ly)
+    if not -wo:it(v.abs) then
+      wo[v.abs] = {"it-crack3"}
     end
   end  
 end
@@ -625,49 +616,48 @@
     goals_filled, number_goals)
   local nr = sokoarea_number or 1
   -- verify correct sokoarea-number and existence of "goal_to_blocker"
-  if nr ~= enigma.GetAttrib(sender, "_sokoarea") then
+  if nr ~= sender._sokoarea then
     myerror("libsoko: Inconsistent sokoarea numbers in goal hook!")
   end
   if type(sokoarea[nr].goal_to_blocker) ~= "table" then
     myerror("libsoko: Blocker list is missing during goal hook!")
   end
   -- identify the corresponding door and open it
-  local goal_number = enigma.GetAttrib(sender, "_goal_number")
-  local blocker = sokoarea[nr].goal_to_blocker[goal_number]
+  local blocker = sokoarea[nr].goal_to_blocker[sender._goal_number]
   if blocker then
-    endphase_ralf_open_door(nr, more_boxes, blocker.lx, blocker.ly)  
+    endphase_ralf_open_door(nr, more_boxes, blocker.abs)
   end
 end
 
 function endphase_ralf_open_doors(sokoarea_number)
   for p, v in pairs(sokoarea[sokoarea_number].list_blocker) do
-    endphase_ralf_open_door(sokoarea_number, true, v.lx, v.ly)
+    endphase_ralf_open_door(sokoarea_number, true, v.abs)
   end
 end
 
 -- endphase_ralf_open_door opens or closes a door at position
 -- (X,Y), dependend on the boolean OPEN.
-function endphase_ralf_open_door(sokoarea_number, open, x, y)
+function endphase_ralf_open_door(sokoarea_number, open, xy)
   local door_kind = sokoarea[sokoarea_number].design.endp.open_door
   if door_kind then
     if not open then
       door_kind =    sokoarea[sokoarea_number].design.door
-                  or sokoarea[sokoarea_number].design.wall or "st-none"
+                  or sokoarea[sokoarea_number].design.wall or "st_nil"
     end
-    set_element(x, y, sokoarea_number, "", door_kind)
+    set_element(xy, sokoarea_number, "", door_kind)
   else
     -- use default "open"/"close"-messages instead
-    local st = enigma.GetStone(x, y)
-    local it = enigma.GetItem(x, y)
-    local fl = enigma.GetFloor(x, y)
-    if st and enigma.GetAttrib(st, "_sokoarea") then
-      SendMessage(st, lib.lua.cond(open, "open", "close"))
+    local st = wo:st(xy)
+    local it = wo:it(xy)
+    local fl = wo:fl(xy)
+    if -st and st._sokoarea then
+      st:message(lib.lua.cond(open, "open", "close"))
     end
-    if it and enigma.GetAttrib(it, "_sokoarea") then
-      SendMessage(it, lib.lua.cond(open, "open", "close"))
+    if -it and it._sokoarea then
+      it:message(lib.lua.cond(open, "open", "close"))
     end
-    if fl then
-      SendMessage(fl, lib.lua.cond(open, "close", "open"))
+    if -fl then
+      fl:message(lib.lua.cond(open, "close", "open"))
     end
   end  
 end
@@ -685,26 +675,26 @@
   end
 
   -- Analyse connected components of list_way, separated by goals.
-  local function mark_component(lx, ly)
-    if     (list_way[lx.."/"..ly])
-       and (not list_way[lx.."/"..ly].component)
-       and (not sokoarea[nr].list_goal[lx.."/"..ly]) then
-      list_way[lx.."/"..ly].component = components
+  local function mark_component(xy)
+    if     (list_way[xy.x.."/"..xy.y])
+       and (not list_way[xy.x.."/"..xy.y].component)
+       and (not sokoarea[nr].list_goal[xy.x.."/"..xy.y]) then
+      list_way[xy.x.."/"..xy.y].component = components
       --set_floor(({"fl-leaves", "fl-ice", "fl-red", "fl-black", "fl-white",
       --    "fl-sahara", "fl-light", "fl-gray", "fl-lightgray", "fl-rough",
       --    "fl-marble", "fl-tigris"})[components] or "fl-sand", lx, ly)
-      table.insert(component[components], {lx = lx, ly = ly})
-      mark_component(lx+1, ly)
-      mark_component(lx-1, ly)
-      mark_component(lx, ly+1)
-      mark_component(lx, ly-1)
+      table.insert(component[components], {abs = xy})
+      mark_component(xy + {1,0})
+      mark_component(xy + {-1,0})
+      mark_component(xy + {0,1})
+      mark_component(xy + {0,-1})
     end
   end
   for p, v in pairs(list_way) do
     if (not list_way[p].component) and (not sokoarea[nr].list_goal[p]) then
       components = components + 1
       component[components] = {oxyds = 0}
-      mark_component(v.lx, v.ly)      
+      mark_component(v.abs)
     end    
   end
 
@@ -715,10 +705,9 @@
 
   -- Analyse oxyds and to which components they belong to.
   for p, v in pairs(sokoarea[nr].list_oxyd) do
-    local component_number = list_way[v.blocker.lx.."/"..v.blocker.ly].component or -1
+    local component_number = list_way[v.blocker.abs.x.."/"..v.blocker.abs.y].component or -1
     if component_number == -1 then
-      set_item("it-banana", v.blocker.lx, v.blocker.ly)
-      mydebug("Banana on "..v.blocker.lx.."/"..v.blocker.ly)
+      myerror("Error in component calculation.")
     else
       component[component_number].oxyds = component[component_number].oxyds + 1
     end
@@ -728,7 +717,7 @@
   -- components, plus the one the marble actually occupies.
   local t = {}  -- helper table: components with oxyds or marble
   local u = {}  -- helper table: all components except t
-  local mx, my = enigma.GetPos(enigma.GetNamedObject("marble_"..nr.."_1"))
+  local mx, my = po(no["marble_"..nr.."_1"]):xy()
   local marble_component = (list_way[mx.."/"..my] or {}).component
   for j = 1, components do
     if (component[j].oxyds > 0) or (j == marble_component) then
@@ -744,9 +733,8 @@
   end
   component = t
   components = table.getn(component)
-  u = nil
 
-  -- From each component, choose one tile and save the {lx,ly}-entry
+  -- From each component, choose one tile and save the position
   local vortex = {}
   for j = 1, components do
     table.insert(vortex, component[j][random(1, table.getn(component[j]))])
@@ -757,14 +745,14 @@
   local connect = lib.math.cyclic_permutation(components)
 
   -- Now set and connect the vortices
-  for j, v in pairs(vortex) do
+  for j, v in ipairs(vortex) do
     local w = vortex[connect[j]]
     -- Remember: We also allow (we need!) vortices at old blocker-positions.
     -- There could still be a stone over this. This stone might be st-blocker,
     -- which turns to it-blocker and has therefore to be removed. Better
     -- we remove all stones:
-    kill_stone(v.lx, v.ly)
-    set_item("it-vortex-open", v.lx, v.ly, {targetx = w.lx, targety = w.ly})
+    wo:st(v.abs):kill()
+    wo[v.abs] = {"it_vortex_open", destination = w.abs}
   end  
 end
 
@@ -772,10 +760,6 @@
   local nr = sokoarea_number
   local flavor = sokoarea[nr].design.oxyd or "b"
   local places = {}
-  local itemkind = param
-  if (itemkind == nil) or (itemkind == "") then
-    itemkind = "it-sensor"
-  end
 
   -- add all blockers
   for p, v in pairs(sokoarea[nr].list_blocker) do
@@ -783,63 +767,40 @@
   end
 
   lib.lua.shuffle_table(places)
-  
-  -- set items (for Enigma 1.0), set attributes of door (>= 1.1)
-  for j, v in pairs(places) do
-    set_item(itemkind, v.lx, v.ly, {action="callback",
-        target="endphase_call_knocking", _number=j, _sokoarea=nr})
-    local st = enigma.GetStone(v.lx, v.ly)
-    if st then
-      enigma.SetAttrib(st, "action", "callback")
-      enigma.SetAttrib(st, "target", "endphase_call_knocking")
-      local closepos = places[lib.lua.mod(j, table.getn(places)) + 1]
-      local openpos = places[lib.lua.mod(j+1, table.getn(places)) + 1]
-      enigma.SetAttrib(st, "_close_x", closepos.lx)
-      enigma.SetAttrib(st, "_close_y", closepos.ly)
-      enigma.SetAttrib(st, "_open_x", openpos.lx)
-      enigma.SetAttrib(st, "_open_y", openpos.ly)
-      --enigma.SetAttrib(st, "_close",
-      --  lib.lua.deep_copy(places[lib.lua.mod(j+1, table.getn(places)) + 1]))
-      --enigma.SetAttrib(st, "_open",
-      --  lib.lua.deep_copy(places[lib.lua.mod(j+2, table.getn(places)) + 1]))
+
+  -- set attributes of door
+  for j, v in ipairs(places) do
+    local st = wo:st(v.abs)
+    if -st then
+      st.action = "callback"
+      st.target = "endphase_call_knocking"
+      st._close = places[lib.lua.mod(j, table.getn(places)) + 1].abs
+      st._open = places[lib.lua.mod(j+1, table.getn(places)) + 1].abs
+      st._number = j
     end
   end
 end
 
 function endphase_call_knocking(onoff, sender)
-  local j = enigma.GetAttrib(sender, "_number")
-  local nr = enigma.GetAttrib(sender, "_sokoarea")
+  local j = sender._number
+  local nr = sender._sokoarea
   if (not nr) or (not j) then
     myerror("libsoko: Knocking's source has no number or no sokoarea.")
   end
-  -- Check that it-sensor did not send its message because of
-  -- the marble standing on it:
-  local x, y = enigma.GetPos(sender)
-  local mx, my = enigma.GetPos(enigma.GetNamedObject("marble_"..nr.."_1"))
-  if (x == mx) and (y == my) then
-    return
-  end
   mydebug("Knocked on "..j.."/"..sokoarea[nr].number_oxyds)
   -- Deactivate the first door until endphase has started.
   if (j == 1) and (not sokoarea[nr].endphase_started) then
     mydebug("Door deactivated until endphase.")
     return
   end
-  -- Get the door (possibly it already is sender), and open or close
-  -- the neccessary doors given as attributes.
-  local mydoor = enigma.GetStone(x, y)
-  if enigma.GetAttrib(mydoor, "_sokoarea") == nr then
-    local close_x = enigma.GetAttrib(mydoor, "_close_x")
-    local close_y = enigma.GetAttrib(mydoor, "_close_y")
-    local open_x = enigma.GetAttrib(mydoor, "_open_x")
-    local open_y = enigma.GetAttrib(mydoor, "_open_y")
-    local closedoor = enigma.GetStone(close_x, close_y)
-    local opendoor = enigma.GetStone(open_x, open_y)
-    if closedoor then
-      SendMessage(closedoor, "close")
+  -- Open or close the neccessary doors given as attributes.
+  if sender._sokoarea == nr then
+    print(po(sender).x.."/"..po(sender).y.."/"..sender:kind())
+    if wo:st(sender._close):is("st_door") then
+      wo:st(sender._close):close()
     end
-    if opendoor then
-      SendMessage(opendoor, "open")
+    if wo:st(sender._open):is("st_door") then
+      wo:st(sender._open):open()
     end
   end
 end

Modified: trunk/data/levels/lib/libsoko.xml
===================================================================
--- trunk/data/levels/lib/libsoko.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/levels/lib/libsoko.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -3,11 +3,11 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libsoko"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="experimental"/>
       <el:author el:name="Enigma Team" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2007 Enigma Team</el:copyright>
+      <el:copyright>Copyright ? 2007, 2008 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="1.00">
+      <el:compatibility el:enigma="1.10">
         <el:dependency el:path="lib/liblua" el:id="lib/liblua" el:release="1" el:preload="true"/>
         <el:dependency el:path="lib/libmath" el:id="lib/libmath" el:release="1" el:preload="true"/>
         <el:dependency el:path="lib/libsoko-designlist" el:id="lib/libsoko-designlist" el:release="1" el:preload="true"/>
@@ -29,6 +29,8 @@
 -- to understand design tables, and libsoko-endphase.xml for goal-triggering
 -- and endphases.
 
+lib.soko = {}
+
 ------------------------------------------------------------------------
 -- Global variables
 ------------------------------------------------------------------------
@@ -83,39 +85,37 @@
 ------------------------------------------------------------------------
 
 function mydebug(st)
-  --print(st)
+  print(st)
 end
 function mywarning(st)
   print(st)
 end
 function myerror(st)
-  error(st)
+  error(st, 2)
 end
 
-function is_floor(s)        return string.sub(s, 1, 3) == "fl-"  end
-function is_stone(s)        return string.sub(s, 1, 3) == "st-"  end
-function is_item(s)         return string.sub(s, 1, 3) == "it-"  end
-function is_actor(s)        return string.sub(s, 1, 3) == "ac-"  end
-function is_algorithm(s)    return string.sub(s, 1, 3) == "al:"  end
-function is_friction(s)     return string.sub(s, 1, 3) == "fr:"  end
-function is_mousefactor(s)  return string.sub(s, 1, 3) == "mf:"  end
+function is_floor(s)        return string.sub(s, 1, 2) == "fl"  end
+function is_stone(s)        return string.sub(s, 1, 2) == "st"  end
+function is_item(s)         return string.sub(s, 1, 2) == "it"  end
+function is_actor(s)        return string.sub(s, 1, 2) == "ac"  end
+function char_is_outf(ch)   return string.find(ch, "[ ]")       == 1  end
+function char_is_inf(ch)    return not char_is_outf(ch)               end
 function char_is_wall(ch)   return string.find(ch, "[#]")       == 1  end
 function char_is_goal(ch)   return string.find(ch, "[\.\*\+N]") == 1  end
 function char_is_box(ch)    return string.find(ch, "[$\*]")     == 1  end
 function char_is_chess(ch)  return string.find(ch, "[nN]")      == 1  end
 function char_is_player(ch) return string.find(ch, "[@\+]")     == 1  end
-function char_is_outf(ch)   return string.find(ch, "[ ]")       == 1  end
-function char_is_inf(ch)    return not char_is_outf(ch)               end
 
 -- choose_among_multiples selects a number between 1 and COUNT
 -- based on the coordinates X and Y and the algorithm's name ALG.
-function choose_among_multiples(x, y, count, alg)
+function choose_among_multiples(abs, count, alg)
   if alg == "checkerboard" then
-    return math.mod(mod(x,2)+mod(y,2), count) + 1
+    return (((abs.x%2) + (abs.y%2)) % count) + 1
   elseif alg == "lines" then
-    return math.mod(x + y, count) + 1
+    return ((abs.x + abs.y) % count) + 1
   elseif alg == "waves" then
-    return math.mod(x + y * y + x*y*x + 3*y*x*y*x, count) + 1
+    local x, y = abs:xy()
+    return ((x + y * y + x*y*x + 3*y*x*y*x) % count) + 1
   elseif alg == "random" then
     return math.random(count)
   end
@@ -141,8 +141,8 @@
   local entry = lib.lua.deep_copy(list_entry)
   entry.flavor = flavor
   entry.color = color
-  oxyd(entry.lx, entry.ly, flavor, color)
-  sokoarea[sokoarea_number].list_oxyd[(entry.lx).."/"..(entry.ly)] = entry
+  wo[entry.abs] = {"st_oxyd", flavor = flavor, oxydcolor = color}
+  sokoarea[sokoarea_number].list_oxyd[entry.abs.x.."/"..entry.abs.y] = entry
   sokoarea[sokoarea_number].number_oxyds =
       sokoarea[sokoarea_number].number_oxyds + 1
 end
@@ -151,8 +151,7 @@
 -- list_way, list_wall_one and list_wall_two for SOKOAREA_NUMBER.
 function create_lists(sokoarea_number)
   local nr = sokoarea_number or 1
-  local dx = sokoarea[nr].offset.x
-  local dy = sokoarea[nr].offset.y
+  local offset = sokoarea[nr].offset
   local mx = sokoarea[nr].array_width
   local my = sokoarea[nr].array_height
   sokoarea[nr].list_outside = {}
@@ -163,22 +162,24 @@
   for x = 0, mx - 1 do
     for y = 0, my - 1 do
       local ch = sokoarea[nr].level_array[y+1][x+1]
-      local entry = {lx = x+dx, ly = y+dy, ax = x+1, ay = y+1}
+      local entry = {abs = offset + {x,y}, rel = po({x+1, y+1})}
+      local sig = entry.abs.x.."/"..entry.abs.y
       if char_is_outf(ch) then
-        sokoarea[nr].list_outside[(x+dx).."/"..(y+dy)] = entry
+        sokoarea[nr].list_outside[sig] = entry
       elseif char_is_wall(ch) then
-        sokoarea[nr].list_wall[(x+dx).."/"..(y+dy)] = entry
+        sokoarea[nr].list_wall[sig] = entry
       else
-        sokoarea[nr].list_way[(x+dx).."/"..(y+dy)] = entry
-      end        
+        sokoarea[nr].list_way[sig] = entry
+      end
     end
   end
   -- list_outside (outside level_array)
   if sokoarea[nr].level_width and sokoarea[nr].level_height then
     for x = 0, sokoarea[nr].level_width - 1 do
       for y = 0, sokoarea[nr].level_height - 1 do
-        if (x < dx) or (x > mx+dx-1) or (y < dy) or (y > my+dy-1) then
-          sokoarea[nr].list_outside[x.."/"..y] = {lx = x, ly = y}
+        if    (x < offset.x) or (x > mx + offset.x - 1)
+           or (y < offset.y) or (y > my + offset.y - 1) then
+          sokoarea[nr].list_outside[x.."/"..y] = {abs = po({x,y})}
         end
       end
     end
@@ -189,8 +190,8 @@
   -- (iii) it's near a way.
   -- In addition, it counts the number of near ways.
   for p, v in pairs(sokoarea[nr].list_wall) do
-    local x = v.lx
-    local y = v.ly
+    local x = v.abs.x
+    local y = v.abs.y
     if    sokoarea[nr].list_outside[(x-1).."/"..(y)]
        or sokoarea[nr].list_outside[(x+1).."/"..(y)]
        or sokoarea[nr].list_outside[(x).."/"..(y-1)]
@@ -206,7 +207,7 @@
       if sokoarea[nr].list_way[(x).."/"..(y+1)] then  count = count + 1  end
       if count > 0 then
         sokoarea[nr].list_wall_one[x.."/"..y] =
-            {lx = x, ly = y, ax = v.ax, ay = v.ay, count = count}
+            {abs = v.abs, rel = v.rel, count = count}
       end
     end
   end
@@ -226,7 +227,7 @@
     if not sokoarea[nr].list_wall_two[x.."/"..y] then
       -- create new entry
       sokoarea[nr].list_wall_two[x.."/"..y] =
-          {lx = x, ly = y, ax = nil, ay = nil, wall_one = {}}
+          {abs = po({x,y}), rel = nil, wall_one = {}}
     end
     -- add the corresponding wall_one
     local w = table.getn(sokoarea[nr].list_wall_two[x.."/"..y].wall_one) + 1
@@ -234,10 +235,10 @@
         sokoarea[nr].list_wall_one[one_x.."/"..one_y]
   end
   for p, v in pairs(sokoarea[nr].list_wall_one) do
-    check_ii_and_iii(v.lx+1, v.ly, v.lx, v.ly)
-    check_ii_and_iii(v.lx-1, v.ly, v.lx, v.ly)
-    check_ii_and_iii(v.lx, v.ly+1, v.lx, v.ly)
-    check_ii_and_iii(v.lx, v.ly-1, v.lx, v.ly)
+    check_ii_and_iii(v.abs.x+1, v.abs.y, v.abs.x, v.abs.y)
+    check_ii_and_iii(v.abs.x-1, v.abs.y, v.abs.x, v.abs.y)
+    check_ii_and_iii(v.abs.x, v.abs.y+1, v.abs.x, v.abs.y)
+    check_ii_and_iii(v.abs.x, v.abs.y-1, v.abs.x, v.abs.y)
   end  
 end
 
@@ -248,11 +249,12 @@
   sokoarea[sokoarea_number] = {
     level_array = {},
     design = default_design,
+    algorithms = {},
     number_goals = 0,
     goals_filled = 0,
     actor_count = 0,
     endphase_started = false,
-    offset = {0, 0},
+    offset = po({0, 0}),
     level_width = nil,
     level_height = nil,
     uses_chess = false,
@@ -278,15 +280,15 @@
 
 -- set_element sets element name EL_STR of area SOKOAREA_NUMBER at x, y.
 -- EL_DESIGN is optional and overrides the design of the given sokoarea.
-function set_element(x, y, sokoarea_number, el_str, el_design)
+function set_element(abs, sokoarea_number, el_str, el_design)
   if type(sokoarea[sokoarea_number]) ~= "table" then
     myerror("Sokoarea table number "..sokoarea_number.." broken or not existing.")
   end
   local el = el_design or sokoarea[sokoarea_number].design[el_str]
   local in_endphase = sokoarea[sokoarea_number].endphase_started
 
-  if (type(x) ~= "number") or (type(y) ~= "number") then
-    myerror("libsoko.set_element: Coordinates are not numbers!")
+  if (usertype(abs) ~= "position") then
+    myerror("libsoko.set_element: Coordinate is not a position!")
     return
   end
 
@@ -299,37 +301,33 @@
   local it = {}
   local multiple_alg = "checkerboard"
   local friction = nil
-  local mousefactor = nil
+  local adhesion = nil
   local fire = nil
 
   -- Now analyse EL: Decompose its entries into fl,st,it.
   -- Each entry might in turn hold a ":NUMBER", which multiplicates it.
   for j, v in pairs(el or {}) do
     if type(v) == "string" then
-      -- Separate the multiplicator
+      -- Separate the multiplicator or argument (separated by ":")
       local s = v
       local nr = 1
       local sep = string.find(v, ":")
+      local arg = nil
       if sep then
         s = string.sub(v, 1, sep - 1)
-        nr = tonumber(string.sub(v, sep + 1))
+        arg = string.sub(v, sep + 1)
       end
-      if type(nr) ~= "number" then
-        -- Assume it's not a multiplicator, like in "al:ALGORITHM".
-        s = v
-        nr = 1
-      end
 
       -- Now sort the entry into tables
-      for j = 1, nr do
-            if is_floor(s)       then  table.insert(fl, s)
-        elseif is_stone(s)       then  table.insert(st, s)
-        elseif is_item(s)        then  table.insert(it, s)
-        elseif is_algorithm(s)   then  multiple_alg = string.sub(s, 4, -1)
-        elseif is_friction(s)    then  friction = tonumber(string.sub(s, 4, -1))
-        elseif is_mousefactor(s) then  mousefactor = tonumber(string.sub(s, 4, -1))
-        elseif s == "fire"       then  fire = true
-        elseif s == "nofire"     then  fire = false
+      for j = 1, tonumber(arg) or 1 do
+            if is_floor(s)    then  table.insert(fl, s)
+        elseif is_stone(s)    then  table.insert(st, s)
+        elseif is_item(s)     then  table.insert(it, s)
+        elseif s == "al"      then  multiple_alg = arg
+        elseif s == "fr"      then  friction = tonumber(arg) or 1
+        elseif s == "ad"      then  adhesion = tonumber(arg) or 1
+        elseif s == "fire"    then  fire = true
+        elseif s == "nofire"  then  fire = false
         else
           mywarning("Unknown entry "..j.."="..s.." in design element.")
         end
@@ -344,76 +342,67 @@
 
   ----------- floor --------------
   if table.getn(fl) > 0 then
-    local flkind = fl[choose_among_multiples(x, y, table.getn(fl), multiple_alg)]
+    local flkind = fl[choose_among_multiples(abs, table.getn(fl), multiple_alg)]
     if flkind == "fl-bridge_x" then
-      created_objects.fl = set_floor("fl-bridge", x, y,
-          {type = "x", burnable = false, eternal = true})
+      wo[abs] = {"fl-bridge", type = "x", burnable = false, eternal = true}
     elseif flkind == "fl-bridge_y" then
-      created_objects.fl = set_floor("fl-bridge", x, y,
-          {type = "y", burnable = false, eternal = true})
+      wo[abs] = {"fl-bridge", type = "y", burnable = false, eternal = true}
     else
-      created_objects.fl = set_floor(flkind, x, y,
-          {burnable = false, eternal = true})
+      wo[abs] = {flkind, burnable = false, eternal = true}
     end
+    created_objects.fl = wo:fl(abs)
     if type(friction) == "number" then
-      enigma.SetAttrib(created_objects.fl, "friction", friction)
+      created_objects.fl.friction = friction
     end
-    if type(mousefactor) == "number" then
-      enigma.SetAttrib(created_objects.fl, "mousefactor", mousefactor)
+    if type(adhesion) == "number" then
+      created_objects.fl.adhesion = adhesion
     end
   end
 
   ----------- stone ---------------
   if table.getn(st) > 0 then
-    local stkind = st[choose_among_multiples(x, y, table.getn(st), multiple_alg)]
-    local existing_stone = enigma.GetStone(x, y)
-    if (not existing_stone) or (enigma.GetKind(existing_stone) ~= "st-oxyd") then
-      if stkind == "st-none" then
-        kill_stone(x, y)
-      else
-        created_objects.st = set_stone(stkind, x, y, {_sokoarea = sokoarea_number})
-      end
+    local stkind = st[choose_among_multiples(abs, table.getn(st), multiple_alg)]
+    if (not -wo:st(abs)) or (not wo:st(abs):is("st_oxyd")) then
+      wo[abs] = {stkind, _sokoarea = sokoarea_number}
+      created_objects.st = wo:st(abs)
     end
   end
 
   ----------- item ----------------
   if table.getn(it) > 0 then
-    local itkind = it[choose_among_multiples(x, y, table.getn(it), multiple_alg)]
+    local itkind = it[choose_among_multiples(abs, table.getn(it), multiple_alg)]
     if sokoarea[sokoarea_number].uses_chess and not in_endphase then
-      itkind = "it-trigger"
-    end    
-    if itkind == "it-none" then
-      kill_item(x, y)
-    else
-      created_objects.it = set_item(itkind, x, y)
+      itkind = "it_trigger"
     end
+    wo[abs] = {itkind}
+    created_objects.it = wo:it(abs)
     if (el_str == "goal") and not in_endphase then
       local gn = sokoarea[sokoarea_number].number_goals + 1
       sokoarea[sokoarea_number].number_goals = gn
-      sokoarea[sokoarea_number].list_goal[x.."/"..y] = 
-          {lx = x, ly = y, goal_number = gn}
+      sokoarea[sokoarea_number].list_goal[abs.x.."/"..abs.y] =
+          {abs = abs, goal_number = gn}
       if created_objects.it and not in_endphase then
-        enigma.SetAttrib(created_objects.it, "action", "callback")
-        enigma.SetAttrib(created_objects.it, "target", "goal_trigger")
-        enigma.SetAttrib(created_objects.it, "_box", 0)
-        enigma.SetAttrib(created_objects.it, "_sokoarea", sokoarea_number)
-        enigma.SetAttrib(created_objects.it, "_goal_number", gn)
+        created_objects.it.action = "callback"
+        created_objects.it.target = "goal_trigger"
+        created_objects.it._box = 0
+        created_objects.it._sokoarea = sokoarea_number
+        created_objects.it._goal_number = gn
       end
     end
   end
 
   ----------- fire ----------------
   if fire ~= nil then
-    local myfloor = enigma.GetFloor(x,y)
+    local myfloor = wo:fl(abs)
     if myfloor then
       if fire then
-        enigma.SetAttrib(myfloor, "burnable", true)
-        enigma.SetAttrib(myfloor, "eternal", true)
-        SendMessage(myfloor, "forcefire")
+        myfloor.burnable = true
+        myfloor.eternal = true
+        myfloor:message("forcefire")
       else
-        SendMessage(myfloor, "stopfire")
-        enigma.SetAttrib(myfloor, "burnable", false)
-        enigma.SetAttrib(myfloor, "eternal", true)
+        myfloor:message("stopfire")
+        myfloor.burnable = false
+        myfloor.eternal = true
       end
     end
   end
@@ -434,8 +423,7 @@
 function draw_level_array(sokoarea_number, outside, draw_actor)
   local nr = sokoarea_number or 1
   local design = sokoarea[nr].design
-  local dx = sokoarea[nr].offset.x
-  local dy = sokoarea[nr].offset.y
+  local offset = sokoarea[nr].offset
   sokoarea[nr].list_goal = {}
 
   -- create level
@@ -443,44 +431,45 @@
     for x = 0, sokoarea[nr].array_width - 1 do
       local ch = sokoarea[nr].level_array[y+1][x+1]
       local obj = {}
+      local abs = offset + {x,y}
       
       -- set floor outside or floor inside
       if (ch == " ") then -- note: space stands for outside, "-" for inside!
         if outside then
-          kill_stone(x+dx, y+dy)
-          kill_item(x+dx, y+dy)
-          set_element(x+dx, y+dy, nr, "outf")
+          wo:st(abs):kill()
+          wo:it(abs):kill()
+          set_element(abs, nr, "outf")
         end
       else
-        kill_stone(x+dx, y+dy)
-        kill_item(x+dx, y+dy)
-        obj = set_element(x+dx, y+dy, nr, "inf")
-        enigma.SetAttrib(obj.fl, "freeze_check", true)
+        wo:st(abs):kill()
+        wo:it(abs):kill()
+        obj = set_element(abs, nr, "inf")
+        obj.fl.freeze_check = true
       end
       
       -- Walls
       if char_is_wall(ch) then
-        obj = set_element(x+dx, y+dy, nr, "wall")
+        obj = set_element(abs, nr, "wall")
       end
       
       -- Goals
       if char_is_goal(ch) then
-        obj = set_element(x+dx, y+dy, nr, "goal")
-        enigma.SetAttrib(enigma.GetFloor(x+dx, y+dy), "freeze_check", false)
+        obj = set_element(abs, nr, "goal")
+        wo:fl(abs).freeze_check = false
       end
       
       -- Boxes
       if char_is_box(ch) then
-        obj = set_element(x+dx, y+dy, nr, "box")
-        enigma.SetAttrib(obj.st, "freeze_check", true)
+        obj = set_element(abs, nr, "box")
+        obj.st.freeze_check = true
       end
       
       -- Chess-Stones
       if char_is_chess(ch) then
         if design["white"] then
-          set_stone("st-chess_white", x + dx, y + dy)
+          wo[abs] = {"st-chess_white"}
         else
-          set_stone("st-chess_black", x + dx, y + dy)
+          wo[abs] = {"st-chess_black"}
         end
       end
       
@@ -489,11 +478,9 @@
         sokoarea[nr].actor_count = sokoarea[nr].actor_count + 1
         local acname = "marble_"..nr.."_"..sokoarea[nr].actor_count
         if design["white"] then
-          set_actor("ac-whiteball", x + 0.5 + dx, y + 0.5 + dy,
-              { name = acname, controllers = 1, player = 0 })
+          wo[abs] = {"#ac-whiteball", acname, controllers = 1, player = 0}
         else
-          set_actor("ac-blackball", x + 0.5 + dx, y + 0.5 + dy,
-              { name = acname })
+          wo[abs] = {"#ac-blackball", acname}
         end
       end
     end
@@ -835,7 +822,7 @@
   end
   -- fill chosen design with default values where neccessary
   design = lib.lua.combine_tables({design, default_design})
-  -- No stone set for outf, not even "st-none"?
+  -- No stone set for outf, not even "st_nil"?
   -- Use the default outf-stone instead, and remove it on endphase.
   if type(design.outf) ~= "table" then
     design.outf = {design.outf}
@@ -854,7 +841,7 @@
       return design
     end
   end
-  table.insert(design.endp.outf, "st-none")  
+  table.insert(design.endp.outf, "st_nil")  
   return design
 end
 
@@ -899,7 +886,8 @@
   local levelh = math.max(sokoarea[1].array_height, 13)
   sokoarea[1].level_width = levelw
   sokoarea[1].level_height = levelh
-  create_world(levelw, levelh)
+  ti[" "] = {"fl-abyss"}
+  wo(ti, " ", levelw, levelh)
   
   -- calculate padding
   local dx = 0
@@ -910,7 +898,7 @@
   if levelh > sokoarea[1].array_height then
     dy = math.floor((levelh - sokoarea[1].array_height) / 2)
   end
-  sokoarea[1].offset = {x = dx, y = dy}
+  sokoarea[1].offset = po({dx, dy})
 
   -- calculate design
   sokoarea[1].design =
@@ -922,7 +910,7 @@
   -- draw level
   for x = 0, levelw - 1 do
     for y = 0, levelh - 1 do
-      set_element(x, y, 1, "outf")
+      set_element(po({x,y}), 1, "outf")
     end
   end
   draw_level_array(1, true, true)
@@ -931,9 +919,10 @@
   prepare_endphase(1)
 
   -- Enigma's global variables
-  enigma.ConserveLevel = FALSE
-  enigma.ShowMoves = TRUE
-  display.SetFollowMode(display.FOLLOW_SMOOTH)
+  wo["ConserveLevel"] = false
+  wo["ShowMoves"] = true
+  wo["FollowGrid"] = false
+  wo["FollowMethod"] = FOLLOW_SCROLL
 
   -- return level width and height
   return levelw, levelh
@@ -953,19 +942,18 @@
   if sokoarea[nr].level_width and sokoarea[nr].level_height then
     for x = 0, sokoarea[nr].level_width - 1 do
       for y = 0, sokoarea[nr].level_height - 1 do
-        kill_stone(x, y)
-        kill_item(x, y)
-        set_element(x, y, nr, "outf")
+        wo:st(x, y):kill()
+        wo:it(x, y):kill()
+        set_element(po({x,y}), nr, "outf")
       end
     end
   else
     for x = 0, sokoarea[nr].array_width - 1 do
       for y = 0, sokoarea[nr].array_height - 1 do
-        local rx = x + sokoarea[nr].offset.x
-        local ry = y + sokoarea[nr].offset.y
-        kill_stone(rx, ry)
-        kill_item(rx, ry)
-        set_element(rx, ry, nr, "outf")
+        local abs = sokoarea[nr].offset + {x,y}
+        wo:st(abs):kill()
+        wo:it(abs):kill()
+        set_element(abs, nr, "outf")
       end
     end
   end
@@ -997,7 +985,7 @@
 
 -- draw_sokoball draws a sokoball level from argument LEVEL, sublevel
 -- number SUBLEVEL with design DESIGN (see create_sokoball) at offset
--- DX, DY. It's arguments are identical to those of create_sokoball.
+-- OFFSET. It's arguments are identical to those of create_sokoball.
 -- Whereas create_sokoball should be used for sokoball-only levels,
 -- draw_sokoball can be used to add a sokoban type area to a larger
 -- level. The difference is as follows:
@@ -1016,7 +1004,7 @@
 -- Note: Overwriting one sokoarea with another creates problems
 --       with the triggers.
 --
-function draw_sokoball(dx, dy, level, sublevel, design, draw_actor,
+function draw_sokoball(offset, level, sublevel, design, draw_actor,
                        endphase_hook, goal_hook)
   local nr = new_sokoarea()
   -- unpack level
@@ -1024,7 +1012,7 @@
   sokoarea[nr].array_width = table.getn(sokoarea[nr].level_array[1])
   sokoarea[nr].array_height = table.getn(sokoarea[nr].level_array)
   sokoarea[nr].uses_chess = check_chess(nr)
-  sokoarea[nr].offset = {x = dx, y = dy}
+  sokoarea[nr].offset = offset
   sokoarea[nr].design = 
       design_from_description(design, sokoarea[nr].level_array)
   if hook ~= nil then

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/data/schemas/objects.xml	2008-09-04 11:50:38 UTC (rev 1301)
@@ -18,6 +18,7 @@
     <attr name="faces" type="string" default="nil" rw="rw"/>
     <attr name="fellows" type="group" default="nil" rw="r"/>
     <attr name="flavor" type="string" default="b" rw="rw"/>
+    <attr name="freeze_check" type="bool" default="false" rw="rw"/>
     <attr name="friction" type="double" default="nil" rw="rw"/>
     <attr name="gradient" type="double" default="nil" rw="rw"/>
     <attr name="hit_factor" type="double" default="nil" rw="rw"/>
@@ -397,6 +398,7 @@
     <object name="st" abstract="true">
       <attr name="movable" rw="r"/>
       <attr name="fellows"/>
+      <attr name="freeze_check"/>
       <attr name="rubbers"/>
       <attr name="wires"/>
     </object>

Modified: trunk/src/stones/BoulderStone.cc
===================================================================
--- trunk/src/stones/BoulderStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/BoulderStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -157,8 +157,10 @@
         if (impulse.sender && impulse.sender->is_kind("st_rotator")) {
             setDir(impulse.dir);  // activate
         }
+        int id = getId();
         move_stone(impulse.dir);  // due to rotator and impulsestone
-        propagateImpulse(impulse);
+        if (Object::getObject(id) != NULL)   // not killed?
+            propagateImpulse(impulse);
     }
 
     Direction BoulderStone::getDir() const {

Modified: trunk/src/stones/LightPassengerStone.cc
===================================================================
--- trunk/src/stones/LightPassengerStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/LightPassengerStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -172,8 +172,10 @@
         Actor *a = dynamic_cast<Actor*>(impulse.sender);
         if (a == NULL && ((objFlags & OBJBIT_LIGHTNEWDIRS) == NODIRBIT || state == OFF 
                 || server::GameCompatibility != GAMET_ENIGMA)) {
+            int id = getId();
             move_stone(impulse.dir);
-            propagateImpulse(impulse);
+            if (Object::getObject(id) != NULL)   // not killed?
+                propagateImpulse(impulse);
         }
     }
     

Modified: trunk/src/stones/PullStone.cc
===================================================================
--- trunk/src/stones/PullStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/PullStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -86,6 +86,8 @@
             return;                 // avoid unremoveable and border stones
         }
         
+        int id = getId();
+        
         PullStone *vanishStone = dynamic_cast<PullStone *>(MakeObject("st_pull"));
         vanishStone->state = VANISHING;
         
@@ -122,8 +124,10 @@
         }
         vanishStone->setAttr("$frozen_actors", actors);
 
-        sound_event("moveslow");
-        propagateImpulse(impulse);
+        if (Object::getObject(id) != NULL) {  // not killed?
+            sound_event("moveslow");
+            propagateImpulse(impulse);
+        }
     }
     
     void PullStone::alarm() {

Modified: trunk/src/stones/RotatorStone.cc
===================================================================
--- trunk/src/stones/RotatorStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/RotatorStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -118,8 +118,10 @@
 
     void RotatorStone::on_impulse(const Impulse& impulse) {
         if (objFlags & OBJBIT_MOVABLE) {
+            int id = getId();
             move_stone(impulse.dir);
-            propagateImpulse(impulse);
+            if (Object::getObject(id) != NULL)   // not killed?
+                propagateImpulse(impulse);
         }
     }
     

Modified: trunk/src/stones/RubberbandStone.cc
===================================================================
--- trunk/src/stones/RubberbandStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/RubberbandStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -68,8 +68,10 @@
     void RubberbandStone::on_impulse (const Impulse& impulse) {
         Actor *a = dynamic_cast<Actor *>(impulse.sender);
         if (a && player::WieldedItemIs (a, "it_magicwand")) {
+            int id = getId();
             move_stone(impulse.dir);
-            propagateImpulse(impulse);
+            if (Object::getObject(id) != NULL)   // not killed?
+                propagateImpulse(impulse);
         }
     }
 

Modified: trunk/src/stones/ShogunStone.cc
===================================================================
--- trunk/src/stones/ShogunStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/ShogunStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -153,6 +153,7 @@
 
     void ShogunStone::on_impulse(const Impulse& impulse) {
         static char * soundevent = "movesmall";
+        int id = getId();
         
         if (!impulse.byWire && subShogun != NULL) {
             subShogun->on_impulse(impulse);
@@ -191,8 +192,8 @@
                 superShogun = s;
 
                 nss->init_model();     // display new hole         
+                setOwnerPos(newPos);   // the stone is owned at the new position
                 SendMessage(GetItem(newPos), "_shogun", nss->getHoles());
-                setOwnerPos(newPos);   // the stone is owned at the new position
             }
             
             server::IncMoveCounter();
@@ -206,7 +207,8 @@
                 }
             }
         }
-        propagateImpulse(impulse);
+        if (Object::getObject(id) != NULL)   // not killed?
+            propagateImpulse(impulse);
     }
     
     int ShogunStone::getHoles() const {

Modified: trunk/src/stones/SwapStone.cc
===================================================================
--- trunk/src/stones/SwapStone.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/SwapStone.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -84,6 +84,8 @@
             propagateImpulse(impulse);
             return;                 // avoid unremoveable and border stones
         }
+
+        int id = getId();
         
         SwapStone *vanishStone = dynamic_cast<SwapStone *>(MakeObject("st_swap"));
         vanishStone->state = VANISHING;
@@ -102,9 +104,11 @@
             if (Item *it = GetItem(newPos))
                 it->on_stonehit(this);
 
-        sound_event("moveslow");
         server::IncMoveCounter(1);
-        propagateImpulse(impulse);
+        if (Object::getObject(id) != NULL) {  // not killed?
+            sound_event("moveslow");
+            propagateImpulse(impulse);
+        }
     }
     
     void SwapStone::alarm() {

Modified: trunk/src/stones/Turnstile.cc
===================================================================
--- trunk/src/stones/Turnstile.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones/Turnstile.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -144,6 +144,7 @@
         }
     
         if (can_rotate) {
+            int id = getId();
             sound_event (clockwise ? "turnstileright" : "turnstileleft");
             sound_event("movesmall");
     
@@ -151,7 +152,10 @@
             set_anim(ecl::strf("st-turnstile%s-anim", (std::string("red") == getAttr("flavor").to_string()) ? "" : "-green"));
             rotate_arms(arms, clockwise);
             handleActorsAndItems(clockwise, impulse_sender);
-            
+
+            if (Object::getObject(id) == NULL)   // Killed? Then forget the rest.
+                return can_rotate;
+        
             Direction dir = to_direction(getAttr("orientation"));
             dir = clockwise ? rotate_cw(dir) : rotate_ccw(dir);
             Stone::setAttr("orientation", dir);

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-09-03 22:27:59 UTC (rev 1300)
+++ trunk/src/stones.cc	2008-09-04 11:50:38 UTC (rev 1301)
@@ -261,7 +261,7 @@
        || ((ms_e & pm) && (ms_n & p) && (ms_se & p))
        || ((ms_e & pm) && (ms_s & p) && (ms_ne & p)))
     {
-        ReplaceStone(this_pos, MakeStone("st-death"));
+        ReplaceStone(this_pos, MakeStone("st_death"));
         // recheck neighboring stones
         // avoid endless loop with bool freeze_check_running
         if (Stone *st = GetStone(this_pos))



From andreasl at mail.berlios.de  Thu Sep  4 13:54:21 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Thu, 4 Sep 2008 13:54:21 +0200
Subject: [Enigma-game-svn] r1302 - team_levelpacks/team_test_new_api
Message-ID: <200809041154.m84BsLOv021538@sheep.berlios.de>

Author: andreasl
Date: 2008-09-04 13:54:20 +0200 (Thu, 04 Sep 2008)
New Revision: 1302

Modified:
   team_levelpacks/team_test_new_api/andreasT02_1.xml
Log:
Test Level new API:
 - Repair/update libmap testlevel.


Modified: team_levelpacks/team_test_new_api/andreasT02_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/andreasT02_1.xml	2008-09-04 11:50:38 UTC (rev 1301)
+++ team_levelpacks/team_test_new_api/andreasT02_1.xml	2008-09-04 11:54:20 UTC (rev 1302)
@@ -2,13 +2,13 @@
 <el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
   <el:protected>
     <el:info el:type="level">
-      <el:identity el:title="Map Handling Luatools" el:subtitle="" el:id="maphandling_andreas"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
+      <el:identity el:title="Test libmap" el:subtitle="" el:id="test_libmap"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="experimental"/>
       <el:author  el:name="Andreas Lochmann" el:email=""/>
       <el:copyright>Copyright ? 2008 Andreas Lochmann</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
       <el:compatibility el:enigma="1.10">
-        <el:dependency el:path="lib/libluatools" el:id="lib/libluatools" el:release="1" el:preload="true"/>
+        <el:dependency el:path="lib/libmap" el:id="lib/libmap" el:release="1" el:preload="true"/>
       </el:compatibility>
       <el:modes el:easy="false" el:single="true" el:network="false"/>
       <el:comments>
@@ -28,12 +28,32 @@
 ti["F "] = {"fl-rough-blue"}
 ti["G "] = {"fl-rough"}
 ti["H "] = {"fl-floor_001"}
+ti["I "] = {"fl-abyss"}
+ti["J "] = {"fl-water"}
 
-ti[" @"] = {"#ac-blackball"}
-ti[" d"] = {"st_death"}
+ti[" "] = {"fl-sahara"}
+ti["A"] = {"fl-leaves"}
+ti["B"] = {"fl-swamp"}
+ti["C"] = {"fl-metal"}
+ti["D"] = {"fl-black"}
+ti["E"] = {"fl-inverse"}
+ti["F"] = {"fl-rough-blue"}
+ti["G"] = {"fl-rough"}
+ti["H"] = {"fl-floor_001"}
+ti["R"] = {"fl-red"}
+
+ti[" @"] = {"#ac-blackball", "marble"}
+ti[" d"] = {"st_death", "death#"}
 ti[" 1"] = {"it_wrench"}
+ti[" S"] = {"st_switch", target = "call_switch1"}
+ti[" T"] = {"st_switch", target = "call_switch2"}
+ti[" U"] = {"st_switch", target = "call_switch3"}
 
-floor = {
+ti["@"] = {"#ac-blackball", "marble"}
+ti["d"] = {"st_death", "death#"}
+ti["1"] = {"it_wrench", "wrench#"}
+
+map1 = wo:newMap(" ", {
 "                    ",
 "         CCCC  DDDD ",
 "         CCCC  DDDD ",
@@ -46,45 +66,74 @@
 "                    ",
 "                    ",
 "                    ",
-"                    "}
+"                    "})
 
-rest = {
-"                    ",
+map2a = wo:newMap(" ", {
+"1",
+" ",
+"   ",
+"",
+"",
+"     @"})
+
+map2b = wo:newMap(" ", {
+"",
+"          1   ",
+"          1",
+"     d    1",
+"          1   ",
+"          1   "})
+
+map2c = wo:newMap(" ", {
 "                1   ",
-"         d      1   ",
+"   d            1   ",
 "                1   ",
 "                1   ",
-"     @          1   ",
-"          d     1   ",
-"                1   ",
-"                1   ",
-"                1   ",
 "           d    1",
 "                1   ",
-"                    "}
+"1                  d"})
 
-new_map = luatools.fuse_map_layers(floor, rest)
+map2 = (map2a .. map2b) + map2c
+map3 = map1 * map2
+map3[{0,0}] = "BS"
+map3[{0, map3.height-1}] = "BT"
+map3[{map3.width-1, 0}] = "BU"
 
-luatools.print_map(floor, "|")
-print("")
-luatools.print_map(rest, "|")
-print("")
-luatools.print_map(new_map, "|")
-print("")
+with_bars = map3 * "|"
+with_bars:print(true, "|")
 
-layers = luatools.split_map_layers(2, new_map)
+levelw, levelh = wo(res.composer(ti), map3)
 
-for _, layer in pairs(layers) do
-  luatools.print_map(layer, "|")
-  print("")
+rect_map = wo:newMap("-", map1)
+function call_switch1()
+  wo:drawMap(ti, {0, 0}, "-", wo:newMap(" ", levelw, levelh))
+  if (rect_map.width > 3) and (rect_map.height > 3) then
+    local sub_map = rect_map:sub({1,1}, rect_map.width-3, rect_map.height-3)
+    rect_map = wo:newMap("R", rect_map.width - 1, rect_map.height - 1)
+    rect_map.defaultkey = "-"
+    rect_map:paste(sub_map, {1, 1})
+  end
+  wo:drawMap(ti, no["marble"], rect_map)
 end
 
-concatted = luatools.concat_maps_vertically(floor, rest)
-luatools.print_map(concatted, "|")
-print("")
+count = 0
+decomap = wo:newMap("-", {"I--J", "I--J", "I--I"}) * " "
+alldirs = {MAP_IDENT,MAP_ROT_CW,MAP_ROT_180,MAP_ROT_CCW,MAP_MIRROR_BACKSLASH,
+           MAP_MIRROR_HORIZONTAL,MAP_MIRROR_SLASH,MAP_MIRROR_VERTICAL}
+function call_switch2()
+  dir = alldirs[count % #alldirs + 1]
+  wo:drawMap(res.composer(ti), {0, 0}, "-", map1)
+  for obj in no["death#*"] do
+    wo:drawMap(res.composer(ti), obj - {1,1}, decomap^dir)
+  end
+  count = count + 1
+end
 
-w, h = wo(res.composer(ti), "  ", new_map)
-
+function call_switch3()
+  map1:replace("G", "A")
+  wo:drawMap(res.composer(ti), {0,0}, map1)
+end
+  
   ]]></el:luamain>
     <el:i18n>
      <el:string el:key="title">



From ral at mail.berlios.de  Thu Sep  4 23:25:59 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 4 Sep 2008 23:25:59 +0200
Subject: [Enigma-game-svn] r1303 - in trunk: data/gfx40 src src/items
	src/stones
Message-ID: <200809042125.m84LPxYY005452@sheep.berlios.de>

Author: ral
Date: 2008-09-04 23:25:57 +0200 (Thu, 04 Sep 2008)
New Revision: 1303

Modified:
   trunk/data/gfx40/sh_window.png
   trunk/src/WorldProxy.cc
   trunk/src/floors.cc
   trunk/src/items.hh
   trunk/src/items/Meditation.cc
   trunk/src/items/Vortex.cc
   trunk/src/lua.cc
   trunk/src/stones.hh
   trunk/src/stones/Door.cc
   trunk/src/stones/Door.hh
   trunk/src/stones/WindowStone.cc
   trunk/src/stones/WindowStone.hh
Log:
Trunk 1.1: new API reengineering
- fix crash on Lua usage of "." instead of ":" on messages - throw error
- fix meditation partial misspelled "vulcano" instead of "volcano"
- adjust global attribute "MeditationForce" to "MeditationStrength"
- center vortex blocking sparkle on destination vortex given by uncentered
  position value
- fire spreading for doors and windows:
  - fire spreads into open doors
  - fire spreads onto window grid if no face on initiator side
  - fire spreads from burning door grid if door is open
  - fire spreads from window grid to grids not blocked by faces
  - spreading feature is fire independent and reusable for water floods
- fix window shadow image gfx40

Modified: trunk/data/gfx40/sh_window.png
===================================================================
(Binary files differ)

Modified: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2008-09-04 11:54:20 UTC (rev 1302)
+++ trunk/src/WorldProxy.cc	2008-09-04 21:25:57 UTC (rev 1303)
@@ -86,7 +86,7 @@
             return server::FlatForce;
         } else if (key == "FrictionFactor") {
             return server::FrictionFactor;
-        } else if (key == "MeditationForce") {
+        } else if (key == "MeditationStrength") {
             return server::HoleForce;
         } else if (key == "IceFriction") {
             return server::IceFriction;
@@ -172,7 +172,7 @@
             server::FlatForce = val;
         } else if (key == "FrictionFactor") {
             server::FrictionFactor = val;
-        } else if (key == "MeditationForce") {
+        } else if (key == "MeditationStrength") {
             server::HoleForce = val;
         } else if (key == "IceFriction") {
             server::IceFriction = val;

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2008-09-04 11:54:20 UTC (rev 1302)
+++ trunk/src/floors.cc	2008-09-04 21:25:57 UTC (rev 1303)
@@ -232,10 +232,9 @@
     // Special case: "st-flrock": No fire at all!
     bool no_closing_stone = true;
     if (Stone *st = GetStone(p)) {
-        string model = st->get_kind();
         if (st->is_movable())
             no_closing_stone = false;
-        else if(!st->is_floating())
+        else if(!st->allowsSpreading(sourcedir))
             return false;
     }
 
@@ -380,26 +379,24 @@
 
 void Floor::on_burnable_animcb(bool justIgnited) {
     GridPos p = get_pos();
-    // Analyse and maybe kill stone: May the fire spread?
-    bool spread = true;
-    if( Stone *st = GetStone(p)) {
-        // Return true on fire-message to allow fire to spread.
-        // Floating stones also allow spreading. Don't use an
-        // OR-statement as the message might kill the stone.
-        spread = st->is_floating();
-        if(to_int(SendMessage(st, "fire")) != 0.0)
-            spread = true;
-    }
+    // 
+    SendMessage(GetStone(p), "fire");
+
     // Will we stop this time with burning?
     bool cont_fire = justIgnited || has_firetype(flft_eternal) || DoubleRand(0,1) < 0.7;
     FloorHeatFlags flhf = (FloorHeatFlags) (flhf_fire
         | (justIgnited ? flhf_first : flhf_fire) | (cont_fire ? flhf_fire : flhf_last));
-    if(spread) {
+
+    Stone *st = GetStone(p);   // stone can be killed due to fire message
+    if (st == NULL || st->allowsSpreading(NORTH))
         heat_neighbor(NORTH, flhf);
+    if (st == NULL || st->allowsSpreading(EAST))
         heat_neighbor(EAST,  flhf);
+    if (st == NULL || st->allowsSpreading(SOUTH))
         heat_neighbor(SOUTH, flhf);
+    if (st == NULL || st->allowsSpreading(WEST))
         heat_neighbor(WEST,  flhf);
-    }
+
     if(cont_fire)
         // continue burning
         //   -> put animation

Modified: trunk/src/items/Meditation.cc
===================================================================
--- trunk/src/items/Meditation.cc	2008-09-04 11:54:20 UTC (rev 1302)
+++ trunk/src/items/Meditation.cc	2008-09-04 21:25:57 UTC (rev 1303)
@@ -240,7 +240,7 @@
         {"it_meditation_dent",  it_meditation_dent,  itf_static | itf_fireproof},
         {"it_meditation_bump",  it_meditation_bump,  itf_static | itf_fireproof},
         {"it_meditation_hill",  it_meditation_hill,  itf_static | itf_fireproof},
-        {"it_meditation_vulcano",  it_meditation_vulcano,  itf_static | itf_fireproof},
+        {"it_meditation_volcano",  it_meditation_volcano,  itf_static | itf_fireproof},
     };
 
     BOOT_REGISTER_START
@@ -250,7 +250,7 @@
         BootRegister(new Meditation(-1), "it_meditation_dent");
         BootRegister(new Meditation(1), "it_meditation_bump");
         BootRegister(new Meditation(2), "it_meditation_hill");
-        BootRegister(new Meditation(3), "it_meditation_vulcano");
+        BootRegister(new Meditation(3), "it_meditation_volcano");
     BOOT_REGISTER_END
 
 } // namespace enigma

Modified: trunk/src/items/Vortex.cc
===================================================================
--- trunk/src/items/Vortex.cc	2008-09-04 11:54:20 UTC (rev 1302)
+++ trunk/src/items/Vortex.cc	2008-09-04 21:25:57 UTC (rev 1303)
@@ -220,7 +220,7 @@
                 if (st && st->is_sticky(actor)) {
                     // is destination vortex blocked? redirect
                     setAttr("$dest_idx", dest_idx + 1);
-                    client::Msg_Sparkle(v_target);
+                    client::Msg_Sparkle(p_target.center());
                     WarpActor(actor, v_target[0], v_target[1], false);
                     GameTimer.set_alarm(this, 0.4, false);
                 }

Modified: trunk/src/items.hh
===================================================================
--- trunk/src/items.hh	2008-09-04 11:54:20 UTC (rev 1302)
+++ trunk/src/items.hh	2008-09-04 21:25:57 UTC (rev 1303)
@@ -93,7 +93,7 @@
         it_meditation_dent,
         it_meditation_bump,
         it_meditation_hill,
-        it_meditation_vulcano,
+        it_meditation_volcano,
         it_odometer,
         it_pencil,
         it_pin,

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-09-04 11:54:20 UTC (rev 1302)
+++ trunk/src/lua.cc	2008-09-04 21:25:57 UTC (rev 1303)
@@ -1374,16 +1374,26 @@
 std::vector<std::string> messageLIFO;
 
 static int objectDirectMessage(lua_State *L) {
+    // object, value
     std::string message = messageLIFO.back();
     messageLIFO.pop_back();
+    if (lua_gettop(L) < 1 || !is_object(L, 1)) {
+        throwLuaError(L, "Message error: no target object - may be caused by usage of '.' instead of ':'");
+        return 0;
+    }
     lua_pushstring(L, message.c_str());
     lua_insert(L, 2);    // message below optional value
     return objectMessage(L);
 }
 
 static int groupDirectMessage(lua_State *L) {
+    // group, value
     std::string message = messageLIFO.back();
     messageLIFO.pop_back();
+    if (lua_gettop(L) < 1 || !is_group(L, 1)) {
+        throwLuaError(L, "Message error: no target group - may be caused by usage of '.' instead of ':'");
+        return 0;
+    }
     lua_pushstring(L, message.c_str());
     lua_insert(L, 2);    // message below optional value
     return groupMessage(L);

Modified: trunk/src/stones/Door.cc
===================================================================
--- trunk/src/stones/Door.cc	2008-09-04 11:54:20 UTC (rev 1302)
+++ trunk/src/stones/Door.cc	2008-09-04 21:25:57 UTC (rev 1303)
@@ -106,6 +106,10 @@
         }
     }
     
+    bool Door::allowsSpreading(Direction dir) const {
+        return state != CLOSED || !has_dir(getFaces(), dir);
+    }
+    
     StoneResponse Door::collision_response(const StoneContact &sc) {
         Direction cf = contact_face(sc);
         if (state == OPEN)

Modified: trunk/src/stones/Door.hh
===================================================================
--- trunk/src/stones/Door.hh	2008-09-04 11:54:20 UTC (rev 1302)
+++ trunk/src/stones/Door.hh	2008-09-04 21:25:57 UTC (rev 1303)
@@ -63,6 +63,7 @@
         // Stone interface
         virtual bool is_floating() const;
         virtual bool is_transparent(Direction d) const;
+        virtual bool allowsSpreading(Direction dir) const;
         virtual StoneResponse collision_response(const StoneContact &sc);
         virtual void actor_hit(const StoneContact &sc);
         virtual const char *collision_sound();

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-09-04 11:54:20 UTC (rev 1302)
+++ trunk/src/stones/WindowStone.cc	2008-09-04 21:25:57 UTC (rev 1303)
@@ -137,6 +137,10 @@
         }
     }
     
+    bool WindowStone::allowsSpreading(Direction dir) const {
+        return !has_dir(getFaces(), dir);
+    }
+    
     void WindowStone::actor_hit(const StoneContact &sc) {
         Actor *a = sc.actor;
             

Modified: trunk/src/stones/WindowStone.hh
===================================================================
--- trunk/src/stones/WindowStone.hh	2008-09-04 11:54:20 UTC (rev 1302)
+++ trunk/src/stones/WindowStone.hh	2008-09-04 21:25:57 UTC (rev 1303)
@@ -66,6 +66,7 @@
         virtual void animcb();
 
         // Stone interface
+        virtual bool allowsSpreading(Direction dir) const;
         virtual void actor_hit(const StoneContact &sc);
         virtual StoneResponse collision_response(const StoneContact &sc);
         virtual const char *collision_sound() {return "glass";}

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-09-04 11:54:20 UTC (rev 1302)
+++ trunk/src/stones.hh	2008-09-04 21:25:57 UTC (rev 1303)
@@ -204,6 +204,11 @@
         virtual bool is_sticky(const Actor *a) const { 
             return !is_floating(); 
         }
+        
+        // Fire and water spreading that is face and state dependent for stones like doors, window
+        virtual bool allowsSpreading(Direction dir) const {
+            return is_floating();
+        }
 
         /* ---------- Stone interface (events) ---------- */
 



From ral at mail.berlios.de  Fri Sep  5 01:04:09 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Fri, 5 Sep 2008 01:04:09 +0200
Subject: [Enigma-game-svn] r1304 - team_levelpacks/team_test_new_api
Message-ID: <200809042304.m84N492P021943@sheep.berlios.de>

Author: ral
Date: 2008-09-05 01:03:51 +0200 (Fri, 05 Sep 2008)
New Revision: 1304

Added:
   team_levelpacks/team_test_new_api/ralT066_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT065_1.xml
Log:
Test Level new API:
- meditation test level updated
- fire - door, window test level added

Modified: team_levelpacks/team_test_new_api/ralT065_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT065_1.xml	2008-09-04 21:25:57 UTC (rev 1303)
+++ team_levelpacks/team_test_new_api/ralT065_1.xml	2008-09-04 23:03:51 UTC (rev 1304)
@@ -16,7 +16,8 @@
     </el:info>
     <el:luamain><![CDATA[
 wo["ConserveLevel"] = true
-wo["MeditationForce"] = 2.0
+wo["MeditationStrength"] = 2.0
+--wo["MeditationStrength"] = -2.0
 
 ti[" "] = {"fl-sahara"}
 

Added: team_levelpacks/team_test_new_api/ralT066_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT066_1.xml	2008-09-04 21:25:57 UTC (rev 1303)
+++ team_levelpacks/team_test_new_api/ralT066_1.xml	2008-09-04 23:03:51 UTC (rev 1304)
@@ -0,0 +1,64 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Fire new API" el:subtitle="" el:id="20080904ral861"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-wood", burnable=true, ignitable=true, secure=true}
+
+ti["w"] = {"st_window_nesw"}
+ti["v"] = {"st_window_ne"}
+ti["u"] = {"st_window_sw"}
+ti["t"] = {"st_window_ns"}
+
+ti["a"] = {"st_door_a", "door#"}
+ti["H"] = {"st_door_d", "door#", faces="ns"}
+ti["V"] = {"st_door_d", "door#", faces="ew"}
+ti["b"] = {"st_door_b", "door#"}
+
+ti["#"] = {"st-rock1"}
+ti["s"] = {"st_switch", target="@door#*"}
+
+ti["e"] = {"it-dynamite"}
+ti["E"] = {"it-extinguisher"}
+
+ti["@"] = {"#ac-blackball"} 
+
+w, h = wo(ti, " ", {
+"         #          ",
+"         V          ",
+"         s          ",
+"#sa###sH####sb######",
+"                    ",
+"                    ",
+"                    ",
+"##sa##    eee  EEE  ",
+" #   #  ### @       ",
+" tttttttt       s###",
+"uv      ###     V   ",
+"  w u   #       V   ",
+"   t    #       V   "
+})
+
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: team_levelpacks/team_test_new_api/ralT066_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Sat Sep  6 00:52:21 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 6 Sep 2008 00:52:21 +0200
Subject: [Enigma-game-svn] r1305 - in trunk: data/schemas src src/stones
Message-ID: <200809052252.m85MqLY3026324@sheep.berlios.de>

Author: ral
Date: 2008-09-06 00:52:18 +0200 (Sat, 06 Sep 2008)
New Revision: 1305

Modified:
   trunk/data/schemas/objects.xml
   trunk/src/items.cc
   trunk/src/stones/BoulderStone.cc
   trunk/src/stones/LightPassengerStone.cc
   trunk/src/stones/PullStone.cc
   trunk/src/stones/RotatorStone.cc
   trunk/src/stones/RubberbandStone.cc
   trunk/src/stones/SwapStone.cc
   trunk/src/stones/Turnstile.cc
   trunk/src/stones/WindowStone.cc
   trunk/src/world.cc
Log:
Trunk 1.1: 
- meditation: just another misspelled "volcano" fix
- temp. fix for blackbomb explosion beneath brake
- fix r1270: actors resting near a passable stone refused move on an actor hit
- window stone fixes:
  - refuse actor entry from other grids on face movement
  - avoid actors being pushed beneath a window face or stone on a face movement
- revert superfluous kill checks on some objects introduced in r1301
  (keep necessary ones on shogun and turnstile)


Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-09-04 23:03:51 UTC (rev 1304)
+++ trunk/data/schemas/objects.xml	2008-09-05 22:52:18 UTC (rev 1305)
@@ -196,7 +196,7 @@
     <object name="it_meditation_hill">
       <attr name="state" value="2"/>
     </object>
-    <object name="it_meditation_vulcano">
+    <object name="it_meditation_volcano">
       <attr name="state" value="3"/>
     </object>
     <object name="it_pipe">

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-09-04 23:03:51 UTC (rev 1304)
+++ trunk/src/items.cc	2008-09-05 22:52:18 UTC (rev 1305)
@@ -1060,8 +1060,8 @@
         void explode() {
             GridPos p = get_pos();
             sound_event ("blackbomb");
-            SendExplosionEffect(p, EXPLOSION_BLACKBOMB);
             replace("it-explosion3");
+            SendExplosionEffect(p, EXPLOSION_BLACKBOMB);  // may kill the bomb by another explosion1 set by brake
         }
     };
     DEF_ITEMTRAITSF(BlackBomb, "it-blackbomb", it_blackbomb,
@@ -1095,7 +1095,7 @@
             GridPos p = get_pos();
             sound_event ("whitebomb");
             replace("it-explosion3");
-            SendExplosionEffect(p, EXPLOSION_WHITEBOMB);
+            SendExplosionEffect(p, EXPLOSION_WHITEBOMB); // may kill the bomb by another explosion1 set by brake
         }
 
     public:

Modified: trunk/src/stones/BoulderStone.cc
===================================================================
--- trunk/src/stones/BoulderStone.cc	2008-09-04 23:03:51 UTC (rev 1304)
+++ trunk/src/stones/BoulderStone.cc	2008-09-05 22:52:18 UTC (rev 1305)
@@ -157,10 +157,8 @@
         if (impulse.sender && impulse.sender->is_kind("st_rotator")) {
             setDir(impulse.dir);  // activate
         }
-        int id = getId();
         move_stone(impulse.dir);  // due to rotator and impulsestone
-        if (Object::getObject(id) != NULL)   // not killed?
-            propagateImpulse(impulse);
+        propagateImpulse(impulse);
     }
 
     Direction BoulderStone::getDir() const {

Modified: trunk/src/stones/LightPassengerStone.cc
===================================================================
--- trunk/src/stones/LightPassengerStone.cc	2008-09-04 23:03:51 UTC (rev 1304)
+++ trunk/src/stones/LightPassengerStone.cc	2008-09-05 22:52:18 UTC (rev 1305)
@@ -172,10 +172,8 @@
         Actor *a = dynamic_cast<Actor*>(impulse.sender);
         if (a == NULL && ((objFlags & OBJBIT_LIGHTNEWDIRS) == NODIRBIT || state == OFF 
                 || server::GameCompatibility != GAMET_ENIGMA)) {
-            int id = getId();
             move_stone(impulse.dir);
-            if (Object::getObject(id) != NULL)   // not killed?
-                propagateImpulse(impulse);
+            propagateImpulse(impulse);
         }
     }
     

Modified: trunk/src/stones/PullStone.cc
===================================================================
--- trunk/src/stones/PullStone.cc	2008-09-04 23:03:51 UTC (rev 1304)
+++ trunk/src/stones/PullStone.cc	2008-09-05 22:52:18 UTC (rev 1305)
@@ -86,8 +86,6 @@
             return;                 // avoid unremoveable and border stones
         }
         
-        int id = getId();
-        
         PullStone *vanishStone = dynamic_cast<PullStone *>(MakeObject("st_pull"));
         vanishStone->state = VANISHING;
         
@@ -124,11 +122,9 @@
         }
         vanishStone->setAttr("$frozen_actors", actors);
 
-        if (Object::getObject(id) != NULL) {  // not killed?
-            sound_event("moveslow");
-            propagateImpulse(impulse);
-        }
-    }
+        sound_event("moveslow");
+        propagateImpulse(impulse);
+     }
     
     void PullStone::alarm() {
         if (state == APPEARING) {

Modified: trunk/src/stones/RotatorStone.cc
===================================================================
--- trunk/src/stones/RotatorStone.cc	2008-09-04 23:03:51 UTC (rev 1304)
+++ trunk/src/stones/RotatorStone.cc	2008-09-05 22:52:18 UTC (rev 1305)
@@ -118,10 +118,8 @@
 
     void RotatorStone::on_impulse(const Impulse& impulse) {
         if (objFlags & OBJBIT_MOVABLE) {
-            int id = getId();
             move_stone(impulse.dir);
-            if (Object::getObject(id) != NULL)   // not killed?
-                propagateImpulse(impulse);
+            propagateImpulse(impulse);
         }
     }
     

Modified: trunk/src/stones/RubberbandStone.cc
===================================================================
--- trunk/src/stones/RubberbandStone.cc	2008-09-04 23:03:51 UTC (rev 1304)
+++ trunk/src/stones/RubberbandStone.cc	2008-09-05 22:52:18 UTC (rev 1305)
@@ -68,11 +68,8 @@
     void RubberbandStone::on_impulse (const Impulse& impulse) {
         Actor *a = dynamic_cast<Actor *>(impulse.sender);
         if (a && player::WieldedItemIs (a, "it_magicwand")) {
-            int id = getId();
             move_stone(impulse.dir);
-            if (Object::getObject(id) != NULL)   // not killed?
-                propagateImpulse(impulse);
-        }
+            propagateImpulse(impulse);
     }
 
     DEF_TRAITSM(RubberbandStone, "st_rubberband", st_rubberband, MOVABLE_STANDARD);

Modified: trunk/src/stones/SwapStone.cc
===================================================================
--- trunk/src/stones/SwapStone.cc	2008-09-04 23:03:51 UTC (rev 1304)
+++ trunk/src/stones/SwapStone.cc	2008-09-05 22:52:18 UTC (rev 1305)
@@ -85,8 +85,6 @@
             return;                 // avoid unremoveable and border stones
         }
 
-        int id = getId();
-        
         SwapStone *vanishStone = dynamic_cast<SwapStone *>(MakeObject("st_swap"));
         vanishStone->state = VANISHING;
         
@@ -105,10 +103,8 @@
                 it->on_stonehit(this);
 
         server::IncMoveCounter(1);
-        if (Object::getObject(id) != NULL) {  // not killed?
-            sound_event("moveslow");
-            propagateImpulse(impulse);
-        }
+        sound_event("moveslow");
+        propagateImpulse(impulse);
     }
     
     void SwapStone::alarm() {

Modified: trunk/src/stones/Turnstile.cc
===================================================================
--- trunk/src/stones/Turnstile.cc	2008-09-04 23:03:51 UTC (rev 1304)
+++ trunk/src/stones/Turnstile.cc	2008-09-05 22:52:18 UTC (rev 1305)
@@ -433,10 +433,10 @@
             if (a != stay) {
                 bool clockwise = (a == ROTR);
                 Actor *actor = dynamic_cast<Actor*>(impulse.sender);
-                Log << "Turnstile impulse " << get_id(pivot) << " - "<<st_turnstile_green <<"\n";
+//                Log << "Turnstile impulse " << get_id(pivot) << " - "<<st_turnstile_green <<"\n";
                 if (get_id(pivot) == st_turnstile_green && actor != NULL &&
                         player::WieldedItemIs(actor, "it_wrench")) {
-                    Log << "Turnstile Wand\n";
+//                    Log << "Turnstile Wand\n";
                     clockwise = !clockwise;
                 }
                 pivot->rotate(clockwise, impulse.sender, this); // ROTR is clockwise
@@ -447,7 +447,7 @@
             move_stone(impulse.dir);
         }
         
-        if (Object::getObject(id) != NULL)   // not killed?
+        if (Object::getObject(id) != NULL)   // not killed - on pivot action?
             propagateImpulse(impulse);
     }
 

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-09-04 23:03:51 UTC (rev 1304)
+++ trunk/src/stones/WindowStone.cc	2008-09-05 22:52:18 UTC (rev 1305)
@@ -216,6 +216,7 @@
     }
     
     bool WindowStone::tryInnerPull(Direction dir, Actor *initiator) {
+        static double eps = 3.0/32;   // thickness of a window face
         DirectionBits faces = getFaces();
         GridPos w_pos(get_pos());
         GridPos w_pos_neighbor = move(w_pos, dir);
@@ -259,13 +260,32 @@
                                 || ((dir == SOUTH) && (dest[1] - r < w_pos.y + 1) && (a_pos == w_pos_neighbor))
                                 || ((dir == NORTH) && (dest[1] + r > w_pos.y) && (a_pos == w_pos_neighbor))) {
                             // we do not have to worry about the level border as no face can be pushed to the border
-                            dest[0] = (dir == EAST) ? (w_pos.x + 1 + r) : ((dir == WEST) ? (w_pos.x - r) : dest[0]);
-                            dest[1] = (dir == SOUTH) ? (w_pos.y + 1 + r): ((dir == NORTH) ? (w_pos.y - r) : dest[1]);
+                            if (dir == EAST || dir == WEST) {
+                                dest[0] = (dir == EAST) ? (w_pos.x + 1 + r) : (w_pos.x - r) ;
+                                if (stone && has_dir(stone->getFaces(), NORTH))
+                                   dest[1] = ecl::Max(dest[1], w_pos.y + r + eps);
+                                else if (GetStone(move(w_pos, NORTH)) != NULL)
+                                   dest[1] = ecl::Max(dest[1], w_pos.y + r);
+                                if (stone && has_dir(stone->getFaces(), SOUTH))
+                                   dest[1] = ecl::Min(dest[1], w_pos.y + 1 - r - eps);
+                                else if (GetStone(move(w_pos, SOUTH)) != NULL)
+                                   dest[1] = ecl::Min(dest[1], w_pos.y + 1 - r);
+                            } else {
+                                dest[1] = (dir == SOUTH) ? (w_pos.y + 1 + r): ((dir == NORTH) ? (w_pos.y - r) : dest[1]);
+                                if (stone && has_dir(stone->getFaces(), WEST))
+                                   dest[0] = ecl::Max(dest[0], w_pos.x + r + eps);
+                                else if (GetStone(move(w_pos, WEST)) != NULL)
+                                   dest[0] = ecl::Max(dest[0], w_pos.x + r);
+                                if (stone && has_dir(stone->getFaces(), EAST))
+                                   dest[0] = ecl::Min(dest[0], w_pos.x + 1 - r - eps);
+                                else if (GetStone(move(w_pos, EAST)) != NULL)
+                                   dest[0] = ecl::Min(dest[0], w_pos.x + 1 - r);
+                            }
                             WarpActor(a, dest[0], dest[1], true);
                         }
                     }
                 }
-                
+                TouchStone(get_pos());  // avoid another actor getting below a moved window face
                 return true;
             }
         }

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-09-04 23:03:51 UTC (rev 1304)
+++ trunk/src/world.cc	2008-09-05 22:52:18 UTC (rev 1305)
@@ -1119,7 +1119,7 @@
         if (Stone *stone = GetStone(sc.stonepos)) {
             stone->actor_contact(sc.actor);
             
-            if (a->get_gridpos() != sc.stonepos) {
+            if (a->get_gridpos() != sc.stonepos && !sc.ignore && sc.response == STONE_REBOUND) {
                 // remove collision forces components from actor-actor collisions 
                 // in direction of stone
                 double normal_component = sc.normal * ai.collforce;            
@@ -2039,6 +2039,8 @@
 
 void TouchStone(GridPos pos) {
     level->changed_stones.push_back(pos);
+    if (level->registerCriticalPositions)
+        level->collisionCriticalPositions.push_back(pos);
 }
 
 void SetScrambleIntensity (int intensity) {



From raoul at mail.berlios.de  Sat Sep  6 23:25:26 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sat, 6 Sep 2008 23:25:26 +0200
Subject: [Enigma-game-svn] r1306 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 src/stones
Message-ID: <200809062125.m86LPQ9O000853@sheep.berlios.de>

Author: raoul
Date: 2008-09-06 23:25:25 +0200 (Sat, 06 Sep 2008)
New Revision: 1306

Added:
   trunk/data/gfx32/it_meditation_bump.png
   trunk/data/gfx32/it_meditation_caldera.png
   trunk/data/gfx32/it_meditation_dent.png
   trunk/data/gfx32/it_meditation_hill.png
   trunk/data/gfx32/it_meditation_hollow.png
   trunk/data/gfx32/it_meditation_volcano.png
   trunk/data/gfx40/it_meditation_bump.png
   trunk/data/gfx40/it_meditation_caldera.png
   trunk/data/gfx40/it_meditation_dent.png
   trunk/data/gfx40/it_meditation_hill.png
   trunk/data/gfx40/it_meditation_hollow.png
   trunk/data/gfx40/it_meditation_volcano.png
   trunk/data/gfx48/it_meditation_bump.png
   trunk/data/gfx48/it_meditation_caldera.png
   trunk/data/gfx48/it_meditation_dent.png
   trunk/data/gfx48/it_meditation_hill.png
   trunk/data/gfx48/it_meditation_hollow.png
   trunk/data/gfx48/it_meditation_volcano.png
Removed:
   trunk/data/gfx32/it-hill.png
   trunk/data/gfx32/it-hollow.png
   trunk/data/gfx32/it-tinyhill.png
   trunk/data/gfx32/it-tinyhollow.png
   trunk/data/gfx40/it-hill.png
   trunk/data/gfx40/it-hollow.png
   trunk/data/gfx40/it-tinyhill.png
   trunk/data/gfx40/it-tinyhollow.png
   trunk/data/gfx48/it-hill.png
   trunk/data/gfx48/it-hollow.png
   trunk/data/gfx48/it-tinyhill.png
   trunk/data/gfx48/it-tinyhollow.png
Modified:
   trunk/data/models-2d.lua
   trunk/src/stones/RubberbandStone.cc
Log:
-> New images for it_meditation{volcano,caldera}
-> Renamed all meditation images
-> Fixed syntax bug (missing })

-> TODO: Better images for volcano, caldera and images for gfx16, gfx64



Deleted: trunk/data/gfx32/it-hill.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/it-hollow.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/it-tinyhill.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/it-tinyhollow.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/it_meditation_bump.png (from rev 1305, trunk/data/gfx32/it-tinyhill.png)


Property changes on: trunk/data/gfx32/it_meditation_bump.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:mergeinfo
   + 

Added: trunk/data/gfx32/it_meditation_caldera.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/it_meditation_caldera.png
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + image/png

Copied: trunk/data/gfx32/it_meditation_dent.png (from rev 1305, trunk/data/gfx32/it-tinyhollow.png)


Property changes on: trunk/data/gfx32/it_meditation_dent.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:mergeinfo
   + 

Copied: trunk/data/gfx32/it_meditation_hill.png (from rev 1305, trunk/data/gfx32/it-hill.png)


Property changes on: trunk/data/gfx32/it_meditation_hill.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:mergeinfo
   + 

Copied: trunk/data/gfx32/it_meditation_hollow.png (from rev 1305, trunk/data/gfx32/it-hollow.png)


Property changes on: trunk/data/gfx32/it_meditation_hollow.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:mergeinfo
   + 

Added: trunk/data/gfx32/it_meditation_volcano.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/it_meditation_volcano.png
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx40/it-hill.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/it-hollow.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/it-tinyhill.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/it-tinyhollow.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/it_meditation_bump.png (from rev 1305, trunk/data/gfx40/it-tinyhill.png)


Property changes on: trunk/data/gfx40/it_meditation_bump.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:mergeinfo
   + 

Added: trunk/data/gfx40/it_meditation_caldera.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/it_meditation_caldera.png
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + image/png

Copied: trunk/data/gfx40/it_meditation_dent.png (from rev 1305, trunk/data/gfx40/it-tinyhollow.png)


Property changes on: trunk/data/gfx40/it_meditation_dent.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:mergeinfo
   + 

Copied: trunk/data/gfx40/it_meditation_hill.png (from rev 1305, trunk/data/gfx40/it-hill.png)


Property changes on: trunk/data/gfx40/it_meditation_hill.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:mergeinfo
   + 

Copied: trunk/data/gfx40/it_meditation_hollow.png (from rev 1305, trunk/data/gfx40/it-hollow.png)


Property changes on: trunk/data/gfx40/it_meditation_hollow.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:mergeinfo
   + 

Added: trunk/data/gfx40/it_meditation_volcano.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/it_meditation_volcano.png
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx48/it-hill.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/it-hollow.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/it-tinyhill.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/it-tinyhollow.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/it_meditation_bump.png (from rev 1305, trunk/data/gfx48/it-tinyhill.png)


Property changes on: trunk/data/gfx48/it_meditation_bump.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:mergeinfo
   + 

Added: trunk/data/gfx48/it_meditation_caldera.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/it_meditation_caldera.png
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + image/png

Copied: trunk/data/gfx48/it_meditation_dent.png (from rev 1305, trunk/data/gfx48/it-tinyhollow.png)


Property changes on: trunk/data/gfx48/it_meditation_dent.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:mergeinfo
   + 

Copied: trunk/data/gfx48/it_meditation_hill.png (from rev 1305, trunk/data/gfx48/it-hill.png)


Property changes on: trunk/data/gfx48/it_meditation_hill.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:mergeinfo
   + 

Copied: trunk/data/gfx48/it_meditation_hollow.png (from rev 1305, trunk/data/gfx48/it-hollow.png)


Property changes on: trunk/data/gfx48/it_meditation_hollow.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:mergeinfo
   + 

Added: trunk/data/gfx48/it_meditation_volcano.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/it_meditation_volcano.png
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + image/png

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-09-05 22:52:18 UTC (rev 1305)
+++ trunk/data/models-2d.lua	2008-09-06 21:25:25 UTC (rev 1306)
@@ -429,10 +429,12 @@
     DefImage("it_key", {filename="it-key"})
     DefImage("it_landmine", {filename="it-landmine"})
     DefImage("it_magicwand", {filename="it-magicwand"})
-    DefImage("it_meditation_hollow", {filename="it-hollow"})
-    DefImage("it_meditation_hill", {filename="it-hill"})
-    DefImage("it_meditation_dent", {filename="it-tinyhollow"})
-    DefImage("it_meditation_bump", {filename="it-tinyhill"})
+    DefImage("it_meditation_hollow", {filename="it_meditation_hollow"})
+    DefImage("it_meditation_hill", {filename="it_meditation_hill"})
+    DefImage("it_meditation_dent", {filename="it_meditation_dent"})
+    DefImage("it_meditation_bump", {filename="it_meditation_bump"})
+    DefImage("it_meditation_volcano", {filename="it_meditation_volcano"})
+    DefImage("it_meditation_caldera", {filename="it_meditation_caldera"})
     DefImage("it_rubberband", {filename="it-rubberband"})
     DefImage("it_sword", {filename="it-sword"})
     DefImage("it_umbrella", {filename="it-umbrella"})

Modified: trunk/src/stones/RubberbandStone.cc
===================================================================
--- trunk/src/stones/RubberbandStone.cc	2008-09-05 22:52:18 UTC (rev 1305)
+++ trunk/src/stones/RubberbandStone.cc	2008-09-06 21:25:25 UTC (rev 1306)
@@ -70,6 +70,7 @@
         if (a && player::WieldedItemIs (a, "it_magicwand")) {
             move_stone(impulse.dir);
             propagateImpulse(impulse);
+        }
     }
 
     DEF_TRAITSM(RubberbandStone, "st_rubberband", st_rubberband, MOVABLE_STANDARD);



From raoul at mail.berlios.de  Sat Sep  6 23:26:51 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sat, 6 Sep 2008 23:26:51 +0200
Subject: [Enigma-game-svn] r1307 - team_levelpacks/team_test_new_api
Message-ID: <200809062126.m86LQpF8001055@sheep.berlios.de>

Author: raoul
Date: 2008-09-06 23:26:50 +0200 (Sat, 06 Sep 2008)
New Revision: 1307

Modified:
   team_levelpacks/team_test_new_api/ralT065_1.xml
Log:
-> Meditation testlevel with volcano, caldera



Modified: team_levelpacks/team_test_new_api/ralT065_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT065_1.xml	2008-09-06 21:25:25 UTC (rev 1306)
+++ team_levelpacks/team_test_new_api/ralT065_1.xml	2008-09-06 21:26:50 UTC (rev 1307)
@@ -27,6 +27,9 @@
 ti["-"] = {"it_meditation_hill", "hilli#", essential=INDISPENSIBLE}
 ti["="] = {"it_meditation_bump", "bumpd#", essential=DISPENSIBLE}
 
+ti["("] = {"it_meditation_volcano"}
+ti[")"] = {"it_meditation_caldera"}
+
 ti["w"] = {"st-wood"}
 ti["d"] = {"it-dynamite"}
 ti["?"] = {"it-spade"}
@@ -38,8 +41,8 @@
 
 w, h = wo(ti, " ", {
 "                    ",
+" (  )   (  )   (  ) ",
 "                    ",
-"                    ",
 "     .    ;    ;    ",
 "                    ",
 "                    ",



From ral at mail.berlios.de  Sun Sep  7 13:04:25 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 7 Sep 2008 13:04:25 +0200
Subject: [Enigma-game-svn] r1308 - in trunk: . data/gfx/flags25x15 po src
Message-ID: <200809071104.m87B4PXx011097@sheep.berlios.de>

Author: ral
Date: 2008-09-07 13:04:22 +0200 (Sun, 07 Sep 2008)
New Revision: 1308

Added:
   trunk/data/gfx/flags25x15/gr-shaded.png
   trunk/data/gfx/flags25x15/gr.png
   trunk/po/el.po
Modified:
   trunk/configure.ac
   trunk/src/nls.hh
Log:
trunk 1.1:
- add Greek language and flag



Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2008-09-06 21:26:50 UTC (rev 1307)
+++ trunk/configure.ac	2008-09-07 11:04:22 UTC (rev 1308)
@@ -10,7 +10,7 @@
 AC_CONFIG_HEADERS([src/config.h])
 AC_GNU_SOURCE
 
-ALL_LINGUAS="de fr nl it es sv ru hu pt fi uk be"
+ALL_LINGUAS="de fr nl it es sv ru hu pt fi uk be el"
 AC_SUBST(ALL_LINGUAS)
 AM_GNU_GETTEXT
 

Added: trunk/data/gfx/flags25x15/gr-shaded.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/gr-shaded.png
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx/flags25x15/gr.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/gr.png
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + image/png

Added: trunk/po/el.po
===================================================================
--- trunk/po/el.po	2008-09-06 21:26:50 UTC (rev 1307)
+++ trunk/po/el.po	2008-09-07 11:04:22 UTC (rev 1308)
@@ -0,0 +1,3195 @@
+msgid ""
+msgstr ""
+"Project-Id-Version: Alexandros Tasos\n"
+"Report-Msgid-Bugs-To: \n"
+"POT-Creation-Date: 2008-07-01 15:29+0200\n"
+"PO-Revision-Date: \n"
+"Last-Translator: \n"
+"Language-Team: \n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=UTF-8\n"
+"Content-Transfer-Encoding: 8bit\n"
+"X-Poedit-Language: Greek\n"
+
+#: src/server.cc:157
+#: src/server.cc:171
+#: src/gui/LevelInspector.cc:201
+msgid "Server Error: could not load level '"
+msgstr "??????: ??? ???? ?????? ? ??????? ??? ???????? '"
+
+#: src/client.cc:68
+#, c-format
+msgid "Mouse speed: %d"
+msgstr "???????? ?????????: %d"
+
+#: src/client.cc:79
+msgid "Another nameless level"
+msgstr "???? ??? ??????? ???????"
+
+#: src/client.cc:83
+msgid " by "
+msgstr " ??? ???/??? "
+
+#: src/client.cc:484
+msgid "Left mouse button:"
+msgstr "???????? ?????? ?????????:"
+
+#: src/client.cc:484
+msgid "Activate/drop leftmost inventory item"
+msgstr "?????/????? ??? ??? ????????? ???????????? ???? ???????"
+
+#: src/client.cc:485
+msgid "Right mouse button:"
+msgstr "???? ?????? ?????????:"
+
+#: src/client.cc:485
+msgid "Rotate inventory items"
+msgstr "?????????? ??? ???????????? ???? ???????"
+
+#: src/client.cc:486
+#: src/gui/LevelMenu.cc:193
+#: src/gui/ScreenshotViewer.cc:34
+msgid "Escape:"
+msgstr "Esc:"
+
+#: src/client.cc:486
+msgid "Show game menu"
+msgstr "???????? ????? ??????????"
+
+#: src/client.cc:487
+msgid "Shift+Escape:"
+msgstr "Shift+Esc:"
+
+#: src/client.cc:487
+msgid "Quit game immediately"
+msgstr "????? ?????? ??? ?? ????????"
+
+#: src/client.cc:488
+msgid "F1:"
+msgstr "F1:"
+
+#: src/client.cc:488
+#: src/gui/LevelMenu.cc:194
+#: src/gui/ScreenshotViewer.cc:35
+msgid "Show this help"
+msgstr "???????? ????? ??? ????????"
+
+#: src/client.cc:489
+msgid "F3:"
+msgstr "F3:"
+
+#: src/client.cc:489
+msgid "Kill current marble"
+msgstr "?????????????? ??? ??????"
+
+#: src/client.cc:490
+msgid "Shift+F3:"
+msgstr "Shift+F3:"
+
+#: src/client.cc:490
+msgid "Restart the current level"
+msgstr "???????????? ????????? ????????"
+
+#: src/client.cc:491
+msgid "F4:"
+msgstr "F4:"
+
+#: src/client.cc:491
+msgid "Skip to next level"
+msgstr "???????? ??? ??????? ???????"
+
+#: src/client.cc:492
+#: src/gui/LevelPackComposer.cc:48
+msgid "F5:"
+msgstr "F5:"
+
+#: src/client.cc:493
+msgid "F6:"
+msgstr "F6:"
+
+#: src/client.cc:493
+msgid "Jump back to last level"
+msgstr "????????? ??? ????????? ???????"
+
+#: src/client.cc:494
+msgid "F10:"
+msgstr "F10:"
+
+#: src/client.cc:494
+msgid "Make screenshot"
+msgstr "?????????? ????????????"
+
+#: src/client.cc:495
+msgid "Left/right arrow:"
+msgstr "????????/???? ?????:"
+
+#: src/client.cc:495
+msgid "Change mouse speed"
+msgstr "?????? ????????? ?????????"
+
+#: src/client.cc:496
+msgid "Alt+x:"
+msgstr "Alt+x:"
+
+#: src/client.cc:496
+msgid "Return to level menu"
+msgstr "????????? ??? ????? ????????"
+
+#: src/client.cc:507
+msgid "Skip to next level for best score hunt"
+msgstr "???????? ??? ??????? ??????? ??? ?????? ????????? ??????"
+
+#: src/client.cc:508
+msgid "Skip to next unsolved level"
+msgstr "???????? ??? ??????? ?? ?????? ???????"
+
+#: src/client.cc:661
+msgid "Too slow for "
+msgstr "???? ????? ?????? ???:"
+
+#: src/client.cc:666
+msgid "You are slow today.. [Ctrl-A]"
+msgstr "????? ????? ??????... [Ctrl+A]"
+
+#: src/client.cc:740
+msgid "Exactly the world record of "
+msgstr "??????? ??? ????????? ????? ???"
+
+#: src/client.cc:742
+msgid "Great! A new world record!"
+msgstr "????????????! ??? ????????? ?????!"
+
+#: src/client.cc:747
+msgid "Again your personal record..."
+msgstr "???? ?? ??????? ??? ?????..."
+
+#: src/client.cc:753
+msgid "New personal record - better than par!"
+msgstr "??? ????????? ????? - ???????? ??? PAR!"
+
+#: src/client.cc:755
+msgid "New personal record, but over par!"
+msgstr "??? ????????? ?????, ???? ???? ??? PAR!"
+
+#: src/client.cc:757
+msgid "New personal record!"
+msgstr "??? ????????? ?????!"
+
+#: src/client.cc:768
+msgid "Your record, "
+msgstr "?? ????? ???,"
+
+#: src/client.cc:775
+msgid "behind world record."
+msgstr "???? ??? ?? ????????? ?????."
+
+#: src/client.cc:777
+msgid "behind your record."
+msgstr "???? ??? ?? ???? ??? ?????."
+
+#: src/client.cc:785
+msgid "Level finished - better than par!"
+msgstr "?? ??????? ???????????? - ???????? ??? ?? PAR!"
+
+#: src/client.cc:787
+msgid "Level finished, but over par!"
+msgstr "?? ??????? ????????????, ???? ???? ??? ?? PAR!"
+
+#: src/client.cc:789
+msgid "Level finished!"
+msgstr "?? ??????? ????????????!"
+
+#: src/client.cc:792
+msgid " Cheater!"
+msgstr " ????????!"
+
+#: src/client.cc:821
+#, c-format
+msgid "Enigma pack %s - level #%d: %s"
+msgstr "?????? %s - ??????? #%d: %s"
+
+#: src/client.cc:831
+msgid "Your record: "
+msgstr "?? ????? ???:"
+
+#: src/client.cc:833
+msgid "World record to beat: "
+msgstr "????????? ????? ??? ?? ???????:"
+
+#: src/main.cc:285
+#, c-format
+msgid "Error in configuration file.\n"
+msgstr "?????? ??? ?????? ?????????.\n"
+
+#: src/main.cc:527
+#: src/main.cc:550
+#, c-format
+msgid "Error Home directory does not exist.\n"
+msgstr "??????: ? ??????? Home ??? ???????.\n"
+
+#: src/main.cc:542
+#, c-format
+msgid "Error Application Data directory does not exist.\n"
+msgstr "??????: ? ??????? Application Data ??? ???????.\n"
+
+#: src/main.cc:570
+#: src/main.cc:619
+#, c-format
+msgid "Error in XML initialization.\n"
+msgstr "?????? ???? ??????? ??? ??????????? XML.\n"
+
+#: src/main.cc:695
+#, c-format
+msgid ""
+"Mac OS X upgrade from Enigma 1.00\n"
+"\n"
+"The default user data path has changed from\n"
+"  %s \n"
+"\n"
+"to the visible data path\n"
+"  %s \n"
+"\n"
+"If ok Enigma will move your data to this new location.\n"
+"Note that you have to restart Enigma once for completion of this update."
+msgstr ""
+"?????????? ??? Enigma 1.00 ??? Mac OS X\n"
+"\n"
+"? ?????? ???????? ????????? ???? ?????????? ???\n"
+"  %s \n"
+"???? ????? ????????\n"
+"  %s \n"
+"\n"
+"?? ??? ???? ???????, ? ???????? ?? ????????? ?? ???????? ??? ??? ??? ????????.\n"
+"????????? ??? ?????????? ???????????? ??? ????????? ??? ?????????? ??? ???????????."
+
+#: src/main.cc:696
+msgid "OK"
+msgstr "???????"
+
+#: src/main.cc:696
+#: src/gui/OptionsMenu.cc:139
+msgid "Never"
+msgstr "????"
+
+#: src/main.cc:696
+msgid "Remind"
+msgstr "??????????"
+
+#: src/main.cc:840
+msgid ""
+"Fatal Error that causes the application to quit:\n"
+"\n"
+msgstr ""
+"??????? ?????? ??? ????????? ??? ???????? ?? ???????????:\n"
+"\n"
+
+#: src/main.cc:842
+#: src/gui/MainMenu.cc:229
+msgid "Quit"
+msgstr "??????"
+
+#: src/gui/MainMenu.cc:68
+#: src/gui/MainMenu.cc:221
+#: src/gui/LevelPackMenu.cc:66
+msgid "Start Game"
+msgstr "?????? ??????????"
+
+#: src/gui/MainMenu.cc:69
+msgid "Join Game"
+msgstr "??????? ?? ????????"
+
+#: src/gui/MainMenu.cc:70
+#: src/gui/ScreenshotViewer.cc:34
+msgid "Back"
+msgstr "????"
+
+#: src/gui/MainMenu.cc:107
+msgid "Main developers of the 1.0 release:"
+msgstr "?????? ??????????? ??? ??????? 1.0:"
+
+#: src/gui/MainMenu.cc:108
+msgid "  RONALD LAMPRECHT (lead)"
+msgstr "  RONALD LAMPRECHT"
+
+#: src/gui/MainMenu.cc:112
+msgid "Special Thanks To:"
+msgstr "??????? ??????????? ?????:"
+
+#: src/gui/MainMenu.cc:113
+msgid "  DANIEL HECK (project founder)"
+msgstr "  DANIEL HECK (?????????? ??? Project)"
+
+#: src/gui/MainMenu.cc:114
+msgid "  MEINOLF SCHNEIDER (game idea, level design)"
+msgstr "  MEINOLF SCHNEIDER (???? ??? ??????????, ?????????? ????????)"
+
+#: src/gui/MainMenu.cc:116
+msgid "Please refer to the manual or the next pages for full credits."
+msgstr "???????? ????????? ??? ?????????? ? ???? ???????? ??????? ??? ????? ????? ??? ???????????."
+
+#: src/gui/MainMenu.cc:118
+msgid "Home Page: http://www.nongnu.org/enigma"
+msgstr "?????? ??????: http://www.nongnu.org/enigma"
+
+#: src/gui/MainMenu.cc:119
+msgid "Contact: enigma-devel at nongnu.org"
+msgstr "???????????: enigma-devel at nongnu.org"
+
+#: src/gui/MainMenu.cc:121
+msgid "Enigma is free software and may be distributed under the"
+msgstr "?? Enigma ????? ?????? ????????? ??? ?????????? ??? ????"
+
+#: src/gui/MainMenu.cc:122
+msgid "terms of the GNU General Public License, version 2."
+msgstr "????? ??? GNU General Public License, ?????? 2."
+
+#: src/gui/MainMenu.cc:124
+msgid "Copyright (C) 2002-2007 Daniel Heck and contributors."
+msgstr "Copyright (C) 2002-2007 Daniel Heck ??? ????????????."
+
+#: src/gui/MainMenu.cc:126
+msgid "Main developer of all releases:"
+msgstr "?????? ??????????????? ???? ??? ????????:"
+
+#: src/gui/MainMenu.cc:140
+msgid "Special Thanks:"
+msgstr "??????? ???????????:"
+
+#: src/gui/MainMenu.cc:153
+msgid "Contributors:"
+msgstr "???????????:"
+
+#: src/gui/MainMenu.cc:222
+#: src/gui/LevelMenu.cc:48
+msgid "Level Pack"
+msgstr "?????? ????????"
+
+#: src/gui/MainMenu.cc:224
+msgid "Network Game"
+msgstr "???????? ?? ??????"
+
+#: src/gui/MainMenu.cc:225
+msgid "Editor"
+msgstr "???????????? ????????"
+
+#: src/gui/MainMenu.cc:227
+#: src/gui/GameMenu.cc:48
+msgid "Options"
+msgstr "????????"
+
+#: src/gui/MainMenu.cc:228
+msgid "Credits"
+msgstr "?????"
+
+#: src/gui/MainMenu.cc:338
+msgid "Preferences Path:"
+msgstr "???????? ???????????:"
+
+#: src/gui/MainMenu.cc:348
+msgid "User Path:"
+msgstr "???????? ??????:"
+
+#: src/gui/MainMenu.cc:358
+msgid "User Image Path:"
+msgstr "???????? ??????? ???????:"
+
+#: src/gui/MainMenu.cc:368
+msgid "System Path:"
+msgstr "???????? ??????????:"
+
+#: src/gui/MainMenu.cc:378
+msgid "Resource Paths:"
+msgstr "???????? ?????? ???????:"
+
+#: src/gui/MainMenu.cc:388
+msgid "L10n Path:"
+msgstr "???????? ??????? ???????:"
+
+#: src/gui/OptionsMenu.cc:92
+#: src/gui/OptionsMenu.cc:113
+msgid "muted"
+msgstr "?? ??????"
+
+#: src/gui/OptionsMenu.cc:126
+msgid "Music in game"
+msgstr "?? ??????? ??? ????????"
+
+#: src/gui/OptionsMenu.cc:126
+msgid "No music in game"
+msgstr "????? ??????? ??? ????????"
+
+#: src/gui/OptionsMenu.cc:131
+#: src/gui/OptionsMenu.cc:135
+#: src/gui/OptionsMenu.cc:261
+msgid "Yes"
+msgstr "???"
+
+#: src/gui/OptionsMenu.cc:131
+#: src/gui/OptionsMenu.cc:135
+#: src/gui/OptionsMenu.cc:261
+msgid "No"
+msgstr "???"
+
+#: src/gui/OptionsMenu.cc:139
+msgid "Auto"
+msgstr "????????"
+
+#: src/gui/OptionsMenu.cc:249
+msgid "reversed"
+msgstr "??????????"
+
+#: src/gui/OptionsMenu.cc:250
+msgid "mono"
+msgstr "??????????"
+
+#: src/gui/OptionsMenu.cc:251
+msgid "normal"
+msgstr "????????"
+
+#: src/gui/OptionsMenu.cc:294
+#: src/gui/LevelInspector.cc:337
+#: src/gui/LevelInspector.cc:353
+#: src/gui/LevelInspector.cc:366
+msgid "unknown"
+msgstr "???????"
+
+#: src/gui/OptionsMenu.cc:408
+msgid "Main"
+msgstr "?????"
+
+#: src/gui/OptionsMenu.cc:410
+msgid "Video"
+msgstr "??????"
+
+#: src/gui/OptionsMenu.cc:412
+msgid "Audio"
+msgstr "????"
+
+#: src/gui/OptionsMenu.cc:414
+msgid "Config"
+msgstr "?????????"
+
+#: src/gui/OptionsMenu.cc:416
+msgid "Paths"
+msgstr "?????????"
+
+#: src/gui/OptionsMenu.cc:435
+#: src/gui/LevelPackComposer.cc:119
+#: src/gui/LevelPackConfig.cc:321
+#: src/gui/LPGroupConfig.cc:102
+#: src/gui/LevelInspector.cc:178
+#: src/gui/HelpMenu.cc:36
+msgid "Ok"
+msgstr "???????"
+
+#: src/gui/OptionsMenu.cc:488
+#: src/gui/OptionsMenu.cc:516
+msgid "Language: "
+msgstr "??????:"
+
+#: src/gui/OptionsMenu.cc:489
+#: src/gui/OptionsMenu.cc:502
+msgid "Fullscreen: "
+msgstr "?????? ?????:"
+
+#: src/gui/OptionsMenu.cc:490
+#: src/gui/OptionsMenu.cc:504
+msgid "Video mode: "
+msgstr "??????? ??????:"
+
+#: src/gui/OptionsMenu.cc:491
+#: src/gui/OptionsMenu.cc:517
+msgid "Mouse speed: "
+msgstr "???????? ?????????:"
+
+#: src/gui/OptionsMenu.cc:492
+#: src/gui/OptionsMenu.cc:510
+msgid "Sound volume: "
+msgstr "?????? ???????? ???:"
+
+#: src/gui/OptionsMenu.cc:493
+#: src/gui/OptionsMenu.cc:511
+msgid "Music volume: "
+msgstr "?????? ????????:"
+
+#: src/gui/OptionsMenu.cc:494
+#: src/gui/OptionsMenu.cc:519
+msgid "Ratings update: "
+msgstr "????????? ??????:"
+
+#: src/gui/OptionsMenu.cc:498
+#: src/gui/OptionsMenu.cc:523
+msgid "User name: "
+msgstr "????? ??????:"
+
+#: src/gui/OptionsMenu.cc:505
+msgid "Gamma correction: "
+msgstr "???????? ????? ??????"
+
+#: src/gui/OptionsMenu.cc:508
+msgid "Sound set: "
+msgstr "??? ????:"
+
+#: src/gui/OptionsMenu.cc:509
+msgid "Menu music: "
+msgstr "??????? ?????:"
+
+#: src/gui/OptionsMenu.cc:512
+msgid "Stereo: "
+msgstr "????????????:"
+
+#: src/gui/OptionsMenu.cc:518
+msgid "Text speed: "
+msgstr "???????? ????????:"
+
+#: src/gui/OptionsMenu.cc:528
+msgid "User path: "
+msgstr "???????? ??????:"
+
+#: src/gui/OptionsMenu.cc:531
+msgid "User image path: "
+msgstr "???????? ??????? ???????:"
+
+#: src/gui/LevelMenu.cc:46
+#: src/gui/LevelPackMenu.cc:67
+msgid "Main Menu"
+msgstr "????? ?????"
+
+#: src/gui/LevelMenu.cc:193
+msgid "Skip to main menu"
+msgstr "???????? ??? ????? ?????"
+
+#: src/gui/LevelMenu.cc:196
+msgid "Arrows:"
+msgstr "????:"
+
+#: src/gui/LevelMenu.cc:196
+msgid "Select level"
+msgstr "??????? ????????"
+
+#: src/gui/LevelMenu.cc:197
+msgid "Return:"
+msgstr "Enter:"
+
+#: src/gui/LevelMenu.cc:197
+#: src/gui/LevelMenu.cc:202
+msgid "Play selected level"
+msgstr "????? ?? ?????????? ???????"
+
+#: src/gui/LevelMenu.cc:198
+msgid "Back/Space:"
+msgstr "Backspace/Spacebar:"
+
+#: src/gui/LevelMenu.cc:198
+msgid "Previous/next levelpack"
+msgstr "???????????/??????? ?????? ????????"
+
+#: src/gui/LevelMenu.cc:199
+msgid "Mark current level as Unsolved"
+msgstr "?????????? ??????????? ???????? ?? ?? ??????????"
+
+#: src/gui/LevelMenu.cc:201
+msgid "Alt+Return:"
+msgstr "Alt+Enter:"
+
+#: src/gui/LevelMenu.cc:201
+msgid "Switch between fullscreen and window"
+msgstr "???????? ?????? ??????? ?????? ??? ?????????"
+
+#: src/gui/LevelMenu.cc:202
+#: src/gui/LevelPackMenu.cc:48
+msgid "Left click:"
+msgstr "???????? ????:"
+
+#: src/gui/LevelMenu.cc:203
+#: src/gui/LevelPackMenu.cc:49
+msgid "Right or control click:"
+msgstr "???? ???? ? Ctrl+????:"
+
+#: src/gui/LevelMenu.cc:203
+msgid "Inspect selected level"
+msgstr "??????????? ??????????? ????????"
+
+#: src/gui/LevelMenu.cc:220
+msgid "Select next level for world record hunt"
+msgstr "??????? ???????? ???????? ??? ?????? ?????????? ?????."
+
+#: src/gui/LevelMenu.cc:222
+msgid "Select next unsolved level"
+msgstr "??????? ???????? ?? ??????? ????????"
+
+#: src/gui/LevelMenu.cc:271
+msgid "You are not allowed to play this level yet."
+msgstr "??? ??????????? ?? ??????? ???? ?? ??????? ?????."
+
+#: src/gui/LevelMenu.cc:307
+#: src/gui/LevelPackComposer.cc:348
+#, c-format
+msgid "%s: %d levels"
+msgstr "%s: %d ???????"
+
+#: src/gui/LevelMenu.cc:323
+#, c-format
+msgid "%d%% best"
+msgstr "%d%% ?? ?????"
+
+#: src/gui/LevelMenu.cc:328
+#, c-format
+msgid "%d%% par, hcp %.1f"
+msgstr "%d%% par, hcp %.1f"
+
+#: src/gui/LevelMenu.cc:332
+#, c-format
+msgid "%d%% solved"
+msgstr "%d%% ??????"
+
+#: src/gui/LevelMenu.cc:367
+#, c-format
+msgid "Your time: %d:%02d"
+msgstr "? ?????? ???: %d:%02d"
+
+#: src/gui/LevelMenu.cc:373
+msgid "That's world record."
+msgstr "???? ????? ????????? ?????."
+
+#: src/gui/LevelMenu.cc:375
+#, c-format
+msgid "That's %d:%02d below world record."
+msgstr "???? ????? %d:%02d ???? ??? ?? ????????? ?????."
+
+#: src/gui/LevelMenu.cc:385
+#, c-format
+msgid "World record: %d:%02d"
+msgstr "????????? ?????: %d: %02d"
+
+#: src/gui/LevelMenu.cc:387
+#, c-format
+msgid "Par: %d:%02d World record: %d:%02d"
+msgstr "Par: %d:%02d ????????? ?????: %d:%02d"
+
+#: src/gui/LevelMenu.cc:401
+#, c-format
+msgid "World record by %s: %d:%02d"
+msgstr "????????? ????? ??? %s: %d:%02d"
+
+#: src/gui/LevelMenu.cc:404
+#, c-format
+msgid "Par: %d:%02d World record by %s: %d:%02d"
+msgstr "Par: %d:%02d ????????? ????? ??? %s: %d:%02d"
+
+#: src/gui/LevelMenu.cc:436
+msgid "No further unsolved level available!"
+msgstr "??? ??????? ????????? ??????? ??? ????!"
+
+#: src/gui/LevelPackComposer.cc:40
+msgid "Shift click:"
+msgstr "Shift+????:"
+
+#: src/gui/LevelPackComposer.cc:40
+msgid "Add to clipboard"
+msgstr "???????? ??? ????????"
+
+#: src/gui/LevelPackComposer.cc:41
+msgid "Shift delete:"
+msgstr "Shift+Delete:"
+
+#: src/gui/LevelPackComposer.cc:41
+msgid "Clear clipboard"
+msgstr "?????????? ?????????"
+
+#: src/gui/LevelPackComposer.cc:42
+msgid "F8:"
+msgstr "F8:"
+
+#: src/gui/LevelPackComposer.cc:42
+msgid "Insert clipboard as reference"
+msgstr "???????? ??? ???????? ?? ???????"
+
+#: src/gui/LevelPackComposer.cc:43
+msgid "F9:"
+msgstr "F9:"
+
+#: src/gui/LevelPackComposer.cc:43
+msgid "Insert clipboard as copy"
+msgstr "???????? ??? ???????? ?? ?????????"
+
+#: src/gui/LevelPackComposer.cc:45
+msgid "Alt left arrow:"
+msgstr "Alt+???????? ?????:"
+
+#: src/gui/LevelPackComposer.cc:45
+msgid "Exchange level with predecessor"
+msgstr "?????????? ???????? ???? ?? ????????"
+
+#: src/gui/LevelPackComposer.cc:46
+msgid "Alt right arrow:"
+msgstr "Alt+???? ?????:"
+
+#: src/gui/LevelPackComposer.cc:46
+msgid "Exchange level with successor"
+msgstr "?????????? ???????? ???? ?? ?????"
+
+#: src/gui/LevelPackComposer.cc:47
+msgid "Delete:"
+msgstr "Delete:"
+
+#: src/gui/LevelPackComposer.cc:47
+msgid "Delete level"
+msgstr "???????? ????????"
+
+#: src/gui/LevelPackComposer.cc:48
+msgid "Update index from levels"
+msgstr "????????? ???? ???????? ??? ?????? ????????"
+
+#: src/gui/LevelPackComposer.cc:53
+msgid "F10"
+msgstr "F10:"
+
+#: src/gui/LevelPackComposer.cc:54
+msgid "Move clipboard levels"
+msgstr "?????????? ???????? ?????????"
+
+#: src/gui/LevelPackComposer.cc:118
+#: src/gui/LevelPackConfig.cc:320
+#: src/gui/LPGroupConfig.cc:101
+#: src/gui/SearchMenu.cc:59
+msgid "Undo"
+msgstr "????????"
+
+#: src/gui/LevelPackComposer.cc:362
+#, c-format
+msgid "Clipboard: %d levels"
+msgstr "????????: %d ???????"
+
+#: src/gui/LevelPackConfig.cc:155
+msgid "Levelpack:"
+msgstr "?????? ????????:"
+
+#: src/gui/LevelPackConfig.cc:156
+msgid "Owner:"
+msgstr "???????:"
+
+#: src/gui/LevelPackConfig.cc:157
+#: src/gui/LPGroupConfig.cc:57
+msgid "Group:"
+msgstr "?????:"
+
+#: src/gui/LevelPackConfig.cc:158
+msgid "Location"
+msgstr "????"
+
+#: src/gui/LevelPackConfig.cc:159
+msgid "in [All Packs]:"
+msgstr "??? [All Packs]:"
+
+#: src/gui/LevelPackConfig.cc:216
+msgid "Edit Metadata"
+msgstr "??????????? ????-?????????"
+
+#: src/gui/LevelPackConfig.cc:219
+msgid "Release:"
+msgstr "??????:"
+
+#: src/gui/LevelPackConfig.cc:220
+msgid "Revision:"
+msgstr "??????????:"
+
+#: src/gui/LevelPackConfig.cc:221
+msgid "Compatibility:"
+msgstr "??????? ??:"
+
+#: src/gui/LevelPackConfig.cc:222
+msgid "Default Location:"
+msgstr "????????????? ????????:"
+
+#: src/gui/LevelPackConfig.cc:223
+msgid "Level types:"
+msgstr "????? ????????:"
+
+#: src/gui/LevelPackConfig.cc:311
+msgid "Please reasign levelpack to another group for group deletion"
+msgstr "???????? ??????????? ?? ?????? ?? ???? ????? ??? ???????? ??? ??????"
+
+#: src/gui/LevelPackConfig.cc:314
+msgid "Compose Pack"
+msgstr "??????? ???????"
+
+#: src/gui/LevelPackConfig.cc:316
+msgid "Update Pack"
+msgstr "????????? ???????"
+
+#: src/gui/LevelPackConfig.cc:395
+msgid "Error: empty title not allowed - press \"Undo\" to exit without modifications"
+msgstr "??????: ??? ??????????? ???? ????? ?????? - ??????? \"????????\" ??? ????? ????? ???????"
+
+#: src/gui/LevelPackConfig.cc:407
+msgid "Error: use only \"a-zA-Z0-9 _-#\" for levelpack title"
+msgstr "??????: ???????????? ???? ?? ?????????? \"a-z ?-? 0-9 _ - #\" ??? ??? ????? ???? ??????? ????????"
+
+#: src/gui/LevelPackConfig.cc:416
+msgid "Error: title already in use - choose another title"
+msgstr "??????: ?????? ?? ????? - ???????? ???? ?????"
+
+#: src/gui/LevelPackMenu.cc:46
+msgid "Left column:"
+msgstr "???????? ?????"
+
+#: src/gui/LevelPackMenu.cc:46
+msgid "Levelpack groups"
+msgstr "?????? ??????? ????????"
+
+#: src/gui/LevelPackMenu.cc:47
+msgid "Right columns:"
+msgstr "?????? ??????:"
+
+#: src/gui/LevelPackMenu.cc:47
+msgid "Levelpacks of selected group"
+msgstr "?????? ???????? ??????????? ??????"
+
+#: src/gui/LevelPackMenu.cc:48
+msgid "Select group or levelpack"
+msgstr "???????? ????? ? ?????? ????????"
+
+#: src/gui/LevelPackMenu.cc:49
+msgid "Configure group or levelpack"
+msgstr "??????? ?????? ? ??????? ????????"
+
+#: src/gui/LevelPackMenu.cc:64
+msgid "New Group"
+msgstr "??? ?????"
+
+#: src/gui/LevelPackMenu.cc:65
+#: src/gui/SearchMenu.cc:60
+msgid "Search"
+msgstr "?????????"
+
+#: src/gui/LPGroupConfig.cc:65
+msgid "Position:"
+msgstr "????:"
+
+#: src/gui/LPGroupConfig.cc:99
+msgid "New Pack"
+msgstr "??? ??????"
+
+#: src/gui/LPGroupConfig.cc:100
+msgid "Delete Group"
+msgstr "???????? ??????"
+
+#: src/gui/LPGroupConfig.cc:130
+msgid "Error: empty group name not allowed - press \"Undo\" to exit without modifications"
+msgstr "??????: ??? ??????????? ???? ????? ?????? - ??????? \"????????\" ??? ????? ????? ?????????????"
+
+#: src/gui/LPGroupConfig.cc:141
+msgid "Error: group name is a duplicate of an existing group"
+msgstr "??????: ?? ????? ????? ??? ?????? ??? ???????"
+
+#: src/gui/LPGroupConfig.cc:146
+msgid "Error: \"Every group\" is a reserved group name"
+msgstr "??????: ?? ????? \"Every group\" ????? ?????????? ????? ??????"
+
+#: src/gui/LPGroupConfig.cc:151
+msgid "Error: group name must not be enclosed in square brackets"
+msgstr "??????: ?? ????? ??? ?????? ??? ?????? ?? ???????????? ?? ???????"
+
+#: src/gui/LPGroupConfig.cc:207
+msgid "Error: group not empty"
+msgstr "??????: ? ????? ??? ????? ????"
+
+#: src/gui/ScreenshotViewer.cc:36
+msgid "Page Up:"
+msgstr "Page Up:"
+
+#: src/gui/ScreenshotViewer.cc:36
+msgid "Show previous screenshot"
+msgstr "???????? ???????????? ????????????"
+
+#: src/gui/ScreenshotViewer.cc:37
+msgid "Page Down:"
+msgstr "Page Down:"
+
+#: src/gui/ScreenshotViewer.cc:37
+msgid "Show next screenshot"
+msgstr "???????? ???????? ????????????"
+
+#: src/gui/ScreenshotViewer.cc:107
+msgid "No screenshot available:"
+msgstr "?? ????????? ???????????:"
+
+#: src/gui/SearchMenu.cc:41
+msgid "Shallow Search:"
+msgstr "???? ?????????:"
+
+#. TRANSLATORS: the translation can have double size of the english text
+#: src/gui/SearchMenu.cc:43
+msgid "case independent search in title, author, filename"
+msgstr "????????? ????? ????????? ????? - ????????? ?? ?????, ?????????, ????? ???????"
+
+#: src/gui/LevelInspector.cc:179
+msgid "Screenshot"
+msgstr "???????????"
+
+#: src/gui/LevelInspector.cc:229
+msgid "Level: "
+msgstr "???????:"
+
+#: src/gui/LevelInspector.cc:231
+#: src/gui/LevelInspector.cc:289
+msgid "Author: "
+msgstr "??????????:"
+
+#: src/gui/LevelInspector.cc:232
+msgid "Contact: "
+msgstr "???????????:"
+
+#: src/gui/LevelInspector.cc:233
+msgid "Homepage: "
+msgstr "??????:"
+
+#: src/gui/LevelInspector.cc:254
+msgid "Public Ratings"
+msgstr "???????? ???????????"
+
+#: src/gui/LevelInspector.cc:256
+msgid "Intelligence: "
+msgstr "?????????:"
+
+#: src/gui/LevelInspector.cc:257
+msgid "Dexterity: "
+msgstr "?????????:"
+
+#: src/gui/LevelInspector.cc:258
+msgid "Patience: "
+msgstr "???????:"
+
+#: src/gui/LevelInspector.cc:259
+msgid "Knowledge: "
+msgstr "?????:"
+
+#: src/gui/LevelInspector.cc:260
+msgid "Speed: "
+msgstr "????????:"
+
+#: src/gui/LevelInspector.cc:261
+msgid "Difficulty: "
+msgstr "????????"
+
+#: src/gui/LevelInspector.cc:282
+msgid "Scores"
+msgstr "??????"
+
+#: src/gui/LevelInspector.cc:285
+msgid "You: "
+msgstr "???:"
+
+#: src/gui/LevelInspector.cc:286
+msgid "World: "
+msgstr "?????????"
+
+#. TRANSLATORS: PAR = professional average rate - an expression used by golfers
+#: src/gui/LevelInspector.cc:288
+msgid "PAR: "
+msgstr "PAR: "
+
+#: src/gui/LevelInspector.cc:290
+msgid "Solved %: "
+msgstr "?????? %:"
+
+#: src/gui/LevelInspector.cc:291
+msgid "Solved #: "
+msgstr "?????? #:"
+
+#: src/gui/LevelInspector.cc:313
+msgid "Version"
+msgstr "??????"
+
+#: src/gui/LevelInspector.cc:316
+msgid "Score: "
+msgstr "??????:"
+
+#: src/gui/LevelInspector.cc:318
+#: src/gui/LevelInspector.cc:322
+msgid "Status: "
+msgstr "?????????"
+
+#: src/gui/LevelInspector.cc:319
+msgid "Release: "
+msgstr "???-??????:"
+
+#: src/gui/LevelInspector.cc:320
+msgid "Revision: "
+msgstr "??????????:"
+
+#: src/gui/LevelInspector.cc:323
+msgid "Control: "
+msgstr "???????:"
+
+#: src/gui/LevelInspector.cc:324
+msgid "Target: "
+msgstr "??????:"
+
+#: src/gui/LevelInspector.cc:331
+#: src/gui/LevelInspector.cc:347
+msgid "stable"
+msgstr "???????"
+
+#: src/gui/LevelInspector.cc:333
+#: src/gui/LevelInspector.cc:349
+msgid "test"
+msgstr "???????????"
+
+#: src/gui/LevelInspector.cc:335
+#: src/gui/LevelInspector.cc:351
+msgid "experimental"
+msgstr "?????????????"
+
+#: src/gui/LevelInspector.cc:345
+msgid "released"
+msgstr "???????????"
+
+#: src/gui/LevelInspector.cc:357
+msgid "force"
+msgstr "??????"
+
+#: src/gui/LevelInspector.cc:360
+msgid "balance"
+msgstr "?????????"
+
+#: src/gui/LevelInspector.cc:363
+msgid "key"
+msgstr "????????????"
+
+#: src/gui/LevelInspector.cc:371
+msgid "time"
+msgstr "??????"
+
+#: src/gui/LevelInspector.cc:372
+msgid "pushes"
+msgstr "???????"
+
+#: src/gui/LevelInspector.cc:373
+msgid "moves"
+msgstr "????????"
+
+#: src/gui/LevelInspector.cc:390
+msgid "World Record Holders: "
+msgstr "??????? ?????????? ?????:"
+
+#: src/gui/LevelInspector.cc:451
+msgid "Credits: "
+msgstr "?????:"
+
+#: src/gui/LevelInspector.cc:462
+msgid "Dedication: "
+msgstr "????????:"
+
+#: src/gui/LevelInspector.cc:473
+msgid "Level Path: "
+msgstr "????????:"
+
+#: src/gui/LevelInspector.cc:493
+msgid "Id: "
+msgstr "??????? ???????:"
+
+#: src/gui/LevelInspector.cc:498
+msgid "Compatibility: "
+msgstr "??????? ??:"
+
+#: src/gui/LevelInspector.cc:506
+msgid "Annotation: "
+msgstr "???????:"
+
+#: src/gui/LevelInspector.cc:511
+msgid "Rating: "
+msgstr "???????????:"
+
+#: src/gui/LevelInspector.cc:513
+msgid "Average: "
+msgstr "????:"
+
+#: src/gui/GameMenu.cc:46
+msgid "Resume Level"
+msgstr "???????? ??????????"
+
+#: src/gui/GameMenu.cc:47
+msgid "Restart Level"
+msgstr "???????????? ????????"
+
+#: src/gui/GameMenu.cc:49
+msgid "Level Info"
+msgstr "???????? ????????"
+
+#: src/gui/GameMenu.cc:50
+msgid "Abort Level"
+msgstr "?????? ??? ?? ???????"
+
+#: src/lev/Proxy.cc:163
+msgid "Error on auto registration of levelfile: "
+msgstr "?????? ???? ???????? ?????????? ??? ???????-????????:"
+
+#: src/lev/Proxy.cc:165
+msgid ""
+"Note: the level will not show up in the \"Auto Folder\" levelpack!\n"
+"\n"
+msgstr ""
+"????????: ?? ??????? ??? ?? ?????????? ??? ?????? \"Auto Folder\"\n"
+"\n"
+
+#: src/lev/Proxy.cc:167
+#: src/lev/PersistentIndex.cc:372
+#: src/d_models.cc:234
+#: src/d_models.cc:247
+#: src/PreferenceManager.cc:181
+#: src/StateManager.cc:177
+msgid "Continue"
+msgstr "????????"
+
+#: src/lev/PersistentIndex.cc:358
+msgid "Error on  update of levelpack index: \n"
+msgstr "?????? ???? ????????? ??? ?????????? ??? ??????? ????????:\n"
+
+#: src/lev/PersistentIndex.cc:360
+msgid ""
+"Note: the current version will be reloaded!\n"
+"\n"
+msgstr ""
+"????????: ? ???????? ?????? ?? ?????????????!\n"
+"\n"
+
+#: src/lev/PersistentIndex.cc:367
+msgid "Error on  registration of levelpack index: \n"
+msgstr "?????? ???? ?????????? ??? ?????????? ??? ??????? ????????:\n"
+
+#: src/lev/PersistentIndex.cc:369
+msgid ""
+"Note: the levelpack will not show up!\n"
+"\n"
+msgstr ""
+"????????: ?? ?????? ???????? ??? ?? ??????????!\n"
+"\n"
+
+#: src/lua.cc:2952
+#, c-format
+msgid "Cannot find '%s'.\n"
+msgstr "??? ???? ?????? ? ?????? ??? '%s'.\n"
+
+#: src/lua.cc:2953
+#: src/lua.cc:2960
+#, c-format
+msgid "Your installation may be incomplete or invalid.\n"
+msgstr "? ??????????? ??? ??????? ?? ????? ????? ? ???????.\n"
+
+#: src/lua.cc:2959
+#, c-format
+msgid "There was an error loading '%s'.\n"
+msgstr "????????????? ?????? ???? ??? ??????? '%s'.\n"
+
+#: src/lua.cc:2961
+#, c-format
+msgid "Error: '%s'\n"
+msgstr "??????: '%s'\n"
+
+#: src/d_models.cc:233
+#: src/d_models.cc:246
+msgid ""
+"\n"
+"\n"
+"This error may cause the application to behave strange!"
+msgstr ""
+"\n"
+"\n"
+"???? ?? ?????? ??????? ?? ???????? ?????????? ??????????? ??? ?????????!"
+
+#  level: "Bye!"
+#  author: "Andreas Lochmann" email ""
+#: po/level_i18n.cc:4
+msgid "But before this, take a look at the final tutorial level Jacob devised for you.   See it as an exam, if you want to.   It's quite difficult, so don't despair if you don't get through it at the first time.   Bye!"
+msgstr "???? ???? ??? ???? ???? ??? ????? ??? ????????? ??????? ??? ??????????? ? Jacob Scott.   ??????? ?? ?? ??? ??????????. ????? ?????? ???????, ??'???? ??? ????????????? ?? ??? ?? ???????? ?? ??? ????? ??????????.  ?????!"
+
+#  level: "Bye!"
+#  author: "Andreas Lochmann" email ""
+#: po/level_i18n.cc:5
+msgid "Well, I hope you enjoyed this tutorial-pack.   You will see most of these levels a second time in the Enigma packs, together with many new and much more difficult ones.   Just don't give up on them!"
+msgstr "??????, ?????? ?? ????????? ???? ?? ??????? ??? ?????????.  ?? ???? ?? ??????????? ??? ???? ??? ??????? ???? ??? ?????? ???????? ??? Enigma ?? ????? ????????? ??? ??? ??????? ???????.  ????? ??? ?? ???????!"
+
+#  level: "Floors 2"
+#  author: "Martin Hawlisch" email ""
+#: po/level_i18n.cc:9
+msgid "The stone with the horse's head is called ''chess stone''. Watch how the other marble hits one of them to move it. The angle is important."
+msgstr "? ????? ?? ?? ?????? ?????? ?????????? ''????? ???????''. ?????????? ??? ? ???? ????? ??????? ??? ??? ?? ??? ???????????. ? ????? ????? ?????????."
+
+#: po/level_i18n.cc:10
+msgid "Now try to move these chess stones onto the triggers. They always move two steps plus one step."
+msgstr "???? ?????????? ?? ???????????? ??? ?????? ??????? ???? ???? ??????????. ????? ????????? ??? ????????? ??? ???."
+
+#: po/level_i18n.cc:14
+msgid "Don't drown in the swamp."
+msgstr "??? ?????????? ??? ?????."
+
+#: po/level_i18n.cc:18
+msgid "This oscillating stone is a timer-stone. You cannot interact with it, but nevertheless be aware when you see one: After some time-period anything might happen ..."
+msgstr "???? ? ????? ??? ???????????? ????? ??? ????? - ?????????????. ??? ??????? ?? ??????????????? ???? ???, ???? ?? ???? ??? ??????????? ?? ???? ???: ???? ??? ???????????? ??????? ???????? ????????? ?????? ?? ??????..."
+
+#: po/level_i18n.cc:19
+msgid "The stones with arrows are one-way-stones. As you might have guessed, you can only pass them in one direction.                Mazes are cherished elements of Enigma - you will see lots of them."
+msgstr "?? ?????? ?? ??????? ????? ?????? ????? ???????????. ???? ?? ????????, ??????? ?? ??? ???????? ???? ??? ??? ??????????.            ?? ?????????? ????? ?????? ???????? ??? Enigma - ?? ???? ???? ???????."
+
+#: po/level_i18n.cc:20
+msgid "Well done!     When you have finished this level, let's play some example levels from the actual Enigma packs!"
+msgstr "???? ??????!  ?? ???????? ?????? ??????? ??? ?? ???????? ?????? ??? Enigma (???? ?????? ???????????? ???? ?? ???????!)"
+
+#: po/level_i18n.cc:24
+msgid "Don't touch everything!"
+msgstr "??? ???????? ?? ?????!"
+
+#: po/level_i18n.cc:28
+msgid "Use the right mouse-button to rotate your inventory,  it's the bar at the bottom of the screen.   And guess what these three items down there can be used to."
+msgstr "????????????? ?? ???? ??????? ??? ????????? ??? ??? ?? ???????????? ?? ??????????? ???? ??????? (??? ??????? ??? ???? ????? ??? ?????????). ??? ??????? ??? ??????? ?? ??????????????? ???? ?? ???????????."
+
+#: po/level_i18n.cc:29
+msgid "There are lots of different items to use in Enigma, as well as special floors and stones.   Let's explore some more of the actual Enigma levels!   And if you have problems with a level - take a look at the manual:   For some levels, there are hints."
+msgstr "???????? ????? ??????????? ??????????? ??? ?? ??????????????? ??? Enigma, ???? ?????? ??? ?????? ?????? ??? ??????.  ?? ????????????? ?????? ??? ?? ???????? ??????? ??? Enigma!  ??? ?? ????? ?????????? ?? ??? ???????, ???? ??? ????? ??? ??????????: ??? ?????? ??????? ???????? ?????."
+
+#: po/level_i18n.cc:33
+msgid "Those doors on the right block your way to the oxyds ... on the left you see some triggers. Maybe they are somehow connected?"
+msgstr "????? ?? ?????? ??? ????? ??? ???????? ?? ????? ??? ??? ?????? oxyd ... ??? ???????? ??????? ??????? ??????????. ????? ???? ?????? ????? ?????????? ?????? ????;"
+
+#: po/level_i18n.cc:37
+msgid "Friction and acceleration depend on the floor type."
+msgstr "? ?????????? ??? ? ??????????? ?????????? ??? ??? ???? ??? ???????."
+
+#: po/level_i18n.cc:41
+msgid "Welcome to Enigma!  This tutorial I (Jacob Scott) made will help you learn how to play."
+msgstr "?????????? ??? Enigma! ???? ?? ???????????? ???????, ??? ?????? ? Jacob Scott, ?? ??? ??????? ??? ?? ???????."
+
+#: po/level_i18n.cc:42
+msgid "You control the black ball.  To pick up an object, just roll over it.  You can bounce off most walls (try it), but avoid the blue floor near the bottom of the room (actually, try falling into it and then restarting the level with the 'Esc' key).  While these messages are being displayed, don't click any buttons or push any keys or the message will stop."
+msgstr "???????? ?? ????? ?????. ??? ?? ????????? ??? ???????????, ????? ????? ??? ???? ???. ??????? ?? ?????????? ????? ????????????? ??????? (???????? ??), ???? ??????? ?? ???? ?????? ??? ???? ????? (? ???????? ?? ?????? ???? ??? ?????????? ?? ??????? ?? ?? ??????? 'Esc'). ??? ???????????? ???? ?? ????????, ??? ?????? ???? ?? ?????? ?????? ??? ????????? ? ???????? ?????? ???????, ????? ?? ?????? ?? ??????????."
+
+#: po/level_i18n.cc:43
+msgid "This is pretty self-explanatory."
+msgstr "???? ????????? ???? ?????? ??? ???? ???."
+
+#: po/level_i18n.cc:44
+msgid "Enigma is full of puzzles of various types.  In the next room, you will encounter your first one."
+msgstr "?? Enigma ????? ?????? ??? ??????? ???????? ?????. ??? ??????? ???????, ?? ??????????? ?? ????? ???."
+
+#: po/level_i18n.cc:45
+msgid "You can't walk on water!  Try pushing the blocks into the water to get to the other side."
+msgstr "??? ??????? ?? ??????????? ???? ??? ????!  ???????? ?? ???????? ?? ?????? ??????? ??? ???? ??? ?? ???????? ????????."
+
+#: po/level_i18n.cc:46
+msgid "Notice that you can't push a row of two or more blocks.  Also, blocks can't be on the same squares as grates but you can."
+msgstr "?????????? ??? ??? ??????? ?? ???????? ??? ????? ??? ??? ? ???????????? ??????. ??????, ?? ?????? ??? ??????? ?? ????? ??? ???? ????????? ?? ??? ?????, ???? ? ????? ??? ??????."
+
+#: po/level_i18n.cc:47
+msgid "There are different types of blocks here.  Those black blocks sink when they fall into water.  The tan blocks don't sink but don't form bridges either."
+msgstr "???????? ??????? ???? ???????? ???.  ???? ?? ????? ??????? ?????????? ??? ????.  ?? ????????? ??????? ??? ?????????? ???? ???? ??????? ?? ????????????? ??????? ?? ????."
+
+#: po/level_i18n.cc:48
+msgid "That thing is a top -- it will destroy your ball if they touch.  Also, as long as you are close enough to it, the top will chase you.  If you die, you will restart at the beginning of the level (if you have any balls left).  Try to find a way to get past and into the next room (you can use the blocks in the center of the room as barricades)."
+msgstr "???? ?? ?????? ????? ???? ?????? -- ?? ??????????? ??? ????? ??? ?? ??? ???????. ??????, ??? ????? ????? ???, ? ?????? ?? ?? ??????. ?? ????????, ?? ?????????????? ??? ??? ???? ??? ???????? (?? ????? ????? ????). ?????????? ?? ????? ???? ????? ?? ?? ???????? ??? ?? ??? ??? ??????? ???????."
+
+#: po/level_i18n.cc:49
+msgid "Good job!  Notice that the top can't go beneath that block with a black outline -- you're safe."
+msgstr "???? ???????! ?????????? ??? ? ?????? ??? ?????? ?? ?????????? ???? ??? ?? ????????? ?? ?? ????? ?????????? -- ????? ???????."
+
+#: po/level_i18n.cc:50
+msgid "Those are different types of floors.  Try going over them."
+msgstr "???? ????? ??????? ???? ???????. ???????? ?? ???????? ???? ??? ????."
+
+#: po/level_i18n.cc:51
+msgid "The grayish floors are slopes.  The white floor is inverse-floor (you will see)."
+msgstr "?? ???????? ?????? ????? ????????? ???????.  ?? ????? ?????? ????? ?????? ??????????? (?? ????)."
+
+#: po/level_i18n.cc:52
+msgid "Watch what happens when you go over those triggers.  See if you can get the extra ball."
+msgstr "?????????? ?? ??????? ???? ?????? ???? ??? ????? ??? ??????????. ??? ?? ??????? ?? ?????? ??? ??????????? ?????."
+
+#: po/level_i18n.cc:53
+msgid "That's dynamite.  Try dropping some next to that yellowish wall (and moving out of the way)."
+msgstr "????? ????? ?????????.  ?????????? ???????? ????? ?? ????? ??? ????????? ????? (??? ????????????)."
+
+#: po/level_i18n.cc:54
+msgid "Try using the spade on the holes caused by the dynamite."
+msgstr "???????? ?? ??????????????? ?? ?????? ???? ?????? ??? ?????????????? ??? ???? ?????????."
+
+#: po/level_i18n.cc:55
+msgid "Those things are bolders -- try moving one of the tan blocks.  Don't fall into the water or abyss (the black floor)."
+msgstr "????? ?? ?????? ?????? ??????????? ?????????????? ?????? -- ?????? ??? ????????? ????? ??? ??? ??? ???????????. ??? ?????? ??? ???? ? ???? ?????? (?? ????? ??????)."
+
+#: po/level_i18n.cc:56
+msgid "Take the magic wand and hit a bolder.  Try to let the row of three bolders pass the large column."
+msgstr "???? ?? ?????? ????? ??? ????? ??? ????????????? ?????. ?????????? ?? ??????? ?? ????? ?? ??? ????? ?????? ??? ???? ?? ??????? ??????? ??? ??? ?????? ?????."
+
+#: po/level_i18n.cc:57
+msgid "Hit it hard enough!"
+msgstr "??????? ?? ?????? ??????!"
+
+#: po/level_i18n.cc:58
+msgid "It appears to be a simple room, but you're getting an extra ball anyway.  Maybe there is a reason ..."
+msgstr "???????? ??? ??? ???? ???????, ???? ????? ? ????? ??? ??????? ??? ?????. ???? ??????? ??????? ????? ..."
+
+#: po/level_i18n.cc:59
+msgid "Try to get the laser beam to hit that black stone, but don't get hit by it!  Use the mirrors to direct the beam."
+msgstr "?????????? ?? ??????????? ??? ?????? ?????? ???? ????? ?????, ???? ??????? ?? ??? ?????????! ????????????? ???? ????????? ??? ?? ??????????? ??? ??????."
+
+#: po/level_i18n.cc:60
+msgid "Many objects change when hit with a laser beam.  Try hitting some of the coins with the laser beam.  Also, try hitting a block over a coin.  Those stones to your right are knights -- you need to fight (hit) them with a sword (in the front of your inventory) to get past."
+msgstr "????? ??????????? ???????? ???? ????????? ??? ??? ?????? ??????. ???????? ?? ????????? ?????? ??????? ?? ??????. ??????, ???????? ?? ???????? ???? ???????? ???? ??? ??? ?????. ?? ?????? ??? ????? ??? ????? ??????? -- ?????? ?? ???? ?????????? (?????????) ?? ??? ????? (?? ?????? ?? ?? ????? ??????????? ??? ??? ???????? ????? ??? ???????? ???), ?? ??? ?? ????????."
+
+#: po/level_i18n.cc:61
+msgid "Do you have any umbrellas?  Each one will give you approximately ten seconds of protection from danger (such as falling)."
+msgstr "????? ????????; ??????? ??? ????? ??????? 10 ??????????? ?????????? ??? ????????? (???? ???????)."
+
+#: po/level_i18n.cc:62
+msgid "Those black stones are fart stones -- they reset all progress made with the oxyd stones.  The other stones are the oxyd stones.  Match them up to win!"
+msgstr "????? ?? ?????? ????? ?????? ???????? -- ?????????? ??? ??? ?????? ??? ???? ????? ?? ??? ?????? oxyd. ?? ????? ?????? ????? ?????? oxyd. ???????? ??? ??? ?? ?????????!"
+
+#: po/level_i18n.cc:63
+msgid "This area at the bottom of the screen is your inventory -- when you pick things up, they go here (there is a maximum of twelve).  To scroll through the inventory, use the right mouse button or the 'tab' key.  To drop or use an object, click the left mouse button.  Some objects, such as documents (like this one), can't be dropped but are instead used.  Those two balls in your inventory are your extra lives -- if you die in this level, you will restart at the beginning of the level if you have any balls left (and you will lose one of the balls)."
+msgstr "? ??????? ??? ???? ????? ??? ?????? ????? ? ??????? ??? -- ???? ????????? ???????????, ????????? ???? (?? ??????? ????? 12 ???????????). ??? ''????????????'' ?? ??????????? ???? ???????, ????????????? ?? ???? ??????? ??? ????????? ? ?? ??????? 'Tab'. ??? ?? ??????? ??? ???????????, ???? ?? ???????? ??????? ??? ?????????. ?????? ???????????, ???? ?? ??????? (??? ?? ????), ??? ??????? ?? ???????, ???? ???????? ????????????????. ????? ?? ??? ?????? ???? ??????? ??? ????? ???? -- ?? ???????? ?? ???? ?? ???????, ?? ?????????????? ??? ??? ???? ??? !
 ????????, ?? ??? ????? ?????? ???? (??? ?? ?????? ???)."
+
+#: po/level_i18n.cc:64
+msgid "Naturally, you're supposed to go through those closed gates at the top of the screen.                         Try going down that slope near the bottom of the room to see what's to the left.                                                         Don't bother with that trigger below the abyss yet.                                 If you could hit that small white ball through the one-way blocks (with the arrows), it might roll down and stop on that trigger.                  You will need to go in with it but you can't go through the white one-way block.                            Take the spoon and use it once the white ball is through (hit it hard)."
+msgstr "???? ?????????? ??? ?????? ?? ???????? ??? ????? ?????? ??? ???? ????? ??? ??????.                    ???????? ?? ??? ??? ???????? ????? ??? ???? ????? ??? ???????? ?? ???? ?? ????.                                                          ??? ?????????? ????? ?? ??? ????????? ???? ??? ??? ??????.                          ?? ????????? ?? ????????? ??? ????? ????? ????? ???? ??? ??? ?????? ?? ?? ???????, ??????? ?? ??????? ???? ??? ?? ?????????? ???? ????????? ??? ????.               ?? ?????????? ?? ????????? ??? ???, ???? ??? ??????? ?? ???????? ??? ?? ????? ????? ???? ???????????.       !
            ???? ?? ??????? ??? ????????????? ?? ???? ? ????? ????? ??????? (????? ??? ??????)."
+
+#: po/level_i18n.cc:65
+msgid "The stone in the top-right of the room is a switch.  Hit it -- it is probably useful.  In this case the switch opens and closes a door (Do you remember a door that you weren't able to open?).  The bluish line is a window -- bridge the water before you do anything with it."
+msgstr "? ????? ??? ???? ???? ????? ????? ???? ?????????. ????? ??? -- ????? ??????? ???????. ?? ????? ??? ????????? ? ????????? ??????? ??? ??????? ??? ????? (??????? ??? ????? ???? ???? ??? ??? ????????? ?? ????????;). ? ???? ?????? ????? ??? ???????? -- ???????? ?? ??? ???? ???? ?????? ?????? ?? ?????."
+
+#: po/level_i18n.cc:66
+msgid "That was a rotor (similar to a top).  Some levels have many rotors and tops to make them difficult.                            However, maybe this rotor has a purpose; maybe you could get it on that trigger near where the spoon was.                      It might be convenient to close the gate."
+msgstr "???? ???? ???? ??????? (???????? ?? ???? ?????).  ?????? ??????? ????? ??????? ??????? ??? ??????? ??? ?? ???????????.                  ???'??? ????, ???? ????? ? ??????? ??????? ??? ?????? ????...           ???? ?? ????????? ?? ??? ???????????? ???? ????????? ????? ??? ???????.          ???? ?? ???????? ?? ?? ???????? ??? ?????."
+
+#: po/level_i18n.cc:70
+msgid "Some stones look exactly like the Oxyd stones!"
+msgstr "??????? ?????? ???????? ??????? ?? ??? ?????? oxyd!"
+
+#: po/level_i18n.cc:74
+msgid "Move all small marbles into the holes. Only one marble per hole is allowed."
+msgstr "?????????? ???? ??? ?????? ?????? ???? ??????. ???? ??? ????? ??? ????? ???????????."
+
+#: po/level_i18n.cc:78
+#: po/level_i18n.cc:4212
+msgid "Take your time ..."
+msgstr "?? ?? ???? ???..."
+
+#: po/level_i18n.cc:82
+msgid "Learn to move your black ball properly."
+msgstr "???? ?? ?????? ??? ????? ????? ????."
+
+#: po/level_i18n.cc:86
+msgid "The bright light beam is a laser beam.   Don't get to close to it!   But it has its uses ...    You can use the mirrors to direct the laser to its targets.   From these, only the light-gray ones are movable, just try it!"
+msgstr "???? ? ????? ????? ????? ??????.   ??? ??? ???? ?????!   ???? ???? ?????? ??????? ...  ??????? ?? ????????? ?? ??????????? ?? ?????? ??? ?????. ??? ??????, ???? ?? ????????????? ??????? ?????????????, ????? ???????? ??! "
+
+#: po/level_i18n.cc:90
+msgid "Levels can be larger than one screen."
+msgstr "?? ??????? ??????? ?? ????? ??????? ?????????? ??? ??? ?????."
+
+#: po/level_i18n.cc:97
+msgid "Prepare for even more mouse gymnastics in the next levels."
+msgstr "???????????? ??? ??????????? ?????????? ?? ?? ??????? ??? ??????? ???????."
+
+#: po/level_i18n.cc:101
+msgid "Careful - you can not swim in the water."
+msgstr "??????? - ??? ??????? ?? ??????????? ??? ????."
+
+#: po/level_i18n.cc:105
+msgid "This wooden block is movable and heavy enough to hold down the trigger on the right.   Try to push it there!"
+msgstr "???? ?? ?????? ??????? ???????? ??? ????? ?????? ???? ??? ?? ???????? ???? ?? ???? ??? ????????? ???? ?? ?????. ?????????? ?? ?? ???????? ????!"
+
+#: po/level_i18n.cc:106
+msgid "Remember?  There are different kinds of floors.  And these are steep ..."
+msgstr "???????; ???????? ??????????? ???? ???????. ??? ???? ????? ????????? ..."
+
+#: po/level_i18n.cc:107
+msgid "Is there more one can do with wooden blocks?   Yes!  Just explore the next levels."
+msgstr "??????? ???? ???????? ??? ????? ?? ???? ?? ?? ?????? ???????; ???! ????? ?????????? ?? ??????? ???????."
+
+#: po/level_i18n.cc:111
+msgid "Remember the colors."
+msgstr "??????? ?? ???????."
+
+#: po/level_i18n.cc:115
+msgid "The blue stones are Oxyd stones. Open them by touching them with your black marble."
+msgstr "?? ???? ?????? ????? ?????? oxyd. ?????? ??? ????????? ??? ?? ??? ????? ????? ???."
+
+#  level: "Timers"
+#  author: "Andreas Lochmann" email ""
+#: po/level_i18n.cc:131
+msgid "Let there be light!"
+msgstr "????????? ???!"
+
+#  level: "Timers"
+#  author: "Andreas Lochmann" email ""
+#: po/level_i18n.cc:150
+msgid "You need to be fast!"
+msgstr "?????? ?? ????? ????????!"
+
+#: po/level_i18n.cc:155
+msgid "It's a ring!"
+msgstr "????? ???? ?????????!"
+
+#: po/level_i18n.cc:171
+#: po/level_i18n.cc:2729
+msgid "Everything's been counted carefully!"
+msgstr "??? ????? ???????? ??????????!"
+
+#: po/level_i18n.cc:172
+#: po/level_i18n.cc:2730
+msgid "Parts of the tubes disappear during detonation!"
+msgstr "???? ??? ??????? ????????????? ???? ??? ??????!"
+
+#: po/level_i18n.cc:182
+msgid "Don't believe all that you see!"
+msgstr "??? ????????? ?,?? ???????!"
+
+#: po/level_i18n.cc:202
+msgid "Free fall with fatal consequences!"
+msgstr "???????? ????? ?? ???????? ?????????!"
+
+#: po/level_i18n.cc:221
+msgid "You really will need every penny!"
+msgstr "?????????? ?? ?????????? ???? ?????!"
+
+#: po/level_i18n.cc:225
+msgid "Umbrellas prevent free fall!"
+msgstr "?? ???????? ?????????? ??? ???????? ?????!"
+
+#: po/level_i18n.cc:254
+msgid "Rotaryrotaryrot..."
+msgstr "?????????????????????..."
+
+#: po/level_i18n.cc:258
+msgid "No problem! Piece of cake!"
+msgstr "?????? ????????! ???? ???????!"
+
+#: po/level_i18n.cc:259
+msgid "It was easy, wasn't it!"
+msgstr "??????, ????;"
+
+#: po/level_i18n.cc:264
+msgid "For heaven's sake ... don't drown!"
+msgstr "??? ????? ??? ????...??? ??????????!"
+
+#: po/level_i18n.cc:268
+msgid "Forget the laser, try using force!"
+msgstr "????? ?? ??????, ????????????? ??????!"
+
+#: po/level_i18n.cc:284
+msgid "Business hours from 8am to 4pm"
+msgstr "???? ???????? ??? 8 ?? ??? 4??"
+
+#: po/level_i18n.cc:295
+#: po/level_i18n.cc:2671
+msgid "It's easier with spikes!"
+msgstr "????? ?????????? ?? ??????!"
+
+#: po/level_i18n.cc:300
+msgid "Nothing but thieves!! Try the mailbox."
+msgstr "?????? ????? ??? ??????!! ???????? ?? ???????????????."
+
+#: po/level_i18n.cc:478
+msgid " . . . There are more than two . . ."
+msgstr "...???????? ??????????? ??? ???..."
+
+#: po/level_i18n.cc:500
+msgid "You can fly for a short time if you use the umbrella."
+msgstr "??????? ?? ???????? ??? ??? ????? ??????? ???????? ??????????????? ??? ???????."
+
+#: po/level_i18n.cc:511
+#: po/level_i18n.cc:925
+#: po/level_i18n.cc:1568
+#: po/level_i18n.cc:2040
+#: po/level_i18n.cc:3114
+#: po/level_i18n.cc:3277
+#: po/level_i18n.cc:3828
+#: po/level_i18n.cc:4229
+msgid "Welcome"
+msgstr "??????????"
+
+#: po/level_i18n.cc:524
+msgid "Same room, new mirrors ..."
+msgstr "???? ???????, ???? ?????????..."
+
+#: po/level_i18n.cc:531
+msgid "Sections which have the same color always turn at the same time and in the same way."
+msgstr "??????? ?? ?? ???? ????? ????? ???????? ???? ??? ???? ?????????? ??? ??? ???? ??????? ??????."
+
+#: po/level_i18n.cc:532
+msgid "Maintenance code: metal-stone-stone-stone-red-yellow-yellow-red-red-stone-stone."
+msgstr "??????? ??????????: ???????-?????-?????-?????-???????-???????-???????-???????-???????-?????-?????."
+
+#: po/level_i18n.cc:537
+msgid "The Grim Reaper"
+msgstr "? ???????? ??? ?????"
+
+#: po/level_i18n.cc:606
+msgid "The Enigmhanoi Towers"
+msgstr "?? ?????? ??? Enigm????"
+
+#: po/level_i18n.cc:608
+msgid "Who speaks, does not know (Lao Tse)"
+msgstr "?????? ??????, ??? ???????? (??? ???)"
+
+#: po/level_i18n.cc:610
+msgid "The wise man laughs (Lao Tse)"
+msgstr "? ????? ???????? ???? (??? ???)"
+
+#: po/level_i18n.cc:612
+msgid "Who knows, does not speak (Lao Tse)"
+msgstr "?????? ???????? ??? ?????? (??? ???)"
+
+#: po/level_i18n.cc:664
+#: po/level_i18n.cc:1467
+msgid "It's a race!"
+msgstr "????? ??? ??????!"
+
+#: po/level_i18n.cc:715
+msgid "The witch of this switch waits for your wish."
+msgstr "????? ? ????????? ????????? ??? ???????? ???."
+
+#: po/level_i18n.cc:717
+msgid "The witch of this switch resets the awale game."
+msgstr "????? ? ????????? ??????????? ?? ???????? ??? Awale."
+
+#: po/level_i18n.cc:719
+msgid "A turn consists in taking the walnuts of a row behind the windowy walls and sowing them 1 by 1 in the following rows."
+msgstr "?? ???? ???? ? ?????????? ??????? ?? ??????? ???? ?????? ??? ?? ????????? ??? ???? ??? ???? ???????? ??????."
+
+#: po/level_i18n.cc:721
+msgid "Warning: What awaits the wailing warrior at the end of a turn? If there are 2 or 3 walnuts in a row, they are a warm award for the warrior, as are the walnuts in the rows which are in the way to this row, if they are 2 or 3 per row."
+msgstr "???????: ?? ????????? ??? ????????? ??? ????? ??? ?????; ?? ???????? ??? ? ???? ??????? ?? ??? ?????, ???????? ??? ??????? ??? ??? ?????????, ???? ??? ???? ?????????? ??????, ?? ???????? ??? ? ???? ??? ?????."
+
+#: po/level_i18n.cc:723
+msgid "Warning: If one warrior's walls are empty, this awesome warrior wins."
+msgstr "???????: ?? ?? ?????? ???? ????????? ????? ?????, ????? ? ?????????? ????????."
+
+#: po/level_i18n.cc:725
+msgid "When a warrior has awarded more than half the walnuts, he wins. What does he win? The way to the waiting oxyds he wants."
+msgstr "???? ???? ?????????? ???????? ??????????? ??? ?? ???? ???????, ??????. ???? ????? ?? ???????; ? ?????? ??? ?? oxyds, ??? ????????."
+
+#: po/level_i18n.cc:727
+msgid "Congratulations! You are the most aware awale player of the valley ..."
+msgstr "????????????! ????? ? ????????? ??????? ??? Awale ???? ??????? ..."
+
+#: po/level_i18n.cc:729
+msgid "Lost in the savannah? Don't wait and walk on the way to the reset switch on the far left ..."
+msgstr "??????? ???? ??????; ??? ?????????? ??? ???? ?? ???????? ??? ????????? ???? - ???? ???????? ..."
+
+#: po/level_i18n.cc:731
+msgid "Validate your choice here."
+msgstr "????????? ??? ??????? ??? ???."
+
+#: po/level_i18n.cc:733
+msgid "Reset the game."
+msgstr "????????? ??? ??????????."
+
+#: po/level_i18n.cc:735
+msgid "A turn consists in taking the stones of a row and sowing them 1 by 1 in one's other rows, counterclockwise, coming back to the beginning."
+msgstr "?? ???? ????, ? ??????? ??????? ??? ?????? ???? ?????? ??? ??? ????????? ??? ???? ??? ???? ?????? ??? ????????? ?? ???? ???????? ??? ???????? ??? ????????????? ???? ????."
+
+#: po/level_i18n.cc:737
+msgid "At the end of a turn, if the last stone falls in a nonempty row, one takes the stones of the facing row if there is any, and repeats a turn."
+msgstr "??? ????? ??? ?????, ?? ? ????????? ????? ????? ?? ??? ?? ???? ?????, ? ??????? ???????? ??? ?????? ??? ?????????? ???? ???????? ????? (?? ????????) ??? ??????????."
+
+#: po/level_i18n.cc:739
+msgid "A turn begins in one of the leftmost rows, unless impossible."
+msgstr "???? ????? ??????? ?? ??? ??? ??? ????????????? ??????, ????? ?? ?? ????? ???????."
+
+#: po/level_i18n.cc:741
+msgid "At the end of the game (if one player cannot move anymore), the player who has the most stones wins."
+msgstr "??? ????? ??? ??????????, ?? ??????? ??? ?????? ?? ???????????, ???? ????? ??? ???? ??? ???????????? ?????? ??????."
+
+#: po/level_i18n.cc:743
+msgid "A yellow stone stands for 10 blue stones (then for 2 brown stones)."
+msgstr "??? ??????? ????? ?????????? ?? 10 ???? ?????? ? ?? ??? ????."
+
+#: po/level_i18n.cc:745
+msgid "A brown stone stands for 5 blue stones."
+msgstr "??? ???? ????? ?????????? ?? 5 ???? ??????."
+
+#: po/level_i18n.cc:747
+msgid "This katro game comes from Madagascar; in Easy mode there is an african Awale."
+msgstr "???? ?? ???????? ?????????? ??? ??? ???????????. ???? ?????? ?????????? ??????? ??? ?????????? Awale?"
+
+#: po/level_i18n.cc:749
+msgid "Only reset or 'Shift+F3' can make things evolve ..."
+msgstr "???? ?? 'Shift+F3' ?????? ?? ????????? ?? ???????? ..."
+
+#: po/level_i18n.cc:804
+msgid "Just a hint: Try the easy-mode first ..."
+msgstr "??? ????? ???????: ???????? ????? ?? ??????? ???? ?????? ?????????? ..."
+
+#: po/level_i18n.cc:805
+msgid "Don't think too long ... it's easy!"
+msgstr "??? ????????? ????...????? ??????!"
+
+#: po/level_i18n.cc:809
+msgid "Beware! Black holes!"
+msgstr "???????! ?????? ??????!"
+
+#: po/level_i18n.cc:814
+msgid "This switch is to validate your guess."
+msgstr "?? ????? ??? ???????? ????????????? ??? ??????? ???."
+
+#: po/level_i18n.cc:816
+msgid "This switch is to reset the game."
+msgstr "????? ? ????????? ?????????? ???? ?????? ????????? ?? ????????."
+
+#: po/level_i18n.cc:818
+msgid "Each color appears once. Each correct color produces whites in the wrong place, blacks in the right one."
+msgstr "???? ????? ??????????? ??? ????. ???? ????? ????? ?? ????? ???? ??????? ????? ??? ???? ????? ????? ?? ????? ???? ?????."
+
+#: po/level_i18n.cc:825
+msgid "Simply 5*12 ..."
+msgstr "???? 5*12..."
+
+#: po/level_i18n.cc:853
+msgid "You'd need a portable box!"
+msgstr "?????????? ??? ?????? ?????!"
+
+#: po/level_i18n.cc:854
+msgid "Congratulations! You found a seed! Try to use it behind the grate (and move away quickly)"
+msgstr "????????????! ????? ?????? ???? ?????! ????????????? ??? ????? ??? ??? ????? (??? ???????????? ???????)."
+
+#: po/level_i18n.cc:855
+msgid "Remember that you can't fill a closed bridge with a box ...                                           but maybe you can use the 3rd seed differently!"
+msgstr "??????? ??? ??? ??????? ?? ???????????? ??? ??????? ?????? ?? ??? ????? ...                                  ???? ???? ??????? ?? ??????????????? ??? 3? ????? ???????????!"
+
+#: po/level_i18n.cc:856
+msgid "There are different kinds of seeds ... Try to use them!"
+msgstr "???????? ??????? ???? ?????? ... ???????? ??!"
+
+#: po/level_i18n.cc:858
+msgid "Noitcerid etisoppo eht yrt! Tuo syaw owt? Rorrim, rorrim ..."
+msgstr "?????????? ???????? ??? ????????! ?????? ???; ?????????, ?????????..."
+
+#: po/level_i18n.cc:872
+msgid "A Stone, a Tree, and Trees be Three,   --   For to Defeat the Enemy,   --   Between Might Lay   --   A Secret Way!   --   (If this you see, press Shift-F3.)"
+msgstr "??? ?????, ??? ?????? ??? ?????? ????, -- ??? ?? ??????? ? ????????,  -- ??????? ??? ?????? ??? ??? ????  --  ??? ??????? ????????!  --  (?? ???? ????? ???, ?? Shift+F3 ?? ???????)."
+
+#: po/level_i18n.cc:888
+msgid "Take some money and build yourself the tools you need."
+msgstr "???? ?????? ??????? ??? ?????? ????? ??? ?? ???????? ??? ??????????."
+
+#: po/level_i18n.cc:897
+msgid "The other document lies and the left wormhole is the right one."
+msgstr "?? ???? ??????? ???? ?????? ??? ? ???????? ????????????? ????? ? ?????."
+
+#: po/level_i18n.cc:900
+msgid "The other document tells the truth and the other wormhole has been left on the right side."
+msgstr "?? ???? ??????? ???? ??? ??????? ??? ? ???? ????????????? ????? ? ???????? ???? ????? ?????."
+
+#: po/level_i18n.cc:916
+msgid "Dedicated to my friend Frank."
+msgstr "?????????? ???? ???? ??? ??? ?????."
+
+#: po/level_i18n.cc:917
+msgid "This level is quite straightforward, isn't it? Just continue .. ;-)"
+msgstr "???? ?? ??????? ????? ???? ??????, ???? ??? ?????; ???? ???????? ... ;-)"
+
+#: po/level_i18n.cc:926
+msgid "Welcome to Enigma II"
+msgstr "????? ????? ??? Enigma II"
+
+#: po/level_i18n.cc:950
+msgid "Road to Eden"
+msgstr "? ?????? ???? ??? ????"
+
+#: po/level_i18n.cc:963
+msgid "Dead end!"
+msgstr "????????!"
+
+#: po/level_i18n.cc:964
+msgid "There are two HIDDEN items!"
+msgstr "???????? ??? ???????? ???????????!"
+
+#: po/level_i18n.cc:965
+msgid "Third stone from the rock is the hole!"
+msgstr "????? ????? ??? ??? ??????? ????? ? ???????!"
+
+#: po/level_i18n.cc:978
+msgid "So,  where  are  the  knights?  -  you'll  be  sorry  you  asked!"
+msgstr "??????, ??? ????? ?? ???????; - ?? ??????? ??? ???????!"
+
+#: po/level_i18n.cc:988
+msgid "Five form twelve!"
+msgstr "????? ??????????? ??????!"
+
+#: po/level_i18n.cc:995
+msgid "One of the puzzle stones needs to be placed onto the trigger field.                       Guess which ... :)"
+msgstr "??? ??? ??? ??????-???? ?????? ?? ??????????? ???? ???? ?????????.                 ??????? ???? ... :)"
+
+#: po/level_i18n.cc:996
+msgid "The level preview might help ..."
+msgstr "? ????????????? ??? ???????? ???? ????????..."
+
+#: po/level_i18n.cc:1000
+msgid "...  now  go  back  and  get  the  hammer!"
+msgstr "...???? ????? ???? ??? ???? ?? ?????!"
+
+#: po/level_i18n.cc:1016
+msgid "Give it another try ..."
+msgstr "??????????????..."
+
+#: po/level_i18n.cc:1032
+msgid "- Meditation -"
+msgstr "- ??????????? -"
+
+#: po/level_i18n.cc:1060
+msgid "And last not least: 3*20 = 60"
+msgstr "??? ?? ??? ?????????: 3*20=60"
+
+#: po/level_i18n.cc:1065
+msgid "You play against Big Brother; each player in turn deletes 1, 2 or 3 stones; the one who deletes the last stone LOOSES!!!"
+msgstr "??????? ???????? ??? ??????? ???????. ???? ??????? ??? ????? ??? ??????? 1, 2 ? 3 ??????. ????? ??? ??????? ??? ????????? ????? ?????!!!"
+
+#: po/level_i18n.cc:1067
+msgid "Now you begin this game."
+msgstr "???? ??????? ???? ?? ????????."
+
+#: po/level_i18n.cc:1069
+msgid "Poor little blackball ... 'SHIFT+F3'!!!"
+msgstr "??????? ????? ?????... 'Shift+F3'!!!"
+
+#: po/level_i18n.cc:1081
+msgid "Our full attention this is worth:           Air and Fire, Water, Earth."
+msgstr "? ?????? ??????? ??? ????? ?????????: ?????, ?????, ???? ??? ??."
+
+#: po/level_i18n.cc:1084
+msgid "And if your answer can?t be found           then shame on you, eyes to the ground!"
+msgstr "??? ?? ? ???? ??? ?????? ?? ??????         ???? ????? ?? ????, ?? ????? ??? ????!"
+
+#: po/level_i18n.cc:1103
+msgid "Some stones are movable."
+msgstr "????????? ?????? ????? ?????????????."
+
+#: po/level_i18n.cc:1104
+msgid "You lost!"
+msgstr "????? ??????!"
+
+#: po/level_i18n.cc:1135
+msgid "Make a Sword, & Umbrella."
+msgstr "?????? ??? ????? ??? ??? ???????."
+
+#: po/level_i18n.cc:1139
+msgid "Do not use too much magic!"
+msgstr "??? ????????????? ????? ??????!"
+
+#: po/level_i18n.cc:1152
+msgid "Press F3 or finish."
+msgstr "???? F3 ? ????????"
+
+#: po/level_i18n.cc:1162
+msgid "is  black  always  beautiful?"
+msgstr "????? ?? ????? ????? ??????;"
+
+#: po/level_i18n.cc:1364
+msgid "A hammer destroys some black stones."
+msgstr "??? ????? ??????????? ??????? ?????? ??????."
+
+#: po/level_i18n.cc:1365
+msgid "Watch out for a disappearing stone."
+msgstr "?????????? ??? ??????????? ?????."
+
+#: po/level_i18n.cc:1384
+msgid "Alfred Nobel says: This is definitely a meditation landscape!"
+msgstr "? ??????? ?????? ????: ???? ????? ??????? ??? ??????? ???????????!"
+
+#: po/level_i18n.cc:1395
+msgid ".moor txen eht ot teg ot syaw owt era erehT"
+msgstr ".??????? ??????? ??? ??? ?? ??? ?????? ??? ????????"
+
+#: po/level_i18n.cc:1414
+msgid "That wasn't fast enough; try F3.                                                                              (Or search for non-solid stones, if you want.)                                                                                                        (But you won't find any.)                                                                                                                  (Really!)"
+msgstr "???? ??? ???? ???? ???????, ???? F3.                                                                     (? ???? ??? ?? ??????? ??????, ?? ??????.)                                                   (???? ??? ?? ????? ?????.)                                                                                                                 (???????!)"
+
+#: po/level_i18n.cc:1415
+msgid "You can believe me: All stones you see in this level are solid!                                                                                      You can really believe me!                                                                               Really!"
+msgstr "??????? ?? ?? ?????????: ???? ?? ?????? ??? ??????? ?? ???? ?? ??????? ????? ???????!                                                        ??????? ???????? ?? ?? ?????????!               ????????!"
+
+#: po/level_i18n.cc:1419
+msgid "! -  DANGER  -  NO TRESPASSING  -  DANGER  - !"
+msgstr "! - ???????! - ???????????? ? ????????? - ??????? - !"
+
+#: po/level_i18n.cc:1439
+msgid "The Flagstone Reaper"
+msgstr "? ???????? ??? ????????????"
+
+#: po/level_i18n.cc:1442
+msgid "No hint today ...    Those flagstones pass away ...    The docu stands alone ...    Why is it so alone?    --    This hint today ...    Why is it on this side ...    The reaper passing by ...    Could know the reason why!     (orig. by Herman's Hermits)   "
+msgstr "????? ??????? ?????? ...  ????? ?? ???????????? ??????? ??????? ...  ? ??????? ????? ????? ...   ????? ????? ???? ?????; ...  ???? ? ??????? ?????? ...   ????? ????? ????????; ...   ? ???????? ??? ??????? ??? ???? ...  ???? ?? ????? ?? ?????!"
+
+#: po/level_i18n.cc:1477
+msgid "Oops ... you're stuck ...     Try again ..."
+msgstr "????...????????...     ??????????????..."
+
+#: po/level_i18n.cc:1478
+msgid "Congratulations, you reached this side ...      but can you get to the oxyds? "
+msgstr "????????????, ??????? ????? ??? ????? ...  ???? ??????? ?? ?????????? ?? oxyds;"
+
+#: po/level_i18n.cc:1479
+msgid "Well done!"
+msgstr "???? ???????!"
+
+#: po/level_i18n.cc:1503
+msgid "Your uncle Sir Blackball has been murdered last night in his manor, in one of his 6 rooms, by one of the weapons which are in the cellar; the suspects are the shy Mrs Peacock, the secret Colonel Mustard, the absent-minded Professor Plum, the mysterious Rev. Green, the nurse Mrs Whiteball, who discovered the corpse, and Miss Scarlett whose beauty might be fatal ... you must find who killed your uncle, where and how."
+msgstr "? ????? ??? ?????? ??????????? ???????????? ???? ?? ????? ???? ?????? ???, ?? ??? ??? ?? ??? ???????, ?? ??? ??? ?? ???? ??? ???????? ??? ??????. ?? ??????? ????? ? ???????? ????? ??????, ? ???????????? ?????????????? ??????????, ? ?????????? ????????? ??????????, ? ????????? ????????????? ????????, ? ??????? ?????? ????? ??????, ??? ????????? ?? ????? ??? ? ????????? ????? ??? ?????? ? ??????? ?????? ?? ????? ????????...?????? ?? ????? ????? ??????? ??? ???? ???, ??? ??? ???."
+
+#: po/level_i18n.cc:1505
+msgid "This room is not the crime scene."
+msgstr "???? ?? ??????? ??? ????? ? ????? ??? ??????????."
+
+#: po/level_i18n.cc:1507
+msgid "The murderer is not Mrs Peacock."
+msgstr "? ????????? ??? ????? ? ????? ??????."
+
+#: po/level_i18n.cc:1509
+msgid "The murderer is not Colonel Mustard."
+msgstr "? ????????? ??? ????? ? ?????????????? ??????????."
+
+#: po/level_i18n.cc:1511
+msgid "The murderer is not Professor Plum."
+msgstr "? ????????? ??? ????? ? ????????? ??????????."
+
+#: po/level_i18n.cc:1513
+msgid "The murderer is not Reverend Green."
+msgstr "? ????????? ??? ????? ? ????????????? ????????."
+
+#: po/level_i18n.cc:1515
+msgid "The murderer is not Mrs Whiteball."
+msgstr "? ????????? ??? ????? ? ????? ??????????."
+
+#: po/level_i18n.cc:1517
+msgid "The murderer is not Miss Scarlett."
+msgstr "? ????????? ??? ????? ? ????????? ?????."
+
+#: po/level_i18n.cc:1519
+msgid "Sir Blackball has not been killed with the bomb."
+msgstr "? ?????? ??????????? ??? ???? ??????????? ?? ?? ?????."
+
+#: po/level_i18n.cc:1521
+msgid "Sir Blackball has not been killed with the dagger."
+msgstr "? ?????? ??????????? ??? ???? ??????????? ?? ?? ???????."
+
+#: po/level_i18n.cc:1523
+msgid "Sir Blackball has not been killed with poison."
+msgstr "? ?????? ??????????? ??? ???? ??????????? ?? ?? ?????????."
+
+#: po/level_i18n.cc:1525
+msgid "Sir Blackball has not been killed with the wrench."
+msgstr "? ?????? ??????????? ??? ???? ??????????? ?? ?? ??????? ??????."
+
+#: po/level_i18n.cc:1527
+msgid "Sir Blackball has not been killed with the candlestick."
+msgstr "? ?????? ??????????? ??? ???? ??????????? ?? ?? ???????."
+
+#: po/level_i18n.cc:1529
+msgid "Sir Blackball has not been killed with the hammer."
+msgstr "? ?????? ??????????? ??? ???? ??????????? ?? ?? ?????."
+
+#: po/level_i18n.cc:1551
+msgid "Paint Ahead!"
+msgstr "???????? ?? ????????????!"
+
+#: po/level_i18n.cc:1569
+msgid "Welcome to Enigma IV"
+msgstr "?????????? ??? Enigma IV"
+
+#: po/level_i18n.cc:1588
+msgid "What a pity, and there's so much paint left ..."
+msgstr "?? ?????, ??? ???? ????????? ???? ????? ??????..."
+
+#: po/level_i18n.cc:1610
+msgid "Danger ... laser beams!"
+msgstr "???????...??????? ??????!"
+
+#: po/level_i18n.cc:1629
+msgid "Too many wooden blocks!  Try the other way ..."
+msgstr "???? ?????? ??????? ??????! ???????? ??? ???? ?????..."
+
+#: po/level_i18n.cc:1630
+msgid "Greetings, adventurer!    The road ahead is long and dangerous, so be careful!"
+msgstr "????????????, ??????????! ? ?????? ??????? ??? ????? ?????? ??? ????????, ??'???? ?? ????? ???????????!"
+
+#: po/level_i18n.cc:1631
+msgid "Well done, adventurer!    Good luck!"
+msgstr "???? ???????, ??????????!  ???? ????!"
+
+#: po/level_i18n.cc:1632
+msgid "Congratulations, adventurer!  You did it!"
+msgstr "???????????? ??????????!    ?? ?????????!"
+
+#: po/level_i18n.cc:1642
+msgid "Don't wake it up!"
+msgstr "??? ?? ?????????!"
+
+#: po/level_i18n.cc:1664
+msgid "Calm down!"
+msgstr "???????!"
+
+#: po/level_i18n.cc:1675
+msgid "The Life Game"
+msgstr "?? ???????? ??? ????"
+
+#: po/level_i18n.cc:1677
+msgid "The nine switches in square serve to configure the initial population."
+msgstr "?? ????? ????????? ?? ????????? ????????? ??? ?????? ????????."
+
+#: po/level_i18n.cc:1679
+msgid "START"
+msgstr "??????"
+
+#: po/level_i18n.cc:1681
+msgid "CLEAR"
+msgstr "??????????"
+
+#: po/level_i18n.cc:1689
+msgid "Wood robbing"
+msgstr "????? ?????"
+
+#: po/level_i18n.cc:1693
+msgid "As long as there is motion around the oxyd-stones, you won't reach them.   So: Don't lose control of the level! It's possible."
+msgstr "??? ??????? ?????? ???? ??? ??? ?????? oxyd, ??? ??????? ?? ??? ????????.  ??'????: ??? ?????? ??? ?????? ??? ????????! ?????????."
+
+#: po/level_i18n.cc:1731
+msgid "when  you've  been  particular  places"
+msgstr "???? ????? ???? ?? ???????? ????"
+
+#: po/level_i18n.cc:1733
+msgid "that  you  know  you've  never  seen  before"
+msgstr "??? ?????? ??? ??? ????? ???????"
+
+#: po/level_i18n.cc:1735
+msgid "can  you  be  sure?"
+msgstr "??????? ?? ????? ????????;"
+
+#: po/level_i18n.cc:1737
+msgid "feel  like  I've  been  here  before"
+msgstr "????? ??? ?? ??? ?????????? ???"
+
+#: po/level_i18n.cc:1739
+msgid "quote:  Iron  Maiden   -   Deja-Vu"
+msgstr "??????: Iron Maiden   -   Deja-Vu"
+
+#: po/level_i18n.cc:1741
+msgid "for  illmind's  deja  vu  try  the  top  left  corner  ..."
+msgstr "??? ?? deja-vu ??? illmind ???????? ??? ???? ???????? ????? ..."
+
+#: po/level_i18n.cc:1760
+msgid "It's a long way ..."
+msgstr "????? ?????? ??????..."
+
+#: po/level_i18n.cc:1770
+msgid "The left-most room is important!"
+msgstr "?? ??? ???????? ??????? ????? ?????????!"
+
+#: po/level_i18n.cc:1771
+msgid "This is the control panel."
+msgstr "????? ????? ? ??????? ???????..."
+
+#: po/level_i18n.cc:1778
+msgid "Flood Control Dam #3 seems rather unstable. Be quick or be dead."
+msgstr "? ??????? ???????? #3 ???????? ?????? ???????. ? ????? ??????? ? ????? ??????."
+
+#: po/level_i18n.cc:1791
+msgid "Remember  to  only  move  enough  stones  to  just  look  into  the  next  room  ..."
+msgstr "??????? ???? ?? ?????????? ??????? ?????? ???? ?? ????????? ????? ?? ????????? ??? ??????? ???????  ..."
+
+#: po/level_i18n.cc:1792
+msgid "You  have  lost  ..."
+msgstr "??????..."
+
+#: po/level_i18n.cc:1850
+msgid "Welcome to the control room. Use the triggers and switches to plan the movement of the turtle. The switches are, clockwise: Add, Run and Restart."
+msgstr "?????????? ??? ?????? ???????. "
+
+#: po/level_i18n.cc:1881
+msgid "I don't believe that you are the Marble. I won't let you pass until you prove me wrong: you have to be faster than my champion!"
+msgstr "??? ??????? ??? ????? ? ??????????. ??? ?? ?? ????? ?? ???????? ??? ???? ??? ?????????? ?? ????????: ?????? ?? ???????? ??? ?????????? ???!"
+
+#: po/level_i18n.cc:1882
+msgid "Congratulations! You may pass!"
+msgstr "????????????, ??????? ?? ????????!"
+
+#: po/level_i18n.cc:1901
+msgid "A castle lies before you ... beware of guardians!"
+msgstr "??? ?????? ????????? ??????? ???...??????? ????? ????????!"
+
+#: po/level_i18n.cc:1917
+msgid "This level is much bigger! Press F3!"
+msgstr "???? ?? ??????? ????? ???? ??????????! ???? F3!"
+
+#: po/level_i18n.cc:1949
+msgid "Risk your life ..."
+msgstr "??????? ?? ??? ???..."
+
+#: po/level_i18n.cc:1962
+msgid "Look ... they're over there!"
+msgstr "????? ... ???? ???? ?????!"
+
+#: po/level_i18n.cc:1966
+msgid "White helps black, black helps white."
+msgstr "? ????? ????? ??? ?????, ? ????? ????? ??? ?????."
+
+#: po/level_i18n.cc:1973
+msgid "Restart with F3 ..."
+msgstr "???????????? ?? F3..."
+
+#: po/level_i18n.cc:1998
+msgid "Don't forget to open the door ..."
+msgstr "??? ?????? ?? ???????? ??? ?????..."
+
+#: po/level_i18n.cc:1999
+msgid "Good Luck!"
+msgstr "???? ????!"
+
+#: po/level_i18n.cc:2000
+msgid "Hurry!"
+msgstr "??????!"
+
+#: po/level_i18n.cc:2001
+msgid "Congratulations! (or try again)"
+msgstr "????????????! (? ?????????? ????)"
+
+#: po/level_i18n.cc:2002
+msgid "Almost finished ..."
+msgstr "?????? ?????????..."
+
+#: po/level_i18n.cc:2012
+msgid "The block near the top-left can move."
+msgstr "? ????? ???? ???????? ?????? ?? ???????????."
+
+#: po/level_i18n.cc:2028
+msgid "One  more  and  you  won't  get  this  hammer  until  you  don't  need  it  anymore!"
+msgstr "??? ??????? ????? ??? ??? ?? ??????? ?? ?????? ???? ?? ?????, ????? ??? ?? ??? ?? ?????????? ???? ???!"
+
+#: po/level_i18n.cc:2032
+msgid "Watch your step!"
+msgstr "??????? ??? ?????!"
+
+#: po/level_i18n.cc:2041
+msgid "Welcome to Enigma III"
+msgstr "?????????? ??? Enigma III"
+
+#: po/level_i18n.cc:2054
+msgid "The danger is not visible!!!"
+msgstr "? ???????? ??? ????? ??????!"
+
+#: po/level_i18n.cc:2058
+msgid "Look closely!"
+msgstr "????? ??????????!"
+
+#: po/level_i18n.cc:2074
+msgid "Sorry for inconvenience, the Bank-O-Mat is empty."
+msgstr "??????????, ???? ? Bank-O-Mat ????? ?????."
+
+#: po/level_i18n.cc:2081
+msgid "Please remember:    42"
+msgstr "???????:       42"
+
+#: po/level_i18n.cc:2097
+msgid "Easy?"
+msgstr "??????;"
+
+#: po/level_i18n.cc:2134
+msgid "Can you see the hidden oxyd stones?"
+msgstr "??????? ?? ???? ??? ????????? ?????? oxyd;"
+
+#: po/level_i18n.cc:2141
+msgid "Sunday, bloody Sunday!"
+msgstr "???????, ?????????? ???????!"
+
+#: po/level_i18n.cc:2157
+msgid "Watch out, slippery!"
+msgstr "???????, ?????????!"
+
+#: po/level_i18n.cc:2164
+msgid "If you haven't won, you've lost!"
+msgstr "?? ??? ????? ????????, ???? ????? ?????!"
+
+#: po/level_i18n.cc:2171
+msgid "Take the key to the left first!"
+msgstr "???? ?? ?????? ??? ???????? ?????!"
+
+#: po/level_i18n.cc:2184
+msgid "It's easier with a shovel!"
+msgstr "????? ?????????? ?? ??? ??????!"
+
+#: po/level_i18n.cc:2269
+msgid "Umbrellas protect!"
+msgstr "?? ???????? ????????????!"
+
+#  level: "Items"
+#  author: "Andreas Lochmann" email ""
+#: po/level_i18n.cc:2303
+msgid "If you think this is too easy, then play -Bavarian Madness-"
+msgstr "?? ???????? ??? ???? ????? ???? ??????, ???????? ?? ??????? -Bavarian Madness-"
+
+#: po/level_i18n.cc:2325
+msgid "Watch out!!"
+msgstr "???????!!"
+
+#: po/level_i18n.cc:2381
+msgid "Translate or let it be translated"
+msgstr "????????? ?? ? ???? ?? ???????????"
+
+#: po/level_i18n.cc:2385
+msgid "Read the right document"
+msgstr "??????? ?? ???? ???????."
+
+#: po/level_i18n.cc:2388
+msgid "The right one, not the right one!"
+msgstr "?? ????, ??? ?? ????!"
+
+#: po/level_i18n.cc:2419
+msgid "Dig in ..."
+msgstr "???? ????..."
+
+#: po/level_i18n.cc:2435
+msgid "Rest on the bright spot for a minute."
+msgstr "?????????? ???? ??? ????? ?????? ??? ??? ?????."
+
+#: po/level_i18n.cc:2436
+msgid "You'll do anything you're told!"
+msgstr "?? ?????? ?,?? ??? ????!"
+
+#: po/level_i18n.cc:2441
+msgid "Did you bring your flag?"
+msgstr "??? ????? ??? ??????;"
+
+#: po/level_i18n.cc:2458
+msgid "Umbreallas protect you against oncomming boulder!"
+msgstr "?? ???????? ?? ???????????? ?? ????????? ?????? ?????????????? ??????!"
+
+#: po/level_i18n.cc:2468
+msgid "Nothing can stop us!"
+msgstr "?????? ??? ??? ???????!"
+
+#: po/level_i18n.cc:2488
+msgid "Some stones and stone rows can be moved!"
+msgstr "??????? ?????? ??? ?????? ?????? ??????? ?? ????????????!"
+
+#: po/level_i18n.cc:2502
+msgid "If you think that's to easy, try \"Difficulty: Normal\"."
+msgstr "?? ???????? ??? ???? ????? ???? ??????, ???????? ?? ??????? ??? ?????????? \"???????\"."
+
+#: po/level_i18n.cc:2504
+msgid "If you think that's to hard, try \"Difficulty: Easy\"."
+msgstr "?? ???????? ??? ???? ????? ???? ???????, ???????? ?? ??????? ??? ?????????? \"??????\"."
+
+#: po/level_i18n.cc:2524
+msgid "... did it!"
+msgstr "?? ?????????!"
+
+#: po/level_i18n.cc:2574
+msgid "Watch out for water holes!"
+msgstr "??????? ?? ??????? ?????!"
+
+#: po/level_i18n.cc:2591
+msgid "Bricks change!"
+msgstr "?? ?????? ????????!"
+
+#: po/level_i18n.cc:2869
+msgid "Make an umbrella."
+msgstr "?????? ??? ???????."
+
+#: po/level_i18n.cc:2901
+msgid "Did you really think this one was so easy!?"
+msgstr "??????? ??????? ??? ???? ?? ???? ???? ??????!;"
+
+#: po/level_i18n.cc:2903
+msgid "Did you forget something?"
+msgstr "????? ?????? ????;"
+
+#: po/level_i18n.cc:2905
+msgid "Go on! There's no way back now!"
+msgstr "????????! ??? ??????? ????????!"
+
+#: po/level_i18n.cc:2907
+msgid "STOP! Not this way! There's a short-cut ..."
+msgstr "????! ??? ??? ??? ??! ??????? ??? ?????????..."
+
+#: po/level_i18n.cc:2909
+msgid "There's a trigger one step to the left. If you could keep it depressed, it would help you a lot if you go back! "
+msgstr "??????? ??? ????????? ??? ???? ????????. ?? ??????? ?? ??? ????????? ????????, ?? ?? ???????? ???? ?? ??? ????!"
+
+#: po/level_i18n.cc:2916
+msgid "If I only had a bag."
+msgstr "?????? ?? ???? ???? ????."
+
+#: po/level_i18n.cc:2917
+msgid "shh ... listen!"
+msgstr "????...????!!!"
+
+#: po/level_i18n.cc:2933
+msgid "Look carefully at everything!"
+msgstr "????? ?????????? ??????!"
+
+#: po/level_i18n.cc:2934
+msgid "Do you need a helping hand?"
+msgstr "????? ?????????? ??? ???? ????????;"
+
+#: po/level_i18n.cc:2944
+msgid "If you have never heard about Brainf***, visit e.g. http://en.wikipedia.org/wiki/Brainfuck before you try to solve this level."
+msgstr "?? ??? ????? ??????? ???? ??? ?? Brainf***, ???? ?.?. ??? http://en.wikipedia.org/wiki/Brainfuck ???? ???????????? ?? ?????? ???? ?? ???????."
+
+#: po/level_i18n.cc:2949
+msgid "When you change the color of one square, the colors of the 2 nearest squares change as well; you must get as many green squares as possible."
+msgstr "???? ???????? ?? ????? ???? ??????????, ?? ????? ??? ??? ?????????? ?????????? ??????? ??????. ?????? ?? ???????? ??? ?? ??????? ??????????? ???????."
+
+#: po/level_i18n.cc:2951
+msgid "You are only allowed to change a color when it is surrounded by the other color."
+msgstr "??????????? ???? ?? ???????? ?? ????? ???? ?????????? ???? ???? ????????? ?????? ?????????? ????? ????????."
+
+#: po/level_i18n.cc:2973
+msgid "Don't get attracted!"
+msgstr "??? ??????? ????!"
+
+#: po/level_i18n.cc:2982
+msgid "Mightie art the Knightes of The Olde Ages who keepe the Elfic Oxyde Stones, and numerous art the Ghostes who lye in the waye to them; many art the adventurers who tryed to steale Aylendil the Sworde but none has ever come back. Hazy is the swampe where the Magick of the Ancients is buryed; the lair of Whiteballs the dragon thu shalt avoyd in feare of awaken him ..."
+msgstr "???????? ????? ?? ??????? ??? ??????????? ?????? ??? ????????? ??? ????? ?????? Oxyd ??? ???????? ?? ???????? ??? ?????????? ??? ????? ????. ?????? ????? ????? ??? ??????????? ?? ??????? ?? ????? ????????, ???? ?????? ??? ????????? ????. ????????? ????? ? ?????? ???? ?? ?????? ??? ??????? ????? ???????. ??? ????? ??? ??????????? ????????? ? ?????? ??? ?????? ?????? ?? ????????? ?? ??? ?????? ?? ??? ????????? ..."
+
+#: po/level_i18n.cc:2986
+msgid "It is not quite that easy."
+msgstr "??? ????? ???? ??????."
+
+#: po/level_i18n.cc:2990
+msgid "This level is symmetric ..."
+msgstr "???? ?? ??????? ????? ??????????..."
+
+#: po/level_i18n.cc:2994
+msgid "Here lies Black Ball the pirate, marooned in the year 1802 after travelling in the wrong direction."
+msgstr "?????? ?????? ? ?????? ?????? ? ????????, ????????????? ?? ???? 1802 ???? ??? ?? ?????? ??? ???? ?? ????? ??????????."
+
+#: po/level_i18n.cc:2995
+msgid "To cure sea sickness hold a large bank note between your teeth and lean over the side."
+msgstr "??? ?? ??????????? ??? ?????? ????? ??? ???????????? ??????? ??? ?????? ??? ??? ????? ???? ???????? ??????."
+
+#: po/level_i18n.cc:3002
+msgid "Warning ... ... thieves!"
+msgstr "???????... ...??????!"
+
+#: po/level_i18n.cc:3007
+msgid "Send me the keys !"
+msgstr "?????? ??? ?? ???????!"
+
+#: po/level_i18n.cc:3009
+msgid "ALL the keys!!!"
+msgstr "??? ?? ???????!!!"
+
+#: po/level_i18n.cc:3019
+msgid "Why has there always to be an active volcano and a village of marble-eating inhabitants on a tropical island?"
+msgstr "????? ?????? ?? ??????? ????? ??? ?????? ????????? ??? ??? ????? ?????????? ???????? ?? ??? ??????? ????;"
+
+#: po/level_i18n.cc:3025
+msgid "The most dangerous animals of the bayou are the alligators, the mosquitoes ... and the zombies! (But the zombies at least, don't move ...)"
+msgstr "?? ??? ?????????? ??? ???? ????????? ???? ????? ?? ??????????, ?? ????????? ... ??? ?? ?????! (??????????? ?? ????? ??? ?????????...)"
+
+#: po/level_i18n.cc:3040
+msgid "Caramba!! El Dictator has muchos pesos in his cristal safe but muchos costa guardia too; Hay!! Poor Bola Negra has only frutos and a lasero!!!"
+msgstr "???????!! ? ?? ???????? ???? ????? ????? ??? ??????????? ?????????????? ???, ???? ??? ??????? ??????? ???? ????? ????????!! ??!! ? ????? ????? ???? ???? ??????? ??? ??? ??????!!!"
+
+#: po/level_i18n.cc:3053
+msgid "No way out?"
+msgstr "??? ??????? ??????;"
+
+#: po/level_i18n.cc:3054
+msgid "Do you miss something?"
+msgstr "????? ?????? ????;"
+
+#: po/level_i18n.cc:3060
+msgid "Pirates Island"
+msgstr "?? ???? ??? ????????"
+
+#: po/level_i18n.cc:3062
+msgid "The pirates have lost several hidden things on this island ..."
+msgstr "?? ???????? ????? ????? ?????? ???????? ?? ???? ?? ????..."
+
+#: po/level_i18n.cc:3081
+msgid "Remember Seed Puzzle 2? There was a similar problem. Or was it Portable Laser ...?"
+msgstr "??????? ?? 'Seed Puzzle 2'; ?????? ??? ???????? ????????. ? ????? ???? ?? 'Portable Laser';"
+
+#: po/level_i18n.cc:3088
+msgid "This is a meditation landscape: put a small marble into every hole ..."
+msgstr "???? ????? ??? ??????? ???????????: ???? ???? ????? ????? ?? ???? ????? ..."
+
+#: po/level_i18n.cc:3115
+msgid "Welcome to Enigma V"
+msgstr "????? ????? ??? Enigma V"
+
+#: po/level_i18n.cc:3141
+msgid "Do you need something?"
+msgstr "????? ?????????? ????;"
+
+#: po/level_i18n.cc:3145
+msgid "You again! We won't let you pass this time! See these Oxyds? You can't reach them unless you rob our Four Holy Items! But they are well guarded! Bwahahahaha!"
+msgstr "???? ???; ??? ?? ?? ???????? ?? ???????? ????? ??? ????! ?? ??????? ???? ?? oxyds; ??? ??????? ?? ?? ??????? ????? ??? ?? ????????? ?? ??????? ???? ???????????! ?????????????!"
+
+#: po/level_i18n.cc:3146
+msgid "Fire burns and destroys ... Want to remove blocking stones? Then dig your way to the Holy Hammer!"
+msgstr "? ????? ????? ??? ???????????... ?????? ?? ?????????? ??? ?????? ??? ??????????; ???? ????? ??? ????? ??? ???? ?? ???? ?????!"
+
+#: po/level_i18n.cc:3147
+msgid "Try again! Bwahahahaha!"
+msgstr "??????????????! ?????????????!"
+
+#: po/level_i18n.cc:3148
+msgid "Earth fills and lasts ... Want to replace missing floors? Then build your way to the Holy Seed!"
+msgstr "? ?? ??????? ??? ??????? ... ?????? ?? ??????????????? ?? ????? ??? ??????? ??? ??????; ???? ????? ??? ????? ??? ???? ??? ???? ?????!"
+
+#: po/level_i18n.cc:3149
+msgid "Air blows and goes by ... Want to jump across the void? Then make your way to the Holy Spring!"
+msgstr "? ????? ??????? ??? ?????? ... ?????? ?? ???????? ????????; ???? ???? ?? ????? ????? ???? ?? ???? ????????!"
+
+#: po/level_i18n.cc:3150
+msgid "Water waves and shifts ... Want to trade minds with your partner? Then find your way to the Holy Yin-Yang!"
+msgstr "?? ???? ????????? ??? ????????????? ... ?????? ?? ??????????? ????? ?? ??? ????? ???; ???? ???? ??? ????? ????? ??? ?? ???? ???-??????!"
+
+#: po/level_i18n.cc:3161
+msgid "Catwalk Meditation"
+msgstr "??????????? ?? ?????????"
+
+#: po/level_i18n.cc:3165
+msgid "This is my first landscape, dedicated to my father. I hope you'll enjoy it!"
+msgstr "???? ????? ?? ????? ??? ???????, ?????????? ???? ?????? ???. ?????? ?? ??? ??????!"
+
+#: po/level_i18n.cc:3169
+msgid "Don't get too attracted!"
+msgstr "??? ???????? ??????????!"
+
+#: po/level_i18n.cc:3197
+msgid "Try the easy mode first ..."
+msgstr "???????? ?? ??????? ????? ???? ?????? ??????????."
+
+#: po/level_i18n.cc:3212
+msgid "April 1st"
+msgstr "???????????"
+
+#: po/level_i18n.cc:3214
+msgid "Do you REALLY want to do this???"
+msgstr "?????? ?????????? ?? ?? ?????? ????;;;"
+
+#: po/level_i18n.cc:3216
+msgid "Didn't your mother tell you that you should not spend your money in such a careless manner?"
+msgstr "??? ??? ????? ???? ? ?????? ??? ?? ??? ???????? ?? ??????? ??? ?? ????? ??? ?????;"
+
+#: po/level_i18n.cc:3218
+msgid "What is the current month?"
+msgstr "?? ???? ?????? ????;"
+
+#: po/level_i18n.cc:3220
+msgid "What is this level's name?"
+msgstr "??? ?????????? ???? ?? ???????;"
+
+#: po/level_i18n.cc:3227
+msgid "Beware, stranger! The ancient gods of Enigma have set many traps to protect their holy Oxyds! You will have to get through the Four Tests to prove your worth!"
+msgstr "???????, ????! ?? ??????? ???? ??? Enigma ????? ??????????? ?????? ??????? ??? ?? ???????????? ?? ???? oxyds! ?? ?????? ?? ???????? ??? ???????? ?????????? ??? ?? ?????????? ??? ???? ???!"
+
+#: po/level_i18n.cc:3228
+msgid "Prove your speed in the Test of Fire!"
+msgstr "???????? ??? ???????? ??? ??? ????????? ??? ??????!"
+
+#: po/level_i18n.cc:3229
+msgid "You have proven your worth! The ancients grant you a FLAG!"
+msgstr "????????? ??? ???? ???! ?? ???? ??? ???????? ??? ??????!"
+
+#: po/level_i18n.cc:3230
+msgid "Prove your intelligence in the Test of Earth!"
+msgstr "???????? ??? ????????? ??? ??? ????????? ??? ???!"
+
+#: po/level_i18n.cc:3231
+msgid "You have proven your worth! The ancients grant you a SPRING!"
+msgstr "????????? ??? ???? ???! ?? ???? ??? ???????? ??? ????????!"
+
+#: po/level_i18n.cc:3232
+msgid "Prove your dexterity in the Test of Air!"
+msgstr "???????? ??? ????????? ??? ??? ????????? ??? ????!"
+
+#: po/level_i18n.cc:3233
+msgid "You have proven your worth! The ancients grant you a NAIL!"
+msgstr "????????? ??? ???? ???! ?? ???? ??? ???????? ??? ?????!"
+
+#: po/level_i18n.cc:3234
+msgid "Prove your patience in the Test of Water!"
+msgstr "???????? ??? ??????? ??? ??? ????????? ??? ?????!"
+
+#: po/level_i18n.cc:3235
+msgid "This can't be! No mortal can reach our Holy Oxyds! Prove yourself once more! Bwahahahaha!"
+msgstr "????????! ?????? ?????? ??? ?????? ?? ?????? ?? ???? Oxyds! ???????? ??? ???? ??? ???? ??? ????! ???????????!"
+
+#: po/level_i18n.cc:3244
+msgid "Fire or be fired"
+msgstr "???? ? ?????"
+
+#: po/level_i18n.cc:3247
+msgid "Do you think a bushman would start to search for an extinguisher in the cellar if a wall of fire were approaching? Be a Firefox - you have the first 5 items to deal with, no more no less!"
+msgstr "???????? ??? ???? ????????? ???????? ?? ?????? ??? ?????? ??? ???? ???????????? ?? ??? ????? ????????; ???? ??? ????????? ?????? - ????? ?? 5 ????? ??????????? ?? ??????????????, ???? ???????????, ???? ????????! "
+
+#: po/level_i18n.cc:3249
+msgid "You can extinguish fire with water. This is a good place to refill your extinguisher. Be aware, water is rare!"
+msgstr "??????? ?? ??????? ??? ????? ?? ?? ????. ???? ????? ??? ???? ????? ?? ???????? ??? ???????????? ???. ???? ???????, ?? ???? ?????????!"
+
+#: po/level_i18n.cc:3251
+msgid "OOPS! The maze is broken! Prepare to repair the maze before you destroy it."
+msgstr "????! ? ?????????? ????? ???? ????????! ???????????? ?? ??? ???????????? ???? ??? ???????????."
+
+#: po/level_i18n.cc:3264
+msgid "Can you relax amid all this chaos?"
+msgstr "??????? ?? ?????????? ?? ??? ???? ?? ????;"
+
+#: po/level_i18n.cc:3269
+msgid "Carry that oxygen around."
+msgstr "????????? ?? ??????? ???????."
+
+#: po/level_i18n.cc:3278
+msgid "Welcome to Enigma VII"
+msgstr "?????????? ??? Enigma VII"
+
+#: po/level_i18n.cc:3289
+msgid "Your faithful friend Tonto, your horse Silver, and Tonto's horse Scout have been captured."
+msgstr "? ?????? ??? ????? ? ?????, ?? ????? ??? ? ?????? ??? ?? ????? ??? ????? ? ?????? ????? ?????????????."
+
+#: po/level_i18n.cc:3291
+msgid "Don't forget your disguise!"
+msgstr "??? ?????? ??? ?????????? ???!"
+
+#: po/level_i18n.cc:3293
+msgid "Here lies the grave of John Reid."
+msgstr "?????? ?????? ? ????? ??? ???? ?????."
+
+#: po/level_i18n.cc:3295
+msgid "Hi-yo Silver, away!"
+msgstr "??????, ??????, ????? ???!"
+
+#: po/level_i18n.cc:3297
+msgid "Who was that masked man?"
+msgstr "????? ???? ????? ? ???????????? ??????;"
+
+#: po/level_i18n.cc:3299
+msgid "Hey! This tomb is empty!"
+msgstr "??! ? ????? ????? ?????!"
+
+#: po/level_i18n.cc:3304
+msgid "Riverside"
+msgstr "???? ??? ???????"
+
+#: po/level_i18n.cc:3306
+msgid "Wrong side!                   F3"
+msgstr "????? ?????!                   F3"
+
+#: po/level_i18n.cc:3314
+msgid "Ball Alley"
+msgstr "????????? ?? ??????"
+
+#: po/level_i18n.cc:3325
+msgid "Remote Meditation"
+msgstr "????????????? ???????????"
+
+#: po/level_i18n.cc:3332
+msgid "A Kind of Magic"
+msgstr "???? ??? ??????"
+
+#: po/level_i18n.cc:3339
+msgid "Watchmaker"
+msgstr "????????????"
+
+#: po/level_i18n.cc:3343
+msgid "Mend the clockwork"
+msgstr "?????? ?? ?????"
+
+#: po/level_i18n.cc:3344
+msgid "Don't close the pools before the clockwork is done, unless you are Fred Astaire"
+msgstr "??? ???????? ??? ????????????? ???? ???????? ?? ?????, ????? ?? ?? ????? ? Fred Astaire"
+
+#: po/level_i18n.cc:3376
+msgid "Free Riders"
+msgstr "?????? ??????"
+
+#: po/level_i18n.cc:3378
+msgid "Left or Right Drive?"
+msgstr "???????? ? ????? ??????;"
+
+#: po/level_i18n.cc:3386
+msgid "Feed me!"
+msgstr "????? ??!"
+
+#: po/level_i18n.cc:3388
+msgid "Beware of Sadistic Dentist!"
+msgstr "??????? ???? ????????? ??????????!"
+
+#: po/level_i18n.cc:3390
+msgid "The innocent victim."
+msgstr "?? ???? ????."
+
+#: po/level_i18n.cc:3392
+msgid "Office of your boss."
+msgstr "??????? ??? ????????? ???."
+
+#: po/level_i18n.cc:3394
+msgid "Aaaaaarrrrggghhhhhh!!!!!"
+msgstr "??????????????????!!!!!"
+
+#: po/level_i18n.cc:3396
+msgid "Everyone has gone, but the plant's still hungry!"
+msgstr "???? ????? ?????? ????, ???? ?? ???? ????? ????? ??????????!"
+
+#: po/level_i18n.cc:3398
+msgid "No! No! Aaaarrrrgggghhhh!"
+msgstr "???! ???! ?????????????!"
+
+#: po/level_i18n.cc:3402
+msgid "Making Shapes"
+msgstr "??????????? ???????"
+
+#: po/level_i18n.cc:3415
+msgid "Spaceship Control"
+msgstr "??????? ??? ???????"
+
+#: po/level_i18n.cc:3435
+msgid "Hey, where am i now?"
+msgstr "??, ??? ????? ????;"
+
+#: po/level_i18n.cc:3437
+msgid "Moments ago i've been at home and wanted to take care about my two oxyd stones."
+msgstr "??????? ??????? ??? ???? ?????????? ????? ??? ??? ???????? ?? ??? ????? ??? oxyds."
+
+#: po/level_i18n.cc:3439
+msgid "And now i'm stranded in this weird forest. How can i escape from here?"
+msgstr "??? ???? ????? ???????????? ?? ???? ?? ?????. ??? ????? ?? ???????? ??? ???;"
+
+#: po/level_i18n.cc:3441
+msgid "If i should have a look-around? Perhaps i can find some things that could help me to find an exit."
+msgstr "???? ?? ?????? ??? ????? ???????; ??????? ?? ??????? ?????? ??????????? ??? ?? ?? ?????????."
+
+#: po/level_i18n.cc:3443
+msgid "WARNING: Highest caution is necessary."
+msgstr "????????: ?????????? ?????? ???????."
+
+#: po/level_i18n.cc:3445
+msgid "Wild buffaloes are crossing the way."
+msgstr "?????? ???????? ?????????? ?? ????????."
+
+#: po/level_i18n.cc:3447
+msgid "Help me, the forest is on fire!"
+msgstr "???????, ?? ????? ?????? ?????!"
+
+#: po/level_i18n.cc:3449
+msgid "A herd of wild horses blocks the way."
+msgstr "??? ?????? ??? ????? ????? ??????? ?? ?????."
+
+#: po/level_i18n.cc:3451
+msgid "A small hamlet with a fence, a few huts, a pond, some bales of straw."
+msgstr "??? ????? ?????????? ?? ???? ??????, ??????? ???????, ??? ????? ??? ?????? ?????? ??????."
+
+#: po/level_i18n.cc:3453
+msgid "If there is finally an exit?"
+msgstr "??????? ????????? ??? ??????;"
+
+#: po/level_i18n.cc:3455
+msgid "I'm afraid, i need some assistance!"
+msgstr "??????? ??? ?????????? ???? ???????."
+
+#: po/level_i18n.cc:3457
+msgid "Filling station for empty extinguishers."
+msgstr "??????? ?????????? ????? ?????????????."
+
+#: po/level_i18n.cc:3459
+msgid "Watch out: Angry mosquitoes!"
+msgstr "???????: ???????? ?????????!"
+
+#: po/level_i18n.cc:3461
+msgid "Useful things may also be hidden!"
+msgstr "??????? ??????????? ?????? ?? ????? ??? ????????!"
+
+#: po/level_i18n.cc:3471
+msgid "Moving Arrow Stones can fall down holes but cannot fall into water."
+msgstr "???? ?????????? ?????? ?? ????, ??????? ?? ?????? ???? ?? ??????, ???? ??? ??? ??? ????."
+
+#: po/level_i18n.cc:3485
+msgid "Keep distance!"
+msgstr "????? ????????!"
+
+#: po/level_i18n.cc:3487
+msgid "Help! I can't see the forest for the trees!"
+msgstr "???????! ??? ????? ?? ?? ?? ????? ??'?? ??????!"
+
+#: po/level_i18n.cc:3497
+msgid "Bridge those synapses!"
+msgstr "???????? ???? ?? ???????!"
+
+#: po/level_i18n.cc:3517
+msgid "The Wild Hunt"
+msgstr "?? ????? ??????"
+
+#: po/level_i18n.cc:3525
+msgid "Freeze by the Power of Light"
+msgstr "?????? ??? ??? ?????? ??? ?????"
+
+#: po/level_i18n.cc:3529
+msgid "You shouldn't have done that."
+msgstr "??? ?????? ?? ?? ?????? ????"
+
+#: po/level_i18n.cc:3530
+msgid "Careful."
+msgstr "???????."
+
+#: po/level_i18n.cc:3568
+msgid "Audience in Venice"
+msgstr "??????? ???? ???????"
+
+#: po/level_i18n.cc:3570
+msgid "Press the Triggers"
+msgstr "????? ??? ??????????"
+
+#: po/level_i18n.cc:3572
+msgid "Welcome to Venice"
+msgstr "?????????? ??? ???????"
+
+#: po/level_i18n.cc:3574
+msgid "Welcome to the Audience"
+msgstr "?????????? ???? ???????"
+
+#: po/level_i18n.cc:3576
+msgid "rialto"
+msgstr "??????"
+
+#: po/level_i18n.cc:3578
+msgid "...under construction"
+msgstr "...??? ?????????"
+
+#: po/level_i18n.cc:3580
+msgid "try the bolders as gondola"
+msgstr "???????? ??? ?????????????? ?????? ?? ????????."
+
+#: po/level_i18n.cc:3582
+msgid "piazza san marco"
+msgstr "?????? ??? ?????"
+
+#: po/level_i18n.cc:3584
+msgid "danger"
+msgstr "????????"
+
+#: po/level_i18n.cc:3586
+msgid "san giorgio"
+msgstr "??? ?????????"
+
+#: po/level_i18n.cc:3588
+msgid "guardian ducale"
+msgstr "??????? ??? ????????"
+
+#: po/level_i18n.cc:3590
+msgid "gondoliere on strike"
+msgstr "??????????? ?? ???????"
+
+#: po/level_i18n.cc:3592
+msgid "palace ducale"
+msgstr "????? ????????"
+
+#: po/level_i18n.cc:3594
+msgid "look at san michele"
+msgstr "????? ??? ??? ??????"
+
+#: po/level_i18n.cc:3596
+msgid "use the gondola below"
+msgstr "????????????? ??? ??????? ????????"
+
+#: po/level_i18n.cc:3598
+msgid "hurry to san giorgio"
+msgstr "?????? ??? ?? ??? ?????????"
+
+#  level: "Advanced Tutorial"
+#  author: "Jacob Scott" email ""
+#: po/level_i18n.cc:3605
+msgid "Clue: The starting point is where all dead marbles go"
+msgstr "???????: ? ?????? ???? ????? ?? ?????? ???? ????????? ???? ?? ?????? ??????."
+
+#: po/level_i18n.cc:3609
+msgid "Ever mapped out a 4D-Labyrinth? Well, it's time to learn thinking in four dimensions ... Some hints: size of the labyrinth is 4x4x4x4; your current position is (2|3|3|2); in all of the 16 corners of the hypercube is a blue oxyd ..."
+msgstr "????? ????????????? ???? ???? ?????????????? ?????????; ??????, ????? ??? ?? ?????? ?? ????????? ?? ???????? ??????????...??????? ?????????: ?? ??????? ??? ?????????? ????? 4x4x4x4, ??? ? ???????? ???? ??? ????? ? (2|2|2|2). ???? 16 ?????? ??? ????????? ??????? ??? ???? oxyd..."
+
+#: po/level_i18n.cc:3610
+msgid "Ever mapped out a 4D-Labyrinth? Well, it's time to learn thinking in four dimensions ... Some hints: size of the labyrinth is 3x3x3x3; your current position is (2|2|2|2); in all of the 16 corners of the hypercube is a blue oxyd ..."
+msgstr "????? ????????????? ???? ???? ?????????????? ?????????; ??????, ????? ??? ?? ?????? ?? ????????? ?? ???????? ??????????...??????? ?????????: ?? ??????? ??? ?????????? ????? 3x3x3x3, ??? ? ???????? ???? ??? ????? ? (2|2|2|2). ???? 16 ?????? ??? ????????? ??????? ??? ???? oxyd..."
+
+#: po/level_i18n.cc:3620
+msgid "... illmind's mad-ill-tation ... a tribute to esprit meditation levels from the past. thank you. ..."
+msgstr "... ?????-??????????? ??? illmind ... ??? ???????? ??? ??????? ??????????? ??? ?????????? esprit. ????????? ..."
+
+#: po/level_i18n.cc:3634
+msgid "Inkblot 1"
+msgstr "??????? ??????? 1"
+
+#: po/level_i18n.cc:3654
+msgid "Funeral on Deep Sea"
+msgstr "?????? ???? ????? ???????"
+
+#: po/level_i18n.cc:3656
+msgid "Warning: Do not play this level for more than 10 minutes - you may suffer sea sickness yourself!"
+msgstr "???????: ??? ??????? ???? ?? ??????? ??? ???????? ??? 10 ????? - ?????? ?? ??? ?????????? ??????!"
+
+#: po/level_i18n.cc:3667
+msgid "Restless Meditation"
+msgstr "??????????? ????? ?????????"
+
+#: po/level_i18n.cc:3669
+msgid "Caution - Quick Sand!"
+msgstr "???????! ????????? ?????!"
+
+#: po/level_i18n.cc:3685
+msgid "Lady in Red"
+msgstr "? ????? ?? ?? ???????"
+
+#: po/level_i18n.cc:3689
+msgid "Recover the Stone"
+msgstr "???????? ??? ?????"
+
+#: po/level_i18n.cc:3696
+msgid "Floating ..."
+msgstr "???????????..."
+
+#: po/level_i18n.cc:3697
+msgid "Don't be afraid -- It's only a ten mile drop!"
+msgstr "??? ???????, ????? ????? ??? ???????? 10 ??????!"
+
+#: po/level_i18n.cc:3710
+msgid "illmind's jumping ball flash ..."
+msgstr "?? ??????-??????? ??? ?????? ??? illmind ..."
+
+#: po/level_i18n.cc:3711
+msgid "... of heaven comes the beast from the ..."
+msgstr "...??? ??? ????????? ??????? ?? ????? ???..."
+
+#: po/level_i18n.cc:3712
+msgid "... t r a p p e d ..."
+msgstr "...????????????..."
+
+#: po/level_i18n.cc:3725
+msgid "Ob Schachfiguren laserresistent sind?"
+msgstr "????????? ?? ?????? ??? ??????? ??? ??????? ??????;"
+
+#: po/level_i18n.cc:3729
+msgid "Chess and Boxes"
+msgstr "????? ??? ??????"
+
+#: po/level_i18n.cc:3743
+msgid "Sorry, this switch is currently out of order."
+msgstr "??????????, ? ????????? ????? ????? ???? ?? ????? ????? ???????????."
+
+#: po/level_i18n.cc:3745
+msgid "As I already told you, this switch is out of order!"
+msgstr "???? ??? ????, ? ????????? ????? ????? ????? ???????????!"
+
+#: po/level_i18n.cc:3747
+msgid "How often are you going to try this?"
+msgstr "???? ????? ?? ????????????;"
+
+#: po/level_i18n.cc:3749
+msgid "Did anything happen? I'm not sure ..."
+msgstr "????? ??????; ??? ??????..."
+
+#: po/level_i18n.cc:3751
+msgid "Congrats, now it works again!"
+msgstr "????????????, ???? ??????????????!"
+
+#: po/level_i18n.cc:3753
+msgid "No hints available at the moment."
+msgstr "??? ??????? ????????? ??????? ???? ?? ?????."
+
+#: po/level_i18n.cc:3755
+msgid "There is a passage right beneath this stone!"
+msgstr "??????? ??? ??????? ??????? ????? ??? ????? ??? ?????!"
+
+#: po/level_i18n.cc:3759
+msgid "Remember 'Changing Positions'?"
+msgstr "??????? ?? ??????? 'Changing Positions';"
+
+#: po/level_i18n.cc:3765
+msgid "Escape by Chaining Thieves"
+msgstr "???????? ?? ?? ?? ??????????? ???? ???????."
+
+#: po/level_i18n.cc:3768
+msgid "Remember Atreyu's horse Atrax!"
+msgstr "??????? ?? ????? ??? Atreyu, ??? Atrax!"
+
+#: po/level_i18n.cc:3770
+msgid "I am innocent! I've never stolen anything!"
+msgstr "????? ?????! ??? ??? ?????? ??????!"
+
+#: po/level_i18n.cc:3772
+msgid "It is said that pirates have taken the treasure."
+msgstr "???? ??? ?? ???????? ????? ????? ??? ???????."
+
+#: po/level_i18n.cc:3774
+msgid "Pirates usually hide their treasure!"
+msgstr "?? ???????? ??????? ??????? ??? ??????? ????!"
+
+#: po/level_i18n.cc:3776
+msgid "A closed door gives a better overview!"
+msgstr "??? ??????? ????? ????? ???????? ???!"
+
+#: po/level_i18n.cc:3796
+msgid "Pass the ball in time"
+msgstr "??????? ??? ????? ??? ????? ??????"
+
+#: po/level_i18n.cc:3800
+msgid "Holes!"
+msgstr "??????!"
+
+#: po/level_i18n.cc:3814
+msgid "Meditation Disturbance"
+msgstr "???????? ??? ???????????"
+
+#: po/level_i18n.cc:3817
+msgid "Hit by a bolting horse"
+msgstr "??????? ??? ??? ??????????????? ?????"
+
+#: po/level_i18n.cc:3829
+msgid "Welcome to Enigma VI"
+msgstr "????? ????? ??? Enigma VI"
+
+#: po/level_i18n.cc:3834
+msgid "Hot Hurdle Race"
+msgstr "?????? ?? ??????????? ???????."
+
+#: po/level_i18n.cc:3836
+msgid "Run for your life!"
+msgstr "????? ??? ?? ??? ???!"
+
+#: po/level_i18n.cc:3847
+msgid "Tandem Chess"
+msgstr "?????????? ?????"
+
+#: po/level_i18n.cc:3849
+msgid "Work together!"
+msgstr "???????? ????!"
+
+#: po/level_i18n.cc:3854
+msgid "The art of steering a quadriga"
+msgstr "? ????? ??? ?? ???????? ??? ?????"
+
+#: po/level_i18n.cc:3857
+msgid "Dropping the spoon redeems from being quartered!"
+msgstr "?? ?? ??????? ?? ??????? ?? ????????? ??? ?? ?? ?????? ?????? ?????!"
+
+#: po/level_i18n.cc:3870
+msgid "illmind's be quick or be dead"
+msgstr "?? ??????? ? ?????? ??? illmind"
+
+#  level: "Advanced Tutorial"
+#  author: "Jacob Scott" email ""
+#: po/level_i18n.cc:3908
+msgid "One-Way Woods"
+msgstr "????????? ????"
+
+#: po/level_i18n.cc:3909
+msgid "Recycling by Swapping"
+msgstr "?????????? ?? ?????????"
+
+#: po/level_i18n.cc:3920
+msgid "Procrustes"
+msgstr "???????????"
+
+#: po/level_i18n.cc:3928
+msgid "In the line of thieves"
+msgstr "???? ?????? ??? ???????"
+
+#: po/level_i18n.cc:3930
+msgid "Keys from left to right are NE, NW, SE, SW."
+msgstr "?? ??????? ??? ???????? ???? ?? ????? ?????: ??, ??, ??, ??."
+
+#: po/level_i18n.cc:3946
+msgid "It isn't as easy as it looks."
+msgstr "??? ????? ???? ?????? ??? ????????."
+
+#: po/level_i18n.cc:3950
+msgid "Oxyd Drilling"
+msgstr "???????? ??? oxyd"
+
+#: po/level_i18n.cc:3952
+msgid "Useful unsuccessful drillings"
+msgstr "???????? ??????????? ??????????"
+
+#: po/level_i18n.cc:3957
+msgid "Rotor Guards"
+msgstr "??????? ???????"
+
+#: po/level_i18n.cc:3959
+msgid "Hoisting guards with their own petard"
+msgstr "?????????? ??? ????????? ??? ??????? ???????? ????."
+
+#: po/level_i18n.cc:3964
+msgid "A really annoying Level"
+msgstr "??? ???? ???????????? ???????"
+
+#  level: "Advanced Tutorial"
+#  author: "Jacob Scott" email ""
+#: po/level_i18n.cc:4010
+msgid "Dialers"
+msgstr "???????????"
+
+#: po/level_i18n.cc:4015
+msgid "Hanging around in the Jungle"
+msgstr "?????????? ??? ???????"
+
+#: po/level_i18n.cc:4022
+msgid "Edwards Mountain"
+msgstr "?? ????? ??? Edward"
+
+#: po/level_i18n.cc:4026
+msgid "Al Capone's training camp."
+msgstr "??????????? ????????? ??? ?? ??????."
+
+#: po/level_i18n.cc:4027
+msgid "There are at least two patterns to break through the wall."
+msgstr "???????? ??????????? ??? ?????? ?? ??????????? ??? ?????."
+
+#: po/level_i18n.cc:4028
+msgid "It is a well known secret that a few prisioners did escape."
+msgstr "????? ???? ?????? ??????? ?? ??? ????????? ??????????? ?????????."
+
+#: po/level_i18n.cc:4029
+msgid "A window in the wall would be really nice."
+msgstr "??? ???????? ???? ????? ?? ???? ?????????? ???? ?????."
+
+#: po/level_i18n.cc:4034
+msgid "Charging live ammunition"
+msgstr "??????????? ??????? ??????????"
+
+#: po/level_i18n.cc:4041
+msgid "No Memory"
+msgstr "????? ?????"
+
+#: po/level_i18n.cc:4046
+msgid "Toreador"
+msgstr "??????????"
+
+#: po/level_i18n.cc:4051
+msgid "Persecution Mania"
+msgstr "????? ??? ???????"
+
+#: po/level_i18n.cc:4053
+msgid "A problem shared is a problem halved!"
+msgstr "??? ?????????? ???????? ????? ??? ???? ????????!"
+
+#: po/level_i18n.cc:4058
+msgid "Magic Trinity"
+msgstr "?????? ??????"
+
+#: po/level_i18n.cc:4066
+msgid "Blitz Chess"
+msgstr "????? - ???????"
+
+#: po/level_i18n.cc:4068
+msgid "Move fast!"
+msgstr "??????? ???????!"
+
+#: po/level_i18n.cc:4073
+msgid "Pleasure Garden"
+msgstr "? ????? ??? ??????????"
+
+#: po/level_i18n.cc:4074
+msgid "Quickly ...                                                                             or trickily!"
+msgstr "??????? ...                                                                          ? ??????!"
+
+#: po/level_i18n.cc:4079
+msgid "Correspondence Chess"
+msgstr "????? ??' ?????????????"
+
+#: po/level_i18n.cc:4081
+msgid "Send smartly!"
+msgstr "?????? ??????!"
+
+#: po/level_i18n.cc:4110
+msgid "Polar Bears' Paradise"
+msgstr "? ?????????? ??? ??????? ????????"
+
+#: po/level_i18n.cc:4112
+msgid "Witch Hunt on Ice"
+msgstr "?????? ???????? ???? ????"
+
+#: po/level_i18n.cc:4116
+msgid "Welcome to Mexico! Eight hours ago, your plane arrived at the Airport of \"Coatlicue\", which is a small village surrounded by unexplored jungle terrain. Now you find yourself in front of an impressive temple, which seems to be a relic of the ancient Aztec empire. But the temple is in surprisingly good condition ..."
+msgstr "?????????? ??? ??????! ???? ???? ????, ?? ????????? ??? ???????????? ??? ?????????? ??? \"Coatlicue\", ??? ????? ????? ???????????????? ??? ???????????? ???? ????????. ????????? ??????? ?? ???? ???, ??? ???????? ?? ????? ?????????? ??? ??????? ????????????? ??? ???????. ???? ? ???? ????? ?? ?????????? ???? ????????? ..."
+
+#: po/level_i18n.cc:4117
+msgid "Next to the giant doors of the temple you see a chrome sign: \"Restoration by: G. G. Goshers, A.D. 1998\". A smaller sign beneath says: \"Property of G. G. Goshers. Trespassing prohibited!\". Now you notice the dog kennels built up along the front side of the temple. \"Goshers made this ancient relic a fortress\", you think, \"this cannot be legal, for Goshers received funding from the UK Government. I'll try to call him to account!\""
+msgstr "????? ???? ???????? ????? ??? ???? ??????? ??? ????????:\"??????????? ??? ??? ?. ?. ???????, 1998\". ??? ????????? ???????? ??? ???? ????:\"?????????? ??? ?. ?. ???????. ???????????? ? ???????!\".  ?????????? ?? ?????????? ???? ????? ??? ???????. ?????????:\"? ??????? ????? ???? ?? ?????? ??????? ??? ??????. ??? ????? ??????, ????? ? ??????? ????? ????????????? ??? ??? ????????? ??? ?. ?????????. ?? ?????????? ?? ??? ?????? ??? ??????????!\""
+
+#: po/level_i18n.cc:4118
+msgid "This guard doesn?t notice me."
+msgstr "????? ? ??????? ??? ?? ??????? ??????."
+
+#: po/level_i18n.cc:4119
+msgid "This lake was obviously made by Goshers. I think the correct way is south."
+msgstr "???? ? ????? ?? ????????????? ??????? ??? ??? ???????. ?????? ? ?????? ?????? ????? ???? ?? ?????."
+
+#: po/level_i18n.cc:4120
+msgid "There's an inscription on the old wall, saying in spanish: \"Careful! What you touch could be the last thing you touch!\""
+msgstr "??????? ??? ???????? ???? ?????, ??? ??? ???????? ????????: \"???????! ?,?? ???????? ?????? ?? ????? ?? ????????? ?????? ??? ????????!\""
+
+#: po/level_i18n.cc:4121
+msgid "Chrome sign: \"Control of the beast?s cage.\""
+msgstr "????????: \"??????? ??? ???????? ??? ???????.\""
+
+#: po/level_i18n.cc:4122
+msgid "Oooh, this slope is steep! Try not to touch the skull!"
+msgstr "????, ???? ?? ?????? ????? ????????! ?????????? ?? ??? ???????? ?? ??????!"
+
+#: po/level_i18n.cc:4123
+msgid "This building down there looks like a prison. Let's see if I can determine its purpose ... Ah, there's another chrome sign. Goshers seems to favour chrome signs. It says: \"Natives? prison\"."
+msgstr "???? ?? ?????? ???? ???? ??????? ?? ??????. ??? ?? ????? ?? ????? ?? ???????? ??? ????? ??? ... ??, ?? ?? ???? ????????. ????:\"??????? ????????\"."
+
+#: po/level_i18n.cc:4124
+msgid "Getting beyond the prison building was a really good idea. But now you have to cross this lake. Be thrifty with those boxes!"
+msgstr "?? ?? ??? ???? ??? ??? ?????? ???? ??????? ???? ????. ???? ???? ?? ?????? ?? ?????????? ?? ??????. ?? ????? ??????????? ?? ???? ?? ???????!"
+
+#: po/level_i18n.cc:4125
+msgid "Now, peering through the grilled prison windows, you see a native woman imprisoned there. Obviously Goshers locked up all the natives, who disturbed his \"work\"; trying to enter the temple and to get rich from the treasures of the Aztecs. It might be helpful to be accompanied by someone, who knows the secrets of the jungle and this temple ..."
+msgstr "????, ????????? ??? ????? ??? ???????? ??? ???????, ??????? ??? ??????? ??????? ???????????. ??????? ? ??????? ??????? ???? ????? ???? ?????????, ??? ????????? ?? \"???????\" ???, ???????????? ?? ????? ???? ??? ?? ?????? ???????? ?? ???? ????????? ??? ???????. ????? ???????? ?? ??????????? ??? ???????, ????? ???????? ??????? ?? ??????? ??? ???????? ..."
+
+#: po/level_i18n.cc:4126
+msgid "Since the white man there freed me from the prison, he certainly cannot be as evil as this Goshers is. Perhaps he wants to end the mastery of Goshers and free my people. And even if this is not the case, it's better to be free than imprisoned. I think I should thank him."
+msgstr "??? ?? ?????? ??? ????? ? ???????? ?? ????????????, ??????? ??? ?????? ?? ????? ??????????, ???? ? ???????. ?????? ?? ????? ?? ????? ??? ????? ???? ???????? ??? ??????? ??? ?? ??????????? ???? ????????? ???. ??? ?? ???? ??? ????? ???? ? ?????????, ????? ???????? ?? ????? ?????????? ???? ????????????. ?????? ??? ?????? ?? ??? ???????????."
+
+#: po/level_i18n.cc:4127
+msgid "You meet the English adventurer in the front of the prison. \"Hello, I'm Xila!\", you tell him in broken English. After he introduced himself as well, both of you begin to work out a plan against the evil G. G. Goshers."
+msgstr "???????? ??? ??????? ?????????? ??????? ??? ??? ??????. \"????, ????? ? Xila\", ??? ??? ?? ?????? ???????. ???? ????????? ??? ? ?????, ??? ?? ??? ??????????? ??? ?????? ??????? ???? ????????? ???????."
+
+#: po/level_i18n.cc:4128
+msgid "This is a really hard puzzle. The English man will have to help me, if this enigma is to be solved."
+msgstr "????? ????? ???? ???? ???????? ??????. ? ???????? ?? ?????? ?? ?? ????????, ?? ???? ?? ??????? ?????? ?? ?????."
+
+#: po/level_i18n.cc:4129
+msgid "You wonder what this switch could trigger."
+msgstr "??????? ?? ?? ???????? ?? ????? ????? ? ?????????."
+
+#: po/level_i18n.cc:4130
+msgid "Xila knows how to drain the lake!"
+msgstr "? Xila ???????? ??? ?? ?????????? ??? ?????!"
+
+#: po/level_i18n.cc:4131
+msgid "You were lucky to find this hole. It prevents you from drowning."
+msgstr "????? ??????? ??? ?????? ????? ??? ?????. ?? ????????? ??? ?? ?? ???????."
+
+#: po/level_i18n.cc:4132
+msgid "This glass stone must fulfill a purpose ..."
+msgstr "???? ? ??????? ????? ?????? ?? ???????? ??? ????? ..."
+
+#: po/level_i18n.cc:4133
+msgid "It's funny that such a temple should have a side entrance."
+msgstr "????? ???????? ??? ????? ? ???? ???? ??? ?????? ??????."
+
+#: po/level_i18n.cc:4134
+msgid "Be careful! There are sensors in the walls."
+msgstr "???????! ???????? ?????????? ????? ???????."
+
+#: po/level_i18n.cc:4135
+msgid "After the huge doors of the old temple have opened, you see, that the entrance is protected by 11 knights, armed with spears. These guards are very dangerous. Without a sword you'll never be able to enter. Be careful. There are not only knights, but also thieves."
+msgstr "???? ?? ????????? ?????? ??? ???? ????????, ??????? ??? ? ??????? ????????????? ??? 11 ????????, ?????????? ?? ??????. ????? ?? ??????? ????? ???? ???????????. ????? ????? ??? ?? ????????? ?? ?????????. ???? ????? ??? ???? ????????, ???????? ??? ??????."
+
+#: po/level_i18n.cc:4136
+msgid "\"Congratulations. You just managed to enter this old Aztec Temple.\""
+msgstr "\"????????????. ????? ????????? ?? ????? ?? ????? ??? ????? ???????? ???.\""
+
+#: po/level_i18n.cc:4137
+msgid "\"You've been smarter than I expected. But you'll never enter the treasure room nor escape from here!\""
+msgstr "\"????? ??? ??????? ??'??? ??????. ???? ???? ??? ?? ????? ??? ??????? ??? ???????? ???? ?? ?????????? ??? ???!\""
+
+#: po/level_i18n.cc:4138
+msgid "\"I, Goshers, will certainly be able to rid myself of one of my archenemies by just killing you!\""
+msgstr "\"???, ? ???????, ??????? ?? ??????? ?? ????????? ??? ???? ??? ???? ??????????? ??? ????? ?? ?? ?? ?? ???????!\" "
+
+#: po/level_i18n.cc:4139
+msgid "\"Run for your life!\""
+msgstr "\"????? ??? ?? ??? ???!\""
+
+#: po/level_i18n.cc:4140
+msgid "Xila and you just entered the Diamond Room of the old Aztec Temple. By taking him back to Great Britain and rendering him to the police, you have ended the evil career of Gerald Gregory Goshers. Congratulations on the success of your expedition!"
+msgstr "? Xila ??? ??? ????? ??????? ??? ??????????? ??????? ??? ?????? ????????? ????. ??????????? ??? ???? ?. ???????? ??? ???????????? ??? ???? ?????????, ???????? ? ????????? ??? ??? ???????? ????????? ???????. ???????????? ???? ???????? ??? ????????? ???!"
+
+#: po/level_i18n.cc:4151
+msgid "Jack-Of-All-Trades"
+msgstr "?????????????-??-????-???-??????"
+
+#: po/level_i18n.cc:4153
+msgid "Find The Paradise"
+msgstr "???? ??? ?????????"
+
+#: po/level_i18n.cc:4167
+msgid "The Green Hell"
+msgstr "? ??????? ??????"
+
+#: po/level_i18n.cc:4169
+msgid "Exploration Trip to Green Waters"
+msgstr "???????????? ?????? ??? ??????? ????"
+
+#: po/level_i18n.cc:4177
+msgid "Open the Doors"
+msgstr "?????? ??? ??????"
+
+#: po/level_i18n.cc:4181
+msgid "Watch out for mines!        White = 0, Blue = 1, Black = 2, Red = 3, Yellow = 4, Deep Blue = 5, Deep Red = 6 ..."
+msgstr "??????? ???? ??????!      ?????=0, ????=1, ?????=2, ???????=3, ???????=4, ?????? ????=5, ?????? ???????=6..."
+
+#: po/level_i18n.cc:4182
+msgid "Hint: Mines are never located along the edges.  If you still get stuck, look behind the wall!"
+msgstr "????????: ?? ?????? ???? ??? ?????????? ???? ?????. ?? ????? ? ????? ?????????, ????? ???? ??? ??? ?????!"
+
+#: po/level_i18n.cc:4183
+msgid "Hit the switch to uncover one tile, but you will have to wait 10 seconds."
+msgstr "????? ?? ???????? ??? ?? ??????????? ??? ?????????, ???? ?? ?????? ?? ?????????? 10 ????????????."
+
+#: po/level_i18n.cc:4188
+msgid "My First Level"
+msgstr "?? ????? ??? ???????"
+
+#: po/level_i18n.cc:4190
+msgid "\"Secrets? Use the items, ... use the glasses ..."
+msgstr "\"???????; ????????????? ?? ???????????, ...?? ??????..."
+
+#: po/level_i18n.cc:4195
+msgid "Only A Labyrinth"
+msgstr "???? ???? ??????????"
+
+#: po/level_i18n.cc:4203
+msgid "Use the Lightpassenger"
+msgstr "????????????? ??? ????? ??? ???????? ??? ?? ??????"
+
+#: po/level_i18n.cc:4208
+msgid "Start the next explosion at brick 17 (counting from left)!"
+msgstr "?????? ??? ??????? ?????? ??? ?????? 17 (????????? ??? ????????)!"
+
+#: po/level_i18n.cc:4210
+msgid "Use of ring only allowed on marked areas."
+msgstr "????? ??? ??????????? ??????????? ???? ???? ????????????? ????????."
+
+#: po/level_i18n.cc:4214
+msgid "Caution! Don't use for bridge-building!"
+msgstr "???????! ?? ??? ??????????????? ?? ????????? ???????!"
+
+#: po/level_i18n.cc:4216
+msgid "Looks pretty dark!"
+msgstr "???????? ???? ????????!"
+
+#: po/level_i18n.cc:4218
+msgid "Prevent theft! Don't leave valuables in your inventory!"
+msgstr "??????? ??? ?????! ??? ?????? ???????? ??????????? ???? ???!"
+
+#: po/level_i18n.cc:4230
+msgid "Welcome to Enigma VIII"
+msgstr "?????????? ??? Enigma VIII"
+
+#: po/level_i18n.cc:4234
+msgid "Hey, you've got godlike help? Is the hell hound on your trail?"
+msgstr "??, ????? ????? ????? ???????; ????? ?? ??????????? ??? ??????? ??? ????? ???;"
+
+#: po/level_i18n.cc:4274
+msgid "Drop the hammer on side of a pentomino and use the switch!"
+msgstr "????? ?? ????? ????? ?? ??? ????????? ??? ????????????? ??? ????????!"
+
+#: po/level_i18n.cc:4275
+msgid "Drop the hammer on side of a pentomino, not beneath it!"
+msgstr "????? ?? ????? ????? ?? ??? ?????????, ??? ??????? ??? ????!"
+


Property changes on: trunk/po/el.po
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/nls.hh
===================================================================
--- trunk/src/nls.hh	2008-09-06 21:26:50 UTC (rev 1307)
+++ trunk/src/nls.hh	2008-09-07 11:04:22 UTC (rev 1308)
@@ -39,6 +39,7 @@
         { "Suomi",      "fi_FI", "flags25x15/fi" },
         { "??????????", "uk_UA", "flags25x15/ua" },
         { "??????????", "be_BY", "flags25x15/by" },
+        { "??? ????????", "el_GR", "flags25x15/gr" },
     };
 }
 



From andreasl at mail.berlios.de  Mon Sep  8 03:01:27 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Mon, 8 Sep 2008 03:01:27 +0200
Subject: [Enigma-game-svn] r1309 - in feature_branches/hp_lotm: .
	images/lotm input/lotm
Message-ID: <200809080101.m8811R9M023187@sheep.berlios.de>

Author: andreasl
Date: 2008-09-08 03:01:10 +0200 (Mon, 08 Sep 2008)
New Revision: 1309

Added:
   feature_branches/hp_lotm/images/lotm/lotm_200809.png
   feature_branches/hp_lotm/images/lotm/lotm_200809_a.png
   feature_branches/hp_lotm/images/lotm/lotm_200809_b.png
   feature_branches/hp_lotm/images/lotm/lotm_200809_c.png
   feature_branches/hp_lotm/images/lotm/lotm_200809_d.png
   feature_branches/hp_lotm/images/lotm/lotm_200809_e.png
   feature_branches/hp_lotm/images/lotm/lotm_200809_f.png
   feature_branches/hp_lotm/images/lotm/lotm_200809_g.png
   feature_branches/hp_lotm/images/lotm/lotm_200809_h.png
   feature_branches/hp_lotm/images/lotm/lotm_200809_x.png
   feature_branches/hp_lotm/input/lotm/lotm_200809.html
Modified:
   feature_branches/hp_lotm/enigma.css
   feature_branches/hp_lotm/images/lotm/lotm-history.png
   feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua
Log:
LotM Feature branch:
 - Added LotM 9/08
 - Proofread and validated
 - CSS: New: "lotmpicleft"
Todo:
 - Russian and German translations


Modified: feature_branches/hp_lotm/enigma.css
===================================================================
--- feature_branches/hp_lotm/enigma.css	2008-09-07 11:04:22 UTC (rev 1308)
+++ feature_branches/hp_lotm/enigma.css	2008-09-08 01:01:10 UTC (rev 1309)
@@ -433,6 +433,25 @@
     font-size: 90%;
 }
 
+.lotmpicleft {
+    float: left;
+    padding-right: 2em;
+    padding-bottom: 1em;
+}
+
+.lotm .lotmpicleft img {
+    border-width: 4px;
+    border-color: #777;
+    padding-right: 0em;
+    margin-top: 1em;
+    padding-top: 0em;
+    padding-bottom: 0em;
+}
+
+.lotmpicleft .imagetitle {
+    font-size: 90%;
+}
+
 .lotm img {
     padding-right: 1em;
     padding-top: 0.5em;

Modified: feature_branches/hp_lotm/images/lotm/lotm-history.png
===================================================================
(Binary files differ)

Added: feature_branches/hp_lotm/images/lotm/lotm_200809.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200809.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200809_a.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200809_a.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200809_b.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200809_b.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200809_c.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200809_c.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200809_d.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200809_d.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200809_e.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200809_e.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200809_f.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200809_f.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200809_g.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200809_g.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200809_h.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200809_h.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200809_x.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200809_x.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/input/lotm/lotm_200809.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200809.html	2008-09-07 11:04:22 UTC (rev 1308)
+++ feature_branches/hp_lotm/input/lotm/lotm_200809.html	2008-09-08 01:01:10 UTC (rev 1309)
@@ -0,0 +1,398 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">September 2008: </span>
+    &quot;River of Challenges&quot; by Lukas Sch&uuml;ller
+  </h3>
+
+<p>Summertime is vacation season. Well, marbles, do they go on vacation too? And
+if they do, what are they doing then? Lazying about and enjoying themselves? Or
+do they prefer activity vacations? Questions and more questions. Thank God,
+Lukas Sch&uuml;ller searched for answers. And with &quot;River of
+Challenges&quot; he allows us to have a look at his findings.</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_a.png" alt="Level of the Month" border="0">
+<div class="imagetitle">Enigma VI # 61</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Some records of August 2008</caption>
+<colgroup>
+    <col width="80">
+    <col width="160">
+</colgroup>
+    <tr><td class="num">9:35</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">11:47</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">11:49</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">12:39</td>
+        <td class="left">Duffy</td></tr>
+    <tr><td class="num">13:39</td>
+        <td class="left">dev0</td></tr>
+    <tr><td class="num">13:41</td>
+        <td class="left">Raoul</td></tr>
+    <tr><td class="num">14:20</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">14:42</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">17:56</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">18:08</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">21:09</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">32:41</td>
+        <td class="left">Alex</td></tr>
+</table>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Easy Mode</caption>
+<colgroup>
+    <col width="80">
+    <col width="160">
+</colgroup>
+    <tr><td class="num">10:56</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">11:25</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">11:58</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">13:32</td>
+        <td class="left">dev0</td></tr>
+    <tr><td class="num">17:21</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">20:14</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">20:37</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">33:00</td>
+        <td class="left">mecke</td></tr>    
+</table>
+
+<h4>&quot;The frustration factor of 'River of Challenges' is
+comparatively low&quot;</h4>
+
+<div class="quote">&quot;River of Challenges&quot; is nice to first-time
+&quot;visitors&quot;, because you can take a look at every part of the level
+before really starting to do anything. Also, there's no given order in which to
+tackle the different &quot;challenges&quot; which makes this level worth a try
+even for less experienced players. However, if you want to actually finish this
+level, you need skill in moving the ball as well as a bit of logic, so as not to
+make mistakes during the pushing puzzles.</div> 
+
+<div class="quote">Fortunately, one of the most critical passages, namely the
+race against the laser beam, can be dealt with right at the beginning, so that
+the frustration factor of &quot;River of Challenges&quot; is comparatively low.
+It takes no mastermind to solve the puzzles either, except for two &quot;booby
+traps&quot;, which cost me quite some time:</div>
+
+<div class="quote">1) Where can I get more dynamite, in order to blow up the
+stones blocking the room with the key?</div>
+
+<div class="quote">2) Why do I get stuck, when I build a bridge across the upper
+part of the &quot;river&quot;? (It did work in the lower right corner!)</div>
+
+<div class="quote">Eventually you reach a point (hopefully), at which you can
+(at least in theory) manage every part of the level separately. Then it's only a
+matter of time &hellip;</div>
+
+<div class="author">Craven</div>
+
+
+
+<p>Actually our marble wanted to go mountain climbing, but the weather forecast
+in the mountains thwarted his plans. Go to the sea? Well, being a non-swimmer
+(one would not think so, but it's true!) that wouldn't really be a marbleous
+adventure! And eventually just hanging around in some anonymous tourist trap?
+Boring! So what else? The ancient ones used to seek advice from the &quot;Gods
+of Enigma&quot; or an &quot;Oracle&quot; to help them out of difficulties, when
+they lacked ideas. Not much has changed: Even nowadays asking and listening
+won't do any harm.</p>
+
+<p>After looking around for a while, our marble found a small interesting
+location in the south &mdash; well-known just to insiders who praised it with
+wide eyes as a &quot;real cool place&quot;. So, it was easy what to decide.
+&quot;South&quot; in the summer means warm and sunny weather, and
+&quot;well-known just to insiders&quot; means a natural place with no hustle and
+bustle. At last, we've settled on our vacation spot!</p>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200809_b.png" alt="Level of the Month" border="0">
+<div class="imagetitle">Unpassable bridge</div>
+</div>
+
+<p>Upon reaching our destination, the first thing we have to do is sound things
+out. From afar we can see the river, which according to some locals we meet is
+suitable for white-water rafting and kayaking. So let's go and check out if
+their enthusiasm is merited. Wow! These folks are totally crazy. Boating in
+these muddy waters would surely be suicide. Branches thick as one's arm, even
+trunks are shooting past. Let's go across the bridge to have a look at the other
+side &mdash; perhaps it's more quiet over there. Oops! No way to cross this
+bridge! It seems like the river has been flooded recently, the bridge is
+damaged. That also must be the reason for all the mud and sludge around.</p> 
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_c.png" alt="Level of the Month" border="0">
+<div class="imagetitle">The village</div>
+</div>
+
+<p>First we will search for informations in the nearby village about what
+happened and when the repairs will be done. But the information we get there
+doesn't encourage us: The repairs will drag on for days, even weeks. &quot;Come
+again next year&quot; they tell us, &quot;or content yourself with what our
+village has to offer&quot;. At least they inform us of three persons who
+probably can help us. But two of them are very busy at the moment, and the way
+to the third one is more than just adventurous. Disheartened spirits would pack
+their bags and go home. But we wanted an activity vacation, so we take up the
+challenge.</p>
+
+<p>For today, to limber up, we decide to examine the bridge to the south east of
+the village. Contrary to all expectations it can be repaired without too much
+fuss. So the way to two hot spots  is now free. We'll leave it at that, it's
+enough for today. We don't want to shoot all our arrows at once. Tomorrow is
+another day.</p>
+
+<h4>Don't miss the &quot;bus&quot;!</h4>
+
+<div class="quote">In January of 1995, I was exploring the lost city of Petra,
+in Jordan. My companion and I took a wrong turn and found ourselves following a
+river that led out of the site toward the wilderness. We were no longer
+surrounded by columns carved into living stone by ancient human hands, but by
+nature itself.</div> 
+
+<div class="quote">We hiked up the river until we came to a rope bridge across.
+We realized that our bus would be leaving soon and we were quite a distance away
+and not sure if we would get to the bus, the final one of the day, on time. We
+had to cross this precarious rope bridge carefully, so as not to fall into the
+water, and quickly, so as not to miss the bus.</div> 
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_d.png" alt="Level of the Month" border="0">
+<div class="imagetitle">Missed the bus.</div>
+</div>
+
+<div class="quote">This is the memory that playing &quot;River of
+Challenges&quot; triggers in me. Like many Enigma levels, there's one crucial
+task that must be mastered initially if one is to continue playing. For this
+level, it's the necessarily rapid, but careful crossing one must make to stop
+the laser that is approaching the boulder. If you miss the bus, you just have to
+restart the game and try again.</div>
+
+<div class="quote">For me, the greatest challenge isn't the mad dash across the
+drink that I allude to above, but the jumping one must do to reach the switch in
+the lower left room &mdash; it is so hard for me to get just the right amount of
+speed going before I bounce across the rivulets. I usually find myself taking a
+mighty leap and hoping to just hit the switch before I bounce into the water and
+lose one life.</div>
+
+<div class="quote">I really like this level &mdash; it's visually sumptuous. The
+tasks that must be mastered vary &mdash; there's the right balance of dexterity
+and forethought required to succeed. I give &quot;River Of Challenges&quot; a
+10.</div>
+
+<div class="author">Taztunes</div>
+
+<p>The next day we set out to pay a visit to those three people who might help
+us. The first one we see seems to need help himself. Having his leg in plaster,
+B.B. Marble suggests a deal. Before his accident he had lost something
+important, that's why he sings the blues. He can't fetch it himself because of
+his limited ability to move. If we can get it for him he would of course show
+his gratitude. We agree and shake hands on the deal. He explains to us where we
+have to go and what lies ahead of us there. &quot;You'd better hurry!&quot;, he
+says.</p>  
+
+<p>So we hurry. We get into our sportswear and out of the village to the east.
+There's no &quot;Slippery when wet&quot; sign, but at the beginning we're more
+slipping and sliding along the muddy path than walking (hoping not to waste too
+much time). But soon we can &mdash; no, we MUST &mdash; force the pace along the
+tortuous plank path. Careful! One false step would surely mean the end (aka
+Ctrl-A). Concentrate and keep up the pace! Phew! We've only just made it! First
+we need a breather, and then we return the lost article to its owner. And like
+he had promised (manus manum lavat) B.B. pulls a few strings, Lucille sings
+&quot;You're still a square, but a fl-bridge-open now&quot; &mdash; and we've
+made another considerable step forward. Let's knock off business for
+today.</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_f.png" alt="Level of the Month" border="0">
+<div class="imagetitle">&quot;Swinging&quot; cross the pool</div>
+</div>
+
+<p>The following morning we go to see the next person who might be able to help
+us get along. Big Bill Marble would like to come to play, but to do so he needs
+his key to the highway which he had lost when rock'n'rolling in a cave to the
+west of the village recently. Great! At least this cave is located on the way to
+the third person who has been mentioned to us as a address to turn to for help.
+As a precaution we fit ourselves out with appropriate equipment for spelunking.
+We leave the village, taking the road west, then turning off south at the next
+crossing. It's pure joy sliding down the crossroad. Well, but then suddenly
+we're stuck: the way is blocked by a pool. We need a good swing to jump across.
+Let's hope we don't lose control on the other side because of all the mud. Let's
+get going then! &hellip; Phew, that was close!</p> 
+
+<p>And on we go. Soon we reach the cave, force our way in and take the fateful
+key. South of the cave we move west to look for the third person on our list. We
+come across two creeks which obstruct progress. But skilled as we are, with the
+right mix of speed and dexterity &mdash; we overcome even this obstacle.
+&quot;I'sorry, but I just can't help you, much as I should like to&quot; is all
+we get from Little Walter Marble at first. &quot;Try to ask around in the pub
+this evening. The pub is to the south of the marketplace at the end of the side
+road. Tell them I sent you. Everything's gonna be alright.&quot; Taking this not
+very promising advice we head for home to the village.</p> 
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_g.png" alt="Level of the Month" border="0">
+<div class="imagetitle">The Cave: Big Bill's lost key</div>
+</div>
+
+<p>We would have gone to a pub anyway this evening. Why not pay a visit to this
+location? No sooner said than done. Our questions are being put off until later:
+The person who might help us hasn't arrived yet. We make ourselves at home. And
+we soon make friends with the pleasent vin du pays, the meals are tasty and the
+atmosphere's enjoyable. Even waiting can be fun. After a while the expected guy
+shows up and soon joins us. He asks us what we want from him, and we tell him
+about our problems. After some (or perhaps some more) glasses of wine, John Lee
+Marble assures us of his support, and moreover gives us some helpful tips. And
+then &hellip;</p>
+
+<!--<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_h.png" alt="Level of the Month" border="0">
+<div class="imagetitle">The Cave: For Members Only</div>
+</div>-->
+
+<!--<p><img class="leftimage" src="$$imagedir$$/lotm/lotm_200809_x.png"
+alt="EoYA 2007" border="0"></p>-->
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200809_x.png" alt="Level of the Month" border="0">
+</div>
+
+<p>
+Damn it! Why is the light so glaring and why are our heads so heavy this
+morning? Oh yeah, yesterday late in the evening &mdash; or was it today early in
+the morning? &mdash; the conference seems to have lasted a little bit longer.
+According to our status quo it seems to be &mdash; no, it has to be &mdash; just
+a few hours ago since the festival came to an end. Well, it doesn't matter.
+Let's have a day off today. &mdash; Wait a minute! Isn't there something we're
+forgetting?  If only we didn't feel so lousy. Apparently we had one Bourbon, one
+Scotch, one Beer, or was it something else? Serves us right to suffer! &mdash;
+But what was it? &mdash; Actually today we wanted to?? &hellip; bridge?!?
+&hellip; hot spot just northeast of the village!?! &hellip; That's it!! But
+should we really do this to ourselves today? Since these nice people have so
+generously supported us, we can't very well disappoint them. We hope it won't be
+too hard. One pot of coffee later, but not yet fit as a fiddle, we unhurriedly
+set off to the scene of today's action.</p>  
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_e.png" alt="Level of the Month" border="0">
+<div class="imagetitle">What shall we do <br> with the stuff from the river?
+<br> &hellip; early in the mornin' &hellip;</div>
+</div>
+
+<p>Great! The northern bridge is passable again. Aside from the muddy path the
+other side doesn't look bad. But stop! What's that? Everything's flooded just
+before our goal!  &mdash; Didn't tell John Lee, yesterday's drinking buddy, that
+there's enough stuff lying around on the waterfront we can make use of without
+any problems? Surely, when we arrived a few days ago we almost stumbled over it.
+And there's one good thing about it: Hopefully the drudgery lying ahead of us
+will break down the residual alcohol. A little bit later after we've moved the
+first piece to the left riverside, a little problem turns up: How can we get it
+across the river? We push it to and drag it from but it won't work. Think a
+little! But that's not so easy, our heads are still aching. Hm, if we however
+&hellip; then &hellip; and with &hellip; Yes, we should succeed doing it this
+way.</p> 
+
+<p>And in fact &mdash; finally we've reached our final goal. The strain eases.
+The last exhausting days are past. What remains is the satisfaction to have
+survived all the challenges of the river. We will certainly brag about it later
+at a certain inn while everyone is celebrating with food and drink. But we don't
+want to say a word about the consequences this time &hellip;</p>
+
+<h4>&quot;One kind of level was missing from my private level collection&quot;</h4>
+
+<div class="quote">I'm very happy about this award. It's a while ago since I
+wrote the level, but I'll try to get things together.</div>
+
+<div class="quote">Now that &quot;River of Challenges&quot; has been voted Level
+of the Month, things have come full circle in some respect: Since the idea for
+this level came into being shortly after I had read the first LotM article,
+which presented one of Duffy's masterpieces (on which I never really dared to
+venture I must confess). Thereby I came to realize that it was exactly this kind
+of level which was missing from my somewhat extensive private collection of
+levels (although not so extensive as the one of the author just mentioned before
+&mdash; if there's anything alike it at all ;) ): A huge level, consisting of
+lots of little puzzles, in which all the skills typical for Enigma are demanded
+from the player.</div>
+
+<div class="quote">The idea to assemble some
+puzzle-stones for transporting purposes and to disassemble them again at their
+destination had occured to me some time before, so building the upper two rooms
+didn't take that long. Luckily this puzzle made it possible for me to outline a
+basic plan regarding the gaming principle as well as the design. The way to the
+other side simply was interrupted at some points and had to be reestablished by
+various actions of the player in the lower part of the level. As the main
+designing element water was the perfect match: it could easily be extended to
+represent a river.</div>
+
+<div class="quote">Then I had to complete the lower area of the level with
+various challenges. My original intention was to design the level in a
+non-linear way &mdash; each of the single challenges should be within easy reach
+right from the start for practising purposes, but still there would only be one
+order, in which the individual challenges could be mastered. Well, it didn't
+quite well work out: most of the puzzles are independent of other ones.
+Particularly the passage with the laser and the breakable stones reveals the
+original idea. And also the fact that it's still me who holds the record
+indicates that there's only one optimum way (concerning time) to solve the
+level.</div>
+
+<div class="quote">After I had finished a first version and sent it to the
+developers, the level was yet far from being finished. Here once again many
+thanks to Raoul, Ronald und Andreas, who especially helped me to complete the
+left area of the level which has been nearly empty at the times. After many more
+minor changes the level was finally completed and ready to be included in the
+game.</div>
+
+<div class="quote">Looking back there are some aspects I'm discontented with:
+the central challenge isn't centrally located for instance, or the fact that it
+has turned out to be a bit too time-consuming &mdash; but on the whole I'm quite
+pleased with my first and up to now only large level. But who knows, maybe in
+future others will follow.</div>
+
+<div class="author">Lukas</div>
+
+<p>It can be taken for granted our marble has to recover from such
+&quot;vacations&quot; by going about its business as an industrial manager (far
+from nature). Without dreaming that it will come across some of that
+&quot;stuff&quot; it had found near the riverbank again, when it will be facing
+the challenges at its working place at factory hall 6098. More about it next
+month. Thanks to Lukas Sch&uuml;ller. He gave us a profound insight how our
+marble is spending its vacation and why our marble sometimes seems to be so
+worn-out for its daily work.</p>
+
+<p><i>NObby and Harry</i></p> 
+
+<p><i>One more time many thanks to our travel companion Taztunes who picked up the
+pieces of our double Dutch English and put them together into something worth
+reading.</i></p> 
+
+<p>Dear reader, we have a constant need for articles from you about Enigma's
+great levels. Please, send us any articles, even comments, you write to:</p>
+<pre>
+<a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
+</pre>
+<p>We're particularly interested in articles about the following levels:
+</p>
+<ul>
+<li>&quot;Plan Ahead&quot; by Jacob Scott</li>
+<li>&quot;Procrustes&quot; by Andreas Lochmann</li>
+<li>&quot;Little Puzzles&quot; by Jon 'WB' Sneyers</li>
+</ul>
+<p>Many thanks in advance, only your help can keep the LotM alive!</p>
+
+<p><i>Your Enigma Team</i></p>
+
+</div>

Modified: feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua	2008-09-07 11:04:22 UTC (rev 1308)
+++ feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua	2008-09-08 01:01:10 UTC (rev 1309)
@@ -148,25 +148,130 @@
   position_num   = "5069"
 }
 
+lotm_archive_data[17] = {
+  date           = { month = 9, year = 2008 },
+  chronological  = 17,
+  name           = "River of Challenges",
+  author         = "Lukas Sch&uuml;ller",
+  position       = "VI/61",
+  position_num   = "6061"
+}
+
+-- Further levels standing data
+-- (no need to change these)
+
+level_archive_data = {}
+
+level_archive_data[1] = {
+  link = "$$eoya_2007$$#best_onescreener",
+  occasion = "Best Onescreener 2007",
+  name = "Doors Galore",
+  author = "Ray Wick",
+  position = "IV/9",
+  position_num = "4009"
+}
+
+level_archive_data[2] = {
+  link = "$$eoya_2007$$#best_levelseries",
+  occasion = "Best Levelseries 2007",
+  name = "Gods of Enigma",
+  author = "moonpearl",
+  position = "V/67",
+  position_num = "5067"
+}
+
+level_archive_data[3] = {
+  link = "$$eoya_2007$$#best_levelseries",
+  occasion = "Best Levelseries 2007",
+  name = "Gods of Enigma II",
+  author = "moonpearl",
+  position = "V/69",
+  position_num = "5069"
+}
+
+level_archive_data[4] = {
+  link = "$$eoya_2007$$#best_design",
+  occasion = "Best Design 2007",
+  name = "The Aztec Temple",
+  author = "Dominik Lehmann",
+  position = "VI/100",
+  position_num = "6100"
+}
+
+level_archive_data[5] = {
+  link = "$$eoya_2007$$#funniest_level",
+  occasion = "Funniest Level 2007",
+  name = "Advancing",
+  author = "Joseph Dunne",
+  position = "VII/23",
+  position_num = "7023"
+}
+
+level_archive_data[6] = {
+  link = "$$eoya_2007$$#funniest_level",
+  occasion = "Funniest Level 2007",
+  name = "Mountain Climbing",
+  author = "Joseph Dunne",
+  position = "VII/22",
+  position_num = "7022"
+}
+
+level_archive_data[7] = {
+  link = "$$eoya_2007$$#best_yinyang",
+  occasion = "Best Yin-Yang Level 2007",
+  name = "Teamwork",
+  author = "Jacob Scott",
+  position = "III/18",
+  position_num = "3018"
+}
+
+level_archive_data[8] = {
+  link = "$$eoya_2007$$#loty",
+  occasion = "Level of the Year 2007",
+  name = "Island Labyrinth",
+  author = "Jacob Scott",
+  position = "V/100",
+  position_num = "5100"
+}
+
+level_archive_data[9] = {
+  link = "$$april_2008$$",
+  occasion = "April Fool's Day Joke 2008",
+  name = "The Three Clouds",
+  author = "Kate Lever",
+  position = "VII+/25",
+  position_num = "7925"
+}
+
+level_archive_data[10] = {
+  link = "$$level_andreas11$$",
+  occasion = "Independent Level Article 8/2008",
+  name = "Patterns of Impulse",
+  author = "Andreas Lochmann",
+  position = "IV/44",
+  position_num = "4044"
+}
+
 -- LotM variable data
 -- format: Level Title, current_rating, current_votes, additional text
 
-lotm_rating(    "Island Labyrinth",  9.31,  13,  "(1 down)")
-lotm_rating(  "Pneumatic Delivery",  8.19,  16,  "(1 up)")
-lotm_rating(    "The Aztec Temple",  9.00,  11,  "")
-lotm_rating("Labyrinth of Puzzles",  8.82,  17,  "(1 up)")
-lotm_rating(           "Elaborate",  8.64,  11,  "(2 up)")
-lotm_rating(             "Houdini",  9.28,   8,  "")
-lotm_rating(           "Tool Time",  8.17,  23,  "(5 down)")
-lotm_rating(         "Quadropolis",  9.20,  10,  "")
-lotm_rating(      "Big Adventures",  8.42,  24,  "(1 up)")
-lotm_rating(      "Temple of Gold",  9.38,   8,  "(1 up)")
-lotm_rating(      "Puzzle Puzzles",  8.63,   8,  "(2 down)")
-lotm_rating(      "Psycho Pushing",  8.18,  11,  "(1 up)")
-lotm_rating(  "Turnstiles for Two",  9.00,   5,  "")
-lotm_rating(     "Pleasure Garden",  8.43,  14,  "(1 up)")
-lotm_rating(      "Block its way!",  8.00,  17,  "")
-lotm_rating(   "Gods of Enigma II",  8.35,  17,  "<b>(newcomer)</b>")
+lotm_rating(    "Island Labyrinth",  9.29,  14,  "")
+lotm_rating(  "Pneumatic Delivery",  8.18,  17,  "(1 down)")
+lotm_rating(    "The Aztec Temple",  9.08,  13,  "")
+lotm_rating("Labyrinth of Puzzles",  8.78,  18,  "(1 up)")
+lotm_rating(           "Elaborate",  8.62,  13,  "(1 up)")
+lotm_rating(             "Houdini",  9.24,   9,  "")
+lotm_rating(           "Tool Time",  8.21,  24,  "(2 up)")
+lotm_rating(         "Quadropolis",  9.18,  11,  "")
+lotm_rating(      "Big Adventures",  8.40,  25,  "(1 up)")
+lotm_rating(      "Temple of Gold",  9.30,  10,  "")
+lotm_rating(      "Puzzle Puzzles",  8.56,   9,  "(2 down)")
+lotm_rating(      "Psycho Pushing",  8.17,  12,  "(1 down)")
+lotm_rating(  "Turnstiles for Two",  8.83,   6,  "(1 down)")
+lotm_rating(     "Pleasure Garden",  8.38,  16,  "(2 down)")
+lotm_rating(      "Block its way!",  8.00,  18,  "")
+lotm_rating(   "Gods of Enigma II",  8.39,  18,  "(1 up)")
+lotm_rating( "River of Challenges",  8.36,  11,  "<b>(newcomer)</b>")
 
 -- Don't forget to adjust the archive dates:
 



From raoul at mail.berlios.de  Mon Sep  8 14:57:18 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Mon, 8 Sep 2008 14:57:18 +0200
Subject: [Enigma-game-svn] r1310 - in trunk/data/levels: enigma_cross
	enigma_iv enigma_viii
Message-ID: <200809081257.m88CvIw6007052@sheep.berlios.de>

Author: raoul
Date: 2008-09-08 14:57:17 +0200 (Mon, 08 Sep 2008)
New Revision: 1310

Added:
   trunk/data/levels/enigma_viii/ral34_1.xml
Modified:
   trunk/data/levels/enigma_cross/enigma0_92_1.xml
   trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
   trunk/data/levels/enigma_iv/ant11_1.xml
   trunk/data/levels/enigma_iv/index.xml
   trunk/data/levels/enigma_viii/index.xml
   trunk/data/levels/enigma_viii/johann03_1.xml
   trunk/data/levels/enigma_viii/mecke01_1.xml
   trunk/data/levels/enigma_viii/ral25_1.xml
   trunk/data/levels/enigma_viii/ral26_1.xml
   trunk/data/levels/enigma_viii/welcometopack8_1.xml
Log:
-> New wire-shogun level
-> Level updates



Modified: trunk/data/levels/enigma_cross/enigma0_92_1.xml
===================================================================
--- trunk/data/levels/enigma_cross/enigma0_92_1.xml	2008-09-08 01:01:10 UTC (rev 1309)
+++ trunk/data/levels/enigma_cross/enigma0_92_1.xml	2008-09-08 12:57:17 UTC (rev 1310)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Facets" location="15100" network="false" owner="Enigma Team" release="1" revision="6" title="Enigma 0.92 - 1"/>
+  <info enigma="1.00" group="Facets" location="15100" network="false" owner="Enigma Team" release="1" revision="7" title="Enigma 0.92 - 1"/>
 
   <attributes/>
 
@@ -121,7 +121,7 @@
     <level _seq="113" _title="Robbery" _xpath="enigma_iv/ant29_2" author="Petr Machata" ctrl="force" easy="false" id="ant29" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="114" _title="Go!" _xpath="enigma_iv/ant02_1" author="Petr Machata" ctrl="force" easy="false" id="ant02" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="115" _title="Laser Magic" _xpath="enigma_ii/ant30_1" author="Petr Machata" ctrl="force" easy="false" id="ant30" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="116" _title="Cannonball" _xpath="enigma_iv/ant11_1" author="Petr Machata" ctrl="force" easy="false" id="ant11" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="116" _title="Cannonball" _xpath="enigma_iv/ant11_1" author="Petr Machata" ctrl="force" easy="false" id="ant11" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="117" _title="Islands" _xpath="enigma_i/duffy10_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy10" rel="2" rev="2" score="2" target="time" unit="duration"/>
     <level _seq="118" _title="Space Walk" _xpath="enigma_iii/nat35_2" author="Nat Pryce" ctrl="force" easy="false" id="natmaze4" rel="2" rev="0" score="2" target="time" unit="duration"/>
     <level _seq="119" _title="- Meditation -" _xpath="enigma_i/siegfried36_1" author="Siegfried Fennig" ctrl="force" easy="false" id="meditation15" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2008-09-08 01:01:10 UTC (rev 1309)
+++ trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2008-09-08 12:57:17 UTC (rev 1310)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="12" title="Enigma 1.1 new"/>
+  <info enigma="1.00" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="13" title="Enigma 1.1 new"/>
 
   <attributes/>
 
@@ -89,7 +89,7 @@
     <level _seq="81" _title="Enigmines" _xpath="enigma_viii/huffman01_1" author="Brian Huffman" ctrl="force" easy="true" id="huffman01" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="82" _title="Red Cave" _xpath="enigma_viii/mecke21_1" author="mecke" ctrl="force" easy="true" id="mecke21" rel="1" rev="30" score="1" target="time" unit="duration"/>
     <level _seq="83" _title="Status code 302" _xpath="enigma_viii/dev02_1" author="/dev/null" ctrl="force" easy="true" id="dev02" rel="1" rev="4" score="1" target="time" unit="duration"/>
-    <level _seq="84" _title="A Screenful of Secrets" _xpath="enigma_viii/mecke01_1" author="mecke" ctrl="force" easy="true" id="mecke01" rel="1" rev="22" score="1" target="time" unit="duration"/>
+    <level _seq="84" _title="A Screenful of Secrets" _xpath="enigma_viii/mecke01_1" author="mecke" ctrl="force" easy="true" id="mecke01" rel="1" rev="23" score="1" target="time" unit="duration"/>
     <level _seq="85" _title="Southside Life" _xpath="enigma_viii/mecke10_1" author="mecke" ctrl="force" easy="true" id="mecke10" rel="1" rev="18" score="1" target="time" unit="duration"/>
     <level _seq="86" _title="Joona's Chess" _xpath="enigma_viii/joona02_1" author="Joona Laire" ctrl="force" easy="true" id="joona02" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="87" _title="Helios I" _xpath="enigma_viii/mecke07_1" author="mecke" ctrl="force" easy="false" id="mecke48" rel="1" rev="12" score="1" target="time" unit="duration"/>
@@ -97,14 +97,14 @@
     <level _seq="89" _title="Tilt Board" _xpath="enigma_viii/ulf06_2" author="Ulf Stegemann" ctrl="force" easy="true" id="20080529ulf118" rel="2" rev="116" score="2" target="time" unit="duration"/>
     <level _seq="90" _title="4 - 8 - 4" _xpath="enigma_viii/dpl03_3" author="Dominik Leipold" ctrl="force" easy="true" id="20070821dpl003" rel="3" rev="4" score="3" target="time" unit="duration"/>
     <level _seq="91" _title="Impulsive Order" _xpath="enigma_viii/raywick05_1" author="Ray Wick" ctrl="force" easy="true" id="raywick5" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="92" _title="Cross Mail" _xpath="enigma_viii/johann03_1" author="Johann Freymuth" ctrl="force" easy="false" id="johann03" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="92" _title="Cross Mail" _xpath="enigma_viii/johann03_1" author="Johann Freymuth" ctrl="force" easy="false" id="johann03" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="93" _title="Color Maze" _xpath="enigma_viii/pulley16_3" author="Mark Pulley" ctrl="force" easy="false" id="pulley16" rel="3" rev="4" score="3" target="time" unit="duration"/>
     <level _seq="94" _title="Earthlink" _xpath="enigma_viii/pulley15_1" author="Mark Pulley" ctrl="force" easy="true" id="pulley15" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="95" _title="Vanity's Constrictions" _xpath="enigma_viii/andreas53_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas53" rel="2" rev="5" score="2" target="time" unit="duration"/>
     <level _seq="96" _title="Wired" _xpath="enigma_viii/andreas49_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas49" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="97" _title="Push Wires" _xpath="enigma_viii/ral24_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080708ral196" rel="1" rev="100" score="1" target="time" unit="duration"/>
-    <level _seq="98" _title="Wired Five" _xpath="enigma_viii/ral25_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080721ral073" rel="1" rev="109" score="1" target="time" unit="duration"/>
-    <level _seq="99" _title="Wireban Premiere" _xpath="enigma_viii/ral26_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080715ral161" rel="1" rev="106" score="1" target="time" unit="duration"/>
+    <level _seq="98" _title="Wired Five" _xpath="enigma_viii/ral25_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080721ral073" rel="1" rev="112" score="1" target="time" unit="duration"/>
+    <level _seq="99" _title="Wireban Premiere" _xpath="enigma_viii/ral26_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080715ral161" rel="1" rev="112" score="1" target="time" unit="duration"/>
     <level _seq="100" _title="Microwire" _xpath="enigma_viii/ral27_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral427" rel="1" rev="107" score="1" target="time" unit="duration"/>
     <level _seq="101" _title="More Microwire" _xpath="enigma_viii/ral28_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral282" rel="1" rev="105" score="1" target="time" unit="duration"/>
     <level _seq="102" _title="Freestyle Microwire" _xpath="enigma_viii/ral29_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080719ral530" rel="1" rev="107" score="1" target="time" unit="duration"/>
@@ -113,6 +113,7 @@
     <level _seq="105" _title="Fashions Pass" _xpath="enigma_viii/andreas48_2" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas48" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="106" _title="Colored Turnstiles" _xpath="enigma_viii/andreas51_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas51" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="107" _title="Sanssouci" _xpath="enigma_viii/mecke05_1" author="mecke" ctrl="force" easy="true" id="mecke05" rel="1" rev="23" score="1" target="time" unit="duration"/>
+    <level _seq="108" _title="Wired Shogun" _xpath="enigma_viii/ral34_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080828ral417" rel="1" rev="112" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Modified: trunk/data/levels/enigma_iv/ant11_1.xml
===================================================================
--- trunk/data/levels/enigma_iv/ant11_1.xml	2008-09-08 01:01:10 UTC (rev 1309)
+++ trunk/data/levels/enigma_iv/ant11_1.xml	2008-09-08 12:57:17 UTC (rev 1310)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Cannonball" el:subtitle="" el:id="ant11"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="Petr Machata" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Petr Machata</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -123,6 +123,7 @@
 
 cells["+"]=cell{item={"it-trigger", {action="callback", target="forceup"}}}
 cells["-"]=cell{parent=cells["_"],item={"it-trigger", {action="callback", target="forcedn"}}}
+cells["i"]=cell{parent=cells["."],item={"it-sensor", {action="callback", target="forcedn"}}}
 cells["*"]=cell{parent={cells[">"], cells["+"]}}
 cells["o"]=cell{item={"it-trigger", {action="callback", target="run_trigger_action"}}}
 cells["9"]=cell{item={"it-trigger", {action="callback", target="restart_trigger_action", invisible=1}}}
@@ -144,9 +145,9 @@
    "=xx        O       %ww=..............www..............Www%wwwwwwXwwwWwwwXwwwW",
    "=x 9               ====...............w...............WWWW...wwwXXXXXXXXXwwwW",
    "=x#?###############=..................w............WWWWWWW...wwwwwwwWwwwwwWWW",
-   "=x# !TvvvvvvvvvvvR&__................www...........wwwwww&wwwwwwwwwwWEwwwwe0W",
-   "=x#o!|>>*>>>*>>>*>&____________-.....whw.........wwwwwwwDWWWWWWWWWWWWWWWWWWWW",
-   "=x# !L^^^^^^^^^^^/&__................www...........wwwwww&wwwwwwwwwwWFwwwwf0W",
+   "=x# !TvvvvvvvvvvvR&__...........i....www...........wwwwww&wwwwwwwwwwWEwwwwe0W",
+   "=x#o!|>>*>>>*>>>*>&____________-i....whw.........wwwwwwwDWWWWWWWWWWWWWWWWWWWW",
+   "=x# !L^^^^^^^^^^^/&__...........i....www...........wwwwww&wwwwwwwwwwWFwwwwf0W",
    "=x#?###############=..................w............WWWWWWW...wwwwwwwWwwwwwWWW",
    "=x 9               ====...............w...............WWWW...wwwXXXXXXXXXwwwW",
    "=xx                %ww=..............www..............Www%wwwwwwXwwwWwwwXwwwW",

Modified: trunk/data/levels/enigma_iv/index.xml
===================================================================
--- trunk/data/levels/enigma_iv/index.xml	2008-09-08 01:01:10 UTC (rev 1309)
+++ trunk/data/levels/enigma_iv/index.xml	2008-09-08 12:57:17 UTC (rev 1310)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10500" network="false" owner="Enigma Team" release="1" revision="5" title="Enigma IV"/>
+  <info enigma="1.00" group="Enigma" location="10500" network="false" owner="Enigma Team" release="1" revision="6" title="Enigma IV"/>
 
   <attributes/>
 
@@ -84,7 +84,7 @@
     <level _seq="76" _title="Speed Jump" _xpath="./duffy44_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy44" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="77" _title="Bolder Run" _xpath="./just02_1" author="JuSt" ctrl="force" easy="false" id="just02" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="78" _title="Excruciating" _xpath="./duffy90_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy90" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="79" _title="Cannonball" _xpath="./ant11_1" author="Petr Machata" ctrl="force" easy="false" id="ant11" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="79" _title="Cannonball" _xpath="./ant11_1" author="Petr Machata" ctrl="force" easy="false" id="ant11" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="80" _title="Electric Funeral" _xpath="./ss15_1" author="Sven Siggelkow" ctrl="force" easy="false" id="ss15" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="81" _title="Be Faster!" _xpath="./martin98_1" author="Martin Hawlisch" ctrl="force" easy="true" id="martin98" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="82" _title="Laser Pushing" _xpath="./just04_1" author="JuSt" ctrl="force" easy="false" id="just04" rel="1" rev="2" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_viii/index.xml
===================================================================
--- trunk/data/levels/enigma_viii/index.xml	2008-09-08 01:01:10 UTC (rev 1309)
+++ trunk/data/levels/enigma_viii/index.xml	2008-09-08 12:57:17 UTC (rev 1310)
@@ -1,43 +1,111 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10900" network="false" owner="Enigma Team" release="1" revision="7" title="Enigma VIII"/>
+  <info enigma="1.00" group="Enigma" location="10800" network="false" owner="Enigma Team" release="1" revision="18" title="Enigma VII"/>
 
   <attributes/>
 
   <levels>
-    <level _seq="1" _title="Welcome" _xpath="./welcometopack8_1" author="Raoul Bourquin" ctrl="force" easy="true" id="welcometopack8" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="2" _title="Enigmaparcour" _xpath="./mecke15_1" author="mecke" ctrl="force" easy="true" id="mecke15" rel="1" rev="21" score="1" target="time" unit="duration"/>
-    <level _seq="3" _title="Rhythm of Space" _xpath="./mecke20_1" author="mecke" ctrl="force" easy="true" id="mecke20" rel="1" rev="21" score="1" target="time" unit="duration"/>
-    <level _seq="4" _title="The Show Jumper" _xpath="./andreas47_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas47" rel="1" rev="4" score="1" target="time" unit="duration"/>
-    <level _seq="5" _title="The Red Room" _xpath="./joe29_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe29" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="6" _title="Enigmines" _xpath="./huffman01_1" author="Brian Huffman" ctrl="force" easy="true" id="huffman01" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="7" _title="Red Cave" _xpath="./mecke21_1" author="mecke" ctrl="force" easy="true" id="mecke21" rel="1" rev="30" score="1" target="time" unit="duration"/>
-    <level _seq="8" _title="Status code 302" _xpath="./dev02_1" author="/dev/null" ctrl="force" easy="true" id="dev02" rel="1" rev="4" score="1" target="time" unit="duration"/>
-    <level _seq="9" _title="A Screenful of Secrets" _xpath="./mecke01_1" author="mecke" ctrl="force" easy="true" id="mecke01" rel="1" rev="22" score="1" target="time" unit="duration"/>
-    <level _seq="10" _title="Southside Life" _xpath="./mecke10_1" author="mecke" ctrl="force" easy="true" id="mecke10" rel="1" rev="18" score="1" target="time" unit="duration"/>
-    <level _seq="11" _title="Joona's Chess" _xpath="./joona02_1" author="Joona Laire" ctrl="force" easy="true" id="joona02" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="12" _title="Helios I" _xpath="./mecke07_1" author="mecke" ctrl="force" easy="false" id="mecke48" rel="1" rev="12" score="1" target="time" unit="duration"/>
-    <level _seq="13" _title="The Green Hell" _xpath="./mecke22_1" author="mecke" ctrl="force" easy="true" id="mecke22" rel="1" rev="55" score="1" target="time" unit="duration"/>
-    <level _seq="14" _title="Tilt Board" _xpath="./ulf06_2" author="Ulf Stegemann" ctrl="force" easy="true" id="20080529ulf118" rel="2" rev="116" score="2" target="time" unit="duration"/>
-    <level _seq="15" _title="4 - 8 - 4" _xpath="./dpl03_3" author="Dominik Leipold" ctrl="force" easy="true" id="20070821dpl003" rel="3" rev="4" score="3" target="time" unit="duration"/>
-    <level _seq="16" _title="Impulsive Order" _xpath="./raywick05_1" author="Ray Wick" ctrl="force" easy="true" id="raywick5" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="17" _title="Cross Mail" _xpath="./johann03_1" author="Johann Freymuth" ctrl="force" easy="false" id="johann03" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="18" _title="Color Maze" _xpath="./pulley16_3" author="Mark Pulley" ctrl="force" easy="false" id="pulley16" rel="3" rev="4" score="3" target="time" unit="duration"/>
-    <level _seq="19" _title="Earthlink" _xpath="./pulley15_1" author="Mark Pulley" ctrl="force" easy="true" id="pulley15" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="20" _title="Vanity's Constrictions" _xpath="./andreas53_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas53" rel="2" rev="5" score="2" target="time" unit="duration"/>
-    <level _seq="21" _title="Wired" _xpath="./andreas49_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas49" rel="1" rev="4" score="1" target="time" unit="duration"/>
-    <level _seq="22" _title="Push Wires" _xpath="./ral24_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080708ral196" rel="1" rev="100" score="1" target="time" unit="duration"/>
-    <level _seq="23" _title="Wired Five" _xpath="./ral25_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080721ral073" rel="1" rev="109" score="1" target="time" unit="duration"/>
-    <level _seq="24" _title="Wireban Premiere" _xpath="./ral26_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080715ral161" rel="1" rev="106" score="1" target="time" unit="duration"/>
-    <level _seq="25" _title="Microwire" _xpath="./ral27_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral427" rel="1" rev="107" score="1" target="time" unit="duration"/>
-    <level _seq="26" _title="More Microwire" _xpath="./ral28_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral282" rel="1" rev="105" score="1" target="time" unit="duration"/>
-    <level _seq="27" _title="Freestyle Microwire" _xpath="./ral29_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080719ral530" rel="1" rev="107" score="1" target="time" unit="duration"/>
-    <level _seq="28" _title="Balance Beam" _xpath="./mecke03_1" author="mecke" ctrl="force" easy="true" id="mecke03" rel="1" rev="29" score="1" target="time" unit="duration"/>
-    <level _seq="29" _title="Colored Oxyds" _xpath="./andreas50_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas50" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="30" _title="Fashions Pass" _xpath="./andreas48_2" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas48" rel="2" rev="3" score="2" target="time" unit="duration"/>
-    <level _seq="31" _title="Colored Turnstiles" _xpath="./andreas51_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas51" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="32" _title="Sanssouci" _xpath="./mecke05_1" author="mecke" ctrl="force" easy="true" id="mecke05" rel="1" rev="23" score="1" target="time" unit="duration"/>
+    <level _seq="1" _title="Welcome" _xpath="./welcometopack7_1" author="Raoul Bourquin" ctrl="force" easy="true" id="welcometopack7" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="2" _title="Diving" _xpath="./joona13_1" author="Joona Laire" ctrl="force" easy="true" id="20061203joona500" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="3" _title="Comet" _xpath="./duffy147_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy147" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="4" _title="Caribbean Waters" _xpath="./duffy139_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy139" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="5" _title="DownDown" _xpath="./joona01_1" author="Joona Laire" ctrl="force" easy="true" id="20070406joona005" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="6" _title="Exclusive Pole Positions" _xpath="./duffy149_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy149" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="7" _title="Mirror Sharing" _xpath="./duffy150_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy150" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="8" _title="Temple of Ganesha" _xpath="./duffy154_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy154" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="9" _title="Open Path" _xpath="./duffy152_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy152" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="10" _title="- Meditation -" _xpath="./edward30_1" author="Edward" ctrl="force" easy="true" id="edward30" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="11" _title="Laser Squad" _xpath="./duffy153_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy153" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="12" _title="Free Riders" _xpath="./duffy155_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy155" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="13" _title="Oneway for White" _xpath="./duffy157_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy157" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="14" _title="The Wild Hunt" _xpath="./duffy159_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy159" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="15" _title="Widgets in the Attic" _xpath="./duffy158_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy158" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="16" _title="Protected Exhibition" _xpath="./duffy156_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy156" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="17" _title="Upstairs Meditation" _xpath="./duffy138_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy138" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="18" _title="Speed Meditation" _xpath="./duffy148_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy148" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="19" _title="Pool with a pole" _xpath="./alain28_1" author="Alain Busser" ctrl="force" easy="false" id="alain28" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="20" _title="Meditation in Peace" _xpath="./ral20_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070502ral466" rel="1" rev="70" score="1" target="time" unit="duration"/>
+    <level _seq="21" _title="Cold Meditation" _xpath="./ral18_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070314ral728" rel="1" rev="67" score="1" target="time" unit="duration"/>
+    <level _seq="22" _title="Mountain Climbing" _xpath="./joe10_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe10" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="23" _title="Advancing" _xpath="./joe01_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe01" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="24" _title="Temple of Gold" _xpath="./duffy151_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy151" rel="3" rev="6" score="3" target="time" unit="duration"/>
+    <level _seq="25" _title="Inkblot 1" _xpath="./npb01_1" author="Nathan Bronecke" ctrl="force" easy="true" id="20070519npb015045" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="26" _title="mad-ill-tation" _xpath="./illmind14_1" author="illmind" ctrl="force" easy="false" id="ill0907-01" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="27" _title="- Meditation -" _xpath="./joe04_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe4" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="28" _title="- Meditation -" _xpath="./joe05_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe5" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="29" _title="Working Outwards" _xpath="./joe06_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe6" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="30" _title="Super Puzzle" _xpath="./joe11_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe11" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="31" _title="Pantograph" _xpath="./duffy160_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy160" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="32" _title="Advanced Space Tubes" _xpath="./duffy161_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy161" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="33" _title="Deserted Island" _xpath="./joe08_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe8" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="34" _title="The Fortress" _xpath="./joe09_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe9" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="35" _title="Manuevre" _xpath="./joe13_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe13" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="36" _title="Mayan Meditation" _xpath="./duffy162_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy162" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="37" _title="Horseshoes" _xpath="./duffy163_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy163" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="38" _title="Knot Garden" _xpath="./duffy165_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy165" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="39" _title="Impulse-phobia" _xpath="./duffy166_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy166" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="40" _title="Slopes, Jumps &amp; Falls" _xpath="./duffy167_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy167" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="41" _title="Arctic Jumping" _xpath="./duffy168_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy168" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="42" _title="Breakthrough" _xpath="./duffy170_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy170" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="43" _title="Seasonal Patterns" _xpath="./duffy164_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy164" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="44" _title="Shark" _xpath="./duffy169_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy169" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="45" _title="Alpha Factor" _xpath="./duffy171_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy171" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="46" _title="Double Oneways" _xpath="./duffy172_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy172" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="47" _title="Wood - Water - Wood" _xpath="./duffy173_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy173" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="48" _title="Transpositions" _xpath="./duffy174_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy174" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="49" _title="Puppet" _xpath="./pulley06_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley06" rel="2" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="50" _title="Restless Meditation" _xpath="./ral09_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070623ral914" rel="1" rev="77" score="1" target="time" unit="duration"/>
+    <level _seq="51" _title="Ghost Driver" _xpath="./duffy176_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy176" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="52" _title="Re-entry Circuit" _xpath="./pulley05_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley05" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="53" _title="Not Fast Enough" _xpath="./jet04_3" author="James Taylor, Ronald Lamprecht" ctrl="force" easy="true" id="20070413jet001" rel="3" rev="3" score="3" target="time" unit="duration"/>
+    <level _seq="54" _title="Give Way" _xpath="./just20_1" author="JuSt" ctrl="force" easy="false" id="just20" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="55" _title="Give more Way" _xpath="./just21_2" author="JuSt" ctrl="force" easy="true" id="just21" rel="2" rev="3" score="2" target="time" unit="duration"/>
+    <level _seq="56" _title="Give Way 4 two" _xpath="./just22_2" author="JuSt" ctrl="force" easy="true" id="just22" rel="2" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="57" _title="Lost in Time and Space" _xpath="./just23_1" author="JuSt" ctrl="force" easy="false" id="just23" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="58" _title="Alternatives?" _xpath="./just24_1" author="JuSt" ctrl="force" easy="true" id="just24" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="59" _title="No More Alternatives" _xpath="./just25_1" author="JuSt" ctrl="force" easy="true" id="just25" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="60" _title="The Walls" _xpath="./just26_1" author="JuSt" ctrl="force" easy="true" id="just26" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="61" _title="Pull the Puller" _xpath="./just28_1" author="JuSt" ctrl="force" easy="false" id="just28" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="62" _title="Double Sense" _xpath="./joe14_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe14" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="63" _title="Double Sense II" _xpath="./joe15_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe15" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="64" _title="Lightyears" _xpath="./duffy177_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy177" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="65" _title="Zero Magnetism Lab" _xpath="./duffy178_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy178" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="66" _title="Armageddon" _xpath="./duffy179_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy179" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="67" _title="Mountain Climbing II" _xpath="./joe25_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe25" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="68" _title="Minor Tangler" _xpath="./joe24_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe24" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="69" _title="Circulation" _xpath="./pulley03_2" author="Mark Pulley" ctrl="force" easy="false" id="pulley03" rel="2" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="70" _title="Maze for Two" _xpath="./ral22_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20071017ral096" rel="1" rev="84" score="1" target="time" unit="duration"/>
+    <level _seq="71" _title="Making Shapes" _xpath="./joe18_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe18" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="72" _title="Clever Pushing" _xpath="./joe19_2" author="Joseph Dunne" ctrl="force" easy="false" id="joe19" rel="2" rev="1" score="2" target="time" unit="duration"/>
+    <level _seq="73" _title="Using Rotators" _xpath="./joe20_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe20" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="74" _title="Swapping Puzzle" _xpath="./joe21_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe21" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="75" _title="Swapping Puzzle II" _xpath="./joe22_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe22" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="76" _title="Multiban" _xpath="./dpl01_1" author="Dominik Leipold" ctrl="force" easy="false" id="dpl01" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="77" _title="Riverside" _xpath="./johann02_2" author="Johann Freymuth" ctrl="force" easy="false" id="johann02" rel="2" rev="0" score="2" target="time" unit="duration"/>
+    <level _seq="78" _title="The Lone Ranger" _xpath="./pulley04_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley04" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="79" _title="Little Shop Of Horrors" _xpath="./pulley07_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley07" rel="1" rev="5" score="1" target="time" unit="duration"/>
+    <level _seq="80" _title="Spaceship Control" _xpath="./safalra01_1" author="Safalra" ctrl="force" easy="false" id="safalra01" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="81" _title="Ball Alley" _xpath="./johann01_1" author="Johann Freymuth" ctrl="force" easy="false" id="johann01" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="82" _title="Action Potential" _xpath="./pulley02_1" author="Mark Pulley" ctrl="force" easy="true" id="pulley02" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="83" _title="Remote Meditation" _xpath="./dpl02_1" author="Dominik Leipold" ctrl="force" easy="true" id="dpl02" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="84" _title="Triggered Triggers" _xpath="./just19_1" author="JuSt" ctrl="force" easy="true" id="just19" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="85" _title="Lady in Red" _xpath="./just30_1" author="Just" ctrl="force" easy="true" id="just30" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="86" _title="Crawling the Abyss" _xpath="./sph02_1" author="ShadowPhrogg32642342" ctrl="force" easy="true" id="sph02" rel="1" rev="5" score="1" target="time" unit="duration"/>
+    <level _seq="87" _title="Bold Boulder" _xpath="./ral14_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20061124ral279" rel="1" rev="96" score="1" target="time" unit="duration"/>
+    <level _seq="88" _title="Tinker, Tailor" _xpath="./andreas46_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas46" rel="4" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="89" _title="Elbow Society" _xpath="./andreas45_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas45" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="90" _title="Watchmaker" _xpath="./huesing01_1" author="Johannes H?sing" ctrl="force" easy="false" id="huesing01" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="91" _title="Map it out II" _xpath="./manuel01_1" author="Manuel Eisentraut" ctrl="force" easy="true" id="manuel01" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="92" _title="Underground Temple" _xpath="./joe12_2" author="Joseph Dunne" ctrl="force" easy="true" id="joe_12" rel="2" rev="0" score="2" target="time" unit="duration"/>
+    <level _seq="93" _title="Mountain Climbing III" _xpath="./joe26_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe26" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="94" _title="Recover the Stone" _xpath="./joe28_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe28" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="95" _title="Pick-Up" _xpath="./joe27_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe27" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="96" _title="A Kind of Magic" _xpath="./just37_1" author="JuSt" ctrl="force" easy="true" id="JuStA Kind of Magic" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="97" _title="Blue Screen Of Death" _xpath="./pulley10_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley10" rel="2" rev="1" score="2" target="time" unit="duration"/>
+    <level _seq="98" _title="Audience in Venice" _xpath="./mecke09_1" author="mecke" ctrl="force" easy="true" id="mecke9" rel="1" rev="20" score="1" target="time" unit="duration"/>
+    <level _seq="99" _title="Black Liberation" _xpath="./mecke11_1" author="mecke" ctrl="force" easy="true" id="mecke11" rel="1" rev="25" score="1" target="time" unit="duration"/>
+    <level _seq="100" _title="Jack-Of-All-Trades" _xpath="./mecke12_1" author="mecke" ctrl="force" easy="true" id="mecke12" rel="1" rev="31" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Modified: trunk/data/levels/enigma_viii/johann03_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/johann03_1.xml	2008-09-08 01:01:10 UTC (rev 1309)
+++ trunk/data/levels/enigma_viii/johann03_1.xml	2008-09-08 12:57:17 UTC (rev 1310)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Cross Mail" el:subtitle="The level goes on" el:id="johann03"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="Johann Freymuth" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Johann Freymuth</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -16,26 +16,26 @@
 
 ti[" "] = {"fl-white"}
 ti["x"] = {"it_cross"}
-ti["|"] = {"it-pipe-v"}
-ti["9"] = {"it-pipe-ne"}
-ti["8"] = {"it-pipe-es"}
-ti["7"] = {"it-pipe-sw"}
-ti["6"] = {"it-pipe-wn"}
+ti["|"] = {"it_pipe_ns"}
+ti["9"] = {"it_pipe_ne"}
+ti["8"] = {"it_pipe_es"}
+ti["7"] = {"it_pipe_sw"}
+ti["6"] = {"it_pipe_nw"}
 ti["b"] = {"it_brush"}
 ti["h"] = {"it_hammer"}
 ti["d"] = {"it-dynamite"}
 ti["o"] = {"it-blackbomb"}
 ti["#"] = {"st-glass2"}
 ti["C"] = {"st-glass1"}
-ti["0"] = ti["C"] .. {"it-pipe-v"}
-ti["1"] = ti["C"] .. {"it-pipe-h"}
-ti["2"] = ti["C"] .. {"it-pipe-ne"}
-ti["3"] = ti["C"] .. {"it-pipe-es"}
-ti["4"] = ti["C"] .. {"it-pipe-sw"}
-ti["5"] = ti["C"] .. {"it-pipe-wn"}
+ti["0"] = ti["C"] .. {"it_pipe_ns"}
+ti["1"] = ti["C"] .. {"it_pipe_ew"}
+ti["2"] = ti["C"] .. {"it_pipe_ne"}
+ti["3"] = ti["C"] .. {"it_pipe_es"}
+ti["4"] = ti["C"] .. {"it_pipe_sw"}
+ti["5"] = ti["C"] .. {"it_pipe_nw"}
 ti["X"] = ti["x"] .. {"st-glass2"}
-ti["M"] = {"st-mail-e"}
-ti["U"] = {"st-mail-n"}
+ti["M"] = {"st_mail_e"}
+ti["U"] = {"st_mail_n"}
 ti["I"] = {"st-break_invisible"}
 ti["O"] = {"st_oxyd", name="oxydstone#"}
 ti["i"] = {"st_switch", target="setv"}
@@ -66,22 +66,22 @@
 wo:shuffleOxyd({"oxydstone#*", linear=true})
 
 function setv()
-    wo[{1,9}] = {"it-pipe-v"}
+    wo[{1,9}] = {"it_pipe_ns"}
 end
 function seth()
-    wo[{2,9}] = {"it-pipe-h"}
+    wo[{2,9}] = {"it_pipe_ew"}
 end
 function setne()
-    wo[{3,9}] = {"it-pipe-ne"}
+    wo[{3,9}] = {"it_pipe_ne"}
 end
 function setes()
-    wo[{4,9}] = {"it-pipe-es"}
+    wo[{4,9}] = {"it_pipe_es"}
 end
 function setsw()
-    wo[{5,9}] = {"it-pipe-sw"}
+    wo[{5,9}] = {"it_pipe_sw"}
 end
 function setwn()
-    wo[{6,9}] = {"it-pipe-wn"}
+    wo[{6,9}] = {"it_pipe_nw"}
 end
     ]]></el:luamain>
     <el:i18n>

Modified: trunk/data/levels/enigma_viii/mecke01_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke01_1.xml	2008-09-08 01:01:10 UTC (rev 1309)
+++ trunk/data/levels/enigma_viii/mecke01_1.xml	2008-09-08 12:57:17 UTC (rev 1310)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="A Screenful of Secrets" el:subtitle="My First Level" el:id="mecke01"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 22 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 23 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -46,7 +46,7 @@
 ti["R "] = ti["R"] .. ti["X "]
 ti["o "] = {"st_oxyd", flavor="d"}
 ti["O "] = {"st_oxyd",flavor="d", name="O#"}
-ti[". "] = {"it-tinyhill"}
+ti[". "] = {"it_meditation_bump"}
 ti["c "] = {"it-cherry"}
 ti["| "] = {"st_death_invisible"}
 ti[", "] = {"st-likeoxydd"}

Modified: trunk/data/levels/enigma_viii/ral25_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral25_1.xml	2008-09-08 01:01:10 UTC (rev 1309)
+++ trunk/data/levels/enigma_viii/ral25_1.xml	2008-09-08 12:57:17 UTC (rev 1310)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Wired Five" el:subtitle="" el:id="20080721ral073"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 109 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 112 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -37,8 +37,8 @@
 ti["brownie"] = {"st-marble_move", "brownie%%"}
 ti["mini"] = {"fl-light", friction=7, mousefactor=1.8} 
              .. ti({"#ac-whiteball-small", player=0})
-             .. ti({"it-tinyhill", "hill%%"})
-ti[","] = ti["."] .. {"it-tinyhill", "hill%5"}
+             .. ti({"it_meditation_bump", "hill%%"})
+ti[","] = ti["."] .. {"it_meditation_bump", "hill%5"}
 ti["@"] = ti["."] .. {"#ac-whiteball-small", player=0, essential=-1}
 
 myres = res.autotile(ti,{"1","5","brownie"},{"a","d","mini"},{"A","E","trigger"})

Modified: trunk/data/levels/enigma_viii/ral26_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral26_1.xml	2008-09-08 01:01:10 UTC (rev 1309)
+++ trunk/data/levels/enigma_viii/ral26_1.xml	2008-09-08 12:57:17 UTC (rev 1310)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Wireban Premiere" el:subtitle="" el:id="20080715ral161"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 106 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 112 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -21,8 +21,8 @@
 ti["+"] = {"st-grate1"}
 ti["w"] = {"st-brownie", "wood1"}
 ti["W"] = {"st-brownie", "wood2"}
-ti["D"] = {"st_door", "door1", flavor="a"}
-ti["d"] = {"st_door", "door2", flavor="a"}
+ti["D"] = {"st_door_a", "door1"}
+ti["d"] = {"st_door_a", "door2"}
 ti["T"] = {"it_trigger", target="door1"}
 ti["t"] = {"it_trigger", target="door2"}
 ti["L"] = {"st_oxyd", "left#"}

Added: trunk/data/levels/enigma_viii/ral34_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral34_1.xml	2008-09-08 01:01:10 UTC (rev 1309)
+++ trunk/data/levels/enigma_viii/ral34_1.xml	2008-09-08 12:57:17 UTC (rev 1310)
@@ -0,0 +1,91 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Wired Shogun" el:subtitle="" el:id="20080828ral417"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 112 $" el:status="released"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:score el:easy="2:05" el:difficult="3:29"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-light", checkerboard=1} .. ti({"fl-marble", checkerboard=0})
+ti["."] = {"fl-abyss"}
+
+ti["1"] = {"st_shogun_l", "l1"}
+ti["2"] = {"st_shogun_l", "l2"}
+ti["4"] = {"st_shogun_m", "m1"}
+ti["5"] = {"st_shogun_m", "m2"}
+ti["7"] = {"st_shogun_s", "s1"}
+ti["8"] = {"st_shogun_s", "s2"}
+
+ti["a"] = {"it_shogun_l", target="ba#*", action="openclose"}
+
+ti["A"] = {"fl-bridge", "ba#", type="a"}
+ti["B"] = {"fl-bridge", "bb#", type="a"}
+ti["C"] = {"fl-bridge", "bc#", type="a"}
+
+if wo["IsDifficult"] then
+  ti["3"] = {"st_shogun_l", "l3"}
+  ti["6"] = {"st_shogun_m", "m3"}
+  ti["9"] = {"st_shogun_s", "s3"}
+  ti["b"] = {"it_shogun_l", target="bb#*", action="openclose"}
+  ti["c"] = {"it_shogun_l", target="bc#*", action="openclose"}
+  ti["D"] = ti["."]
+else
+  ti["3"] = ti[" "]
+  ti["6"] = {"it_shogun_l", target="bd#*", action="openclose"}
+  ti["9"] = ti[" "]
+  ti["b"] = ti[" "]
+  ti["c"] = ti[" "]
+  ti["D"] = {"fl-bridge", "bd#", type="a"}
+end
+
+ti["X"] = {"st_oxyd_d"} .. ti["."]
+
+ti["@"] = {"#ac-blackball"}
+
+
+w, h = wo(ti, " ", {
+"...................",
+"..XCB.       .BCX..",
+"..CDA 1     8 ADC..",
+"..BA           AB..",
+"...    9   b    ...",
+"..               ..",
+".. 5   a @ 6   4 ..",
+"..               ..",
+"...    3   c    ...",
+"..BA           AB..",
+"..CDA 7     2 ADC..",
+"..XCB.       .BCX..",
+"..................."
+})
+
+if wo["IsDifficult"] then
+  wo:add({"ot_wire", anchor1="l1", anchor2="m1"})
+  wo:add({"ot_wire", anchor1="s1", anchor2="m1"})
+  wo:add({"ot_wire", anchor1="l2", anchor2="m2"})
+  wo:add({"ot_wire", anchor1="s2", anchor2="m2"})
+  wo:add({"ot_wire", anchor1="l3", anchor2="m3"})
+  wo:add({"ot_wire", anchor1="s3", anchor2="m3"})
+else
+  wo:add({"ot_wire", anchor1="l1", anchor2="m1"})
+  wo:add({"ot_wire", anchor1="s1", anchor2="l2"})
+  wo:add({"ot_wire", anchor1="s2", anchor2="m2"})
+end
+
+wo:shuffleOxyd()
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_viii/ral34_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/data/levels/enigma_viii/welcometopack8_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/welcometopack8_1.xml	2008-09-08 01:01:10 UTC (rev 1309)
+++ trunk/data/levels/enigma_viii/welcometopack8_1.xml	2008-09-08 12:57:17 UTC (rev 1310)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Welcome" el:subtitle="" el:id="welcometopack8"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="Raoul Bourquin" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Raoul Bourquin</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -27,7 +27,7 @@
 
 if wo["IsDifficult"] then
     ti["T"] = {"st_timer", target="fart1", action="toggle", interval=30}
-    ti["F"] = {"st-fart", "fart1"}
+    ti["F"] = {"st_fart", "fart1"}
 else
     ti["T"] = ti[" "]
     ti["F"] = ti[" "]



From raoul at mail.berlios.de  Mon Sep  8 15:04:12 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Mon, 8 Sep 2008 15:04:12 +0200
Subject: [Enigma-game-svn] r1311 - trunk/data/levels/enigma_viii
Message-ID: <200809081304.m88D4CUw008001@sheep.berlios.de>

Author: raoul
Date: 2008-09-08 15:04:11 +0200 (Mon, 08 Sep 2008)
New Revision: 1311

Modified:
   trunk/data/levels/enigma_viii/index.xml
Log:
-> Wrong index for pack VIII in last commit



Modified: trunk/data/levels/enigma_viii/index.xml
===================================================================
--- trunk/data/levels/enigma_viii/index.xml	2008-09-08 12:57:17 UTC (rev 1310)
+++ trunk/data/levels/enigma_viii/index.xml	2008-09-08 13:04:11 UTC (rev 1311)
@@ -1,111 +1,44 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10800" network="false" owner="Enigma Team" release="1" revision="18" title="Enigma VII"/>
+  <info enigma="1.00" group="Enigma" location="10900" network="false" owner="Enigma Team" release="1" revision="8" title="Enigma VIII"/>
 
   <attributes/>
 
   <levels>
-    <level _seq="1" _title="Welcome" _xpath="./welcometopack7_1" author="Raoul Bourquin" ctrl="force" easy="true" id="welcometopack7" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="2" _title="Diving" _xpath="./joona13_1" author="Joona Laire" ctrl="force" easy="true" id="20061203joona500" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="3" _title="Comet" _xpath="./duffy147_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy147" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="4" _title="Caribbean Waters" _xpath="./duffy139_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy139" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="5" _title="DownDown" _xpath="./joona01_1" author="Joona Laire" ctrl="force" easy="true" id="20070406joona005" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="6" _title="Exclusive Pole Positions" _xpath="./duffy149_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy149" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="7" _title="Mirror Sharing" _xpath="./duffy150_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy150" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="8" _title="Temple of Ganesha" _xpath="./duffy154_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy154" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="9" _title="Open Path" _xpath="./duffy152_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy152" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="10" _title="- Meditation -" _xpath="./edward30_1" author="Edward" ctrl="force" easy="true" id="edward30" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="11" _title="Laser Squad" _xpath="./duffy153_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy153" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="12" _title="Free Riders" _xpath="./duffy155_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy155" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="13" _title="Oneway for White" _xpath="./duffy157_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy157" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="14" _title="The Wild Hunt" _xpath="./duffy159_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy159" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="15" _title="Widgets in the Attic" _xpath="./duffy158_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy158" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="16" _title="Protected Exhibition" _xpath="./duffy156_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy156" rel="1" rev="3" score="1" target="time" unit="duration"/>
-    <level _seq="17" _title="Upstairs Meditation" _xpath="./duffy138_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy138" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="18" _title="Speed Meditation" _xpath="./duffy148_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy148" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="19" _title="Pool with a pole" _xpath="./alain28_1" author="Alain Busser" ctrl="force" easy="false" id="alain28" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="20" _title="Meditation in Peace" _xpath="./ral20_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070502ral466" rel="1" rev="70" score="1" target="time" unit="duration"/>
-    <level _seq="21" _title="Cold Meditation" _xpath="./ral18_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070314ral728" rel="1" rev="67" score="1" target="time" unit="duration"/>
-    <level _seq="22" _title="Mountain Climbing" _xpath="./joe10_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe10" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="23" _title="Advancing" _xpath="./joe01_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe01" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="24" _title="Temple of Gold" _xpath="./duffy151_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy151" rel="3" rev="6" score="3" target="time" unit="duration"/>
-    <level _seq="25" _title="Inkblot 1" _xpath="./npb01_1" author="Nathan Bronecke" ctrl="force" easy="true" id="20070519npb015045" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="26" _title="mad-ill-tation" _xpath="./illmind14_1" author="illmind" ctrl="force" easy="false" id="ill0907-01" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="27" _title="- Meditation -" _xpath="./joe04_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe4" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="28" _title="- Meditation -" _xpath="./joe05_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe5" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="29" _title="Working Outwards" _xpath="./joe06_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe6" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="30" _title="Super Puzzle" _xpath="./joe11_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe11" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="31" _title="Pantograph" _xpath="./duffy160_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy160" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="32" _title="Advanced Space Tubes" _xpath="./duffy161_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy161" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="33" _title="Deserted Island" _xpath="./joe08_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe8" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="34" _title="The Fortress" _xpath="./joe09_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe9" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="35" _title="Manuevre" _xpath="./joe13_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe13" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="36" _title="Mayan Meditation" _xpath="./duffy162_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy162" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="37" _title="Horseshoes" _xpath="./duffy163_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy163" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="38" _title="Knot Garden" _xpath="./duffy165_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy165" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="39" _title="Impulse-phobia" _xpath="./duffy166_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy166" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="40" _title="Slopes, Jumps &amp; Falls" _xpath="./duffy167_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy167" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="41" _title="Arctic Jumping" _xpath="./duffy168_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy168" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="42" _title="Breakthrough" _xpath="./duffy170_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy170" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="43" _title="Seasonal Patterns" _xpath="./duffy164_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy164" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="44" _title="Shark" _xpath="./duffy169_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy169" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="45" _title="Alpha Factor" _xpath="./duffy171_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy171" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="46" _title="Double Oneways" _xpath="./duffy172_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy172" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="47" _title="Wood - Water - Wood" _xpath="./duffy173_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy173" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="48" _title="Transpositions" _xpath="./duffy174_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy174" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="49" _title="Puppet" _xpath="./pulley06_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley06" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="50" _title="Restless Meditation" _xpath="./ral09_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070623ral914" rel="1" rev="77" score="1" target="time" unit="duration"/>
-    <level _seq="51" _title="Ghost Driver" _xpath="./duffy176_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy176" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="52" _title="Re-entry Circuit" _xpath="./pulley05_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley05" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="53" _title="Not Fast Enough" _xpath="./jet04_3" author="James Taylor, Ronald Lamprecht" ctrl="force" easy="true" id="20070413jet001" rel="3" rev="3" score="3" target="time" unit="duration"/>
-    <level _seq="54" _title="Give Way" _xpath="./just20_1" author="JuSt" ctrl="force" easy="false" id="just20" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="55" _title="Give more Way" _xpath="./just21_2" author="JuSt" ctrl="force" easy="true" id="just21" rel="2" rev="3" score="2" target="time" unit="duration"/>
-    <level _seq="56" _title="Give Way 4 two" _xpath="./just22_2" author="JuSt" ctrl="force" easy="true" id="just22" rel="2" rev="2" score="2" target="time" unit="duration"/>
-    <level _seq="57" _title="Lost in Time and Space" _xpath="./just23_1" author="JuSt" ctrl="force" easy="false" id="just23" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="58" _title="Alternatives?" _xpath="./just24_1" author="JuSt" ctrl="force" easy="true" id="just24" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="59" _title="No More Alternatives" _xpath="./just25_1" author="JuSt" ctrl="force" easy="true" id="just25" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="60" _title="The Walls" _xpath="./just26_1" author="JuSt" ctrl="force" easy="true" id="just26" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="61" _title="Pull the Puller" _xpath="./just28_1" author="JuSt" ctrl="force" easy="false" id="just28" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="62" _title="Double Sense" _xpath="./joe14_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe14" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="63" _title="Double Sense II" _xpath="./joe15_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe15" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="64" _title="Lightyears" _xpath="./duffy177_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy177" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="65" _title="Zero Magnetism Lab" _xpath="./duffy178_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy178" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="66" _title="Armageddon" _xpath="./duffy179_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy179" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="67" _title="Mountain Climbing II" _xpath="./joe25_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe25" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="68" _title="Minor Tangler" _xpath="./joe24_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe24" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="69" _title="Circulation" _xpath="./pulley03_2" author="Mark Pulley" ctrl="force" easy="false" id="pulley03" rel="2" rev="2" score="2" target="time" unit="duration"/>
-    <level _seq="70" _title="Maze for Two" _xpath="./ral22_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20071017ral096" rel="1" rev="84" score="1" target="time" unit="duration"/>
-    <level _seq="71" _title="Making Shapes" _xpath="./joe18_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe18" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="72" _title="Clever Pushing" _xpath="./joe19_2" author="Joseph Dunne" ctrl="force" easy="false" id="joe19" rel="2" rev="1" score="2" target="time" unit="duration"/>
-    <level _seq="73" _title="Using Rotators" _xpath="./joe20_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe20" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="74" _title="Swapping Puzzle" _xpath="./joe21_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe21" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="75" _title="Swapping Puzzle II" _xpath="./joe22_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe22" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="76" _title="Multiban" _xpath="./dpl01_1" author="Dominik Leipold" ctrl="force" easy="false" id="dpl01" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="77" _title="Riverside" _xpath="./johann02_2" author="Johann Freymuth" ctrl="force" easy="false" id="johann02" rel="2" rev="0" score="2" target="time" unit="duration"/>
-    <level _seq="78" _title="The Lone Ranger" _xpath="./pulley04_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley04" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="79" _title="Little Shop Of Horrors" _xpath="./pulley07_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley07" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="80" _title="Spaceship Control" _xpath="./safalra01_1" author="Safalra" ctrl="force" easy="false" id="safalra01" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="81" _title="Ball Alley" _xpath="./johann01_1" author="Johann Freymuth" ctrl="force" easy="false" id="johann01" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="82" _title="Action Potential" _xpath="./pulley02_1" author="Mark Pulley" ctrl="force" easy="true" id="pulley02" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="83" _title="Remote Meditation" _xpath="./dpl02_1" author="Dominik Leipold" ctrl="force" easy="true" id="dpl02" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="84" _title="Triggered Triggers" _xpath="./just19_1" author="JuSt" ctrl="force" easy="true" id="just19" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="85" _title="Lady in Red" _xpath="./just30_1" author="Just" ctrl="force" easy="true" id="just30" rel="1" rev="3" score="1" target="time" unit="duration"/>
-    <level _seq="86" _title="Crawling the Abyss" _xpath="./sph02_1" author="ShadowPhrogg32642342" ctrl="force" easy="true" id="sph02" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="87" _title="Bold Boulder" _xpath="./ral14_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20061124ral279" rel="1" rev="96" score="1" target="time" unit="duration"/>
-    <level _seq="88" _title="Tinker, Tailor" _xpath="./andreas46_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas46" rel="4" rev="5" score="2" target="time" unit="duration"/>
-    <level _seq="89" _title="Elbow Society" _xpath="./andreas45_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas45" rel="2" rev="5" score="2" target="time" unit="duration"/>
-    <level _seq="90" _title="Watchmaker" _xpath="./huesing01_1" author="Johannes H?sing" ctrl="force" easy="false" id="huesing01" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="91" _title="Map it out II" _xpath="./manuel01_1" author="Manuel Eisentraut" ctrl="force" easy="true" id="manuel01" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="92" _title="Underground Temple" _xpath="./joe12_2" author="Joseph Dunne" ctrl="force" easy="true" id="joe_12" rel="2" rev="0" score="2" target="time" unit="duration"/>
-    <level _seq="93" _title="Mountain Climbing III" _xpath="./joe26_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe26" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="94" _title="Recover the Stone" _xpath="./joe28_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe28" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="95" _title="Pick-Up" _xpath="./joe27_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe27" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="96" _title="A Kind of Magic" _xpath="./just37_1" author="JuSt" ctrl="force" easy="true" id="JuStA Kind of Magic" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="97" _title="Blue Screen Of Death" _xpath="./pulley10_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley10" rel="2" rev="1" score="2" target="time" unit="duration"/>
-    <level _seq="98" _title="Audience in Venice" _xpath="./mecke09_1" author="mecke" ctrl="force" easy="true" id="mecke9" rel="1" rev="20" score="1" target="time" unit="duration"/>
-    <level _seq="99" _title="Black Liberation" _xpath="./mecke11_1" author="mecke" ctrl="force" easy="true" id="mecke11" rel="1" rev="25" score="1" target="time" unit="duration"/>
-    <level _seq="100" _title="Jack-Of-All-Trades" _xpath="./mecke12_1" author="mecke" ctrl="force" easy="true" id="mecke12" rel="1" rev="31" score="1" target="time" unit="duration"/>
+    <level _seq="1" _title="Welcome" _xpath="./welcometopack8_1" author="Raoul Bourquin" ctrl="force" easy="true" id="welcometopack8" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="2" _title="Enigmaparcour" _xpath="./mecke15_1" author="mecke" ctrl="force" easy="true" id="mecke15" rel="1" rev="21" score="1" target="time" unit="duration"/>
+    <level _seq="3" _title="Rhythm of Space" _xpath="./mecke20_1" author="mecke" ctrl="force" easy="true" id="mecke20" rel="1" rev="21" score="1" target="time" unit="duration"/>
+    <level _seq="4" _title="The Show Jumper" _xpath="./andreas47_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas47" rel="1" rev="4" score="1" target="time" unit="duration"/>
+    <level _seq="5" _title="The Red Room" _xpath="./joe29_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe29" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="6" _title="Enigmines" _xpath="./huffman01_1" author="Brian Huffman" ctrl="force" easy="true" id="huffman01" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="7" _title="Red Cave" _xpath="./mecke21_1" author="mecke" ctrl="force" easy="true" id="mecke21" rel="1" rev="30" score="1" target="time" unit="duration"/>
+    <level _seq="8" _title="Status code 302" _xpath="./dev02_1" author="/dev/null" ctrl="force" easy="true" id="dev02" rel="1" rev="4" score="1" target="time" unit="duration"/>
+    <level _seq="9" _title="A Screenful of Secrets" _xpath="./mecke01_1" author="mecke" ctrl="force" easy="true" id="mecke01" rel="1" rev="23" score="1" target="time" unit="duration"/>
+    <level _seq="10" _title="Southside Life" _xpath="./mecke10_1" author="mecke" ctrl="force" easy="true" id="mecke10" rel="1" rev="18" score="1" target="time" unit="duration"/>
+    <level _seq="11" _title="Joona's Chess" _xpath="./joona02_1" author="Joona Laire" ctrl="force" easy="true" id="joona02" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="12" _title="Helios I" _xpath="./mecke07_1" author="mecke" ctrl="force" easy="false" id="mecke48" rel="1" rev="12" score="1" target="time" unit="duration"/>
+    <level _seq="13" _title="The Green Hell" _xpath="./mecke22_1" author="mecke" ctrl="force" easy="true" id="mecke22" rel="1" rev="55" score="1" target="time" unit="duration"/>
+    <level _seq="14" _title="Tilt Board" _xpath="./ulf06_2" author="Ulf Stegemann" ctrl="force" easy="true" id="20080529ulf118" rel="2" rev="116" score="2" target="time" unit="duration"/>
+    <level _seq="15" _title="4 - 8 - 4" _xpath="./dpl03_3" author="Dominik Leipold" ctrl="force" easy="true" id="20070821dpl003" rel="3" rev="4" score="3" target="time" unit="duration"/>
+    <level _seq="16" _title="Impulsive Order" _xpath="./raywick05_1" author="Ray Wick" ctrl="force" easy="true" id="raywick5" rel="1" rev="5" score="1" target="time" unit="duration"/>
+    <level _seq="17" _title="Cross Mail" _xpath="./johann03_1" author="Johann Freymuth" ctrl="force" easy="false" id="johann03" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="18" _title="Color Maze" _xpath="./pulley16_3" author="Mark Pulley" ctrl="force" easy="false" id="pulley16" rel="3" rev="4" score="3" target="time" unit="duration"/>
+    <level _seq="19" _title="Earthlink" _xpath="./pulley15_1" author="Mark Pulley" ctrl="force" easy="true" id="pulley15" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="20" _title="Vanity's Constrictions" _xpath="./andreas53_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas53" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="21" _title="Wired" _xpath="./andreas49_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas49" rel="1" rev="4" score="1" target="time" unit="duration"/>
+    <level _seq="22" _title="Push Wires" _xpath="./ral24_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080708ral196" rel="1" rev="100" score="1" target="time" unit="duration"/>
+    <level _seq="23" _title="Wired Five" _xpath="./ral25_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080721ral073" rel="1" rev="112" score="1" target="time" unit="duration"/>
+    <level _seq="24" _title="Wireban Premiere" _xpath="./ral26_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080715ral161" rel="1" rev="112" score="1" target="time" unit="duration"/>
+    <level _seq="25" _title="Microwire" _xpath="./ral27_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral427" rel="1" rev="107" score="1" target="time" unit="duration"/>
+    <level _seq="26" _title="More Microwire" _xpath="./ral28_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral282" rel="1" rev="105" score="1" target="time" unit="duration"/>
+    <level _seq="27" _title="Freestyle Microwire" _xpath="./ral29_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080719ral530" rel="1" rev="107" score="1" target="time" unit="duration"/>
+    <level _seq="28" _title="Balance Beam" _xpath="./mecke03_1" author="mecke" ctrl="force" easy="true" id="mecke03" rel="1" rev="29" score="1" target="time" unit="duration"/>
+    <level _seq="29" _title="Colored Oxyds" _xpath="./andreas50_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas50" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="30" _title="Fashions Pass" _xpath="./andreas48_2" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas48" rel="2" rev="3" score="2" target="time" unit="duration"/>
+    <level _seq="31" _title="Colored Turnstiles" _xpath="./andreas51_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas51" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="32" _title="Sanssouci" _xpath="./mecke05_1" author="mecke" ctrl="force" easy="true" id="mecke05" rel="1" rev="23" score="1" target="time" unit="duration"/>
+    <level _seq="33" _title="Wired Shogun" _xpath="./ral34_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080828ral417" rel="1" rev="112" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>



From ral at mail.berlios.de  Tue Sep  9 00:46:40 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 9 Sep 2008 00:46:40 +0200
Subject: [Enigma-game-svn] r1312 - in trunk: data data/levels/enigma_vii
	data/schemas src src/stones
Message-ID: <200809082246.m88MkeY4013127@sheep.berlios.de>

Author: ral
Date: 2008-09-09 00:46:29 +0200 (Tue, 09 Sep 2008)
New Revision: 1312

Added:
   trunk/src/floors/
Modified:
   trunk/data/api1init.lua
   trunk/data/levels/enigma_vii/duffy151_3.xml
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/floors.cc
   trunk/src/floors.hh
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.cc
   trunk/src/stones/WindowStone.cc
   trunk/src/stones/WindowStone.hh
   trunk/src/stones_complex.cc
Log:
Trunk 1.1: new API reengineering
- bridge floor - complete rewrite:
  - rename to fl_bridge, fl_bridge_gc, fl_bridge_bw, fl_bridge_bn
  - attribute flavor, values "gc" (grey centered), "bw" (brown from west),
    "bn" (brown form north)
  - full StateObject support: state attribute of OPEN, CLOSED
  - default state is OPEN
  - message "signal" now with values 0/1
  - message "toggle" instead "openclose"
  - stones not floating on bridges do fully close it - actors can pass
  - snapshot principle: stones on bridges are evaluated on initialization
    and on any set operation, closing the bridge according to the float feature
- fix Floor: do set attributes in class hierarchy - not directly on Object
- fix Window: do not shatter marbles on move
- change Puzzle: hollow puzzle is no longer floating - thus pressing triggers
    and bridges, too
- fix level "Temple of Gold" - usage of bridge message "signal"

Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/data/api1init.lua	2008-09-08 22:46:29 UTC (rev 1312)
@@ -45,6 +45,7 @@
 }
 
 RenamingObjectsNew2Old = {
+    fl_bridge = "fl-bridge",
     it_blocker = "it-blocker",
     it_blocker_new = "it-blocker-new",
     it_brake = "it-brake",
@@ -255,7 +256,14 @@
 end
 
 function enigma.MakeObject(name)
-    if name == "st-key" then
+    if name == "fl-bridge-open" then
+        local obj = enigma._MakeObject("fl_bridge")
+        return obj
+    elseif name == "fl-bridge-closed" then
+        local obj = enigma._MakeObject("fl_bridge")
+        enigma._SetAttrib(obj, "state", 0)
+        return obj
+    elseif name == "st-key" then
         local obj = enigma._MakeObject("st_key")
         -- Old API keycode default was 0 for st-key, but 1 for it-key!
         enigma._SetAttrib(obj, "code", 0)
@@ -541,6 +549,13 @@
          _key = "faces"
          if val == "h" then _val = "ns" else _val = "ew" end
      end
+     if key == "type" and _obj_name == "fl-bridge" then
+         _key = "flavor"
+         if val == "x" then _val = "bw"
+         elseif val == "y" then _val = "bn"
+         else _val = "gc"
+         end
+     end
      enigma._SetAttrib(obj, _key, _val)
 end
 
@@ -585,10 +600,17 @@
          _key = "state"
      end
      if key == "type" and _obj_name == "st-door" then
-         faces = enigma._GetAttrib(obj, "faces")
+         local faces = enigma._GetAttrib(obj, "faces")
          if faces == "ns" then val = "h" else val = "v" end
          return val
      end
+     if key == "type" and _obj_name == "fl-bridge" then
+         local flavor = enigma._GetAttrib(obj, "flavor")
+         if flavor == "bw" then return "x"
+         elseif flavor == "bn" then return "y"
+         else return "a"
+         end
+     end
 
      local val = enigma._GetAttrib(obj, _key)
      
@@ -661,6 +683,7 @@
 end
 
 MessageRenaming = {
+    fl_bridge__openclose = "toggle",
     it_blocker__trigger = "toggle",
     it_blocker__openclose = "toggle",
     ["it-burnable__trigger"] = "ignite",

Modified: trunk/data/levels/enigma_vii/duffy151_3.xml
===================================================================
--- trunk/data/levels/enigma_vii/duffy151_3.xml	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/data/levels/enigma_vii/duffy151_3.xml	2008-09-08 22:46:29 UTC (rev 1312)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Temple of Gold" el:subtitle="" el:id="duffy151"/>
-      <el:version el:score="3" el:release="3" el:revision="6" el:status="released"/>
+      <el:version el:score="3" el:release="3" el:revision="7" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -248,7 +248,7 @@
 
 function showbridges(value, sender)
     for i = 1,bridgecount do
-        SendMessage(enigma.GetNamedObject("bridge#"..i), "signal", value)
+        SendMessage(enigma.GetNamedObject("bridge#"..i), "toggle", value)
     end
 end
 

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/data/schemas/objects.xml	2008-09-08 22:46:29 UTC (rev 1312)
@@ -112,6 +112,23 @@
       <msg name="kill"/>
       <msg name="toggle"/>
     </object>
+    <object name="fl" abstract="true"/>
+    <object name="fl_bridge">
+      <attr name="flavor" default="gc"/>
+      <msg name="close"/>
+      <msg name="open"/>
+      <msg name="signal"/>
+      <msg name="_init"/>
+    </object>
+    <object name="fl_bridge_gc">
+      <attr name="flavor" value="gc"/>
+    </object>
+    <object name="fl_bridge_bw">
+      <attr name="flavor" value="bw"/>
+    </object>
+    <object name="fl_bridge_bn">
+      <attr name="flavor" value="bn"/>
+    </object>
     <object name="it" abstract="true"/>
     <object name="it_blocker">
       <attr name="autoclose"/>

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/src/Makefile.am	2008-09-08 22:46:29 UTC (rev 1312)
@@ -145,6 +145,8 @@
 	XMLtoLocal.hh		\
 	XMLtoUtf8.cc		\
 	XMLtoUtf8.hh		\
+	floors/BridgeFloor.cc	\
+	floors/BridgeFloor.hh	\
 	gui/ErrorMenu.cc	\
 	gui/ErrorMenu.hh	\
 	gui/GameMenu.cc		\
@@ -185,18 +187,6 @@
 	gui/TextField.hh	\
 	gui/widgets.cc		\
 	gui/widgets.hh		\
-	lev/Index.cc		\
-	lev/Index.hh		\
-	lev/RatingManager.cc	\
-	lev/RatingManager.hh	\
-	lev/PersistentIndex.cc	\
-	lev/PersistentIndex.hh	\
-	lev/Proxy.cc		\
-	lev/Proxy.hh		\
-	lev/ScoreManager.cc	\
-	lev/ScoreManager.hh	\
-	lev/VolatileIndex.cc	\
-	lev/VolatileIndex.hh	\
 	items/BrakeItem.cc	\
 	items/BrakeItem.hh	\
 	items/BlockerItem.cc	\
@@ -225,6 +215,18 @@
 	items/Vortex.hh		\
 	items/WormHole.cc	\
 	items/WormHole.hh	\
+	lev/Index.cc		\
+	lev/Index.hh		\
+	lev/RatingManager.cc	\
+	lev/RatingManager.hh	\
+	lev/PersistentIndex.cc	\
+	lev/PersistentIndex.hh	\
+	lev/Proxy.cc		\
+	lev/Proxy.hh		\
+	lev/ScoreManager.cc	\
+	lev/ScoreManager.hh	\
+	lev/VolatileIndex.cc	\
+	lev/VolatileIndex.hh	\
 	others/Other.cc		\
 	others/Other.hh		\
 	others/Rubberband.cc	\

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/src/floors.cc	2008-09-08 22:46:29 UTC (rev 1312)
@@ -95,7 +95,7 @@
         var_floorforce[0] = to_double(val);
     else if (key == "force_y")
         var_floorforce[1] = to_double(val);
-    Object::setAttr(key, val);
+    GridObject::setAttr(key, val);
 }
 
 void Floor::get_sink_speed (double &sinkspeed, double &raisespeed) const {
@@ -675,174 +675,7 @@
     Floor::add_force(a, f);
 }
 
-
-/* -------------------- Bridge -------------------- */
 
-/** \page fl-bridge Bridge Floor
-
-This Floor can be opened and closed much like a bridge.
-The actor can move over this floor if the bridge is closed,
-and will fall into abyss when the bridge is open.
-
-\subsection bridgea Attributes
-
-- \b type	The type of the bridge, currently only 'a' is possible
-
-\subsection bridgem Messages
-- \b open	open the bridge so actors cannot pass it
-- \b close	close the bridge so actors can pass it
-- \b openclose	toggle the state of the bridge
-- \b signal     same as \b openclose
-
-*/
-namespace
-{
-    class Bridge : public Floor {
-        CLONEOBJ(Bridge);
-    public:
-        Bridge(bool open=true);
-        virtual Value message(const Message &m);
-    private:
-        enum State {
-            OPEN, CLOSED, OPENING, CLOSING, // normal states
-            CLOSING_BYSTONE, CLOSED_BYSTONE // when stones are moved onto the bridge
-        } state;
-        // the BYSTONE-states look like closed, but act like open
-
-        char get_type() const {
-            string type = "a";
-            if (Value v = getAttr("type")) type = v.get_string();
-            return type[0];
-        }
-
-//         void actor_enter(Actor *);
-        void actor_contact (Actor* a) {if (state!=CLOSED) SendMessage(a, "fall");}
-        void init_model();
-        void stone_change(Stone *st);
-
-        void change_state( State newstate);
-        void animcb();
-    };
-}
-
-Bridge::Bridge(bool open) : Floor("fl-bridge", 5, 1)
-{
-    setAttr("type", "a");
-    state=open ? OPEN : CLOSED;
-}
-
-void Bridge::stone_change(Stone *st) {
-    if (st && !st->is_floating()) {
-        if (state == OPEN || state == OPENING) {
-            change_state(CLOSING_BYSTONE);
-        }
-    }
-    else {
-        if (state == CLOSED_BYSTONE || state == CLOSING_BYSTONE) {
-            change_state(OPENING);
-        }
-    }
-}
-
-Value Bridge::message(const Message &m)
-{
-    if (m.message == "open" && (state==CLOSED || state==CLOSING|| state==OPENING)) {
-        change_state(OPENING);
-        return Value();
-    } else if (m.message == "close") {
-        switch (state) {
-            case OPEN:
-            case OPENING:
-            case CLOSING_BYSTONE:
-                change_state(CLOSING);
-                break;
-            case CLOSED_BYSTONE:
-                change_state(CLOSED);
-                break;
-            case CLOSED:
-            case CLOSING:
-                break; // already closed
-        }
-        return Value();
-    } else if (m.message == "openclose" || m.message == "signal") {
-        switch (state) {
-            case OPEN:
-            case OPENING:
-            case CLOSING_BYSTONE:
-                change_state(CLOSING);
-                break;
-            case CLOSED_BYSTONE:
-                change_state(CLOSED);
-                break;
-            case CLOSED:
-            case CLOSING:
-                change_state(OPENING);
-                break;
-        }
-        return Value();
-    }
-    return Floor::message(m);
-}
-
-void Bridge::init_model()
-{
-    set_model(ecl::strf("fl-bridge%c-%s", get_type(),
-                       (state==OPEN) ? "open" : "closed"));
-}
-
-void Bridge::change_state( State newstate)
-{
-    if (state != newstate) {
-        string mname = string("fl-bridge")+get_type();
-
-        switch( newstate) {
-        case OPENING: {
-            Stone *st = GetStone(get_pos());
-            if (st && !st->is_floating()) {
-                if (state == CLOSED || state == CLOSED_BYSTONE)
-                    newstate = CLOSED_BYSTONE;
-                else if (state == CLOSING || state == CLOSING_BYSTONE)
-                    newstate = CLOSING_BYSTONE;
-                // here the model is already correct!
-            }
-            else { // no stone or floating stone :
-                if( state == CLOSING || state == CLOSING_BYSTONE)
-                    get_model()->reverse();
-                else
-                    set_anim(mname+"-opening");
-            }
-            break;
-        }
-        case CLOSING:
-        case CLOSING_BYSTONE:
-            if( state == OPENING)
-                get_model()->reverse();
-            else if (state != CLOSING && state != CLOSING_BYSTONE)
-                set_anim(mname+"-closing");
-            break;
-        case OPEN:
-        case CLOSED:
-        case CLOSED_BYSTONE:
-            state = newstate;
-            init_model();
-            break;
-        }
-        state = newstate;
-    }
-}
-
-void Bridge::animcb()
-{
-    switch (state) {
-        case OPENING: change_state(OPEN); break;
-        case CLOSING: change_state(CLOSED); break;
-        case CLOSING_BYSTONE: change_state(CLOSED_BYSTONE); break;
-        default :
-            ASSERT(0, XLevelRuntime, "Bridge: animcb called after unknown animation");
-            break;
-    }
-}
-
 /* -------------------- Thief Floor -------------------- */
 namespace{
     class Thief : public Floor {
@@ -1014,9 +847,6 @@
     Register(new FallenBox("fl-stwood"));
     Register(new FallenBox("fl-stwood1"));
     Register(new FallenBox("fl-stwood2"));
-    Register(new Bridge);
-    Register("fl-bridge-open", new Bridge(true));
-    Register("fl-bridge-closed", new Bridge(false));
     Register(new Thief);
     Register(new WhiteTile);
     Register(new BlackTile);

Modified: trunk/src/floors.hh
===================================================================
--- trunk/src/floors.hh	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/src/floors.hh	2008-09-08 22:46:29 UTC (rev 1312)
@@ -105,7 +105,7 @@
         virtual void on_pickup (Item *) {}
 
         virtual void stone_change(Stone *) {}
-        virtual void actor_contact (Actor *) {}
+        virtual void actor_contact(Actor *) {}
 
         virtual double get_friction() const;
         virtual double get_mousefactor() const;

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/src/ox_extra.cc	2008-09-08 22:46:29 UTC (rev 1312)
@@ -110,7 +110,7 @@
     UNUSED,              // OxydExtra floor 0x49
     UNUSED,              // OxydExtra floor 0x4a
     UNUSED,              // OxydExtra floor 0x4b
-    "fl-bridge",         // OxydExtra floor 0x4c
+    "fl_bridge",         // OxydExtra floor 0x4c
     UNUSED,              // OxydExtra floor 0x4d
     UNUSED,              // OxydExtra floor 0x4e
     UNUSED,              // OxydExtra floor 0x4f

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/src/ox_magnum.cc	2008-09-08 22:46:29 UTC (rev 1312)
@@ -116,7 +116,7 @@
     UNUSED,                     // OxydMagnum floor 0x4f
     UNUSED,                     // OxydMagnum floor 0x50
     UNUSED,                     // OxydMagnum floor 0x51
-    "fl-bridge",                // OxydMagnum floor 0x52 (common was 'fl-bridge')
+    "fl_bridge",                // OxydMagnum floor 0x52 (common was 'fl-bridge')
     "fl-springboard",           // OxydMagnum floor 0x53
     "fl-light",                 // OxydMagnum floor 0x54
     "fl-lightgray",             // OxydMagnum floor 0x55

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/src/ox_oxyd1.cc	2008-09-08 22:46:29 UTC (rev 1312)
@@ -149,7 +149,7 @@
     UNUSED,                     // Oxyd1 floor 0x4f
     UNUSED,                     // Oxyd1 floor 0x50
     UNUSED,                     // Oxyd1 floor 0x51
-    "fl-bridge",                // Oxyd1 floor 0x52
+    "fl_bridge",                // Oxyd1 floor 0x52
     "fl-springboard",           // Oxyd1 floor 0x53
     UNUSED,                     // Oxyd1 floor 0x54
     "fl-gray",                  // Oxyd1 floor 0x55

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/src/ox_peroxyd.cc	2008-09-08 22:46:29 UTC (rev 1312)
@@ -179,7 +179,7 @@
     UNUSED,                     // PerOxyd floor 0x49
     UNUSED,                     // PerOxyd floor 0x4a
     UNUSED,                     // PerOxyd floor 0x4b
-    "fl-bridge-open",           // PerOxyd floor 0x4c
+    "fl_bridge",                // PerOxyd floor 0x4c
     UNUSED,                     // PerOxyd floor 0x4d
     "fl-gray",                  // PerOxyd floor 0x4e
     "fl-gradient13",            // PerOxyd floor 0x4f (flat force up, beige)        (maybe gradient22?)

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/src/stones/WindowStone.cc	2008-09-08 22:46:29 UTC (rev 1312)
@@ -182,6 +182,10 @@
         return false;
     }
     
+    void WindowStone::on_move() {
+        // do not shatter actors
+    }
+    
     StoneResponse WindowStone::collision_response(const StoneContact &sc) {
         const double face_width = 3.0/32.0; 
         

Modified: trunk/src/stones/WindowStone.hh
===================================================================
--- trunk/src/stones/WindowStone.hh	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/src/stones/WindowStone.hh	2008-09-08 22:46:29 UTC (rev 1312)
@@ -73,6 +73,7 @@
         virtual bool is_transparent (Direction) const { return true; }
         virtual bool is_floating() const { return state != IDLE; }
         virtual bool is_sticky(const Actor *a) const;
+        virtual void on_move();
 
     private:
         void breakFaces(DirectionBits faces);

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/src/stones.cc	2008-09-08 22:46:29 UTC (rev 1312)
@@ -58,15 +58,14 @@
 }
 
 
-Stone::Stone()
-: freeze_check_running (false)
-{}
+Stone::Stone() : freeze_check_running (false) {
+}
 
-Stone::Stone(const char * kind)
-: GridObject (kind), freeze_check_running (false)
-{}
+Stone::Stone(const char * kind) : GridObject (kind), freeze_check_running (false) {
+}
 
-Stone::~Stone() {  }
+Stone::~Stone() {
+}
 
 const StoneTraits &Stone::get_traits() const
 {

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2008-09-08 13:04:11 UTC (rev 1311)
+++ trunk/src/stones_complex.cc	2008-09-08 22:46:29 UTC (rev 1312)
@@ -117,7 +117,10 @@
         PuzzleStone(int connections, bool oxyd1_compatible_);  
         
         virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
-        
+        virtual bool is_transparent(Direction d) const;
+        virtual bool is_sticky(const Actor *a) const;
+        virtual bool allowsSpreading(Direction dir) const;
+        virtual void on_move();
     protected:
         virtual ~PuzzleStone() {
             GameTimer.remove_alarm (this);
@@ -164,8 +167,6 @@
         void on_creation (GridPos p);
         void on_impulse (const Impulse& impulse);
 
-        bool is_floating() const;
-
         StoneResponse collision_response(const StoneContact &sc);
         void actor_hit (const StoneContact &sc);
         void actor_contact (Actor *a);
@@ -590,10 +591,23 @@
     return exploded;
 }
 
-bool PuzzleStone::is_floating() const {
+bool PuzzleStone::is_transparent(Direction d) const {
     return get_connections() == 0;
 }
 
+bool PuzzleStone::is_sticky(const Actor *a) const {
+    return get_connections() != 0;
+}
+
+bool PuzzleStone::allowsSpreading(Direction dir) const {
+    return get_connections() == 0;
+}
+
+void PuzzleStone::on_move() {
+    if (get_connections() != 0) 
+        ShatterActorsInsideField (get_pos());
+}
+
 void PuzzleStone::maybe_rotate_cluster(Direction dir) 
 {
     if (dir != NODIR) {



From ral at mail.berlios.de  Tue Sep  9 01:00:49 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 9 Sep 2008 01:00:49 +0200
Subject: [Enigma-game-svn] r1313 - trunk/src/floors
Message-ID: <200809082300.m88N0nca031156@sheep.berlios.de>

Author: ral
Date: 2008-09-09 01:00:47 +0200 (Tue, 09 Sep 2008)
New Revision: 1313

Added:
   trunk/src/floors/BridgeFloor.cc
   trunk/src/floors/BridgeFloor.hh
Log:
Trunk 1.1: new API reengineering
- fix r1312 - missing files added


Added: trunk/src/floors/BridgeFloor.cc
===================================================================
--- trunk/src/floors/BridgeFloor.cc	2008-09-08 22:46:29 UTC (rev 1312)
+++ trunk/src/floors/BridgeFloor.cc	2008-09-08 23:00:47 UTC (rev 1313)
@@ -0,0 +1,164 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "floors/BridgeFloor.hh"
+
+#include "errors.hh"
+#include "main.hh"
+#include "stones.hh"
+#include "world.hh"
+
+namespace enigma {
+    
+    BridgeFloor::BridgeFloor(std::string flavor) : Floor("fl_bridge", 5, 1) {
+        Floor::setAttr("flavor", flavor);
+        state = OPEN;
+    }
+    
+    std::string BridgeFloor::getClass() const {
+        return "fl_bridge";
+    }
+        
+    void BridgeFloor::setAttr(const string& key, const Value &val) {
+        if (key == "flavor") {
+            std::string flavor = val.to_string();
+            ASSERT(flavor == "gc" || flavor == "bw" || flavor == "bn", XLevelRuntime, "BridgeFloor illegal flavor value");
+            Floor::setAttr("flavor", val);
+            if (isDisplayable() && state <= OPEN) {
+                init_model();    // need to redisplay after attribute set
+            }
+            return;
+        }
+        Floor::setAttr(key, val);
+    }
+    
+    Value BridgeFloor::message(const Message &m) {
+        if (m.message == "_init") {
+            // a stone may be set or changed after floor set
+            Stone *st = GetStone(get_pos());
+            if ((objFlags & OBJBIT_EXPLICIT) || (st != NULL && !st->is_floating())) {
+                state = CLOSED;
+            } else {
+                state = OPEN;
+            }
+            init_model();
+            return Value();
+        } else
+            return Floor::message(m);
+    }
+
+    int BridgeFloor::externalState() const {
+        return (state == CLOSED) ? 0 : 1;
+    }
+    
+    void BridgeFloor::setState(int extState) {
+        if (isDisplayable()) {
+            Stone *st = GetStone(get_pos());
+            if (extState == 1 && (state == CLOSED || state == CLOSING) && (st == NULL || st->is_floating()))
+                set_iState(OPENING);
+            else if (extState == 0 && (state == OPEN || state == OPENING))
+                set_iState(CLOSING);
+        } else {   // object initialisation
+            state = extState;
+        }
+        if (extState == 1)
+            objFlags &= ~OBJBIT_EXPLICIT;
+        else
+            objFlags |= OBJBIT_EXPLICIT;
+    }
+    
+    void BridgeFloor::toggleState() {
+        Stone *st = GetStone(get_pos());
+        if ((state == CLOSED || state == CLOSING) && st != NULL && !st->is_floating())
+            objFlags ^= OBJBIT_EXPLICIT;   // toggle flag
+        else if (state == CLOSED || state == CLOSING)
+            setState(1);
+        else
+            setState(0);
+    }
+
+    void BridgeFloor::init_model()  {
+        set_model(model_basename() + ((state==OPEN) ? "open" : "closed"));
+    }
+    
+    void BridgeFloor::on_creation(GridPos p) {
+        // we can not rely on state attribute in case a floor in yielded and reset on anther grid
+        Stone *st = GetStone(get_pos());
+        if ((objFlags & OBJBIT_EXPLICIT) || (st != NULL && !st->is_floating()))
+            state = CLOSED;
+        else
+            state = OPEN;
+        Floor::on_creation(p);
+    }
+    
+    void BridgeFloor::animcb() {
+        if (state == OPENING)
+            state = OPEN;
+        else if (state == CLOSING)
+            state = CLOSED;
+        init_model();
+    }
+
+    void BridgeFloor::stone_change(Stone *st) {
+        if (st != NULL && !st->is_floating() && (state == OPEN || state == OPENING)) {
+            set_iState(CLOSING);
+        }
+        else if ((st == NULL || st->is_floating()) && (state == CLOSED || state == CLOSING) 
+                && !(objFlags & OBJBIT_EXPLICIT)) {
+            set_iState(OPENING);
+        }
+    }
+    
+    void BridgeFloor::actor_contact(Actor *a) {
+        if (state != CLOSED) SendMessage(a, "fall");
+    }
+    
+    std::string BridgeFloor::model_basename() const {
+        std::string flavor = getAttr("flavor").to_string();
+        if (flavor == "gc")
+            return "fl-bridgea-";
+        else if (flavor == "bw")
+            return "fl-bridgex-";
+        else if (flavor == "bn")
+            return "fl-bridgey-";
+    }
+    
+    void BridgeFloor::set_iState(int newState) {
+        if (newState == OPENING) {
+            if (state == CLOSING)
+                get_model()->reverse();
+            else
+                set_anim(model_basename() + "opening");
+        } else if (newState == CLOSING) {
+            if (state == OPENING)
+                get_model()->reverse();
+            else
+                set_anim(model_basename() + "closing");
+        }
+        state = newState;
+    }
+
+    BOOT_REGISTER_START
+        BootRegister(new BridgeFloor("gc"), "fl_bridge");
+        BootRegister(new BridgeFloor("gc"), "fl_bridge_gc");
+        BootRegister(new BridgeFloor("bn"), "fl_bridge_bn");
+        BootRegister(new BridgeFloor("bw"), "fl_bridge_bw");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/floors/BridgeFloor.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/floors/BridgeFloor.hh
===================================================================
--- trunk/src/floors/BridgeFloor.hh	2008-09-08 22:46:29 UTC (rev 1312)
+++ trunk/src/floors/BridgeFloor.hh	2008-09-08 23:00:47 UTC (rev 1313)
@@ -0,0 +1,75 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef BRIDGEFLOOR_HH
+#define BRIDGEFLOOR_HH
+
+#include "floors.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class BridgeFloor : public Floor {
+        CLONEOBJ(BridgeFloor);
+        
+    private:
+        enum iState {
+            CLOSED,    ///< 
+            OPEN,      ///< 
+            CLOSING,   ///< 
+            OPENING,   ///< 
+        };
+
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_EXPLICIT =   1<<24,   ///< closed by message and not by a stone
+        };
+    public:
+        BridgeFloor(std::string flavor);
+
+        // Object interface
+        virtual std::string getClass() const;
+        virtual void setAttr(const string& key, const Value &val);
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual int externalState() const;
+        virtual void setState(int extState);
+        virtual void toggleState();
+
+        // GridObject interface
+        virtual void init_model();
+        virtual void on_creation(GridPos p);
+                
+        // ModelCallback interface  - Animation callback
+        virtual void animcb();
+
+        // Floor interface
+        virtual void stone_change(Stone *st);
+        virtual void actor_contact(Actor *a);
+        
+    private:
+        // Private methods.
+        std::string model_basename() const;
+        void set_iState(int newState);
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/floors/BridgeFloor.hh
___________________________________________________________________
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Tue Sep  9 01:07:30 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Tue, 9 Sep 2008 01:07:30 +0200
Subject: [Enigma-game-svn] r1314 - team_levelpacks/team_test_new_api
Message-ID: <200809082307.m88N7U1i004927@sheep.berlios.de>

Author: ral
Date: 2008-09-09 01:07:19 +0200 (Tue, 09 Sep 2008)
New Revision: 1314

Added:
   team_levelpacks/team_test_new_api/ralT068_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT061_1.xml
   team_levelpacks/team_test_new_api/raoulT03_1.xml
Log:
Test Level new API:
- bridge test level added, other levels updated


Modified: team_levelpacks/team_test_new_api/ralT061_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT061_1.xml	2008-09-08 23:00:47 UTC (rev 1313)
+++ team_levelpacks/team_test_new_api/ralT061_1.xml	2008-09-08 23:07:19 UTC (rev 1314)
@@ -46,6 +46,7 @@
 
 ti["d"] = {"it-dynamite"}
 ti["E"] = {"st-bombs"}
+ti["|"] = {"it-spring1"}
 
 ti["@"] = {"#ac-blackball"} 
 ti["."] = {"#ac-whiteball", "white"} 
@@ -58,7 +59,7 @@
 "                    ",
 "  #     PB    S  g  ",
 "  #                 ",
-"  #                E",
+"  #   |            E",
 "          R        d",
 "   s   @       p   d",
 "        cc         d",

Added: team_levelpacks/team_test_new_api/ralT068_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT068_1.xml	2008-09-08 23:00:47 UTC (rev 1313)
+++ team_levelpacks/team_test_new_api/ralT068_1.xml	2008-09-08 23:07:19 UTC (rev 1314)
@@ -0,0 +1,71 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Bridges new API" el:subtitle="" el:id="20080907ral929"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+
+ti["-"] = {"fl_bridge_bw", "bridge#"}
+ti["|"] = {"fl_bridge_bn", "bridge#"}
+ti["."] = {"fl_bridge_gc", "bridge#"}
+
+ti["="] = {"fl_bridge_bw", "closed", state=CLOSED}
+ti["!"] = {"fl_bridge", state=CLOSED, flavor="bn"}
+ti[":"] = {"fl_bridge_gc", state=CLOSED}
+
+ti["S"] = {"st_switch", target="@bridge#*"}
+ti["T"] = {"st_switch", target="closed", action_1="open", action_0="close"}
+
+ti["w"] = {"st-wood"}
+ti["g"] = {"st-glass_move"}
+ti["c"] = {"it-cherry"}
+ti["s"] = {"it-spring1"}
+ti["p"] = {"st_pull"}
+ti["W"] = {"st_window_ew", secure=true}
+ti["h"] = {"st-puzzle-hollow"}
+ti["H"] = {"st-puzzle-ew"}
+
+ti[";"] = ti["."] .. ti["g"]
+
+ti["b"] = {"st_brake"}
+
+ti["@"] = {"#ac-blackball"} 
+
+w, h = wo(ti, " ", {
+"    S    S     S    ",
+"                    ",
+"    -    |     .    ",
+"                    ",
+"    p  w   hhH      ",
+"    W    g     g    ",
+"                    ",
+"  s    b    ccc   ; ",
+"          @         ",
+"                    ",
+"    =     !    :    ",
+"                    ",
+"    T               "
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: team_levelpacks/team_test_new_api/ralT068_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Modified: team_levelpacks/team_test_new_api/raoulT03_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-09-08 23:00:47 UTC (rev 1313)
+++ team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-09-08 23:07:19 UTC (rev 1314)
@@ -63,6 +63,7 @@
 ti["G"] = {"st_window", faces="ws", "pullwindow"}
 ti["L"] = {"st_laser_w", "laser"}
 ti["S"] = {"st_switch", target="laser"}
+ti["M"] = {"st-wood"}
 
 
 ti["x"] = ti["C"] .. {"it_vortex", "vortexx", destination="vortexy"}
@@ -85,14 +86,14 @@
 "#  sssssssssi    rk#",
 "#  :::::          k#",
 "#                ' #",
-"#  a     d     e   #",
+"#  a   d       e   #",
+"#          v       #",
+"#  a   b  h2h  -   #",
+"#          v       #",
+"#  a   +     M H   #",
 "#                  #",
-"#  a     b     -   #",
 "#                  #",
-"#  a     +     H   #",
 "#                  #",
-"#                  #",
-"#                  #",
 "####################"
 })
 



From ral at mail.berlios.de  Wed Sep 10 23:43:01 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 10 Sep 2008 23:43:01 +0200
Subject: [Enigma-game-svn] r1315 - in trunk: data data/schemas src/items
	src/stones
Message-ID: <200809102143.m8ALh1xY003946@sheep.berlios.de>

Author: ral
Date: 2008-09-10 23:43:00 +0200 (Wed, 10 Sep 2008)
New Revision: 1315

Modified:
   trunk/data/api1init.lua
   trunk/data/schemas/objects.xml
   trunk/src/items/Meditation.cc
   trunk/src/items/RubberbandItem.cc
   trunk/src/items/ShogunDot.cc
   trunk/src/items/ShogunDot.hh
   trunk/src/stones/ShogunStone.cc
Log:
Trunk 1.1: 
- fix rubberband item: drop item on attempt to connect to activating actor
- old api bridge: map old signal to toggle
- meditation:
  - fix old API message "trigger" mapping
  - make hill and bump areas of meditation, too
  - message "toggle" transforms CALDERA<->HILL, HOLLOW<->VOLCANO
- shogun: switch from message based stone to dot notification to stone_change
  based like trigger to decouple dot action from stone impulse event


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-09-08 23:07:19 UTC (rev 1314)
+++ trunk/data/api1init.lua	2008-09-10 21:43:00 UTC (rev 1315)
@@ -684,6 +684,7 @@
 
 MessageRenaming = {
     fl_bridge__openclose = "toggle",
+    fl_bridge__signal = "toggle",
     it_blocker__trigger = "toggle",
     it_blocker__openclose = "toggle",
     ["it-burnable__trigger"] = "ignite",
@@ -692,11 +693,8 @@
     ["it-burnable_fireproof__trigger"] = "ignite",
     ["it-burnable_ash__trigger"] = "ignite",
     ["it-burnable_oil__trigger"] = "ignite",
-    ["it-hill__trigger"] = "flip",
-    ["it-hollow__trigger"] = "flip",
     it_magnet__onoff = "toggle",
-    ["it-tinyhill__trigger"] = "flip",
-    ["it-tinyhollow__trigger"] = "flip",
+    it_medidation__trigger = "flip",
     it_vortex__openclose = "toggle",
     it_vortex__trigger = "toggle",
     it_wormhole__onoff = "toggle",

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-09-08 23:07:19 UTC (rev 1314)
+++ trunk/data/schemas/objects.xml	2008-09-10 21:43:00 UTC (rev 1315)
@@ -281,7 +281,6 @@
     </object>
     <object name="it_shogun">
       <attr name="flavor"/>
-      <msg name="_shogun"/>
       <msg name="_init"/>
     </object>
     <object name="it_shogun_s">

Modified: trunk/src/items/Meditation.cc
===================================================================
--- trunk/src/items/Meditation.cc	2008-09-08 23:07:19 UTC (rev 1314)
+++ trunk/src/items/Meditation.cc	2008-09-10 21:43:00 UTC (rev 1315)
@@ -37,7 +37,7 @@
         if (key == "essential") {
             bool essential = (val == 1);
             if (essential != (bool)(objFlags & OBJBIT_INDISPENSIBLE)) {
-                if (isDisplayable() /* && state != HILL && state != BUMP */) {
+                if (isDisplayable()) {
                     if (whiteball != NULL && enter_time == -1) {   // meditatist is registered
                         bool indispensable = objFlags & OBJBIT_INDISPENSIBLE;
                         ChangeMeditation(0, 0, indispensable ? -1 : +1, indispensable ? +1 : -1);
@@ -83,35 +83,29 @@
     }
     
     void Meditation::toggleState() {
-        setState(-state);
+        int newState;
+        switch (state) {
+            case CALDERA: newState = HILL; break;
+            case HOLLOW:  newState = VOLCANO; break;
+            case DENT:    newState = BUMP; break;
+            case BUMP:    newState = DENT; break;
+            case HILL:    newState = CALDERA; break;
+            case VOLCANO: newState = HOLLOW; break;
+        }
+        setState(newState);
     }
     
     void Meditation::setState(int extState) {
         if (extState != state && extState != 0) {
-            if (isDisplayable()) {
-                if (state != HILL && state != BUMP && (extState == HILL || extState == BUMP)) {
-                    // a meditation hole is changed to a hill or bump
-                    if (whiteball != NULL)
-                        deregisterWhiteball();
-//                    if (objFlags & OBJBIT_INDISPENSIBLE)
-//                        ChangeMeditation(0, -1, 0, 0);
-                } else if ((state == HILL || state == BUMP) && extState != HILL && extState != BUMP) {
-                    // hill or bump is made a meditation hole
-                    if (server::WorldInitialized)
-                        checkActors();
-//                    if (objFlags & OBJBIT_INDISPENSIBLE)
-//                        ChangeMeditation(0, +1, 0, 0);
-                }
-                
-                state = extState;
+            state = extState;
+            if (isDisplayable()) {                
                 init_model();
-            } else
-                state = extState;
+            }
         }
     }
         
     void Meditation::on_creation(GridPos p) {
-        if (/* state != HILL && state != BUMP && */ (objFlags & OBJBIT_INDISPENSIBLE))
+        if (objFlags & OBJBIT_INDISPENSIBLE)
             ChangeMeditation(0, +1, 0, 0);
         if (server::WorldInitialized)
             checkActors();
@@ -119,7 +113,7 @@
     }
     
     void Meditation::on_removal(GridPos p) {
-        if (/* state != HILL && state != BUMP && */ (objFlags & OBJBIT_INDISPENSIBLE))
+        if (objFlags & OBJBIT_INDISPENSIBLE)
             ChangeMeditation(0, -1, 0, 0);
         if (whiteball != NULL)
             deregisterWhiteball();
@@ -140,27 +134,26 @@
         static const double MINTIME = 1.0;
         ItemID id = get_id(this);
     
-        if (state != HILL && state != BUMP) {
-            if (whiteball == NULL && !a->is_flying() && get_id(a) == ac_meditation && isMeditating(a)) {
-                // meditatist entered a free hollow
-                whiteball  = a;
-                enter_time = server::LevelTime;
-            } else if (whiteball == a) {
-                if (a->is_flying() || !isMeditating(a)) {
-                    // meditatist left hollow
-                    whiteball = NULL;
-                    if (enter_time == -1) {   // meditatist is registered
-                        bool indispensable = objFlags & OBJBIT_INDISPENSIBLE;
-                        ChangeMeditation(0, 0, indispensable ? -1 : 0, indispensable ? 0 : -1);
-                    }
-                } else  if (enter_time != -1 && (server::LevelTime - enter_time) >= MINTIME) {
-                        // just meditated enough to mark hollow as engaged
-                        bool indispensable = objFlags & OBJBIT_INDISPENSIBLE;
-                        ChangeMeditation(0, 0, indispensable ? +1 : 0, indispensable ? 0 : +1);
-                        enter_time = -1;  // mark as registered
+        if (whiteball == NULL && !a->is_flying() && get_id(a) == ac_meditation && isMeditating(a)) {
+            // meditatist entered a free hollow
+            whiteball  = a;
+            enter_time = server::LevelTime;
+        } else if (whiteball == a) {
+            if (a->is_flying() || !isMeditating(a)) {
+                // meditatist left hollow
+                whiteball = NULL;
+                if (enter_time == -1) {   // meditatist is registered
+                    bool indispensable = objFlags & OBJBIT_INDISPENSIBLE;
+                    ChangeMeditation(0, 0, indispensable ? -1 : 0, indispensable ? 0 : -1);
                 }
+            } else  if (enter_time != -1 && (server::LevelTime - enter_time) >= MINTIME) {
+                    // just meditated enough to mark hollow as engaged
+                    bool indispensable = objFlags & OBJBIT_INDISPENSIBLE;
+                    ChangeMeditation(0, 0, indispensable ? +1 : 0, indispensable ? 0 : +1);
+                    enter_time = -1;  // mark as registered
             }
         }
+
         return false;  // do not pick up
     }
     
@@ -189,7 +182,7 @@
     
     bool Meditation::isMeditating(Actor *a) {
         double dist = ecl::length(a->get_pos() - get_pos().center());
-        return (state <= HOLLOW) && dist < 0.4 || (state == DENT || state == VOLCANO) && dist < 0.24;
+        return dist < 0.24 || ((state <= HOLLOW || state >= HILL) && dist < 0.4) ;
     }
      
     void Meditation::shovel() {
@@ -206,18 +199,14 @@
     
     void Meditation::checkActors() {
         ItemID id = get_id(this);
-        if (state != HILL && state != BUMP) {
-            std::vector<Actor*> actors;
-            GetActorsInsideField(get_pos(), actors);
-            for (std::vector<Actor*>::iterator itr = actors.begin(); itr != actors.end(); ++itr) {
-//                Log << "Hollow - initial meditatist  typ " << get_id(*itr) << "\n";
-                if (!(*itr)->is_flying() &&  whiteball==NULL && get_id(*itr)==ac_meditation && isMeditating(*itr)) {
-                     // meditatist entered a free hollow
-                    whiteball  = *itr;
-                    enter_time = server::LevelTime;
-//                    Log << "Hollow - initial meditatist time " << enter_time << "\n";
-                    break;
-                }
+        std::vector<Actor*> actors;
+        GetActorsInsideField(get_pos(), actors);
+        for (std::vector<Actor*>::iterator itr = actors.begin(); itr != actors.end(); ++itr) {
+            if (!(*itr)->is_flying() &&  whiteball==NULL && get_id(*itr)==ac_meditation && isMeditating(*itr)) {
+                 // meditatist entered a free hollow
+                whiteball  = *itr;
+                enter_time = server::LevelTime;
+                break;
             }
         }
     }

Modified: trunk/src/items/RubberbandItem.cc
===================================================================
--- trunk/src/items/RubberbandItem.cc	2008-09-08 23:07:19 UTC (rev 1314)
+++ trunk/src/items/RubberbandItem.cc	2008-09-10 21:43:00 UTC (rev 1315)
@@ -66,9 +66,9 @@
             AddOther(dynamic_cast<Other *>(obj));
             transferIdentity(obj);
             SendMessage(obj, "_performaction");
-        }
-
-        return ITEM_KILL;
+            return ITEM_KILL;
+        } else
+            return ITEM_DROP;
     }
     
     DEF_ITEMTRAITS(RubberbandItem, "it_rubberband", it_rubberband);

Modified: trunk/src/items/ShogunDot.cc
===================================================================
--- trunk/src/items/ShogunDot.cc	2008-09-08 23:07:19 UTC (rev 1314)
+++ trunk/src/items/ShogunDot.cc	2008-09-10 21:43:00 UTC (rev 1315)
@@ -71,15 +71,6 @@
             if (server::EnigmaCompatibility < 1.10 && state == ON) {
                 performAction(true);
             }
-        } else if (m.message =="_shogun" && server::WorldInitialized) {
-            if (state == OFF && (requiredShogunHoles() == (int)m.value)) {  
-                state = ON;
-                performAction(true);
-            } else if (state == ON && (requiredShogunHoles() != (int)m.value)) {
-                state = OFF;
-                performAction(false);
-            }
-            return Value();
         }
         return Item::message(m);
     }
@@ -95,6 +86,14 @@
         Item::on_creation(p);
     }
     
+    void ShogunDot::stone_change(Stone *st) {
+        int newState = SendMessage(GetStone(get_pos()), "_shogun", requiredShogunHoles()).to_bool() ? ON : OFF;
+        if (state != newState ) {  
+            state = newState;
+            performAction(newState == ON);
+        }
+    }
+    
     int ShogunDot::getHoles() const {
         return (objFlags & OBJBIT_HOLES) >> 24;
     }

Modified: trunk/src/items/ShogunDot.hh
===================================================================
--- trunk/src/items/ShogunDot.hh	2008-09-08 23:07:19 UTC (rev 1314)
+++ trunk/src/items/ShogunDot.hh	2008-09-10 21:43:00 UTC (rev 1315)
@@ -54,6 +54,9 @@
         // GridObject interface
         virtual void on_creation(GridPos p);
 
+        // Item interface
+        virtual void stone_change(Stone *st);
+        
     private:
         int getHoles() const;
         int requiredShogunHoles() const;

Modified: trunk/src/stones/ShogunStone.cc
===================================================================
--- trunk/src/stones/ShogunStone.cc	2008-09-08 23:07:19 UTC (rev 1314)
+++ trunk/src/stones/ShogunStone.cc	2008-09-10 21:43:00 UTC (rev 1315)
@@ -141,11 +141,9 @@
                 s->setOwnerPos(p);
             }
         }
-        SendMessage(GetItem(p), "_shogun", getHoles());
     }
     
     void ShogunStone::on_removal(GridPos p) {
-        SendMessage(GetItem(p), "_shogun", 0);
         if (subShogun != NULL)
             subShogun->setOwnerPos(GridPos(-1,-1));
         Stone::on_removal(p);
@@ -153,7 +151,6 @@
 
     void ShogunStone::on_impulse(const Impulse& impulse) {
         static char * soundevent = "movesmall";
-        int id = getId();
         
         if (!impulse.byWire && subShogun != NULL) {
             subShogun->on_impulse(impulse);
@@ -179,7 +176,6 @@
             // then put to new position
             if (st == NULL) {
                 SetStone(newPos, this);
-                SendMessage(GetItem(newPos), "_shogun", getHoles());
             } else {
                 // register our hole to all super shoguns
                 ShogunStone *s = nss;
@@ -193,7 +189,7 @@
 
                 nss->init_model();     // display new hole         
                 setOwnerPos(newPos);   // the stone is owned at the new position
-                SendMessage(GetItem(newPos), "_shogun", nss->getHoles());
+                TouchStone(newPos);
             }
             
             server::IncMoveCounter();
@@ -207,8 +203,7 @@
                 }
             }
         }
-        if (Object::getObject(id) != NULL)   // not killed?
-            propagateImpulse(impulse);
+        propagateImpulse(impulse);
     }
     
     int ShogunStone::getHoles() const {
@@ -240,14 +235,12 @@
     bool ShogunStone::yieldShogun() {
         if (isDisplayable() && subShogun == NULL) {
             YieldStone(get_pos());
-            SendMessage(GetItem(get_pos()), "_shogun", 0);
         } else if (isDisplayable()) {
             // top most shogun moved by wire or killed
             GridPos oldPos = get_pos(); 
             YieldStone(oldPos);
             subShogun->superShogun = NULL;
             SetStone(oldPos, subShogun);
-            SendMessage(GetItem(oldPos), "_shogun", subShogun->getHoles());
             subShogun = NULL;
             removeAllSubHoles();
         } else {
@@ -262,10 +255,10 @@
             if (ShogunStone *superSuperShogun = superShogun->superShogun) {
                 superSuperShogun->removeSubHoles(ownHole());
                 superSuperShogun->init_model();
-                SendMessage(GetItem(getOwnerPos()), "_shogun", superSuperShogun->getHoles());
+                TouchStone(getOwnerPos());
             } else
                 superShogun->init_model();
-                SendMessage(GetItem(getOwnerPos()), "_shogun", superShogun->getHoles());
+                TouchStone(getOwnerPos());
             if (subShogun != NULL) subShogun->superShogun = superShogun;
             superShogun = NULL;
             subShogun = NULL;



From ral at mail.berlios.de  Sat Sep 13 16:48:19 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 13 Sep 2008 16:48:19 +0200
Subject: [Enigma-game-svn] r1316 - in trunk: doc src src/floors src/items
Message-ID: <200809131448.m8DEmJ7S003658@sheep.berlios.de>

Author: ral
Date: 2008-09-13 16:48:18 +0200 (Sat, 13 Sep 2008)
New Revision: 1316

Modified:
   trunk/doc/README.macosx
   trunk/src/Makefile.am
   trunk/src/floors/BridgeFloor.cc
   trunk/src/items/BlockerItem.cc
Log:
Trunk 1.1: 
- fix BlockerItem: stone destruction on messages - recheck stones on item
- Mac OS X patch of Sidney


Modified: trunk/doc/README.macosx
===================================================================
--- trunk/doc/README.macosx	2008-09-10 21:43:00 UTC (rev 1315)
+++ trunk/doc/README.macosx	2008-09-13 14:48:18 UTC (rev 1316)
@@ -1,8 +1,17 @@
-Building Enigma under MacOS X 10.4 and 10.3.9
+Building Enigma under MacOS X 10.5, 10.4 and 10.3.9
 
 Overview:
 ---------
 
+Due to which machines are available to Enigma developers, The latest version
+of Enigma has only been built under MacOS X 10.5. The instructions for
+building under older versions of MacOS X are retained below, but have
+not been tested to verify that they continue to work. Note that the
+Enigma Mac developers all have Apple's free Xcode development environment
+installed on their machines. Even though the build process is not run
+under Xcode, there may be some things that would not work if Xcode had
+never been installed.
+
 Enigma is built from the command line using make. There is a make
 target that will create a Mac OS application bundle in a compressed
 disk image file, enigma.dmg. That file can be copied to a Mac without
@@ -12,6 +21,247 @@
 You do need some other packages installed in order to build Enigma on
 your MacOS X system.
 
+Building under MacOS 10.5:
+--------------------------
+
+The build process has only been tested using packages installed from
+MacPorts (formerly called DarwinPorts). It may well be possible to use
+the equivalent packages from Fink or by downloading and building the
+packages and all of their dependencies from the various project source
+sites, but that has not been tested. MacPorts seems to provide the
+easiest way to get a working build environment for Enigma.
+
+There are several problems preventing being able to build Enigma as a
+universal binary on a single machine, including the smpeg package
+build process using ar to unpack separately built library files to
+combine them, a misfeature in QuickTime endian support that breaks
+SDL_mixer when it is compiled for the ppc architecture on an Intel
+host, and Enigma's use of the -M compiler options in building the lua
+code. Instructions for creating a universal binary of Enigma by
+combining separate builds on Intel and PPC machines are included
+below.
+
+Step 0 Install MacPorts: How to do that is outside the scope of this
+README, but it is pretty much a matter of finding the MacPorts web
+site, downloading and running their install package, and then checking
+to make sure that you have a ~/.profile file that adds
+/opt/local/bin to your path. For more information see the
+documentation at the MacPorts web site.
+
+Step 0a Fix up an autconf problem:
+
+I don't know if this is the most correct way to fix a problem with
+some builds not seeing some MacPorts installed packages, but it does
+work. Create a file named /usr/share/aclocal/dirlist that contains
+just the one line
+
+/opt/local/share/aclocal
+
+Step 1 Install SDL frameworks: Download the binary packages for Mac OS
+X from the SDL project web site for the current stable version of SDL
+(SDL 1.2 at the time of this writing), SDL_image, SDL_ttf, and
+SDL_mixer. The four URLs to find them are:
+
+http://www.libsdl.org/
+http://www.libsdl.org/projects/SDL_image/
+http://www.libsdl.org/projects/SDL_ttf/
+http://www.libsdl.org/projects/SDL_mixer/
+
+Each download is a dmg file that when opened contains a Framework
+directory, e.g., SDL.framework. Copy each of those directories into
+/Library/Frameworks/ to install it.
+
+  ------------
+
+NOTE: If you are running under MacOS 10.5 (Leopard) and you want to
+build a binary that can run under 10.4 (Tiger) skip ahead to Step
+2a. The simpler steps 2 and 3 will work to build under 10.4 to run under
+either 10.4 or 10.5, or to build under 10.5 to run only under 10.5.
+
+  -----------
+
+Step 2 At a Terminal.app command line, run the command
+
+ sudo port install libsdl libsdl_mixer libsdl_image libsdl_ttf xercesc
+
+Step 3 Build Enigma:
+
+Important: The configure step requires you to be logged in with access
+to the window system, i.e., either at the Mac keyboard or using remote
+screen sharing, and in a Terminal.app comand line. It will hang trying
+to test the SDL library if you are using ssh to log in remotely with no
+GUI screen.
+
+At the Terminal.app command line, cd to the Enigma directory tree and
+type
+
+ ./autogen.sh
+ env CPPFLAGS="-I/opt/local/include" LDFLAGS="-L/opt/local/lib" ./configure
+ make
+ make macapp
+
+That's it! If it all works, there will be a copy of enigma.dmg in the
+etc/ subdirectory and a copy of Enigma.app in etc/macfiles/
+subdirectory.
+
+  ------------
+
+Building on 10.5 to deploy on 10.4 or 10.5:
+
+Note: See the section below on making a Universal build for
+instructions on building on 10.5 on a PPC Mac to deploy on 10.3.9 or
+higher.
+
+Step 2a: The Macports packages are not set up to allow
+building under Mac OS 10.5 (Leopard) to produce a binary that can run
+under Mac OS 10.4 (Tiger). This optional step tells how to patch the
+Macports packages so that the resulting binary can run under 10.4 as
+well as 10.5. Note that nothing special needs to be done when building
+on a machine running 10.4 to result in a binary that can run on 10.5
+too.
+
+The files to be patched are all named Portfile and are under the directory
+/opt/local/var/macports/sources/rsync.macports.org/release/ports
+in the subdirectory indicated in the right column in the following list.
+
+The Macports packages that will be installed are:
+
+freetype          print/freetype
+jpeg              graphics/jpeg
+libogg            multimedia/libogg
+libpng            graphics/libpng
+libsdl            devel/libsdl
+libsdl_image      devel/libsdl_image
+libsdl_mixer      audio/libsdl_mixer
+libsdl_ttf        devel/libsdl_ttf
+libvorbis         audio/libvorbis
+pkgconfig         devel/pkgconfig
+smpeg             multimedia/smpeg
+tiff              graphics/tiff
+xercesc           textproc/xercesc
+
+Add the following sections to each of the port files above, with the
+exceptions listed below. Some of this may be unnecessary overkill, but
+it does seem to work. NOTE: When editing the Portfiles also remove any
+dependency delcaration for port:zlib.
+
+platform darwin 8 {
+	 configure.env-append    MACOSX_DEPLOYMENT_TARGET=10.4
+	 build.env-append        MACOSX_DEPLOYMENT_TARGET=10.4
+	 configure.cflags-delete	"-isysroot"
+	 configure.cflags-delete	"/Developer/SDKs/MacOSX10.5.sdk"
+	 configure.cxxflags-delete	"-isysroot"
+	 configure.cxxflags-delete	"/Developer/SDKs/MacOSX10.5.sdk"
+	 configure.ldflags-delete	"-isysroot"
+	 configure.ldflags-delete	"/Developer/SDKs/MacOSX10.5.sdk"
+ 	 configure.ldflags-delete	"-Wl,-syslibroot,Developer/SDKs/MacOSX10.5.sdk"
+	 configure.cflags-append	"-mmacosx-version-min=10.4 -isysroot /Developer/SDKs/MacOSX10.4u.sdk"
+	 configure.cxxflags-append	"-mmacosx-version-min=10.4 -isysroot /Developer/SDKs/MacOSX10.4u.sdk"
+ 	 configure.ldflags-append	"-mmacosx-version-min=10.4 -isysroot /Developer/SDKs/MacOSX10.4u.sdk -Wl,-syslibroot,/Developer/SDKs/MacOSX10.4u.sdk"
+}
+
+   --------
+Exceptions:
+
+pkgconfig does not have to be altered, as it is only a build dependency
+tiff does not have to be altered, as it is already configured properly
+
+libsdl already has a darwin_8 section, so add the above
+contents to the end of the existing section.
+
+xercesc needs the following section instead of the above:
+
+platform darwin 8 {
+	 configure.env-append    MACOSX_DEPLOYMENT_TARGET=10.4
+	 build.env-append        MACOSX_DEPLOYMENT_TARGET=10.4
+	configure.pre_args-append	-c /usr/bin/gcc-4.0 -x /usr/bin/g++-4.0 -z -isysroot -z /Developer/SDKs/MacOSX10.4u.sdk -z -mmacosx-version-min=10.4 -l -isysroot -l /Developer/SDKs/MacOSX10.4u.sdk -l -mmacosx-version-min=10.4 -l -Wl,-syslibroot,/Developer/SDKs/MacOSX10.4u.sdk
+}
+
+   --------
+
+Uninstall and clean each of the above packages if they are installed
+in MacPorts, then edit the Portfile for each one, then install all of
+them with variant +darwin_8. The following commands will get all of the
+required packages once dependencies are followed:
+
+ sudo port install xercesc +darwin_8
+ sudo port install libsdl +darwin_8
+ sudo port install libsdl_image +darwin_8
+ sudo port install libsdl_ttf +darwin_8
+ sudo port install libsdl_mixer +darwin_8
+
+Step 3a Build Enigma:
+
+Important: The configure step requires you to be logged in with access
+to the window system, i.e., either at the Mac keyboard or using remote
+screen sharing, and in a Terminal.app comand line. It will hang trying
+to test the SDL library if you are using ssh to log in remotely with no
+GUI screen.
+
+At the Terminal.app command line, cd to the Enigma directory tree and
+type
+
+ export MACOSX_DEPLOYMENT_TARGET=10.4
+ export SDK=/Developer/SDKs/MacOSX10.4u.sdk
+ ./autogen.sh
+ env CPPFLAGS="-I/opt/local/include -mmacosx-version-min=10.4 -isysroot ${SDK}" LDFLAGS="-L/opt/local/lib -mmacosx-version-min=10.4 -isysroot ${SDK} -Wl,-syslibroot,${SDK}" ./configure
+ make
+ make macapp
+
+That's it! If it all works, there will be a copy of enigma.dmg in the
+etc/ subdirectory and a copy of Enigma.app in etc/macfiles/
+subdirectory.
+
+Creating a universal binary with support for 10.3.9+
+---------------------------
+
+To get a Universal binary, you must create separate builds on a PPC
+and an Intel Mac, then combine them to form one Universal
+build. Follow the instructions above to get a build for 10.4+ on the
+Intel machine. Modify the instructions above on the PPC machine as
+follows to get a build that will work on 10.3.9 or higher:
+
+Instead of adding a "platform darwin 8" section to the MacPorts
+Portfiles, add an equivalent "platform darwin 7" section in which each
+"10.4" is replaced by "10.3" and each "MacOSX10.4u.sdk" is replaced by
+"MacOSX10.3.9.sdk". In the steps to install the MacPorts packages, use
++darwin_7 in the install commands instead of +darwin_8
+
+If you then complete the bulld process on the PPC machine it will
+produce a PPC-only build compatible with MacOS 10.3.9 and higher.
+
+On the PPC machine, go into the direcctory tree of the resulting
+Enigma.app, either using a terminal command line or in the finder
+using control-click Show Package Contents, and copy the file
+Enigma.app/Contents/MacOS/enigma to the Intel machine where you name
+the file enigma-ppc and place it in Enigma.app/Contents/MacOS/
+there. On the Intel machine rename the file
+Enigma.app/Contents/MacOS/enigma to enigma-intel. Now that you have
+the two versions of that file with suitable names, in a Terminal.app
+command line cd into the Enigma.app/Contents/MacOS/ directory and run
+the following command
+
+ lipo -create enigma-intel enigma-ppc -output enigma
+
+Delete enigma-intel and enigma-ppc
+
+At this point, if you want, you can verify that the Enigma.app on the
+Intel machine runs fine on both the Intel and the PPC machines.
+
+To recreate the etc/enigma.dmg file with the new app, first delete or
+rename the etc/enigma.dmg file, then cd to the src/ directory and run
+the command
+
+ make bundle-dmg
+
+-------------------------
+-------------------------
+-------------------------
+
+The remainder of this file is being kept to document the procedures
+that were used with older versions of MacOS X, but we have not tested
+them using current versions of Enigma.
+
 Building under MacOS 10.4:
 -------------------------
 

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-09-10 21:43:00 UTC (rev 1315)
+++ trunk/src/Makefile.am	2008-09-13 14:48:18 UTC (rev 1316)
@@ -446,10 +446,11 @@
 	cp $(top_builddir)/doc/reference/*.html $(bundle_doc)/reference/
 
 # Special target to create a binary linked with Mac OS X frameworks
+# note this assumes that xercesc and libpng are installed in same directory as the SDL libraries.
 static_prefix := `$(SDL_CONFIG) --prefix`
 .PHONY: enigma-fw-mosx
 enigma-fw-mosx: $(enigma_OBJECTS) $(enigma_DEPENDENCIES)
-	$(CXX) $(LDFLAGS) -o enigma-fw $(enigma_OBJECTS) $(enigma_DEPENDENCIES) $(static_prefix)/lib/libintl.a $(static_prefix)/lib/libxerces-c.a /usr/lib/libiconv.dylib -L$(static_prefix)/lib -lsdlmain -lz -framework SDL -framework SDL_image -framework SDL_mixer -framework Cocoa -framework OpenGL -framework SDL_ttf $(static_prefix)/lib/libpng.a 
+	$(CXX) $(LDFLAGS) -o enigma-fw $(enigma_OBJECTS) $(enigma_DEPENDENCIES) ${LIBINTL} $(static_prefix)/lib/libxerces-c.a -L$(static_prefix)/lib -lsdlmain -lz -framework SDL -framework SDL_image -framework SDL_mixer -framework Cocoa -framework OpenGL -framework SDL_ttf $(static_prefix)/lib/libpng.a 
 
 # Special target to make a disk image of the bundled app
 .PHONY: bundle-dmg

Modified: trunk/src/floors/BridgeFloor.cc
===================================================================
--- trunk/src/floors/BridgeFloor.cc	2008-09-10 21:43:00 UTC (rev 1315)
+++ trunk/src/floors/BridgeFloor.cc	2008-09-13 14:48:18 UTC (rev 1316)
@@ -137,6 +137,7 @@
             return "fl-bridgex-";
         else if (flavor == "bn")
             return "fl-bridgey-";
+        return "";
     }
     
     void BridgeFloor::set_iState(int newState) {

Modified: trunk/src/items/BlockerItem.cc
===================================================================
--- trunk/src/items/BlockerItem.cc	2008-09-10 21:43:00 UTC (rev 1315)
+++ trunk/src/items/BlockerItem.cc	2008-09-13 14:48:18 UTC (rev 1316)
@@ -73,6 +73,8 @@
     }
     
     void BlockerItem::setState(int extState) {
+        if (isDisplayable())
+            stone_change(GetStone(get_pos()));
         if (extState == 1) {         // open (shrink)
             if (state == UNLOCKED)   //   revoke pending grow/close
                 setIState(LOCKED);



From ral at mail.berlios.de  Sat Sep 13 16:51:34 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 13 Sep 2008 16:51:34 +0200
Subject: [Enigma-game-svn] r1317 - in trunk: data data/schemas src src/stones
Message-ID: <200809131451.m8DEpYRS004117@sheep.berlios.de>

Author: ral
Date: 2008-09-13 16:51:32 +0200 (Sat, 13 Sep 2008)
New Revision: 1317

Added:
   trunk/src/stones/PuzzleStone.cc
   trunk/src/stones/PuzzleStone.hh
Removed:
   trunk/src/stones/ConnectiveStone.cc
   trunk/src/stones/ConnectiveStone.hh
Modified:
   trunk/data/api1init.lua
   trunk/data/api2init.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/enigma.hh
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.cc
   trunk/src/stones.hh
   trunk/src/stones/ClusterStone.cc
   trunk/src/stones/ClusterStone.hh
   trunk/src/stones_complex.cc
   trunk/src/world.cc
Log:
Trunk 1.1: new API reengineering
- puzzle part 1:
  - rename to "st_puzzle","st_puzzle_blue", "st_puzzle_yellow"
  - attribute "color", values BLUE, YELLOW
  - attribute "connections" like Clusterstones - substring of "nesw" 
  - attribute "hollow": true, false
  - hollow puzzles exist only with "nesw", connection attribute is set
  - keep identity of stones on rotation
  - fix laser light bugs on rotation of hollow, switched off light,...
  - improve algorithms - linear ones only
  - disable all operations on a cluster on pending explosions
  - add autocluster feature
- unused class ConnectiveStone eliminated


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/data/api1init.lua	2008-09-13 14:51:32 UTC (rev 1317)
@@ -219,6 +219,38 @@
     st_panel = "st-wood_001",
     st_polarswitch = "st-polarswitch",
     st_pull = "st-pull",
+    st_puzzle = "st-puzzle",
+    st_puzzle_blue_w = "st-puzzle-w",
+    st_puzzle_blue_s = "st-puzzle-s",
+    st_puzzle_blue_sw = "st-puzzle-sw",
+    st_puzzle_blue_e = "st-puzzle-e",
+    st_puzzle_blue_ew = "st-puzzle-ew",
+    st_puzzle_blue_es = "st-puzzle-es",
+    st_puzzle_blue_esw = "st-puzzle-esw",
+    st_puzzle_blue_n = "st-puzzle-n",
+    st_puzzle_blue_nw = "st-puzzle-nw",
+    st_puzzle_blue_ns = "st-puzzle-ns",
+    st_puzzle_blue_nsw = "st-puzzle-nsw",
+    st_puzzle_blue_ne = "st-puzzle-ne",
+    st_puzzle_blue_new = "st-puzzle-new",
+    st_puzzle_blue_nes = "st-puzzle-nes",
+    st_puzzle_blue_nesw = "st-puzzle-nesw",
+    st_puzzle_blue_hollow = "st-puzzle-hollow",
+    st_puzzle_yellow_w = "st-puzzle2-w",
+    st_puzzle_yellow_s = "st-puzzle2-s",
+    st_puzzle_yellow_sw = "st-puzzle2-sw",
+    st_puzzle_yellow_e = "st-puzzle2-e",
+    st_puzzle_yellow_ew = "st-puzzle2-ew",
+    st_puzzle_yellow_es = "st-puzzle2-es",
+    st_puzzle_yellow_esw = "st-puzzle2-esw",
+    st_puzzle_yellow_n = "st-puzzle2-n",
+    st_puzzle_yellow_nw = "st-puzzle2-nw",
+    st_puzzle_yellow_ns = "st-puzzle2-ns",
+    st_puzzle_yellow_nsw = "st-puzzle2-nsw",
+    st_puzzle_yellow_ne = "st-puzzle2-ne",
+    st_puzzle_yellow_new = "st-puzzle2-new",
+    st_puzzle_yellow_nes = "st-puzzle2-nes",
+    st_puzzle_yellow_nesw_hollow = "st-puzzle2-hollow",
     st_rotator_cw = "st-rotator-right",
     st_rotator_ccw = "st-rotator-left",
     st_rotator_cw_movable = "st-rotator_move-right",
@@ -409,6 +441,9 @@
             return "st-door_" .. flavor
         end
     end
+    if _newname == "st_puzzle" then
+        return "st-puzzle"
+    end
     if _newname == "it_sensor" then
         local code = enigma._GetAttrib(obj, "inverse")
         if code == false then
@@ -441,9 +476,8 @@
              _key = "oxydcolor"
 	 end
      end
-     if key == "connections" and _obj_name ~= "st-puzzle" then
-         if val == 1 then _val = ""
-         elseif  val == 2  then _val = "w"
+     if key == "connections" then
+         if  val == 2  then _val = "w"
          elseif  val == 3  then _val = "s"
          elseif  val == 4  then _val = "sw"
          elseif  val == 5  then _val = "e"
@@ -458,8 +492,16 @@
          elseif  val == 14 then _val = "new"
          elseif  val == 15 then _val = "nes"
          elseif  val == 16 then _val = "nesw"
+         elseif  val == 1 and _obj_name ~= "st-puzzle" then _val = ""
+         elseif  val == 1 and _obj_name == "st-puzzle" then
+             _key = "hollow"
+             _val = true
          end
      end
+     if key == "oxyd" then
+        _key = "color"
+        if val == 0 then _val = 2 else _val = 3 end
+     end
      if key == "keycode" then
          _key = "code"
      end
@@ -611,6 +653,11 @@
          else return "a"
          end
      end
+     if key == "oxyd" and _obj_name == "st-puzzle" then
+         local color = enigma._GetAttrib(obj, "color")
+         if color == 2 then val = 0 else val = 1 end
+         return val
+     end
 
      local val = enigma._GetAttrib(obj, _key)
      
@@ -620,7 +667,7 @@
      if key == "whiteball" then
         if val == 1 then val = 1 else val = 0 end
      end
-     if key == "connections" and _obj_name ~= "st-puzzle" then
+     if key == "connections" then
          if val == "" then val = 1
          elseif  val == "w"    then val = 2
          elseif  val == "s"    then val = 3

Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/data/api2init.lua	2008-09-13 14:51:32 UTC (rev 1317)
@@ -71,8 +71,10 @@
 OXYDPAIR = 2
 
 -- color
-BLACK = 0
-WHITE = 1
+BLACK  = 0
+WHITE  = 1
+BLUE   = 2
+YELLOW = 3
 NOCOLOR = nil
 
 -- rotation direction

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/data/schemas/objects.xml	2008-09-13 14:51:32 UTC (rev 1317)
@@ -6,7 +6,7 @@
     <attr name="anchor1" type="tokens" default="nil" rw="rw"/>
     <attr name="anchor2" type="tokens" default="nil" rw="rw"/>
     <attr name="autoclose" type="bool" default="false" rw="rw"/>
-    <attr name="cluster" type="int" default="nil" min="0" max="1" rw="rw"/>
+    <attr name="cluster" type="int" default="nil" min="0" max="9" rw="rw"/>
     <attr name="code" type="int" default="1" rw="rw"/>
     <attr name="coin_value" type="double" default="1" rw="rw"/>
     <attr name="color" type="int" default="nil" min="0" max="1" rw="rw"/>
@@ -26,6 +26,7 @@
     <attr name="hit_distortion_xy" type="double" default="0" rw="rw"/>
     <attr name="hit_distortion_yx" type="double" default="0" rw="rw"/>
     <attr name="hit_distortion_yy" type="double" default="1" rw="rw"/>
+    <attr name="hollow" type="bool" default="false" rw="rw"/>
     <attr name="instant" type="bool" default="false" rw="rw"/>
     <attr name="interval" type="double" default="1" rw="rw"/>
     <attr name="interval_s" type="double" default="3" rw="rw"/>
@@ -63,6 +64,7 @@
     <msg name="closeall" type="nil"/>
     <msg name="disconnect" type="nil"/>
     <msg name="flip" type="nil"/>
+    <msg name="get_adjacents" type="nil"/>
     <msg name="grow" type="nil"/>
     <msg name="hit" type="object"/>
     <msg name="ignite" type="nil"/>
@@ -73,6 +75,8 @@
     <msg name="on" type="nil"/>
     <msg name="open" type="nil"/>
     <msg name="orientate" type="nil"/>
+    <msg name="pull_rotate" type="int"/>
+    <msg name="push_rotate" type="int"/>
     <msg name="shuffle" type="nil"/>
     <msg name="shovel" type="nil"/>
     <msg name="signal" type="int" min="0" max="1"/>
@@ -92,6 +96,7 @@
     <msg name="_passed" type="nil"/>            <!-- check type-->
     <msg name="_performaction" type="nil"/>
     <msg name="_revive" type="nil"/>
+    <msg name="_scramble" type="int"/>
     <msg name="_shogun" type="int"/>
     <msg name="_spitter" type="nil"/>
     <msg name="_start" type="nil"/>
@@ -819,6 +824,23 @@
       <msg name="_freeze"/>
       <msg name="_revive"/>
     </object>
+    <object name="st_puzzle">
+      <attr name="connections"/>
+      <attr name="cluster"/>
+      <attr name="color" min="2" max="3"/>
+      <attr name="hollow"/>
+      <attr name="state" rw="r"/>
+      <msg name="get_adjacents"/>
+      <msg name="pull_rotate"/>
+      <msg name="push_rotate"/>
+      <msg name="_scramble"/>
+    </object>
+    <object name="st_puzzle_blue">
+      <attr name="color" value="2"/>
+    </object>
+    <object name="st_puzzle_yellow">
+      <attr name="color" value="3"/>
+   </object>
     <object name="st_rotator">
       <attr name="counterclock"/>
       <attr name="movable" rw="rw"/>

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/Makefile.am	2008-09-13 14:51:32 UTC (rev 1317)
@@ -247,8 +247,6 @@
 	stones/ClusterStone.hh	\
 	stones/CoinSlot.cc	\
 	stones/CoinSlot.hh	\
-	stones/ConnectiveStone.cc	\
-	stones/ConnectiveStone.hh	\
 	stones/DeathStone.cc	\
 	stones/DeathStone.hh	\
 	stones/Door.cc		\
@@ -283,6 +281,8 @@
 	stones/PolarSwitchStone.hh	\
 	stones/PullStone.cc	\
 	stones/PullStone.hh	\
+	stones/PuzzleStone.cc	\
+	stones/PuzzleStone.hh	\
 	stones/RotatorStone.cc	\
 	stones/RotatorStone.hh	\
 	stones/RubberbandStone.cc	\

Modified: trunk/src/enigma.hh
===================================================================
--- trunk/src/enigma.hh	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/enigma.hh	2008-09-13 14:51:32 UTC (rev 1317)
@@ -41,7 +41,9 @@
     
     enum Color {
         BLACK = 0,
-        WHITE = 1
+        WHITE = 1,
+        BLUE  = 2,
+        YELLOW = 3
     };
     
 /* -------------------- Various types -------------------- */

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/ox_magnum.cc	2008-09-13 14:51:32 UTC (rev 1317)
@@ -203,17 +203,17 @@
     "st_mirror_triangle_nc",    // OxydMagnum stone 0x54
     "st_mirror_triangle_wc",    // OxydMagnum stone 0x55
     "st_mirror_triangle_sc",    // OxydMagnum stone 0x56
-    "st-puzzle2-es",            // Oxyd1 stone 0x57
-    "st-puzzle2-sw",            // Oxyd1 stone 0x58
-    "st-puzzle2-nw",            // Oxyd1 stone 0x59
-    "st-puzzle2-ne",            // Oxyd1 stone 0x5a
-    "st-puzzle2-ew",            // Oxyd1 stone 0x5b
-    "st-puzzle2-ns",            // Oxyd1 stone 0x5c
-    "st-puzzle2-n",             // Oxyd1 stone 0x5d
-    "st-puzzle2-s",             // Oxyd1 stone 0x5e
-    "st-puzzle2-w",             // Oxyd1 stone 0x5f
-    "st-puzzle2-e",             // Oxyd1 stone 0x60
-    "st-puzzle2-nesw",          // Oxyd1 stone 0x61
+    "st_puzzle_yellow_es",      // Oxyd1 stone 0x57
+    "st_puzzle_yellow_ew",      // Oxyd1 stone 0x58
+    "st_puzzle_yellow_nw",      // Oxyd1 stone 0x59
+    "st_puzzle_yellow_ne",      // Oxyd1 stone 0x5a
+    "st_puzzle_yellow_ew",      // Oxyd1 stone 0x5b
+    "st_puzzle_yellow_ns",      // Oxyd1 stone 0x5c
+    "st_puzzle_yellow_n",       // Oxyd1 stone 0x5d
+    "st_puzzle_yellow_s",       // Oxyd1 stone 0x5e
+    "st_puzzle_yellow_w",       // Oxyd1 stone 0x5f
+    "st_puzzle_yellow_e",       // Oxyd1 stone 0x60
+    "st_puzzle_yellow_nesw",    // Oxyd1 stone 0x61
     "st-metal_hole",            // OxydMagnum stone 0x62  (st-explosive: like st-metal, but explodes when touched ...)
     "st-plain_break",           // OxydMagnum stone 0x63
     "st-fakeoxyda",             // OxydMagnum stone 0x64

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/ox_oxyd1.cc	2008-09-13 14:51:32 UTC (rev 1317)
@@ -235,17 +235,17 @@
     "st_mirror_triangle_nc",    // Oxyd1 stone 0x54
     "st_mirror_triangle_wc",    // Oxyd1 stone 0x55
     "st_mirror_triangle_sc",    // Oxyd1 stone 0x56
-    "st-puzzle2-es",            // Oxyd1 stone 0x57
-    "st-puzzle2-sw",            // Oxyd1 stone 0x58
-    "st-puzzle2-nw",            // Oxyd1 stone 0x59
-    "st-puzzle2-ne",            // Oxyd1 stone 0x5a
-    "st-puzzle2-ew",            // Oxyd1 stone 0x5b
-    "st-puzzle2-ns",            // Oxyd1 stone 0x5c
-    "st-puzzle2-n",             // Oxyd1 stone 0x5d
-    "st-puzzle2-s",             // Oxyd1 stone 0x5e
-    "st-puzzle2-w",             // Oxyd1 stone 0x5f
-    "st-puzzle2-e",             // Oxyd1 stone 0x60
-    "st-puzzle2-nesw",          // Oxyd1 stone 0x61
+    "st_puzzle_yellow_es",      // Oxyd1 stone 0x57
+    "st_puzzle_yellow_sw",      // Oxyd1 stone 0x58
+    "st_puzzle_yellow_nw",      // Oxyd1 stone 0x59
+    "st_puzzle_yellow_ne",      // Oxyd1 stone 0x5a
+    "st_puzzle_yellow_ew",      // Oxyd1 stone 0x5b
+    "st_puzzle_yellow_ns",      // Oxyd1 stone 0x5c
+    "st_puzzle_yellow_n",       // Oxyd1 stone 0x5d
+    "st_puzzle_yellow_s",       // Oxyd1 stone 0x5e
+    "st_puzzle_yellow_w",       // Oxyd1 stone 0x5f
+    "st_puzzle_yellow_e",       // Oxyd1 stone 0x60
+    "st_puzzle_yellow_nesw",    // Oxyd1 stone 0x61
     "st-metal_hole",            // Oxyd1 stone 0x62
     "st-laserbreak",            // Oxyd1 stone 0x63
     "st-fakeoxyda",             // Oxyd1 stone 0x64

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/ox_peroxyd.cc	2008-09-13 14:51:32 UTC (rev 1317)
@@ -269,18 +269,18 @@
     "st_mirror_triangle_nc",    // PerOxyd stone 0x4e
     "st_mirror_triangle_wc",    // PerOxyd stone 0x4f
     "st_mirror_triangle_sc",    // PerOxyd stone 0x50
-    "st-puzzle-es",             // PerOxyd stone 0x51
-    "st-puzzle-sw",             // PerOxyd stone 0x52
-    "st-puzzle-nw",             // PerOxyd stone 0x53
-    "st-puzzle-ne",             // PerOxyd stone 0x54
-    "st-puzzle-ew",             // PerOxyd stone 0x55
-    "st-puzzle-ns",             // PerOxyd stone 0x56
-    "st-puzzle-n",              // PerOxyd stone 0x57
-    "st-puzzle-s",              // PerOxyd stone 0x58
-    "st-puzzle-w",              // PerOxyd stone 0x59
-    "st-puzzle-e",              // PerOxyd stone 0x5a
-    "st-puzzle-nesw",           // PerOxyd stone 0x5b
-    "st-puzzle-hollow",         // PerOxyd stone 0x5c
+    "st_puzzle_blue_es",        // PerOxyd stone 0x51
+    "st_puzzle_blue_sw",        // PerOxyd stone 0x52
+    "st_puzzle_blue_nw",        // PerOxyd stone 0x53
+    "st_puzzle_blue_ne",        // PerOxyd stone 0x54
+    "st_puzzle_blue_ew",        // PerOxyd stone 0x55
+    "st_puzzle_blue_ns",        // PerOxyd stone 0x56
+    "st_puzzle_blue_n",         // PerOxyd stone 0x57
+    "st_puzzle_blue_s",         // PerOxyd stone 0x58
+    "st_puzzle_blue_w",         // PerOxyd stone 0x59
+    "st_puzzle_blue_e",         // PerOxyd stone 0x5a
+    "st_puzzle_blue_nesw",      // PerOxyd stone 0x5b
+    "st_puzzle_blue_nesw_hollow", // PerOxyd stone 0x5c
     "st-laserbreak",            // PerOxyd stone 0x5d
     "st-coffee",                // PerOxyd stone 0x5e
     "st_shogun",                // PerOxyd stone 0x5f (oxyd with a hole, movable ... strange stone! st-shogun as workaround, only link level 74)

Modified: trunk/src/stones/ClusterStone.cc
===================================================================
--- trunk/src/stones/ClusterStone.cc	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/stones/ClusterStone.cc	2008-09-13 14:51:32 UTC (rev 1317)
@@ -70,48 +70,7 @@
     bool ClusterStone::is_removable() const {
         return getFaces() == ALL_DIRECTIONS;
     }
-    
-    void ClusterStone::autoJoinCluster() {
-        GridPos p = get_pos();
-        Value myCluster = getAttr("cluster");
-        for (int i = WEST; i <= NORTH; i++) {
-            Direction d = (Direction) i;
-            Stone *neighbour = GetStone(move(p, d));
-            if (neighbour != NULL && std::string(neighbour->getClass()) == getClass()) {
-                Value neighbourCluster = neighbour->getAttr("cluster");
-                if (myCluster) {
-                    if (myCluster == neighbourCluster) {
-                        setAttr("$connections", getConnections() | to_bits(d));
-                        neighbour->setAttr("$connections", neighbour->getConnections() | to_bits(reverse(d)));
-                    } else if (!neighbourCluster && neighbour->getConnections() & to_bits(reverse(d))) {
-                        setAttr("$connections", getConnections() | to_bits(d));
-                    } else {
-                        setAttr("$connections", getConnections() & (ALL_DIRECTIONS ^ to_bits(d))); // clear connection
-                    }
-                } else if (neighbourCluster)  {// I have fixed connections -> adapt neighbour
-                    if (getConnections() & to_bits(d))
-                        neighbour->setAttr("$connections", neighbour->getConnections() | to_bits(reverse(d)));
-                    else
-                        neighbour->setAttr("$connections", neighbour->getConnections() & (ALL_DIRECTIONS ^ to_bits(reverse(d))));
-                }
-            } else if (myCluster) { // no neighbour -> no connection
-                setAttr("$connections", getConnections() & (ALL_DIRECTIONS ^ to_bits(d))); // clear connection
-            }
-        }
-    }
-    
-    void ClusterStone::autoLeaveCluster() {
-        GridPos p = get_pos();
-        for (int i = WEST; i <= NORTH; i++) {
-            Direction d = (Direction) i;
-            Stone *neighbour = GetStone(move(p, d));
-            if (neighbour != NULL && std::string(neighbour->getClass()) == getClass() 
-                    && neighbour->getAttr("cluster")) {
-                neighbour->setAttr("$connections", neighbour->getConnections() & (ALL_DIRECTIONS ^ to_bits(reverse(d))));
-            }
-        }
-    }
-    
+        
     BOOT_REGISTER_START
         BootRegister(new ClusterStone("st_panel", ""), "st_panel");
         BootRegister(new ClusterStone("st_panel", "w"), "st_panel_w");

Modified: trunk/src/stones/ClusterStone.hh
===================================================================
--- trunk/src/stones/ClusterStone.hh	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/stones/ClusterStone.hh	2008-09-13 14:51:32 UTC (rev 1317)
@@ -45,11 +45,7 @@
         virtual std::string getModelName() const;
         
         // Stone interface
-        virtual bool is_removable() const;
-        
-    private:
-        void autoJoinCluster();
-        void autoLeaveCluster();
+        virtual bool is_removable() const;        
     };
 
 } // namespace enigma

Deleted: trunk/src/stones/ConnectiveStone.cc
===================================================================
--- trunk/src/stones/ConnectiveStone.cc	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/stones/ConnectiveStone.cc	2008-09-13 14:51:32 UTC (rev 1317)
@@ -1,24 +0,0 @@
-/*
- * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2007 Ronald Lamprecht
- *
- * This program is free software; you can redistribute it and/or
- * modify it under the terms of the GNU General Public License
- * as published by the Free Software Foundation; either version 2
- * of the License, or (at your option) any later version.
- *  
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along
- * with this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
- *
- */
-
-#include "stones/ConnectiveStone.hh"
-
-namespace enigma {
-} // namespace enigma

Deleted: trunk/src/stones/ConnectiveStone.hh
===================================================================
--- trunk/src/stones/ConnectiveStone.hh	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/stones/ConnectiveStone.hh	2008-09-13 14:51:32 UTC (rev 1317)
@@ -1,76 +0,0 @@
-/*
- * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2007 Ronald Lamprecht
- *
- * This program is free software; you can redistribute it and/or
- * modify it under the terms of the GNU General Public License
- * as published by the Free Software Foundation; either version 2
- * of the License, or (at your option) any later version.
- *  
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along
- * with this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
- *
- */
-#ifndef CONNECTIVESTONE_HH_INCLUDED
-#define CONNECTIVESTONE_HH_INCLUDED
-
-#include "stones.hh"
-
-/* -------------------- ConnectiveStone -------------------- */
-
-// base class for PuzzleStone and BigBrick
-
-namespace enigma {
-    
-    class ConnectiveStone : public Stone {
-    public:
-        ConnectiveStone(const char *kind, int connections): Stone(kind) {
-            setAttr("connections", connections);
-        }
-        ConnectiveStone(int connections) {
-            setAttr("connections", connections);
-        }
-
-        DirectionBits get_connections() const {
-            int conn = (int)getAttr("connections") - 1;
-            if (conn >=0 && conn <16)
-                return DirectionBits(conn);
-            else
-                return NODIRBIT;
-        }
-
-        // temp. workarounds until this class gets eliminated
-        virtual void setAttr(const string& key, const Value &val) {
-            if (key == "connections")
-                Object::setAttr(key, val);  // bypass GridObject
-            else
-                Stone::setAttr(key, val);
-        }
-        
-        virtual Value getAttr(const string &key) const {
-            if (key == "connections")
-                return Object::getAttr(key);
-            else
-                return Stone::getAttr(key);
-        }
-
-
-    protected:
-        virtual void init_model() {
-            set_model(get_kind()+ecl::strf("%d", get_modelno()));
-        }
-
-        virtual int get_modelno() const {
-            return getAttr("connections");
-        }
-    };
-
-} // namespace enigma
-
-#endif

Added: trunk/src/stones/PuzzleStone.cc
===================================================================
--- trunk/src/stones/PuzzleStone.cc	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/stones/PuzzleStone.cc	2008-09-13 14:51:32 UTC (rev 1317)
@@ -0,0 +1,605 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/PuzzleStone.hh"
+#include "errors.hh"
+#include "main.hh"
+#include "player.hh"
+#include "world.hh"
+#include <algorithm>
+
+namespace enigma {
+    PuzzleStone::PuzzleStone(int color, std::string connections, bool hollow) : Stone() {
+        setAttr("color", color);
+        setAttr("connections", connections);
+        setAttr("hollow", hollow);
+    }
+    
+    PuzzleStone::~PuzzleStone() {
+        GameTimer.remove_alarm (this);
+    }
+    
+    std::string PuzzleStone::getClass() const {
+        return "st_puzzle";
+    }
+    
+    void PuzzleStone::setAttr(const string& key, const Value &val) {
+        if (key == "hollow") {
+            if (val.to_bool() != (bool)(objFlags & OBJBIT_HOLLOW)) {
+                objFlags ^= OBJBIT_HOLLOW;
+                if (objFlags & OBJBIT_HOLLOW)
+                    Stone::setAttr("connections", "nesw");
+                else if (isDisplayable())
+                    init_model();
+            }
+            return;
+        } else if (key == "connections" && !(objFlags & OBJBIT_HOLLOW)) {
+            Stone::setAttr(key, val);
+        }
+        Stone::setAttr(key, val);
+    }
+
+    Value PuzzleStone::getAttr(const std::string &key) const {
+        if (key == "hollow") {
+            return (bool)(objFlags & OBJBIT_HOLLOW);
+        }
+        return Stone::getAttr(key);
+    }
+
+    Value PuzzleStone::message(const Message &m) {
+        if (m.message == "_scramble") {
+            // oxyd levels contain explicit information on how to
+            // scramble puzzle stones. According to that information
+            // a "scramble" message is send to specific puzzle stones
+            // together with information about the direction.
+            //
+            // enigma levels may create scramble messages using
+            // AddScramble() and SetScrambleIntensity()
+    
+            Direction dir = to_direction(m.value);
+            PuzzleList c;
+            int size = findLine(c, dir, (int)getAttr("color"));
+    
+            // warning("received 'scramble'. dir=%s size=%i", to_suffix(dir).c_str(), size);
+    
+            if (size >= 2) {
+                int count = IntegerRand(0, static_cast<int> (size-1));
+                while (count--)
+                    rotateLine(c);
+            }
+            else {
+                warning("useless scramble (line size=%i)", size);
+            }
+            return Value();
+        } else if (m.message == "get_adjacents") {
+            // need a message instead of getAttr as we write mark puzzles what contradicts "const"
+            PuzzleList huddle;
+            findAdjacents(huddle);
+            ObjectList adj;
+            for (PuzzleList::iterator itr = huddle.begin(); itr != huddle.end(); ++itr)
+                adj.push_back(*itr);
+            return adj;
+        } else if (m.message == "pull_rotate") {
+            rotateLine(to_direction(m.value), false);
+            return Value();
+        } else if (m.message == "push_rotate") {
+            rotateLine(to_direction(m.value), true);
+            return Value();
+        }
+        return Stone::message(m);
+    }
+    
+    void PuzzleStone::setState(int extState) {
+        // block all write attempts
+    }
+    
+    void PuzzleStone::init_model() {
+        if (state == EXPLODING) {
+            set_anim("st-explosion");
+            return;
+        }
+        int m = getConnections() + 1;
+        if (m == 1)
+            set_model("st-metal");
+        else {    
+            if ((objFlags & OBJBIT_HOLLOW) && m == 16)
+                m = 1;
+            if (getAttr("color") == YELLOW)
+                m += 16;
+            set_model(ecl::strf("st-puzzle%d", m));
+        }
+    }
+    
+    void PuzzleStone::on_creation(GridPos p) {
+        if (!(objFlags & OBJBIT_INIT)) {
+            autoJoinCluster();
+             objFlags |= OBJBIT_INIT;
+        }
+        activatePhoto();
+        Stone::on_creation(p);
+    }
+    
+    void PuzzleStone::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
+        if (state == IDLE && !(objFlags & OBJBIT_HOLLOW)) {
+            DirectionBits addDirs = added_dirs(oldDirs, newDirs);
+            if (addDirs != NODIRBIT && !explodeCluster() && getAttr("color") == BLUE) {
+                if (addDirs & SOUTHBIT) rotateLine(SOUTH);
+                if (addDirs & NORTHBIT) rotateLine(NORTH);
+                if (addDirs & WESTBIT)  rotateLine(WEST);
+                if (addDirs & EASTBIT)  rotateLine(EAST);
+            }
+        }
+    }
+
+    void PuzzleStone::animcb() {
+        KillStone(get_pos());
+    }
+    
+    bool PuzzleStone::is_transparent(Direction d) const {
+        return objFlags & OBJBIT_HOLLOW;
+    }
+    
+    bool PuzzleStone::is_sticky(const Actor *a) const {
+        return !(objFlags & OBJBIT_HOLLOW);
+    }
+    
+    bool PuzzleStone::allowsSpreading(Direction dir) const {
+        return objFlags & OBJBIT_HOLLOW;
+    }
+
+    bool PuzzleStone::is_removable() const {
+        return state == IDLE;
+    }
+    
+    bool PuzzleStone::isConnectable(Stone *other) const {
+        return Stone::isConnectable(other) && (other->getAttr("color") == getAttr("color"));
+    }
+    
+    StoneResponse PuzzleStone::collision_response(const StoneContact &sc) {
+        if ((objFlags & OBJBIT_HOLLOW) || state == EXPLODING)
+            return STONE_PASS;
+        return STONE_REBOUND;
+    }
+
+    void PuzzleStone::actor_hit(const StoneContact &sc) {
+        if (objFlags & OBJBIT_HOLLOW)
+            return;                 // Puzzle stone is hollow
+    
+        if (state != IDLE)
+            return;
+    
+        Direction rotate_dir = reverse(contact_face(sc));
+        Direction move_dir = get_push_direction(sc);
+    
+        if (getAttr("color") == YELLOW) {
+            if (explodeCluster())
+                return;
+    
+            // 1) If unconnected puzzle stones -> try to move it
+            if ((objFlags & OBJBIT_SINGLE) && move_dir != NODIR) {
+                // if cluster contains single stone
+                // -> move it if dest pos is free
+                GridPos dest = move(get_pos(), move_dir);
+                if (GetStone(dest) == NULL) {
+                    Stone *puzz = YieldStone(get_pos());
+                    SetStone(dest, puzz);
+                    puzz->on_move();
+                    sound_event ("movesmall");
+                } else
+                    rotateLine(rotate_dir);
+            } 
+            // 2) If more than one stone, 
+            else 
+                rotateLine(rotate_dir);
+        }
+        else {
+            // BLUE
+            bool has_magic_wand = player::WieldedItemIs (sc.actor, "it_magicwand");
+    
+            // 1) Try to start explosion of complete cluster
+            if (has_magic_wand && explodeCluster())
+                return;
+    
+            // 2) Failed? Try to move the cluster
+            if (move_dir != NODIR && moveCluster(true, move_dir, true)) {
+                sc.actor->send_impulse(get_pos(), move_dir);
+                return;
+            }
+    
+            // 3) Last chance: try to rotate the row or column 
+            if (has_magic_wand) {
+                rotateLine(rotate_dir);
+            }
+        }
+    }
+    
+    void PuzzleStone::actor_contact (Actor *a) {
+        if (state == EXPLODING || state == IGNITED)
+            SendMessage(a, "shatter");
+    }
+    
+    void PuzzleStone::on_impulse(const Impulse& impulse) {
+        if (state == IDLE) {
+            bool    actor_with_wand = false;
+            if (Actor *ac = dynamic_cast<Actor*>(impulse.sender)) 
+                actor_with_wand = player::WieldedItemIs(ac, "it_magicwand");
+    
+            moveCluster(!actor_with_wand, impulse.dir);
+        }
+    }
+
+    void PuzzleStone::on_move() {
+        if (!(objFlags & OBJBIT_HOLLOW)) 
+            ShatterActorsInsideField (get_pos());
+    }
+    
+    void PuzzleStone::alarm() {
+        explodeStone();
+    }
+    
+    void PuzzleStone::markPuzzle(bool visited) {
+        if (visited != (bool)(objFlags & OBJBIT_VISITED))
+            objFlags ^= OBJBIT_VISITED;
+    }
+    
+    void PuzzleStone::markList(PuzzleList &list, bool visited) {
+        for (PuzzleList::iterator itr = list.begin(); itr != list.end(); ++itr)
+            (*itr)->markPuzzle(visited);
+    }
+    
+    bool PuzzleStone::checkConnected(PuzzleList &todo, PuzzleStone * source, Direction dir, int color) {
+        GridPos newpos = move(source->get_pos(), dir);
+        PuzzleStone *pz = dynamic_cast<PuzzleStone*>(GetStone(newpos));
+    
+        if ((pz ==  NULL) || (pz->getAttr("color") != color))
+            return false;
+    
+        DirectionBits cfaces = pz->getConnections();
+    
+        if (has_dir(cfaces, reverse(dir))) {
+            // Puzzle stone at newpos is connected to stone at curpos
+            if (!(pz->objFlags & OBJBIT_VISITED)) {
+                pz->markPuzzle(true);
+                todo.push_back(pz);
+            }
+            return true;
+        } else {
+            // The two stones are adjacent but not connected
+            return false;
+        }
+    }
+    
+    bool PuzzleStone::findFragment(PuzzleList &cluster, bool keepMarked) {
+        // Use a depth first search to determine the group of all stones that
+        //   are connected to the current stone.  Returns true if the cluster is
+        //``complete'' in the sense defined above.
+
+        bool is_complete = true;
+        PuzzleList todo;
+        todo.push_back(this);
+        markPuzzle(true);
+        int color = getAttr("color");
+    
+        while (!todo.empty()) {
+            PuzzleStone *pz = todo.back();
+            todo.pop_back();
+        
+            cluster.push_back(pz);
+            DirectionBits cfaces = pz->getConnections();
+    
+            if (has_dir(cfaces, NORTH))
+                is_complete &= checkConnected(todo, pz, NORTH, color);
+            if (has_dir(cfaces, EAST))
+                is_complete &= checkConnected(todo, pz, EAST, color);
+            if (has_dir(cfaces, SOUTH))
+                is_complete &= checkConnected(todo, pz, SOUTH, color);
+            if (has_dir(cfaces, WEST))
+                is_complete &= checkConnected(todo, pz, WEST, color);
+        }
+        
+        if (!keepMarked)
+            markList(cluster, false);
+        return is_complete;
+    }
+
+    bool PuzzleStone::checkNeighbor(PuzzleList &todo, PuzzleStone *source, Direction dir, int color) {
+        GridPos newpos = move(source->get_pos(), dir);
+        if (PuzzleStone *pz = dynamic_cast<PuzzleStone*>(GetStone(newpos))) {
+            if (!(pz->objFlags & OBJBIT_VISITED) && (pz->getAttr("color") == color)) {
+                pz->markPuzzle(true);
+                todo.push_back(pz);
+            }
+        }
+    }
+    
+    bool PuzzleStone::findAdjacents(PuzzleList &huddle) {    
+        PuzzleList todo;
+        todo.push_back(this);
+        markPuzzle(true);
+        int color = getAttr("color");
+    
+        while (!todo.empty()) {
+            PuzzleStone *pz = todo.back();
+            todo.pop_back();
+    
+            huddle.push_back(pz);
+            checkNeighbor(todo, pz, NORTH, color);
+            checkNeighbor(todo, pz, SOUTH, color);
+            checkNeighbor(todo, pz, EAST, color);
+            checkNeighbor(todo, pz, WEST, color);
+        }
+        markList(huddle, false);
+    }
+        
+    int PuzzleStone::findLine(PuzzleList &line, Direction dir, int color) {
+        ASSERT(dir != NODIR, XLevelRuntime,
+            "PuzzleStone: no direction in find_row_or_column_cluster");
+        
+        int size = 0;
+        GridPos p = get_pos();
+        while (PuzzleStone *puzz = dynamic_cast<PuzzleStone*>(GetStone(p))) {
+            if (puzz->getAttr("color") != color)
+                break; // stop when an unrequested puzzle stone type is readed
+            line.push_back(puzz);
+            p.move(dir);
+            size += 1;
+        }
+        return size;
+    }
+
+    bool PuzzleStone::moveCluster(bool waterSink, Direction dir, bool checkOnly) {
+        PuzzleList cluster;
+        bool isComplete = findFragment(cluster, true);
+        
+        // Now check whether all stones can be placed at their new position
+        bool move_ok = true;
+        for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
+            Stone *st = GetStone(move((*itr)->get_pos(), dir));
+            if (st != NULL) {
+                // check if is the stone at destination a part of the cluster
+                PuzzleStone *pz = dynamic_cast<PuzzleStone*>(st);
+                if ((pz == NULL) || !(pz->objFlags & OBJBIT_VISITED)) {
+                    move_ok = false;
+                    break;
+                }
+            }
+        }
+        
+        markList(cluster, false);
+        if (checkOnly || !move_ok) {
+            return move_ok;
+        }
+        
+        // If the floor at a complete cluster's new position consists
+        // exclusively of abyss or water, create a bridge instead of
+        // moving the cluster.
+        //
+        // For partial clusters build bridges only on water and if the
+        // wielded item is NOT the magic wand.
+    
+        bool createBridge = true;
+    
+        for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
+            if (Floor *fl = GetFloor(move((*itr)->get_pos(), dir))) {
+                if (!((fl->is_kind("fl-abyss") && isComplete) || (fl->is_kind("fl-water") && (isComplete || waterSink)))) {
+                    createBridge = false;
+                    break;
+                }
+            }
+        }
+        
+        // Finally, either move the whole cluster or create a bridge
+        sound_event("movebig");
+        int size = cluster.size();
+        
+        if (createBridge) {
+            for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
+                SetFloor(move((*itr)->get_pos(), dir), MakeFloor("fl-gray"));
+                KillStone((*itr)->get_pos());
+            }
+        } 
+        else {
+            for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
+               (*itr)->sourcePos = (*itr)->get_pos();
+               YieldStone((*itr)->sourcePos);
+            }
+    
+            for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
+                SetStone(move((*itr)->sourcePos, dir), *itr);
+                (*itr)->on_move();
+            }
+        }
+        server::IncMoveCounter(size);
+        return true;
+    }
+    
+    bool PuzzleStone::explodeCluster() {
+        bool exploded = false;
+
+        PuzzleList cluster;
+        if (findFragment(cluster)) {
+            PuzzleList huddle;
+            findAdjacents(huddle);
+    
+            // If all adjacent stones build one complete cluster explode it
+//            Log << "Huddle " << huddle.size() << " Cluster "<< cluster.size() << "\n";
+            if (huddle.size() == cluster.size()) {
+                exploded = true;
+            }
+            else {
+                if (getAttr("color") == BLUE) {
+                    // check if 'huddle' is made up of complete clusters :
+    
+                    while (!huddle.empty()) {
+                        // remove one complete cluster from 'huddle'
+                        markList(cluster, true);
+                        for (PuzzleList::iterator itr = huddle.begin(); itr != huddle.end(); ) {
+                            if ((*itr)->objFlags & OBJBIT_VISITED) {
+                                (*itr)->objFlags &= ~OBJBIT_VISITED;
+                                PuzzleList::iterator ditr = itr;
+                                ++itr;
+                                huddle.erase(ditr);
+                            } else
+                               ++itr;
+                        }
+                            
+                        if (huddle.empty()) { // none left -> all were complete
+                            exploded = true;
+                            break;
+                        }
+    
+                        // look for next complete cluster :
+                        cluster.clear();
+                        PuzzleStone *pz = huddle.front();
+                        if (!pz->findFragment(cluster)) {
+                            break; // incomplete cluster found -> don't explode
+                        }
+                    }
+                }
+            }
+        }
+        
+        if (exploded) {
+            if (getAttr("color") == BLUE)
+                findAdjacents(cluster);
+            else
+                findFragment(cluster);
+            for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr)
+                (*itr)->state = PENDING;
+            explodeStone();
+        } else if (getAttr("color") == YELLOW){
+            if (cluster.size() == 1)
+                objFlags |= OBJBIT_SINGLE;
+            else
+                objFlags &= ~OBJBIT_SINGLE;
+        }
+        
+        return exploded;
+    }
+    
+    void PuzzleStone::explodeStone() {
+        GridPos p = get_pos();
+        int color = getAttr("color");
+    
+        // exchange puzzle stone with explosion
+        sound_event("stonedestroy");
+        state = EXPLODING;
+        init_model();
+    
+        // trigger all adjacent puzzle stones :
+        const double DEFAULT_DELAY = 0.2;
+        triggerExplosion(move(p, NORTH), DEFAULT_DELAY, color);
+        triggerExplosion(move(p, SOUTH), DEFAULT_DELAY, color);
+        triggerExplosion(move(p, EAST),  DEFAULT_DELAY, color);
+        triggerExplosion(move(p, WEST),  DEFAULT_DELAY, color);
+    }
+    
+    void PuzzleStone::triggerExplosion(GridPos p, double delay, int color) {
+        PuzzleStone *puzz = dynamic_cast<PuzzleStone*>(GetStone(p));
+        if (puzz && puzz->state == PENDING && puzz->getAttr("color") == color ) {
+            // explode adjacent puzzle stones of same type
+            puzz->ignite(delay);
+        }
+    }
+    
+    void PuzzleStone::ignite(double delay) {
+        if (state == PENDING) {
+            state = IGNITED;
+            GameTimer.set_alarm(this, delay, false);
+        }
+    }
+    
+    void PuzzleStone::rotateLine(PuzzleList &line, bool forward) {
+        PuzzleList::iterator itr = line.begin();
+        PuzzleStone *pz1 = *itr;
+        ++itr;
+        if (itr != line.end()) {
+            GridPos p1 = pz1->get_pos();
+            YieldStone(p1);
+            for (; itr != line.end(); ++itr) {
+                if (forward) {
+                    PuzzleStone *pz2 = *itr;
+                    GridPos p2 = pz2->get_pos();
+                    YieldStone(p2);
+                    SetStone(p2, pz1);
+                    pz1 = pz2; 
+                } else {
+                    PuzzleStone *pz2 = *itr;
+                    GridPos p2 = pz2->get_pos();
+                    YieldStone(p2);
+                    SetStone(p1, pz2);
+                    p1 = p2; 
+                }
+            }
+            SetStone(p1, pz1);
+        }
+    }
+    
+    void PuzzleStone::rotateLine(Direction dir, bool forward) {
+        if (dir != NODIR) {
+            PuzzleList line;
+            int size = findLine(line, dir, (int)getAttr("color"));
+            if (size >= 2) {
+                rotateLine(line, forward);
+            }
+        }
+    }
+
+    DEF_TRAITSM(PuzzleStone, "st_puzzle", st_puzzle, MOVABLE_IRREGULAR);
+    
+    BOOT_REGISTER_START
+        BootRegister(new PuzzleStone(BLUE, ""), "st_puzzle");
+        BootRegister(new PuzzleStone(BLUE, ""), "st_puzzle_blue");
+        BootRegister(new PuzzleStone(YELLOW, ""), "st_puzzle_yellow");
+        BootRegister(new PuzzleStone(BLUE, "w"),   "st_puzzle_blue_w");
+        BootRegister(new PuzzleStone(BLUE, "s"),   "st_puzzle_blue_s");
+        BootRegister(new PuzzleStone(BLUE, "sw"),  "st_puzzle_blue_sw");
+        BootRegister(new PuzzleStone(BLUE, "e"),   "st_puzzle_blue_e");
+        BootRegister(new PuzzleStone(BLUE, "ew"),  "st_puzzle_blue_ew");
+        BootRegister(new PuzzleStone(BLUE, "es"),  "st_puzzle_blue_es");
+        BootRegister(new PuzzleStone(BLUE, "esw"), "st_puzzle_blue_esw");
+        BootRegister(new PuzzleStone(BLUE, "n"),   "st_puzzle_blue_n");
+        BootRegister(new PuzzleStone(BLUE, "nw"),  "st_puzzle_blue_nw");
+        BootRegister(new PuzzleStone(BLUE, "ns"),  "st_puzzle_blue_ns");
+        BootRegister(new PuzzleStone(BLUE, "nsw"), "st_puzzle_blue_nsw");
+        BootRegister(new PuzzleStone(BLUE, "ne"),  "st_puzzle_blue_ne");
+        BootRegister(new PuzzleStone(BLUE, "new"), "st_puzzle_blue_new");
+        BootRegister(new PuzzleStone(BLUE, "nes"), "st_puzzle_blue_nes");
+        BootRegister(new PuzzleStone(BLUE, "nesw"), "st_puzzle_blue_nesw");
+        BootRegister(new PuzzleStone(BLUE, "nesw", true), "st_puzzle_blue_nesw_hollow");
+        BootRegister(new PuzzleStone(YELLOW, "w"),   "st_puzzle_yellow_w");
+        BootRegister(new PuzzleStone(YELLOW, "s"),   "st_puzzle_yellow_s");
+        BootRegister(new PuzzleStone(YELLOW, "sw"),  "st_puzzle_yellow_sw");
+        BootRegister(new PuzzleStone(YELLOW, "e"),   "st_puzzle_yellow_e");
+        BootRegister(new PuzzleStone(YELLOW, "ew"),  "st_puzzle_yellow_ew");
+        BootRegister(new PuzzleStone(YELLOW, "es"),  "st_puzzle_yellow_es");
+        BootRegister(new PuzzleStone(YELLOW, "esw"), "st_puzzle_yellow_esw");
+        BootRegister(new PuzzleStone(YELLOW, "n"),   "st_puzzle_yellow_n");
+        BootRegister(new PuzzleStone(YELLOW, "nw"),  "st_puzzle_yellow_nw");
+        BootRegister(new PuzzleStone(YELLOW, "ns"),  "st_puzzle_yellow_ns");
+        BootRegister(new PuzzleStone(YELLOW, "nsw"), "st_puzzle_yellow_nsw");
+        BootRegister(new PuzzleStone(YELLOW, "ne"),  "st_puzzle_yellow_ne");
+        BootRegister(new PuzzleStone(YELLOW, "new"), "st_puzzle_yellow_new");
+        BootRegister(new PuzzleStone(YELLOW, "nes"), "st_puzzle_yellow_nes");
+        BootRegister(new PuzzleStone(YELLOW, "nesw"), "st_puzzle_yellow_nesw");
+        BootRegister(new PuzzleStone(YELLOW, "nesw", true), "st_puzzle_yellow_nesw_hollow");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/PuzzleStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/PuzzleStone.hh
===================================================================
--- trunk/src/stones/PuzzleStone.hh	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/stones/PuzzleStone.hh	2008-09-13 14:51:32 UTC (rev 1317)
@@ -0,0 +1,140 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef PUZZLESTONE_HH
+#define PUZZLESTONE_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     *  Puzzle stones can be connected to other stones of the same type.  Any
+     *  of the four faces of the stone can have ``socket''.  If the adjoining
+     *  faces of two neighboring stones both have a socket, the two stones
+     *  link up and henceforth move as group.
+     *  
+     *  A cluster of puzzle stones may for example look like this:
+     *  
+     *  +---+---+---+---+
+     *  |   |   |   |   |
+     *  | --+-+-+---+-+ |
+     *  |   | | |   | | |
+     *  +---+-+-+---+-+-+
+     *      | | |   | | |
+     *      | | |   | | |
+     *      |   |   |   |
+     *      +---+   +---+
+     *  
+     *  This example actually presents the special case of a ``complete''
+     *  cluster.  A cluster is complete if none of its stones has an
+     *  unconnected socket.
+     *  
+     *  When touched with a magic wand the puzzle stones rotate
+     *  row- or columnwise.
+     *   
+     * fragment = connected
+     * cluster = connected and complete
+     * huddle  = adjacent
+     */
+    class PuzzleStone : public Stone, public TimeHandler {
+        CLONEOBJ(PuzzleStone);
+        DECL_TRAITS;
+        
+    private:
+        enum iState {
+            IDLE,       ///<
+            PENDING,    ///<  a cluster gets locked on a pending explosion to avoid further actions
+            IGNITED,    ///< 
+            EXPLODING   ///< 
+        };
+
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_INIT     =   1<<24,   ///< we cluster just on first grid set and mark initialization
+            OBJBIT_HOLLOW   =   1<<25,   ///< 
+            OBJBIT_VISITED  =   1<<26,   ///< 
+            OBJBIT_SINGLE   =   1<<27    ///< a single, unconnected stone - flag is continuously not updated! 
+        };
+        
+        typedef std::list<PuzzleStone *> PuzzleList;
+
+    public:
+        PuzzleStone(int color, std::string connections, bool hollow = false);
+        virtual ~PuzzleStone();
+        
+        // Object interface
+        virtual std::string getClass() const;
+        virtual void setAttr(const string& key, const Value &val);
+        virtual Value getAttr(const std::string &key) const;
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+//        virtual int externalState() const;
+        virtual void setState(int extState);
+//        virtual void toggleState();
+
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+        virtual void init_model();
+        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
+        
+        // ModelCallback interface  - Animation callback
+        virtual void animcb();
+
+        // Stone interface
+        virtual bool isConnectable(Stone *other) const;
+        virtual void on_impulse(const Impulse& impulse);
+        virtual void on_move();
+        virtual bool is_sticky(const Actor *a) const;
+        virtual bool is_transparent(Direction d) const;
+        virtual bool allowsSpreading(Direction dir) const;
+        virtual bool is_removable() const;        
+        virtual StoneResponse collision_response(const StoneContact &sc);
+        virtual void actor_hit(const StoneContact &sc);
+        virtual void actor_contact(Actor *a);
+        
+        // TimeHandler interface
+        virtual void alarm();
+        
+    private:
+        void markPuzzle(bool visited);
+        void markList(PuzzleList &list, bool visited);
+        bool checkConnected(PuzzleList &todo, PuzzleStone *source, Direction dir, int color);
+        bool findFragment(PuzzleList &cluster, bool keepMarked = false);
+        bool checkNeighbor(PuzzleList &todo, PuzzleStone *source, Direction dir, int color);
+        bool findAdjacents(PuzzleList &huddle);
+        int  findLine(PuzzleList &line, Direction dir, int color);
+        
+        bool moveCluster(bool waterSink, Direction dir, bool checkOnly = false);
+        bool explodeCluster();
+        void explodeStone();
+        void triggerExplosion(GridPos p, double delay, int color);
+        void ignite(double delay);
+        void rotateLine(PuzzleList &line, bool forward = true);
+        void rotateLine(Direction dir, bool forward = true);
+        
+        // volatile:
+        GridPos sourcePos;   // source position on move
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/PuzzleStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/stones.cc	2008-09-13 14:51:32 UTC (rev 1317)
@@ -174,6 +174,47 @@
     return newvel * factor;
 }
 
+/* -------------------- Cluster routines -------------------- */
+    void Stone::autoJoinCluster() {
+        GridPos p = get_pos();
+        Value myCluster = getAttr("cluster");
+        for (int i = WEST; i <= NORTH; i++) {
+            Direction d = (Direction) i;
+            Stone *neighbour = GetStone(move(p, d));
+            if (isConnectable(neighbour)) {
+                Value neighbourCluster = neighbour->getAttr("cluster");
+                if (myCluster) {
+                    if (myCluster == neighbourCluster) {
+                        setAttr("$connections", getConnections() | to_bits(d));
+                        neighbour->setAttr("$connections", neighbour->getConnections() | to_bits(reverse(d)));
+                    } else if (!neighbourCluster && neighbour->getConnections() & to_bits(reverse(d))) {
+                        setAttr("$connections", getConnections() | to_bits(d));
+                    } else {
+                        setAttr("$connections", getConnections() & (ALL_DIRECTIONS ^ to_bits(d))); // clear connection
+                    }
+                } else if (neighbourCluster)  {// I have fixed connections -> adapt neighbour
+                    if (getConnections() & to_bits(d))
+                        neighbour->setAttr("$connections", neighbour->getConnections() | to_bits(reverse(d)));
+                    else
+                        neighbour->setAttr("$connections", neighbour->getConnections() & (ALL_DIRECTIONS ^ to_bits(reverse(d))));
+                }
+            } else if (myCluster) { // no neighbour -> no connection
+                setAttr("$connections", getConnections() & (ALL_DIRECTIONS ^ to_bits(d))); // clear connection
+            }
+        }
+    }
+    
+    void Stone::autoLeaveCluster() {
+        GridPos p = get_pos();
+        for (int i = WEST; i <= NORTH; i++) {
+            Direction d = (Direction) i;
+            Stone *neighbour = GetStone(move(p, d));
+            if (isConnectable(neighbour) && neighbour->getAttr("cluster")) {
+                neighbour->setAttr("$connections", neighbour->getConnections() & (ALL_DIRECTIONS ^ to_bits(reverse(d))));
+            }
+        }
+    }
+
 /* -------------------- Freeze check routines -------------------- */
 
 FreezeStatusBits Stone::get_freeze_bits() {

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/stones.hh	2008-09-13 14:51:32 UTC (rev 1317)
@@ -209,6 +209,10 @@
         virtual bool allowsSpreading(Direction dir) const {
             return is_floating();
         }
+        
+        virtual bool isConnectable(Stone *other) const {
+            return other != NULL && std::string(other->getClass()) == getClass();
+        }
 
         /* ---------- Stone interface (events) ---------- */
 
@@ -230,6 +234,11 @@
         bool move_stone(GridPos newPos, const char *soundevent);
         bool move_stone(Direction dir);
         ecl::V2 distortedVelocity (ecl::V2 vel, double defaultfactor);
+        
+        // Cluster support
+        void autoJoinCluster();
+        void autoLeaveCluster();
+        
 
     protected:
         // GridObject interface

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/stones_complex.cc	2008-09-13 14:51:32 UTC (rev 1317)
@@ -25,7 +25,6 @@
 #include "player.hh"
 #include "Inventory.hh"
 #include "stones_internal.hh"
-#include "stones/ConnectiveStone.hh"
 #include "actors.hh"
 #include "main.hh"
 #include "Value.hh"
@@ -39,669 +38,6 @@
 
 namespace enigma { 
 
-
-///* -------------------- Puzzle stones -------------------- */ 
-
-/** \page st-puzzle Puzzle Stone
-
-Puzzle stones can be connected to other stones of the same type.  Any
-of the four faces of the stone can have ``socket''.  If the adjoining
-faces of two neighboring stones both have a socket, the two stones
-link up and henceforth move as group.
-
-A cluster of puzzle stones may for example look like this:
-
-\verbatim
-+---+---+---+---+
-|   |   |   |   |
-| --+-+-+---+-+ |
-|   | | |   | | |
-+---+-+-+---+-+-+
-    | | |   | | |
-    | | |   | | |
-    |   |   |   |
-    +---+   +---+
-\endverbatim
-
-This example actually presents the special case of a ``complete''
-cluster.  A cluster is complete if none of its stones has an
-unconnected socket.
-
-When touched with a magic wand the puzzle stones rotate
-row- or columnwise.  
-
-\subsection puzzlea Attributes
-
-- \b connections
-   number between 1 an 16.  Each bit in (connections-1) corresponds to
-   a socket on one of the four faces.  You will normally simply use
-   one of the Lua constants \c PUZ_0000 to \c PUZ_1111.
-
-- \b oxyd
-   If 1 then the puzzle stones act oxyd-compatible: Complete clusters
-   explode, when they get touched. All other puzzle stones rotate row-
-   or columnwise. Groups of oxyd-compatible puzzle stones are shuffled
-   randomly at level startup.
-
-\subsection puzzlee Example
-<table>
-<tr>
-<td> \image html st-puzzletempl_0001.png "PUZ_0000"
-<td> \image html st-puzzletempl_0002.png "PUZ_0001"
-<td> \image html st-puzzletempl_0003.png "PUZ_0010"
-<td> \image html st-puzzletempl_0004.png "PUZ_0011"
-<tr>
-<td> \image html st-puzzletempl_0005.png "PUZ_0100"
-<td> \image html st-puzzletempl_0006.png "PUZ_0101"
-<td> \image html st-puzzletempl_0007.png "PUZ_0110"
-<td> \image html st-puzzletempl_0008.png "PUZ_0111"
-<tr>
-<td> \image html st-puzzletempl_0009.png "PUZ_1000"
-<td> \image html st-puzzletempl_0010.png "PUZ_1001"
-<td> \image html st-puzzletempl_0011.png "PUZ_1010"
-<td> \image html st-puzzletempl_0012.png "PUZ_1011"
-<tr>
-<td> \image html st-puzzletempl_0013.png "PUZ_1100"
-<td> \image html st-puzzletempl_0014.png "PUZ_1101"
-<td> \image html st-puzzletempl_0015.png "PUZ_1110"
-<td> \image html st-puzzletempl_0016.png "PUZ_1111"
-</tr>
-</table>
-*/
-namespace
-{
-    class PuzzleStone : public ConnectiveStone, public TimeHandler {
-        INSTANCELISTOBJ(PuzzleStone);
-        DECL_TRAITS;
-    public:
-        PuzzleStone(int connections, bool oxyd1_compatible_);  
-        
-        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
-        virtual bool is_transparent(Direction d) const;
-        virtual bool is_sticky(const Actor *a) const;
-        virtual bool allowsSpreading(Direction dir) const;
-        virtual void on_move();
-    protected:
-        virtual ~PuzzleStone() {
-            GameTimer.remove_alarm (this);
-        }     
-    private:
-        typedef vector<GridPos> Cluster;
-
-        /* ---------- Private methods ---------- */
-
-        bool oxyd1_compatible() const { return getAttr("oxyd") != 0; }
-
-        static bool visit_dir(vector<GridPos> &stack, GridPos curpos,
-                              Direction dir, int wanted_oxyd_attrib);
-        static void visit_adjacent(vector<GridPos>& stack, GridPos curpos,
-                                   Direction dir, int wanted_oxyd_attrib);
-
-        bool find_cluster(Cluster &);
-        void find_adjacents(Cluster &);
-        void find_row_or_column_cluster(Cluster &c, GridPos startpos,
-                                        Direction  dir, int wanted_oxyd_attrib);
-
-        bool cluster_complete();
-        bool can_move_cluster (Cluster &c, Direction dir);
-        void maybe_move_cluster(Cluster &c, bool is_complete, bool actor_with_wand, 
-                                Direction dir);
-        void rotate_cluster(const Cluster &c);
-        void maybe_rotate_cluster(Direction dir);
-
-        int get_modelno() const;
-
-        void        trigger_explosion(double delay);
-        static void trigger_explosion_at(GridPos p, double delay, int wanted_oxyd_attrib);
-        void        explode();
-        bool        explode_complete_cluster();
-
-        /* ---------- TimeHandler interface ---------- */
-
-        void alarm();
-
-        /* ---------- Stone interface ---------- */
-
-        virtual Value message(const Message &m);
-
-        void on_creation (GridPos p);
-        void on_impulse (const Impulse& impulse);
-
-        StoneResponse collision_response(const StoneContact &sc);
-        void actor_hit (const StoneContact &sc);
-        void actor_contact (Actor *a);
-
-        /* ---------- Variables ---------- */
-        bool visited;           // flag for DFS
-        enum { IDLE, EXPLODING } state;
-    };
-    DEF_TRAITSM(PuzzleStone, "st-puzzle", st_puzzle, MOVABLE_IRREGULAR);
-}
-
-PuzzleStone::InstanceList PuzzleStone::instances;
-
-PuzzleStone::PuzzleStone(int connections, bool oxyd1_compatible_) : ConnectiveStone(connections), 
-  state (IDLE)
-//  illumination (NODIRBIT)
-{
-    setAttr("oxyd", int(oxyd1_compatible_));
-}
-
-
-bool PuzzleStone::visit_dir(vector<GridPos> &stack, GridPos curpos, 
-        Direction dir, int wanted_oxyd_attrib)
-{
-    GridPos newpos = move(curpos, dir);
-    PuzzleStone *pz = dynamic_cast<PuzzleStone*>(GetStone(newpos));
-
-    if ((!pz) || (wanted_oxyd_attrib != (int)pz->getAttr("oxyd")))
-        return false;
-
-    DirectionBits cfaces = pz->get_connections();
-
-    if (cfaces==NODIRBIT || has_dir(cfaces, reverse(dir))) {
-        // Puzzle stone at newpos is connected to stone at curpos
-        if (!pz->visited) {
-            pz->visited = true;
-            stack.push_back(newpos);
-        }
-        return true;
-    } else {
-        // The two stones are adjacent but not connected
-        return false;
-    }
-}
-
-/* Use a depth first search to determine the group of all stones that
-   are connected to the current stone.  Returns true if the cluster is
-   ``complete'' in the sense defined above. */
-bool PuzzleStone::find_cluster(Cluster &cluster) {
-    for (unsigned i=0; i<instances.size(); ++i)
-        instances[i]->visited=false;
-
-    vector<GridPos> pos_stack;
-    bool is_complete = true;
-    pos_stack.push_back(get_pos());
-    this->visited = true;
-    int wanted_oxyd_attrib = getAttr("oxyd");
-
-    while (!pos_stack.empty())
-    {
-        GridPos curpos = pos_stack.back();
-        pos_stack.pop_back();
-
-        PuzzleStone *pz = dynamic_cast<PuzzleStone*>(GetStone(curpos));
-        ASSERT(pz, XLevelRuntime, "PuzzleStone: missing stone in find_cluster");
-
-        cluster.push_back(curpos);
-        DirectionBits cfaces = pz->get_connections();
-
-        if (cfaces==NODIRBIT)
-            cfaces = DirectionBits(NORTHBIT | SOUTHBIT | EASTBIT | WESTBIT);
-
-        if (has_dir(cfaces, NORTH))
-            is_complete &= visit_dir(pos_stack, curpos, NORTH, wanted_oxyd_attrib);
-        if (has_dir(cfaces, EAST))
-            is_complete &= visit_dir(pos_stack, curpos, EAST, wanted_oxyd_attrib);
-        if (has_dir(cfaces, SOUTH))
-            is_complete &= visit_dir(pos_stack, curpos, SOUTH, wanted_oxyd_attrib);
-        if (has_dir(cfaces, WEST))
-            is_complete &= visit_dir(pos_stack, curpos, WEST, wanted_oxyd_attrib);
-    }
-    return is_complete;
-}
-
-void PuzzleStone::visit_adjacent (vector<GridPos>& stack, GridPos curpos, 
-                                  Direction dir, int wanted_oxyd_attrib)
-{
-    GridPos newpos = move(curpos, dir);
-    if (PuzzleStone *pz = dynamic_cast<PuzzleStone*>(GetStone(newpos))) {
-        if (!pz->visited) {
-            if (wanted_oxyd_attrib == (int)pz->getAttr("oxyd")) {
-                pz->visited = true;
-                stack.push_back(newpos);
-            }
-        }
-    }
-}
-
-/* Use a depth first search to determine the group of all puzzle stones
-   with the same "oxyd" attrib that are adjacent to the current stone
-   (or to any other member of the group).
-*/
-void PuzzleStone::find_adjacents(Cluster &cluster) {
-    for (unsigned i=0; i<instances.size(); ++i)
-        instances[i]->visited=false;
-
-    vector<GridPos> pos_stack;
-    pos_stack.push_back(get_pos());
-    this->visited = true;
-
-    int wanted_oxyd_attrib = getAttr("oxyd");
-
-    while (!pos_stack.empty()) {
-        GridPos curpos = pos_stack.back();
-        pos_stack.pop_back();
-
-        cluster.push_back(curpos);
-        visit_adjacent(pos_stack, curpos, NORTH, wanted_oxyd_attrib);
-        visit_adjacent(pos_stack, curpos, SOUTH, wanted_oxyd_attrib);
-        visit_adjacent(pos_stack, curpos, EAST, wanted_oxyd_attrib);
-        visit_adjacent(pos_stack, curpos, WEST, wanted_oxyd_attrib);
-    }
-}
-
-/* searches from 'startpos' into 'dir' for puzzle-stones.
-   wanted_oxyd_attrib == -1 -> take any puzzle stone
-                      else  -> take only puzzle stones of same type
-*/
-
-void PuzzleStone::find_row_or_column_cluster(Cluster &c, GridPos startpos, 
-                                             Direction dir, int wanted_oxyd_attrib)
-{
-    ASSERT(dir != NODIR, XLevelRuntime,
-        "PuzzleStone: no direction in find_row_or_column_cluster");
-
-    GridPos p = startpos;
-    while (Stone *puzz = dynamic_cast<PuzzleStone*>(GetStone(p))) {
-        if (wanted_oxyd_attrib != -1 && wanted_oxyd_attrib != (int)puzz->getAttr("oxyd"))
-            break; // stop when an unrequested puzzle stone type is readed
-        c.push_back(p);
-        p.move(dir);
-    }
-}
-
-bool PuzzleStone::can_move_cluster (Cluster &c, Direction dir)
-{
-    sort(c.begin(), c.end());
-    Cluster mc(c);              // Moved cluster
-    Cluster diff;               // Difference between mc and c
-
-    for (unsigned i=0; i<mc.size(); ++i)
-        mc[i].move(dir);
-
-    set_difference(mc.begin(), mc.end(), c.begin(), c.end(),
-                   back_inserter(diff));
-
-    // Now check whether all stones can be placed at their new
-    // position
-    bool move_ok = true;
-    for (unsigned i=0; i<diff.size(); ++i)
-        if (GetStone(diff[i]) != 0)
-            move_ok = false;
-
-    return move_ok;    
-}
-
-void PuzzleStone::maybe_move_cluster(Cluster &c, bool is_complete, 
-                                     bool actor_with_wand, Direction dir)
-{
-    sort(c.begin(), c.end());
-    Cluster mc(c);              // Moved cluster
-    Cluster diff;               // Difference between mc and c
-
-    for (unsigned i=0; i<mc.size(); ++i)
-        mc[i].move(dir);
-
-    set_difference(mc.begin(), mc.end(), c.begin(), c.end(),
-                   back_inserter(diff));
-
-    // Now check whether all stones can be placed at their new
-    // position
-    bool move_ok = true;
-    for (unsigned i=0; i<diff.size(); ++i)
-        if (GetStone(diff[i]) != 0)
-            move_ok = false;
-
-    if (!move_ok)
-        return;
-
-    // If the floor at a complete cluster's new position consists
-    // exclusively of abyss or water, create a bridge instead of
-    // moving the cluster.
-    //
-    // For partial clusters build bridges only on water and if the
-    // wielded item is NOT the magic wand.
-
-    bool create_bridge = true;
-
-    for (unsigned i=0; create_bridge && i<mc.size(); ++i) {
-        if (Floor *fl = GetFloor(mc[i])) {
-            if (fl->is_kind("fl-abyss")) {
-                if (!is_complete)
-                    create_bridge = false;
-            }
-            else if (fl->is_kind("fl-water")) {
-                if (!is_complete && actor_with_wand) 
-                    create_bridge = false;
-            }
-            else
-                create_bridge = false;
-        }
-    }
-
-    // Finally, either move the whole cluster or create a bridge
-    sound_event("movebig");
-    if (create_bridge) {
-        for (unsigned i=0; i<c.size(); ++i) {
-            KillStone(c[i]);
-            SetFloor(mc[i], MakeFloor("fl-gray"));
-        }
-    } 
-    else {
-        vector<Stone*> clusterstones;
-        for (unsigned i=0; i<c.size(); ++i)
-            clusterstones.push_back(YieldStone(c[i]));
-
-        for (unsigned i=0; i<c.size(); ++i) {
-            SetStone(mc[i], clusterstones[i]);
-            clusterstones[i]->on_move();
-        }
-    }
-
-    server::IncMoveCounter (static_cast<int> (c.size()));
-}
-
-bool PuzzleStone::cluster_complete() {
-    Cluster c;
-    return find_cluster(c);
-}
-
-int PuzzleStone::get_modelno() const {
-    int modelno = getAttr("connections");
-    if (oxyd1_compatible()) modelno += 16;
-    return modelno;
-}
-
-void PuzzleStone::rotate_cluster(const Cluster &c) {
-    size_t size = c.size();
-    if (size > 1) {
-        int cn = GetStone(c[size-1])->getAttr("connections");
-        for (size_t i=size-1; i>0; --i) {
-            PuzzleStone *st = dynamic_cast<PuzzleStone*> (GetStone (c[i]));
-            st->setAttr("connections", GetStone(c[i-1])->getAttr("connections"));
-            st->init_model();
-        }
-        GetStone(c[0])->setAttr("connections", cn);
-        dynamic_cast<PuzzleStone*> (GetStone(c[0]))->init_model();
-    }
-}
-
-StoneResponse PuzzleStone::collision_response(const StoneContact &/*sc*/) {
-    if (get_connections() == NODIRBIT)
-        return STONE_PASS;
-    return STONE_REBOUND;
-}
-
-void PuzzleStone::trigger_explosion(double delay) {
-    if (state == IDLE) {
-        state = EXPLODING;
-        GameTimer.set_alarm(this, delay, false);
-    }
-}
-
-void PuzzleStone::trigger_explosion_at (GridPos p, double delay,
-                                        int wanted_oxyd_attrib)
-{
-    PuzzleStone *puzz = dynamic_cast<PuzzleStone*>(GetStone(p));
-    if (puzz && wanted_oxyd_attrib == (int)puzz->getAttr("oxyd")) {
-        // explode adjacent puzzle stones of same type
-        puzz->trigger_explosion(delay);
-    }
-}
-
-void PuzzleStone::explode() {
-    GridPos p       = get_pos();
-    int     ox_attr = getAttr("oxyd");
-
-    // exchange puzzle stone with explosion
-    sound_event("stonedestroy");
-    SetStone(p, MakeStone("st-explosion"));
-
-    // trigger all adjacent puzzle stones :
-    const double DEFAULT_DELAY = 0.2;
-    trigger_explosion_at(move(p, NORTH), DEFAULT_DELAY, ox_attr);
-    trigger_explosion_at(move(p, SOUTH), DEFAULT_DELAY, ox_attr);
-    trigger_explosion_at(move(p, EAST),  DEFAULT_DELAY, ox_attr);
-    trigger_explosion_at(move(p, WEST),  DEFAULT_DELAY, ox_attr);
-
-    // @@@ FIXME: At the moment it's possible to push partial puzzle stones
-    // next to an already exploding cluster. Then the part will explode as well.
-    // Possible fix : mark whole cluster as "EXPLODING_SOON" when explosion is initiated
-
-    // ignite adjacent fields
-//     SendExplosionEffect(p, DYNAMITE);
-}
-
-void PuzzleStone::alarm() {
-    explode();
-}
-
-Value PuzzleStone::message(const Message &m) {
-    if (m.message == "scramble") {
-        // oxyd levels contain explicit information on how to
-        // scramble puzzle stones. According to that information
-        // a "scramble" message is send to specific puzzle stones
-        // together with information about the direction.
-        //
-        // enigma levels may create scramble messages using
-        // AddScramble() and SetScrambleIntensity()
-
-        Direction dir = to_direction(m.value);
-        Cluster   c;
-        find_row_or_column_cluster(c, get_pos(), dir, oxyd1_compatible());
-
-        size_t size = c.size();
-
-        // warning("received 'scramble'. dir=%s size=%i", to_suffix(dir).c_str(), size);
-
-        if (size >= 2) {
-            int count = IntegerRand(0, static_cast<int> (size-1));
-            while (count--)
-                rotate_cluster(c);
-        }
-        else {
-            warning("useless scramble (cluster size=%i)", size);
-        }
-        return Value();
-    }
-    return ConnectiveStone::message(m);
-}
-
-void PuzzleStone::on_impulse(const Impulse& impulse) 
-{
-//    if (!oxyd1_compatible() && state == IDLE) {
-    if (state == IDLE) {
-        Cluster c;
-        bool    is_complete     = find_cluster(c);
-        bool    actor_with_wand = false;
-
-        if (Actor *ac = dynamic_cast<Actor*>(impulse.sender)) 
-            actor_with_wand = player::WieldedItemIs (ac, "it_magicwand");
-
-        maybe_move_cluster(c, is_complete, actor_with_wand, impulse.dir);
-    }
-}
-
-bool PuzzleStone::explode_complete_cluster() 
-{
-    // @@@ FIXME: explode_complete_cluster should mark the whole cluster
-    // as "EXPLODING_SOON" (otherwise it may be changed before it explodes completely)
-
-    ASSERT(state == IDLE, XLevelRuntime,
-        "PuzzleStone: explode_complete_cluster called with inconsistent state");
-    bool exploded = false;
-
-    Cluster complete;
-    if (find_cluster(complete)) {
-        Cluster all;
-        find_adjacents(all);
-
-        // If all adjacent stones build one complete cluster explode it
-        if (all.size() == complete.size()) {
-            explode();          // explode complete cluster
-            exploded = true;
-        }
-        else {
-            ASSERT(all.size() > complete.size(), XLevelRuntime,
-                "PuzzleStone: sizes don't match in explode_complete_cluster");
-            if (!oxyd1_compatible()) {
-                // check if 'all' is made up of complete clusters :
-
-                sort(all.begin(), all.end());
-
-                while (1) {
-                    sort(complete.begin(), complete.end());
-
-                    // remove one complete cluster from 'all'
-                    {
-                        Cluster rest;
-                        set_symmetric_difference(all.begin(), all.end(),
-                                                 complete.begin(), complete.end(),
-                                                 back_inserter(rest));
-                        // now rest contains 'all' minus 'complete'
-                        swap(all, rest);
-                    }
-
-                    if (all.empty()) { // none left -> all were complete
-                        exploded = true;
-                        break;
-                    }
-
-                    // look for next complete cluster :
-                    complete.clear();
-                    {
-                        PuzzleStone *pz = dynamic_cast<PuzzleStone*>(GetStone(all[0]));
-                        ASSERT(pz, XLevelRuntime,
-                            "PuzzleStone: missing stone in explode_complete_cluster");
-                        if (!pz->find_cluster(complete)) {
-                            break; // incomplete cluster found -> don't explode
-                        }
-                    }
-                }
-
-                if (exploded) {
-//                     warning("exploding complete cluster");
-                    explode();
-                }
-            }
-        }
-    }
-
-    return exploded;
-}
-
-bool PuzzleStone::is_transparent(Direction d) const {
-    return get_connections() == 0;
-}
-
-bool PuzzleStone::is_sticky(const Actor *a) const {
-    return get_connections() != 0;
-}
-
-bool PuzzleStone::allowsSpreading(Direction dir) const {
-    return get_connections() == 0;
-}
-
-void PuzzleStone::on_move() {
-    if (get_connections() != 0) 
-        ShatterActorsInsideField (get_pos());
-}
-
-void PuzzleStone::maybe_rotate_cluster(Direction dir) 
-{
-    if (dir != NODIR) {
-        Cluster c;
-        find_row_or_column_cluster(c, get_pos(), dir, (int)getAttr("oxyd"));
-        if (c.size() >= 2) {
-//             warning("ok -> rotate");
-            rotate_cluster(c);
-        }
-    }
-}
-
-void PuzzleStone::on_creation (GridPos p) {
-    activatePhoto();
-    ConnectiveStone::on_creation (p);
-}
-
-
-void PuzzleStone::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
-    if (state == IDLE && newDirs != NODIRBIT) {
-        if (!explode_complete_cluster() && oxyd1_compatible()) {
-            if (newDirs & SOUTHBIT) maybe_rotate_cluster(SOUTH);
-            if (newDirs & NORTHBIT) maybe_rotate_cluster(NORTH);
-            if (newDirs & WESTBIT)  maybe_rotate_cluster(WEST);
-            if (newDirs & EASTBIT)  maybe_rotate_cluster(EAST);
-        }
-    }
-}
-
-void PuzzleStone::actor_hit(const StoneContact &sc) 
-{
-    if (get_connections() == NODIRBIT)
-        return;                 // Puzzle stone is hollow
-
-    if (state == EXPLODING)
-        return;
-
-    Cluster c;
-    find_cluster (c);
-
-    Direction rotate_dir = reverse (contact_face (sc));
-    Direction move_dir = get_push_direction(sc);
-
-    if (oxyd1_compatible()) {
-        // Oxyd 1
-
-        if (explode_complete_cluster())
-            return;
-
-        // 1) If unconnected puzzle stones -> try to move it
-        if (c.size() == 1 && move_dir != NODIR) {
-            // if cluster contains single stone
-            // -> move it if dest pos is free
-            GridPos dest = move(c[0], move_dir);
-            if (GetStone(dest) == 0) {
-                Stone *puzz = YieldStone(c[0]);
-                SetStone(dest, puzz);
-                puzz->on_move();
-                sound_event ("movesmall");
-            } else
-                maybe_rotate_cluster (rotate_dir);
-        } 
-        // 2) If more than one stone, 
-        else 
-            maybe_rotate_cluster (rotate_dir);
-    }
-    else {
-        // Not Oxyd 1
-
-        bool has_magic_wand = player::WieldedItemIs (sc.actor, "it_magicwand");
-
-        // 1) Try to start explosion of complete cluster
-        if (has_magic_wand && explode_complete_cluster())
-            return;
-
-        // 2) Failed? Try to move the cluster
-        if (move_dir != NODIR && can_move_cluster (c, move_dir)) {
-            sc.actor->send_impulse(get_pos(), move_dir);
-            return;
-        }
-
-        // 3) Last chance: try to rotate the row or column 
-        if (has_magic_wand)
-            maybe_rotate_cluster (rotate_dir);
-    }
-}
-
-void PuzzleStone::actor_contact (Actor *a)
-{
-    if (state == EXPLODING)
-        SendMessage(a, "shatter");
-}
-
-
 /* -------------------- Stone impulse stones -------------------- */
 
 // Messages:
@@ -969,43 +305,6 @@
 
     Register(new MovableImpulseStone);
 
-    // PerOxyd/Enigma compatible puzzle stones:
-    Register(new PuzzleStone(0, false));
-    Register("st-puzzle-hollow", new PuzzleStone(1, false));
-    Register("st-puzzle-n", new PuzzleStone(9, false));
-    Register("st-puzzle-e", new PuzzleStone(5, false));
-    Register("st-puzzle-s", new PuzzleStone(3, false));
-    Register("st-puzzle-w", new PuzzleStone(2, false));
-    Register("st-puzzle-ne", new PuzzleStone(13, false));
-    Register("st-puzzle-nw", new PuzzleStone(10, false));
-    Register("st-puzzle-es", new PuzzleStone(7, false));
-    Register("st-puzzle-sw", new PuzzleStone(4, false));
-    Register("st-puzzle-ns", new PuzzleStone(11, false));
-    Register("st-puzzle-ew", new PuzzleStone(6, false));
-    Register("st-puzzle-nes", new PuzzleStone(15, false));
-    Register("st-puzzle-new", new PuzzleStone(14, false));
-    Register("st-puzzle-nsw", new PuzzleStone(12, false));
-    Register("st-puzzle-esw", new PuzzleStone(8, false));
-    Register("st-puzzle-nesw", new PuzzleStone(16, false));
-
-    // Oxyd1 compatible puzzle stones:
-    Register("st-puzzle2-hollow", new PuzzleStone(1, true));
-    Register("st-puzzle2-n", new PuzzleStone(9, true));
-    Register("st-puzzle2-e", new PuzzleStone(5, true));
-    Register("st-puzzle2-s", new PuzzleStone(3, true));
-    Register("st-puzzle2-w", new PuzzleStone(2, true));
-    Register("st-puzzle2-ne", new PuzzleStone(13, true));
-    Register("st-puzzle2-nw", new PuzzleStone(10, true));
-    Register("st-puzzle2-es", new PuzzleStone(7, true));
-    Register("st-puzzle2-sw", new PuzzleStone(4, true));
-    Register("st-puzzle2-ns", new PuzzleStone(11, true));
-    Register("st-puzzle2-ew", new PuzzleStone(6, true));
-    Register("st-puzzle2-nes", new PuzzleStone(15, true));
-    Register("st-puzzle2-new", new PuzzleStone(14, true));
-    Register("st-puzzle2-nsw", new PuzzleStone(12, true));
-    Register("st-puzzle2-esw", new PuzzleStone(8, true));
-    Register("st-puzzle2-nesw", new PuzzleStone(16, true));
-
     Register(new StoneImpulseStone);
 
 }

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-09-13 14:48:18 UTC (rev 1316)
+++ trunk/src/world.cc	2008-09-13 14:51:32 UTC (rev 1317)
@@ -460,7 +460,7 @@
         for (; i != e; ++i) {
             Stone *puzz = GetStone(i->pos);
             if (puzz && i->intensity) {
-                SendMessage(puzz, "scramble", Value(double(i->dir)));
+                SendMessage(puzz, "_scramble", Value(double(i->dir)));
                 --i->intensity;
             }
             else {



From ral at mail.berlios.de  Sat Sep 13 16:57:48 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sat, 13 Sep 2008 16:57:48 +0200
Subject: [Enigma-game-svn] r1318 - team_levelpacks/team_test_new_api
Message-ID: <200809131457.m8DEvmIJ004467@sheep.berlios.de>

Author: ral
Date: 2008-09-13 16:57:34 +0200 (Sat, 13 Sep 2008)
New Revision: 1318

Modified:
   team_levelpacks/team_test_new_api/ralT063_1.xml
   team_levelpacks/team_test_new_api/ralT065_1.xml
Log:
Test Level new API:
- puzzle test level updated



Modified: team_levelpacks/team_test_new_api/ralT063_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT063_1.xml	2008-09-13 14:51:32 UTC (rev 1317)
+++ team_levelpacks/team_test_new_api/ralT063_1.xml	2008-09-13 14:57:34 UTC (rev 1318)
@@ -16,73 +16,77 @@
     </el:info>
     <el:luamain><![CDATA[
 wo["ConserveLevel"] = true
-wo["ConserveLevel"] = true
 
 ti[" "] = {"fl-sahara"}
-ti["#"] = {"st_bluesand", cluster=1}
+ti["~"] = {"fl-water"}
+ti["_"] = {"fl-abyss"}
+ti["w"] = {"st-wood"}
+ti["s"] = {"st_swap"}
 
-ti["A"] = {"st-puzzle-w"}
-ti["B"] = {"st-puzzle-s"}
-ti["C"] = {"st-puzzle-sw"}
-ti["D"] = {"st-puzzle-e"}
-ti["E"] = {"st-puzzle-ew"}
-ti["F"] = {"st-puzzle-es"}
-ti["G"] = {"st-puzzle-esw"}
-ti["H"] = {"st-puzzle-n"}
-ti["I"] = {"st-puzzle-nw"}
-ti["J"] = {"st-puzzle-ns"}
-ti["K"] = {"st-puzzle-nsw"}
-ti["L"] = {"st-puzzle-ne"}
-ti["M"] = {"st-puzzle-new"}
-ti["N"] = {"st-puzzle-nes"}
-ti["O"] = {"st-puzzle-nesw"}
-ti["P"] = {"st-puzzle-hollow"}
+ti["1"] = {"st_puzzle_blue", cluster=1, hollow=false}
+ti["2"] = {"st_puzzle_blue", cluster=2}
+ti["|"] = {"st_puzzle_blue", connections="ns"}
+ti["+"] = {"st_puzzle_blue", connections="nesw", hollow=true}
+--ti["+"] = {"st_puzzle_blue", connections="nesw", hollow=false}
 
-ti["a"] = {"st-puzzle2-w"}
-ti["b"] = {"st-puzzle2-s"}
-ti["c"] = {"st-puzzle2-sw"}
-ti["d"] = {"st-puzzle2-e"}
-ti["e"] = {"st-puzzle2-ew"}
-ti["f"] = {"st-puzzle2-es"}
-ti["g"] = {"st-puzzle2-esw"}
-ti["h"] = {"st-puzzle2-n"}
-ti["i"] = {"st-puzzle2-nw"}
-ti["j"] = {"st-puzzle2-ns"}
-ti["k"] = {"st-puzzle2-nsw"}
-ti["l"] = {"st-puzzle2-ne"}
-ti["m"] = {"st-puzzle2-new"}
-ti["n"] = {"st-puzzle2-nes"}
-ti["o"] = {"st-puzzle2-nesw"}
-ti["p"] = {"st-puzzle2-hollow"}
+ti["8"] = {"st_puzzle_yellow", cluster=1}
+ti["9"] = {"st_puzzle_yellow", cluster=2}
+ti["-"] = {"st_puzzle_yellow", connections="ew"}
+ti["o"] = {"st_puzzle_blue", color=YELLOW, hollow=true}
 
-ti["'"] = {"st-puzzle-n", "puz1"}
-ti["!"] = {"st-puzzle2-w", "puz2"}
+ti["A"] = {"st_puzzle", connections="w"}
+ti["B"] = {"st_puzzle", connections="s"}
+ti["D"] = {"st_puzzle", connections="e"}
+ti["H"] = {"st_puzzle", connections="n"}
+
+ti["a"] = {"st_puzzle_yellow", connections="w"}
+ti["b"] = {"st_puzzle_yellow", connections="s"}
+ti["d"] = {"st_puzzle_yellow", connections="e"}
+ti["h"] = {"st_puzzle_yellow", connections="n"}
+
+
+ti["'"] = {"st_puzzle", "puz1", connections="n"}
+ti["!"] = {"st_puzzle_yellow", "puz2", connections="w"}
 ti["W"] = {"st-wood", "wood1"}
-ti["w"] = {"st-wood", "wood2"}
+ti["V"] = {"st-wood", "wood2"}
 
-ti["-"] = {"st_laser_w", state = ON}
+ti["l"] = {"st_laser_w", state = ON}
+ti["L"] = {"st_laser_n", state = ON}
 ti["="] = {"st_polarswitch"}
 ti["."] = {"st-stoneimpulse_movable"}
 ti["*"] = {"it-cherry"}
 
-ti["@"] = {"#ac-blackball"} ..ti({"it_magicwand"})
+ti["@"] = {"#ac-blackball"}  ..ti({"it_magicwand"})
 
 w, h = wo(ti, " ", {
-"                   ",
-" BB    =-    BPB =-",
-" H     =-          ",
-"  H                ",
-"   bb  =-          ",
-"   h   =-    bpb =-",
-"    h        @     ",
-"                   ",
-"   DPA.       dpa. ",
-"    *          *   ",
-"                   ",
-"  O'  W     dp! w  ",
-"                   "
+"                                       ",
+"                               ~~~~~   ",
+"                               ~~~~~   ",
+"  111       888        111     ~~~~~   ",
+"  2|2      18-9         21             ",
+"  222       999   8     222    _____   ",
+"                               _____   ",
+"   +         o          |      _____   ",
+"1         @     988-    |              ",
+"   1111      -         8       _____   ",
+"                      888      _____   ",
+"                      898      ~~~~~   ",
+"                      888              ",
+"   1B    =l   B+B =l                   ",
+"   1     =l                    Ds   =l  ",
+"    H                           A   =l ",
+"     8b  =l   bob =l                   ",
+"     8   =l                     =      ",
+"      h                         L      ",
+"                                       ",
+"     D+A.      doa.                    ",
+"      *         *                      ",
+"                                       ",
+"    +'    W   do!  V                   ",
+"                                       "
 })
 
+
 wo:add({"ot_wire", anchor1="puz1", anchor2="wood1"})
 wo:add({"ot_wire", anchor1="puz2", anchor2="wood2"})
 

Modified: team_levelpacks/team_test_new_api/ralT065_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT065_1.xml	2008-09-13 14:51:32 UTC (rev 1317)
+++ team_levelpacks/team_test_new_api/ralT065_1.xml	2008-09-13 14:57:34 UTC (rev 1318)
@@ -27,20 +27,22 @@
 ti["-"] = {"it_meditation_hill", "hilli#", essential=INDISPENSIBLE}
 ti["="] = {"it_meditation_bump", "bumpd#", essential=DISPENSIBLE}
 
-ti["("] = {"it_meditation_volcano"}
-ti[")"] = {"it_meditation_caldera"}
+ti["("] = {"it_meditation_volcano", "vol#"}
+ti[")"] = {"it_meditation_caldera", "vol#"}
 
 ti["w"] = {"st-wood"}
 ti["d"] = {"it-dynamite"}
 ti["?"] = {"it-spade"}
 ti["S"] = {"st_switch", target="hilli#*", action="flip"}
 ti["s"] = {"st_switch", target="bumpd#*", action="signal"}
+ti["T"] = {"st_switch", target="@vol#*", action="toggle"}
+ti["F"] = {"st_fourswitch", target="@vol#*", action_0="flip", action_2="flip"}
 
 ti["@"] = {"#ac-whiteball-small", player=0} 
 ti["1"] = {"#ac-blackball"} 
 
 w, h = wo(ti, " ", {
-"                    ",
+"F             T    T",
 " (  )   (  )   (  ) ",
 "                    ",
 "     .    ;    ;    ",



From ral at mail.berlios.de  Sun Sep 14 00:12:52 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 14 Sep 2008 00:12:52 +0200
Subject: [Enigma-game-svn] r1319 - in trunk/data: levels/lib schemas
Message-ID: <200809132212.m8DMCqsO002404@sheep.berlios.de>

Author: ral
Date: 2008-09-14 00:12:51 +0200 (Sun, 14 Sep 2008)
New Revision: 1319

Added:
   trunk/data/levels/lib/libpuzzle_3.xml
Modified:
   trunk/data/schemas/objects.xml
Log:
Trunk 1.1: new API reengineering
- puzzle part 2:
  - rewrite of libpuzzle as a resolver
  - auto tile generation for puzzles
  - guaranteed solvable shuffles of hollow crosses
  - mark of positions from which the user can push
Note:
- see upcoming test level and docu
- resolver still needs some comments and cleanup


Added: trunk/data/levels/lib/libpuzzle_3.xml
===================================================================
--- trunk/data/levels/lib/libpuzzle_3.xml	2008-09-13 14:57:34 UTC (rev 1318)
+++ trunk/data/levels/lib/libpuzzle_3.xml	2008-09-13 22:12:51 UTC (rev 1319)
@@ -0,0 +1,181 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="library">
+      <el:identity el:title="" el:id="lib/libpuzzle"/>
+      <el:version el:score="2" el:release="3" el:revision="5" el:status="test"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="false" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+function res.puzzle_finalization(context)
+    print("puzzle final - num pos "..#context[5])
+    local stones = {}
+    for i, ppos in ipairs(context[5]) do
+        local stone = st(context[5][i])
+        if -stone and stone:is("st_puzzle") then
+            table.insert(stones, stone)
+        end
+    end
+    stones = grp(stones)
+    -- seperate puzzles into huddles
+    local huddles = {}
+    while #stones > 0 do
+        local huddle = stones[1]:get_adjacents()
+        table.insert(huddles, huddle)
+        stones = stones - huddle
+--        print("puzzle final - huddle of size "..#huddle)
+    end
+--    print("puzzle final - num huddles "..#huddles)
+    
+    -- shuffle huddles
+    local width = wo["Width"]
+    local height = wo["Height"]
+    local offsets = {po(-1,0), po(0,1), po(1,0), po(0,-1)}
+    local dirchars = {"w","s","e","n"}
+    for h, huddle in ipairs(huddles) do
+        print("puzzle final - shuffle huddle of size "..#huddle)
+        local pfloors = fl(huddle)
+        local pushes = {}
+        local intensity = 0
+        local algorithm = 0   -- std
+        for puz in huddle do
+            local alg = puz["algorithm"]
+            if alg == "marked" then
+               algorithm = 1
+            end
+            intensity = math.max(intensity, puz["intensity"])
+        end
+        for puz in huddle do
+            for dir, offset in ipairs(offsets) do
+                local cand = puz - offset
+                if cand.x >= 0 and cand.x < width and cand.y >= 0 and cand.y < height then
+                    local cfloor = fl(cand)
+                    if pfloors[cfloor] == nil then
+                        local may_push = true
+                        if algorithm == 1 then
+                            local pushdirs = cfloor["push_directions"]
+                            if type(pushdirs) ~= "string" or not pushdirs:find(dirchars[dir]) then
+                                may_push = false
+                            end
+                        end
+                        if may_push then
+                            local length = 1
+                            local lpos = puz + offset
+                            while lpos.x >= 0 and lpos.x < width and lpos.y >= 0 and lpos.y < height
+                                    and pfloors[fl(lpos)] ~= nil do
+                                length = length + 1
+                                lpos = lpos + offset
+                            end
+                            if length > 1 then
+                                table.insert(pushes, {fl(puz), dir - 1, length})
+--                                print("  push ("..cfloor.x..","..cfloor.y..") dir "..(dir-1).." length "..length)
+                            end
+                        end
+                    end
+                end
+            end
+        end
+        intensity = intensity * #huddle
+        local maxp = math.floor(math.sqrt(intensity))
+        while intensity > 0 and #pushes > 0 do
+            local pidx = random(#pushes)  -- select a random push pos/dir
+            local nump = random(math.min(pushes[pidx][3],
+                            math.max(maxp, intensity)))  -- number of pushes 
+            
+            intensity = intensity - nump
+            for i = 1, nump do 
+                if not (st(pushes[pidx][1] + offsets[pushes[pidx][2] + 1]))["hollow"] then
+                    st(pushes[pidx][1]):pull_rotate(pushes[pidx][2])
+                end
+            end
+        end
+    end
+end
+
+function res.puzzle_newtile(key, template, suffix)
+    local decl = template:_declaration()  -- get a deep copy
+    local result
+    for i, tile in ipairs(decl) do
+        if type(tile) == "string" then
+            if result == nil then
+                result = ti[tile]
+            else
+                result = result .. ti[tile]
+            end
+        else
+            if tile[1]:find("st_puzzle", 1, true) then
+                local clusteridx = ("01234456789"):find(suffix)
+                local connections = (" abcdefghijklmno"):find(suffix)
+                if  clusteridx ~= nil then
+                    tile["cluster"] = clusteridx - 1
+                elseif connections ~= nil then
+                    tile["connections"] = ({"","w","s","sw","e","ew","es","esw",
+                            "n","nw","ns","nsw","ne","new","nes","nesw"})[connections]
+                end
+            end
+            
+            if result == nil then
+                result = ti(tile)
+            else
+                result = result .. ti(tile)
+            end
+        end
+    end
+    ti[key] = result
+end
+
+function res.puzzle_implementation(context, evaluator, key, x, y)
+    for i, prefix in ipairs (context[4]) do
+        if key:find(prefix, 1, true) == 1 then
+            -- prefix based substitution
+            if ti[key] == nil then
+                local template = ti[prefix]
+                local suffix = key:sub(#(prefix) + 1)
+                if template == nil then
+                    error("Resolver puzzle missing template rule '" ..prefix.."'",2 )
+                elseif #suffix ~= 1 then
+                    error("Resolver puzzle key '"..key.."' does not match template rule '" ..prefix.."'",2 )
+                else
+                    res.puzzle_newtile(key, template, suffix)
+                end
+            end
+            table.insert(context[5], po(x,y))
+            return ti[key]
+        end
+    end
+    return evaluator(context[3], key, x, y)
+end
+
+function res.puzzle(subresolver, ...)
+    -- syntax: ... = <prefixkey>
+    -- context: [4] = table with unmodified rule tables
+    local args = {...}
+    local length = 0
+    for i, prefix in ipairs(args) do
+        if type(prefix) ~= "string" then
+            error("Resolver puzzle prefix " .. i.." is not a string", 2)
+        else
+           if length == 0 then
+               length = #prefix
+           elseif length ~= #prefix then
+               error("Resolver puzzle prefix " .. i.." mismatch of length", 2)
+           end
+        end
+    end
+    local context = {res.puzzle_implementation, res.puzzle_finalization, subresolver, args, {}}
+    return context
+end
+
+    ]]></el:luamain>
+    <el:i18n>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/lib/libpuzzle_3.xml
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:eol-style
   + native

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-09-13 14:57:34 UTC (rev 1318)
+++ trunk/data/schemas/objects.xml	2008-09-13 22:12:51 UTC (rev 1319)
@@ -3,6 +3,7 @@
   <attributes>
     <attr name="action" type="tokens" default="nil" rw="rw"/>
     <attr name="adhesion" type="double" default="nil" rw="rw"/>
+    <attr name="algorithm" type="string" default="std" rw="rw"/>
     <attr name="anchor1" type="tokens" default="nil" rw="rw"/>
     <attr name="anchor2" type="tokens" default="nil" rw="rw"/>
     <attr name="autoclose" type="bool" default="false" rw="rw"/>
@@ -28,6 +29,7 @@
     <attr name="hit_distortion_yy" type="double" default="1" rw="rw"/>
     <attr name="hollow" type="bool" default="false" rw="rw"/>
     <attr name="instant" type="bool" default="false" rw="rw"/>
+    <attr name="intensity" type="double" default="1" rw="rw"/>
     <attr name="interval" type="double" default="1" rw="rw"/>
     <attr name="interval_s" type="double" default="3" rw="rw"/>
     <attr name="interval_m" type="double" default="6" rw="rw"/>
@@ -46,6 +48,7 @@
     <attr name="noshuffle" type="bool" default="false" rw="rw"/>
     <attr name="orientation" type="int" default="0" min="0" max="3" rw="rw"/>
     <attr name="oxydcolor" type="int" default="-1" min="-4" max="7" rw="rw"/>
+    <attr name="push_directions" type="string" default="nil" rw="rw"/>
     <attr name="range" type="double" default="1.0" rw="rw"/>
     <attr name="rubbers" type="group" default="nil" rw="r"/>
     <attr name="secure" type="bool" default="false" rw="rw"/>
@@ -117,7 +120,9 @@
       <msg name="kill"/>
       <msg name="toggle"/>
     </object>
-    <object name="fl" abstract="true"/>
+    <object name="fl" abstract="true">
+      <attr name="push_directions"/>
+    </object>
     <object name="fl_bridge">
       <attr name="flavor" default="gc"/>
       <msg name="close"/>
@@ -825,10 +830,12 @@
       <msg name="_revive"/>
     </object>
     <object name="st_puzzle">
+      <attr name="algorithm"/>
       <attr name="connections"/>
       <attr name="cluster"/>
       <attr name="color" min="2" max="3"/>
       <attr name="hollow"/>
+      <attr name="intensity" default="3"/>
       <attr name="state" rw="r"/>
       <msg name="get_adjacents"/>
       <msg name="pull_rotate"/>



From ral at mail.berlios.de  Sun Sep 14 00:23:15 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 14 Sep 2008 00:23:15 +0200
Subject: [Enigma-game-svn] r1320 - team_levelpacks/team_test_new_api
Message-ID: <200809132223.m8DMNFAZ002996@sheep.berlios.de>

Author: ral
Date: 2008-09-14 00:23:08 +0200 (Sun, 14 Sep 2008)
New Revision: 1320

Added:
   team_levelpacks/team_test_new_api/ralT069_1.xml
Log:
Test Level new API:
- puzzle lib test level added


Added: team_levelpacks/team_test_new_api/ralT069_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT069_1.xml	2008-09-13 22:12:51 UTC (rev 1319)
+++ team_levelpacks/team_test_new_api/ralT069_1.xml	2008-09-13 22:23:08 UTC (rev 1320)
@@ -0,0 +1,60 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Puzzle new API" el:subtitle="" el:id="20080910ral228"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 1314 $" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libpuzzle" el:id="lib/libpuzzle" el:release="3" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti["  "] = {"fl-sahara"}
+
+ti[".."] = {"fl-sahara", push_directions="nesw"}
+ti["++"] = {"fl-sahara", push_directions="w"} .. ti{"st_window_s", secure=true}
+ti["##"] = {"st-rock1"}
+
+ti["P"] = {"st_puzzle_blue"}
+ti["H"] = {"st_puzzle_blue", hollow=true}
+ti["S"] = {"st_puzzle_yellow", intensity=2/6}
+ti["M"] = {"st_puzzle_blue", algorithm="marked"}
+ti["C"] = {"st_puzzle_blue", algorithm="marked", intensity=10}
+
+ti["@@"] = {"#ac-blackball"}  ..ti({"it_magicwand"})
+
+puzz = res.puzzle(ti, "P","H", "S", "M", "C")
+
+w, h = wo(puzz, "  ", {
+"              P7P7P7          ..  ",
+"  P1P1    @@  P7P7P7    M1M1  M1  ",
+"  P1P1        P7P7P7  ..M1M1M1M1  ",
+"                                  ",
+"            P1P1                  ",
+"      Pj    PjP2  ##########      ",
+"            P2P2  ##C1C1C1##      ",
+"P3P3P3            ##C1C1C1++      ",
+"P3P3P3            ##C1C1C1C1##..  ",
+"P3H3P3      S1      ..####C1##C1##",
+"P3P3P3      S1S1        ..C1C1C1##",
+"          S1S1S1          ####C1##",
+"                              ####"
+})
+
+    ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: team_levelpacks/team_test_new_api/ralT069_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native



From andreasl at mail.berlios.de  Sun Sep 14 00:32:02 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Sun, 14 Sep 2008 00:32:02 +0200
Subject: [Enigma-game-svn] r1321 - in trunk: data/levels/lib doc/reference
Message-ID: <200809132232.m8DMW2xp006956@sheep.berlios.de>

Author: andreasl
Date: 2008-09-14 00:31:57 +0200 (Sun, 14 Sep 2008)
New Revision: 1321

Modified:
   trunk/data/levels/lib/liblua.xml
   trunk/data/levels/lib/libsoko-endphase.xml
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk:
 - Replace lib.lua.shuffle_table by lib.lua.shuffle:
   lib.lua.shuffle returns a shallow copy of the shuffled
   table instead of shuffling the table inplace. The result
   will have the same metatable as the source table.
    - Corresponding refman and libsoko updates.
 - Remove a print-message from libsoko-endphase (debugging).


Modified: trunk/data/levels/lib/liblua.xml
===================================================================
--- trunk/data/levels/lib/liblua.xml	2008-09-13 22:23:08 UTC (rev 1320)
+++ trunk/data/levels/lib/liblua.xml	2008-09-13 22:31:57 UTC (rev 1321)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/liblua"/>
-      <el:version el:score="1" el:release="1" el:revision="4" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="5" el:status="released"/>
       <el:author  el:name="Enigma Team" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007, 2008 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -25,7 +25,7 @@
 -- liblua provides the following functions:
 --   lib.lua.deep_copy(source)
 --   lib.lua.combine_tables(arg1, ...)
---   lib.lua.shuffle_table(t)
+--   lib.lua.shuffle(t)
 --   lib.lua.print_table(t, prefix, depth)
 --   lib.lua.mod(value, modul)
 --   lib.lua.cond(condition, iftrue, iffalse)
@@ -83,17 +83,29 @@
   return result
 end
 
--- shuffle_table resorts the table T randomly. Note that only those entries
--- of T can be sorted, that are indexed with integers from 1 to table.getn(T).
--- No return value, the table itself is shuffled.
-function lib.lua.shuffle_table(t)
-  if table.getn(t) < 2 then
-    return
+-- shuffle resorts the table T randomly and returns a shallow copy of the
+-- shuffled table. Note that only those entries of T can be sorted, that
+-- are indexed with integers from 1 to table.getn(T), all other entries
+-- will be in the result, but will not be shuffled. Metatable will be
+-- that of the argument. Metamethods will be used during the copy
+-- (i.e. no rawget or rawset).
+function lib.lua.shuffle(t)
+  if type(t) ~= "table" then
+    error("lib.lua.shuffle: Argument is not a table.", 2)
   end
-  for n = table.getn(t), 2, -1 do
+  local result = {}
+  setmetatable(result, getmetatable(t))
+  for key, value in pairs(t) do
+    result[key] = value
+  end
+  if table.getn(result) < 2 then
+    return result
+  end
+  for n = table.getn(result), 2, -1 do
     local m = math.random(n)
-    t[n], t[m] = t[m], t[n]
+    result[n], result[m] = result[m], result[n]
   end
+  return result
 end
 
 -- print_table uses the print command to print all

Modified: trunk/data/levels/lib/libsoko-endphase.xml
===================================================================
--- trunk/data/levels/lib/libsoko-endphase.xml	2008-09-13 22:23:08 UTC (rev 1320)
+++ trunk/data/levels/lib/libsoko-endphase.xml	2008-09-13 22:31:57 UTC (rev 1321)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libsoko-endphase"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="experimental"/>
       <el:author el:name="Enigma Team" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007, 2008 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -334,7 +334,7 @@
     end    
   end
 
-  lib.lua.shuffle_table(places)
+  places = lib.lua.shuffle(places)
 
   for j = 1, number_pairs do
     set_oxyd(sokoarea_number, places[2*j-1], flavor, j - 1)
@@ -399,7 +399,7 @@
     end    
   end
 
-  lib.lua.shuffle_table(oxyds)
+  oxyds = lib.lua.shuffle(oxyds)
 
   -- set oxyds and blockers
   local function set_block(w)
@@ -437,7 +437,7 @@
   for p, v in pairs(sokoarea[nr].list_goal) do
     table.insert(goal_table, v)
   end
-  lib.lua.shuffle_table(goal_table)
+  goal_table = lib.lua.shuffle(goal_table)
   for j = 2, math.min(table.getn(goal_table), table.getn(oxyds)) do
     sokoarea[nr].goal_to_blocker[goal_table[j].goal_number] = oxyds[j].blocker
   end
@@ -454,7 +454,7 @@
     table.insert(places, v)
   end
 
-  lib.lua.shuffle_table(places)
+  places = lib.lua.shuffle(places)
   
   -- choose number of oxyds
   local max = table.getn(places)
@@ -503,7 +503,7 @@
     end
   end
 
-  lib.lua.shuffle_table(places)
+  places = lib.lua.shuffle(places)
 
   -- choose number of magnets
   local number_magnets = math.floor(table.getn(places)/6)
@@ -523,7 +523,7 @@
     table.insert(places, v)
   end
 
-  lib.lua.shuffle_table(places)
+  places = lib.lua.shuffle(places)
 
   -- choose number of fourswitchs/oxyds
   local max = table.getn(places)
@@ -726,7 +726,7 @@
       table.insert(u, component[j])
     end
   end
-  lib.lua.shuffle_table(u)
+  u = lib.lua.shuffle(u)
   while (table.getn(t) < 5) and (table.getn(u) > 0) do
     table.insert(t, u[table.getn(u)])
     table.remove(u)
@@ -766,7 +766,7 @@
     table.insert(places, v)
   end
 
-  lib.lua.shuffle_table(places)
+  places = lib.lua.shuffle(places)
 
   -- set attributes of door
   for j, v in ipairs(places) do
@@ -795,7 +795,6 @@
   end
   -- Open or close the neccessary doors given as attributes.
   if sender._sokoarea == nr then
-    print(po(sender).x.."/"..po(sender).y.."/"..sender:kind())
     if wo:st(sender._close):is("st_door") then
       wo:st(sender._close):close()
     end

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-09-13 22:23:08 UTC (rev 1320)
+++ trunk/doc/reference/enigma-ref.texi	2008-09-13 22:31:57 UTC (rev 1321)
@@ -9560,7 +9560,7 @@
 * lib.lua.deep_copy::       Complete copies of Lua-tables.
 * lib.lua.mod::             A modulo operation.
 * lib.lua.print_table::     Print tables for debug reasons.
-* lib.lua.shuffle_table::   Shuffle arbitrary anonymous Lua-tables.
+* lib.lua.shuffle::         Shuffle arbitrary anonymous Lua-tables.
 @end menu
 
 @c ----------------- combine_tables -------------------- 
@@ -9784,38 +9784,54 @@
 @end example
 @end table
 
- at c ----------------- shuffle_table -------------------- 
+ at c ----------------- shuffle -------------------- 
 
- at node lib.lua.shuffle_table
- at subsection lib.lua.shuffle_table
+ at node lib.lua.shuffle
+ at subsection lib.lua.shuffle
 
- at samp{shuffle_table} randomly resorts its argument.
+ at samp{shuffle} randomly resorts its argument, a numerical table.
 
 @table @asis
 @item @b{Syntax:}
- at b{lib.lua.shuffle_table}(@i{source})
+ at i{result} = @b{lib.lua.shuffle}(@i{source})
 
 @table @asis
 @item @i{source}
-The table to be shuffled.
+The table to be shuffled (only the numerical entries will be shuffled).
 @end table
 
 @item @b{Syntax Samples:}
 @example
+directions = lib.lua.shuffle(@{NORTH, SOUTH, EAST, WEST@})
 a = @{1, 2, 3, "r", @{"x", "y", "z"@}, 4@}
-lib.lua.shuffle_table(a)
+b = lib.lua.shuffle(a)
 @end example
 
-A typical result for @samp{a} would be
+A typical result for @samp{b} would be
 @example
-a = @{"r", 4, 2, @{"x", "y", "z"@}, 1, 3@}
+b = @{"r", 4, 2, @{"x", "y", "z"@}, 1, 3@}
 @end example
 
 @item @b{Details:}
-The result is a permutation of the original table. The permutation restricts to
-those entries with numerical keys, and of those only the ones between @samp{1}
-and @samp{table.getn(@i{source})}. @samp{shuffle_table} has no return value.
+The result is a permutation of the numerical entries of the source table,
+starting with entry 1 and ending with entry @samp{table.getn(@i{source})}. All
+other entries will simply be copied into @samp{result}. All copies are shallow
+copies, i.e. table-valued and userdata-valued entries (like objects) are not
+copied, just references (pointers) to them. Use @ref{lib.lua.deep_copy} to
+create a deep copy of the shuffled table, if needed. @samp{result} will use the
+same metatable as @samp{source}, and metamethods will be used during the copy
+and shuffling process.
 
+Currently, @samp{lib.lua.shuffle} can shuffle only tables. To shuffle groups,
+use the group method of the same name:
+ at example
+mygroup:shuffle()
+ at end example
+
+Shuffling a @ref{libmap}-map results in a map with shuffled rows, i.e. the
+x-coordinates of all tile keys are kept constant. Use @ref{Rotating and
+Mirroring Maps} to shuffle the columns.
+
 @item @b{Full Example:}
 @example
 @end example



From andreasl at mail.berlios.de  Sun Sep 14 00:38:38 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Sun, 14 Sep 2008 00:38:38 +0200
Subject: [Enigma-game-svn] r1322 - feature_branches/hp_lotm/input/lotm
Message-ID: <200809132238.m8DMccUq016704@sheep.berlios.de>

Author: andreasl
Date: 2008-09-14 00:38:26 +0200 (Sun, 14 Sep 2008)
New Revision: 1322

Added:
   feature_branches/hp_lotm/input/lotm/lotm_200809_de.html
Modified:
   feature_branches/hp_lotm/input/lotm/lotm_200809.html
Log:
LotM Feature branch:
 - German translation of LotM 9/08
 - Typos in English article
 - Moved Craven's comment further down, to separate
   two "days" of the story.
Todo:
 - Russian translation
 - Upload


Modified: feature_branches/hp_lotm/input/lotm/lotm_200809.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200809.html	2008-09-13 22:31:57 UTC (rev 1321)
+++ feature_branches/hp_lotm/input/lotm/lotm_200809.html	2008-09-13 22:38:26 UTC (rev 1322)
@@ -73,37 +73,6 @@
         <td class="left">mecke</td></tr>    
 </table>
 
-<h4>&quot;The frustration factor of 'River of Challenges' is
-comparatively low&quot;</h4>
-
-<div class="quote">&quot;River of Challenges&quot; is nice to first-time
-&quot;visitors&quot;, because you can take a look at every part of the level
-before really starting to do anything. Also, there's no given order in which to
-tackle the different &quot;challenges&quot; which makes this level worth a try
-even for less experienced players. However, if you want to actually finish this
-level, you need skill in moving the ball as well as a bit of logic, so as not to
-make mistakes during the pushing puzzles.</div> 
-
-<div class="quote">Fortunately, one of the most critical passages, namely the
-race against the laser beam, can be dealt with right at the beginning, so that
-the frustration factor of &quot;River of Challenges&quot; is comparatively low.
-It takes no mastermind to solve the puzzles either, except for two &quot;booby
-traps&quot;, which cost me quite some time:</div>
-
-<div class="quote">1) Where can I get more dynamite, in order to blow up the
-stones blocking the room with the key?</div>
-
-<div class="quote">2) Why do I get stuck, when I build a bridge across the upper
-part of the &quot;river&quot;? (It did work in the lower right corner!)</div>
-
-<div class="quote">Eventually you reach a point (hopefully), at which you can
-(at least in theory) manage every part of the level separately. Then it's only a
-matter of time &hellip;</div>
-
-<div class="author">Craven</div>
-
-
-
 <p>Actually our marble wanted to go mountain climbing, but the weather forecast
 in the mountains thwarted his plans. Go to the sea? Well, being a non-swimmer
 (one would not think so, but it's true!) that wouldn't really be a marbleous
@@ -213,7 +182,7 @@
 Ctrl-A). Concentrate and keep up the pace! Phew! We've only just made it! First
 we need a breather, and then we return the lost article to its owner. And like
 he had promised (manus manum lavat) B.B. pulls a few strings, Lucille sings
-&quot;You're still a square, but a fl-bridge-open now&quot; &mdash; and we've
+&quot;You're still a square, but a fl-bridge-closed now&quot; &mdash; and we've
 made another considerable step forward. Let's knock off business for
 today.</p>
 
@@ -256,9 +225,38 @@
 atmosphere's enjoyable. Even waiting can be fun. After a while the expected guy
 shows up and soon joins us. He asks us what we want from him, and we tell him
 about our problems. After some (or perhaps some more) glasses of wine, John Lee
-Marble assures us of his support, and moreover gives us some helpful tips. And
-then &hellip;</p>
+Marble assures us of his support, and moreover gives us some helpful tips. <br>
+And then &hellip;</p>
 
+<h4>&quot;The frustration factor of 'River of Challenges' is
+comparatively low&quot;</h4>
+
+<div class="quote">&quot;River of Challenges&quot; is nice to first-time
+&quot;visitors&quot;, because you can take a look at every part of the level
+before really starting to do anything. Also, there's no given order in which to
+tackle the different &quot;challenges&quot; which makes this level worth a try
+even for less experienced players. However, if you want to actually finish this
+level, you need skill in moving the ball as well as a bit of logic, so as not to
+make mistakes during the pushing puzzles.</div> 
+
+<div class="quote">Fortunately, one of the most critical passages, namely the
+race against the laser beam, can be dealt with right at the beginning, so that
+the frustration factor of &quot;River of Challenges&quot; is comparatively low.
+It takes no mastermind to solve the puzzles either, except for two &quot;booby
+traps&quot;, which cost me quite some time:</div>
+
+<div class="quote">1) Where can I get more dynamite, in order to blow up the
+stones blocking the room with the key?</div>
+
+<div class="quote">2) Why do I get stuck, when I build a bridge across the upper
+part of the &quot;river&quot;? (It did work in the lower right corner!)</div>
+
+<div class="quote">Eventually you reach a point (hopefully), at which you can
+(at least in theory) manage every part of the level separately. Then it's only a
+matter of time &hellip;</div>
+
+<div class="author">Craven</div>
+
 <!--<div class="lotmpic">
 <img src="$$imagedir$$/lotm/lotm_200809_h.png" alt="Level of the Month" border="0">
 <div class="imagetitle">The Cave: For Members Only</div>
@@ -373,7 +371,7 @@
 marble is spending its vacation and why our marble sometimes seems to be so
 worn-out for its daily work.</p>
 
-<p><i>NObby and Harry</i></p> 
+<p><i>NObby And Harry</i></p> 
 
 <p><i>One more time many thanks to our travel companion Taztunes who picked up the
 pieces of our double Dutch English and put them together into something worth

Added: feature_branches/hp_lotm/input/lotm/lotm_200809_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200809_de.html	2008-09-13 22:31:57 UTC (rev 1321)
+++ feature_branches/hp_lotm/input/lotm/lotm_200809_de.html	2008-09-13 22:38:26 UTC (rev 1322)
@@ -0,0 +1,437 @@
+
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">September 2008: </span>
+    &quot;River of Challenges&quot; von Lukas Sch&uuml;ller
+  </h3>
+
+<p>Sommerzeit ist auch Urlaubszeit. Tja, haben Murmeln denn auch Urlaub? Und
+wenn ja, was machen sie dann? Faulenzen und sich verw&ouml;hnen lassen oder doch
+lieber Aktivurlaub? Fragen &uuml;ber Fragen. Zum Gl&uuml;ck ist Lukas
+Sch&uuml;ller diesen Fragen nachgegangen und erlaubt uns, mit &quot;River Of
+Challenges&quot; einen Einblick in seine Erkenntnisse zu bekommen. </p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_a.png" alt="Level des Monats" border="0">
+<div class="imagetitle">Enigma VI # 61</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Einige Rekorde vom August 2008:</caption>
+<colgroup>
+    <col width="80">
+    <col width="160">
+</colgroup>
+    <tr><td class="num">9:35</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">11:47</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">11:49</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">12:39</td>
+        <td class="left">Duffy</td></tr>
+    <tr><td class="num">13:39</td>
+        <td class="left">dev0</td></tr>
+    <tr><td class="num">13:41</td>
+        <td class="left">Raoul</td></tr>
+    <tr><td class="num">14:20</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">14:42</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">17:56</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">18:08</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">21:09</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">32:41</td>
+        <td class="left">Alex</td></tr>
+</table>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Einfacher Modus</caption>
+<colgroup>
+    <col width="80">
+    <col width="160">
+</colgroup>
+    <tr><td class="num">10:56</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">11:25</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">11:58</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">13:32</td>
+        <td class="left">dev0</td></tr>
+    <tr><td class="num">17:21</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">20:14</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">20:37</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">33:00</td>
+        <td class="left">mecke</td></tr>    
+</table>
+
+<p>Eigentlich wollte unsere Murmel dieses Jahr zum Bergsteigen, aber die
+vorherrschende Gro&szlig;wetterlage im Gebirge machte ihr leider einen Strich
+durch die Rechnung. Ans Meer? Naja, als Nichtschwimmer (man soll's nicht
+glauben, aber es ist so) ist das auch nicht so prickelnd, und dort am Ende noch
+in irgendeiner anonymen Touri-Hochburg nur abh&auml;ngen? Gestrichen! Also was?
+Die Altvorderen haben, wenn ihnen die Ideen ausgingen, ein Orakel befragt. Das
+half einem dann schon weiter. Umh&ouml;ren und fragen schadet auch heutzutage
+nicht. </p>
+
+<p>Nach etwas Recherche an den richtigen Stellen st&ouml;&szlig;t unsere Murmel
+bald auf ein interessantes Fleckchen im S&uuml;den &mdash; nur Insidern bekannt
+und von diesen mit gl&auml;nzenden Augen als &quot;echt geile Location&quot;
+gelobt. Da f&auml;llt einem die Entscheidung leicht. &quot;S&uuml;den&quot;
+bedeutet im Sommer warmes und stabiles, gutes Wetter, &quot;nur Insidern
+bekannt&quot; Urspr&uuml;nglichkeit und keinen Rummel. Damit ist eine
+Alternative gefunden. </p>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200809_b.png" alt="Level des Monats" border="0">
+<div class="imagetitle">Unpassierbare Br&uuml;cke</div>
+</div>
+
+<p>An unserem Urlaubsziel angekommen, wird zun&auml;chst die Lage sondiert. Den
+von den Insidern angesprochenen Fluss, der sich hervorragend zum Kajaken bzw.
+Rafting eignen soll, sehen wir schon in der Ferne. Also gleich mal
+&uuml;berpr&uuml;fen, ob er den Schw&auml;rmereien gerecht wird. Wow! Die haben
+ja ein Rad ab, das Ding zu befahren, ist reiner Selbstmord. Armdicke &Auml;ste,
+sogar Baumst&auml;mme schie&szlig;en vorbei. Gehen wir mal &uuml;ber die
+Br&uuml;cke und sehen auf der anderen Seite nach: Vielleicht ist es dort
+ruhiger. Upps, der Weg ist wohl nicht passierbar! Anscheinend gab es hier
+k&uuml;rzlich ein Hochwasser, das die Br&uuml;cke demoliert hat, deswegen auch
+der ganze Schlamm und Matsch. </p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_c.png" alt="Level des Monats" border="0">
+<div class="imagetitle">Die Ortschaft</div>
+</div>
+
+<p>Da werden wir uns in der naheliegenden Ortschaft erst einmal informieren, was
+passiert ist und wann die Reparaturarbeiten abgeschlossen sein werden. Leider
+sind die Ausk&uuml;nfte, die wir dort erhalten, alles andere als aufmunternd:
+Die Arbeiten werden sich noch Tage, wenn nicht Wochen hinziehen. Wir sollen doch
+n&auml;chstes Jahr wieder kommen oder uns mit dem begn&uuml;gen, was im Ort
+geboten wird, hei&szlig;t es. Zumindest erfahren wir, dass drei Leute uns
+eventuell weiterhelfen k&ouml;nnen. Allerdings seien zwei von denen momentan
+wohl verhindert oder zu besch&auml;ftigt, und der Weg zum dritten sei zur Zeit
+mehr als abenteuerlich. Verzagte Gem&uuml;ter w&uuml;rden jetzt die Koffer
+packen, aber wir wollten ja Aktivurlaub &mdash; also stellen wir uns den
+Herausforderungen. </p>
+
+<p>Zum Warmwerden nehmen wir uns f&uuml;r den heutigen Tag die Br&uuml;cke
+s&uuml;d&ouml;stlich der Ortschaft vor. Wider Erwarten l&auml;sst diese sich
+doch ohne gr&ouml;&szlig;ere Probleme wieder instandsetzen. Damit ist der Weg zu
+zwei &quot;Sehensw&uuml;rdigkeiten&quot; frei. Um unser Pulver nicht zu
+fr&uuml;h zu verschie&szlig;en, lassen wir es f&uuml;r heute dabei bewenden.
+Morgen ist ja auch noch ein Tag. </p>
+
+<h4>Verpassen Sie nicht den letzten &quot;Bus&quot;!</h4>
+
+<div class="quote">Im Januar 1995 habe ich den Ruinen der antiken Stadt Petra in
+Jordanien einen Besuch abgestattet. Mein Reisegef&auml;hrte und ich hatten an
+einer Stelle wohl die falsche Abzweigung genommen, und wanderten nun an den
+Ufern eines Flusses entlang weg von der Augrabungsst&auml;tte hinaus in die
+Wildnis. Auf einmal waren wir nicht l&auml;nger von S&auml;ulen umgeben, einst
+vor langer Zeit von Menschenhand aus totem Stein gehauen und zu etwas Lebendigem
+geformt, sondern nur noch von den Sch&ouml;pfungen von Mutter Natur selbst.
+</div>
+
+<div class="quote">Wir folgten dem Lauf des Flusses weiter, bis wir an eine
+Seilbr&uuml;cke gelangten. Wir waren uns im Klaren dar&uuml;ber, dass unser Bus
+bald abfahren w&uuml;rde, und da wir uns mittlerweile doch ein gutes St&uuml;ck
+von unserem Ausgangspunkt entfernt hatten, konnten wir nicht sicher sein, ob wir
+den Bus &uuml;berhaupt noch rechtzeitig erreichen w&uuml;rden, der zudem noch
+der letzte f&uuml;r den damaligen Tag war. Wir mussten also diese prek&auml;re
+Seilbr&uuml;cke zum einen mit &auml;u&szlig;erster Vorsicht &uuml;berqueren, um
+nicht hinab ins Wasser zu st&uuml;rzen, und zum anderen mit der gebotenen Eile,
+um nicht den Bus zu verpassen. </div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_d.png" alt="Level des Monats" border="0">
+<div class="imagetitle">Den Bus verpasst.</div>
+</div>
+
+<div class="quote">Dies ist die Erinnerung, die &quot;River of Challenges&quot;
+in mir ausl&ouml;st. Wie es bei vielen Enigma Leveln der Fall ist, so gibt es
+auch hier eine kritische Aufgabe, die man gleich zu Beginn meistern muss, will
+man das Spiel weiter fortsetzen. In diesem Level ist es die notwendigerweise
+rasche aber zugleich auch vorsichtige &Uuml;berquerung des Flusses, die man
+unternehmen muss, um den Laser abzuschalten, bevor der Laserstrahl den Boulder
+erreicht. Wenn man den &quot;Bus&quot; verpasst, bleibt einem nichts anderes
+&uuml;brig, als das Spiel wieder von vorne zu beginnen.  </div>
+
+<div class="quote">F&uuml;r mich allerdings war die gr&ouml;&szlig;te
+Herausforderung nicht etwa diese verr&uuml;ckte Rennerei &uuml;ber den Fluss,
+auf die ich eben angespielt habe, sondern das Springbrettgeh&uuml;pfe in dem
+Raum unten links, das man veranstalten muss, um an den Schalter zu gelangen. Ich
+finde es ziemlich schwierig, die richtige Anlaufgeschwindigkeit zu finden, um
+dann mit dem richtigen Schwung &uuml;ber die B&auml;chlein hin&uuml;ber gefedert
+zu werden. Meistens versuche ich mit einem riesigen Satz beide Gew&auml;sser zu
+&uuml;berqueren, in der Hoffnung den Schalter zu erwischen, bevor ich wieder von
+der Wand zur&uuml;ckpralle, ins Wasser st&uuml;rze und dabei ein Leben verliere.
+</div>
+
+<div class="quote">Mir gef&auml;llt der Level wirklich ausgesprochen gut &mdash;
+er macht optisch einen pr&auml;chtigen Eindruck. Die Aufgaben, die
+bew&auml;ltigt werden m&uuml;ssen, sind abwechslungsreich &mdash; und auch die
+f&uuml;r den Erfolg erforderlichen Ma&szlig;e an Geschicklichkeit auf der einen,
+sowie an Vorausdenken auf der anderen Seite sind wohl ausgewogen. Von mir
+erh&auml;lt &quot;River Of Challenges&quot; eine &quot;10&quot;. </div>
+
+<div class="author">Taztunes</div>
+
+<p>Am n&auml;chsten Tag schauen wir mal, wie es mit der Hilfe aussieht. Der
+Erste, den wir aufsuchen, scheint selbst Hilfe zu ben&ouml;tigen. Best&uuml;ckt
+mit einem Gips am Bein schl&auml;gt uns B.B. Marble einen Handel vor. Vor seinem
+Unfall habe er etwas Wichtiges verloren, das er sich aufgrund seiner nun
+eingeschr&auml;nkten Bewegungsfreiheit nicht holen k&ouml;nne. Wenn wir ihm dies
+wiederbeschaffen k&ouml;nnten, w&uuml;rde er sich selbstverst&auml;ndlich
+erkenntlich zeigen. Wir sind einverstanden und das Angebot wird mit Handschlag
+besiegelt. Er instruiert uns noch genau, wo wir hin m&uuml;ssen und was uns auf
+dem Trip erwarten wird &mdash; und dass Eile geboten ist.  </p>
+
+<p>Na dann mal los. Rein in die Sportklamotten und raus aus dem Ort, ab in
+&ouml;stlicher Richtung. Anfangs eiern wir noch wegen des Schlamms ein wenig
+durch die Gegend (hoffentlich haben wir dadurch nicht zu viel Zeit verloren!),
+aber bald k&ouml;nnen wir &mdash; nein, m&uuml;ssen wir &mdash; Tempo aufnehmen
+&mdash; soweit es uns eben die verschlungene Holzbohlen-Konstruktion erlaubt.
+Blo&szlig; kein Fehltritt, konzentriert bleiben und das Tempo halten. Geschafft!
+Das war knapp! Erst mal verschnaufen, und dann das schwer erk&auml;mpfte
+&quot;Fundst&uuml;ck&quot; abliefern. Und wie versprochen &mdash; manus manum
+lavat &mdash; l&auml;sst B.B. seine Beziehungen spielen, und bald darauf sind
+wir einen Schritt (i.e. ein fl-bridge-closed) weiter. Feierabend f&uuml;r heute.
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_f.png" alt="Level des Monats" border="0">
+<div class="imagetitle">&quot;Schwingen&quot; &uuml;ber den T&uuml;mpel</div>
+</div>
+
+<p>Am folgenden Morgen machen wir uns auf zum n&auml;chsten Hilfsbereiten. Big
+Bill Marble w&uuml;rde uns ja gerne helfen, wozu er aber einen Schl&uuml;ssel
+ben&ouml;tige, seinen &quot;Key to the Highway&quot; wie er das gute St&uuml;ck
+nennt, den er bei seiner letzten Rock'n'Roll Show im Musiktheather &quot;Die
+H&ouml;hle&quot; westlich der Ortschaft vergessen habe, meint der gute Mann. Na
+toll! Wenigstens liegt &quot;Die H&ouml;hle&quot; auf dem Weg zu demjenigen, der
+uns als dritte Anlaufstelle f&uuml;r Unterst&uuml;tzung genannt wurde.
+Wohlweislich r&uuml;sten wir uns f&uuml;r den &quot;H&ouml;hlentrip&quot;
+entsprechend aus. Zun&auml;chst geht's zum westlichen Ortsausgang raus, um dann
+sofort nach S&uuml;den abzuschwenken. Die reinste Rutschbahn ist das. Tja, doch
+dann ist unser weiterer Weg durch einen T&uuml;mpel versperrt. Da kommen wir nur
+mit dem richtigen Schwung dr&uuml;ber. Es ist nur zu hoffen, dass wir auf der
+anderen Seite wegen des Schlamms nicht die Kontrolle verlieren. Na dann &hellip;
+Uff, gerade noch mal gut gegangen. Und weiter.  </p>
+
+<p>Schon sind wir bei der &quot;H&ouml;hle&quot; angekommen, und nachdem auf
+unser Klopfen niemand reagiert, schlagen wir kurzerhand die T&uuml;r ein und
+nehmen den verlorengegangenen Schl&uuml;ssel an uns. S&uuml;dlich der
+&quot;H&ouml;hle&quot; biegen wir nach Westen ab, um den Dritten auf unserer
+Liste aufzusuchen. Im Folgenden versuchen uns zwei B&auml;che am erfolgreichen
+Weiterkommen zu hindern. Doch mit dem richtigen Schwung und der n&ouml;tigen
+Pr&auml;zision meistern wir auch dieses Hindernis. &quot;Tut mir furchtbar leid,
+aber da kann ich beim besten Willen nicht weiterhelfen,&quot; ist zun&auml;chst
+alles, was wir von Little Walter Marble ernten. &quot;Fragt mal heute Abend in
+der Kneipe nach, die sich am Ende der Seitengasse s&uuml;dlich des Marktplatzes
+befindet. Sagt, dass ich euch geschickt habe. Everything's gonna be
+alright.&quot; Was auch immer das bedeuten mag, mit diesem nicht gerade
+erfolgversprechenden Ratschlag machen wir uns auf den R&uuml;ckweg in die
+Ortschaft.  </p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_g.png" alt="Level des Monats" border="0">
+<div class="imagetitle">Die H&ouml;hle: Big Bills verlorener Schl&uuml;ssel</div>
+</div>
+
+<p>Kneipe w&auml;re heute sowieso angesagt gewesen, warum also der besagten
+Lokalit&auml;t keinen Besuch abstatten? Gesagt, getan. Auf unsere Fragen hin
+werden wir zun&auml;chst vertr&ouml;stet: Derjenige, der uns weiterhelfen
+k&ouml;nne, k&auml;me erst etwas sp&auml;ter. Wir machen es uns gem&uuml;tlich.
+Mit dem s&uuml;ffigen Landwein haben wir schnell Freundschaft geschlossen, das
+Essen ist ebenfalls gut, die Stimmung passt. Da macht sogar das Warten
+Spa&szlig;. Irgendwann sp&auml;ter trifft auch der von uns Erwartete ein und
+gesellt sich kurz darauf zu uns. Auf seine Frage, was wir denn von ihm wollten,
+kl&auml;ren wir ihn &uuml;ber unsere Probleme auf. Bei einigen (oder doch
+mehreren?) Gl&auml;schen sichert uns John Lee Marble seine Unterst&uuml;tzung zu
+und gibt uns noch einige hilfreiche Tipps. Was dann noch kommt &hellip; </p>
+
+<h4>&quot;Der Frustfaktor bei &quot;River of Challenges&quot; ist
+vergleichsweise gering&quot;</h4>
+
+<div class="quote">&quot;River of Challenges&quot; ist recht &uuml;bersichtlich
+gestaltet, so dass man den ganzen Level anschauen kann, ohne richtig loszulegen.
+Gleichzeitig hat man ein wenig Freiheit dabei, in welcher Reihenfolge man die
+einzelnen &quot;Herausforderungen&quot; angeht, so dass es sich auch f&uuml;r
+unge&uuml;bte Spieler lohnt, hier einmal hineinzuschnuppern. Wenn man den Level
+l&ouml;sen will, muss man aber sowohl etwas Geschick beim Steuern der Kugel
+haben, als auch ein wenig logisch denken k&ouml;nnen, um bei den
+Verschieber&auml;tseln keine Fehler zu machen.  </div>
+
+<div class="quote">Zum Gl&uuml;ck kann man eine der kritischsten Stellen,
+n&auml;mlich den Wettlauf mit dem Laserstrahl gleich zu Beginn erledigen, so
+dass der Frustfaktor bei &quot;River of Challenges&quot; vergleichsweise gering
+ist. Auch die L&ouml;sung der Denkaufgaben erfordert keine Geniestreiche, wenn
+man mal von zwei &quot;Stolperfallen&quot; absieht, mit denen ich mich lange
+herumgeplagt habe: </div>
+
+<div class="quote">1) Wo bekomme ich mehr Dynamit her, um den Raum mit dem
+Schl&uuml;ssel freizusprengen? </div>
+
+<div class="quote">2) Warum komme ich nicht weiter, wenn ich im oberen Teil des
+&quot;Flusses&quot; (analog zu unten rechts) eine Br&uuml;cke baue? </div>
+
+<div class="quote">Irgendwann erreicht man dann (hoffentlich) einen Punkt, an
+dem man jeden einzelnen Teil des Levels (wenigstens theoretisch) im Griff hat.
+Dann ist es nur noch eine Frage der Zeit? </div>
+
+<div class="author">Craven</div>
+
+<!--<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_h.png" alt="Level des Monats" border="0">
+<div class="imagetitle">The Cave: For Members Only</div>
+</div>-->
+
+<!--<p><img class="leftimage" src="$$imagedir$$/lotm/lotm_200809_x.png"
+alt="EoYA 2007" border="0"></p>-->
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200809_x.png" alt="Level des Monats" border="0">
+</div>
+
+<p>Oh Gott, warum ist es heute Morgen nur so hell, und warum ist mein Kopf so
+schwer? Ach ja, gestern abend, oder war das schon heute morgen, sind wohl ein
+'bisschen' verhockt? So wie es uns momentan geht, kann &mdash; nein, muss
+&mdash; das nur ein paar Stunden her sein. Egal. Dann wird heute einfach eine
+Pause eingelegt. &mdash; Halt, da war doch noch was. &mdash; Wenn wir uns nur
+nicht so mies f&uuml;hlen w&uuml;rden. &mdash; Hatten wohl &quot;einen Bourbon,
+einen Scotch, ein Bier&quot; oder was auch immer zu viel? &mdash; Was war da
+nochmal? &mdash; Eigentlich wollten wir heute &hellip; die Br&uuml;cke &hellip;
+die &quot;Sehensw&uuml;rdigkeit&quot; nord&ouml;stlich der Stadt &hellip; Genau!
+Aber sollen wir uns das heute wirklich antun? Naja, nachdem die Leute sich so
+f&uuml;r uns eingesetzt haben, k&ouml;nnen wir die jetzt schlecht
+entt&auml;uschen. Wird schon nicht so schlimm werden. Nach einer Kanne Kaffee,
+aber immer noch nicht ganz so fit, begeben wir uns gem&auml;chlich an den
+heutigen Ort des Geschehens.  </p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_e.png" alt="Level des Monats" border="0">
+<div class="imagetitle">What shall we do <br> with the stuff from the river?
+<br> &hellip; early in the mornin' &hellip;</div>
+</div>
+
+<p>Super, die n&ouml;rdliche Br&uuml;cke ist wieder benutzbar. Bis auf den
+matschigen Weg sieht die anderen Seite echt okay aus. Doch halt, was ist denn
+das? Kurz vor unserem Ziel ist alles meterhoch &uuml;berflutet. &mdash; Hatte
+unser gestriger Zechkumpan John Lee nicht irgendwann erw&auml;hnt, dass in der
+N&auml;he gen&uuml;gend Zeug rumliegen w&uuml;rde, das wir problemlos verwenden
+k&ouml;nnten? &quot;Cover the waterfront &hellip; Process&hellip; Think twice
+before you go&quot; oder so was in der Art hat er vor sich hin gemurmelt. Na
+klar, bei unserer Ankunft hier vor einigen Tagen sind wir fast &uuml;ber das
+&quot;Zeug&quot; gestolpert. Ein Gutes hat die Sache jedoch, bei der uns
+bevorstehenden Plackerei wird der Restalkohol mit ziemlicher Sicherheit
+abgebaut. Als wir kurz darauf das erste Teil ans linke Flussufer geschafft
+haben, ergibt sich nur ein kleines Problemchen: Wie bekommen wir es r&uuml;ber?
+Wir wuchten es hin und her, aber es wird nichts. Denk nach! Wenn das mit dem
+Kopf nur so einfach ginge. Wenn wir allerdings &hellip; dann &hellip; und mit
+&hellip; Ja, so sollte es klappen.  </p>
+
+<p>Und tats&auml;chlich &mdash; endlich haben wir unser letztes Ziel erreicht.
+Die Anspannung l&ouml;st sich. Die Anstrenungen der letzten Tage sind
+Vergangenheit. Was bleibt ist die Genugtuung, alle Herausforderungen erfolgreich
+bestanden zu haben. Dass am Abend in besagter Kneipe nicht zu knapp gefeiert
+wird, soll nicht unterschlagen werden. &Uuml;ber die Folgen wollen wir aber
+diesmal besser keine Worte verlieren&hellip; </p>
+
+<h4>&quot;Genau eine Art von Level fehlte noch in meiner Sammlung&quot;</h4>
+
+<div class="quote">Ich freue mich sehr &uuml;ber diese Auszeichnung. Es ist
+schon ein bisschen her, dass ich dieses Level geschrieben habe, aber ich
+versuche trotzdem mal, ob ich noch alles zusammenkriege: </div>
+
+<div class="quote">Dadurch, dass &quot;River of Challenges&quot; nun zum Level
+des Monats wurde, schlie&szlig;t sich in gewisser Weise ein Kreis. Denn die Idee
+zu diesem Level entstand kurz nach dem ich den ersten LdM-Artikel gelesen hatte,
+in dem eines von Duffys Meisterwerken (an das ich mich zugegebenerma&szlig;en
+noch nie wirklich herangetraut habe) beschrieben wurde. Dadurch fiel mir
+n&auml;mlich auf, dass genau diese Art von Level in meiner doch schon etwas
+gr&ouml;&szlig;eren Sammlung an Levels (wenn auch nicht so gro&szlig; wie die
+des vorher genannten Autors &mdash; aber welche ist das schon?) ;) fehlte: Ein
+riesiges Level, das viele kleinere R&auml;tsel enth&auml;lt, und das alle
+Enigma-typischen Eigenschaften vom Spieler verlangt. </div>
+
+<div class="quote">Die Idee, mehrere Puzzlesteine zur Bef&ouml;rderung
+zusammenzusetzen und sie daraufhin wieder zu trennen, hatte ich schon einige
+Zeit zuvor, und so sind die oberen beiden R&auml;ume auch recht schnell
+entstanden. Gl&uuml;cklicherweise bot genau dieses R&auml;tsel die
+M&ouml;glichkeit f&uuml;r mich, sowohl vom Design als auch vom Spielprinzip her
+ein Grundkonzept zu erstellen. Der Weg, der zur anderen Seite f&uuml;hrte wurde
+einfach unterbrochen und musste durch verschiedene Aktionen im unteren
+Levelbereich wieder vervollst&auml;ndigt werden. Als Hauptdesignelement eignete
+sich die Wasserfl&auml;che perfekt, da ich diese einfach ausbauen und somit als
+Flu&szlig; gestalten konnte. </div>
+
+<div class="quote">Danach ging es daran, den unteren Teil des Levels mit
+verschiedenen Herausforderungen aufzuf&uuml;llen. Mein eigentliches Ziel war es,
+das Level zwar non-linear zu gestalten &mdash; jeder Teil sollte ohne
+gr&ouml;&szlig;ere Probleme vom Start aus erreichbar und &uuml;bbar sein &mdash;
+aber dennoch nur eine Reihenfolge zuzulassen, in der die einzelnen Teile
+gel&ouml;st werden m&uuml;ssen. Ganz geklappt hat das nicht: Die meisten
+R&auml;tsel sind v&ouml;llig unabh&auml;ngig von den anderen. Aber gerade an der
+Laser/st-break-Kombination kann man Ans&auml;tze davon erahnen. Und auch dass
+ich immer noch den Rekord f&uuml;r dieses Level halte spricht wohl daf&uuml;r,
+dass es &mdash; zeitlich gesehen &mdash; (fast) nur einen optimalen Weg gibt.
+</div>
+
+<div class="quote">Nachdem ich die erste Version erstellt und an die Entwickler
+geschickt hatte, war das Level allerdings noch lange nicht fertig. Hier nochmals
+vielen Dank an Raoul, Ronald und Andreas, die besonders dabei geholfen haben,
+den linken, bis dahin noch etwas leeren Teil des Levels aufzuf&uuml;llen. Nach
+vielen weiteren kleineren Ver&auml;nderungen war das Level dann endlich fertig
+und bereit, ins Spiel aufgenommen zu werden. </div>
+
+<div class="quote">Mit ein paar Punkten bin ich im Nachhinein gesehen etwas
+unzufrieden &mdash; etwa dass das zentrale R&auml;tsel nicht wirklich zentral
+liegt, oder auch dass eben dieses etwas langwierig ist &mdash; aber im
+Gro&szlig;en und Ganzen bin ich doch mit meinem erstem und bis jetzt einzigem
+gro&szlig;en Level zufrieden. Wer wei&szlig;, vielleicht werden ja weitere in
+der Zukunft folgen? </div>
+
+<div class="author">Lukas</div>
+
+<p>Es ist wohl mehr als selbstverst&auml;ndlich, dass sich nach diesem
+&quot;Urlaub&quot; unsere Murmel erst einmal wieder bei der t&auml;glichen
+Arbeit (weit weg von der Natur) von den Strapazen erholen muss. Sie kann ja noch
+nicht ahnen, dass Einiges von dem &quot;Zeug&quot; vom Flussufer eine nicht ganz
+unwesentliche Rolle spielen wird bei der Bew&auml;ltigung der betrieblichen
+Aufgaben, die sie an ihrem Arbeitsplatz in Produktionshalle 6098 erwarten
+werden. Dar&uuml;ber n&auml;chsten Monat mehr. Dank gilt auf jeden Fall Lukas
+Sch&uuml;ller, der uns tiefere Einsichten vermittelt hat, was eine Murmel so in
+ihrem Urlaub treibt, und warum sie bisweilen bei den
+&quot;Herausforderungen&quot; an der Arbeit so schlapp erscheint. </p>
+
+<p><i>NObby und Harry</i></p>
+
+<p>Liebe Leserin, lieber Leser, wir haben ein st&auml;ndiges Bed&uuml;rfnis nach
+Ihren Artikeln &uuml;ber Enigmas gro&szlig;e Levels. Bitte, schicken Sie uns
+jeden Artikel, sogar Kommentare, die Sie geschrieben haben, an:</p>
+<pre>
+<a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
+</pre>
+<p>Wir sind besonders interessiert an Artikeln &uuml;ber die folgenden Levels:
+</p>
+<ul>
+<li>&quot;Plan Ahead&quot; von Jacob Scott</li>
+<li>&quot;Procrustes&quot; von Andreas Lochmann</li>
+<li>&quot;Little Puzzles&quot; von Jon 'WB' Sneyers</li>
+</ul>
+<p>Vielen Dank im voraus, nur Ihre Mithilfe kann den LdM am Leben erhalten!
+</p>
+<p><i>Ihr Enigma-Team</i></p>
+
+</div>
+



From ral at mail.berlios.de  Sun Sep 14 21:16:55 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 14 Sep 2008 21:16:55 +0200
Subject: [Enigma-game-svn] r1323 - trunk/src
Message-ID: <200809141916.m8EJGtb1031928@sheep.berlios.de>

Author: ral
Date: 2008-09-14 21:16:54 +0200 (Sun, 14 Sep 2008)
New Revision: 1323

Modified:
   trunk/src/lua.cc
Log:
Trunk 1.1:  new API 
- Lua basic API support:
  - add position unary minus operator
  - add position method "exists()" as a check if position is inside world
  - improve handling of invalid object references: ignore message calls


Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-09-13 22:38:26 UTC (rev 1322)
+++ trunk/src/lua.cc	2008-09-14 19:16:54 UTC (rev 1323)
@@ -935,6 +935,19 @@
     return pushNewPosition(L);
 }
 
+static int minusPosition(lua_State *L) {
+    // pos  + ?? (some undocumented garbage is on the stack!!)    
+    lua_getmetatable(L, 1);
+    lua_rawgeti(L, -1, 1);
+    double x = lua_tonumber(L, -1);
+    lua_rawgeti(L, -2, 2);
+    double y = lua_tonumber(L, -1);
+    lua_pushnumber(L, -x);
+    lua_pushnumber(L, -y);
+
+    return pushNewPosition(L);
+}
+
 static int addPositionsBase(lua_State *L, int factorArg2) {
     // (pos|obj|table) +|- (pos|obj|table)
     double x = 0;
@@ -1072,6 +1085,17 @@
     return 1;
 }
 
+static int existsPosition(lua_State *L) {
+    // position guaranteed
+    lua_getmetatable(L, -1);
+    lua_rawgeti(L, -1, 1);
+    lua_rawgeti(L, -2, 2);
+    int x = round_down<int>(lua_tonumber(L, -2));
+    int y = round_down<int>(lua_tonumber(L, -1));
+    lua_pushboolean(L, IsInsideLevel(GridPos(x, y)));
+    return 1;
+}
+
 static int pushNewTile(lua_State *L, int numArgs, std::string key="") {
     // numArgs 1 or 2 of type (table|tile)
     int *udata;
@@ -1556,20 +1580,18 @@
     } else {
         // attribute
         Value val;  // nil
-        if (obj) {
-            if ((keyStr.find('_') != 0) &&  obj->validateMessage(keyStr, Value(Value::DEFAULT))) {
-                // it is a valid public message - try to send it
-                messageLIFO.push_back(keyStr);
-                lua_pushcfunction(L, objectDirectMessage);
-            } else {
-                val = obj->getAttrChecked(keyStr);
-                // user attribute, existing system attribute or nil if no object
-                push_value(L, val);
-            }
+        if ((keyStr.find('_') != 0) && (obj == NULL || obj->validateMessage(keyStr, Value(Value::DEFAULT)))) {
+            // it is a valid public message - try to send it
+            messageLIFO.push_back(keyStr);
+            lua_pushcfunction(L, objectDirectMessage);
+        } else if (obj != NULL) {
+            val = obj->getAttrChecked(keyStr);
+            // user attribute, existing system attribute or nil if no object
+            push_value(L, val);
         } else {
             // access of no longer existing object - ignore it and return nil
             push_value(L, val);
-        } 
+        }
         return 1;
     }
     return 0;
@@ -2829,12 +2851,14 @@
     {multiplyPositions,             "__mul"},      //  obj * obj
     {dividePositions,               "__div"},      //  obj / obj
     {centerPosition,                "__len"},      //  #obj
+    {minusPosition,                 "__unm"},      //  -obj
     {0,0}
 };
 
 static CFunction positionMethods[] = {
     {xyPosition,                    "xy"},
     {gridAlignPosition,             "grid"},
+    {existsPosition,                "exists"},
     {0,0}
 };
 



From ral at mail.berlios.de  Sun Sep 14 23:09:54 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 14 Sep 2008 23:09:54 +0200
Subject: [Enigma-game-svn] r1324 - in trunk/data: . levels/lib
Message-ID: <200809142109.m8EL9stY010279@sheep.berlios.de>

Author: ral
Date: 2008-09-14 23:09:54 +0200 (Sun, 14 Sep 2008)
New Revision: 1324

Modified:
   trunk/data/api2init.lua
   trunk/data/levels/lib/libpuzzle_3.xml
Log:
Trunk 1.1: new API reengineering
- fix drawMap to call resolver finalizers
- puzzle part 3:
  - handle multiple hollow puzzle stone shuffling
  - make resolver reusable for multiple drawMap usage


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-09-14 19:16:54 UTC (rev 1323)
+++ trunk/data/api2init.lua	2008-09-14 21:09:54 UTC (rev 1324)
@@ -244,6 +244,15 @@
                 end
             end
         end
+        -- Call resolver finalizers
+        local context = resolver
+        while type(context) == "table" do
+            local finalizer = context[2]
+            if type(finalizer) == "function" then
+               finalizer(context) 
+            end
+            context = context[3]
+        end
     end
 )
 

Modified: trunk/data/levels/lib/libpuzzle_3.xml
===================================================================
--- trunk/data/levels/lib/libpuzzle_3.xml	2008-09-14 19:16:54 UTC (rev 1323)
+++ trunk/data/levels/lib/libpuzzle_3.xml	2008-09-14 21:09:54 UTC (rev 1324)
@@ -16,7 +16,7 @@
     </el:info>
     <el:luamain><![CDATA[
 function res.puzzle_finalization(context)
-    print("puzzle final - num pos "..#context[5])
+--    print("puzzle final - num pos "..#context[5])
     local stones = {}
     for i, ppos in ipairs(context[5]) do
         local stone = st(context[5][i])
@@ -41,7 +41,7 @@
     local offsets = {po(-1,0), po(0,1), po(1,0), po(0,-1)}
     local dirchars = {"w","s","e","n"}
     for h, huddle in ipairs(huddles) do
-        print("puzzle final - shuffle huddle of size "..#huddle)
+--        print("puzzle final - shuffle huddle of size "..#huddle)
         local pfloors = fl(huddle)
         local pushes = {}
         local intensity = 0
@@ -56,7 +56,7 @@
         for puz in huddle do
             for dir, offset in ipairs(offsets) do
                 local cand = puz - offset
-                if cand.x >= 0 and cand.x < width and cand.y >= 0 and cand.y < height then
+                if cand:exists() then
                     local cfloor = fl(cand)
                     if pfloors[cfloor] == nil then
                         local may_push = true
@@ -69,8 +69,7 @@
                         if may_push then
                             local length = 1
                             local lpos = puz + offset
-                            while lpos.x >= 0 and lpos.x < width and lpos.y >= 0 and lpos.y < height
-                                    and pfloors[fl(lpos)] ~= nil do
+                            while lpos:exists() and pfloors[fl(lpos)] ~= nil do
                                 length = length + 1
                                 lpos = lpos + offset
                             end
@@ -84,20 +83,28 @@
             end
         end
         intensity = intensity * #huddle
-        local maxp = math.floor(math.sqrt(intensity))
         while intensity > 0 and #pushes > 0 do
             local pidx = random(#pushes)  -- select a random push pos/dir
-            local nump = random(math.min(pushes[pidx][3],
-                            math.max(maxp, intensity)))  -- number of pushes 
+            local puzz = st(pushes[pidx][1])
+            local dir = pushes[pidx][2]
+            local length = pushes[pidx][3]
+            local nextpuzz = st(puzz + offsets[dir + 1])
             
-            intensity = intensity - nump
-            for i = 1, nump do 
-                if not (st(pushes[pidx][1] + offsets[pushes[pidx][2] + 1]))["hollow"] then
-                    st(pushes[pidx][1]):pull_rotate(pushes[pidx][2])
-                end
+            -- check for leading sequence of hollow puzzles
+            while length > 2 and puzz["hollow"] and nextpuzz["hollow"] do
+                puzz = nextpuzz
+                nextpuzz = st(puzz + offsets[dir + 1])
+                length = length - 1
             end
+            
+            if not nextpuzz["hollow"] then
+                puzz:pull_rotate(dir)
+                intensity = intensity - 1
+            end
         end
     end
+    -- cleanup for subsequent calls
+    context[5] = {}
 end
 
 function res.puzzle_newtile(key, template, suffix)



From ral at mail.berlios.de  Sun Sep 14 23:14:07 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 14 Sep 2008 23:14:07 +0200
Subject: [Enigma-game-svn] r1325 - team_levelpacks/team_test_new_api
Message-ID: <200809142114.m8ELE7Th010476@sheep.berlios.de>

Author: ral
Date: 2008-09-14 23:13:59 +0200 (Sun, 14 Sep 2008)
New Revision: 1325

Modified:
   team_levelpacks/team_test_new_api/ralT069_1.xml
Log:
Test Level new API:
- puzzle lib test level extended



Modified: team_levelpacks/team_test_new_api/ralT069_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT069_1.xml	2008-09-14 21:09:54 UTC (rev 1324)
+++ team_levelpacks/team_test_new_api/ralT069_1.xml	2008-09-14 21:13:59 UTC (rev 1325)
@@ -23,6 +23,7 @@
 ti[".."] = {"fl-sahara", push_directions="nesw"}
 ti["++"] = {"fl-sahara", push_directions="w"} .. ti{"st_window_s", secure=true}
 ti["##"] = {"st-rock1"}
+ti["S#"] = {"st_switch", target="newpuz"}
 
 ti["P"] = {"st_puzzle_blue"}
 ti["H"] = {"st_puzzle_blue", hollow=true}
@@ -35,21 +36,42 @@
 puzz = res.puzzle(ti, "P","H", "S", "M", "C")
 
 w, h = wo(puzz, "  ", {
-"              P7P7P7          ..  ",
-"  P1P1    @@  P7P7P7    M1M1  M1  ",
-"  P1P1        P7P7P7  ..M1M1M1M1  ",
-"                                  ",
-"            P1P1                  ",
-"      Pj    PjP2  ##########      ",
-"            P2P2  ##C1C1C1##      ",
-"P3P3P3            ##C1C1C1++      ",
-"P3P3P3            ##C1C1C1C1##..  ",
-"P3H3P3      S1      ..####C1##C1##",
-"P3P3P3      S1S1        ..C1C1C1##",
-"          S1S1S1          ####C1##",
-"                              ####"
+"              P7P7P7          ..    ",
+"  P1P1        P7P7P7    M1M1  M1M1..",
+"  P1P1        P7P7P7  ..M1M1M1H1M1..",
+"                              M1M1..",
+"            P1P1                ..  ",
+"      Pj    PjP2  ##########        ",
+"            P2P2  ##C1C1C1##        ",
+"P3P3P3            ##C1C1C1++        ",
+"P3P3P3            ##C1C1C1C1##..    ",
+"P3H3P3      S1      ..####C1##C1##  ",
+"P3P3P3      S1S1        ..C1C1C1##  ",
+"          S1S1S1          ####C1##  ",
+"                  @@          ####  ",
+"                                    ",
+"    P3P3P3            P3P3P3P3P3    ",
+"    P3H3P3            HoP3H3P3P3    ",
+"    P3H3P3P3P3        P3P3P3P3P3    ",
+"    P3P3P3P3P3        P3P3HoP3P3    ",
+"    P3P3P3P3P3                      ",
+"                                    ",
+"S#                                  ",
+"                                    ",
+"                                    ",
+"                                    ",
+"                                    ",
+"                                    "
 })
 
+function newpuz(value, sender)
+    wo:drawMap(puzz, sender, "  ", {
+        "      P3P3P3P3P3",
+        "    P3P3P3P3"
+    })
+end
+
+
     ]]></el:luamain>
     <el:i18n>
 	 <el:string el:key="title">



From raoul at mail.berlios.de  Mon Sep 15 02:01:18 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Mon, 15 Sep 2008 02:01:18 +0200
Subject: [Enigma-game-svn] r1326 - team_levelpacks/team_test_new_api
Message-ID: <200809150001.m8F01IKt018025@sheep.berlios.de>

Author: raoul
Date: 2008-09-15 02:01:17 +0200 (Mon, 15 Sep 2008)
New Revision: 1326

Added:
   team_levelpacks/team_test_new_api/raoulT08_1.xml
Log:
-> Testlevel with all puzzle pieces



Added: team_levelpacks/team_test_new_api/raoulT08_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT08_1.xml	2008-09-14 21:13:59 UTC (rev 1325)
+++ team_levelpacks/team_test_new_api/raoulT08_1.xml	2008-09-15 00:01:17 UTC (rev 1326)
@@ -0,0 +1,140 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Puzzle Pieces new API" el:subtitle="" el:id="raoul08"/>
+      <el:version el:score="1" el:release="1" el:revision="0" el:status="experimental"/>
+      <el:author  el:name="Raoul Bourquin" el:email="raoul at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Raoul Bourquin</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti["  "] = {"fl-sahara"}
+
+ti["B0"] = {"st_puzzle_blue"}
+ti["B1"] = {"st_puzzle_blue", connections="w"}
+ti["B2"] = {"st_puzzle_blue", connections="s"}
+ti["B3"] = {"st_puzzle_blue", connections="sw"}
+
+ti["B4"] = {"st_puzzle_blue", connections="e"}
+ti["B5"] = {"st_puzzle_blue", connections="ew"}
+ti["B6"] = {"st_puzzle_blue", connections="es"}
+ti["B7"] = {"st_puzzle_blue", connections="esw"}
+
+ti["B8"] = {"st_puzzle_blue", connections="n"}
+ti["B9"] = {"st_puzzle_blue", connections="wn"}
+ti["Ba"] = {"st_puzzle_blue", connections="ns"}
+ti["Bb"] = {"st_puzzle_blue", connections="nsw"}
+
+ti["Bc"] = {"st_puzzle_blue", connections="ne"}
+ti["Bd"] = {"st_puzzle_blue", connections="new"}
+ti["Be"] = {"st_puzzle_blue", connections="nes"}
+ti["Bf"] = {"st_puzzle_blue", connections="nesw"}
+
+
+ti["b0"] = {"st_puzzle_blue", hollow=true}
+ti["b1"] = {"st_puzzle_blue", connections="w", hollow=true}
+ti["b2"] = {"st_puzzle_blue", connections="s", hollow=true}
+ti["b3"] = {"st_puzzle_blue", connections="sw", hollow=true}
+
+ti["b4"] = {"st_puzzle_blue", connections="e", hollow=true}
+ti["b5"] = {"st_puzzle_blue", connections="ew", hollow=true}
+ti["b6"] = {"st_puzzle_blue", connections="es", hollow=true}
+ti["b7"] = {"st_puzzle_blue", connections="esw", hollow=true}
+
+ti["b8"] = {"st_puzzle_blue", connections="n", hollow=true}
+ti["b9"] = {"st_puzzle_blue", connections="wn", hollow=true}
+ti["ba"] = {"st_puzzle_blue", connections="ns", hollow=true}
+ti["bb"] = {"st_puzzle_blue", connections="nsw", hollow=true}
+
+ti["bc"] = {"st_puzzle_blue", connections="ne", hollow=true}
+ti["bd"] = {"st_puzzle_blue", connections="new", hollow=true}
+ti["be"] = {"st_puzzle_blue", connections="nes", hollow=true}
+ti["bf"] = {"st_puzzle_blue", connections="nesw", hollow=true}
+
+
+ti["Y0"] = {"st_puzzle_yellow"}
+ti["Y1"] = {"st_puzzle_yellow", connections="w"}
+ti["Y2"] = {"st_puzzle_yellow", connections="s"}
+ti["Y3"] = {"st_puzzle_yellow", connections="sw"}
+
+ti["Y4"] = {"st_puzzle_yellow", connections="e"}
+ti["Y5"] = {"st_puzzle_yellow", connections="ew"}
+ti["Y6"] = {"st_puzzle_yellow", connections="es"}
+ti["Y7"] = {"st_puzzle_yellow", connections="esw"}
+
+ti["Y8"] = {"st_puzzle_yellow", connections="n"}
+ti["Y9"] = {"st_puzzle_yellow", connections="wn"}
+ti["Ya"] = {"st_puzzle_yellow", connections="ns"}
+ti["Yb"] = {"st_puzzle_yellow", connections="nsw"}
+
+ti["Yc"] = {"st_puzzle_yellow", connections="ne"}
+ti["Yd"] = {"st_puzzle_yellow", connections="new"}
+ti["Ye"] = {"st_puzzle_yellow", connections="nes"}
+ti["Yf"] = {"st_puzzle_yellow", connections="nesw"}
+
+
+ti["y0"] = {"st_puzzle_yellow", hollow=true}
+ti["y1"] = {"st_puzzle_yellow", connections="w", hollow=true}
+ti["y2"] = {"st_puzzle_yellow", connections="s", hollow=true}
+ti["y3"] = {"st_puzzle_yellow", connections="sw", hollow=true}
+
+ti["y4"] = {"st_puzzle_yellow", connections="e", hollow=true}
+ti["y5"] = {"st_puzzle_yellow", connections="ew", hollow=true}
+ti["y6"] = {"st_puzzle_yellow", connections="es", hollow=true}
+ti["y7"] = {"st_puzzle_yellow", connections="esw", hollow=true}
+
+ti["y8"] = {"st_puzzle_yellow", connections="n", hollow=true}
+ti["y9"] = {"st_puzzle_yellow", connections="wn", hollow=true}
+ti["ya"] = {"st_puzzle_yellow", connections="ns", hollow=true}
+ti["yb"] = {"st_puzzle_yellow", connections="nsw", hollow=true}
+
+ti["yc"] = {"st_puzzle_yellow", connections="ne", hollow=true}
+ti["yd"] = {"st_puzzle_yellow", connections="new", hollow=true}
+ti["ye"] = {"st_puzzle_yellow", connections="nes", hollow=true}
+ti["yf"] = {"st_puzzle_yellow", connections="nesw", hollow=true}
+
+
+ti["@ "] = {"#ac-blackball"}  ..ti({"it_magicwand"})
+
+w, h = wo(ti, "  ", {
+"                                                                              ",
+"  @                                                                           ",
+"                                                                              ",
+"  B0      b0      Y0      y0                                                  ",
+"  B1      b1      Y1      y1                                                  ",
+"  B2      b2      Y2      y2                                                  ",
+"  B3      b3      Y3      y3                                                  ",
+"  B4      b4      Y4      y4                                                  ",
+"  B5      b5      Y5      y5                                                  ",
+"  B6      b6      Y6      y6                                                  ",
+"  B7      b7      Y7      y7                                                  ",
+"  B8      b8      Y8      y8                                                  ",
+"  B9      b9      Y9      y9                                                  ",
+"  Ba      ba      Ya      ya                                                  ",
+"  Bb      bb      Yb      yb                                                  ",
+"  Bc      bc      Yc      yc                                                  ",
+"  Bd      bd      Yd      yd                                                  ",
+"  Be      be      Ye      ye                                                  ",
+"  Bf      bf      Yf      yf                                                  ",
+"                                                                              ",
+"                                                                              ",
+"                                                                              "
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: team_levelpacks/team_test_new_api/raoulT08_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native



From raoul at mail.berlios.de  Mon Sep 15 02:03:07 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Mon, 15 Sep 2008 02:03:07 +0200
Subject: [Enigma-game-svn] r1327 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 src/stones
Message-ID: <200809150003.m8F037IC018149@sheep.berlios.de>

Author: raoul
Date: 2008-09-15 02:02:58 +0200 (Mon, 15 Sep 2008)
New Revision: 1327

Added:
   trunk/data/gfx32/st_puzzle.png
   trunk/data/gfx40/st_puzzle.png
   trunk/data/gfx48/st_puzzle.png
Removed:
   trunk/data/gfx32/it-hstrip.png
   trunk/data/gfx32/it-vstrip.png
   trunk/data/gfx40/it-hstrip.png
   trunk/data/gfx40/it-vstrip.png
   trunk/data/gfx48/it-hstrip.png
   trunk/data/gfx48/it-vstrip.png
   trunk/data/gfx48/st-puzzle.png
Modified:
   trunk/data/models-2d.lua
   trunk/src/stones/PuzzleStone.cc
Log:
-> New gfx for new puzzle pieces
-> Old gfx (st-puzzle.png) for gfx{32,40} not yet removed
-> Removed unused stripitem images



Deleted: trunk/data/gfx32/it-hstrip.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/it-vstrip.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx32/st_puzzle.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st_puzzle.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx40/it-hstrip.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/it-vstrip.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx40/st_puzzle.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st_puzzle.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx48/it-hstrip.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/it-vstrip.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-puzzle.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx48/st_puzzle.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st_puzzle.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-09-15 00:01:17 UTC (rev 1326)
+++ trunk/data/models-2d.lua	2008-09-15 00:02:58 UTC (rev 1327)
@@ -1033,11 +1033,11 @@
 
 -- st-puzzle* --
 do
-    DefSubimages("st-puzzle", {modelname="st-puzzlex",w=8,h=4})
-    for i=2,16  do DefSolidStone("st-puzzle"..i, "st-puzzlex"..i) end
-    for i=18,32 do DefSolidStone("st-puzzle"..i, "st-puzzlex"..i) end
-    DefShModel("st-puzzle1", "st-puzzlex1", "sh-puzzle1")
-    DefShModel("st-puzzle17", "st-puzzlex17", "sh-puzzle1")
+    DefSubimages("st_puzzle", {modelname="st_puzzlex",w=16,h=4,startindex=0})
+    -- Full puzzels
+    for i=0,31  do DefSolidStone("st_puzzle"..i, "st_puzzlex"..i) end
+    -- Hollow puzzels
+    for i=32,63  do DefShModel("st_puzzle"..i, "st_puzzlex"..i, "sh-puzzle1") end
 end
 
 -- st-rock3-break --
@@ -1366,7 +1366,7 @@
         local fadein = "oxyd"..flavor.."-fadein"
         local fadeout= "oxyd"..flavor.."-fadeout"
         local spotcolor = color
-        
+
         if (color >= 0) then
             spotcolor = color + 1 -- oxyd color 0..num_colors-1, file 1.., frames 1..
         else

Modified: trunk/src/stones/PuzzleStone.cc
===================================================================
--- trunk/src/stones/PuzzleStone.cc	2008-09-15 00:01:17 UTC (rev 1326)
+++ trunk/src/stones/PuzzleStone.cc	2008-09-15 00:02:58 UTC (rev 1327)
@@ -6,7 +6,7 @@
  * modify it under the terms of the GNU General Public License
  * as published by the Free Software Foundation; either version 2
  * of the License, or (at your option) any later version.
- *  
+ *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
@@ -31,15 +31,15 @@
         setAttr("connections", connections);
         setAttr("hollow", hollow);
     }
-    
+
     PuzzleStone::~PuzzleStone() {
         GameTimer.remove_alarm (this);
     }
-    
+
     std::string PuzzleStone::getClass() const {
         return "st_puzzle";
     }
-    
+
     void PuzzleStone::setAttr(const string& key, const Value &val) {
         if (key == "hollow") {
             if (val.to_bool() != (bool)(objFlags & OBJBIT_HOLLOW)) {
@@ -72,13 +72,13 @@
             //
             // enigma levels may create scramble messages using
             // AddScramble() and SetScrambleIntensity()
-    
+
             Direction dir = to_direction(m.value);
             PuzzleList c;
             int size = findLine(c, dir, (int)getAttr("color"));
-    
+
             // warning("received 'scramble'. dir=%s size=%i", to_suffix(dir).c_str(), size);
-    
+
             if (size >= 2) {
                 int count = IntegerRand(0, static_cast<int> (size-1));
                 while (count--)
@@ -105,28 +105,22 @@
         }
         return Stone::message(m);
     }
-    
+
     void PuzzleStone::setState(int extState) {
         // block all write attempts
     }
-    
+
     void PuzzleStone::init_model() {
         if (state == EXPLODING) {
             set_anim("st-explosion");
             return;
         }
-        int m = getConnections() + 1;
-        if (m == 1)
-            set_model("st-metal");
-        else {    
-            if ((objFlags & OBJBIT_HOLLOW) && m == 16)
-                m = 1;
-            if (getAttr("color") == YELLOW)
-                m += 16;
-            set_model(ecl::strf("st-puzzle%d", m));
-        }
+        int m = getConnections();
+        if (getAttr("color") == YELLOW) { m += 16; }
+        if ((objFlags & OBJBIT_HOLLOW)) { m += 32; }
+        set_model(ecl::strf("st_puzzle%d", m));
     }
-    
+
     void PuzzleStone::on_creation(GridPos p) {
         if (!(objFlags & OBJBIT_INIT)) {
             autoJoinCluster();
@@ -135,7 +129,7 @@
         activatePhoto();
         Stone::on_creation(p);
     }
-    
+
     void PuzzleStone::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
         if (state == IDLE && !(objFlags & OBJBIT_HOLLOW)) {
             DirectionBits addDirs = added_dirs(oldDirs, newDirs);
@@ -151,15 +145,15 @@
     void PuzzleStone::animcb() {
         KillStone(get_pos());
     }
-    
+
     bool PuzzleStone::is_transparent(Direction d) const {
         return objFlags & OBJBIT_HOLLOW;
     }
-    
+
     bool PuzzleStone::is_sticky(const Actor *a) const {
         return !(objFlags & OBJBIT_HOLLOW);
     }
-    
+
     bool PuzzleStone::allowsSpreading(Direction dir) const {
         return objFlags & OBJBIT_HOLLOW;
     }
@@ -167,11 +161,11 @@
     bool PuzzleStone::is_removable() const {
         return state == IDLE;
     }
-    
+
     bool PuzzleStone::isConnectable(Stone *other) const {
         return Stone::isConnectable(other) && (other->getAttr("color") == getAttr("color"));
     }
-    
+
     StoneResponse PuzzleStone::collision_response(const StoneContact &sc) {
         if ((objFlags & OBJBIT_HOLLOW) || state == EXPLODING)
             return STONE_PASS;
@@ -181,17 +175,17 @@
     void PuzzleStone::actor_hit(const StoneContact &sc) {
         if (objFlags & OBJBIT_HOLLOW)
             return;                 // Puzzle stone is hollow
-    
+
         if (state != IDLE)
             return;
-    
+
         Direction rotate_dir = reverse(contact_face(sc));
         Direction move_dir = get_push_direction(sc);
-    
+
         if (getAttr("color") == YELLOW) {
             if (explodeCluster())
                 return;
-    
+
             // 1) If unconnected puzzle stones -> try to move it
             if ((objFlags & OBJBIT_SINGLE) && move_dir != NODIR) {
                 // if cluster contains single stone
@@ -204,75 +198,75 @@
                     sound_event ("movesmall");
                 } else
                     rotateLine(rotate_dir);
-            } 
-            // 2) If more than one stone, 
-            else 
+            }
+            // 2) If more than one stone,
+            else
                 rotateLine(rotate_dir);
         }
         else {
             // BLUE
             bool has_magic_wand = player::WieldedItemIs (sc.actor, "it_magicwand");
-    
+
             // 1) Try to start explosion of complete cluster
             if (has_magic_wand && explodeCluster())
                 return;
-    
+
             // 2) Failed? Try to move the cluster
             if (move_dir != NODIR && moveCluster(true, move_dir, true)) {
                 sc.actor->send_impulse(get_pos(), move_dir);
                 return;
             }
-    
-            // 3) Last chance: try to rotate the row or column 
+
+            // 3) Last chance: try to rotate the row or column
             if (has_magic_wand) {
                 rotateLine(rotate_dir);
             }
         }
     }
-    
+
     void PuzzleStone::actor_contact (Actor *a) {
         if (state == EXPLODING || state == IGNITED)
             SendMessage(a, "shatter");
     }
-    
+
     void PuzzleStone::on_impulse(const Impulse& impulse) {
         if (state == IDLE) {
             bool    actor_with_wand = false;
-            if (Actor *ac = dynamic_cast<Actor*>(impulse.sender)) 
+            if (Actor *ac = dynamic_cast<Actor*>(impulse.sender))
                 actor_with_wand = player::WieldedItemIs(ac, "it_magicwand");
-    
+
             moveCluster(!actor_with_wand, impulse.dir);
         }
     }
 
     void PuzzleStone::on_move() {
-        if (!(objFlags & OBJBIT_HOLLOW)) 
+        if (!(objFlags & OBJBIT_HOLLOW))
             ShatterActorsInsideField (get_pos());
     }
-    
+
     void PuzzleStone::alarm() {
         explodeStone();
     }
-    
+
     void PuzzleStone::markPuzzle(bool visited) {
         if (visited != (bool)(objFlags & OBJBIT_VISITED))
             objFlags ^= OBJBIT_VISITED;
     }
-    
+
     void PuzzleStone::markList(PuzzleList &list, bool visited) {
         for (PuzzleList::iterator itr = list.begin(); itr != list.end(); ++itr)
             (*itr)->markPuzzle(visited);
     }
-    
+
     bool PuzzleStone::checkConnected(PuzzleList &todo, PuzzleStone * source, Direction dir, int color) {
         GridPos newpos = move(source->get_pos(), dir);
         PuzzleStone *pz = dynamic_cast<PuzzleStone*>(GetStone(newpos));
-    
+
         if ((pz ==  NULL) || (pz->getAttr("color") != color))
             return false;
-    
+
         DirectionBits cfaces = pz->getConnections();
-    
+
         if (has_dir(cfaces, reverse(dir))) {
             // Puzzle stone at newpos is connected to stone at curpos
             if (!(pz->objFlags & OBJBIT_VISITED)) {
@@ -285,25 +279,25 @@
             return false;
         }
     }
-    
+
     bool PuzzleStone::findFragment(PuzzleList &cluster, bool keepMarked) {
         // Use a depth first search to determine the group of all stones that
-        //   are connected to the current stone.  Returns true if the cluster is
-        //``complete'' in the sense defined above.
+        // are connected to the current stone.  Returns true if the cluster is
+        // ``complete'' in the sense defined above.
 
         bool is_complete = true;
         PuzzleList todo;
         todo.push_back(this);
         markPuzzle(true);
         int color = getAttr("color");
-    
+
         while (!todo.empty()) {
             PuzzleStone *pz = todo.back();
             todo.pop_back();
-        
+
             cluster.push_back(pz);
             DirectionBits cfaces = pz->getConnections();
-    
+
             if (has_dir(cfaces, NORTH))
                 is_complete &= checkConnected(todo, pz, NORTH, color);
             if (has_dir(cfaces, EAST))
@@ -313,7 +307,7 @@
             if (has_dir(cfaces, WEST))
                 is_complete &= checkConnected(todo, pz, WEST, color);
         }
-        
+
         if (!keepMarked)
             markList(cluster, false);
         return is_complete;
@@ -328,17 +322,17 @@
             }
         }
     }
-    
-    bool PuzzleStone::findAdjacents(PuzzleList &huddle) {    
+
+    bool PuzzleStone::findAdjacents(PuzzleList &huddle) {
         PuzzleList todo;
         todo.push_back(this);
         markPuzzle(true);
         int color = getAttr("color");
-    
+
         while (!todo.empty()) {
             PuzzleStone *pz = todo.back();
             todo.pop_back();
-    
+
             huddle.push_back(pz);
             checkNeighbor(todo, pz, NORTH, color);
             checkNeighbor(todo, pz, SOUTH, color);
@@ -347,11 +341,11 @@
         }
         markList(huddle, false);
     }
-        
+
     int PuzzleStone::findLine(PuzzleList &line, Direction dir, int color) {
         ASSERT(dir != NODIR, XLevelRuntime,
             "PuzzleStone: no direction in find_row_or_column_cluster");
-        
+
         int size = 0;
         GridPos p = get_pos();
         while (PuzzleStone *puzz = dynamic_cast<PuzzleStone*>(GetStone(p))) {
@@ -367,7 +361,7 @@
     bool PuzzleStone::moveCluster(bool waterSink, Direction dir, bool checkOnly) {
         PuzzleList cluster;
         bool isComplete = findFragment(cluster, true);
-        
+
         // Now check whether all stones can be placed at their new position
         bool move_ok = true;
         for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
@@ -381,21 +375,21 @@
                 }
             }
         }
-        
+
         markList(cluster, false);
         if (checkOnly || !move_ok) {
             return move_ok;
         }
-        
+
         // If the floor at a complete cluster's new position consists
         // exclusively of abyss or water, create a bridge instead of
         // moving the cluster.
         //
         // For partial clusters build bridges only on water and if the
         // wielded item is NOT the magic wand.
-    
+
         bool createBridge = true;
-    
+
         for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
             if (Floor *fl = GetFloor(move((*itr)->get_pos(), dir))) {
                 if (!((fl->is_kind("fl-abyss") && isComplete) || (fl->is_kind("fl-water") && (isComplete || waterSink)))) {
@@ -404,23 +398,23 @@
                 }
             }
         }
-        
+
         // Finally, either move the whole cluster or create a bridge
         sound_event("movebig");
         int size = cluster.size();
-        
+
         if (createBridge) {
             for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
                 SetFloor(move((*itr)->get_pos(), dir), MakeFloor("fl-gray"));
                 KillStone((*itr)->get_pos());
             }
-        } 
+        }
         else {
             for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
                (*itr)->sourcePos = (*itr)->get_pos();
                YieldStone((*itr)->sourcePos);
             }
-    
+
             for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
                 SetStone(move((*itr)->sourcePos, dir), *itr);
                 (*itr)->on_move();
@@ -429,7 +423,7 @@
         server::IncMoveCounter(size);
         return true;
     }
-    
+
     bool PuzzleStone::explodeCluster() {
         bool exploded = false;
 
@@ -437,7 +431,7 @@
         if (findFragment(cluster)) {
             PuzzleList huddle;
             findAdjacents(huddle);
-    
+
             // If all adjacent stones build one complete cluster explode it
 //            Log << "Huddle " << huddle.size() << " Cluster "<< cluster.size() << "\n";
             if (huddle.size() == cluster.size()) {
@@ -446,7 +440,7 @@
             else {
                 if (getAttr("color") == BLUE) {
                     // check if 'huddle' is made up of complete clusters :
-    
+
                     while (!huddle.empty()) {
                         // remove one complete cluster from 'huddle'
                         markList(cluster, true);
@@ -459,12 +453,12 @@
                             } else
                                ++itr;
                         }
-                            
+
                         if (huddle.empty()) { // none left -> all were complete
                             exploded = true;
                             break;
                         }
-    
+
                         // look for next complete cluster :
                         cluster.clear();
                         PuzzleStone *pz = huddle.front();
@@ -475,7 +469,7 @@
                 }
             }
         }
-        
+
         if (exploded) {
             if (getAttr("color") == BLUE)
                 findAdjacents(cluster);
@@ -490,19 +484,19 @@
             else
                 objFlags &= ~OBJBIT_SINGLE;
         }
-        
+
         return exploded;
     }
-    
+
     void PuzzleStone::explodeStone() {
         GridPos p = get_pos();
         int color = getAttr("color");
-    
+
         // exchange puzzle stone with explosion
         sound_event("stonedestroy");
         state = EXPLODING;
         init_model();
-    
+
         // trigger all adjacent puzzle stones :
         const double DEFAULT_DELAY = 0.2;
         triggerExplosion(move(p, NORTH), DEFAULT_DELAY, color);
@@ -510,7 +504,7 @@
         triggerExplosion(move(p, EAST),  DEFAULT_DELAY, color);
         triggerExplosion(move(p, WEST),  DEFAULT_DELAY, color);
     }
-    
+
     void PuzzleStone::triggerExplosion(GridPos p, double delay, int color) {
         PuzzleStone *puzz = dynamic_cast<PuzzleStone*>(GetStone(p));
         if (puzz && puzz->state == PENDING && puzz->getAttr("color") == color ) {
@@ -518,14 +512,14 @@
             puzz->ignite(delay);
         }
     }
-    
+
     void PuzzleStone::ignite(double delay) {
         if (state == PENDING) {
             state = IGNITED;
             GameTimer.set_alarm(this, delay, false);
         }
     }
-    
+
     void PuzzleStone::rotateLine(PuzzleList &line, bool forward) {
         PuzzleList::iterator itr = line.begin();
         PuzzleStone *pz1 = *itr;
@@ -539,19 +533,19 @@
                     GridPos p2 = pz2->get_pos();
                     YieldStone(p2);
                     SetStone(p2, pz1);
-                    pz1 = pz2; 
+                    pz1 = pz2;
                 } else {
                     PuzzleStone *pz2 = *itr;
                     GridPos p2 = pz2->get_pos();
                     YieldStone(p2);
                     SetStone(p1, pz2);
-                    p1 = p2; 
+                    p1 = p2;
                 }
             }
             SetStone(p1, pz1);
         }
     }
-    
+
     void PuzzleStone::rotateLine(Direction dir, bool forward) {
         if (dir != NODIR) {
             PuzzleList line;
@@ -563,7 +557,7 @@
     }
 
     DEF_TRAITSM(PuzzleStone, "st_puzzle", st_puzzle, MOVABLE_IRREGULAR);
-    
+
     BOOT_REGISTER_START
         BootRegister(new PuzzleStone(BLUE, ""), "st_puzzle");
         BootRegister(new PuzzleStone(BLUE, ""), "st_puzzle_blue");



From ged at mail.berlios.de  Mon Sep 15 15:27:12 2008
From: ged at mail.berlios.de (ged at mail.berlios.de)
Date: Mon, 15 Sep 2008 15:27:12 +0200
Subject: [Enigma-game-svn] r1328 - feature_branches/hp_lotm/input/lotm
Message-ID: <200809151327.m8FDRC33028832@sheep.berlios.de>

Author: ged
Date: 2008-09-15 15:27:08 +0200 (Mon, 15 Sep 2008)
New Revision: 1328

Added:
   feature_branches/hp_lotm/input/lotm/lotm_200809_ru.html
Log:
Homepage:
- Russian translation of September '09 LotM has been added.

Added: feature_branches/hp_lotm/input/lotm/lotm_200809_ru.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200809_ru.html	2008-09-15 00:02:58 UTC (rev 1327)
+++ feature_branches/hp_lotm/input/lotm/lotm_200809_ru.html	2008-09-15 13:27:08 UTC (rev 1328)
@@ -0,0 +1,386 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">???????? 2008: </span>
+    &quot;River of Challenges&quot; ?? Lukas Sch&uuml;ller
+  </h3>
+
+<p>???? &mdash; ????? ????????. ?? ? ??????, ??? ???? ?????? ? ???????
+?, ???? ??? ???, ??? ??? ??????????? ????????? ???? ? ???????????? ?????
+??? ???????????? ???????? ?????? ??????? ? ???????&hellip; ????? ????,
+Lukas Sch&uuml;ller ????? ??????. ? ? ??????? &quot;River of
+Challenges&quot; ?? ???? ??? ??????????? ?????? ???, ??? ?? ??? ?????????.</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_a.png" alt="??????? ??????" border="0">
+<div class="imagetitle">Enigma VI # 61</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">????????? ???????? ??????? 2008</caption>
+<colgroup>
+    <col width="80">
+    <col width="160">
+</colgroup>
+    <tr><td class="num">9:35</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">11:47</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">11:49</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">12:39</td>
+        <td class="left">Duffy</td></tr>
+    <tr><td class="num">13:39</td>
+        <td class="left">dev0</td></tr>
+    <tr><td class="num">13:41</td>
+        <td class="left">Raoul</td></tr>
+    <tr><td class="num">14:20</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">14:42</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">17:56</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">18:08</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">21:09</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">32:41</td>
+        <td class="left">Alex</td></tr>
+</table>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">?????????? ?????</caption>
+<colgroup>
+    <col width="80">
+    <col width="160">
+</colgroup>
+    <tr><td class="num">10:56</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">11:25</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">11:58</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">13:32</td>
+        <td class="left">dev0</td></tr>
+    <tr><td class="num">17:21</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">20:14</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">20:37</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">33:00</td>
+        <td class="left">mecke</td></tr>    
+</table>
+
+<p>??????-?? ??? ????? ?????? ? ????????? ?????? ??????, ?? ??????? ??????
+? ?????? ??????? ?????? ??? ?????. ?????????? ?? ????? ?? ???? ????? ?? ?????
+??????? (???? ????? ????? ?? ????? ?????, ?? ??? ??????!), ? ??????, ??? ??????????? ??
+????? ????? ?? ?????????????! ? ????? ??????, ???? ???? ?? ???? ?????? ??????? ? ???????,
+???????????? ??? ???????????? ????????? ??????! ??? ?? ???? ????? ?? ?? ??????? ????,
+??, ????? ?????????? ???? ?????????, ??????? ?????? ?????? ?
+&quot;Gods of Enigma&quot; ??? &quot;Oracle&quot;. ?? ?????? ??????????:
+???? ?????? ?? ???????? ?????? ???????? ??????? ? ???????.</p>
+
+<p>??????? ????????????, ??? ????? ????? ????????? ?????????? ??????? ?? ???,
+?????? ????????? ? ????? ?????? ?????, ??????? ? ??????????? ????????? ???
+&quot;? ??????? ???????? ??????&quot;. ??????, ????? ????? ?? ???????.
+&quot;??&quot; ? ?????? ????? ????????????? ? ?????? ? ????????? ???????, ?
+&quot;?????? ????????? ? ????? ??????&quot; ????????????? ????? ??? ???????? ? ????????.
+???????-?? ?? ??????? ???? ????? ??? ??????!</p>
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200809_b.png" alt="??????? ??????" border="0">
+<div class="imagetitle">??????????? ????</div>
+</div>
+
+<p>??????, ??? ?? ?????? ???????, ????? ????????? ?? ????? ????? &mdash; ??????? ??????????.
+??????? ????? ??????? ????, ???????, ???? ?????? ??????? ???????,
+??????? ???????? ??? ????????? ?? ?????? ? ???????? (????????????? ??? ?????? &mdash;
+????? ?? ????? ?? ?????). ????, ?????? ? ????????, ????????? ????????? ?? ?????????.
+???! ??? ?????? ????????? ???????????. ???????? ?? ????? ? ????? ??????? ????? &mdash; ???
+????? ????????????. ??? ??????? ????? ???????? ? ???????????? ???? ? ???? ????? ?????? ????????.
+??????? ???????? ???? ? ???????? ?????? ??????? &mdash; ???????? ??? ???????????. ???!
+?? ?? ????? ??????? ????! ????? ???????????, ??? ?????? ??????? ???? ????? ?? ??????? &mdash;
+???? ?????????. ????????, ??-?? ????? ????? ?????? ????? ? ????.</p> 
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_c.png" alt="??????? ??????" border="0">
+<div class="imagetitle">???????</div>
+</div>
+
+<p>??? ?????? ?????? ? ????????? ???????, ??? ????????? ? ????? ????? ?????????
+??????? ??????. ?? ??? ???? ?????????? ???????: ?????? ????? ??????? ????? ? ???? ????????.
+&quot;????????? ????? ???&quot; &mdash; ???????? ??? &mdash; &quot;???
+??????????????? ???, ??? ????? ?????????? ??? ???????&quot;. ?? ??????? ???? ???
+?????????? ? ???? ??????, ???????, ????????, ?????? ??? ??????. ?? ???? ?? ??? ??????
+??????? ??????, ? ???? ? ???????? ????? ?????? &quot;???????????&quot;. ??????
+????? ????? ???????? ???????? ? ???????????? ?????. ?? ??? ????? ??? ????????
+?????, ??????? ?? ?????? ?????.</p>
+
+<p>???????, ????? ?????????, ?? ?????? ????????? ???? ? ???-??????? ?? ???????.
+??????? ???? ????? ?????????, ??? ????? ??????????????? ??? ?????? ?????. ????,
+???? ? ???? ?????? ??????????? ?????? ??????. ???? ??????? ??? ??? ????,
+?? ??????? ??????????. ?? ?? ????? ?????????? ????? ??? ??????. ????????? ??????.</p>
+
+<h4>?? ?????????? &quot;???????&quot;!</h4>
+
+<div class="quote">? ?????? 1995-?? ? ?????????? ????????? ????? ????? ? ????????.
+?????? ?? ????????? ?? ????????? ?? ????? ????????? ? ????, ??????? ??????? ? ???????.
+?????? ??? ???????? ?? ???????, ?????????? ?? ????? ?????? ??????? ?????, ? ???? ???????.</div> 
+
+<div class="quote">?? ????????????? ????? ????, ???? ?? ????? ?? ?????????????? ???
+????? ??????????? ?????. ?? ????????, ??? ??? ??????? ????? ??????????, ? ?? ?? ?????????
+?????????? ?? ???? ? ????? ???????????, ??? ?????? ??????? ?? ???? ????????? ???????.
+?? ?????? ?? ????? ??????? ??????????? ????? ????????? (????? ?? ?????? ? ????) ? ??????
+(????? ?? ???????? ?? ???????).</div> 
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_d.png" alt="??????? ??????" border="0">
+<div class="imagetitle">??????? ??????????.</div>
+</div>
+
+<div class="quote">??? ???????????? ???????? ? ???? ?????? ???? ?? ?????? &quot;River of
+Challenges&quot;. ??? ? ?? ?????? ???????, ????? ???? ?????? ??????, ? ??????? ?????
+?????????? ? ????? ??????, ????, ???????, ????? ?????????? ?????????? ????. ?? ????
+?????? ??? ??????????? ????? ?????? ? ? ?? ?? ????? ????????? ?????? ?? ??????????
+??????? ? ????????? ?????, ??????? ??????????? ? ???????. ???? ?? ????????? ?? ???????,
+??? ???????? ????????????? ??????? ? ?????????? ?????.</div>
+
+<div class="quote">??? ?? ???, ????? ??????? ?????????? ?????? ?? ????????????? ??????
+?? ????????, ?? ??????? ? ???????? ????, ? ??????, ??????? ????? ?????? ?????????,
+????? ????????? ?? ????????????? ? ?????? ????? ??????? &mdash; ??? ????? ?????? ??????????
+????????, ????? ??? ??? ???????????? ????? ???????. ?????? ? ???????? ????????? ??????,
+? ??? ???????? ?????? ?????????, ??? ? ?????? ?????????????? ?? ????, ??? ??????? ?
+???? ? ?????? ?????.</div>
+
+<div class="quote">? ?????? ? ???????? ?? ????? ?????? &mdash; ???????? ?? ???????????.
+???????????? ?????? ???????????? &mdash; ????? ???????? ?????? ????????? ????????
+? ????????. ?????? &quot;River Of Challenges&quot; 10 ??????.</div>
+
+<div class="author">Taztunes</div>
+
+<p>????????? ???? ?? ???????? ??????? ? ??? ???? ??????, ??????? ????? ??? ??????.
+??????, ???????? ?? ????????, ??????, ??? ????????? ? ??????. ? ?.?. ?????? ???? ?
+?????, ? ?? ?????????? ??????. ??? ?? ??????????? ?????? ?? ??????? ???-??? ??????,
+??????? ?? ? ????? ??????. ??-?? ????? ??????? ?? ?? ????? ??? ??????? ?? ???? ???????.
+???? ?? ???????? ??? ??, ?? ??? ????????????. ?? ??????????? ? ???? ???? ????? ????.
+?? ????????? ???, ??? ????? ?????? ?????? ? ???? ??? ??????? ???????. &quot;?? ????????!&quot;
+&mdash; ??????? ??.</p>  
+
+<p>?????? ????????. ??????? ?????????? ?????? ? ???????????? ?? ?????? ?? ???????.
+???? ????? ? ??? ????? "???????? ??????", ??????? ?? ????? ?????? ????????? ?
+????????? ?? ??????? ?????? (? ??????? ????? ????????? ??????). ?? ?????? ?? ??????
+&mdash; ???, ?? ?????? &mdash; ?????? ?? ???????? ??????.
+?????????! ???? ???????? ??? ????? ????? ????????? (?? ???? ???????? ?????? Ctrl-A).
+?????????????? ? ??????????? ????! ???! ??????, ???????-??! ??? ??????
+??????? ???????? ????, ? ????? ?????? ?????????? ??????? ?? ?????????. ?, ??? ??
+? ?????? (manus manum lavat), ?.?. ?????? ?? ???????, ??????? ???????:
+&quot;?? ??????? ???????, ?? ???? ?????? ??????&quot;, ? ?? ??????? ????????? ??????
+??? ??????. ??????? ??? ?????? ?????? ??????.</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_f.png" alt="??????? ??????" border="0">
+<div class="imagetitle">&quot;?????&quot; ??? ?????????</div>
+</div>
+
+<p>?? ????????? ???? ?? ???? ?? ??????? ?? ????????? ??????, ??????? ?????? ??? ??????
+?????? ??????. ??????? ???? ????? ??? ?? ?? ????? ????????, ?? ??? ????? ???
+????? ???? ? ?????????? ??????????, ??????? ?? ???????, ????? ??????? ??????? ?? ??????
+?? ?????? ?? ???????. ???????????! ?? ?????? ???? ??? ?????? ????? ?? ???? ? ?????,
+? ??????? ??? ???????????? ?????????? ?? ???????. ? ????? ???????????????? ??????????
+???? ??????????????? ??????????? ??? ???????????? ?????. ??????? ?? ???????, ????????????
+?? ?????, ? ?? ????????? ??????????? ?? ??. ????????? ?? ?????? ???? &mdash; ???
+???????????? ????????????. ?? ????? ?? ?????????? ??????????? ? ??????:
+???? ??? ??????????? ???????. ??? ??????????? ?????? ????????????, ????? ???????????? ???.
+????? ?????????, ??? ?? ??????? ???????? ?? ?????? ??????? ??-?? ???? ?????.
+?????? ??????! &hellip; ???, ??? ???? ??????!</p> 
+
+<p>????, ????. ?????? ?? ????????? ?? ??????, ?????? ? ??? ? ??????? ??????????? ????.
+? ??????? ??????? ????? ?? ?????? ??????, ? ????? ????? ?????? ???? ?? ?????.
+?? ???? ??? ?????????? ??? ??????. ?? ????? ??????? ?????? ??? ??,
+?????? ??????????? ???????? ? ????????, ?????? ?????????? ???? ??? ???????????.
+&quot;???????? ????, ?? ? ?????? ?? ? ????????? ?????? ???, ??? ?? ??? ????? ?? ????????&quot;
+&mdash; ??? ???, ??? ?? ??????? ??????? ?? ?????????? ???????? ??????.
+&quot;?????????? ???????????? ? ???? ???? ???????. ??? ????????? ? ??? ?? ?????
+? ????? ????? ??????? ??????. ??????? ??, ??? ??? ?????? ?. ??? ?????? ???? ??????.&quot;
+??????? ????? ?? ??????? ?????????????? ?????, ?? ???????????? ????? ? ???????.
+</p> 
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_g.png" alt="??????? ??????" border="0">
+<div class="imagetitle">??????: ?????????? ???? ???????? ?????</div>
+</div>
+
+<p>???? ?? ???? ??????? ??? ? ????? ?????? ???????? ????????? ???, ?????? ?? ??
+?????????? ????? ??????? - ???????. ???? ??????? ????????, ???? ?? ??????
+?????, ??????? ????? ??? ??????. ?? ????????????? ? ???? ? ????? ??????? ????? ??????,
+?????? ????; ??? ???????, ? ????????? ????????? ????????????. ???? ???????? ?????
+???? ????????. ?????? ????????? ????? ???????? ??????, ???????? ?? ????, ? ??????
+????????????? ? ???. ?? ??????????, ???? ?? ????? ? ?? ???????????? ??? ? ?????
+?????????. ????? ?????????? (???????? ??????) ????? ????, ???? ?? ????? ????????
+???, ??? ???????, ? ????? ???? ???? ????????? ???????? ???????. <br> ? ????? &hellip;</p>
+
+<h4>&quot;???? ?????????????? ? 'River of Challenges' ????????????
+??????&quot;</h4>
+
+<div class="quote">&quot;River of Challenges&quot; ?????????? ?????????????
+&quot;???????????&quot;, ?????? ??? ?? ?????? ????????? ?? ?????? ????? ??????,
+????? ??? ??? ?????? ???-?? ??????. ????? ????, ?? ????? ???????? ? ?????
+?????????????????? ??????? ?? ??????????? ????????? &quot;???????????&quot;, ???
+???? ??????????? ????? ??????? ??????? ???? ?????????? ?????? ???? ???????.
+??????, ???? ?? ?? ????? ???? ?????? ????????? ???? ???????, ??? ?????????? ??
+?????? ?????? ????????? ???????, ?? ? ??????? ??????????? ????????, ????? ?? ?????????
+?????? ??? ??????????? ??????.</div> 
+
+<div class="quote">? ???????, ???? ?? ????? ?????? ???????? ??????, ? ?????? ?????
+? ???????? ?????, ????? ?????? ? ????? ??????, ??????? ???? ?????????????? ?
+'River of Challenges' ???????????? ??????. ????? ?????? ????? ??????????? ?? ?????
+???? ???? ????? ?? ???, ?? ??????????? ???? &quot;??????? ??? ?????????&quot;,
+?? ??????? ? ???????? ???????? ????? ???????:</div>
+
+<div class="quote">1) ??? ??? ????? ??? ??????? ?????????? ?????, ??? ????, ?????
+????????? ?????, ????????????? ???? ? ??????? ? ???????</div>
+
+<div class="quote">2) ?????? ? ?????????? ? ??????, ????? ????? ???? ?????
+??????? ????? &quot;????&quot;? (? ?????? ?????? ???? ??? ???????????!)</div>
+
+<div class="quote">??????? (????? ????????) ?? ?????????? ??????? ?????????,
+??? ?????? ?????? (?? ??????? ???? ????????????) ????? ??? ????? ?????????? ????
+?? ??????. ????? ????? ??????? ????? ?????? ?????????? ?????? ???????? ???????&hellip;</div>
+
+<div class="author">Craven</div>
+
+<!--<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_h.png" alt="Level of the Month" border="0">
+<div class="imagetitle">The Cave: For Members Only</div>
+</div>-->
+
+<!--<p><img class="leftimage" src="$$imagedir$$/lotm/lotm_200809_x.png"
+alt="EoYA 2007" border="0"></p>-->
+
+<div class="lotmpicleft">
+<img src="$$imagedir$$/lotm/lotm_200809_x.png" alt="??????? ??????" border="0">
+</div>
+
+<p>
+?????????! ??? ?? ????????????? ???? ? ?????? ? ???? ??? ????? ??????? ?, ??,
+????? ?????? ??????? &mdash; ??? ??? ???? ??????? ???? ?????? &mdash;
+?????????, ???????, ??????? ??????????. ???? ?? ?????? ?????????, ????????
+&mdash; ???, ????????? &mdash; ? ??????? ????????? ??????? ?????? ????? ????????? ?????.
+?????, ??? ?? ????? ????????. ??????? ??????? ????????.
+&mdash; ???????! ?? ?????? ?? ??????? ???? ?? ?????? ??? ?? ???? ??? ?????.
+??-???????? ?? ?????? ?? ??????? ???????, ???????????? ????? ? ????, ? ?????
+? ??? ????-??? ??? ??? ???? ?????????? ????????? ?? ?????????! &mdash; ?? ??? ?? ?? ???????
+&mdash; ??????-?? ??????? ?? ?????????? &hellip; ?? ?????!? &hellip; ????? ?? ??????-??????? ?? ???????,
+??? ????? ??????????!?! &hellip; ?????!! ?? ??? ?? ??? ????? ?????????? ????
+?????? ???????? ??? ??? ????????????? ???? ??? ??????????? ??? ???????, ?? ??
+????? ?? ????????????. ????????, ??? ????? ?? ??????? ??????. ????? ???????
+????, ?? ??? ?? ?????? ?????? ?? ??????????, ?? ??????????? ???????????? ?
+????? ??????????? ???????.</p>  
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200809_e.png" alt="??????? ??????" border="0">
+<div class="imagetitle">??? ?? ?????? ??????? <br> ? ?????? ????? ?????
+<br> &hellip; ???? ????? &hellip;</div>
+</div>
+
+<p>????????????! ?? ????????? ????? ?????? ????? ??????. ???? ?? ???????
+??????? ??????, ?????? ????? ???? ???????? ???????. ?? ??????! ??? ????
+??? ????????????? ????? ? ??? ?? ??????! &mdash; ??????? ???? ??,
+?????? ? ??????? ?? ????? ????, ???????, ??? ?? ????? ????????????????
+???????????? ????????????? ????? ?????? ??????????. ? ?????, ????? ??
+??????? ???? ???? ???? ?????, ?? ? ??? ???? ?? ???????????.
+?? ???? ? ??????? ???????: ??????? ??????, ??????? ??? ????, ??????? ???????
+?? ????????? ?????? ????????. ??????? ??????, ????? ?? ?????????? ?? ?????
+????? ?????? ??????, ???????? ????????? ????????: ??? ??? ????????? ??? ?????
+????? ?? ??????? ? ????? ???? ??????, ?? ??? ?? ????????. ????? ??????? ????????!
+?? ??? ?? ??? ??????, ???? ?????? ????? ?? ??? ???. ??? ?? ?????, ???? ?? &hellip;
+? ????? &hellip; ? ? ??????? &hellip; ??, ??? ?????? ?????????.</p> 
+
+<p>? ? ?????????? ??, ???????, ???????? ????? ????????? ????. ?????? ???? ? ????.
+????????? ????????????? ??? ?????????. ???????? ?????? ??????????? ???, ???
+?? ?????? ?? ???? ?????????? ? ???? ????. ?????, ?? ????? ????????? ????????????
+????????, ?? ??????????? ???????????? ? ??? ????? ???????. ?? ????? ?????????????? ????
+??? ?? ?????? &hellip;</p>
+
+<h4>&quot;? ???? ?????? ????????? ??????? ?? ??????? ?????? ??????????&quot;</h4>
+
+<div class="quote">? ????? ??? ???? ???????. ? ??? ???, ??? ? ??????? ???? ???????,
+?????? ????? ???????, ?? ? ?????????? ?????????? ??? ? ???.</div>
+
+<div class="quote">?????? ????? &quot;River of Challenges&quot; ???? ???????
+??????, ????? ???????, ??? ???? ?????????: ???? ???? ????? ?????? ?????? ???
+? ?????? ????? ????? ????, ??? ? ???????? ?????? ?????? ?? ??, ???????????? ?? ?????
+?? ???????? Duffy (??????? ?, ?????? ??????????, ??? ? ?? ????????? ??????????? ??????).
+????? ???????, ? ?????? ? ??????, ??? ??? ??? ?????? ??? ?????????, ????????
+??? ?? ??????? ? ???? ?????????? ???????? ?????? ????????? ???????
+(???? ? ?? ????? ???????? ??? ? ??????????? ???? ??????, ???? ?? ?????? ?????
+?????????? ;) ): ???????? ??????? ? ???????? ??????????? ???????????, ?
+??????? ?? ?????? ????????? ?????? ??????????? ????? ?????? ??? ???? ? Enigma.</div>
+
+<div class="quote">???? ???????? ????????? ?????? ??????????? ? ????? ???????????
+????????? ? ????? ????????? ?? ? ?????? ?????????? ?????? ?? ??? ????????? ?? ??????
+?????? ??? ???????, ??????? ?????????? ??????? ???? ?????? ??????? ?? ?????.
+? ???????, ??? ??????????? ??????? ??? ?????????? ? ???????? ???? ???????? ????,
+? ????? ??? ??????????. ???? ?? ?????? ????? ??? ??????-???????? ???????? ? ??????????
+?????? ? ????? ?????? ?????????? ? ?????? ????? ?????? ?????? ???????????? ???.
+?? ???? ????????? ???????? ?????????? ???????? ????????? ????: ?? ????? ????? ????
+????????? ?? ???????? ????.</div>
+
+<div class="quote">????? ??? ????? ???? ????????? ?????? ????? ?????? ??????????
+?????????????. ??????? ? ??????????? ?????????????? ??????? ??????????: ???
+???????? ? ??????? ??????????? ????? ???? ?? ????????? ? ?????? ??????,
+?? ??? ?? ????? ??? ?????? ????????? ??????????? ?????? ? ???????????? ???????.
+???? ??? ??? ?? ?????? ???????: ??????????? ?? ??????????? ?????????? ????
+?? ?????. ? ?????????, ???????? ???? ?????? ??? ?????????? ?????? ? ???????.
+? ??????? ??? ????, ??? ??????? ?????? ?? ??? ??? ??????????? ???, ????????
+?????????????? ????, ??? ???? ???? ???? ??????????? ?????? ?????? ??????? ?
+?????????? ????.</div>
+
+<div class="quote">????? ????, ??? ? ???????? ?????? ?????? ??????, ? ?????? ???
+?????????????, ??????? ??? ??? ??? ????? ?? ??????????. ? ????? ??????? ???????
+Raoul, Ronald ? Andreas, ??????? ????? ??????? ??? ????????? ????? ????? ??????,
+??????? ?? ??? ?????? ???? ??????????? ??????. ????? ??? ?????????? ??????????????
+????????? ??????? ??????? ??? ???????? ? ????? ?? ????????? ? ????.</div>
+
+<div class="quote">??????????? ?????, ????? ???????? ????????? ??????, ???????? ?
+?????????: ???????? ???????????, ????????, ????????? ?? ? ?????? ?????? ???,
+??????, ??? ????, ??? ??????????? ?????? ???????? ??????? ????? ???????, ?? ?
+????? ? ?????? ??????? ???? ??????, ? ???? ??? ????????????, ??????? ???????.
+?? ??? ?????, ????? ???? ? ??????? ?? ?????? ??????????.</div>
+
+<div class="author">Lukas</div>
+
+<p>??????? ??, ?????????? ?? ?????? &quot;???????&quot; ????? ???, ?????? ?????
+????????? ? ????? ???????????? ????????? ?? ???????????? (???????? ?? ???????).
+???? ?? ??????????, ??? ?? ??????? ????? ??? ?? &quot;????????????&quot;, ???????
+?? ???????? ?? ?????? ????, ?????, ?? ????? ??????? ????? ? ???????? ???? #6098.
+????????? ?? ???? ? ????????? ??????. ??????? Lukas Sch&uuml;ller. ?????? ?? ?????,
+??? ??? ????? ???????? ???? ?????? ? ?????? ?? ?????? ???????? ????? ??????????
+?? ????? ?????????? ??????.</p>
+
+<p><i>NObby ? Harry</i></p> 
+
+<p><i>? ? ??????? ??? ?? ?????? ?? ????????????? ?????? ???????? Taztunes, ???????
+?????? ???????????? ??????? ????? ????? ??????????? ? ???????????? ? ??????, ???????
+????? ? ????????????? ????????.</i></p> 
+
+<p>????????? ????????, ??? ?????? ????? ???? ?????? ? ??????? ??????? Enigma.
+?????????? ?????????? ??? ????? ??????, ??? ???? ???????????, ??????? ?? ????????
+?? ?????????? ??????:</p>
+<pre>
+<a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
+</pre>
+<p>? ?????????, ??? ?????????? ?????? ? ????????? ???????:
+</p>
+<ul>
+<li>&quot;Plan Ahead&quot; ?? Jacob Scott</li>
+<li>&quot;Procrustes&quot; ?? Andreas Lochmann</li>
+<li>&quot;Little Puzzles&quot; ?? Jon 'WB' Sneyers</li>
+</ul>
+<p>??????? ??????? ???????, ?????? ???? ?????? ????? ????????? ??!</p>
+
+<p><i>???? ??????? Enigma</i></p>
+
+</div>



From andreasl at mail.berlios.de  Mon Sep 15 16:04:22 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Mon, 15 Sep 2008 16:04:22 +0200
Subject: [Enigma-game-svn] r1329 - in homepage: . images/lotm input/lotm
Message-ID: <200809151404.m8FE4Mb0000256@sheep.berlios.de>

Author: andreasl
Date: 2008-09-15 16:04:07 +0200 (Mon, 15 Sep 2008)
New Revision: 1329

Added:
   homepage/images/lotm/lotm_200809.png
   homepage/images/lotm/lotm_200809_a.png
   homepage/images/lotm/lotm_200809_b.png
   homepage/images/lotm/lotm_200809_c.png
   homepage/images/lotm/lotm_200809_d.png
   homepage/images/lotm/lotm_200809_e.png
   homepage/images/lotm/lotm_200809_f.png
   homepage/images/lotm/lotm_200809_g.png
   homepage/images/lotm/lotm_200809_h.png
   homepage/images/lotm/lotm_200809_x.png
   homepage/input/lotm/lotm_200809.html
   homepage/input/lotm/lotm_200809_de.html
   homepage/input/lotm/lotm_200809_ru.html
Modified:
   homepage/enigma.css
   homepage/images/lotm/lotm-history.png
   homepage/input/lotm/lotm_archive_data.lua
Log:
Homepage:
 - Merged LotM-feature branch back to homepage.
 - Validated
Todo:
 - Upload
Note:
 - Next Mecke article is scheduled for in two weeks.


Modified: homepage/enigma.css
===================================================================
--- homepage/enigma.css	2008-09-15 13:27:08 UTC (rev 1328)
+++ homepage/enigma.css	2008-09-15 14:04:07 UTC (rev 1329)
@@ -433,6 +433,25 @@
     font-size: 90%;
 }
 
+.lotmpicleft {
+    float: left;
+    padding-right: 2em;
+    padding-bottom: 1em;
+}
+
+.lotm .lotmpicleft img {
+    border-width: 4px;
+    border-color: #777;
+    padding-right: 0em;
+    margin-top: 1em;
+    padding-top: 0em;
+    padding-bottom: 0em;
+}
+
+.lotmpicleft .imagetitle {
+    font-size: 90%;
+}
+
 .lotm img {
     padding-right: 1em;
     padding-top: 0.5em;

Modified: homepage/images/lotm/lotm-history.png
===================================================================
(Binary files differ)

Copied: homepage/images/lotm/lotm_200809.png (from rev 1328, feature_branches/hp_lotm/images/lotm/lotm_200809.png)

Copied: homepage/images/lotm/lotm_200809_a.png (from rev 1328, feature_branches/hp_lotm/images/lotm/lotm_200809_a.png)

Copied: homepage/images/lotm/lotm_200809_b.png (from rev 1328, feature_branches/hp_lotm/images/lotm/lotm_200809_b.png)

Copied: homepage/images/lotm/lotm_200809_c.png (from rev 1328, feature_branches/hp_lotm/images/lotm/lotm_200809_c.png)

Copied: homepage/images/lotm/lotm_200809_d.png (from rev 1328, feature_branches/hp_lotm/images/lotm/lotm_200809_d.png)

Copied: homepage/images/lotm/lotm_200809_e.png (from rev 1328, feature_branches/hp_lotm/images/lotm/lotm_200809_e.png)

Copied: homepage/images/lotm/lotm_200809_f.png (from rev 1328, feature_branches/hp_lotm/images/lotm/lotm_200809_f.png)

Copied: homepage/images/lotm/lotm_200809_g.png (from rev 1328, feature_branches/hp_lotm/images/lotm/lotm_200809_g.png)

Copied: homepage/images/lotm/lotm_200809_h.png (from rev 1328, feature_branches/hp_lotm/images/lotm/lotm_200809_h.png)

Copied: homepage/images/lotm/lotm_200809_x.png (from rev 1328, feature_branches/hp_lotm/images/lotm/lotm_200809_x.png)

Copied: homepage/input/lotm/lotm_200809.html (from rev 1328, feature_branches/hp_lotm/input/lotm/lotm_200809.html)

Copied: homepage/input/lotm/lotm_200809_de.html (from rev 1328, feature_branches/hp_lotm/input/lotm/lotm_200809_de.html)

Copied: homepage/input/lotm/lotm_200809_ru.html (from rev 1328, feature_branches/hp_lotm/input/lotm/lotm_200809_ru.html)

Modified: homepage/input/lotm/lotm_archive_data.lua
===================================================================
--- homepage/input/lotm/lotm_archive_data.lua	2008-09-15 13:27:08 UTC (rev 1328)
+++ homepage/input/lotm/lotm_archive_data.lua	2008-09-15 14:04:07 UTC (rev 1329)
@@ -148,6 +148,15 @@
   position_num   = "5069"
 }
 
+lotm_archive_data[17] = {
+  date           = { month = 9, year = 2008 },
+  chronological  = 17,
+  name           = "River of Challenges",
+  author         = "Lukas Sch&uuml;ller",
+  position       = "VI/61",
+  position_num   = "6061"
+}
+
 -- Further levels standing data
 -- (no need to change these)
 
@@ -246,22 +255,23 @@
 -- LotM variable data
 -- format: Level Title, current_rating, current_votes, additional text
 
-lotm_rating(    "Island Labyrinth",  9.31,  13,  "(1 down)")
-lotm_rating(  "Pneumatic Delivery",  8.19,  16,  "(1 up)")
-lotm_rating(    "The Aztec Temple",  9.00,  11,  "")
-lotm_rating("Labyrinth of Puzzles",  8.82,  17,  "(1 up)")
-lotm_rating(           "Elaborate",  8.64,  11,  "(2 up)")
-lotm_rating(             "Houdini",  9.28,   8,  "")
-lotm_rating(           "Tool Time",  8.17,  23,  "(5 down)")
-lotm_rating(         "Quadropolis",  9.20,  10,  "")
-lotm_rating(      "Big Adventures",  8.42,  24,  "(1 up)")
-lotm_rating(      "Temple of Gold",  9.38,   8,  "(1 up)")
-lotm_rating(      "Puzzle Puzzles",  8.63,   8,  "(2 down)")
-lotm_rating(      "Psycho Pushing",  8.18,  11,  "(1 up)")
-lotm_rating(  "Turnstiles for Two",  9.00,   5,  "")
-lotm_rating(     "Pleasure Garden",  8.43,  14,  "(1 up)")
-lotm_rating(      "Block its way!",  8.00,  17,  "")
-lotm_rating(   "Gods of Enigma II",  8.35,  17,  "<b>(newcomer)</b>")
+lotm_rating(    "Island Labyrinth",  9.29,  14,  "")
+lotm_rating(  "Pneumatic Delivery",  8.18,  17,  "(1 down)")
+lotm_rating(    "The Aztec Temple",  9.08,  13,  "")
+lotm_rating("Labyrinth of Puzzles",  8.78,  18,  "(1 up)")
+lotm_rating(           "Elaborate",  8.62,  13,  "(1 up)")
+lotm_rating(             "Houdini",  9.24,   9,  "")
+lotm_rating(           "Tool Time",  8.21,  24,  "(2 up)")
+lotm_rating(         "Quadropolis",  9.18,  11,  "")
+lotm_rating(      "Big Adventures",  8.40,  25,  "(1 up)")
+lotm_rating(      "Temple of Gold",  9.30,  10,  "")
+lotm_rating(      "Puzzle Puzzles",  8.56,   9,  "(2 down)")
+lotm_rating(      "Psycho Pushing",  8.17,  12,  "(1 down)")
+lotm_rating(  "Turnstiles for Two",  8.83,   6,  "(1 down)")
+lotm_rating(     "Pleasure Garden",  8.38,  16,  "(2 down)")
+lotm_rating(      "Block its way!",  8.00,  18,  "")
+lotm_rating(   "Gods of Enigma II",  8.39,  18,  "(1 up)")
+lotm_rating( "River of Challenges",  8.36,  11,  "<b>(newcomer)</b>")
 
 -- Don't forget to adjust the archive dates:
 



From raoul at mail.berlios.de  Mon Sep 15 17:38:46 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Mon, 15 Sep 2008 17:38:46 +0200
Subject: [Enigma-game-svn] r1330 - team_levelpacks/team_test_new_api
Message-ID: <200809151538.m8FFckXX009143@sheep.berlios.de>

Author: raoul
Date: 2008-09-15 17:38:46 +0200 (Mon, 15 Sep 2008)
New Revision: 1330

Modified:
   team_levelpacks/team_test_new_api/ralT059_1.xml
   team_levelpacks/team_test_new_api/ralT068_1.xml
   team_levelpacks/team_test_new_api/raoulT08_1.xml
Log:
-> Updates for testlevels (bridge/puzzle objects)
-> New tests in puzzle pieces testlevel



Modified: team_levelpacks/team_test_new_api/ralT059_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT059_1.xml	2008-09-15 14:04:07 UTC (rev 1329)
+++ team_levelpacks/team_test_new_api/ralT059_1.xml	2008-09-15 15:38:46 UTC (rev 1330)
@@ -36,7 +36,7 @@
 ti["L"] = {"st_laser_n", "laser#", state=ON}
 ti["P"] = {"st_polarswitch"}
 
-ti["*"] = {"fl-bridge-open", type="x"} .. ti({"st_door_a", state=OPEN})
+ti["*"] = {"fl_bridge_gc", state=OPEN} .. ti({"st_door_a", state=OPEN})
 
 ti["k"] = {"st_door_d", target="laser#*"}
 

Modified: team_levelpacks/team_test_new_api/ralT068_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT068_1.xml	2008-09-15 14:04:07 UTC (rev 1329)
+++ team_levelpacks/team_test_new_api/ralT068_1.xml	2008-09-15 15:38:46 UTC (rev 1330)
@@ -36,8 +36,8 @@
 ti["s"] = {"it-spring1"}
 ti["p"] = {"st_pull"}
 ti["W"] = {"st_window_ew", secure=true}
-ti["h"] = {"st-puzzle-hollow"}
-ti["H"] = {"st-puzzle-ew"}
+ti["h"] = {"st_puzzle", hollow=true, connections="nesw"}
+ti["H"] = {"st_puzzle", connections="ew"}
 
 ti[";"] = ti["."] .. ti["g"]
 

Modified: team_levelpacks/team_test_new_api/raoulT08_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT08_1.xml	2008-09-15 14:04:07 UTC (rev 1329)
+++ team_levelpacks/team_test_new_api/raoulT08_1.xml	2008-09-15 15:38:46 UTC (rev 1330)
@@ -2,7 +2,7 @@
 <el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
   <el:protected>
     <el:info el:type="level">
-      <el:identity el:title="Test Puzzle Pieces new API" el:subtitle="" el:id="raoul08"/>
+      <el:identity el:title="Test Puzzle Pieces new API" el:subtitle="" el:id="raoult08"/>
       <el:version el:score="1" el:release="1" el:revision="0" el:status="experimental"/>
       <el:author  el:name="Raoul Bourquin" el:email="raoul at users.berlios.de"/>
       <el:copyright>Copyright ? 2008 Raoul Bourquin</el:copyright>
@@ -102,6 +102,8 @@
 ti["ye"] = {"st_puzzle_yellow", connections="nes", hollow=true}
 ti["yf"] = {"st_puzzle_yellow", connections="nesw", hollow=true}
 
+ti["LL"] = {"st_laser", orientation="w", state=ON}
+ti["PP"] = {"st_polarswitch", state=OFF}
 
 ti["@ "] = {"#ac-blackball"}  ..ti({"it_magicwand"})
 
@@ -109,22 +111,22 @@
 "                                                                              ",
 "  @                                                                           ",
 "                                                                              ",
-"  B0      b0      Y0      y0                                                  ",
-"  B1      b1      Y1      y1                                                  ",
-"  B2      b2      Y2      y2                                                  ",
-"  B3      b3      Y3      y3                                                  ",
-"  B4      b4      Y4      y4                                                  ",
-"  B5      b5      Y5      y5                                                  ",
-"  B6      b6      Y6      y6                                                  ",
-"  B7      b7      Y7      y7                                                  ",
-"  B8      b8      Y8      y8                                                  ",
-"  B9      b9      Y9      y9                                                  ",
-"  Ba      ba      Ya      ya                                                  ",
-"  Bb      bb      Yb      yb                                                  ",
-"  Bc      bc      Yc      yc                                                  ",
-"  Bd      bd      Yd      yd                                                  ",
-"  Be      be      Ye      ye                                                  ",
-"  Bf      bf      Yf      yf                                                  ",
+"  B0      Y0      b0      y0        PPLL                                      ",
+"  B1      Y1      b1      y1        PPLL                                      ",
+"  B2      Y2      b2      y2        PPLL                                      ",
+"  B3      Y3      b3      y3        PPLL                                      ",
+"  B4      Y4      b4      y4        PPLL                                      ",
+"  B5      Y5      b5      y5        PPLL                                      ",
+"  B6      Y6      b6      y6        PPLL                                      ",
+"  B7      Y7      b7      y7        PPLL                                      ",
+"  B8      Y8      b8      y8        PPLL                                      ",
+"  B9      Y9      b9      y9        PPLL                                      ",
+"  Ba      Ya      ba      ya        PPLL                                      ",
+"  Bb      Yb      bb      yb        PPLL                                      ",
+"  Bc      Yc      bc      yc        PPLL                                      ",
+"  Bd      Yd      bd      yd        PPLL                                      ",
+"  Be      Ye      be      ye        PPLL                                      ",
+"  Bf      Yf      bf      yf        PPLL                                      ",
 "                                                                              ",
 "                                                                              ",
 "                                                                              "



From raoul at mail.berlios.de  Mon Sep 15 20:45:32 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Mon, 15 Sep 2008 20:45:32 +0200
Subject: [Enigma-game-svn] r1331 - in trunk: data src/stones
Message-ID: <200809151845.m8FIjWZb017710@sheep.berlios.de>

Author: raoul
Date: 2008-09-15 20:45:31 +0200 (Mon, 15 Sep 2008)
New Revision: 1331

Modified:
   trunk/data/models-2d.lua
   trunk/src/stones/PuzzleStone.cc
   trunk/src/stones/Turnstile.cc
   trunk/src/stones/Turnstile.hh
Log:
-> Added some forgotten puzzle changes
-> Fixed broken turnstiles



Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-09-15 15:38:46 UTC (rev 1330)
+++ trunk/data/models-2d.lua	2008-09-15 18:45:31 UTC (rev 1331)
@@ -1158,10 +1158,10 @@
 end
 
 -- st-turnstle, arms --
-DefAlias("st-turnstile-e", "st-puzzle2")
-DefAlias("st-turnstile-w", "st-puzzle5")
-DefAlias("st-turnstile-s", "st-puzzle9")
-DefAlias("st-turnstile-n", "st-puzzle3")
+DefAlias("st-turnstile-e", "st_puzzle1")
+DefAlias("st-turnstile-w", "st_puzzle4")
+DefAlias("st-turnstile-s", "st_puzzle8")
+DefAlias("st-turnstile-n", "st_puzzle2")
 
 -- st-turnstile-green --
 do

Modified: trunk/src/stones/PuzzleStone.cc
===================================================================
--- trunk/src/stones/PuzzleStone.cc	2008-09-15 15:38:46 UTC (rev 1330)
+++ trunk/src/stones/PuzzleStone.cc	2008-09-15 18:45:31 UTC (rev 1331)
@@ -44,14 +44,11 @@
         if (key == "hollow") {
             if (val.to_bool() != (bool)(objFlags & OBJBIT_HOLLOW)) {
                 objFlags ^= OBJBIT_HOLLOW;
-                if (objFlags & OBJBIT_HOLLOW)
-                    Stone::setAttr("connections", "nesw");
-                else if (isDisplayable())
-                    init_model();
             }
             return;
-        } else if (key == "connections" && !(objFlags & OBJBIT_HOLLOW)) {
+        } else if (key == "connections") {
             Stone::setAttr(key, val);
+            return;
         }
         Stone::setAttr(key, val);
     }
@@ -124,7 +121,7 @@
     void PuzzleStone::on_creation(GridPos p) {
         if (!(objFlags & OBJBIT_INIT)) {
             autoJoinCluster();
-             objFlags |= OBJBIT_INIT;
+            objFlags |= OBJBIT_INIT;
         }
         activatePhoto();
         Stone::on_creation(p);

Modified: trunk/src/stones/Turnstile.cc
===================================================================
--- trunk/src/stones/Turnstile.cc	2008-09-15 15:38:46 UTC (rev 1330)
+++ trunk/src/stones/Turnstile.cc	2008-09-15 18:45:31 UTC (rev 1331)
@@ -7,7 +7,7 @@
  * modify it under the terms of the GNU General Public License
  * as published by the Free Software Foundation; either version 2
  * of the License, or (at your option) any later version.
- *  
+ *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
@@ -37,10 +37,10 @@
     std::string TurnstilePivot::getClass() const {
         return "st_turnstile";
     }
-        
+
     void TurnstilePivot::setAttr(const string& key, const Value &val) {
         if (key == "flavor") {
-            ASSERT((val.to_string() == "red" || val.to_string() == "green"), XLevelRuntime, 
+            ASSERT((val.to_string() == "red" || val.to_string() == "green"), XLevelRuntime,
                     ("Turnstile unknown flavor: " + val.to_string()).c_str());
             Stone::setAttr(key, val);
             if (isDisplayable())
@@ -48,24 +48,24 @@
         } else
             Stone::setAttr(key, val);
     }
-    
+
     Value TurnstilePivot::message(const Message &m) {
         if (m.message == "signal") {               // turn , turnback
             if (isDisplayable())
                 rotate(m.value == 0, NULL, NULL);
             return Value();
         } else if ((m.message == "turn" || m.message == "turnback")) {
-            rotate((m.message == "turn" && !getAttr("counterclock").to_bool() || 
+            rotate((m.message == "turn" && !getAttr("counterclock").to_bool() ||
                     m.message == "turnback" && getAttr("counterclock").to_bool()), NULL, NULL);
             return Value();
         }
         return Stone::message(m);
     }
-    
+
     int TurnstilePivot::maxState() const {
         return 0;
     }
-    
+
     void TurnstilePivot::setState(int extState) {
         // ignore all state settings
     }
@@ -73,13 +73,13 @@
     void TurnstilePivot::init_model() {
         set_model(std::string("red") == getAttr("flavor").to_string() ? "st-turnstile" : "st-turnstile-green");
     }
-    
 
+
     void TurnstilePivot::animcb() {
         state = IDLE;
         init_model();
     }
-    
+
     DirectionBits TurnstilePivot::arms_present() const {
         int arms = NODIRBIT;
         GridPos p = get_pos();
@@ -91,7 +91,7 @@
         }
         return (DirectionBits)arms;
     }
-    
+
     bool TurnstilePivot::no_stone(int xoff, int yoff) const {
         GridPos p = get_pos();
         p.x += xoff;
@@ -102,10 +102,10 @@
     bool TurnstilePivot::rotate(bool clockwise, Object *impulse_sender, TurnstileArm *initiator) {
         if (state == ROTATING || !isDisplayable())
             return false;
-    
+
         DirectionBits arms = arms_present();
         bool can_rotate = true;
-    
+
         if (clockwise)  {
             if (arms & NORTHBIT) {
                 can_rotate &= no_stone(+1,-1);
@@ -142,12 +142,12 @@
                 if (! (arms & NORTHBIT)) can_rotate &= no_stone(0,-1);
             }
         }
-    
+
         if (can_rotate) {
             int id = getId();
             sound_event (clockwise ? "turnstileright" : "turnstileleft");
             sound_event("movesmall");
-    
+
             state = ROTATING;
             set_anim(ecl::strf("st-turnstile%s-anim", (std::string("red") == getAttr("flavor").to_string()) ? "" : "-green"));
             rotate_arms(arms, clockwise);
@@ -155,11 +155,11 @@
 
             if (Object::getObject(id) == NULL)   // Killed? Then forget the rest.
                 return can_rotate;
-        
+
             Direction dir = to_direction(getAttr("orientation"));
             dir = clockwise ? rotate_cw(dir) : rotate_ccw(dir);
             Stone::setAttr("orientation", dir);
-            
+
             for (Direction dir = WEST; dir != NODIR; dir = next(dir)) {
                 if (TurnstileArm * ta = dynamic_cast<TurnstileArm *>(GetStone(move(get_pos(), dir)))) {
                     if (ta != initiator) {
@@ -168,7 +168,7 @@
                     }
                 }
             }
-    
+
             performAction(!clockwise);
             server::IncMoveCounter();
         }
@@ -177,12 +177,12 @@
 
     void TurnstilePivot::rotate_arms(DirectionBits arms, bool clockwise) {
         GridPos p = get_pos();
-    
+
         Object * n = (arms & NORTHBIT) ? YieldStone(move (p, NORTH)) : NULL;
         Object * e = (arms & EASTBIT)  ? YieldStone(move (p, EAST))  : NULL;
         Object * s = (arms & SOUTHBIT) ? YieldStone(move (p, SOUTH)) : NULL;
         Object * w = (arms & WESTBIT)  ? YieldStone(move (p, WEST))  : NULL;
-            
+
         if (clockwise) {
             if (arms & NORTHBIT) setArm(n, EAST);
             if (arms & EASTBIT)  setArm(e, SOUTH);
@@ -196,17 +196,17 @@
             if (arms & WESTBIT)  setArm(w, SOUTH);
         }
     }
-    
+
     void TurnstilePivot::setArm(Object * obj, Direction dir) {
         GridPos newp = move(get_pos(), dir);
         Stone * st = dynamic_cast<Stone *>(obj);
         SetStone(newp, st);
         obj->setAttr("state", dir);
-    
+
         if (Item *it = GetItem(newp))
             it->on_stonehit(st);
     }
-   
+
     bool TurnstilePivot::calc_arm_seen(bool cw, DirectionBits arms, int field) {
         // for each field calculate whether an arm has passed by, first
         // counterclockwise and then clockwise:
@@ -225,32 +225,32 @@
         };
         const int to_x[8] = { -1, 0, 1, 1, 1, 0, -1, -1 };
         const int to_y[8] = { -1, -1, -1, 0, 1, 1, 1, 0 };
-    
+
         bool arm_seen[8];
         DirectionBits arms = arms_present(); // Note: already the rotated state
         for (int i = 0; i<8; ++i)
             arm_seen[i] = calc_arm_seen(clockwise, arms, i);
-    
+
         // ---------- Handle items in range ----------
         GridPos pv_pos = get_pos();
-        for (int i = 0; i<8; ++i) 
+        for (int i = 0; i<8; ++i)
             if (arm_seen[i]) {
                 GridPos item_pos(pv_pos.x+to_x[i], pv_pos.y+to_y[i]);
-                if (Item *it = GetItem(item_pos)) { 
+                if (Item *it = GetItem(item_pos)) {
                     if (it->get_traits().id == it_laserbeam)
-                        KillItem(item_pos); 
+                        KillItem(item_pos);
                     else
                         it->on_stonehit(this); // hit with pivot (shouldn't matter)
                 }
             }
-    
+
         // ---------- Handle actors in range ----------
         std::vector<Actor*> actorsInRange;
-    
-        // tested range is sqrt(sqr(1.5)+sqr(1.5)) 
+
+        // tested range is sqrt(sqr(1.5)+sqr(1.5))
         if (!GetActorsInRange(pv_pos.center(), 2.124, actorsInRange))
             return;
-    
+
         std::vector<Actor*>::iterator iter = actorsInRange.begin(), end = actorsInRange.end();
         for (; iter != end; ++iter) {
             Actor *ac = *iter;
@@ -258,17 +258,17 @@
             GridPos   ac_pos(ac_center);
             int dx  = ac_pos.x-pv_pos.x;
             int dy  = ac_pos.y-pv_pos.y;
-    
+
             // ignore if actor is not inside the turnstile square or is not
             // in distance of the the rotating arms
-            if ((dx<-1 || dx>1 || dy<-1 || dy>1) || 
+            if ((dx<-1 || dx>1 || dy<-1 || dy>1) ||
                     (length(ac->get_pos() - pv_pos.center()) > 1.58114 + ac->get_actorinfo()->radius))
                 continue;
-    
+
             int idx_source = to_index[dx+1][dy+1];
-            if (idx_source == -1) 
+            if (idx_source == -1)
                 continue;       // actor inside pivot -- should not happen
-    
+
             const int rot_index[4][8] = {
                 // The warp-destinations for actors. Why different destinations
                 // for oxyd/non-oxyd-type turnstiles? Imagine the actor on position
@@ -285,11 +285,11 @@
                 { 6,  6, 0,  0, 2,  2, 4,  4 }, // anticlockwise (oxyd-compatible)
                 { 2,  4, 4,  6, 6,  0, 0,  2 }, // clockwise (oxyd-compatible)
             };
-    
+
             bool compatible = std::string("red") == getAttr("flavor").to_string();   // oxyd compatibility
             int  idx_target = rot_index[clockwise+2*compatible][idx_source]; // destination index
             bool do_warp = false; // move the actor along with the turnstile?
-    
+
             if (compatible) {
                 // Move only the actor that hit the turnstile in Oxyd mode
                 do_warp = (ac == dynamic_cast<Actor*>(impulse_sender));
@@ -299,13 +299,13 @@
                 // move all actors only if pushed by an arm
                 do_warp = arm_seen[idx_source];
             }
-    
-            if (!do_warp) 
+
+            if (!do_warp)
                 continue;
-    
+
             // Pushing an actor out of the level results in a shatter (no warp) instead
             GridPos ac_target_pos(pv_pos.x+to_x[idx_target], pv_pos.y+to_y[idx_target]);
-    
+
             if(!IsInsideLevel(ac_target_pos)) {
                 SendMessage(ac, "shatter");
                 continue;
@@ -313,17 +313,17 @@
 
             // Keep the actors rotated position within grid, but ensure that
             // - actors once warped keep warping on further turnstile turns
-            // - small marbles end up in meditation hollows  
+            // - small marbles end up in meditation hollows
             ecl::V2 offset = ac->get_pos() - ac->get_gridpos().center();
             if (ecl::length(offset) > 0.5 - ac->get_actorinfo()->radius)
                 offset =  (0.5 - ac->get_actorinfo()->radius) * ecl::normalize(offset);
             WarpActor(ac, ac_target_pos.x + 0.5 + (clockwise ? -offset[1] : offset[1]),
                      ac_target_pos.y + 0.5 + (clockwise ? offset[0] : -offset[0]), false);
-    
+
             if (Stone *st = GetStone(ac_target_pos)) {
-    
+
                 // destination is blocked
-    
+
                 TurnstileArm *arm = dynamic_cast<TurnstileArm*>(st);
                 if (arm && !compatible) { // if blocking stone is turnstile arm -> hit it!
                     const int impulse_dir[2][8] = {
@@ -334,14 +334,14 @@
                         { NORTHBIT|EASTBIT, EASTBIT, SOUTHBIT|EASTBIT, SOUTHBIT,
                           SOUTHBIT|WESTBIT, WESTBIT, NORTHBIT|WESTBIT, NORTHBIT }
                     };
-    
+
                     DirectionBits possible_impulses =
                         static_cast<DirectionBits>(impulse_dir[clockwise][idx_target]);
-    
-                    for (int d = 0; d<4; ++d) 
-                        if (has_dir(possible_impulses, Direction(d))) 
+
+                    for (int d = 0; d<4; ++d)
+                        if (has_dir(possible_impulses, Direction(d)))
                             ac->send_impulse(ac_target_pos, Direction(d));
-    
+
     //                 if (GetStone(ac_target_pos) == 0)  // arm disappeared
     //                     break;
                 }
@@ -352,14 +352,14 @@
     int TurnstilePivot::traitsIdx() const {
         return (std::string("red") == getAttr("flavor").to_string()) ? 0 : 1;
     }
-    
+
     StoneTraits TurnstilePivot::traits[2] = {
         {"st_turnstile_red", st_turnstile_red, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
         {"st_turnstile_green", st_turnstile_green, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
     };
-    
 
 
+
     TurnstileArm::TurnstileArm(Direction dir) : Stone () {
         state = dir;
     }
@@ -367,7 +367,7 @@
     std::string TurnstileArm::getClass() const {
         return "st_turnstilearm";
     }
-        
+
     void TurnstileArm::setAttr(const string& key, const Value &val) {
         if (key == "orientation") {                // TODO connections support
             setState(val);
@@ -384,13 +384,13 @@
                 case NORTHBIT :
                     state = NORTH; break;
                 default :
-                    ASSERT(false, XLevelRuntime, ("Turnstile set attribute 'connections' with illegal value '" 
+                    ASSERT(false, XLevelRuntime, ("Turnstile set attribute 'connections' with illegal value '"
                             + val.to_string() + "'").c_str());
             }
         } else
             Stone::setAttr(key, val);
     }
-    
+
     Value TurnstileArm::getAttr(const std::string &key) const {
         if (key == "orientation") {
             return state;
@@ -400,22 +400,22 @@
         } else
             return Stone::getAttr(key);
     }
-    
+
     Value TurnstileArm::message(const Message &m) {
         if (m.message == "orientate") {
             setAttr("state", m.value);    // do check min, max limits
         }
         return Stone::message(m);
     }
-    
+
     int TurnstileArm::maxState() const {
         return NORTH;
     }
-    
+
     void TurnstileArm::init_model() {
         set_model(ecl::strf("st-turnstile%s", to_suffix((Direction)state).c_str()));
     }
-    
+
     void TurnstileArm::on_impulse(const Impulse& impulse) {
         enum Action { ROTL, ROTR, stay };
         static Action actions[4][4] = {
@@ -424,10 +424,10 @@
             { stay, ROTR, stay, ROTL }, // east arm
             { ROTL, stay, ROTR, stay }  // north arm
         };
-        
+
         int id = getId();
         TurnstilePivot *pivot = getPivot();
-    
+
         if (pivot != NULL) {
             Action a = actions[state][impulse.dir];
             if (a != stay) {
@@ -446,7 +446,7 @@
             // Move arms not attached to a pivot individually
             move_stone(impulse.dir);
         }
-        
+
         if (Object::getObject(id) != NULL)   // not killed - on pivot action?
             propagateImpulse(impulse);
     }
@@ -454,14 +454,14 @@
     TurnstilePivot *TurnstileArm::getPivot() {
         return dynamic_cast<TurnstilePivot *>(GetStone(move(get_pos(), reverse((Direction)state))));
     }
-    
+
     StoneTraits TurnstileArm::traits[4] = {
         {"st_turnstilearm_w", st_turnstilearm_w, stf_none, material_stone, 1.0, MOVABLE_IRREGULAR},
         {"st_turnstilearm_s", st_turnstilearm_s, stf_none, material_stone, 1.0, MOVABLE_IRREGULAR},
         {"st_turnstilearm_e", st_turnstilearm_e, stf_none, material_stone, 1.0, MOVABLE_IRREGULAR},
         {"st_turnstilearm_n", st_turnstilearm_n, stf_none, material_stone, 1.0, MOVABLE_IRREGULAR},
     };
-    
+
     BOOT_REGISTER_START
         BootRegister(new TurnstilePivot("red"), "st_turnstile");
         BootRegister(new TurnstilePivot("red"), "st_turnstile_red");

Modified: trunk/src/stones/Turnstile.hh
===================================================================
--- trunk/src/stones/Turnstile.hh	2008-09-15 15:38:46 UTC (rev 1330)
+++ trunk/src/stones/Turnstile.hh	2008-09-15 18:45:31 UTC (rev 1331)
@@ -28,39 +28,39 @@
 
     class TurnstileArm;
 
-    /** 
-     * 
+    /**
+     *
      */
     class TurnstilePivot : public Stone {
         CLONEOBJ(TurnstilePivot);
         DECL_TRAITS_ARRAY(2, traitsIdx());
     private:
         enum iState {
-            IDLE,     ///< 
-            ROTATING  ///< 
+            IDLE,     ///<
+            ROTATING  ///<
         };
-        
+
     public:
         TurnstilePivot(std::string flavor);
-        
+
         // Object interface
         virtual std::string getClass() const;
         virtual void setAttr(const string& key, const Value &val);
         virtual Value message(const Message &m);
-        
+
         // StateObject interface
         virtual int maxState() const;
         virtual void setState(int extState);
 
         // GridObject interface
         virtual void init_model();
-        
+
         // ModelCallback interface
         virtual void animcb();
-        
+
         // Stone interface
 //        virtual void actor_hit(const StoneContact &sc);
-        
+
         bool rotate(bool clockwise, Object *impulse_sender, TurnstileArm *initiator);
         int traitsIdx() const;
     private:
@@ -72,36 +72,36 @@
         void handleActorsAndItems(bool clockwise, Object *impulse_sender);
     };
 
-    
-    /** 
-     * 
+
+    /**
+     *
      */
     class TurnstileArm : public Stone {
         CLONEOBJ(TurnstileArm);
         DECL_TRAITS_ARRAY(4, state);
-        
+
     public:
         TurnstileArm(Direction dir);
-        
+
         // Object interface
         virtual std::string getClass() const;
         virtual void setAttr(const string& key, const Value &val);
         virtual Value getAttr(const std::string &key) const;
         virtual Value message(const Message &m);
-        
+
         // StateObject interface
         virtual int maxState() const;
 
         // GridObject interface
         virtual void init_model();
-        
+
         // Stone interface
         virtual void on_impulse(const Impulse& impulse);
-        
+
     private:
         TurnstilePivot *getPivot();
     };
-    
+
 } // namespace enigma
 
 #endif



From andreasl at mail.berlios.de  Mon Sep 15 22:22:11 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Mon, 15 Sep 2008 22:22:11 +0200
Subject: [Enigma-game-svn] r1332 - in trunk/data/levels: enigma_experimental
	lib
Message-ID: <200809152022.m8FKMBcb029783@sheep.berlios.de>

Author: andreasl
Date: 2008-09-15 22:22:06 +0200 (Mon, 15 Sep 2008)
New Revision: 1332

Modified:
   trunk/data/levels/enigma_experimental/test_libsoko.xml
   trunk/data/levels/lib/libsoko-designlist.xml
   trunk/data/levels/lib/libsoko-endphase.xml
   trunk/data/levels/lib/libsoko.xml
Log:
Trunk:
 - Adapt/repair libsoko (part II)
    - switch to namespace lib.soko in nearly all functions
    - remove function hooks
    - adapt test_libsoko.xml
Todo:
 - More beautifications
 - Finetuning of designs
 - Refman
Note:
 - libsoko uses enigma.LoadLib to define the field
   "lib.soko" prior to loading its two extension libraries.


Modified: trunk/data/levels/enigma_experimental/test_libsoko.xml
===================================================================
--- trunk/data/levels/enigma_experimental/test_libsoko.xml	2008-09-15 18:45:31 UTC (rev 1331)
+++ trunk/data/levels/enigma_experimental/test_libsoko.xml	2008-09-15 20:22:06 UTC (rev 1332)
@@ -313,12 +313,12 @@
 
 
 design_min = 1 --76
-design_max = table.getn(design_list)
+design_max = table.getn(lib.soko.design_list)
 
 design_number = 77 --design_max
 
 --create_sokoball(multilevel2, 1, 1)
-create_sokoball(multilevel2, 13, design_number)
+lib.soko.create_sokoball(multilevel2, 13, design_number)
 --create_sokoball(chessoban, 2)
 --draw_sokoball(0, 0, chessoban, 2, nil, true) --leftending)
 wo[{9,1}] = {"st_switch", target="design_minus_one"}
@@ -327,7 +327,7 @@
 
 function leftending(nr)
   if nr == 2 then
-    recreate_sokoball(150, 2)
+    lib.soko.recreate_sokoball(150, 2)
   else
     error("Should never happen!")
   end
@@ -339,7 +339,7 @@
   if design_number < design_min then
     design_number = design_max
   end
-  recreate_sokoball(design_number)
+  lib.soko.recreate_sokoball(design_number)
   wo[{9,1}] = {"st_switch", target="design_minus_one"}
   wo[{10,1}] = {"st_switch", target="design_plus_one"}
 end
@@ -348,7 +348,7 @@
   if design_number > design_max then
     design_number = design_min
   end
-  recreate_sokoball(design_number)
+  lib.soko.recreate_sokoball(design_number)
   wo[{9,1}] = {"st_switch", target="design_minus_one"}
   wo[{10,1}] = {"st_switch", target="design_plus_one"}
 end

Modified: trunk/data/levels/lib/libsoko-designlist.xml
===================================================================
--- trunk/data/levels/lib/libsoko-designlist.xml	2008-09-15 18:45:31 UTC (rev 1331)
+++ trunk/data/levels/lib/libsoko-designlist.xml	2008-09-15 20:22:06 UTC (rev 1332)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libsoko-designlist"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="experimental"/>
       <el:author el:name="Enigma Team" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007, 2008 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -91,7 +91,7 @@
 --   block:X        : create oxyds with blocking object X
 --   outside:X      : create X oxyd-pairs in the outside and outer walls
   
-default_design = {
+lib.soko.default_design = {
   wall = { "st-rock3", "fl-leaves" },
    inf = { "fl-wood" },
   outf = { "fl-water" },
@@ -109,7 +109,7 @@
 -- This is done to avoid a chess-stone from jumping into the void,
 -- as a present to the gamer.
 
-design_list = {
+lib.soko.design_list = {
 
 -- endp-algs: circle, ralf, hide, outside, allcrack, block, fourswitch
 --            vortex, gradients, magnets
@@ -646,7 +646,7 @@
 --   create_sokoban(..., ..., ralfcode_conversion_table[715])
 -- to activate it.
 --
-ralfcode_conversion_table = {
+lib.soko.ralfcode_conversion_table = {
      [0]   = 1,
    [714+1] = 4,
    [715+1] = 70,

Modified: trunk/data/levels/lib/libsoko-endphase.xml
===================================================================
--- trunk/data/levels/lib/libsoko-endphase.xml	2008-09-15 18:45:31 UTC (rev 1331)
+++ trunk/data/levels/lib/libsoko-endphase.xml	2008-09-15 20:22:06 UTC (rev 1332)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libsoko-endphase"/>
-      <el:version el:score="1" el:release="1" el:revision="3" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="4" el:status="experimental"/>
       <el:author el:name="Enigma Team" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007, 2008 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -21,14 +21,16 @@
 -- endphases. Don't include this library with your levels (it won't
 -- have any effect), but libsoko.xml.
 
+lib.soko.GOAL_HOOK_RALF = 1
+
 ------------------------------------------------------------------------
 -- Goal Trigger and Endphase Main Functions
 ------------------------------------------------------------------------
 
-function goal_trigger(onoff, sender)
+function lib.soko.goal_trigger(onoff, sender)
   local nr = sender._sokoarea
   local more_boxes = false  -- memorizes whether a box was added or removed
-  if sokoarea[nr].endphase_started then
+  if lib.soko.sokoarea[nr].endphase_started then
     return
   end
 
@@ -36,7 +38,7 @@
   if(sender._box == 0) then
     if -wo:st(sender) then
       sender._box = 1
-      sokoarea[nr].goals_filled = sokoarea[nr].goals_filled + 1
+      lib.soko.sokoarea[nr].goals_filled = lib.soko.sokoarea[nr].goals_filled + 1
       more_boxes = true
     else
       -- blind alarm, probably a marble
@@ -44,49 +46,48 @@
     end
   else
     sender._box = 0
-    sokoarea[nr].goals_filled = sokoarea[nr].goals_filled - 1
+    lib.soko.sokoarea[nr].goals_filled = lib.soko.sokoarea[nr].goals_filled - 1
   end
 
   -- Call goal_hook, e.g. for algorithms "ralf" and "allcrack".
-  if type(sokoarea[nr].goal_hook) == "function" then
-    sokoarea[nr].goal_hook(nr, sender, more_boxes, sokoarea[nr].goals_filled,
-              sokoarea[nr].number_goals)
+  if type(lib.soko.sokoarea[nr].goal_hook) == "number" then
+    if lib.soko.sokoarea[nr].goal_hook == lib.soko.GOAL_HOOK_RALF then
+      lib.soko.endphase_goal_hook_ralf(nr, sender, more_boxes,
+          lib.soko.sokoarea[nr].goals_filled, lib.soko.sokoarea[nr].number_goals)
   end
   
   -- Start endphase?
-  if sokoarea[nr].goals_filled == sokoarea[nr].number_goals then
-    sokoarea[nr].endphase_started = true
-    if type(sokoarea[nr].endphase_hook) == "function" then
-      sokoarea[nr].endphase_hook(nr)
-    else
-      mydebug("libsoko: No endphase hook found!")
+  if lib.soko.sokoarea[nr].goals_filled == lib.soko.sokoarea[nr].number_goals then
+    lib.soko.sokoarea[nr].endphase_started = true
+    if type(lib.soko.sokoarea[nr].endphase_hook) ~= "nil" then
+      lib.soko.debug("libsoko: Unknown endphase hook.")
     end
   end
 end
 
-function prepare_endphase(sokoarea_number)
+function lib.soko.prepare_endphase(sokoarea_number)
   local nr = sokoarea_number
   -- ensure existence of goals
-  if sokoarea[nr].number_goals < 1 then
-    myerror("No goals defined!\n")
+  if lib.soko.sokoarea[nr].number_goals < 1 then
+    lib.soko.error("No goals defined!\n")
   end
   -- ensure a correctly set endphase-attribute
-  local endp = sokoarea[nr].design.endp
+  local endp = lib.soko.sokoarea[nr].design.endp
   if not endp then
-    sokoarea[nr].design.endp = lib.lua.deep_copy(default_design.endp)
-    endp = sokoarea[nr].design.endp
+    lib.soko.sokoarea[nr].design.endp = lib.lua.deep_copy(lib.soko.default_design.endp)
+    endp = lib.soko.sokoarea[nr].design.endp
   end
   if type(endp) ~= "table" then
-    myerror("This design's endphase is given as "..type(endp)
+    lib.soko.error("This design's endphase is given as "..type(endp)
             ..", should be table.")
   end
   local alg = endp.alg
   if alg == nil then
-    sokoarea[nr].design.endp.alg = lib.lua.deep_copy(default_design.endp.alg)
+    lib.soko.sokoarea[nr].design.endp.alg = lib.lua.deep_copy(lib.soko.default_design.endp.alg)
     alg = endp.alg
   end
   if type(alg) ~= "string" then
-    myerror("This design's endphase algorithm is given as "..type(alg)
+    lib.soko.error("This design's endphase algorithm is given as "..type(alg)
             ..", should be string.")
   end
 
@@ -108,29 +109,29 @@
   elseif (alg == "ralf")
       or (alg == "allcrack")
       or (alg == "vortex") then
-    endphase_set_block_oxyds(nr, (sokoarea[nr].design.door or
-        sokoarea[nr].design.wall or "st_nil"), param)
-    sokoarea[nr].goal_hook = endphase_goal_hook_ralf
+    lib.soko.endphase_set_block_oxyds(nr, (lib.soko.sokoarea[nr].design.door or
+        lib.soko.sokoarea[nr].design.wall or "st_nil"), param)
+    lib.soko.sokoarea[nr].goal_hook = lib.soko.GOAL_HOOK_RALF
   elseif (alg == "block") then
-    endphase_set_block_oxyds(nr, param)
+    lib.soko.endphase_set_block_oxyds(nr, param)
   elseif (alg == "outside") then
-    endphase_set_outside_oxyds(nr, param)
+    lib.soko.endphase_set_outside_oxyds(nr, param)
   elseif (alg == "knock") then
-    endphase_set_block_oxyds(nr, sokoarea[nr].design.door, 3)
-    endphase_set_knocking(nr, param)
+    lib.soko.endphase_set_block_oxyds(nr, lib.soko.sokoarea[nr].design.door, 3)
+    lib.soko.endphase_set_knocking(nr, param)
   -- "Jumpyoxyds" deactivated for once
   --elseif (alg == "jumpyoxyds") then
   --  endphase_set_block_oxyds(nr, "jumpy")
-  --  goal_hook = endphase_goal_hook_ralf
+  --  goal_hook = lib.soko.GOAL_HOOK_RALF
   else
-    mywarning("Endphase algorithm "..alg.." unknown! Will use 'circle' instead.")
+    lib.soko.warning("Endphase algorithm "..alg.." unknown! Will use 'circle' instead.")
   end
 end
 
-function endphase(sokoarea_number)
+function lib.soko.endphase(sokoarea_number)
   -- Correct structure of endp-attribute has been checked
   -- by prepare_endphase, we trust it blindly.
-  local endp = lib.lua.deep_copy(sokoarea[sokoarea_number].design.endp)
+  local endp = lib.lua.deep_copy(lib.soko.sokoarea[sokoarea_number].design.endp)
   local alg = endp.alg
   local param = ""
   local marble = po(no["marble_"..sokoarea_number.."_1"])
@@ -142,9 +143,9 @@
     param = string.sub(endp.alg, sep + 1)
   end
   if param == "" then
-    mydebug("Endphase starts of type "..alg..", no parameter.")
+    lib.soko.debug("Endphase starts of type "..alg..", no parameter.")
   else
-    mydebug("Endphase starts of type "..alg..", parameter "..param..".")
+    lib.soko.debug("Endphase starts of type "..alg..", parameter "..param..".")
   end
 
   -- redraw level and give items
@@ -156,13 +157,13 @@
   if type(give) == "table" then
     for k, v in pairs(give) do
       if is_item(v) or is_stone(v) or is_floor(v) then
-        set_element(marble, sokoarea_number, "", v)
+        lib.soko.set_element(marble, sokoarea_number, "", v)
       elseif is_actor(v) then
         wo[marble] = {v, 0.5, 0.5}
       elseif v == "rubberball" then
         local old_actor = no["marble_"..sokoarea_number.."_1"]
         local actor_kind = "ac-whiteball"
-        if sokoarea[sokoarea_number].design.white then
+        if lib.soko.sokoarea[sokoarea_number].design.white then
           actor_kind = "ac-blackball"
         end
         wo[marble] = {actor_kind, "rubberball_sokoarea_"..sokoarea_number,
@@ -170,11 +171,11 @@
         wo:add({"ot_rubberband", anchor1 = no["marble_"..sokoarea_number],
             anchor2 = no["rubberball_sokoarea_"..sokoarea_number], strength = 50})
       else
-        myerror("Can't give "..v..".")
+        lib.soko.error("Can't give "..v..".")
       end
     end
   elseif type(give) ~= "nil" then
-    myerror("Can't give something of type "..type(v)..".")
+    lib.soko.error("Can't give something of type "..type(v)..".")
   end
 
   if alg == "circle" then
@@ -209,38 +210,38 @@
   end
 end
 
-function endphase_redraw_level_array(sokoarea_number)
+function lib.soko.endphase_redraw_level_array(sokoarea_number)
   local nr = sokoarea_number or 1
-  local endp = lib.lua.deep_copy(sokoarea[nr].design.endp)
-  local offset = sokoarea[nr].offset
+  local endp = lib.lua.deep_copy(lib.soko.sokoarea[nr].design.endp)
+  local offset = lib.soko.sokoarea[nr].offset
   
   -- small routine to check the walls and outside
   local function is_oxyd_or_blocker(x,y)
-    if sokoarea[nr].list_oxyd[x.."/"..y] then
+    if lib.soko.sokoarea[nr].list_oxyd[x.."/"..y] then
       return true
-    elseif sokoarea[nr].list_blocker[x.."/"..y] then
+    elseif lib.soko.sokoarea[nr].list_blocker[x.."/"..y] then
       return true
     end
     return false
   end
   
   -- redraw outside
-  for p, v in pairs(sokoarea[nr].list_outside) do
+  for p, v in pairs(lib.soko.sokoarea[nr].list_outside) do
     if not is_oxyd_or_blocker(v.abs.x, v.abs.y) then
-      set_element(v.abs, nr, k, endp.outf)
+      lib.soko.set_element(v.abs, nr, k, endp.outf)
     end
   end
   
   -- redraw the rest inside level_array:
-  for y = 0, sokoarea[nr].array_height - 1 do
-    for x = 0, sokoarea[nr].array_width - 1 do
+  for y = 0, lib.soko.sokoarea[nr].array_height - 1 do
+    for x = 0, lib.soko.sokoarea[nr].array_width - 1 do
       if not is_oxyd_or_blocker(x + offset.x, y + offset.y) then
-        local ch = sokoarea[nr].level_array[y+1][x+1]
+        local ch = lib.soko.sokoarea[nr].level_array[y+1][x+1]
         for k, v in pairs(endp) do
           if    ((k == "inf")  and char_is_inf(ch))
              or ((k == "wall") and char_is_wall(ch))
              or ((k == "goal") and char_is_goal(ch)) then
-            set_element(offset + {x,y}, nr, k, v)
+            lib.soko.set_element(offset + {x,y}, nr, k, v)
           end
         end
       end
@@ -248,9 +249,9 @@
   end
   
   -- if existent, redraw blocker floors
-  if (sokoarea[nr].list_blocker) and (endp.inf) then
-    for p, v in pairs(sokoarea[nr].list_blocker) do
-      set_element(v.abs, nr, "inf", endp.inf)
+  if (lib.soko.sokoarea[nr].list_blocker) and (endp.inf) then
+    for p, v in pairs(lib.soko.sokoarea[nr].list_blocker) do
+      lib.soko.set_element(v.abs, nr, "inf", endp.inf)
     end
   end 
 end
@@ -259,13 +260,13 @@
 -- Endphase Games and Algorithms
 ------------------------------------------------------------------------
 
-function endphase_circle(sokoarea_number)
-  local flavor = sokoarea[sokoarea_number].design.oxyd or "b"
+function lib.soko.endphase_circle(sokoarea_number)
+  local flavor = lib.soko.sokoarea[sokoarea_number].design.oxyd or "b"
   local actor = no["marble_"..sokoarea_number.."_1"]
   if not -actor then
     actor = no["marble"]
     if not -actor then
-      myerror("No marble found. Please name it 'marble'.")  
+      lib.soko.error("No marble found. Please name it 'marble'.")  
     end
   end
   local abs = po(actor)
@@ -276,14 +277,14 @@
     abs = abs + {0,-2}
   end
   for j = 0, 2 do
-    set_oxyd(sokoarea_number, {abs = abs + {j,-1}}, flavor, 2*j)
-    set_oxyd(sokoarea_number, {abs = abs + {-1,j}}, flavor, 2*j)
-    set_oxyd(sokoarea_number, {abs = abs + {j,3}},  flavor, 2*j+1)
-    set_oxyd(sokoarea_number, {abs = abs + {3,j}},  flavor, 2*j+1)
+    lib.soko.set_oxyd(sokoarea_number, {abs = abs + {j,-1}}, flavor, 2*j)
+    lib.soko.set_oxyd(sokoarea_number, {abs = abs + {-1,j}}, flavor, 2*j)
+    lib.soko.set_oxyd(sokoarea_number, {abs = abs + {j,3}},  flavor, 2*j+1)
+    lib.soko.set_oxyd(sokoarea_number, {abs = abs + {3,j}},  flavor, 2*j+1)
     for k = 0, 2 do
       wo:st(abs + {j,k}):kill()
       wo:it(abs + {j,k}):kill()
-      set_element(abs + {j,k}, sokoarea_number, "inf")
+      lib.soko.set_element(abs + {j,k}, sokoarea_number, "inf")
     end
   end
   wo[abs + {1,1}] = {"st_fart", _sokoarea = sokoarea_number}
@@ -294,18 +295,18 @@
 -- wall_two-area of the level. There will be 2 to 5 pairs of oxyds
 -- depending on the amount of space. PARAM may define a maximal
 -- number of oxyd pairs (good for outf = "fl-space").
-function endphase_set_outside_oxyds(sokoarea_number, param)
+function lib.soko.endphase_set_outside_oxyds(sokoarea_number, param)
   local places = {}
   local nr = sokoarea_number or 1
-  local offset = sokoarea[nr].offset
-  local mx = sokoarea[nr].array_width
-  local my = sokoarea[nr].array_height
-  local flavor = sokoarea[nr].design.oxyd or "b"
+  local offset = lib.soko.sokoarea[nr].offset
+  local mx = lib.soko.sokoarea[nr].array_width
+  local my = lib.soko.sokoarea[nr].array_height
+  local flavor = lib.soko.sokoarea[nr].design.oxyd or "b"
 
   -- Select all places outside or in the walls, unreachable
   -- for the marble.
-  for p, v in pairs(lib.lua.combine_tables(sokoarea[nr].list_outside,
-                sokoarea[nr].list_wall_two)) do
+  for p, v in pairs(lib.lua.combine_tables(lib.soko.sokoarea[nr].list_outside,
+                lib.soko.sokoarea[nr].list_wall_two)) do
     if (v.abs.x % 2 == 0) and (v.abs.y % 2 == 0) then
       table.insert(places, v)
     end
@@ -337,24 +338,24 @@
   places = lib.lua.shuffle(places)
 
   for j = 1, number_pairs do
-    set_oxyd(sokoarea_number, places[2*j-1], flavor, j - 1)
-    set_oxyd(sokoarea_number, places[2*j], flavor, j - 1)
+    lib.soko.set_oxyd(sokoarea_number, places[2*j-1], flavor, j - 1)
+    lib.soko.set_oxyd(sokoarea_number, places[2*j], flavor, j - 1)
   end
   wo:shuffleOxyd()
 end
 
-function endphase_set_block_oxyds(sokoarea_number, blocker, max_pairs)
+function lib.soko.endphase_set_block_oxyds(sokoarea_number, blocker, max_pairs)
   local oxyds = {}
   local nr = sokoarea_number or 1
-  local flavor = sokoarea[nr].design.oxyd or "b"
+  local flavor = lib.soko.sokoarea[nr].design.oxyd or "b"
 
   -- Add all wall_one-elements with exactly one way near as blocker,
   -- and the opposite position as oxyd, if it is of type wall_two.
   -- Make sure that each possible oxyd position is assigned at most once,
   -- and that no other oxyds or blockers are near.
   local function opposite_as_oxyd(xy, dxy)
-    if     sokoarea[nr].list_way[(xy.x+dxy.x).."/"..(xy.y+dxy.y)]
-       and sokoarea[nr].list_wall_two[(xy.x-dxy.x).."/"..(xy.y-dxy.y)] then
+    if     lib.soko.sokoarea[nr].list_way[(xy.x+dxy.x).."/"..(xy.y+dxy.y)]
+       and lib.soko.sokoarea[nr].list_wall_two[(xy.x-dxy.x).."/"..(xy.y-dxy.y)] then
       -- Check that no oxyd has been set on this position before
       -- and no other oxyd or blocker is near the new oxyd or its
       -- blocker.
@@ -373,7 +374,7 @@
     return
   end
   local directions = {po({-1,0}), po({1,0}), po({0,-1}), po({0,1})}
-  for p, v in pairs(sokoarea[nr].list_wall_one) do
+  for p, v in pairs(lib.soko.sokoarea[nr].list_wall_one) do
     if v.count == 1 then
       for _, dir in ipairs(directions) do
         opposite_as_oxyd(v.abs, dir)
@@ -386,7 +387,7 @@
   local number_pairs = 2
   if max < 4 then
     -- Not enough places? Choose "circle"-algorithm instead.
-    sokoarea[nr].design.endp.alg = "circle"
+    lib.soko.sokoarea[nr].design.endp.alg = "circle"
     return
   elseif max <  8 then  number_pairs = 2
   elseif max < 16 then  number_pairs = 3
@@ -418,13 +419,13 @@
       end
     end
     -- now set in-floor and blocker, and add to list_blocker.
-    set_element(w.abs, nr, "inf")
-    set_element(w.abs, nr, "", myblocker)
-    sokoarea[nr].list_blocker[(w.abs.x).."/"..(w.abs.y)] = lib.lua.deep_copy(w)
+    lib.soko.set_element(w.abs, nr, "inf")
+    lib.soko.set_element(w.abs, nr, "", myblocker)
+    lib.soko.sokoarea[nr].list_blocker[(w.abs.x).."/"..(w.abs.y)] = lib.lua.deep_copy(w)
   end
   for j = 1, number_pairs do   -- Testlevel: 14
-    set_oxyd(nr, oxyds[2*j-1], flavor, j - 1)
-    set_oxyd(nr, oxyds[2*j], flavor, j - 1)
+    lib.soko.set_oxyd(nr, oxyds[2*j-1], flavor, j - 1)
+    lib.soko.set_oxyd(nr, oxyds[2*j], flavor, j - 1)
     set_block(oxyds[2*j-1].blocker)
     set_block(oxyds[2*j].blocker)
   end
@@ -434,23 +435,23 @@
   -- Note: There might be more goals as blockers, and, vice versa,
   --       there might be more blockers as goals.
   local goal_table = {}
-  for p, v in pairs(sokoarea[nr].list_goal) do
+  for p, v in pairs(lib.soko.sokoarea[nr].list_goal) do
     table.insert(goal_table, v)
   end
   goal_table = lib.lua.shuffle(goal_table)
   for j = 2, math.min(table.getn(goal_table), table.getn(oxyds)) do
-    sokoarea[nr].goal_to_blocker[goal_table[j].goal_number] = oxyds[j].blocker
+    lib.soko.sokoarea[nr].goal_to_blocker[goal_table[j].goal_number] = oxyds[j].blocker
   end
 end
 
 -- endphase_set_hide_oxyds distributes oxyds over the wall_one-walls.
 -- PARAM is a maximal number of oxyd pairs.
-function endphase_set_hide_oxyds(sokoarea_number, param)
-  local flavor = sokoarea[sokoarea_number].design.oxyd or "b"
+function lib.soko.endphase_set_hide_oxyds(sokoarea_number, param)
+  local flavor = lib.soko.sokoarea[sokoarea_number].design.oxyd or "b"
   local places = {}
   
   -- add all wall_one-elements
-  for p, v in pairs(sokoarea[sokoarea_number].list_wall_one) do
+  for p, v in pairs(lib.soko.sokoarea[sokoarea_number].list_wall_one) do
     table.insert(places, v)
   end
 
@@ -476,29 +477,29 @@
   
   -- set oxyds
   for j = 1, number_pairs do
-    set_oxyd(sokoarea_number, places[2*j-1], flavor, j - 1)
-    set_oxyd(sokoarea_number, places[2*j], flavor, j - 1)
+    lib.soko.set_oxyd(sokoarea_number, places[2*j-1], flavor, j - 1)
+    lib.soko.set_oxyd(sokoarea_number, places[2*j], flavor, j - 1)
   end
   wo:shuffleOxyd()
 end
 
-function endphase_gradients(sokoarea_number, param)
+function lib.soko.endphase_gradients(sokoarea_number, param)
   local force = tonumber(param) or 25.0
-  for p, v in pairs(sokoarea[sokoarea_number].list_way) do
+  for p, v in pairs(lib.soko.sokoarea[sokoarea_number].list_way) do
     local grad_type = random(1,12)
     wo[v.abs] = {"fl-gradient", type = grad_type, force = force}
   end
 end
 
-function endphase_magnets(sokoarea_number, param)
+function lib.soko.endphase_magnets(sokoarea_number, param)
   local force = tonumber(param) or 30.0
   local places = {}
   local nr = sokoarea_number or 1
-  local flavor = sokoarea[nr].design.oxyd or "b"
+  local flavor = lib.soko.sokoarea[nr].design.oxyd or "b"
 
   -- add all way-elements which are not goals
-  for p, v in pairs(sokoarea[nr].list_way) do
-    if not char_is_goal(sokoarea[nr].level_array[v.rel.y][v.rel.x]) then
+  for p, v in pairs(lib.soko.sokoarea[nr].list_way) do
+    if not char_is_goal(lib.soko.sokoarea[nr].level_array[v.rel.y][v.rel.x]) then
       table.insert(places, v)
     end
   end
@@ -514,12 +515,12 @@
   end
 end
 
-function endphase_fourswitch(sokoarea_number)
-  local flavor = sokoarea[sokoarea_number].design.oxyd or "b"
+function lib.soko.endphase_fourswitch(sokoarea_number)
+  local flavor = lib.soko.sokoarea[sokoarea_number].design.oxyd or "b"
   local places = {}
 
   -- add all wall_one-elements
-  for p, v in pairs(sokoarea[sokoarea_number].list_wall_one) do
+  for p, v in pairs(lib.soko.sokoarea[sokoarea_number].list_wall_one) do
     table.insert(places, v)
   end
 
@@ -546,13 +547,13 @@
     places[j].correct = false
   end
   places.number_pairs = number_pairs
-  sokoarea[sokoarea_number].places = lib.lua.deep_copy(places)
+  lib.soko.sokoarea[sokoarea_number].places = lib.lua.deep_copy(places)
 end
 
-function endphase_call_fourswitch(onoff, sender)
+function lib.soko.endphase_call_fourswitch(onoff, sender)
   local j = sender._number
   local nr = sender._sokoarea
-  local places = sokoarea[nr].places
+  local places = lib.soko.sokoarea[nr].places
 
   -- When fourswitch is knocked, count it.
   places[j].current = places[j].current + 1
@@ -570,7 +571,7 @@
   -- fourswitch that doesn't change any other), check all fourswitchs
   -- and replace them by oxyds if all are correct. Else, recreate the
   -- next fourswitch in hierarchy, set it to the old number, then
-  -- set the callback function and call it once by triggering another
+  -- set the callback function lib.soko.and call it once by triggering another
   -- time (making it show the new number). This means: Recursion!
   if j ~= 1 then
     -- Trigger all lower fourswitchs
@@ -595,8 +596,8 @@
     if correct then
       -- replace fourswitchs by oxyds
       for k = 1, places.number_pairs do
-        set_oxyd(sokoarea_number, places[2*k-1], flavor, k - 1)
-        set_oxyd(sokoarea_number, places[2*k], flavor, k - 1)
+        lib.soko.set_oxyd(sokoarea_number, places[2*k-1], flavor, k - 1)
+        lib.soko.set_oxyd(sokoarea_number, places[2*k], flavor, k - 1)
       end
       wo:shuffleOxyd()
     end
@@ -604,47 +605,47 @@
 end
 
 
-function endphase_allcrack(sokoarea_number)
-  for p, v in pairs(sokoarea[sokoarea_number].list_way) do
+function lib.soko.endphase_allcrack(sokoarea_number)
+  for p, v in pairs(lib.soko.sokoarea[sokoarea_number].list_way) do
     if not -wo:it(v.abs) then
       wo[v.abs] = {"it-crack3"}
     end
   end  
 end
 
-function endphase_goal_hook_ralf(sokoarea_number, sender, more_boxes,
+function lib.soko.endphase_goal_hook_ralf(sokoarea_number, sender, more_boxes,
     goals_filled, number_goals)
   local nr = sokoarea_number or 1
   -- verify correct sokoarea-number and existence of "goal_to_blocker"
   if nr ~= sender._sokoarea then
-    myerror("libsoko: Inconsistent sokoarea numbers in goal hook!")
+    lib.soko.error("libsoko: Inconsistent sokoarea numbers in goal hook!")
   end
-  if type(sokoarea[nr].goal_to_blocker) ~= "table" then
-    myerror("libsoko: Blocker list is missing during goal hook!")
+  if type(lib.soko.sokoarea[nr].goal_to_blocker) ~= "table" then
+    lib.soko.error("libsoko: Blocker list is missing during goal hook!")
   end
   -- identify the corresponding door and open it
-  local blocker = sokoarea[nr].goal_to_blocker[sender._goal_number]
+  local blocker = lib.soko.sokoarea[nr].goal_to_blocker[sender._goal_number]
   if blocker then
     endphase_ralf_open_door(nr, more_boxes, blocker.abs)
   end
 end
 
-function endphase_ralf_open_doors(sokoarea_number)
-  for p, v in pairs(sokoarea[sokoarea_number].list_blocker) do
+function lib.soko.endphase_ralf_open_doors(sokoarea_number)
+  for p, v in pairs(lib.soko.sokoarea[sokoarea_number].list_blocker) do
     endphase_ralf_open_door(sokoarea_number, true, v.abs)
   end
 end
 
 -- endphase_ralf_open_door opens or closes a door at position
 -- (X,Y), dependend on the boolean OPEN.
-function endphase_ralf_open_door(sokoarea_number, open, xy)
-  local door_kind = sokoarea[sokoarea_number].design.endp.open_door
+function lib.soko.endphase_ralf_open_door(sokoarea_number, open, xy)
+  local door_kind = lib.soko.sokoarea[sokoarea_number].design.endp.open_door
   if door_kind then
     if not open then
-      door_kind =    sokoarea[sokoarea_number].design.door
-                  or sokoarea[sokoarea_number].design.wall or "st_nil"
+      door_kind =    lib.soko.sokoarea[sokoarea_number].design.door
+                  or lib.soko.sokoarea[sokoarea_number].design.wall or "st_nil"
     end
-    set_element(xy, sokoarea_number, "", door_kind)
+    lib.soko.set_element(xy, sokoarea_number, "", door_kind)
   else
     -- use default "open"/"close"-messages instead
     local st = wo:st(xy)
@@ -662,10 +663,10 @@
   end  
 end
 
-function endphase_vortex(sokoarea_number)
+function lib.soko.endphase_vortex(sokoarea_number)
   local nr = sokoarea_number or 1
   local list_way = 
-    lib.lua.combine_tables(sokoarea[nr].list_way, sokoarea[nr].list_blocker)
+    lib.lua.combine_tables(lib.soko.sokoarea[nr].list_way, lib.soko.sokoarea[nr].list_blocker)
   local components = 0
   local component = {}
 
@@ -678,7 +679,7 @@
   local function mark_component(xy)
     if     (list_way[xy.x.."/"..xy.y])
        and (not list_way[xy.x.."/"..xy.y].component)
-       and (not sokoarea[nr].list_goal[xy.x.."/"..xy.y]) then
+       and (not lib.soko.sokoarea[nr].list_goal[xy.x.."/"..xy.y]) then
       list_way[xy.x.."/"..xy.y].component = components
       --set_floor(({"fl-leaves", "fl-ice", "fl-red", "fl-black", "fl-white",
       --    "fl-sahara", "fl-light", "fl-gray", "fl-lightgray", "fl-rough",
@@ -691,7 +692,7 @@
     end
   end
   for p, v in pairs(list_way) do
-    if (not list_way[p].component) and (not sokoarea[nr].list_goal[p]) then
+    if (not list_way[p].component) and (not lib.soko.sokoarea[nr].list_goal[p]) then
       components = components + 1
       component[components] = {oxyds = 0}
       mark_component(v.abs)
@@ -704,10 +705,10 @@
   end
 
   -- Analyse oxyds and to which components they belong to.
-  for p, v in pairs(sokoarea[nr].list_oxyd) do
+  for p, v in pairs(lib.soko.sokoarea[nr].list_oxyd) do
     local component_number = list_way[v.blocker.abs.x.."/"..v.blocker.abs.y].component or -1
     if component_number == -1 then
-      myerror("Error in component calculation.")
+      lib.soko.error("Error in component calculation.")
     else
       component[component_number].oxyds = component[component_number].oxyds + 1
     end
@@ -756,13 +757,13 @@
   end  
 end
 
-function endphase_set_knocking(sokoarea_number, param)
+function lib.soko.endphase_set_knocking(sokoarea_number, param)
   local nr = sokoarea_number
-  local flavor = sokoarea[nr].design.oxyd or "b"
+  local flavor = lib.soko.sokoarea[nr].design.oxyd or "b"
   local places = {}
 
   -- add all blockers
-  for p, v in pairs(sokoarea[nr].list_blocker) do
+  for p, v in pairs(lib.soko.sokoarea[nr].list_blocker) do
     table.insert(places, v)
   end
 
@@ -781,16 +782,16 @@
   end
 end
 
-function endphase_call_knocking(onoff, sender)
+function lib.soko.endphase_call_knocking(onoff, sender)
   local j = sender._number
   local nr = sender._sokoarea
   if (not nr) or (not j) then
-    myerror("libsoko: Knocking's source has no number or no sokoarea.")
+    lib.soko.error("libsoko: Knocking's source has no number or no sokoarea.")
   end
-  mydebug("Knocked on "..j.."/"..sokoarea[nr].number_oxyds)
+  lib.soko.debug("Knocked on "..j.."/"..lib.soko.sokoarea[nr].number_oxyds)
   -- Deactivate the first door until endphase has started.
-  if (j == 1) and (not sokoarea[nr].endphase_started) then
-    mydebug("Door deactivated until endphase.")
+  if (j == 1) and (not lib.soko.sokoarea[nr].endphase_started) then
+    lib.soko.debug("Door deactivated until endphase.")
     return
   end
   -- Open or close the neccessary doors given as attributes.

Modified: trunk/data/levels/lib/libsoko.xml
===================================================================
--- trunk/data/levels/lib/libsoko.xml	2008-09-15 18:45:31 UTC (rev 1331)
+++ trunk/data/levels/lib/libsoko.xml	2008-09-15 20:22:06 UTC (rev 1332)
@@ -3,15 +3,15 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libsoko"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="experimental"/>
       <el:author el:name="Enigma Team" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007, 2008 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
       <el:compatibility el:enigma="1.10">
         <el:dependency el:path="lib/liblua" el:id="lib/liblua" el:release="1" el:preload="true"/>
         <el:dependency el:path="lib/libmath" el:id="lib/libmath" el:release="1" el:preload="true"/>
-        <el:dependency el:path="lib/libsoko-designlist" el:id="lib/libsoko-designlist" el:release="1" el:preload="true"/>
-        <el:dependency el:path="lib/libsoko-endphase" el:id="lib/libsoko-endphase" el:release="1" el:preload="true"/>
+        <el:dependency el:path="lib/libsoko-designlist" el:id="lib/libsoko-designlist" el:release="1" el:preload="false"/>
+        <el:dependency el:path="lib/libsoko-endphase" el:id="lib/libsoko-endphase" el:release="1" el:preload="false"/>
       </el:compatibility>
       <el:modes el:easy="false" el:single="false" el:network="false"/>
       <el:comments>
@@ -30,16 +30,20 @@
 -- and endphases.
 
 lib.soko = {}
+setmetatable(lib.soko, getmetatable(lib))
 
+enigma.LoadLib("lib/libsoko-designlist")
+enigma.LoadLib("lib/libsoko-endphase")
+
 ------------------------------------------------------------------------
 -- Global variables
 ------------------------------------------------------------------------
 
 -- The global table "sokoarea" holds all sokoban parts a level
--- creates. I.e., sokoarea[1] holds information about the first
--- part, sokoarea[2] about the second etc. In most cases, only
--- sokoarea[1] will be used.
--- Each sokoarea[j] is again a table with the following entries:
+-- creates. I.e., lib.soko.sokoarea[1] holds information about the first
+-- part, lib.soko.sokoarea[2] about the second etc. In most cases, only
+-- lib.soko.sokoarea[1] will be used.
+-- Each lib.soko.sokoarea[j] is again a table with the following entries:
 --
 --        level_array - a 2D-array of characters defining the sokoban part
 --        array_width - width of level_array
@@ -53,15 +57,9 @@
 --         uses_chess - flag to note that st-chess was used (no shogun-triggers)
 --        level_width - width of whole level (create_sokoban only)
 --       level_height - height of whole level (create_sokoban only)
---          goal_hook - function to call when a goal activates/deactivates
---      endphase_hook - function to call when all triggers are filled
+--          goal_hook - describes the function to call when a goal is activated/deactivated
+--      endphase_hook - describes the function to call when all triggers are filled
 --
--- endphase_hook is a function with one argument, the sokoarea-number.
--- goal_hook takes five arguments: Sokoarea-number, goal-object that was
--- triggered, a bool whether the box was added (instead of removed), number
--- of now-filled goals in this area, number of all goals in this area.
--- Hooking goal_hook does not interfere the default operations of libsoko,
--- but hooking endphase_hook results in skipping the usual endphase.
 -- However, you can call endphase(sokoarea_number) yourself if neccessary.
 --
 --       list_outside - list of positions of outf-tiles
@@ -78,19 +76,19 @@
 -- (nil else). Some endphases also use list_oxyd, list_blocker,
 -- goal_to_blocker and/or number_oxyds as additional data structures.
 
-sokoarea = {}
+lib.soko.sokoarea = {}
 
 ------------------------------------------------------------------------
 -- Tools
 ------------------------------------------------------------------------
 
-function mydebug(st)
-  print(st)
+function lib.soko.debug(st)
+  --print(st)
 end
-function mywarning(st)
+function lib.soko.warning(st)
   print(st)
 end
-function myerror(st)
+function lib.soko.error(st)
   error(st, 2)
 end
 
@@ -108,7 +106,7 @@
 
 -- choose_among_multiples selects a number between 1 and COUNT
 -- based on the coordinates X and Y and the algorithm's name ALG.
-function choose_among_multiples(abs, count, alg)
+function lib.soko.choose_among_multiples(abs, count, alg)
   if alg == "checkerboard" then
     return (((abs.x%2) + (abs.y%2)) % count) + 1
   elseif alg == "lines" then
@@ -123,10 +121,10 @@
 
 -- check_chess returns a boolean whether a chess stone is used
 -- in the sokoarea SOKOAREA_NUMBER.
-function check_chess(sokoarea_number)
-  for y = 1, sokoarea[sokoarea_number].array_height do
-    for x = 1, sokoarea[sokoarea_number].array_width do
-      local ch = sokoarea[sokoarea_number].level_array[y][x]
+function lib.soko.check_chess(sokoarea_number)
+  for y = 1, lib.soko.sokoarea[sokoarea_number].array_height do
+    for x = 1, lib.soko.sokoarea[sokoarea_number].array_width do
+      local ch = lib.soko.sokoarea[sokoarea_number].level_array[y][x]
       if char_is_chess(ch) then
         return true
       end
@@ -137,49 +135,49 @@
 
 -- set_oxyd sets an oxyd with given flavor and color and adds
 -- the neccessary entry to list_oxyd.
-function set_oxyd(sokoarea_number, list_entry, flavor, color)
+function lib.soko.set_oxyd(sokoarea_number, list_entry, flavor, color)
   local entry = lib.lua.deep_copy(list_entry)
   entry.flavor = flavor
   entry.color = color
   wo[entry.abs] = {"st_oxyd", flavor = flavor, oxydcolor = color}
-  sokoarea[sokoarea_number].list_oxyd[entry.abs.x.."/"..entry.abs.y] = entry
-  sokoarea[sokoarea_number].number_oxyds =
-      sokoarea[sokoarea_number].number_oxyds + 1
+  lib.soko.sokoarea[sokoarea_number].list_oxyd[entry.abs.x.."/"..entry.abs.y] = entry
+  lib.soko.sokoarea[sokoarea_number].number_oxyds =
+      lib.soko.sokoarea[sokoarea_number].number_oxyds + 1
 end
 
 -- create_lists creates the special lists list_outside, list_wall,
 -- list_way, list_wall_one and list_wall_two for SOKOAREA_NUMBER.
-function create_lists(sokoarea_number)
+function lib.soko.create_lists(sokoarea_number)
   local nr = sokoarea_number or 1
-  local offset = sokoarea[nr].offset
-  local mx = sokoarea[nr].array_width
-  local my = sokoarea[nr].array_height
-  sokoarea[nr].list_outside = {}
-  sokoarea[nr].list_way = {}
-  sokoarea[nr].list_wall_one = {}
-  sokoarea[nr].list_wall_two = {}
+  local offset = lib.soko.sokoarea[nr].offset
+  local mx = lib.soko.sokoarea[nr].array_width
+  local my = lib.soko.sokoarea[nr].array_height
+  lib.soko.sokoarea[nr].list_outside = {}
+  lib.soko.sokoarea[nr].list_way = {}
+  lib.soko.sokoarea[nr].list_wall_one = {}
+  lib.soko.sokoarea[nr].list_wall_two = {}
   -- list_way, list_wall and list_outside (inside level_array)
   for x = 0, mx - 1 do
     for y = 0, my - 1 do
-      local ch = sokoarea[nr].level_array[y+1][x+1]
+      local ch = lib.soko.sokoarea[nr].level_array[y+1][x+1]
       local entry = {abs = offset + {x,y}, rel = po({x+1, y+1})}
       local sig = entry.abs.x.."/"..entry.abs.y
       if char_is_outf(ch) then
-        sokoarea[nr].list_outside[sig] = entry
+        lib.soko.sokoarea[nr].list_outside[sig] = entry
       elseif char_is_wall(ch) then
-        sokoarea[nr].list_wall[sig] = entry
+        lib.soko.sokoarea[nr].list_wall[sig] = entry
       else
-        sokoarea[nr].list_way[sig] = entry
+        lib.soko.sokoarea[nr].list_way[sig] = entry
       end
     end
   end
   -- list_outside (outside level_array)
-  if sokoarea[nr].level_width and sokoarea[nr].level_height then
-    for x = 0, sokoarea[nr].level_width - 1 do
-      for y = 0, sokoarea[nr].level_height - 1 do
+  if lib.soko.sokoarea[nr].level_width and lib.soko.sokoarea[nr].level_height then
+    for x = 0, lib.soko.sokoarea[nr].level_width - 1 do
+      for y = 0, lib.soko.sokoarea[nr].level_height - 1 do
         if    (x < offset.x) or (x > mx + offset.x - 1)
            or (y < offset.y) or (y > my + offset.y - 1) then
-          sokoarea[nr].list_outside[x.."/"..y] = {abs = po({x,y})}
+          lib.soko.sokoarea[nr].list_outside[x.."/"..y] = {abs = po({x,y})}
         end
       end
     end
@@ -189,24 +187,24 @@
   -- (i) it's a wall, (ii) it's near or diagonal to outside,
   -- (iii) it's near a way.
   -- In addition, it counts the number of near ways.
-  for p, v in pairs(sokoarea[nr].list_wall) do
+  for p, v in pairs(lib.soko.sokoarea[nr].list_wall) do
     local x = v.abs.x
     local y = v.abs.y
-    if    sokoarea[nr].list_outside[(x-1).."/"..(y)]
-       or sokoarea[nr].list_outside[(x+1).."/"..(y)]
-       or sokoarea[nr].list_outside[(x).."/"..(y-1)]
-       or sokoarea[nr].list_outside[(x).."/"..(y+1)]
-       or sokoarea[nr].list_outside[(x+1).."/"..(y+1)]
-       or sokoarea[nr].list_outside[(x+1).."/"..(y-1)]
-       or sokoarea[nr].list_outside[(x-1).."/"..(y+1)]
-       or sokoarea[nr].list_outside[(x-1).."/"..(y-1)] then
+    if    lib.soko.sokoarea[nr].list_outside[(x-1).."/"..(y)]
+       or lib.soko.sokoarea[nr].list_outside[(x+1).."/"..(y)]
+       or lib.soko.sokoarea[nr].list_outside[(x).."/"..(y-1)]
+       or lib.soko.sokoarea[nr].list_outside[(x).."/"..(y+1)]
+       or lib.soko.sokoarea[nr].list_outside[(x+1).."/"..(y+1)]
+       or lib.soko.sokoarea[nr].list_outside[(x+1).."/"..(y-1)]
+       or lib.soko.sokoarea[nr].list_outside[(x-1).."/"..(y+1)]
+       or lib.soko.sokoarea[nr].list_outside[(x-1).."/"..(y-1)] then
       local count = 0
-      if sokoarea[nr].list_way[(x-1).."/"..(y)] then  count = count + 1  end
-      if sokoarea[nr].list_way[(x+1).."/"..(y)] then  count = count + 1  end
-      if sokoarea[nr].list_way[(x).."/"..(y-1)] then  count = count + 1  end
-      if sokoarea[nr].list_way[(x).."/"..(y+1)] then  count = count + 1  end
+      if lib.soko.sokoarea[nr].list_way[(x-1).."/"..(y)] then  count = count + 1  end
+      if lib.soko.sokoarea[nr].list_way[(x+1).."/"..(y)] then  count = count + 1  end
+      if lib.soko.sokoarea[nr].list_way[(x).."/"..(y-1)] then  count = count + 1  end
+      if lib.soko.sokoarea[nr].list_way[(x).."/"..(y+1)] then  count = count + 1  end
       if count > 0 then
-        sokoarea[nr].list_wall_one[x.."/"..y] =
+        lib.soko.sokoarea[nr].list_wall_one[x.."/"..y] =
             {abs = v.abs, rel = v.rel, count = count}
       end
     end
@@ -214,27 +212,27 @@
   -- list_wall_two
   -- There are three conditions for an element of list_wall_two:
   -- (i) it's near a wall_one, (ii) it's not a wall_one,
-  -- (iii) it's wall or outside. Next function checks (ii) and (iii)
+  -- (iii) it's wall or outside. Next function lib.soko.checks (ii) and (iii)
   -- and adds the checked element to the list. In addition, the
   -- neighboring wall_one are added into the list.
   local function check_ii_and_iii(x, y, one_x, one_y)
-    if sokoarea[nr].list_wall_one[x.."/"..y] then
+    if lib.soko.sokoarea[nr].list_wall_one[x.."/"..y] then
       return
     end
-    if sokoarea[nr].list_way[x.."/"..y] then
+    if lib.soko.sokoarea[nr].list_way[x.."/"..y] then
       return
     end
-    if not sokoarea[nr].list_wall_two[x.."/"..y] then
+    if not lib.soko.sokoarea[nr].list_wall_two[x.."/"..y] then
       -- create new entry
-      sokoarea[nr].list_wall_two[x.."/"..y] =
+      lib.soko.sokoarea[nr].list_wall_two[x.."/"..y] =
           {abs = po({x,y}), rel = nil, wall_one = {}}
     end
     -- add the corresponding wall_one
-    local w = table.getn(sokoarea[nr].list_wall_two[x.."/"..y].wall_one) + 1
-    sokoarea[nr].list_wall_two[x.."/"..y].wall_one[w] =
-        sokoarea[nr].list_wall_one[one_x.."/"..one_y]
+    local w = table.getn(lib.soko.sokoarea[nr].list_wall_two[x.."/"..y].wall_one) + 1
+    lib.soko.sokoarea[nr].list_wall_two[x.."/"..y].wall_one[w] =
+        lib.soko.sokoarea[nr].list_wall_one[one_x.."/"..one_y]
   end
-  for p, v in pairs(sokoarea[nr].list_wall_one) do
+  for p, v in pairs(lib.soko.sokoarea[nr].list_wall_one) do
     check_ii_and_iii(v.abs.x+1, v.abs.y, v.abs.x, v.abs.y)
     check_ii_and_iii(v.abs.x-1, v.abs.y, v.abs.x, v.abs.y)
     check_ii_and_iii(v.abs.x, v.abs.y+1, v.abs.x, v.abs.y)
@@ -244,11 +242,11 @@
 
 -- new_sokoarea initialises a new entry in the global
 -- sokoarea table and returns its number.
-function new_sokoarea()
-  sokoarea_number = table.getn(sokoarea) + 1
-  sokoarea[sokoarea_number] = {
+function lib.soko.new_sokoarea()
+  sokoarea_number = table.getn(lib.soko.sokoarea) + 1
+  lib.soko.sokoarea[sokoarea_number] = {
     level_array = {},
-    design = default_design,
+    design = lib.soko.default_design,
     algorithms = {},
     number_goals = 0,
     goals_filled = 0,
@@ -278,17 +276,17 @@
 -- Drawing Functions and Level Interpretation
 ------------------------------------------------------------------------
 
--- set_element sets element name EL_STR of area SOKOAREA_NUMBER at x, y.
+-- lib.soko.set_element sets element name EL_STR of area SOKOAREA_NUMBER at x, y.
 -- EL_DESIGN is optional and overrides the design of the given sokoarea.
-function set_element(abs, sokoarea_number, el_str, el_design)
-  if type(sokoarea[sokoarea_number]) ~= "table" then
-    myerror("Sokoarea table number "..sokoarea_number.." broken or not existing.")
+function lib.soko.set_element(abs, sokoarea_number, el_str, el_design)
+  if type(lib.soko.sokoarea[sokoarea_number]) ~= "table" then
+    lib.soko.error("Sokoarea table number "..sokoarea_number.." broken or not existing.")
   end
-  local el = el_design or sokoarea[sokoarea_number].design[el_str]
-  local in_endphase = sokoarea[sokoarea_number].endphase_started
+  local el = el_design or lib.soko.sokoarea[sokoarea_number].design[el_str]
+  local in_endphase = lib.soko.sokoarea[sokoarea_number].endphase_started
 
   if (usertype(abs) ~= "position") then
-    myerror("libsoko.set_element: Coordinate is not a position!")
+    lib.soko.error("libsoko.lib.soko.set_element: Coordinate is not a position!")
     return
   end
 
@@ -329,11 +327,11 @@
         elseif s == "fire"    then  fire = true
         elseif s == "nofire"  then  fire = false
         else
-          mywarning("Unknown entry "..j.."="..s.." in design element.")
+          lib.soko.warning("Unknown entry "..j.."="..s.." in design element.")
         end
       end
     else
-      mywarning("In design element, entry "..j.." is of type "
+      lib.soko.warning("In design element, entry "..j.." is of type "
                 ..type(v)..", not string.")      
     end
   end
@@ -342,7 +340,7 @@
 
   ----------- floor --------------
   if table.getn(fl) > 0 then
-    local flkind = fl[choose_among_multiples(abs, table.getn(fl), multiple_alg)]
+    local flkind = fl[lib.soko.choose_among_multiples(abs, table.getn(fl), multiple_alg)]
     if flkind == "fl-bridge_x" then
       wo[abs] = {"fl-bridge", type = "x", burnable = false, eternal = true}
     elseif flkind == "fl-bridge_y" then
@@ -361,7 +359,7 @@
 
   ----------- stone ---------------
   if table.getn(st) > 0 then
-    local stkind = st[choose_among_multiples(abs, table.getn(st), multiple_alg)]
+    local stkind = st[lib.soko.choose_among_multiples(abs, table.getn(st), multiple_alg)]
     if (not -wo:st(abs)) or (not wo:st(abs):is("st_oxyd")) then
       wo[abs] = {stkind, _sokoarea = sokoarea_number}
       created_objects.st = wo:st(abs)
@@ -370,16 +368,16 @@
 
   ----------- item ----------------
   if table.getn(it) > 0 then
-    local itkind = it[choose_among_multiples(abs, table.getn(it), multiple_alg)]
-    if sokoarea[sokoarea_number].uses_chess and not in_endphase then
+    local itkind = it[lib.soko.choose_among_multiples(abs, table.getn(it), multiple_alg)]
+    if lib.soko.sokoarea[sokoarea_number].uses_chess and not in_endphase then
       itkind = "it_trigger"
     end
     wo[abs] = {itkind}
     created_objects.it = wo:it(abs)
     if (el_str == "goal") and not in_endphase then
-      local gn = sokoarea[sokoarea_number].number_goals + 1
-      sokoarea[sokoarea_number].number_goals = gn
-      sokoarea[sokoarea_number].list_goal[abs.x.."/"..abs.y] =
+      local gn = lib.soko.sokoarea[sokoarea_number].number_goals + 1
+      lib.soko.sokoarea[sokoarea_number].number_goals = gn
+      lib.soko.sokoarea[sokoarea_number].list_goal[abs.x.."/"..abs.y] =
           {abs = abs, goal_number = gn}
       if created_objects.it and not in_endphase then
         created_objects.it.action = "callback"
@@ -418,18 +416,18 @@
 --  - set global variables
 --  - prepare oxyds
 --  - solve the level
--- This function is not intended to be used in level programming
+-- This function lib.soko.is not intended to be used in level programming
 -- directly, use "draw_sokoball" instead.
-function draw_level_array(sokoarea_number, outside, draw_actor)
+function lib.soko.draw_level_array(sokoarea_number, outside, draw_actor)
   local nr = sokoarea_number or 1
-  local design = sokoarea[nr].design
-  local offset = sokoarea[nr].offset
-  sokoarea[nr].list_goal = {}
+  local design = lib.soko.sokoarea[nr].design
+  local offset = lib.soko.sokoarea[nr].offset
+  lib.soko.sokoarea[nr].list_goal = {}
 
   -- create level
-  for y = 0, sokoarea[nr].array_height - 1 do
-    for x = 0, sokoarea[nr].array_width - 1 do
-      local ch = sokoarea[nr].level_array[y+1][x+1]
+  for y = 0, lib.soko.sokoarea[nr].array_height - 1 do
+    for x = 0, lib.soko.sokoarea[nr].array_width - 1 do
+      local ch = lib.soko.sokoarea[nr].level_array[y+1][x+1]
       local obj = {}
       local abs = offset + {x,y}
       
@@ -438,29 +436,29 @@
         if outside then
           wo:st(abs):kill()
           wo:it(abs):kill()
-          set_element(abs, nr, "outf")
+          lib.soko.set_element(abs, nr, "outf")
         end
       else
         wo:st(abs):kill()
         wo:it(abs):kill()
-        obj = set_element(abs, nr, "inf")
+        obj = lib.soko.set_element(abs, nr, "inf")
         obj.fl.freeze_check = true
       end
       
       -- Walls
       if char_is_wall(ch) then
-        obj = set_element(abs, nr, "wall")
+        obj = lib.soko.set_element(abs, nr, "wall")
       end
       
       -- Goals
       if char_is_goal(ch) then
-        obj = set_element(abs, nr, "goal")
+        obj = lib.soko.set_element(abs, nr, "goal")
         wo:fl(abs).freeze_check = false
       end
       
       -- Boxes
       if char_is_box(ch) then
-        obj = set_element(abs, nr, "box")
+        obj = lib.soko.set_element(abs, nr, "box")
         obj.st.freeze_check = true
       end
       
@@ -475,8 +473,8 @@
       
       -- Actors
       if char_is_player(ch) and draw_actor then
-        sokoarea[nr].actor_count = sokoarea[nr].actor_count + 1
-        local acname = "marble_"..nr.."_"..sokoarea[nr].actor_count
+        lib.soko.sokoarea[nr].actor_count = lib.soko.sokoarea[nr].actor_count + 1
+        local acname = "marble_"..nr.."_"..lib.soko.sokoarea[nr].actor_count
         if design["white"] then
           wo[abs] = {"#ac-whiteball", acname, controllers = 1, player = 0}
         else
@@ -507,9 +505,9 @@
 -- in which case SUBLEVEL determines the number of the level to unpack.
 -- Default of SUBLEVEL is 1.
 --
-function unpack_level(multilevel, sublevel_number)
+function lib.soko.unpack_level(multilevel, sublevel_number)
   if type(multilevel) ~= "string" then
-    myerror("Can't make sense of level type "..type(level)..".")
+    lib.soko.error("Can't make sense of level type "..type(level)..".")
   end
   local current_level = 0
   local level = ""
@@ -535,16 +533,16 @@
           level = line.."\n"
         end
       end
-      mydebug("Level "..current_level.." : |"..line.."|")
+      lib.soko.debug("Level "..current_level.." : |"..line.."|")
     else
       in_level = false
     end
   end
   
-  mydebug(level)
+  lib.soko.debug(level)
   
   if level == "" then
-    myerror("libsoko.unpack_level: Multilevel holds less than "
+    lib.soko.error("libsoko.unpack_level: Multilevel holds less than "
             ..sublevel_number.." levels!")
   end
 
@@ -593,7 +591,7 @@
   end  
 
   -- mark outside floor fields from the border
-  function check_for_outside(x, y)
+  local function check_for_outside(x, y)
     if level_array[y][x] == "-" then
       level_array[y][x] = " "
       if y > 1         then  check_for_outside(x, y - 1)  end
@@ -646,9 +644,9 @@
     end
   end
   if (border_n >= border_s) or (border_w >= border_e) then
-    myerror("libsoko: Level is empty or trimming code is corrupt.")
+    lib.soko.error("libsoko: Level is empty or trimming code is corrupt.")
   end
-  mydebug("N: "..border_n..", S: "..border_s
+  lib.soko.debug("N: "..border_n..", S: "..border_s
       ..", W: "..border_w..", E: "..border_e)
   local trimmed_array = {}
   for y = border_n, border_s do
@@ -658,9 +656,9 @@
       trimmed_array[y - border_n + 1][x - border_w + 1] = level_array[y][x]
       line = line .. level_array[y][x]
     end
-    mydebug("|"..line.."|")
+    lib.soko.debug("|"..line.."|")
   end
-  mydebug(table.getn(trimmed_array).." : "..table.getn(trimmed_array[1]))
+  lib.soko.debug(table.getn(trimmed_array).." : "..table.getn(trimmed_array[1]))
   return trimmed_array
 end
 
@@ -766,12 +764,12 @@
 --  only slightly above the normal distribution. However, their
 --  ratio varies with the list length.
 --
--- See also: Landau function g(n) for determining the maximal
+-- See also: Landau function lib.soko.g(n) for determining the maximal
 --           order of an element in the symmetric group S(n).
 --
-function number_from_level(level_array, list_length)
+function lib.soko.number_from_level(level_array, list_length)
   local j = list_length + 1
-  mydebug("Calculating number from level_array, modulus "..list_length.." ...")
+  lib.soko.debug("Calculating number from level_array, modulus "..list_length.." ...")
   local l = 2
   repeat
     j = j - 1
@@ -793,12 +791,12 @@
       end
     end
   until (b == 0) or (j == 1)
-  mydebug("Calculation ended. Result: "..j)
+  lib.soko.debug("Calculation ended. Result: "..j)
   return j
 end
 
-function design_from_level(level_array, list_length)
-  return design_list[number_from_level(level_array,
+function lib.soko.design_from_level(level_array, list_length)
+  return lib.soko.design_list[lib.soko.number_from_level(level_array,
             list_length or table.getn(design_list))]
 end
 
@@ -808,20 +806,20 @@
 --  - a number specifying the number of the design in the design list
 --  - "nil" plus a level_array from which a design from the design
 --    list will be chosen.
-function design_from_description(design_description, level_array, maxdesignnumber)
+function lib.soko.design_from_description(design_description, level_array, maxdesignnumber)
   -- choose design
   local design = {}
   if type(design_description) == "number" then
-    design = lib.lua.deep_copy(design_list[design_description])
+    design = lib.lua.deep_copy(lib.soko.design_list[design_description])
   elseif type(design_description) == "table" then
     design = lib.lua.deep_copy(design_description)
   elseif (type(design_description) == "nil") and (type(level_array) == "table") then
-    design = lib.lua.deep_copy(design_from_level(level_array, maxdesignnumber))
+    design = lib.lua.deep_copy(lib.soko.design_from_level(level_array, maxdesignnumber))
   else
-    myerror("Can't make sense of design type "..type(design)..".")
+    lib.soko.error("Can't make sense of design type "..type(design)..".")
   end
   -- fill chosen design with default values where neccessary
-  design = lib.lua.combine_tables({design, default_design})
+  design = lib.lua.combine_tables({design, lib.soko.default_design})
   -- No stone set for outf, not even "st_nil"?
   -- Use the default outf-stone instead, and remove it on endphase.
   if type(design.outf) ~= "table" then
@@ -832,7 +830,7 @@
       return design
     end
   end
-  table.insert(design.outf, default_design.outf_default_stone)
+  table.insert(design.outf, lib.soko.default_design.outf_default_stone)
   if type(design.endp.outf) ~= "table" then
     design.endp.outf = {design.endp.outf}
   end
@@ -863,60 +861,60 @@
 -- design list is enlarged.
 -- Returns width and height of new level.
 --
-function create_sokoball(level, sublevel, design, maxdesignnumber)
+function lib.soko.create_sokoball(level, sublevel, design, maxdesignnumber)
   -- check that this is the first sokoarea, and initialise it.
-  if type(sokoarea) ~= "table" then
-    myerror("No sense in sokoarea of type "..type(sokoarea)..".")
+  if type(lib.soko.sokoarea) ~= "table" then
+    lib.soko.error("No sense in sokoarea of type "..type(sokoarea)..".")
   end
-  if table.getn(sokoarea) ~= 0 then
-    myerror("Tried to use create_sokoball twice. Use draw_sokoball instead.")
+  if table.getn(lib.soko.sokoarea) ~= 0 then
+    lib.soko.error("Tried to use create_sokoball twice. Use draw_sokoball instead.")
   end
-  new_sokoarea()
+  lib.soko.new_sokoarea()
 
   -- unpack level
-  sokoarea[1].level_array = unpack_level(level, sublevel)
+  lib.soko.sokoarea[1].level_array = lib.soko.unpack_level(level, sublevel)
 
   -- calculate screen position
   -- Important Note: level_array is reversely indexed, i.e.
   --                 level_array[y-coordinate][x-coordinate]
-  sokoarea[1].array_width = table.getn(sokoarea[1].level_array[1])
-  sokoarea[1].array_height = table.getn(sokoarea[1].level_array)
-  sokoarea[1].uses_chess = check_chess(1)
-  local levelw = math.max(sokoarea[1].array_width, 20)
-  local levelh = math.max(sokoarea[1].array_height, 13)
-  sokoarea[1].level_width = levelw
-  sokoarea[1].level_height = levelh
+  lib.soko.sokoarea[1].array_width = table.getn(lib.soko.sokoarea[1].level_array[1])
+  lib.soko.sokoarea[1].array_height = table.getn(lib.soko.sokoarea[1].level_array)
+  lib.soko.sokoarea[1].uses_chess = lib.soko.check_chess(1)
+  local levelw = math.max(lib.soko.sokoarea[1].array_width, 20)
+  local levelh = math.max(lib.soko.sokoarea[1].array_height, 13)
+  lib.soko.sokoarea[1].level_width = levelw
+  lib.soko.sokoarea[1].level_height = levelh
   ti[" "] = {"fl-abyss"}
   wo(ti, " ", levelw, levelh)
   
   -- calculate padding
   local dx = 0
   local dy = 0
-  if levelw > sokoarea[1].array_width then
-    dx = math.floor((levelw - sokoarea[1].array_width) / 2)
+  if levelw > lib.soko.sokoarea[1].array_width then
+    dx = math.floor((levelw - lib.soko.sokoarea[1].array_width) / 2)
   end
-  if levelh > sokoarea[1].array_height then
-    dy = math.floor((levelh - sokoarea[1].array_height) / 2)
+  if levelh > lib.soko.sokoarea[1].array_height then
+    dy = math.floor((levelh - lib.soko.sokoarea[1].array_height) / 2)
   end
-  sokoarea[1].offset = po({dx, dy})
+  lib.soko.sokoarea[1].offset = po({dx, dy})
 
   -- calculate design
-  sokoarea[1].design =
-    design_from_description(design, sokoarea[1].level_array, maxdesignnumber)
+  lib.soko.sokoarea[1].design =
+    lib.soko.design_from_description(design, lib.soko.sokoarea[1].level_array, maxdesignnumber)
 
   -- create special position lists
-  create_lists(nr)
+  lib.soko.create_lists(nr)
   
   -- draw level
   for x = 0, levelw - 1 do
     for y = 0, levelh - 1 do
-      set_element(po({x,y}), 1, "outf")
+      lib.soko.set_element(po({x,y}), 1, "outf")
     end
   end
-  draw_level_array(1, true, true)
+  lib.soko.draw_level_array(1, true, true)
   
   -- prepare oxyds for end phase
-  prepare_endphase(1)
+  lib.soko.prepare_endphase(1)
 
   -- Enigma's global variables
   wo["ConserveLevel"] = false
@@ -933,54 +931,54 @@
 -- from scratch, but not the world and doesn't add another
 -- actor.
 --
-function recreate_sokoball(design, maxdesignnumber, sokoarea_number)
+function lib.soko.recreate_sokoball(design, maxdesignnumber, sokoarea_number)
   local nr = sokoarea_number or 1
 
-  sokoarea[nr].design =
-      design_from_description(design, sokoarea[nr].level_array, maxdesignnumber)
+  lib.soko.sokoarea[nr].design =
+      lib.soko.design_from_description(design, lib.soko.sokoarea[nr].level_array, maxdesignnumber)
 
-  if sokoarea[nr].level_width and sokoarea[nr].level_height then
-    for x = 0, sokoarea[nr].level_width - 1 do
-      for y = 0, sokoarea[nr].level_height - 1 do
+  if lib.soko.sokoarea[nr].level_width and lib.soko.sokoarea[nr].level_height then
+    for x = 0, lib.soko.sokoarea[nr].level_width - 1 do
+      for y = 0, lib.soko.sokoarea[nr].level_height - 1 do
         wo:st(x, y):kill()
         wo:it(x, y):kill()
-        set_element(po({x,y}), nr, "outf")
+        lib.soko.set_element(po({x,y}), nr, "outf")
       end
     end
   else
-    for x = 0, sokoarea[nr].array_width - 1 do
-      for y = 0, sokoarea[nr].array_height - 1 do
-        local abs = sokoarea[nr].offset + {x,y}
+    for x = 0, lib.soko.sokoarea[nr].array_width - 1 do
+      for y = 0, lib.soko.sokoarea[nr].array_height - 1 do
+        local abs = lib.soko.sokoarea[nr].offset + {x,y}
         wo:st(abs):kill()
         wo:it(abs):kill()
-        set_element(abs, nr, "outf")
+        lib.soko.set_element(abs, nr, "outf")
       end
     end
   end
 
-  sokoarea[nr].number_goals = 0
-  sokoarea[nr].goals_filled = 0
-  sokoarea[nr].endphase_started = false
-  sokoarea[nr].goal_to_blocker = {}
-  sokoarea[nr].goal_hook = nil
-  sokoarea[nr].list_goal = {}
-  sokoarea[nr].list_oxyd = {}
-  sokoarea[nr].list_blocker = {}
-  sokoarea[nr].number_oxyds = 0
-  sokoarea[nr].goal_to_blocker = {}
-  sokoarea[nr].endphase_hook = endphase
+  lib.soko.sokoarea[nr].number_goals = 0
+  lib.soko.sokoarea[nr].goals_filled = 0
+  lib.soko.sokoarea[nr].endphase_started = false
+  lib.soko.sokoarea[nr].goal_to_blocker = {}
+  lib.soko.sokoarea[nr].list_goal = {}
+  lib.soko.sokoarea[nr].list_oxyd = {}
+  lib.soko.sokoarea[nr].list_blocker = {}
+  lib.soko.sokoarea[nr].number_oxyds = 0
+  lib.soko.sokoarea[nr].goal_to_blocker = {}
+  lib.soko.sokoarea[nr].goal_hook = nil
+  lib.soko.sokoarea[nr].endphase_hook = endphase
 
-  --sokoarea[nr].list_outside = {}
-  --sokoarea[nr].list_wall = {}
-  --sokoarea[nr].list_way = {}
-  --sokoarea[nr].list_wall_one = {}
-  --sokoarea[nr].list_wall_two = {}
+  --lib.soko.sokoarea[nr].list_outside = {}
+  --lib.soko.sokoarea[nr].list_wall = {}
+  --lib.soko.sokoarea[nr].list_way = {}
+  --lib.soko.sokoarea[nr].list_wall_one = {}
+  --lib.soko.sokoarea[nr].list_wall_two = {}
 
-  draw_level_array(nr, true, false)
+  lib.soko.draw_level_array(nr, true, false)
 
   -- prepare oxyds for end phase
-  prepare_endphase(nr)
-  mydebug("Prepared for endphase "..sokoarea[nr].design.endp.alg..".")
+  lib.soko.prepare_endphase(nr)
+  lib.soko.debug("Prepared for endphase "..lib.soko.sokoarea[nr].design.endp.alg..".")
 end
 
 -- draw_sokoball draws a sokoball level from argument LEVEL, sublevel
@@ -996,36 +994,36 @@
 --  - draw any oxyds
 --  - solve the level when all triggers are activated.
 -- DRAW_ACTOR determines if an actor should be placed.
--- ENDPHASE_HOOK is the function to be called when all goals are filled.
--- GOAL_HOOK is called when a single goal is triggered (see libsoko-endphase).
--- (As a function, not as a string!) If it's nil, the standard
+-- ENDPHASE_HOOK describes the function to be called when all goals are filled.
+-- GOAL_HOOK describes the function to be called when a single goal is
+-- triggered (see libsoko-endphase). If it's nil, the standard
 -- function from this library will be called. This might be
 -- broken as no oxyds have been prepared.
 -- Note: Overwriting one sokoarea with another creates problems
 --       with the triggers.
 --
-function draw_sokoball(offset, level, sublevel, design, draw_actor,
+function lib.soko.draw_sokoball(offset, level, sublevel, design, draw_actor,
                        endphase_hook, goal_hook)
-  local nr = new_sokoarea()
+  local nr = lib.soko.new_sokoarea()
   -- unpack level
-  sokoarea[nr].level_array = unpack_level(level, sublevel)
-  sokoarea[nr].array_width = table.getn(sokoarea[nr].level_array[1])
-  sokoarea[nr].array_height = table.getn(sokoarea[nr].level_array)
-  sokoarea[nr].uses_chess = check_chess(nr)
-  sokoarea[nr].offset = offset
-  sokoarea[nr].design = 
-      design_from_description(design, sokoarea[nr].level_array)
+  lib.soko.sokoarea[nr].level_array = lib.soko.unpack_level(level, sublevel)
+  lib.soko.sokoarea[nr].array_width = table.getn(lib.soko.sokoarea[nr].level_array[1])
+  lib.soko.sokoarea[nr].array_height = table.getn(lib.soko.sokoarea[nr].level_array)
+  lib.soko.sokoarea[nr].uses_chess = lib.soko.check_chess(nr)
+  lib.soko.sokoarea[nr].offset = offset
+  lib.soko.sokoarea[nr].design = 
+    lib.soko.design_from_description(design, lib.soko.sokoarea[nr].level_array)
   if hook ~= nil then
-    sokoarea[nr].endphase_hook = endphase_hook
+    lib.soko.sokoarea[nr].endphase_hook = endphase_hook
   end
-  sokoarea[nr].goal_hook = goal_hook
-  create_lists(nr)
-  draw_level_array(nr, false, draw_actor)
+  lib.soko.sokoarea[nr].goal_hook = goal_hook
+  lib.soko.create_lists(nr)
+  lib.soko.draw_level_array(nr, false, draw_actor)
 end
 
--- design_statistics uses mywarning to output statistics of
+-- design_statistics uses lib.soko.warning to output statistics of
 -- the used algorithms
-function design_statistics()
+function lib.soko.design_statistics()
   alglist = {}
   for k, v in pairs(design_list) do
     if v.endp then
@@ -1038,7 +1036,7 @@
     end
   end
   for k, v in pairs(alglist) do
-    mywarning(k..": "..v)
+    lib.soko.warning(k..": "..v)
   end
 end
 



From andreasl at mail.berlios.de  Wed Sep 17 21:55:10 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Wed, 17 Sep 2008 21:55:10 +0200
Subject: [Enigma-game-svn] r1333 - trunk/data/levels/lib
Message-ID: <200809171955.m8HJtAKI023685@sheep.berlios.de>

Author: andreasl
Date: 2008-09-17 21:55:07 +0200 (Wed, 17 Sep 2008)
New Revision: 1333

Modified:
   trunk/data/levels/lib/libsoko-endphase.xml
   trunk/data/levels/lib/libsoko.xml
Log:
Trunk:
 - Fix of rev. 1332 (libsoko).


Modified: trunk/data/levels/lib/libsoko-endphase.xml
===================================================================
--- trunk/data/levels/lib/libsoko-endphase.xml	2008-09-15 20:22:06 UTC (rev 1332)
+++ trunk/data/levels/lib/libsoko-endphase.xml	2008-09-17 19:55:07 UTC (rev 1333)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libsoko-endphase"/>
-      <el:version el:score="1" el:release="1" el:revision="4" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="5" el:status="experimental"/>
       <el:author el:name="Enigma Team" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007, 2008 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -22,12 +22,13 @@
 -- have any effect), but libsoko.xml.
 
 lib.soko.GOAL_HOOK_RALF = 1
+lib.soko.ENDPHASE_HOOK_DEFAULT = 1
 
 ------------------------------------------------------------------------
 -- Goal Trigger and Endphase Main Functions
 ------------------------------------------------------------------------
 
-function lib.soko.goal_trigger(onoff, sender)
+function lib_soko_goal_trigger(onoff, sender)
   local nr = sender._sokoarea
   local more_boxes = false  -- memorizes whether a box was added or removed
   if lib.soko.sokoarea[nr].endphase_started then
@@ -54,13 +55,24 @@
     if lib.soko.sokoarea[nr].goal_hook == lib.soko.GOAL_HOOK_RALF then
       lib.soko.endphase_goal_hook_ralf(nr, sender, more_boxes,
           lib.soko.sokoarea[nr].goals_filled, lib.soko.sokoarea[nr].number_goals)
+    else
+      lib.soko.error("libsoko: Unknown goal hook.")
+    end
   end
   
   -- Start endphase?
   if lib.soko.sokoarea[nr].goals_filled == lib.soko.sokoarea[nr].number_goals then
     lib.soko.sokoarea[nr].endphase_started = true
-    if type(lib.soko.sokoarea[nr].endphase_hook) ~= "nil" then
-      lib.soko.debug("libsoko: Unknown endphase hook.")
+    if type(lib.soko.sokoarea[nr].endphase_hook) == "number" then
+      if lib.soko.sokoarea[nr].endphase_hook == lib.soko.ENDPHASE_HOOK_DEFAULT then
+        lib.soko.endphase(nr)
+      else
+        lib.soko.error("libsoko: Unknown endphase hook number " .. 
+          lib.soko.sokoarea[nr].endphase_hook .. ".")
+      end
+    else
+      lib.soko.error("libsoko: Unknown endphase hook of type "
+        .. type(lib.soko.sokoarea[nr].endphase_hook) .. ".")
     end
   end
 end
@@ -149,7 +161,7 @@
   end
 
   -- redraw level and give items
-  endphase_redraw_level_array(sokoarea_number)
+  lib.soko.endphase_redraw_level_array(sokoarea_number)
   local give = lib.lua.deep_copy(endp.give)
   if type(give) == "string" then
     give = {give}
@@ -179,34 +191,34 @@
   end
 
   if alg == "circle" then
-    endphase_circle(sokoarea_number)
+    lib.soko.endphase_circle(sokoarea_number)
   elseif alg == "hide" then
-    endphase_set_hide_oxyds(sokoarea_number, param)
+    lib.soko.endphase_set_hide_oxyds(sokoarea_number, param)
   elseif    (alg == "ralf")
          or (alg == "outside")
          --or (alg == "jumpyoxyds")
          or (alg == "block") then
-    endphase_ralf_open_doors(sokoarea_number)
+    lib.soko.endphase_ralf_open_doors(sokoarea_number)
   elseif alg == "allcrack" then
-    endphase_ralf_open_doors(sokoarea_number)
-    endphase_allcrack(sokoarea_number)
+    lib.soko.endphase_ralf_open_doors(sokoarea_number)
+    lib.soko.endphase_allcrack(sokoarea_number)
   elseif alg == "fourswitch" then
-    endphase_fourswitch(sokoarea_number)
+    lib.soko.endphase_fourswitch(sokoarea_number)
   elseif alg == "vortex" then
-    endphase_ralf_open_doors(sokoarea_number)
-    endphase_vortex(sokoarea_number)
+    lib.soko.endphase_ralf_open_doors(sokoarea_number)
+    lib.soko.endphase_vortex(sokoarea_number)
   elseif alg == "gradients" then
-    endphase_set_hide_oxyds(sokoarea_number)
-    endphase_gradients(sokoarea_number, param)
+    lib.soko.endphase_set_hide_oxyds(sokoarea_number)
+    lib.soko.endphase_gradients(sokoarea_number, param)
   elseif alg == "magnets" then
-    endphase_set_hide_oxyds(sokoarea_number)
-    endphase_magnets(sokoarea_number, param)
+    lib.soko.endphase_set_hide_oxyds(sokoarea_number)
+    lib.soko.endphase_magnets(sokoarea_number, param)
   elseif alg == "knock" then
     -- don't do anything; endphase_call_knocking
     -- queries endphase_started.
   else
     -- use default: "circle"
-    endphase_circle(sokoarea_number)
+    lib.soko.endphase_circle(sokoarea_number)
   end
 end
 
@@ -462,7 +474,7 @@
   local number_pairs = 1
   if max < 2 then
     -- use circle instead
-    endphase_circle(sokoarea)
+    lib.soko.endphase_circle(sokoarea)
     return
   elseif max <  6  then  number_pairs = 2
   elseif max < 10  then  number_pairs = 3
@@ -531,7 +543,7 @@
   local number_pairs = 1
   if max < 2 then
     -- use circle instead
-    endphase_circle(sokoarea_number)
+    lib.soko.endphase_circle(sokoarea_number)
     return
   elseif max <  6  then  number_pairs = 2
   elseif max < 10  then  number_pairs = 3
@@ -540,7 +552,7 @@
   -- set fourswitchs
   for j = 1, 2*number_pairs do
     wo[places[j].abs] =
-        {"st_fourswitch", target = "endphase_call_fourswitch", _number = j,
+        {"st_fourswitch", target = "lib_soko_endphase_call_fourswitch", _number = j,
          _sokoarea = sokoarea_number}
     places[j].current = 4
     places[j].solve = random(1,4)
@@ -550,7 +562,7 @@
   lib.soko.sokoarea[sokoarea_number].places = lib.lua.deep_copy(places)
 end
 
-function lib.soko.endphase_call_fourswitch(onoff, sender)
+function lib_soko_endphase_call_fourswitch(onoff, sender)
   local j = sender._number
   local nr = sender._sokoarea
   local places = lib.soko.sokoarea[nr].places
@@ -571,7 +583,7 @@
   -- fourswitch that doesn't change any other), check all fourswitchs
   -- and replace them by oxyds if all are correct. Else, recreate the
   -- next fourswitch in hierarchy, set it to the old number, then
-  -- set the callback function lib.soko.and call it once by triggering another
+  -- set the callback function and call it once by triggering another
   -- time (making it show the new number). This means: Recursion!
   if j ~= 1 then
     -- Trigger all lower fourswitchs
@@ -583,7 +595,7 @@
       for k = 1, places[j-1].current do
         mystone:toggle()
       end
-      mystone.target = "endphase_call_fourswitch"
+      mystone.target = "lib_soko_endphase_call_fourswitch"
       places[j-1].correct = false
     end
     wo:st(xy):toggle()
@@ -626,13 +638,13 @@
   -- identify the corresponding door and open it
   local blocker = lib.soko.sokoarea[nr].goal_to_blocker[sender._goal_number]
   if blocker then
-    endphase_ralf_open_door(nr, more_boxes, blocker.abs)
+    lib.soko.endphase_ralf_open_door(nr, more_boxes, blocker.abs)
   end
 end
 
 function lib.soko.endphase_ralf_open_doors(sokoarea_number)
   for p, v in pairs(lib.soko.sokoarea[sokoarea_number].list_blocker) do
-    endphase_ralf_open_door(sokoarea_number, true, v.abs)
+    lib.soko.endphase_ralf_open_door(sokoarea_number, true, v.abs)
   end
 end
 
@@ -774,7 +786,7 @@
     local st = wo:st(v.abs)
     if -st then
       st.action = "callback"
-      st.target = "endphase_call_knocking"
+      st.target = "lib_soko_endphase_call_knocking"
       st._close = places[lib.lua.mod(j, table.getn(places)) + 1].abs
       st._open = places[lib.lua.mod(j+1, table.getn(places)) + 1].abs
       st._number = j
@@ -782,7 +794,7 @@
   end
 end
 
-function lib.soko.endphase_call_knocking(onoff, sender)
+function lib_soko_endphase_call_knocking(onoff, sender)
   local j = sender._number
   local nr = sender._sokoarea
   if (not nr) or (not j) then

Modified: trunk/data/levels/lib/libsoko.xml
===================================================================
--- trunk/data/levels/lib/libsoko.xml	2008-09-15 20:22:06 UTC (rev 1332)
+++ trunk/data/levels/lib/libsoko.xml	2008-09-17 19:55:07 UTC (rev 1333)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libsoko"/>
-      <el:version el:score="1" el:release="1" el:revision="3" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="4" el:status="experimental"/>
       <el:author el:name="Enigma Team" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007, 2008 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -83,7 +83,7 @@
 ------------------------------------------------------------------------
 
 function lib.soko.debug(st)
-  --print(st)
+  print(st)
 end
 function lib.soko.warning(st)
   print(st)
@@ -257,7 +257,7 @@
     level_height = nil,
     uses_chess = false,
     goal_hook = nil,
-    endphase_hook = endphase,
+    endphase_hook = lib.soko.ENDPHASE_HOOK_DEFAULT,
     list_outside = {},
     list_wall = {},
     list_way = {},
@@ -381,7 +381,7 @@
           {abs = abs, goal_number = gn}
       if created_objects.it and not in_endphase then
         created_objects.it.action = "callback"
-        created_objects.it.target = "goal_trigger"
+        created_objects.it.target = "lib_soko_goal_trigger"
         created_objects.it._box = 0
         created_objects.it._sokoarea = sokoarea_number
         created_objects.it._goal_number = gn
@@ -966,7 +966,7 @@
   lib.soko.sokoarea[nr].number_oxyds = 0
   lib.soko.sokoarea[nr].goal_to_blocker = {}
   lib.soko.sokoarea[nr].goal_hook = nil
-  lib.soko.sokoarea[nr].endphase_hook = endphase
+  lib.soko.sokoarea[nr].endphase_hook = lib.soko.ENDPHASE_HOOK_DEFAULT
 
   --lib.soko.sokoarea[nr].list_outside = {}
   --lib.soko.sokoarea[nr].list_wall = {}
@@ -1014,7 +1014,7 @@
   lib.soko.sokoarea[nr].design = 
     lib.soko.design_from_description(design, lib.soko.sokoarea[nr].level_array)
   if hook ~= nil then
-    lib.soko.sokoarea[nr].endphase_hook = endphase_hook
+    lib.soko.sokoarea[nr].endphase_hook = lib.soko.ENDPHASE_HOOK_DEFAULT
   end
   lib.soko.sokoarea[nr].goal_hook = goal_hook
   lib.soko.create_lists(nr)



From ral at mail.berlios.de  Thu Sep 18 00:09:07 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 18 Sep 2008 00:09:07 +0200
Subject: [Enigma-game-svn] r1334 - in trunk: data src src/stones
Message-ID: <200809172209.m8HM97Tg010551@sheep.berlios.de>

Author: ral
Date: 2008-09-18 00:09:04 +0200 (Thu, 18 Sep 2008)
New Revision: 1334

Modified:
   trunk/data/api1init.lua
   trunk/src/GridObject.cc
   trunk/src/stones/PuzzleStone.cc
Log:
Trunk 1.1: new API reengineering
- fix GridObject light handling for stones moving on light impulses
- puzzle part 4:
  - fix api 1 mapping
  - laser light rotations: fix and ensure reliable rotations, ignore
       initial light due to the snapshot principle


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-09-17 19:55:07 UTC (rev 1333)
+++ trunk/data/api1init.lua	2008-09-17 22:09:04 UTC (rev 1334)
@@ -235,7 +235,7 @@
     st_puzzle_blue_new = "st-puzzle-new",
     st_puzzle_blue_nes = "st-puzzle-nes",
     st_puzzle_blue_nesw = "st-puzzle-nesw",
-    st_puzzle_blue_hollow = "st-puzzle-hollow",
+    st_puzzle_blue_nesw_hollow = "st-puzzle-hollow",
     st_puzzle_yellow_w = "st-puzzle2-w",
     st_puzzle_yellow_s = "st-puzzle2-s",
     st_puzzle_yellow_sw = "st-puzzle2-sw",
@@ -250,6 +250,7 @@
     st_puzzle_yellow_ne = "st-puzzle2-ne",
     st_puzzle_yellow_new = "st-puzzle2-new",
     st_puzzle_yellow_nes = "st-puzzle2-nes",
+    st_puzzle_yellow_nesw = "st-puzzle2-nesw",
     st_puzzle_yellow_nesw_hollow = "st-puzzle2-hollow",
     st_rotator_cw = "st-rotator-right",
     st_rotator_ccw = "st-rotator-left",

Modified: trunk/src/GridObject.cc
===================================================================
--- trunk/src/GridObject.cc	2008-09-17 19:55:07 UTC (rev 1333)
+++ trunk/src/GridObject.cc	2008-09-17 22:09:04 UTC (rev 1334)
@@ -259,7 +259,7 @@
     
     void GridObject::activatePhoto() {
         ASSERT((objFlags & OBJBIT_PHOTOACTIV) == 0, XLevelRuntime , "GridObject: double photo sensor activation");
-        photoSensorList.push_back(this);
+        photoSensorList.push_front(this);  // it is essential to insert at front in case a object is moved on lightDirChanged()
         objFlags |= OBJBIT_PHOTOACTIV;
     }
 

Modified: trunk/src/stones/PuzzleStone.cc
===================================================================
--- trunk/src/stones/PuzzleStone.cc	2008-09-17 19:55:07 UTC (rev 1333)
+++ trunk/src/stones/PuzzleStone.cc	2008-09-17 22:09:04 UTC (rev 1334)
@@ -99,6 +99,9 @@
         } else if (m.message == "push_rotate") {
             rotateLine(to_direction(m.value), true);
             return Value();
+        } else if (m.message == "_init") {
+            updateCurrentLightDirs();
+            return Value();
         }
         return Stone::message(m);
     }
@@ -124,6 +127,7 @@
             objFlags |= OBJBIT_INIT;
         }
         activatePhoto();
+        updateCurrentLightDirs();
         Stone::on_creation(p);
     }
 
@@ -131,10 +135,16 @@
         if (state == IDLE && !(objFlags & OBJBIT_HOLLOW)) {
             DirectionBits addDirs = added_dirs(oldDirs, newDirs);
             if (addDirs != NODIRBIT && !explodeCluster() && getAttr("color") == BLUE) {
+                GridPos p = get_pos();
                 if (addDirs & SOUTHBIT) rotateLine(SOUTH);
-                if (addDirs & NORTHBIT) rotateLine(NORTH);
-                if (addDirs & WESTBIT)  rotateLine(WEST);
-                if (addDirs & EASTBIT)  rotateLine(EAST);
+                if (p == get_pos() && (addDirs & WESTBIT))  rotateLine(WEST);
+                if (p == get_pos() && (addDirs & NORTHBIT)) rotateLine(NORTH);
+                if (p == get_pos() && (addDirs & EASTBIT))  rotateLine(EAST);
+                
+                if (p != get_pos() && GetStone(p)->getAttr("hollow").to_bool()) {
+                    // we are still enlighted via hollow successor
+                    objFlags |= to_bits(direction_fromto(p, get_pos()));
+                }
             }
         }
     }



From ral at mail.berlios.de  Sat Sep 20 00:47:51 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 20 Sep 2008 00:47:51 +0200
Subject: [Enigma-game-svn] r1335 - in trunk: data/levels/lib src/stones
Message-ID: <200809192247.m8JMlpVt001851@sheep.berlios.de>

Author: ral
Date: 2008-09-20 00:47:43 +0200 (Sat, 20 Sep 2008)
New Revision: 1335

Modified:
   trunk/data/levels/lib/libpuzzle_3.xml
   trunk/src/stones/PuzzleStone.cc
   trunk/src/stones/PuzzleStone.hh
Log:
Trunk 1.1: new API reengineering
- puzzle part 5:
  - fix: yellow puzzles are laser rotatable, blue ones not
  - crash fix: fall puzzles on floor change, not directly on move
  - let puzzle fall on first fitting position
  - fix: break infinite shuffling if no stone can be pushed
  - add uppercase suffixes and "upper" numbers as hollow auto puzzle tiles


Modified: trunk/data/levels/lib/libpuzzle_3.xml
===================================================================
--- trunk/data/levels/lib/libpuzzle_3.xml	2008-09-17 22:09:04 UTC (rev 1334)
+++ trunk/data/levels/lib/libpuzzle_3.xml	2008-09-19 22:47:43 UTC (rev 1335)
@@ -99,8 +99,9 @@
             
             if not nextpuzz["hollow"] then
                 puzz:pull_rotate(dir)
-                intensity = intensity - 1
             end
+            -- decrement in any case - there may exist no way scramble
+            intensity = intensity - 1
         end
     end
     -- cleanup for subsequent calls
@@ -119,8 +120,20 @@
             end
         else
             if tile[1]:find("st_puzzle", 1, true) then
-                local clusteridx = ("01234456789"):find(suffix)
-                local connections = (" abcdefghijklmno"):find(suffix)
+                local clusteridx = ("01234456789"):find(suffix, 1, true)
+                local connections = (" abcdefghijklmno"):find(suffix, 1 , true)
+                if  clusteridx == nil then
+                    clusteridx = (")!@#$%^&*("):find(suffix, 1, true)
+                    if clusteridx ~= nil then
+                        tile["hollow"] = true
+                    end
+                end
+                if  connections == nil then
+                    connections = ("+ABCDEFGHIJKLMNO"):find(suffix, 1, true)
+                    if connections ~= nil then
+                        tile["hollow"] = true
+                    end
+                end
                 if  clusteridx ~= nil then
                     tile["cluster"] = clusteridx - 1
                 elseif connections ~= nil then

Modified: trunk/src/stones/PuzzleStone.cc
===================================================================
--- trunk/src/stones/PuzzleStone.cc	2008-09-17 22:09:04 UTC (rev 1334)
+++ trunk/src/stones/PuzzleStone.cc	2008-09-19 22:47:43 UTC (rev 1335)
@@ -134,7 +134,7 @@
     void PuzzleStone::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
         if (state == IDLE && !(objFlags & OBJBIT_HOLLOW)) {
             DirectionBits addDirs = added_dirs(oldDirs, newDirs);
-            if (addDirs != NODIRBIT && !explodeCluster() && getAttr("color") == BLUE) {
+            if (addDirs != NODIRBIT && !explodeCluster() && getAttr("color") == YELLOW) {
                 GridPos p = get_pos();
                 if (addDirs & SOUTHBIT) rotateLine(SOUTH);
                 if (p == get_pos() && (addDirs & WESTBIT))  rotateLine(WEST);
@@ -251,6 +251,14 @@
             ShatterActorsInsideField (get_pos());
     }
 
+    void PuzzleStone::on_floor_change() {
+        if (state == FALLING) {
+            state = FALLEN;   // we need to mark the puzzle as the floor set recalls this methods
+            SetFloor(get_pos(), MakeFloor("fl-gray"));
+            KillStone(get_pos());
+        }
+    }
+    
     void PuzzleStone::alarm() {
         explodeStone();
     }
@@ -410,24 +418,22 @@
         sound_event("movebig");
         int size = cluster.size();
 
-        if (createBridge) {
-            for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
-                SetFloor(move((*itr)->get_pos(), dir), MakeFloor("fl-gray"));
-                KillStone((*itr)->get_pos());
-            }
+        for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
+           (*itr)->sourcePos = (*itr)->get_pos();
+           YieldStone((*itr)->sourcePos);
         }
-        else {
-            for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
-               (*itr)->sourcePos = (*itr)->get_pos();
-               YieldStone((*itr)->sourcePos);
-            }
 
+        for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
+            SetStone(move((*itr)->sourcePos, dir), *itr);
+            (*itr)->on_move();
+        }
+        server::IncMoveCounter(size);
+
+        if (createBridge) {
             for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
-                SetStone(move((*itr)->sourcePos, dir), *itr);
-                (*itr)->on_move();
+                (*itr)->state = FALLING;
             }
         }
-        server::IncMoveCounter(size);
         return true;
     }
 

Modified: trunk/src/stones/PuzzleStone.hh
===================================================================
--- trunk/src/stones/PuzzleStone.hh	2008-09-17 22:09:04 UTC (rev 1334)
+++ trunk/src/stones/PuzzleStone.hh	2008-09-19 22:47:43 UTC (rev 1335)
@@ -62,7 +62,9 @@
     private:
         enum iState {
             IDLE,       ///<
-            PENDING,    ///<  a cluster gets locked on a pending explosion to avoid further actions
+            FALLING,    ///< a cluster falling into water or abyss
+            FALLEN,     ///< a stone that is fallen an is vanishing
+            PENDING,    ///< a cluster gets locked on a pending explosion to avoid further actions
             IGNITED,    ///< 
             EXPLODING   ///< 
         };
@@ -100,16 +102,17 @@
         virtual void animcb();
 
         // Stone interface
-        virtual bool isConnectable(Stone *other) const;
-        virtual void on_impulse(const Impulse& impulse);
-        virtual void on_move();
+        virtual bool is_transparent(Direction d) const;
         virtual bool is_sticky(const Actor *a) const;
-        virtual bool is_transparent(Direction d) const;
         virtual bool allowsSpreading(Direction dir) const;
         virtual bool is_removable() const;        
+        virtual bool isConnectable(Stone *other) const;
         virtual StoneResponse collision_response(const StoneContact &sc);
         virtual void actor_hit(const StoneContact &sc);
         virtual void actor_contact(Actor *a);
+        virtual void on_impulse(const Impulse& impulse);
+        virtual void on_move();
+        virtual void on_floor_change();
         
         // TimeHandler interface
         virtual void alarm();



From ral at mail.berlios.de  Sat Sep 20 11:25:31 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sat, 20 Sep 2008 11:25:31 +0200
Subject: [Enigma-game-svn] r1336 - team_levelpacks/team_test_new_api
Message-ID: <200809200925.m8K9PVwv024218@sheep.berlios.de>

Author: ral
Date: 2008-09-20 11:25:21 +0200 (Sat, 20 Sep 2008)
New Revision: 1336

Modified:
   team_levelpacks/team_test_new_api/ralT027_1.xml
   team_levelpacks/team_test_new_api/ralT063_1.xml
   team_levelpacks/team_test_new_api/ralT069_1.xml
Log:
Test Level new API:
- puzzle lib test levels updated and extended


Modified: team_levelpacks/team_test_new_api/ralT027_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT027_1.xml	2008-09-19 22:47:43 UTC (rev 1335)
+++ team_levelpacks/team_test_new_api/ralT027_1.xml	2008-09-20 09:25:21 UTC (rev 1336)
@@ -36,7 +36,8 @@
 
 ti["S"] = {"st_switch", target="blocker"}
 ti["s"] = {"it_blocker", "blocker"}
-ti["H"] = {"st-wood"}
+ti["H"] = {"st-wood", "wood1"}
+ti["t"] = {"it_trigger", target="blocker"} .. ti({"st-wood", "wood2"})
 
 
 
@@ -50,7 +51,7 @@
 "                    ",
 "                    ",
 "        Ss         E",
-"         H          ",
+"         Ht         ",
 "           1        ",
 "                    ",
 "                    ",
@@ -58,8 +59,8 @@
 "     A       a     E"
 })
 
+wo:add({"ot_wire", anchor1 = "wood1", anchor2 = "wood2"})
 
-
   ]]></el:luamain>
     <el:i18n>
 	 <el:string el:key="title">

Modified: team_levelpacks/team_test_new_api/ralT063_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT063_1.xml	2008-09-19 22:47:43 UTC (rev 1335)
+++ team_levelpacks/team_test_new_api/ralT063_1.xml	2008-09-20 09:25:21 UTC (rev 1336)
@@ -25,14 +25,16 @@
 
 ti["1"] = {"st_puzzle_blue", cluster=1, hollow=false}
 ti["2"] = {"st_puzzle_blue", cluster=2}
+ti["3"] = {"st_puzzle_blue", cluster=3} .. ti["~"]
 ti["|"] = {"st_puzzle_blue", connections="ns"}
 ti["+"] = {"st_puzzle_blue", connections="nesw", hollow=true}
 --ti["+"] = {"st_puzzle_blue", connections="nesw", hollow=false}
 
+ti["7"] = {"st_puzzle_yellow", cluster=1} .. ti["~"]
 ti["8"] = {"st_puzzle_yellow", cluster=1}
 ti["9"] = {"st_puzzle_yellow", cluster=2}
 ti["-"] = {"st_puzzle_yellow", connections="ew"}
-ti["o"] = {"st_puzzle_blue", color=YELLOW, hollow=true}
+ti["o"] = {"st_puzzle_blue", color=YELLOW, connections="nesw", hollow=true}
 
 ti["A"] = {"st_puzzle", connections="w"}
 ti["B"] = {"st_puzzle", connections="s"}
@@ -50,9 +52,16 @@
 ti["W"] = {"st-wood", "wood1"}
 ti["V"] = {"st-wood", "wood2"}
 
+ti["n"] = {"st_puzzle_blue", "puz3", connections="n"}
+ti["m"] = {"st_puzzle_blue", "puz4", connections="s"}
+ti["v"] = {"st-wood", "wood3"}
+
+
 ti["l"] = {"st_laser_w", state = ON}
 ti["L"] = {"st_laser_n", state = ON}
+ti["e"] = {"st_laser_e", state = ON}
 ti["="] = {"st_polarswitch"}
+ti[":"] = {"st_polarswitch", state=ON}
 ti["."] = {"st-stoneimpulse_movable"}
 ti["*"] = {"it-cherry"}
 
@@ -60,35 +69,49 @@
 
 w, h = wo(ti, " ", {
 "                                       ",
+"                               ~~~33   ",
 "                               ~~~~~   ",
-"                               ~~~~~   ",
 "  111       888        111     ~~~~~   ",
 "  2|2      18-9         21             ",
 "  222       999   8     222    _____   ",
 "                               _____   ",
 "   +         o          |      _____   ",
-"1         @     988-    |              ",
+"1               988-    |              ",
 "   1111      -         8       _____   ",
 "                      888      _____   ",
 "                      898      ~~~~~   ",
-"                      888              ",
-"   1B    =l   B+B =l                   ",
-"   1     =l                    Ds   =l  ",
+"                      888        ~77   ",
+"   1B    =l   B+B =l               .   ",
+"   1     =l                    Ds   =l ",
 "    H                           A   =l ",
 "     8b  =l   bob =l                   ",
 "     8   =l                     =      ",
-"      h                         L      ",
+"      h                 @       L      ",
+"                             8         ",
+"     D+A.      doa.         88         ",
+"      *         *    e:  8o8888  =l    ",
+"                            8          ",
+"   +'    W   do!  V         =:         ",
+"             ~~~~           LL         ",
+"             ~~~~                      ",
+"       v                               ",
+"  ~~                                   ",
+"  ~~  m                                ",
+"  ~~  n                                ",
+"  ~~                                   ",
+"   ~                                   ",
+"   ~                                   ",
 "                                       ",
-"     D+A.      doa.                    ",
-"      *         *                      ",
 "                                       ",
-"    +'    W   do!  V                   ",
+"                                       ",
 "                                       "
 })
 
 
 wo:add({"ot_wire", anchor1="puz1", anchor2="wood1"})
 wo:add({"ot_wire", anchor1="puz2", anchor2="wood2"})
+wo:add({"ot_wire", anchor1="puz3", anchor2="wood3"})
+wo:add({"ot_wire", anchor1="puz4", anchor2="wood3"})
 
   ]]></el:luamain>
     <el:i18n>

Modified: team_levelpacks/team_test_new_api/ralT069_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT069_1.xml	2008-09-19 22:47:43 UTC (rev 1335)
+++ team_levelpacks/team_test_new_api/ralT069_1.xml	2008-09-20 09:25:21 UTC (rev 1336)
@@ -25,7 +25,7 @@
 ti["##"] = {"st-rock1"}
 ti["S#"] = {"st_switch", target="newpuz"}
 
-ti["P"] = {"st_puzzle_blue"}
+ti["P"] = {"st_puzzle_blue", intensity= 2/12}
 ti["H"] = {"st_puzzle_blue", hollow=true}
 ti["S"] = {"st_puzzle_yellow", intensity=2/6}
 ti["M"] = {"st_puzzle_blue", algorithm="marked"}
@@ -55,12 +55,13 @@
 "    P3H3P3P3P3        P3P3P3P3P3    ",
 "    P3P3P3P3P3        P3P3HoP3P3    ",
 "    P3P3P3P3P3                      ",
+"                        P#P#P#P#    ",
+"S#                      P#PAP#P#    ",
 "                                    ",
-"S#                                  ",
+"                        P$P$P$P$    ",
+"                        P$P4P$P$    ",
+"                        P$P$P$P$    ",
 "                                    ",
-"                                    ",
-"                                    ",
-"                                    ",
 "                                    "
 })
 



From raoul at mail.berlios.de  Mon Sep 22 00:51:31 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Mon, 22 Sep 2008 00:51:31 +0200
Subject: [Enigma-game-svn] r1337 - in trunk/data/levels: enigma_cross
	enigma_v enigma_vii enigma_viii
Message-ID: <200809212251.m8LMpVXW015017@sheep.berlios.de>

Author: raoul
Date: 2008-09-22 00:51:29 +0200 (Mon, 22 Sep 2008)
New Revision: 1337

Added:
   trunk/data/levels/enigma_v/raoul12_2.xml
   trunk/data/levels/enigma_viii/dev08_1.xml
   trunk/data/levels/enigma_viii/mecke08_1.xml
   trunk/data/levels/enigma_viii/ral30_1.xml
   trunk/data/levels/enigma_viii/raoul31_1.xml
Removed:
   trunk/data/levels/enigma_v/raoul12_1.xml
Modified:
   trunk/data/levels/enigma_cross/newlevels.xml
   trunk/data/levels/enigma_cross/newlevels_1.0.1.xml
   trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
   trunk/data/levels/enigma_v/index.xml
   trunk/data/levels/enigma_vii/andreas45_2.xml
   trunk/data/levels/enigma_vii/index.xml
   trunk/data/levels/enigma_viii/index.xml
   trunk/data/levels/enigma_viii/mecke05_1.xml
   trunk/data/levels/enigma_viii/ral28_1.xml
   trunk/data/levels/enigma_viii/ral34_1.xml
Log:
-> Level object renamings and a few new levels.
--> New: ral30, raoul31, dev08, mecke08
--> Object-name updates: ral28, ral34, mecke05, andreas45
--> Rewrites in new api: raoul12

Many bugfixes and some other new levels will
follow in a few days



Modified: trunk/data/levels/enigma_cross/newlevels.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_cross/newlevels.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Facets" location="15400" network="false" owner="Enigma Team" release="1" revision="10" title="Enigma 1.00 new"/>
+  <info enigma="1.00" group="Facets" location="15400" network="false" owner="Enigma Team" release="1" revision="11" title="Enigma 1.00 new"/>
 
   <attributes/>
 
@@ -107,7 +107,7 @@
     <level _seq="99" _title="Thievish Alleys" _xpath="enigma_v/andreas33_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas33" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="100" _title="Double play" _xpath="enigma_v/just06_1" author="JuSt" ctrl="force" easy="false" id="just06" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="101" _title="Oxyd-Puzzle" _xpath="enigma_v/raoul05_1" author="Raoul Bourquin" ctrl="force" easy="false" id="raoul05" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="102" _title="Keystone" _xpath="enigma_v/raoul12_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul12" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="102" _title="Keystone" _xpath="enigma_v/raoul12_2" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul12" rel="2" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="103" _title="Print 23" _xpath="enigma_v/richi07_1" author="Richi B?tzer" ctrl="force" easy="false" id="richi07" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="104" _title="Laser Crossing" _xpath="enigma_v/luc24_1" author="Lukas Sch?ller" ctrl="force" easy="true" id="luc24" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="105" _title="The Carousel" _xpath="enigma_v/luc30_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc30" rel="1" rev="2" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels_1.0.1.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.0.1.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_cross/newlevels_1.0.1.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Facets" location="15500" network="false" owner="Enigma Team" release="1" revision="13" title="Enigma 1.01 new"/>
+  <info enigma="1.00" group="Facets" location="15500" network="false" owner="Enigma Team" release="1" revision="14" title="Enigma 1.01 new"/>
 
   <attributes/>
 
@@ -56,7 +56,7 @@
     <level _seq="48" _title="Polar Bears' Paradise" _xpath="enigma_vi/ral19_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070314ral394" rel="1" rev="68" score="1" target="time" unit="duration"/>
     <level _seq="49" _title="Open Path" _xpath="enigma_vii/duffy152_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy152" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="50" _title="Temple of Ganesha" _xpath="enigma_vii/duffy154_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy154" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="51" _title="Temple of Gold" _xpath="enigma_vii/duffy151_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy151" rel="3" rev="6" score="3" target="time" unit="duration"/>
+    <level _seq="51" _title="Temple of Gold" _xpath="enigma_vii/duffy151_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy151" rel="3" rev="7" score="3" target="time" unit="duration"/>
     <level _seq="52" _title="Advancing" _xpath="enigma_vii/joe01_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="53" _title="Free Riders" _xpath="enigma_vii/duffy155_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy155" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="54" _title="Meditation in Peace" _xpath="enigma_vii/ral20_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070502ral466" rel="1" rev="70" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="13" title="Enigma 1.1 new"/>
+  <info enigma="1.00" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="14" title="Enigma 1.1 new"/>
 
   <attributes/>
 
@@ -70,7 +70,7 @@
     <level _seq="62" _title="Crawling the Abyss" _xpath="enigma_vii/sph02_1" author="ShadowPhrogg32642342" ctrl="force" easy="true" id="sph02" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="63" _title="Bold Boulder" _xpath="enigma_vii/ral14_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20061124ral279" rel="1" rev="96" score="1" target="time" unit="duration"/>
     <level _seq="64" _title="Tinker, Tailor" _xpath="enigma_vii/andreas46_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas46" rel="4" rev="5" score="2" target="time" unit="duration"/>
-    <level _seq="65" _title="Elbow Society" _xpath="enigma_vii/andreas45_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas45" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="65" _title="Elbow Society" _xpath="enigma_vii/andreas45_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas45" rel="2" rev="6" score="2" target="time" unit="duration"/>
     <level _seq="66" _title="Watchmaker" _xpath="enigma_vii/huesing01_1" author="Johannes H?sing" ctrl="force" easy="false" id="huesing01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="67" _title="Map it out II" _xpath="enigma_vii/manuel01_1" author="Manuel Eisentraut" ctrl="force" easy="true" id="manuel01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="68" _title="Underground Temple" _xpath="enigma_vii/joe12_2" author="Joseph Dunne" ctrl="force" easy="true" id="joe_12" rel="2" rev="0" score="2" target="time" unit="duration"/>
@@ -106,14 +106,18 @@
     <level _seq="98" _title="Wired Five" _xpath="enigma_viii/ral25_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080721ral073" rel="1" rev="112" score="1" target="time" unit="duration"/>
     <level _seq="99" _title="Wireban Premiere" _xpath="enigma_viii/ral26_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080715ral161" rel="1" rev="112" score="1" target="time" unit="duration"/>
     <level _seq="100" _title="Microwire" _xpath="enigma_viii/ral27_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral427" rel="1" rev="107" score="1" target="time" unit="duration"/>
-    <level _seq="101" _title="More Microwire" _xpath="enigma_viii/ral28_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral282" rel="1" rev="105" score="1" target="time" unit="duration"/>
+    <level _seq="101" _title="More Microwire" _xpath="enigma_viii/ral28_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral282" rel="1" rev="114" score="1" target="time" unit="duration"/>
     <level _seq="102" _title="Freestyle Microwire" _xpath="enigma_viii/ral29_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080719ral530" rel="1" rev="107" score="1" target="time" unit="duration"/>
     <level _seq="103" _title="Balance Beam" _xpath="enigma_viii/mecke03_1" author="mecke" ctrl="force" easy="true" id="mecke03" rel="1" rev="29" score="1" target="time" unit="duration"/>
     <level _seq="104" _title="Colored Oxyds" _xpath="enigma_viii/andreas50_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas50" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="105" _title="Fashions Pass" _xpath="enigma_viii/andreas48_2" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas48" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="106" _title="Colored Turnstiles" _xpath="enigma_viii/andreas51_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas51" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="107" _title="Sanssouci" _xpath="enigma_viii/mecke05_1" author="mecke" ctrl="force" easy="true" id="mecke05" rel="1" rev="23" score="1" target="time" unit="duration"/>
-    <level _seq="108" _title="Wired Shogun" _xpath="enigma_viii/ral34_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080828ral417" rel="1" rev="112" score="1" target="time" unit="duration"/>
+    <level _seq="107" _title="Sanssouci" _xpath="enigma_viii/mecke05_1" author="mecke" ctrl="force" easy="true" id="mecke05" rel="1" rev="24" score="1" target="time" unit="duration"/>
+    <level _seq="108" _title="Wired Shogun" _xpath="enigma_viii/ral34_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080828ral417" rel="1" rev="114" score="1" target="time" unit="duration"/>
+    <level _seq="109" _title="Scarlett's Necklet" _xpath="enigma_viii/ral30_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080814ral422" rel="1" rev="115" score="1" target="time" unit="duration"/>
+    <level _seq="110" _title="- Meditation -" _xpath="enigma_viii/raoul31_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul31" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="111" _title="Relaxing at the sea" _xpath="enigma_viii/dev08_1" author="/dev/null" ctrl="force" easy="true" id="dev08" rel="1" rev="9" score="1" target="time" unit="duration"/>
+    <level _seq="112" _title="Helios II" _xpath="enigma_viii/mecke08_1" author="mecke" ctrl="force" easy="true" id="mecke08" rel="1" rev="15" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Modified: trunk/data/levels/enigma_v/index.xml
===================================================================
--- trunk/data/levels/enigma_v/index.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_v/index.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10600" network="false" owner="Enigma Team" release="1" revision="7" title="Enigma V"/>
+  <info enigma="1.00" group="Enigma" location="10600" network="false" owner="Enigma Team" release="1" revision="8" title="Enigma V"/>
 
   <attributes/>
 
@@ -27,7 +27,7 @@
     <level _seq="19" _title="Oxyd-Puzzle" _xpath="./raoul05_1" author="Raoul Bourquin" ctrl="force" easy="false" id="raoul05" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="20" _title="- Meditation -" _xpath="./ralf12_1" author="Ralf Westram" ctrl="force" easy="true" id="ralf12" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="21" _title="Plan Ahead" _xpath="./duffy114_2" author="Jacob Scott" ctrl="force" easy="true" id="duffy114" rel="2" rev="3" score="2" target="time" unit="duration"/>
-    <level _seq="22" _title="Keystone" _xpath="./raoul12_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul12" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="22" _title="Keystone" _xpath="./raoul12_2" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul12" rel="2" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="23" _title="Print 23" _xpath="./richi07_1" author="Richi B?tzer" ctrl="force" easy="false" id="richi07" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="24" _title="Space Pirates" _xpath="./siegfried19_2" author="Siegfried Fennig" ctrl="force" easy="false" id="level6a" rel="2" rev="0" score="2" target="time" unit="duration"/>
     <level _seq="25" _title="Laser Crossing" _xpath="./luc24_1" author="Lukas Sch?ller" ctrl="force" easy="true" id="luc24" rel="1" rev="0" score="1" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_v/raoul12_1.xml
===================================================================
--- trunk/data/levels/enigma_v/raoul12_1.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_v/raoul12_1.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -1,230 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Keystone" el:subtitle="" el:id="raoul12"/>
-      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
-      <el:author  el:name="Raoul Bourquin" el:email="raoul at users.berlios.de" el:homepage=""/>
-      <el:copyright>Copyright ? 2006 Raoul Bourquin</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-       <el:dependency el:path="lib/libpuzzle" el:id="lib/libpuzzle" el:release="2" el:preload="true"/>
-      </el:compatibility>
-      <el:modes el:easy="true" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="1:10"/>
-    </el:info>
-    <el:luamain><![CDATA[
--- Another Level with Puzzles...
--- GENERAL --
-levelw = 20
-levelh = 37
-create_world(levelw, levelh)
-enigma.ConserveLevel = TRUE
-
--- DESIGN --
-boden="fl-black"
-wand="st-glass"
-
--- FLOOR --
-fill_floor("fl-abyss_fake", 0,0,levelw,levelh)
-fill_floor(boden, 3,0,15,13)
-fill_floor(boden, 5,26,11,9)
-
--- STONES --
-draw_border(wand,3,0,15,13)
-draw_border(wand,5,26,11,9)
-
--- second room --
-if not difficult then
-set_stone("st-switch_white", 8, 29, {action="callback",target="per1",name="rot1"})
-set_stone("st-switch_white", 8, 31, {action="callback",target="per2",name="rot2"})
-set_stone("st-switch_white", 9, 30, {action="callback",target="per3",name="rot3"})
-set_stone("st-switch_white", 10, 30, {action="callback",target="per4",name="rot4"})
-set_stone("st-switch_white", 11, 30, {action="callback",target="per5",name="rot5"})
-set_stone("st-switch_white", 12, 29,{action="callback",target="per6",name="rot6"})
-set_stone("st-switch_white", 12, 31, {action="callback",target="per7",name="rot7"})
-else
-set_stone("st-switch_white", 8, 29, {action="callback",target="per7",name="rot1"})
-set_stone("st-switch_white", 8, 31, {action="callback",target="per6",name="rot2"})
-set_stone("st-switch_white", 9, 30, {action="callback",target="per5",name="rot3"})
-set_stone("st-switch_white", 10, 30, {action="callback",target="per4",name="rot4"})
-set_stone("st-switch_white", 11, 30, {action="callback",target="per3",name="rot5"})
-set_stone("st-switch_white", 12, 29,{action="callback",target="per2",name="rot6"})
-set_stone("st-switch_white", 12, 31, {action="callback",target="per1",name="rot7"})
-end
-
--- ACTORS --
-set_actor("ac-blackball", 15.5,10.5, {player=0})
-set_actor("ac-whiteball", 7.5,28.5, {player=1})
-set_item("it-yinyang", 15,10)
-set_item("it-yinyang", 7,28)
-
--- OXYD --
-oxyd(3,6)
-oxyd(10,0)
-oxyd(10,12)
-oxyd(17,6)
-oxyd_default_flavor = "d"
-oxyd_shuffle()
-
--- Oranges Puzzleteil:
-puzzle({"## ##",
-        " ### ",
-        "## ##"},{8,5},"redpuzzle","permutation")
-
--- shift_helper_functions --
-waswo = {"","","","","","","","","","",""}
-nr = 1
-
-function local_translate_type(type)
-    local local_translate_table = {"","w","s","sw","e","ew","es","esw","n","nw","ns","nsw","ne","new","nes","nesw"}
-    return local_translate_table[type]
-end
-
-local i, j = 0, 0
-for i=1, 3 do
-    for j=1, 5 do
-        local this_stone = enigma.GetStone(8+j-1,5+i-1)
-        if this_stone ~= nil then
-            local temp = local_translate_type(enigma.GetAttrib(this_stone,"connections"))
-            waswo[nr] = "st-puzzle2-"..tostring(temp)
-            nr = nr+1
-        end
-    end
-end
-
--- Blaue Puzzleteile:
-puzzle({"#  # ",
-        "#####",
-        "# #  "},{4,5},"bluepuzzle","none")
-
-puzzle({" #  #",
-        "#####",
-        " #  #"},{12,5},"bluepuzzle","none")
-
-puzzle({"###",
-        " # ",
-        "###",
-        " # ",
-        " # "},{9,1},"bluepuzzle","none")
-
-puzzle({" # ",
-        " ##",
-        "## ",
-        " # ",
-        "###"},{9,7},"bluepuzzle","none")
-
----------------
-function per1()
- localram={"",""}
- localram[1]=waswo[1]
- localram[2]=waswo[2]
- tmp=localram[2]
- localram[2]=localram[1]
- localram[1]=tmp
- waswo[1]=localram[1]
- waswo[2]=localram[2]
- set_stone(localram[1],8,5)
- set_stone(localram[2],9,5)
-end
----------------
-function per2()
- localram={"",""}
- localram[1]=waswo[8]
- localram[2]=waswo[9]
- tmp=localram[2]
- localram[2]=localram[1]
- localram[1]=tmp 
- waswo[8]=localram[1]
- waswo[9]=localram[2]
- set_stone(localram[1],8,7)
- set_stone(localram[2],9,7)
-end
----------------
-function per3()
- localram={"","",""}
- localram[1]=waswo[2]
- localram[2]=waswo[5]
- localram[3]=waswo[9]
- tmp=localram[3]
- localram[3]=localram[2]
- localram[2]=localram[1]
- localram[1]=tmp
- waswo[2]=localram[1]
- waswo[5]=localram[2]
- waswo[9]=localram[3]
- set_stone(localram[1],9,5)
- set_stone(localram[2],9,6)
- set_stone(localram[3],9,7)
-end
----------------
-function per4()
- localram={"","",""}
- localram[1]=waswo[5]
- localram[2]=waswo[6]
- localram[3]=waswo[7]
- tmp=localram[3]
- localram[3]=localram[2]
- localram[2]=localram[1]
- localram[1]=tmp
- waswo[5]=localram[1]
- waswo[6]=localram[2]
- waswo[7]=localram[3]
- set_stone(localram[1],9,6)
- set_stone(localram[2],10,6)
- set_stone(localram[3],11,6)
-end
----------------
-function per5()
- localram={"","",""}
- localram[1]=waswo[3]
- localram[2]=waswo[7]
- localram[3]=waswo[10]
- tmp=localram[3]
- localram[3]=localram[2]
- localram[2]=localram[1]
- localram[1]=tmp
- waswo[3]=localram[1]
- waswo[7]=localram[2]
- waswo[10]=localram[3]
- set_stone(localram[1],11,5)
- set_stone(localram[2],11,6)
- set_stone(localram[3],11,7)
-end
----------------
-function per6()
- localram={"",""}
- localram[1]=waswo[3]
- localram[2]=waswo[4]
- tmp=localram[2]
- localram[2]=localram[1]
- localram[1]=tmp
- waswo[3]=localram[1]
- waswo[4]=localram[2]
- set_stone(localram[1],11,5)
- set_stone(localram[2],12,5)
-end
----------------
-function per7()
- localram={"",""}
- localram[1]=waswo[10]
- localram[2]=waswo[11]
- tmp=localram[2]
- localram[2]=localram[1]
- localram[1]=tmp
- waswo[10]=localram[1]
- waswo[11]=localram[2]
- set_stone(localram[1],11,7)
- set_stone(localram[2],12,7)
-end
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_v/raoul12_2.xml (from rev 1336, trunk/data/levels/enigma_v/raoul12_1.xml)
===================================================================
--- trunk/data/levels/enigma_v/raoul12_1.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_v/raoul12_2.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -0,0 +1,101 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Keystone" el:subtitle="" el:id="raoul12"/>
+      <el:version el:score="1" el:release="2" el:revision="4" el:status="released"/>
+      <el:author  el:name="Raoul Bourquin" el:email="raoul at users.berlios.de" el:homepage=""/>
+      <el:copyright>Copyright ? 2006,2008 Raoul Bourquin</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libpuzzle" el:id="lib/libpuzzle" el:release="3" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="1:10"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-black"}
+ti["."] = {"fl-abyss"}
+ti["#"] = {"st-glass"}
+ti["O"] = {"st_oxyd"}
+ti["P"] = {"st_puzzle_blue", cluster=1}
+ti["1"] = {"st_switch_white", target="permute", _tag=1}
+ti["2"] = {"st_switch_white", target="permute", _tag=2}
+ti["3"] = {"st_switch_white", target="permute", _tag=3}
+ti["4"] = {"st_switch_white", target="permute", _tag=4}
+ti["5"] = {"st_switch_white", target="permute", _tag=5}
+ti["6"] = {"st_switch_white", target="permute", _tag=6}
+ti["7"] = {"st_switch_white", target="permute", _tag=7}
+ti["?"] = {"st_puzzle_yellow", intensity = 4/5, cluster=1}
+ti["@"] = {"#ac-blackball"} .. ti({"it-yinyang"})
+ti["B"] = {"#ac-whiteball"} .. ti({"it-yinyang"})
+
+puzz = res.puzzle(ti,"?")
+
+w, h = wo(puzz, " ", {
+"#######O#######",
+"#     PPP     #",
+"#      P      #",
+"#     PPP     #",
+"#      P      #",
+"#P  P??P??P  P#",
+"OPPPPP???PPPPPO",
+"#P P ??P??P  P#",
+"#      PP     #",
+"#     PP      #",
+"#      P    @ #",
+"#     PPP     #",
+"#######O#######",
+
+"...............",
+"...............",
+"...............",
+"...............",
+"...............",
+"...............",
+"...............",
+"...............",
+"...............",
+"...............",
+"...............",
+
+"...............",
+"...............",
+"..###########..",
+"..#         #..",
+"..# B       #..",
+"..#  1   3  #..",
+"..#   567   #..",
+"..#  2   4  #..",
+"..#         #..",
+"..#         #..",
+"..###########..",
+"...............",
+"..............."
+})
+
+wo:shuffleOxyd()
+
+if wo["IsDifficult"] then
+    pos = {{9,7}, {9,5}, {5,7}, {5,5}, {8,7}, {8,6}, {6,5}}
+    dir = {WEST, WEST, EAST, EAST, NORTH, WEST, SOUTH}
+else
+    pos = {{5,5}, {5,7}, {9,5}, {9,7}, {6,5}, {6,6}, {8,7}}
+    dir = {EAST, EAST, WEST, WEST, SOUTH, EAST, NORTH}
+end
+
+function permute(value, sender)
+    wo:st(pos[sender["_tag"]]):message("push_rotate", dir[sender["_tag"]])
+end
+    ]]></el:luamain>
+    <el:i18n>
+     <el:string el:key="title">
+       <el:english el:translate="false"/>
+     </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_v/raoul12_2.xml
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Modified: trunk/data/levels/enigma_vii/andreas45_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/andreas45_2.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_vii/andreas45_2.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Elbow Society" el:subtitle="" el:id="andreas45"/>
-      <el:version el:score="2" el:release="2" el:revision="5" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="6" el:status="released"/>
       <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Andreas Lochmann</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -23,7 +23,7 @@
 mainfloor = "fl-black"
 mainstone = "st-death"
 friction = 3.0
-mousefactor = 1.0
+adhesion = 1.0
 
 function set_deathly(x, y)
   set_item("it-death", x, y)
@@ -56,7 +56,7 @@
     set_deathly(x + 9, y)
   end
 end
-  
+
 function render_cell( maze, cellx, celly )
   x, y = cell_to_level( cellx, celly )
   if not maze:can_go_south(cellx,celly) then
@@ -86,20 +86,20 @@
     elseif c == "#" then
       set_stone(mainstone, j-1, line)
     elseif c == "." then
-      --set_deathly(j-1, line)       
+      --set_deathly(j-1, line)
     elseif c == "+" then
       close_tile(j-1, line)
     elseif c == "*" then
-      set_deathly(j-1, line)       
+      set_deathly(j-1, line)
     elseif c == "t" then
       set_item("it-trigger", j-1, line,
                {action = "callback", target = "call_trigger"})
     elseif c == "b" then
       set_floor("fl-bridge-closed", j-1, line,
-                {friction = friction, mousefactor = mousefactor})
+                {friction = friction, adhesion = adhesion})
     elseif c == "B" then
       set_floor("fl-bridge-closed", j-1, line,
-                {friction = friction, mousefactor = mousefactor})
+                {friction = friction, adhesion = adhesion})
       set_deathly(j-1, line)
     end
   end
@@ -117,7 +117,7 @@
 
 for x = 0, levelw - 1 do
   for y = 0, levelh - 1 do
-    set_floor(mainfloor, x, y, {friction = friction, mousefactor = mousefactor})
+    set_floor(mainfloor, x, y, {friction = friction, adhesion = adhesion})
   end
 end
 

Modified: trunk/data/levels/enigma_vii/index.xml
===================================================================
--- trunk/data/levels/enigma_vii/index.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_vii/index.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10800" network="false" owner="Enigma Team" release="1" revision="17" title="Enigma VII"/>
+  <info enigma="1.00" group="Enigma" location="10800" network="false" owner="Enigma Team" release="1" revision="18" title="Enigma VII"/>
 
   <attributes/>
 
@@ -29,7 +29,7 @@
     <level _seq="21" _title="Cold Meditation" _xpath="./ral18_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070314ral728" rel="1" rev="67" score="1" target="time" unit="duration"/>
     <level _seq="22" _title="Mountain Climbing" _xpath="./joe10_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe10" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="23" _title="Advancing" _xpath="./joe01_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe01" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="24" _title="Temple of Gold" _xpath="./duffy151_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy151" rel="3" rev="6" score="3" target="time" unit="duration"/>
+    <level _seq="24" _title="Temple of Gold" _xpath="./duffy151_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy151" rel="3" rev="7" score="3" target="time" unit="duration"/>
     <level _seq="25" _title="Inkblot 1" _xpath="./npb01_1" author="Nathan Bronecke" ctrl="force" easy="true" id="20070519npb015045" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="26" _title="mad-ill-tation" _xpath="./illmind14_1" author="illmind" ctrl="force" easy="false" id="ill0907-01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="27" _title="- Meditation -" _xpath="./joe04_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe4" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -94,7 +94,7 @@
     <level _seq="86" _title="Crawling the Abyss" _xpath="./sph02_1" author="ShadowPhrogg32642342" ctrl="force" easy="true" id="sph02" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="87" _title="Bold Boulder" _xpath="./ral14_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20061124ral279" rel="1" rev="96" score="1" target="time" unit="duration"/>
     <level _seq="88" _title="Tinker, Tailor" _xpath="./andreas46_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas46" rel="4" rev="5" score="2" target="time" unit="duration"/>
-    <level _seq="89" _title="Elbow Society" _xpath="./andreas45_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas45" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="89" _title="Elbow Society" _xpath="./andreas45_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas45" rel="2" rev="6" score="2" target="time" unit="duration"/>
     <level _seq="90" _title="Watchmaker" _xpath="./huesing01_1" author="Johannes H?sing" ctrl="force" easy="false" id="huesing01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="91" _title="Map it out II" _xpath="./manuel01_1" author="Manuel Eisentraut" ctrl="force" easy="true" id="manuel01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="92" _title="Underground Temple" _xpath="./joe12_2" author="Joseph Dunne" ctrl="force" easy="true" id="joe_12" rel="2" rev="0" score="2" target="time" unit="duration"/>

Added: trunk/data/levels/enigma_viii/dev08_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/dev08_1.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_viii/dev08_1.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -0,0 +1,101 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Relaxing at the sea" el:subtitle="" el:id="dev08"/>
+      <el:version el:score="1" el:release="1" el:revision="9" el:status="released"/>
+      <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 dev0</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+        <el:credits el:showinfo="true" el:showstart="true">Thanks to Meditation Master Daydreamer for faith-healing the level which terribly suffered from cuts.</el:credits>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+-- settings
+wo["FollowMethod"] = FOLLOW_SCROLL
+
+-- variables
+sFactor = 5.0
+
+-- tiles
+ti["  "] = {"fl-water"}
+ti[" c"] = {"fl-concrete"}
+ti[" h"] = {"fl-hay"}
+ti[" l"] = {"fl-leaves"}
+ti[" r"] = {"fl-rock"}
+ti[" s"] = {"fl-sand"}
+ti[" v"] = {"fl-gravel", friction = sFactor}
+ti[" V"] = {"fl-gravel", friction = sFactor * 2.5}
+ti[". "] = {"st-disco-light"}
+ti[": "] = {"st-disco-medium"}
+ti["p "] = {"st-flrock"}
+ti["R "] = {"st-rock2"}
+ti["w "] = {"st-wood"}
+ti["% "] = {"it-document", text = "Did you ask the devil to give you more power? ;-)"}
+
+-- meditation_hollow
+ti["5 "] = {"it_meditation_hollow", essential = 0}
+ti["6 "] = {"it_meditation_hollow", essential = 1}
+ti["7 "] = {"it_meditation_hollow", essential = 1}
+ti["8 "] = {"it_meditation_hollow", essential = 1} .. ti["p "]
+ti["9 "] = {"it_meditation_hollow", essential = 1}
+
+if wo["IsDifficult"] then
+  ti["P "] = ti["p "]
+  ti["W "] = ti[" r"]
+else
+  ti["P "] = ti[" r"]
+  ti["W "] = ti["p "]
+end
+
+-- the ball(s)
+ti["1 "] = {"#ac-whiteball-small", player = 0, essential=1}
+ti["2 "] = {"#ac-whiteball-small", player = 0, essential=1}
+ti["3 "] = {"#ac-whiteball-small", player = 0, essential=1} .. ti["p "]
+ti["4 "] = {"#ac-whiteball-small", player = 0, essential=1} .. ti["p "]
+
+-- map
+local resolver = res.composer(ti)
+
+width, height = wo(resolver, "  ", 
+-- 0                  10                  20
+-- 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+{ "            . . . . : : : : : : : . . . . : ", --  0
+  "                  . . . : . . . . . R . : : ", --  1
+  "   l l l l            . . .        vRv. . . ", --  2 
+  "   l1lwlwl   l l l l           r rRrRv v. . ", --  3 
+  "   lwl l5l     lwlwl s        wh r  RvR . . ", --  4 
+  "                   l lws          R       . ", --  5 
+  "                   l l s         h h r r  . ", --  6 
+  "     r        .                hwhwlwl l    ", --  7 
+  "    pr  R       . . . . .      h l l l l    ", --  8 
+  "     rpr r r r  . R : .                     ", --  9 
+  "     r r rpr r  . : R R .     wh h          ", -- 10 
+  "        R         . R 6V v       rR         ", -- 11
+  "     r  R  r      . . R        r rR  r r    ", -- 12
+  "     r  R pr        .                r c    ", -- 13
+  ".     R R  r  pr r.      r    . .   prwc c  ", -- 14
+  ".         pr rpr rR     Pr rpr  pr    wc    ", -- 15
+  ". .  r  R  r rPr rR      r. . pr    wc      ", -- 16
+  ". . WrR R R         R    r. .  r            ", -- 17
+  ". .    v7vR      r  R      rpr r     cwc h  ", -- 18
+  ".  r rR  vR R .  r rR R   R   .     wcwc h  ", -- 19
+  ". prpr2v8VR R R Pr r4r r  R           wh h  ", -- 20
+  ".    rR   R   3r rpr rR 9VR . .       wh    ", -- 21
+  ". . . . R %vR R  r r rR R : . . .           ", -- 22
+  ". . . . : : : . .     . . : : : . .         ", -- 23
+  ". . : : : : : : . . . . : : : : : . . .     "  -- 24
+}) 
+
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_viii/dev08_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/data/levels/enigma_viii/index.xml
===================================================================
--- trunk/data/levels/enigma_viii/index.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_viii/index.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10900" network="false" owner="Enigma Team" release="1" revision="8" title="Enigma VIII"/>
+  <info enigma="1.00" group="Enigma" location="10900" network="false" owner="Enigma Team" release="1" revision="9" title="Enigma VIII"/>
 
   <attributes/>
 
@@ -31,14 +31,18 @@
     <level _seq="23" _title="Wired Five" _xpath="./ral25_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080721ral073" rel="1" rev="112" score="1" target="time" unit="duration"/>
     <level _seq="24" _title="Wireban Premiere" _xpath="./ral26_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080715ral161" rel="1" rev="112" score="1" target="time" unit="duration"/>
     <level _seq="25" _title="Microwire" _xpath="./ral27_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral427" rel="1" rev="107" score="1" target="time" unit="duration"/>
-    <level _seq="26" _title="More Microwire" _xpath="./ral28_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral282" rel="1" rev="105" score="1" target="time" unit="duration"/>
+    <level _seq="26" _title="More Microwire" _xpath="./ral28_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080717ral282" rel="1" rev="114" score="1" target="time" unit="duration"/>
     <level _seq="27" _title="Freestyle Microwire" _xpath="./ral29_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080719ral530" rel="1" rev="107" score="1" target="time" unit="duration"/>
     <level _seq="28" _title="Balance Beam" _xpath="./mecke03_1" author="mecke" ctrl="force" easy="true" id="mecke03" rel="1" rev="29" score="1" target="time" unit="duration"/>
     <level _seq="29" _title="Colored Oxyds" _xpath="./andreas50_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas50" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="30" _title="Fashions Pass" _xpath="./andreas48_2" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas48" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="31" _title="Colored Turnstiles" _xpath="./andreas51_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas51" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="32" _title="Sanssouci" _xpath="./mecke05_1" author="mecke" ctrl="force" easy="true" id="mecke05" rel="1" rev="23" score="1" target="time" unit="duration"/>
-    <level _seq="33" _title="Wired Shogun" _xpath="./ral34_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080828ral417" rel="1" rev="112" score="1" target="time" unit="duration"/>
+    <level _seq="32" _title="Sanssouci" _xpath="./mecke05_1" author="mecke" ctrl="force" easy="true" id="mecke05" rel="1" rev="24" score="1" target="time" unit="duration"/>
+    <level _seq="33" _title="Wired Shogun" _xpath="./ral34_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080828ral417" rel="1" rev="114" score="1" target="time" unit="duration"/>
+    <level _seq="34" _title="Scarlett's Necklet" _xpath="./ral30_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080814ral422" rel="1" rev="115" score="1" target="time" unit="duration"/>
+    <level _seq="35" _title="- Meditation -" _xpath="./raoul31_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul31" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="36" _title="Relaxing at the sea" _xpath="./dev08_1" author="/dev/null" ctrl="force" easy="true" id="dev08" rel="1" rev="9" score="1" target="time" unit="duration"/>
+    <level _seq="37" _title="Helios II" _xpath="./mecke08_1" author="mecke" ctrl="force" easy="true" id="mecke08" rel="1" rev="15" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Modified: trunk/data/levels/enigma_viii/mecke05_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke05_1.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_viii/mecke05_1.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -3,43 +3,42 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Sanssouci" el:subtitle="A Baroque Game" el:id="mecke05"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision:23$" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision:24$" el:status="released"/>
       <el:author  el:name="mecke" el:email=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
       <el:compatibility el:enigma="1.10"/>
-      <el:modes el:easy="true" el:single="true" el:network="false" el:control="force"
-        el:scoreunit="duration" el:scoretarget="time"/>
-	<el:comments>
-    <el:credits el:showinfo="true" el:showstart="false">Thanks to Ronald Lamprecht and Raoul Bourquin for some important patterns</el:credits> 
-    </el:comments>
-       <el:score el:easy="12:20" el:difficult="13:56"/>
+      <el:modes el:easy="true" el:single="true" el:network="false" el:control="force" el:scoreunit="duration" el:scoretarget="time"/>
+      <el:comments>
+        <el:credits el:showinfo="true" el:showstart="false">Thanks to Ronald Lamprecht and Raoul Bourquin for some important patterns</el:credits>
+      </el:comments>
+      <el:score el:easy="12:20" el:difficult="13:56"/>
     </el:info>
     <el:luamain><![CDATA[
 wo["ConserveLevel"] = true
 
 if wo ["IsDifficult"] then
     ti["  "] = {"fl-gravel",burnable=true}
-	ti["H "] = {"fl-gravel",burnable=true,"hotspot"}
-	ti["n1"] = {"fl-gravel","knight1"}
-	ti["n2"] = {"fl-gravel","knight2"}
-	ti["n3"] = {"fl-gravel","break2"}
-	ti["m5"] = {"fl-gravel","swordm"}
-	ti["n5"] = {"fl-gravel","swordn"}
-	ti["o5"] = {"fl-gravel","swordo"}
-	ti["s5"] = {"fl-gravel","swords"}
-	ti["y "] = {"fl-swamp"}
-  else
+    ti["H "] = {"fl-gravel",burnable=true,"hotspot"}
+    ti["n1"] = {"fl-gravel","knight1"}
+    ti["n2"] = {"fl-gravel","knight2"}
+    ti["n3"] = {"fl-gravel","break2"}
+    ti["m5"] = {"fl-gravel","swordm"}
+    ti["n5"] = {"fl-gravel","swordn"}
+    ti["o5"] = {"fl-gravel","swordo"}
+    ti["s5"] = {"fl-gravel","swords"}
+    ti["y "] = {"fl-swamp"}
+else
     ti["  "] = {"fl-rough",burnable=true}
-	ti["H "] = {"fl-rough",burnable=true,securefire=true,"hotspot"}
-	ti["n1"] = {"fl-rough","knight1"}
-	ti["n2"] = {"fl-rough","knight2"}
-	ti["n3"] = {"fl-rough","break2"}
-	ti["m5"] = {"fl-rough","swordm"}
-	ti["n5"] = {"fl-rough","swordn"}
-	ti["o5"] = {"fl-rough","swordo"}
-	ti["s5"] = {"fl-rough","swords"}
-	ti["y "] = {"fl-swamp",{friction=0.6}}
+    ti["H "] = {"fl-rough",burnable=true,securefire=true,"hotspot"}
+    ti["n1"] = {"fl-rough","knight1"}
+    ti["n2"] = {"fl-rough","knight2"}
+    ti["n3"] = {"fl-rough","break2"}
+    ti["m5"] = {"fl-rough","swordm"}
+    ti["n5"] = {"fl-rough","swordn"}
+    ti["o5"] = {"fl-rough","swordo"}
+    ti["s5"] = {"fl-rough","swords"}
+    ti["y "] = {"fl-swamp",{friction=0.6}}
 end
 
 ti["9 "] = {"fl-bluegreenx"}
@@ -174,21 +173,21 @@
 ti["I9"] = ti["S9"] .. {"st_window_e",secure=true}
 ti["I1"] = ti["S2"] .. {"st_window_w",secure=true}
 ti["I3"] = ti["S2"] .. {"st_window_e",secure=true}
-ti["NE"] = ti["E2"] .. {"st-puzzle2-ne"}
-ti["NW"] = ti["E1"] .. {"st-puzzle2-nw"}
-ti["SE"] = ti["S2"] .. {"st-puzzle2-es"}
-ti["SW"] = ti["S2"] .. {"st-puzzle2-sw"}
-ti["GE"] = ti["~ "] .. {"st-puzzle2-e"}
-ti["GW"] = ti["~ "] .. {"st-puzzle2-w"}
-ti["QE"] = ti["~ "] .. {"st-puzzle2-ne"}
-ti["QW"] = ti["~ "] .. {"st-puzzle2-nw"}
-ti["OE"] = ti["~ "] .. {"st-puzzle2-es"}
-ti["OW"] = ti["~ "] .. {"st-puzzle2-sw"}
+ti["NE"] = ti["E2"] .. {"st_puzzle_yellow_ne"}
+ti["NW"] = ti["E1"] .. {"st_puzzle_yellow_nw"}
+ti["SE"] = ti["S2"] .. {"st_puzzle_yellow_es"}
+ti["SW"] = ti["S2"] .. {"st_puzzle_yellow_sw"}
+ti["GE"] = ti["~ "] .. {"st_puzzle_yellow_e"}
+ti["GW"] = ti["~ "] .. {"st_puzzle_yellow_w"}
+ti["QE"] = ti["~ "] .. {"st_puzzle_yellow_ne"}
+ti["QW"] = ti["~ "] .. {"st_puzzle_yellow_nw"}
+ti["OE"] = ti["~ "] .. {"st_puzzle_yellow_es"}
+ti["OW"] = ti["~ "] .. {"st_puzzle_yellow_sw"}
 ti["TT"] = ti["y "] .. {"it_strip_new"}
 ti["EE"] = ti["  "] .. {"it-cherry"}
 ti["Ee"] = ti["? "] .. {"it-cherry"}
 ti["/="] = {"st_window_s"}
-ti["!!"] = ti({"st_window_new", secure=true}) .. {"it_extralife"} 
+ti["!!"] = ti({"st_window_new", secure=true}) .. {"it_extralife"}
 
 local resolver = res.composer(ti)
 
@@ -247,7 +246,6 @@
 function fire ()
     no["hotspot"]:setfire()
     wo[no["Tollkirsche#*"]] = {"it_death"}
-	
 end
 
 function knight ()
@@ -256,14 +254,14 @@
 
 function jux ()
     wo[no["swords"]] = {"it_sword",}
-	wo[no["sword4"]] = {"st-puzzle2-es"}
-	wo[no["sword2"]] = {"st-puzzle2-sw"}
-	wo[no["swordo"]] = {"st-puzzle2-w"}
-	wo[no["swordm"]] = {"st-puzzle2-e"}
-	wo[no["swordn"]] = {"st-puzzle2-ew"}
-	wo[no["sword1"]] = {"st-puzzle2-new"}
-	wo[no["swords"]] = {"st-puzzle2-new"}
-	wo[no["sword3"]] = {"st-puzzle2-ew"}
+    wo[no["sword4"]] = {"st-puzzle2-es"}
+    wo[no["sword2"]] = {"st-puzzle2-sw"}
+    wo[no["swordo"]] = {"st-puzzle2-w"}
+    wo[no["swordm"]] = {"st-puzzle2-e"}
+    wo[no["swordn"]] = {"st-puzzle2-ew"}
+    wo[no["sword1"]] = {"st-puzzle2-new"}
+    wo[no["swords"]] = {"st-puzzle2-new"}
+    wo[no["sword3"]] = {"st-puzzle2-ew"}
 end
 
 j = 0
@@ -271,37 +269,33 @@
     j = j+1
     if (j <= 1) then
       wo[no["repanel1"]] = {"st_panel"}
-	  wo[no["repanel2"]] = {"st_panel"}
-	  wo[no["knight2"]] =  {"st_knight"}
-	end  
-end    
+      wo[no["repanel2"]] = {"st_panel"}
+      wo[no["knight2"]] =  {"st_knight"}
+    end
+end
 
 
 function topblock1 ()
-    wo[{14,12}] = {"st-black4"}  
-  
+    wo[{14,12}] = {"st-black4"}
 end
 
 function topblock2 ()
-    wo[{5,12}] = {"st-black4"}  
-  
+    wo[{5,12}] = {"st-black4"}
 end
 
 function topblock3 ()
-    wo[{5,11}] = {"st-black4"}  
-  
+    wo[{5,11}] = {"st-black4"}
 end
 
 function topblock4 ()
-    wo[{14,11}] = {"st-black4"}  
-  
+    wo[{14,11}] = {"st-black4"}
 end
 
 wo:add({"ot_wire", anchor1="boulderCircle", anchor2="dd1"})
 wo:add({"ot_wire", anchor1="boulderCircle", anchor2="dd2"})
 wo:add({"ot_wire", anchor1="woody1", anchor2="woody2"})
 
-wo:shuffleOxyd()  
+wo:shuffleOxyd()
   ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Added: trunk/data/levels/enigma_viii/mecke08_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke08_1.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_viii/mecke08_1.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -0,0 +1,143 @@
+<?xml version="1.0" encoding="utf-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+  xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd"
+  xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Helios II" el:subtitle="Use the Lightpassenger" el:id="mecke08"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 15 $" el:status="released"/>
+      <el:author  el:name="mecke" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false" el:control="force" el:scoreunit="duration" el:scoretarget="time"/>
+      <el:comments>
+        <el:credits el:showinfo="true" el:showstart="false">Thanks to Ronald Lamprecht for the difficult mode</el:credits>
+      </el:comments>
+      <el:score el:easy="14:51" el:difficult="19:53"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+wo["ExtralifeGlasses"] = wo["ExtralifeGlasses"] + SPOT_ACTORIMPULSE
+
+ti[" t"] = {"fl-thief"}
+ti["  "] = {"fl-rough"}
+ti[" q"] = {"fl-bluegreenx"}
+ti[" i"] = ti[" q"] ..{"it-crack3", brittleness=0}
+ti["# "] = ti[" i"] ..{"st_actorimpulse_invisible"}
+ti[" l"] = ti["  "] ..{"it_meditation_bump"}
+ti[" m"] = {"fl-sahara"}
+ti[" c"] = {"it_brush"}
+ti["X "] = ti[" m"] ..{"st-grate1"}
+ti[" _"] = {"fl-swamp"}
+
+ti[" ,"] = {"fl-red"}
+ti[" ~"] = {"fl-water"}
+ti[" ."] = {"fl-bluegreenx", friction=0.8}
+ti[" n"] = {"fl-light"}
+
+ti["E "] = {"st_lightpassenger_off"}
+ti["O "] = {"st_rotator_ccw", movable=false}
+ti["Q "] = {"st_rotator_ccw", movable=true}
+ti["T "] = {"st-thief"}
+ti["Y "] = {"st-glass_move"}
+ti["B "] = {"it_trigger",target="laser1"}
+ti["C "] = {"it_trigger",target="laser2"}
+ti["F "] = {"it_trigger",target="laser3"}
+ti["K "] = {"st_laser_n", name="laser1", state=OFF}
+ti["U "] = {"st_laser_n", name="laser2", state=OFF}
+ti["W "] = {"st_laser_n", name="laser3", state=OFF}
+ti["1 "] = {"st-black4"}
+ti["D "] = {"st_death"}
+ti["L "] = ti[" _"] .. {"st_laser_s", name="laser", state=ON}
+ti["h "] = {"st-bluegray_hole"}
+ti["A "] = ti[" ~"] .. {"st_actorimpulse"}
+ti["> "] = ti[" ~"] .. {"st_boulder_e"}
+ti["< "] = {"st_boulder_w"}
+ti[" f"] = {"it_wrench"}
+ti[" y"] = {"it_floppy"}
+ti["x1"] = ti[" ~"] .. {"st_oxyd", flavor="a",name="olli1"}
+ti["x2"] = ti[" ~"] .. {"st_oxyd", flavor="a",name="olli2"}
+ti["x3"] = ti[" ~"] .. {"st_oxyd", flavor="a",name="olli3"}
+ti["x4"] = ti[" ~"] .. {"st_oxyd", flavor="a",name="olli4"}
+ti["x5"] = ti[" ~"] .. {"st_oxyd", flavor="a",name="olli5"}
+ti["x6"] = ti[" ~"] .. {"st_oxyd", flavor="a",name="olli6"}
+ti["e "] = {"it_extralife"}
+ti["o "] = {"it-springboard"}
+ti[" j"] = {"it_magicwand"}
+ti["S "] = ti[" n"] ..{"st-white4"}
+ti["G "] = {"st-yellow"}
+ti["2 "] = {"st-brake"}
+ti["P "] = {"st_pull"}
+
+ti["J "] = {"#ac-top", range=1, force=1}
+ti["= "] = {"#ac-horse"}
+
+ti["Z "] = {"st_floppy", action="open",target="vortex1"}
+ti["V1"] = ti[" _"] ..{"it_vortex_closed", name="vortex1", destination="vortex2"}
+
+if wo["IsDifficult"] then
+  ti[" '"] = ti[" ."] .. {"it-crack2", brittleness=0}
+  ti["1f"] = ti["1 "] .. {"it_magicwand"}
+  ti["* "] = ti["  "] .. {"#ac-blackball"}
+  ti["Dx"] = ti[" ."] .. {"st_door", "doora#", flavor="a"}
+  ti["Ax"] = ti[" ."] .. {"st_door", "doorb#", flavor="a"}
+  ti["$1"] = {"it_trigger", target={"@doora#*", "@doorb#*"}}
+  ti["$2"] = {"it_trigger", target={"@doora#*", "@doorb#*"}}
+  ti["$3"] = {"it_trigger", target={"@doora#*", "@doorb#*"}}
+  ti["$4"] = {"it_trigger", target={"@doora#*", "@doorb#*"}}
+  ti["$5"] = {"it_trigger", target={"@doora#*", "@doorb#*"}}
+  ti["$6"] = {"it_trigger", target={"@doora#*", "@doorb#*"}}
+  ti["3 "] = {"fl-swamp"}
+  ti["M."] = ti[" _"]
+  ti["V2"] = ti["  "] ..{"it_vortex_open", name="vortex2", destination="vortex3"}
+  ti["Ay"] = ti["Ax"] ..{"it_vortex_open", name="vortex3", destination="vortex1"}
+else
+  ti[" '"] = {"fl-swamp"}
+  ti["1f"] = ti["1 "] .. {"it_wrench"}
+  ti["* "] = ti[" t"] .. {"#ac-blackball"}
+  ti["Dx"] = ti["D "]
+  ti["Ax"] = ti["A "]
+  ti["$1"] = {"it_trigger", target="olli1"}
+  ti["$2"] = {"it_trigger", target="olli2"}
+  ti["$3"] = {"it_trigger", target="olli3"}
+  ti["$4"] = {"it_trigger", target="olli4"}
+  ti["$5"] = {"it_trigger", target="olli5"}
+  ti["$6"] = {"it_trigger", target="olli6"}
+  ti["3 "] = ti[" j"] ..{"fl-swamp"}
+  ti["M."] = ti[" _"] .. {"it_glasses"}
+  ti["V2"] = ti["  "] ..{"it_vortex_open", name="vortex2", destination="vortex1"}
+end
+
+local resolver = res.composer(ti)
+
+w, h = wo(resolver, "  ", {
+-- 0001020304050607080910111213141516171819
+  "# # # # # # # # # # # # # # $4# $5# $6# ",
+  "# D D D D D D D A # # #  ~h  'h  'h  ~# ",
+  "# D x1D x2D x3D A # G #  . l .Ql . l .# ",
+  "# D DxD DxD DxD A # 1j  e,   .e  .< E.# ",
+  "# A AxA AxA AxA A # Pc iX X X SfX X X # ",
+  "# h  .h  .h  .h X # P # X    .  M.   .# ",
+  "Z     J   J   J X  t*  tX J   J   J   V1",
+  "#   L.  3    .  X # P # X h  .h  .h W.# ",
+  "# X X X X SyX X X  iPc# A A AxA AxA Ay# ",
+  "# e E.   .Q  .  e O 1f# A D DxD DxD Dx# ",
+  "#  l . l . l . l ~> G # A D x4D x5D x6# ",
+  "# h  ~h  'h  'h  ~# F # A D D D D D D # ",
+  "# # $1# $2# $3# # # V2# # # # # # # # # "
+})
+
+wo:shuffleOxyd()
+    ]]></el:luamain>
+      <el:i18n>
+        <el:string el:key="title">
+          <el:english el:translate="false"/>
+        </el:string>
+        <el:string el:key="subtitle">
+          <el:english el:translate="true"/>
+          <el:translation el:lang="de">Nutze den Lightpass...</el:translation>
+        </el:string>
+     </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_viii/mecke08_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/data/levels/enigma_viii/ral28_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral28_1.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_viii/ral28_1.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="More Microwire" el:subtitle="" el:id="20080717ral282"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 105 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 114 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -19,22 +19,18 @@
 ti["."] = {"fl-samba", friction=7, mousefactor=1.8}
 ti["*"] = ti[" "] ..{"st-beads"}
 ti["#"] = {"fl-samba"}
-ti["1"] = {"it_trigger", target="bridgeA", action="openclose"} 
-          .. ti({"st-brownie", "brownie1"})
-ti["2"] = {"it_trigger", target="bridgeB", action="openclose"} 
-          .. ti({"st-brownie", "brownie2"})
-ti["3"] = {"it_trigger", target="bridgeC", action="openclose"} 
-          .. ti({"st-brownie", "brownie3"})
-ti["4"] = {"it_trigger", target="bridgeD", action="openclose"} 
-          .. ti({"#ac-blackball"})
-ti["5"] = {"it_trigger", target="bridgeE", action="openclose"} 
-ti["6"] = {"it_trigger", target="bridgeF", action="openclose"} 
-ti["a"] = {"fl-bridge-closed", "bridgeA", type="x"}
-ti["b"] = {"fl-bridge-closed", "bridgeB", type="x"}
-ti["c"] = {"fl-bridge-closed", "bridgeC", type="x"}
-ti["d"] = {"fl-bridge-closed", "bridgeD", type="x"}
-ti["e"] = {"fl-bridge", "bridgeE", type="x"}
-ti["f"] = {"fl-bridge", "bridgeF", type="x"}
+ti["1"] = {"it_trigger", target="bridgeA"} .. ti{"st-brownie", "brownie1"}
+ti["2"] = {"it_trigger", target="bridgeB"} .. ti{"st-brownie", "brownie2"}
+ti["3"] = {"it_trigger", target="bridgeC"} .. ti{"st-brownie", "brownie3"}
+ti["4"] = {"it_trigger", target="bridgeD"} .. ti{"#ac-blackball"}
+ti["5"] = {"it_trigger", target="bridgeE"} 
+ti["6"] = {"it_trigger", target="bridgeF"} 
+ti["a"] = {"fl_bridge_bw", "bridgeA", state=CLOSED}
+ti["b"] = {"fl_bridge_bw", "bridgeB", state=CLOSED}
+ti["c"] = {"fl_bridge_bw", "bridgeC", state=CLOSED}
+ti["d"] = {"fl_bridge_bw", "bridgeD", state=CLOSED}
+ti["e"] = {"fl_bridge_bw", "bridgeE"}
+ti["f"] = {"fl_bridge_bw", "bridgeF"}
 ti["W"] = {"st_oxyd_d", "west#"}
 ti["E"] = {"st_oxyd_d", "east#"}
 
@@ -57,6 +53,7 @@
 wo:add({"ot_wire", anchor1="brownie1", anchor2="brownie2"})
 wo:add({"ot_wire", anchor1="brownie2", anchor2="brownie3"})
 wo:shuffleOxyd({no["west#*"], max=0})
+
     ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Added: trunk/data/levels/enigma_viii/ral30_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral30_1.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_viii/ral30_1.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -0,0 +1,127 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Scarlett's Necklet" el:subtitle="Who did broke the pearl necklet?" el:id="20080814ral422"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 115 $" el:status="released"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/liblua" el:id="lib/liblua" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+        <el:credits el:showinfo="true" el:showstart="false">Pearl theme inspired by Jacob Scott, Scarlett story by Andreas Lochmann</el:credits>
+      </el:comments>
+      <el:score el:easy="5:54" el:difficult="10:47"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-black"}
+ti["="] = {"fl_bridge_bw", "bridge#"}
+ti["x"] = {"it_shogun_s", "x%%"}
+
+ti["A"] = {"st-block", "pearl#"}
+ti["B"] = {"st-brownie", "pearl#"}
+ti["C"] = {"st-marble_move", "pearl#"}
+ti["D"] = {"st-rock1_move", "pearl#"}
+ti["E"] = {"st-glass1_move", "pearl#"}
+ti["F"] = {"st-camouflage_move", "pearl#"}
+ti["G"] = {"st-wood", "pearl#"}
+ti["H"] = {"st-glass_move", "pearl#"}
+ti["I"] = {"st-rock3_move", "pearl#"}
+ti["J"] = {"st-flhay", "pearl#"}
+
+ti["_"] = {"st_window_s", secure=true}
+ti["|"] = {"st_window_e", secure=true}
+ti["."] = {"st_window_w", secure=true}
+ti["-"] = {"st_window_n", secure=true}
+ti["}"] = {"st_window_ne", secure=true}
+ti["{"] = {"st_window_nw", secure=true}
+ti[")"] = {"st_window_es", secure=true}
+ti["("] = {"st_window_sw", secure=true}
+
+ti["d"] = {"it-document", text="story"}
+
+if wo["IsDifficult"] then
+    ti["S"] = {"st_coinslot", target="check"}
+    ti["s"] = {"st-yellow"}
+    ti["c"] = {"it_coin_s"}
+else
+    ti["S"] = {"st_switch", target="check"}
+    ti["s"] = {"st-rock1"}
+    ti["c"] = ti[" "]
+end
+
+ti["X"] = {"st_oxyd_d", "oxyd"}
+
+ti["@"] = {"ac-blackball", 0, 0.5}
+
+pearl_keys = lib.lua.shuffle({"A","B","C","D","E","F","G","H","I","J"})
+function myres(key, x, y)
+   local idx = ("ABCDEFGHIJ"):find(key, 1, true)
+   if idx ~= nil then
+       return ti[pearl_keys[idx]]
+   else
+       return ti[key]
+   end
+end
+
+w, h = wo(res.autotile(myres,{"0","9","x"}), " ", {
+"{--------sS--------}",
+".     cccccccc     |",
+".0                9|",
+".                  |",
+".      G JH I      |",
+". 1   A B  C D   8 |",
+".       E  F       |",
+".  2      @     7  |",
+".        cd        |",
+".    3        6    |",
+".       4  5       |",
+"(________  ________)",
+"X=== =  =  =  = ===X"
+})
+
+pearls = no["pearl#*"]:shuffle()
+
+function check(value, sender)
+    if value or sender:is("st_switch") then
+        no["bridge#*"]:open()
+        no["oxyd"]:closeall()
+        for i = 1, #pearls + 1 do
+            j = ((i-1) % #pearls) + 1   -- we need to check first place two times
+            pearl = st(no["x%"..j])
+            pearl_right = st(no["x%"..((j % #pearls) + 1)])
+            if -pearl and -pearl_right then
+                wirename = "wire"..pearls[pearl].."_"..pearls[pearl_right]
+                if pearl_right == pearls[(pearls[pearl] % #pearls) + 1] and not -no[wirename] then
+                    wo:add({"ot_wire", wirename, anchor1=pearl, anchor2=pearl_right})
+                    pearl["_wires"] = lib.lua.cond(pearl["_wires"] == 1, 2, 1)
+                    pearl_right["_wires"] = lib.lua.cond(pearl_right["_wires"] == 1, 2, 1)
+                end
+                wires = pearl["wires"]
+                if pearl["_wires"] == 2 then
+                    fl(pearl.x, h-1):close()
+                end
+            end
+        end
+    end
+end
+
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+      <el:string el:key="subtitle">
+        <el:english el:translate="true"/>
+      </el:string>
+      <el:string el:key="story">
+        <el:english el:translate="true" >Mrs Scarlett's wonderful pearl necklet tore, and now all the colorful pearls roll on the floor. Mrs Scarlett doesn't remember the sequence, but she knows, adjacent pearls connect, when being on dots while triggered by the switch.</el:english>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_viii/ral30_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/data/levels/enigma_viii/ral34_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/ral34_1.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_viii/ral34_1.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -3,7 +3,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Wired Shogun" el:subtitle="" el:id="20080828ral417"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 112 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 114 $" el:status="released"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -24,26 +24,26 @@
 ti["7"] = {"st_shogun_s", "s1"}
 ti["8"] = {"st_shogun_s", "s2"}
 
-ti["a"] = {"it_shogun_l", target="ba#*", action="openclose"}
+ti["a"] = {"it_shogun_l", target="ba#*"}
 
-ti["A"] = {"fl-bridge", "ba#", type="a"}
-ti["B"] = {"fl-bridge", "bb#", type="a"}
-ti["C"] = {"fl-bridge", "bc#", type="a"}
+ti["A"] = {"fl_bridge_gc", "ba#"}
+ti["B"] = {"fl_bridge_gc", "bb#"}
+ti["C"] = {"fl_bridge_gc", "bc#"}
 
 if wo["IsDifficult"] then
   ti["3"] = {"st_shogun_l", "l3"}
   ti["6"] = {"st_shogun_m", "m3"}
   ti["9"] = {"st_shogun_s", "s3"}
-  ti["b"] = {"it_shogun_l", target="bb#*", action="openclose"}
-  ti["c"] = {"it_shogun_l", target="bc#*", action="openclose"}
+  ti["b"] = {"it_shogun_l", target="bb#*"}
+  ti["c"] = {"it_shogun_l", target="bc#*"}
   ti["D"] = ti["."]
 else
   ti["3"] = ti[" "]
-  ti["6"] = {"it_shogun_l", target="bd#*", action="openclose"}
+  ti["6"] = {"it_shogun_l", target="bd#*"}
   ti["9"] = ti[" "]
   ti["b"] = ti[" "]
   ti["c"] = ti[" "]
-  ti["D"] = {"fl-bridge", "bd#", type="a"}
+  ti["D"] = {"fl_bridge_gc", "bd#"}
 end
 
 ti["X"] = {"st_oxyd_d"} .. ti["."]

Added: trunk/data/levels/enigma_viii/raoul31_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/raoul31_1.xml	2008-09-20 09:25:21 UTC (rev 1336)
+++ trunk/data/levels/enigma_viii/raoul31_1.xml	2008-09-21 22:51:29 UTC (rev 1337)
@@ -0,0 +1,58 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="- Meditation -" el:subtitle="" el:id="raoul31"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
+      <el:author  el:name="Raoul Bourquin" el:email="raoul at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Raoul Bourquin</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+if wo["IsDifficult"] then
+    wo["MeditationStrength"] = 4.0
+else
+    wo["MeditationStrength"] = 2.0
+end
+
+ti[" "] = {"fl-light"}
+ti["-"] = {"fl-black"}
+ti["."] = {"fl-abyss"}
+ti["#"] = {"st_panel", cluster = 1}
+ti["="] = {"st_panel", cluster = 2}
+ti["u"] = {"it_meditation_hill"}
+ti["o"] = {"it_meditation_hollow"}
+ti["0"] = ti["u"] .. {"#ac-whiteball-small", name="a", player=0} 
+ti["O"] = ti["o"] .. {"#ac-whiteball-small", "s#"} 
+ti["q"] = {"it_rubberband", anchor2="@@s#*", length=5, strength=10, max=5}
+
+w, h = wo(ti, " ", {
+"....##=======##....",
+"...## -     - ##...",
+"..## -O-- --O- ##..",
+".##   - --- -   ##.",
+".#  q    -    q  #.",
+".=  -   ---   -  =.",
+".=q-O----0----O-q=.",
+".=  -   ---   -  =.",
+".#  q    -    q  #.",
+".##   - --- -   ##.",
+"..## -O-- --O- ##..",
+"...## -     - ##...",
+"....##=======##...."
+})
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_viii/raoul31_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native



From andreasl at mail.berlios.de  Mon Sep 22 23:21:55 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Mon, 22 Sep 2008 23:21:55 +0200
Subject: [Enigma-game-svn] r1338 - in trunk: data/levels/lib data/schemas
	doc/reference src/floors
Message-ID: <200809222121.m8MLLtDU007626@sheep.berlios.de>

Author: andreasl
Date: 2008-09-22 23:21:50 +0200 (Mon, 22 Sep 2008)
New Revision: 1338

Modified:
   trunk/data/levels/lib/ralf.xml
   trunk/data/levels/lib/ralf_sokoban.xml
   trunk/data/schemas/objects.xml
   trunk/doc/reference/enigma-ref.texi
   trunk/src/floors/BridgeFloor.cc
   trunk/src/floors/BridgeFloor.hh
Log:
Trunk:
 - ralf_sokoban.xml, ralf.xml:
    - Fix bug #10295 ("st-swap in Sokoban") by deactivating
      level solvability check in swap-style sokobans.
    - Remove multiple create_worlds from ralf_sokoban
      (this needed some code-relocations), and block
      further unintentional multiple calls from ralf.xml.
    - Deactivated annoying "boxface="-logs.
 - Add fire-related messages and attributes to objects.xml
 - Brown and open fl_bridge now is burnable.
    - incl. refman-entry to section "The 1.0-Fire System".
Note:
 - Recheck spelling of "expl", "setfire", "stopfire", "forcefire",
   "initfire", "fastfire": Maybe they should be called "explode",
   "set_fire", "stop_fire", "force_fire", "init_fire", "fast_fire".
 - fl_bridge is only burnable when it is closed, this overrides all
   items and attributes on it. Changing the flavor of fl_bridge
   will change the burnable-attribute as well, according to the new
   flavor.


Modified: trunk/data/levels/lib/ralf.xml
===================================================================
--- trunk/data/levels/lib/ralf.xml	2008-09-21 22:51:29 UTC (rev 1337)
+++ trunk/data/levels/lib/ralf.xml	2008-09-22 21:21:50 UTC (rev 1338)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/ralf"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="Ralf Westram" el:email="amgine at reallysoft.de" el:homepage=""/>
       <el:copyright>Copyright ? Feb 2003 Ralf Westram</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -19,6 +19,11 @@
     <el:luamain><![CDATA[
 -- Thanks to ant
 
+-- Sep 08: Ensure that create_world is called only once.
+--         Use global variables to store world size.  -- Andreas
+
+ralf_world_created = false
+
 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
 -- draw maps of maps (metamaps)
 -- * each cell in a metamap refers to a normal map (here: basemap)
@@ -146,7 +151,13 @@
    --print("xlo="..xlo.." ylo="..ylo)
 
    local oxyd_flavor = oxyd_default_flavor
-   create_world(rworldw, rworldh)
+
+   if not ralf_world_created then
+     create_world(rworldw, rworldh)
+     ralf_world_created = true
+   else
+     error("Not allowed to recreate the world.")
+   end
    oxyd_default_flavor = oxyd_flavor
 end
 

Modified: trunk/data/levels/lib/ralf_sokoban.xml
===================================================================
--- trunk/data/levels/lib/ralf_sokoban.xml	2008-09-21 22:51:29 UTC (rev 1337)
+++ trunk/data/levels/lib/ralf_sokoban.xml	2008-09-22 21:21:50 UTC (rev 1338)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/ralf_sokoban"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
       <el:author  el:name="Ralf Westram" el:email="amgine at reallysoft.de" el:homepage=""/>
       <el:copyright>Copyright ? Mar 2003 Ralf Westram</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -19,7 +19,15 @@
     <el:luamain><![CDATA[
 
 -- Jun 06: Changed "init(num)" such that reverse_scrolling is used
---         in difficult mode instead of easy mode  -- Andreas
+--         in difficult mode instead of easy mode.  -- Andreas
+-- Sep 08: * Deactivated annoying "boxface=..."-log
+--         * Multiple create_world are not allowed, so I separated
+--           the oxyd position calculation from the real oxyd setting
+--           (i.e. splitted "install_oxyds" into two functions and
+--           adapted the corresponding loop in "play_sokoban").
+--         * Deactivated solvability check for swapStyle-puzzles:
+--           It never worked before and with the new swap-stones
+--           it's completely broken.  -- Andreas
 
 --debug_mode()
 show_restricted = 0 -- set to 1 to use different floors for restricted areas (for debugging)
@@ -325,10 +333,10 @@
    if (test==1) then
       set_stone("st-brake",x,y,{name=boxname});
    elseif (boxface=="st-glass1" or boxface=="sokoban_box") then
-      print("boxface="..boxface);
+      debug("boxface="..boxface);
       set_stone(boxface,x,y,{movable=1,name=boxname});
    else
-      print("boxface="..boxface);
+      debug("boxface="..boxface);
       set_stone(boxface,x,y,{name=boxname})
    end
 end
@@ -612,7 +620,7 @@
 
 maxoxyds = 999
 
-function install_oxyds(w,h) -- uses Nat's method (see nat7.lua)
+function choose_oxyd_positions(w,h) -- uses Nat's method (see nat7.lua)
    for x=1,w do
       for y=1,h do
          if (peek(x,y)=='#') then
@@ -875,7 +883,9 @@
       position[p][3] = position[p][3]+xlo-1
       position[p][4] = position[p][4]+ylo-1
    end
+end
 
+function set_oxyds()
    -- now really set oxyds
    for p=1,positions do
       local xd,yd = position[p][1],position[p][2]
@@ -885,24 +895,22 @@
       enigma.KillStone(xo,yo)
 
       if (shogunLaser==1) then
-         lasers = lasers+1
          local d
          if (xd==xo) then
             if (yd>yo) then d = NORTH else d = SOUTH end
          else
             if (xd>xo) then d = WEST else d = EAST end
          end
-         set_stone("st-laser",xd,yd,{name="laser"..lasers, dir=d,on=0})
+         set_stone("st-laser",xd,yd,{name="laser"..p, dir=d,on=0})
       else
-         doors = doors+1
          local d = "v"
          if (xd==xo) then d = "h" end
          set_floor(floorface,xd,yd)
          if doorface == "st-blocker" then
-           set_stone(doorface,xd,yd, {name="door"..doors})
+           set_stone(doorface,xd,yd, {name="door"..p})
          else
---           set_stone(doorface,xd,yd, {name="door"..doors, type=d})
-           set_stone(doorface,xd,yd, {name="door"..doors})
+--           set_stone(doorface,xd,yd, {name="door"..p, type=d})
+           set_stone(doorface,xd,yd, {name="door"..p})
          end
       end
       oxyd(xo,yo)
@@ -924,7 +932,7 @@
    if (multiTriggeredDoors>0 and multiTriggeredDoors<doors) then
       locked_target = multiTriggeredDoors+1 -- dont use multitrigger door (makes levels nearly unsolvable)
    end
-
+      
    debug("correct_locked_target_position: locked_target="..locked_target.." doors="..doors.." multiTriggeredDoors="..multiTriggeredDoors);
 
    while (locked_target <= doors) do
@@ -1352,41 +1360,54 @@
       preferred_width,preferred_height = w+40,h+26
    end
 
+   init(num-1)
+   rs_create_world(level,cells,set_spacecell,set_spacecell)
+   
+   enigma.ConserveLevel = FALSE
+   enigma.ShowMoves = TRUE
+
+   if (scrolling==1) then
+      spl,spr,spt,spb = 1,1,1,1 -- everywhere is space
+   else
+      if (xlo > 0) then
+         spl = 1 -- there's space at the left side
+         space_count = space_count + maph
+      end
+      if (ylo > 0) then
+         spt = 1 -- there's space at the top side
+         space_count = space_count + mapw
+      end
+      if ((xlo+mapw) < 20) then
+         spr = 1 -- there's space at the right side
+         space_count = space_count + maph
+      end
+      if ((ylo+maph) < 13) then
+         spb = 1 -- there's space at the bottom side
+         space_count = space_count + mapw
+      end
+   end
+   
+   debug("Space aside: spl="..spl.." spr="..spr.." spt="..spt.." spb="..spb);
+   
    while ((tries > 0) and (maxoxyds > 0) and (ok == 0)) do
-      init(num-1)
-      rs_create_world(level,cells,set_spacecell,set_spacecell)
+      doors = 0
+      lasers = 0
+      shuffle = {}
+      shuffletrig = {}
+      position = {}
+      positions = 0
+      locked_target = 1
 
-      enigma.ConserveLevel = FALSE
-      enigma.ShowMoves = TRUE
+      -- install oxyds
+      choose_oxyd_positions(w,h)
 
-      if (scrolling==1) then
-         spl,spr,spt,spb = 1,1,1,1 -- everywhere is space
+      if (shogunLaser==1) then
+         lasers = positions
       else
-         if (xlo > 0) then
-            spl = 1 -- there's space at the left side
-            space_count = space_count + maph
-         end
-         if (ylo > 0) then
-            spt = 1 -- there's space at the top side
-            space_count = space_count + mapw
-         end
-         if ((xlo+mapw) < 20) then
-            spr = 1 -- there's space at the right side
-            space_count = space_count + maph
-         end
-         if ((ylo+maph) < 13) then
-            spb = 1 -- there's space at the bottom side
-            space_count = space_count + mapw
-         end
-      end
+         doors = positions
+      end      
 
-      debug("Space aside: spl="..spl.." spr="..spr.." spt="..spt.." spb="..spb);
-
-      -- install oxyds
-      install_oxyds(w,h)
-      local targets=doors
-      if (shogunLaser==1) then targets=lasers end
-      init_shuffle(targets) -- mix trigger-door associations
+      init_shuffle(positions) -- mix trigger-door associations
       ok = correct_target_positions()
       -- ok = 1
       if (ok == 0) then
@@ -1395,6 +1416,8 @@
       tries = tries - 1
       -- if (maxoxyds > 2) then maxoxyds = maxoxyds - 1 end
    end
+   
+   set_oxyds()
 
    if (ok==0) then
       error("Sorry - couldn't correct door positions. Avoiding deadlock (try again)");
@@ -1427,7 +1450,9 @@
          boxx[b]=-1
          boxy[b]=-1
       end
-      set_stone("st-timer", 0,0, {action="callback", target="timer_cb", interval=0.3, invisible=1})
+      if useSwapStyle ~= 1 then
+        set_stone("st-timer", 0,0, {action="callback", target="timer_cb", interval=0.3, invisible=1})
+      end
    end
 
 end

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-09-21 22:51:29 UTC (rev 1337)
+++ trunk/data/schemas/objects.xml	2008-09-22 21:21:50 UTC (rev 1338)
@@ -7,6 +7,7 @@
     <attr name="anchor1" type="tokens" default="nil" rw="rw"/>
     <attr name="anchor2" type="tokens" default="nil" rw="rw"/>
     <attr name="autoclose" type="bool" default="false" rw="rw"/>
+    <attr name="burnable" type="bool" default="false" rw="rw"/>
     <attr name="cluster" type="int" default="nil" min="0" max="9" rw="rw"/>
     <attr name="code" type="int" default="1" rw="rw"/>
     <attr name="coin_value" type="double" default="1" rw="rw"/>
@@ -16,7 +17,9 @@
     <attr name="checkerboard" type="int" default="nil" rw="rw"/>
     <attr name="destination" type="tokens" default="nil" rw="rw"/>
     <attr name="essential" type="int" default="0" min="0" max="2" rw="rw"/>
+    <attr name="eternal" type="bool" default="false" rw="rw"/>
     <attr name="faces" type="string" default="nil" rw="rw"/>
+    <attr name="fastfire" type="bool" default="false" rw="rw"/>
     <attr name="fellows" type="group" default="nil" rw="r"/>
     <attr name="flavor" type="string" default="b" rw="rw"/>
     <attr name="freeze_check" type="bool" default="false" rw="rw"/>
@@ -28,6 +31,8 @@
     <attr name="hit_distortion_yx" type="double" default="0" rw="rw"/>
     <attr name="hit_distortion_yy" type="double" default="1" rw="rw"/>
     <attr name="hollow" type="bool" default="false" rw="rw"/>
+    <attr name="ignitable" type="bool" default="false" rw="rw"/>
+    <attr name="initfire" type="bool" default="false" rw="rw"/>
     <attr name="instant" type="bool" default="false" rw="rw"/>
     <attr name="intensity" type="double" default="1" rw="rw"/>
     <attr name="interval" type="double" default="1" rw="rw"/>
@@ -44,6 +49,7 @@
     <attr name="name" type="string" default="nil" rw="rw"/>
     <attr name="name_m" type="string" default="nil" rw="rw"/>
     <attr name="name_s" type="string" default="nil" rw="rw"/>
+    <attr name="noash" type="bool" default="false" rw="rw"/>
     <attr name="nopaction" type="bool" default="false" rw="rw"/>
     <attr name="noshuffle" type="bool" default="false" rw="rw"/>
     <attr name="orientation" type="int" default="0" min="0" max="3" rw="rw"/>
@@ -66,9 +72,12 @@
     <msg name="close" type="nil"/>
     <msg name="closeall" type="nil"/>
     <msg name="disconnect" type="nil"/>
+    <msg name="expl" type="nil"/>
     <msg name="flip" type="nil"/>
+    <msg name="forcefire" type="nil"/>
     <msg name="get_adjacents" type="nil"/>
     <msg name="grow" type="nil"/>
+    <msg name="heat" type="nil"/>
     <msg name="hit" type="object"/>
     <msg name="ignite" type="nil"/>
     <msg name="inner_pull" type="dir"/>
@@ -80,9 +89,11 @@
     <msg name="orientate" type="nil"/>
     <msg name="pull_rotate" type="int"/>
     <msg name="push_rotate" type="int"/>
+    <msg name="setfire" type="nil"/>
     <msg name="shuffle" type="nil"/>
     <msg name="shovel" type="nil"/>
     <msg name="signal" type="int" min="0" max="1"/>
+    <msg name="stopfire" type="nil"/>
     <msg name="toggle" type="nil"/>
     <msg name="turn" type="nil"/>
     <msg name="turnback" type="nil"/>
@@ -121,7 +132,21 @@
       <msg name="toggle"/>
     </object>
     <object name="fl" abstract="true">
+      <attr name="burnable"/>
+      <attr name="eternal"/>
+      <attr name="fastfire"/>
+      <attr name="freeze_check"/>
+      <attr name="ignitable"/>
+      <attr name="initfire"/>      
+      <attr name="noash"/>
       <attr name="push_directions"/>
+      <attr name="secure"/>
+      <msg name="expl"/>
+      <msg name="heat"/>
+      <msg name="forcefire"/>
+      <msg name="ignite"/>
+      <msg name="setfire"/>
+      <msg name="stopfire"/>
     </object>
     <object name="fl_bridge">
       <attr name="flavor" default="gc"/>

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-09-21 22:51:29 UTC (rev 1337)
+++ trunk/doc/reference/enigma-ref.texi	2008-09-22 21:21:50 UTC (rev 1338)
@@ -7636,7 +7636,7 @@
 A chess stone that jumps onto a @ref{fl_thief} captures and inactivates the 
 thief.
 
-Chess stones can't jump over or into fire (see The 1.0-Fire System). At least, 
+Chess stones can't jump over or into fire (see @ref{The 1.0-Fire System}). At least, 
 a chess knight is brave enough not to panic when fire starts to burn beneath. 
 Note that fire can't ignite the floor below a chess stone. In this
 context it acts like an immovable stone. In the same sense, they don't act on 
@@ -15873,11 +15873,11 @@
 @strong{Burnable and Fireproof Floors}
 
 The following floors are fireproof (they don't burn by default):
- at code{fl-abyss*, fl-ac*, fl-black, fl-brick, fl-bridge*, fl-bumps,
+ at code{fl-abyss*, fl-ac*, fl-black, fl-brick, fl-bumps,
 fl-concrete, fl-dummy, fl-dunes, fl-gradient*, fl-gravel, fl-gray,
 fl-himalaya, fl-ice*, fl-inverse, fl-inverse2, fl-darkgray, fl-metal*,
 fl-mortar, fl-normal*, fl-rock, fl-sahara, fl-sand, fl-space*,
-fl-springboard, fl-stone, fl-swamp, fl-water, fl-white}
+fl-springboard, fl-stone, fl-swamp, fl-water, fl-white}, gray @code{fl-bridge}
 
 The following floors are burnable: @code{fl-bluegray, fl-bluegreen*,
 fl-hay, fl-light, fl-lightgray, fl-marble, fl-red, fl-rough*,
@@ -15887,8 +15887,15 @@
 @code{fl-leaves*}
 
 The following floors are burnable and leave @code{fl-abyss} behind:
- at code{fl-floor_001, fl-plank, fl-samba*, fl-stwood*, fl-wood*}
+ at code{fl-floor_001, fl-plank, fl-samba*, fl-stwood*, fl-wood*}, brown
+ at code{fl-bridge}.
 
+An open @ref{fl-bridge} is never burnable, this overrides all items and
+attributes. A closed @code{fl-bridge} is burnable if and only if it is brown,
+but this can be changed via attribute @code{burnable}. Note that changing the
+flavor of @code{fl-bridge} will change @code{burnable} according to the new
+flavor as well.
+
 @strong{Fireproof Items}
 
 Most items are passively burnable, this is: An item is destroyed by

Modified: trunk/src/floors/BridgeFloor.cc
===================================================================
--- trunk/src/floors/BridgeFloor.cc	2008-09-21 22:51:29 UTC (rev 1337)
+++ trunk/src/floors/BridgeFloor.cc	2008-09-22 21:21:50 UTC (rev 1338)
@@ -26,7 +26,9 @@
 
 namespace enigma {
     
-    BridgeFloor::BridgeFloor(std::string flavor) : Floor("fl_bridge", 5, 1) {
+    BridgeFloor::BridgeFloor(std::string flavor) : Floor("fl_bridge", 5, 1,
+        flf_default, flft_noash, "fl-abyss")
+    {
         Floor::setAttr("flavor", flavor);
         state = OPEN;
     }
@@ -40,6 +42,7 @@
             std::string flavor = val.to_string();
             ASSERT(flavor == "gc" || flavor == "bw" || flavor == "bn", XLevelRuntime, "BridgeFloor illegal flavor value");
             Floor::setAttr("flavor", val);
+            Floor::setAttr("burnable", flavor != "gc");
             if (isDisplayable() && state <= OPEN) {
                 init_model();    // need to redisplay after attribute set
             }
@@ -155,6 +158,14 @@
         state = newState;
     }
 
+    bool BridgeFloor::has_firetype(FloorFireType selector) {
+        if(   (selector == flft_burnable)
+           && (server::GameCompatibility == GAMET_ENIGMA)) {
+            return (state == CLOSED) && Floor::has_firetype(selector);
+        } else
+            return Floor::has_firetype(selector);
+    }
+
     BOOT_REGISTER_START
         BootRegister(new BridgeFloor("gc"), "fl_bridge");
         BootRegister(new BridgeFloor("gc"), "fl_bridge_gc");

Modified: trunk/src/floors/BridgeFloor.hh
===================================================================
--- trunk/src/floors/BridgeFloor.hh	2008-09-21 22:51:29 UTC (rev 1337)
+++ trunk/src/floors/BridgeFloor.hh	2008-09-22 21:21:50 UTC (rev 1338)
@@ -63,7 +63,10 @@
         // Floor interface
         virtual void stone_change(Stone *st);
         virtual void actor_contact(Actor *a);
-        
+
+    protected:
+        bool has_firetype(FloorFireType selector);
+            
     private:
         // Private methods.
         std::string model_basename() const;



From ral at mail.berlios.de  Wed Sep 24 23:18:41 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 24 Sep 2008 23:18:41 +0200
Subject: [Enigma-game-svn] r1339 - in trunk: data data/levels/lib
	data/schemas src src/items src/others src/stones
Message-ID: <200809242118.m8OLIfwB012855@sheep.berlios.de>

Author: ral
Date: 2008-09-24 23:18:40 +0200 (Wed, 24 Sep 2008)
New Revision: 1339

Modified:
   trunk/data/api1init.lua
   trunk/data/levels/lib/libpuzzle_3.xml
   trunk/data/schemas/objects.xml
   trunk/src/floors.cc
   trunk/src/floors.hh
   trunk/src/items/PipeItem.cc
   trunk/src/items/RubberbandItem.cc
   trunk/src/others/Wire.cc
   trunk/src/player.cc
   trunk/src/player.hh
   trunk/src/stones/PuzzleStone.cc
Log:
Trunk 1.1: new API reengineering
- fix puzzle: propagate wire impulse
- modify puzzle resolver suffix usage: use hollow cluster suffices 5-9
- floor new API:
  - rename attribute "mousefactor" to "adhesion"
  - declare attributes "adhesion" and "friction"
  - add read access to  "adhesion" and "friction"
  - fix r1338: eliminate not existing message "expl"
- fix wires:
  - in case of a second wire gets added between two stones, the first one
    is removed.
- fix rubberband item:
  - in case of activation the item gets dropped if it would cause a second
    rubberband between two objects
- modify brake stone: pickup brake while jumping
- fix mail pipe: do not drop a brake at the end of a closed pipe

Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-09-22 21:21:50 UTC (rev 1338)
+++ trunk/data/api1init.lua	2008-09-24 21:18:40 UTC (rev 1339)
@@ -599,6 +599,9 @@
          else _val = "gc"
          end
      end
+     if key == "mousefactor" then
+         _key = "adhesion"
+     end
      enigma._SetAttrib(obj, _key, _val)
 end
 

Modified: trunk/data/levels/lib/libpuzzle_3.xml
===================================================================
--- trunk/data/levels/lib/libpuzzle_3.xml	2008-09-22 21:21:50 UTC (rev 1338)
+++ trunk/data/levels/lib/libpuzzle_3.xml	2008-09-24 21:18:40 UTC (rev 1339)
@@ -120,10 +120,10 @@
             end
         else
             if tile[1]:find("st_puzzle", 1, true) then
-                local clusteridx = ("01234456789"):find(suffix, 1, true)
+                local clusteridx = ("01234pqrstuvwxyz"):find(suffix, 1, true)
                 local connections = (" abcdefghijklmno"):find(suffix, 1 , true)
                 if  clusteridx == nil then
-                    clusteridx = (")!@#$%^&*("):find(suffix, 1, true)
+                    clusteridx = ("56789PQRSTUVWXYZ"):find(suffix, 1, true)
                     if clusteridx ~= nil then
                         tile["hollow"] = true
                     end
@@ -135,7 +135,11 @@
                     end
                 end
                 if  clusteridx ~= nil then
-                    tile["cluster"] = clusteridx - 1
+                    if clusteridx < 6 then
+                        tile["cluster"] = clusteridx - 1
+                    else   -- pqr...xyz = 10...20
+                        tile["cluster"] = clusteridx + 4
+                    end
                 elseif connections ~= nil then
                     tile["connections"] = ({"","w","s","sw","e","ew","es","esw",
                             "n","nw","ns","nsw","ne","new","nes","nesw"})[connections]

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-09-22 21:21:50 UTC (rev 1338)
+++ trunk/data/schemas/objects.xml	2008-09-24 21:18:40 UTC (rev 1339)
@@ -132,16 +132,17 @@
       <msg name="toggle"/>
     </object>
     <object name="fl" abstract="true">
+      <attr name="adhesion"/>
       <attr name="burnable"/>
       <attr name="eternal"/>
       <attr name="fastfire"/>
       <attr name="freeze_check"/>
+      <attr name="friction"/>
       <attr name="ignitable"/>
       <attr name="initfire"/>      
       <attr name="noash"/>
       <attr name="push_directions"/>
       <attr name="secure"/>
-      <msg name="expl"/>
       <msg name="heat"/>
       <msg name="forcefire"/>
       <msg name="ignite"/>

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2008-09-22 21:21:50 UTC (rev 1338)
+++ trunk/src/floors.cc	2008-09-24 21:18:40 UTC (rev 1339)
@@ -87,7 +87,7 @@
 
 void Floor::setAttr(const string& key, const Value &val)
 {
-    if (key == "mousefactor")
+    if (key == "adhesion")
         var_mousefactor = to_double(val);
     else if (key == "friction")
         var_friction = to_double(val);
@@ -98,6 +98,16 @@
     GridObject::setAttr(key, val);
 }
 
+    Value Floor::getAttr(const std::string &key) const {
+        if (key == "adhesion") {
+            return var_mousefactor;
+        } else if (key == "friction") {
+            return var_friction;
+        }
+        return GridObject::getAttr(key);
+
+    }
+
 void Floor::get_sink_speed (double &sinkspeed, double &raisespeed) const {
 //     sinkspeed = raisespeed = 0.0;
 }

Modified: trunk/src/floors.hh
===================================================================
--- trunk/src/floors.hh	2008-09-22 21:21:50 UTC (rev 1338)
+++ trunk/src/floors.hh	2008-09-24 21:18:40 UTC (rev 1339)
@@ -96,6 +96,7 @@
         void dispose();
         virtual Value message(const Message &m);
         virtual void setAttr(const string& key, const Value &val);
+        virtual Value getAttr(const std::string &key) const;
 
         // Floor interface
         virtual ecl::V2 process_mouseforce (Actor *a, ecl::V2 force);

Modified: trunk/src/items/PipeItem.cc
===================================================================
--- trunk/src/items/PipeItem.cc	2008-09-22 21:21:50 UTC (rev 1338)
+++ trunk/src/items/PipeItem.cc	2008-09-24 21:18:40 UTC (rev 1339)
@@ -52,7 +52,7 @@
                             case SOUTHBIT : move_dir = SOUTH; break;
                             case EASTBIT : move_dir = EAST; break;
                             case NORTHBIT : move_dir = NORTH; break;
-                            default : move_dir = NODIR; break;
+                            default : return GridPos(-1, -1);         // illegal position outside of world
                         }
                     } else
                         move_dir = NODIR;

Modified: trunk/src/items/RubberbandItem.cc
===================================================================
--- trunk/src/items/RubberbandItem.cc	2008-09-22 21:21:50 UTC (rev 1338)
+++ trunk/src/items/RubberbandItem.cc	2008-09-24 21:18:40 UTC (rev 1339)
@@ -54,7 +54,15 @@
 
         sound_event ("rubberband");
         
-        if (anchor2 != a) { // It's not allowed to connect a rubberband to self.
+        bool alreadyConnected = false;
+        ObjectList rubbers = a->getAttr("rubbers");
+        for (ObjectList::iterator it =  rubbers.begin(); it != rubbers.end(); ++it) {
+            if (((Object *)(*it)->getAttr("anchor2")) == anchor2) {
+                alreadyConnected = true;
+                break;
+            }
+        }
+        if (!alreadyConnected && anchor2 != a) { // It's not allowed to connect a rubberband to self.
             Object *obj = MakeObject("ot_rubberband");
             obj->setAttr("anchor1", a);
             obj->setAttr("anchor2", anchor2);

Modified: trunk/src/others/Wire.cc
===================================================================
--- trunk/src/others/Wire.cc	2008-09-22 21:21:50 UTC (rev 1338)
+++ trunk/src/others/Wire.cc	2008-09-24 21:18:40 UTC (rev 1339)
@@ -109,6 +109,20 @@
             if (otherAnchor != NULL) {
                 // add both anchors to each others fellows list
                 olist = newAnchor->getAttr("fellows");
+                ObjectList::iterator it = find(olist.begin(), olist.end(), otherAnchor);
+                if (it != olist.end()) {
+                    // we are a replacement wire for an already existing wire - remove it
+                    olist = newAnchor->getAttr("wires");
+                    for (ObjectList::iterator itr = olist.begin(); itr != olist.end(); ++itr) {
+                        Wire *w = dynamic_cast<Wire *>(*itr);
+                        if (w != NULL && (((Object *)(w->getAttr("anchor1")) == newAnchor &&  (Object *)(w->getAttr("anchor2")) == otherAnchor)
+                                || ((Object *)(w->getAttr("anchor2")) == newAnchor &&  (Object *)(w->getAttr("anchor1")) == otherAnchor)))
+                            KillOther(w);
+                            break;
+                    }
+                    // reload fellows
+                    olist = newAnchor->getAttr("fellows");
+                }
                 olist.push_back(otherAnchor);
                 newAnchor->setAttr("fellows", olist);
                 olist = otherAnchor->getAttr("fellows");

Modified: trunk/src/player.cc
===================================================================
--- trunk/src/player.cc	2008-09-22 21:21:50 UTC (rev 1338)
+++ trunk/src/player.cc	2008-09-24 21:18:40 UTC (rev 1339)
@@ -548,7 +548,7 @@
 
 /*! Return pointer to inventory if actor may pick up items, 0
    otherwise. */
-Inventory *player::MayPickup(Actor *a, Item *it) 
+Inventory *player::MayPickup(Actor *a, Item *it, bool allowFlying) 
 {
     int iplayer=-1;
     if (Value v = a->getAttr("player")) iplayer = v;
@@ -559,7 +559,7 @@
 
     Inventory *inv = GetInventory(iplayer);
     bool dont_pickup = players[iplayer].inhibit_pickup 
-        || a->is_flying()
+        || (!allowFlying && a->is_flying())
         || !inv->willAddItem(it)
         || a->is_dead();
 
@@ -580,7 +580,7 @@
 
 void player::PickupStoneAsItem (Actor *a, enigma::GridPos p) 
 {
-    if (Inventory *inv = MayPickup(a, GetField(p)->item)) 
+    if (Inventory *inv = MayPickup(a, GetField(p)->item, true)) 
     {
         if (Stone *stone = YieldStone(p)) 
         {

Modified: trunk/src/player.hh
===================================================================
--- trunk/src/player.hh	2008-09-22 21:21:50 UTC (rev 1338)
+++ trunk/src/player.hh	2008-09-24 21:18:40 UTC (rev 1339)
@@ -72,7 +72,7 @@
         unsigned NumberOfRealPlayers();
 
 
-        Inventory *MayPickup(Actor *a, Item *it);
+        Inventory *MayPickup(Actor *a, Item *it, bool allowFlying = false);
         Inventory *GetInventory(int iplayer);
         Inventory *GetInventory(Actor *a);
         bool       WieldedItemIs(Actor *a, const std::string &kind);

Modified: trunk/src/stones/PuzzleStone.cc
===================================================================
--- trunk/src/stones/PuzzleStone.cc	2008-09-22 21:21:50 UTC (rev 1338)
+++ trunk/src/stones/PuzzleStone.cc	2008-09-24 21:18:40 UTC (rev 1339)
@@ -244,6 +244,7 @@
 
             moveCluster(!actor_with_wand, impulse.dir);
         }
+        propagateImpulse(impulse);
     }
 
     void PuzzleStone::on_move() {



From ral at mail.berlios.de  Fri Sep 26 19:58:47 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Fri, 26 Sep 2008 19:58:47 +0200
Subject: [Enigma-game-svn] r1340 - trunk/doc/reference
Message-ID: <200809261758.m8QHwlHe001527@sheep.berlios.de>

Author: ral
Date: 2008-09-26 19:58:37 +0200 (Fri, 26 Sep 2008)
New Revision: 1340

Modified:
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk 1.1: new API
- refman docu updates for r1339: added bridge, puzzle


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-09-24 21:18:40 UTC (rev 1339)
+++ trunk/doc/reference/enigma-ref.texi	2008-09-26 17:58:37 UTC (rev 1340)
@@ -5608,6 +5608,7 @@
 * MagnetRange:: 
 * MagnetStrength::
 * MaxOxydColor::
+* MeditationStrength::
 * ProvideExtralifes::
 * ShowMoves::
 * SurviveFinish::
@@ -5819,6 +5820,21 @@
 @item @b{Support:} @ @ @ref{st_oxyd}
 @end table
 
+ at node MeditationStrength
+ at subsection MeditationStrength
+
+A global scalar default factor for @ref{it_meditation} slope forces. Positive
+numbers are downhill forces that let actors roll into dents and hollows and roll
+down from hills and bumps. 
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ float number
+ at item @b{Default:} @ @ @code{1.0}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{it_meditation}
+ at end table
+
 @node ProvideExtralifes
 @subsection ProvideExtralifes
 
@@ -5915,6 +5931,87 @@
 
 @node Floor Objects
 @chapter Floor Objects
+
+ at menu
+* Special Floors:: 
+ at end menu
+
+ at node Special Floors
+ at section Special Floors
+
+ at menu
+* fl_bridge::         Abyss Bridge
+ at end menu
+
+ at c ----------------- Bridge Floor -------------------- 
+ at node fl_bridge
+ at subsection fl_bridge
+ at obindex fl_bridge
+
+A bridge is a variable floor that can be passed when being @code{CLOSED} but
+being unpassable for marbles like @ref{fl_abyss} when being opened. Floor
+bridges come in several flavors. They can be grey or wooden brown, they can
+pop up in the center or emerge from one side. The flavor string is a combination
+of a color character and a emerging direction character. Note that not all
+combination do exist.
+
+Bridges can be opened and closed via messages and state set operations like
+ at ref{st_door}.
+
+But a unique feature of bridges is to close on a solid stone being pushed onto
+them. Thus stones do not fall into the visible abyss of an opened bridge, but
+can be pushed over them. But as soon as the stone leaves the bridge it openes
+again. Thus a user will notice the closing and opening bridge on stone pushes.
+
+To be more precise after a stone leaving a bridge, it switches into the state
+that it would have had if the stone would never have been on top of it. That
+means that if a stone gets pushed onto an open bridge and the bridge receives
+a @code{"close"} or @code{"toggle"} message while the stone is being on top the
+bridge remains closed when the stone is pushed away.
+
+A bridge being set adjusts its state according to the @ref{Snapshot Principle}.
+It checks for solid stones being on top of it and auto closes accordingly.
+
+ at table @asis
+
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{state}, @ @ @i{values}: @code{CLOSED}, @code{OPEN}; @ @ @i{default}: @code{OPEN} @ @ @xref{state}
+The state as visible and responsible for the actor ability to pass.
+ at item @b{flavor}, @ @ @i{values}: @code{"gc"}, @code{"bw"}, @code{"bn"}; @ @ @i{default}: @code{"gc"}
+The type of the bridge.
+ at end table
+
+ at item @b{Messages:}
+ at table @asis
+ at item @b{open} @ @ @xref{open}
+Opens a closed bridge that is not covered by a solid stone. Otherwise the 
+explicit open request will be registered and executed as soon as the stone
+is pushed away.
+ at item @b{close} @ @ @xref{close}
+Closes an open bridge. If the bridge is already closed by a covering solid
+stone, the request will be registered and the bridge will not open when the
+stone is pushed away.
+ at item @b{signal} @ @ @xref{signal}
+A signal of value 1 sends an open message, a signal of value 0 sends a close
+message.
+ at item @b{toggle} @ @ @xref{toggle}
+A toggle causes a change of the state if no stone is on top, or the registered
+explicit state if a solid stone currently covers the bridge.
+ at end table
+
+
+ at item @b{Variants:}
+ at table @asis
+ at item @b{fl_bridge} flavor = @code{"gc"}
+ at item @b{fl_bridge_gc} flavor = @code{"gc"}
+ at item @b{fl_bridge_bw} flavor = @code{"bw"}
+ at item @b{fl_bridge_bn} flavor = @code{"bn"}
+ at end table
+
+ at end table
+
 @c ===================  Items  =======================
 
 @node Item Objects
@@ -5942,6 +6039,7 @@
 * it_landmine::        
 * it_magicwand::       Wizards Tools
 * it_magnet::          
+* it_meditation::      
 * it_pipe::            
 * it_rubberband::      
 * it_seed::            Seeds for Wood, Volcano Stones
@@ -6460,54 +6558,87 @@
 
 @end table
 
- at c ----------------- Seed Item -------------------- 
- at node it_seed
- at subsection it_seed
- at obindex it_seed
+ at c ----------------- Meditation Item -------------------- 
+ at node it_meditation
+ at subsection it_meditation
+ at obindex it_meditation
 
-Stone seeds are items that start growing and finally transforming to stones
-on activation. There are different @samp{flavor}s of seeds that all look the
-same, but do grow to different stones. While a @samp{wood} seed grows to an
- at ref{st_wood}, a @samp{fake} seed grows to an unmovable green brown stone and
-a @samp{volcano} seed grows to an active @ref{st_volcano}.
+Meditation items are small round areas of flatness imperfection. All actors will
+experience the slope forces that can be modified by the global scalar factor
+ at ref{MeditationStrength}. There are different shapes of meditation items that 
+are named according to their shape: @code{MEDITATION_CALDERA}, 
+ at code{MEDITATION_HOLLOW}, @code{MEDITATION_DENT}, @code{MEDITATION_BUMP}, 
+ at code{MEDITATION_HILL}, @code{MEDITATION_VOLCANO}.
 
-Seeds can be dropped on any item free grid position, even beneath another stone
-that will get killed by the seed successor stone.
+Of special interest are @ref{ac_marble_meditation}s resting on a meditation 
+item. They are counted as meditating after staying continuously for one second
+within the round area of the item. One of the two @ref{Ending Conditions} of the
+game is that all meditation marbles come to rest on mediation items.
 
-Seeds get automatically activated when being dropped, when hit by a laser beam
-or a stone being pushed on them. You can activate them by @samp{grow} and
- at samp{signal} messages, too.
+As meditation items can dynamically be generated during the game by exploding
+ at ref{it_landmine} or @ref{it_dynamite} it may be necessary for an author to
+mark those meditation items that are required to be filled with meditation
+marbles. You do this by setting the @samp{essential} attribute to @code{true}.
+Please make rare and obvious usage of this attribute, as the player can not 
+distinguish essential from not essential meditation items by their images.
 
-The identity of the seed gets transfered to the emerging stone including the
-attribute @samp{secure}.
+Meditation items can transform into other shapes by various means. 
 
-The only method of handling seeds without activation are containment within a
- at ref{it_bag} or sending them via @ref{st_mail} to a destination grid.
+First a user can push a solid stone over a meditation item or activate an 
+ at ref{it_shovel} on it. Both actions flatten the meditation, either
+ at code{MEDITATION_VOLCANO} -> @code{MEDITATION_HILL} -> @code{MEDITATION_BUMP}
+-> @code{it_nil} or @code{MEDITATION_CALDERA} -> @code{MEDITATION_HOLLOW} ->
+ at code{MEDITATION_DENT} -> @code{it_nil}.
 
+Secondly you can send a @code{"flip"} message to a meditation item which 
+transforms hollow like items into their hill like counterparts and vice versa:
+ at code{MEDITATION_VOLCANO} <-> @code{MEDITATION_CALDERA}, @code{MEDITATION_HILL} 
+<-> @code{MEDITATION_HOLLOW}, @code{MEDITATION_BUMP} <-> @code{MEDITATION_DENT}.
+
+Third a @code{"signal"} messages flips on a @code{1} value all meditations to
+their hill like counterparts, keeping hill like meditations unchanged, and on a
+ at code{0} value to their hollow like counterparts, keeping hollow like meditations
+unchanged.
+
+A fourth message is @code{"toggle"}. It transforms @code{MEDITATION_HOLLOW} <->
+ at code{MEDITATION_VOLCANO}, @code{MEDITATION_CALDERA} <-> @code{MEDITATION_HILL},
+ at code{MEDITATION_BUMP} <-> @code{MEDITATION_DENT}.
+
+Of course you can change the state by attribute setting anytime in any sequence
+you like. Essentialness is kept on shape transformations and mediation actor
+counting is updated and continues.
+
 @table @asis
 @item @b{Attributes:}
 @table @asis
- at item @b{flavor}, @ @ @i{values}: @code{"wood"}, @code{"fake"}, @code{"volcano"}; @ @ @i{default}: @code{"wood"}
-The type of the resulting stone.
- at item @b{secure} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
-This attribute is transfered to the resulting stone. The @ref{st_volcano} makes
-use of it.
+ at item @b{state}, @ @ @i{values}: @code{MEDITATION_CALDERA}, @code{MEDITATION_HOLLOW}, @code{MEDITATION_DENT}, @code{MEDITATION_BUMP}, @code{MEDITATION_HILL}, @code{MEDITATION_VOLCANO}; @ @ @i{default}: @code{MEDITATION_HOLLOW} @ @ @xref{state}
+The shape of the meditation.
+ at item @b{essential} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+Essentialness of being filled with a meditation marble to fulfill the 
+ at ref{Ending Conditions}.
 @end table
 
- at item @b{Messages:} none
+ at item @b{Messages:}
 @table @asis
- at item @b{grow}
-Start growing the seed.
+ at item @b{flip}
+Shape transformation. See text above.
+ at item @b{shovel}
+Shape transformation like an activated @ref{it_shovel}. See text above.
 @item @b{signal} @ @ @xref{signal}
-Start growing the seed.
+Shape transformation. See text above.
+ at item @b{toggle}
+Shape transformation. See text above.
 @end table
 
 @item @b{Variants:}
 @table @asis
- at item @b{it_seed} flavor = @code{"wood"}
- at item @b{it_seed_wood} flavor = @code{"wood"}
- at item @b{it_seed_fake} flavor = @code{"fake"}
- at item @b{it_seed_volcano} flavor = @code{"volcano"}
+ at item @b{it_meditation} state = @code{MEDITATION_HOLLOW}
+ at item @b{it_meditation_caldera} state = @code{MEDITATION_CALDERA}
+ at item @b{it_meditation_hollow} state = @code{MEDITATION_HOLLOW}
+ at item @b{it_meditation_dent} state = @code{MEDITATION_DENT}
+ at item @b{it_meditation_bump} state = @code{MEDITATION_BUMP}
+ at item @b{it_meditation_hill} state = @code{MEDITATION_HILL}
+ at item @b{it_meditation_volcano} state = @code{MEDITATION_VOLCANO}
 @end table
 
 @end table
@@ -6643,7 +6774,7 @@
 use of it.
 @end table
 
- at item @b{Messages:} none
+ at item @b{Messages:}
 @table @asis
 @item @b{grow}
 Start growing the seed.
@@ -7354,6 +7485,7 @@
 * st_oxyd::            Game Target Stone
 * st_polarswitch::     Transparency Switch for Light Beams
 * st_pull::            Pullable Stone
+* st_puzzle::          Clusterable Puzzle Stones
 * st_rotator::         Rotating Stone Impulser
 * st_rubberband::      Rubberband generator
 * st_scissors::        Scissors cutting rubberbands
@@ -7586,11 +7718,11 @@
 all other blocking stones the brake can be picked up as an item by actors and
 dropped anywhere else.
 
-When an actor passes below the brake stone it will pick up the object like
-other items. The brake will be added as an @ref{it_brake} to its inventory. 
-Unlike other items the brake can be dropped even on grids that are already
-occupied by an item. But you can not drop the brake beneath another stone like
-a @ref{it_seed}.
+When an actor passes an brake stone, rolling on the floor or while jumping, it
+will pick up the object like other items. The brake will be added as an
+ at ref{it_brake} to its inventory. Unlike other items the brake can be dropped 
+even on grids that are already occupied by an item. But you can not drop the
+brake beneath another stone like a @ref{it_seed}.
 
 On dropping the brake item it transforms immediatly back to an @ref{st_brake}
 without killing the item positioned on the grid. Just one exception is a brake
@@ -7694,6 +7826,13 @@
 coinslot will first switch @samp{OFF} and switch @samp{ON} when the next coin
 is completly inserted.
 
+The acticity interval of a coin insertion depends on the type of the coin. For
+each type you can set the interval by the @samp{interval_*} attributes. You
+can reject the insertion of a coin type by setting its interval to 
+ at samp{COIN_REJECT}. The coin will not be taken from the players inventory. By
+a value of @samp{COIN_IGNORE} on the interval attribute the coinslot will fetch
+the coin but will not act at all.
+
 Coinslots configured as @samp{instant} do activate immediatly when the actor
 hits the stone. On every actor hit a coin is inserted independent of the last
 insertion.
@@ -7710,11 +7849,11 @@
 @item @b{instant} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 A default coinslot switches to active state after insertion of a coin and allows
 the insertion of just one coin at a time.
- at item @b{interval_s} @ @ @i{values}: positive number; @ @ @i{default}: @code{3.0}
+ at item @b{interval_s} @ @ @i{values}: positive number, @code{COIN_REJECT}, @code{COIN_IGNORE}; @ @ @i{default}: @code{3.0}
 Number of additional active seconds on insertion of a small @ref{it_coin}.
- at item @b{interval_m} @ @ @i{values}: positive number; @ @ @i{default}: @code{6.0}
+ at item @b{interval_m} @ @ @i{values}: positive number, @code{COIN_REJECT}, @code{COIN_IGNORE}; @ @ @i{default}: @code{6.0}
 Number of additional active seconds on insertion of a medium @ref{it_coin}.
- at item @b{interval_l} @ @ @i{values}: positive number; @ @ @i{default}: @code{12.0}
+ at item @b{interval_l} @ @ @i{values}: positive number, @code{COIN_REJECT}, @code{COIN_IGNORE}; @ @ @i{default}: @code{12.0}
 Number of additional active seconds on insertion of a large @ref{it_coin}.
 @end table
 
@@ -8305,7 +8444,10 @@
 When hit by an actor, a mail stone takes the first item out of the player's
 inventory and drops it at its exit, or the exit of the appending @ref{it_pipe}. 
 If this position is blocked (e.g., by another item), no item is taken from
-inventory.
+inventory. The @ref{it_brake} is the only item that gets delivered even if 
+another item is positioned at the end of the pipe as it emerges the pipe as an
+@{st_brake} stone. An @ref{it_pipe} end piece with just one fitting connection
+closes a mail pipe completely, rejecting any item insertion.
 
 @table @asis
 @item @b{Attributes:}
@@ -8727,6 +8869,145 @@
 
 @end table
 
+ at c ----------------- Puzzle Stone -------------------- 
+ at node st_puzzle
+ at subsection st_puzzle
+ at obindex st_puzzle
+
+Puzzle stones can construct large clusters of stones, that move together and can
+be destroyed together. There are two colors, blue and yellow puzzle stones, 
+which behave different. Each of these color families again consists of 16
+variants that differ in the location of sockets to which neighboring puzzle 
+stones can be attached. Furtheron there are hollow variants of all colors and
+connections.
+
+A cluster is complete as soon as all sockets of all stones are connected to
+matching sockets of adjacent puzzle stones of the same color, but independent
+of being hollow or solid. A cluster fragment still has at least one stone with
+an open stub. A single puzzle stone with no open sockets counts as a complete
+cluster.
+
+Puzzle stone offer manifold features. A complete cluster can explode and 
+dissolve. Cluster fragments and complete clusters can move and will sink on some
+floors building bridges. Rows and columns of adjacent, identical colored puzzle
+stones, connected and unconnected ones, can shift rotate thus allowing the 
+player to rearrange and sort the puzzle.
+
+Blue puzzle stones can be moved as single stones, cluster fragements and 
+complete clusters by an actor pushing or a stone impulse by @ref{ot_wire} or
+ at ref{st_stoneimpulse}. Of course all new positions of the moving puzzle must be
+free of other stones. If all new positions are @ref{fl_water} the blue puzzle
+will sink and leave @ref{fl_gray} thus building a bridge over water. If all new
+positions are @ref{fl_abyss} just complete blue clusters will sink and build
+a bridge. If all new positions are either abyss or water with at least one
+abyss floor just complete blue clusters will sink. Note that puzzles just sink
+on moves. Moving a blue fragment besides another fragment on abyss so that both
+fragments build a complete cluster will not sink the new cluster. It will sink
+on the next move. If two or more stones of a cluster are connected by a wire
+which all send move impulses by the same event, the cluster will move multiple
+times. But it will sink on the first opportunity.
+
+Just single unconnected yellow puzzle stones can be moved by actors. Any yellow
+cluster of 2 or more stone can not moved by actor hits. But on stone impulses
+they move like blue puzzles with the exception that just complete yellow clusters
+will sink on water.
+
+All puzzle stone moves do not cause standard item transformations, like 
+ at ref{it_coin} value changes, @ref{it_bomb} explosions, etc. But they all are not
+floating and thus do press @ref{it_trigger}s and close @ref{fl_bridge}s.
+
+Hollow puzzle stones let pass actors, either moving on the floor or jumping,
+and laser light without any interaction, too.
+
+Complete clusters can explode and dissolve. A precondition is that the cluster
+is isolated from any adjacent, same colored further puzzle stone. Such clusters
+explode on an additional new laser beam hitting one of its solid stones. Yellow
+ones explode on any actor hit. Blue ones only on actor hits with a revealed 
+ at ref{it_magicwand}.
+
+Exploding puzzles will stay on place and do not interact any more. The exploding
+stones are leathal for actors hitting them, but an actor can start an explosion
+beneath a hollow puzzle stone and stay beneath this hollow exploding stone
+without harm until the puzzle dissolved.
+
+Puzzles can be rearranged by column and row rotations. Blue puzzle react just
+on actor hits with a revealed wand, yellow ones on any actor hit. All colors
+do rotate on laser light hits. All rotations can originate only on a solid
+puzzle stone. All subsequent puzzle stones of the same color will shift away
+with the last puzzle of the line returning to the origin. This operation is
+called @code{"push_rotate"} and can be initiated by a message, too.
+
+In case of actor hits possible explosions preceed moves, which preceed rotation
+operations. Thus you need to touch a blue puzzle row carefully with a revealed
+wand if the row is part of a movable cluster fragment. If the speed is 
+sufficient for a hit operation, the cluster will move instead of an expected
+row rotation.
+
+Like @ref{Cluster Stone}s puzzle accept a @samp{cluster} attribute. A new set
+puzzle stone autoconnects to adjacent, same colored puzzle stones belonging to
+the same cluster. But once set the puzzle stone will of course not change its 
+connections on subsequent moves or rotations. But as a level author you need to 
+think of possible puzzle stones pushed to positions neighboring an area on which
+a puzzle might be set during the running game. The new set stones may 
+autoconnect to such unexpected stones if the color and cluster number fits.
+
+The resolver @ref{res.puzzle} provides easy methods to set and shuffle puzzles.
+The attributes @samp{algorithm} and @samp{intensity} are used by the resolver
+only.
+
+If you need to shuffle a puzzle of your own, you can make use of the messages
+ at samp{get_adjacents} which returns the group of color matching, adjacent puzzle 
+stones, and @samp{push_rotate} which is the exact invertion of a push rotation.
+
+ at table @asis
+ at item @b{Attributes:} none
+ at item @b{color} @ @ @i{values}: @code{BLUE}, @code{YELLOW}; @ @ @i{default}: @code{BLUE}
+The color of the puzzle stubs. Adjacent puzzle stones of matching colors and
+connections cluster to fragments.
+
+ at item @b{connections}, @ @ @i{values}: string; @ @ @i{default}: @code{nil}
+Describes the connection stubs of the puzzle stone. The string is a substring
+of @code{"nesw"} listing the stubs. The sequence of the sides, north, east, 
+south, west, is guaranteed on read access but arbitrary on write access.
+
+ at item @b{cluster} @ @ @i{values}: number; @ @ @i{default}: @code{nil}
+If set to a number all adjacent puzzle stones of the same color with
+the identical cluster number will build a cluster. This attribute superceds
+any explicitly given connection description.
+
+ at item @b{hollow} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+A hollow puzzle stone has a hole in its middle and allows actors to pass beneath.
+
+ at item @b{algorithm}, @ @ @i{values}: string; @ @ @i{default}: @code{nil}
+
+ at item @b{intensity} @ @ @i{values}: number; @ @ @i{default}: @code{3}
+
+ at item @b{Messages:}
+ at table @asis
+ at item @b{get_adjacents}
+Returns the huddle of all adjacent puzzle stones of same color independent of
+being connected or not. The huddle is returned as a group.
+ at item @b{pull_rotate}, @ @ @i{value type}: direction
+Perform a reverse @samp{push_rotate} from this puzzle stone with the line
+of puzzle stone into the given direction.
+ at item @b{push_rotate}, @ @ @i{value type}: direction
+Perform a line rotation as described above from this puzzle stone with the line
+of puzzle stone into the given direction.
+
+ at end table
+
+ at item @b{Action:} none
+
+ at item @b{Variants:}
+
+ at table @asis
+ at item @b{st_puzzle}: color = @code{BLUE}
+ at item @b{st_puzzle_blue}: color = @code{BLUE}
+ at item @b{st_puzzle_yellow}: color = @code{YELLOW}
+ at end table
+
+ at end table
+
 @c ----------------- Rotator Stone -------------------- 
 @node st_rotator
 @subsection st_rotator
@@ -8849,9 +9130,8 @@
 single grid.
 
 An actor or a stone impulse hitting a shogun stack will push the smallest shogun 
-out of the stack. The upper and larger shogun stones can only be moved out of
-a stack by a @ref{ot_wire} impulse. But larger shoguns stones can never be 
-pushed over smaller ones.
+out of the stack. The upper and larger shogun stones can never be moved out of
+a stack and larger shoguns stones can never be pushed over smaller ones.
 
 @ref{it_shogun} are a special trigger type for shogun stones represented by 
 animated blue dots. They just react on shogun stacks positioned on top of the
@@ -9510,6 +9790,9 @@
 that are wired themselves to any of the fellows. Just the direct wired stones
 will move.
 
+But you can wire to stones just once. Any subsequent additional wire between
+two already wired stones will cut the old wire prior establishing the new one.
+
 You can request the wires connected to a stone by the stones @ref{wires} 
 attribute. As it is tedious to evaluate both anchors, every stone supports
 an attribute @ref{fellows} that reports the connected objects.
@@ -10926,6 +11209,7 @@
 * res.autotile::  Generate tiles from given template declarations
 * res.composer::  Compose tiles from given base tiles
 * res.maze::      Generate arbitrarly chaped mazes
+* res.puzzle::    Generate puzzle tiles and shuffle resulting puzzle clusters
 * res.random::    Choosing random tiles in a given distribution
 @end menu
 
@@ -11156,6 +11440,172 @@
 @subsection res.maze
 
 
+ at c ----------------- Puzzle Resolver -------------------- 
+
+ at node res.puzzle
+ at subsection res.puzzle
+
+The puzzle resolver helps you to reduce the number of required tile declarations
+for clusters of @ref{st_puzzle} stones. By usage of the @samp{cluster} attribute
+of @ref{st_puzzle} you can easily set clusters of fully connected stones. But
+for irregular, internally just partial connected puzzles you often need a bunch
+of similar tile declarations that differ just in the @samp{connections} attribute
+value. 
+
+ at example
+ti["B1"] = @{"st_puzzle_blue", cluster=1@} 
+ti["Ba"] = @{"st_puzzle_blue", connections="w"@} 
+ti["Bb"] = @{"st_puzzle_blue", connections="sw"@} 
+ti["Bd"] = @{"st_puzzle_blue", connections="ew"@} 
+ti["Bh"] = @{"st_puzzle_blue", connections="n"@} 
+ at end example
+
+Like @ref{res.autotile} this resolver offers autotiling. You just define one
+template tile and can use all connections variations
+
+ at example
+ti["B"] = @{"st_puzzle_blue"@} 
+ at end example
+
+Additonally this resolver registers every puzzle stone set and allows you to
+shuffle the puzzle clusters. You can even select shuffle algorithms and define
+accessible sides of a puzzle.
+
+ at table @asis
+ at item @b{Location:}
+This resolver is part of the library @samp{libpuzzle} as of release 3. You can
+use it by adding the following dependency to your level @ref{<compatibility>}
+declaration:
+ at example
+<el:dependency el:path="lib/libpuzzle" el:id="lib/libpuzzle" el:release="3" el:preload="true"/>
+ at end example
+
+ at item @b{Syntax:}
+
+ at b{res.puzzle}(@i{subresolver}, @i{rules})
+
+ at table @asis
+ at item @i{subresolver}
+Resolver to which unresolved requests should be forwarded. May be @samp{ti}
+as the final resolver of the resolver chain.
+ at item @i{rules} = @i{rule}, @i{rule},...
+One rule or as many as you like, all seperated by a comma.
+ at item @i{rule}
+The string of the template tile key that is the common tile key prefix for all
+autogenerated tile declarations.
+ at end table
+
+ at item @b{Syntax Samples:}
+ at example
+res.puzzle(ti, "B", "Y", "I", "M")
+ at end example
+
+ at item @b{Details:}
+The puzzle resolver assumes a tile key length of two or more characters. The
+given rules are prefix strings which need concat with a one character suffix
+to a standard tile key. Given a rule with a proper template rule you can use
+any of the following suffices without tile declaration:
+
+ at example
+    Suffix   Cluster Connections
+Solid Hollow 
+ '0'   '5'       0   autoconnect
+ '1'   '6'       1   autoconnect
+ '2'   '7'       2   autoconnect
+ '3'   '8'       3   autoconnect
+ '4'   '9'       4   autoconnect
+ ' '   '+'      nil    ""
+ 'a'   'A'      nil    "w"
+ 'b'   'B'      nil    "s"
+ 'c'   'C'      nil    "sw"
+ 'd'   'D'      nil    "e" 
+ 'e'   'E'      nil    "ew" 
+ 'f'   'F'      nil    "es" 
+ 'g'   'G'      nil    "esw" 
+ 'h'   'H'      nil    "n" 
+ 'i'   'I'      nil    "nw" 
+ 'j'   'J'      nil    "ns" 
+ 'k'   'K'      nil    "nsw" 
+ 'l'   'L'      nil    "ne" 
+ 'm'   'M'      nil    "new" 
+ 'n'   'N'      nil    "nes" 
+ 'o'   'O'      nil    "nesw" 
+ 'p'   'P'      10   autoconnect
+ 'q'   'Q'      11   autoconnect
+ 'r'   'R'      12   autoconnect
+ 's'   'S'      13   autoconnect
+ 't'   'T'      14   autoconnect
+ 'u'   'U'      15   autoconnect
+ 'v'   'V'      16   autoconnect
+ 'w'   'W'      17   autoconnect
+ 'x'   'X'      18   autoconnect
+ 'y'   'Y'      19   autoconnect
+ 'z'   'Z'      20   autoconnect
+ at end example
+
+All puzzle stones set by this resolver will be registered and shuffled by
+default with the @samp{intensity} of 3. You can define other intensity attribute
+values on any puzzle stone. The maximum intensity of all stones in a cluster
+will be taken. The intensity multiplied by the number of stones in a cluster
+describes the number of inverse pushes, called pulls, that will be performed
+during shuffling. Thus an intensity of 3 on a cluster of 6 stones will perform
+18 pulls. That means it is guaranteed that you can solve the puzzle with 18
+pushes. But as some pull operations may neutralize the user may be able to
+solve such a shuffled puzzle with less than 18 pushes.
+
+If you define no shuffle @samp{algorithm} it is assumed that the user can
+rotate the puzzle from any side and any @ref{st_puzzle}. The requested number
+of shuffling pull operations will be performed from random puzzle stones in a
+manner that gurantees that the user can solve the puzzle if he has free access
+to all sides.
+
+If you set the @samp{algorithm} on any of the puzzle stones to the value
+ at code{"marked"} the resolver registers that the user has no free access, but
+just from positions that you did mark. You do mark a position by setting
+the attribute @samp{"push_directions"} on a floor. All floors adajacent to
+outer puzzle stones from which a user can push rotate a puzzle will be checked
+for this attribute. If its string value, a substring of @code{"nesw"}, contains
+the character of the required push direction this push event will take part
+in the random reverse shuffling process.
+
+Note that hollow stones and their restriction of not being able to initiate a
+rotation if fully respected on shuffling.
+
+ at item @b{Full Example:}
+ at example
+ti["  "] = @{"fl-sahara"@}
+ti["##"] = @{"st-rock1"@}
+
+ti[".."] = @{"fl-sahara", push_directions="nesw"@}
+
+ti["B"] = @{"st_puzzle_blue"@} 
+ti["Y"] = @{"st_puzzle_yellow"@} 
+ti["I"] = @{"st_puzzle_blue", intensity=2/6@} 
+ti["M"] = @{"st_puzzle_blue", algorithm="marked", intensity=10@} 
+
+ti["xx"] = @{"#ac-blackball"@} ..ti(@{"it_magicwand"@})
+
+local resolver = res.puzzle(ti, "B", "Y", "I", "M")
+
+w, h = wo(resolver, "  ", @{
+"                                        ",
+"B1B1B1B1                                ",
+"B2B1BjB1                      Y1Y6Y1    ",
+"B2B2B2B2                      Y1Y1YC    ",
+"                                Y6YnY1  ",
+"                ##########      Y1Y1Y1  ",
+"                ##M1M1M1##              ",
+"  I1I1          ##M1McM1..              ",
+"  I6Ia          ..M1M1M1..      xx      ",
+"  I1I1            ....####              ",
+"                                        ",
+"                                        ",
+"                                        "
+@})
+ at end example
+ at end table
+
+
 @c ----------------- Random Resolver -------------------- 
 
 @node res.random
@@ -11724,7 +12174,7 @@
 * Floors::                      
 * Items::                       
 * Stones::                      
-* Actors::                      
+* Old Actors::                      
 * General object attributes::
 * The 1.0-Fire System::
 * Freeze Checking::
@@ -15476,8 +15926,8 @@
 
 
 @c ----------------------------------------------------------------------
- at node Actors
- at section Actors
+ at node Old Actors
+ at section Old Actors
 
 @menu
 * Actor Attributes::            Common attributes of actors



From ral at mail.berlios.de  Sat Sep 27 01:13:47 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 27 Sep 2008 01:13:47 +0200
Subject: [Enigma-game-svn] r1341 - trunk/src
Message-ID: <200809262313.m8QNDl5W014372@sheep.berlios.de>

Author: ral
Date: 2008-09-27 01:13:45 +0200 (Sat, 27 Sep 2008)
New Revision: 1341

Modified:
   trunk/src/Object.cc
   trunk/src/lua.cc
   trunk/src/lua.hh
   trunk/src/server.cc
Log:
Trunk 1.1:  new API 
- Lua callback: allow functions in '.' separated table-based "subdomains"
- Lua userdata methods: improve error handling - report errors on incidential
    usage of '.' instead of ':'
- remove api1 function Tick()


Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2008-09-26 17:58:37 UTC (rev 1340)
+++ trunk/src/Object.cc	2008-09-26 23:13:45 UTC (rev 1341)
@@ -307,10 +307,10 @@
             
             ObjectList ol = (*tit).getObjectList(this);  // get all or nearest objects described by target token
             if (ol.size() == 0 || (ol.size() == 1 && ol.front() == NULL)) {  // no target object
-                if ((action == "callback" || action == "") && (tit->getType() == Value::STRING) 
-                        && lua::IsFunc(lua::LevelState(), tit->get_string())) {
+                if ((action == "callback" || action.empty()) && (tit->getType() == Value::STRING)) { 
+//                        && lua::IsFunc(lua::LevelState(), tit->get_string())) {
                     // it is an existing callback function
-                    if (lua::CallFunc(lua::LevelState(), tit->get_string(), messageValue, this) != lua::NO_LUAERROR) {
+                    if (lua::CallFunc(lua::LevelState(), tit->get_string(), messageValue, this, !action.empty()) != lua::NO_LUAERROR) {
                         throw XLevelRuntime(std::string("callback '") + tit->get_string() + "' failed:\n"+lua::LastError(lua::LevelState()));
                     }
                 }

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-09-26 17:58:37 UTC (rev 1340)
+++ trunk/src/lua.cc	2008-09-26 23:13:45 UTC (rev 1341)
@@ -1074,6 +1074,10 @@
 
 static int gridAlignPosition(lua_State *L) {
     // position guaranteed
+    if (lua_gettop(L) < 1 || !is_position(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     lua_getmetatable(L, 1);
     lua_rawgeti(L, -1, 1);
     lua_rawgeti(L, -2, 2);
@@ -1087,6 +1091,10 @@
 
 static int existsPosition(lua_State *L) {
     // position guaranteed
+    if (lua_gettop(L) < 1 || !is_position(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     lua_getmetatable(L, -1);
     lua_rawgeti(L, -1, 1);
     lua_rawgeti(L, -2, 2);
@@ -1158,6 +1166,10 @@
 
 static int setAttributes(lua_State *L) {
     // 
+    if (lua_gettop(L) < 1 || !is_object(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     Object *obj = to_object(L, 1);
     lua_rawgeti(L, -1, 1);  // check if any unnamed attribute exists
     if (!lua_isnil(L, -1)) {
@@ -1219,17 +1231,17 @@
     return 1;
 }
 static int getFloor(lua_State *L) {
-    // position|table|obj|(num,num)|group
+    // optional world, position|table|obj|(num,num)|group
     return getStoneItemFloor(L, Object::FLOOR);
 }
 
 static int getItem(lua_State *L) {
-    // position|table|obj|(num,num)|group
+    // optional world, position|table|obj|(num,num)|group
     return getStoneItemFloor(L, Object::ITEM);
 }
 
 static int getStone(lua_State *L) {
-    // position|table|obj|(num,num)|group
+    // optional world, position|table|obj|(num,num)|group
     return getStoneItemFloor(L, Object::STONE);
 }
 
@@ -1262,6 +1274,10 @@
 }
 
 static int killObject(lua_State *L) {
+    if (lua_gettop(L) < 1 || !(is_object(L, 1) || is_group(L, 1))) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     if (lua_gettop(L) != 1) {
          throwLuaError(L, "Kill of object allows no arguments");
          return 0;
@@ -1282,6 +1298,10 @@
 
 static int xyObject(lua_State *L) {
     // object guaranteed
+    if (lua_gettop(L) < 1 || !is_object(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     Object *obj = to_object(L,1);
     GridPos  p;
     if (GridObject *gobj = dynamic_cast<GridObject*>(obj)) {
@@ -1307,6 +1327,10 @@
 
 static int objectExistance(lua_State *L) { 
     // object type is guaranteed
+    if (lua_gettop(L) < 1 || !is_object(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     Object * obj = to_object(L, 1);
     lua_pushboolean(L, (obj != NULL));
     return 1;
@@ -1314,6 +1338,10 @@
 
 static int objectGetKind(lua_State *L) { 
     // object type is guaranteed
+    if (lua_gettop(L) < 1 || !is_object(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     Object * obj = to_object(L, 1);
     lua_pushstring(L, (obj != NULL) ? obj->getKind().c_str() : "");
     return 1;
@@ -1321,6 +1349,10 @@
 
 static int objectIsKind(lua_State *L) { 
     // object type is guaranteed
+    if (lua_gettop(L) < 1 || !is_object(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     Object * obj = to_object(L, 1);
     if (!lua_isstring(L, 2)) {
         throwLuaError(L,"Illegal kind - no string");
@@ -1362,6 +1394,10 @@
 }
 
 static int objectMessage(lua_State *L) {
+    if (lua_gettop(L) < 1 || !is_object(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     if (lua_gettop(L) < 2) {
         throwLuaError (L, "Message missing");
         return 0;
@@ -1372,6 +1408,10 @@
 }
 
 static int groupMessage(lua_State *L) {
+    if (lua_gettop(L) < 1 || !is_group(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     if (lua_gettop(L) < 2) {
         throwLuaError (L, "Message missing");
         return 0;
@@ -1611,6 +1651,10 @@
 
 static int xyPosition(lua_State *L) {
     // position guaranteed
+    if (lua_gettop(L) < 1 || !is_position(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     lua_getmetatable(L, 1);            
     lua_rawgeti(L, -1, 1);
     lua_rawgeti(L, -2, 2);
@@ -2297,6 +2341,10 @@
 
 static int addOther(lua_State *L) {
     // world, table | tile
+    if (lua_gettop(L) < 1 || !is_world(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     if (is_tile(L, 2)  || is_table(L, 2)) {
         if (is_table(L, -1))
             setObjectByTable(L, -1, -1);
@@ -2310,6 +2358,10 @@
     // world, {table}  -- table with 1=(group|obj|name), [2=(group|obj|name], 
     //                               min=[number], max=[number], circular=true, linear=true
     //                               log=("solution"|"count"|"all") 
+    if (lua_gettop(L) < 1 || !is_world(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     OxydStone::LogType logFlag = OxydStone::NOTHING;
     for (int i = 2; i <= lua_gettop(L); i++) {
         if (!is_table(L, i)) {
@@ -2501,9 +2553,9 @@
 
 static int tileDeclaration(lua_State *L) {
     // tile
-    if (lua_gettop(L) != 1) {
-        throwLuaError(L, "Tile declaration with illegal arguments");
-        return 0;
+    if (lua_gettop(L) != 1 || !is_tile(L, 1)) {
+        throwLuaError(L, "Tile declaration with illegal arguments: possible syntax error - usage of '.' instead of ':'");
+        return 0;        
     }
     lua_newtable(L); // the result
     tileDeclForTile(L, true);
@@ -2706,6 +2758,10 @@
 
 static int shuffleGroup(lua_State *L) {
     // group
+    if (lua_gettop(L) < 1 || !is_group(L, 1)) {
+        throwLuaError(L, "Syntax error - usage of '.' instead of ':'");
+        return 0;        
+    }
     ObjectList oldSort = toObjectList(L, 1);
     ObjectList newSort;
     std::vector<Object *> shuffleVector;
@@ -3019,29 +3075,54 @@
     return result;
 }
 
-Error CallFunc(lua_State *L, const char *funcname, const Value& arg, Object *obj) {
+Error CallFunc(lua_State *L, const std::string funcpath, const Value& arg, Object *obj, bool expectFunction) {
     int retval;
-    lua_getglobal(L, funcname);
-    push_value(L, arg);
-    pushobject(L, obj);
-    retval=lua_pcall(L,2,0,0);
-    if (retval!=0) // error
-    {
-        lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
+    const char *funcname = funcpath.c_str();
+    
+    if (funcpath.find('.')) {
+        std::list<std::string> nodes;
+        ecl::split_copy(funcpath, '.', std::back_inserter(nodes));
+        for (std::list<std::string>::iterator itr = nodes.begin(); itr != nodes.end();) {
+            if (itr == nodes.begin()) {
+                lua_getglobal(L, (*itr).c_str());
+            } else {
+                lua_getfield(L, -1, (*itr).c_str());
+                lua_remove(L, -2);
+            }
+            ++itr;
+            if (itr != nodes.end() && !lua_istable(L, -1)) {
+                if (expectFunction) {
+                    lua_pushstring(L, ecl::strf("Super domain of '%s' is not a table!", (*itr).c_str()).c_str());
+                    lua_setglobal(L, "_LASTERROR");
+                    return ERRRUN;
+                } else {
+                    lua_pop(L, 1);
+                    return NO_LUAERROR;
+                }
+            }
+        }
+    } else {
+        lua_getglobal(L, funcname);
     }
-    return _lua_err_code(retval);
-}
-
-Error CallFunc(lua_State *L, const char *funcname, const ByteVec& arg) {
-  int retval;
-    lua_getglobal(L, funcname);
-    lua_pushlstring (L, &arg[0], arg.size());
-    retval=lua_pcall(L,1,0,0);
-    if (retval!=0) // error
-    {
-        lua_setglobal (L, "_LASTERROR") ; //Set _LASTERROR to returned error message
+    
+    if (lua_isfunction(L, -1)) {
+        push_value(L, arg);
+        pushobject(L, obj);
+        retval = lua_pcall(L, 2, 0, 0);
+        if (retval != 0)  {  // error
+            lua_setglobal(L, "_LASTERROR") ; //Set _LASTERROR to returned error message
+        }
+        return _lua_err_code(retval);
+    } else {
+        if (expectFunction) {
+            lua_pushstring(L, "No function of given name exists.");
+            lua_setglobal(L, "_LASTERROR");
+            return ERRRUN;
+        } else {
+            lua_pop(L, 1);
+            return NO_LUAERROR;
+        }
     }
-    return _lua_err_code(retval);
 }
 
 std::string NewMessageName(lua_State *L, const Object *obj, const std::string &message) {

Modified: trunk/src/lua.hh
===================================================================
--- trunk/src/lua.hh	2008-09-26 17:58:37 UTC (rev 1340)
+++ trunk/src/lua.hh	2008-09-26 23:13:45 UTC (rev 1341)
@@ -91,11 +91,7 @@
     
     /*! Call a Lua function with one argument.  This is mainly used
       for callbacks during the game. */
-    Error CallFunc(lua_State *L, const char *funcname, const enigma::Value& arg, Object *obj);
-
-    /*! Call a Lua function with a (large) byte vector as the sole
-      argument.  Currently only used for loading XML levels. */
-    Error CallFunc (lua_State *L, const char *funcname, const ByteVec &arg);
+    Error CallFunc(lua_State *L, std::string funcpath, const enigma::Value& arg, Object *obj, bool expectFunction = true);
     
     std::string NewMessageName(lua_State *L, const Object *obj, const std::string &message);
     

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2008-09-26 17:58:37 UTC (rev 1340)
+++ trunk/src/server.cc	2008-09-26 23:13:45 UTC (rev 1341)
@@ -205,10 +205,10 @@
     player::Tick (time_accu);
     for (;time_accu >= timestep; time_accu -= timestep) {
         WorldTick (timestep);
-        if (lua::CallFunc (lua::LevelState(), "Tick", timestep, NULL) != 0) {
-            throw XLevelRuntime (string("Calling 'Tick' failed:\n")
-                                                + lua::LastError(lua::LevelState()));
-        }
+//        if (lua::CallFunc (lua::LevelState(), "Tick", timestep, NULL) != 0) {
+//            throw XLevelRuntime (string("Calling 'Tick' failed:\n")
+//                                                + lua::LastError(lua::LevelState()));
+//        }
     }
     TickFinished ();
 }



From andreasl at mail.berlios.de  Mon Sep 29 00:00:07 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Mon, 29 Sep 2008 00:00:07 +0200
Subject: [Enigma-game-svn] r1343 - in homepage/input: . articles
Message-ID: <200809282200.m8SM07Yb010377@sheep.berlios.de>

Author: andreasl
Date: 2008-09-28 23:59:58 +0200 (Sun, 28 Sep 2008)
New Revision: 1343

Added:
   homepage/input/articles/marbleous_2.html
   homepage/input/articles/marbleous_2_de.html
Modified:
   homepage/input/articles/infobox_marbleous.html
   homepage/input/articles/infobox_marbleous_de.html
   homepage/input/articles/infobox_marbleous_ru.html
   homepage/input/hp_archive.html
   homepage/input/hp_archive_de.html
   homepage/input/hp_archive_ru.html
   homepage/input/infobox.html
   homepage/input/infobox_de.html
   homepage/input/infobox_ru.html
   homepage/input/output-files.lua
Log:
Homepage:
 - Part 2 of "Marbleous!" (English, German)
Todo:
 - Russian translation (marbleous_2, infobox, infobox_marbleous)
 - English proofread
 - Validation
Note:
 - Upload together with new statistics.


Modified: homepage/input/articles/infobox_marbleous.html
===================================================================
--- homepage/input/articles/infobox_marbleous.html	2008-09-27 19:12:39 UTC (rev 1342)
+++ homepage/input/articles/infobox_marbleous.html	2008-09-28 21:59:58 UTC (rev 1343)
@@ -3,5 +3,7 @@
          <h2>Marbleous!</h2>
          <h3>The Novice</h3>
          <a href="$$marbleous_1$$">Part 1: <br>&quot;We welcome you&quot;</a>
+         <br><br>
+         <a href="$$marbleous_2$$">Part 2: <br>&quot;Easy?&quot; &mdash; Dragging the Boxes</a>
        </div>
     </div>

Modified: homepage/input/articles/infobox_marbleous_de.html
===================================================================
--- homepage/input/articles/infobox_marbleous_de.html	2008-09-27 19:12:39 UTC (rev 1342)
+++ homepage/input/articles/infobox_marbleous_de.html	2008-09-28 21:59:58 UTC (rev 1343)
@@ -3,5 +3,7 @@
          <h2>Gemurmel!</h2>
          <h3>Der Neuling</h3>
          <a href="$$marbleous_1$$">Teil 1: <br>&quot;You are welcome&quot;</a>
+         <br><br>
+         <a href="$$marbleous_2$$">Teil 2: <br>&quot;Easy?&quot; &mdash; Vom Kistenschleppen</a>
        </div>
     </div>

Modified: homepage/input/articles/infobox_marbleous_ru.html
===================================================================
--- homepage/input/articles/infobox_marbleous_ru.html	2008-09-27 19:12:39 UTC (rev 1342)
+++ homepage/input/articles/infobox_marbleous_ru.html	2008-09-28 21:59:58 UTC (rev 1343)
@@ -3,5 +3,7 @@
          <h2>???????????!</h2>
          <h3>???????? ?? ???????</h3>
          <a href="$$marbleous_1$$">????? 1: <br>&quot;????? ??????????&quot;</a>
+         <br><br>
+         <a href="$$marbleous_2$$">????? 2: <br>&quot;Easy?&quot; &mdash; Dragging the Boxes</a>
        </div>
     </div>

Added: homepage/input/articles/marbleous_2.html
===================================================================
--- homepage/input/articles/marbleous_2.html	2008-09-27 19:12:39 UTC (rev 1342)
+++ homepage/input/articles/marbleous_2.html	2008-09-28 21:59:58 UTC (rev 1343)
@@ -0,0 +1,30 @@
+
+<h2>Marbleous!</h2>
+
+<h3>The Novice &mdash; &quot;Easy?&quot; &mdash; Dragging the Boxes</h3>
+
+<p>
+Walking through the Tutorial, our novice is confronted with probable, exemplary
+&quot;scenarios&quot;:<br>
+For exmaple with water!<br>
+How do I get to the other site &mdsh; and he sees those wooden boxes,
+&quot;st_wood&quot; &mdash; this stone is one of the most fundamental in
+Enigma: Movable, onto-something-movable, away-from-something-movable, building
+&quot;bridges&quot; in water and abyss, combinable &mdash; thus its immense
+spread across all of Enigma's levels: In sokoban-like games, puzzle-games,
+landscapes. And the player asks himself quite often, e.g. in
+&quot;Waterworld&quot;, how many &quot;st_woods&quot; have to be placed
+correctly to get nearer to the solution: push here, push there, but push
+correctly!<br>
+And then our novice starts the level &quot;Easy?&quot;. Like within a nightmare
+he thinks about these &quot;fascinating&quot; logical exercises of intelligence
+tests, &quot;which everyone is freightening of &mdash; confess it!&quot;
+&mdash; and he thinks by himself: Oh dear &mdash; where shall all those boxes
+go? And he starts to work out some approaches to the solution &mdash; yes, it
+really is &quot;dragging the boxes&quot;! Easy? Made it &mdash; yes, this is
+Enigma!
+</p>
+
+<p><i>
+Mecke
+</i></p>

Added: homepage/input/articles/marbleous_2_de.html
===================================================================
--- homepage/input/articles/marbleous_2_de.html	2008-09-27 19:12:39 UTC (rev 1342)
+++ homepage/input/articles/marbleous_2_de.html	2008-09-28 21:59:58 UTC (rev 1343)
@@ -0,0 +1,30 @@
+
+<h2>Gemurmel!</h2>
+
+<h3>Der Neuling &mdash; &quot;Easy?&quot; &mdash; Vom Kistenschleppen</h3>
+
+<p>
+Beim Gang durch das Tutorial wird unser Neuling mit m&ouml;glichen, beispielhaften
+&quot;Szenarien&quot; konfrontiert:<br>
+Zum Beispiel mit Wasser!<br>
+Wie komme ich auf die andere Seite - und er sieht diese Holzkl&ouml;tze,
+&quot;st_wood&quot; - dieser Stein ist einer der wesentlichen in Enigma:
+Verschiebbar, auf etwas draufschiebbar, wegschiebbar, in Wasser und Abgrund
+&quot;Br&uuml;cken bauend&quot;, kombinierbar -
+Daher seine gro&szlig;e Verbreitung in Enigma-Leveln:
+In den Sokoban-Spielen, Puzzle-Spielen, Landschaften.
+Und der Spieler fragt sich oft, wie z.B. in &quot;Waterworld&quot;, wieviele
+&quot;st_woods&quot; richtig zu platzieren sind, um der L&ouml;sung n&auml;her
+zu kommen: Hinschieben - wegschieben, aber richtig!<br>
+Und dann startet unser Neuling den Level &quot;Easy?&quot;.
+Alptraumartig denkt er an diese &quot;faszinierenden&quot; Logik-Aufgaben von
+Intelligenz-Tests, &quot;vor denen doch jeder ein wenig Angst hat - 
+gib's zu!&quot; - und denkt sich: Oje - wo sollen die Kisten hin?
+Und er beginnt, sich L&ouml;sungswege zu erarbeiten - doch
+&quot;Kistenschleppen&quot;! Easy? Geschafft - Ja, das ist Enigma!
+</p>
+
+<p><i>
+Mecke
+</i></p>
+

Modified: homepage/input/hp_archive.html
===================================================================
--- homepage/input/hp_archive.html	2008-09-27 19:12:39 UTC (rev 1342)
+++ homepage/input/hp_archive.html	2008-09-28 21:59:58 UTC (rev 1343)
@@ -26,6 +26,8 @@
   </li>
   <li><a href="$$marbleous_1$$">Marbleous! &mdash; The Novice, Part 1</a>
   </li>
+  <li><a href="$$marbleous_2$$">Marbleous! &mdash; The Novice, Part 2</a>
+  </li>
 </ul>
 
 

Modified: homepage/input/hp_archive_de.html
===================================================================
--- homepage/input/hp_archive_de.html	2008-09-27 19:12:39 UTC (rev 1342)
+++ homepage/input/hp_archive_de.html	2008-09-28 21:59:58 UTC (rev 1343)
@@ -26,5 +26,7 @@
   </li>
   <li><a href="$$marbleous_1$$">Gemurmel! &mdash; Der Neuling, Teil 1</a>
   </li>
+  <li><a href="$$marbleous_2$$">Gemurmel! &mdash; Der Neuling, Teil 2</a>
+  </li>
 </ul>
 

Modified: homepage/input/hp_archive_ru.html
===================================================================
--- homepage/input/hp_archive_ru.html	2008-09-27 19:12:39 UTC (rev 1342)
+++ homepage/input/hp_archive_ru.html	2008-09-28 21:59:58 UTC (rev 1343)
@@ -25,4 +25,6 @@
   </li>
   <li><a href="$$marbleous_1$$">???????????! &mdash; ???????? ?? ???????, ????? 1</a>
   </li>
+  <li><a href="$$marbleous_2$$">???????????! &mdash; ???????? ?? ???????, ????? 2</a>
+  </li>
 </ul>

Modified: homepage/input/infobox.html
===================================================================
--- homepage/input/infobox.html	2008-09-27 19:12:39 UTC (rev 1342)
+++ homepage/input/infobox.html	2008-09-28 21:59:58 UTC (rev 1343)
@@ -1,10 +1,8 @@
     <div class="infobody">
        <div class="info">
          <h3>Marbleous!</h3>
-         With this we present a new column on our homepage, starting with
-         Mecke's series &quot;The Novice&quot;! Read <a
-         href="$$marbleous_1$$">here</a> about his first adventures,
-         his experiences and thoughts as &quot;novice&quot;.
+         Read <a href="$$marbleous_2$$">here</a> about the newest adventure of
+         our &quot;novice&quot;, his experiences and thoughts!
 
          <h3>Level of the Month</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"

Modified: homepage/input/infobox_de.html
===================================================================
--- homepage/input/infobox_de.html	2008-09-27 19:12:39 UTC (rev 1342)
+++ homepage/input/infobox_de.html	2008-09-28 21:59:58 UTC (rev 1343)
@@ -1,10 +1,8 @@
     <div class="infobody">
        <div class="info">
          <h3>Gemurmel!</h3>
-         Eine neue Kolumne er&ouml;ffnen wir hiermit auf unserer Homepage,
-         beginnend mit Mecke's Reihe &quot;Der Neuling&quot;! Lesen Sie <a
-         href="$$marbleous_1$$">hier</a> &uuml;ber sein erstes Abenteuer,
-         seine Erfahrungen und Gedanken als &quot;Neuling&quot;.
+         Lesen Sie <a href="$$marbleous_2$$">hier</a> &uuml;ber das neueste
+         Abenteuer unseres &quot;Neulings&quot;, seine Erfahrungen und Gedanken!
          
          <h3>Level des Monats</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"

Modified: homepage/input/infobox_ru.html
===================================================================
--- homepage/input/infobox_ru.html	2008-09-27 19:12:39 UTC (rev 1342)
+++ homepage/input/infobox_ru.html	2008-09-28 21:59:58 UTC (rev 1343)
@@ -1,10 +1,8 @@
     <div class="infobody">
        <div class="info">
          <h3>???????????!</h3>
-         ? ????? ??????? ?? ????? ???????? ???????? ????? ???????, ??????? ????????? ????? ??????
-         Mecke &mdash; &quot;???????? ?? ???????&quot;! <a
-         href="$$marbleous_1$$">?????</a> ?? ?????? ???????? ? ??? ?????? ???????????, ?????
-	  ? ????????????, ????? ?? ??? &quot;????????&quot;.
+         Read <a href="$$marbleous_2$$">here</a> about the newest adventure of
+         our &quot;novice&quot;, his experiences and thoughts!
 
          <h3>??????? ??????</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"

Modified: homepage/input/output-files.lua
===================================================================
--- homepage/input/output-files.lua	2008-09-27 19:12:39 UTC (rev 1342)
+++ homepage/input/output-files.lua	2008-09-28 21:59:58 UTC (rev 1343)
@@ -533,6 +533,15 @@
     body = {"articles/marbleous_1"},
 }
 
+html.marbleous_2 = {
+    outfile = "marbleous_2.html",
+    title = "Marbleous! &mdash; The Novice, Part 2",
+    title_de = "Gemurmel! &mdash; Der Neuling, Teil 2",
+    title_ru = "???????????! &mdash; ???????? ?? ???????, ????? 2",
+    rightcolumn = {"articles/infobox_marbleous"},
+    body = {"articles/marbleous_2"},
+}
+
 ----------------------------------------------------------------------
 -- Independent Level Articles
 ----------------------------------------------------------------------



From ral at mail.berlios.de  Mon Sep 29 19:55:44 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 29 Sep 2008 19:55:44 +0200
Subject: [Enigma-game-svn] r1344 - in trunk: data data/levels/lib
	data/schemas src/items
Message-ID: <200809291755.m8THtiha027250@sheep.berlios.de>

Author: ral
Date: 2008-09-29 19:55:43 +0200 (Mon, 29 Sep 2008)
New Revision: 1344

Modified:
   trunk/data/api1init.lua
   trunk/data/levels/lib/ralf_pento.xml
   trunk/data/schemas/objects.xml
   trunk/src/items/Meditation.cc
   trunk/src/items/Meditation.hh
   trunk/src/items/SeedItem.cc
Log:
Trunk 1.1:  new API 
- fix typo in meditation old API mapping - message "trigger"
- fix seed attribute "flavor" set
- add meditation attributes "friction" and "adhesion"
- fix lib ralf_pento: renamed user attribute "pento"

Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-09-28 21:59:58 UTC (rev 1343)
+++ trunk/data/api1init.lua	2008-09-29 17:55:43 UTC (rev 1344)
@@ -746,7 +746,7 @@
     ["it-burnable_ash__trigger"] = "ignite",
     ["it-burnable_oil__trigger"] = "ignite",
     it_magnet__onoff = "toggle",
-    it_medidation__trigger = "flip",
+    it_meditation__trigger = "flip",
     it_vortex__openclose = "toggle",
     it_vortex__trigger = "toggle",
     it_wormhole__onoff = "toggle",

Modified: trunk/data/levels/lib/ralf_pento.xml
===================================================================
--- trunk/data/levels/lib/ralf_pento.xml	2008-09-28 21:59:58 UTC (rev 1343)
+++ trunk/data/levels/lib/ralf_pento.xml	2008-09-29 17:55:43 UTC (rev 1344)
@@ -333,7 +333,7 @@
       if (state[i]==1) then
          local pos = area[i];
          local st = enigma.GetStone(pos.x,pos.y)
-         set_attrib(st, "pento", "p"..id)
+         set_attrib(st, "_pento", "p"..id)
       end
    end
 end
@@ -442,7 +442,7 @@
 function hammer(x,y)
    local st = enigma.GetStone(x,y)
    if ((st ~= nil) and (enigma.GetKind(st)=="st-puzzle")) then
-      local name = get_attrib(st,"pento")
+      local name = get_attrib(st,"_pento")
       if ((name ~= nil) and (strsub(name,1,1)=="p")) then
          local id = tonumber(strsub(name,2))
          if (id ~= nil) then
@@ -460,7 +460,7 @@
                for y=ymin,ymax do
                   st = enigma.GetStone(x,y)
                   if ((st ~= nil) and (enigma.GetKind(st)=="st-puzzle")) then
-                     local name2 = get_attrib(st,"pento")
+                     local name2 = get_attrib(st,"_pento")
                      if (name2==name) then
                         kill_stone(x,y)
                         set_item("it-explosion1",x,y)

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-09-28 21:59:58 UTC (rev 1343)
+++ trunk/data/schemas/objects.xml	2008-09-29 17:55:43 UTC (rev 1344)
@@ -229,6 +229,8 @@
     <object name="it_meditation">
       <attr name="state" min="-3" max="3" default="-2"/>
       <attr name="essential" max="1"/>
+      <attr name="friction"/>
+      <attr name="adhesion"/>
       <msg name="flip"/>
       <msg name="shovel"/>
       <msg name="signal"/>

Modified: trunk/src/items/Meditation.cc
===================================================================
--- trunk/src/items/Meditation.cc	2008-09-28 21:59:58 UTC (rev 1343)
+++ trunk/src/items/Meditation.cc	2008-09-29 17:55:43 UTC (rev 1344)
@@ -180,6 +180,22 @@
                 * 90 * server::HoleForce * v; // get the force
     }
     
+    double Meditation::getFriction(ecl::V2 pos, double defaultFriction, Actor *a) {
+        Value v = getAttr("friction");
+        if (v && covers_floor(pos, a))
+            return v;
+        else
+            return defaultFriction;
+    }
+    
+    ecl::V2 Meditation::calcMouseforce(Actor *a, ecl::V2 mouseForce, ecl::V2 floorForce) {
+        Value v = getAttr("adhesion");
+        if (v && covers_floor(a->get_pos(), a))
+            return mouseForce * (double)v ;
+        else
+            return floorForce;        
+    }
+        
     bool Meditation::isMeditating(Actor *a) {
         double dist = ecl::length(a->get_pos() - get_pos().center());
         return dist < 0.24 || ((state <= HOLLOW || state >= HILL) && dist < 0.4) ;

Modified: trunk/src/items/Meditation.hh
===================================================================
--- trunk/src/items/Meditation.hh	2008-09-28 21:59:58 UTC (rev 1343)
+++ trunk/src/items/Meditation.hh	2008-09-29 17:55:43 UTC (rev 1344)
@@ -66,6 +66,8 @@
         virtual void on_stonehit(Stone *st);
         virtual bool actor_hit(Actor *a);
         virtual void add_force(Actor *a, ecl::V2 &f);
+        virtual double getFriction(ecl::V2 pos, double defaultFriction, Actor *a);
+        virtual ecl::V2 calcMouseforce(Actor *a, ecl::V2 mouseForce, ecl::V2 floorForce);
         
     private:
         // Variables.

Modified: trunk/src/items/SeedItem.cc
===================================================================
--- trunk/src/items/SeedItem.cc	2008-09-28 21:59:58 UTC (rev 1343)
+++ trunk/src/items/SeedItem.cc	2008-09-29 17:55:43 UTC (rev 1344)
@@ -44,6 +44,7 @@
             else
                 ASSERT(false, XLevelRuntime, ecl::strf("Seed: illegal flavor value #s", flavor.c_str()).c_str());
                 
+            objFlags = (objFlags & ~OBJBIT_FLAVOR) | (code << 24);
             if (isDisplayable()) {
                 init_model();
             }



From ral at mail.berlios.de  Tue Sep 30 00:13:40 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Tue, 30 Sep 2008 00:13:40 +0200
Subject: [Enigma-game-svn] r1345 - team_levelpacks/team_test_new_api
Message-ID: <200809292213.m8TMDe28018460@sheep.berlios.de>

Author: ral
Date: 2008-09-30 00:13:33 +0200 (Tue, 30 Sep 2008)
New Revision: 1345

Added:
   team_levelpacks/team_test_new_api/ralT071_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT037_1.xml
   team_levelpacks/team_test_new_api/ralT063_1.xml
Log:
Test Level new API:
- test levels extended for r1339, 1341 features
- test level added for upcomming stoneimpulse reengineering


Modified: team_levelpacks/team_test_new_api/ralT037_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT037_1.xml	2008-09-29 17:55:43 UTC (rev 1344)
+++ team_levelpacks/team_test_new_api/ralT037_1.xml	2008-09-29 22:13:33 UTC (rev 1345)
@@ -23,12 +23,20 @@
 ti["s"] = {"st_shogun", "him"}
 ti["w"] = {"st-wood", "you"}
 ti["r"] = {"it_rubberband", anchor2="you", length=4}
-ti["S"] = {"st_switch", target="killwood"}
+ti["S"] = {"st_switch", target="privat.callbacks.killwood"}
+ti["X"] = {"st_scissors"}
 ti["T"] = {"st_turnstile"}
 ti["t"] = {"st_turnstilearm_n","it"}
 ti["R"] = {"it_rubberband", anchor2="it", length=4}
 ti["p"] = {"st_swap", "you"}
 ti["m"] = {"it_magnet_on", strength=-40}
+ti["b"] = {"st_brake"}
+ti["B"] = ti["~"] .. ti["b"]
+ti["."] = {"it-springboard"}
+ti["|"] = {"it-spring1"}
+ti[";"] = {"it-spring2"}
+
+
 ti["1"] = {"#ac-blackball", "me"}
 ti["2"] = {"#ac-whiteball"}
 
@@ -39,18 +47,21 @@
 "                    ",
 "     m  ~  2        ",
 "                    ",
-"     S pw  s        ",
+"       pw  s        ",
+"     S              ",
+"        r  1       X",
 "                    ",
-"        r  1        ",
+"  b  |  ;   .  B    ",
 "                    ",
-"        m           ",
-"                    ",
 "                    "
 })
 
 enigma.AddRubberBand(no["me"], no["him"], 5, 4)
 
-function killwood()
+privat = {}
+privat.callbacks = {}
+
+function privat.callbacks.killwood()
     no["you"]:kill()
 end
 

Modified: team_levelpacks/team_test_new_api/ralT063_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT063_1.xml	2008-09-29 17:55:43 UTC (rev 1344)
+++ team_levelpacks/team_test_new_api/ralT063_1.xml	2008-09-29 22:13:33 UTC (rev 1345)
@@ -56,7 +56,10 @@
 ti["m"] = {"st_puzzle_blue", "puz4", connections="s"}
 ti["v"] = {"st-wood", "wood3"}
 
+ti["N"] = {"st_puzzle_blue", "puz5", connections="n"}
+ti["M"] = {"st_puzzle_blue", "puz6", connections="s"}
 
+
 ti["l"] = {"st_laser_w", state = ON}
 ti["L"] = {"st_laser_n", state = ON}
 ti["e"] = {"st_laser_e", state = ON}
@@ -65,6 +68,9 @@
 ti["."] = {"st-stoneimpulse_movable"}
 ti["*"] = {"it-cherry"}
 
+ti["x"] = {"st-wood", "wood4"}
+ti["X"] = {"st-wood", "wood5"}
+
 ti["@"] = {"#ac-blackball"}  ..ti({"it_magicwand"})
 
 w, h = wo(ti, " ", {
@@ -96,14 +102,14 @@
 "             ~~~~                      ",
 "       v                               ",
 "  ~~                                   ",
-"  ~~  m                                ",
-"  ~~  n                                ",
-"  ~~                                   ",
+"  ~~  m        M                       ",
+"  ~~  n        1                       ",
+"  ~~           1                       ",
+"   ~  x        N                       ",
 "   ~                                   ",
-"   ~                                   ",
+"      X                                ",
 "                                       ",
 "                                       ",
-"                                       ",
 "                                       "
 })
 
@@ -112,7 +118,11 @@
 wo:add({"ot_wire", anchor1="puz2", anchor2="wood2"})
 wo:add({"ot_wire", anchor1="puz3", anchor2="wood3"})
 wo:add({"ot_wire", anchor1="puz4", anchor2="wood3"})
+wo:add({"ot_wire", anchor1="puz5", anchor2="puz6"})
 
+wo:add({"ot_wire", anchor1="wood4", anchor2="wood5"})
+wo:add({"ot_wire", anchor1="wood4", anchor2="wood5"})
+
   ]]></el:luamain>
     <el:i18n>
 	 <el:string el:key="title">

Added: team_levelpacks/team_test_new_api/ralT071_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT071_1.xml	2008-09-29 17:55:43 UTC (rev 1344)
+++ team_levelpacks/team_test_new_api/ralT071_1.xml	2008-09-29 22:13:33 UTC (rev 1345)
@@ -0,0 +1,93 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test StoneImpulse new API" el:subtitle="" el:id="20080928ral709"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+
+ti[";"] = {"st_stoneimpulse"}
+ti["*"] = {"st_stoneimpulse_steady"}
+ti["^"] = {"st_stoneimpulse_hollow"}
+ti["."] = {"st_stoneimpulse_movable"}
+ti[">"] = {"st_stoneimpulse_new", orientation = EAST, hollow = true}
+
+ti["m"] = {"it_magicwand"}
+ti["w"] = {"st-wood"}
+ti["s"] = {"st_swap"}
+ti["p"] = {"st_polarswitch"}
+ti["n"] = {"st_laser_n",state=ON}
+ti["r"] = {"st_boulder_w"}
+
+ti["W"] = {"st-wood", "w1"}
+ti["V"] = {"st-wood", "w2"}
+ti["U"] = {"st-wood", "w3"}
+
+ti["a"] = {"st_stoneimpulse_hollow", "a1"}
+ti["A"] = {"st_stoneimpulse_hollow", "a2"}
+ti["b"] = {"st_stoneimpulse_hollow", "b1"}
+ti["B"] = {"st_stoneimpulse_hollow", "b2"}
+
+ti[":"] = {"st_stoneimpulse", "s1"}
+ti["-"] = {"st_stoneimpulse_movable","s2"}
+ti["1"] = {"st_stoneimpulse", "s3"}
+ti["2"] = {"st_stoneimpulse", "s4"}
+
+
+ti["@"] = {"#ac-blackball"} 
+
+w, h = wo(ti, " ", {
+"                    ",
+"                    ",
+";   ;   .   *   ^  ;",
+";                  ;",
+";r                 ;",
+";  ;   V   -    ;  ;",
+"   ;            ^  ;",
+"   ;            ^   ",
+"                    ",
+"   ;;;;             ",
+"   ;;;;    W   :    ",
+"   ;;;;             ",
+"                    ",
+"  1  2         .    ",
+"  ;  ;              ",
+"        @m     pp   ",
+" ^^>^^         nn   ",
+" ^   ^              ",
+" ^^^^^    *     ;   ",
+"          *     ;   ",
+"   ^>^    *s    ;s  ",
+"   b ^              ",
+" ^a A^ *           ;",
+" ^ B      p     pp  ",
+" ^^^   n  n     nn n"
+})
+
+wo:add({"ot_wire", anchor1="w1", anchor2="s1"})
+wo:add({"ot_wire", anchor1="w2", anchor2="s2"})
+wo:add({"ot_wire", anchor1="s3", anchor2="s4"})
+wo:add({"ot_wire", anchor1="a1", anchor2="a2"})
+wo:add({"ot_wire", anchor1="b1", anchor2="b2"})
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: team_levelpacks/team_test_new_api/ralT071_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Tue Sep 30 00:28:01 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 30 Sep 2008 00:28:01 +0200
Subject: [Enigma-game-svn] r1346 - in trunk: data data/schemas src src/stones
Message-ID: <200809292228.m8TMS18I019515@sheep.berlios.de>

Author: ral
Date: 2008-09-30 00:28:00 +0200 (Tue, 30 Sep 2008)
New Revision: 1346

Added:
   trunk/src/stones/StoneImpulse.cc
   trunk/src/stones/StoneImpulse.hh
Removed:
   trunk/src/stones_complex.cc
Modified:
   trunk/data/api1init.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/enigma.cc
   trunk/src/enigma.hh
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.cc
   trunk/src/stones.hh
   trunk/src/stones_internal.hh
Log:
Trunk 1.1: new API reengineering Stoneimpulse
- rename to st_stoneimpulse, st_stoneimulse_hollow, st_stoneimpulse_movable
- attributes "movable", "hollow", "steady" - all mutual exclusive true
- full wire support
- two variants of laser light behaviour:
  - "steady" stoneimpulse will send continuos impulses as long as enlighted
  - not "steady" (currently default) will just send 1 impulse on each
    new additional light beam
- full swap support for both light variants
- new variant: st_stoneimpulse_new can be set with attribute "orientation"
    as a stoneimpulse that starts in activated status as if it had just
    received an incoming impulse into given direction.
- all other stoneimpulse are set and initialized according to the snapshot
    principle.
Note:
- stone_complex.cc has been removed


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/data/api1init.lua	2008-09-29 22:28:00 UTC (rev 1346)
@@ -266,6 +266,9 @@
     st_shogun_sl = "st-shogun-sl",
     st_shogun_ml = "st-shogun-ml",
     st_shogun_sml = "st-shogun-sml",
+    st_stoneimpulse = "st-stoneimpulse",
+    st_stoneimpulse_hollow = "st-stoneimpulse-hollow",
+    st_stoneimpulse_movable = "st-stoneimpulse_movable",
     st_swap = "st-swap",
     st_switch = "st-switch",
     st_switch_black = "st-switch_black",
@@ -765,9 +768,7 @@
     st_floppy__onoff = "toggle",
     st_key__onoff = "toggle",
     st_laser__onoff = "toggle",
-    ["st-stoneimpulse__trigger"] = "signal",
-    ["st-stoneimpulse-hollow__trigger"] = "signal",
-    ["st-stoneimpulse_movable__trigger"] = "signal",
+    st_stoneimpulse__trigger = "signal",
     st_lightpassenger__trigger = "toggle",
     st_lightpassenger__onoff = "toggle",
     st_mirror__trigger = "turn",

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/data/schemas/objects.xml	2008-09-29 22:28:00 UTC (rev 1346)
@@ -62,6 +62,7 @@
     <attr name="scratches" type="string" default="" rw="rw"/>
     <attr name="state" type="int" default="0" min="0" max="1" rw="rw"/>
     <attr name="static" type="bool" default="false" rw="rw"/>
+    <attr name="steady" type="bool" default="false" rw="rw"/>
     <attr name="strength" type="double" default="1" rw="rw"/>
     <attr name="target" type="tokens" default="nil" rw="rw"/>
     <attr name="transparent" type="bool" default="false" rw="rw"/>
@@ -926,6 +927,27 @@
     <object name="st_shogun_sml">
       <attr name="flavor" value="sml"/>
     </object>
+    <object name="st_stoneimpulse">
+      <attr name="hollow"/>
+      <attr name="movable"/>
+      <attr name="orientation"/>
+      <attr name="steady"/>
+      <msg name="signal"/>
+      <msg name="_model_reanimated"/>
+      <msg name="_init"/>
+      <msg name="_trigger"/>
+    </object>
+    <object name="st_stoneimpulse_hollow">
+      <attr name="hollow" value="true"/>
+    </object>
+    <object name="st_stoneimpulse_movable">
+      <attr name="movable" value="true"/>
+    </object>
+    <object name="st_stoneimpulse_steady">
+      <attr name="steady" value="true"/>
+    </object>
+    <object name="st_stoneimpulse_new" init="true">
+    </object>
     <object name="st_swap">
       <attr name="state" rw="r"/>
     </object>

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/Makefile.am	2008-09-29 22:28:00 UTC (rev 1346)
@@ -125,7 +125,6 @@
 	stones.hh 		\
 	stones_internal.hh 	\
 	stones_simple.cc 	\
-	stones_complex.cc  	\
 	Utf8ToXML.cc		\
 	Utf8ToXML.hh		\
 	util.cc 		\
@@ -291,6 +290,8 @@
 	stones/ScissorsStone.hh	\
 	stones/ShogunStone.cc	\
 	stones/ShogunStone.hh	\
+	stones/StoneImpulse.cc	\
+	stones/StoneImpulse.hh	\
 	stones/SwapStone.cc	\
 	stones/SwapStone.hh	\
 	stones/Switch.cc	\

Modified: trunk/src/enigma.cc
===================================================================
--- trunk/src/enigma.cc	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/enigma.cc	2008-09-29 22:28:00 UTC (rev 1346)
@@ -89,7 +89,12 @@
     return rdir[d+1];
 }
 
+Direction previous(Direction d) {
+    static Direction rdir[] = {NORTH, NODIR, WEST, SOUTH, EAST};
+    return rdir[d+1];
+}
 
+
 Direction
 direction_fromto(GridPos source, GridPos target)
 {

Modified: trunk/src/enigma.hh
===================================================================
--- trunk/src/enigma.hh	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/enigma.hh	2008-09-29 22:28:00 UTC (rev 1346)
@@ -118,6 +118,7 @@
     Direction rotate_cw (Direction d);
     Direction rotate_ccw (Direction d);
     Direction next(Direction d);
+    Direction previous(Direction d);
 
     std::string to_suffix(Direction d);
     std::string toSuffix(Direction d);

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/ox_extra.cc	2008-09-29 22:28:00 UTC (rev 1346)
@@ -225,7 +225,7 @@
     UNUSED,              // OxydExtra stone 0x6a
     UNUSED,              // OxydExtra stone 0x6b
     UNUSED,              // OxydExtra stone 0x6c
-    "st-stoneimpulse",   // OxydExtra stone 0x6d
+    "st_stoneimpulse",   // OxydExtra stone 0x6d
     UNUSED,              // OxydExtra stone 0x6e
     UNUSED,              // OxydExtra stone 0x6f
     UNUSED,              // OxydExtra stone 0x70
@@ -303,7 +303,7 @@
     UNUSED,              // OxydExtra stone 0xb8
     UNUSED,              // OxydExtra stone 0xb9
     UNUSED,              // OxydExtra stone 0xba
-    "st-stoneimpulse-hollow", // OxydExtra stone 0xbb
+    "st_stoneimpulse_hollow", // OxydExtra stone 0xbb
     // codes >= 0xbc are unused
 };
 

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/ox_magnum.cc	2008-09-29 22:28:00 UTC (rev 1346)
@@ -225,7 +225,7 @@
     "st_coinslot_instant",      // OxydMagnum stone 0x6a
     "st-thief",                 // OxydMagnum stone 0x6b
     "st_shogun_s",              // OxydMagnum stone 0x6c
-    "st-stoneimpulse",          // OxydMagnum stone 0x6d
+    "st_stoneimpulse",          // OxydMagnum stone 0x6d
     "st_laserflop",             // OxydMagnum stone 0x6e
     "st_mail_n",                // OxydMagnum stone 0x6f
     "st_mail_w",                // OxydMagnum stone 0x70
@@ -280,7 +280,7 @@
     UNUSED,                     // OxydMagnum stone 0xa1
     UNUSED,                     // OxydMagnum stone 0xa2
     UNUSED,                     // OxydMagnum stone 0xa3
-    "st-stoneimpulse-hollow",   // OxydMagnum stone 0xa4
+    "st_stoneimpulse_hollow",   // OxydMagnum stone 0xa4
     UNUSED,                     // OxydMagnum stone 0xa5
     UNUSED,                     // OxydMagnum stone 0xa6
     "st_lightpassenger",        // OxydMagnum stone 0xa7

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/ox_oxyd1.cc	2008-09-29 22:28:00 UTC (rev 1346)
@@ -257,7 +257,7 @@
     "st_coinslot_instant",      // Oxyd1 stone 0x6a
     "st-thief",                 // Oxyd1 stone 0x6b
     "st_shogun_s",              // Oxyd1 stone 0x6c
-    "st-stoneimpulse",          // Oxyd1 stone 0x6d
+    "st_stoneimpulse",          // Oxyd1 stone 0x6d
     "st_laserflop",             // Oxyd1 stone 0x6e
     "st_mail_n",                // Oxyd1 stone 0x6f
     "st_mail_w",                // Oxyd1 stone 0x70

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/ox_peroxyd.cc	2008-09-29 22:28:00 UTC (rev 1346)
@@ -297,7 +297,7 @@
     "st_shogun_ml",             // PerOxyd stone 0x6a
     "st_shogun_sl",             // PerOxyd stone 0x6b
     "st_shogun_sm",             // PerOxyd stone 0x6c
-    "st-stoneimpulse",          // PerOxyd stone 0x6d
+    "st_stoneimpulse",          // PerOxyd stone 0x6d
     "st_laserflop",             // PerOxyd stone 0x6e
     "st_mail_n",                // PerOxyd stone 0x6f
     "st_mail_w",                // PerOxyd stone 0x70

Added: trunk/src/stones/StoneImpulse.cc
===================================================================
--- trunk/src/stones/StoneImpulse.cc	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/stones/StoneImpulse.cc	2008-09-29 22:28:00 UTC (rev 1346)
@@ -0,0 +1,271 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/StoneImpulse.hh"
+#include "main.hh"
+#include "player.hh"
+
+namespace enigma {
+    StoneImpulse::StoneImpulse(bool isSteady, bool isHollow, bool isMovable, bool isActive) : Stone () {
+        if (isSteady)
+            objFlags |= OBJBIT_STEADY;
+        if (isHollow)
+            objFlags |= OBJBIT_HOLLOW;
+        if (isMovable)
+            objFlags |= OBJBIT_MOVABLE;
+        if (isActive)
+            state = EXPANDING;
+    }
+
+    std::string StoneImpulse::getClass() const {
+        return "st_stoneimpulse";
+    }
+        
+    void StoneImpulse::setAttr(const string& key, const Value &val) {
+        if (key == "hollow") {
+            if (val.to_bool()) {
+                objFlags |= OBJBIT_HOLLOW;
+                objFlags &= ~OBJBIT_MOVABLE;
+                objFlags &= ~OBJBIT_STEADY;
+            } else
+                objFlags &= ~OBJBIT_HOLLOW;
+        } else if (key == "movable") {
+            if (val.to_bool()) {
+                objFlags |= OBJBIT_MOVABLE;
+                objFlags &= ~OBJBIT_HOLLOW;
+                objFlags &= ~OBJBIT_STEADY;
+            } else
+                objFlags &= ~OBJBIT_MOVABLE;
+        } else if (key == "steady") {
+            if (val.to_bool()) {
+                objFlags |= OBJBIT_STEADY;
+                objFlags &= ~OBJBIT_HOLLOW;
+                objFlags &= ~OBJBIT_MOVABLE;
+            } else
+                objFlags &= ~OBJBIT_STEADY;
+        } else if (key == "orientation") {
+            if (!isDisplayable()) {
+                objFlags &= ~OBJBIT_INCOMINGDIR;
+                Direction incoming = to_direction(val); 
+                if (incoming != NODIR ) {
+                    objFlags |= (incoming << 29) | OBJBIT_NOBACKFIRE;
+                }
+            }
+        } else
+            Stone::setAttr(key, val);
+    }
+    
+    Value StoneImpulse::getAttr(const std::string &key) const {
+        if (key == "hollow") {
+            return (bool)(objFlags & OBJBIT_HOLLOW);
+        } else if (key == "movable") {
+            return (bool)(objFlags & OBJBIT_MOVABLE);
+        } else if (key == "steady") {
+            return (bool)(objFlags & OBJBIT_STEADY);
+        } else
+            return Stone::getAttr(key);
+    }
+    
+    Value StoneImpulse::message(const Message &m) {
+        if (m.message == "_trigger" && m.value.to_bool()) {
+            Direction incoming = NODIR;
+            if (m.sender != NULL)
+                incoming = direction_fromto(dynamic_cast<GridObject *>(m.sender)->get_pos(), get_pos());
+            
+            if (state == IDLE && incoming != NODIR) {
+                objFlags |= OBJBIT_NOBACKFIRE;
+            }
+            setIState(EXPANDING, incoming);
+            return Value();
+        } else if (m.message == "signal" && (to_double(m.value) != 0 || 
+                (server::EnigmaCompatibility < 1.10 /*&& m.value.getType() == Value::NIL*/))) { // hack for old trigger without value
+            setIState(EXPANDING);
+            return Value();
+        } else if (m.message == "_model_reanimated") {
+            // we are swapped in or out of a laser beam
+            if ((objFlags & OBJBIT_STEADY) && (objFlags & OBJBIT_LIGHTNEWDIRS))
+                init_model();     // replace potential bogus model
+            else if (!(objFlags & OBJBIT_STEADY) && (objFlags & OBJBIT_LIGHTNEWDIRS) && !(objFlags & OBJBIT_LASERIDLE))
+                setIState(EXPANDING);
+        } else if (m.message == "_init") {
+            // we may have the wrong model
+            updateCurrentLightDirs();
+            if (state == IDLE && (objFlags & OBJBIT_STEADY) && (objFlags & OBJBIT_LIGHTNEWDIRS))
+               setIState(EXPANDING);     // replace potential bogus model
+        } else
+            return Stone::message(m);
+    }
+    
+            
+    void StoneImpulse::setState(int extState) {
+        // block any write attempts
+    }
+
+    void StoneImpulse::init_model() {
+        if (state == IDLE)
+            set_model(ecl::strf("st-stoneimpulse%s", (objFlags & OBJBIT_HOLLOW) ? "-hollow" : ""));
+        else
+            set_anim(ecl::strf("st-stoneimpulse%s-anim%d", (objFlags & OBJBIT_HOLLOW) ? "-hollow" : "",
+                    state == EXPANDING ? 1 : 2));
+    }
+    
+    void StoneImpulse::on_creation(GridPos p) {
+        updateCurrentLightDirs();
+            
+        if (!(objFlags & OBJBIT_HOLLOW))
+            activatePhoto();
+        
+        if (state == IDLE && (objFlags & OBJBIT_STEADY) && (objFlags & OBJBIT_LIGHTNEWDIRS))
+            setIState(EXPANDING);
+        else if (!(objFlags & OBJBIT_STEADY) && !(objFlags & OBJBIT_LIGHTNEWDIRS))  // being swapped out of light
+            objFlags &= ~OBJBIT_LASERIDLE;    
+
+        Stone::on_creation(p);
+    }
+    
+    void StoneImpulse::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
+        if (added_dirs(oldDirs, newDirs) != NODIRBIT) {
+            setIState(EXPANDING);            
+        }
+    }
+
+    void StoneImpulse::animcb() {
+        if (state == EXPANDING)
+            setIState(SHRINKING);
+        else {
+            setIState(IDLE);
+            if ((objFlags & OBJBIT_STEADY) && (objFlags & OBJBIT_LIGHTNEWDIRS))
+                setIState(EXPANDING);
+            else if (!(objFlags & OBJBIT_STEADY) && (objFlags & OBJBIT_LIGHTNEWDIRS))
+                objFlags |= OBJBIT_LASERIDLE;
+        }
+        init_model();
+    }
+    
+    bool StoneImpulse::is_floating() const {
+        return objFlags & OBJBIT_HOLLOW;
+    }
+    
+    StoneResponse StoneImpulse::collision_response(const StoneContact &sc) {
+        return ((state != IDLE) || !(objFlags & OBJBIT_HOLLOW)) ? STONE_REBOUND : STONE_PASS;
+    }
+    
+    void StoneImpulse::actor_inside(Actor *a) {
+        if ((state != IDLE) && (objFlags & OBJBIT_HOLLOW))
+            SendMessage(a, "shatter");
+    }
+    
+    void StoneImpulse::actor_hit(const StoneContact &sc) {
+        if ((objFlags & OBJBIT_MOVABLE) && maybe_push_stone(sc))
+            return;                                      // stone did move on impulse
+        else if (!(objFlags & OBJBIT_HOLLOW)) 
+            sc.actor->send_impulse(sc.stonepos, NODIR);  // impulse on the slightest touch
+    }
+
+    void StoneImpulse::on_impulse(const Impulse& impulse) {
+        if ((objFlags & OBJBIT_MOVABLE) && (impulse.dir != NODIR)) {
+            // move stone without disturbing a running animation
+            display::Model *yieldedModel = display::YieldModel(GridLoc(GRID_STONES, get_pos()));
+            move_stone(impulse.dir);
+            display::SetModel(GridLoc(GRID_STONES, get_pos()), yieldedModel);
+            
+            // pulse only if not pushed with a wand
+            Actor *hitman = dynamic_cast<Actor*>(impulse.sender);
+            if (hitman == NULL || !player::WieldedItemIs (hitman, "it_magicwand")) {
+                if (state != IDLE)
+                    objFlags |= OBJBIT_REPULSE;
+                else
+                    setIState(EXPANDING, NODIR);
+            }
+        } else {
+            setIState(EXPANDING, impulse.dir);
+        }
+        
+        propagateImpulse(impulse);
+    }
+    
+    FreezeStatusBits StoneImpulse::get_freeze_bits() {
+        return FREEZEBIT_NO_STONE;
+    }
+    
+    void StoneImpulse::setIState(int newState, Direction incoming) {
+        if (newState != state && isDisplayable()) {
+            switch (newState) {
+                case IDLE:
+                    state = newState;
+                    if (objFlags & OBJBIT_REPULSE) {
+                        objFlags &= ~OBJBIT_REPULSE;
+                        setIState(EXPANDING, NODIR);
+                    } else
+                        init_model();
+                    break;
+                case EXPANDING:
+                    if (state != IDLE) {
+                        return;         // do not set new state
+                    }
+                    objFlags &= ~OBJBIT_LASERIDLE;
+                    objFlags &= ~OBJBIT_INCOMINGDIR;
+                    if (incoming != NODIR)
+                        objFlags |= (incoming << 29);
+                    state = newState;
+                    init_model();
+                    sound_event("impulse");
+                    break;
+                case SHRINKING:
+                    state = newState;
+                    init_model();
+                    GridPos p = get_pos();
+                    Direction origin = reverse((Direction)((objFlags & OBJBIT_INCOMINGDIR) >> 29));
+                    for (Direction d = NORTH; d != NODIR; d = previous(d)) {
+                        if (!(objFlags & OBJBIT_NOBACKFIRE) || d != origin)
+                            send_impulse(move(p, d), d);
+                    }
+                    break;
+            }
+        }
+    }
+    
+    int StoneImpulse::traitsIdx() const {
+        if (objFlags & OBJBIT_MOVABLE)
+            return 3;
+        else if (objFlags & OBJBIT_HOLLOW)
+            return 2;
+        else if (objFlags & OBJBIT_STEADY)
+            return 1;
+        else
+            return 0;
+    }
+
+    
+    StoneTraits StoneImpulse::traits[4] = {
+        {"st_stoneimpulse", st_stoneimpulse, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_stoneimpulse_steady", st_stoneimpulse_steady, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_stoneimpulse_hollow", st_stoneimpulse_hollow, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_stoneimpulse_movable", st_stoneimpulse_movable, stf_none, material_stone, 1.0, MOVABLE_STANDARD},
+    };
+    
+    BOOT_REGISTER_START
+        BootRegister(new StoneImpulse(false, false, false, false), "st_stoneimpulse");
+        BootRegister(new StoneImpulse(true,  false, false, false), "st_stoneimpulse_steady");
+        BootRegister(new StoneImpulse(false, true,  false, false), "st_stoneimpulse_hollow");
+        BootRegister(new StoneImpulse(false, false, true,  false),  "st_stoneimpulse_movable");
+        BootRegister(new StoneImpulse(false, false, false, true), "st_stoneimpulse_new");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/StoneImpulse.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/StoneImpulse.hh
===================================================================
--- trunk/src/stones/StoneImpulse.hh	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/stones/StoneImpulse.hh	2008-09-29 22:28:00 UTC (rev 1346)
@@ -0,0 +1,93 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef STONEIMPULSESTONE_HH
+#define STONEIMPULSESTONE_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     * It is essential for the propagation of impulses, that the expanding phase
+     * of a stoneimpulse is slightly shorter than the shrinking phase. This is
+     * currently achieved by the animation sequence. This mismatch is responsible
+     * for blocking impulse waves from backfiring.
+     * 
+     * 
+     */
+    class StoneImpulse : public Stone {
+        CLONEOBJ(StoneImpulse);
+        DECL_TRAITS_ARRAY(4, traitsIdx());
+    private:
+        enum iState {
+            IDLE,        ///<  
+            EXPANDING,   ///<  
+            SHRINKING    ///<
+        };
+        
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_MOVABLE     =  1<<24,   ///< Object is movable 
+            OBJBIT_HOLLOW      =  1<<25,   ///< 
+            OBJBIT_STEADY      =  1<<26,   ///< continuous laser light causes repeating impulses 
+            OBJBIT_REPULSE     =  1<<27,   ///< pending impulse
+            OBJBIT_NOBACKFIRE  =  1<<28,   ///< avoid sending impulse back into incoming direction
+            OBJBIT_INCOMINGDIR =  3<<29,   ///< incoming direction
+            OBJBIT_LASERIDLE   =  1<<31,   ///< not steady stoneimpulse did run singleton pulse and is idle but still enlighted
+        };
+    public:
+        StoneImpulse(bool isSteady, bool isHollow, bool isMovable, bool isActive);
+        
+        // Object interface
+        virtual std::string getClass() const;
+        virtual void setAttr(const string& key, const Value &val);
+        virtual Value getAttr(const std::string &key) const;
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        virtual void on_creation(GridPos p);
+        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual bool is_floating() const;
+        virtual StoneResponse collision_response(const StoneContact &sc);
+        virtual void actor_inside(Actor *a);
+        virtual void actor_hit(const StoneContact &sc);
+        virtual void on_impulse(const Impulse& impulse);
+//        virtual void on_move();
+        virtual FreezeStatusBits get_freeze_bits();
+        
+    private:
+        void setIState(int newState, Direction incoming = NODIR);
+        int traitsIdx() const;
+    };
+
+} // namespace enigma
+
+#endif
+


Property changes on: trunk/src/stones/StoneImpulse.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/stones.cc	2008-09-29 22:28:00 UTC (rev 1346)
@@ -990,6 +990,5 @@
 
     // Init stones from stones_simple.cc and stones_complex.cc:
     Init_simple();
-    Init_complex();
 }
 } // namespace enigma

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/stones.hh	2008-09-29 22:28:00 UTC (rev 1346)
@@ -87,6 +87,7 @@
         st_scissors,
         st_shogun,
         st_stoneimpulse,
+        st_stoneimpulse_steady,
         st_stoneimpulse_hollow,
         st_stoneimpulse_movable,
         st_surprise,

Deleted: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/stones_complex.cc	2008-09-29 22:28:00 UTC (rev 1346)
@@ -1,312 +0,0 @@
-/*
- * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2007 Ronald Lamprecht
- *
- * This program is free software; you can redistribute it and/ or
- * modify it under the terms of the GNU General Public License
- * as published by the Free Software Foundation; either version 2
- * of the License, or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along
- * with this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
- *
- */
-
-#include "errors.hh"
-#include "laser.hh"
-#include "SoundEffectManager.hh"
-#include "server.hh"
-#include "player.hh"
-#include "Inventory.hh"
-#include "stones_internal.hh"
-#include "actors.hh"
-#include "main.hh"
-#include "Value.hh"
-
-#include "ecl_util.hh"
-
-#include <algorithm>
-#include <iostream>
-
-using namespace std;
-
-namespace enigma { 
-
-/* -------------------- Stone impulse stones -------------------- */
-
-// Messages:
-//
-// :trigger
-namespace
-{
-    class StoneImpulse_Base : public Stone {
-    protected:
-        StoneImpulse_Base() : state(IDLE), incoming(NODIR), nobackfire (false)
-        {}
-
-        enum State { IDLE, PULSING, CLOSING };
-        State     state;
-        Direction incoming; // direction of incoming impulse (may be NODIR)
-        bool      nobackfire;
-
-        void change_state(State st);
-
-        virtual void on_impulse(const Impulse& impulse) {
-            incoming = impulse.dir;
-            change_state(PULSING);
-        }
-
-    private:
-
-        virtual void notify_state(State st) = 0;
-
-        virtual Value message(const Message &m) {
-            if (m.message == "_trigger" && m.value.to_bool()) {
-                incoming = NODIR;
-                if (m.sender != NULL)
-                    incoming = direction_fromto(dynamic_cast<GridObject *>(m.sender)->get_pos(), get_pos());
-                
-                if (state == IDLE && incoming != NODIR) {
-                    nobackfire = true;
-                }
-                change_state(PULSING);
-                return Value();
-            }
-            else if (m.message == "signal" && (to_double(m.value) != 0 || 
-                    (server::EnigmaCompatibility < 1.10 /*&& m.value.getType() == Value::NIL*/))) { // hack for old trigger without value
-                incoming = NODIR;
-                change_state (PULSING);
-                return Value();
-            }
-            return Stone::message(m);
-        }
-
-        void animcb() {
-            if (state == PULSING)
-                change_state (CLOSING);
-            else if (state == CLOSING)
-                change_state (IDLE);
-        }
-
-        void processLight(Direction dir) {
-            incoming = dir;
-            change_state(PULSING);
-        }
-
-        FreezeStatusBits get_freeze_bits() { return FREEZEBIT_NO_STONE; }
-    };
-}
-
-void StoneImpulse_Base::change_state(State new_state) {
-    if (new_state == state) return;
-
-    GridPos p = get_pos();
-    switch (new_state) {
-        case IDLE: {
-            state = new_state;
-            notify_state(state);
-            break;
-        }
-        case PULSING:
-            if (state != IDLE) {
-                return;         // do not set new state
-            }
-            state = new_state;
-            notify_state(state);
-            sound_event("impulse");
-            break;
-        case CLOSING: {
-            GridPos targetpos[4];
-            bool    haveStone[4];
-
-            // set CLOSING model _before_ sending impulses !!!
-            // (any impulse might have side effects that move this stone)
-
-            state = new_state;
-            notify_state(state);
-
-            for (int d = 0; d < 4; ++d) {
-                targetpos[d] = move(p, Direction(d));
-                haveStone[d] = GetStone(targetpos[d]) != 0;
-            }
-
-            for (int d = int(incoming)+1; d <= int(incoming)+4; ++d) {
-                int D = d%4;
-                if (!nobackfire || reverse(incoming) != D) {
-                    if (haveStone[D]) {
-                        send_impulse(targetpos[D], Direction(D));
-                    }
-                }
-            }
-
-            incoming = NODIR;   // forget impulse direction
-            nobackfire = false;
-            break;
-        }
-    }
-}
-
-
-namespace
-{
-    class StoneImpulseStone : public StoneImpulse_Base {
-        CLONEOBJ(StoneImpulseStone);
-        DECL_TRAITS;
-    public:
-        StoneImpulseStone()
-        {}
-
-    private:
-        void notify_state(State st) {
-            switch (st) {
-            case IDLE:
-                init_model();
-                break;
-            case PULSING:
-                set_anim("st-stoneimpulse-anim1");
-                break;
-            case CLOSING:
-                set_anim("st-stoneimpulse-anim2");
-                break;
-            }
-        }
-
-        void actor_hit(const StoneContact &/*sc*/) {
-            change_state(PULSING);
-        }
-    };
-    DEF_TRAITS(StoneImpulseStone, "st-stoneimpulse", st_stoneimpulse);
-
-    class HollowStoneImpulseStone : public StoneImpulse_Base {
-        CLONEOBJ(HollowStoneImpulseStone);
-        DECL_TRAITS;
-    public:
-        HollowStoneImpulseStone()
-        {}
-    private:
-        void notify_state(State st) {
-            switch (st) {
-            case IDLE:
-                init_model();
-                MaybeRecalcLight(get_pos());
-                break;
-            case PULSING:
-                MaybeRecalcLight(get_pos());
-                set_anim("st-stoneimpulse-hollow-anim1");
-                break;
-            case CLOSING:
-                set_anim("st-stoneimpulse-hollow-anim2");
-                break;
-            }
-        }
-
-        StoneResponse collision_response(const StoneContact &/*sc*/) {
-            return (state == IDLE) ? STONE_PASS : STONE_REBOUND;
-        }
-        void actor_inside(Actor *a) {
-            if (state == PULSING || state == CLOSING)
-                SendMessage(a, "shatter");
-        }
-
-        bool is_floating () const {
-            return true;
-        }
-
-        void processLight(Direction d) {
-            // hollow StoneImpulseStones cannot be activated using lasers
-        }
-    };
-    DEF_TRAITS(HollowStoneImpulseStone, "st-stoneimpulse-hollow",
-               st_stoneimpulse_hollow);
-
-    class MovableImpulseStone : public StoneImpulse_Base {
-        CLONEOBJ(MovableImpulseStone);
-        DECL_TRAITS;
-    public:
-        MovableImpulseStone()
-        : repulse(false)
-        {}
-
-    private:
-
-        void notify_state(State st) {
-            switch (st) {
-            case IDLE:
-                if (repulse) {
-                    repulse = false;
-                    change_state(PULSING);
-                }
-                else
-                    init_model();
-                break;
-            case PULSING:
-                set_anim("st-stoneimpulse-anim1");
-                break;
-            case CLOSING:
-                set_anim("st-stoneimpulse-anim2");
-                break;
-            }
-        }
-
-        void init_model() {
-            set_model("st-stoneimpulse");
-        }
-
-        // Stone interface:
-
-        void actor_hit(const StoneContact &sc) {
-            if (!maybe_push_stone (sc)) {
-                incoming = NODIR; // bad, but no real problem!
-                if (state == IDLE)
-                    change_state(PULSING);
-            }
-        }
-
-        void on_impulse(const Impulse& impulse) {
-            State oldstate = state;
-
-            if (move_stone(impulse.dir)) {
-                notify_state(oldstate); // restart anim if it was animated before move
-
-                Actor *hitman = dynamic_cast<Actor*>(impulse.sender);
-                if (hitman && player::WieldedItemIs (hitman, "it_magicwand")) {
-                    return;     // do not change state to PULSING
-                }
-            }
-
-            if (state == IDLE)
-                change_state(PULSING);
-        }
-
-        void on_move() {
-            if (state != PULSING)
-                repulse = true; // pulse again
-            Stone::on_move();
-        }
-
-        // Variables.
-        bool repulse;
-    };
-    DEF_TRAITSM(MovableImpulseStone, "st-stoneimpulse_movable",
-                st_stoneimpulse_movable, MOVABLE_STANDARD);
-}
-
-// --------------------------------------------------------------------------------
-
-void Init_complex()
-{
-    Register(new HollowStoneImpulseStone);
-
-    Register(new MovableImpulseStone);
-
-    Register(new StoneImpulseStone);
-
-}
-
-} // namespace enigma

Modified: trunk/src/stones_internal.hh
===================================================================
--- trunk/src/stones_internal.hh	2008-09-29 22:13:33 UTC (rev 1345)
+++ trunk/src/stones_internal.hh	2008-09-29 22:28:00 UTC (rev 1346)
@@ -41,7 +41,6 @@
 namespace enigma {
 
     void Init_simple();
-    void Init_complex();
 
 
 /* -------------------- Auxiliary Functions -------------------- */



