From ral at mail.berlios.de  Sun Jun  1 23:50:04 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 1 Jun 2008 23:50:04 +0200
Subject: [Enigma-game-svn] r1163 - homepage/input
Message-ID: <200806012150.m51Lo4QE016719@sheep.berlios.de>

Author: ral
Date: 2008-06-01 23:50:03 +0200 (Sun, 01 Jun 2008)
New Revision: 1163

Modified:
   homepage/input/stat-other.html
   homepage/input/table-hcp.html
   homepage/input/table-rat.html
   homepage/input/table-solved.html
   homepage/input/table-wr.html
   homepage/input/userlist.html
Log:
Homepage:
- statistics May 2008


Modified: homepage/input/stat-other.html
===================================================================
--- homepage/input/stat-other.html	2008-05-28 19:49:29 UTC (rev 1162)
+++ homepage/input/stat-other.html	2008-06-01 21:50:03 UTC (rev 1163)
@@ -1,22 +1,22 @@
   <div class="stat-help">
     <h3>$$Other_Statistics$$</h3>
     <h4>$$Scores$$</h4>
-      77232 $$single_level_scores$$.
+      77764 $$single_level_scores$$.
     <h4>$$Ratings$$</h4>
-      14376 $$single_level_ratings$$ 4.91 $$and_distribution$$: 
+      14496 $$single_level_ratings$$ 4.90 $$and_distribution$$: 
       <table>
         <colgroup><col width="80"><col width="80"></colgroup>
         <tr><th>$$rating$$</th><th>$$count$$</th></tr>
-        <tr><td class="num">0</td><td class="num">78</td></tr>
-        <tr><td class="num">1</td><td class="num">278</td></tr>
-        <tr><td class="num">2</td><td class="num">764</td></tr>
-        <tr><td class="num">3</td><td class="num">2050</td></tr>
-        <tr><td class="num">4</td><td class="num">2710</td></tr>
-        <tr><td class="num">5</td><td class="num">3424</td></tr>
-        <tr><td class="num">6</td><td class="num">2393</td></tr>
-        <tr><td class="num">7</td><td class="num">1650</td></tr>
-        <tr><td class="num">8</td><td class="num">650</td></tr>
-        <tr><td class="num">9</td><td class="num">260</td></tr>
+        <tr><td class="num">0</td><td class="num">84</td></tr>
+        <tr><td class="num">1</td><td class="num">283</td></tr>
+        <tr><td class="num">2</td><td class="num">780</td></tr>
+        <tr><td class="num">3</td><td class="num">2059</td></tr>
+        <tr><td class="num">4</td><td class="num">2736</td></tr>
+        <tr><td class="num">5</td><td class="num">3445</td></tr>
+        <tr><td class="num">6</td><td class="num">2408</td></tr>
+        <tr><td class="num">7</td><td class="num">1667</td></tr>
+        <tr><td class="num">8</td><td class="num">654</td></tr>
+        <tr><td class="num">9</td><td class="num">261</td></tr>
         <tr><td class="num">10</td><td class="num">119</td></tr>
       </table>
   </div>

Modified: homepage/input/table-hcp.html
===================================================================
--- homepage/input/table-hcp.html	2008-05-28 19:49:29 UTC (rev 1162)
+++ homepage/input/table-hcp.html	2008-06-01 21:50:03 UTC (rev 1163)
@@ -1,151 +1,155 @@
   <table>
-    <caption>$$Handicap_Statistics$$ $$April$$ 2008</caption>
+    <caption>$$Handicap_Statistics$$ $$May$$ 2008</caption>
     <colgroup><col width="130"><col width="220"></colgroup>
     <tr><th>$$solved_hcp$$</th><th class="left">$$user$$</th></tr>
-     <tr><td class="num">-144.6</td><td class="left">'Moneymaker'</td></tr>
-     <tr><td class="num"> -82.4</td><td class="left">'Johannes'</td></tr>
-     <tr><td class="num"> -82.3</td><td class="left">'Stupid'</td></tr>
-     <tr><td class="num"> -73.9</td><td class="left">'daydreamer'</td></tr>
-     <tr><td class="num"> -70.9</td><td class="left">'Great Scott'</td></tr>
-     <tr><td class="num"> -60.7</td><td class="left">'Duffy'</td></tr>
-     <tr><td class="num"> -59.3</td><td class="left">'Malla'</td></tr>
-     <tr><td class="num"> -53.6</td><td class="left">'ryujun'</td></tr>
-     <tr><td class="num"> -48.8</td><td class="left">'Django'</td></tr>
-     <tr><td class="num"> -45.6</td><td class="left">'dev0'</td></tr>
-     <tr><td class="num"> -43.5</td><td class="left">'Gloop'</td></tr>
-     <tr><td class="num"> -42.6</td><td class="left">'Alexandros'</td></tr>
-     <tr><td class="num"> -40.3</td><td class="left">'Taztunes'</td></tr>
-     <tr><td class="num"> -36.9</td><td class="left">'Safalra'</td></tr>
-     <tr><td class="num"> -31.7</td><td class="left">'B-Huff'</td></tr>
-     <tr><td class="num"> -31.3</td><td class="left">'Ludmian'</td></tr>
-     <tr><td class="num"> -27.1</td><td class="left">'Zekobah'</td></tr>
-     <tr><td class="num"> -26.9</td><td class="left">'bojster'</td></tr>
-     <tr><td class="num"> -23.3</td><td class="left">'hendrik'</td></tr>
-     <tr><td class="num"> -23.1</td><td class="left">'Emmanuel'</td></tr>
-     <tr><td class="num"> -22.1</td><td class="left">'ged'</td></tr>
-     <tr><td class="num"> -21.6</td><td class="left">'ABS'</td></tr>
-     <tr><td class="num"> -21.4</td><td class="left">'dpl'</td></tr>
-     <tr><td class="num"> -19.5</td><td class="left">'Raoul'</td></tr>
-     <tr><td class="num"> -16.1</td><td class="left">'Ronald'</td></tr>
-     <tr><td class="num"> -15.7</td><td class="left">'Ghatotkacha'</td></tr>
-     <tr><td class="num"> -12.2</td><td class="left">'Lukas'</td></tr>
-     <tr><td class="num"> -11.4</td><td class="left">'HuB34'</td></tr>
-     <tr><td class="num"> -11.3</td><td class="left">'Daisy'</td></tr>
-     <tr><td class="num">  -8.2</td><td class="left">'joseba'</td></tr>
-     <tr><td class="num">  -8.1</td><td class="left">'Iceshark7'</td></tr>
-     <tr><td class="num">  -4.2</td><td class="left">'Daniel'</td></tr>
-     <tr><td class="num">  -3.0</td><td class="left">'fabian'</td></tr>
-     <tr><td class="num">  -1.4</td><td class="left">'Craven'</td></tr>
-     <tr><td class="num">  -1.1</td><td class="left">'Wuzzy'</td></tr>
-     <tr><td class="num">  -1.1</td><td class="left">'JuSt'</td></tr>
-     <tr><td class="num">   0.3</td><td class="left">'mrduke'</td></tr>
-     <tr><td class="num">   1.6</td><td class="left">'para_doks'</td></tr>
-     <tr><td class="num">   1.8</td><td class="left">'Tobias'</td></tr>
-     <tr><td class="num">   2.6</td><td class="left">'Guglielmo'</td></tr>
+     <tr><td class="num">-143.8</td><td class="left">'Moneymaker'</td></tr>
+     <tr><td class="num"> -81.8</td><td class="left">'Johannes'</td></tr>
+     <tr><td class="num"> -81.6</td><td class="left">'Stupid'</td></tr>
+     <tr><td class="num"> -75.4</td><td class="left">'daydreamer'</td></tr>
+     <tr><td class="num"> -70.3</td><td class="left">'Great Scott'</td></tr>
+     <tr><td class="num"> -60.1</td><td class="left">'Duffy'</td></tr>
+     <tr><td class="num"> -58.7</td><td class="left">'Malla'</td></tr>
+     <tr><td class="num"> -54.0</td><td class="left">'ryujun'</td></tr>
+     <tr><td class="num"> -51.1</td><td class="left">'dev0'</td></tr>
+     <tr><td class="num"> -48.2</td><td class="left">'Django'</td></tr>
+     <tr><td class="num"> -42.8</td><td class="left">'Gloop'</td></tr>
+     <tr><td class="num"> -42.0</td><td class="left">'Alexandros'</td></tr>
+     <tr><td class="num"> -39.6</td><td class="left">'Taztunes'</td></tr>
+     <tr><td class="num"> -36.4</td><td class="left">'Safalra'</td></tr>
+     <tr><td class="num"> -31.1</td><td class="left">'B-Huff'</td></tr>
+     <tr><td class="num"> -30.9</td><td class="left">'Ludmian'</td></tr>
+     <tr><td class="num"> -28.6</td><td class="left">'Zekobah'</td></tr>
+     <tr><td class="num"> -26.3</td><td class="left">'bojster'</td></tr>
+     <tr><td class="num"> -24.1</td><td class="left">'ged'</td></tr>
+     <tr><td class="num"> -22.5</td><td class="left">'hendrik'</td></tr>
+     <tr><td class="num"> -22.4</td><td class="left">'Emmanuel'</td></tr>
+     <tr><td class="num"> -21.0</td><td class="left">'ABS'</td></tr>
+     <tr><td class="num"> -20.9</td><td class="left">'dpl'</td></tr>
+     <tr><td class="num"> -18.9</td><td class="left">'Raoul'</td></tr>
+     <tr><td class="num"> -15.6</td><td class="left">'Ronald'</td></tr>
+     <tr><td class="num"> -15.2</td><td class="left">'Ghatotkacha'</td></tr>
+     <tr><td class="num"> -11.8</td><td class="left">'Daisy'</td></tr>
+     <tr><td class="num"> -11.8</td><td class="left">'Lukas'</td></tr>
+     <tr><td class="num"> -11.0</td><td class="left">'HuB34'</td></tr>
+     <tr><td class="num">  -7.9</td><td class="left">'joseba'</td></tr>
+     <tr><td class="num">  -7.7</td><td class="left">'Iceshark7'</td></tr>
+     <tr><td class="num">  -3.7</td><td class="left">'Daniel'</td></tr>
+     <tr><td class="num">  -2.4</td><td class="left">'fabian'</td></tr>
+     <tr><td class="num">  -1.0</td><td class="left">'Craven'</td></tr>
+     <tr><td class="num">  -0.8</td><td class="left">'JuSt'</td></tr>
+     <tr><td class="num">  -0.7</td><td class="left">'Wuzzy'</td></tr>
+     <tr><td class="num">   0.0</td><td class="left">'Freshman'</td></tr>
+     <tr><td class="num">   0.7</td><td class="left">'mrduke'</td></tr>
+     <tr><td class="num">   1.9</td><td class="left">'para_doks'</td></tr>
+     <tr><td class="num">   2.2</td><td class="left">'Tobias'</td></tr>
+     <tr><td class="num">   3.0</td><td class="left">'Guglielmo'</td></tr>
      <tr><td class="num">   3.7</td><td class="left">'Kevin'</td></tr>
-     <tr><td class="num">   3.7</td><td class="left">'U-Punkt'</td></tr>
-     <tr><td class="num">   4.0</td><td class="left">'Andy'</td></tr>
-     <tr><td class="num">   4.1</td><td class="left">'serpent'</td></tr>
-     <tr><td class="num">   6.2</td><td class="left">'Austin'</td></tr>
-     <tr><td class="num">   8.1</td><td class="left">'shoki'</td></tr>
-     <tr><td class="num">   9.5</td><td class="left">'Tiza'</td></tr>
-     <tr><td class="num">  10.5</td><td class="left">'Freshman'</td></tr>
-     <tr><td class="num">  10.8</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-     <tr><td class="num">  12.3</td><td class="left">'Andreas'</td></tr>
-     <tr><td class="num">  13.2</td><td class="left">'alfred69'</td></tr>
-     <tr><td class="num">  13.6</td><td class="left">'Chocolate Zero'</td></tr>
-     <tr><td class="num">  14.4</td><td class="left">'Sim_Ed'</td></tr>
-     <tr><td class="num">  14.6</td><td class="left">'Agnieszka'</td></tr>
-     <tr><td class="num">  14.9</td><td class="left">'Mark P.'</td></tr>
-     <tr><td class="num">  19.3</td><td class="left">'Alex'</td></tr>
-     <tr><td class="num">  21.2</td><td class="left">'Antonio EE'</td></tr>
-     <tr><td class="num">  22.1</td><td class="left">'Klaus'</td></tr>
-     <tr><td class="num">  22.2</td><td class="left">'Marc-Hendrik'</td></tr>
-     <tr><td class="num">  22.4</td><td class="left">'Chris'</td></tr>
-     <tr><td class="num">  22.6</td><td class="left">'Angolino'</td></tr>
-     <tr><td class="num">  23.4</td><td class="left">'Bent'</td></tr>
-     <tr><td class="num">  23.4</td><td class="left">'Thomas'</td></tr>
-     <tr><td class="num">  24.1</td><td class="left">'hdwow'</td></tr>
-     <tr><td class="num">  24.8</td><td class="left">'Gottseinsohn'</td></tr>
-     <tr><td class="num">  25.3</td><td class="left">'Hans-HD'</td></tr>
-     <tr><td class="num">  25.9</td><td class="left">'Ale'</td></tr>
-     <tr><td class="num">  27.1</td><td class="left">'J3FF'</td></tr>
-     <tr><td class="num">  27.1</td><td class="left">'Little_Mole'</td></tr>
-     <tr><td class="num">  28.4</td><td class="left">'biotopa'</td></tr>
-     <tr><td class="num">  29.1</td><td class="left">'oblo'</td></tr>
-     <tr><td class="num">  29.4</td><td class="left">'redsantz'</td></tr>
-     <tr><td class="num">  29.8</td><td class="left">'geembo_90'</td></tr>
-     <tr><td class="num">  30.4</td><td class="left">'Edgar_Flesk'</td></tr>
-     <tr><td class="num">  30.9</td><td class="left">'Melanie'</td></tr>
-     <tr><td class="num">  31.0</td><td class="left">'IChrisI'</td></tr>
-     <tr><td class="num">  31.3</td><td class="left">'Vinksu'</td></tr>
-     <tr><td class="num">  31.4</td><td class="left">'erich'</td></tr>
-     <tr><td class="num">  31.5</td><td class="left">'NorthForty'</td></tr>
-     <tr><td class="num">  31.7</td><td class="left">'Gorn'</td></tr>
-     <tr><td class="num">  31.8</td><td class="left">'Davacardo'</td></tr>
-     <tr><td class="num">  34.5</td><td class="left">'MicWa'</td></tr>
-     <tr><td class="num">  34.6</td><td class="left">'niebie'</td></tr>
-     <tr><td class="num">  34.8</td><td class="left">'WP319'</td></tr>
-     <tr><td class="num">  35.0</td><td class="left">'Kosby'</td></tr>
-     <tr><td class="num">  36.7</td><td class="left">'Rugby4ever'</td></tr>
-     <tr><td class="num">  38.0</td><td class="left">'mecke'</td></tr>
-     <tr><td class="num">  38.1</td><td class="left">'Drotten'</td></tr>
-     <tr><td class="num">  38.6</td><td class="left">'Archcorenth'</td></tr>
-     <tr><td class="num">  38.9</td><td class="left">'Harry Lim'</td></tr>
-     <tr><td class="num">  39.0</td><td class="left">'B-man'</td></tr>
-     <tr><td class="num">  40.0</td><td class="left">'Nfol'</td></tr>
-     <tr><td class="num">  40.5</td><td class="left">'Tiger'</td></tr>
-     <tr><td class="num">  40.7</td><td class="left">'gringer'</td></tr>
-     <tr><td class="num">  41.0</td><td class="left">'Snaily'</td></tr>
-     <tr><td class="num">  41.1</td><td class="left">'Vlad'</td></tr>
-     <tr><td class="num">  42.4</td><td class="left">'Momcat'</td></tr>
-     <tr><td class="num">  42.5</td><td class="left">'Liam Sheehan'</td></tr>
-     <tr><td class="num">  42.9</td><td class="left">'Breezy'</td></tr>
-     <tr><td class="num">  43.1</td><td class="left">'Uli'</td></tr>
-     <tr><td class="num">  44.9</td><td class="left">'Tarim'</td></tr>
-     <tr><td class="num">  45.4</td><td class="left">'IntKecsk'</td></tr>
-     <tr><td class="num">  45.7</td><td class="left">'tjRaven'</td></tr>
-     <tr><td class="num">  46.8</td><td class="left">'ntaeijr'</td></tr>
-     <tr><td class="num">  47.0</td><td class="left">'mhatta'</td></tr>
-     <tr><td class="num">  48.6</td><td class="left">'Zak'</td></tr>
-     <tr><td class="num">  49.0</td><td class="left">'rima'</td></tr>
-     <tr><td class="num">  49.1</td><td class="left">'Valkyrie2'</td></tr>
-     <tr><td class="num">  49.5</td><td class="left">'Sandra'</td></tr>
-     <tr><td class="num">  50.4</td><td class="left">'jdcampo'</td></tr>
-     <tr><td class="num">  50.9</td><td class="left">'Jeffrey S'</td></tr>
-     <tr><td class="num">  51.2</td><td class="left">'brynn'</td></tr>
-     <tr><td class="num">  51.3</td><td class="left">'Slav'</td></tr>
+     <tr><td class="num">   4.0</td><td class="left">'U-Punkt'</td></tr>
+     <tr><td class="num">   4.4</td><td class="left">'Andy'</td></tr>
+     <tr><td class="num">   4.5</td><td class="left">'serpent'</td></tr>
+     <tr><td class="num">   6.6</td><td class="left">'Austin'</td></tr>
+     <tr><td class="num">   8.5</td><td class="left">'shoki'</td></tr>
+     <tr><td class="num">  10.0</td><td class="left">'Tiza'</td></tr>
+     <tr><td class="num">  11.1</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+     <tr><td class="num">  12.7</td><td class="left">'Andreas'</td></tr>
+     <tr><td class="num">  13.5</td><td class="left">'alfred69'</td></tr>
+     <tr><td class="num">  13.8</td><td class="left">'Chocolate Zero'</td></tr>
+     <tr><td class="num">  14.6</td><td class="left">'Mark P.'</td></tr>
+     <tr><td class="num">  14.7</td><td class="left">'Sim_Ed'</td></tr>
+     <tr><td class="num">  14.9</td><td class="left">'Agnieszka'</td></tr>
+     <tr><td class="num">  19.5</td><td class="left">'Alex'</td></tr>
+     <tr><td class="num">  21.4</td><td class="left">'Antonio EE'</td></tr>
+     <tr><td class="num">  22.3</td><td class="left">'Klaus'</td></tr>
+     <tr><td class="num">  22.4</td><td class="left">'Marc-Hendrik'</td></tr>
+     <tr><td class="num">  22.7</td><td class="left">'Chris'</td></tr>
+     <tr><td class="num">  23.1</td><td class="left">'Angolino'</td></tr>
+     <tr><td class="num">  23.6</td><td class="left">'Bent'</td></tr>
+     <tr><td class="num">  23.6</td><td class="left">'Thomas'</td></tr>
+     <tr><td class="num">  24.4</td><td class="left">'hdwow'</td></tr>
+     <tr><td class="num">  25.1</td><td class="left">'Gottseinsohn'</td></tr>
+     <tr><td class="num">  25.5</td><td class="left">'Hans-HD'</td></tr>
+     <tr><td class="num">  26.1</td><td class="left">'Ale'</td></tr>
+     <tr><td class="num">  27.3</td><td class="left">'Little_Mole'</td></tr>
+     <tr><td class="num">  27.4</td><td class="left">'J3FF'</td></tr>
+     <tr><td class="num">  28.6</td><td class="left">'biotopa'</td></tr>
+     <tr><td class="num">  29.3</td><td class="left">'oblo'</td></tr>
+     <tr><td class="num">  29.6</td><td class="left">'redsantz'</td></tr>
+     <tr><td class="num">  29.9</td><td class="left">'geembo_90'</td></tr>
+     <tr><td class="num">  30.6</td><td class="left">'Edgar_Flesk'</td></tr>
+     <tr><td class="num">  31.1</td><td class="left">'Melanie'</td></tr>
+     <tr><td class="num">  31.3</td><td class="left">'IChrisI'</td></tr>
+     <tr><td class="num">  31.5</td><td class="left">'Vinksu'</td></tr>
+     <tr><td class="num">  31.7</td><td class="left">'erich'</td></tr>
+     <tr><td class="num">  31.7</td><td class="left">'NorthForty'</td></tr>
+     <tr><td class="num">  31.9</td><td class="left">'Gorn'</td></tr>
+     <tr><td class="num">  32.1</td><td class="left">'Davacardo'</td></tr>
+     <tr><td class="num">  34.8</td><td class="left">'niebie'</td></tr>
+     <tr><td class="num">  34.8</td><td class="left">'MicWa'</td></tr>
+     <tr><td class="num">  35.0</td><td class="left">'WP319'</td></tr>
+     <tr><td class="num">  35.3</td><td class="left">'Kosby'</td></tr>
+     <tr><td class="num">  37.2</td><td class="left">'Rugby4ever'</td></tr>
+     <tr><td class="num">  38.2</td><td class="left">'mecke'</td></tr>
+     <tr><td class="num">  38.5</td><td class="left">'Drotten'</td></tr>
+     <tr><td class="num">  38.8</td><td class="left">'Archcorenth'</td></tr>
+     <tr><td class="num">  39.1</td><td class="left">'Harry Lim'</td></tr>
+     <tr><td class="num">  39.2</td><td class="left">'B-man'</td></tr>
+     <tr><td class="num">  39.6</td><td class="left">'Nfol'</td></tr>
+     <tr><td class="num">  40.7</td><td class="left">'Tiger'</td></tr>
+     <tr><td class="num">  41.0</td><td class="left">'gringer'</td></tr>
+     <tr><td class="num">  41.3</td><td class="left">'Vlad'</td></tr>
+     <tr><td class="num">  41.3</td><td class="left">'Snaily'</td></tr>
+     <tr><td class="num">  42.6</td><td class="left">'Momcat'</td></tr>
+     <tr><td class="num">  42.7</td><td class="left">'Liam Sheehan'</td></tr>
+     <tr><td class="num">  43.1</td><td class="left">'Breezy'</td></tr>
+     <tr><td class="num">  43.3</td><td class="left">'Uli'</td></tr>
+     <tr><td class="num">  45.1</td><td class="left">'Tarim'</td></tr>
+     <tr><td class="num">  45.6</td><td class="left">'IntKecsk'</td></tr>
+     <tr><td class="num">  45.8</td><td class="left">'tjRaven'</td></tr>
+     <tr><td class="num">  47.0</td><td class="left">'ntaeijr'</td></tr>
+     <tr><td class="num">  47.1</td><td class="left">'mhatta'</td></tr>
+     <tr><td class="num">  48.7</td><td class="left">'Zak'</td></tr>
+     <tr><td class="num">  49.2</td><td class="left">'rima'</td></tr>
+     <tr><td class="num">  49.3</td><td class="left">'Valkyrie2'</td></tr>
+     <tr><td class="num">  49.6</td><td class="left">'Sandra'</td></tr>
+     <tr><td class="num">  50.5</td><td class="left">'jdcampo'</td></tr>
+     <tr><td class="num">  51.0</td><td class="left">'Jeffrey S'</td></tr>
+     <tr><td class="num">  51.4</td><td class="left">'brynn'</td></tr>
      <tr><td class="num">  51.5</td><td class="left">'AkRa'</td></tr>
-     <tr><td class="num">  51.8</td><td class="left">'Vaily'</td></tr>
-     <tr><td class="num">  52.9</td><td class="left">'Turbogurk'</td></tr>
-     <tr><td class="num">  52.9</td><td class="left">'Neophilus'</td></tr>
-     <tr><td class="num">  52.9</td><td class="left">'Cyphase'</td></tr>
-     <tr><td class="num">  55.3</td><td class="left">'krazy62'</td></tr>
-     <tr><td class="num">  56.1</td><td class="left">'Adonica'</td></tr>
-     <tr><td class="num">  58.8</td><td class="left">'Mecki'</td></tr>
-     <tr><td class="num">  59.3</td><td class="left">'Sopoforic'</td></tr>
-     <tr><td class="num">  61.4</td><td class="left">'Asbel'</td></tr>
-     <tr><td class="num">  63.3</td><td class="left">'Meeve'</td></tr>
-     <tr><td class="num">  65.8</td><td class="left">'ael'</td></tr>
-     <tr><td class="num">  66.3</td><td class="left">'Samuel'</td></tr>
-     <tr><td class="num">  66.6</td><td class="left">'schmusi20'</td></tr>
-     <tr><td class="num">  67.3</td><td class="left">'Alf'</td></tr>
-     <tr><td class="num">  68.9</td><td class="left">'Magnus and Susi'</td></tr>
-     <tr><td class="num">  69.6</td><td class="left">'Zhura'</td></tr>
-     <tr><td class="num">  70.0</td><td class="left">'xmouse'</td></tr>
-     <tr><td class="num">  70.6</td><td class="left">'tasker'</td></tr>
-     <tr><td class="num">  71.6</td><td class="left">'Joona'</td></tr>
-     <tr><td class="num">  71.8</td><td class="left">'AQZ'</td></tr>
-     <tr><td class="num">  73.3</td><td class="left">'crypto_rsa'</td></tr>
-     <tr><td class="num">  73.7</td><td class="left">'Dvorhagen'</td></tr>
-     <tr><td class="num">  74.7</td><td class="left">'Nicol?s'</td></tr>
-     <tr><td class="num">  74.8</td><td class="left">'jojo'</td></tr>
-     <tr><td class="num">  74.9</td><td class="left">'AsuCaga'</td></tr>
-     <tr><td class="num">  78.2</td><td class="left">'colonel crayon'</td></tr>
-     <tr><td class="num">  79.9</td><td class="left">'Kroetchen'</td></tr>
-     <tr><td class="num">  80.1</td><td class="left">'Agares'</td></tr>
+     <tr><td class="num">  51.8</td><td class="left">'Slav'</td></tr>
+     <tr><td class="num">  51.9</td><td class="left">'Vaily'</td></tr>
+     <tr><td class="num">  53.1</td><td class="left">'Turbogurk'</td></tr>
+     <tr><td class="num">  53.1</td><td class="left">'Cyphase'</td></tr>
+     <tr><td class="num">  53.2</td><td class="left">'Neophilus'</td></tr>
+     <tr><td class="num">  55.5</td><td class="left">'krazy62'</td></tr>
+     <tr><td class="num">  56.3</td><td class="left">'Adonica'</td></tr>
+     <tr><td class="num">  56.7</td><td class="left">'Kadu'</td></tr>
+     <tr><td class="num">  58.9</td><td class="left">'Mecki'</td></tr>
+     <tr><td class="num">  59.7</td><td class="left">'Sopoforic'</td></tr>
+     <tr><td class="num">  61.7</td><td class="left">'Asbel'</td></tr>
+     <tr><td class="num">  63.5</td><td class="left">'Meeve'</td></tr>
+     <tr><td class="num">  66.0</td><td class="left">'ael'</td></tr>
+     <tr><td class="num">  66.3</td><td class="left">'Fred_the_wise'</td></tr>
+     <tr><td class="num">  66.4</td><td class="left">'Samuel'</td></tr>
+     <tr><td class="num">  66.8</td><td class="left">'schmusi20'</td></tr>
+     <tr><td class="num">  67.1</td><td class="left">'Sparkey'</td></tr>
+     <tr><td class="num">  67.4</td><td class="left">'Alf'</td></tr>
+     <tr><td class="num">  69.0</td><td class="left">'Magnus and Susi'</td></tr>
+     <tr><td class="num">  69.7</td><td class="left">'Zhura'</td></tr>
+     <tr><td class="num">  70.1</td><td class="left">'xmouse'</td></tr>
+     <tr><td class="num">  70.7</td><td class="left">'tasker'</td></tr>
+     <tr><td class="num">  71.7</td><td class="left">'Joona'</td></tr>
+     <tr><td class="num">  72.0</td><td class="left">'AQZ'</td></tr>
+     <tr><td class="num">  73.4</td><td class="left">'crypto_rsa'</td></tr>
+     <tr><td class="num">  73.9</td><td class="left">'Dvorhagen'</td></tr>
+     <tr><td class="num">  74.7</td><td class="left">'Eselchen'</td></tr>
+     <tr><td class="num">  74.9</td><td class="left">'Nicol?s'</td></tr>
+     <tr><td class="num">  74.9</td><td class="left">'jojo'</td></tr>
+     <tr><td class="num">  75.1</td><td class="left">'AsuCaga'</td></tr>
+     <tr><td class="num">  78.3</td><td class="left">'colonel crayon'</td></tr>
+     <tr><td class="num">  79.2</td><td class="left">'Kroetchen'</td></tr>
+     <tr><td class="num">  80.2</td><td class="left">'Agares'</td></tr>
      <tr><td class="num">  84.8</td><td class="left">'Miel56'</td></tr>
-     <tr><td class="num">  89.9</td><td class="left">'The red O'</td></tr>
-     <tr><td class="num">  90.0</td><td class="left">'Sequoyah'</td></tr>
-     <tr><td class="num">  92.2</td><td class="left">'Michael'</td></tr>
+     <tr><td class="num">  90.0</td><td class="left">'The red O'</td></tr>
+     <tr><td class="num">  90.1</td><td class="left">'Sequoyah'</td></tr>
+     <tr><td class="num">  92.3</td><td class="left">'Michael'</td></tr>
   </table>

Modified: homepage/input/table-rat.html
===================================================================
--- homepage/input/table-rat.html	2008-05-28 19:49:29 UTC (rev 1162)
+++ homepage/input/table-rat.html	2008-06-01 21:50:03 UTC (rev 1163)
@@ -1,22 +1,22 @@
   <table>
-    <caption>$$Rating_Statistics$$ $$April$$ 2008</caption>
+    <caption>$$Rating_Statistics$$ $$May$$ 2008</caption>
     <colgroup><col width="80"><col width="80"><col width="220"></colgroup>
     <tr><th>$$count$$</th><th>$$average$$</th><th class="left">$$user$$</th></tr>    <tr><td class="num">1062</td><td class="num"> 5.06</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1056</td><td class="num"> 4.83</td><td class="left">'Taztunes'</td></tr>
-    <tr><td class="num">921</td><td class="num"> 5.02</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num">974</td><td class="num"> 5.03</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num">873</td><td class="num"> 4.79</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">871</td><td class="num"> 5.09</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num">868</td><td class="num"> 4.79</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">653</td><td class="num"> 5.01</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num">628</td><td class="num"> 5.00</td><td class="left">'Moneymaker'</td></tr>
     <tr><td class="num">622</td><td class="num"> 4.22</td><td class="left">'shoki'</td></tr>
     <tr><td class="num">596</td><td class="num"> 4.82</td><td class="left">'U-Punkt'</td></tr>
-    <tr><td class="num">549</td><td class="num"> 5.13</td><td class="left">'dpl'</td></tr>
+    <tr><td class="num">552</td><td class="num"> 5.14</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">534</td><td class="num"> 4.97</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num">511</td><td class="num"> 5.30</td><td class="left">'Lukas'</td></tr>
     <tr><td class="num">487</td><td class="num"> 5.02</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num">448</td><td class="num"> 5.08</td><td class="left">'Johannes'</td></tr>
     <tr><td class="num">438</td><td class="num"> 4.23</td><td class="left">'Alexandros'</td></tr>
-    <tr><td class="num">431</td><td class="num"> 4.36</td><td class="left">'ged'</td></tr>
+    <tr><td class="num">433</td><td class="num"> 4.36</td><td class="left">'ged'</td></tr>
     <tr><td class="num">388</td><td class="num"> 4.86</td><td class="left">'Gloop'</td></tr>
     <tr><td class="num">369</td><td class="num"> 4.04</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num">307</td><td class="num"> 4.01</td><td class="left">'Sim_Ed'</td></tr>
@@ -31,7 +31,7 @@
     <tr><td class="num"> 97</td><td class="num"> 4.16</td><td class="left">'Safalra'</td></tr>
     <tr><td class="num"> 91</td><td class="num"> 4.41</td><td class="left">'Zhura'</td></tr>
     <tr><td class="num"> 85</td><td class="num"> 4.76</td><td class="left">'para_doks'</td></tr>
-    <tr><td class="num"> 72</td><td class="num"> 4.49</td><td class="left">'Kroetchen'</td></tr>
+    <tr><td class="num"> 75</td><td class="num"> 4.52</td><td class="left">'Kroetchen'</td></tr>
     <tr><td class="num"> 72</td><td class="num"> 5.63</td><td class="left">'Wuzzy'</td></tr>
     <tr><td class="num"> 62</td><td class="num"> 6.03</td><td class="left">'mecke'</td></tr>
     <tr><td class="num"> 51</td><td class="num"> 6.39</td><td class="left">'Little_Mole'</td></tr>
@@ -40,11 +40,13 @@
     <tr><td class="num"> 49</td><td class="num"> 4.90</td><td class="left">'hendrik'</td></tr>
     <tr><td class="num"> 43</td><td class="num"> 3.74</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 39</td><td class="num"> 6.08</td><td class="left">'mrduke'</td></tr>
+    <tr><td class="num"> 33</td><td class="num"> 3.39</td><td class="left">'Freshman'</td></tr>
     <tr><td class="num"> 33</td><td class="num"> 5.27</td><td class="left">'gringer'</td></tr>
     <tr><td class="num"> 31</td><td class="num"> 7.61</td><td class="left">'AkRa'</td></tr>
     <tr><td class="num"> 30</td><td class="num"> 4.40</td><td class="left">'Archcorenth'</td></tr>
     <tr><td class="num"> 25</td><td class="num"> 4.88</td><td class="left">'Drotten'</td></tr>
-    <tr><td class="num"> 23</td><td class="num"> 7.22</td><td class="left">'Mark P.'</td></tr>
+    <tr><td class="num"> 24</td><td class="num"> 7.13</td><td class="left">'Mark P.'</td></tr>
+    <tr><td class="num"> 19</td><td class="num"> 3.74</td><td class="left">'Eselchen'</td></tr>
     <tr><td class="num"> 17</td><td class="num"> 5.53</td><td class="left">'Jeffrey S'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 7.63</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 3.88</td><td class="left">'Mecki'</td></tr>
@@ -75,6 +77,7 @@
     <tr><td class="num">  1</td><td class="num"> 6.00</td><td class="left">'Slav'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 4.00</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'Uli'</td></tr>
+    <tr><td class="num">  1</td><td class="num"> 0.00</td><td class="left">'Fred_the_wise'</td></tr>
     <tr><td class="num">  1</td><td class="num">10.00</td><td class="left">'Cyphase'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'Harry Lim'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 2.00</td><td class="left">'Sequoyah'</td></tr>

Modified: homepage/input/table-solved.html
===================================================================
--- homepage/input/table-solved.html	2008-05-28 19:49:29 UTC (rev 1162)
+++ homepage/input/table-solved.html	2008-06-01 21:50:03 UTC (rev 1163)
@@ -1,22 +1,22 @@
   <table>
-    <caption>$$Solved_Level_Statistics$$ $$April$$ 2008</caption>
+    <caption>$$Solved_Level_Statistics$$ $$May$$ 2008</caption>
     <colgroup><col width="130"><col width="130"><col width="130"><col width="240"></colgroup>
     <tr><th>$$difficult$$</th><th>$$easy$$</th><th>$$total$$</th><th class="left">$$user$$</th></tr>
     <tr><td class="num">1045/1045</td><td class="num">189/189</td><td class="num">100.00%</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1043/1045</td><td class="num">189/189</td><td class="num"> 99.84%</td><td class="left">'Taztunes'</td></tr>
+    <tr><td class="num">1029/1045</td><td class="num">185/189</td><td class="num"> 98.38%</td><td class="left">'Freshman'</td></tr>
     <tr><td class="num">1029/1045</td><td class="num">183/189</td><td class="num"> 98.22%</td><td class="left">'Craven'</td></tr>
     <tr><td class="num">1031/1045</td><td class="num">179/189</td><td class="num"> 98.06%</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">1025/1045</td><td class="num">183/189</td><td class="num"> 97.89%</td><td class="left">'Freshman'</td></tr>
     <tr><td class="num">1016/1045</td><td class="num">182/189</td><td class="num"> 97.08%</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num">1021/1045</td><td class="num">177/189</td><td class="num"> 97.08%</td><td class="left">'Malla'</td></tr>
     <tr><td class="num">1014/1045</td><td class="num">175/189</td><td class="num"> 96.35%</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num"> 999/1045</td><td class="num">177/189</td><td class="num"> 95.30%</td><td class="left">'biotopa'</td></tr>
-    <tr><td class="num"> 988/1045</td><td class="num">175/189</td><td class="num"> 94.25%</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num"> 995/1045</td><td class="num">175/189</td><td class="num"> 94.81%</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num"> 977/1045</td><td class="num">173/189</td><td class="num"> 93.19%</td><td class="left">'dev0'</td></tr>
     <tr><td class="num"> 970/1045</td><td class="num">166/189</td><td class="num"> 92.06%</td><td class="left">'Andy'</td></tr>
     <tr><td class="num"> 949/1045</td><td class="num">170/189</td><td class="num"> 90.68%</td><td class="left">'para_doks'</td></tr>
     <tr><td class="num"> 945/1045</td><td class="num">172/189</td><td class="num"> 90.52%</td><td class="left">'Daisy'</td></tr>
     <tr><td class="num"> 947/1045</td><td class="num">169/189</td><td class="num"> 90.44%</td><td class="left">'mecke'</td></tr>
-    <tr><td class="num"> 925/1045</td><td class="num">169/189</td><td class="num"> 88.65%</td><td class="left">'dev0'</td></tr>
     <tr><td class="num"> 922/1045</td><td class="num">154/189</td><td class="num"> 87.20%</td><td class="left">'mrduke'</td></tr>
     <tr><td class="num"> 933/1045</td><td class="num">125/189</td><td class="num"> 85.74%</td><td class="left">'Alex'</td></tr>
     <tr><td class="num"> 914/1045</td><td class="num">135/189</td><td class="num"> 85.01%</td><td class="left">'JuSt'</td></tr>
@@ -34,13 +34,13 @@
     <tr><td class="num"> 938/1045</td><td class="num">  1/189</td><td class="num"> 76.09%</td><td class="left">'Ale'</td></tr>
     <tr><td class="num"> 772/1045</td><td class="num">113/189</td><td class="num"> 71.72%</td><td class="left">'U-Punkt'</td></tr>
     <tr><td class="num"> 739/1045</td><td class="num">131/189</td><td class="num"> 70.50%</td><td class="left">'ABS'</td></tr>
+    <tr><td class="num"> 740/1045</td><td class="num">123/189</td><td class="num"> 69.94%</td><td class="left">'dpl'</td></tr>
     <tr><td class="num"> 728/1045</td><td class="num">126/189</td><td class="num"> 69.21%</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num"> 755/1045</td><td class="num"> 96/189</td><td class="num"> 68.96%</td><td class="left">'brynn'</td></tr>
-    <tr><td class="num"> 730/1045</td><td class="num">121/189</td><td class="num"> 68.96%</td><td class="left">'dpl'</td></tr>
     <tr><td class="num"> 762/1045</td><td class="num"> 73/189</td><td class="num"> 67.67%</td><td class="left">'redsantz'</td></tr>
+    <tr><td class="num"> 710/1045</td><td class="num">116/189</td><td class="num"> 66.94%</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 734/1045</td><td class="num"> 82/189</td><td class="num"> 66.13%</td><td class="left">'bojster'</td></tr>
     <tr><td class="num"> 782/1045</td><td class="num"> 33/189</td><td class="num"> 66.05%</td><td class="left">'Sim_Ed'</td></tr>
-    <tr><td class="num"> 693/1045</td><td class="num">112/189</td><td class="num"> 65.24%</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 766/1045</td><td class="num"> 37/189</td><td class="num"> 65.07%</td><td class="left">'alfred69'</td></tr>
     <tr><td class="num"> 681/1045</td><td class="num"> 78/189</td><td class="num"> 61.51%</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 659/1045</td><td class="num"> 95/189</td><td class="num"> 61.10%</td><td class="left">'Marc-Hendrik'</td></tr>
@@ -53,9 +53,9 @@
     <tr><td class="num"> 569/1045</td><td class="num">113/189</td><td class="num"> 55.27%</td><td class="left">'Mark P.'</td></tr>
     <tr><td class="num"> 588/1045</td><td class="num"> 93/189</td><td class="num"> 55.19%</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 599/1045</td><td class="num"> 80/189</td><td class="num"> 55.02%</td><td class="left">'serpent'</td></tr>
+    <tr><td class="num"> 577/1045</td><td class="num">100/189</td><td class="num"> 54.86%</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 634/1045</td><td class="num"> 43/189</td><td class="num"> 54.86%</td><td class="left">'Klaus'</td></tr>
     <tr><td class="num"> 576/1045</td><td class="num"> 93/189</td><td class="num"> 54.21%</td><td class="left">'Guglielmo'</td></tr>
-    <tr><td class="num"> 565/1045</td><td class="num">100/189</td><td class="num"> 53.89%</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 525/1045</td><td class="num"> 95/189</td><td class="num"> 50.24%</td><td class="left">'ShadowPhrogg32642342'</td></tr>
     <tr><td class="num"> 589/1045</td><td class="num"> 26/189</td><td class="num"> 49.84%</td><td class="left">'hdwow'</td></tr>
     <tr><td class="num"> 533/1045</td><td class="num"> 82/189</td><td class="num"> 49.84%</td><td class="left">'Wuzzy'</td></tr>
@@ -71,7 +71,7 @@
     <tr><td class="num"> 506/1045</td><td class="num"> 12/189</td><td class="num"> 41.98%</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num"> 446/1045</td><td class="num"> 65/189</td><td class="num"> 41.41%</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num"> 503/1045</td><td class="num">  7/189</td><td class="num"> 41.33%</td><td class="left">'Edgar_Flesk'</td></tr>
-    <tr><td class="num"> 439/1045</td><td class="num"> 49/189</td><td class="num"> 39.55%</td><td class="left">'ged'</td></tr>
+    <tr><td class="num"> 440/1045</td><td class="num"> 50/189</td><td class="num"> 39.71%</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 390/1045</td><td class="num"> 93/189</td><td class="num"> 39.14%</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 467/1045</td><td class="num">  6/189</td><td class="num"> 38.33%</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num"> 438/1045</td><td class="num">  3/189</td><td class="num"> 35.74%</td><td class="left">'oblo'</td></tr>
@@ -95,8 +95,8 @@
     <tr><td class="num"> 281/1045</td><td class="num"> 63/189</td><td class="num"> 27.88%</td><td class="left">'erich'</td></tr>
     <tr><td class="num"> 295/1045</td><td class="num"> 29/189</td><td class="num"> 26.26%</td><td class="left">'Tiger'</td></tr>
     <tr><td class="num"> 288/1045</td><td class="num"> 36/189</td><td class="num"> 26.26%</td><td class="left">'Drotten'</td></tr>
+    <tr><td class="num"> 300/1045</td><td class="num"> 19/189</td><td class="num"> 25.85%</td><td class="left">'Nfol'</td></tr>
     <tr><td class="num"> 261/1045</td><td class="num"> 53/189</td><td class="num"> 25.45%</td><td class="left">'Andreas'</td></tr>
-    <tr><td class="num"> 287/1045</td><td class="num"> 18/189</td><td class="num"> 24.72%</td><td class="left">'Nfol'</td></tr>
     <tr><td class="num"> 269/1045</td><td class="num"> 26/189</td><td class="num"> 23.91%</td><td class="left">'Mecki'</td></tr>
     <tr><td class="num"> 276/1045</td><td class="num"> 15/189</td><td class="num"> 23.58%</td><td class="left">'Thomas'</td></tr>
     <tr><td class="num"> 245/1045</td><td class="num"> 36/189</td><td class="num"> 22.77%</td><td class="left">'B-man'</td></tr>
@@ -120,6 +120,7 @@
     <tr><td class="num"> 164/1045</td><td class="num">  0/189</td><td class="num"> 13.29%</td><td class="left">'Bent'</td></tr>
     <tr><td class="num"> 124/1045</td><td class="num"> 33/189</td><td class="num"> 12.72%</td><td class="left">'joseba'</td></tr>
     <tr><td class="num"> 127/1045</td><td class="num"> 29/189</td><td class="num"> 12.64%</td><td class="left">'ael'</td></tr>
+    <tr><td class="num"> 120/1045</td><td class="num"> 35/189</td><td class="num"> 12.56%</td><td class="left">'Kadu'</td></tr>
     <tr><td class="num"> 148/1045</td><td class="num">  5/189</td><td class="num"> 12.40%</td><td class="left">'Rugby4ever'</td></tr>
     <tr><td class="num"> 110/1045</td><td class="num"> 31/189</td><td class="num"> 11.43%</td><td class="left">'Cyphase'</td></tr>
     <tr><td class="num"> 124/1045</td><td class="num"> 15/189</td><td class="num"> 11.26%</td><td class="left">'Magnus and Susi'</td></tr>
@@ -127,9 +128,11 @@
     <tr><td class="num"> 105/1045</td><td class="num"> 22/189</td><td class="num"> 10.29%</td><td class="left">'Neophilus'</td></tr>
     <tr><td class="num">  89/1045</td><td class="num"> 24/189</td><td class="num">  9.16%</td><td class="left">'Zhura'</td></tr>
     <tr><td class="num"> 101/1045</td><td class="num">  0/189</td><td class="num">  8.18%</td><td class="left">'Alf'</td></tr>
+    <tr><td class="num">  84/1045</td><td class="num"> 15/189</td><td class="num">  8.02%</td><td class="left">'Eselchen'</td></tr>
+    <tr><td class="num">  79/1045</td><td class="num"> 10/189</td><td class="num">  7.21%</td><td class="left">'Kroetchen'</td></tr>
+    <tr><td class="num">  78/1045</td><td class="num"> 10/189</td><td class="num">  7.13%</td><td class="left">'Fred_the_wise'</td></tr>
     <tr><td class="num">  75/1045</td><td class="num"> 12/189</td><td class="num">  7.05%</td><td class="left">'schmusi20'</td></tr>
     <tr><td class="num">  67/1045</td><td class="num"> 19/189</td><td class="num">  6.97%</td><td class="left">'Dvorhagen'</td></tr>
-    <tr><td class="num">  75/1045</td><td class="num"> 10/189</td><td class="num">  6.89%</td><td class="left">'Kroetchen'</td></tr>
     <tr><td class="num">  83/1045</td><td class="num">  1/189</td><td class="num">  6.81%</td><td class="left">'tasker'</td></tr>
     <tr><td class="num">  57/1045</td><td class="num"> 26/189</td><td class="num">  6.73%</td><td class="left">'Meeve'</td></tr>
     <tr><td class="num">  65/1045</td><td class="num"> 16/189</td><td class="num">  6.56%</td><td class="left">'Slav'</td></tr>
@@ -141,6 +144,7 @@
     <tr><td class="num">  54/1045</td><td class="num"> 12/189</td><td class="num">  5.35%</td><td class="left">'Samuel'</td></tr>
     <tr><td class="num">  47/1045</td><td class="num"> 17/189</td><td class="num">  5.19%</td><td class="left">'crypto_rsa'</td></tr>
     <tr><td class="num">  44/1045</td><td class="num"> 16/189</td><td class="num">  4.86%</td><td class="left">'Agares'</td></tr>
+    <tr><td class="num">  33/1045</td><td class="num"> 23/189</td><td class="num">  4.54%</td><td class="left">'Sparkey'</td></tr>
     <tr><td class="num">  40/1045</td><td class="num"> 15/189</td><td class="num">  4.46%</td><td class="left">'Nicol?s'</td></tr>
     <tr><td class="num">  39/1045</td><td class="num"> 14/189</td><td class="num">  4.29%</td><td class="left">'jojo'</td></tr>
     <tr><td class="num">  31/1045</td><td class="num"> 10/189</td><td class="num">  3.32%</td><td class="left">'colonel crayon'</td></tr>

Modified: homepage/input/table-wr.html
===================================================================
--- homepage/input/table-wr.html	2008-05-28 19:49:29 UTC (rev 1162)
+++ homepage/input/table-wr.html	2008-06-01 21:50:03 UTC (rev 1163)
@@ -1,35 +1,35 @@
   <table>
-    <caption>$$Worldrecord_Statistics$$ $$April$$ 2008</caption>
+    <caption>$$Worldrecord_Statistics$$ $$May$$ 2008</caption>
     <colgroup><col width="80"><col width="80"><col width="470"></colgroup>
     <tr><th>$$total$$</th><th>$$shared$$</th><th class="left">$$user$$</th></tr>
-    <tr><td class="num">995</td><td class="num">238</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">161</td><td class="num"> 93</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num">118</td><td class="num">110</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num"> 79</td><td class="num"> 66</td><td class="left">'daydreamer'</td></tr>
-    <tr><td class="num"> 60</td><td class="num"> 42</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num">987</td><td class="num">236</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">160</td><td class="num"> 92</td><td class="left">'Stupid'</td></tr>
+    <tr><td class="num">116</td><td class="num">108</td><td class="left">'Johannes'</td></tr>
+    <tr><td class="num"> 83</td><td class="num"> 69</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num"> 59</td><td class="num"> 41</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num"> 51</td><td class="num"> 42</td><td class="left">'dev0'</td></tr>
     <tr><td class="num"> 47</td><td class="num"> 46</td><td class="left">'Great Scott'</td></tr>
     <tr><td class="num"> 45</td><td class="num"> 31</td><td class="left">'Malla'</td></tr>
-    <tr><td class="num"> 40</td><td class="num"> 34</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num"> 37</td><td class="num"> 24</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num"> 35</td><td class="num"> 27</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 35</td><td class="num"> 33</td><td class="left">'Django'</td></tr>
-    <tr><td class="num"> 34</td><td class="num"> 22</td><td class="left">'ryujun'</td></tr>
-    <tr><td class="num"> 33</td><td class="num"> 28</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 32</td><td class="num"> 26</td><td class="left">'Alexandros'</td></tr>
+    <tr><td class="num"> 32</td><td class="num"> 28</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 30</td><td class="num"> 29</td><td class="left">'joseba'</td></tr>
     <tr><td class="num"> 27</td><td class="num"> 26</td><td class="left">'Ghatotkacha'</td></tr>
-    <tr><td class="num"> 21</td><td class="num"> 19</td><td class="left">'ged'</td></tr>
+    <tr><td class="num"> 23</td><td class="num"> 18</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 20</td><td class="num"> 15</td><td class="left">'Emmanuel'</td></tr>
-    <tr><td class="num"> 20</td><td class="num"> 17</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 20</td><td class="num"> 19</td><td class="left">'Safalra'</td></tr>
+    <tr><td class="num"> 19</td><td class="num"> 16</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 19</td><td class="num"> 17</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num"> 17</td><td class="num"> 17</td><td class="left">'bojster'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 14</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 15</td><td class="num"> 15</td><td class="left">'ABS'</td></tr>
     <tr><td class="num"> 14</td><td class="num">  7</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num"> 11</td><td class="num">  8</td><td class="left">'Chocolate Zero'</td></tr>
-    <tr><td class="num"> 10</td><td class="num">  6</td><td class="left">'Taztunes'</td></tr>
     <tr><td class="num">  9</td><td class="num">  5</td><td class="left">'ShadowPhrogg32642342'</td></tr>
     <tr><td class="num">  9</td><td class="num">  9</td><td class="left">'fabian'</td></tr>
+    <tr><td class="num">  8</td><td class="num">  5</td><td class="left">'Taztunes'</td></tr>
     <tr><td class="num">  8</td><td class="num">  6</td><td class="left">'Gloop'</td></tr>
     <tr><td class="num">  8</td><td class="num">  8</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">  7</td><td class="num">  6</td><td class="left">'Edgar_Flesk'</td></tr>
@@ -44,7 +44,7 @@
     <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'geembo_90' + 'Tiza' + 'Neophilus' + 'Nicol?s' + 'Andy' + 'Sopoforic'</td></tr>
     <tr><td class="num">  2</td><td class="num">  1</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'Drotten' + 'tjRaven' + 'Sim_Ed' + 'hendrik' + 'Austin' + 'Snaily' + 'Antonio EE' + 'Ingo' + 'serpent'</td></tr>
-    <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'Ale' + 'Gorn' + 'Nat' + 'Daisy'</td></tr>
+    <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'Ale' + 'Sparkey' + 'Gorn' + 'Nat' + 'Daisy'</td></tr>
     <tr><td class="num">  1</td><td class="num">  1</td><td class="left">'alfred69' + 'Agares' + 'ntaeijr' + 'Tiger' + 'Zak' + 'Slav' + 'niebie' + 'Andreas' + 'Samuel' + 'Mark P.' + 'oblo' + 'hdwow' + 'B-man' + 'Asbel' + 'Vlad' + 'Vaily' + 'krazy62' + 'JuSt'</td></tr>
-    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'tasker' + 'Miel56' + 'Zhura' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'ael' + 'biotopa' + 'brynn' + 'IntKecsk' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'Kroetchen' + 'crypto_rsa' + 'Harry Lim' + 'Sequoyah' + 'AkRa' + 'Momcat' + 'NorthForty' + 'Mecki' + 'The red O' + 'gringer' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'shoki' + 'jojo' + 'rima' + 'Klaus' + 'Valkyrie2' + 'MicWa' + 'AsuCaga' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'mecke' + 'Dvorhagen' + 'Holger' + 'Ingo_K' + 'Ant' + 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Liam Sheehan' + 'Michael' + 'Tarim' + 'Agnieszka'</td></tr>
+    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'tasker' + 'Miel56' + 'Zhura' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'Eselchen' + 'ael' + 'biotopa' + 'brynn' + 'IntKecsk' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'Fred_the_wise' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'Kroetchen' + 'crypto_rsa' + 'Harry Lim' + 'Sequoyah' + 'AkRa' + 'Momcat' + 'NorthForty' + 'Mecki' + 'The red O' + 'gringer' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'Kadu' + 'shoki' + 'jojo' + 'rima' + 'Klaus' + 'Valkyrie2' + 'MicWa' + 'AsuCaga' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'mecke' + 'Dvorhagen' + 'Holger' + 'Ingo_K' + 'Ant' + 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Liam Sheehan' + 'Michael' + 'Tarim' + 'Agnieszka'</td></tr>
   </table>

Modified: homepage/input/userlist.html
===================================================================
--- homepage/input/userlist.html	2008-05-28 19:49:29 UTC (rev 1162)
+++ homepage/input/userlist.html	2008-06-01 21:50:03 UTC (rev 1163)
@@ -48,7 +48,9 @@
     <li>Edgar_Flesk</li>
     <li>Emmanuel</li>
     <li>erich</li>
+    <li>Eselchen</li>
     <li>fabian</li>
+    <li>Fred_the_wise</li>
     <li>Freshman</li>
     <li>ged</li>
     <li>geembo_90</li>
@@ -78,6 +80,7 @@
     <li>Joona</li>
     <li>joseba</li>
     <li>JuSt</li>
+    <li>Kadu</li>
     <li>Kevin</li>
     <li>Klaus</li>
     <li>Kosby</li>
@@ -131,6 +134,7 @@
     <li>Slav</li>
     <li>Snaily</li>
     <li>Sopoforic</li>
+    <li>Sparkey</li>
     <li>Stephanie</li>
     <li>Stupid</li>
     <li>Tarim</li>



From ral at mail.berlios.de  Fri Jun  6 00:33:37 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 6 Jun 2008 00:33:37 +0200
Subject: [Enigma-game-svn] r1164 - in trunk: data data/schemas src src/stones
Message-ID: <200806052233.m55MXbis007266@sheep.berlios.de>

Author: ral
Date: 2008-06-06 00:33:30 +0200 (Fri, 06 Jun 2008)
New Revision: 1164

Added:
   trunk/src/stones/ActorImpulseStone.cc
   trunk/src/stones/ActorImpulseStone.hh
Modified:
   trunk/data/api1init.lua
   trunk/data/api2init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/Object.cc
   trunk/src/WorldProxy.cc
   trunk/src/items.cc
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones/ClusterStone.cc
   trunk/src/stones/ClusterStone.hh
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering ActorImpulseStone 
- renaming to st_actorimpulse, st_actorimpulse_invisible
- new attribute "invisible"
- attribute "force" renamed to standard attribute "strength"
- global attribute "BumperForce" renamed to "BumperStrength"
- invisible actorimpulse are visible with glasses with SPOT_ACTORIMPULSE
- boulder stones are reflected on actorimpulse

- it_glasses_broken as it_glasses in state SPOT_NOTHING = 0

- Clusterstones: fix problems with reengineered neighbor stones - switch
  completly to new methods, avoid usage of obsolete get_kind()

Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/data/api1init.lua	2008-06-05 22:33:30 UTC (rev 1164)
@@ -55,6 +55,7 @@
     it_extralife = "it-extralife",
     it_floppy = "it-floppy",
     it_glasses = "it-glasses",
+    it_glasses_broken = "it-glasses-broken",
     it_hammer = "it-hammer",
     it_magnet = "it-magnet",
     it_magnet_on = "it-magnet-on",
@@ -68,6 +69,8 @@
     it_wormhole_on = "it-wormhole",
     it_wormhole_off = "it-wormhole-off",
     it_wrench = "it-wrench",
+    st_actorimpulse = "st-actorimpulse",
+    st_actorimpulse_invisible = "st-actorimpulse_invisible",
     st_blocker = "st-blocker",
     st_blocker_new = "st-blocker-growing",
     st_bluesand = "st-blue-sand",
@@ -313,6 +316,10 @@
      if key == "value" then
          _key = "coin_value"
      end
+     if key == "force" and (_obj_name == "st-actorimpulse" or
+             _obj_name == "st-actorimpulse_invisible")  then
+         _key = "strength"
+     end
      if key == "friction_factor" then
          _key = "friction"
      end
@@ -379,6 +386,10 @@
      if key == "value" then
          _key = "coin_value"
      end
+     if key == "force" and (_obj_name == "st-actorimpulse" or
+             _obj_name == "st-actorimpulse_invisible")  then
+         _key = "strength"
+     end
      if key == "friction_factor" then
          _key = "friction"
      end

Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/data/api2init.lua	2008-06-05 22:33:30 UTC (rev 1164)
@@ -107,6 +107,7 @@
 PERKIND       = 2
 
 -- glasses
+SPOT_NOTHING        =   0
 SPOT_DEATH          =   1
 SPOT_HOLLOW         =   2
 SPOT_ACTORIMPULSE   =   4

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/data/models-2d.lua	2008-06-05 22:33:30 UTC (rev 1164)
@@ -401,7 +401,6 @@
         "it-dynamite",
         "it-flagblack",
         "it-flagwhite",
-        "it-glasses-broken",
         "it-hill",
         "it-hollow",
         "it-hstrip",
@@ -436,6 +435,7 @@
     DefImage("it_extralife", {filename="it-extralife"})
     DefImage("it_floppy", {filename="it-floppy"})
     DefImage("it_glasses", {filename="it-glasses"})
+    DefImage("it_glasses_broken", {filename="it-glasses-broken"})
     DefImage("it_hammer", {filename="it-hammer"})
     DefImage("it_key", {filename="it-key"})
     DefImage("it_sword", {filename="it-sword"})

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/data/schemas/objects.xml	2008-06-05 22:33:30 UTC (rev 1164)
@@ -14,6 +14,11 @@
     <attr name="flavor" type="string" default="b" rw="rw"/>
     <attr name="friction" type="double" default="nil" rw="rw"/>
     <attr name="gradient" type="double" default="nil" rw="rw"/>
+    <attr name="hit_factor" type="double" default="nil" rw="rw"/>
+    <attr name="hit_distortion_xx" type="double" default="1" rw="rw"/>
+    <attr name="hit_distortion_xy" type="double" default="0" rw="rw"/>
+    <attr name="hit_distortion_yx" type="double" default="0" rw="rw"/>
+    <attr name="hit_distortion_yy" type="double" default="1" rw="rw"/>
     <attr name="instant" type="bool" default="false" rw="rw"/>
     <attr name="interval" type="double" default="1" rw="rw"/>
     <attr name="interval_s" type="double" default="3" rw="rw"/>
@@ -115,6 +120,9 @@
     <object name="it_glasses">
       <attr name="state" max="31"/>
     </object>
+    <object name="it_glasses_broken">
+      <attr name="state" value="0"/>
+    </object>
     <object name="it_hammer"/>
     <object name="it_hammer_new" init="true"/>
     <object name="it_key">
@@ -189,6 +197,21 @@
     <object name="st" abstract="true">
       <attr name="movable" rw="r"/>
     </object>
+    <object name="st_actorimpulse">
+      <attr name="invisible"/>
+      <attr name="strength" default="nil"/>
+      <attr name="hit_factor"/>
+      <attr name="hit_distortion_xx"/>
+      <attr name="hit_distortion_xy"/>
+      <attr name="hit_distortion_yx"/>
+      <attr name="hit_distortion_yy"/>
+      <msg name="_init"/>
+      <msg name="_model_reanimated"/>
+      <msg name="_trigger"/>
+    </object>
+    <object name="st_actorimpulse_invisible">
+      <attr name="invisible" value="true"/>
+    </object>
     <object name="st_blocker">
       <attr name="autoclose"/>
       <msg name="close"/>

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/Makefile.am	2008-06-05 22:33:30 UTC (rev 1164)
@@ -197,6 +197,8 @@
 	lev/ScoreManager.hh	\
 	lev/VolatileIndex.cc	\
 	lev/VolatileIndex.hh	\
+	stones/ActorImpulseStone.cc	\
+	stones/ActorImpulseStone.hh	\
 	stones/BlockerStone.cc	\
 	stones/BlockerStone.hh	\
 	stones/BoulderStone.cc	\

Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/Object.cc	2008-06-05 22:33:30 UTC (rev 1164)
@@ -114,7 +114,7 @@
     }
     
     const char * Object::get_kind() const {      // To be made pure virtual
-        AttribMap::const_iterator i = attribs.find("kind");        
+        AttribMap::const_iterator i = attribs.find("kind");
         ASSERT(i != attribs.end() && i->second.getType() == Value::STRING, XLevelRuntime,
                 "Object: attribute kind not found");
         return i->second.get_string();

Modified: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/WorldProxy.cc	2008-06-05 22:33:30 UTC (rev 1164)
@@ -63,7 +63,7 @@
             return Width();
         } else if (key == "Brittleness") {
             return server::Brittleness;
-        } else if (key == "BumperForce") {
+        } else if (key == "BumperStrength") {
             return server::BumperForce;
         } else if (key == "ElectricForce") {
             return server::ElectricForce;
@@ -77,7 +77,7 @@
             return server::HoleForce;
         } else if (key == "IceFriction") {
             return server::IceFriction;
-        } else if (key == "MagnetForce") {
+        } else if (key == "MagnetStrength") {
             return server::MagnetForce;
         } else if (key == "MagnetRange") {
             return server::MagnetRange;
@@ -89,7 +89,7 @@
             return server::SwampSinkSpeed;
         } else if (key == "WaterSinkSpeed") {
             return server::WaterSinkSpeed;
-        } else if (key == "WormholeForce") {
+        } else if (key == "WormholeStrength") {
             return server::WormholeForce;
         } else if (key == "WormholeRange") {
             return server::WormholeRange;
@@ -111,7 +111,7 @@
             STATUSBAR->show_move_counter (server::ShowMoves);
         } else if (key == "Brittleness") {
             server::Brittleness = val;
-        } else if (key == "BumperForce") {
+        } else if (key == "BumperStrength") {
             server::BumperForce = val;
         } else if (key == "ElectricForce") {
             server::ElectricForce = val;

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/items.cc	2008-06-05 22:33:30 UTC (rev 1164)
@@ -192,7 +192,6 @@
     DEF_ITEM(Key,       "it_key", it_key);
     DEF_ITEM(Odometer,  "it-odometer", it_odometer);
     DEF_ITEM(Wrench,    "it_wrench", it_wrench);
-    DEF_ITEM(BrokenGlasses, "it-glasses-broken", it_glasses_broken);
     DEF_ITEMF(Coffee,   "it-coffee", it_coffee, itf_inflammable);
 }
 
@@ -3433,7 +3432,7 @@
 /* -------------------- Glasses -------------------- */
     class Glasses : public Item {
         CLONEOBJ(Glasses);
-        DECL_TRAITS;
+        DECL_TRAITS_ARRAY(2, traitsIdx());
 
     public:
         enum Spot {
@@ -3447,18 +3446,25 @@
         };
         
         static void updateGlasses();
+        static void setup();
+                
+        Glasses(int initState);
         
-        Glasses();
-        
         // StateObject interface
         virtual int maxState() const;
         virtual void toggleState();
+        virtual void setState(int extState);
         
+        // GridObject interface
+        virtual void init_model();
+        
         // Items interface
         virtual void on_drop(Actor *a);
         virtual void on_pickup(Actor *a);
         virtual void on_stonehit(Stone *st);
         
+    private:
+        int traitsIdx() const;
     };
     
     void Glasses::updateGlasses() {
@@ -3475,10 +3481,15 @@
         }
     }
     
-    Glasses::Glasses() {
-        state = DEATH + HOLLOW + LIGHTPASSENGER;
+    void Glasses::setup() {
+        RegisterItem (new Glasses(0));
+        RegisterItem (new Glasses(DEATH + HOLLOW + LIGHTPASSENGER));
     }
     
+    Glasses::Glasses(int initState) {
+        state = initState;
+    }
+    
     int Glasses::maxState() const {
         return MAX;
     }
@@ -3487,6 +3498,24 @@
         // ignore toggle
     }
     
+    void Glasses::setState(int extState) {
+        state = extState;
+        if (isDisplayable()) {
+            init_model();
+        } else {
+            // maybe part of players inventory
+            updateGlasses();
+            player::RedrawInventory();
+        }
+    }
+    
+    void Glasses::init_model() {
+        if (state > 0)
+            set_model("it_glasses");
+        else
+            set_model("it_glasses_broken");
+    }
+    
     void Glasses::on_drop(Actor *a) {
         updateGlasses();
     }
@@ -3495,12 +3524,19 @@
     }
     void Glasses::on_stonehit(Stone *) {
         sound_event ("shatter");
-        replace(it_glasses_broken);
+        setState(0);
     }
         
-    DEF_TRAITS(Glasses, "it_glasses", it_glasses);
+    int Glasses::traitsIdx() const {
+        return state != 0 ? 0 : 1;
+    }
 
+    ItemTraits Glasses::traits[2] = {
+        {"it_glasses",  it_glasses,  itf_none},
+        {"it_glasses_broken",  it_glasses_broken,  itf_none}
+    };
 
+
 /* -------------------- Invisible abyss -------------------- */
 namespace
 {
@@ -4069,8 +4105,7 @@
     RegisterItem (new FlagBlack);
     RegisterItem (new FlagWhite);
     RegisterItem (new Floppy);
-    RegisterItem (new Glasses);
-    RegisterItem (new BrokenGlasses);
+    Glasses::setup();
     RegisterItem (new Hammer(false));
     Register ("it_hammer_new", new Hammer(true));
     RegisterItem (new Hill);
@@ -4096,7 +4131,6 @@
     RegisterItem (new SeedWood);
     RegisterItem (new SeedNowood);
     RegisterItem (new SeedVolcano);
-//    RegisterItem (new Sensor);
     Sensor::setup();
     ShogunDot::setup();
     SignalFilterItem::setup();

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/ox_extra.cc	2008-06-05 22:33:30 UTC (rev 1164)
@@ -182,7 +182,7 @@
     UNUSED,              // OxydExtra stone 0x39
     UNUSED,              // OxydExtra stone 0x3a
     UNUSED,              // OxydExtra stone 0x3b
-    "st-actorimpulse",   // OxydExtra stone 0x3c
+    "st_actorimpulse",   // OxydExtra stone 0x3c
     UNUSED,              // OxydExtra stone 0x3d
     "st-laser-1",        // OxydExtra stone 0x3e  The laser-names are fake names!
     "st-laser-2",        // OxydExtra stone 0x3f  Direction and state are generated by Enigma.

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/ox_magnum.cc	2008-06-05 22:33:30 UTC (rev 1164)
@@ -188,8 +188,8 @@
     UNUSED,                     // OxydMagnum stone 0x3f
     UNUSED,                     // OxydMagnum stone 0x40
     UNUSED,                     // OxydMagnum stone 0x41
-    "st-actorimpulse",          // OxydMagnum stone 0x42
-    "st-actorimpulse_invisible", // OxydMagnum stone 0x43
+    "st_actorimpulse",          // OxydMagnum stone 0x42
+    "st_actorimpulse_invisible", // OxydMagnum stone 0x43
     "st-laser-1",               // OxydMagnum stone 0x44  The laser-names are fake names!
     "st-laser-2",               // OxydMagnum stone 0x45  Direction and state are generated by Enigma.
     "st-laser-3",               // OxydMagnum stone 0x46

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/ox_oxyd1.cc	2008-06-05 22:33:30 UTC (rev 1164)
@@ -218,8 +218,8 @@
     "",                         // Oxyd1 stone 0x3f magic stone
     "",                         // Oxyd1 stone 0x40 magic stone
     "",                         // Oxyd1 stone 0x41 magic stone
-    "st-actorimpulse",          // Oxyd1 stone 0x42
-    "st-actorimpulse_invisible", // Oxyd1 stone 0x43
+    "st_actorimpulse",          // Oxyd1 stone 0x42
+    "st_actorimpulse_invisible", // Oxyd1 stone 0x43
     "st-laser-1",               // Oxyd1 stone 0x44  The laser-names are fake names!
     "st-laser-2",               // Oxyd1 stone 0x45  Direction and state are generated by Enigma.
     "st-laser-3",               // Oxyd1 stone 0x46

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/ox_peroxyd.cc	2008-06-05 22:33:30 UTC (rev 1164)
@@ -254,8 +254,8 @@
     "st-magic",                 // PerOxyd stone 0x39 ('st-magic')
     "st-magic",                 // PerOxyd stone 0x3a ('st-magic')
     "st-magic",                 // PerOxyd stone 0x3b ('st-magic')
-    "st-actorimpulse",          // PerOxyd stone 0x3c
-    "st-actorimpulse_invisible", // PerOxyd stone 0x3d
+    "st_actorimpulse",          // PerOxyd stone 0x3c
+    "st_actorimpulse_invisible", // PerOxyd stone 0x3d
     "st-laser-1",               // PerOxyd stone 0x3e  The laser-names are fake names!
     "st-laser-2",               // PerOxyd stone 0x3f  Direction and state are generated by Enigma.
     "st-laser-3",               // PerOxyd stone 0x40

Added: trunk/src/stones/ActorImpulseStone.cc
===================================================================
--- trunk/src/stones/ActorImpulseStone.cc	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/stones/ActorImpulseStone.cc	2008-06-05 22:33:30 UTC (rev 1164)
@@ -0,0 +1,167 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/ActorImpulseStone.hh"
+//#include "main.hh"
+#include "player.hh"
+#include "server.hh"
+
+namespace enigma {
+    ActorImpulseStone::ActorImpulseStone(bool isInvisible) : Stone () {
+        if (isInvisible)
+            objFlags |= OBJBIT_INVISIBLE;
+            
+        state = IDLE;
+    }
+
+    std::string ActorImpulseStone::getClass() const {
+        return "st_actorimpulse";
+    }
+        
+    void ActorImpulseStone::setAttr(const string& key, const Value &val) {
+        if (key == "invisible") {
+            if (val.to_bool() != ((objFlags & OBJBIT_INVISIBLE) != 0)) {
+                // change of visibility
+                objFlags ^= OBJBIT_INVISIBLE;
+                if (isDisplayable())
+                    init_model();
+            }
+        } else
+            Stone::setAttr(key, val);
+    }
+    
+    Value ActorImpulseStone::getAttr(const std::string &key) const {
+        if (key == "invisible") {
+            return (objFlags & OBJBIT_INVISIBLE) != 0;
+        } else
+            return Stone::getAttr(key);
+    }
+    
+    Value ActorImpulseStone::message(const Message &m) {
+        if (m.message == "_model_reanimated") {
+            state = IDLE;   // reset any running anim, be ready to bump again on new grid
+            init_model();   // visibility might have changed
+        } else if (m.message == "_trigger") {
+            // a boulder that we will send back
+            Object *boulder = m.sender;
+            if (boulder != NULL && m.value.to_bool()) {
+                boulder->setAttr("orientation", reverse(to_direction(boulder->getAttr("orientation"))));
+                sound_event("bumper");
+                state = PULSING;
+                set_anim("st-actorimpulse-anim");
+            }
+        } else if (m.message == "_glasses") {
+            init_model();
+            return Value();
+        } else if (server::GameCompatibility != GAMET_ENIGMA) {
+            // Oxyd* usage of ActorImpulseStone as a signal multiplier
+            ObjectList ol = getAttr("$!oxyd!destinations");
+            
+            if (m.message == "_init" && ol.size() > 0) {
+                setAttr("$signalidx", 0);
+                SendMessage(ol.front(), "signal", 1);
+                return Value();
+            } else if (m.message == "signal") {
+                int i = 0;
+                int signalidx = getAttr("$signalidx");
+                bool didBreak = false;
+                for (ObjectList::iterator oit = ol.begin(); oit != ol.end(); ++oit, i++) {
+                    if (i == signalidx) {
+                        SendMessage(*oit, "signal", 0);
+                    } else if (i == signalidx + 1) {
+                        SendMessage(*oit, "signal", 1);
+                        didBreak = true;
+                        break;
+                    }
+                }
+                if (!didBreak && ol.size() > 0) {
+                    SendMessage(ol.front(), "signal", 1);
+                    signalidx = 0;                        
+                } else
+                    signalidx++;
+                
+                setAttr("$signalidx", signalidx);
+                return Value();
+            }
+        } // GameCompatibility != GAMET_ENIGMA
+        return Stone::message(m);
+    }
+            
+    void ActorImpulseStone::setState(int extState) {
+        // ignore all state settings
+    }
+
+    void ActorImpulseStone::init_model() {
+        if (state == IDLE) {
+            if ((objFlags & OBJBIT_INVISIBLE) && ((server::GlassesVisibility & 4) == 0))
+                set_model("invisible");
+            else
+                set_model("st-actorimpulse");
+        }
+        // PULSING anim is always visible and should continue independent on init_model calls
+    }
+    
+    void ActorImpulseStone::animcb() {
+        if (state == PULSING) {
+            state = IDLE;
+            init_model();
+        }
+    }
+    
+    void ActorImpulseStone::actor_hit(const StoneContact &sc) {
+        if ((objFlags & OBJBIT_INVISIBLE) && player::WieldedItemIs(sc.actor, "it_brush")) {
+            objFlags &= ~OBJBIT_INVISIBLE;
+        }
+        if (state == IDLE) {
+            // actor_hit is called before reflect, but the force added below
+            // is applied to actor after the reflection.
+
+            double forcefac = getDefaultedAttr("strength", server::BumperForce);
+
+            V2 vec = normalize(sc.actor->get_pos() - get_pos().center());
+            sc.actor->add_force(distortedVelocity(vec, forcefac));                
+
+            sound_event("bumper");
+            state = PULSING;
+            set_anim("st-actorimpulse-anim");
+        }
+    }
+
+    const char *ActorImpulseStone::collision_sound() {
+        // no general sound - just a sound if really bumping
+        return "";
+    }
+
+    int ActorImpulseStone::traitsIdx() const {
+        return (objFlags & OBJBIT_INVISIBLE) ? 1 : 0;
+    }
+
+    
+    StoneTraits ActorImpulseStone::traits[2] = {
+        {"st_actorimpulse", st_INVALID, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_actorimpulse_invisible", st_INVALID, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+    };
+    
+    BOOT_REGISTER_START
+        BootRegister(new ActorImpulseStone(false), "st_actorimpulse");
+        BootRegister(new ActorImpulseStone(true), "st_actorimpulse_invisible");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/ActorImpulseStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/ActorImpulseStone.hh
===================================================================
--- trunk/src/stones/ActorImpulseStone.hh	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/stones/ActorImpulseStone.hh	2008-06-05 22:33:30 UTC (rev 1164)
@@ -0,0 +1,72 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef ACTORIMPULSESTONE_HH
+#define ACTORIMPULSESTONE_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class ActorImpulseStone : public Stone {
+        CLONEOBJ(ActorImpulseStone);
+        DECL_TRAITS_ARRAY(2, traitsIdx());
+    private:
+        enum iState {
+            IDLE,     ///< 
+            PULSING   ///< 
+        };
+        
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_INVISIBLE   =   1<<24,  ///< Object is invisible 
+        };
+    public:
+        ActorImpulseStone(bool isInvisible);
+        
+        // Object interface
+        virtual std::string getClass() const;
+        virtual void setAttr(const string& key, const Value &val);
+        virtual Value getAttr(const std::string &key) const;
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+        virtual const char *collision_sound();
+
+    private:
+        int traitsIdx() const;
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/ActorImpulseStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones/ClusterStone.cc
===================================================================
--- trunk/src/stones/ClusterStone.cc	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/stones/ClusterStone.cc	2008-06-05 22:33:30 UTC (rev 1164)
@@ -21,10 +21,15 @@
 //#include "main.hh"
 
 namespace enigma {
-    ClusterStone::ClusterStone(std::string classname, std::string connections) : Stone(classname.c_str()) {
+    ClusterStone::ClusterStone(std::string classname, std::string connections) : Stone() {
         setAttr("connections", connections);
+        setAttr("$class", classname);
     }
     
+    std::string ClusterStone::getClass() const {
+        return getAttr("$class").to_string();
+    }
+    
     void ClusterStone::setAttr(const string& key, const Value &val) {
         if (key == "connections" || key == "faces" || key == "cluster") {
             Stone::setAttr(key, val);
@@ -53,6 +58,10 @@
         autoLeaveCluster();
         Stone::on_removal(p);
     }
+    
+    std::string ClusterStone::getModelName() const {
+        return getClass();
+    }
 
     bool ClusterStone::is_removable() const {
         return getFaces() == ALL_DIRECTIONS;
@@ -64,7 +73,7 @@
         for (int i = WEST; i <= NORTH; i++) {
             Direction d = (Direction) i;
             Stone *neighbour = GetStone(move(p, d));
-            if (neighbour != NULL && std::string(neighbour->get_kind()) == get_kind()) {
+            if (neighbour != NULL && std::string(neighbour->getClass()) == getClass()) {
                 Value neighbourCluster = neighbour->getAttr("cluster");
                 if (myCluster) {
                     if (myCluster == neighbourCluster) {
@@ -92,7 +101,7 @@
         for (int i = WEST; i <= NORTH; i++) {
             Direction d = (Direction) i;
             Stone *neighbour = GetStone(move(p, d));
-            if (neighbour != NULL && std::string(neighbour->get_kind()) == get_kind() 
+            if (neighbour != NULL && std::string(neighbour->getClass()) == getClass() 
                     && neighbour->getAttr("cluster")) {
                 neighbour->setAttr("$connections", neighbour->getConnections() & (ALL_DIRECTIONS ^ to_bits(reverse(d))));
             }

Modified: trunk/src/stones/ClusterStone.hh
===================================================================
--- trunk/src/stones/ClusterStone.hh	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/stones/ClusterStone.hh	2008-06-05 22:33:30 UTC (rev 1164)
@@ -34,12 +34,15 @@
         ClusterStone(std::string classname, std::string connections);
         
         // Object interface
+        virtual std::string getClass() const;
         virtual void setAttr(const string& key, const Value &val);
         virtual Value message(const Message &m);
+        
         // GridObject interface
         virtual void on_creation(GridPos p);
         virtual void on_removal(GridPos p);
-                
+        virtual std::string getModelName() const;
+        
         // Stone interface
         virtual bool is_removable() const;
         

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-06-01 21:50:03 UTC (rev 1163)
+++ trunk/src/stones_simple.cc	2008-06-05 22:33:30 UTC (rev 1164)
@@ -1432,114 +1432,6 @@
     return Stone::message(m);
 }
 
-// -------------------------
-//      ActorImpulseBase
-// -------------------------
-
-namespace
-{
-    class ActorImpulseBase : public Stone {
-    public:
-        ActorImpulseBase(const char *kind) : Stone(kind), state(IDLE) {
-//             setAttr("force", Value());
-        }
-
-    protected:
-        virtual void actor_hit (const StoneContact &sc) {
-            if (state == IDLE) {
-                // actor_hit is called before reflect, but the force added below
-                // is applied to actor after the reflection.
-
-                double forcefac = getDefaultedAttr("force", server::BumperForce);
-
-                V2 vec = normalize(sc.actor->get_pos() - get_pos().center());
-                sc.actor->add_force (distortedVelocity(vec, forcefac));                
-
-                sound_event("bumper");
-                set_anim("st-actorimpulse-anim");
-                state = PULSING;
-            }
-        }
-
-    private:
-        virtual const char *collision_sound() {
-            return "";
-        }
-
-        void animcb() {
-            if (state == PULSING) {
-                state = IDLE;
-                init_model();
-            }
-        }
-
-        // Variables
-        enum State { IDLE, PULSING, BROKEN };
-        State state;
-    };
-
-
-    class ActorImpulseStone : public ActorImpulseBase {
-        CLONEOBJ(ActorImpulseStone);
-
-        int signalidx;
-
-        virtual Value message(const Message &m) {
-            if(server::GameCompatibility != GAMET_ENIGMA) {
-                // Oxyd* usage of ActorImpulseStone as a signal multiplier
-                ObjectList ol = getAttr("$!oxyd!destinations");
-                
-                if (m.message == "_init" && ol.size() > 0) {
-                    signalidx = 0;
-                    SendMessage(ol.front(), "signal", 1);
-                    return Value();
-                } else if (m.message == "signal") {
-                    int i = 0;
-                    bool didBreak = false;
-                    for (ObjectList::iterator oit = ol.begin(); oit != ol.end(); ++oit, i++) {
-                        if (i == signalidx) {
-                            SendMessage(*oit, "signal", 0);
-                        } else if (i == signalidx + 1) {
-                            SendMessage(*oit, "signal", 1);
-                            didBreak = true;
-                            break;
-                        }
-                    }
-                    if (!didBreak && ol.size() > 0) {
-                        SendMessage(ol.front(), "signal", 1);
-                        signalidx = 0;                        
-                    } else
-                        signalidx++;
-                    return Value();
-                }
-            } // GameCompatibility != GAMET_ENIGMA
-            return ActorImpulseBase::message(m);
-        }
-
-    public:
-        ActorImpulseStone() : ActorImpulseBase("st-actorimpulse"),
-                              signalidx(0)
-        {}
-    };
-
-
-    class ActorImpulseStoneInvisible : public ActorImpulseBase {
-        CLONEOBJ(ActorImpulseStoneInvisible);
-    public:
-        ActorImpulseStoneInvisible() : ActorImpulseBase("st-actorimpulse_invisible") {}
-
-        void actor_hit(const StoneContact& sc) {
-            if (player::WieldedItemIs (sc.actor, "it_brush")) {
-                Stone *st = MakeStone("st-actorimpulse");
-                SetStone(get_pos(), st);
-                st->actor_hit(sc);
-            }
-            else
-                ActorImpulseBase::actor_hit(sc);
-        }
-    };
-}
-
 //----------------------------------------
 // FakeOxydStone
 //----------------------------------------
@@ -2193,9 +2085,6 @@
 
 void Init_simple()
 {
-    Register(new ActorImpulseStone);
-    Register(new ActorImpulseStoneInvisible);
-
     BlackWhiteStone::setup();
 
     Register(new BlockStone);



From ral at mail.berlios.de  Sat Jun  7 00:17:27 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 7 Jun 2008 00:17:27 +0200
Subject: [Enigma-game-svn] r1165 - in trunk/src: . stones
Message-ID: <200806062217.m56MHRSl018137@sheep.berlios.de>

Author: ral
Date: 2008-06-07 00:17:26 +0200 (Sat, 07 Jun 2008)
New Revision: 1165

Modified:
   trunk/src/lua.cc
   trunk/src/stones.hh
   trunk/src/stones/ActorImpulseStone.cc
Log:
Trunk 1.1: new API reengineering
- fix ActorImpulseStone: add internal stone enum for compatibility issues
- add new Lua userdata "DEFAULT" that resolves to a nil value in C++
  - this value can be used in Lua table instead of "nil"


Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-06-05 22:33:30 UTC (rev 1164)
+++ trunk/src/lua.cc	2008-06-06 22:17:26 UTC (rev 1165)
@@ -60,6 +60,7 @@
 #define LUA_ID_GROUP    "_GROUP"
 #define LUA_ID_TILES    "_TILES"
 #define LUA_ID_TILE     "_TILE"
+#define LUA_ID_DEFAULT  "_DEFAULT"
 /**
  * The tile dictionary or function that should be used to resolve tile keys.
  */
@@ -190,6 +191,11 @@
     return lua_isuserdata(L,idx) && checkMetadata(L, idx, LUA_ID_WORLD);
 }
 
+static bool is_default(lua_State *L, int idx) {
+    return lua_isuserdata(L,idx) && checkMetadata(L, idx, LUA_ID_DEFAULT);
+}
+
+
 static Object *to_object(lua_State *L, int idx) {
     
     if (lua_isnil(L,idx) && server::EnigmaCompatibility < 1.10)
@@ -388,6 +394,8 @@
                 return Value(toObjectList(L, idx));
             else  if (is_position(L, idx))
                 return Value(toPosition(L, idx));
+            else  if (is_default(L, idx))
+                return Value();
         case LUA_TTABLE: {
             TokenList tokens;
             int i = 1;
@@ -2555,6 +2563,21 @@
     }
 }
 
+MethodMap defaultMethodeMap;
+
+static int pushNewDefault(lua_State *L) {
+    // tiles is a singleton
+    
+    int *udata;
+    udata=(int *)lua_newuserdata(L,sizeof(int));   // user object
+    *udata = 1;  // dummy
+    
+    luaL_getmetatable(L, LUA_ID_DEFAULT);
+    lua_setmetatable(L, -2);
+    return 1;
+}
+
+
 static CFunction globalfuncs[] = {
     {FindDataFile,          "FindDataFile"},
 //    {lua::PlaySoundGlobal,  "PlaySoundGlobal"},
@@ -2745,7 +2768,15 @@
     {0,0}
 };
 
+static CFunction defaultOperations[] = {
+    {0,0}
+};
 
+static CFunction defaultMethods[] = {
+    {0,0}
+};
+
+
 /* -------------------- lua:: functions -------------------- */
 
 int FindDataFile (lua_State *L) 
@@ -3041,6 +3072,7 @@
     RegisterLuaType(L, LUA_ID_TILE, tileOperations, tileMethods, tileMethodeMap);
     RegisterLuaType(L, LUA_ID_TILES, tilesOperations, tilesMethods, tilesMethodeMap);
     RegisterLuaType(L, LUA_ID_GROUP, groupOperations, groupMethods, groupMethodeMap);
+    RegisterLuaType(L, LUA_ID_DEFAULT, defaultOperations, defaultMethods, defaultMethodeMap);
     
     pushNewNamedObj(L);
     RegisterObject(L, "no");
@@ -3051,6 +3083,9 @@
     pushNewTiles(L);
     RegisterObject(L, "ti");
     
+    pushNewDefault(L);
+    RegisterObject(L, "DEFAULT");
+    
     return L;
 }
 

Modified: trunk/src/stones/ActorImpulseStone.cc
===================================================================
--- trunk/src/stones/ActorImpulseStone.cc	2008-06-05 22:33:30 UTC (rev 1164)
+++ trunk/src/stones/ActorImpulseStone.cc	2008-06-06 22:17:26 UTC (rev 1165)
@@ -155,8 +155,8 @@
 
     
     StoneTraits ActorImpulseStone::traits[2] = {
-        {"st_actorimpulse", st_INVALID, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
-        {"st_actorimpulse_invisible", st_INVALID, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_actorimpulse", st_actorimpulse, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_actorimpulse_invisible", st_actorimpulse_invisible, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
     };
     
     BOOT_REGISTER_START

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-06-05 22:33:30 UTC (rev 1164)
+++ trunk/src/stones.hh	2008-06-06 22:17:26 UTC (rev 1165)
@@ -23,7 +23,6 @@
 
 namespace enigma {
     
-//    using namespace enigma;
     struct Impulse;
     struct StoneContact;
 
@@ -32,6 +31,8 @@
         st_FIRST = 0,
         st_none = 0,
 
+        st_actorimpulse,
+        st_actorimpulse_invisible,
         st_borderstone,
         st_black1,
         st_black2,



From ral at mail.berlios.de  Sat Jun  7 11:29:22 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 7 Jun 2008 11:29:22 +0200
Subject: [Enigma-game-svn] r1166 - team_levelpacks/team_test_new_api
Message-ID: <200806070929.m579TMcB014342@sheep.berlios.de>

Author: ral
Date: 2008-06-07 11:29:22 +0200 (Sat, 07 Jun 2008)
New Revision: 1166

Added:
   team_levelpacks/team_test_new_api/ralD003_1.xml
   team_levelpacks/team_test_new_api/ralT050_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT029_1.xml
   team_levelpacks/team_test_new_api/ralT049_1.xml
Log:
Test Level new API:
- add actorimpulse/DEFAULT test level
- add demo level shuffleOxyd
- update glasses test level


Added: team_levelpacks/team_test_new_api/ralD003_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD003_1.xml	2008-06-06 22:17:26 UTC (rev 1165)
+++ team_levelpacks/team_test_new_api/ralD003_1.xml	2008-06-07 09:29:22 UTC (rev 1166)
@@ -0,0 +1,55 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Demo Oxyd Shuffling" el:subtitle="" el:id="20080530ral108"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = false
+
+ti["~"] = {"fl-water"}
+ti[" "] = {"fl-plank"}
+ti["c"] = {"it-crack3", brittleness=0}
+ti["^"] = {"st-oneway-n"}
+ti["1"] = {"ac-blackball", 0, 0.5}
+
+ti["x"] = {"st_oxyd", "island#"}
+ti["y"] = {"st_oxyd", "left#"}
+ti["z"] = {"st_oxyd", "right#"}
+
+w, h = wo(ti, " ", {
+"~~x  x  x  x  x  x~~",
+"~~                ~~",
+"~~~~^~~~~~~~~~~^~~~~",
+"y       ~~~~       z",
+"~       cccc       ~",
+"y       ~~~~       z",
+"~       cccc       ~",
+"y       ~~~~       z",
+"~       cccc       ~",
+"y       ~~~~       z",
+"~~~~c~~~~~~~~~~c~~~~",
+"~~                ~~",
+"~~        1       ~~"
+})
+
+wo:shuffleOxyd({"island#*", min=3, linear=true}, {"left#*","right#*", max=2, min=2})
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralD003_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Modified: team_levelpacks/team_test_new_api/ralT029_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT029_1.xml	2008-06-06 22:17:26 UTC (rev 1165)
+++ team_levelpacks/team_test_new_api/ralT029_1.xml	2008-06-07 09:29:22 UTC (rev 1166)
@@ -31,6 +31,7 @@
 
 ti["8"] = ti[" "] .. {"st_brick", cluster=8}
 ti["9"] = ti[" "] .. {"st_brick", cluster=9}
+ti["0"] = ti[" "] .. {"st_panel", cluster=9}
 
 ti["P"] = ti[" "] .. {"st_panel"}
 ti["Q"] = ti[" "] .. {"st_panel_n"}
@@ -63,8 +64,8 @@
 " 8             c    ",
 "889          11111  ",
 "8999  222    11x21  ",
-"889   1|1     1221  ",
-"999   111     1111  "
+"8890  1|1     1221  ",
+"9990  111     1111  "
 })
 
 

Modified: team_levelpacks/team_test_new_api/ralT049_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT049_1.xml	2008-06-06 22:17:26 UTC (rev 1165)
+++ team_levelpacks/team_test_new_api/ralT049_1.xml	2008-06-07 09:29:22 UTC (rev 1166)
@@ -25,7 +25,7 @@
 ti["H"] = {"st-camouflage_hole"}
 ti["L"] = {"st_lightpassenger", state=OFF}
 ti["l"] = {"st_switch", target="newlp"}
-ti["A"] = {"st-actorimpulse_invisible"}
+ti["A"] = {"st_actorimpulse_invisible"}
 ti["S"] = {"it_sensor", invisible=true}
 ti["#"] = {"st-wood"}
 ti["N"] = {"st_laser_n", "laser", state=OFF}
@@ -39,6 +39,10 @@
 ti["s"] = {"it_glasses", state=SPOT_SENSOR}
 ti["a"] = {"it_glasses", state=SPOT_ACTORIMPULSE}
 
+
+ti["x"] = {"it_glasses", "myglasses"}
+ti["X"] = {"st_switch", target="breakglasses"}
+
 ti["b"] = {"it-bag"}
 ti["y"] = {"it-yinyang"}
 ti["1"] = ti["y"] .. {"#ac-blackball"} 
@@ -50,8 +54,8 @@
 " f       Nn       g ",
 "                    ",
 "                    ",
-"         G          ",
-"     b  1  2  b     ",
+"         G         x",
+"#    b  1  2  b    X",
 "                    ",
 "                    ",
 "                    ",
@@ -63,6 +67,10 @@
 function newlp(value, sender)
     wo[sender - {1,0}] = ti["L"]
 end
+
+function breakglasses(value, sender)
+    no["myglasses"]["state"] = SPOT_NOTHING
+end
   ]]></el:luamain>
     <el:i18n>
 	 <el:string el:key="title">

Added: team_levelpacks/team_test_new_api/ralT050_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT050_1.xml	2008-06-06 22:17:26 UTC (rev 1165)
+++ team_levelpacks/team_test_new_api/ralT050_1.xml	2008-06-07 09:29:22 UTC (rev 1166)
@@ -0,0 +1,66 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Actorimpulse new API" el:subtitle="" el:id="20080605ral607"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["A"] = {"st_actorimpulse"}
+ti["a"] = {"st_actorimpulse_invisible"}
+
+ti["B"] = {"st_boulder_e"}
+ti["C"] = {"st_actorimpulse", strength=1000}
+ti["D"] = {"st_actorimpulse", strength=600, hit_distortion_xx=0, hit_distortion_xy=1, hit_distortion_yx=-1, hit_distortion_yy=0}
+
+ti["b"] = {"it_brush"}
+ti["G"] = {"it_glasses"}
+ti["g"] = {"it_glasses", state=SPOT_ACTORIMPULSE}
+
+
+ti["1"] = {"#ac-blackball"} 
+
+
+ti["w"] = {"it-magicwand"}
+ti["c"] = {"st-chess_black"}
+ti["3"] = {"#ac-blackball", player=DEFAULT, controllers=0}
+ti["4"] = {"#ac-whiteball", player=DEFAULT, controllers=0}
+
+
+w, h = wo(ti, " ", {
+"A    B   Aa    B   a",
+"                    ",
+"A      g 1 b       a",
+"A                  a",
+"A    C       D     a",
+"   3                ",
+"c    w              ",
+"   4                ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    "
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT050_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Sat Jun  7 11:32:31 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 7 Jun 2008 11:32:31 +0200
Subject: [Enigma-game-svn] r1167 - trunk/doc/reference
Message-ID: <200806070932.m579WVRr014481@sheep.berlios.de>

Author: ral
Date: 2008-06-07 11:32:30 +0200 (Sat, 07 Jun 2008)
New Revision: 1167

Modified:
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk 1.1: new API reengineering
- refman update (shuffleOxyd, DEFAULT, common attributes,
  all new objects)

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-06-07 09:29:22 UTC (rev 1166)
+++ trunk/doc/reference/enigma-ref.texi	2008-06-07 09:32:30 UTC (rev 1167)
@@ -3002,7 +3002,7 @@
 @item int
 @item double
 @item string
- at item nil
+ at item nil, DEFAULT
 @item position
 @item object
 @item group
@@ -3022,9 +3022,32 @@
 @samp{nil} it will be set to its default, which is actually @samp{NORTH}, an
 enumerated direction value. A subsequent read of the attribute will return this
 value. Just those attributes that allow a nil value will ever return @samp{nil}
-on a read access. Aa a direct consequence these attributes always default to 
+on a read access. As a direct consequence these attributes always default to 
 @samp{nil}.
 
+The authors of Lua did decide to prohibit the usage of @samp{nil} as a value
+in Lua tables. As we make heavy usage of anonymous tables as object 
+declarations, you would not be able to set such attributes to @samp{nil}. You
+would need to set such attributes explicitly. As a workaround we added a custom
+value @samp{DEFAULT} that can be used anywhere to set attributes - even within
+Lua tables.
+
+ at example
+mySwitch["color"] = nil
+mySwitch["color"] = DEFAULT
+wo[{3,6}] = @{"ac_marble_black", player=DEFAULT@}
+ at end example
+
+Note that @samp{DEFAULT} is not equal to @samp{nil}. They are different values
+concerning Lua. They just result both in attributes reset to their default. If
+you request a nil valued attribute you will always receive the Lua value
+ at samp{nil}. @samp{DEFAULT} will never be returned by the engine.
+
+A group is an ordered set of @ref{Object Reference}s. As all contained objects
+must exist this value is seldomly used for attributes in object declarations.
+But is is very useful for postprocessing of objects and for usage within
+ at ref{Callback Function}s.
+
 The most complex attribute value type are the tokens. Their purpose is the
 specification of one or many objects. As Enigma provides several means to do
 that this value type combines and mix all possibilities. A tokens value may 
@@ -3622,6 +3645,7 @@
 * inverse::
 * destination::
 * movable::
+* hit_*::
 @end menu
 
 @node name
@@ -3652,15 +3676,91 @@
 @node state
 @subsection state
 
+The central attribute of any object that describes the current state of an 
+object in its standard life cycle. This @ref{Object State} is described by
+a simple number. Most dynamic objects have just 2 states. Others may have more.
+The available states are listed with each object. This universal attribute
+allows common messages like @ref{toggle}, @ref{signal}, @ref{on}, @ref{off},
+ at ref{open}, @ref{close}. 
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ dependend on the individual object
+Please use the given upper case constants.
+ at item @b{Default:} @ @ @code{0}
+ at item @b{Access:} @ @ read/sometimes write
+While it is common to set the state attribute on object creation, it is 
+preferable to change the object state lateron by messages.
+ at item @b{Support:} @ @ by all objects
+ at end table
+
 @node target
 @subsection target
 
+All active objects react on being triggered by performing an action on their
+targets. This attribute is part of the @ref{Target - Action} paradigm that 
+guarantees pluggability of objects. You can either set a general @samp{target}
+attribute for an object, or you can set @ref{state} dependant attributes 
+ at samp{target_0}, @samp{target_1},... (@pxref{Object State}). They all have the
+same syntax:
+
+ at table @asis
+ at item @b{Type:} @ @ string, object, group, tokens @ @ @xref{Object Description}
+Single targets may be declared by their object name or their reference. Multiple
+targets can be declared by usage of groups and tokens.
+ at item @b{Values:} @ @ @xref{Object Attributes}
+ at example
+target = "myDoor"
+target = myObject
+target = @{"myDoor", myObject@}
+target = @{grp(obj1, obj2), "myDoor", myObject@}
+ at end example
+
+ at item @b{Default:} @ @ @code{nil}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ by all objects
+ at end table
+
 @node action
 @subsection action
 
+All active objects react on being triggered by performing an action on their
+targets. This attribute is part of the @ref{Target - Action} paradigm that 
+guarantees pluggability of objects. You can either set a general @samp{action}
+attribute for an object, or you can set @ref{state} dependant attributes 
+ at samp{action_0}, @samp{action_1},... (@pxref{Object State}). They all have the
+same syntax:
+
+ at table @asis
+ at item @b{Type:} @ @ string, tokens of strings @ @ @xref{Target - Action}
+A single action may be declared by its message string. Multiple actions that
+match multiple targets can be declared by tokens of strings.
+ at item @b{Values:} @ @ @xref{Object Attributes}
+ at example
+action = "open"
+action = @{"open", "turn", "toggle"@}
+ at end example
+
+ at item @b{Default:} @ @ @code{nil}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ by all objects
+ at end table
+
 @node nopaction
 @subsection nopaction
 
+A very special addition to the @ref{Target - Action} paradigm that allows
+in case of state specific actions to deny the sending of default messages
+(@pxref{Object State}).
+
+ at table @asis
+ at item @b{Type:} @ @ bool
+ at item @b{Values:} @ @ @code{true}, @code{false}
+ at item @b{Default:} @ @ @code{false}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ by all objects
+ at end table
+
 @node inverse
 @subsection inverse
 
@@ -3730,7 +3830,32 @@
 @item @b{Support:} @ @ by all stones
 @end table
 
+ at node hit_*
+ at subsection hit_*
 
+A set of attributes that allow you to distort hit forces. Objects like 
+ at ref{st_flash}, @ref{st_spitter} and @ref{st_actorimpulse} apply forces that
+are either based on the hit velocity or the position. 
+
+By usage of a simple @samp{hit_factor} you can increase, decrease or invert the
+default factor. Note that you must not set this attribute, if you want to use
+the default.
+
+By setting the four attributes @samp{hit_distortion_xx}, @samp{hit_distortion_xy},
+ at samp{hit_distortion_yx} and @samp{hit_distortion_yy} you can describe a 
+matrix to set up a new direction. These attributes default to 1, 0, 0, 1. 
+A 90 degree clockwise turn is described by 0, 1, -1, 0.
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ 
+ at item @b{Default:} @ @ factor - @code{nil}, xx, yy - @code{1}, xy, yx - @code{0}
+By default no hit factor is applied. The hit matrix is the neutral one.
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ by some stones
+ at end table
+
+
 @node Common Messages
 @section Common Messages
 
@@ -3769,6 +3894,8 @@
 @section Global Attributes
 
 @menu
+* BumperStrength::
+* ExtralifeGlasses::
 * Height::
 * IsDifficult:: 
 * MagnetRange:: 
@@ -3779,16 +3906,46 @@
 * WormholeStrength:: 
 @end menu
 
+ at node BumperStrength
+ at subsection BumperStrength
+
+A global scalar default factor for the actorimpulse bumping force. This global 
+value is only used if no object specific value is set. 
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ float number
+ at item @b{Default:} @ @ @code{+200.0}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{st_actorimpulse}
+ at end table
+
+ at node ExtralifeGlasses
+ at subsection ExtralifeGlasses
+
+A global variable that defines the @ref{it_glasses} type that is generated on
+the laser light convertion of an @ref{it_extralife}
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ positiv integer number
+A sum out of the constants @samp{SPOT_DEATH}, @samp{SPOT_HOLLOW},
+ at samp{SPOT_ACTORIMPULSE}, @samp{SPOT_SENSOR}, @samp{SPOT_LIGHTPASSENGER}
+ at item @b{Default:} @ @ @code{SPOT_DEATH + SPOT_HOLLOW + SPOT_LIGHTPASSENGER}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{it_extralife}
+ at end table
+
 @node Height
 @subsection Height
 
-A global read only variable reports the height of the the world in grid units.
+A global read only variable reports the height of the world in grid units.
 This is set by the initial world constructor call 
 (@pxref{World Creation and Resolver Chaining}).
 
 @table @asis
 @item @b{Type:} @ @ number
- at item @b{Values:} @ @ positiv integer number
+ at item @b{Values:} @ @ positive integer number
 @item @b{Default:} @ @ @code{?}
 @item @b{Access:} @ @ read only
 @item @b{Support:} @ @ object independent
@@ -3799,8 +3956,9 @@
 
 A global read only variable that defines the current diffculty mode selected
 by the user. All differences of easy and difficult mode within the level should
-be coded solely in dependence of this flag. A level that supports an easy mode
-the author needs to declare it in the XML header in the element @ref{<modes>}.
+be coded solely in dependence of this flag. If a level that supports an easy
+mode the author needs to declare it in the XML header in the element 
+ at ref{<modes>}.
 
 @table @asis
 @item @b{Type:} @ @ bool
@@ -3840,10 +3998,10 @@
 @item @b{Support:} @ @ @ref{it_magnet}
 @end table
 
- at node Height
- at subsection Height
+ at node Width
+ at subsection Width
 
-A global read only variable reports the height of the the world in grid units.
+A global read only variable reports the width of the the world in grid units.
 This is set by the initial world constructor call 
 (@pxref{World Creation and Resolver Chaining}).
 
@@ -3894,7 +4052,7 @@
 @item @b{Type:} @ @ number
 @item @b{Values:} @ @ float number
 @item @b{Default:} @ @ @code{30.0}
-Positve number are attracting, negative numbers are repelling.
+Positive number are attracting, negative numbers are repelling.
 @item @b{Access:} @ @ read/write
 @item @b{Support:} @ @ @ref{it_wormhole}
 @end table
@@ -3922,6 +4080,7 @@
 * it_coin::            Enigma's currency
 * it_extralife::
 * it_floppy::          
+* it_glasses::         Glasses to spot certain objects
 * it_hammer::
 * it_key::             
 * it_magnet::
@@ -3956,7 +4115,7 @@
 Note that the blocker is the only door object that allows a stone to be pushed
 through. Just boulders cause the growing. Any other stone keeps the open state.
 
-Another unique door feature is the closing of an blocker item caused by a 
+Another unique door feature is the closing of a blocker item caused by a 
 passing actor if the autoclose attribute is set to true.
 
 Note that a dropped @ref{it_brake} destroys this item.
@@ -3968,8 +4127,8 @@
 @item @b{state}, @ @ @i{values}: @code{0}, @code{1}; @ @ @i{default}: @code{1} @ @ @xref{state}
 Use CLOSED and OPEN macros as values. The item represents the open state
 and will always return state 1. But you can set its state what is equivalent
-to sending an open message in case of value 1 and an close message in case of
-value 0..
+to sending an open message in case of value 1 and a close message in case of
+value 0.
 
 @atindex autoclose
 @item @b{autoclose} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
@@ -3984,7 +4143,7 @@
 A signal of value 1 sends an open message, a signal of value 0 sends a close
 message.
 @item @b{toggle} @ @ @xref{toggle}
-A toggle causes an close message.
+A toggle causes a close message.
 @item @b{close} @ @ @xref{close}
 A close message take immediate effect if the item is not covered by a stone.
 The item transforms to a new growing @ref{st_blocker}. If it is covered by a
@@ -3994,7 +4153,7 @@
 As the item is open this message takes only effect if it is currently covered
 by a stone and marked as unlocked. That means it should grow as soon as the
 stone moves away what happens when an @ref{st_boulder} passes an idle blocker
-item. In this case an open messages locks the blocker again to avoid a growing
+item. In this case an open message locks the blocker again to avoid a growing
 when the stone moves away.
 @end table
 
@@ -4090,6 +4249,8 @@
 A cross can be drawn with an @ref{it_pencil} and it can be removed with an
 @ref{it_brush}.
 
+An @ref{st_lightpassenger} moving onto a cross item will switch off.
+
 @table @asis
 @item @b{Attributes:}
 
@@ -4116,7 +4277,9 @@
 @obindex it_extralife
 
 An extralife transforms into @ref{it_glasses} when hit by a laser beam and is
-itself a laser transformation result of an @samp{it_coin4} (@pxref{it_coin}).
+itself a laser transformation result of an @samp{it_coin_l} (@pxref{it_coin}).
+The global variable @ref{ExtralifeGlasses} describes what the new glasses are
+able to spot.
 
 An extralife that comes into existence on an illuminated grid position will not
 be destroyed due to already existing laser beams. But it will be destroyed on
@@ -4154,6 +4317,61 @@
 
 @end table
 
+ at c ----------------- Glasses Item -------------------- 
+ at node it_glasses
+ at subsection it_glasses
+ at obindex it_glasses
+
+Glasses help a marble to spot certain other objects that are otherwise invisible
+or indistinguishable. 
+
+To be effective glasses must be hold in the top level of a players inventory.
+That means that the glasses must be shown in the inventory and not be burried
+in an @ref{it_bag} that is part of the inventory. Of course glasses just help
+those actors that are attached to the player wearing the glasses.
+
+Glasses can make invisible @ref{st_death} visible, can uncover invisible
+passages by making hollow stones transparent, can make inactive
+ at ref{st_lightpassenger} be distinguishable from @ref{st_glass}, can make
+invisble @ref{it_sensor} be visible and they can make invisble 
+ at ref{st_actorimpulse} be visible.
+
+All these features are configurable by the constants @samp{SPOT_DEATH},
+ at samp{SPOT_HOLLOW}, @samp{SPOT_LIGHTPASSENGER}, @samp{SPOT_SENSOR} and
+ at samp{SPOT_ACTORIMPULSE}. You can set the @samp{state} attribute to a sum
+of these constants that should apply to given glasses. The default is for 
+backward compatibility @samp{SPOT_DEATH + SPOT_HOLLOW + SPOT_LIGHTPASSENGER}.
+When a player wears several glasses he spots everything that any of the glasses
+could spot.
+
+Glasses break when a stone is pushed over them. Broken glasses spot nothing.
+
+Glasses result from the laser light transformation of @ref{it_extralife}. The
+features of such new glasses are determined by the global variable 
+ at ref{ExtralifeGlasses}.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{state}, @ @ @i{values}: positive numbers; @ @ @i{default}: @code{SPOT_DEATH + SPOT_HOLLOW + SPOT_LIGHTPASSENGER} @ @ @xref{state}
+A sum of the constants @samp{SPOT_DEATH}, @samp{SPOT_HOLLOW}, 
+ at samp{SPOT_LIGHTPASSENGER}, @samp{SPOT_SENSOR}, @samp{SPOT_ACTORIMPULSE}.
+ at samp{SPOT_NOTHING} is the state of a broken glasses.
+ at end table
+
+ at item @b{Messages:} none
+
+ at item @b{Variants:}
+ at table @asis
+ at item @b{it_glasses}
+Active glasses item.
+ at item @b{it_glasses_broken}
+Broken glasses that spot nothing.
+ at end table
+
+ at end table
+
 @c ----------------- Hammer Item -------------------- 
 @node it_hammer
 @subsection it_hammer
@@ -4163,7 +4381,7 @@
 @ref{st_lightpassenger}. 
 
 It transforms into @ref{it_sword} when hit by a laser beam and is itself a
-laser transformation result of an @ref{it_sword} and an @samp{it_coin2} 
+laser transformation result of an @ref{it_sword} and an @samp{it_coin_m} 
 (@pxref{it_coin}).
 
 An hammer that comes into existence on an illuminated grid position will not
@@ -4281,7 +4499,7 @@
 Be aware that the user will still notice that actors cannot drop items onto the
 same grid position.
 
-Alternative objects that reacts on actors are @ref{it_trigger} and 
+Alternative objects that react on actors are @ref{it_trigger} and 
 @ref{it_cross}.
 
 @table @asis
@@ -4361,7 +4579,7 @@
 still produces its click-sounds and the user will notice that actors cannot drop
 items onto the same grid position.
 
-Alternative objects that reacts just on actors are @ref{it_sensor} and
+Alternative objects that react just on actors are @ref{it_sensor} and
 @ref{it_cross}.
 
 @table @asis
@@ -4398,7 +4616,7 @@
 thieves.
 
 An umbrella gets destroyed when hit by a laser beam and is itself a
-laser transformation result of an @samp{it_coin1}(@pxref{it_coin}).
+laser transformation result of an @samp{it_coin_s}(@pxref{it_coin}).
 
 An umbrella that comes into existence on an illuminated grid position will not
 be destroyed due to already existing laser beams. But it will be destroyed on
@@ -4481,9 +4699,9 @@
 @item @b{toggle} @ @ @xref{toggle}
 Opens a closed vortex and closes an open vortex if possible.
 @item @b{open} @ @ @xref{open}
-Try to open a vortex.
+Tries to open the vortex.
 @item @b{close} @ @ @xref{close}
-Try to close a vortex.
+Tries to close the vortex.
 @end table
 
 @item @b{Action:}
@@ -4510,7 +4728,7 @@
 Teleports actors of any kind to a given @samp{destination}. Unlike 
 @ref{it_vortex} every wormhole has a unique destination. But of course the
 destination may be another wormhole which instantly teleports the actor again.
-Infinite circle of wormholes conneted by destinations are forbidden.
+An infinite circle of wormholes that are connected by destinations is forbidden.
 
 A wormhole can attract or repell actors in its @samp{range} with a force
 proportional to the @samp{strength} and the inverse of the squared distance.
@@ -4522,7 +4740,7 @@
 @samp{scissor} allows you to control the cutting behaviour.
 
 After teleporting an actor, the wormhole's teleporting ability may be switched
-off for a short latency period given by @samp{interval}. A letancy separates
+off for a short latency period given by @samp{interval}. A latency separates
 actors travelling through a wormhole and avoids overlapping actors at the
 destination.
 
@@ -4531,7 +4749,7 @@
 
 @table @asis
 @item @b{state}, @ @ @i{values}: @code{ON}, @code{OFF}; @ @ @i{default}: @code{OFF} @ @ @xref{state}
-The current force state - @samp{ON} for an force applying wormholes, @samp{OFF}
+The current force state - @samp{ON} for a force applying wormholes, @samp{OFF}
 for force neutral wormholes.
 
 @item @b{destination}, @ @ @i{values}: tokens or position; @ @ @i{default}: @code{nil} @ @ @xref{destination}
@@ -4549,7 +4767,7 @@
 Rubberband cutting behaviour on teleporting.
 
 @item @b{interval} @ @ @i{values}: float number greater equal 0; @ @ @i{default}: @code{0.0}
-The letancy time after a teleport during which no further teleports take place.
+The latency time after a teleport during which no further teleports take place.
 
 
 @item @b{Messages:}
@@ -4787,6 +5005,7 @@
 @section Special Stones
 
 @menu
+* st_actorimpulse::    Bumper Stone
 * st_blocker::         Shrinkable Blocker
 * st_boulder::         Moving Arrow Boulder
 * st_coinslot::        Coin Driven Switch
@@ -4807,6 +5026,68 @@
 @end menu
 
 
+ at c ----------------- Actorimpulse Stone -------------------- 
+ at node st_actorimpulse
+ at subsection st_actorimpulse
+ at obindex st_actorimpulse
+
+An active bumper for actors and some stones like @ref{st_boulder}. The 
+actorimpulse stone can be made invisible while idle to introduce some surprise
+effects.
+
+Actors that hit this stone will not be reflected just passively. An additional
+force will be applied to them that can even be distorted. By default the actors
+are just pushed away from the center of the stone. A global attribute
+ at ref{BumperStrength} gives a default force that can be overridden by the 
+stone attribute @samp{strength}.
+
+For sophisticated usage you can distort this force by usage of the @ref{hit_*}
+attributes. Note that the @samp{hit_factor} overrides a @samp{strength}
+attribute.
+
+An actorimpulse stone can be configured by the @samp{invisible} attribute to
+be hidden while being idle. While pulsing any actorimpulse is visible. An
+invisible actorimpulse can be made permanent visible by hitting it with a
+revealed @ref{it_brush} in the players inventory. The level author can configure
+ at ref{it_glasses} by addition of @samp{SPOT_ACTORIMPULSE} to show otherwise
+invisible actorimpulse stones. With the global attribute @ref{ExtralifeGlasses}
+even glasses generated by laser lighting an @ref{it_extralife} can be configured
+to show invisible actorimpulse stones.
+
+An @ref{st_boulder} hitting an actorimpulse stone will revert its direction
+and return in the incoming direction.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{invisible} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+An invisible actorimpulse stone is totally transparent. But the user will
+notice it, as actors will bounce with addtional impulses.
+ at item @b{strength} @ @ @i{values}: float number; @ @ @i{default}: @code{+200.0} @ @ @xref{BumperStrength}
+A scalar factor for the impulse force. Positive numbers are attracting forces
+where as negative numbers are repelling forces.
+ at item @b{hit_factor} @ @ @i{values}: float number; @ @ @i{default}: @code{nil} @ @ @xref{hit_*}
+A @samp{hit_factor} overrrides a given @samp{strength} attribute.
+ at item @b{hit_distortion_xx} @ @ @i{values}: float number; @ @ @i{default}: @code{+1.0} @ @ @xref{hit_*}
+ at item @b{hit_distortion_xy} @ @ @i{values}: float number; @ @ @i{default}: @code{0.0} @ @ @xref{hit_*}
+ at item @b{hit_distortion_yx} @ @ @i{values}: float number; @ @ @i{default}: @code{0.0} @ @ @xref{hit_*}
+ at item @b{hit_distortion_yy} @ @ @i{values}: float number; @ @ @i{default}: @code{+1.0} @ @ @xref{hit_*}
+ at end table
+
+ at item @b{Messages:} none
+
+ at item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
+
+ at item @b{Variants:}
+
+ at table @asis
+ at item @b{st_actorimpulse}: invisible = @code{false}
+ at item @b{st_actorimpulse_invisible}: invisible = @code{true}
+ at end table
+
+ at end table
+
 @c ----------------- Blocker Stone -------------------- 
 @node st_blocker
 @subsection st_blocker
@@ -4892,7 +5173,7 @@
 it by a sequence of two internal messages. Some stones give way like 
 @ref{st_blocker}, others change their state like @ref{st_oxyd}, 
 @ref{st_stoneimpulse}, @ref{st_fart}, @ref{st_mirror}, @ref{st_fourswitch},
- at ref{st_volcano}. A third categorie switches temporary in another state on the
+ at ref{st_volcano}. A third category switches temporary in another state on the
 first message sent when the boulder reaches a grid and switch back on the
 second message sent when the boulder gives up like @ref{st_[black/white]},
 @ref{st_plain}, @ref{st_lightpassenger}.
@@ -4902,11 +5183,12 @@
 to a blocking stone.
 
 Boulder stones fall into @ref{fl_abyss}, but cross @ref{fl_water}
-unchanged.  
+unchanged.
 
- at ref{it_magicwand} and lasers reverse its direction. @ref{st_rotator} changes
-its direction according to the rotators direction. @ref{st_stoneimpulse} pushes
-a boulder away.
+ at ref{it_magicwand} and lasers reverse its direction. An @ref{st_actorimpulse}
+reverts the direction if the boulder hits it frontally. An @ref{st_rotator}
+changes its direction according to the rotators direction. An 
+ at ref{st_stoneimpulse} pushes a boulder away.
 
 @table @asis
 @item @b{Attributes:}
@@ -5314,10 +5596,19 @@
 and @floor{floor_gradient} the parallel part of the force of the floor,
 i.e., the sum of gradient-force and @code{force_x/y}-attributes.
 
-The light passenger can be switched on and off by messages (see
-below), and appears as @samp{st_glass2} when inactive.  The variant
- at samp{st_lightpassenger_off} is deactivated from the beginning.
+The light passenger can be switched on and off by messages (see below), and 
+appears as @samp{st_glass2} when inactive. A player with an @ref{it_glasses}
+in his inventory that includes the @samp{SPOT_LIGHTPASSENGER} feature is able
+to distinguish the switched off lightpassenger from an @samp{st_glass2}.
+The variant @samp{st_lightpassenger_off} is deactivated from the beginning.
+A lightpassenger that moves onto an @ref{it_cross} switches off immediatly. A
+switchted off lightpassenger can be switched on by an actor hit with a revealed
+ at ref{it_brush} in the inventory. Such a touch with a brush does wipe out a
+cross beneath the lightpassenger, too.
 
+An @ref{st_boulder} hitting a lightpassenger toggles its state for a short
+period.
+
 When an active @samp{st_lightpassenger} is trapped between exactly two
 opposing light beams or light beams from all four directions, it
 starts blinking.  In this state, it can be destroyed with
@@ -5832,13 +6123,24 @@
 @node shuffleOxyd
 @subsection shuffleOxyd
 
-Read API Concept Draft
+Shuffling the color distribution of the @ref{st_oxyd} makes every level, that
+is no meditation, a bit generic. On every level start the level looks a little
+bit different and the user has to solve a modified level. This provides long
+term amusement. Thus the call of this method is part of most levels.
 
-Work in progress!
+Many levels just call this method without any arguments. This results in a
+shuffling of all @ref{st_oxyd} that are not exclude by an @samp{noshuffle}
+attribute.
 
+But sometimes levels need to influence the shuffling, either for ensuring that
+the level remains solvable, or simply to ensure fairness. Imagine a level that
+has two @ref{st_oxyd}s in every corner. If by chance a user gets a distribution
+where he has in each corner a pair of same colored oxyds, the level might be
+trivial. Another level may have a passage that the marble can pass just a few
+times. With 5 or more oxyds on each side of the passage you need to ensure that
+the marble never needs to pass the passage more often than possible. Both 
+situations can be handled by providing proper rules as arguments to this method.
 
- at ref{st_oxyd}
-
 @table @asis
 @item @b{Syntax:}
 
@@ -5847,7 +6149,7 @@
 @table @asis
 @item @i{rules} = @i{rule}, @i{rule},...
 No rule or as many as you like, all seperated by a comma.
- at item @i{rule} = @{@i{group1}, @i{group2}, @i{maxrule}, @i{minrule}, @i{circularrule}, @i{linearrule}, @i{logrule}@}
+ at item @i{rule} = @{@i{group1}, @i{group2}, @i{maxrule}, @i{minrule}, @i{circularrule}, @i{linearrule}, @i{log}@}
 Each rule is a table with a subset of the listed entries. The @i{group1} entry
 is mandatory. All other entries are optional and can be added in any combination.
 @item @i{group1} = @i{group} | @i{objectreference} | @i{objectspecifier}
@@ -5867,7 +6169,7 @@
 last oxyd in group1, too.
 @item @i{linearrule} = @code{linear = true}
 Avoid any pair of neighboring oxyds in group1.
- at item @i{logrule} = @code{log = } @ @  @code{"solution"} |@code{"count"} |@code{"all"} 
+ at item @i{log} = @code{log = } @ @  @code{"solution"} |@code{"count"} |@code{"all"} 
 Log additional information to the log stream for debugging purposes and 
 security checks by the level author.
 @end table
@@ -5881,9 +6183,112 @@
 
 @item @b{Details:}
 
+Any call of @samp{wo:shuffleOxyd()} must occur after all @ref{st_oxyd} have been
+set. That means that it must follow the standard world initialzation 
+(@pxref{World Creation and Resolver Chaining}). As a side effect shuffleOxyd 
+will assign colors to all @samp{OXYD_AUTO} colored @ref{st_oxyd}. 
+
+Once called the given shuffling rules remain valid. Any further reshuffling
+must be done by messages @samp{closeall} and @samp{shuffle} to one arbitrary
+ at ref{st_oxyd} instance. No addition of an @ref{st_oxyd} or subsequent 
+ at samp{wo:shuffleOxyd()} calls are possible without disturbing and deleting the
+given rules.
+
+Rule based shuffling is limited to a maximum of one pair of each standard oxyd
+color plus any combination of additional special fake, fart or bold oxyds 
+summing up to a maximum of 32 oxyds. If more than 32 oxyds or 2 or more pairs
+of a single standard color are set, all oxyds will be shuffled by random
+ignoring any provided rules.
+
+There are basically two different types of rules. Those with one group and those
+with two groups of oxyds (Note that group is the general API expression for
+a set of oxyds and not a mathematical group). For a single group the rules apply
+to the oxyd instances within this group. For two groups the rules apply to oxyd
+pairs with one oxyd in the first group and the other in the second group.
+
+E.g. @samp{@{"islandoxyds#*", max=0@}} requests that there is no pair within
+this group of oxyds. Whereas @samp{@{"leftoxyds#*","rightoxyds#*", min=3@}} 
+requests that there are 3 different oxyd pairs, each with one oxyd out of the
+leftoxyd group and the second out of the rightoxyd group.
+
+Linear and circular rules can only be applied to a single group. They are
+shortcuts for the most common rules that are applied to oxyds arranged on a
+line or a circle. In both cases they avoid pairs of neighboring oxyds. They
+are equivalent to @samp{n-1} res. @samp{n} rules with all possible neighboring
+oxyds pairs as two groups and a rule of @samp{max=0}.
+
+Note that you can apply several rules at once to given groups. E.g. you can
+apply a minrule and a maxrule within one rule!
+
+The shuffling process consists always of two stages. The most important first
+stage generates a valid oxyd pair distribution. That means that we settle which
+pairs will have the same color. But the color itself is assigned in an
+independent second stage. As for the examination of given rules just the pair
+distribution is relevant, we do just count and log these different distributions
+ignoring the colors.
+
+With 16 oxyds of 8 different colors and no restricting rules you have 2027025
+(15 * 13 * 11 * 9 * 7 * 5 * 3) different valid distributions. Keep in mind
+that useful rules should always keep hundreds or thousands of different valid
+distributions for a level.
+
+For debugging purposes you can add a log parameter to one of the rules (it does
+not matter to which one). If you request the log of @samp{solution} the
+pair distribution will be printed to the log stream. 
+
+In case of @samp{count} the number of different oxyd distributions will be 
+counted and logged. It is recommended to check the count on complex rules to 
+ensure that enough distributions remain for a varying game. But be careful 
+applying count on trivial rules. With 16 oxyds there may be as many as
+... distributions and it may take a standard PC up to 30 seconds to count them!
+
+Be very, very cautious in usage of logging @samp{all}. This call tries to print
+all solutions. It takes ages if there are to many solutions. First check the
+count before trying to log the solutions.
+
 @item @b{Full Example:}
 @example
+wo["ConserveLevel"] = false
+
+ti["~"] = @{"fl_water"@}
+ti[" "] = @{"fl_plank"@}
+ti["c"] = @{"it_crack3", brittleness=0@}
+ti["^"] = @{"st_oneway_n"@}
+ti["1"] = @{"ac_marble_black", 0, 0.5}
+
+ti["x"] = @{"st_oxyd", "island#"@}
+ti["y"] = @{"st_oxyd", "left#"@}
+ti["z"] = @{"st_oxyd", "right#"@}
+
+w, h = wo(ti, " ", @{
+"~~x  x  x  x  x  x~~",
+"~~                ~~",
+"~~~~^~~~~~~~~~~^~~~~",
+"y       ~~~~       z",
+"~       cccc       ~",
+"y       ~~~~       z",
+"~       cccc       ~",
+"y       ~~~~       z",
+"~       cccc       ~",
+"y       ~~~~       z",
+"~~~~c~~~~~~~~~~c~~~~",
+"~~                ~~",
+"~~        1       ~~"
+@})
+
+wo:shuffleOxyd(@{"island#*", min=3, linear=true@}, @{"left#*","right#*", max=2, min=2@})
 @end example
+
+This level uses 14 oxyds. The 6 oxyds in the upper row are on an island that
+can not be left once the marble entered it through one of the oneways. Thus
+we need 3 pairs of oxyds on this island, which are enforced by the min rule.
+To avoid trivial neighboring pairs on the island, we do add a linear rule, too.
+The marble can pass just three times between the left and right islands. This
+allows a first look on the color oxyds with one pass and opening one pair on
+each of the two following passes. Thus we limit the number of pairs by a max
+rule to 2. To avoid trivial oxyd pair distributions, like two pairs on the left
+and two pairs on the right side, we do add a min rule that enforces that two
+shared pairs of oxyds do exist.
 @end table
 
 @c ----------------- drawMap -------------------- 



From andreasl at mail.berlios.de  Wed Jun 11 02:47:38 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Wed, 11 Jun 2008 02:47:38 +0200
Subject: [Enigma-game-svn] r1168 - in feature_branches/hp_lotm: images/lotm
	input/lotm
Message-ID: <200806110047.m5B0lcXg016419@sheep.berlios.de>

Author: andreasl
Date: 2008-06-11 02:47:29 +0200 (Wed, 11 Jun 2008)
New Revision: 1168

Added:
   feature_branches/hp_lotm/images/lotm/lotm_200806.png
   feature_branches/hp_lotm/images/lotm/lotm_200806_a.jpg
   feature_branches/hp_lotm/images/lotm/lotm_200806_b.jpg
   feature_branches/hp_lotm/images/lotm/lotm_200806_c.jpg
   feature_branches/hp_lotm/images/lotm/lotm_200806_d.jpg
   feature_branches/hp_lotm/input/lotm/lotm_200806.html
   feature_branches/hp_lotm/input/lotm/lotm_200806_de.html
Modified:
   feature_branches/hp_lotm/input/lotm/lotm_200805.html
   feature_branches/hp_lotm/input/lotm/lotm_200805_de.html
   feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua
Log:
LotM Feature branch:
 - First version of LotM June 2008 (English, German)
 - Jacob's comment to LotM May 2008 (English, German)
Todo:
 - Russian translation (including Jacob's comment)
 - Proofread
 - Gamers' comments, if available
 - lotm-history.png
 - New <span class="blue">
 - New <div class="spoiler">


Added: feature_branches/hp_lotm/images/lotm/lotm_200806.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200806.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200806_a.jpg
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200806_a.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200806_b.jpg
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200806_b.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200806_c.jpg
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200806_c.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200806_d.jpg
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200806_d.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: feature_branches/hp_lotm/input/lotm/lotm_200805.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805.html	2008-06-07 09:32:30 UTC (rev 1167)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805.html	2008-06-11 00:47:29 UTC (rev 1168)
@@ -217,6 +217,42 @@
 in contrast to the other parts adds much to the pleasure of the level
 as a whole.</p>
 
+<a name="jacob">
+<h4>With some delay, here are the comments of the author:</h4>
+</a>
+
+<div class="quote">I wrote &quot;Pleasure Garden&quot; as my first serious attempt at emulating the
+style of the original Oxyd labyrinths.  Usually they comprised many
+interconnected rooms with no obvious way to complete it, or even what
+to do next.  However, my level started becoming too linear, though I
+did nothing about this.  I was happy just to build a level linking
+together some of my favorite types of puzzles.  Because the level
+became so linear, I ended it with a more reasonable number of
+segments, not quite as large as I had originally planned (I
+constructed levels in the intended style later).</div>
+
+<div class="quote">I wanted to include the types of puzzles I always used to enjoy in the
+Oxyd games: boulder puzzles, bomb puzzles, shogun challenges, and even
+a oneway maze.  I designed the level to be a sort of journey, through
+a bunch of interesting challenges, with one final challenge at the
+end.  As it turns out, there is a way to make this ultimate puzzle a
+little easier, but given the difficulty of the rest of the level (and
+the time required to get that far) I decided not to change it.
+Overall, I wrote it such that each part would be comparable to an easy
+individual level by itself, but that together the different areas
+would mesh together nicely.  For this reason, most of the parts use
+consistent color schemes in fairly open environments.</div>
+
+<div class="quote">I think &quot;Pleasure Garden&quot; turned out fairly well.  At the time I wrote
+it it was probably one of the harder levels I had written (not at all
+true anymore), and it was really an experiment in what I could put
+together into one level without it becoming too much.  Compared to
+some more recent levels (of mine, e.g.), &quot;Pleasure Garden&quot; is fairly
+easy, but I think it still retains its sense of a journey through an
+open, inviting landscape.</div>
+
+<div class="author">Jacob Scott</div>
+
 <p>Definitely &quot;Pleasure Garden&quot; has taken its seat high up in my 
 private Top 10. Many thanks to Jacob Scott for this terrific level.</p>
 

Modified: feature_branches/hp_lotm/input/lotm/lotm_200805_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805_de.html	2008-06-07 09:32:30 UTC (rev 1167)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805_de.html	2008-06-11 00:47:29 UTC (rev 1168)
@@ -227,6 +227,50 @@
 Gegenpol zum Rest - diesem meines Erachtens seinen ganz besonderen 
 Reiz.</p>
 
+<a name="jacob">
+<h4>Und hier ist, mit etwas Verz&ouml;gerung, der Kommentar des Autors:</h4>
+</a>
+
+<div class="quote">&quot;Pleasure Garden&quot; ist das Resultat meines ersten ernsthaften Versuchs, 
+den Stil der Original Oxyd Labyrinthe zu emulieren. Normalerweise 
+bestehen diese aus vielen miteinander verbundenen R&auml;umen, ohne dass 
+zun&auml;chst ersichtlich ist, auf welche Weise der Level gel&ouml;st werden kann,
+oder was der n&auml;chste L&ouml;sungsschritt ist. Der Level begann mir jedoch 
+bald etwas zu linear zu geraten, obwohl das in keiner Weise meine 
+Absicht war. Ich freute mich einfach nur dar&uuml;ber, einen Level zu bauen,
+indem ich verschiedene meiner Lieblingspuzzletypen zusammenf&uuml;gte. Weil
+der Level sich aber so linear entwickelt hatte, beschloss ich, die 
+Anzahl der einzelnen Abschnitte auf ein vern&uuml;nftiges Ma&szlig; zu reduzieren,
+nicht ganz so gro&szlig; wie ich das urspr&uuml;nglich geplant hatte (Level im 
+beabsichtigten Stil habe ich dann sp&auml;ter konstruiert).</div>
+
+<div class="quote">Ich wollte die Typen von Puzzles einbauen, die mir bei den Oxyd Spielen
+immer am meisten Spass gemacht hatten: Boulder Puzzles, Bomben Puzzles, 
+Shogun Challenges, und sogar ein Labyrinth aus Einbahn-Steinen. Ich habe 
+den Level als eine Art Reise angelegt, durch eine Ansammlung von 
+interessanten Aufgaben, mit einer Abschlu&szlig;pr&uuml;fung, die es in sich hat.
+Wie sich mittlerweise herausgestellt hat, gibt es einen Weg, dieses 
+ultimative Puzzle etwas einfacher zu bew&auml;ltigen, aber aufgrund der 
+Schwierigkeit des Levels als Ganzes betrachtet, und der Zeit, die man 
+ben&ouml;tigt, um &uuml;berhaupt erst so weit zu kommen, habe ich beschlossen,
+nichts mehr zu ver&auml;ndern. Insgesamt habe ich den Level so konzipiert, 
+dass jeder Teil f&uuml;r sich allein genommen, einem einzelnen nicht 
+allzu schwierigen Level vergleichbar ist, dass aber die verschiedenen 
+Abschnitte insgesamt auch gut ineinandergreifen. Aus diesem Grund habe
+ich auch f&uuml;r die meisten Abschnitte miteinander in Einklang stehende 
+Farbmuster verwendet, in einer ziemlich offen gestalteten Umgebung.</div>
+
+<div class="quote">Ich denke, &quot;Pleasure Garden&quot; ist mir ganz gut gelungen. Zur Zeit als ich
+es geschrieben habe, war es wahrscheinlich einer der schwersten Level,
+die ich bis dahin verfasst hatte (was jetzt nat&uuml;rlich nicht mehr ganz 
+zutrifft), und es war eigentlich ein Experiment, was ich in einem einzigen
+Level so alles unterbringen k&ouml;nnte, ohne dass es zuviel w&uuml;rde. 
+Verglichen mit einigen aktuelleren Leveln (von meinen eigenen z.B.) ist
+&quot;Pleasure Garden&quot; ziemlich einfach, aber ich finde, es vermittelt immer 
+noch den Eindruck einer Reise durch eine offene und einladende Landschaft.</div>
+
+<div class="author">Jacob Scott</div>
+
 <p>Auf jeden Fall steht Lustgarten in meinen Top 10 gaaanz weit 
 oben. Vielen Dank an Jacob Scott f&uuml;r diesen geilen Level.</p>
 

Added: feature_branches/hp_lotm/input/lotm/lotm_200806.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200806.html	2008-06-07 09:32:30 UTC (rev 1167)
+++ feature_branches/hp_lotm/input/lotm/lotm_200806.html	2008-06-11 00:47:29 UTC (rev 1168)
@@ -0,0 +1,313 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">June 2008: </span>
+    &quot;Block its way!&quot; by Jon 'WB' Sneyers
+  </h3>
+
+<p>
+Since March the 26th 2008 I have to grin or even laugh each time this level
+crosses my way. Why? Well, quite easy&mdash;but, stop, one thing after the
+after.
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200806_c.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">Enigma III # 66</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Some records of March 2008</caption>
+<colgroup>
+   <col width="80">
+   <col width="160">
+</colgroup>
+    <tr><td class="num">3:21</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">3:37</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">4:16</td>
+        <td class="left">Malla</td></tr>
+    <tr><td class="num">4:21</td>
+        <td class="left">Johannes</td></tr>
+    <tr><td class="num">4:25</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">4:37</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">5:29</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">5:33</td>
+        <td class="left">dpl</td></tr>
+    <tr><td class="num">5:39</td>
+        <td class="left">dev0+hdwow</td></tr>
+    <tr><td class="num">5:41</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">5:45</td>
+        <td class="left">Django</td></tr>
+    <tr><td class="num">5:46</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">5:52</td>
+        <td class="left">Daisy</td></tr>
+    <tr><td class="num">6:06</td>
+        <td class="left">U-Punkt+alfred69</td></tr>
+    <tr><td class="num">6:15</td>
+        <td class="left">Tobias+Safalra</td></tr>
+    <tr><td class="num">6:35</td>
+        <td class="left">Agnieszka</td></tr>
+    <tr><td class="num">6:41</td>
+        <td class="left">NorthForty</td></tr>
+    <tr><td class="num">6:44</td>
+        <td class="left">JuSt</td></tr>
+    <tr><td class="num">6:48</td>
+        <td class="left">B-Huff</td></tr>
+    <tr><td class="num">6:50</td>
+        <td class="left">Gloop</td></tr>
+    <tr><td class="num">6:51</td>
+        <td class="left">Alex</td></tr>
+    <tr><td class="num">6:58</td>
+        <td class="left">Mark P.</td></tr>
+    <tr><td class="num">7:08</td>
+        <td class="left">Klaus+Gottseinsohn</td></tr>
+    <tr><td class="num">7:21</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">7:52</td>
+        <td class="left">Vinksu</td></tr>
+    <tr><td class="num">7:56</td>
+        <td class="left">para_doks</td></tr>
+    <tr><td class="num">8:12</td>
+        <td class="left">Great Scott</td></tr>
+    <tr><td class="num">8:16</td>
+        <td class="left">shoki</td></tr>
+    <tr><td class="num">8:28</td>
+        <td class="left">mhatta</td></tr>
+    <tr><td class="num">8:43</td>
+        <td class="left">biotopa</td></tr>
+    <tr><td class="num">8:46</td>
+        <td class="left">Antonio EE</td></tr>
+    <tr><td class="num">9:08</td>
+        <td class="left">Andy</td></tr>
+    <tr><td class="num">9:18</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">9:23</td>
+        <td class="left">Kosby+mrduke</td></tr>
+    <tr><td class="num">9:46</td>
+        <td class="left">Freshman</td></tr>
+    <tr><td class="num">10:01</td>
+        <td class="left">Sim_Ed</td></tr>
+    <tr><td class="num">10:20</td>
+        <td class="left">fabian</td></tr>
+    <tr><td class="num">10:29</td>
+        <td class="left">Little_Mole</td></tr>
+    <tr><td class="num">10:58</td>
+        <td class="left">ABS</td></tr>
+    <tr><td class="num">11:43</td>
+        <td class="left">Valkyrie2</td></tr>
+    <tr><td class="num">11:45</td>
+        <td class="left">WP319</td></tr>
+    <tr><td class="num">12:03</td>
+        <td class="left">Drotten</td></tr>
+    <tr><td class="num">12:16</td>
+        <td class="left">Melanie</td></tr>
+    <tr><td class="num">13:35</td>
+        <td class="left">Tarim</td></tr>
+    <tr><td class="num">13:38</td>
+        <td class="left">Jeffrey S</td></tr>
+    <tr><td class="num">14:44</td>
+        <td class="left">HuB34</td></tr>
+    <tr><td class="num">20:26</td>
+        <td class="left">mecke</td></tr>
+</table>
+
+<p>My first try has been quite a long time ago, and was merely a kind of naive
+marble pushing than a real attempt to solve the level. How did the start screen
+present itself to me:
+</p>
+
+<p>
+<ul>
+<li>
+  a small amount of impulse stones and some wood stones interspersed with a
+  small and a large water hole
+  <br>
+  (<span class="blue">Shall I look at that more carefully and consider when I
+  what-how-where &hellip;&mdash;actually I wasn't up for this, so I applied the
+  principle of let's-see-what-happens</span>),
+</li><li>
+  an accessible oxyd stone and three more behind a closed door, together with a
+  yin-yang stone
+  <br>
+  (<span class="blue">Aha, a white marble will be part of the game. The thing
+  with the door might become complicated&mdash;let's wait and see</span>),
+</li><li>
+  four documents
+  <br>
+  (<span class="blue">So the author provides some hints as well. The first one
+  already is close-by, let's read it: &quot;I shall not forget to open the door
+  &hellip;&quot;. Obviously it refers to the trigger &hellip; excellent, the
+  door is open. That was simple.</span>),
+</li><li>
+  an exit to the next room
+  <br>
+  (<span class="blue">Although blocked by a water hole, there's still enough
+  wood&mdash;hence no problem</span>),
+</li><li>
+  oh yes, I nearly forgot, two one-ways.
+  <br>
+  (<span class="blue">One out of the starting area and one leading to the
+  'last' oxyd</span>),
+</li><li>
+  and an st_bolder
+  <br>
+  (<span class="blue">What that is supposed to do, once it's going? Could
+  &hellip; ah, well, everything will go well</span>).
+</li>
+</ul>
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200806_a.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">Unblocked &hellip;</div>
+</div>
+
+<p>And so we start. Door is open, touching one of the lower impulse stones, to
+fill the larger water hole at least partially with wood, then through the
+one-way, collect the next document, it reads &quot;Good Luck!&quot; (<span
+class="blue">My heart misgives me, but let's be optimistic &hellip;</span>),
+touch the next impulse stone, open the first oxyd stone, unhurried forward,
+until the impulse stones places the wood stones into the water, taking another
+document along the way, push a wood stone into the water hole to get into the
+next room, and daring a look, what the bolder is supposed to do.
+</p>
+
+<p>Well, and that's it. I only see how the bolder rushes along in front of me
+and parks on the trigger. Should the trigger &hellip; yes, the door is closed
+again, and the level can't be solved anymore (F3 restarts the whole level.
+Ouch!). By the way, I now had the time to read the last document:
+&quot;Hurry!&quot; Uhh, who would've thought about that one?!<br>
+Oh yes, what was this level called after all? Yes! So it's reeaally simple
+;-))), block the bolder with one of the 'remaining' wood stones. Can't be that
+difficult, can it?
+</p>
+
+<p>Well then, but this time with more enthusiasm and in particular more speed,
+after all the level info gives a speed factor of three.
+</p>
+
+<p>I finally made it, two tries later. Sorry, that's a lie&mdash;it were
+definitely more (to be honest, I surely worked on it two days in a row). Either
+I was too slow (once again) or too careless (much too often). But with time
+came routine &hellip; and someday the time had come to attend to the rest of
+the level. And that is everything but stressful, more speed parcours: nada.
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200806_b.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">Still too late!</div>
+</div>
+
+<p>As next, the white marble has to be put into play, otherwise there's nothing
+more to do for the black one&mdash;a wood stone blocks the remaining way. Well
+then, let's do some 'island hopping' with the white marble&mdash;no, no need
+for jumping. Place wood stones between the four islands. Here everyone should
+act careful, who have problems with the rebound of pushing stones on narrow
+floors; fortunately, the grass's not wet and the sand is just normal sand.
+</p>
+
+<p>After we managed this as well, the black and the white marble mutually free
+their paths. Open some oxyds along the way. Finally the black marble has to
+open a gap in a row of wood stones, to reach the remaining oxyd stones.
+</p>
+
+<p>After all oxyd stones but the last one are open, the black marble can go on
+its last way, to finally solve the level by touching the oxyd stone behind the
+one-way on the start screen.
+</p>
+
+<p>If you like &quot;Little Puzzles&quot; and &quot;Big Adventures&quot;
+optically and technically, you will for sure feel like home in the two rooms on
+the right side of &quot;Block its way!&quot;; after all, all three levels are
+penned by the same author.
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200806_d.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">Another broken ego &hellip;</div>
+</div>
+
+<p>If you remember the first sentence of this article, you will ask yourself,
+what on earth is so funny with this level? Actually, nothing, if&mdash;yes,
+<b>if</b>&mdash;one plays it like described. Because there's one more variant,
+where one circumvents the speed parcour in the beginning (many thanks to
+Taztunes for the hint). So everyone who has problems with that, or are not
+that interested in a good time, or just want to play a nice level in a relaxed
+atmosphere, should do the following:
+<br>
+<i>Danger, spoiler ahead!</i><div class="spoiler">Open the door with the
+trigger and touch one of the surrounding impulse stones, then <b>wait</b> until
+the door closes (the bolder now reached its trigger), then just press the
+trigger a second time and the door opens up again, finished (read Taztunes'
+post about &quot;Block its way!&quot; from March 26th 2008 on the forum
+mag-heut.net).</div><i>End of spoiler</i>
+</p>
+
+<p>Now I ask myself the question, why is the level called &quot;Block its
+way!&quot;, why should I &quot;Hurry!&quot;, like is written on the document,
+why has the level a speed factor of 3? Everything just red herrings? Is the
+author amused about all the gullible players like me (he might forgive me, when
+I alleged something wrong)? If yes, I think it's okay LOL. By all means I've
+willingly learned my lesson mit a smile. I always have to thing about a quote
+from Kurt Tucholsky on such occasions: &quot;Never let an expert impress
+yourself, when he tells: 'Dear friend, I'm doing it this way for twenty years
+now!'&mdash;one can well do it the wrong way for twenty years.</i>&quot;
+</p>
+
+<p>And therefore a large 'Thank you' to Jon 'WB' Sneyers for a level
+which&mdash;like in my case&mdash;demonstrates the own shortsightedness. And
+please leave the level the way it is and don't correct it afterwards, at least
+I would deplore it.
+</p>
+
+<p><i>[Commentary: The shortcut wasn't known to the team nor to Jon, until
+Taztunes advised us of it. Thus, the speed rating of three was assigned without
+knowledge of the shortcut.]</i></p>
+
+<div class="quote">
+The level started out with the idea of the title: a race against time to block a
+boulder from running into a doomed trigger. If I remember correctly, I wanted to
+make it a one-screen level first, where you could see what was going to happen
+from the beginning. Somehow I was using too much space for the impulse stone
+routes, so the boulder path ended up just on the next screen. Then I started to
+like that, because you can still see the boulder sitting there, but you don't
+know immediately what it is going to do. Only after you've got to the next
+screen once, you can know what needs to be done. Anyway, now I had a second
+screen to fill, so I could just as well make it a somewhat larger level. I have
+always liked yin-yang levels, so I decided to make it a level where first black
+solves a puzzle (the blocking of the boulder, which is mostly a dexterity
+challenge), then white solves a puzzle, then they both cooperate to solve the
+rest of the map. For white's puzzle I tried to make a connect-the-islands
+bridgebuilding puzzle where the bridges need to be in somewhat unexpected
+places.
+</div>
+
+<div class="author">Jon 'WB' Sneyers</div>
+
+<p><i>NObby</i></p>
+
+<p>Dear reader, we have a constant need for articles from you about Enigma's
+great levels. Please, send us any articles, even comments, you write to:</p>
+<pre>
+<a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
+</pre>
+<p>We're particularly interested in articles about the following levels:
+</p>
+<ul>
+<li>&quot;Plan Ahead&quot; by Jacob Scott</li>
+<li>&quot;River of Challenges&quot; by Lukas Sch&uuml;ller</li>
+<li>&quot;Procrustes&quot; by Andreas Lochmann</li>
+</ul>
+<p>Many thanks in advance, only your help can keep the LotM alive!</p>
+
+<p><i>Your Enigma Team</i></p>
+
+</div>

Added: feature_branches/hp_lotm/input/lotm/lotm_200806_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200806_de.html	2008-06-07 09:32:30 UTC (rev 1167)
+++ feature_branches/hp_lotm/input/lotm/lotm_200806_de.html	2008-06-11 00:47:29 UTC (rev 1168)
@@ -0,0 +1,320 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">June 2008: </span>
+    &quot;Block its way!&quot; by Jon 'WB' Sneyers
+  </h3>
+
+<p>Seit dem 26. M&auml;rz 2008 muss ich immer, wenn mir dieses Level &uuml;ber den
+Weg l&auml;uft, grinsen oder gar lachen. Warum? Tja ganz einfach -  aber halt,
+alles sch&ouml;n der Reihe nach.</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200806_c.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">Enigma III # 66</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Some records of March 2008</caption>
+<colgroup>
+   <col width="80">
+   <col width="160">
+</colgroup>
+    <tr><td class="num">3:21</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">3:37</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">4:16</td>
+        <td class="left">Malla</td></tr>
+    <tr><td class="num">4:21</td>
+        <td class="left">Johannes</td></tr>
+    <tr><td class="num">4:25</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">4:37</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">5:29</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">5:33</td>
+        <td class="left">dpl</td></tr>
+    <tr><td class="num">5:39</td>
+        <td class="left">dev0+hdwow</td></tr>
+    <tr><td class="num">5:41</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">5:45</td>
+        <td class="left">Django</td></tr>
+    <tr><td class="num">5:46</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">5:52</td>
+        <td class="left">Daisy</td></tr>
+    <tr><td class="num">6:06</td>
+        <td class="left">U-Punkt+alfred69</td></tr>
+    <tr><td class="num">6:15</td>
+        <td class="left">Tobias+Safalra</td></tr>
+    <tr><td class="num">6:35</td>
+        <td class="left">Agnieszka</td></tr>
+    <tr><td class="num">6:41</td>
+        <td class="left">NorthForty</td></tr>
+    <tr><td class="num">6:44</td>
+        <td class="left">JuSt</td></tr>
+    <tr><td class="num">6:48</td>
+        <td class="left">B-Huff</td></tr>
+    <tr><td class="num">6:50</td>
+        <td class="left">Gloop</td></tr>
+    <tr><td class="num">6:51</td>
+        <td class="left">Alex</td></tr>
+    <tr><td class="num">6:58</td>
+        <td class="left">Mark P.</td></tr>
+    <tr><td class="num">7:08</td>
+        <td class="left">Klaus+Gottseinsohn</td></tr>
+    <tr><td class="num">7:21</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">7:52</td>
+        <td class="left">Vinksu</td></tr>
+    <tr><td class="num">7:56</td>
+        <td class="left">para_doks</td></tr>
+    <tr><td class="num">8:12</td>
+        <td class="left">Great Scott</td></tr>
+    <tr><td class="num">8:16</td>
+        <td class="left">shoki</td></tr>
+    <tr><td class="num">8:28</td>
+        <td class="left">mhatta</td></tr>
+    <tr><td class="num">8:43</td>
+        <td class="left">biotopa</td></tr>
+    <tr><td class="num">8:46</td>
+        <td class="left">Antonio EE</td></tr>
+    <tr><td class="num">9:08</td>
+        <td class="left">Andy</td></tr>
+    <tr><td class="num">9:18</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">9:23</td>
+        <td class="left">Kosby+mrduke</td></tr>
+    <tr><td class="num">9:46</td>
+        <td class="left">Freshman</td></tr>
+    <tr><td class="num">10:01</td>
+        <td class="left">Sim_Ed</td></tr>
+    <tr><td class="num">10:20</td>
+        <td class="left">fabian</td></tr>
+    <tr><td class="num">10:29</td>
+        <td class="left">Little_Mole</td></tr>
+    <tr><td class="num">10:58</td>
+        <td class="left">ABS</td></tr>
+    <tr><td class="num">11:43</td>
+        <td class="left">Valkyrie2</td></tr>
+    <tr><td class="num">11:45</td>
+        <td class="left">WP319</td></tr>
+    <tr><td class="num">12:03</td>
+        <td class="left">Drotten</td></tr>
+    <tr><td class="num">12:16</td>
+        <td class="left">Melanie</td></tr>
+    <tr><td class="num">13:35</td>
+        <td class="left">Tarim</td></tr>
+    <tr><td class="num">13:38</td>
+        <td class="left">Jeffrey S</td></tr>
+    <tr><td class="num">14:44</td>
+        <td class="left">HuB34</td></tr>
+    <tr><td class="num">20:26</td>
+        <td class="left">mecke</td></tr>
+</table>
+
+<p>Mein erster Versuch liegt schon eine Weile zur&uuml;ck und kann eigentlich
+nicht einmal als Versuch sondern vielmehr als unbedarftes Kugelgeschiebe
+bezeichnet werden. Wie stellte sich mir die Startlandschaft dar:</p>
+
+<ul>
+<li>
+  eine Menge an Impulssteinen und einige Holzsteine durchsetzt mit einem
+  kleinen und einem gr&ouml;&szlig;eren Wasserloch
+  <br>
+  (<span class="blue">Soll ich mir das jetzt genauer ansehen und
+  &uuml;berlegen, wann ich was-wie-wo &hellip; - eigentlich  hatte ich dazu keine
+  Lust, also kommt das Prinzip Schauen-wir-mal-was-passiert zum
+  Einsatz</span>),
+</li><li>
+  ein zug&auml;nglicher Oxydstein und hinter einer geschlossenen T&uuml;r drei
+  weitere Oxydssteine und ein Yinyang-Stein 
+  <br>
+  (<span class="blue">Aha, eine wei&szlig;e Murmel kommt auch noch ins Spiel. Das
+  mit der T&uuml;re k&ouml;nnte vielleicht komplizierter werden - warten wir's
+  ab</span>),
+</li><li>
+  vier Dokumente
+  <br>
+  (<span class="blue">F&uuml;r Tipps ist also auch gesorgt. Das erste liegt gleich in der N&auml;he, also 
+  lesen wir mal: &quot;Ich soll nicht vergessen die T&uuml;r zu &ouml;ffnen &hellip;&quot;. Damit ist wohl der Trigger gemeint &hellip; 
+  super, die T&uuml;re ist offen. Das war ja einfach.</span>),
+  Das erste liegt gleich in der N&auml;he, also 
+  lesen wir mal: &quot;Ich soll nicht vergessen die T&uuml;r zu &ouml;ffnen
+  &hellip;&quot;. Damit ist wohl der Trigger gemeint &hellip; 
+  super, die T&uuml;re ist offen. Das war ja einfach</span>),
+</li><li>
+  einen Ausgang in den n&auml;chsten Raum 
+  <br>
+  (<span class="blue">Zwar durch ein Wasserloch blockiert, aber es liegt ja gen&uuml;gend Holz herum - also kein 
+  Problem</span>),
+</li><li>
+  ach ja, fast h&auml;tte ich's vergessen, zwei One-ways
+  <br>
+  (<span class="blue">Einer raus aus dem Startbereich und einer rein zum
+  'letzten' Oxyd</span>),
+</li><li>
+  und ein st_bolder
+  <br>
+  (<span class="blue">Was der wohl tut, wenn er mal losgelassen ist? K&ouml;nnte
+  &hellip; ach was, wird schon gutgehen</span>).
+</li>
+</ul>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200806_a.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">Ungeblockt &hellip;</div> </div>
+
+<p>Also los gings. T&uuml;re ist ge&ouml;ffnet, einen der unteren Impulssteine
+angesto&szlig;en, um das gr&ouml;&szlig;ere Wasserloch schon mal zur H&auml;lfte
+mit Holz abzudecken, dann durch den One-way, das n&auml;chste Dokument
+aufgesammelt, &quot;Viel Gl&uuml;ck!&quot; steht da zu lesen (<span
+class="blue">Mir schwant B&ouml;ses, aber man ist ja Optimist &hellip;</span>), den
+n&auml;chsten Impulsstein angesto&szlig;en, den ersten Oxydstein ge&ouml;ffnet,
+gem&uuml;tlich weiter bis die Impulssteine die Holzsteine in Position geschubst
+haben, nebenbei noch ein weiteres  Dokument aufgenommen, einen Holzstein in ein
+Wasserloch geschoben, um in den n&auml;chsten Raum zu gelangen, und einen Blick
+reinwerfen,  was der Bolder da anstellen kann.
+</p>
+
+<p>Tja und das war's dann. Ich seh nur noch wie der Bolder an mir vorbei seine
+Bahn zieht und auf dem Trigger parkt. Sollte der &hellip;  Tats&auml;chlich die
+T&uuml;re ist wieder zu und damit das Level nicht mehr zu l&ouml;sen (F3 startet
+das ganze Level neu. &Auml;tsch!). &Uuml;brigens  hatte ich jetzt die Zeit zu
+lesen, was auf dem letzten Dokument steht: &quot;Hurry!&quot; Na wer h&auml;tt's
+gedacht?!<br> Ach ja, wie hei&szlig;t das Level doch gleich? Genau! Also
+gaaanz einfach ;-))) mit einem der '&uuml;brigen' Holzsteine den Bolder
+blockieren. Sooo schwierig kann das doch nicht sein, oder?
+</p>
+
+<p>Also dann, aber diesmal mit mehr Enthusiasmus und vor allem Geschwindigkeit,
+schlie&szlig;lich wei&szlig;t das Levelinfo einen Speedfaktor von drei aus.
+</p>
+
+<p>Zwei Versuche sp&auml;ter hatte ich's dann geschafft. Sorry, ist gelogen - es
+waren deutlich mehr (um ehrlich zu sein, ich habe an  dem Teil bestimmt zwei
+Tage rumgemacht). Entweder war ich wiedermal zu langsam oder zu unachtsam
+(vielzuoft). Aber mit der Zeit  kam dann die Routine &hellip; und irgendwann war's
+dann so weit sich dem Rest zu widmen. Und der ist alles andere als stressig,
+weitere  Geschwindigkeitsparcours - Fehlanzeige.
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200806_b.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">Noch immer zu sp&auml;t!</div>
+</div>
+
+<p>Als n&auml;chstes muss die wei&szlig;e Murmel ins Spiel gebracht werden,
+sonst geht f&uuml;r die schwarze garnichts - ein Holzstein versperrt 
+n&auml;mlich deren weiteren Weg. Na dann auf zum 'Island-Hopping' mit der
+wei&szlig;en Murmel - nein, es muss nicht geh&uuml;pft werden. Mit  Holzsteinen
+wird ein Weg zwischen vier Inseln verlegt. Hier sollten all diejenigen
+vorsichtig agieren, die Probleme mit dem  R&uuml;cksto&szlig; beim Schieben von
+Steinen auf engem Raum haben; gl&uuml;cklicherweise ist aber das Gras nicht nass
+und der Sand eben ganz  normaler Sand.
+</p>
+
+<p>Nachdem auch das geschafft ist, machen sich die schwarze und wei&szlig;e
+Murmel gegenseitig den Weg frei. Nebenbei werden noch ein  paar Oxydsteine
+mitgenommen. Zuletzt muss die schwarze Murmel noch eine Bresche in eine Reihe
+aus Holzsteinen schlagen, um  die verbleibendenen Oxydsteine zu erreichen.
+</p>
+
+<p>Nachdem dann alle Oxydsteine bis auf einen ge&ouml;ffnet sind, kann sich die
+schwarze Murmel auf ihren letzten Weg machen, um mit  dem Ber&uuml;hren des
+Oxydsteins hinter dem One-Way im Startraum das Level erfolgreich zu beenden.
+</p>
+
+<p>Wem &quot;Little Puzzles&quot; und &quot;Big Adventures&quot; optisch und
+technisch zusagen, wird sich sicher in den beiden rechten R&auml;umen von 
+&quot;Block its way!&quot; heimisch f&uuml;hlen; stammen doch alle drei Level
+aus der Feder des gleichen Autors.
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200806_d.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">Ein weiteres gebrochenes Ego &hellip;</div>
+</div>
+
+<p>Wer sich noch an den ersten Satz des Artikels erinnert, wird sich jetzt fragen,
+was ist denn bittesch&ouml;n so lustig an dem Level?  Eigentlich garnichts, wenn
+- ja <b>wenn</b> - man es so spielt, wie gerade beschrieben. Es gibt
+n&auml;mlich noch eine andere  Variante, bei der man den
+Geschwindigkeitsparcours am Anfang einfach ausl&auml;sst (vielen Dank an
+Taztunes f&uuml;r den Tipp). Also alle, die Probleme damit haben oder an einer
+guten Zeit nicht so interessiert sind oder einfach entspannt ein sch&ouml;nes 
+Level in aller Ruhe spielen wollen, sollten folgendes tun:
+<br>
+<i>Vorsicht, es folgt ein Spoiler!</i><div class="spoiler">Die T&uuml;re mit dem
+Trigger &ouml;ffnen und einen der dort umliegenden  Impulsstein ber&uuml;hren,
+dann <b>warten</b> bis sich die T&uuml;re schlie&szlig;t (der Bolder ist dann
+auf dem Trigger angelangt), jetzt  einfach nochmal auf den Trigger und die
+T&uuml;r &ouml;ffnet sich wieder, fertig (siehe Taztunes' Posting zu &quot;Block
+its way!&quot; vom  26. M&auml;rz 2008 im Forum mag-heut.net).</div><i>Ende des
+Spoilers</i>
+</p>
+
+<p>Mir stellen sich dann aber die Fragen, warum hei&szlig;t das Level
+&quot;Block its way!&quot;, warum sollte ich mich &quot;Beeilen!&quot;, wie es 
+auf einem Dokument steht, warum hat das Level einen Speedfaktor von 3? Alles nur
+falsche F&auml;hrten? Am&uuml;siert sich derweilen  der Autor (er m&ouml;ge mir
+verzeihen, wenn ich ihm da etwas f&auml;lschlicherweise unterstelle) &uuml;ber
+all diejenigen, die genauso  leichgl&auml;ubig sind wie ich? Wenn ja, ich find's
+okay LOL. Ich habe auf jeden Fall meine Lektion mit einem L&auml;cheln gerne 
+gelernt. Mir kommt bei so etwas immer Kurt Tucholskys Aussage in den Sinn:
+&quot;<i>La&szlig; dir von keinem Fachmann imponieren, der dir erz&auml;hlt:
+'Lieber Freund, das mache ich schon seit zwanzig Jahren so!' - Man kann eine
+Sache auch zwanzig Jahre lang falsch machen.</i>&quot;
+</p>
+
+<p>Deswegen auch ein riesiges Dankesch&ouml;n an Jon 'WB' Sneyers f&uuml;r ein
+Level, das einem - wie in meinem Fall - die eigene Kurzsichtkeit vor Augen
+h&auml;lt. Und bitte das Level so belassen wie es ist und es nicht
+nachbessern, zumindest ich f&auml;nde das echt schade.
+</p>
+
+<div class="quote">
+Der Level begann aus der Idee des Titels heraus: Ein Rennen gegen die Zeit, um
+einen Bolder davon abzuhalten, auf einem Weltuntergangs-Trigger zu landen. Wenn
+ich mich recht entsinne, wollte ich urspr&uuml;nglich einen Onescreener schreiben,
+wo man von Anfang an sehen konnte, was geschieht. Irgendwie habe ich zuviel
+Platz f&uuml;r die Route der Impulssteine verschwendet, so dass der Bolder gerade
+auf dem n&auml;chsten Bildschirm endete. Dann fing ich an, das zu m&ouml;gen, weil man
+zwar noch sieht, dass der Bolder dort anf&auml;ngt, aber nicht sogleich, was er
+danach macht. Erst wenn man mindestens einmal im n&auml;chsten Raum war, kann man
+wissen, was zu tun ist. So oder so, jetzt hatte ich einen zweiten Raum zu
+f&uuml;llen, also konnte ich auch gleich einen gr&ouml;&szlig;eren Level daraus machen. Ich
+habe schon immer Yin-Yang-Levels gemocht, so entschied ich mich zu einem Level,
+in dem zuerst Schwarz ein R&auml;tsel l&ouml;st (das Blockieren des Bolder, was prim&auml;r
+eine Geschicklichkeitsaufgabe ist), dann l&ouml;st Wei&szlig; ein R&auml;tsel, dann kooperieren
+beide, um den Rest der Karte zu l&ouml;sen. F&uuml;r das wei&szlig;e R&auml;tsel habe ich versucht,
+ein verbinde-die-Inseln-Br&uuml;ckebau-R&auml;tsel zu schreiben, in dem die Br&uuml;cken an
+in gewisser Weise unerwarteten Pl&auml;tzen sein m&uuml;ssen.
+</div>
+
+<div class="author">Jon 'WB' Sneyers</div>
+
+<p><i>NObby</i></p>
+
+<p>Liebe Leserin, lieber Leser, wir haben ein st&auml;ndiges Bed&uuml;rfnis nach
+Ihren Artikeln &uuml;ber Enigmas gro&szlig;e Levels. Bitte, schicken Sie uns
+jeden Artikel, sogar Kommentare, die Sie geschrieben haben, an:</p>
+<pre>
+<a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
+</pre>
+<p>Wir sind besonders interessiert an Artikeln &uuml;ber die folgenden Levels:
+</p>
+<ul>
+<li>&quot;Plan Ahead&quot; von Jacob Scott</li>
+<li>&quot;River of Challenges&quot; von Lukas Sch&uuml;ller</li>
+<li>&quot;Procrustes&quot; by Andreas Lochmann</li>
+</ul>
+<p>Vielen Dank im voraus, nur Ihre Mithilfe kann den LdM am Leben erhalten!</p>
+
+<p><i>Ihr Enigma-Team</i></p>
+
+</div>

Modified: feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua	2008-06-07 09:32:30 UTC (rev 1167)
+++ feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua	2008-06-11 00:47:29 UTC (rev 1168)
@@ -130,23 +130,33 @@
   position_num   = "6095"
 }
 
+lotm_archive_data[15] = {
+  date           = { month = 6, year = 2008 },
+  chronological  = 15,
+  name           = "Block its way!",
+  author         = "Jon 'WB' Sneyers",
+  position       = "III/66",
+  position_num   = "3066"
+}
+
 -- LotM variable data
 -- format: Level Title, current_rating, current_votes, additional text
 
-lotm_rating(    "Island Labyrinth",  9.27,  11,  "")
-lotm_rating(  "Pneumatic Delivery",  8.13,  15,  "")
+lotm_rating(    "Island Labyrinth",  9.31,  13,  "")
+lotm_rating(  "Pneumatic Delivery",  8.19,  16,  "")
 lotm_rating(    "The Aztec Temple",  9.00,  11,  "")
-lotm_rating("Labyrinth of Puzzles",  8.81,  16,  "")
-lotm_rating(           "Elaborate",  8.44,   9,  "")
-lotm_rating(             "Houdini",  9.22,   7,  "")
+lotm_rating("Labyrinth of Puzzles",  8.82,  17,  "")
+lotm_rating(           "Elaborate",  8.50,  10,  "")
+lotm_rating(             "Houdini",  9.28,   8,  "")
 lotm_rating(           "Tool Time",  8.52,  21,  "")
 lotm_rating(         "Quadropolis",  9.20,  10,  "")
-lotm_rating(      "Big Adventures",  8.39,  23,  "")
+lotm_rating(      "Big Adventures",  8.42,  24,  "")
 lotm_rating(      "Temple of Gold",  9.29,   7,  "")
 lotm_rating(      "Puzzle Puzzles",  8.83,   6,  "")
-lotm_rating(      "Psycho Pushing",  8.20,  10,  "")
-lotm_rating(  "Turnstiles for Two",  9.00,   4,  "")
-lotm_rating(     "Pleasure Garden",  8.36,  14,  "<b>(newcomer)</b>")
+lotm_rating(      "Psycho Pushing",  8.18,  11,  "")
+lotm_rating(  "Turnstiles for Two",  9.00,   5,  "")
+lotm_rating(     "Pleasure Garden",  8.43,  14,  "")
+lotm_rating(      "Block its way!",  8.00,  16,  "<b>(newcomer)</b>")
 
 -- Don't forget to adjust the archive dates:
 



From ral at mail.berlios.de  Thu Jun 12 00:12:51 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 12 Jun 2008 00:12:51 +0200
Subject: [Enigma-game-svn] r1169 - in trunk: data src
Message-ID: <200806112212.m5BMCp0P019421@sheep.berlios.de>

Author: ral
Date: 2008-06-12 00:12:50 +0200 (Thu, 12 Jun 2008)
New Revision: 1169

Modified:
   trunk/data/api2init.lua
   trunk/src/WorldProxy.cc
Log:
Trunk 1.1: new API reengineering
- unify ActorImpulseStone: rename world attribute from "BumperStrength" to
  "ActorimpulseStrength"
- rename world method: from "drawmap()" to "drawMap()"
- add world methods:
  - drawBorder()
  - drawRect()


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-06-11 00:47:29 UTC (rev 1168)
+++ trunk/data/api2init.lua	2008-06-11 22:12:50 UTC (rev 1169)
@@ -118,25 +118,67 @@
 -- Utility Methods --
 ---------------------
 
-function drawmap(world, resolver, origin, ignore, map)
-    local len = string.len(ignore)
-    for y=1, #map do
-        local linelen = string.len(map[y])
-        if math.fmod(linelen, len) ~= 0 then
-            error("drawmap map line ".. y .. " with odd length", 2)
+wo:_register("drawMap", 
+    function (world, resolver, origin, ignore, map)
+        -- TODO check validity of arguements
+        local len = string.len(ignore)
+        for y=1, #map do
+            local linelen = string.len(map[y])
+            if math.fmod(linelen, len) ~= 0 then
+                error("drawmap map line ".. y .. " with odd length", 2)
+            end
+            for x = 1, linelen/len do
+                local key = string.sub(map[y], len*(x-1)+1, len*x)
+                if key ~= ignore then
+                    world[origin + {x-1, y-1}] =  
+                            world:_evaluate(resolver, key, origin.x + x - 1, 
+                                    origin.y + y-1)
+                end
+            end
         end
-        for x = 1, linelen/len do
-            local key = string.sub(map[y], len*(x-1)+1, len*x)
-            if key ~= ignore then
-                world[origin + {x-1, y-1}] =  
-                        world:_evaluate(resolver, key, origin.x + x - 1, 
-                                origin.y + y-1)
+    end
+)
+
+wo:_register("drawBorder", 
+    function (world, origin, arg2, arg3, arg4)
+        local dest = arg2
+        local tile = arg3
+        if type(arg2) == "number" and type(arg3) == "number" then
+            dest = po(origin.x + arg2 - 1, origin.y + arg3 - 1)
+            tile = arg4
+        end
+        -- TODO check validity of arguements
+        for x = origin.x, dest.x do
+            wo[{x, origin.y}] = tile
+            if origin.y ~= dest.y then
+                wo[{x, dest.y}] = tile
             end
         end
+        for y = origin.y + 1, dest.y -1 do
+            wo[{origin.x, y}] = tile
+            if origin.x ~= dest.x then
+                wo[{dest.x, y}] = tile
+            end
+        end
     end
-end
+)
 
-wo:_register("drawmap", drawmap)
+wo:_register("drawRect", 
+    function (world, origin, arg2, arg3, arg4)
+        local dest = arg2
+        local tile = arg3
+        if type(arg2) == "number" and type(arg3) == "number" then
+            dest = po(origin.x + arg2 - 1, origin.y + arg3 - 1)
+            tile = arg4
+        end
+        -- TODO check validity of arguements
+        for x = origin.x, dest.x do
+            for y = origin.y, dest.y do
+                wo[{x, y}] = tile
+            end
+        end
+    end
+)
 
 ---------------
 -- Resolvers --

Modified: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2008-06-11 00:47:29 UTC (rev 1168)
+++ trunk/src/WorldProxy.cc	2008-06-11 22:12:50 UTC (rev 1169)
@@ -63,7 +63,7 @@
             return Width();
         } else if (key == "Brittleness") {
             return server::Brittleness;
-        } else if (key == "BumperStrength") {
+        } else if (key == "ActorimpulseStrength") {
             return server::BumperForce;
         } else if (key == "ElectricForce") {
             return server::ElectricForce;
@@ -111,7 +111,7 @@
             STATUSBAR->show_move_counter (server::ShowMoves);
         } else if (key == "Brittleness") {
             server::Brittleness = val;
-        } else if (key == "BumperStrength") {
+        } else if (key == "ActorimpulseStrength") {
             server::BumperForce = val;
         } else if (key == "ElectricForce") {
             server::ElectricForce = val;



From ral at mail.berlios.de  Thu Jun 12 00:24:43 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 12 Jun 2008 00:24:43 +0200
Subject: [Enigma-game-svn] r1170 - team_levelpacks/team_test_new_api
Message-ID: <200806112224.m5BMOhKh020492@sheep.berlios.de>

Author: ral
Date: 2008-06-12 00:24:43 +0200 (Thu, 12 Jun 2008)
New Revision: 1170

Added:
   team_levelpacks/team_test_new_api/ralD004_1.xml
   team_levelpacks/team_test_new_api/ralD005_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT035_1.xml
   team_levelpacks/team_test_new_api/ralT050_1.xml
Log:
Test Level new API:
- added demo level for random resolver
- added demo level for drawMap method
- update of other levels

Added: team_levelpacks/team_test_new_api/ralD004_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD004_1.xml	2008-06-11 22:12:50 UTC (rev 1169)
+++ team_levelpacks/team_test_new_api/ralD004_1.xml	2008-06-11 22:24:43 UTC (rev 1170)
@@ -0,0 +1,58 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Demo Random Resolver" el:subtitle="" el:id="20080608ral108"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti["~"] = {"fl-water"}
+ti["s"] = {"fl-sahara"}
+ti["t"] = {"fl-tigris"}
+ti["i"] = {"fl-inverse2"}
+ti["b"] = {"fl-acblack"}
+ti["w"] = {"fl-acwhite"}
+
+ti["c"] = {"it_coin_s"}
+ti["p"] = {"it_brush"}
+
+ti["1"] = {"ac-blackball", 0, 0.5}
+
+simple_random = res.random(ti, " ", {"s", "t"})
+
+full_random = res.random(simple_random, {".",{"C","c"},{"p","p"}},
+                                        {{"i",3},{"b",4},{"w",1}})
+
+w, h = wo(full_random, "s", {
+"         ~~.........",
+"         ~~.........",
+"         ~~......C..",
+"         ~~.........",
+"         ~~.........",
+"         ~~.........",
+"         c1.........",
+"         ~~.........",
+"         ~~.........",
+"         ~~.........",
+"         ~~......p..",
+"         ~~.........",
+"         ~~........."
+})
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralD004_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralD005_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD005_1.xml	2008-06-11 22:12:50 UTC (rev 1169)
+++ team_levelpacks/team_test_new_api/ralD005_1.xml	2008-06-11 22:24:43 UTC (rev 1170)
@@ -0,0 +1,68 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Demo Draw Map" el:subtitle="" el:id="20080610ral774"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl-plank"}
+ti["X"] = {"st_oxyd"}
+ti["B"] = {"st-black3"}
+ti["W"] = {"st-white3"}
+
+ti["y"] = {"it-yinyang"}
+ti["1"] = ti["y"] .. {"#ac-blackball"}
+ti["2"] = ti["y"] .. {"#ac-whiteball"}
+
+function myresolver(key, x, y)
+    if key == "w" then
+        wo:drawMap(ti, po(x-1, y-1), "-", {"-W-",
+                                           "WXW",
+                                           "-W-"})
+        return ti({})
+    elseif key == "b" then
+        wo:drawMap(ti, po(x-1, y-1), "-", {"-B",
+                                           "BXB",
+                                           "-B"})
+        return ti({})
+    else
+        return ti[key]
+    end
+end
+
+w, h = wo(myresolver, " ", {
+"                    ",
+"  b         b       ",
+"       w       w    ",
+"                    ",
+"                    ",
+"   w                ",
+"         12      b  ",
+"              w     ",
+"         w          ",
+"      b             ",
+"   w           b    ",
+"         b          ",
+"                    "
+})
+
+wo:shuffleOxyd()
+]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralD005_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Modified: team_levelpacks/team_test_new_api/ralT035_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT035_1.xml	2008-06-11 22:12:50 UTC (rev 1169)
+++ team_levelpacks/team_test_new_api/ralT035_1.xml	2008-06-11 22:24:43 UTC (rev 1170)
@@ -19,6 +19,9 @@
 wo["ConserveLevel"] = true
 
 ti["  "] = {"fl-sahara"}
+ti["~~"] = {"fl-water"}
+ti["##"] = {"st-rock1"}
+ti["++"] = {"st-wood"}
 ti[" 1"] = ti["  "] .. {"#ac-blackball"}
 
 -- sample of create world without a given map - just default floors
@@ -53,12 +56,17 @@
     end
 end
 
-wo:drawmap(myresolver, po({wo.Width-10, wo.Height-5}), "--", {
+wo:drawMap(myresolver, po({wo.Width-10, wo.Height-5}), "--", {
   "----######",
   "######----######",
   "------######"
 })
 
+wo:drawBorder(po(0,0), w, h, ti["##"])
+wo:drawBorder(po(3,3), po(6,5), ti["++"])
+
+wo:drawRect(po(10,2), 5, 3, ti["~~"])
+
   ]]></el:luamain>
     <el:i18n>
 	 <el:string el:key="title">

Modified: team_levelpacks/team_test_new_api/ralT050_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT050_1.xml	2008-06-11 22:12:50 UTC (rev 1169)
+++ team_levelpacks/team_test_new_api/ralT050_1.xml	2008-06-11 22:24:43 UTC (rev 1170)
@@ -16,6 +16,7 @@
     </el:info>
     <el:luamain><![CDATA[
 wo["ConserveLevel"] = true
+wo["ActorImpulseStrength"] = 150
 
 ti[" "] = {"fl-sahara"}
 ti["A"] = {"st_actorimpulse"}



From raoul at mail.berlios.de  Thu Jun 12 21:01:14 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Thu, 12 Jun 2008 21:01:14 +0200
Subject: [Enigma-game-svn] r1171 - in trunk: lib-src/enigma-core src src/gui
Message-ID: <200806121901.m5CJ1EHQ023739@sheep.berlios.de>

Author: raoul
Date: 2008-06-12 21:01:14 +0200 (Thu, 12 Jun 2008)
New Revision: 1171

Modified:
   trunk/lib-src/enigma-core/ecl_util.hh
   trunk/src/Utf8ToXML.cc
   trunk/src/file.hh
   trunk/src/gui/widgets.cc
Log:
-> Fix trunk to compile with gcc 4.3.*
   For more infos, please look at:
   http://gcc.gnu.org/gcc-4.3/porting_to.html



Modified: trunk/lib-src/enigma-core/ecl_util.hh
===================================================================
--- trunk/lib-src/enigma-core/ecl_util.hh	2008-06-11 22:24:43 UTC (rev 1170)
+++ trunk/lib-src/enigma-core/ecl_util.hh	2008-06-12 19:01:14 UTC (rev 1171)
@@ -20,6 +20,7 @@
 #define ECL_UTIL_HH_INCLUDED
 
 #include <string>
+#include <algorithm>
 
 /* hide GNU extensions for non-gnu compilers: */
 #ifndef __GNU__

Modified: trunk/src/Utf8ToXML.cc
===================================================================
--- trunk/src/Utf8ToXML.cc	2008-06-11 22:24:43 UTC (rev 1170)
+++ trunk/src/Utf8ToXML.cc	2008-06-12 19:01:14 UTC (rev 1171)
@@ -17,6 +17,7 @@
  *
  */
 
+#include <cstring>
 #include "Utf8ToXML.hh"
 #include "main.hh"
 #include <xercesc/util/XMLString.hpp>

Modified: trunk/src/file.hh
===================================================================
--- trunk/src/file.hh	2008-06-11 22:24:43 UTC (rev 1170)
+++ trunk/src/file.hh	2008-06-12 19:01:14 UTC (rev 1171)
@@ -22,6 +22,7 @@
 #include <iosfwd>
 #include <vector>
 #include <list>
+#include <memory>
 #include "ecl_error.hh"
 
 namespace enigma

Modified: trunk/src/gui/widgets.cc
===================================================================
--- trunk/src/gui/widgets.cc	2008-06-11 22:24:43 UTC (rev 1170)
+++ trunk/src/gui/widgets.cc	2008-06-12 19:01:14 UTC (rev 1171)
@@ -28,6 +28,7 @@
 #include <cassert>
 #include <algorithm>
 #include <iostream>
+#include <climits>
 
 using namespace enigma::gui;
 using namespace ecl;



From ral at mail.berlios.de  Fri Jun 13 00:12:28 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 13 Jun 2008 00:12:28 +0200
Subject: [Enigma-game-svn] r1172 - trunk/doc/reference
Message-ID: <200806122212.m5CMCSuA014443@sheep.berlios.de>

Author: ral
Date: 2008-06-13 00:12:27 +0200 (Fri, 13 Jun 2008)
New Revision: 1172

Modified:
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk 1.1: new API reengineering
- refman update:
  - drawMap, drawBorder, drawRect, 
  - random resolver
  - common messages
  - global attr. ActorimpulseStrength

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-06-12 19:01:14 UTC (rev 1171)
+++ trunk/doc/reference/enigma-ref.texi	2008-06-12 22:12:27 UTC (rev 1172)
@@ -3574,10 +3574,24 @@
 String that contains the tile key to be resolved.
 @item @i{x}
 The world x coordinate of the tile.
- at item @i{x}
+ at item @i{y}
 The world y coordinate of the tile.
 @end table
 
+ at item @b{Details:}
+A custom resolver function is the last resolver that is called in the chain.
+It has to return the final tile that should be drawn at the given position.
+This can be done by statement @samp{return ti["k"]}, which references the tile
+already declared in the tiles map.
+
+If no suited tile is already declared you can alternatively return a new tile
+like @samp{return ti(@{"st_switch", state=ON@})}.
+
+If you decide not to draw any tile at all, you must return an empty tile
+declaration: @samp{return ti(@{@})}.
+
+ at samp{return nil} indicates an error of usage of an unknown tile key.
+
 @item @b{Example:}
 @example
 ti["r"] = @{"fl_rough_red"@}
@@ -3872,29 +3886,106 @@
 @node toggle
 @subsection toggle
 
+This is the default message that is always taken if no other message is provided.
+It toggels the @ref{Object State} quite independant of the very nature of the
+state. Two-stated objects like switches will toggle their state form @samp{ON}
+to @samp{OFF} or from @samp{OFF} to @samp{ON}. Door like objects will toggle 
+their state form @samp{OPEN} to @samp{CLOSED} or from @samp{CLOSED} to 
+ at samp{OPEN}. Other objects like @ref{st_fourswitch} will turn into the next
+direction. Generally the object will toggle to its next state.
+
+ at table @asis
+ at item @b{Value:} @ @ -
+ at item @b{Returns:} @ @ -
+ at item @b{Support:} @ @ by nearly all objects which use the @samp{state} attribute
+ at end table
+
 @node nop
 @subsection nop
 
+A dummy message that just does nothing: no operation. You may need it in cases
+of state dependent actions to block an otherwise sent default @samp{toggle}
+message (@pxref{Object State}).
+
+ at table @asis
+ at item @b{Value:} @ @ -
+ at item @b{Returns:} @ @ -
+ at item @b{Support:} @ @ by all objects
+ at end table
+
 @node signal
 @subsection signal
 
+A signal message tries to set the object to the state 0 (@samp{OFF}, 
+ at samp{CLOSED}) or state 1 (@samp{ON}, @samp{OPEN}) according to its value. This
+message allows you to keep the states of a action source and a receiving object
+in sync. Note that values like @samp{true}, @samp{false} and direction values
+like @samp{WEST} to @samp{NORTH} are converted to 0 and 1. This allows you to
+use @samp{signal} as action message on most objects.
+
+ at table @asis
+ at item @b{Value:} @ @ @code{0}, @code{1}
+ at item @b{Returns:} @ @ -
+ at item @b{Support:} @ @ by nearly all objects which use the @samp{state} attribute
+ at end table
+
 @node on
 @subsection on
 
+This message is just supported by objects that can be switched on and off. Just
+objects in state @samp{OFF} will be switched on. An object in state @samp{ON}
+remains unchanged in its state.
+
+ at table @asis
+ at item @b{Value:} @ @ -
+ at item @b{Returns:} @ @ -
+ at item @b{Support:} @ @ by objects that can be switched on and off
+ at end table
+
 @node off
 @subsection off
 
+This message is just supported by objects that can be switched on and off. Just
+objects in state @samp{ON} will be switched off. An object in state @samp{OFF}
+remains unchanged in its state.
+
+ at table @asis
+ at item @b{Value:} @ @ -
+ at item @b{Returns:} @ @ -
+ at item @b{Support:} @ @ by objects that can be switched on and off
+ at end table
+
 @node open
 @subsection open
 
+This message is just supported by door like objects that can be opened and closed.
+Just objects in state @samp{CLOSED} will be opened. An object in state 
+ at samp{OPEN} remains unchanged in its state.
+
+ at table @asis
+ at item @b{Value:} @ @ -
+ at item @b{Returns:} @ @ -
+ at item @b{Support:} @ @ by door like objects that can be opened and closed
+ at end table
+
 @node close
 @subsection close
 
+This message is just supported by door like objects that can be opened and closed.
+Just objects in state @samp{OPEN} will be closed. An object in state 
+ at samp{CLOSED} remains unchanged in its state.
+
+ at table @asis
+ at item @b{Value:} @ @ -
+ at item @b{Returns:} @ @ -
+ at item @b{Support:} @ @ by door like objects that can be opened and closed
+ at end table
+
 @node Global Attributes
 @section Global Attributes
 
 @menu
-* BumperStrength::
+* ActorimpulseStrength::
 * ExtralifeGlasses::
 * Height::
 * IsDifficult:: 
@@ -3906,11 +3997,11 @@
 * WormholeStrength:: 
 @end menu
 
- at node BumperStrength
- at subsection BumperStrength
+ at node ActorimpulseStrength
+ at subsection ActorimpulseStrength
 
-A global scalar default factor for the actorimpulse bumping force. This global 
-value is only used if no object specific value is set. 
+A global scalar default factor for the actorimpulse stone bumping force. This 
+global value is only used if no object specific value is set. 
 
 @table @asis
 @item @b{Type:} @ @ number
@@ -4445,7 +4536,7 @@
 The current magnet state - @samp{ON} for an active magnet, @samp{OFF} for an
 inactive magnet.
 
- at item @b{range} @ @ @i{values}: float number greater equal 0; @ @ @i{default}: @code{10.0} @ @ @xref{MagnetRange}
+ at item @b{range} @ @ @i{values}: float number greater or equal 0; @ @ @i{default}: @code{10.0} @ @ @xref{MagnetRange}
 The distance up to which the magnet applies forces to actors.
 
 @item @b{strength} @ @ @i{values}: float number; @ @ @i{default}: @code{+30.0} @ @ @xref{MagnetStrength}
@@ -4755,7 +4846,7 @@
 @item @b{destination}, @ @ @i{values}: tokens or position; @ @ @i{default}: @code{nil} @ @ @xref{destination}
 The destination of the teleport given by an object or a position.
 
- at item @b{range} @ @ @i{values}: float number greater equal 0; @ @ @i{default}: @code{10.0} @ @ @xref{WormholeRange}
+ at item @b{range} @ @ @i{values}: float number greater or equal 0; @ @ @i{default}: @code{10.0} @ @ @xref{WormholeRange}
 The distance up to which the wormhole applies forces to actors.
 
 @item @b{strength} @ @ @i{values}: float number; @ @ @i{default}: @code{+30.0} @ @ @xref{WormholeStrength}
@@ -4766,7 +4857,7 @@
 @item @b{scissor}, @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{true}
 Rubberband cutting behaviour on teleporting.
 
- at item @b{interval} @ @ @i{values}: float number greater equal 0; @ @ @i{default}: @code{0.0}
+ at item @b{interval} @ @ @i{values}: float number greater or equal 0; @ @ @i{default}: @code{0.0}
 The latency time after a teleport during which no further teleports take place.
 
 
@@ -5038,7 +5129,7 @@
 Actors that hit this stone will not be reflected just passively. An additional
 force will be applied to them that can even be distorted. By default the actors
 are just pushed away from the center of the stone. A global attribute
- at ref{BumperStrength} gives a default force that can be overridden by the 
+ at ref{ActorimpulseStrength} gives a default force that can be overridden by the 
 stone attribute @samp{strength}.
 
 For sophisticated usage you can distort this force by usage of the @ref{hit_*}
@@ -5064,7 +5155,7 @@
 @item @b{invisible} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 An invisible actorimpulse stone is totally transparent. But the user will
 notice it, as actors will bounce with addtional impulses.
- at item @b{strength} @ @ @i{values}: float number; @ @ @i{default}: @code{+200.0} @ @ @xref{BumperStrength}
+ at item @b{strength} @ @ @i{values}: float number; @ @ @i{default}: @code{+200.0} @ @ @xref{ActorimpulseStrength}
 A scalar factor for the impulse force. Positive numbers are attracting forces
 where as negative numbers are repelling forces.
 @item @b{hit_factor} @ @ @i{values}: float number; @ @ @i{default}: @code{nil} @ @ @xref{hit_*}
@@ -6115,10 +6206,186 @@
 @section World Advanced Methods
 
 @menu 
+* drawBorder::   
+* drawMap::      
+* drawRect::     
 * shuffleOxyd::  Oxyd Shuffling Rules
-* drawMap::      
 @end menu
 
+ at c ----------------- drawBorder -------------------- 
+ at node drawBorder
+ at subsection drawBorder
+
+Draw a border around a rectangle out of given tiles.
+
+ at table @asis
+ at item @b{Syntax:}
+ at b{wo:drawBorder}(@i{upperleft_edge}, @i{lowerright_edge}, @i{tile})
+
+ at b{wo:drawBorder}(@i{upperleft_edge}, @i{width}, @i{height}, @i{tile})
+
+ at table @asis
+ at item @i{upperleft_edge}
+Upper left anchor position of the rectangle. 
+ at item @i{lowerright_edge}
+Lower right end position of the rectangle. 
+ at item @i{width}
+Width of the rectangle. 
+ at item @i{height}
+Height of the rectangle. 
+ at end table
+
+ at item @b{Syntax Samples:}
+ at example
+wo:drawBorder(po(0, 0), wo["Width"], wo["Height"], ti["#"])
+wo:drawBorder(no["myRectUL"], no["myRectLR"], @{"st_grate1"@})
+ at end example
+
+ at item @b{Details:}
+
+
+
+ at item @b{Full Example:}
+ at example
+ at end example
+ at end table
+
+ at c ----------------- drawMap -------------------- 
+ at node drawMap
+ at subsection drawMap
+
+Even if the world is initialized by a map on creation of the world 
+(@pxref{World Creation and Resolver Chaining}), it is sometime useful to 
+be able to draw smaller submaps either as part of the initialization or as
+dynamic level changes within @ref{Callback Function}. Of course the main purpose
+of @samp{drawMap} is the drawing of repeating patterns.
+
+ at table @asis
+ at item @b{Syntax:}
+
+ at b{wo:drawMap}(@i{resolver}, @i{anchor}, @i{ignore}, @i{map})
+
+ at table @asis
+ at item @i{subresolver}
+Resolver to which unresolved requests should be forwarded. May be @samp{ti}
+as the final resolver of the resolver chain.
+ at item @i{anchor}
+The anchor position where the upper left tile of the map should be drawn.
+ at item @i{ignore}
+A tile key string that should be ignored. This key string is mandatory, even
+if it not used within the map.
+ at item @i{map}
+A table of strings. Each string describes a row of tiles by its tile keys.
+ at end table
+
+ at item @b{Syntax Samples:}
+ at example
+wo:drawMap(ti, po(5, 7), "-", @{"abcabc"@})
+wo:drawMap(ti, anchor_object, "--", @{"--##--##","##--##"@})
+ at end example
+
+ at item @b{Details:}
+The syntax is similar to the world creation call. But there are two essential
+difference you need to be aware of. First the map is drawn in the already
+existing world. Thus we need to define the position. This is done via the
+anchor position, which can be an already existing object, too.
+
+The second difference is in the definition of a tile key string for tiles in 
+the map that should be ignored. Remember that the world initialization requested
+a default tile key string. This default is still valid. But with the given 
+ignore key string we can draw arbitrary shaped patterns by filling unused
+grids in the map with this key.
+
+The length of the ignore key defines the map key length. It is strongly
+recommended to use the same key length as in the world map.
+
+The rows of the supplied map are drawn from the anchor position. The rows may
+be of different length and may start with ignore tile keys. The anchor must be
+the position composed of the smallest x and smallest y coordinate within the
+pattern.
+
+You can use drawMap anywhere after the world creation. You are even allowed to
+use it within the world creation in a resolver.
+
+ at item @b{Full Example:}
+ at example
+ti[" "] = @{"fl-plank"@}
+ti["X"] = @{"st_oxyd"@}
+ti["B"] = @{"st-black3"@}
+ti["W"] = @{"st-white3"@}
+ti["y"] = @{"it-yinyang"@}
+ti["1"] = ti["y"] .. @{"#ac-blackball"@}
+ti["2"] = ti["y"] .. @{"#ac-whiteball"@}
+
+function myresolver(key, x, y)
+    if key == "w" then
+        wo:drawMap(ti, po(x-1, y-1), "-", @{"-W-",
+                                           "WXW",
+                                           "-W-"@})
+        return ti(@{@})
+    elseif key == "b" then
+        wo:drawMap(ti, po(x-1, y-1), "-", @{"-B",
+                                           "BXB",
+                                           "-B"@})
+        return ti(@{@})
+    else
+        return ti[key]
+    end
+end
+
+w, h = wo(myresolver, " ", @{
+"                    ",
+"  b         b       ",
+"       w       w    ",
+"                    ",
+"                    ",
+"   w                ",
+"         12      b  ",
+"              w     ",
+"         w          ",
+"      b             ",
+"   w           b    ",
+"         b          ",
+"                    "
+@})
+wo:shuffleOxyd()
+ at end example
+ at end table
+
+ at c ----------------- drawRect -------------------- 
+ at node drawRect
+ at subsection drawRect
+
+ at table @asis
+ at item @b{Syntax:}
+ at b{wo:drawRect}(@i{upperleft_edge}, @i{lowerright_edge}, @i{tile})
+
+ at b{wo:drawRect}(@i{upperleft_edge}, @i{width}, @i{height}, @i{tile})
+
+ at table @asis
+ at item @i{upperleft_edge}
+Upper left anchor position of the rectangle. 
+ at item @i{lowerright_edge}
+Lower right end position of the rectangle. 
+ at item @i{width}
+Width of the rectangle. 
+ at item @i{height}
+Height of the rectangle. 
+ at end table
+
+ at item @b{Syntax Samples:}
+ at example
+wo:drawRect(po(0, 0), wo["Width"], wo["Height"], ti[" "])
+wo:drawRect(no["myRectUL"], no["myRectLR"], @{"fl_water"@})
+ at end example
+
+ at item @b{Details:}
+ at item @b{Full Example:}
+ at example
+ at end example
+ at end table
+
+
 @c ----------------- shuffleOxyd -------------------- 
 @node shuffleOxyd
 @subsection shuffleOxyd
@@ -6291,11 +6558,6 @@
 shared pairs of oxyds do exist.
 @end table
 
- at c ----------------- drawMap -------------------- 
- at node drawMap
- at subsection drawMap
-
-
 @node Resolvers
 @section Resolvers
 
@@ -6530,12 +6792,111 @@
 @node res.maze
 @subsection res.maze
 
+
+ at c ----------------- Random Resolver -------------------- 
+
 @node res.random
 @subsection res.random
 
+With map based level description you have explicit control about the objects
+being set on every single grid. But sometimes you may want to introduce some
+randomness in the used objects. E.g. a floor may be made up of two types at
+random to generate a different look on every level start. The randomness would
+even make a level more difficult to play if one of the two floors would 
+invert the mouse forces. The random resolver allows you to set up such
+cases.
 
+ at table @asis
+ at item @b{Syntax:}
 
+ at b{res.random}(@i{subresolver}, @i{hits}, @i{replacements})
 
+ at table @asis
+ at item @i{subresolver}
+Resolver to which unresolved requests should be forwarded. May be @samp{ti}
+as the final resolver of the resolver chain.
+ at item @i{hits} = @i{key} | @{@i{hit}, @i{hit}, ...@}
+Either a single tile key string that defines the tiles to be randomized, or a
+table of hit descriptors that should all be examined in parallel.
+ at item @i{hit} = @i{key} | @{@i{key}, @i{superkey}@}
+Either a single tile key string or a pair of tile key string and a related
+tile superkey string. The superkey tile will be set additionally to the random
+replacement.
+ at item @i{replacements} = @i{key} | @{@i{replacement}, @i{replacement}, ...@}
+Either a single tile key string that would be taken without randomness or as in
+most cases a table of replacement descriptors from which the resulting tile
+should be selected with randomness.
+ at item @i{replacement} = @i{key} | @{@i{key}, @i{frequency}@}
+Either a single tile key string that should be taken with a frequency of @samp{1},
+or a pair of a tile key string with a given frequency number.
+ at end table
+
+ at item @b{Syntax Samples:}
+ at example
+res.random(ti, "x", @{"a", "b"@})
+res.random(ti, @{@{"x", "y"@},@{"i","j"@}@}, @{@{"a", 2@}, @{"b", 1@}@})
+ at end example
+
+ at item @b{Details:}
+Every key in the map is checked against the given hit key strings. If it fits
+one of them a replacement will take place.
+
+The replacement will be one of the replacement tile keys resolved via the
+subresolver. The different keys will be chosen with a likelyhood according to
+the ratio of the given frequency numbers. If no frequency is supplied a default
+of @samp{1} is taken. Thus in the first example both keys are taken in an ratio
+1:1, whereas in the second the ratio will be 2:1.
+
+When a superkey is given for a hit key this superkey will additionally be 
+resolved via the subresolver. This feature allows to use randomness on tiles
+with more than one object on a grid position. E.g. an item or an actor on a
+random floor. The other objects can be set via the superkey while the random
+floor is set according to the replacement rules.
+
+ at item @b{Full Example:}
+ at example
+ti["~"] = @{"fl-water"@}
+ti["s"] = @{"fl-sahara"@}
+ti["t"] = @{"fl-tigris"@}
+ti["i"] = @{"fl-inverse2"@}
+ti["b"] = @{"fl-acblack"@}
+ti["w"] = @{"fl-acwhite"@}
+
+ti["c"] = @{"it_coin_s"@}
+ti["p"] = @{"it_brush"@}
+
+ti["1"] = @{"ac-blackball", 0, 0.5@}
+
+simple_random = res.random(ti, " ", @{"s", "t"@})
+
+full_random = res.random(simple_random, @{".",@{"C","c"@},@{"p","p"@}@},
+                                        @{@{"i",3@},@{"b",4@},@{"w",1@}@})
+
+w, h = wo(full_random, "s", @{
+"         ~~.........",
+"         ~~.........",
+"         ~~......C..",
+"         ~~.........",
+"         ~~.........",
+"         ~~.........",
+"         c1.........",
+"         ~~.........",
+"         ~~.........",
+"         ~~.........",
+"         ~~......p..",
+"         ~~.........",
+"         ~~........."
+})
+ at end example
+
+Note that in this example we can use @samp{p} as key as well as superkey. This
+is due to the fact that nowhere else this tile is directly set. Whereas the
+tile key @samp{c} is used for another tile with the default floor. Thus we do
+need to use another unique key @samp{C} for the coin on our random floor. 
+
+ at end table
+
+
 @node Tips and Tricks
 @section Tips and Tricks
 
@@ -6743,7 +7104,7 @@
 coordinates for postprocessing operations in the finalizer.
 
 @item @b{Full Example:}
-The implementatio of the composer (without the special 3 character key treatment)
+The implementation of the composer (without the special 3 character key treatment)
 @example
 function res.composer_implementation(context, evaluator, key, x, y)
     local tile = evaluator(context[3], key, x, y)



From raoul at mail.berlios.de  Fri Jun 13 15:00:29 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Fri, 13 Jun 2008 15:00:29 +0200
Subject: [Enigma-game-svn] r1173 - in branches/1.01: lib-src/enigma-core src
	src/gui
Message-ID: <200806131300.m5DD0Thl021301@sheep.berlios.de>

Author: raoul
Date: 2008-06-13 15:00:22 +0200 (Fri, 13 Jun 2008)
New Revision: 1173

Modified:
   branches/1.01/lib-src/enigma-core/ecl_util.hh
   branches/1.01/src/Utf8ToXML.cc
   branches/1.01/src/file.hh
   branches/1.01/src/gui/widgets.cc
Log:
-> Fix branch/1.01 to compile with gcc 4.3.*
   For more infos, please look at:
   http://gcc.gnu.org/gcc-4.3/porting_to.html



Modified: branches/1.01/lib-src/enigma-core/ecl_util.hh
===================================================================
--- branches/1.01/lib-src/enigma-core/ecl_util.hh	2008-06-12 22:12:27 UTC (rev 1172)
+++ branches/1.01/lib-src/enigma-core/ecl_util.hh	2008-06-13 13:00:22 UTC (rev 1173)
@@ -20,6 +20,7 @@
 #define ECL_UTIL_HH_INCLUDED
 
 #include <string>
+#include <algorithm>
 
 /* hide GNU extensions for non-gnu compilers: */
 #ifndef __GNU__

Modified: branches/1.01/src/Utf8ToXML.cc
===================================================================
--- branches/1.01/src/Utf8ToXML.cc	2008-06-12 22:12:27 UTC (rev 1172)
+++ branches/1.01/src/Utf8ToXML.cc	2008-06-13 13:00:22 UTC (rev 1173)
@@ -17,6 +17,7 @@
  *
  */
 
+#include <cstring>
 #include "Utf8ToXML.hh"
 #include "main.hh"
 #include <xercesc/util/XMLString.hpp>

Modified: branches/1.01/src/file.hh
===================================================================
--- branches/1.01/src/file.hh	2008-06-12 22:12:27 UTC (rev 1172)
+++ branches/1.01/src/file.hh	2008-06-13 13:00:22 UTC (rev 1173)
@@ -22,6 +22,7 @@
 #include <iosfwd>
 #include <vector>
 #include <list>
+#include <memory>
 #include "ecl_error.hh"
 
 namespace enigma

Modified: branches/1.01/src/gui/widgets.cc
===================================================================
--- branches/1.01/src/gui/widgets.cc	2008-06-12 22:12:27 UTC (rev 1172)
+++ branches/1.01/src/gui/widgets.cc	2008-06-13 13:00:22 UTC (rev 1173)
@@ -28,6 +28,7 @@
 #include <cassert>
 #include <algorithm>
 #include <iostream>
+#include <climits>
 
 using namespace enigma::gui;
 using namespace ecl;



From ral at mail.berlios.de  Sat Jun 14 01:57:21 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sat, 14 Jun 2008 01:57:21 +0200
Subject: [Enigma-game-svn] r1174 - team_levelpacks/team_test_new_api
Message-ID: <200806132357.m5DNvLKK027029@sheep.berlios.de>

Author: ral
Date: 2008-06-14 01:56:43 +0200 (Sat, 14 Jun 2008)
New Revision: 1174

Modified:
   team_levelpacks/team_test_new_api/ralT050_1.xml
Log:
a test of the switched Berlios protocols


Modified: team_levelpacks/team_test_new_api/ralT050_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT050_1.xml	2008-06-13 13:00:22 UTC (rev 1173)
+++ team_levelpacks/team_test_new_api/ralT050_1.xml	2008-06-13 23:56:43 UTC (rev 1174)
@@ -30,7 +30,6 @@
 ti["G"] = {"it_glasses"}
 ti["g"] = {"it_glasses", state=SPOT_ACTORIMPULSE}
 
-
 ti["1"] = {"#ac-blackball"} 
 
 



From ral at mail.berlios.de  Sat Jun 14 02:01:46 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sat, 14 Jun 2008 02:01:46 +0200
Subject: [Enigma-game-svn] r1175 - in trunk: doc/reference src/stones
Message-ID: <200806140001.m5E01kbN027322@sheep.berlios.de>

Author: ral
Date: 2008-06-14 02:01:24 +0200 (Sat, 14 Jun 2008)
New Revision: 1175

Modified:
   trunk/doc/reference/enigma-ref.texi
   trunk/src/stones/ClusterStone.cc
   trunk/src/stones/ClusterStone.hh
Log:
Trunk 1.1: new API reengineering
- refman fix typos
- fix r1164 Clusterstone add get_kind for backward compatibility


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-06-13 23:56:43 UTC (rev 1174)
+++ trunk/doc/reference/enigma-ref.texi	2008-06-14 00:01:24 UTC (rev 1175)
@@ -4958,7 +4958,7 @@
 same number and the faces will be set up automatically to form a large block.
 
 You can build a screen of arbitrary big blocks and it is proven that there will
-be never be the need of more than 4 different cluster numbers (the "4 color 
+never be the need of more than 4 different cluster numbers (the "4 color 
 theorem"). But for convenience you are free to use additional cluster numbers
 as you like. Note that the autoclustering is quite dynamic. A single cluster
 stone with fitting cluster number that is swapped at the side of an existing
@@ -4967,8 +4967,8 @@
 
 We recommend making use of the autoclustering feature by setting the 
 @samp{cluster} attribute and using the @samp{faces} attribute where necessary.
- at samp{connections} attribute and explicit naming of variations by suffices 
-are depreceated, but will continue to be supported.
+ at samp{connections} attribute and explicit naming of variations by a suffix 
+are deprecated, but will continue to be supported.
 
 @table @asis
 @item @b{Attributes:}
@@ -4986,8 +4986,8 @@
 
 @item @b{cluster} @ @ @i{values}: number; @ @ @i{default}: @code{nil}
 If set to a number all adjacent cluster stones of the same base type with
-the identical cluster number will build a big block. This attribute superceeds
-any explicit given face description.
+the identical cluster number will build a big block. This attribute superceds
+any explicitly given face description.
 
 @end table
 @end table
@@ -5138,8 +5138,8 @@
 
 An actorimpulse stone can be configured by the @samp{invisible} attribute to
 be hidden while being idle. While pulsing any actorimpulse is visible. An
-invisible actorimpulse can be made permanent visible by hitting it with a
-revealed @ref{it_brush} in the players inventory. The level author can configure
+invisible actorimpulse can be made permanently visible by hitting it with a
+revealed @ref{it_brush} in the player's inventory. The level author can configure
 @ref{it_glasses} by addition of @samp{SPOT_ACTORIMPULSE} to show otherwise
 invisible actorimpulse stones. With the global attribute @ref{ExtralifeGlasses}
 even glasses generated by laser lighting an @ref{it_extralife} can be configured
@@ -5154,12 +5154,12 @@
 @table @asis
 @item @b{invisible} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 An invisible actorimpulse stone is totally transparent. But the user will
-notice it, as actors will bounce with addtional impulses.
+notice it, as actors will bounce with additional impulses.
 @item @b{strength} @ @ @i{values}: float number; @ @ @i{default}: @code{+200.0} @ @ @xref{ActorimpulseStrength}
 A scalar factor for the impulse force. Positive numbers are attracting forces
 where as negative numbers are repelling forces.
 @item @b{hit_factor} @ @ @i{values}: float number; @ @ @i{default}: @code{nil} @ @ @xref{hit_*}
-A @samp{hit_factor} overrrides a given @samp{strength} attribute.
+A @samp{hit_factor} overrides a given @samp{strength} attribute.
 @item @b{hit_distortion_xx} @ @ @i{values}: float number; @ @ @i{default}: @code{+1.0} @ @ @xref{hit_*}
 @item @b{hit_distortion_xy} @ @ @i{values}: float number; @ @ @i{default}: @code{0.0} @ @ @xref{hit_*}
 @item @b{hit_distortion_yx} @ @ @i{values}: float number; @ @ @i{default}: @code{0.0} @ @ @xref{hit_*}
@@ -5198,7 +5198,7 @@
 will open and close a given blocker multiple times.
 
 Note that the blocker is the only door object that allows a stone to be pushed
-through. Just bloulders cause the growing. Any other stone keeps the open state.
+through. Just boulders cause the growing. Any other stone keeps the open state.
 
 Be aware that the @ref{it_brake} destroys an @ref{it_blocker}.
 
@@ -5209,11 +5209,11 @@
 @item @b{state}, @ @ @i{values}: @code{OPEN}, @code{CLOSED}; @ @ @i{default}: @code{CLOSED} @ @ @xref{state}
 The stone represents the closed state and will always return state @samp{CLOSED}.
 But you can set its state what is equivalent to sending an open message in case
-of value @samp{OPEN} and an close message in case of value @samp{CLOSED}..
+of value @samp{OPEN} and a close message in case of value @samp{CLOSED}.
 
 @atindex autoclose
 @item @b{autoclose} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
-This attribute is irrelevant to the blocker stone itself. But is is transfered
+This attribute is irrelevant to the blocker stone itself. But it is transferred
 to the @ref{it_blocker} when the blocker opens.
 
 @end table
@@ -5225,15 +5225,15 @@
 A signal of value 1 sends an open message, a signal of value 0 sends a close
 message.
 @item @b{toggle} @ @ @xref{toggle}
-A toggle causes an open unless the the blocker stone is in the shrinking process.
+A toggle causes an open unless the blocker stone is in the shrinking process.
 In this case it causes a close message.
 @item @b{open} @ @ @xref{open}
 Starts an opening by shrinking the blocker. Note that during the shrinking
 process the blocker still reports to be closed. The shrinking process can
 be reverted by a close message.
 @item @b{close} @ @ @xref{close}
-A close message take only effect on blocker stone that is in the shrinking
-process. The shrinking is stopped immediatly and reverted to grow the blocker
+A close message takes only effect on a blocker stone that is in the shrinking
+process. The shrinking is stopped immediately and reverted to grow the blocker
 again to full size.
 @end table
 
@@ -5260,12 +5260,12 @@
 @obindex st_boulder
 
 This solid stone moves into the direction shown by the arrow on its picture.
-A marble blocking its way is shattered. When a stone blocks its way, it triggers
-it by a sequence of two internal messages. Some stones give way like 
+A marble blocking its way is shattered. When a stone blocks its way, the boulder
+triggers it by a sequence of two internal messages. Some stones give way like 
 @ref{st_blocker}, others change their state like @ref{st_oxyd}, 
 @ref{st_stoneimpulse}, @ref{st_fart}, @ref{st_mirror}, @ref{st_fourswitch},
- at ref{st_volcano}. A third category switches temporary in another state on the
-first message sent when the boulder reaches a grid and switch back on the
+ at ref{st_volcano}. A third category switches temporarily into another state on the
+first message sent when the boulder reaches a grid and switches back on the
 second message sent when the boulder gives up like @ref{st_[black/white]},
 @ref{st_plain}, @ref{st_lightpassenger}.
 
@@ -5278,7 +5278,7 @@
 
 @ref{it_magicwand} and lasers reverse its direction. An @ref{st_actorimpulse}
 reverts the direction if the boulder hits it frontally. An @ref{st_rotator}
-changes its direction according to the rotators direction. An 
+changes its direction according to the rotator's direction. An 
 @ref{st_stoneimpulse} pushes a boulder away.
 
 @table @asis
@@ -5346,7 +5346,7 @@
 coinslot will first switch @samp{OFF} and switch @samp{ON} when the next coin
 is completly inserted.
 
-Coinslots configured as @samp{instant} do activy immediatly when the actor
+Coinslots configured as @samp{instant} do activate immediatly when the actor
 hits the stone. On every actor hit a coin is inserted independent of the last
 insertion.
 
@@ -5357,7 +5357,7 @@
 @item @b{Attributes:}
 
 @table @asis
- at item @b{state}, @ @ @i{values}: @code{ON}, @code{OFF}; @ @ @i{default}: @code{OFF}: @i{access}: @code{read only}  @ @ @xref{state}
+ at item @b{state}, @ @ @i{values}: @code{ON}, @code{OFF}; @ @ @i{default}: @code{OFF}; @i{access}: @code{read only}  @ @ @xref{state}
 Current activity state of the coinslot.
 @item @b{instant} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 A default coinslot switches to active state after insertion of a coin and allows
@@ -5459,7 +5459,7 @@
 @item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
 Performs an action on each turn. If just a pair of global @samp{target/action}
 attributes are given, the action message is sent to the target with a 
-direction value of the new orientation. This values suits any message of the
+direction value of the new orientation. This value suits any message of the
 target that expects a direction value, and the @ref{signal} message, that 
 translates the direction to a 1 for @samp{NORTH}, @samp{SOUTH} and a 0 for 
 @samp{EAST}, @samp{WEST}.
@@ -5484,16 +5484,16 @@
 @samp{code} are accepted.
 
 On a second hit the switch is deactivated and the inserted key is returned
-to the players inventory.
+to the player's inventory.
 
 @table @asis
 @item @b{Attributes:}
 
 @table @asis
- at item @b{state}, @ @ @i{values}: @code{ON}, @code{OFF}; @ @ @i{default}: @code{OFF}: @ @ @xref{state}
+ at item @b{state}, @ @ @i{values}: @code{ON}, @code{OFF}; @ @ @i{default}: @code{OFF}; @ @ @xref{state}
 Current activity state of the key stone.
 @item @b{code}, @ @ @i{values}: number; @ @ @i{default}: @code{1}:
-The code that is required to activy this switch.
+The code that is required to activate this switch.
 @end table
 
 @item @b{Messages:}
@@ -5518,7 +5518,7 @@
 the activity of the laser and can be set initially to @samp{ON}. A laser is
 orientated to one direction in which the light will be emitted.
 
-Lasers have a latency that protect them from infinit fast switching cycles. This
+Lasers have a latency that protect them from infinite fast switching cycles. This
 allows you to toggle a laser with an @ref{st_laserswitch} that is illuminated
 by the laser itself. During the latency period pending switch requests will be
 registered but will be executed with a certain small delay. Note that several
@@ -5601,7 +5601,7 @@
 @table @asis
 @item @b{state}, @ @ @i{values}: @code{ON}, @code{OFF}; @ @ @i{default}: @code{OFF}; @ @ @xref{state}
 Represents the activity state. The state of a new object can be set, but an
-active monoflop cannot be set to state @samp{OFF}.
+active laserflop cannot be set to state @samp{OFF}.
 @item @b{interval} @ @ @i{values}: positive number; @ @ @i{default}: @code{1.8}
 Number of seconds to return to state @samp{OFF} after the last hit.
 
@@ -5611,9 +5611,9 @@
 
 @table @asis
 @item @b{signal} @ @ @xref{signal}
-Switches on at value @samp{1}. A values of @samp{0} is ignored.
+Switches on at value @samp{1}. A value of @samp{0} is ignored.
 @item @b{on} @ @ @xref{on}
-Switch the monoflop on like on an actor hit.
+Switches the laserflop on like on an actor hit.
 @end table
 
 @item @b{Action:} @ @ @xref{target}, @ @ @xref{action}
@@ -5629,7 +5629,7 @@
 state @samp{ON} when a laser beam hits the stone from any direction. It switches
 instantly back to state @samp{OFF} when it is no longer illuminated.
 
-There is no way to set set the state of this stone manually. But the state
+There is no way to set the state of this stone manually. But the state
 can nevertheless be read. At initialization a laserswitch that is exposed to
 laser light will start in state @samp{ON} without sending actions due to the
 @ref{Snapshot Principle}.
@@ -5676,7 +5676,7 @@
 The speed of the light passenger can be changed with the
 @samp{interval}-attribute (default 50 ms, which is quite fast) and may
 include the floor friction and local gradient via
- at samp{friction} and @code{gradient}. The resulting interval results as
+ at samp{friction} and @samp{gradient}. The resulting interval results as
 
 @example
 interval  =  base * (1 + stone_friction * floor_friction) / (1 + stone_gradient * floor_gradient)
@@ -5697,8 +5697,8 @@
 @ref{it_brush} in the inventory. Such a touch with a brush does wipe out a
 cross beneath the lightpassenger, too.
 
-An @ref{st_boulder} hitting a lightpassenger toggles its state for a short
-period.
+An @ref{st_boulder} hitting a lightpassenger toggles the lightpassenger's state
+for a short period.
 
 When an active @samp{st_lightpassenger} is trapped between exactly two
 opposing light beams or light beams from all four directions, it
@@ -5748,7 +5748,7 @@
 
 A switch that is triggered by actor hits. It switches instantly to
 state @samp{ON} and after a given @samp{interval} back to state @samp{OFF}.
-Repeatitive actor hits will prolong the @samp{ON} state untill a trailing 
+Repetitive actor hits will prolong the @samp{ON} state until a trailing 
 @samp{interval} after the last hit has been expired. A switch similar to
 the monoflop is the @ref{st_laserflop}, which is additionally light sensitive.
 
@@ -5800,14 +5800,14 @@
 This causes an automatic coloring by pairs of colors in the standard color
 sequence.
 
-There is no limit on the number of used oxyd pairs. There exists 12 different
+There is no limit on the number of used oxyd pairs. There exist 12 different
 regular colors for oxyds. But per default just the first 8 colors will be
 assigned to @samp{OXYD_AUTO} colored oxyds. The colors will repeat from the
 9th pair giving the user the possibility to build arbitrary couples within a
 single color. With the world attribute @ref{MaxOxydColor} you can lower or
 increase this limit. By setting this attribute to @samp{OXYD_GREEN} you can
 enforce the engine to assign just the first three colors. Be careful in usage
-of more than 8 colors as levels can get incredible difficult. Uneven number of
+of more than 8 colors as levels can get incredibly difficult. Uneven number of
 regular colored oxyds are not allowed.
 
 Usually oxyds are shuffled by a @samp{wo:shuffleOxyd()} statement after setting
@@ -6071,7 +6071,7 @@
 cannot pass and other stones cannot be moved onto the same grid position.
 @item @b{interval} @ @ @i{values}: positive number; @ @ @i{default}: @code{1.0}
 Number of seconds until the first and between subsequent events. The interval
-must be larger equal 0.01 seconds for looping timers.
+must be larger or equal 0.01 seconds for looping timers.
 @item @b{loop} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{true}
 A looping timer will send periodic events.
 @end table
@@ -6097,10 +6097,10 @@
 @subsection st_window
 @obindex st_window
 
-A stone made up just of glass window faces. All combination of window faces with
+A stone made up just of glass window faces. All combinations of window faces with
 at least one face are possible. There exist two versions of windows, normal
-blue colored glass and green colored saftey glass, that is nearly undistructable.
-Saftey glass is seleted by setting the attribute @samp{secure} to @samp{true}.
+blue colored glass and green colored safety glass, that is nearly undistructable.
+Safety glass is seleted by setting the attribute @samp{secure} to @samp{true}.
 Every glass face can be weakened by @samp{scratches} which are visible in the
 shadows.
 
@@ -6108,7 +6108,7 @@
 
 Slowly moving actors will bounce from window faces on any side. They can freely
 move within the inner part of the window stone. Invisible actors can even pass
-the normal blue window faces, but not the green saftey glass faces.
+the normal blue window faces, but not the green safety glass faces.
 
 Fast moving actors can blast normal blue window faces into smithereens. But too
 strong hits will cause marbles to shatter themselves. An actor can lower the
@@ -6117,7 +6117,7 @@
 safty glass windows will never break on actor attacks.
 
 Bomb explosions can shatter window faces, too. Normal blue window faces adjacent
-to a bomb explosion will break. Green saftey glass faces will break only if 
+to a bomb explosion will break. Green safety glass faces will break only if 
 prior weakened by an @ref{it_ring} scratch.
 
 Window faces can be rearranged by actors with a revealed @ref{it_wrench}.
@@ -6143,7 +6143,7 @@
 @code{"nesw"} listing the faces. The sequence of the sides, north, east, south,
 west, is guaranteed on read access but arbitrary on write access.
 @item @b{secure} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
-Green saftey glass is secure, whereas normal blue is not.
+Green safety glass is secure, whereas normal blue is not.
 @item @b{scatches} @ @ @i{values}: string; @ @ @i{default}: @code{""}
 Describes the scratched window faces of the stone. The string is a substring of 
 @code{"nesw"} listing the affected faces. The sequence of the sides, north, east,
@@ -6154,7 +6154,7 @@
 
 @table @asis
 @item @b{inner_pull}, @ @ @i{value type}: direction
-Try to tear the opposite window face into the given direction.
+Tries to tear the opposite window face into the given direction.
 @end table
 
 @item @b{Variants:}
@@ -10981,7 +10981,7 @@
 to group actors of different kinds into an essential group via this id. The
 engine keeps this id even if actors are transformed into other kinds.
 
- at item @b{whiteball}, @b{blackball} @i{depreceated}
+ at item @b{whiteball}, @b{blackball} @i{deprecated}
 @code{TRUE} or @code{FALSE}. Used by color-sensitive stones
 (black/white switches for example) to determine whether the actor is
 the black or the white marble.  These attributes may disappear in

Modified: trunk/src/stones/ClusterStone.cc
===================================================================
--- trunk/src/stones/ClusterStone.cc	2008-06-13 23:56:43 UTC (rev 1174)
+++ trunk/src/stones/ClusterStone.cc	2008-06-14 00:01:24 UTC (rev 1175)
@@ -30,6 +30,10 @@
         return getAttr("$class").to_string();
     }
     
+    const char *ClusterStone::get_kind() const {
+        return getClass().c_str();
+    }
+    
     void ClusterStone::setAttr(const string& key, const Value &val) {
         if (key == "connections" || key == "faces" || key == "cluster") {
             Stone::setAttr(key, val);

Modified: trunk/src/stones/ClusterStone.hh
===================================================================
--- trunk/src/stones/ClusterStone.hh	2008-06-13 23:56:43 UTC (rev 1174)
+++ trunk/src/stones/ClusterStone.hh	2008-06-14 00:01:24 UTC (rev 1175)
@@ -35,6 +35,7 @@
         
         // Object interface
         virtual std::string getClass() const;
+        virtual const char *get_kind() const;  // for backward compatibility
         virtual void setAttr(const string& key, const Value &val);
         virtual Value message(const Message &m);
         



From ged at mail.berlios.de  Sat Jun 14 13:15:35 2008
From: ged at mail.berlios.de (ged at mail.berlios.de)
Date: Sat, 14 Jun 2008 13:15:35 +0200
Subject: [Enigma-game-svn] r1176 - feature_branches/hp_lotm/input/lotm
Message-ID: <200806141115.m5EBFZnw011911@sheep.berlios.de>

Author: ged
Date: 2008-06-14 13:15:31 +0200 (Sat, 14 Jun 2008)
New Revision: 1176

Added:
   feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html
Modified:
   feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html
Log:
Homepage:

- Added Russian translation of lotm_200806
- Added Russian translation of new comment to lotm_200805


Modified: feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html	2008-06-14 00:01:24 UTC (rev 1175)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html	2008-06-14 11:15:31 UTC (rev 1176)
@@ -81,7 +81,7 @@
 ? ??????? ??? ?? ??????? ????????, ????? ???? ?? ?????????? ??????????
 ? ???????? ??? &quot;????????? ?????&quot;. ?? ????? ??? ??? ?? ???????? ? ????, ?? ??????
 ???????????? ? &quot;????????&quot;. ????, ?????? ???? ? ???????? ??????.
-???????, ? ???? ??????? ???????? ?????, ???????? ?????, ????? ??????
+???????, ? ???? ??????? ???????? ?????, ???????? ?????, ????? ??????
 ???? ?????. ???! ??? ? ??????????, ? ????? ??? ? ?????? ? ????????? ?????,
 ????? ???????? ?????????????, ? ?????? ?????? ????? ???????? ??? ????? ???? ??????.</p>
 
@@ -155,8 +155,8 @@
 <div class="author">Shoki</div>
 
 <p>?? ?????? ? ?????? ????? ????. ??? ???? ???????-??: ????? ??????????
-?????? ?? ????????????? ???? ????? ?? &quot;??????&quot;, ?????????? ? ???.
-? ????????? ? ??? ?? ????????????. ????? ??? ??? ????? ??????,
+?????? ?? ????????????? ???? ?????? ?? &quot;??????&quot;, ?????????? ? ???.
+? ????????? ? ??? ?? ????????????. ????? ??? ??? ????? ??????,
 ????? ??????? ????????? ??????????? ? ????????? ?? ? ?????? ??????????. 
 (???? ??? ??? ????-?? ????? ??????, ?? ?? ????? ??????? ????????????????
 ? &quot;Boulder-Puzzle&quot; (IV - #8) ???? ?? ??????.) ???? ??? ???????? ???????????,
@@ -165,7 +165,7 @@
 ?? ?.) ???????, ? ????? ??? ???????????????.</p>
 
 <p>?????? ?? ???????? ????????? ????? ?????????. ??????, ??????? ? 
-&quot;??????&quot;, ??????? ????????? - ???????? ?????????? ???????
+&quot;??????&quot;, ??????? ????????? - ???????? ?????????? ???????
 ???????? ??????, ?? ???????? ? ????????? (?????? ?????????? ???-?? ?? ??????? ? ???.)
 ????????: ???? ?? ??? ??????????? ?????????? ? ?????? ??????????? ??? ????. ?????
 ??? ?????? &quot;?????&quot; ? ???????, ????? ??????? ???? ?????? ????????????.
@@ -204,13 +204,45 @@
 ? ?? ?? ????????), ??-????? ????????? ????? &quot;Pleasure Garden&quot; ? ??????? ?? ?????????,
 ????????? ??????? ????? ???? ????????????, ??????? ???????? ???? ???????.</p>
 
+<a name="jacob">
+<h4>? ????????? ?????????, ???????? ??????????? ?????? ??????:</h4>
+</a>
+
+<div class="quote">? ????? &quot;Pleasure Garden&quot; ??????? ??????? ???????? ???????
+? ???????? ????? ???????????? ?????????? Oxyd. ?????? ??? ??????? ?? ?????????
+??????????? ????? ????? ?????? ??? ???????? ???? ??????? ? ???? ??? ?????? ?? ??,
+??? ?????? ??????.  ??????, ??? ??????? ? ?????? ??????? ??????? ????????, ????
+? ?? ??????????? ? ????? ??????? ??????.  ??? ?????????? ???????????? ??? ????
+??????????? ?????????? ???? ??????? ????? ???????????.  ??-?? ????, ??? ??????? ?????
+????? ????????, ? ???????? ??? ??????? ??????? ??????????? ??????, ???? ?? ??????
+?????????, ?????? ? ?????????? ?? ??????? ?????????? (????? ? ?????? ?????? ? ?????? ?????).</div>
+
+<div class="quote">??? ???????? ???????? ??? ???? ???????????, ??????? ??? ?????? ????????? ?
+????? Oxyd: ??????????? ? ?????????, ???????, ??????? ? ???????-????? ? ???? ?????????????
+?????????.  ? ????????????? ??????? ? ???? ??????????? ? ????????? ?????????? ???????????
+? ????? ????????? ????????? ? ????? ????.  ????? ??? ???? ???????, ???????? ?????? ???????
+??? ?????????? ??????????? ??????? ?????, ?? ?????? ????????? ????????? ????? ??????
+(? ?????, ??????????? ??? ??? ??????????), ? ????? ?????? ?? ??????.
+? ?????, ? ??????? ??????? ???, ????? ?????? ????? ???? ?? ???? ???? ??????? ???????, ??
+??? ????????????? ????? ?????? ?? ?????? ???????????.  ??? ????? ?? ???????? ????????????
+? ??????????? ?????? ??????? ???????? ??????????.</div>
+
+<div class="quote">? ?????, &quot;Pleasure Garden&quot; ?????????? ???????? ??????? ???????????.
+??????, ????? ? ???? ??? ??????, ??? ???????, ??? ??? ???? ?? ?????????? ???????, ??????????
+???? (??? ? ???????? ?? ?????), ? ???? ?? ??? ????? ???? ?????????????, ? ??????? ? ????????? ???????
+????????? ???????, ??? ????? ??? ?? ?????????? ????? ??? ?????.  ?? ????????? ? ??????????
+?????????? ???????? (?????, ????????), &quot;Pleasure Garden&quot; ???????? ?????, ??
+? ?????, ?? ??? ??? ????????? ???? ??? ??????????? ?? ????????, ??????? ?????????.</div>
+
+<div class="author">Jacob Scott</div>
+
 <p>??????????? &quot;Pleasure Garden&quot; ????? ???? ??????? ????? ? ???? ?????? Top 10.
 ??????? ??????? Jacob Scott ?? ???? ???????? ???????.</p>
 
 <p><i>NObby</i></p>
 
 <p>????????? ????????, ??? ?????? ????? ???? ?????? ? ??????? ??????? Enigma.
-?????????? ?????????? ??? ????? ??????, ??? ???? ???????????, ??????? ?? ???????? ?? ?????????? ??????:</p>
+?????????? ?????????? ??? ????? ??????, ??? ???? ???????????, ??????? ?? ???????? ?? ?????????? ??????:</p>
 <pre>
 <a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
 </pre>

Added: feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html	2008-06-14 00:01:24 UTC (rev 1175)
+++ feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html	2008-06-14 11:15:31 UTC (rev 1176)
@@ -0,0 +1,307 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">???? 2008: </span>
+    &quot;Block its way!&quot; ?? Jon 'WB' Sneyers
+  </h3>
+
+<p>
+? 26 ????? 2008 ???? ?????? ???, ????? ??? ?? ????? ????????? ???? ???????,
+? ?? ??? ???????? ??????. ??????? ??, ??? ???????? ?????? &mdash;
+??, ????????, ??????? ??? ???? ?? ???????.
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200806_c.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">Enigma III # 66</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">????????? ???????? ????? 2008</caption>
+<colgroup>
+   <col width="80">
+   <col width="160">
+</colgroup>
+    <tr><td class="num">3:21</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">3:37</td>
+        <td class="left">Stupid</td></tr>
+    <tr><td class="num">4:16</td>
+        <td class="left">Malla</td></tr>
+    <tr><td class="num">4:21</td>
+        <td class="left">Johannes</td></tr>
+    <tr><td class="num">4:25</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">4:37</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">5:29</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">5:33</td>
+        <td class="left">dpl</td></tr>
+    <tr><td class="num">5:39</td>
+        <td class="left">dev0+hdwow</td></tr>
+    <tr><td class="num">5:41</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">5:45</td>
+        <td class="left">Django</td></tr>
+    <tr><td class="num">5:46</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">5:52</td>
+        <td class="left">Daisy</td></tr>
+    <tr><td class="num">6:06</td>
+        <td class="left">U-Punkt+alfred69</td></tr>
+    <tr><td class="num">6:15</td>
+        <td class="left">Tobias+Safalra</td></tr>
+    <tr><td class="num">6:35</td>
+        <td class="left">Agnieszka</td></tr>
+    <tr><td class="num">6:41</td>
+        <td class="left">NorthForty</td></tr>
+    <tr><td class="num">6:44</td>
+        <td class="left">JuSt</td></tr>
+    <tr><td class="num">6:48</td>
+        <td class="left">B-Huff</td></tr>
+    <tr><td class="num">6:50</td>
+        <td class="left">Gloop</td></tr>
+    <tr><td class="num">6:51</td>
+        <td class="left">Alex</td></tr>
+    <tr><td class="num">6:58</td>
+        <td class="left">Mark P.</td></tr>
+    <tr><td class="num">7:08</td>
+        <td class="left">Klaus+Gottseinsohn</td></tr>
+    <tr><td class="num">7:21</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">7:52</td>
+        <td class="left">Vinksu</td></tr>
+    <tr><td class="num">7:56</td>
+        <td class="left">para_doks</td></tr>
+    <tr><td class="num">8:12</td>
+        <td class="left">Great Scott</td></tr>
+    <tr><td class="num">8:16</td>
+        <td class="left">shoki</td></tr>
+    <tr><td class="num">8:28</td>
+        <td class="left">mhatta</td></tr>
+    <tr><td class="num">8:43</td>
+        <td class="left">biotopa</td></tr>
+    <tr><td class="num">8:46</td>
+        <td class="left">Antonio EE</td></tr>
+    <tr><td class="num">9:08</td>
+        <td class="left">Andy</td></tr>
+    <tr><td class="num">9:18</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">9:23</td>
+        <td class="left">Kosby+mrduke</td></tr>
+    <tr><td class="num">9:46</td>
+        <td class="left">Freshman</td></tr>
+    <tr><td class="num">10:01</td>
+        <td class="left">Sim_Ed</td></tr>
+    <tr><td class="num">10:20</td>
+        <td class="left">fabian</td></tr>
+    <tr><td class="num">10:29</td>
+        <td class="left">Little_Mole</td></tr>
+    <tr><td class="num">10:58</td>
+        <td class="left">ABS</td></tr>
+    <tr><td class="num">11:43</td>
+        <td class="left">Valkyrie2</td></tr>
+    <tr><td class="num">11:45</td>
+        <td class="left">WP319</td></tr>
+    <tr><td class="num">12:03</td>
+        <td class="left">Drotten</td></tr>
+    <tr><td class="num">12:16</td>
+        <td class="left">Melanie</td></tr>
+    <tr><td class="num">13:35</td>
+        <td class="left">Tarim</td></tr>
+    <tr><td class="num">13:38</td>
+        <td class="left">Jeffrey S</td></tr>
+    <tr><td class="num">14:44</td>
+        <td class="left">HuB34</td></tr>
+    <tr><td class="num">20:26</td>
+        <td class="left">mecke</td></tr>
+</table>
+
+<p>??????? ? ?????????? ??????? ? ???? ??????? ????? ?????, ?? ?????
+? ?????? ??????  ???????? ?? ??????, ??? ??????? ????????? ??? ??????.
+??? ????? ??? ???????????? ????????? ?????:
+</p>
+
+<p>
+<ul>
+<li>
+  ????????? ?????????? ???????????? ?????????? ?????? ? ?????????? ?????? ? ????? ? ??????? ?????????
+  <br>
+  (<span class="blue">????????, ??? ?????? ????????????? ???????????? ? ????????? ??? ???? ???? ????????
+  &hellip;&mdash; ?? ????? ????, ? ??? ?? ??? ? ????? ?????, ??????? ?????????????? ?????????
+  "? ??? ?????, ????..."</span>),
+</li><li>
+  ????????? ??????-????? ? ??? ??? ?? ???????? ?????? ?????? ? ???????? ???-???
+  <br>
+  (<span class="blue">???, ????? ?????? ???? ? ????? ?????. ??????? ?????, ??????, ????? ????????
+  &mdash; ???????? ? ?????????</span>),
+</li><li>
+  ?????? ???????
+  <br>
+  (<span class="blue">?????? ????? ??? ? ????????? ????. ?????? ???????
+  ????? ?????? ????, ??????-?? ? ??: &quot;?? ???????? ??????? ????? &hellip;&quot;.
+  ????????, ??? ????????? ? ???????? &hellip; ???????, ????? ???????. ??? ???? ??????.</span>),
+</li><li>
+  ?????? ? ????????? ???????
+  <br>
+  (<span class="blue">???? ? ???????? ????????, ????? ?????? ??????? ?????? &mdash; ??????
+  ??????? ?? ?????</span>),
+</li><li>
+  ?, ??, ????? ?????, ??? ????????????? ???????.
+  <br>
+  (<span class="blue">???? ??????? ?? ????????? ????????, ? ?????? ????? ? '??????????' ??????</span>),
+</li><li>
+  ? ?????? (st_bolder)
+  <br>
+  (<span class="blue">??? ?? ?? ?????? ??????, ????? ?????? ????????? ?????? ????
+  &hellip; ?, ?????, ??? ????? ??????</span>).
+</li>
+</ul>
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200806_a.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">?? ???????????? &hellip;</div>
+</div>
+
+<p>? ?????? ??????? ??????. ????? ???????, ????????????? ?? ?????? ?? ?????? ??????????
+??????, ????? ???? ?? ???????? ????????? ??????? ??????? ??????, ????? ????????
+????? ????????????? ??????, ????????? ????????? ???????, ?????? &quot;?????!&quot; (<span
+class="blue">?? ??? ? ?????? ????????? ????????, ?? ??????? ????? ??????????? &hellip;</span>),
+????????????? ?? ?????????? ??????????? ?????, ????????? ?????? ?????,
+?? ????? ???????????? ??????, ???? ?????????? ????? ?? ??????? ? ???? ?????????? ?????,
+?? ???? ????????? ??? ???? ???????, ?????????? ? ???? ?????????? ????, ????? ?????? ?
+????????? ??????? ? ????????? ??? ???? ???????????? ??????.
+</p>
+
+<p>???, ? ??? ? ??. ? ?????? ????? ????????, ??? ?????? ???????? ????? ?????? ???? ?
+??????????? ?? ????????. ?????? ??????? &hellip; ??, ????? ????? ??????? ? ???????
+??? ?? ?????? (F3 ????????????? ???? ???????. ??!). ??????, ?????? ???? ????? ???????? ?????????
+???????: &quot;????????????!&quot; ??, ??? ?? ??? ?????????!<br>
+??????, ? ??? ?????? ?????????? ???????? ??! ???? ??? ??? ??????
+;-))), ????????????? ?????? ????? ?? '??????????' ?????????? ??????. ???? ??? ??
+??????, ???????
+</p>
+
+<p>?????????? ?????, ?? ?? ???? ??? ? ??????? ???????????, ? ??????? ???????, ? ????? ??????,
+??????? ???????? ?????? ????? ????.
+</p>
+
+<p>???????, ? ???? ??????????, ? ??????? ???????. ????????, ??? &mdash; ??? ????? ??????
+?????? ??????? (???? ???? ???????, ? ????? ??? ???? ??????? ??? ??? ? ????).
+? ?? ??? ??????? ?????????? (?????), ?? ??????? ???????????? (??????? ????).
+?? ???????? ? ???? ????????? ??????? ? ???? ????? ??????, ??????????? ?? ????????? &hellip;
+? ??????? ?????? ?????, ????? ?????? ??????? ??????.
+? ??? ???? ???, ????? ??? ?????? ???????????? ? ??? ????? ???????? ???????: ? ????? ?? ?????.
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200806_b.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">??? ??? ??????!</div>
+</div>
+
+<p>?????? ? ???? ?????? ???????? ????? ?????, ? ????????? ?????? ??????? ?????? ????? ?????? ??????
+&mdash; ?????????? ???? ??????????? ?????????? ????. ????? ????? ??????? ????? ??????? ???????
+'????????? ????? ?????????' &mdash; ???, ??????? ?? ???????????. ??????????? ????? ???????? ?????????
+?????????? ?????. ????? ?????? ?? ???, ? ???? ???? ???????? ? ???????? ?? ????????? ? ?????????
+???????????? ??????, ?????? ???? ??????????; ? ??????? ????? ?? ??????, ? ????? ???????.
+</p>
+
+<p>????? ????, ??? ?? ? ???? ?????????, ?????? ? ????? ????? ????? ??????????? ???? ???? ?????.
+?? ???? ???????? ????????? ???????. ???????, ?????? ????? ?????? ????????? ???? ???? ? ??????????
+??????? ?????? ??? ?????????? ??????.
+</p>
+
+<p>????? ??? ??????, ????? ?????????? ????? ???????, ?????? ????? ????? ??????????? ? ????
+????????? ????, ?????, ???????, ?????? ???????, ???????????? ?? ?????-?????? ??
+????????????? ?????? ?????????? ??????.
+</p>
+
+<p>???? ??? ???????? &quot;Little Puzzles&quot; ? &quot;Big Adventures&quot;
+??? ?? ???, ??? ? ? ??????????? ????? ??????, ?? ?????? ??????????? ???? ??? ???? ?
+???? ???????? ? ?????? ??????? &quot;Block its way!&quot;; ? ????? ??????, ??? ??? ?????? ????????
+??? ?? ???????.
+</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200806_d.jpg" alt="Level of the Month" border="0">
+<div class="imagetitle">? ??? ???? ????????? ????? &hellip;</div>
+</div>
+
+<p>???? ?? ??????? ?????? ??????????? ???? ??????, ?? ?????????? ????????,
+???, ?? ??? ????? ???????, ?????? ???????? ? ???? ??????? ?? ????? ???? ??????, ???? &mdash; ??,
+<b>????</b> &mdash; ????? ?????????, ??? ??????? ????. ?????? ??? ???? ??? ???? ???????,
+? ??????? ????? ?????????? ?????? ? ????? ?????? (??????? ??????? ?? ??? ????????? Taztunes).
+????, ?????? ? ???? ????????? ????????, ??? ??? ???? ?? ????? ??????? ?????????, ???
+??? ?????? ????? ??????? ?? ??????? ?????? ? ????????????? ?????????, ?????? ?????????
+?????????:
+<br>
+<i>?????????, ???????!</i><div class="spoiler">???????? ????? ? ??????? ???????? ?
+????????? ?????? ?? ?????????? ??? ?????????? ??????, ????? <b>?????????</b> ????
+????? ?? ????????? (?????? ?????? ????????? ?? ????????), ????? ?????? ??????? ?? ???????
+??? ???, ? ????? ????? ?????????, ?????? (???????? ????????? Taztunes ?
+&quot;Block its way!&quot; ?? 26 ????? 2008 ???? ?? ?????? mag-heut.net).</div><i>????? ????????</i>
+</p>
+
+<p>? ?????? ? ????????? ????, ?????? ??????? ?????????? &quot;Block its
+way!&quot; (&quot;???????? ??? ????&quot;), ?????? ? ?????? &quot;?????????!&quot;, ??? ???????? ? ???????,
+?????? ??????? ???????? ?????? ????????? 3? ??? ??? ?????? ??? ?????????? ?????????
+????? ?????? ??????? ??? ????? ??????????? ???????? ????? ???? (??????? ?? ??????? ????,
+???? ? ????????)? ???? ??, ? ?? ???? ? ???? ?????? ??????? LOL (*?????*). ? ????? ??????, ? ?
+??????? ?????? ???? ????. ? ????? ??????? ? ?????? ????????? ????? Kurt'? Tucholsky:
+&quot;??????? ?? ??????? ???????? ???????? ?? ???, ????? ?? ???????: '??????? ????, ? ????? ??? ???
+???????? ???!' &mdash; ?? ????? ??????? ?????? ??? ??????????? ??? ???????? ???.</i>&quot;
+</p>
+
+<p>? ??????? ??????? '???????' Jon 'WB' Sneyers ?? ???????, ???????
+&mdash; ?? ??????? ???? ??? ???? &mdash; ?????????? ??? ??????????? ????????????????.
+? ??????????, ???????? ??????? ?????, ????? ?? ????, ? ?? ??????????? ??????,
+?? ??????? ????, ? ?? ?? ???? ??????.
+</p>
+
+<p><i>[???????????: ???????? ???? ?? ??? ???????? ?? ???????, ?? Jon, ????
+??? ?? ????????? ? ??? Taztunes. ???????, ??????? ???????? ??? ???????? ?????? ????
+?? ???????? ????????? ????.]</i></p>
+
+<div class="quote">
+???? ??????? ??????? ? ???? ????????: ??? ??????????? ? ????????, ?????
+?? ???? ??? ?????? ??????? ???????. ???? ? ????????? ?????, ??????? ?
+????? ??????? ???????????? ???????, ??? ?? ????? ??????, ??? ??????????,
+? ?????? ??????. ?? ? ?? ????????? ????? ??? ?????????? ??????, ? ????????
+????? ???? ??????? ???????? ?? ????????? ??????. ??? ??? ???????????,
+?????? ??? ????? ??? ??? ????? ?????? ??????, ?? ??????? ?? ? ???????
+?? ?????, ??? ???? ?????? ????? ???????. ?????? ????? ????, ??? ?????
+????????? ?? ?????????? ??????, ?? ????? ??????, ??? ????? ??????.
+? ????? ??????, ?????? ??? ????? ???? ???-?? ????????? ?????? ?????,
+??? ??? ? ?????? ??? ??????? ??????? ??? ??????. ??? ?????? ?????????
+?????? ??? ???? ???????, ??????? ? ????? ??????? ???????, ??? ???????
+?????? ????? ?????? ?????? (??????????? ???? ???????, ??? ??????? ??
+?????? ? ?????? ??????? ????????), ????? ?????? ?????? ????? ?????,
+????? ??? ?????? ?????? ??????? ??????. ??? ?????? ?????? ? ?????????
+????????? ???????????, ? ??????? ????? ???? ????????? ??????? ???????,
+?????? ????? ????? ??????? ? ????????? ??????????? ??????.
+</div>
+
+<div class="author">Jon 'WB' Sneyers</div>
+
+<p><i>NObby</i></p>
+
+<p>????????? ????????, ??? ?????? ????? ???? ?????? ? ??????? ??????? Enigma.
+?????????? ?????????? ??? ????? ??????, ??? ???? ???????????, ??????? ?? ???????? ?? ?????????? ??????:</p>
+<pre>
+<a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
+</pre>
+<p>? ?????????, ??? ?????????? ?????? ? ????????? ???????:
+</p>
+<ul>
+<li>&quot;Plan Ahead&quot; ?? Jacob Scott</li>
+<li>&quot;River of Challenges&quot; ?? Lukas Sch&uuml;ller</li>
+<li>&quot;Procrustes&quot; ?? Andreas Lochmann</li>
+</ul>
+<p>??????? ??????? ???????, ?????? ???? ?????? ????? ????????? ??!</p>
+
+<p><i>???? ??????? Enigma</i></p>
+
+</div>


Property changes on: feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html
___________________________________________________________________
Name: svn:eol-style
   + native



From andreasl at mail.berlios.de  Sun Jun 15 17:08:59 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Sun, 15 Jun 2008 17:08:59 +0200
Subject: [Enigma-game-svn] r1177 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 data/gfx64 data/levels/enigma_iv
	data/levels/enigma_tutorial data/levels/lib
	data/levels/patches doc/manual src src/gui
Message-ID: <200806151508.m5FF8xAp019071@sheep.berlios.de>

Author: andreasl
Date: 2008-06-15 17:08:41 +0200 (Sun, 15 Jun 2008)
New Revision: 1177

Added:
   trunk/data/gfx64/it-dummy.png
   trunk/data/levels/patches/pox_051.lua
Modified:
   trunk/data/gfx32/it-dummy.png
   trunk/data/gfx40/it-dummy.png
   trunk/data/gfx48/it-dummy.png
   trunk/data/levels/enigma_iv/ralf15_1.xml
   trunk/data/levels/enigma_tutorial/a_tut07.xml
   trunk/data/levels/lib/libluatools.xml
   trunk/data/models-2d.lua
   trunk/doc/manual/enigma.texi
   trunk/doc/manual/enigma_de.texi
   trunk/src/SoundEngine.cc
   trunk/src/SoundEngine.hh
   trunk/src/client.cc
   trunk/src/gui/HelpMenu.cc
Log:
Trunk: Minor improvements and bug fixes
 - #include SDL_mutex for Maemo-compatibility.
 - Add helptext for "Shift+ESC"
    - in F1 game help menu (still fits on 640x480/320x240),
    - manual (English, German).
 - "assert" to ensure correct helptext in HelpMenu.
 - Better resolution and 64x64 for it-dummy.
 - it_cross in a_tut07 to show original position of st_chess,
   and removed wrong document text.
 - Patch pox_051.
 - Uncommented (unused) reference to randseed in ralf15.
 - New luatools function: luatools.digits.
Todo:
 - Although the manuals have to be worked over to include
   the new options menu either way, it might be better to
   translate the "Shift+ESC"-helptext already now.


Modified: trunk/data/gfx32/it-dummy.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/it-dummy.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/it-dummy.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx64/it-dummy.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx64/it-dummy.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/data/levels/enigma_iv/ralf15_1.xml
===================================================================
--- trunk/data/levels/enigma_iv/ralf15_1.xml	2008-06-14 11:15:31 UTC (rev 1176)
+++ trunk/data/levels/enigma_iv/ralf15_1.xml	2008-06-15 15:08:41 UTC (rev 1177)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="U-Swap" el:subtitle="" el:id="ralf15"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="Ralf Westram" el:email="amgine at reallysoft.de" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Ralf Westram</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -33,11 +33,13 @@
    "###o###########o####",
 }
 
-if not difficult then
-   seed = 947360
-else
-   seed = 8375
-end
+--- No rand-seed in Enigma 1.1 anymore, Andreas May 2008
+-- (wasn't used anyway)
+--if not difficult then
+--   seed = 947360
+--else
+--   seed = 8375
+--end
 
 function randstone(x,y)
    local r = random(1,7)

Modified: trunk/data/levels/enigma_tutorial/a_tut07.xml
===================================================================
--- trunk/data/levels/enigma_tutorial/a_tut07.xml	2008-06-14 11:15:31 UTC (rev 1176)
+++ trunk/data/levels/enigma_tutorial/a_tut07.xml	2008-06-15 15:08:41 UTC (rev 1177)
@@ -29,7 +29,7 @@
 ti["#"] = ti[" "] .. {"st-likeoxyda"}
 ti["@"] = ti["."] .. {"#ac-blackball"}
 ti["C"] = ti["."] .. {"st-chess_black"}
-ti["c"] = ti["."] .. {"st-chess_black", "it_cross"}
+ti["c"] = (ti["."] .. {"st-chess_black"}) .. {"it_cross"}
 ti["D"] = ti[" "] .. {"st-door_a", name="door#"}
 ti["T"] = ti["."] .. {"it_trigger", name="trigger#", target="open_door"}
 ti["B"] = ti["."] .. {"#ac-blackball", controllers=0, player=1, name="second_marble"}
@@ -92,7 +92,7 @@
         <el:english el:translate="true">The stone with the horse's head is called ''chess stone''. Watch how the other marble hits one of them to move it. The angle is important.</el:english>
       </el:string> 
       <el:string el:key="text2">
-        <el:english el:translate="true">Now try to move these chess stones onto the triggers. They always move two steps plus one step, the crosses might give you some idea.</el:english>
+        <el:english el:translate="true">Now try to move these chess stones onto the triggers. They always move two steps plus one step.</el:english>
       </el:string> 
     </el:i18n>
   </el:protected>

Modified: trunk/data/levels/lib/libluatools.xml
===================================================================
--- trunk/data/levels/lib/libluatools.xml	2008-06-14 11:15:31 UTC (rev 1176)
+++ trunk/data/levels/lib/libluatools.xml	2008-06-15 15:08:41 UTC (rev 1177)
@@ -131,7 +131,7 @@
 -- A wrapper of "if" to resemble the ternary ?:-function.
 -- Note that this function evaluates both IFTRUE as well as IFFALSE, e.g.
 --   luatools.cond(t == 0, 1/t, error("Division by zero"))
--- will evaluate the error-function and thus hold for any T.
+-- will evaluate the error-function and thus halt for any T.
 -- Hence: Make sure there are no sideeffects in IFTRUE and IFFALSE!
 function luatools.cond(condition, iftrue, iffalse)
   if condition then
@@ -141,6 +141,59 @@
   end
 end
 
+-- digits returns a table whose elements are the digits of NUMBER
+-- in base BASE. BASE can be a number (e.g. 3 to get ternary)
+-- as well as a table (then the table entries with numerical
+-- keys will be used as digits).
+-- Examples:
+--   luatools.digits(13, 2) = {1, 0, 1, 1}
+--   luatools.digits(15, 16) = {15}
+--   luatools.digits(17, 3) = {2, 2, 1}
+--   luatools.digits(17, {2, "b", 5}) = {5, 5, "b"}
+-- Hexadecimal would be:
+--   luatools.digits(x, {0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"})
+-- NUMBER is supposed to be a non-negative integer.
+function luatools.digits(number, base)
+  -- Check arguments and calculate fullbase and exponent
+  if type(number) ~= "number" then
+    error("digits: First argument not a number ("..type(number).." instead).")
+  end
+  if (type(base) ~= "number") and (type(base) ~= "table") then
+    error("digits: Second argument not valid type ("..type(base)..").")
+  end
+  if (number < 0) or (number ~= math.ceil(number)) then
+    error("digits: First argument out of range ("..number..").")
+  end
+  local fullbase = {}
+  local exponent = 0
+  if type(base) == "number" then
+    if (base < 2) or (base ~= math.ceil(base)) then
+      error("digits: Second argument out of range ("..base..").")
+    end
+    for j = 1, base do
+      table.insert(fullbase, j - 1)
+    end
+  else -- type(base) == "table"
+    if table.getn(base) < 2 then
+      error("digits: Second argument has not enough elements.")
+    end
+    fullbase = base
+  end
+  exponent = table.getn(fullbase)
+  -- Decompose NUMBER
+  local remains = number
+  local result = {}
+  while remains > 0 do
+    local d = luatools.mod(remains, exponent)
+    table.insert(result, fullbase[d + 1])
+    remains = (remains - d) / exponent
+    if remains ~= math.ceil(remains) then
+      error("digits: Internal error during calculation (remains = "..remains..").")
+    end
+  end
+  return result
+end
+
 -- Return a random permutation of n elements.
 -- This function outputs a table with integer entries between
 -- 1 and n at positions 1 to n.

Added: trunk/data/levels/patches/pox_051.lua
===================================================================
--- trunk/data/levels/patches/pox_051.lua	2008-06-14 11:15:31 UTC (rev 1176)
+++ trunk/data/levels/patches/pox_051.lua	2008-06-15 15:08:41 UTC (rev 1177)
@@ -0,0 +1,30 @@
+set_item("it-floppy", 18, 5)
+set_item("it-floppy", 31, 36)
+set_item("it-floppy", 34, 32)
+set_item("it-floppy", 32, 28)
+set_item("it-floppy", 30, 10)
+set_item("it-floppy", 55, 15)
+set_stone("st-door-h", 9, 3, {name = "safe_door"})
+kill_item(9, 5)
+
+xpositions = {6, 7, 8, 10, 11, 12}
+floppystate = {}
+
+for j, x in pairs(xpositions) do
+  set_stone("st-floppy", x, 4, {action = "callback", target = "floppy_callback"})
+end
+
+function floppy_callback(onoff, sender)
+  local x, y = enigma.GetPos(sender)
+  floppystate[x] = 1 - (floppystate[x] or 0)
+  local total = 0
+  for j, x in pairs(xpositions) do
+    total = total + (floppystate[x] or 0)
+  end
+  if total == 6 then
+    SendMessage(enigma.GetNamedObject("safe_door"), "open")
+  else
+    SendMessage(enigma.GetNamedObject("safe_door"), "close")
+  end
+end
+

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-06-14 11:15:31 UTC (rev 1176)
+++ trunk/data/models-2d.lua	2008-06-15 15:08:41 UTC (rev 1177)
@@ -397,7 +397,6 @@
         "it-cross",
         "it-document",
         "it-drop",
-        "it-dummy",
         "it-dynamite",
         "it-flagblack",
         "it-flagwhite",
@@ -465,6 +464,11 @@
     DefTiles("it-extinguisher", {"it-extinguisher", "it-extinguisher_medium", "it-extinguisher_empty"})
 end
 
+-- it-dummy
+do
+    DefTiles("it-dummy", {"it-dummy", "it-dummy_egg"})
+end
+
 -- Oil --
 do
     DefSubimages("it-burnable_oil", {h=4})

Modified: trunk/doc/manual/enigma.texi
===================================================================
--- trunk/doc/manual/enigma.texi	2008-06-14 11:15:31 UTC (rev 1176)
+++ trunk/doc/manual/enigma.texi	2008-06-15 15:08:41 UTC (rev 1177)
@@ -522,6 +522,9 @@
 @item @key{ESC}
 Display game menu
 
+ at item @key{Shift-ESC}
+Quit game immediately
+
 @item @key{F1}
 Display help screen
 

Modified: trunk/doc/manual/enigma_de.texi
===================================================================
--- trunk/doc/manual/enigma_de.texi	2008-06-14 11:15:31 UTC (rev 1176)
+++ trunk/doc/manual/enigma_de.texi	2008-06-15 15:08:41 UTC (rev 1177)
@@ -581,6 +581,9 @@
 @item @key{ESC}
 Zeige das Spielmen@"u
 
+ at item @key{Umschalt+ESC}
+Spiel sofort beenden
+
 @item @key{F1}
 Zeige den Hilfebildschirm
 

Modified: trunk/src/SoundEngine.cc
===================================================================
--- trunk/src/SoundEngine.cc	2008-06-14 11:15:31 UTC (rev 1176)
+++ trunk/src/SoundEngine.cc	2008-06-15 15:08:41 UTC (rev 1177)
@@ -23,6 +23,7 @@
 #include "main.hh"
 
 #include "SDL_mixer.h"
+#include "SDL_mutex.h"
 
 #include <string>
 #include <cassert>

Modified: trunk/src/SoundEngine.hh
===================================================================
--- trunk/src/SoundEngine.hh	2008-06-14 11:15:31 UTC (rev 1176)
+++ trunk/src/SoundEngine.hh	2008-06-15 15:08:41 UTC (rev 1177)
@@ -26,6 +26,7 @@
 #include "SoundEffectManager.hh"
 #include "MusicManager.hh"
 #include "SDL_mixer.h"
+#include "SDL_mutex.h"
 
 #include <string>
 #include <vector>

Modified: trunk/src/client.cc
===================================================================
--- trunk/src/client.cc	2008-06-14 11:15:31 UTC (rev 1176)
+++ trunk/src/client.cc	2008-06-15 15:08:41 UTC (rev 1177)
@@ -484,6 +484,7 @@
     N_("Left mouse button:"),    N_("Activate/drop leftmost inventory item"),
     N_("Right mouse button:"),      N_("Rotate inventory items"),
     N_("Escape:"),                  N_("Show game menu"),
+    N_("Shift+Escape:"),            N_("Quit game immediately"),
     N_("F1:"),                      N_("Show this help"),
     N_("F3:"),                      N_("Kill current marble"),
     N_("Shift+F3:"),                N_("Restart the current level"),
@@ -502,7 +503,7 @@
     server::Msg_Pause (true);
     video::TempInputGrab grab(false);
 
-    helptext_ingame[15] = app.state->getInt("NextLevelMode") == lev::NEXT_LEVEL_NOT_BEST
+    helptext_ingame[17] = app.state->getInt("NextLevelMode") == lev::NEXT_LEVEL_NOT_BEST
         ? _("Skip to next level for best score hunt")
         : _("Skip to next unsolved level");
 

Modified: trunk/src/gui/HelpMenu.cc
===================================================================
--- trunk/src/gui/HelpMenu.cc	2008-06-14 11:15:31 UTC (rev 1176)
+++ trunk/src/gui/HelpMenu.cc	2008-06-15 15:08:41 UTC (rev 1177)
@@ -22,6 +22,8 @@
 #include "video.hh"
 #include "nls.hh"
 
+#include <cassert>
+
 using namespace ecl;
 using namespace std;
 
@@ -37,7 +39,10 @@
         const video::VMInfo &vminfo = *video::GetInfo();
         const int vshrink = vminfo.width < 640 ? 1 : 0;
         
-        add(ok, Rect(vminfo.width-(vshrink?85:170),vminfo.height-(vshrink?30:60),vshrink?75:150,vshrink?20:40));
+        add(ok, Rect(vminfo.width  - (vshrink ? 85 : 170),
+                     vminfo.height - (vshrink ? 30 : 60),
+                     vshrink ? 75 : 150,
+                     vshrink ? 20 : 40));
     }
     
     bool HelpMenu::on_event (const SDL_Event &e) 
@@ -64,10 +69,14 @@
         blit(gc, 0,0, enigma::GetImage("menu_bg", ".jpg"));
         Font *f = enigma::GetFont(cfg.fontname.c_str());
     
-        int x = (vminfo.width-(vshrink?320:640))/2;
+        int x = (vminfo.width - (vshrink ? 320 : 640))/2;
         int y = (cfg.y0/(vshrink?2:1)) + (vminfo.height - (vshrink?240:480))/2;
         for (int i = 0; helptext[i]; i += 2) 
         {
+            assert(helptext[i+1]);
+            // If assert stops here, and you've worked on the game
+            // help menu, check Client::show_help(): Here one of
+            // the text lines is redefined. Correct the line number.
             f->render (gc, cfg.x0/(vshrink?2:1) + x, y, _(helptext[i]));    // translate
             f->render (gc, cfg.x1/(vshrink?2:1) + x, y, _(helptext[i+1]));  // translate
             y += cfg.yskip/(vshrink?2:1);



From andreasl at mail.berlios.de  Tue Jun 17 02:22:33 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Tue, 17 Jun 2008 02:22:33 +0200
Subject: [Enigma-game-svn] r1178 - in feature_branches/hp_lotm: images/lotm
	input input/lotm
Message-ID: <200806170022.m5H0MX1D002752@sheep.berlios.de>

Author: andreasl
Date: 2008-06-17 02:22:09 +0200 (Tue, 17 Jun 2008)
New Revision: 1178

Added:
   feature_branches/hp_lotm/images/lotm/lotm_200703_shoki.jpg
Modified:
   feature_branches/hp_lotm/input/infobox.html
   feature_branches/hp_lotm/input/infobox_de.html
   feature_branches/hp_lotm/input/infobox_ru.html
   feature_branches/hp_lotm/input/lotm/lotm_200703.html
   feature_branches/hp_lotm/input/lotm/lotm_200703_de.html
   feature_branches/hp_lotm/input/lotm/lotm_200806.html
   feature_branches/hp_lotm/input/lotm/lotm_200806_de.html
Log:
LotM Feature branch:
 - Added gamer's comment from Mecke for LotM 6/08
 - Proofread of English LotM 6/08
 - Added Shoki's map of "Island Labyrinth"
 - Infobox:
    - New Topnews: "Two addenda" (Jacob's comment, Shoki's map)
    - Removed link to April's Fool article.
Todo:
 - Russian translation:
    - Infobox
    - Mecke's comment ("It really looks a bit walled in"
      till "<div class="author">mecke</div>")
 - lotm-history.png
 - New <span class="blue">
 - New <div class="spoiler">
 - Validation


Added: feature_branches/hp_lotm/images/lotm/lotm_200703_shoki.jpg
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200703_shoki.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: feature_branches/hp_lotm/input/infobox.html
===================================================================
--- feature_branches/hp_lotm/input/infobox.html	2008-06-15 15:08:41 UTC (rev 1177)
+++ feature_branches/hp_lotm/input/infobox.html	2008-06-17 00:22:09 UTC (rev 1178)
@@ -1,10 +1,12 @@
     <div class="infobody">
        <div class="info">
-         <h3>500,000 Downloads!</h3>
-         In 2 out of 3 statistics, Enigma jumped the 500.000 downloads mark on
-         the Berlios server. This includes downloads from 0.92 up to 1.01.
-         Thanks to all players who made this possible!
-         
+         <h3>Two addenda</h3>
+         We now have a comment from Jacob to his last LotM, you can read
+         it <a href="$$lotm_200805$$#jacob">here</a>. AND, we got a great map
+         of the Level of the Year 2007, <a href="$$lotm_200703$$">&quot;Island
+         Labyrinth&quot;</a>, from Shoki. You can download it
+         <a href="$$imagedir$$/lotm/lotm_200703_shoki.jpg">here</a>.
+
          <h3>Level of the Month</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>
@@ -12,12 +14,14 @@
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
          </div>
 
+         <!--
          <h3>April Fool's Day '08</h3>
          <a href="$$april_2008$$"><img src="$$imagedir$$/articles/april_2008.png"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">
            <a href="$$april_2008$$">&quot;The Three Clouds&quot;</a>
          </div>
+         -->
          
          <!--
          <h3>End-of-Year Awards</h3>

Modified: feature_branches/hp_lotm/input/infobox_de.html
===================================================================
--- feature_branches/hp_lotm/input/infobox_de.html	2008-06-15 15:08:41 UTC (rev 1177)
+++ feature_branches/hp_lotm/input/infobox_de.html	2008-06-17 00:22:09 UTC (rev 1178)
@@ -1,10 +1,12 @@
     <div class="infobody">
        <div class="info">
-         <h3>500.000 Downloads!</h3>
-         In zwei von drei Statistiken hat Enigma die
-         500.000-Download-Marke auf dem Berlios-Server &uuml;bersprungen.
-         Dies umfasst Downloads von 0.92 bis 1.01. Vielen Dank an alle Spieler,
-         die dies m&ouml;glich gemacht haben!
+         <h3>Zwei Nachtr&auml;ge</h3>
+         Wir haben nun einen Kommentar von Jacob zu seinem letzten LotM,
+         Sie k&ouml;nnen ihn <a href="$$lotm_200805$$#jacob">hier</a> lesen.
+         UND, wir haben eine gro&szlig;artige Karte vom Level des Jahres 2007,
+         <a href="$$lotm_200703$$">&quot;Island Labyrinth&quot;</a>, von Shoki
+         bekommen. Sie k&ouml;nnen sie <a
+         href="$$imagedir$$/lotm/lotm_200703_shoki.jpg">hier</a> herunterladen.
 
          <h3>Level des Monats</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
@@ -13,12 +15,14 @@
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
          </div>
 
+         <!--
          <h3>Aprilscherz '08</h3>
          <a href="$$april_2008$$"><img src="$$imagedir$$/articles/april_2008.png"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">
            <a href="$$april_2008$$">&quot;The Three Clouds&quot;</a>
          </div>
+         -->
          
          <!--
          <h3>Jahresend-<br>auszeichnungen</h3>

Modified: feature_branches/hp_lotm/input/infobox_ru.html
===================================================================
--- feature_branches/hp_lotm/input/infobox_ru.html	2008-06-15 15:08:41 UTC (rev 1177)
+++ feature_branches/hp_lotm/input/infobox_ru.html	2008-06-17 00:22:09 UTC (rev 1178)
@@ -12,12 +12,14 @@
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
          </div>
 
+         <!--
          <h3>April Fool's Day '08</h3>
          <a href="$$april_2008$$"><img src="$$imagedir$$/articles/april_2008.png"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">
            <a href="$$april_2008$$">&quot;The Three Clouds&quot;</a>
          </div>
+         -->
          
          <!--
          <h3>??????? ????? ????</h3>

Modified: feature_branches/hp_lotm/input/lotm/lotm_200703.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200703.html	2008-06-15 15:08:41 UTC (rev 1177)
+++ feature_branches/hp_lotm/input/lotm/lotm_200703.html	2008-06-17 00:22:09 UTC (rev 1178)
@@ -151,4 +151,12 @@
 
   <p>Greets,<br>
   <i>Andreas</i></p>
+  
+  <p>
+  <i>Addendum:</i> Shoki send us a special piece of gamer's art, a full map of
+  &quot;Island Labyrinth&quot;! You find it
+  <a href="$$imagedir$$/lotm/lotm_200703_shoki.jpg">here</a>, many thanks to
+  Shoki for this! (Note the map is a spoiler.)
+  </p>
+
 </div>

Modified: feature_branches/hp_lotm/input/lotm/lotm_200703_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200703_de.html	2008-06-15 15:08:41 UTC (rev 1177)
+++ feature_branches/hp_lotm/input/lotm/lotm_200703_de.html	2008-06-17 00:22:09 UTC (rev 1178)
@@ -165,4 +165,12 @@
 
   <p>Sch&ouml;ne Gr&uuml;&szlig;e,<br>
   <i>Andreas</i></p>
+
+  <p>
+  <i>Nachtrag:</i> Shoki hat uns ein besonderes St&uuml;ck Spielerkunst
+  zugesendet, eine komplette Karte von &quot;Island Labyrinth&quot;! Sie finden
+  sie <a href="$$imagedir$$/lotm/lotm_200703_shoki.jpg">hier</a>, vielen Dank
+  an Shoki daf&uuml;r! (Vorsicht, die Karte ist nat&uuml;rlich ein Spoiler.)
+  </p>
+
 </div>

Modified: feature_branches/hp_lotm/input/lotm/lotm_200806.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200806.html	2008-06-15 15:08:41 UTC (rev 1177)
+++ feature_branches/hp_lotm/input/lotm/lotm_200806.html	2008-06-17 00:22:09 UTC (rev 1178)
@@ -209,9 +209,10 @@
 <p>As next, the white marble has to be put into play, otherwise there's nothing
 more to do for the black one&mdash;a wood stone blocks the remaining way. Well
 then, let's do some 'island hopping' with the white marble&mdash;no, no need
-for jumping. Place wood stones between the four islands. Here everyone should
-act careful, who have problems with the rebound of pushing stones on narrow
-floors; fortunately, the grass's not wet and the sand is just normal sand.
+for jumping. Place wood stones between the four islands. 
+Here everyone who has problems with the rebound of pushing stones on narrow
+floors should be careful; fortunately, the grass's not wet and the sand is just
+normal sand.
 </p>
 
 <p>After we managed this as well, the black and the white marble mutually free
@@ -235,6 +236,53 @@
 <div class="imagetitle">Another broken ego &hellip;</div>
 </div>
 
+<div class="quote">
+It really looks a bit walled in, the black marble, that I as a gamer have to
+use. And the hint to open &quot;the&quot; door, sounds like a command, and when
+the author wishes me &quot;good luck&quot;, I'll surely need it!
+</div>
+
+<div class="quote">
+There I see some impulse stones, that can move many a stone, and their
+&quot;hollow&quot; relatives, which can destroy a passing marble: Keep your
+fingers on the pulse of time!
+</div>
+
+<div class="quote">
+I see a yin-yang symbol beyond the &quot;now&quot; opened door and have a clue
+to the existence of a partner, which is important for the solution: a white
+marble.
+</div>
+
+<div class="quote">
+So I begin to play, make my way to the yin-yang &hellip; and suddenly &hellip;
+the door is &hellip; closed. Lost? <i>Can there be another actor? &quot;Block
+its way&quot;? &hellip; Whose way shall I block?</i>
+</div>
+
+<div class="quote">
+I switch to the white marble, free it, equip it and &hellip; for starters, build
+a bridge to the main island with the oxyds. <i>But: How can I open the door
+again? Lost? And what is the bolder doing there? Maybe there are switches
+&hellip; or a magic wand?</i>
+</div>
+
+<div class="quote">
+With speed, and the &quot;right&quot; impulse, I finally come up with a
+blockade &quot;solution&quot; just in time: &quot;Block its way&quot;! Do you
+have your fingers on the pulse of time?
+</div>
+
+<div class="quote">
+It's a beautiful game, two marbles, two initial scenarios, and the demand to
+accomplish intelligent and fast actions with time and dexterity. And to keep
+the &quot;alien&quot; blocking actor on distance: Block its way. Only then the
+door keeps open until the closing tune plays, just like the first hint reminds
+us so categorically.
+</div>
+
+<div class="author">mecke</div>
+
 <p>If you remember the first sentence of this article, you will ask yourself,
 what on earth is so funny with this level? Actually, nothing, if&mdash;yes,
 <b>if</b>&mdash;one plays it like described. Because there's one more variant,
@@ -257,16 +305,16 @@
 author amused about all the gullible players like me (he might forgive me, when
 I alleged something wrong)? If yes, I think it's okay LOL. By all means I've
 willingly learned my lesson mit a smile. I always have to thing about a quote
-from Kurt Tucholsky on such occasions: &quot;Never let an expert impress
-yourself, when he tells: 'Dear friend, I'm doing it this way for twenty years
-now!'&mdash;one can well do it the wrong way for twenty years.</i>&quot;
+from Kurt Tucholsky on such occasions: 
+&quot;Never let an expert impress you when he says, 'Dear friend, I've been
+doing it this way for twenty years now!'&mdash;one can well do it the wrong way
+for twenty years.</i>&quot;
 </p>
 
 <p>And therefore a large 'Thank you' to Jon 'WB' Sneyers for a level
-which&mdash;like in my case&mdash;demonstrates the own shortsightedness. And
-please leave the level the way it is and don't correct it afterwards, at least
-I would deplore it.
-</p>
+which&mdash;like in my case&mdash;demonstrates the gamer's own shortsightedness.
+And please leave the level the way it is and don't correct it, as I, for one,
+would be very disappointed!</p>
 
 <p><i>[Commentary: The shortcut wasn't known to the team nor to Jon, until
 Taztunes advised us of it. Thus, the speed rating of three was assigned without

Modified: feature_branches/hp_lotm/input/lotm/lotm_200806_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200806_de.html	2008-06-15 15:08:41 UTC (rev 1177)
+++ feature_branches/hp_lotm/input/lotm/lotm_200806_de.html	2008-06-17 00:22:09 UTC (rev 1178)
@@ -240,6 +240,55 @@
 <div class="imagetitle">Ein weiteres gebrochenes Ego &hellip;</div>
 </div>
 
+<div class="quote">
+Ein bisschen eingemauert sieht sie aus, die schwarze Kugel, die ich als Spieler
+benutzen soll, und der Hinweis, &quot;die&quot; T&uuml;r zu &ouml;ffnen, klingt
+befehlsartig, und wem man &quot;Gl&uuml;ck&quot; w&uuml;nscht, der kann es wohl auch
+gebrauchen!
+</div>
+
+<div class="quote">
+Da sehe ich die Impulssteine, die so manches bewegen k&ouml;nnen, und ihre
+&quot;hohlen&quot; Verwandten, die beim Durchwandern die Kugel mit
+&quot;Impuls&quot; zerst&ouml;ren k&ouml;nnten: Sei am Puls der Zeit!
+</div>
+
+<div class="quote">
+Ich sehe ein Yinyang-Symbol jenseits der &quot;nun&quot; ge&ouml;ffneten T&uuml;r und habe
+den Hinweis auf die Existenz eines f&uuml;r die L&ouml;sung notwendigen Partners: eine
+wei&szlig;e Kugel.
+</div>
+
+<div class="quote">
+Also fange ich an, schaffe den Weg zum Yinyang &hellip; und pl&ouml;tzlich &hellip;
+ist die T&uuml;r &hellip; zu. Verloren? <i>Gibt es da etwa noch einen Akteur?
+&quot;Block its way&quot;? &hellip; Wessen Weg soll ich blockieren?</i>
+</div>
+
+<div class="quote">
+Ich switche auf die wei&szlig;e Kugel, befreie sie, statte sie aus und &hellip; baue
+erst einmal Br&uuml;cken bis hin zur Hauptinsel mit den Oxyds.
+<i> Aber: wie bekomme ich die T&uuml;r wieder auf? Verloren?
+Und was macht der Bolder da? 
+Gibt es vielleicht Schalter &hellip; oder einen Zauberstab?</i>
+</div>
+
+<div class="quote">
+Mit Schnelligkeit, dem &quot;richtigen&quot; Impuls, schaffe ich schlie&szlig;lich
+eine &quot;rechtzeitige&quot; Blockade-&quot;L&ouml;sung&quot;:
+&quot;Block its way&quot;! Bist du am Puls mit der Zeit?
+</div>
+
+<div class="quote">
+Es ist ein sch&ouml;nes Spiel, zwei Kugeln, zwei Ausgangsszenarien, und die Erfordernis,
+intelligente Aktionen schnell mit Zeit und Geschick durchzuf&uuml;hren.
+Und so den &quot;fremden&quot; versperrenden Akteur fernzuhalten: Block its way.
+Nur so bleibt die T&uuml;r bis zur Schlu&szlig;melodie ge&ouml;ffnet, wie es der erste Hinweis
+so &quot;unbedingt&quot; anmahnt.
+</div>
+
+<div class="author">mecke</div>
+
 <p>Wer sich noch an den ersten Satz des Artikels erinnert, wird sich jetzt fragen,
 was ist denn bittesch&ouml;n so lustig an dem Level?  Eigentlich garnichts, wenn
 - ja <b>wenn</b> - man es so spielt, wie gerade beschrieben. Es gibt



From ged at mail.berlios.de  Tue Jun 17 18:42:38 2008
From: ged at mail.berlios.de (ged at mail.berlios.de)
Date: Tue, 17 Jun 2008 18:42:38 +0200
Subject: [Enigma-game-svn] r1179 - in feature_branches/hp_lotm/input: . lotm
Message-ID: <200806171642.m5HGgcnV030951@sheep.berlios.de>

Author: ged
Date: 2008-06-17 18:42:27 +0200 (Tue, 17 Jun 2008)
New Revision: 1179

Modified:
   feature_branches/hp_lotm/input/infobox_ru.html
   feature_branches/hp_lotm/input/lotm/lotm_200703_ru.html
   feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html
Log:
Homepage:

- Added Russian translation for new comment at lotm_200806,
addendum for lotm_200703 and infobox.


Modified: feature_branches/hp_lotm/input/infobox_ru.html
===================================================================
--- feature_branches/hp_lotm/input/infobox_ru.html	2008-06-17 00:22:09 UTC (rev 1178)
+++ feature_branches/hp_lotm/input/infobox_ru.html	2008-06-17 16:42:27 UTC (rev 1179)
@@ -1,9 +1,10 @@
     <div class="infobody">
        <div class="info">
-         <h3>500,000 ????????!</h3>
-         ? 2 ?? 3 ?????????????? ???????, Enigma ???????? ??????? ? 500.000 ???????? ?
-         ??????? Berlios. ? ??? ?????? ???????? ? ?????? 0.92 ?? 1.01.
-         ??????? ???? ???????, ??????? ??????? ??? ?????????!
+         <h3>??? ??????????</h3>
+         ?????? ? ??? ???? ??????????? ?? Jacob ? ??? ?????????? ??, ??????? ?? ?????? ????????
+         <a href="$$lotm_200805$$#jacob">?????</a>. ? ???, ?? ???????? ?? Shoki, ???????? ?????
+         ?????? ???? 2007, <a href="$$lotm_200703$$">&quot;Island
+         Labyrinth&quot;</a>. ?? ?????? ??????? ?? <a href="$$imagedir$$/lotm/lotm_200703_shoki.jpg">?????</a>.
 
          <h3>??????? ??????</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"

Modified: feature_branches/hp_lotm/input/lotm/lotm_200703_ru.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200703_ru.html	2008-06-17 00:22:09 UTC (rev 1178)
+++ feature_branches/hp_lotm/input/lotm/lotm_200703_ru.html	2008-06-17 16:42:27 UTC (rev 1179)
@@ -144,4 +144,12 @@
 
   <p>? ?????????,<br>
   <i>Andreas</i></p>
+  
+  <p>
+  <i>??????????:</i> Shoki ??????? ??? ?????? ???????????? ????????? ??????? - ?????? ?????
+  &quot;Island Labyrinth&quot;! ?? ??????? ??
+  <a href="$$imagedir$$/lotm/lotm_200703_shoki.jpg">?????</a>, ???????? ??????? ?? ??? Shoki!
+  (?????? ? ????, ??? ????? ??? ???????.)
+  </p>
+
 </div>

Modified: feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html	2008-06-17 00:22:09 UTC (rev 1178)
+++ feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html	2008-06-17 16:42:27 UTC (rev 1179)
@@ -127,35 +127,43 @@
 <p>
 <ul>
 <li>
-  ????????? ?????????? ???????????? ?????????? ?????? ? ?????????? ?????? ? ????? ? ??????? ?????????
+  ????????? ?????????? ???????????? ?????????? ?????? ? ??????????
+?????? ? ????? ? ??????? ?????????
   <br>
-  (<span class="blue">????????, ??? ?????? ????????????? ???????????? ? ????????? ??? ???? ???? ????????
-  &hellip;&mdash; ?? ????? ????, ? ??? ?? ??? ? ????? ?????, ??????? ?????????????? ?????????
+  (<span class="blue">????????, ??? ?????? ????????????? ????????????
+? ????????? ??? ???? ???? ???????? &hellip;&mdash; ?? ????? ????, ? ???
+?? ??? ? ????? ?????, ??????? ?????????????? ?????????
   "? ??? ?????, ????..."</span>),
 </li><li>
-  ????????? ??????-????? ? ??? ??? ?? ???????? ?????? ?????? ? ???????? ???-???
+  ????????? ??????-????? ? ??? ??? ?? ???????? ?????? ?????? ?
+???????? ???-???
   <br>
-  (<span class="blue">???, ????? ?????? ???? ? ????? ?????. ??????? ?????, ??????, ????? ????????
+  (<span class="blue">???, ????? ?????? ???? ? ????? ?????. ??????? ?????,
+ ??????, ????? ????????
   &mdash; ???????? ? ?????????</span>),
 </li><li>
   ?????? ???????
   <br>
   (<span class="blue">?????? ????? ??? ? ????????? ????. ?????? ???????
   ????? ?????? ????, ??????-?? ? ??: &quot;?? ???????? ??????? ????? &hellip;&quot;.
-  ????????, ??? ????????? ? ???????? &hellip; ???????, ????? ???????. ??? ???? ??????.</span>),
+  ????????, ??? ????????? ? ???????? &hellip; ???????, ????? ???????.
+ ??? ???? ??????.</span>),
 </li><li>
   ?????? ? ????????? ???????
   <br>
-  (<span class="blue">???? ? ???????? ????????, ????? ?????? ??????? ?????? &mdash; ??????
+  (<span class="blue">???? ? ???????? ????????, ????? ?????? ???????
+ ?????? &mdash; ??????
   ??????? ?? ?????</span>),
 </li><li>
   ?, ??, ????? ?????, ??? ????????????? ???????.
   <br>
-  (<span class="blue">???? ??????? ?? ????????? ????????, ? ?????? ????? ? '??????????' ??????</span>),
+  (<span class="blue">???? ??????? ?? ????????? ????????, ? ??????
+ ????? ? '??????????' ??????</span>),
 </li><li>
   ? ?????? (st_bolder)
   <br>
-  (<span class="blue">??? ?? ?? ?????? ??????, ????? ?????? ????????? ?????? ????
+  (<span class="blue">??? ?? ?? ?????? ??????, ????? ?????? ?????????
+ ?????? ????
   &hellip; ?, ?????, ??? ????? ??????</span>).
 </li>
 </ul>
@@ -166,35 +174,40 @@
 <div class="imagetitle">?? ???????????? &hellip;</div>
 </div>
 
-<p>? ?????? ??????? ??????. ????? ???????, ????????????? ?? ?????? ?? ?????? ??????????
-??????, ????? ???? ?? ???????? ????????? ??????? ??????? ??????, ????? ????????
-????? ????????????? ??????, ????????? ????????? ???????, ?????? &quot;?????!&quot; (<span
-class="blue">?? ??? ? ?????? ????????? ????????, ?? ??????? ????? ??????????? &hellip;</span>),
+<p>? ?????? ??????? ??????. ????? ???????, ????????????? ?? ??????
+ ?? ?????? ?????????? ??????, ????? ???? ?? ???????? ????????? ???????
+??????? ??????, ????? ???????? ????? ????????????? ??????, ?????????
+????????? ???????, ?????? &quot;?????!&quot; (<span class="blue">?? ??? ?
+?????? ????????? ????????, ?? ??????? ????? ??????????? &hellip;</span>),
 ????????????? ?? ?????????? ??????????? ?????, ????????? ?????? ?????,
-?? ????? ???????????? ??????, ???? ?????????? ????? ?? ??????? ? ???? ?????????? ?????,
-?? ???? ????????? ??? ???? ???????, ?????????? ? ???? ?????????? ????, ????? ?????? ?
-????????? ??????? ? ????????? ??? ???? ???????????? ??????.
+?? ????? ???????????? ??????, ???? ?????????? ????? ?? ??????? ? ????
+?????????? ?????, ?? ???? ????????? ??? ???? ???????, ?????????? ? ????
+?????????? ????, ????? ?????? ? ????????? ??????? ? ????????? ??? ????
+???????????? ??????.
 </p>
 
-<p>???, ? ??? ? ??. ? ?????? ????? ????????, ??? ?????? ???????? ????? ?????? ???? ?
-??????????? ?? ????????. ?????? ??????? &hellip; ??, ????? ????? ??????? ? ???????
-??? ?? ?????? (F3 ????????????? ???? ???????. ??!). ??????, ?????? ???? ????? ???????? ?????????
-???????: &quot;????????????!&quot; ??, ??? ?? ??? ?????????!<br>
-??????, ? ??? ?????? ?????????? ???????? ??! ???? ??? ??? ??????
-;-))), ????????????? ?????? ????? ?? '??????????' ?????????? ??????. ???? ??? ??
-??????, ???????
+<p>???, ? ??? ? ??. ? ?????? ????? ????????, ??? ?????? ???????? ?????
+?????? ???? ? ??????????? ?? ????????. ?????? ??????? &hellip; ??, ?????
+????? ??????? ? ??????? ??? ?? ?????? (F3 ????????????? ???? ???????.
+??!). ??????, ?????? ???? ????? ???????? ????????? ???????:
+&quot;????????????!&quot; ??, ??? ?? ??? ?????????!<br> ??????, ? ???
+?????? ?????????? ???????? ??! ???? ??? ??? ?????? ;-))), ?????????????
+?????? ????? ?? '??????????' ?????????? ??????. ???? ??? ?? ??????,
+???????
 </p>
 
-<p>?????????? ?????, ?? ?? ???? ??? ? ??????? ???????????, ? ??????? ???????, ? ????? ??????,
-??????? ???????? ?????? ????? ????.
+<p>?????????? ?????, ?? ?? ???? ??? ? ??????? ???????????, ? ???????
+???????, ? ????? ??????, ??????? ???????? ?????? ????? ????.
 </p>
 
-<p>???????, ? ???? ??????????, ? ??????? ???????. ????????, ??? &mdash; ??? ????? ??????
-?????? ??????? (???? ???? ???????, ? ????? ??? ???? ??????? ??? ??? ? ????).
-? ?? ??? ??????? ?????????? (?????), ?? ??????? ???????????? (??????? ????).
-?? ???????? ? ???? ????????? ??????? ? ???? ????? ??????, ??????????? ?? ????????? &hellip;
+<p>???????, ? ???? ??????????, ? ??????? ???????. ????????, ???
+&mdash; ??? ????? ?????? ?????? ??????? (???? ???? ???????, ? ?????
+??? ???? ??????? ??? ??? ? ????). ? ?? ??? ??????? ?????????? (?????),
+?? ??????? ???????????? (??????? ????). ?? ???????? ? ???? ?????????
+??????? ? ???? ????? ??????, ??????????? ?? ????????? &hellip;
 ? ??????? ?????? ?????, ????? ?????? ??????? ??????.
-? ??? ???? ???, ????? ??? ?????? ???????????? ? ??? ????? ???????? ???????: ? ????? ?? ?????.
+? ??? ???? ???, ????? ??? ?????? ???????????? ? ??? ????? ????????
+???????: ? ????? ?? ?????.
 </p>
 
 <div class="lotmpic">
@@ -202,27 +215,32 @@
 <div class="imagetitle">??? ??? ??????!</div>
 </div>
 
-<p>?????? ? ???? ?????? ???????? ????? ?????, ? ????????? ?????? ??????? ?????? ????? ?????? ??????
-&mdash; ?????????? ???? ??????????? ?????????? ????. ????? ????? ??????? ????? ??????? ???????
-'????????? ????? ?????????' &mdash; ???, ??????? ?? ???????????. ??????????? ????? ???????? ?????????
-?????????? ?????. ????? ?????? ?? ???, ? ???? ???? ???????? ? ???????? ?? ????????? ? ?????????
-???????????? ??????, ?????? ???? ??????????; ? ??????? ????? ?? ??????, ? ????? ???????.
+<p>?????? ? ???? ?????? ???????? ????? ?????, ? ????????? ??????
+??????? ?????? ????? ?????? ?????? &mdash; ?????????? ???? ???????????
+?????????? ????. ????? ????? ??????? ????? ??????? ???????
+'????????? ????? ?????????' &mdash; ???, ??????? ?? ???????????.
+??????????? ????? ???????? ????????? ?????????? ?????. ?????
+?????? ?? ???, ? ???? ???? ???????? ? ???????? ?? ????????? ? ?????????
+???????????? ??????, ?????? ???? ??????????; ? ??????? ????? ??
+??????, ? ????? ???????.
 </p>
 
-<p>????? ????, ??? ?? ? ???? ?????????, ?????? ? ????? ????? ????? ??????????? ???? ???? ?????.
-?? ???? ???????? ????????? ???????. ???????, ?????? ????? ?????? ????????? ???? ???? ? ??????????
+<p>????? ????, ??? ?? ? ???? ?????????, ?????? ? ????? ????? ?????
+??????????? ???? ???? ?????. ?? ???? ???????? ????????? ???????.
+???????, ?????? ????? ?????? ????????? ???? ???? ? ??????????
 ??????? ?????? ??? ?????????? ??????.
 </p>
 
-<p>????? ??? ??????, ????? ?????????? ????? ???????, ?????? ????? ????? ??????????? ? ????
-????????? ????, ?????, ???????, ?????? ???????, ???????????? ?? ?????-?????? ??
-????????????? ?????? ?????????? ??????.
+<p>????? ??? ??????, ????? ?????????? ????? ???????, ?????? ?????
+????? ??????????? ? ???? ????????? ????, ?????, ???????, ??????
+???????, ???????????? ?? ?????-?????? ?? ????????????? ??????
+?????????? ??????.
 </p>
 
 <p>???? ??? ???????? &quot;Little Puzzles&quot; ? &quot;Big Adventures&quot;
-??? ?? ???, ??? ? ? ??????????? ????? ??????, ?? ?????? ??????????? ???? ??? ???? ?
-???? ???????? ? ?????? ??????? &quot;Block its way!&quot;; ? ????? ??????, ??? ??? ?????? ????????
-??? ?? ???????.
+??? ?? ???, ??? ? ? ??????????? ????? ??????, ?? ?????? ???????????
+???? ??? ???? ? ???? ???????? ? ?????? ??????? &quot;Block its way!&quot;;
+? ????? ??????, ??? ??? ?????? ???????? ??? ?? ???????.
 </p>
 
 <div class="lotmpic">
@@ -230,6 +248,54 @@
 <div class="imagetitle">? ??? ???? ????????? ????? &hellip;</div>
 </div>
 
+<div class="quote">
+?? ????? ???? ????????? ???????????, ??? ?????? ?????, ??????? ?,
+??? ?????, ?????? ???????????? ? ?????????. ? ????? ???????
+&quot;?????&quot; ?????? ??? ??????, ? ????? ????? ?????? ??? &quot;?????&quot;,
+??? ??? ??????????? ??????????!
+</div>
+
+<div class="quote">
+? ?????? ????????? ?????????? ??????, ??????? ????? ???????????
+????????? ?????? ? ?? &quot;?????&quot; ?????????, ??????? ?????
+????????? ????????? ???? ?????: ?????????? ???? ??????!
+</div>
+
+<div class="quote">
+?? &quot;???&quot; ??????????? ?????? ? ?????? ?????? ???-???
+? ????????? ? ????????????? ????????, ??????? ?????? ?????? ????
+? ??????? - ?????? ??????
+</div>
+
+<div class="quote">
+????, ? ????????? ? ????, ???????? ???? ? ??????? ???-??? &hellip; ? ?????????? &hellip;
+????? ????????? &hellip; ????????. ???????? <i>????? ????? ???? ?????? ??????
+&quot;???????? ??? ????&quot;? &hellip; ???? ? ?????? ?????????? ?????</i>
+</div>
+
+<div class="quote">
+? ???????????? ?? ????? ?????, ????????? ???, ?????? ??? ???? ????????
+? &hellip; ??????????, ??????? ???? ? ???????? ??????? ? ???????-????????.
+<i>??: ??? ??? ????? ??????? ?????? ???????? ? ??? ????? ?????? ???????
+????? ????? ???? ????????????? &hellip; ??? ????????? ????????</i>
+</div>
+
+<div class="quote">
+???????? ? &quot;??????????&quot; ???????, ??????? ??? ??????? &quot;??????&quot;
+???? ??????? ? ??????? ??????????: &quot;?????????? ??? ????&quot;! ?? ??????????
+???? ???????
+</div>
+
+<div class="quote">
+??? ???????????? ????, ??? ??????, ??? ????????? ????????, ? ?????????????
+?????? ??? ????? ? ??????, ??????? ? ?????. ? ????? ???????
+&quot;??????&quot; ???????????? ?????? ?? ??????????: ?????????? ??? ????.
+?????? ????? ????? ????????? ????????, ?? ????? ???????? ??????,
+? ??? ??? ??????????? ?????????? ??? ?????? ???????.
+</div>
+
+<div class="author">mecke</div>
+
 <p>???? ?? ??????? ?????? ??????????? ???? ??????, ?? ?????????? ????????,
 ???, ?? ??? ????? ???????, ?????? ???????? ? ???? ??????? ?? ????? ???? ??????, ???? &mdash; ??,
 <b>????</b> &mdash; ????? ?????????, ??? ??????? ????. ?????? ??? ???? ??? ???? ???????,



From andreasl at mail.berlios.de  Tue Jun 17 22:20:07 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Tue, 17 Jun 2008 22:20:07 +0200
Subject: [Enigma-game-svn] r1180 - in feature_branches/hp_lotm: .
	images/lotm input/lotm
Message-ID: <200806172020.m5HKK7U2025030@sheep.berlios.de>

Author: andreasl
Date: 2008-06-17 22:19:59 +0200 (Tue, 17 Jun 2008)
New Revision: 1180

Modified:
   feature_branches/hp_lotm/enigma.css
   feature_branches/hp_lotm/images/lotm/lotm-history.png
   feature_branches/hp_lotm/input/lotm/lotm_200805.html
   feature_branches/hp_lotm/input/lotm/lotm_200805_de.html
   feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html
   feature_branches/hp_lotm/input/lotm/lotm_200806.html
   feature_branches/hp_lotm/input/lotm/lotm_200806_de.html
   feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html
Log:
LotM Feature branch:
 - Validation
 - lotm-history.png
 - CSS (validated)
    - .lotm.blue
    - .lotm.spoiler
    - Validation
Todo:
 - Merge to homepage, then upload


Modified: feature_branches/hp_lotm/enigma.css
===================================================================
--- feature_branches/hp_lotm/enigma.css	2008-06-17 16:42:27 UTC (rev 1179)
+++ feature_branches/hp_lotm/enigma.css	2008-06-17 20:19:59 UTC (rev 1180)
@@ -462,6 +462,18 @@
     background-color: #aaaaaa;
 }
 
+.lotm .blue {
+    color: #0000ff;
+    font-style: italic;
+}
+
+.lotm .spoiler {
+    color: #aaaaaa;
+    background-color: #aaaaaa;
+    padding-left: 1em;
+    padding-right: 1em;
+}
+
 .credits table td {
     padding-right: 1em;
 }

Modified: feature_branches/hp_lotm/images/lotm/lotm-history.png
===================================================================
(Binary files differ)

Modified: feature_branches/hp_lotm/input/lotm/lotm_200805.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805.html	2008-06-17 16:42:27 UTC (rev 1179)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805.html	2008-06-17 20:19:59 UTC (rev 1180)
@@ -217,9 +217,9 @@
 in contrast to the other parts adds much to the pleasure of the level
 as a whole.</p>
 
-<a name="jacob">
-<h4>With some delay, here are the comments of the author:</h4>
-</a>
+<h4><a name="jacob">
+With some delay, here are the comments of the author:
+</a></h4>
 
 <div class="quote">I wrote &quot;Pleasure Garden&quot; as my first serious attempt at emulating the
 style of the original Oxyd labyrinths.  Usually they comprised many

Modified: feature_branches/hp_lotm/input/lotm/lotm_200805_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805_de.html	2008-06-17 16:42:27 UTC (rev 1179)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805_de.html	2008-06-17 20:19:59 UTC (rev 1180)
@@ -227,9 +227,9 @@
 Gegenpol zum Rest - diesem meines Erachtens seinen ganz besonderen 
 Reiz.</p>
 
-<a name="jacob">
-<h4>Und hier ist, mit etwas Verz&ouml;gerung, der Kommentar des Autors:</h4>
-</a>
+<h4><a name="jacob">
+Und hier ist, mit etwas Verz&ouml;gerung, der Kommentar des Autors:
+</a></h4>
 
 <div class="quote">&quot;Pleasure Garden&quot; ist das Resultat meines ersten ernsthaften Versuchs, 
 den Stil der Original Oxyd Labyrinthe zu emulieren. Normalerweise 

Modified: feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html	2008-06-17 16:42:27 UTC (rev 1179)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html	2008-06-17 20:19:59 UTC (rev 1180)
@@ -204,9 +204,9 @@
 ? ?? ?? ????????), ??-????? ????????? ????? &quot;Pleasure Garden&quot; ? ??????? ?? ?????????,
 ????????? ??????? ????? ???? ????????????, ??????? ???????? ???? ???????.</p>
 
-<a name="jacob">
-<h4>? ????????? ?????????, ???????? ??????????? ?????? ??????:</h4>
-</a>
+<h4><a name="jacob">
+? ????????? ?????????, ???????? ??????????? ?????? ??????:
+</a></h4>
 
 <div class="quote">? ????? &quot;Pleasure Garden&quot; ??????? ??????? ???????? ???????
 ? ???????? ????? ???????????? ?????????? Oxyd. ?????? ??? ??????? ?? ?????????

Modified: feature_branches/hp_lotm/input/lotm/lotm_200806.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200806.html	2008-06-17 16:42:27 UTC (rev 1179)
+++ feature_branches/hp_lotm/input/lotm/lotm_200806.html	2008-06-17 20:19:59 UTC (rev 1180)
@@ -124,7 +124,6 @@
 present itself to me:
 </p>
 
-<p>
 <ul>
 <li>
   a small amount of impulse stones and some wood stones interspersed with a
@@ -163,7 +162,6 @@
   &hellip; ah, well, everything will go well</span>).
 </li>
 </ul>
-</p>
 
 <div class="lotmpic">
 <img src="$$imagedir$$/lotm/lotm_200806_a.jpg" alt="Level of the Month" border="0">
@@ -290,13 +288,22 @@
 Taztunes for the hint). So everyone who has problems with that, or are not
 that interested in a good time, or just want to play a nice level in a relaxed
 atmosphere, should do the following:
-<br>
-<i>Danger, spoiler ahead!</i><div class="spoiler">Open the door with the
+</p>
+
+<p>
+<i>Danger, spoiler ahead!</i>
+</p>
+
+<div class="spoiler">Open the door with the
 trigger and touch one of the surrounding impulse stones, then <b>wait</b> until
 the door closes (the bolder now reached its trigger), then just press the
 trigger a second time and the door opens up again, finished (read Taztunes'
 post about &quot;Block its way!&quot; from March 26th 2008 on the forum
-mag-heut.net).</div><i>End of spoiler</i>
+mag-heut.net).
+</div>
+
+<p>
+<i>End of spoiler</i>
 </p>
 
 <p>Now I ask myself the question, why is the level called &quot;Block its
@@ -308,7 +315,7 @@
 from Kurt Tucholsky on such occasions: 
 &quot;Never let an expert impress you when he says, 'Dear friend, I've been
 doing it this way for twenty years now!'&mdash;one can well do it the wrong way
-for twenty years.</i>&quot;
+for twenty years.&quot;
 </p>
 
 <p>And therefore a large 'Thank you' to Jon 'WB' Sneyers for a level

Modified: feature_branches/hp_lotm/input/lotm/lotm_200806_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200806_de.html	2008-06-17 16:42:27 UTC (rev 1179)
+++ feature_branches/hp_lotm/input/lotm/lotm_200806_de.html	2008-06-17 20:19:59 UTC (rev 1180)
@@ -140,18 +140,15 @@
 </li><li>
   vier Dokumente
   <br>
-  (<span class="blue">F&uuml;r Tipps ist also auch gesorgt. Das erste liegt gleich in der N&auml;he, also 
-  lesen wir mal: &quot;Ich soll nicht vergessen die T&uuml;r zu &ouml;ffnen &hellip;&quot;. Damit ist wohl der Trigger gemeint &hellip; 
-  super, die T&uuml;re ist offen. Das war ja einfach.</span>),
-  Das erste liegt gleich in der N&auml;he, also 
-  lesen wir mal: &quot;Ich soll nicht vergessen die T&uuml;r zu &ouml;ffnen
-  &hellip;&quot;. Damit ist wohl der Trigger gemeint &hellip; 
-  super, die T&uuml;re ist offen. Das war ja einfach</span>),
+  (<span class="blue">F&uuml;r Tipps ist also auch gesorgt. Das erste liegt
+  gleich in der N&auml;he, also  lesen wir mal: &quot;Ich soll nicht vergessen
+  die T&uuml;r zu &ouml;ffnen &hellip;&quot;. Damit ist wohl der Trigger gemeint
+  &hellip;  super, die T&uuml;re ist offen. Das war ja einfach.</span>),  
 </li><li>
-  einen Ausgang in den n&auml;chsten Raum 
+  einen Ausgang in den n&auml;chsten Raum
   <br>
-  (<span class="blue">Zwar durch ein Wasserloch blockiert, aber es liegt ja gen&uuml;gend Holz herum - also kein 
-  Problem</span>),
+  (<span class="blue">Zwar durch ein Wasserloch blockiert, aber es liegt ja
+  gen&uuml;gend Holz herum - also kein  Problem</span>),
 </li><li>
   ach ja, fast h&auml;tte ich's vergessen, zwei One-ways
   <br>
@@ -297,16 +294,25 @@
 Taztunes f&uuml;r den Tipp). Also alle, die Probleme damit haben oder an einer
 guten Zeit nicht so interessiert sind oder einfach entspannt ein sch&ouml;nes 
 Level in aller Ruhe spielen wollen, sollten folgendes tun:
-<br>
-<i>Vorsicht, es folgt ein Spoiler!</i><div class="spoiler">Die T&uuml;re mit dem
-Trigger &ouml;ffnen und einen der dort umliegenden  Impulsstein ber&uuml;hren,
-dann <b>warten</b> bis sich die T&uuml;re schlie&szlig;t (der Bolder ist dann
-auf dem Trigger angelangt), jetzt  einfach nochmal auf den Trigger und die
-T&uuml;r &ouml;ffnet sich wieder, fertig (siehe Taztunes' Posting zu &quot;Block
-its way!&quot; vom  26. M&auml;rz 2008 im Forum mag-heut.net).</div><i>Ende des
-Spoilers</i>
 </p>
 
+<p>
+<i>Vorsicht, es folgt ein Spoiler!</i>
+</p>
+
+<div class="spoiler">
+Die T&uuml;re mit dem Trigger &ouml;ffnen und einen der dort umliegenden 
+Impulsstein ber&uuml;hren, dann <b>warten</b> bis sich die T&uuml;re
+schlie&szlig;t (der Bolder ist dann auf dem Trigger angelangt), jetzt  einfach
+nochmal auf den Trigger und die T&uuml;r &ouml;ffnet sich wieder, fertig (siehe
+Taztunes' Posting zu &quot;Block its way!&quot; vom  26. M&auml;rz 2008 im Forum
+mag-heut.net).
+</div>
+
+<p>
+<i>Ende des Spoilers</i>
+</p>
+
 <p>Mir stellen sich dann aber die Fragen, warum hei&szlig;t das Level
 &quot;Block its way!&quot;, warum sollte ich mich &quot;Beeilen!&quot;, wie es 
 auf einem Dokument steht, warum hat das Level einen Speedfaktor von 3? Alles nur

Modified: feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html	2008-06-17 16:42:27 UTC (rev 1179)
+++ feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html	2008-06-17 20:19:59 UTC (rev 1180)
@@ -124,7 +124,6 @@
 ??? ????? ??? ???????????? ????????? ?????:
 </p>
 
-<p>
 <ul>
 <li>
   ????????? ?????????? ???????????? ?????????? ?????? ? ??????????
@@ -167,7 +166,6 @@
   &hellip; ?, ?????, ??? ????? ??????</span>).
 </li>
 </ul>
-</p>
 
 <div class="lotmpic">
 <img src="$$imagedir$$/lotm/lotm_200806_a.jpg" alt="Level of the Month" border="0">
@@ -303,14 +301,24 @@
 ????, ?????? ? ???? ????????? ????????, ??? ??? ???? ?? ????? ??????? ?????????, ???
 ??? ?????? ????? ??????? ?? ??????? ?????? ? ????????????? ?????????, ?????? ?????????
 ?????????:
-<br>
-<i>?????????, ???????!</i><div class="spoiler">???????? ????? ? ??????? ???????? ?
-????????? ?????? ?? ?????????? ??? ?????????? ??????, ????? <b>?????????</b> ????
-????? ?? ????????? (?????? ?????? ????????? ?? ????????), ????? ?????? ??????? ?? ???????
-??? ???, ? ????? ????? ?????????, ?????? (???????? ????????? Taztunes ?
-&quot;Block its way!&quot; ?? 26 ????? 2008 ???? ?? ?????? mag-heut.net).</div><i>????? ????????</i>
 </p>
 
+<p>
+<i>?????????, ???????!</i>
+</p>
+
+<div class="spoiler">
+???????? ????? ? ??????? ???????? ? ????????? ?????? ?? ?????????? ???
+?????????? ??????, ????? <b>?????????</b> ???? ????? ?? ????????? (?????? ??????
+????????? ?? ????????), ????? ?????? ??????? ?? ??????? ??? ???, ? ????? ?????
+?????????, ?????? (???????? ????????? Taztunes ? &quot;Block its way!&quot; ??
+26 ????? 2008 ???? ?? ?????? mag-heut.net).
+</div>
+
+<p>
+<i>????? ????????</i>
+</p>
+
 <p>? ?????? ? ????????? ????, ?????? ??????? ?????????? &quot;Block its
 way!&quot; (&quot;???????? ??? ????&quot;), ?????? ? ?????? &quot;?????????!&quot;, ??? ???????? ? ???????,
 ?????? ??????? ???????? ?????? ????????? 3? ??? ??? ?????? ??? ?????????? ?????????
@@ -318,7 +326,7 @@
 ???? ? ????????)? ???? ??, ? ?? ???? ? ???? ?????? ??????? LOL (*?????*). ? ????? ??????, ? ?
 ??????? ?????? ???? ????. ? ????? ??????? ? ?????? ????????? ????? Kurt'? Tucholsky:
 &quot;??????? ?? ??????? ???????? ???????? ?? ???, ????? ?? ???????: '??????? ????, ? ????? ??? ???
-???????? ???!' &mdash; ?? ????? ??????? ?????? ??? ??????????? ??? ???????? ???.</i>&quot;
+???????? ???!' &mdash; ?? ????? ??????? ?????? ??? ??????????? ??? ???????? ???.&quot;
 </p>
 
 <p>? ??????? ??????? '???????' Jon 'WB' Sneyers ?? ???????, ???????



From andreasl at mail.berlios.de  Tue Jun 17 22:37:35 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Tue, 17 Jun 2008 22:37:35 +0200
Subject: [Enigma-game-svn] r1181 - in homepage: . images/lotm input
	input/lotm
Message-ID: <200806172037.m5HKbZ0n025842@sheep.berlios.de>

Author: andreasl
Date: 2008-06-17 22:37:09 +0200 (Tue, 17 Jun 2008)
New Revision: 1181

Added:
   homepage/images/lotm/lotm_200703_shoki.jpg
   homepage/images/lotm/lotm_200806.png
   homepage/images/lotm/lotm_200806_a.jpg
   homepage/images/lotm/lotm_200806_b.jpg
   homepage/images/lotm/lotm_200806_c.jpg
   homepage/images/lotm/lotm_200806_d.jpg
   homepage/input/lotm/lotm_200806.html
   homepage/input/lotm/lotm_200806_de.html
   homepage/input/lotm/lotm_200806_ru.html
Modified:
   homepage/enigma.css
   homepage/images/lotm/lotm-history.png
   homepage/input/infobox.html
   homepage/input/infobox_de.html
   homepage/input/infobox_ru.html
   homepage/input/lotm/lotm_200703.html
   homepage/input/lotm/lotm_200703_de.html
   homepage/input/lotm/lotm_200703_ru.html
   homepage/input/lotm/lotm_200805.html
   homepage/input/lotm/lotm_200805_de.html
   homepage/input/lotm/lotm_200805_ru.html
   homepage/input/lotm/lotm_archive_data.lua
Log:
Homepage:
 - Merged LotM-feature branch back to homepage.
 - Corrected date in lotm archive.
Todo:
 - Upload


Modified: homepage/enigma.css
===================================================================
--- homepage/enigma.css	2008-06-17 20:19:59 UTC (rev 1180)
+++ homepage/enigma.css	2008-06-17 20:37:09 UTC (rev 1181)
@@ -462,6 +462,18 @@
     background-color: #aaaaaa;
 }
 
+.lotm .blue {
+    color: #0000ff;
+    font-style: italic;
+}
+
+.lotm .spoiler {
+    color: #aaaaaa;
+    background-color: #aaaaaa;
+    padding-left: 1em;
+    padding-right: 1em;
+}
+
 .credits table td {
     padding-right: 1em;
 }

Modified: homepage/images/lotm/lotm-history.png
===================================================================
(Binary files differ)

Copied: homepage/images/lotm/lotm_200703_shoki.jpg (from rev 1180, feature_branches/hp_lotm/images/lotm/lotm_200703_shoki.jpg)

Copied: homepage/images/lotm/lotm_200806.png (from rev 1180, feature_branches/hp_lotm/images/lotm/lotm_200806.png)

Copied: homepage/images/lotm/lotm_200806_a.jpg (from rev 1180, feature_branches/hp_lotm/images/lotm/lotm_200806_a.jpg)

Copied: homepage/images/lotm/lotm_200806_b.jpg (from rev 1180, feature_branches/hp_lotm/images/lotm/lotm_200806_b.jpg)

Copied: homepage/images/lotm/lotm_200806_c.jpg (from rev 1180, feature_branches/hp_lotm/images/lotm/lotm_200806_c.jpg)

Copied: homepage/images/lotm/lotm_200806_d.jpg (from rev 1180, feature_branches/hp_lotm/images/lotm/lotm_200806_d.jpg)

Modified: homepage/input/infobox.html
===================================================================
--- homepage/input/infobox.html	2008-06-17 20:19:59 UTC (rev 1180)
+++ homepage/input/infobox.html	2008-06-17 20:37:09 UTC (rev 1181)
@@ -1,10 +1,12 @@
     <div class="infobody">
        <div class="info">
-         <h3>500,000 Downloads!</h3>
-         In 2 out of 3 statistics, Enigma jumped the 500.000 downloads mark on
-         the Berlios server. This includes downloads from 0.92 up to 1.01.
-         Thanks to all players who made this possible!
-         
+         <h3>Two addenda</h3>
+         We now have a comment from Jacob to his last LotM, you can read
+         it <a href="$$lotm_200805$$#jacob">here</a>. AND, we got a great map
+         of the Level of the Year 2007, <a href="$$lotm_200703$$">&quot;Island
+         Labyrinth&quot;</a>, from Shoki. You can download it
+         <a href="$$imagedir$$/lotm/lotm_200703_shoki.jpg">here</a>.
+
          <h3>Level of the Month</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
          alt="$$lotm_expansion$$" border="0"></a>
@@ -12,12 +14,14 @@
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
          </div>
 
+         <!--
          <h3>April Fool's Day '08</h3>
          <a href="$$april_2008$$"><img src="$$imagedir$$/articles/april_2008.png"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">
            <a href="$$april_2008$$">&quot;The Three Clouds&quot;</a>
          </div>
+         -->
          
          <!--
          <h3>End-of-Year Awards</h3>

Modified: homepage/input/infobox_de.html
===================================================================
--- homepage/input/infobox_de.html	2008-06-17 20:19:59 UTC (rev 1180)
+++ homepage/input/infobox_de.html	2008-06-17 20:37:09 UTC (rev 1181)
@@ -1,10 +1,12 @@
     <div class="infobody">
        <div class="info">
-         <h3>500.000 Downloads!</h3>
-         In zwei von drei Statistiken hat Enigma die
-         500.000-Download-Marke auf dem Berlios-Server &uuml;bersprungen.
-         Dies umfasst Downloads von 0.92 bis 1.01. Vielen Dank an alle Spieler,
-         die dies m&ouml;glich gemacht haben!
+         <h3>Zwei Nachtr&auml;ge</h3>
+         Wir haben nun einen Kommentar von Jacob zu seinem letzten LotM,
+         Sie k&ouml;nnen ihn <a href="$$lotm_200805$$#jacob">hier</a> lesen.
+         UND, wir haben eine gro&szlig;artige Karte vom Level des Jahres 2007,
+         <a href="$$lotm_200703$$">&quot;Island Labyrinth&quot;</a>, von Shoki
+         bekommen. Sie k&ouml;nnen sie <a
+         href="$$imagedir$$/lotm/lotm_200703_shoki.jpg">hier</a> herunterladen.
 
          <h3>Level des Monats</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
@@ -13,12 +15,14 @@
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
          </div>
 
+         <!--
          <h3>Aprilscherz '08</h3>
          <a href="$$april_2008$$"><img src="$$imagedir$$/articles/april_2008.png"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">
            <a href="$$april_2008$$">&quot;The Three Clouds&quot;</a>
          </div>
+         -->
          
          <!--
          <h3>Jahresend-<br>auszeichnungen</h3>

Modified: homepage/input/infobox_ru.html
===================================================================
--- homepage/input/infobox_ru.html	2008-06-17 20:19:59 UTC (rev 1180)
+++ homepage/input/infobox_ru.html	2008-06-17 20:37:09 UTC (rev 1181)
@@ -1,9 +1,10 @@
     <div class="infobody">
        <div class="info">
-         <h3>500,000 ????????!</h3>
-         ? 2 ?? 3 ?????????????? ???????, Enigma ???????? ??????? ? 500.000 ???????? ?
-         ??????? Berlios. ? ??? ?????? ???????? ? ?????? 0.92 ?? 1.01.
-         ??????? ???? ???????, ??????? ??????? ??? ?????????!
+         <h3>??? ??????????</h3>
+         ?????? ? ??? ???? ??????????? ?? Jacob ? ??? ?????????? ??, ??????? ?? ?????? ????????
+         <a href="$$lotm_200805$$#jacob">?????</a>. ? ???, ?? ???????? ?? Shoki, ???????? ?????
+         ?????? ???? 2007, <a href="$$lotm_200703$$">&quot;Island
+         Labyrinth&quot;</a>. ?? ?????? ??????? ?? <a href="$$imagedir$$/lotm/lotm_200703_shoki.jpg">?????</a>.
 
          <h3>??????? ??????</h3>
          <a href="$$lotm_current$$"><img src="$$lotm_current_image$$"
@@ -12,12 +13,14 @@
            <a href="$$lotm_current$$">&quot;$$lotm_current_name$$&quot;</a>
          </div>
 
+         <!--
          <h3>?????? ?????? '08</h3>
          <a href="$$april_2008$$"><img src="$$imagedir$$/articles/april_2008.png"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">
            <a href="$$april_2008$$">&quot;The Three Clouds&quot;</a>
          </div>
+         -->
          
          <!--
          <h3>??????? ????? ????</h3>

Modified: homepage/input/lotm/lotm_200703.html
===================================================================
--- homepage/input/lotm/lotm_200703.html	2008-06-17 20:19:59 UTC (rev 1180)
+++ homepage/input/lotm/lotm_200703.html	2008-06-17 20:37:09 UTC (rev 1181)
@@ -151,4 +151,12 @@
 
   <p>Greets,<br>
   <i>Andreas</i></p>
+  
+  <p>
+  <i>Addendum:</i> Shoki send us a special piece of gamer's art, a full map of
+  &quot;Island Labyrinth&quot;! You find it
+  <a href="$$imagedir$$/lotm/lotm_200703_shoki.jpg">here</a>, many thanks to
+  Shoki for this! (Note the map is a spoiler.)
+  </p>
+
 </div>

Modified: homepage/input/lotm/lotm_200703_de.html
===================================================================
--- homepage/input/lotm/lotm_200703_de.html	2008-06-17 20:19:59 UTC (rev 1180)
+++ homepage/input/lotm/lotm_200703_de.html	2008-06-17 20:37:09 UTC (rev 1181)
@@ -165,4 +165,12 @@
 
   <p>Sch&ouml;ne Gr&uuml;&szlig;e,<br>
   <i>Andreas</i></p>
+
+  <p>
+  <i>Nachtrag:</i> Shoki hat uns ein besonderes St&uuml;ck Spielerkunst
+  zugesendet, eine komplette Karte von &quot;Island Labyrinth&quot;! Sie finden
+  sie <a href="$$imagedir$$/lotm/lotm_200703_shoki.jpg">hier</a>, vielen Dank
+  an Shoki daf&uuml;r! (Vorsicht, die Karte ist nat&uuml;rlich ein Spoiler.)
+  </p>
+
 </div>

Modified: homepage/input/lotm/lotm_200703_ru.html
===================================================================
--- homepage/input/lotm/lotm_200703_ru.html	2008-06-17 20:19:59 UTC (rev 1180)
+++ homepage/input/lotm/lotm_200703_ru.html	2008-06-17 20:37:09 UTC (rev 1181)
@@ -144,4 +144,12 @@
 
   <p>? ?????????,<br>
   <i>Andreas</i></p>
+  
+  <p>
+  <i>??????????:</i> Shoki ??????? ??? ?????? ???????????? ????????? ??????? - ?????? ?????
+  &quot;Island Labyrinth&quot;! ?? ??????? ??
+  <a href="$$imagedir$$/lotm/lotm_200703_shoki.jpg">?????</a>, ???????? ??????? ?? ??? Shoki!
+  (?????? ? ????, ??? ????? ??? ???????.)
+  </p>
+
 </div>

Modified: homepage/input/lotm/lotm_200805.html
===================================================================
--- homepage/input/lotm/lotm_200805.html	2008-06-17 20:19:59 UTC (rev 1180)
+++ homepage/input/lotm/lotm_200805.html	2008-06-17 20:37:09 UTC (rev 1181)
@@ -217,6 +217,42 @@
 in contrast to the other parts adds much to the pleasure of the level
 as a whole.</p>
 
+<h4><a name="jacob">
+With some delay, here are the comments of the author:
+</a></h4>
+
+<div class="quote">I wrote &quot;Pleasure Garden&quot; as my first serious attempt at emulating the
+style of the original Oxyd labyrinths.  Usually they comprised many
+interconnected rooms with no obvious way to complete it, or even what
+to do next.  However, my level started becoming too linear, though I
+did nothing about this.  I was happy just to build a level linking
+together some of my favorite types of puzzles.  Because the level
+became so linear, I ended it with a more reasonable number of
+segments, not quite as large as I had originally planned (I
+constructed levels in the intended style later).</div>
+
+<div class="quote">I wanted to include the types of puzzles I always used to enjoy in the
+Oxyd games: boulder puzzles, bomb puzzles, shogun challenges, and even
+a oneway maze.  I designed the level to be a sort of journey, through
+a bunch of interesting challenges, with one final challenge at the
+end.  As it turns out, there is a way to make this ultimate puzzle a
+little easier, but given the difficulty of the rest of the level (and
+the time required to get that far) I decided not to change it.
+Overall, I wrote it such that each part would be comparable to an easy
+individual level by itself, but that together the different areas
+would mesh together nicely.  For this reason, most of the parts use
+consistent color schemes in fairly open environments.</div>
+
+<div class="quote">I think &quot;Pleasure Garden&quot; turned out fairly well.  At the time I wrote
+it it was probably one of the harder levels I had written (not at all
+true anymore), and it was really an experiment in what I could put
+together into one level without it becoming too much.  Compared to
+some more recent levels (of mine, e.g.), &quot;Pleasure Garden&quot; is fairly
+easy, but I think it still retains its sense of a journey through an
+open, inviting landscape.</div>
+
+<div class="author">Jacob Scott</div>
+
 <p>Definitely &quot;Pleasure Garden&quot; has taken its seat high up in my 
 private Top 10. Many thanks to Jacob Scott for this terrific level.</p>
 

Modified: homepage/input/lotm/lotm_200805_de.html
===================================================================
--- homepage/input/lotm/lotm_200805_de.html	2008-06-17 20:19:59 UTC (rev 1180)
+++ homepage/input/lotm/lotm_200805_de.html	2008-06-17 20:37:09 UTC (rev 1181)
@@ -227,6 +227,50 @@
 Gegenpol zum Rest - diesem meines Erachtens seinen ganz besonderen 
 Reiz.</p>
 
+<h4><a name="jacob">
+Und hier ist, mit etwas Verz&ouml;gerung, der Kommentar des Autors:
+</a></h4>
+
+<div class="quote">&quot;Pleasure Garden&quot; ist das Resultat meines ersten ernsthaften Versuchs, 
+den Stil der Original Oxyd Labyrinthe zu emulieren. Normalerweise 
+bestehen diese aus vielen miteinander verbundenen R&auml;umen, ohne dass 
+zun&auml;chst ersichtlich ist, auf welche Weise der Level gel&ouml;st werden kann,
+oder was der n&auml;chste L&ouml;sungsschritt ist. Der Level begann mir jedoch 
+bald etwas zu linear zu geraten, obwohl das in keiner Weise meine 
+Absicht war. Ich freute mich einfach nur dar&uuml;ber, einen Level zu bauen,
+indem ich verschiedene meiner Lieblingspuzzletypen zusammenf&uuml;gte. Weil
+der Level sich aber so linear entwickelt hatte, beschloss ich, die 
+Anzahl der einzelnen Abschnitte auf ein vern&uuml;nftiges Ma&szlig; zu reduzieren,
+nicht ganz so gro&szlig; wie ich das urspr&uuml;nglich geplant hatte (Level im 
+beabsichtigten Stil habe ich dann sp&auml;ter konstruiert).</div>
+
+<div class="quote">Ich wollte die Typen von Puzzles einbauen, die mir bei den Oxyd Spielen
+immer am meisten Spass gemacht hatten: Boulder Puzzles, Bomben Puzzles, 
+Shogun Challenges, und sogar ein Labyrinth aus Einbahn-Steinen. Ich habe 
+den Level als eine Art Reise angelegt, durch eine Ansammlung von 
+interessanten Aufgaben, mit einer Abschlu&szlig;pr&uuml;fung, die es in sich hat.
+Wie sich mittlerweise herausgestellt hat, gibt es einen Weg, dieses 
+ultimative Puzzle etwas einfacher zu bew&auml;ltigen, aber aufgrund der 
+Schwierigkeit des Levels als Ganzes betrachtet, und der Zeit, die man 
+ben&ouml;tigt, um &uuml;berhaupt erst so weit zu kommen, habe ich beschlossen,
+nichts mehr zu ver&auml;ndern. Insgesamt habe ich den Level so konzipiert, 
+dass jeder Teil f&uuml;r sich allein genommen, einem einzelnen nicht 
+allzu schwierigen Level vergleichbar ist, dass aber die verschiedenen 
+Abschnitte insgesamt auch gut ineinandergreifen. Aus diesem Grund habe
+ich auch f&uuml;r die meisten Abschnitte miteinander in Einklang stehende 
+Farbmuster verwendet, in einer ziemlich offen gestalteten Umgebung.</div>
+
+<div class="quote">Ich denke, &quot;Pleasure Garden&quot; ist mir ganz gut gelungen. Zur Zeit als ich
+es geschrieben habe, war es wahrscheinlich einer der schwersten Level,
+die ich bis dahin verfasst hatte (was jetzt nat&uuml;rlich nicht mehr ganz 
+zutrifft), und es war eigentlich ein Experiment, was ich in einem einzigen
+Level so alles unterbringen k&ouml;nnte, ohne dass es zuviel w&uuml;rde. 
+Verglichen mit einigen aktuelleren Leveln (von meinen eigenen z.B.) ist
+&quot;Pleasure Garden&quot; ziemlich einfach, aber ich finde, es vermittelt immer 
+noch den Eindruck einer Reise durch eine offene und einladende Landschaft.</div>
+
+<div class="author">Jacob Scott</div>
+
 <p>Auf jeden Fall steht Lustgarten in meinen Top 10 gaaanz weit 
 oben. Vielen Dank an Jacob Scott f&uuml;r diesen geilen Level.</p>
 

Modified: homepage/input/lotm/lotm_200805_ru.html
===================================================================
--- homepage/input/lotm/lotm_200805_ru.html	2008-06-17 20:19:59 UTC (rev 1180)
+++ homepage/input/lotm/lotm_200805_ru.html	2008-06-17 20:37:09 UTC (rev 1181)
@@ -81,7 +81,7 @@
 ? ??????? ??? ?? ??????? ????????, ????? ???? ?? ?????????? ??????????
 ? ???????? ??? &quot;????????? ?????&quot;. ?? ????? ??? ??? ?? ???????? ? ????, ?? ??????
 ???????????? ? &quot;????????&quot;. ????, ?????? ???? ? ???????? ??????.
-???????, ? ???? ??????? ???????? ?????, ???????? ?????, ????? ??????
+???????, ? ???? ??????? ???????? ?????, ???????? ?????, ????? ??????
 ???? ?????. ???! ??? ? ??????????, ? ????? ??? ? ?????? ? ????????? ?????,
 ????? ???????? ?????????????, ? ?????? ?????? ????? ???????? ??? ????? ???? ??????.</p>
 
@@ -155,8 +155,8 @@
 <div class="author">Shoki</div>
 
 <p>?? ?????? ? ?????? ????? ????. ??? ???? ???????-??: ????? ??????????
-?????? ?? ????????????? ???? ????? ?? &quot;??????&quot;, ?????????? ? ???.
-? ????????? ? ??? ?? ????????????. ????? ??? ??? ????? ??????,
+?????? ?? ????????????? ???? ?????? ?? &quot;??????&quot;, ?????????? ? ???.
+? ????????? ? ??? ?? ????????????. ????? ??? ??? ????? ??????,
 ????? ??????? ????????? ??????????? ? ????????? ?? ? ?????? ??????????. 
 (???? ??? ??? ????-?? ????? ??????, ?? ?? ????? ??????? ????????????????
 ? &quot;Boulder-Puzzle&quot; (IV - #8) ???? ?? ??????.) ???? ??? ???????? ???????????,
@@ -165,7 +165,7 @@
 ?? ?.) ???????, ? ????? ??? ???????????????.</p>
 
 <p>?????? ?? ???????? ????????? ????? ?????????. ??????, ??????? ? 
-&quot;??????&quot;, ??????? ????????? - ???????? ?????????? ???????
+&quot;??????&quot;, ??????? ????????? - ???????? ?????????? ???????
 ???????? ??????, ?? ???????? ? ????????? (?????? ?????????? ???-?? ?? ??????? ? ???.)
 ????????: ???? ?? ??? ??????????? ?????????? ? ?????? ??????????? ??? ????. ?????
 ??? ?????? &quot;?????&quot; ? ???????, ????? ??????? ???? ?????? ????????????.
@@ -204,13 +204,45 @@
 ? ?? ?? ????????), ??-????? ????????? ????? &quot;Pleasure Garden&quot; ? ??????? ?? ?????????,
 ????????? ??????? ????? ???? ????????????, ??????? ???????? ???? ???????.</p>
 
+<h4><a name="jacob">
+? ????????? ?????????, ???????? ??????????? ?????? ??????:
+</a></h4>
+
+<div class="quote">? ????? &quot;Pleasure Garden&quot; ??????? ??????? ???????? ???????
+? ???????? ????? ???????????? ?????????? Oxyd. ?????? ??? ??????? ?? ?????????
+??????????? ????? ????? ?????? ??? ???????? ???? ??????? ? ???? ??? ?????? ?? ??,
+??? ?????? ??????.  ??????, ??? ??????? ? ?????? ??????? ??????? ????????, ????
+? ?? ??????????? ? ????? ??????? ??????.  ??? ?????????? ???????????? ??? ????
+??????????? ?????????? ???? ??????? ????? ???????????.  ??-?? ????, ??? ??????? ?????
+????? ????????, ? ???????? ??? ??????? ??????? ??????????? ??????, ???? ?? ??????
+?????????, ?????? ? ?????????? ?? ??????? ?????????? (????? ? ?????? ?????? ? ?????? ?????).</div>
+
+<div class="quote">??? ???????? ???????? ??? ???? ???????????, ??????? ??? ?????? ????????? ?
+????? Oxyd: ??????????? ? ?????????, ???????, ??????? ? ???????-????? ? ???? ?????????????
+?????????.  ? ????????????? ??????? ? ???? ??????????? ? ????????? ?????????? ???????????
+? ????? ????????? ????????? ? ????? ????.  ????? ??? ???? ???????, ???????? ?????? ???????
+??? ?????????? ??????????? ??????? ?????, ?? ?????? ????????? ????????? ????? ??????
+(? ?????, ??????????? ??? ??? ??????????), ? ????? ?????? ?? ??????.
+? ?????, ? ??????? ??????? ???, ????? ?????? ????? ???? ?? ???? ???? ??????? ???????, ??
+??? ????????????? ????? ?????? ?? ?????? ???????????.  ??? ????? ?? ???????? ????????????
+? ??????????? ?????? ??????? ???????? ??????????.</div>
+
+<div class="quote">? ?????, &quot;Pleasure Garden&quot; ?????????? ???????? ??????? ???????????.
+??????, ????? ? ???? ??? ??????, ??? ???????, ??? ??? ???? ?? ?????????? ???????, ??????????
+???? (??? ? ???????? ?? ?????), ? ???? ?? ??? ????? ???? ?????????????, ? ??????? ? ????????? ???????
+????????? ???????, ??? ????? ??? ?? ?????????? ????? ??? ?????.  ?? ????????? ? ??????????
+?????????? ???????? (?????, ????????), &quot;Pleasure Garden&quot; ???????? ?????, ??
+? ?????, ?? ??? ??? ????????? ???? ??? ??????????? ?? ????????, ??????? ?????????.</div>
+
+<div class="author">Jacob Scott</div>
+
 <p>??????????? &quot;Pleasure Garden&quot; ????? ???? ??????? ????? ? ???? ?????? Top 10.
 ??????? ??????? Jacob Scott ?? ???? ???????? ???????.</p>
 
 <p><i>NObby</i></p>
 
 <p>????????? ????????, ??? ?????? ????? ???? ?????? ? ??????? ??????? Enigma.
-?????????? ?????????? ??? ????? ??????, ??? ???? ???????????, ??????? ?? ???????? ?? ?????????? ??????:</p>
+?????????? ?????????? ??? ????? ??????, ??? ???? ???????????, ??????? ?? ???????? ?? ?????????? ??????:</p>
 <pre>
 <a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
 </pre>

Copied: homepage/input/lotm/lotm_200806.html (from rev 1180, feature_branches/hp_lotm/input/lotm/lotm_200806.html)

Copied: homepage/input/lotm/lotm_200806_de.html (from rev 1180, feature_branches/hp_lotm/input/lotm/lotm_200806_de.html)

Copied: homepage/input/lotm/lotm_200806_ru.html (from rev 1180, feature_branches/hp_lotm/input/lotm/lotm_200806_ru.html)

Modified: homepage/input/lotm/lotm_archive_data.lua
===================================================================
--- homepage/input/lotm/lotm_archive_data.lua	2008-06-17 20:19:59 UTC (rev 1180)
+++ homepage/input/lotm/lotm_archive_data.lua	2008-06-17 20:37:09 UTC (rev 1181)
@@ -130,11 +130,20 @@
   position_num   = "6095"
 }
 
+lotm_archive_data[15] = {
+  date           = { month = 6, year = 2008 },
+  chronological  = 15,
+  name           = "Block its way!",
+  author         = "Jon 'WB' Sneyers",
+  position       = "III/66",
+  position_num   = "3066"
+}
+
 -- LotM variable data
 -- format: Level Title, current_rating, current_votes, additional text
 
-lotm_rating(    "Island Labyrinth",  9.31,  13,  "(1 up)")
-lotm_rating(  "Pneumatic Delivery",  8.19,  16,  "(1 up)")
+lotm_rating(    "Island Labyrinth",  9.31,  13,  "")
+lotm_rating(  "Pneumatic Delivery",  8.19,  16,  "")
 lotm_rating(    "The Aztec Temple",  9.00,  11,  "")
 lotm_rating("Labyrinth of Puzzles",  8.82,  17,  "")
 lotm_rating(           "Elaborate",  8.50,  10,  "")
@@ -142,15 +151,16 @@
 lotm_rating(           "Tool Time",  8.52,  21,  "")
 lotm_rating(         "Quadropolis",  9.20,  10,  "")
 lotm_rating(      "Big Adventures",  8.42,  24,  "")
-lotm_rating(      "Temple of Gold",  9.29,   7,  "(1 down)")
+lotm_rating(      "Temple of Gold",  9.29,   7,  "")
 lotm_rating(      "Puzzle Puzzles",  8.83,   6,  "")
-lotm_rating(      "Psycho Pushing",  8.18,  11,  "(1 down)")
+lotm_rating(      "Psycho Pushing",  8.18,  11,  "")
 lotm_rating(  "Turnstiles for Two",  9.00,   5,  "")
-lotm_rating(     "Pleasure Garden",  8.43,  14,  "<b>(newcomer)</b>")
+lotm_rating(     "Pleasure Garden",  8.43,  14,  "")
+lotm_rating(      "Block its way!",  8.00,  16,  "<b>(newcomer)</b>")
 
 -- Don't forget to adjust the archive dates:
 
-lotm_archive_data_from = { month = 4, year = 2008 }
+lotm_archive_data_from = { month = 5, year = 2008 }
 
 lotm_current = lotm_archive_data[table.getn(lotm_archive_data)]
 



From andreasl at mail.berlios.de  Tue Jun 17 22:54:40 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Tue, 17 Jun 2008 22:54:40 +0200
Subject: [Enigma-game-svn] r1182 - in feature_branches/hp_lotm: images input
	input/lotm
Message-ID: <200806172054.m5HKseZp027572@sheep.berlios.de>

Author: andreasl
Date: 2008-06-17 22:54:25 +0200 (Tue, 17 Jun 2008)
New Revision: 1182

Added:
   feature_branches/hp_lotm/input/hp_archive.html
   feature_branches/hp_lotm/input/hp_archive_de.html
   feature_branches/hp_lotm/input/hp_archive_ru.html
   feature_branches/hp_lotm/input/top_news.html
   feature_branches/hp_lotm/input/top_news_de.html
   feature_branches/hp_lotm/input/top_news_ru.html
Modified:
   feature_branches/hp_lotm/images/menu_bg.jpg
   feature_branches/hp_lotm/input/faq_core.html
   feature_branches/hp_lotm/input/faq_core_de.html
   feature_branches/hp_lotm/input/faq_core_ru.html
   feature_branches/hp_lotm/input/faq_questions.html
   feature_branches/hp_lotm/input/faq_questions_de.html
   feature_branches/hp_lotm/input/faq_questions_ru.html
   feature_branches/hp_lotm/input/infobox_ru.html
   feature_branches/hp_lotm/input/lotm/lotm_200805.html
   feature_branches/hp_lotm/input/lotm/lotm_200805_de.html
   feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html
   feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua
   feature_branches/hp_lotm/input/menu.html
   feature_branches/hp_lotm/input/menu_de.html
   feature_branches/hp_lotm/input/menu_ru.html
   feature_branches/hp_lotm/input/output-files.lua
   feature_branches/hp_lotm/input/stat-other.html
   feature_branches/hp_lotm/input/table-hcp.html
   feature_branches/hp_lotm/input/table-rat.html
   feature_branches/hp_lotm/input/table-solved.html
   feature_branches/hp_lotm/input/table-wr.html
   feature_branches/hp_lotm/input/userlist.html
Log:
LotM Feature branch:
 - Merged homepage back to feature branch,
   they are now synchronous.


Modified: feature_branches/hp_lotm/images/menu_bg.jpg
===================================================================
(Binary files differ)

Modified: feature_branches/hp_lotm/input/faq_core.html
===================================================================
--- feature_branches/hp_lotm/input/faq_core.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/faq_core.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -166,6 +166,15 @@
 </p>
 
 
+<h4><a name="s2q10">I use Linux. While playing Enigma, xmms (or any other music
+player) doesn't work, or Enigma doesn't have sound.</a></h4>
+<p>
+Your music player should use ALSA instead of OSS. In case of xmms: Right-click,
+&quot;Options&quot;, &quot;Preferences&quot;, &quot;Audio I/O Plugins&quot;,
+&quot;Output Plugin&quot;: Choose ALSA, if possible.
+</p>
+
+
 <h4><a name="s2q4">When I enter a level pack, it takes so long to load the images?</a></h4>
 <p>This happens only the first time you start Enigma, and only
 if no thumbnails had been downloaded with Enigma. It's normal

Modified: feature_branches/hp_lotm/input/faq_core_de.html
===================================================================
--- feature_branches/hp_lotm/input/faq_core_de.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/faq_core_de.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -40,7 +40,7 @@
 
 <h4><a name="s1q3">Wie mache ich ein Update f&uuml;r Enigma?</a></h4>
 <p>Im Grunde gibt es drei Arten von Updates: Die Weltrekordliste
-(bzw. Spielergebnisse oder Statistiken), die Level und das Programm.</p>
+(bzw. Spielergebnisse oder Statistiken), die Levels und das Programm.</p>
 <ul>
 <li>
 Enigma erneuert seine Statistiken automatisch, falls Sie im Optionsmen&uuml; die
@@ -96,7 +96,7 @@
 </p><p>
 Beachten Sie bitte, dass der Level fehlerhaft sein kann. Falls dem so ist,
 wird sich Enigma beim Programmstart dar&uuml;ber beschweren. In diesem Fall kann es
-sinnvoll sein, die Level aus dem &quot;levels/auto&quot;-Verzeichnis wieder zu
+sinnvoll sein, den Level aus dem &quot;levels/auto&quot;-Verzeichnis wieder zu
 entfernen.</p>
 
 
@@ -183,6 +183,17 @@
 </p>
 
 
+<h4><a name="s2q10">Ich benutze Linux. W&auml;hrend ich Enigma spiele,
+funktioniert xmms (oder irgend ein anderer Musicplayer) nicht, oder
+Enigma hat keinen Sound.</a></h4>
+<p>
+Ihr Musicplayer sollte ALSA anstelle von OSS benutzen. Im Falle von xmms:
+Rechts-Klick, &quot;Optionen&quot;, &quot;Einstellungen&quot;,
+&quot;Audio-I/O-Plugins&quot;, &quot;Ausgabe-Plugin&quot;: W&auml;hlen Sie
+ALSA, wenn m&ouml;glich.
+</p>
+
+
 <h4><a name="s2q4">Wenn ich ein Levelpaket &ouml;ffne, dauert es so lange, bis die Bilder geladen
 sind?</a></h4>
 <p>Das geschieht nur zu Beginn, und auch nur, wenn Sie keine Vorschaubilder
@@ -271,7 +282,7 @@
 einige Zeit diese Level gespielt haben, sollten Sie am besten mit dem
 Levelpack &quot;Enigma I&quot; beginnen und sich dann langsam durch die
 Levelpacks spielen. Nat&uuml;rlich k&ouml;nnen Sie auch mit einem anderen Levelpack
-anfangen, aber die Level sind so geordnet, dass nicht zu viele neue
+anfangen, aber die Levels sind so geordnet, dass nicht zu viele neue
 Spielobjekte auf einmal eingef&uuml;hrt werden.</p>
 
 
@@ -368,7 +379,7 @@
 entfernen Sie die Datei &quot;enigma.score&quot;. Sie wollen dann vielleicht
 auch Ihre 0.92-Ergebnisse l&ouml;schen oder umbenennen (&quot;enigmarc.lua2&quot;).
 Bitte bedenken Sie, dass mit dem L&ouml;schen der Datei &quot;enigma.score&quot;
-auch alle Ihre pers&ouml;nlichen Bewertungen von Levlen verloren gehen!</p>
+auch alle Ihre pers&ouml;nlichen Bewertungen von Leveln verloren gehen!</p>
 
 
 <h4><a name="s3q9">Ich habe einen Level gesehen und m&ouml;chte ihn nochmal spielen; aber ich habe
@@ -399,7 +410,7 @@
 
 <h4><a name="s3q11">Darf ich auch Spielergebnisse einsenden, die mit Version 0.92 erreicht
 wurden?</a></h4>
-<p>Ja. Alle Ergebnisse, die inkompatibel zur 1.00-Version der Levels sind
+<p>Ja. Alle Ergebnisse, die inkompatibel zur 1.00-Version der Levels sind,
 werden nicht in der Statistik ber&uuml;cksichtigt. Sie werden ein kleines rotes
 Dreieck bei solchen Levels im Levelmen&uuml; bemerken. Wenn Sie diese Level mit
 1.00 l&ouml;sen, werden Ihre neuen Ergebnisse das n&auml;chste Mal registriert.</p>
@@ -414,8 +425,8 @@
 Ihnen vielleicht Tipps.</p>
 
 
-<h4><a name="s3q13">Ich hatte einen Weltrekord f&uuml;r eine Level. Nach einem Neustart von Enigma
-ist er verschwunden!</a></h4>
+<h4><a name="s3q13">Ich hatte einen Weltrekord f&uuml;r einen Level. Nach einem
+Neustart von Enigma ist er verschwunden!</a></h4>
 <p>Ihr Spielergebnis ist nach wie vor derselbe. Aber Sie konkurrieren mit
 anderen Spielern weltweit um die besten Ergebnisse. Wenn Sie die &quot;Update
 Bewertungen&quot;-Einstellung auf &quot;Autom.&quot; gestellt haben, wird
@@ -445,9 +456,9 @@
 href="http://www.mag-heut.net/blackball/index.php"
 >http://www.mag-heut.net/</a>.</li>
 
-<li>Sie k&ouml;nnen neue Level schreiben und uns schicken oder auf
+<li>Sie k&ouml;nnen neue Levels schreiben und uns schicken oder auf
 <a href="http://www.mag-heut.net/blackball/index.php"
->http://www.mag-heut.net/</a> posten; vgl. &quot;Wie kann ich eine Level f&uuml;r
+>http://www.mag-heut.net/</a> posten; vgl. &quot;Wie kann ich einen Level f&uuml;r
 Enigma schreiben?&quot;</li>
 
 <li>Sie k&ouml;nnen Enigma in andere Sprachen &uuml;bersetzen. Das ben&ouml;tigt einige
@@ -475,7 +486,7 @@
 href="#s4q1">Aufgaben</a> helfen.</p>
 
 
-<h4><a name="s4q3">Wie kann ich eine Level f&uuml;r Enigma schreiben?</a></h4>
+<h4><a name="s4q3">Wie kann ich einen Level f&uuml;r Enigma schreiben?</a></h4>
 <p>Lesen Sie dazu das <a href="$$refman$$">Referenz-Handbuch</a>, besuchen Sie
 <a href="http://www.mag-heut.net" >mag-heut.net</a> oder studieren Sie
 existierende Level; diese befinden sich im Unterverzeichnis
@@ -506,7 +517,7 @@
 >http://www.capkoh.narod.ru/SL_MainPage.html</a>.</p>
 
 
-<h4><a name="s4q5">Ich habe neue Level geschrieben, w&uuml;rdet ihr sie in Enigma einbinden?</a></h4>
+<h4><a name="s4q5">Ich habe neue Levels geschrieben, w&uuml;rdet ihr sie in Enigma einbinden?</a></h4>
 <p>Ja, das werden wir gerne. Bitte senden Sie uns eine Email an die
 Entwickler-Mailing-Liste, wenn Sie gerne Ihre Level mit anderen teilen
 m&ouml;chten. Die Mailing-Liste hat ein Limit von 300k, also fragen Sie bitte vorher
@@ -517,10 +528,10 @@
 wurden.</p>
 
 
-<h4><a name="s4q6">Ich m&ouml;chte ein Objekt in meiner neuen Level verwenden, aber kenne nicht
+<h4><a name="s4q6">Ich m&ouml;chte ein Objekt in meinem neuen Level verwenden, aber kenne nicht
 seinen Namen.</a></h4>
 <p>Besuchen Sie hierf&uuml;r das Enigma Wiki auf
-<a href="$$wiki$$" >$$wiki$$</a> oder analysieren Sie eine Level, in der das
+<a href="$$wiki$$" >$$wiki$$</a> oder analysieren Sie einen Level, in der das
 Objekt erscheint.</p>
 
 
@@ -580,7 +591,7 @@
 <ul>
 <li>Es muss neue Aspekte ins Spiel bringen, die bisher nicht durch andere Objekte
 abgedeckt sind.</li>
-<li>Es muss gut f&uuml;r neue Level sein und sollte m&ouml;glichst viele Level
+<li>Es muss gut f&uuml;r neue Levels sein und sollte m&ouml;glichst viele Levels
 inspirieren.</li>
 <li>Es muss wohl definiert in seinem Verhalten bez&uuml;glich allen anderen
 bereits bestenenden Objekten sein.</li>

Modified: feature_branches/hp_lotm/input/faq_core_ru.html
===================================================================
--- feature_branches/hp_lotm/input/faq_core_ru.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/faq_core_ru.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -155,6 +155,15 @@
 </p>
 
 
+<h4><a name="s2q10">? ????????? Linux. ?? ????? ???? ? Enigma, xmms (??? ????? ?????? ??????????? ?????????????) ?? ????????
+    ??? ??? ????? ? Enigma.</a></h4>
+<p>
+??? ??????????? ????????????? ?????? ???????????? ALSA, ? ?? OSS. ??? xmms: ???????? ?????? ???????,
+&quot;?????????(Options)&quot;, &quot;????????(Preferences)&quot;, &quot;?????????? ?????-?????? ?????(Audio I/O Plugins)&quot;,
+&quot;?????????? ??? ??????(Output Plugin)&quot;: ???? ? ?????? ???? ALSA, ?? ???????? ??.
+</p>
+
+
 <h4><a name="s2q4">??????, ????? ? ??????? ????? ???????, ??????????? ??????????? ??? ??????</a></h4>
 <p>??? ?????????? ?????? ??? ?????? ??????? Enigma, ? ?????? 
 ???? ? Enigma ?? ???? ????????? ??????. ??? ?????????

Modified: feature_branches/hp_lotm/input/faq_questions.html
===================================================================
--- feature_branches/hp_lotm/input/faq_questions.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/faq_questions.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -53,6 +53,10 @@
     I use Kaspersky Internet Security 7.0. When I start Enigma,
     it says &quot;Keylogger found&quot;.</a></li>
 
+    <li><a href="$$faq$$#s2q10">
+    I use Linux. While playing Enigma, xmms (or any other music player) doesn't
+    work, or Enigma doesn't have sound.</a></li>
+
     <li><a href="$$faq$$#s2q4">
     When I enter a level pack, it takes so long to load the images?</a></li>
 

Modified: feature_branches/hp_lotm/input/faq_questions_de.html
===================================================================
--- feature_branches/hp_lotm/input/faq_questions_de.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/faq_questions_de.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -55,6 +55,10 @@
     Ich benutze Kaspersky Internet Security 7.0. Wenn ich Enigma starte, kommt
     &quot;Keylogger gefunden&quot;.</a></li> 
 
+    <li><a href="$$faq$$#s2q10">
+    Ich benutze Linux. W&auml;hrend ich Enigma spiele, funktioniert xmms (oder
+    irgend ein anderer Musicplayer) nicht, oder Enigma hat keinen Sound.</a></li>
+
     <li><a href="$$faq$$#s2q4">
     Wenn ich ein Levelpaket &ouml;ffne, dauert es so lange, bis die Bilder
     geladen sind?</a></li> 

Modified: feature_branches/hp_lotm/input/faq_questions_ru.html
===================================================================
--- feature_branches/hp_lotm/input/faq_questions_ru.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/faq_questions_ru.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -25,7 +25,7 @@
     ? ????????? ? ????? ??????? ??? Enigma ? ???? ??????? ?? ??? &#8230;</a></li>
 
     <li><a href="$$faq$$#s1q7">
-    ??? ? ???? ??????? ?? ??????? Sokoban ????? ?????????</a></li>
+    ??? ? ???? ??????? ?? ??????? ???????? ????? ?????????</a></li>
 
 </ul><li><a href="$$faq$$#section2" name="index_section2">?????? Enigma</a><ul>
 
@@ -51,6 +51,10 @@
     ? ????????? Kaspersky Internet Security 7.0. ????? ? ???????? Enigma,
     ?? ???????? &quot;Keylogger found&quot;.</a></li>
 
+    <li><a href="$$faq$$#s2q10">
+    ? ????????? Linux. ?? ????? ???? ? Enigma, xmms (??? ????? ?????? ??????????? ?????????????) ?? ????????
+    ??? ??? ????? ? Enigma.</a></li>
+
     <li><a href="$$faq$$#s2q4">
     ??????, ????? ? ??????? ????? ???????, ??????????? ??????????? ??? ??????</a></li>
 

Copied: feature_branches/hp_lotm/input/hp_archive.html (from rev 1181, homepage/input/hp_archive.html)

Copied: feature_branches/hp_lotm/input/hp_archive_de.html (from rev 1181, homepage/input/hp_archive_de.html)

Copied: feature_branches/hp_lotm/input/hp_archive_ru.html (from rev 1181, homepage/input/hp_archive_ru.html)

Modified: feature_branches/hp_lotm/input/infobox_ru.html
===================================================================
--- feature_branches/hp_lotm/input/infobox_ru.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/infobox_ru.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -14,7 +14,7 @@
          </div>
 
          <!--
-         <h3>April Fool's Day '08</h3>
+         <h3>?????? ?????? '08</h3>
          <a href="$$april_2008$$"><img src="$$imagedir$$/articles/april_2008.png"
          alt="$$lotm_expansion$$" border="0"></a>
          <div class="imagetitle">

Modified: feature_branches/hp_lotm/input/lotm/lotm_200805.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -270,6 +270,7 @@
 <li>&quot;Industrial Puzzles&quot; by Raoul Bourquin</li>
 <li>&quot;Plan Ahead&quot; by Jacob Scott</li>
 <li>&quot;Block its way!&quot; by Jon 'WB' Sneyers</li>
+<li>&quot;River of Challenges&quot; by Lukas Sch&uuml;ller</li>
 </ul>
 <p>Many thanks in advance, only your help can keep the LotM alive!</p>
 

Modified: feature_branches/hp_lotm/input/lotm/lotm_200805_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805_de.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805_de.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -289,6 +289,7 @@
 <li>&quot;Industrial Puzzles&quot; von Raoul Bourquin</li>
 <li>&quot;Plan Ahead&quot; von Jacob Scott</li>
 <li>&quot;Block its way!&quot; von Jon 'WB' Sneyers</li>
+<li>&quot;River of Challenges&quot; von Lukas Sch&uuml;ller</li>
 </ul>
 <p>Vielen Dank im voraus, nur Ihre Mithilfe kann den LdM am Leben erhalten!</p>
 

Modified: feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -253,6 +253,7 @@
 <li>&quot;Industrial Puzzles&quot; ?? Raoul Bourquin</li>
 <li>&quot;Plan Ahead&quot; ?? Jacob Scott</li>
 <li>&quot;Block its way!&quot; ?? Jon 'WB' Sneyers</li>
+<li>&quot;River of Challenges&quot; ?? Lukas Sch&uuml;ller</li>
 </ul>
 <p>??????? ??????? ???????, ?????? ???? ?????? ???????? ????????? ?????? ??!</p>
 

Modified: feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua	2008-06-17 20:54:25 UTC (rev 1182)
@@ -160,7 +160,7 @@
 
 -- Don't forget to adjust the archive dates:
 
-lotm_archive_data_from = { month = 3, year = 2008 }
+lotm_archive_data_from = { month = 5, year = 2008 }
 
 lotm_current = lotm_archive_data[table.getn(lotm_archive_data)]
 

Modified: feature_branches/hp_lotm/input/menu.html
===================================================================
--- feature_branches/hp_lotm/input/menu.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/menu.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -1,4 +1,8 @@
     <div class="menu">
+      <!--<ul class="mlist">
+        <li><a href="$$index$$">Home</a>
+        </li>
+      </ul>-->
       <ul class="mlist">
         <li><a href="$$about$$">About</a>
           <ul>
@@ -6,6 +10,7 @@
             <li><a href="$$about$$#testimonials">Testimonials<br>
               <span class="menusubtitle">User Comments</span></a></li>
             <li><a href="$$news$$">News and Olds</a></li>
+            <li><a href="$$hp_archive$$">Homepage Archive</a></li>
             <li><a href="$$screenshots$$">Screenshots</a></li>
             <li><a href="$$credits$$">Credits</a></li>
           </ul>

Modified: feature_branches/hp_lotm/input/menu_de.html
===================================================================
--- feature_branches/hp_lotm/input/menu_de.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/menu_de.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -6,6 +6,7 @@
             <li><a href="$$about$$#testimonials">Meinungen<br>
               <span class="menusubtitle">von Spielern</span></a></li>
             <li><a href="$$news$$">Neues und Altes</a></li>
+            <li><a href="$$hp_archive$$">Homepage-Archiv</a></li>
             <li><a href="$$screenshots$$">Schnappsch&uuml;sse</a></li>
             <li><a href="$$credits$$">Danksagungen</a></li>
           </ul>

Modified: feature_branches/hp_lotm/input/menu_ru.html
===================================================================
--- feature_branches/hp_lotm/input/menu_ru.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/menu_ru.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -6,6 +6,7 @@
             <li><a href="about_ru.html#testimonials">??????<br>
               <span class="menusubtitle">??????????? ?????????????</span></a></li>
             <li><a href="news_ru.html">??????? ? ?????</a></li>
+            <li><a href="$$hp_archive$$">????? ???????? ????????</a></li>
             <li><a href="screenshots_ru.html">?????????</a></li>
             <li><a href="credits_ru.html">?????????????</a></li>
           </ul>

Modified: feature_branches/hp_lotm/input/output-files.lua
===================================================================
--- feature_branches/hp_lotm/input/output-files.lua	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/output-files.lua	2008-06-17 20:54:25 UTC (rev 1182)
@@ -457,10 +457,22 @@
 --------------------------------------------------------------------------------
 
 ----------------------------------------------------------------------
--- Remaining Articles
+-- Homepage Archiv
 ----------------------------------------------------------------------
+html.hp_archive = {
+    outfile = "hp_archive.html",
+    title = "Homepage Archive",
+    title_de = "Homepage-Archiv",
+    title_ru = "????? ???????? ????????",
+    --es-- title_es = "Homepage Archive",
+    body = {"hp_archive", "top_news"}
+}
 
 ----------------------------------------------------------------------
+-- Special Articles
+----------------------------------------------------------------------
+
+----------------------------------------------------------------------
 -- End of Year Awards 2007
 ----------------------------------------------------------------------
 html.eoya_2007 = {

Modified: feature_branches/hp_lotm/input/stat-other.html
===================================================================
--- feature_branches/hp_lotm/input/stat-other.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/stat-other.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -1,22 +1,22 @@
   <div class="stat-help">
     <h3>$$Other_Statistics$$</h3>
     <h4>$$Scores$$</h4>
-      75496 $$single_level_scores$$.
+      77764 $$single_level_scores$$.
     <h4>$$Ratings$$</h4>
-      14014 $$single_level_ratings$$ 4.90 $$and_distribution$$: 
+      14496 $$single_level_ratings$$ 4.90 $$and_distribution$$: 
       <table>
         <colgroup><col width="80"><col width="80"></colgroup>
         <tr><th>$$rating$$</th><th>$$count$$</th></tr>
-        <tr><td class="num">0</td><td class="num">58</td></tr>
-        <tr><td class="num">1</td><td class="num">269</td></tr>
-        <tr><td class="num">2</td><td class="num">731</td></tr>
-        <tr><td class="num">3</td><td class="num">2015</td></tr>
-        <tr><td class="num">4</td><td class="num">2679</td></tr>
-        <tr><td class="num">5</td><td class="num">3347</td></tr>
-        <tr><td class="num">6</td><td class="num">2344</td></tr>
-        <tr><td class="num">7</td><td class="num">1616</td></tr>
-        <tr><td class="num">8</td><td class="num">607</td></tr>
-        <tr><td class="num">9</td><td class="num">238</td></tr>
-        <tr><td class="num">10</td><td class="num">110</td></tr>
+        <tr><td class="num">0</td><td class="num">84</td></tr>
+        <tr><td class="num">1</td><td class="num">283</td></tr>
+        <tr><td class="num">2</td><td class="num">780</td></tr>
+        <tr><td class="num">3</td><td class="num">2059</td></tr>
+        <tr><td class="num">4</td><td class="num">2736</td></tr>
+        <tr><td class="num">5</td><td class="num">3445</td></tr>
+        <tr><td class="num">6</td><td class="num">2408</td></tr>
+        <tr><td class="num">7</td><td class="num">1667</td></tr>
+        <tr><td class="num">8</td><td class="num">654</td></tr>
+        <tr><td class="num">9</td><td class="num">261</td></tr>
+        <tr><td class="num">10</td><td class="num">119</td></tr>
       </table>
   </div>

Modified: feature_branches/hp_lotm/input/table-hcp.html
===================================================================
--- feature_branches/hp_lotm/input/table-hcp.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/table-hcp.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -1,143 +1,155 @@
   <table>
-    <caption>$$Handicap_Statistics$$ $$March$$ 2008</caption>
+    <caption>$$Handicap_Statistics$$ $$May$$ 2008</caption>
     <colgroup><col width="130"><col width="220"></colgroup>
     <tr><th>$$solved_hcp$$</th><th class="left">$$user$$</th></tr>
-     <tr><td class="num">-143.6</td><td class="left">'Moneymaker'</td></tr>
-     <tr><td class="num"> -82.6</td><td class="left">'Johannes'</td></tr>
-     <tr><td class="num"> -82.4</td><td class="left">'Stupid'</td></tr>
-     <tr><td class="num"> -71.3</td><td class="left">'daydreamer'</td></tr>
-     <tr><td class="num"> -71.0</td><td class="left">'Great Scott'</td></tr>
-     <tr><td class="num"> -60.9</td><td class="left">'Duffy'</td></tr>
-     <tr><td class="num"> -59.5</td><td class="left">'Malla'</td></tr>
-     <tr><td class="num"> -52.8</td><td class="left">'ryujun'</td></tr>
-     <tr><td class="num"> -49.0</td><td class="left">'Django'</td></tr>
-     <tr><td class="num"> -43.6</td><td class="left">'Gloop'</td></tr>
-     <tr><td class="num"> -42.4</td><td class="left">'Alexandros'</td></tr>
-     <tr><td class="num"> -41.6</td><td class="left">'dev0'</td></tr>
-     <tr><td class="num"> -40.5</td><td class="left">'Taztunes'</td></tr>
-     <tr><td class="num"> -37.1</td><td class="left">'Safalra'</td></tr>
-     <tr><td class="num"> -31.7</td><td class="left">'B-Huff'</td></tr>
-     <tr><td class="num"> -30.8</td><td class="left">'Ludmian'</td></tr>
-     <tr><td class="num"> -27.0</td><td class="left">'Zekobah'</td></tr>
-     <tr><td class="num"> -27.0</td><td class="left">'bojster'</td></tr>
-     <tr><td class="num"> -23.3</td><td class="left">'hendrik'</td></tr>
-     <tr><td class="num"> -21.6</td><td class="left">'ABS'</td></tr>
-     <tr><td class="num"> -20.7</td><td class="left">'ged'</td></tr>
-     <tr><td class="num"> -19.8</td><td class="left">'dpl'</td></tr>
-     <tr><td class="num"> -19.5</td><td class="left">'Raoul'</td></tr>
-     <tr><td class="num"> -18.9</td><td class="left">'Emmanuel'</td></tr>
-     <tr><td class="num"> -16.2</td><td class="left">'Ronald'</td></tr>
-     <tr><td class="num"> -15.7</td><td class="left">'Ghatotkacha'</td></tr>
-     <tr><td class="num"> -12.3</td><td class="left">'Lukas'</td></tr>
-     <tr><td class="num"> -11.5</td><td class="left">'HuB34'</td></tr>
-     <tr><td class="num"> -11.1</td><td class="left">'Daisy'</td></tr>
-     <tr><td class="num">  -8.2</td><td class="left">'joseba'</td></tr>
-     <tr><td class="num">  -8.1</td><td class="left">'Iceshark7'</td></tr>
-     <tr><td class="num">  -4.3</td><td class="left">'Daniel'</td></tr>
-     <tr><td class="num">  -3.0</td><td class="left">'fabian'</td></tr>
-     <tr><td class="num">  -1.5</td><td class="left">'Craven'</td></tr>
-     <tr><td class="num">  -1.2</td><td class="left">'JuSt'</td></tr>
-     <tr><td class="num">  -1.0</td><td class="left">'Wuzzy'</td></tr>
-     <tr><td class="num">   1.5</td><td class="left">'para_doks'</td></tr>
-     <tr><td class="num">   1.7</td><td class="left">'Tobias'</td></tr>
-     <tr><td class="num">   2.6</td><td class="left">'Guglielmo'</td></tr>
+     <tr><td class="num">-143.8</td><td class="left">'Moneymaker'</td></tr>
+     <tr><td class="num"> -81.8</td><td class="left">'Johannes'</td></tr>
+     <tr><td class="num"> -81.6</td><td class="left">'Stupid'</td></tr>
+     <tr><td class="num"> -75.4</td><td class="left">'daydreamer'</td></tr>
+     <tr><td class="num"> -70.3</td><td class="left">'Great Scott'</td></tr>
+     <tr><td class="num"> -60.1</td><td class="left">'Duffy'</td></tr>
+     <tr><td class="num"> -58.7</td><td class="left">'Malla'</td></tr>
+     <tr><td class="num"> -54.0</td><td class="left">'ryujun'</td></tr>
+     <tr><td class="num"> -51.1</td><td class="left">'dev0'</td></tr>
+     <tr><td class="num"> -48.2</td><td class="left">'Django'</td></tr>
+     <tr><td class="num"> -42.8</td><td class="left">'Gloop'</td></tr>
+     <tr><td class="num"> -42.0</td><td class="left">'Alexandros'</td></tr>
+     <tr><td class="num"> -39.6</td><td class="left">'Taztunes'</td></tr>
+     <tr><td class="num"> -36.4</td><td class="left">'Safalra'</td></tr>
+     <tr><td class="num"> -31.1</td><td class="left">'B-Huff'</td></tr>
+     <tr><td class="num"> -30.9</td><td class="left">'Ludmian'</td></tr>
+     <tr><td class="num"> -28.6</td><td class="left">'Zekobah'</td></tr>
+     <tr><td class="num"> -26.3</td><td class="left">'bojster'</td></tr>
+     <tr><td class="num"> -24.1</td><td class="left">'ged'</td></tr>
+     <tr><td class="num"> -22.5</td><td class="left">'hendrik'</td></tr>
+     <tr><td class="num"> -22.4</td><td class="left">'Emmanuel'</td></tr>
+     <tr><td class="num"> -21.0</td><td class="left">'ABS'</td></tr>
+     <tr><td class="num"> -20.9</td><td class="left">'dpl'</td></tr>
+     <tr><td class="num"> -18.9</td><td class="left">'Raoul'</td></tr>
+     <tr><td class="num"> -15.6</td><td class="left">'Ronald'</td></tr>
+     <tr><td class="num"> -15.2</td><td class="left">'Ghatotkacha'</td></tr>
+     <tr><td class="num"> -11.8</td><td class="left">'Daisy'</td></tr>
+     <tr><td class="num"> -11.8</td><td class="left">'Lukas'</td></tr>
+     <tr><td class="num"> -11.0</td><td class="left">'HuB34'</td></tr>
+     <tr><td class="num">  -7.9</td><td class="left">'joseba'</td></tr>
+     <tr><td class="num">  -7.7</td><td class="left">'Iceshark7'</td></tr>
+     <tr><td class="num">  -3.7</td><td class="left">'Daniel'</td></tr>
+     <tr><td class="num">  -2.4</td><td class="left">'fabian'</td></tr>
+     <tr><td class="num">  -1.0</td><td class="left">'Craven'</td></tr>
+     <tr><td class="num">  -0.8</td><td class="left">'JuSt'</td></tr>
+     <tr><td class="num">  -0.7</td><td class="left">'Wuzzy'</td></tr>
+     <tr><td class="num">   0.0</td><td class="left">'Freshman'</td></tr>
+     <tr><td class="num">   0.7</td><td class="left">'mrduke'</td></tr>
+     <tr><td class="num">   1.9</td><td class="left">'para_doks'</td></tr>
+     <tr><td class="num">   2.2</td><td class="left">'Tobias'</td></tr>
+     <tr><td class="num">   3.0</td><td class="left">'Guglielmo'</td></tr>
      <tr><td class="num">   3.7</td><td class="left">'Kevin'</td></tr>
-     <tr><td class="num">   3.7</td><td class="left">'U-Punkt'</td></tr>
-     <tr><td class="num">   4.0</td><td class="left">'Andy'</td></tr>
-     <tr><td class="num">   4.0</td><td class="left">'serpent'</td></tr>
-     <tr><td class="num">   6.3</td><td class="left">'Austin'</td></tr>
-     <tr><td class="num">   8.1</td><td class="left">'shoki'</td></tr>
-     <tr><td class="num">   8.3</td><td class="left">'mrduke'</td></tr>
-     <tr><td class="num">  10.8</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-     <tr><td class="num">  11.9</td><td class="left">'Tiza'</td></tr>
-     <tr><td class="num">  12.2</td><td class="left">'Andreas'</td></tr>
-     <tr><td class="num">  12.2</td><td class="left">'Freshman'</td></tr>
-     <tr><td class="num">  13.1</td><td class="left">'alfred69'</td></tr>
-     <tr><td class="num">  13.4</td><td class="left">'Chocolate Zero'</td></tr>
-     <tr><td class="num">  14.4</td><td class="left">'Sim_Ed'</td></tr>
-     <tr><td class="num">  14.7</td><td class="left">'Agnieszka'</td></tr>
-     <tr><td class="num">  15.0</td><td class="left">'Mark P.'</td></tr>
-     <tr><td class="num">  19.2</td><td class="left">'Alex'</td></tr>
-     <tr><td class="num">  21.1</td><td class="left">'Antonio EE'</td></tr>
-     <tr><td class="num">  22.0</td><td class="left">'Klaus'</td></tr>
-     <tr><td class="num">  22.2</td><td class="left">'Marc-Hendrik'</td></tr>
-     <tr><td class="num">  22.4</td><td class="left">'Chris'</td></tr>
-     <tr><td class="num">  23.3</td><td class="left">'Thomas'</td></tr>
-     <tr><td class="num">  23.4</td><td class="left">'Bent'</td></tr>
-     <tr><td class="num">  24.1</td><td class="left">'hdwow'</td></tr>
-     <tr><td class="num">  24.7</td><td class="left">'Gottseinsohn'</td></tr>
-     <tr><td class="num">  25.2</td><td class="left">'Hans-HD'</td></tr>
-     <tr><td class="num">  25.7</td><td class="left">'Ale'</td></tr>
-     <tr><td class="num">  27.0</td><td class="left">'Little_Mole'</td></tr>
-     <tr><td class="num">  27.1</td><td class="left">'J3FF'</td></tr>
-     <tr><td class="num">  28.3</td><td class="left">'biotopa'</td></tr>
-     <tr><td class="num">  29.0</td><td class="left">'oblo'</td></tr>
-     <tr><td class="num">  29.3</td><td class="left">'redsantz'</td></tr>
-     <tr><td class="num">  29.7</td><td class="left">'geembo_90'</td></tr>
-     <tr><td class="num">  30.4</td><td class="left">'Edgar_Flesk'</td></tr>
-     <tr><td class="num">  30.8</td><td class="left">'Melanie'</td></tr>
-     <tr><td class="num">  31.0</td><td class="left">'IChrisI'</td></tr>
-     <tr><td class="num">  31.2</td><td class="left">'Vinksu'</td></tr>
-     <tr><td class="num">  31.3</td><td class="left">'erich'</td></tr>
-     <tr><td class="num">  31.4</td><td class="left">'NorthForty'</td></tr>
-     <tr><td class="num">  31.6</td><td class="left">'Gorn'</td></tr>
-     <tr><td class="num">  31.8</td><td class="left">'Davacardo'</td></tr>
-     <tr><td class="num">  34.5</td><td class="left">'niebie'</td></tr>
-     <tr><td class="num">  34.5</td><td class="left">'MicWa'</td></tr>
-     <tr><td class="num">  34.7</td><td class="left">'WP319'</td></tr>
-     <tr><td class="num">  35.0</td><td class="left">'Kosby'</td></tr>
-     <tr><td class="num">  36.7</td><td class="left">'Rugby4ever'</td></tr>
-     <tr><td class="num">  38.1</td><td class="left">'mecke'</td></tr>
-     <tr><td class="num">  38.2</td><td class="left">'Drotten'</td></tr>
-     <tr><td class="num">  38.6</td><td class="left">'Archcorenth'</td></tr>
-     <tr><td class="num">  38.9</td><td class="left">'Harry Lim'</td></tr>
-     <tr><td class="num">  39.1</td><td class="left">'B-man'</td></tr>
-     <tr><td class="num">  39.5</td><td class="left">'Angolino'</td></tr>
-     <tr><td class="num">  40.0</td><td class="left">'Nfol'</td></tr>
-     <tr><td class="num">  40.5</td><td class="left">'Tiger'</td></tr>
-     <tr><td class="num">  41.1</td><td class="left">'Snaily'</td></tr>
-     <tr><td class="num">  41.4</td><td class="left">'Vlad'</td></tr>
-     <tr><td class="num">  42.4</td><td class="left">'Momcat'</td></tr>
-     <tr><td class="num">  42.5</td><td class="left">'Liam Sheehan'</td></tr>
-     <tr><td class="num">  42.9</td><td class="left">'Breezy'</td></tr>
-     <tr><td class="num">  43.0</td><td class="left">'Uli'</td></tr>
-     <tr><td class="num">  44.8</td><td class="left">'Tarim'</td></tr>
-     <tr><td class="num">  45.4</td><td class="left">'IntKecsk'</td></tr>
-     <tr><td class="num">  45.7</td><td class="left">'tjRaven'</td></tr>
-     <tr><td class="num">  46.8</td><td class="left">'ntaeijr'</td></tr>
-     <tr><td class="num">  47.0</td><td class="left">'mhatta'</td></tr>
-     <tr><td class="num">  48.6</td><td class="left">'Zak'</td></tr>
-     <tr><td class="num">  49.1</td><td class="left">'Valkyrie2'</td></tr>
-     <tr><td class="num">  49.5</td><td class="left">'Sandra'</td></tr>
-     <tr><td class="num">  50.4</td><td class="left">'jdcampo'</td></tr>
-     <tr><td class="num">  50.9</td><td class="left">'Jeffrey S'</td></tr>
-     <tr><td class="num">  51.2</td><td class="left">'brynn'</td></tr>
-     <tr><td class="num">  51.3</td><td class="left">'Slav'</td></tr>
-     <tr><td class="num">  51.4</td><td class="left">'AkRa'</td></tr>
-     <tr><td class="num">  51.8</td><td class="left">'Vaily'</td></tr>
-     <tr><td class="num">  52.9</td><td class="left">'Turbogurk'</td></tr>
-     <tr><td class="num">  52.9</td><td class="left">'Neophilus'</td></tr>
-     <tr><td class="num">  52.9</td><td class="left">'Cyphase'</td></tr>
-     <tr><td class="num">  55.3</td><td class="left">'krazy62'</td></tr>
-     <tr><td class="num">  56.1</td><td class="left">'Adonica'</td></tr>
-     <tr><td class="num">  58.7</td><td class="left">'Mecki'</td></tr>
-     <tr><td class="num">  61.4</td><td class="left">'Asbel'</td></tr>
-     <tr><td class="num">  63.3</td><td class="left">'Meeve'</td></tr>
-     <tr><td class="num">  65.9</td><td class="left">'ael'</td></tr>
-     <tr><td class="num">  66.3</td><td class="left">'Samuel'</td></tr>
-     <tr><td class="num">  66.6</td><td class="left">'schmusi20'</td></tr>
-     <tr><td class="num">  67.2</td><td class="left">'Alf'</td></tr>
-     <tr><td class="num">  68.9</td><td class="left">'Magnus and Susi'</td></tr>
-     <tr><td class="num">  70.0</td><td class="left">'xmouse'</td></tr>
-     <tr><td class="num">  71.6</td><td class="left">'Joona'</td></tr>
-     <tr><td class="num">  71.8</td><td class="left">'AQZ'</td></tr>
-     <tr><td class="num">  73.3</td><td class="left">'crypto_rsa'</td></tr>
-     <tr><td class="num">  73.8</td><td class="left">'Dvorhagen'</td></tr>
-     <tr><td class="num">  74.8</td><td class="left">'jojo'</td></tr>
-     <tr><td class="num">  74.9</td><td class="left">'AsuCaga'</td></tr>
-     <tr><td class="num">  78.2</td><td class="left">'colonel crayon'</td></tr>
-     <tr><td class="num">  80.1</td><td class="left">'Agares'</td></tr>
+     <tr><td class="num">   4.0</td><td class="left">'U-Punkt'</td></tr>
+     <tr><td class="num">   4.4</td><td class="left">'Andy'</td></tr>
+     <tr><td class="num">   4.5</td><td class="left">'serpent'</td></tr>
+     <tr><td class="num">   6.6</td><td class="left">'Austin'</td></tr>
+     <tr><td class="num">   8.5</td><td class="left">'shoki'</td></tr>
+     <tr><td class="num">  10.0</td><td class="left">'Tiza'</td></tr>
+     <tr><td class="num">  11.1</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+     <tr><td class="num">  12.7</td><td class="left">'Andreas'</td></tr>
+     <tr><td class="num">  13.5</td><td class="left">'alfred69'</td></tr>
+     <tr><td class="num">  13.8</td><td class="left">'Chocolate Zero'</td></tr>
+     <tr><td class="num">  14.6</td><td class="left">'Mark P.'</td></tr>
+     <tr><td class="num">  14.7</td><td class="left">'Sim_Ed'</td></tr>
+     <tr><td class="num">  14.9</td><td class="left">'Agnieszka'</td></tr>
+     <tr><td class="num">  19.5</td><td class="left">'Alex'</td></tr>
+     <tr><td class="num">  21.4</td><td class="left">'Antonio EE'</td></tr>
+     <tr><td class="num">  22.3</td><td class="left">'Klaus'</td></tr>
+     <tr><td class="num">  22.4</td><td class="left">'Marc-Hendrik'</td></tr>
+     <tr><td class="num">  22.7</td><td class="left">'Chris'</td></tr>
+     <tr><td class="num">  23.1</td><td class="left">'Angolino'</td></tr>
+     <tr><td class="num">  23.6</td><td class="left">'Bent'</td></tr>
+     <tr><td class="num">  23.6</td><td class="left">'Thomas'</td></tr>
+     <tr><td class="num">  24.4</td><td class="left">'hdwow'</td></tr>
+     <tr><td class="num">  25.1</td><td class="left">'Gottseinsohn'</td></tr>
+     <tr><td class="num">  25.5</td><td class="left">'Hans-HD'</td></tr>
+     <tr><td class="num">  26.1</td><td class="left">'Ale'</td></tr>
+     <tr><td class="num">  27.3</td><td class="left">'Little_Mole'</td></tr>
+     <tr><td class="num">  27.4</td><td class="left">'J3FF'</td></tr>
+     <tr><td class="num">  28.6</td><td class="left">'biotopa'</td></tr>
+     <tr><td class="num">  29.3</td><td class="left">'oblo'</td></tr>
+     <tr><td class="num">  29.6</td><td class="left">'redsantz'</td></tr>
+     <tr><td class="num">  29.9</td><td class="left">'geembo_90'</td></tr>
+     <tr><td class="num">  30.6</td><td class="left">'Edgar_Flesk'</td></tr>
+     <tr><td class="num">  31.1</td><td class="left">'Melanie'</td></tr>
+     <tr><td class="num">  31.3</td><td class="left">'IChrisI'</td></tr>
+     <tr><td class="num">  31.5</td><td class="left">'Vinksu'</td></tr>
+     <tr><td class="num">  31.7</td><td class="left">'erich'</td></tr>
+     <tr><td class="num">  31.7</td><td class="left">'NorthForty'</td></tr>
+     <tr><td class="num">  31.9</td><td class="left">'Gorn'</td></tr>
+     <tr><td class="num">  32.1</td><td class="left">'Davacardo'</td></tr>
+     <tr><td class="num">  34.8</td><td class="left">'niebie'</td></tr>
+     <tr><td class="num">  34.8</td><td class="left">'MicWa'</td></tr>
+     <tr><td class="num">  35.0</td><td class="left">'WP319'</td></tr>
+     <tr><td class="num">  35.3</td><td class="left">'Kosby'</td></tr>
+     <tr><td class="num">  37.2</td><td class="left">'Rugby4ever'</td></tr>
+     <tr><td class="num">  38.2</td><td class="left">'mecke'</td></tr>
+     <tr><td class="num">  38.5</td><td class="left">'Drotten'</td></tr>
+     <tr><td class="num">  38.8</td><td class="left">'Archcorenth'</td></tr>
+     <tr><td class="num">  39.1</td><td class="left">'Harry Lim'</td></tr>
+     <tr><td class="num">  39.2</td><td class="left">'B-man'</td></tr>
+     <tr><td class="num">  39.6</td><td class="left">'Nfol'</td></tr>
+     <tr><td class="num">  40.7</td><td class="left">'Tiger'</td></tr>
+     <tr><td class="num">  41.0</td><td class="left">'gringer'</td></tr>
+     <tr><td class="num">  41.3</td><td class="left">'Vlad'</td></tr>
+     <tr><td class="num">  41.3</td><td class="left">'Snaily'</td></tr>
+     <tr><td class="num">  42.6</td><td class="left">'Momcat'</td></tr>
+     <tr><td class="num">  42.7</td><td class="left">'Liam Sheehan'</td></tr>
+     <tr><td class="num">  43.1</td><td class="left">'Breezy'</td></tr>
+     <tr><td class="num">  43.3</td><td class="left">'Uli'</td></tr>
+     <tr><td class="num">  45.1</td><td class="left">'Tarim'</td></tr>
+     <tr><td class="num">  45.6</td><td class="left">'IntKecsk'</td></tr>
+     <tr><td class="num">  45.8</td><td class="left">'tjRaven'</td></tr>
+     <tr><td class="num">  47.0</td><td class="left">'ntaeijr'</td></tr>
+     <tr><td class="num">  47.1</td><td class="left">'mhatta'</td></tr>
+     <tr><td class="num">  48.7</td><td class="left">'Zak'</td></tr>
+     <tr><td class="num">  49.2</td><td class="left">'rima'</td></tr>
+     <tr><td class="num">  49.3</td><td class="left">'Valkyrie2'</td></tr>
+     <tr><td class="num">  49.6</td><td class="left">'Sandra'</td></tr>
+     <tr><td class="num">  50.5</td><td class="left">'jdcampo'</td></tr>
+     <tr><td class="num">  51.0</td><td class="left">'Jeffrey S'</td></tr>
+     <tr><td class="num">  51.4</td><td class="left">'brynn'</td></tr>
+     <tr><td class="num">  51.5</td><td class="left">'AkRa'</td></tr>
+     <tr><td class="num">  51.8</td><td class="left">'Slav'</td></tr>
+     <tr><td class="num">  51.9</td><td class="left">'Vaily'</td></tr>
+     <tr><td class="num">  53.1</td><td class="left">'Turbogurk'</td></tr>
+     <tr><td class="num">  53.1</td><td class="left">'Cyphase'</td></tr>
+     <tr><td class="num">  53.2</td><td class="left">'Neophilus'</td></tr>
+     <tr><td class="num">  55.5</td><td class="left">'krazy62'</td></tr>
+     <tr><td class="num">  56.3</td><td class="left">'Adonica'</td></tr>
+     <tr><td class="num">  56.7</td><td class="left">'Kadu'</td></tr>
+     <tr><td class="num">  58.9</td><td class="left">'Mecki'</td></tr>
+     <tr><td class="num">  59.7</td><td class="left">'Sopoforic'</td></tr>
+     <tr><td class="num">  61.7</td><td class="left">'Asbel'</td></tr>
+     <tr><td class="num">  63.5</td><td class="left">'Meeve'</td></tr>
+     <tr><td class="num">  66.0</td><td class="left">'ael'</td></tr>
+     <tr><td class="num">  66.3</td><td class="left">'Fred_the_wise'</td></tr>
+     <tr><td class="num">  66.4</td><td class="left">'Samuel'</td></tr>
+     <tr><td class="num">  66.8</td><td class="left">'schmusi20'</td></tr>
+     <tr><td class="num">  67.1</td><td class="left">'Sparkey'</td></tr>
+     <tr><td class="num">  67.4</td><td class="left">'Alf'</td></tr>
+     <tr><td class="num">  69.0</td><td class="left">'Magnus and Susi'</td></tr>
+     <tr><td class="num">  69.7</td><td class="left">'Zhura'</td></tr>
+     <tr><td class="num">  70.1</td><td class="left">'xmouse'</td></tr>
+     <tr><td class="num">  70.7</td><td class="left">'tasker'</td></tr>
+     <tr><td class="num">  71.7</td><td class="left">'Joona'</td></tr>
+     <tr><td class="num">  72.0</td><td class="left">'AQZ'</td></tr>
+     <tr><td class="num">  73.4</td><td class="left">'crypto_rsa'</td></tr>
+     <tr><td class="num">  73.9</td><td class="left">'Dvorhagen'</td></tr>
+     <tr><td class="num">  74.7</td><td class="left">'Eselchen'</td></tr>
+     <tr><td class="num">  74.9</td><td class="left">'Nicol?s'</td></tr>
+     <tr><td class="num">  74.9</td><td class="left">'jojo'</td></tr>
+     <tr><td class="num">  75.1</td><td class="left">'AsuCaga'</td></tr>
+     <tr><td class="num">  78.3</td><td class="left">'colonel crayon'</td></tr>
+     <tr><td class="num">  79.2</td><td class="left">'Kroetchen'</td></tr>
+     <tr><td class="num">  80.2</td><td class="left">'Agares'</td></tr>
      <tr><td class="num">  84.8</td><td class="left">'Miel56'</td></tr>
-     <tr><td class="num">  89.9</td><td class="left">'The red O'</td></tr>
-     <tr><td class="num">  92.2</td><td class="left">'Michael'</td></tr>
+     <tr><td class="num">  90.0</td><td class="left">'The red O'</td></tr>
+     <tr><td class="num">  90.1</td><td class="left">'Sequoyah'</td></tr>
+     <tr><td class="num">  92.3</td><td class="left">'Michael'</td></tr>
   </table>

Modified: feature_branches/hp_lotm/input/table-rat.html
===================================================================
--- feature_branches/hp_lotm/input/table-rat.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/table-rat.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -1,22 +1,22 @@
   <table>
-    <caption>$$Rating_Statistics$$ $$March$$ 2008</caption>
+    <caption>$$Rating_Statistics$$ $$May$$ 2008</caption>
     <colgroup><col width="80"><col width="80"><col width="220"></colgroup>
     <tr><th>$$count$$</th><th>$$average$$</th><th class="left">$$user$$</th></tr>    <tr><td class="num">1062</td><td class="num"> 5.06</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1056</td><td class="num"> 4.83</td><td class="left">'Taztunes'</td></tr>
-    <tr><td class="num">880</td><td class="num"> 5.00</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num">974</td><td class="num"> 5.03</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num">873</td><td class="num"> 4.79</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">871</td><td class="num"> 5.09</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num">864</td><td class="num"> 4.78</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">653</td><td class="num"> 5.01</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num">628</td><td class="num"> 5.00</td><td class="left">'Moneymaker'</td></tr>
     <tr><td class="num">622</td><td class="num"> 4.22</td><td class="left">'shoki'</td></tr>
     <tr><td class="num">596</td><td class="num"> 4.82</td><td class="left">'U-Punkt'</td></tr>
-    <tr><td class="num">539</td><td class="num"> 5.11</td><td class="left">'dpl'</td></tr>
+    <tr><td class="num">552</td><td class="num"> 5.14</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">534</td><td class="num"> 4.97</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num">511</td><td class="num"> 5.30</td><td class="left">'Lukas'</td></tr>
     <tr><td class="num">487</td><td class="num"> 5.02</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num">448</td><td class="num"> 5.08</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num">433</td><td class="num"> 4.24</td><td class="left">'Alexandros'</td></tr>
-    <tr><td class="num">424</td><td class="num"> 4.35</td><td class="left">'ged'</td></tr>
+    <tr><td class="num">438</td><td class="num"> 4.23</td><td class="left">'Alexandros'</td></tr>
+    <tr><td class="num">433</td><td class="num"> 4.36</td><td class="left">'ged'</td></tr>
     <tr><td class="num">388</td><td class="num"> 4.86</td><td class="left">'Gloop'</td></tr>
     <tr><td class="num">369</td><td class="num"> 4.04</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num">307</td><td class="num"> 4.01</td><td class="left">'Sim_Ed'</td></tr>
@@ -25,22 +25,28 @@
     <tr><td class="num">208</td><td class="num"> 6.15</td><td class="left">'Momcat'</td></tr>
     <tr><td class="num">200</td><td class="num"> 5.74</td><td class="left">'Malla'</td></tr>
     <tr><td class="num">187</td><td class="num"> 5.05</td><td class="left">'WP319'</td></tr>
-    <tr><td class="num">138</td><td class="num"> 5.00</td><td class="left">'Tiza'</td></tr>
+    <tr><td class="num">158</td><td class="num"> 5.05</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num">135</td><td class="num"> 4.13</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num">129</td><td class="num"> 5.64</td><td class="left">'Raoul'</td></tr>
     <tr><td class="num"> 97</td><td class="num"> 4.16</td><td class="left">'Safalra'</td></tr>
+    <tr><td class="num"> 91</td><td class="num"> 4.41</td><td class="left">'Zhura'</td></tr>
     <tr><td class="num"> 85</td><td class="num"> 4.76</td><td class="left">'para_doks'</td></tr>
+    <tr><td class="num"> 75</td><td class="num"> 4.52</td><td class="left">'Kroetchen'</td></tr>
     <tr><td class="num"> 72</td><td class="num"> 5.63</td><td class="left">'Wuzzy'</td></tr>
+    <tr><td class="num"> 62</td><td class="num"> 6.03</td><td class="left">'mecke'</td></tr>
     <tr><td class="num"> 51</td><td class="num"> 6.39</td><td class="left">'Little_Mole'</td></tr>
     <tr><td class="num"> 50</td><td class="num"> 5.26</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num"> 49</td><td class="num"> 6.02</td><td class="left">'oblo'</td></tr>
     <tr><td class="num"> 49</td><td class="num"> 4.90</td><td class="left">'hendrik'</td></tr>
     <tr><td class="num"> 43</td><td class="num"> 3.74</td><td class="left">'Iceshark7'</td></tr>
+    <tr><td class="num"> 39</td><td class="num"> 6.08</td><td class="left">'mrduke'</td></tr>
+    <tr><td class="num"> 33</td><td class="num"> 3.39</td><td class="left">'Freshman'</td></tr>
+    <tr><td class="num"> 33</td><td class="num"> 5.27</td><td class="left">'gringer'</td></tr>
     <tr><td class="num"> 31</td><td class="num"> 7.61</td><td class="left">'AkRa'</td></tr>
     <tr><td class="num"> 30</td><td class="num"> 4.40</td><td class="left">'Archcorenth'</td></tr>
-    <tr><td class="num"> 25</td><td class="num"> 6.04</td><td class="left">'mrduke'</td></tr>
     <tr><td class="num"> 25</td><td class="num"> 4.88</td><td class="left">'Drotten'</td></tr>
-    <tr><td class="num"> 23</td><td class="num"> 7.22</td><td class="left">'Mark P.'</td></tr>
+    <tr><td class="num"> 24</td><td class="num"> 7.13</td><td class="left">'Mark P.'</td></tr>
+    <tr><td class="num"> 19</td><td class="num"> 3.74</td><td class="left">'Eselchen'</td></tr>
     <tr><td class="num"> 17</td><td class="num"> 5.53</td><td class="left">'Jeffrey S'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 7.63</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 3.88</td><td class="left">'Mecki'</td></tr>
@@ -65,13 +71,16 @@
     <tr><td class="num">  3</td><td class="num"> 3.00</td><td class="left">'Rugby4ever'</td></tr>
     <tr><td class="num">  3</td><td class="num"> 4.33</td><td class="left">'krazy62'</td></tr>
     <tr><td class="num">  2</td><td class="num"> 6.50</td><td class="left">'tjRaven'</td></tr>
+    <tr><td class="num">  2</td><td class="num"> 6.00</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num">  2</td><td class="num"> 0.00</td><td class="left">'mhatta'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'ael'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 6.00</td><td class="left">'Slav'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 4.00</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'Uli'</td></tr>
+    <tr><td class="num">  1</td><td class="num"> 0.00</td><td class="left">'Fred_the_wise'</td></tr>
     <tr><td class="num">  1</td><td class="num">10.00</td><td class="left">'Cyphase'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'Harry Lim'</td></tr>
-    <tr><td class="num">  1</td><td class="num"> 6.00</td><td class="left">'Emmanuel'</td></tr>
+    <tr><td class="num">  1</td><td class="num"> 2.00</td><td class="left">'Sequoyah'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 4.00</td><td class="left">'jojo'</td></tr>
+    <tr><td class="num">  1</td><td class="num"> 6.00</td><td class="left">'Sopoforic'</td></tr>
   </table>

Modified: feature_branches/hp_lotm/input/table-solved.html
===================================================================
--- feature_branches/hp_lotm/input/table-solved.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/table-solved.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -1,26 +1,26 @@
   <table>
-    <caption>$$Solved_Level_Statistics$$ $$March$$ 2008</caption>
+    <caption>$$Solved_Level_Statistics$$ $$May$$ 2008</caption>
     <colgroup><col width="130"><col width="130"><col width="130"><col width="240"></colgroup>
     <tr><th>$$difficult$$</th><th>$$easy$$</th><th>$$total$$</th><th class="left">$$user$$</th></tr>
     <tr><td class="num">1045/1045</td><td class="num">189/189</td><td class="num">100.00%</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1043/1045</td><td class="num">189/189</td><td class="num"> 99.84%</td><td class="left">'Taztunes'</td></tr>
+    <tr><td class="num">1029/1045</td><td class="num">185/189</td><td class="num"> 98.38%</td><td class="left">'Freshman'</td></tr>
     <tr><td class="num">1029/1045</td><td class="num">183/189</td><td class="num"> 98.22%</td><td class="left">'Craven'</td></tr>
     <tr><td class="num">1031/1045</td><td class="num">179/189</td><td class="num"> 98.06%</td><td class="left">'Moneymaker'</td></tr>
     <tr><td class="num">1016/1045</td><td class="num">182/189</td><td class="num"> 97.08%</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num">1021/1045</td><td class="num">177/189</td><td class="num"> 97.08%</td><td class="left">'Malla'</td></tr>
     <tr><td class="num">1014/1045</td><td class="num">175/189</td><td class="num"> 96.35%</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num"> 999/1045</td><td class="num">177/189</td><td class="num"> 95.30%</td><td class="left">'biotopa'</td></tr>
-    <tr><td class="num"> 984/1045</td><td class="num">173/189</td><td class="num"> 93.76%</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num"> 995/1045</td><td class="num">175/189</td><td class="num"> 94.81%</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num"> 977/1045</td><td class="num">173/189</td><td class="num"> 93.19%</td><td class="left">'dev0'</td></tr>
     <tr><td class="num"> 970/1045</td><td class="num">166/189</td><td class="num"> 92.06%</td><td class="left">'Andy'</td></tr>
     <tr><td class="num"> 949/1045</td><td class="num">170/189</td><td class="num"> 90.68%</td><td class="left">'para_doks'</td></tr>
-    <tr><td class="num"> 943/1045</td><td class="num">172/189</td><td class="num"> 90.36%</td><td class="left">'Daisy'</td></tr>
-    <tr><td class="num"> 943/1045</td><td class="num">168/189</td><td class="num"> 90.03%</td><td class="left">'mecke'</td></tr>
+    <tr><td class="num"> 945/1045</td><td class="num">172/189</td><td class="num"> 90.52%</td><td class="left">'Daisy'</td></tr>
+    <tr><td class="num"> 947/1045</td><td class="num">169/189</td><td class="num"> 90.44%</td><td class="left">'mecke'</td></tr>
+    <tr><td class="num"> 922/1045</td><td class="num">154/189</td><td class="num"> 87.20%</td><td class="left">'mrduke'</td></tr>
     <tr><td class="num"> 933/1045</td><td class="num">125/189</td><td class="num"> 85.74%</td><td class="left">'Alex'</td></tr>
     <tr><td class="num"> 914/1045</td><td class="num">135/189</td><td class="num"> 85.01%</td><td class="left">'JuSt'</td></tr>
-    <tr><td class="num"> 879/1045</td><td class="num">163/189</td><td class="num"> 84.44%</td><td class="left">'dev0'</td></tr>
     <tr><td class="num"> 894/1045</td><td class="num">140/189</td><td class="num"> 83.79%</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num"> 887/1045</td><td class="num">143/189</td><td class="num"> 83.47%</td><td class="left">'mrduke'</td></tr>
-    <tr><td class="num">1020/1045</td><td class="num">  6/189</td><td class="num"> 83.14%</td><td class="left">'Freshman'</td></tr>
     <tr><td class="num"> 863/1045</td><td class="num">161/189</td><td class="num"> 82.98%</td><td class="left">'Tobias'</td></tr>
     <tr><td class="num"> 917/1045</td><td class="num">106/189</td><td class="num"> 82.90%</td><td class="left">'Django'</td></tr>
     <tr><td class="num"> 863/1045</td><td class="num">150/189</td><td class="num"> 82.09%</td><td class="left">'Gloop'</td></tr>
@@ -34,14 +34,14 @@
     <tr><td class="num"> 938/1045</td><td class="num">  1/189</td><td class="num"> 76.09%</td><td class="left">'Ale'</td></tr>
     <tr><td class="num"> 772/1045</td><td class="num">113/189</td><td class="num"> 71.72%</td><td class="left">'U-Punkt'</td></tr>
     <tr><td class="num"> 739/1045</td><td class="num">131/189</td><td class="num"> 70.50%</td><td class="left">'ABS'</td></tr>
+    <tr><td class="num"> 740/1045</td><td class="num">123/189</td><td class="num"> 69.94%</td><td class="left">'dpl'</td></tr>
     <tr><td class="num"> 728/1045</td><td class="num">126/189</td><td class="num"> 69.21%</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num"> 755/1045</td><td class="num"> 96/189</td><td class="num"> 68.96%</td><td class="left">'brynn'</td></tr>
     <tr><td class="num"> 762/1045</td><td class="num"> 73/189</td><td class="num"> 67.67%</td><td class="left">'redsantz'</td></tr>
+    <tr><td class="num"> 710/1045</td><td class="num">116/189</td><td class="num"> 66.94%</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 734/1045</td><td class="num"> 82/189</td><td class="num"> 66.13%</td><td class="left">'bojster'</td></tr>
     <tr><td class="num"> 782/1045</td><td class="num"> 33/189</td><td class="num"> 66.05%</td><td class="left">'Sim_Ed'</td></tr>
-    <tr><td class="num"> 686/1045</td><td class="num">118/189</td><td class="num"> 65.15%</td><td class="left">'dpl'</td></tr>
     <tr><td class="num"> 766/1045</td><td class="num"> 37/189</td><td class="num"> 65.07%</td><td class="left">'alfred69'</td></tr>
-    <tr><td class="num"> 670/1045</td><td class="num">107/189</td><td class="num"> 62.97%</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 681/1045</td><td class="num"> 78/189</td><td class="num"> 61.51%</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 659/1045</td><td class="num"> 95/189</td><td class="num"> 61.10%</td><td class="left">'Marc-Hendrik'</td></tr>
     <tr><td class="num"> 633/1045</td><td class="num">110/189</td><td class="num"> 60.21%</td><td class="left">'Raoul'</td></tr>
@@ -49,13 +49,13 @@
     <tr><td class="num"> 714/1045</td><td class="num">  0/189</td><td class="num"> 57.86%</td><td class="left">'Gottseinsohn'</td></tr>
     <tr><td class="num"> 620/1045</td><td class="num"> 72/189</td><td class="num"> 56.08%</td><td class="left">'Breezy'</td></tr>
     <tr><td class="num"> 636/1045</td><td class="num"> 55/189</td><td class="num"> 56.00%</td><td class="left">'fabian'</td></tr>
+    <tr><td class="num"> 566/1045</td><td class="num">117/189</td><td class="num"> 55.35%</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 569/1045</td><td class="num">113/189</td><td class="num"> 55.27%</td><td class="left">'Mark P.'</td></tr>
     <tr><td class="num"> 588/1045</td><td class="num"> 93/189</td><td class="num"> 55.19%</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 599/1045</td><td class="num"> 80/189</td><td class="num"> 55.02%</td><td class="left">'serpent'</td></tr>
+    <tr><td class="num"> 577/1045</td><td class="num">100/189</td><td class="num"> 54.86%</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 634/1045</td><td class="num"> 43/189</td><td class="num"> 54.86%</td><td class="left">'Klaus'</td></tr>
-    <tr><td class="num"> 557/1045</td><td class="num">117/189</td><td class="num"> 54.62%</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 576/1045</td><td class="num"> 93/189</td><td class="num"> 54.21%</td><td class="left">'Guglielmo'</td></tr>
-    <tr><td class="num"> 565/1045</td><td class="num">100/189</td><td class="num"> 53.89%</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 525/1045</td><td class="num"> 95/189</td><td class="num"> 50.24%</td><td class="left">'ShadowPhrogg32642342'</td></tr>
     <tr><td class="num"> 589/1045</td><td class="num"> 26/189</td><td class="num"> 49.84%</td><td class="left">'hdwow'</td></tr>
     <tr><td class="num"> 533/1045</td><td class="num"> 82/189</td><td class="num"> 49.84%</td><td class="left">'Wuzzy'</td></tr>
@@ -69,32 +69,34 @@
     <tr><td class="num"> 516/1045</td><td class="num"> 24/189</td><td class="num"> 43.76%</td><td class="left">'niebie'</td></tr>
     <tr><td class="num"> 494/1045</td><td class="num"> 26/189</td><td class="num"> 42.14%</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num"> 506/1045</td><td class="num"> 12/189</td><td class="num"> 41.98%</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num"> 446/1045</td><td class="num"> 65/189</td><td class="num"> 41.41%</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num"> 503/1045</td><td class="num">  7/189</td><td class="num"> 41.33%</td><td class="left">'Edgar_Flesk'</td></tr>
-    <tr><td class="num"> 419/1045</td><td class="num"> 59/189</td><td class="num"> 38.74%</td><td class="left">'Tiza'</td></tr>
-    <tr><td class="num"> 433/1045</td><td class="num"> 45/189</td><td class="num"> 38.74%</td><td class="left">'ged'</td></tr>
+    <tr><td class="num"> 440/1045</td><td class="num"> 50/189</td><td class="num"> 39.71%</td><td class="left">'ged'</td></tr>
+    <tr><td class="num"> 390/1045</td><td class="num"> 93/189</td><td class="num"> 39.14%</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 467/1045</td><td class="num">  6/189</td><td class="num"> 38.33%</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num"> 438/1045</td><td class="num">  3/189</td><td class="num"> 35.74%</td><td class="left">'oblo'</td></tr>
     <tr><td class="num"> 392/1045</td><td class="num"> 40/189</td><td class="num"> 35.01%</td><td class="left">'hendrik'</td></tr>
     <tr><td class="num"> 391/1045</td><td class="num"> 36/189</td><td class="num"> 34.60%</td><td class="left">'Iceshark7'</td></tr>
-    <tr><td class="num"> 336/1045</td><td class="num"> 86/189</td><td class="num"> 34.20%</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 397/1045</td><td class="num"> 24/189</td><td class="num"> 34.12%</td><td class="left">'Chocolate Zero'</td></tr>
     <tr><td class="num"> 368/1045</td><td class="num"> 44/189</td><td class="num"> 33.39%</td><td class="left">'Liam Sheehan'</td></tr>
     <tr><td class="num"> 376/1045</td><td class="num"> 35/189</td><td class="num"> 33.31%</td><td class="left">'Jeffrey S'</td></tr>
     <tr><td class="num"> 392/1045</td><td class="num"> 12/189</td><td class="num"> 32.74%</td><td class="left">'NorthForty'</td></tr>
     <tr><td class="num"> 344/1045</td><td class="num"> 51/189</td><td class="num"> 32.01%</td><td class="left">'Momcat'</td></tr>
     <tr><td class="num"> 382/1045</td><td class="num"> 10/189</td><td class="num"> 31.77%</td><td class="left">'J3FF'</td></tr>
+    <tr><td class="num"> 347/1045</td><td class="num"> 45/189</td><td class="num"> 31.77%</td><td class="left">'rima'</td></tr>
     <tr><td class="num"> 335/1045</td><td class="num"> 50/189</td><td class="num"> 31.20%</td><td class="left">'Harry Lim'</td></tr>
     <tr><td class="num"> 361/1045</td><td class="num"> 18/189</td><td class="num"> 30.71%</td><td class="left">'MicWa'</td></tr>
     <tr><td class="num"> 306/1045</td><td class="num"> 71/189</td><td class="num"> 30.55%</td><td class="left">'Davacardo'</td></tr>
     <tr><td class="num"> 370/1045</td><td class="num">  7/189</td><td class="num"> 30.55%</td><td class="left">'IChrisI'</td></tr>
     <tr><td class="num"> 350/1045</td><td class="num"> 25/189</td><td class="num"> 30.39%</td><td class="left">'IntKecsk'</td></tr>
     <tr><td class="num"> 323/1045</td><td class="num"> 52/189</td><td class="num"> 30.39%</td><td class="left">'Kevin'</td></tr>
+    <tr><td class="num"> 277/1045</td><td class="num"> 90/189</td><td class="num"> 29.74%</td><td class="left">'gringer'</td></tr>
     <tr><td class="num"> 331/1045</td><td class="num"> 14/189</td><td class="num"> 27.96%</td><td class="left">'Archcorenth'</td></tr>
     <tr><td class="num"> 281/1045</td><td class="num"> 63/189</td><td class="num"> 27.88%</td><td class="left">'erich'</td></tr>
     <tr><td class="num"> 295/1045</td><td class="num"> 29/189</td><td class="num"> 26.26%</td><td class="left">'Tiger'</td></tr>
     <tr><td class="num"> 288/1045</td><td class="num"> 36/189</td><td class="num"> 26.26%</td><td class="left">'Drotten'</td></tr>
+    <tr><td class="num"> 300/1045</td><td class="num"> 19/189</td><td class="num"> 25.85%</td><td class="left">'Nfol'</td></tr>
     <tr><td class="num"> 261/1045</td><td class="num"> 53/189</td><td class="num"> 25.45%</td><td class="left">'Andreas'</td></tr>
-    <tr><td class="num"> 287/1045</td><td class="num"> 18/189</td><td class="num"> 24.72%</td><td class="left">'Nfol'</td></tr>
     <tr><td class="num"> 269/1045</td><td class="num"> 26/189</td><td class="num"> 23.91%</td><td class="left">'Mecki'</td></tr>
     <tr><td class="num"> 276/1045</td><td class="num"> 15/189</td><td class="num"> 23.58%</td><td class="left">'Thomas'</td></tr>
     <tr><td class="num"> 245/1045</td><td class="num"> 36/189</td><td class="num"> 22.77%</td><td class="left">'B-man'</td></tr>
@@ -107,6 +109,7 @@
     <tr><td class="num"> 214/1045</td><td class="num"> 19/189</td><td class="num"> 18.88%</td><td class="left">'Adonica'</td></tr>
     <tr><td class="num"> 206/1045</td><td class="num">  4/189</td><td class="num"> 17.02%</td><td class="left">'krazy62'</td></tr>
     <tr><td class="num"> 181/1045</td><td class="num"> 20/189</td><td class="num"> 16.29%</td><td class="left">'Vaily'</td></tr>
+    <tr><td class="num"> 152/1045</td><td class="num"> 32/189</td><td class="num"> 14.91%</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num"> 156/1045</td><td class="num"> 24/189</td><td class="num"> 14.59%</td><td class="left">'jdcampo'</td></tr>
     <tr><td class="num"> 125/1045</td><td class="num"> 55/189</td><td class="num"> 14.59%</td><td class="left">'Vlad'</td></tr>
     <tr><td class="num"> 149/1045</td><td class="num"> 30/189</td><td class="num"> 14.51%</td><td class="left">'Chris'</td></tr>
@@ -117,26 +120,35 @@
     <tr><td class="num"> 164/1045</td><td class="num">  0/189</td><td class="num"> 13.29%</td><td class="left">'Bent'</td></tr>
     <tr><td class="num"> 124/1045</td><td class="num"> 33/189</td><td class="num"> 12.72%</td><td class="left">'joseba'</td></tr>
     <tr><td class="num"> 127/1045</td><td class="num"> 29/189</td><td class="num"> 12.64%</td><td class="left">'ael'</td></tr>
+    <tr><td class="num"> 120/1045</td><td class="num"> 35/189</td><td class="num"> 12.56%</td><td class="left">'Kadu'</td></tr>
     <tr><td class="num"> 148/1045</td><td class="num">  5/189</td><td class="num"> 12.40%</td><td class="left">'Rugby4ever'</td></tr>
     <tr><td class="num"> 110/1045</td><td class="num"> 31/189</td><td class="num"> 11.43%</td><td class="left">'Cyphase'</td></tr>
     <tr><td class="num"> 124/1045</td><td class="num"> 15/189</td><td class="num"> 11.26%</td><td class="left">'Magnus and Susi'</td></tr>
-    <tr><td class="num"> 114/1045</td><td class="num"> 23/189</td><td class="num"> 11.10%</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num"> 131/1045</td><td class="num">  1/189</td><td class="num"> 10.70%</td><td class="left">'Asbel'</td></tr>
     <tr><td class="num"> 105/1045</td><td class="num"> 22/189</td><td class="num"> 10.29%</td><td class="left">'Neophilus'</td></tr>
+    <tr><td class="num">  89/1045</td><td class="num"> 24/189</td><td class="num">  9.16%</td><td class="left">'Zhura'</td></tr>
     <tr><td class="num"> 101/1045</td><td class="num">  0/189</td><td class="num">  8.18%</td><td class="left">'Alf'</td></tr>
+    <tr><td class="num">  84/1045</td><td class="num"> 15/189</td><td class="num">  8.02%</td><td class="left">'Eselchen'</td></tr>
+    <tr><td class="num">  79/1045</td><td class="num"> 10/189</td><td class="num">  7.21%</td><td class="left">'Kroetchen'</td></tr>
+    <tr><td class="num">  78/1045</td><td class="num"> 10/189</td><td class="num">  7.13%</td><td class="left">'Fred_the_wise'</td></tr>
     <tr><td class="num">  75/1045</td><td class="num"> 12/189</td><td class="num">  7.05%</td><td class="left">'schmusi20'</td></tr>
     <tr><td class="num">  67/1045</td><td class="num"> 19/189</td><td class="num">  6.97%</td><td class="left">'Dvorhagen'</td></tr>
+    <tr><td class="num">  83/1045</td><td class="num">  1/189</td><td class="num">  6.81%</td><td class="left">'tasker'</td></tr>
     <tr><td class="num">  57/1045</td><td class="num"> 26/189</td><td class="num">  6.73%</td><td class="left">'Meeve'</td></tr>
     <tr><td class="num">  65/1045</td><td class="num"> 16/189</td><td class="num">  6.56%</td><td class="left">'Slav'</td></tr>
     <tr><td class="num">  64/1045</td><td class="num"> 16/189</td><td class="num">  6.48%</td><td class="left">'AQZ'</td></tr>
     <tr><td class="num">  59/1045</td><td class="num"> 21/189</td><td class="num">  6.48%</td><td class="left">'AsuCaga'</td></tr>
     <tr><td class="num">  58/1045</td><td class="num"> 19/189</td><td class="num">  6.24%</td><td class="left">'xmouse'</td></tr>
     <tr><td class="num">  67/1045</td><td class="num">  7/189</td><td class="num">  6.00%</td><td class="left">'Joona'</td></tr>
+    <tr><td class="num">  54/1045</td><td class="num"> 18/189</td><td class="num">  5.83%</td><td class="left">'Sopoforic'</td></tr>
     <tr><td class="num">  54/1045</td><td class="num"> 12/189</td><td class="num">  5.35%</td><td class="left">'Samuel'</td></tr>
     <tr><td class="num">  47/1045</td><td class="num"> 17/189</td><td class="num">  5.19%</td><td class="left">'crypto_rsa'</td></tr>
     <tr><td class="num">  44/1045</td><td class="num"> 16/189</td><td class="num">  4.86%</td><td class="left">'Agares'</td></tr>
+    <tr><td class="num">  33/1045</td><td class="num"> 23/189</td><td class="num">  4.54%</td><td class="left">'Sparkey'</td></tr>
+    <tr><td class="num">  40/1045</td><td class="num"> 15/189</td><td class="num">  4.46%</td><td class="left">'Nicol?s'</td></tr>
     <tr><td class="num">  39/1045</td><td class="num"> 14/189</td><td class="num">  4.29%</td><td class="left">'jojo'</td></tr>
     <tr><td class="num">  31/1045</td><td class="num"> 10/189</td><td class="num">  3.32%</td><td class="left">'colonel crayon'</td></tr>
+    <tr><td class="num">  39/1045</td><td class="num">  0/189</td><td class="num">  3.16%</td><td class="left">'Sequoyah'</td></tr>
     <tr><td class="num">  27/1045</td><td class="num">  5/189</td><td class="num">  2.59%</td><td class="left">'Miel56'</td></tr>
     <tr><td class="num">  23/1045</td><td class="num">  5/189</td><td class="num">  2.27%</td><td class="left">'The red O'</td></tr>
     <tr><td class="num">   7/1045</td><td class="num"> 12/189</td><td class="num">  1.54%</td><td class="left">'Michael'</td></tr>

Modified: feature_branches/hp_lotm/input/table-wr.html
===================================================================
--- feature_branches/hp_lotm/input/table-wr.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/table-wr.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -1,52 +1,50 @@
   <table>
-    <caption>$$Worldrecord_Statistics$$ $$March$$ 2008</caption>
+    <caption>$$Worldrecord_Statistics$$ $$May$$ 2008</caption>
     <colgroup><col width="80"><col width="80"><col width="470"></colgroup>
     <tr><th>$$total$$</th><th>$$shared$$</th><th class="left">$$user$$</th></tr>
-    <tr><td class="num">977</td><td class="num">240</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">165</td><td class="num"> 96</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num">126</td><td class="num">115</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num"> 73</td><td class="num"> 57</td><td class="left">'daydreamer'</td></tr>
-    <tr><td class="num"> 62</td><td class="num"> 43</td><td class="left">'Duffy'</td></tr>
-    <tr><td class="num"> 48</td><td class="num"> 31</td><td class="left">'Malla'</td></tr>
+    <tr><td class="num">987</td><td class="num">236</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">160</td><td class="num"> 92</td><td class="left">'Stupid'</td></tr>
+    <tr><td class="num">116</td><td class="num">108</td><td class="left">'Johannes'</td></tr>
+    <tr><td class="num"> 83</td><td class="num"> 69</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num"> 59</td><td class="num"> 41</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num"> 51</td><td class="num"> 42</td><td class="left">'dev0'</td></tr>
     <tr><td class="num"> 47</td><td class="num"> 46</td><td class="left">'Great Scott'</td></tr>
-    <tr><td class="num"> 36</td><td class="num"> 30</td><td class="left">'dev0'</td></tr>
-    <tr><td class="num"> 36</td><td class="num"> 34</td><td class="left">'Django'</td></tr>
+    <tr><td class="num"> 45</td><td class="num"> 31</td><td class="left">'Malla'</td></tr>
+    <tr><td class="num"> 37</td><td class="num"> 24</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num"> 35</td><td class="num"> 27</td><td class="left">'Zekobah'</td></tr>
-    <tr><td class="num"> 34</td><td class="num"> 29</td><td class="left">'Iceshark7'</td></tr>
+    <tr><td class="num"> 35</td><td class="num"> 33</td><td class="left">'Django'</td></tr>
     <tr><td class="num"> 32</td><td class="num"> 26</td><td class="left">'Alexandros'</td></tr>
+    <tr><td class="num"> 32</td><td class="num"> 28</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 30</td><td class="num"> 29</td><td class="left">'joseba'</td></tr>
-    <tr><td class="num"> 29</td><td class="num"> 15</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num"> 27</td><td class="num"> 26</td><td class="left">'Ghatotkacha'</td></tr>
+    <tr><td class="num"> 23</td><td class="num"> 18</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 20</td><td class="num"> 15</td><td class="left">'Emmanuel'</td></tr>
-    <tr><td class="num"> 20</td><td class="num"> 17</td><td class="left">'Ludmian'</td></tr>
-    <tr><td class="num"> 20</td><td class="num"> 18</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 20</td><td class="num"> 19</td><td class="left">'Safalra'</td></tr>
+    <tr><td class="num"> 19</td><td class="num"> 16</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 19</td><td class="num"> 17</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num"> 17</td><td class="num"> 17</td><td class="left">'bojster'</td></tr>
-    <tr><td class="num"> 16</td><td class="num">  8</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 14</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 15</td><td class="num"> 15</td><td class="left">'ABS'</td></tr>
+    <tr><td class="num"> 14</td><td class="num">  7</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num"> 11</td><td class="num">  8</td><td class="left">'Chocolate Zero'</td></tr>
-    <tr><td class="num"> 10</td><td class="num">  6</td><td class="left">'Taztunes'</td></tr>
     <tr><td class="num">  9</td><td class="num">  5</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-    <tr><td class="num">  9</td><td class="num">  6</td><td class="left">'Gloop'</td></tr>
     <tr><td class="num">  9</td><td class="num">  9</td><td class="left">'fabian'</td></tr>
+    <tr><td class="num">  8</td><td class="num">  5</td><td class="left">'Taztunes'</td></tr>
+    <tr><td class="num">  8</td><td class="num">  6</td><td class="left">'Gloop'</td></tr>
     <tr><td class="num">  8</td><td class="num">  8</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">  7</td><td class="num">  6</td><td class="left">'Edgar_Flesk'</td></tr>
-    <tr><td class="num">  6</td><td class="num">  2</td><td class="left">'Breezy'</td></tr>
-    <tr><td class="num">  6</td><td class="num">  3</td><td class="left">'para_doks'</td></tr>
+    <tr><td class="num">  6</td><td class="num">  3</td><td class="left">'para_doks' + 'Breezy'</td></tr>
     <tr><td class="num">  6</td><td class="num">  4</td><td class="left">'Lukas'</td></tr>
-    <tr><td class="num">  6</td><td class="num">  5</td><td class="left">'Guglielmo'</td></tr>
+    <tr><td class="num">  6</td><td class="num">  5</td><td class="left">'Guglielmo' + 'Angolino'</td></tr>
     <tr><td class="num">  6</td><td class="num">  6</td><td class="left">'Tobias' + 'Wuzzy'</td></tr>
-    <tr><td class="num">  5</td><td class="num">  4</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num">  5</td><td class="num">  5</td><td class="left">'Raoul' + 'Cyphase' + 'Thomas' + 'Chris' + 'Ralf'</td></tr>
     <tr><td class="num">  4</td><td class="num">  2</td><td class="left">'Bent'</td></tr>
     <tr><td class="num">  4</td><td class="num">  4</td><td class="left">'U-Punkt' + 'J3FF'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'Craven' + 'colonel crayon' + 'Stephanie'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'geembo_90' + 'Neophilus' + 'Andy'</td></tr>
-    <tr><td class="num">  2</td><td class="num">  1</td><td class="left">'mrduke' + 'Daniel' + 'Slav' + 'tjRaven'</td></tr>
-    <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'Drotten' + 'Sim_Ed' + 'hendrik' + 'Austin' + 'Snaily' + 'Antonio EE' + 'Ingo' + 'serpent'</td></tr>
-    <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'Ale' + 'Gorn' + 'Nat' + 'Daisy'</td></tr>
-    <tr><td class="num">  1</td><td class="num">  1</td><td class="left">'alfred69' + 'Agares' + 'ntaeijr' + 'Tiger' + 'Zak' + 'Tiza' + 'niebie' + 'Andreas' + 'Samuel' + 'Mark P.' + 'oblo' + 'hdwow' + 'B-man' + 'Asbel' + 'Vlad' + 'Vaily' + 'krazy62' + 'JuSt'</td></tr>
-    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'Miel56' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'ael' + 'biotopa' + 'brynn' + 'IntKecsk' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'crypto_rsa' + 'Harry Lim' + 'AkRa' + 'Momcat' + 'NorthForty' + 'Mecki' + 'The red O' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'shoki' + 'jojo' + 'Klaus' + 'Valkyrie2' + 'MicWa' + 'AsuCaga' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'mecke' + 'Dvorhagen' + 'Holger' + 'Ingo_K' + 'Ant' + 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Liam Sheehan' + 'Michael' + 'Tarim' + 'Agnieszka'</td></tr>
+    <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'mrduke' + 'Craven' + 'colonel crayon' + 'Stephanie'</td></tr>
+    <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'geembo_90' + 'Tiza' + 'Neophilus' + 'Nicol?s' + 'Andy' + 'Sopoforic'</td></tr>
+    <tr><td class="num">  2</td><td class="num">  1</td><td class="left">'Daniel'</td></tr>
+    <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'Drotten' + 'tjRaven' + 'Sim_Ed' + 'hendrik' + 'Austin' + 'Snaily' + 'Antonio EE' + 'Ingo' + 'serpent'</td></tr>
+    <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'Ale' + 'Sparkey' + 'Gorn' + 'Nat' + 'Daisy'</td></tr>
+    <tr><td class="num">  1</td><td class="num">  1</td><td class="left">'alfred69' + 'Agares' + 'ntaeijr' + 'Tiger' + 'Zak' + 'Slav' + 'niebie' + 'Andreas' + 'Samuel' + 'Mark P.' + 'oblo' + 'hdwow' + 'B-man' + 'Asbel' + 'Vlad' + 'Vaily' + 'krazy62' + 'JuSt'</td></tr>
+    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'tasker' + 'Miel56' + 'Zhura' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'Eselchen' + 'ael' + 'biotopa' + 'brynn' + 'IntKecsk' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'Fred_the_wise' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'Kroetchen' + 'crypto_rsa' + 'Harry Lim' + 'Sequoyah' + 'AkRa' + 'Momcat' + 'NorthForty' + 'Mecki' + 'The red O' + 'gringer' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'Kadu' + 'shoki' + 'jojo' + 'rima' + 'Klaus' + 'Valkyrie2' + 'MicWa' + 'AsuCaga' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'mecke' + 'Dvorhagen' + 'Holger' + 'Ingo_K' + 'Ant' + 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Liam Sheehan' + 'Michael' + 'Tarim' + 'Agnieszka'</td></tr>
   </table>

Copied: feature_branches/hp_lotm/input/top_news.html (from rev 1181, homepage/input/top_news.html)

Copied: feature_branches/hp_lotm/input/top_news_de.html (from rev 1181, homepage/input/top_news_de.html)

Copied: feature_branches/hp_lotm/input/top_news_ru.html (from rev 1181, homepage/input/top_news_ru.html)

Modified: feature_branches/hp_lotm/input/userlist.html
===================================================================
--- feature_branches/hp_lotm/input/userlist.html	2008-06-17 20:37:09 UTC (rev 1181)
+++ feature_branches/hp_lotm/input/userlist.html	2008-06-17 20:54:25 UTC (rev 1182)
@@ -48,7 +48,9 @@
     <li>Edgar_Flesk</li>
     <li>Emmanuel</li>
     <li>erich</li>
+    <li>Eselchen</li>
     <li>fabian</li>
+    <li>Fred_the_wise</li>
     <li>Freshman</li>
     <li>ged</li>
     <li>geembo_90</li>
@@ -57,6 +59,7 @@
     <li>Gorn</li>
     <li>Gottseinsohn</li>
     <li>Great Scott</li>
+    <li>gringer</li>
     <li>Guglielmo</li>
     <li>Hans-HD</li>
     <li>Harry Lim</li>
@@ -77,10 +80,12 @@
     <li>Joona</li>
     <li>joseba</li>
     <li>JuSt</li>
+    <li>Kadu</li>
     <li>Kevin</li>
     <li>Klaus</li>
     <li>Kosby</li>
     <li>krazy62</li>
+    <li>Kroetchen</li>
     <li>Liam Sheehan</li>
     <li>Little_Mole</li>
     <li>Ludmian</li>
@@ -104,6 +109,7 @@
     <li>Nat</li>
     <li>Neophilus</li>
     <li>Nfol</li>
+    <li>Nicol?s</li>
     <li>niebie</li>
     <li>NorthForty</li>
     <li>ntaeijr</li>
@@ -112,6 +118,7 @@
     <li>Ralf</li>
     <li>Raoul</li>
     <li>redsantz</li>
+    <li>rima</li>
     <li>Ronald</li>
     <li>Rugby4ever</li>
     <li>ryujun</li>
@@ -119,15 +126,19 @@
     <li>Samuel</li>
     <li>Sandra</li>
     <li>schmusi20</li>
+    <li>Sequoyah</li>
     <li>serpent</li>
     <li>ShadowPhrogg32642342</li>
     <li>shoki</li>
     <li>Sim_Ed</li>
     <li>Slav</li>
     <li>Snaily</li>
+    <li>Sopoforic</li>
+    <li>Sparkey</li>
     <li>Stephanie</li>
     <li>Stupid</li>
     <li>Tarim</li>
+    <li>tasker</li>
     <li>Taztunes</li>
     <li>The red O</li>
     <li>Thomas</li>
@@ -147,5 +158,6 @@
     <li>xmouse</li>
     <li>Zak</li>
     <li>Zekobah</li>
+    <li>Zhura</li>
   </ul>
 </div>



From ral at mail.berlios.de  Wed Jun 18 23:41:46 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Wed, 18 Jun 2008 23:41:46 +0200
Subject: [Enigma-game-svn] r1183 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 data/schemas src
Message-ID: <200806182141.m5ILfkPV010746@sheep.berlios.de>

Author: ral
Date: 2008-06-18 23:41:18 +0200 (Wed, 18 Jun 2008)
New Revision: 1183

Added:
   trunk/data/gfx32/st-mirrortempl_0017.png
   trunk/data/gfx32/st-mirrortempl_0018.png
   trunk/data/gfx32/st-mirrortempl_0019.png
   trunk/data/gfx32/st-mirrortempl_0020.png
   trunk/data/gfx40/st-mirrortempl_0017.png
   trunk/data/gfx40/st-mirrortempl_0018.png
   trunk/data/gfx40/st-mirrortempl_0019.png
   trunk/data/gfx40/st-mirrortempl_0020.png
   trunk/data/gfx48/st-mirrortempl_0017.png
   trunk/data/gfx48/st-mirrortempl_0018.png
   trunk/data/gfx48/st-mirrortempl_0019.png
   trunk/data/gfx48/st-mirrortempl_0020.png
Modified:
   trunk/data/api1init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/enigma.cc
   trunk/src/enigma.hh
   trunk/src/laser.cc
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.hh
Log:
Trunk 1.1: new API reengineering Mirror 
- renaming to st_mirror, st_mirror_slab, st_mirror_triangle, st_mirror_sheets
  slab and sheets are both planar, sheets are always semi-transparent and
  let a parallel beam pass, a slab lets a parallel beam not pass
- attribute "orientation" is attribute "state" with standard direction notation
- attribute "counterclock" detemines rotation direction
- standard behaviour on messages turn, turnback, orientate
- actor turns into direction given by counterclock, 
  if actor reveals a wrench it performs a turnback
- boulder trigger fixed to a single mirror turn


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-06-17 20:54:25 UTC (rev 1182)
+++ trunk/data/api1init.lua	2008-06-18 21:41:18 UTC (rev 1183)
@@ -121,6 +121,40 @@
     st_laserflop = "st-lasertimeswitch",
     st_lightpassenger = "st-lightpassenger",
     st_lightpassenger_off = "st-lightpassenger_off",
+    
+    st_mirror_slab_n = "st-mirror-p|",
+    st_mirror_slab_e = "st-mirror-p/",
+    st_mirror_slab_s = "st-mirror-p-",
+    st_mirror_slab_w = "st-mirror-p\\",
+    st_mirror_slab_nt = "st-mirror-p|t",
+    st_mirror_slab_et = "st-mirror-p/t",
+    st_mirror_slab_st = "st-mirror-p-t",
+    st_mirror_slab_wt = "st-mirror-p\\t",
+    st_mirror_slab_nm = "st-mirror-p|m",
+    st_mirror_slab_em = "st-mirror-p/m",
+    st_mirror_slab_sm = "st-mirror-p-m",
+    st_mirror_slab_wm = "st-mirror-p\\m",
+    st_mirror_slab_ntm = "st-mirror-p|tm",
+    st_mirror_slab_etm = "st-mirror-p/tm",
+    st_mirror_slab_stm = "st-mirror-p-tm",
+    st_mirror_slab_wtm = "st-mirror-p\\tm",
+    st_mirror_triangle_n = "st-mirror-3^",
+    st_mirror_triangle_e = "st-mirror-3>",
+    st_mirror_triangle_s = "st-mirror-3v",
+    st_mirror_triangle_w = "st-mirror-3<",
+    st_mirror_triangle_nt = "st-mirror-3^t",
+    st_mirror_triangle_et = "st-mirror-3>t",
+    st_mirror_triangle_st = "st-mirror-3vt",
+    st_mirror_triangle_wt = "st-mirror-3<t",
+    st_mirror_triangle_nm = "st-mirror-3^m",
+    st_mirror_triangle_em = "st-mirror-3>m",
+    st_mirror_triangle_sm = "st-mirror-3vm",
+    st_mirror_triangle_wm = "st-mirror-3<m",
+    st_mirror_triangle_ntm = "st-mirror-3^tm",
+    st_mirror_triangle_etm = "st-mirror-3>tm",
+    st_mirror_triangle_stm = "st-mirror-3vtm",
+    st_mirror_triangle_wtm = "st-mirror-3<tm",
+    
     st_monoflop = "st-timeswitch",
     st_oxyd = "st-oxyd",
     st_panel = "st-wood_001",
@@ -208,8 +242,12 @@
         enigma._SetAttrib(obj, "scissor", false)
         enigma._SetAttrib(obj, "autoclose", true)
         return obj
+    elseif name == "st-pmirror" then
+        return enigma._MakeObject("st_mirror_slab_e")
+    elseif name == "st-3mirror" then
+        return enigma._MakeObject("st_mirror_triangle_s")
     end
-
+    
     newname = RenamingObjectsOld2New[name]
     
     if name == "st-laser" then
@@ -264,6 +302,9 @@
     if string.sub(_newname, 1, 8) == "st_laser" then
         return "st-laser"
     end
+    if _newname == "it_mirror" then
+        return "st-mirror"
+    end
     if _oldname ~= nil then
         return _oldname
     else
@@ -371,6 +412,15 @@
      if key == "invisible" then
          if val == 1 then _val = true else _val = false end
      end
+     if key == "orientation" then
+         _val = (6 - val) % 4
+     end
+     if key == "transparent" then
+         if val == 1 then _val = true else _val = false end
+     end
+     if key == "movable" then
+         if val == 1 then _val = true else _val = false end
+     end
      enigma._SetAttrib(obj, _key, _val)
 end
 
@@ -456,6 +506,15 @@
      if key == "invisible" then
          if val == false then val = 0 else val = 1 end
      end
+     if key == "orientation" then
+         val = (5 - val) % 4 + 1
+     end
+     if key == "transparent" then
+         if val == false then val = 0 else val = 1 end
+     end
+     if key == "movable" then
+         if val == false then val = 0 else val = 1 end
+     end
      return val
 end
 
@@ -506,7 +565,7 @@
     ["st-stoneimpulse_movable__trigger"] = "signal",
     st_lightpassenger__trigger = "toggle",
     st_lightpassenger__onoff = "toggle",
-    ["st-mirror__trigger"] = "turn",
+    st_mirror__trigger = "turn",
     st_oxyd__trigger = "open",
     ["st-plain__trigger"] = "signal",
     ["st-plain_hole__trigger"] = "signal",

Added: trunk/data/gfx32/st-mirrortempl_0017.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-mirrortempl_0017.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx32/st-mirrortempl_0018.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-mirrortempl_0018.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx32/st-mirrortempl_0019.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-mirrortempl_0019.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx32/st-mirrortempl_0020.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-mirrortempl_0020.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st-mirrortempl_0017.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-mirrortempl_0017.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st-mirrortempl_0018.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-mirrortempl_0018.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st-mirrortempl_0019.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-mirrortempl_0019.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st-mirrortempl_0020.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-mirrortempl_0020.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st-mirrortempl_0017.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-mirrortempl_0017.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st-mirrortempl_0018.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-mirrortempl_0018.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st-mirrortempl_0019.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-mirrortempl_0019.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st-mirrortempl_0020.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-mirrortempl_0020.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-06-17 20:54:25 UTC (rev 1182)
+++ trunk/data/models-2d.lua	2008-06-18 21:41:18 UTC (rev 1183)
@@ -1613,7 +1613,7 @@
 --      st-{3mirror,pmirror}-{m,s}{o,t}[1234]
 --
 -- {m,s} -> movable or static
--- {o,t} -> opaque or transparent
+-- {o,t,f} -> opaque or pane transparent or full transparent (pane + side)
 --
 -- The numbers map to actual orientations as follows:
 --
@@ -1634,7 +1634,8 @@
     mirror3_opaque = FrameNames("st-mirrortempl", 1, 4)
     mirror3_transp = FrameNames("st-mirrortempl", 5, 8)
     mirrorp_opaque = FrameNames("st-mirrortempl", 9, 12)
-    mirrorp_transp = FrameNames("st-mirrortempl", 13, 16)
+    mirrorp_transp1 = FrameNames("st-mirrortempl", 13, 16)
+    mirrorp_transp2 = FrameNames("st-mirrortempl", 17, 20)
 
     make_mirror("st-3mirror-mo", "st-mirror-movable", mirror3_opaque)
     make_mirror("st-3mirror-so", "st-mirror-static",  mirror3_opaque)
@@ -1643,8 +1644,10 @@
 
     make_mirror("st-pmirror-mo", "st-mirror-movable", mirrorp_opaque)
     make_mirror("st-pmirror-so", "st-mirror-static",  mirrorp_opaque)
-    make_mirror("st-pmirror-mt", "st-mirror-movable", mirrorp_transp)
-    make_mirror("st-pmirror-st", "st-mirror-static",  mirrorp_transp)
+    make_mirror("st-pmirror-mt", "st-mirror-movable", mirrorp_transp1)
+    make_mirror("st-pmirror-st", "st-mirror-static",  mirrorp_transp1)
+    make_mirror("st-pmirror-mf", "st-mirror-movable", mirrorp_transp2)
+    make_mirror("st-pmirror-sf", "st-mirror-static",  mirrorp_transp2)
 end
 
 --------------------------

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-06-17 20:54:25 UTC (rev 1182)
+++ trunk/data/schemas/objects.xml	2008-06-18 21:41:18 UTC (rev 1183)
@@ -41,6 +41,7 @@
     <attr name="static" type="bool" default="false" rw="rw"/>
     <attr name="strength" type="double" default="1" rw="rw"/>
     <attr name="target" type="tokens" default="nil" rw="rw"/>
+    <attr name="transparent" type="bool" default="false" rw="rw"/>
   </attributes>
   <messages>
     <msg name="close" type="nil"/>
@@ -410,6 +411,27 @@
       <msg name="_init"/>
       <msg name="_model_reanimated"/>
     </object>
+    <object name="st_mirror">
+      <attr name="counterclock"/>
+      <attr name="flavor" default="slab"/>
+      <attr name="movable" rw="rw"/>
+      <attr name="orientation"/>
+      <attr name="transparent"/>
+      <msg name="orientate"/>
+      <msg name="signal"/>
+      <msg name="turn"/>
+      <msg name="turnback"/>
+      <msg name="_trigger"/>
+    </object>
+    <object name="st_mirror_sheets">
+      <attr name="flavor" value="sheets"/>
+    </object>
+    <object name="st_mirror_slab">
+      <attr name="flavor" value="slab"/>
+    </object>
+    <object name="st_mirror_triangle">
+      <attr name="flavor" value="triangle"/>
+    </object>
     <object name="st_monoflop">
       <attr name="interval" default="1.8"/>
       <msg name="on"/>

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-06-17 20:54:25 UTC (rev 1182)
+++ trunk/src/Makefile.am	2008-06-18 21:41:18 UTC (rev 1183)
@@ -221,6 +221,8 @@
 	stones/LaserSwitch.hh	\
 	stones/LightPassengerStone.cc	\
 	stones/LightPassengerStone.hh	\
+	stones/MirrorStone.cc	\
+	stones/MirrorStone.hh	\
 	stones/MonoFlopStone.cc	\
 	stones/MonoFlopStone.hh	\
 	stones/OxydStone.cc	\

Modified: trunk/src/enigma.cc
===================================================================
--- trunk/src/enigma.cc	2008-06-17 20:54:25 UTC (rev 1182)
+++ trunk/src/enigma.cc	2008-06-18 21:41:18 UTC (rev 1183)
@@ -84,6 +84,12 @@
     return rdir[d+1];
 }
 
+Direction next(Direction d) {
+    static Direction rdir[] = {WEST, SOUTH, EAST, NORTH, NODIR};
+    return rdir[d+1];
+}
+
+
 Direction
 direction_fromto(GridPos source, GridPos target)
 {
@@ -129,7 +135,6 @@
     return d;
 }
 
-
 /* -------------------- GridPos -------------------- */
 
 GridPos::GridPos(const ecl::V2& p) 

Modified: trunk/src/enigma.hh
===================================================================
--- trunk/src/enigma.hh	2008-06-17 20:54:25 UTC (rev 1182)
+++ trunk/src/enigma.hh	2008-06-18 21:41:18 UTC (rev 1183)
@@ -115,6 +115,7 @@
     Direction reverse (Direction d);
     Direction rotate_cw (Direction d);
     Direction rotate_ccw (Direction d);
+    Direction next(Direction d);
 
     std::string to_suffix(Direction d);
     std::string toSuffix(Direction d);

Modified: trunk/src/laser.cc
===================================================================
--- trunk/src/laser.cc	2008-06-17 20:54:25 UTC (rev 1182)
+++ trunk/src/laser.cc	2008-06-18 21:41:18 UTC (rev 1183)
@@ -262,300 +262,6 @@
 }
 
 
-/* -------------------- MirrorStone -------------------- */
-namespace
-{
-    class MirrorStone
-        : public Stone, public PhotoCell
-    {
-    protected:
-        MirrorStone(const char *name, bool movable=false, bool transparent=false);
-
-        bool is_transparent() const { return getAttr("transparent") != 0; }
-
-        void set_orientation(int o) { setAttr("orientation", o); }
-        int get_orientation() { return getAttr("orientation"); }
-
-        void emit_light(Direction dir) {
-            if (!has_dir(outdirs, dir))
-            {
-                outdirs = DirectionBits(outdirs | to_bits(dir));
-                LaserBeam::emit_from(get_pos(), dir);
-            }
-        }
-
-        void init_model();
-        void setAttr(const string& key, const Value &val);
-
-    private:
-
-        StoneTraits traits;
-
-	// Object interface.
-        virtual Value message(const Message &m);
-
-        //GridObject interface
-        DirectionBits emissionDirections() const {
-            return outdirs;
-        }
-
-        // PhotoCell interface
-        void on_recalc_start() { outdirs = NODIRBIT; }
-        void on_recalc_finish() {}
-
-        // Stone interface
-        void actor_hit(const StoneContact &sc);
-        void on_creation (GridPos p);
-        void on_removal (GridPos p);
-        bool is_transparent(Direction) const { return is_transparent(); }
-
-        // Private methods
-        void rotate_right();
-        
-        const StoneTraits &get_traits() const { return traits; }
-        
-        // Variables
-        DirectionBits outdirs;    
-    };
-}
-
-MirrorStone::MirrorStone(const char *name, bool movable, bool transparent)
-: Stone(name), outdirs(NODIRBIT)
-{
-    setAttr("transparent", transparent);
-    setAttr("movable", movable);
-    setAttr("orientation", Value(1));
-    traits.name = "st-mirror";
-    traits.id = st_INVALID;
-    traits.flags = stf_none;
-    traits.material = material_stone;
-    traits.restitution = 1.0;
-    //traits.movable is already set via setAttr("movable", ...);
-}
-
-void MirrorStone::init_model() {
-    string mname = get_kind();
-    mname += is_movable() ? "-m" : "-s";
-    mname += is_transparent() ? "t" : "o";
-    mname += char('0' + get_orientation());
-    set_model(mname);
-}
-
-Value MirrorStone::message(const Message &m) {
-    if ((m.message == "_trigger" && m.value.to_bool()) || m.message == "turn") {
-        rotate_right();
-        return Value();
-    }
-    else if (m.message == "signal") {
-        if (to_double(m.value) != 0) {
-            rotate_right();
-        }
-        return Value();
-    }
-    else if (m.message == "mirror-north") {
-        set_orientation(3);
-        init_model();
-        MaybeRecalcLight(get_pos());
-        return Value();
-    }
-    else if (m.message == "mirror-east") {
-        set_orientation(4);
-        init_model();
-        MaybeRecalcLight(get_pos());
-        return Value();
-    }
-    else if (m.message == "mirror-south") {
-        set_orientation(1);
-        init_model();
-        MaybeRecalcLight(get_pos());
-        return Value();
-    }
-    else if (m.message == "mirror-west") {
-        set_orientation(2);
-        init_model();
-        MaybeRecalcLight(get_pos());
-        return Value();
-    }
-    return Stone::message(m);
-}
-
-void MirrorStone::actor_hit(const StoneContact &sc)
-{
-    if (is_movable())
-        maybe_push_stone(sc);
-    rotate_right();
-}
-
-void MirrorStone::on_creation (GridPos p)
-{
-    photo_activate();
-    Stone::on_creation(p);
-}
-
-void MirrorStone::on_removal(GridPos p)
-{
-    photo_deactivate();
-    Stone::on_removal(p);
-}
-
-void MirrorStone::rotate_right()
-{
-    set_orientation(1+(get_orientation() % 4));
-    init_model();
-    MaybeRecalcLight(get_pos());
-    sound_event ("mirrorturn");
-}
-
-void MirrorStone::setAttr(const string& key, const Value &val) {
-    Stone::setAttr(key, val);
-    if (key == "movable")
-        traits.movable = to_bool(val) ? MOVABLE_STANDARD : MOVABLE_PERSISTENT;
-}
-    
-
-/* -------------------- Plane Mirror -------------------- */
-namespace
-{
-    class PlaneMirror : public MirrorStone {
-        CLONEOBJ(PlaneMirror);
-    public:
-        PlaneMirror(char orientation='/', bool movable=false, bool transparent=false)
-        : MirrorStone("st-pmirror", movable, transparent)
-        {
-            SetOrientation(orientation);
-        }
-    private:
-        void SetOrientation(char o) {
-            const char *a = " -\\|/";
-            MirrorStone::set_orientation(int (strchr(a,o)-a));
-        }
-        char GetOrientation() {
-            const char *a = " -\\|/";
-            return a[MirrorStone::get_orientation()];
-        }
-        void processLight(Direction dir);
-    };
-}
-
-void PlaneMirror::processLight(Direction dir) 
-{
-    char orientation = GetOrientation();
-    bool transparent = is_transparent();
-
-    switch (orientation) {
-    case '|':
-        if (dir==EAST || dir==WEST) {
-            emit_light(reverse(dir));
-            if (transparent)
-                emit_light(dir);
-        }
-        else if ((dir == NORTH || dir == SOUTH) && transparent &&
-                 server::GameCompatibility == GAMET_OXYD1) {
-            emit_light(dir);
-        }
-        break;
-    case '-':
-        if (dir==NORTH || dir==SOUTH) {
-            emit_light(reverse(dir));
-            if (transparent)
-                emit_light(dir);
-        }
-        else if ((dir == EAST || dir == WEST) && transparent &&
-                 server::GameCompatibility == GAMET_OXYD1) {
-            emit_light(dir);
-        }
-        break;
-    case '/':
-        switch(dir) {
-        case EAST: emit_light(NORTH); break;
-        case SOUTH: emit_light(WEST); break;
-        case NORTH: emit_light(EAST); break;
-        case WEST: emit_light(SOUTH); break;
-        case NODIR: break;
-        }
-        if (transparent)
-            emit_light(dir);
-        break;
-    case '\\':
-        switch(dir) {
-        case EAST: emit_light(SOUTH); break;
-        case SOUTH: emit_light(EAST); break;
-        case NORTH: emit_light(WEST); break;
-        case WEST: emit_light(NORTH); break;
-        case NODIR: break;
-        }
-        if (transparent)
-            emit_light(dir);
-        break;
-    }
-}
-
-
-/* -------------------- TriangleMirror -------------------- */
-
-namespace
-{
-    // The orientations of the TriangleMirror have an unusual definition,
-    // but we cannot change them w/o changing many levels
-    //
-    //    Flat side of the triangle
-    //    points to :                            Orientation :
-    //
-    //    WEST                                   4
-    //    SOUTH                                  3
-    //    EAST                                   2
-    //    NORTH                                  1
-
-    class TriangleMirror : public MirrorStone {
-        CLONEOBJ(TriangleMirror);
-    public:
-        TriangleMirror(char orientation='v', bool movable=false, bool transparent=false)
-        : MirrorStone("st-3mirror", movable, transparent)
-        {
-            SetOrientation (orientation);
-        }
-    private:
-
-        void SetOrientation(char o) {
-            const char *a = " v<^>";
-            MirrorStone::set_orientation( int (strchr(a,o)-a));
-        }
-
-        Direction GetOrientation() // orientation of the flat side of the mirror
-        {
-            const Direction a[] = {NODIR, NORTH, EAST, SOUTH, WEST};
-            return a[MirrorStone::get_orientation()];
-        }
-        void processLight(Direction dir);
-    };
-}
-
-void TriangleMirror::processLight(Direction beam_dir)
-    // note: 'beam_dir' is the direction where laserbeam goes to
-{
-    // direction where flat side of triangle points to
-    Direction flat_dir = GetOrientation();
-    Direction tip_dir  = reverse(flat_dir);
-
-    if (beam_dir == tip_dir) // beam hits the flat side
-        emit_light(flat_dir);
-    else if (beam_dir == flat_dir) {
-        // this is the "complicated" case where the light falls
-        // on the tip of the triangle
-        switch (beam_dir) {
-            case SOUTH: case NORTH:
-                emit_light(EAST); emit_light(WEST); break;
-            case WEST: case EAST:
-                emit_light(SOUTH); emit_light(NORTH); break;
-            case NODIR: break;
-        }
-    } else
-        emit_light(tip_dir);
-
-    if (is_transparent())
-        emit_light(beam_dir);
-}
-
 //----------------------------------------------------------------------
 // FUNCTIONS
 //----------------------------------------------------------------------
@@ -567,47 +273,8 @@
 }
 
 void InitLasers() {
-//    Register (new LaserStone);
-//    Register ("st-laser-n", new LaserStone(NORTH));
-//    Register ("st-laser-e", new LaserStone(EAST));
-//    Register ("st-laser-s", new LaserStone(SOUTH));
-//    Register ("st-laser-w", new LaserStone(WEST));
 
-    Register (new TriangleMirror);
-    Register ("st-mirror-3v", new TriangleMirror('v'));
-    Register ("st-mirror-3<", new TriangleMirror('<'));
-    Register ("st-mirror-3^", new TriangleMirror('^'));
-    Register ("st-mirror-3>", new TriangleMirror('>'));
-    Register ("st-mirror-3vm", new TriangleMirror('v', true));
-    Register ("st-mirror-3<m", new TriangleMirror('<', true));
-    Register ("st-mirror-3^m", new TriangleMirror('^', true));
-    Register ("st-mirror-3>m", new TriangleMirror('>', true));
-    Register ("st-mirror-3vt", new TriangleMirror('v', false, true));
-    Register ("st-mirror-3<t", new TriangleMirror('<', false, true));
-    Register ("st-mirror-3^t", new TriangleMirror('^', false, true));
-    Register ("st-mirror-3>t", new TriangleMirror('>', false, true));
-    Register ("st-mirror-3vtm", new TriangleMirror('v', true, true));
-    Register ("st-mirror-3<tm", new TriangleMirror('<', true, true));
-    Register ("st-mirror-3^tm", new TriangleMirror('^', true, true));
-    Register ("st-mirror-3>tm", new TriangleMirror('>', true, true));
 
-    Register (new PlaneMirror);
-    Register ("st-mirror-p|", new PlaneMirror('|'));
-    Register ("st-mirror-p/", new PlaneMirror('/'));
-    Register ("st-mirror-p-", new PlaneMirror('-'));
-    Register ("st-mirror-p\\", new PlaneMirror('\\'));
-    Register ("st-mirror-p|m", new PlaneMirror('|', true));
-    Register ("st-mirror-p/m", new PlaneMirror('/', true));
-    Register ("st-mirror-p-m", new PlaneMirror('-', true));
-    Register ("st-mirror-p\\m", new PlaneMirror('\\', true));
-    Register ("st-mirror-p|t", new PlaneMirror('|', false, true));
-    Register ("st-mirror-p/t", new PlaneMirror('/', false, true));
-    Register ("st-mirror-p-t", new PlaneMirror('-', false, true));
-    Register ("st-mirror-p\\t", new PlaneMirror('\\', false, true));
-    Register ("st-mirror-p|tm", new PlaneMirror('|', true, true));
-    Register ("st-mirror-p/tm", new PlaneMirror('/', true, true));
-    Register ("st-mirror-p-tm", new PlaneMirror('-', true, true));
-    Register ("st-mirror-p\\tm", new PlaneMirror('\\', true, true));
 }
 
 

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-06-17 20:54:25 UTC (rev 1182)
+++ trunk/src/ox_extra.cc	2008-06-18 21:41:18 UTC (rev 1183)
@@ -189,20 +189,20 @@
     "st-laser-3",        // OxydExtra stone 0x40
     UNUSED,              // OxydExtra stone 0x41
     UNUSED,              // OxydExtra stone 0x42
-    "st-mirror-p-",      // OxydExtra stone 0x43
-    "st-mirror-p\\",     // OxydExtra stone 0x44
+    "st_mirror_slab_s",  // OxydExtra stone 0x43
+    "st_mirror_slab_w",  // OxydExtra stone 0x44
     UNUSED,              // OxydExtra stone 0x45
-    "st-mirror-p/",      // OxydExtra stone 0x46
+    "st_mirror_slab_e",  // OxydExtra stone 0x46
     UNUSED,              // OxydExtra stone 0x47
     UNUSED,              // OxydExtra stone 0x48
     UNUSED,              // OxydExtra stone 0x49
     UNUSED,              // OxydExtra stone 0x4a
-    "st-mirror-p-t",     // OxydExtra stone 0x4b
+    "st_mirror_slab_st", // OxydExtra stone 0x4b
     UNUSED,              // OxydExtra stone 0x4c
-    "st-mirror-3>",      // OxydExtra stone 0x4d
-    "st-mirror-3^",      // OxydExtra stone 0x4e
-    "st-mirror-3<",      // OxydExtra stone 0x4f
-    "st-mirror-3v",      // OxydExtra stone 0x50
+    "st_mirror_triangle_ec", // OxydExtra stone 0x4d
+    "st_mirror_triangle_nc", // OxydExtra stone 0x4e
+    "st_mirror_triangle_wc", // OxydExtra stone 0x4f
+    "st_mirror_triangle_sc", // OxydExtra stone 0x50
     UNUSED,              // OxydExtra stone 0x51
     UNUSED,              // OxydExtra stone 0x52
     UNUSED,              // OxydExtra stone 0x53

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-06-17 20:54:25 UTC (rev 1182)
+++ trunk/src/ox_magnum.cc	2008-06-18 21:41:18 UTC (rev 1183)
@@ -193,22 +193,22 @@
     "st-laser-1",               // OxydMagnum stone 0x44  The laser-names are fake names!
     "st-laser-2",               // OxydMagnum stone 0x45  Direction and state are generated by Enigma.
     "st-laser-3",               // OxydMagnum stone 0x46
-    "st-mirror-p|",             // OxydMagnum stone 0x47
-    "st-mirror-p/",             // OxydMagnum stone 0x48
-    "st-mirror-p-",             // OxydMagnum stone 0x49
-    "st-mirror-p\\",            // OxydMagnum stone 0x4a
-    "st-mirror-p|m",            // OxydMagnum stone 0x4b
-    "st-mirror-p/m",            // OxydMagnum stone 0x4c
-    "st-mirror-p-m",            // OxydMagnum stone 0x4d
-    "st-mirror-p\\m",           // OxydMagnum stone 0x4e
-    "st-mirror-p|t",            // OxydMagnum stone 0x4f
-    "st-mirror-p/t",            // OxydMagnum stone 0x50
-    "st-mirror-p-t",            // OxydMagnum stone 0x51
-    "st-mirror-p\\t",           // OxydMagnum stone 0x52
-    "st-mirror-3>",             // OxydMagnum stone 0x53
-    "st-mirror-3^",             // OxydMagnum stone 0x54
-    "st-mirror-3<",             // OxydMagnum stone 0x55
-    "st-mirror-3v",             // OxydMagnum stone 0x56
+    "st_mirror_slab_n",         // OxydMagnum stone 0x47
+    "st_mirror_slab_e",         // OxydMagnum stone 0x48
+    "st_mirror_slab_s",         // OxydMagnum stone 0x49
+    "st_mirror_slab_w",         // OxydMagnum stone 0x4a
+    "st_mirror_slab_nm",        // OxydMagnum stone 0x4b
+    "st_mirror_slab_em",        // OxydMagnum stone 0x4c
+    "st_mirror_slab_sm",        // OxydMagnum stone 0x4d
+    "st_mirror_slab_wm",        // OxydMagnum stone 0x4e
+    "st_mirror_slab_nt",        // OxydMagnum stone 0x4f
+    "st_mirror_slab_et",        // OxydMagnum stone 0x50
+    "st_mirror_slab_st",        // OxydMagnum stone 0x51
+    "st_mirror_slab_wt",        // OxydMagnum stone 0x52
+    "st_mirror_triangle_ec",    // OxydMagnum stone 0x53
+    "st_mirror_triangle_nc",    // OxydMagnum stone 0x54
+    "st_mirror_triangle_wc",    // OxydMagnum stone 0x55
+    "st_mirror_triangle_sc",    // OxydMagnum stone 0x56
     "st-puzzle2-es",            // Oxyd1 stone 0x57
     "st-puzzle2-sw",            // Oxyd1 stone 0x58
     "st-puzzle2-nw",            // Oxyd1 stone 0x59

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-06-17 20:54:25 UTC (rev 1182)
+++ trunk/src/ox_oxyd1.cc	2008-06-18 21:41:18 UTC (rev 1183)
@@ -223,22 +223,22 @@
     "st-laser-1",               // Oxyd1 stone 0x44  The laser-names are fake names!
     "st-laser-2",               // Oxyd1 stone 0x45  Direction and state are generated by Enigma.
     "st-laser-3",               // Oxyd1 stone 0x46
-    "st-mirror-p|",             // Oxyd1 stone 0x47
-    "st-mirror-p/",             // Oxyd1 stone 0x48
-    "st-mirror-p-",             // Oxyd1 stone 0x49
-    "st-mirror-p\\",            // Oxyd1 stone 0x4a
-    "st-mirror-p|m",            // Oxyd1 stone 0x4b
-    "st-mirror-p/m",            // Oxyd1 stone 0x4c
-    "st-mirror-p-m",            // Oxyd1 stone 0x4d
-    "st-mirror-p\\m",           // Oxyd1 stone 0x4e
-    "st-mirror-p|t",            // Oxyd1 stone 0x4f
-    "st-mirror-p/t",            // Oxyd1 stone 0x50
-    "st-mirror-p-t",            // Oxyd1 stone 0x51
-    "st-mirror-p\\t",           // Oxyd1 stone 0x52
-    "st-mirror-3>",             // Oxyd1 stone 0x53
-    "st-mirror-3^",             // Oxyd1 stone 0x54
-    "st-mirror-3<",             // Oxyd1 stone 0x55
-    "st-mirror-3v",             // Oxyd1 stone 0x56
+    "st_mirror_slab_n",         // Oxyd1 stone 0x47
+    "st_mirror_slab_e",         // Oxyd1 stone 0x48
+    "st_mirror_slab_s",         // Oxyd1 stone 0x49
+    "st_mirror_slab_w",         // Oxyd1 stone 0x4a
+    "st_mirror_slab_nm",        // Oxyd1 stone 0x4b
+    "st_mirror_slab_em",        // Oxyd1 stone 0x4c
+    "st_mirror_slab_sm",        // Oxyd1 stone 0x4d
+    "st_mirror_slab_wm",        // Oxyd1 stone 0x4e
+    "st_mirror_slab_nt",        // Oxyd1 stone 0x4f
+    "st_mirror_slab_et",        // Oxyd1 stone 0x50
+    "st_mirror_slab_st",        // Oxyd1 stone 0x51
+    "st_mirror_slab_wt",        // Oxyd1 stone 0x52
+    "st_mirror_triangle_ec",    // Oxyd1 stone 0x53
+    "st_mirror_triangle_nc",    // Oxyd1 stone 0x54
+    "st_mirror_triangle_wc",    // Oxyd1 stone 0x55
+    "st_mirror_triangle_sc",    // Oxyd1 stone 0x56
     "st-puzzle2-es",            // Oxyd1 stone 0x57
     "st-puzzle2-sw",            // Oxyd1 stone 0x58
     "st-puzzle2-nw",            // Oxyd1 stone 0x59

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-06-17 20:54:25 UTC (rev 1182)
+++ trunk/src/ox_peroxyd.cc	2008-06-18 21:41:18 UTC (rev 1183)
@@ -259,22 +259,22 @@
     "st-laser-1",               // PerOxyd stone 0x3e  The laser-names are fake names!
     "st-laser-2",               // PerOxyd stone 0x3f  Direction and state are generated by Enigma.
     "st-laser-3",               // PerOxyd stone 0x40
-    "st-mirror-p|",             // PerOxyd stone 0x41
-    "st-mirror-p/",             // PerOxyd stone 0x42
-    "st-mirror-p-",             // PerOxyd stone 0x43
-    "st-mirror-p\\",            // PerOxyd stone 0x44
+    "st_mirror_slab_n",         // PerOxyd stone 0x41
+    "st_mirror_slab_e",         // PerOxyd stone 0x42
+    "st_mirror_slab_s",         // PerOxyd stone 0x43
+    "st_mirror_slab_w",         // PerOxyd stone 0x44
     UNUSED,                     // PerOxyd stone 0x45
-    "st-mirror-p/m",            // PerOxyd stone 0x46
-    "st-mirror-p-m",            // PerOxyd stone 0x47
-    "st-mirror-p\\m",           // PerOxyd stone 0x48
-    "st-mirror-p|t",            // PerOxyd stone 0x49
-    "st-mirror-p/t",            // PerOxyd stone 0x4a
-    "st-mirror-p-t",            // PerOxyd stone 0x4b
-    "st-mirror-p\\t",           // PerOxyd stone 0x4c
-    "st-mirror-3>",             // PerOxyd stone 0x4d
-    "st-mirror-3^",             // PerOxyd stone 0x4e
-    "st-mirror-3<",             // PerOxyd stone 0x4f
-    "st-mirror-3v",             // PerOxyd stone 0x50
+    "st_mirror_slab_em",        // PerOxyd stone 0x46
+    "st_mirror_slab_sm",        // PerOxyd stone 0x47
+    "st_mirror_slab_wm",        // PerOxyd stone 0x48
+    "st_mirror_slab_nt",        // PerOxyd stone 0x49
+    "st_mirror_slab_et",        // PerOxyd stone 0x4a
+    "st_mirror_slab_st",        // PerOxyd stone 0x4b
+    "st_mirror_slab_wt",        // PerOxyd stone 0x4c
+    "st_mirror_triangle_ec",    // PerOxyd stone 0x4d
+    "st_mirror_triangle_nc",    // PerOxyd stone 0x4e
+    "st_mirror_triangle_wc",    // PerOxyd stone 0x4f
+    "st_mirror_triangle_sc",    // PerOxyd stone 0x50
     "st-puzzle-es",             // PerOxyd stone 0x51
     "st-puzzle-sw",             // PerOxyd stone 0x52
     "st-puzzle-nw",             // PerOxyd stone 0x53

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-06-17 20:54:25 UTC (rev 1182)
+++ trunk/src/stones.hh	2008-06-18 21:41:18 UTC (rev 1183)
@@ -66,6 +66,7 @@
         st_knight,
         st_laserbreak,
         st_magic,
+        st_mirror,
         st_movebreak,
         st_oneway,
         st_oneway_black,



From ral at mail.berlios.de  Thu Jun 19 00:50:11 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Thu, 19 Jun 2008 00:50:11 +0200
Subject: [Enigma-game-svn] r1184 - in trunk/src: . stones
Message-ID: <200806182250.m5IMoB3Q010923@sheep.berlios.de>

Author: ral
Date: 2008-06-19 00:49:49 +0200 (Thu, 19 Jun 2008)
New Revision: 1184

Added:
   trunk/src/stones/MirrorStone.cc
   trunk/src/stones/MirrorStone.hh
Modified:
   trunk/src/laser.cc
   trunk/src/laser.hh
   trunk/src/stones_complex.cc
Log:
Trunk 1.1: new API reengineering Mirror 
- now the missing MirrorStone sources
- switched PuzzleStone from PhotoCell to new GridStone methods
- removed PhotoCell


Modified: trunk/src/laser.cc
===================================================================
--- trunk/src/laser.cc	2008-06-18 21:41:18 UTC (rev 1183)
+++ trunk/src/laser.cc	2008-06-18 22:49:49 UTC (rev 1184)
@@ -40,62 +40,6 @@
 
 
 
-/* -------------------- PhotoCell -------------------- */
-
-vector<void*> PhotoCell::instances;
-
-PhotoCell::~PhotoCell() 
-{
-    photo_deactivate();
-}
-
-
-/**
- * This function notifies all instances of PhotoCell that a
- * recalculation of the laser beams is about to begin by calling
- * on_recalc_start() for each instance.
- */
-void PhotoCell::notify_start()
-{
-    for(unsigned i=0; i<instances.size(); ++i)
-    {
-        PhotoCell *pc = (PhotoCell*) instances[i];
-        pc->on_recalc_start();
-    }
-}
-
-/**
- * This function notifies all instances of PhotoCell that the engine
- * has finished recalculating the laser beams by calling
- * on_recalc_finish() for each instance.
- */
-void PhotoCell::notify_finish()
-{
-    for(unsigned i=0; i<instances.size(); ++i)
-    {
-        PhotoCell *pc = (PhotoCell*) instances[i];
-        pc->on_recalc_finish();
-    }
-}
-
-void PhotoCell::photo_activate()
-{
-    vector<void*>::iterator i = std::find(instances.begin(), instances.end(), this);
-    if (i != instances.end())
-        assert (0 || "Photocell activated twice\n");
-    else
-        instances.push_back (this);
-}
-
-void PhotoCell::photo_deactivate()
-{
-    vector<void*>::iterator i;
-    i = std::find (instances.begin(), instances.end(), this);
-    if (i != instances.end())
-        instances.erase(i);
-}
-
-
 /* -------------------- LaserBeam -------------------- */
 
 // The implementation of laser beams is a little tricky because, in
@@ -302,7 +246,6 @@
 void PerformRecalcLight(bool isInit) {
     if (light_recalc_scheduled) {
         light_recalc_scheduled = false;    // this is the right place - but we have first to fix some object like hammer,...
-        PhotoCell::notify_start();
         GridObject::preLaserRecalc();
         LaserBeam::kill_all();
         LaserStone::reemit_all();
@@ -310,7 +253,6 @@
         if (!isInit)
             // do not cause actions on initial laser beam generation
             GridObject::postLaserRecalc();
-        PhotoCell::notify_finish();
 //        light_recalc_scheduled = false;
     }
 }

Modified: trunk/src/laser.hh
===================================================================
--- trunk/src/laser.hh	2008-06-18 21:41:18 UTC (rev 1183)
+++ trunk/src/laser.hh	2008-06-18 22:49:49 UTC (rev 1184)
@@ -29,41 +29,6 @@
 
 namespace enigma {
 
-/* -------------------- PhotoCell -------------------- */
-
-    /**
-     * PhotoCells are objects (not necessarily stones) that are
-     * sensitive to laser light.  Whenever the game engine
-     * recalculates the laser beams, instances of this class are
-     * notified about the beginning and the end of a recalculation.
-     */
-    class PhotoCell {
-    public:
-        virtual ~PhotoCell();
-
-        // ---------- Static functions ----------
-        static void notify_start();
-        static void notify_finish();
-
-        // ---------- PhotoCell interface ----------
-        virtual void on_recalc_start() = 0;
-        virtual void on_recalc_finish() = 0;
-    protected:
-
-        /*! Derived classes must call this method to register
-          themselves for the on_recalc_start() and on_recalc_finish()
-          events. */
-        void photo_activate();
-
-        /*! Derived classes must call this method to unregister
-          themselves.  It is automatically called by ~PhotoCell(), but
-          objects may have to call it explicitly if they are not
-          interested in PhotoCell events. */
-        void photo_deactivate();
-    private:
-        static std::vector<void*> instances;
-    };
-
 /* -------------------- LaserBeam -------------------- */
 
     class LaserBeam : public Item {

Added: trunk/src/stones/MirrorStone.cc
===================================================================
--- trunk/src/stones/MirrorStone.cc	2008-06-18 21:41:18 UTC (rev 1183)
+++ trunk/src/stones/MirrorStone.cc	2008-06-18 22:49:49 UTC (rev 1184)
@@ -0,0 +1,298 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/MirrorStone.hh"
+
+//#include "main.hh"
+#include "laser.hh"
+#include "player.hh"
+
+namespace enigma {
+
+    MirrorStone::MirrorStone(bool isTriangle, bool isMovable, bool paneTransparent, bool sideTransparent, 
+            Direction dir, bool counterclock) : Stone() {
+        state = dir;
+        if (isTriangle)
+            objFlags |= OBJBIT_TRIANGLE;
+        if (isMovable)
+            objFlags |= OBJBIT_MOVABLE;
+        if (paneTransparent)
+            objFlags |= OBJBIT_PANE;
+        if (sideTransparent)
+            objFlags |= OBJBIT_SIDE;
+        if (counterclock)
+            setAttr("counterclock", true);
+    }
+    
+    std::string MirrorStone::getClass() const {
+        return "st_mirror";
+    }
+    
+    void MirrorStone::setAttr(const string& key, const Value &val) {
+        bool newModel = false;
+        bool lightChange = false;
+        bool handled = false;
+        if (key == "movable") {
+            if (val.to_bool() != ((objFlags & OBJBIT_MOVABLE) != 0)) {
+                objFlags ^=  OBJBIT_MOVABLE;
+                newModel = true;
+                handled = true;
+            }
+        } else if (key == "flavor") {
+            if (val.to_string() == "triangle" && !(objFlags & OBJBIT_TRIANGLE)) {
+                objFlags |= OBJBIT_TRIANGLE;
+                objFlags &= ~OBJBIT_SIDE;
+                newModel = true;
+                lightChange = true;
+                handled = true;
+            } else if (val.to_string() == "slab" && ((objFlags & OBJBIT_TRIANGLE) || (objFlags & OBJBIT_SIDE))) {
+                objFlags &= ~OBJBIT_TRIANGLE;
+                objFlags &= ~OBJBIT_SIDE;
+                newModel = true;
+                lightChange = true;
+                handled = true;
+            } else if (val.to_string() == "sheets" && ((objFlags & OBJBIT_TRIANGLE) || !(objFlags & OBJBIT_SIDE))) {
+                objFlags &= ~OBJBIT_TRIANGLE;
+                objFlags |= OBJBIT_SIDE;
+                objFlags |= OBJBIT_PANE;  // sheets are always semi transparent
+                newModel = true;
+                lightChange = true;
+                handled = true;
+            }
+        } else if (key == "orientation") {
+            if (val >= minState() && val <= maxState()) {
+                setState(val);
+                handled = true;
+            }
+        } else if (key == "transparent") {
+            if ((val.to_bool() != ((objFlags & OBJBIT_PANE) != 0)) && !(objFlags & OBJBIT_SIDE)) {
+                objFlags ^=  OBJBIT_PANE;
+                newModel = true;
+                lightChange = true;
+                handled = true;
+            }
+        }
+        
+        if (isDisplayable()) {
+            if (newModel)
+                init_model();
+            if (lightChange)
+                RecalcLight();
+        }
+        
+        if (!handled)
+            Stone::setAttr(key, val);
+    }
+    
+    Value MirrorStone::getAttr(const std::string &key) const {
+        if (key == "movable") {
+            return (bool)(objFlags & OBJBIT_MOVABLE);
+        } else if (key == "flavor") {
+            return (objFlags & OBJBIT_TRIANGLE) ? "triangle" : ((objFlags & OBJBIT_SIDE) ? "sheets" : "slab");
+        } else if (key == "orientation") {
+            return state;
+        } else if (key == "transparent") {
+            return (bool)(objFlags & OBJBIT_PANE);
+        }
+        return Stone::getAttr(key);
+    }
+    
+    Value MirrorStone::message(const Message &m) {
+        if (m.message == "orientate") {
+            setAttr("orientation", m.value);
+            return Value();
+        } else if ((m.message == "turn" || m.message == "turnback")) {
+            setAttr("orientation", (m.message == "turn" && !getAttr("counterclock").to_bool() || 
+                    m.message == "turnback" && getAttr("counterclock").to_bool())
+                    ? rotate_cw((Direction)state) : rotate_ccw((Direction)state));
+            return Value();
+        } else if (m.message == "signal") {
+            if (m.value == 1)
+                toggleState();
+            return Value();
+        } else if (m.message == "_trigger") {
+            if (m.value == 1)
+                toggleState();                
+            return Value();
+        }
+        return Stone::message(m);
+    }
+    
+
+    int MirrorStone::maxState() const {
+        return 3;  // dir representing state
+    }
+
+    void MirrorStone::setState(int extState) {
+        bool changed = (extState != state);
+        
+        state = extState;
+        
+        if (isDisplayable()) {
+            init_model();
+            RecalcLight();
+        }
+     }
+    
+    void MirrorStone::toggleState() {
+        setState(!getAttr("counterclock").to_bool() ? rotate_cw((Direction)state) : rotate_ccw((Direction)state));
+    }
+
+    void MirrorStone::init_model()  {
+        // the models are still encoded in the old API notation
+        set_model(ecl::strf("st-%cmirror-%c%c%d", 
+                (objFlags & OBJBIT_TRIANGLE) ? '3' : 'p',
+                (objFlags & OBJBIT_MOVABLE)  ? 'm' : 's',
+                (objFlags & OBJBIT_PANE) ? ((objFlags & OBJBIT_SIDE) ? 'f' : 't') : 'o',
+                ((5 - state) % 4) + 1));
+    }
+    
+    void MirrorStone::on_creation(GridPos p) {
+        activatePhoto();
+        Stone::on_creation(p);
+    }
+        
+    void MirrorStone::processLight(Direction d) {
+        DirectionBits oldOutDirs = emissionDirections();
+        Stone::processLight(d);
+        DirectionBits newOutDirs = emissionDirections();
+        if (oldOutDirs != newOutDirs) {
+            // emit light to new dirs
+            for (Direction newDir = WEST; newDir != NODIR; newDir = next(newDir)) {
+                 DirectionBits newDirBit = to_bits(newDir);
+                 if (!(oldOutDirs & newDirBit) && (newOutDirs & newDirBit))
+                    LaserBeam::emit_from(get_pos(), newDir);
+            }
+        }
+    }
+    
+    DirectionBits MirrorStone::emissionDirections() const {
+        static uint16_t outDirs[] = {
+            ((WESTBIT)<<12) + ((SOUTHBIT)<<8) + ((EASTBIT)<<4) + (NORTHBIT),   // no side, no pane, planar, '\'
+            ((SOUTHBIT)<<12) + ((NODIRBIT)<<8) + ((NORTHBIT)<<4) + (NODIRBIT), // no side, no pane, planar, '-'
+            ((EASTBIT)<<12) + ((NORTHBIT)<<8) + ((WESTBIT)<<4) + (SOUTHBIT),   // no side, no pane, planar, '/'
+            ((NODIRBIT)<<12) + ((WESTBIT)<<8) + ((NODIRBIT)<<4) + (EASTBIT),   // no side, no pane, planar, '|'
+            ((WESTBIT)<<12) + ((NORTHBIT+SOUTHBIT)<<8) + ((WESTBIT)<<4) + (EASTBIT),    // no side, no pane, triangle,'<'
+            ((WESTBIT+EASTBIT)<<12) + ((SOUTHBIT)<<8) + ((NORTHBIT)<<4) + (SOUTHBIT),   // no side, no pane, triangle,'v'
+            ((EASTBIT)<<12) + ((WESTBIT)<<8) + ((EASTBIT)<<4) + (NORTHBIT+SOUTHBIT),    // no side, no pane, triangle,'>'
+            ((SOUTHBIT)<<12) + ((NORTHBIT)<<8) + ((WESTBIT+EASTBIT)<<4) + (NORTHBIT),   // no side, no pane, triangle,'^'
+            ((WESTBIT+NORTHBIT)<<12) + ((SOUTHBIT+EASTBIT)<<8) + ((EASTBIT+SOUTHBIT)<<4) + (NORTHBIT+WESTBIT),   // no side, pane, planar, '\'
+            ((SOUTHBIT+NORTHBIT)<<12) + ((NODIRBIT)<<8) + ((NORTHBIT+SOUTHBIT)<<4) + (NODIRBIT), // no side, pane, planar, '-'
+            ((EASTBIT+NORTHBIT)<<12) + ((NORTHBIT+EASTBIT)<<8) + ((WESTBIT+SOUTHBIT)<<4) + (SOUTHBIT+WESTBIT),   // no side, pane, planar, '/'
+            ((NODIRBIT)<<12) + ((WESTBIT+EASTBIT)<<8) + ((NODIRBIT)<<4) + (EASTBIT+WESTBIT),   // no side, pane, planar, '|'
+            ((WESTBIT+NORTHBIT)<<12) + ((NORTHBIT+SOUTHBIT+EASTBIT)<<8) + ((WESTBIT+SOUTHBIT)<<4) + (EASTBIT+WESTBIT),     // no side, pane, triangle,'<'
+            ((WESTBIT+EASTBIT+NORTHBIT)<<12) + ((SOUTHBIT+EASTBIT)<<8) + ((NORTHBIT+SOUTHBIT)<<4) + (SOUTHBIT+WESTBIT),   // no side, pane, triangle,'v'
+            ((EASTBIT+NORTHBIT)<<12) + ((WESTBIT+EASTBIT)<<8) + ((EASTBIT+SOUTHBIT)<<4) + (NORTHBIT+SOUTHBIT+WESTBIT),    // no side, pane, triangle,'>'
+            ((SOUTHBIT+NORTHBIT)<<12) + ((NORTHBIT+EASTBIT)<<8) + ((WESTBIT+EASTBIT+SOUTHBIT)<<4) + (NORTHBIT+WESTBIT),   // no side, pane, triangle,'^'
+            0,0,0,0,  // side, no pane, planar
+            0,0,0,0,  // side, no pane, triangle
+            ((WESTBIT+NORTHBIT)<<12) + ((SOUTHBIT+EASTBIT)<<8) + ((EASTBIT+SOUTHBIT)<<4) + (NORTHBIT+WESTBIT),   // side, pane, planar, '\'
+            ((SOUTHBIT+NORTHBIT)<<12) + ((EASTBIT)<<8) + ((NORTHBIT+SOUTHBIT)<<4) + (WESTBIT), // side, pane, planar, '-'
+            ((EASTBIT+NORTHBIT)<<12) + ((NORTHBIT+EASTBIT)<<8) + ((WESTBIT+SOUTHBIT)<<4) + (SOUTHBIT+WESTBIT),   // side, pane, planar, '/'
+            ((NORTHBIT)<<12) + ((WESTBIT+EASTBIT)<<8) + ((SOUTHBIT)<<4) + (EASTBIT+WESTBIT),   // side, pane, planar, '|'
+            0,0,0,0  // side, pane, triangle
+        };
+        int index = ((objFlags>>22) & 0x1C) | state; // 5 bit index: OBJBIT_SIDE - OBJBIT_PANE - OBJBIT_TRIANGLE - 2bit orientation
+        uint16_t outCandidates = outDirs[index];
+        DirectionBits result = NODIRBIT;
+        if (objFlags & NORTHBIT)
+            result = (DirectionBits)(result | (outCandidates>>12) & ALL_DIRECTIONS);
+        if (objFlags & EASTBIT)
+            result = (DirectionBits)(result | (outCandidates>>8) & ALL_DIRECTIONS);
+        if (objFlags & SOUTHBIT)
+            result = (DirectionBits)(result | (outCandidates>>4) & ALL_DIRECTIONS);
+        if (objFlags & WESTBIT)
+            result = (DirectionBits)(result | (outCandidates) & ALL_DIRECTIONS);
+        
+        return result;
+    }
+
+    void MirrorStone::actor_hit(const StoneContact &sc) {
+        if (objFlags & OBJBIT_MOVABLE)
+            maybe_push_stone(sc);
+        if (player::WieldedItemIs (sc.actor, "it_wrench")) 
+            setState(!getAttr("counterclock").to_bool() ? rotate_ccw((Direction)state) : rotate_cw((Direction)state));
+        else
+            toggleState();
+    }
+
+    int MirrorStone::traitsIdx() const {
+        return (objFlags & OBJBIT_MOVABLE) ? 1 : 0;
+    }
+
+    StoneTraits MirrorStone::traits[2] = {
+        {"st_mirror", st_mirror, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_mirror", st_mirror, stf_none, material_stone, 1.0, MOVABLE_STANDARD},
+    };
+    BOOT_REGISTER_START
+        BootRegister(new MirrorStone(false, false, false, false, NORTH), "st_mirror");
+        BootRegister(new MirrorStone(false, false, false, false, NORTH), "st_mirror_slab");
+        BootRegister(new MirrorStone(true, false, false, false,  NORTH), "st_mirror_triangle");
+        BootRegister(new MirrorStone(false, false, true, true, NORTH), "st_mirror_sheets");
+        BootRegister(new MirrorStone(false, false, false, false, NORTH), "st_mirror_slab_n");
+        BootRegister(new MirrorStone(false, false, false, false, EAST), "st_mirror_slab_e");
+        BootRegister(new MirrorStone(false, false, false, false, SOUTH), "st_mirror_slab_s");
+        BootRegister(new MirrorStone(false, false, false, false, WEST), "st_mirror_slab_w");
+        BootRegister(new MirrorStone(false, false, true, false, NORTH), "st_mirror_slab_nt");
+        BootRegister(new MirrorStone(false, false, true, false, EAST), "st_mirror_slab_et");
+        BootRegister(new MirrorStone(false, false, true, false, SOUTH), "st_mirror_slab_st");
+        BootRegister(new MirrorStone(false, false, true, false, WEST), "st_mirror_slab_wt");
+        BootRegister(new MirrorStone(false, true, false, false, NORTH), "st_mirror_slab_nm");
+        BootRegister(new MirrorStone(false, true, false, false, EAST), "st_mirror_slab_em");
+        BootRegister(new MirrorStone(false, true, false, false, SOUTH), "st_mirror_slab_sm");
+        BootRegister(new MirrorStone(false, true, false, false, WEST), "st_mirror_slab_wm");
+        BootRegister(new MirrorStone(false, true, true, false, NORTH), "st_mirror_slab_ntm");
+        BootRegister(new MirrorStone(false, true, true, false, EAST), "st_mirror_slab_etm");
+        BootRegister(new MirrorStone(false, true, true, false, SOUTH), "st_mirror_slab_stm");
+        BootRegister(new MirrorStone(false, true, true, false, WEST), "st_mirror_slab_wtm");
+        BootRegister(new MirrorStone(true, false, false, false, NORTH), "st_mirror_triangle_n");
+        BootRegister(new MirrorStone(true, false, false, false, EAST), "st_mirror_triangle_e");
+        BootRegister(new MirrorStone(true, false, false, false, SOUTH), "st_mirror_triangle_s");
+        BootRegister(new MirrorStone(true, false, false, false, WEST), "st_mirror_triangle_w");
+        BootRegister(new MirrorStone(true, false, true, false, NORTH), "st_mirror_triangle_nt");
+        BootRegister(new MirrorStone(true, false, true, false, EAST), "st_mirror_triangle_et");
+        BootRegister(new MirrorStone(true, false, true, false, SOUTH), "st_mirror_triangle_st");
+        BootRegister(new MirrorStone(true, false, true, false, WEST), "st_mirror_triangle_wt");
+        BootRegister(new MirrorStone(true, true, false, false, NORTH), "st_mirror_triangle_nm");
+        BootRegister(new MirrorStone(true, true, false, false, EAST), "st_mirror_triangle_em");
+        BootRegister(new MirrorStone(true, true, false, false, SOUTH), "st_mirror_triangle_sm");
+        BootRegister(new MirrorStone(true, true, false, false, WEST), "st_mirror_triangle_wm");
+        BootRegister(new MirrorStone(true, true, true, false, NORTH), "st_mirror_triangle_ntm");
+        BootRegister(new MirrorStone(true, true, true, false, EAST), "st_mirror_triangle_etm");
+        BootRegister(new MirrorStone(true, true, true, false, SOUTH), "st_mirror_triangle_stm");
+        BootRegister(new MirrorStone(true, true, true, false, WEST), "st_mirror_triangle_wtm");
+        BootRegister(new MirrorStone(true, false, false, false, NORTH, true), "st_mirror_triangle_nc");
+        BootRegister(new MirrorStone(true, false, false, false, EAST, true), "st_mirror_triangle_ec");
+        BootRegister(new MirrorStone(true, false, false, false, SOUTH, true), "st_mirror_triangle_sc");
+        BootRegister(new MirrorStone(true, false, false, false, WEST, true), "st_mirror_triangle_wc");
+        BootRegister(new MirrorStone(true, false, true, false, NORTH, true), "st_mirror_triangle_ntc");
+        BootRegister(new MirrorStone(true, false, true, false, EAST, true), "st_mirror_triangle_etc");
+        BootRegister(new MirrorStone(true, false, true, false, SOUTH, true), "st_mirror_triangle_stc");
+        BootRegister(new MirrorStone(true, false, true, false, WEST, true), "st_mirror_triangle_wtc");
+        BootRegister(new MirrorStone(true, true, false, false, NORTH, true), "st_mirror_triangle_nmc");
+        BootRegister(new MirrorStone(true, true, false, false, EAST, true), "st_mirror_triangle_emc");
+        BootRegister(new MirrorStone(true, true, false, false, SOUTH, true), "st_mirror_triangle_smc");
+        BootRegister(new MirrorStone(true, true, false, false, WEST, true), "st_mirror_triangle_wmc");
+        BootRegister(new MirrorStone(true, true, true, false, NORTH, true), "st_mirror_triangle_ntmc");
+        BootRegister(new MirrorStone(true, true, true, false, EAST, true), "st_mirror_triangle_etmc");
+        BootRegister(new MirrorStone(true, true, true, false, SOUTH, true), "st_mirror_triangle_stmc");
+        BootRegister(new MirrorStone(true, true, true, false, WEST, true), "st_mirror_triangle_wtmc");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/MirrorStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/MirrorStone.hh
===================================================================
--- trunk/src/stones/MirrorStone.hh	2008-06-18 21:41:18 UTC (rev 1183)
+++ trunk/src/stones/MirrorStone.hh	2008-06-18 22:49:49 UTC (rev 1184)
@@ -0,0 +1,75 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef MIRRORSTONE_HH
+#define MIRRORSTONE_HH
+
+#include "stones.hh"
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     * 
+     */
+    class MirrorStone : public Stone {
+         CLONEOBJ(MirrorStone);
+         DECL_TRAITS_ARRAY(2, traitsIdx());
+    private:
+        enum iState {
+        };
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_TRIANGLE =   1<<24,    ///< 
+            OBJBIT_PANE     =   1<<25,    ///< transparency of mirror panes 
+            OBJBIT_SIDE     =   1<<26,    ///< transparency of mirror sides (just planar mirror)
+            OBJBIT_MOVABLE  =   1<<27     ///<  
+        };
+
+    public:
+        MirrorStone(bool isTriangle, bool isMovable, bool paneTransparent, bool sideTransparent, 
+                Direction dir=EAST, bool counterclock=false);
+
+        // Object interface
+        virtual std::string getClass() const;
+        virtual void setAttr(const string& key, const Value &val);
+        virtual Value getAttr(const std::string &key) const;
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual int maxState() const;
+        virtual void setState(int extState);
+        virtual void toggleState();
+
+        // GridObject interface
+        virtual void init_model();
+        virtual void on_creation(GridPos p);
+        virtual void processLight(Direction d);   // direction of laserbeam
+        virtual DirectionBits emissionDirections() const;
+        
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+               
+    private:
+        // Private methods.
+        int traitsIdx() const;
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/MirrorStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2008-06-18 21:41:18 UTC (rev 1183)
+++ trunk/src/stones_complex.cc	2008-06-18 22:49:49 UTC (rev 1184)
@@ -509,11 +509,14 @@
 */
 namespace
 {
-    class PuzzleStone : public ConnectiveStone, public TimeHandler, public PhotoCell {
+    class PuzzleStone : public ConnectiveStone, public TimeHandler {
         INSTANCELISTOBJ(PuzzleStone);
         DECL_TRAITS;
     public:
         PuzzleStone(int connections, bool oxyd1_compatible_);  
+        
+        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
+        
     protected:
         virtual ~PuzzleStone() {
             GameTimer.remove_alarm (this);
@@ -553,19 +556,12 @@
 
         void alarm();
 
-        /* ---------- PhotoCell interface ---------- */
-
-        void on_recalc_start();
-        void on_recalc_finish();
-
         /* ---------- Stone interface ---------- */
 
         virtual Value message(const Message &m);
 
         void on_creation (GridPos p);
-        void on_removal (GridPos p);
         void on_impulse (const Impulse& impulse);
-        void processLight(Direction dir);
 
         bool is_floating() const;
 
@@ -576,17 +572,15 @@
         /* ---------- Variables ---------- */
         bool visited;           // flag for DFS
         enum { IDLE, EXPLODING } state;
-        DirectionBits illumination; // last state of surrounding laser beams
     };
     DEF_TRAITSM(PuzzleStone, "st-puzzle", st_puzzle, MOVABLE_IRREGULAR);
 }
 
 PuzzleStone::InstanceList PuzzleStone::instances;
 
-PuzzleStone::PuzzleStone(int connections, bool oxyd1_compatible_)
-: ConnectiveStone(connections), 
-  state (IDLE), 
-  illumination (NODIRBIT)
+PuzzleStone::PuzzleStone(int connections, bool oxyd1_compatible_) : ConnectiveStone(connections), 
+  state (IDLE)
+//  illumination (NODIRBIT)
 {
     setAttr("oxyd", int(oxyd1_compatible_));
 }
@@ -1012,34 +1006,18 @@
 }
 
 void PuzzleStone::on_creation (GridPos p) {
-    photo_activate();
+    activatePhoto();
     ConnectiveStone::on_creation (p);
-    illumination = NODIRBIT;
 }
 
-void PuzzleStone::on_removal(GridPos p) {
-    photo_deactivate();
-    ConnectiveStone::on_removal(p);
-}
 
-void PuzzleStone::processLight(Direction dir) {
-    ecl::set_flags (illumination, to_bits(reverse(dir)));
-}
-
-void PuzzleStone::on_recalc_start() {
-    illumination = NODIRBIT;
-}
-
-void PuzzleStone::on_recalc_finish() {
-    if (illumination != (ALL_DIRECTIONS+1) && 
-        illumination != NODIRBIT && 
-        state == IDLE) 
-    {
+void PuzzleStone::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
+    if (state == IDLE && newDirs != NODIRBIT) {
         if (!explode_complete_cluster() && oxyd1_compatible()) {
-            if (illumination & NORTHBIT) maybe_rotate_cluster(SOUTH);
-            if (illumination & SOUTHBIT) maybe_rotate_cluster(NORTH);
-            if (illumination & EASTBIT)  maybe_rotate_cluster(WEST);
-            if (illumination & WESTBIT)  maybe_rotate_cluster(EAST);
+            if (newDirs & SOUTHBIT) maybe_rotate_cluster(SOUTH);
+            if (newDirs & NORTHBIT) maybe_rotate_cluster(NORTH);
+            if (newDirs & WESTBIT)  maybe_rotate_cluster(WEST);
+            if (newDirs & EASTBIT)  maybe_rotate_cluster(EAST);
         }
     }
 }



From ral at mail.berlios.de  Thu Jun 19 00:55:02 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Thu, 19 Jun 2008 00:55:02 +0200
Subject: [Enigma-game-svn] r1185 - team_levelpacks/team_test_new_api
Message-ID: <200806182255.m5IMt2Ot017883@sheep.berlios.de>

Author: ral
Date: 2008-06-19 00:54:50 +0200 (Thu, 19 Jun 2008)
New Revision: 1185

Added:
   team_levelpacks/team_test_new_api/ralT051_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT042_1.xml
Log:
Test Level new API:
- added demo level for MirrorStone


Modified: team_levelpacks/team_test_new_api/ralT042_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT042_1.xml	2008-06-18 22:49:49 UTC (rev 1184)
+++ team_levelpacks/team_test_new_api/ralT042_1.xml	2008-06-18 22:54:50 UTC (rev 1185)
@@ -22,6 +22,7 @@
 ti[" "] = {"fl-sahara"}
 ti["."] = {"fl-ice"}
 ti["c"] = {"it_cross"}
+ti["v"] = {"it-cherry"}
 
 ti["A"] = {"#ac-blackball"}
 
@@ -57,7 +58,7 @@
 "                s   ",
 "E     w    lW       ",
 "    iM              ",
-"          Ahmbppp   ",
+"          Ahmbpppv  ",
 " ww     S       g   ",
 "E        w          ",
 "E    w              ",

Added: team_levelpacks/team_test_new_api/ralT051_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT051_1.xml	2008-06-18 22:49:49 UTC (rev 1184)
+++ team_levelpacks/team_test_new_api/ralT051_1.xml	2008-06-18 22:54:50 UTC (rev 1185)
@@ -0,0 +1,73 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Mirrors new API" el:subtitle="" el:id="20080618ral697"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["B"] = {"st-brownie"}
+ti["b"] = {"st_boulder_n"}
+ti["W"] = {"it_wrench"}
+ti["w"] = {"it-magicwand"}
+
+ti["M"] = {"st_mirror", "mymir", flavor="triangle", transparent=true}
+ti["m"] = {"st_mirror", flavor="triangle", counterclock=true}
+ti["T"] = {"st_mirror_triangle"}
+ti["="] = {"st_mirror_sheets"}
+ti["S"] = {"st_mirror_slab"}
+ti["t"] = {"st_mirror_triangle", movable=true}
+ti[":"] = {"st_mirror_sheets", movable=true}
+ti["s"] = {"st_mirror_slab", movable=true}
+
+ti["D"] = {"st_mirror_triangle", transparent=true}
+ti["P"] = {"st_mirror_slab", transparent=true}
+ti["d"] = {"st_mirror_triangle", movable=true, transparent=true}
+ti["p"] = {"st_mirror_slab", movable=true, transparent=true}
+
+ti["L"] = {"st_laser_n", "laser", state=ON}
+ti["l"] = {"st_laser_w", "laser", state=ON}
+
+ti["F"] = {"st_fourswitch", target="mymir", action="orientate"}
+ti["G"] = {"it_trigger", target="mymir", action="signal"}
+ti["g"] = {"it_trigger", target="mymir", action_1="turn", action_0="turnback"}
+
+ti["1"] = {"#ac-blackball"} 
+
+w, h = wo(ti, " ", {
+"         s         l",
+"                    ",
+"      S             ",
+"    T               ",
+"          B  s t    ",
+"                    ",
+"s      B  1wW      s",
+"       b     dp:    ",
+"     =              ",
+"  P          m      ",
+"   D          M     ",
+"            g   G F ",
+"L        s        lL"
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT051_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From andreasl at mail.berlios.de  Sun Jun 22 01:48:53 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Sun, 22 Jun 2008 01:48:53 +0200
Subject: [Enigma-game-svn] r1186 - in trunk/data: . gfx32 gfx40 gfx48 gfx64
Message-ID: <200806212348.m5LNmr38000163@sheep.berlios.de>

Author: andreasl
Date: 2008-06-22 01:48:47 +0200 (Sun, 22 Jun 2008)
New Revision: 1186

Added:
   trunk/data/gfx32/it_trap.png
   trunk/data/gfx40/it_trap.png
   trunk/data/gfx48/it_trap.png
   trunk/data/gfx64/it_trap.png
Modified:
   trunk/data/models-2d.lua
Log:
Trunk:
 - Add images and animations for it_trap.
Note:
 - Animation available as "it_trap_breaking",
   animation has not been tested yet.


Added: trunk/data/gfx32/it_trap.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/it_trap.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx40/it_trap.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/it_trap.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx48/it_trap.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/it_trap.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx64/it_trap.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx64/it_trap.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-06-18 22:54:50 UTC (rev 1185)
+++ trunk/data/models-2d.lua	2008-06-21 23:48:47 UTC (rev 1186)
@@ -640,6 +640,14 @@
     DefAlias("it-wormhole-off", "it-wormhole1")
 end
 
+-- it_trap --
+do
+    local images = DefSubimages("it_trap", {h=8})
+    local frames = BuildFrames(images, 100)
+    DefAnim("it_trap_breaking", frames)
+    DefAlias("it_trap", "it_trap8")
+end
+
 --------------------------------------------------------------------------------
 --                                STONE MODELS                                --
 --------------------------------------------------------------------------------



From andreasl at mail.berlios.de  Sun Jun 22 13:41:00 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Sun, 22 Jun 2008 13:41:00 +0200
Subject: [Enigma-game-svn] r1187 - in trunk: data/levels/enigma_vii
	data/levels/enigma_viii doc/manual
Message-ID: <200806221141.m5MBf0pf032243@sheep.berlios.de>

Author: andreasl
Date: 2008-06-22 13:40:55 +0200 (Sun, 22 Jun 2008)
New Revision: 1187

Modified:
   trunk/data/levels/enigma_vii/andreas46_3.xml
   trunk/data/levels/enigma_viii/
   trunk/data/levels/enigma_viii/mecke15_1.xml
   trunk/doc/manual/enigma_fr.texi
Log:
Trunk:
 - French translation of manual entry for Shift-ESC
 - API2 object names in mecke15 ("Enigmaparcour")
 - use autotiling in andreas45 ("Tinker, Tailor")
 - svn: ignore data/levels/enigma_viii/Makefile and Makefile.in


Modified: trunk/data/levels/enigma_vii/andreas46_3.xml
===================================================================
--- trunk/data/levels/enigma_vii/andreas46_3.xml	2008-06-21 23:48:47 UTC (rev 1186)
+++ trunk/data/levels/enigma_vii/andreas46_3.xml	2008-06-22 11:40:55 UTC (rev 1187)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Tinker, Tailor" el:subtitle="" el:id="andreas46"/>
-      <el:version el:score="2" el:release="4" el:revision="2" el:status="released"/>
+      <el:version el:score="2" el:release="4" el:revision="3" el:status="released"/>
       <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Andreas Lochmann</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -29,45 +29,45 @@
 
 wo["ConserveLevel"] = true
 
-ti[" "] = {"fl-leavesb"}
-ti["1"] = {"fl-leavesc1"}
-ti["2"] = {"fl-leavesc2"}
-ti["3"] = {"fl-leavesc3"}
-ti["4"] = {"fl-leavesc4"}
-ti["."] = {"fl-leavesb", force_x = myrandom(), force_y = myrandom()}
+ti["  "] = {"fl-leavesb"}
+ti[". "] = {"fl-leavesb", force_x = myrandom(), force_y = myrandom()}
 
-ti["#"] = ti[" "] .. {"st-glass2"}
-ti["G"] = ti[" "] .. {"st-glass2"}
-ti["@"] = ti[" "] .. {"#ac-blackball", name = "marble"}
-ti["o"] = ti[" "] .. {"st_oxyd", flavor = "b"}
-ti["S"] = ti[" "] .. {"st-scissors", name = "scissors#", target = "call_scissors"}
-ti["C"] = ti[" "] .. {"st-scissors", name = "scissors_central", target = "call_scissors"}
-ti["X"] = (ti[" "] .. {"st-glass1"}) .. {"#ac-horse", name = "horse#"}
-ti["s"] = ti[" "] .. {parastonekind, name = "parascissors#"}
-ti["c"] = ti[" "] .. {parastonekind, name = "parascissors_central"}
-ti["x"] = (ti[" "] .. {"st-glass1_hole", name = "paraplace#"})
-ti["u"] = ti[" "] .. {"st_switch", target = "next_pattern"}
-ti["v"] = ti[" "] .. {"st_switch", target = "solve"}
-ti["r"] = {"fl-leavesb", "parafloor#"}
-ti["t"] = ti[" "] .. {"st_timer", interval = 2.0, name = "timer", loop = false,
-                      invisible = true}
+ti["# "] = ti["  "] .. {"st-glass2"}
+ti["G "] = ti["  "] .. {"st-glass2"}
+ti["@ "] = ti["  "] .. {"#ac-blackball", name = "marble"}
+ti["o "] = ti["  "] .. {"st_oxyd", flavor = "b"}
+ti["template_S"] = ti["  "] .. {"st-scissors", name = "scissors%%", target = "call_scissors"}
+ti["C "] = ti["  "] .. {"st-scissors", name = "scissors_central", target = "call_scissors"}
+ti["template_X"] = (ti["  "] .. {"st-glass1"}) .. {"#ac-horse", name = "horse%%"}
+ti["template_s"] = ti["  "] .. {parastonekind, name = "parascissors%%"}
+ti["c "] = ti["  "] .. {parastonekind, name = "parascissors_central"}
+ti["template_x"] = (ti["  "] .. {"st-glass1_hole", name = "paraplace%%"})
+ti["u "] = ti["  "] .. {"st_switch", target = "next_pattern"}
+ti["v "] = ti["  "] .. {"st_switch", target = "solve"}
+ti["template_r"] = {"fl-leavesb", "parafloor%%"}
+ti["t "] = ti["  "] .. {"st_timer", interval = 2.0, name = "timer", loop = false,
+                       invisible = true}
 
-w, h = wo(ti, " ", {
+local resolver = res.autotile(ti,
+                   {"S", "template_S"}, {"X", "template_X"},
+                   {"s", "template_s"}, {"x", "template_x"}, {"r", "template_r"})
+
+w, h = wo(resolver, "  ", {
  -- 01234567890123456789
-   "####################",
-   "#         GG  r r  #",
-   "#   X X   GGr.....r#",
-   "#   S S   GG..x.x..#",
-   "#         GG..s.s..#",
-   "#XS @   SXGGxs...sx#",
-   "#    C    GG...c...#",
-   "#XS     SXGGxs...sx#",
-   "#         GG..s.s..#",
-   "#   S S   GG..x.x..#",
-   "#   X X   GGr.....r#",
-   "#         GG  r r  #",
-   "####################",
-   "t                   ",
+   "# # # # # # # # # # # # # # # # # # # # ",
+   "#                   G G     r1  r2    # ",
+   "#       X1  X2      G G r3. . . . . r4# ",
+   "#       S1  S2      G G . . x1. x2. . # ",
+   "#                   G G . . s1. s2. . # ",
+   "# X3S3  @       S4X4G G x3s3. . . s4x4# ",
+   "#         C         G G . . . c . . . # ",
+   "# X5S5          S6X6G G x5s5. . . s6x6# ",
+   "#                   G G . . s7. s8. . # ",
+   "#       S7  S8      G G . . x7. x8. . # ",
+   "#       X7  X8      G G r5. . . . . r6# ",
+   "#                   G G     r7  r8    # ",
+   "# # # # # # # # # # # # # # # # # # # # ",
+   "t                                       ",
 })
 
 function connect(obj1, obj2, strength)
@@ -98,7 +98,7 @@
     local correct = true
     for j = 1, 8 do
       correct = correct and
-          (no["horse#"..j]["_partner"] == no["scissors#"..Goal[j]])
+          (no["horse%"..j]["_partner"] == no["scissors%"..Goal[j]])
     end
     if correct then
       next_pattern()
@@ -108,10 +108,10 @@
 
 function solve()
   for j = 1, 8 do
-    wo[no["scissors#"..j]] = {"st-scissors", name = "scissors#"..j}
+    wo[no["scissors%"..j]] = {"st-scissors", name = "scissors%"..j}
   end
   for j = 1, 8 do
-    connect(no["horse#"..j], no["scissors#"..Goal[j]])
+    connect(no["horse%"..j], no["scissors%"..Goal[j]])
   end
 end
 
@@ -130,8 +130,8 @@
     -- create temporary goals for the horses to untangle
     local TemporaryGoal = luatools.permutation(8)
     for j = 1, 8 do
-      no["parahorse#"..j]:set(
-          {destination = {no["parafloor#"..TemporaryGoal[j]]}})
+      no["parahorse%"..j]:set(
+          {destination = {no["parafloor%"..TemporaryGoal[j]]}})
     end
     -- use timer to set real goals
     no["timer"]:set({target = "fix_horses", interval = 2.0, loop = false})
@@ -139,7 +139,7 @@
   else
     -- set oxyds
     for j = 1, 8 do
-      wo[no["scissors#"..j]] = {"st_oxyd"}
+      wo[no["scissors%"..j]] = {"st_oxyd"}
     end
     wo:shuffleOxyd()
   end
@@ -147,15 +147,15 @@
 
 function fix_horses()
   for j = 1, 8 do
-    no["parahorse#"..Goal[j]]:set({destination = {no["paraplace#"..j]}})
+    no["parahorse%"..Goal[j]]:set({destination = {no["paraplace%"..j]}})
   end
   -- taint the glass of the new "fixpoint"
   local k = 8 - pattern_count + 1  --first_permutation[pattern_count]
-  wo[no["paraplace#"..fixpoint_permutation[k]]]
-    = {"st-glass2_hole", name = "paraplace#"..fixpoint_permutation[k]}
+  wo[no["paraplace%"..fixpoint_permutation[k]]]
+    = {"st-glass2_hole", name = "paraplace%"..fixpoint_permutation[k]}
   if pattern_count == 7 then
-    wo[no["paraplace#"..fixpoint_permutation[1]]]
-      = {"st-glass2_hole", name = "paraplace#"..fixpoint_permutation[1]}
+    wo[no["paraplace%"..fixpoint_permutation[1]]]
+      = {"st-glass2_hole", name = "paraplace%"..fixpoint_permutation[1]}
   end
 end
 
@@ -176,13 +176,13 @@
   --       they're connected to. It's the paraplace which Goal
   --       references to, in contrast to the real situation on
   --       the left side.
-  wo[no["paraplace#"..j]] = {"#ac-horse", name = "parahorse#"..Goal[j],
+  wo[no["paraplace%"..j]] = {"#ac-horse", name = "parahorse%"..Goal[j],
                                           force = 4 + j/10}
 end
 
 for j = 1, 8 do
-  connect(no["parahorse#"..j], no["parascissors#"..j], 0)
-  connect(no["horse#"..j], no["scissors#"..j], 0)
+  connect(no["parahorse%"..j], no["parascissors%"..j], 0)
+  connect(no["horse%"..j], no["scissors%"..j], 0)
 end
 
 wo:shuffleOxyd()


Property changes on: trunk/data/levels/enigma_viii
___________________________________________________________________
Name: svn:ignore
   + Makefile
Makefile.in



Modified: trunk/data/levels/enigma_viii/mecke15_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke15_1.xml	2008-06-21 23:48:47 UTC (rev 1186)
+++ trunk/data/levels/enigma_viii/mecke15_1.xml	2008-06-22 11:40:55 UTC (rev 1187)
@@ -5,7 +5,7 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Enigmaparcour" el:subtitle="Open the Doors" el:id="mecke15"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 11 $" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 12 $" el:status="released"/>
       <el:author  el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -54,7 +54,7 @@
 ti["Y"] = ti[" "] .. {"st-glass"}
 ti["L"] = ti["_"] .. {"st_laser_e", name="laser", state=ON}
 ti["h"] = ti[" "] .. {"st-bluegray_hole"}
-ti["A"] = ti["~"] .. {"st-actorimpulse"}
+ti["A"] = ti["~"] .. {"st_actorimpulse"}
 ti["I"] = ti[" "] .. {"st-oneway_black-w"}
 ti["^"] = ti[" "] .. {"st_boulder_n"}
 ti[">"] = ti["v"] .. {"st_boulder_e"}
@@ -65,13 +65,13 @@
 ti["6"] = ti[" "] .. {"st-oneway-e"}
 ti["8"] = ti[" "] .. {"st-oneway_black-n"}
 ti["Q"] = ti[" "] .. {"st-stone_break"}
-ti["m"] = ti["_"] .. {"st-pmirror", movable=false, transparent=true, orientation=2}
-ti["M"] = ti["_"] .. {"st-pmirror", movable=false, orientation=1}
+ti["m"] = ti["_"] .. {"st_mirror_slab", movable=false, transparent=true, orientation=2}
+ti["M"] = ti["_"] .. {"st_mirror_slab", movable=false, orientation=1}
 ti["X"] = ti["~"] .. {"st_oxyd", flavor="a"}
 ti["S"] = ti["_"] .. {"st_laserswitch", target={"door#7", "door#8"}}
 ti[":"] = ti[" "] .. {"st-door-v", name="door#"}
 ti["9"] = ti[" "] .. {"st-turnstile"}
-ti["?"] = ti["~"] .. {"st-actorimpulse_invisible"}
+ti["?"] = ti["~"] .. {"st_actorimpulse_invisible"}
 ti["z"] = ti["v"] .. {"st-stone_break"}
 ti["N"] = ti["t"] .. {"fl-ice"}
 ti["-"] = ti["~"] .. {"it-hstrip"}
@@ -115,7 +115,7 @@
 wo[base+{9, 7}] = {"st-turnstile-e"}
 
 wo[base+{18, 11}] = {"it_key", code=1}
-wo[base+{8, 1}] = {"it-glasses"}
+wo[base+{8, 1}] = {"it_glasses"}
 wo[base+{8, 0}] = {"it_umbrella_new"}
 wo[base+{0, 11}] = {"it-magicwand"}
 wo[base+{5, 11}] = {"it_extralife"}
@@ -134,7 +134,7 @@
 
 wo[base+{3, 9}] = ti["~"]
 wo[base+{2, 9}] = ti["~"]
-wo[base+{3, 6}] = {"st-pmirror", movable=false, orientation=4}
+wo[base+{3, 6}] = {"st_mirror_slab", movable=false, orientation=4}
 
 wo[base+{18, 0}] = {"it_trigger", target="door#2"}
 wo[base+{18, 4}] = {"it_trigger", target="door#1"}

Modified: trunk/doc/manual/enigma_fr.texi
===================================================================
--- trunk/doc/manual/enigma_fr.texi	2008-06-21 23:48:47 UTC (rev 1186)
+++ trunk/doc/manual/enigma_fr.texi	2008-06-22 11:40:55 UTC (rev 1187)
@@ -508,6 +508,9 @@
 @item @key{Echap}
 Retour au menu principal
 
+ at item @key{Shift-Echap}
+Quitter le jeux d'embl@'ee
+
 @item @key{F1}
 Affichage de l'aide
 



From ral at mail.berlios.de  Sun Jun 22 20:45:40 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 22 Jun 2008 20:45:40 +0200
Subject: [Enigma-game-svn] r1188 - in trunk: data src
Message-ID: <200806221845.m5MIjeKG003121@sheep.berlios.de>

Author: ral
Date: 2008-06-22 20:45:23 +0200 (Sun, 22 Jun 2008)
New Revision: 1188

Modified:
   trunk/data/api2init.lua
   trunk/src/WorldProxy.cc
   trunk/src/d_engine.hh
   trunk/src/display.cc
   trunk/src/display.hh
   trunk/src/lua.cc
   trunk/src/lua.hh
   trunk/src/server.cc
   trunk/src/server.hh
Log:
Trunk 1.1: new API reengineering Follower
- fix Follower_Scrolling asymmetric scroll behaviour on half screen scrolls
- fix Follower_Scrolling problems with boundary thresholds
- fix Follower_Screen problems with boundary thresholds
- add independent boundaries for x and y
- fix impossibility to set follower before world creation
- fix missing screen refresh on follower switch on running level
- new API config of Follower via world attributes:
  FollowMethod:   FOLLOW_NO, FOLLOW_SCROLL, FOLLOW_FLIP
  FollowThreshold: number | position:  as boundary
  FollowAction:    number | position: scrollamount (currently just halfscreen)
  FollowGrid:   boolean : true - fixed to grid, false - pixel smooth
Note:
- see upcoming testlevel and refman for more details.
- old display.* Lua functions are no longer accessible from new API


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-06-22 11:40:55 UTC (rev 1187)
+++ trunk/data/api2init.lua	2008-06-22 18:45:23 UTC (rev 1188)
@@ -114,6 +114,11 @@
 SPOT_SENSOR         =   8
 SPOT_LIGHTPASSENGER =  16
 
+-- Follower
+FOLLOW_NO     = 0
+FOLLOW_SCROLL = 1
+FOLLOW_FLIP   = 2
+
 ---------------------
 -- Utility Methods --
 ---------------------

Modified: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2008-06-22 11:40:55 UTC (rev 1187)
+++ trunk/src/WorldProxy.cc	2008-06-22 18:45:23 UTC (rev 1188)
@@ -51,6 +51,15 @@
             return server::ConserveLevel;
         } else if (key == "CreatingPreview") {
             return server::CreatingPreview;  // read only
+        } else if (key == "FollowAction") {
+            return server::FollowAction;
+        } else if (key == "FollowGrid") {
+            return server::FollowGrid;
+        } else if (key == "FollowMethod") {
+            return server::FollowMethod;
+//        } else if (key == "FollowRoomSize") {    // Enigma 1.2 
+        } else if (key == "FollowThreshold") {
+            return server::FollowThreshold;            
         } else if (key == "Height") {
             return Height();
         } else if (key == "IsDifficult") {
@@ -104,8 +113,38 @@
             server::AllowTogglePlayer = val;
         } else if (key == "ConserveLevel") {
             server::ConserveLevel = val.to_bool();
-        } else if (key == "FollowMode") {
-            display::SetFollowMode((display::FollowMode)((int)val));
+        } else if (key == "FollowAction") {
+            server::FollowAction = val;
+            display::UpdateFollowMode();
+        } else if (key == "FollowGrid") {
+            bool wasGrid = server::FollowGrid;
+            server::FollowGrid = val.to_bool();
+            if (wasGrid && !server::FollowGrid) {
+                server::FollowMethod = display::FOLLOW_SCROLL;
+                server::FollowThreshold = 0;
+                server::FollowAction = 0;
+            } else if (!wasGrid && server::FollowGrid) {
+                server::FollowThreshold = 0.5;
+                server::FollowAction = ecl::V2(9.5, 6);
+            }
+            display::UpdateFollowMode();
+        } else if (key == "FollowMethod") {
+            int oldMethod = server::FollowMethod;
+            server::FollowMethod = val;
+            if ( oldMethod != server::FollowMethod) {
+                if (server::FollowMethod == display::FOLLOW_FLIP) {
+                    server::FollowThreshold = 0.5;
+                    server::FollowAction = ecl::V2(19, 12);
+                } else if (server::FollowMethod == display::FOLLOW_SCROLL &&  server::FollowGrid) {
+                    server::FollowThreshold = 0.5;
+                    server::FollowAction = ecl::V2(9.5, 6);
+                }
+                display::UpdateFollowMode();
+            }
+//        } else if (key == "FollowRoomSize") {    // Enigma 1.2 
+        } else if (key == "FollowThreshold") {
+            server::FollowThreshold = val;
+            display::UpdateFollowMode();
         } else if (key == "ShowMoves") {
             server::ShowMoves = val.to_bool();
             STATUSBAR->show_move_counter (server::ShowMoves);

Modified: trunk/src/d_engine.hh
===================================================================
--- trunk/src/d_engine.hh	2008-06-22 11:40:55 UTC (rev 1187)
+++ trunk/src/d_engine.hh	2008-06-22 18:45:23 UTC (rev 1188)
@@ -383,7 +383,10 @@
         virtual void tick(double dtime, const ecl::V2 &point) = 0;
         virtual void center(const ecl::V2 &point);
 
-        void set_boundary (double b) { m_boundary = b; }
+        void set_boundary (double b) { 
+            m_boundary_x = b;
+            m_boundary_y = b;
+        }
 
     protected:
         DisplayEngine *get_engine() const { return m_engine; }
@@ -392,7 +395,8 @@
         double get_voff() const;
         ecl::V2 get_scrollpos(const ecl::V2 &point);
 
-        double m_boundary;
+        double m_boundary_x;
+        double m_boundary_y;
 
     private:
         DisplayEngine *m_engine;
@@ -402,7 +406,7 @@
       sprite reaches the border of the current screen. */
     class Follower_Screen : public Follower {
     public:
-        Follower_Screen(DisplayEngine *e);
+        Follower_Screen(DisplayEngine *e, double borderx = 0.5, double bordery = 0.5);
         void tick(double dtime, const ecl::V2 &point);
     };
 
@@ -411,7 +415,7 @@
       screen. */
     class Follower_Scrolling : public Follower {
     public:
-        Follower_Scrolling (DisplayEngine *e, bool screenwise_);
+        Follower_Scrolling (DisplayEngine *e, bool screenwise, double borderx = 0.5, double bordery = 0.5);
         void tick(double dtime, const ecl::V2 &point);
         void center(const ecl::V2 &point);
     private:
@@ -451,6 +455,7 @@
 
         /* ---------- Scrolling ---------- */
         void set_follow_mode (FollowMode m);
+        void updateFollowMode();
         void follow_center();
         void set_follow_sprite(SpriteId id);
         void set_reference_point (const ecl::V2 &point);

Modified: trunk/src/display.cc
===================================================================
--- trunk/src/display.cc	2008-06-22 11:40:55 UTC (rev 1187)
+++ trunk/src/display.cc	2008-06-22 18:45:23 UTC (rev 1188)
@@ -1598,32 +1598,30 @@
     m_cache->release (sh);
 }
 
-
+
 //----------------------------------------------------------------------
 // Sprite following code
 //----------------------------------------------------------------------
 
-Follower::Follower (DisplayEngine *e)
-: m_boundary (0.5),
-  m_engine(e)
-{}
+Follower::Follower (DisplayEngine *e) : m_boundary_x (0.5), m_boundary_y (0.5), m_engine(e) {
+}
 
 double Follower::get_hoff() const 
 { 
     ScreenArea gamearea = m_engine->get_area();
-    return gamearea.w / m_engine->get_tilew() -m_boundary*2; 
+    return gamearea.w / m_engine->get_tilew() -m_boundary_x*2; 
 }
 
 double Follower::get_voff() const 
 {
     ScreenArea gamearea = m_engine->get_area();
-    return gamearea.h / m_engine->get_tileh() -m_boundary*2;
+    return gamearea.h / m_engine->get_tileh() -m_boundary_y*2;
 }
 
 void Follower::center(const ecl::V2 &point) 
 {
-    double borderh = m_boundary; 
-    double borderv = m_boundary;
+    double borderh = m_boundary_x; 
+    double borderv = m_boundary_y;
     double hoff = get_hoff();
     double voff = get_voff();
 
@@ -1639,20 +1637,21 @@
     DisplayEngine *e = get_engine();
     offs[0] = max (offs[0], 0.0);
     offs[1] = max (offs[1], 0.0);
-    offs[0] = min (offs[0], double(e->get_width()-get_hoff()-1));
-    offs[1] = min (offs[1], double(e->get_height()-get_voff()-1));
+    offs[0] = min (offs[0], double(e->get_width()-get_hoff()-m_boundary_x*2));
+    offs[1] = min (offs[1], double(e->get_height()-get_voff()-m_boundary_y*2));
     if (offs != e->get_offset()) {
-	e->set_offset(offs);
-	return true;
+        e->set_offset(offs);
+        return true;
     }
     return false;
 }
 
 /* -------------------- Follower_Screen -------------------- */
 
-Follower_Screen::Follower_Screen(DisplayEngine *e)
-: Follower(e)
-{}
+Follower_Screen::Follower_Screen(DisplayEngine *e, double borderx, double bordery) : Follower(e) {
+    m_boundary_x  = borderx;
+    m_boundary_y  = bordery;
+}
 
 
 /*! Determine whether the screen must be scrolled or not, and change
@@ -1666,15 +1665,17 @@
 }
 
 
-
+
 /* -------------------- Follower_Scrolling -------------------- */
 
-Follower_Scrolling::Follower_Scrolling(DisplayEngine *e, bool screenwise_)
+Follower_Scrolling::Follower_Scrolling(DisplayEngine *e, bool screenwise_, double borderx, double bordery)
 : Follower (e),
   currently_scrolling(false),
   scrollspeed(0), resttime(0),
-  screenwise (screenwise_)
-{}
+  screenwise (screenwise_) {
+    m_boundary_x  = borderx;
+    m_boundary_y  = bordery;
+}
 
 void Follower_Scrolling::center(const ecl::V2 &point) 
 {
@@ -1690,17 +1691,15 @@
         ScreenArea gamearea = engine->get_area();
         int        tilew    = engine->get_tilew();
         int        tileh    = engine->get_tileh();
-        int        borderx  = tilew/2;
-        int        bordery  = tileh/2;
 
         int sx, sy;
         engine->world_to_screen(point, &sx, &sy);
 
-        bool scrollx_p = (sx < gamearea.x + borderx)
-            || (sx >= gamearea.x + gamearea.w - borderx);
+        bool scrollx_p = (sx < gamearea.x + m_boundary_x * tilew)
+            || (sx >= gamearea.x + gamearea.w - m_boundary_x * tilew);
 
-        bool scrolly_p = (sy < gamearea.y + bordery)
-            || (sy >= gamearea.y + gamearea.h - bordery);
+        bool scrolly_p = (sy < gamearea.y + m_boundary_y * tileh)
+            || (sy >= gamearea.y + gamearea.h - m_boundary_y * tileh);
 
         if (scrollx_p || scrolly_p) {
             V2 olddest = destpos;
@@ -1714,20 +1713,26 @@
             if (screenwise) {
                 double hoff = get_hoff();
                 double voff = get_voff();
-                destpos[0] = floor((point[0]-m_boundary) / hoff) * hoff;
-                destpos[1] = floor((point[1]-m_boundary) / voff) * voff;
+//                Log << "scroll screen " << hoff << " " << voff << " " << m_boundary_x << " " << m_boundary_y << "\n";
+                destpos[0] = floor((point[0]-m_boundary_x) / hoff) * hoff;
+                destpos[1] = floor((point[1]-m_boundary_y) / voff) * voff;
             } else {
                 destpos = point - V2(gamearea.w/tilew, gamearea.h/tileh)/2;
+                // round to grid - a hack just for 20x13 screen TODO rewrite for Enigma 1.2
+                // x scroll of "alternating" 10 and 9 grids, try to join this grid after warps 
+                double xmod = std::fmod(destpos[0], 19);
+                if (xmod < 5 || (xmod > 10 && xmod < 14.5))
+                    destpos[0] = std::floor(destpos[0]);
+                else 
+                    destpos[0] = std::ceil(destpos[0]);
+                // y scroll of stable 6 grids
+                destpos[1] = round_nearest<int>(destpos[1]);
             }
 
-            // Round to integer pixel offset
-            destpos[0] = round_nearest<int>(destpos[0]*tilew)/tilew;
-            destpos[1] = round_nearest<int>(destpos[1]*tileh)/tileh;
-
             // Don't scroll off the game area
-            destpos[0] = Clamp (destpos[0], 0.0,
+            destpos[0] = ecl::Clamp<double>(destpos[0], 0.0,
                                 (double)engine->get_width()-gamearea.w/tilew);
-            destpos[1] = Clamp (destpos[1], 0.0, 
+            destpos[1] = ecl::Clamp<double>(destpos[1], 0.0, 
                                 (double)engine->get_height()-gamearea.h/tileh);
             if (!scrollx_p)
                 destpos[0] = olddest[0];
@@ -1788,7 +1793,7 @@
     set_offset(calc_offset (point));
 }
 
-
+
 //----------------------------------------------------------------------
 // Editor / game display engine
 //----------------------------------------------------------------------
@@ -1946,7 +1951,7 @@
     CommonDisplay::new_world (w, h);
     status_bar->new_world();
     resize_game_area (NTILESH, NTILESV);
-    set_follow_mode (FOLLOW_SCREEN);
+    updateFollowMode();
     m_reference_point = V2();
 
 //     shadow_layer->new_world(w,h);
@@ -1958,28 +1963,56 @@
     return status_bar;
 }
 
-
+
 /* -------------------- Scrolling -------------------- */
 
 void GameDisplay::set_follow_mode (FollowMode m) {
     switch (m) {
-    case FOLLOW_NONE: 
-        set_follower(0); 
-        break;
-    case FOLLOW_SCROLLING:
-	set_follower (new Follower_Scrolling(get_engine(), false)); 
-        break;
-    case FOLLOW_SCREEN:
-	set_follower (new Follower_Screen(get_engine())); 
-        break;
-    case FOLLOW_SCREENSCROLLING:
-	set_follower (new Follower_Scrolling(get_engine(), true)); 
-        break;
-    case FOLLOW_SMOOTH:
-        set_follower (new Follower_Smooth(get_engine()));
+        case FOLLOW_NONEOLD: 
+            set_follower(0); 
+            break;
+        case FOLLOW_SCROLLING:
+       	    set_follower (new Follower_Scrolling(get_engine(), false)); 
+            break;
+        case FOLLOW_SCREEN:
+    	    set_follower (new Follower_Screen(get_engine())); 
+            break;
+        case FOLLOW_SCREENSCROLLING:
+    	    set_follower (new Follower_Scrolling(get_engine(), true, 0.5, 0.5)); 
+            break;
+        case FOLLOW_SMOOTH:
+            set_follower (new Follower_Smooth(get_engine()));
     };
+    get_engine()->mark_redraw_screen();
 }
 
+void GameDisplay::updateFollowMode () {
+    if (!server::FollowGrid)
+        set_follower(new Follower_Smooth(get_engine()));
+    else if (server::FollowMethod == FOLLOW_NONE) 
+        set_follower(NULL); 
+    else if (server::FollowMethod == FOLLOW_FLIP) {
+	    if (server::FollowThreshold.getType() == Value::DOUBLE) 
+            set_follower (new Follower_Screen(get_engine(), (double)server::FollowThreshold, 
+                    (double)server::FollowThreshold)); 
+        else
+            set_follower (new Follower_Screen(get_engine(), ecl::V2(server::FollowThreshold)[0], 
+                    ecl::V2(server::FollowThreshold)[1])); 
+    }
+    else if ((server::FollowThreshold.getType() == Value::DOUBLE) && ((double)server::FollowThreshold == 0.5) 
+            && (server::FollowAction == Value(ecl::V2(9.5, 6))))
+   	    set_follower(new Follower_Scrolling(get_engine(), false)); 
+    else {
+	    if (server::FollowThreshold.getType() == Value::DOUBLE) 
+            set_follower (new Follower_Scrolling(get_engine(), true, (double)server::FollowThreshold, 
+                    (double)server::FollowThreshold)); 
+        else
+            set_follower (new Follower_Scrolling(get_engine(), true, ecl::V2(server::FollowThreshold)[0], 
+                    ecl::V2(server::FollowThreshold)[1])); 
+    }
+    get_engine()->mark_redraw_screen();
+}
+
 void GameDisplay::set_follower (Follower *f) {
     delete m_follower;
     if ((m_follower = f))
@@ -2125,6 +2158,10 @@
     gamedpy->set_follow_mode(m);
 }
 
+void display::UpdateFollowMode() {
+    gamedpy->updateFollowMode();
+}
+
 void display::SetScrollBoundary (double boundary) {
     gamedpy->set_scroll_boundary (boundary);
 }

Modified: trunk/src/display.hh
===================================================================
--- trunk/src/display.hh	2008-06-22 11:40:55 UTC (rev 1187)
+++ trunk/src/display.hh	2008-06-22 18:45:23 UTC (rev 1188)
@@ -21,6 +21,7 @@
 
 #include "enigma.hh"
 #include "ecl.hh"
+#include "server.hh"
 
 //----------------------------------------
 // Definition of models
@@ -109,15 +110,22 @@
 namespace display
 {
     enum FollowMode {
-        FOLLOW_NONE            = 0, // Don't follow any sprite
+        FOLLOW_NONEOLD            = 0, // Don't follow any sprite
         FOLLOW_SCROLLING       = 1, // Scroll the screen
         FOLLOW_SCREEN          = 2, // Flip the screen region
         FOLLOW_SCREENSCROLLING = 3, // Scroll to the next screen
         FOLLOW_SMOOTH          = 4, // Follow pixel by pixel
     };
+    
+    enum FollowTyp {
+        FOLLOW_NONE            = 0, // Don't follow any sprite
+        FOLLOW_SCROLL          = 1, // Scroll pixelwise
+        FOLLOW_FLIP            = 2, // Flip the display to destination
+    };
 
 
     void SetFollowMode (FollowMode m);
+    void UpdateFollowMode();
     void SetScrollBoundary (double boundary);
 
     void SetReferencePoint (const ecl::V2 &point);

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-06-22 11:40:55 UTC (rev 1187)
+++ trunk/src/lua.cc	2008-06-22 18:45:23 UTC (rev 1188)
@@ -3043,7 +3043,7 @@
 
 
 
-lua_State *InitLevel() 
+lua_State *InitLevel(int api) 
 {
     char buffer[255];
 
@@ -3057,9 +3057,10 @@
 
     tolua_open(L);
     tolua_enigma_open(L);
-    tolua_px_open(L);
-    tolua_display_open(L);
-
+    if (api == 1) {
+        tolua_px_open(L);
+        tolua_display_open(L);
+    }
     
     RegisterFuncs(L, levelfuncs);
     RegisterFuncs2(L, levelFuncs);

Modified: trunk/src/lua.hh
===================================================================
--- trunk/src/lua.hh	2008-06-22 11:40:55 UTC (rev 1187)
+++ trunk/src/lua.hh	2008-06-22 18:45:23 UTC (rev 1188)
@@ -64,7 +64,7 @@
     lua_State *LevelState();
 
     /*! Initialize the ingame Lua state. */
-    lua_State *InitLevel();
+    lua_State *InitLevel(int api);
 
     /*! Close the ingame Lua state. */
     void ShutdownLevel();

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2008-06-22 11:40:55 UTC (rev 1187)
+++ trunk/src/server.cc	2008-06-22 18:45:23 UTC (rev 1188)
@@ -82,6 +82,12 @@
 bool     server::AllowTogglePlayer;
 bool     server::CreatingPreview = false;   // read only for Lua
 bool     server::ConserveLevel;
+
+Value    server::FollowAction;
+bool     server::FollowGrid;
+int      server::FollowMethod;
+Value    server::FollowThreshold;
+
 double   server::LevelTime;                 // read only for Lua (> 1.10)
 bool     server::ShowMoves;
 bool     server::SingleComputerGame;        // no Lua access
@@ -241,6 +247,10 @@
     server::SingleComputerGame= true;
     server::AllowSingleOxyds  = false;
     server::AllowTogglePlayer = true;
+    server::FollowAction      = GridPos(19, 12);   // inner space of a room
+    server::FollowGrid        = true;
+    server::FollowMethod      = display::FOLLOW_FLIP;      // FLIP
+    server::FollowThreshold   = 0.5;
     server::ShowMoves         = false;
     server::Brittleness       = 0.5;
     server::SlopeForce        = 25.0;
@@ -273,7 +283,7 @@
     // different levels do not get in each other's way.
     int api = (server::EnigmaCompatibility < 1.10) ? 1 : 2;
     lua::ShutdownLevel();
-    lua_State *L = lua::InitLevel();
+    lua_State *L = lua::InitLevel(api);
     if (lua::DoSysFile(L, "compat.lua") != lua::NO_LUAERROR) {
         throw XLevelLoading("While processing 'compat.lua':\n"+lua::LastError(L));
     }

Modified: trunk/src/server.hh
===================================================================
--- trunk/src/server.hh	2008-06-22 11:40:55 UTC (rev 1187)
+++ trunk/src/server.hh	2008-06-22 18:45:23 UTC (rev 1188)
@@ -24,6 +24,7 @@
 #define SERVER_HH_INCLUDED
 
 #include "lev/Proxy.hh"
+#include "Value.hh"
 
 #include <stdint.h>
 
@@ -98,6 +99,11 @@
     
     extern int      GlassesVisibility;
     extern int      ExtralifeGlasses;
+    
+    extern Value     FollowAction;
+    extern bool      FollowGrid;
+    extern int       FollowMethod;
+    extern Value     FollowThreshold;
 
 /* --------------------  Force multipliers... -------------------- */
 



From ral at mail.berlios.de  Sun Jun 22 20:59:23 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 22 Jun 2008 20:59:23 +0200
Subject: [Enigma-game-svn] r1189 - team_levelpacks/team_test_new_api
Message-ID: <200806221859.m5MIxNM7004626@sheep.berlios.de>

Author: ral
Date: 2008-06-22 20:59:15 +0200 (Sun, 22 Jun 2008)
New Revision: 1189

Added:
   team_levelpacks/team_test_new_api/ralT052_1.xml
Log:
Test Level new API:
- added test level for Follower


Added: team_levelpacks/team_test_new_api/ralT052_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT052_1.xml	2008-06-22 18:45:23 UTC (rev 1188)
+++ team_levelpacks/team_test_new_api/ralT052_1.xml	2008-06-22 18:59:15 UTC (rev 1189)
@@ -0,0 +1,121 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Follower" el:subtitle="" el:id="20080622ral708"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+-- old API   FOLLOW_SCREEN
+--wo["FollowGrid"] = true
+--wo["FollowMethod"] = FOLLOW_FLIP
+
+-- old API   FOLLOW_SCROLLING (halfscreen scroll)
+wo["FollowGrid"] = true
+wo["FollowMethod"] = FOLLOW_SCROLL
+
+-- old API   FOLLOW_SCREENSCROLLING
+--wo["FollowGrid"] = true
+--wo["FollowMethod"] = FOLLOW_SCROLL
+--wo["FollowAction"] = 0
+
+-- old API   FOLLOW_SMOOTH
+--wo["FollowGrid"] = false
+--wo["FollowMethod"] = FOLLOW_SCROLL
+
+
+-- new API no scroll at all
+--wo["FollowMethod"] = FOLLOW_NO
+
+-- new API flip screen with boundary
+--wo["FollowGrid"] = true
+--wo["FollowMethod"] = FOLLOW_FLIP
+--wo["FollowThreshold"] = 1.5
+--wo["FollowThreshold"] = po(2.5, 1.5)
+
+
+-- new API scroll screen with boundary
+--wo["FollowGrid"] = true
+--wo["FollowMethod"] = FOLLOW_SCROLL
+--wo["FollowThreshold"] = 1.5
+--wo["FollowThreshold"] = po(2.5, 1.5)
+
+ti[" "] = {"fl-sahara"}
+ti["#"] = {"st-grate1"}
+
+ti["V"] = {"it_vortex_open", "vortex1", destination="vortex2"}
+ti["v"] = {"it_vortex_open", "vortex2", destination="vortex1"}
+
+ti["s"] = {"st_switch", target="doit"}
+ti["1"] = {"#ac-blackball"}
+
+w, h = wo(ti, " ", {
+"##########################################################",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"# # # # # # # # #  # # # # # # # # #  # # # # # # # # #  #",
+"#     1            #                  #                  #",
+"#          V       #                  #                  #",
+"#                  #                  #                  #",
+"#      s           #                  #                  #",
+"#                  #                  #                  #",
+"##########################################################",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"# # # # # # # # #  # # # # # # # # #  # # # # # # # # #  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #               v  #                  #",
+"#                  #                  #                  #",
+"##########################################################",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"# # # # # # # # #  # # # # # # # # #  # # # # # # # # #  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"#                  #                  #                  #",
+"##########################################################"
+})
+
+function doit(value, sender)
+    if value then
+        wo["FollowGrid"] = false
+        wo["FollowMethod"] = FOLLOW_SCROLL
+    else
+        wo["FollowGrid"] = true
+        wo["FollowMethod"] = FOLLOW_SCROLL
+        wo["FollowThreshold"] = po(2.5, 1.5)
+    end
+end
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT052_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Tue Jun 24 23:41:35 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Tue, 24 Jun 2008 23:41:35 +0200
Subject: [Enigma-game-svn] r1190 - in trunk: data data/schemas src src/stones
Message-ID: <200806242141.m5OLfZKd000351@sheep.berlios.de>

Author: ral
Date: 2008-06-24 23:41:23 +0200 (Tue, 24 Jun 2008)
New Revision: 1190

Modified:
   trunk/data/api1init.lua
   trunk/data/api2init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/items.cc
   trunk/src/items.hh
   trunk/src/stones/MirrorStone.cc
Log:
Trunk 1.1: new API reengineering
- fix Mirror turning sound - r1183
- fix Oneway false orientation interpretation - r1183
- fix Mirror signal behaviour on DAT
- reengineering it-signalfilter*:
  - elimination on new API
  - subkind of it_sensor for DAT
- add new API constants FOLLOW_FULLSCREEN, FOLLOW_HALFSCREEN
- add new API planar mirror constants BACKSLASH, HORIZONTAL, SLASH, VERTICAL
- reengineering it-abyss:
  - renamed to it_trap
  - glasses added trap spotting
  - run animation on falling actor
- reengineering it-landmine
  - renamed to it_landmine


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-06-22 18:59:15 UTC (rev 1189)
+++ trunk/data/api1init.lua	2008-06-24 21:41:23 UTC (rev 1190)
@@ -57,10 +57,12 @@
     it_glasses = "it-glasses",
     it_glasses_broken = "it-glasses-broken",
     it_hammer = "it-hammer",
+    it_landmine = "it-landmine",
     it_magnet = "it-magnet",
     it_magnet_on = "it-magnet-on",
     it_magnet_off = "it-magnet-off",
     it_sword = "it-sword",
+    it_trap = "it-abyss",
     it_trigger = "it-trigger",
     it_umbrella = "it-umbrella",
     it_vortex = "it-vortex-open",
@@ -302,7 +304,7 @@
     if string.sub(_newname, 1, 8) == "st_laser" then
         return "st-laser"
     end
-    if _newname == "it_mirror" then
+    if _newname == "st_mirror" then
         return "st-mirror"
     end
     if _oldname ~= nil then
@@ -412,7 +414,7 @@
      if key == "invisible" then
          if val == 1 then _val = true else _val = false end
      end
-     if key == "orientation" then
+     if key == "orientation" and _obj_name == "st-mirror" then
          _val = (6 - val) % 4
      end
      if key == "transparent" then
@@ -506,7 +508,7 @@
      if key == "invisible" then
          if val == false then val = 0 else val = 1 end
      end
-     if key == "orientation" then
+     if key == "orientation" and _obj_name == "st-mirror" then
          val = (5 - val) % 4 + 1
      end
      if key == "transparent" then

Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-06-22 18:59:15 UTC (rev 1189)
+++ trunk/data/api2init.lua	2008-06-24 21:41:23 UTC (rev 1190)
@@ -101,6 +101,12 @@
 EAST  = 2
 NORTH = 3
 
+-- alternative orientation notation for mirrors
+BACKSLASH  = 0
+HORIZONTAL = 1
+SLASH      = 2
+VERTICAL   = 3
+
 -- essential
 DISPENSIBLE   = 0
 INDISPENSIBLE = 1
@@ -113,12 +119,16 @@
 SPOT_ACTORIMPULSE   =   4
 SPOT_SENSOR         =   8
 SPOT_LIGHTPASSENGER =  16
+SPOT_TRAP           =  32
 
 -- Follower
 FOLLOW_NO     = 0
 FOLLOW_SCROLL = 1
 FOLLOW_FLIP   = 2
 
+FOLLOW_FULLSCREEN = po(19, 12)
+FOLLOW_HALFSCREEN = po(9.5, 6)
+
 ---------------------
 -- Utility Methods --
 ---------------------

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-06-22 18:59:15 UTC (rev 1189)
+++ trunk/data/models-2d.lua	2008-06-24 21:41:23 UTC (rev 1190)
@@ -403,7 +403,6 @@
         "it-hill",
         "it-hollow",
         "it-hstrip",
-        "it-landmine",
         "it-magicwand",
         "it-odometer",
         "it-pencil",
@@ -437,6 +436,7 @@
     DefImage("it_glasses_broken", {filename="it-glasses-broken"})
     DefImage("it_hammer", {filename="it-hammer"})
     DefImage("it_key", {filename="it-key"})
+    DefImage("it_landmine", {filename="it-landmine"})
     DefImage("it_sword", {filename="it-sword"})
     DefImage("it_umbrella", {filename="it-umbrella"})
     DefImage("it_wrench", {filename="it-wrench"})

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-06-22 18:59:15 UTC (rev 1189)
+++ trunk/data/schemas/objects.xml	2008-06-24 21:41:23 UTC (rev 1190)
@@ -129,6 +129,7 @@
     <object name="it_key">
       <attr name="code"/>
     </object>
+    <object name="it_landmine"/>
     <object name="it_magnet">
       <attr name="range" default="nil"/>
       <attr name="strength" default="nil"/>
@@ -155,6 +156,11 @@
       <msg name="_init"/>
       <msg name="_jumping"/>
     </object>
+    <object name="it_trap">
+      <msg name="open"/>
+      <msg name="signal"/>
+      <msg name="_glasses"/>
+    </object>
     <object name="it_umbrella"/>
     <object name="it_umbrella_new" init="true"/>
     <object name="it_vortex">

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-06-22 18:59:15 UTC (rev 1189)
+++ trunk/src/items.cc	2008-06-24 21:41:23 UTC (rev 1190)
@@ -3182,11 +3182,15 @@
    activated only once. */
     class Sensor : public Item {
         CLONEOBJ(Sensor);
-        DECL_TRAITS_ARRAY(2, traitsIdx());
+        DECL_TRAITS_ARRAY(4, traitsIdx());
+    private:
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_ISFILTER  =   1<<24    ///< sensor that filters signals, too
+        };
     public:
         static void setup();
             
-        Sensor(bool inverse);
+        Sensor(bool inverse, bool isFilter = false);
         
         // Object interface
         virtual Value message(const Message &m);
@@ -3208,12 +3212,18 @@
     };
     
     void Sensor::setup() {
-        RegisterItem (new Sensor(false));
-        RegisterItem (new Sensor(true));
+        RegisterItem(new Sensor(false));
+        RegisterItem(new Sensor(true));
+        RegisterItem(new Sensor(true, true));
+        RegisterItem(new Sensor(false, true));
     }
     
-    Sensor::Sensor(bool inverse) {
+    Sensor::Sensor(bool inverse, bool isFilter) {
         Object::setAttr("inverse", inverse);
+        if (isFilter) {
+            objFlags |= OBJBIT_ISFILTER;
+            Item::setAttr("invisible", true);
+        }
     }
     
     Value Sensor::message(const Message &m) {
@@ -3227,6 +3237,10 @@
         } else if (m.message == "_glasses") {
             if (isDisplayable())
                 init_model();            
+        } else if (m.message == "signal" && (objFlags & OBJBIT_ISFILTER)) {
+            if (m.value == 1)
+                performAction(true);   // invertion done by Object
+            return Value();
         }
         return Item::message(m);
     }
@@ -3259,56 +3273,19 @@
     }
     
     int Sensor::traitsIdx() const {
-        return getAttr("inverse").to_bool() ? 1 : 0;
+        int idx = getAttr("inverse").to_bool() ? 1 : 0;
+        if (objFlags & OBJBIT_ISFILTER)
+            idx +=2;
+        return idx;
     }
 
-    ItemTraits Sensor::traits[2] = {
+    ItemTraits Sensor::traits[4] = {
         {"it_sensor",  it_sensor,  itf_static},
-        {"it_sensor",  it_inversesensor,  itf_static}
+        {"it_sensor",  it_inversesensor,  itf_static},
+        {"it_sensor_filter1", it_signalfilter1, itf_static | itf_invisible, 0.0},  // DAT only
+        {"it_sensor_filter0", it_signalfilter0, itf_static | itf_invisible, 0.0}   // DAT only
     };
 
-/* -------------------- Signal filters -------------------- */
-namespace
-{
-    class SignalFilterItem : public Item {
-        CLONEOBJ(SignalFilterItem);
-        DECL_TRAITS_ARRAY(2, type);
-
-        SignalFilterItem(int type_) : type(type_) {
-            ASSERT(type >= 0 && type <= 1, XLevelRuntime, "SignalFilterItem: type unknown");
-        }
-
-        virtual Value message(const Message &m) {
-            if (m.message == "signal") {
-                int value = m.value;
-//                 warning("received signal with value %i", value);
-                if (value)
-                    performAction(type != 0);
-                return Value();
-            }
-            return Item::message(m);
-        }
-
-        // type of signal filter
-        // 0 : receive 1 -> send 0
-        // 1 : receive 1 -> send 1
-        int type;
-
-    public:
-        static void setup() {
-            RegisterItem (new SignalFilterItem(0));
-            RegisterItem (new SignalFilterItem(1));
-        }
-    };
-    ItemTraits SignalFilterItem::traits[2] = {
-        {"it-signalfilter0", it_signalfilter0,
-            itf_static | itf_invisible | itf_fireproof, 0.0},
-        {"it-signalfilter1", it_signalfilter1,
-            itf_static | itf_invisible | itf_fireproof, 0.0},
-    };
-}
-
-
 /* -------------------- EasyKillStone -------------------- */
 
 /*
@@ -3537,53 +3514,111 @@
     };
 
 
-/* -------------------- Invisible abyss -------------------- */
-namespace
-{
-    class InvisibleAbyss : public Item {
-        CLONEOBJ(InvisibleAbyss);
+/* -------------------- Invisible Trap -------------------- */
+    class Trap : public Item {
+        CLONEOBJ(Trap);
         DECL_TRAITS;
-        bool actor_hit(Actor *a) {
-            SendMessage(a, "fall");
-            return false;
-        }
+    
     public:
-        InvisibleAbyss() {}
+        Trap();
+        
+        // Object interface
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual void setState(int extState);
+        
+        // GridObject interface
+        virtual void init_model();
+
+        // ModelCallback interface
+        virtual void animcb();
+
+        // Item interface
+        virtual bool actor_hit(Actor *a);        
     };
-    DEF_TRAITSF(InvisibleAbyss, "it-abyss", it_abyss,
-                itf_static | itf_invisible | itf_fireproof);
-}
+    
+    Trap::Trap() {
+    }
+    
+    Value Trap::message(const Message &m) {
+        if (m.message == "_glasses") {
+            if (isDisplayable())
+                init_model();            
+        }
+        return Item::message(m);
+    }
+    
+    void Trap::setState(int extState) {
+        if (state == 0) {       // no toggle back of a broken (open) trap
+            state == extState;
+            init_model();
+        }
+    }
+    
+    void Trap::init_model() {
+        if (state == 0 && ((server::GlassesVisibility & 32) == 0))
+            set_model("invisible");
+        else
+            set_model("it_trap");
+        
+    }
+    
+    void Trap::animcb() {
+        init_model();
+    }
+    
+    bool Trap::actor_hit(Actor *a) {
+        SendMessage(a, "fall");
+        if (state == 0) {
+            state = 1;
+            set_anim("it_trap_breaking");
+        }
+        return false;
+    }
+        
+    DEF_TRAITSF(Trap, "it_trap", it_trap, itf_static | itf_fireproof);
 
 
 /* -------------------- Landmine -------------------- */
-namespace
-{
     class Landmine : public Item {
         CLONEOBJ(Landmine);
         DECL_TRAITS;
 
-	void explode() {
-            sound_event ("landmine");
-	    replace (it_explosion2);
+    public:
+        Landmine();
+
+        // Item interface
+        virtual bool actor_hit(Actor *a);
+        virtual void on_stonehit(Stone *st);
+    
+    private:
+        void explode();
+    };
+
+    Landmine::Landmine() {
+    }
+    
+    bool Landmine::actor_hit (Actor *a) {
+        const double ITEM_RADIUS = 0.3;
+        double dist = length(a->get_pos() - get_pos().center());
+        if (dist < ITEM_RADIUS)
+            explode();
+        return false;
+    }
+    
+    void Landmine::on_stonehit(Stone *st) { 
+        explode();
+    }
+    
+	void Landmine::explode() {
+        sound_event ("landmine");
+        replace(it_explosion2);
 	}
 
-        bool actor_hit (Actor *a) {
-            const double ITEM_RADIUS = 0.3;
-            double dist = length(a->get_pos() - get_pos().center());
-            if (dist < ITEM_RADIUS)
-		explode();
-            return false;
-        }
+    DEF_TRAITSF(Landmine, "it_landmine", it_landmine, itf_static);
 
-        void on_stonehit(Stone *) { explode(); }
-    public:
-        Landmine()
-        {}
-    };
-    DEF_TRAITSF(Landmine, "it-landmine", it_landmine, itf_static);
-}
 
-
 /* -------------------- Cross -------------------- */
     class Cross : public Item, public TimeHandler {
         CLONEOBJ(Cross);
@@ -4111,7 +4146,7 @@
     RegisterItem (new Hill);
     RegisterItem (new Hollow);
     RegisterItem (new HStrip);
-    RegisterItem (new InvisibleAbyss);
+    RegisterItem (new Trap);
     RegisterItem (new Key);
     RegisterItem (new Landmine);
     RegisterItem (new MagicWand);
@@ -4133,7 +4168,6 @@
     RegisterItem (new SeedVolcano);
     Sensor::setup();
     ShogunDot::setup();
-    SignalFilterItem::setup();
     RegisterItem (new Spade);
     RegisterItem (new Spoon);
     RegisterItem (new Spring1);

Modified: trunk/src/items.hh
===================================================================
--- trunk/src/items.hh	2008-06-22 18:59:15 UTC (rev 1189)
+++ trunk/src/items.hh	2008-06-24 21:41:23 UTC (rev 1190)
@@ -29,7 +29,6 @@
         it_none = 0,
         it_1pkillstone,
         it_2pkillstone,
-        it_abyss,
         it_bag,
         it_banana,
         it_blackbomb,
@@ -120,6 +119,7 @@
         it_sword,
         it_tinyhill,
         it_tinyhollow,
+        it_trap,
         it_trigger,
         it_umbrella,
         it_vortex_open,

Modified: trunk/src/stones/MirrorStone.cc
===================================================================
--- trunk/src/stones/MirrorStone.cc	2008-06-22 18:59:15 UTC (rev 1189)
+++ trunk/src/stones/MirrorStone.cc	2008-06-24 21:41:23 UTC (rev 1190)
@@ -115,16 +115,19 @@
     
     Value MirrorStone::message(const Message &m) {
         if (m.message == "orientate") {
-            setAttr("orientation", m.value);
+            setAttr("state", m.value);   // enforce value check
             return Value();
         } else if ((m.message == "turn" || m.message == "turnback")) {
-            setAttr("orientation", (m.message == "turn" && !getAttr("counterclock").to_bool() || 
+            setAttr("state", (m.message == "turn" && !getAttr("counterclock").to_bool() || 
                     m.message == "turnback" && getAttr("counterclock").to_bool())
                     ? rotate_cw((Direction)state) : rotate_ccw((Direction)state));
             return Value();
         } else if (m.message == "signal") {
             if (m.value == 1)
                 toggleState();
+            else if (m.value == 0 && server::GameCompatibility != GAMET_ENIGMA)
+                // rotate mirror in opposite direction
+                setState(!getAttr("counterclock").to_bool() ? rotate_ccw((Direction)state) : rotate_cw((Direction)state));
             return Value();
         } else if (m.message == "_trigger") {
             if (m.value == 1)
@@ -147,6 +150,7 @@
         if (isDisplayable()) {
             init_model();
             RecalcLight();
+            sound_event ("mirrorturn");
         }
      }
     



From andreasl at mail.berlios.de  Wed Jun 25 01:13:21 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Wed, 25 Jun 2008 01:13:21 +0200
Subject: [Enigma-game-svn] r1191 - team_levelpacks/team_test_new_api
Message-ID: <200806242313.m5ONDLZS030037@sheep.berlios.de>

Author: andreasl
Date: 2008-06-25 01:13:18 +0200 (Wed, 25 Jun 2008)
New Revision: 1191

Added:
   team_levelpacks/team_test_new_api/andreasT01_1.xml
Log:
Test Level new API:
 - Test level for it_trap.


Added: team_levelpacks/team_test_new_api/andreasT01_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/andreasT01_1.xml	2008-06-24 21:41:23 UTC (rev 1190)
+++ team_levelpacks/team_test_new_api/andreasT01_1.xml	2008-06-24 23:13:18 UTC (rev 1191)
@@ -0,0 +1,74 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Trap new API" el:subtitle="" el:id="testtrap_andreas"/>
+      <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
+      <el:author  el:name="Andreas Lochmann" el:email=""/>
+      <el:copyright>Copyright ? 2008 Andreas Lochmann</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+wo["ConserveLevel"] = true
+wo["ExtralifeGlasses"] = SPOT_DEATH + SPOT_TRAP
+
+ti[" "] = {"fl-sahara"}
+
+ti["."] = {"it_trap"}
+
+ti["@"] = {"#ac-blackball"}
+
+ti["l"] = {"st_laser", state = ON, orientation = SOUTH}
+ti["p"] = {"st_polarswitch", state = OFF}
+ti["e"] = {"it_extralife"}
+ti["g"] = {"it_glasses", state = SPOT_TRAP}
+ti["h"] = {"it_glasses", state = SPOT_SENSOR}
+ti["u"] = {"it_umbrella"}
+ti["d"] = {"st-death_invisible"}
+ti["b"] = {"it-blackbomb"}
+ti["y"] = {"it-dynamite"}
+ti["w"] = ti["."] .. {"st_window", faces="e"}
+ti["r"] = {"it_wrench"}
+ti["s"] = {"it_sensor", invisible = true} --{"it-spring2"}
+
+ti["A"] = ti["."] .. {"fl-leaves"}
+ti["B"] = ti["."] .. {"fl-swamp"}
+ti["C"] = ti["."] .. {"fl-metal"}
+ti["D"] = ti["."] .. {"fl-black"}
+ti["E"] = ti["."] .. {"fl-inverse"}
+ti["F"] = ti["."] .. {"fl-rough-blue"}
+ti["G"] = ti["."] .. {"fl-rough"}
+ti["H"] = ti["."] .. {"fl-floor_001"}
+
+w, h = wo(ti, " ", {
+"@                   ",
+"   uuuu  CCCC  DDDD ",
+"g  uuuu  CCCC  DDDD ",
+"h                   ",
+"   AAAA  BBBB  EEEE ",
+"   AAAA  BBBB  EEEE ",
+"s                   ",
+"   FFFF  GGGG  HHHH ",
+"   FFFF  GGGG  HHHH ",
+"l    b              ",
+"p    y    wr        ",
+"                    ",
+"e                  d"
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+     <el:string el:key="title">
+       <el:english el:translate="false"/>
+     </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+



From ral at mail.berlios.de  Wed Jun 25 13:27:35 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Wed, 25 Jun 2008 13:27:35 +0200
Subject: [Enigma-game-svn] r1192 - in trunk: data data/schemas src
Message-ID: <200806251127.m5PBRZJH010368@sheep.berlios.de>

Author: ral
Date: 2008-06-25 13:27:17 +0200 (Wed, 25 Jun 2008)
New Revision: 1192

Modified:
   trunk/data/api1init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/Object.cc
   trunk/src/items.cc
Log:
Trunk 1.1: new API reengineering
- it_trap
  - fix spotting with glasses
  - no trap opening while jumping over it
- it_landmine
  - no explosion while jumping over it
- Object:
  - add general message "kill"
- reengineering it-death
  - renamed to it_death
  

Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-06-24 23:13:18 UTC (rev 1191)
+++ trunk/data/api1init.lua	2008-06-25 11:27:17 UTC (rev 1192)
@@ -53,6 +53,7 @@
     it_coin_l = "it-coin4",
     it_cross = "it-cross",
     it_extralife = "it-extralife",
+    it_death = "it-death",
     it_floppy = "it-floppy",
     it_glasses = "it-glasses",
     it_glasses_broken = "it-glasses-broken",

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-06-24 23:13:18 UTC (rev 1191)
+++ trunk/data/models-2d.lua	2008-06-25 11:27:17 UTC (rev 1192)
@@ -558,8 +558,8 @@
 -- it-death --
 do
     local images = DefSubimages("it-death", {h=4})
-    DefAlias("it-death", images[1])
-    DefAnim("it-death-anim", BuildFrames(images, 100))
+    DefAlias("it_death", images[1])
+    DefAnim("it_death_anim", BuildFrames(images, 100))
 end
 
 -- Explosion --

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-06-24 23:13:18 UTC (rev 1191)
+++ trunk/data/schemas/objects.xml	2008-06-25 11:27:17 UTC (rev 1192)
@@ -48,6 +48,7 @@
     <msg name="closeall" type="nil"/>
     <msg name="hit" type="object"/>
     <msg name="inner_pull" type="dir"/>
+    <msg name="kill" type="nil"/>
     <msg name="off" type="nil"/>
     <msg name="on" type="nil"/>
     <msg name="open" type="nil"/>
@@ -82,6 +83,7 @@
       <attr name="state"/>
       <attr name="target"/>
       <action type="bool"/>
+      <msg name="kill"/>
       <msg name="toggle"/>
     </object>
     <object name="it" abstract="true"/>
@@ -115,6 +117,7 @@
       <msg name="_brush"/>
       <msg name="signal"/>
     </object>
+    <object name="it_death"/>
     <object name="it_extralife"/>
     <object name="it_extralife_new" init="true"/>
     <object name="it_floppy"/>

Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2008-06-24 23:13:18 UTC (rev 1191)
+++ trunk/src/Object.cc	2008-06-25 11:27:17 UTC (rev 1192)
@@ -150,6 +150,15 @@
         if (m.message == "_init") {
             // finalize nearest target and destination
             finalizeNearestObjectReferences();
+        } else if (m.message == "kill") {
+            switch (getObjectType()) {
+                case FLOOR:
+                    KillFloor(dynamic_cast<GridObject *>(this)->get_pos()); break;
+                case ITEM:
+                    KillItem(dynamic_cast<GridObject *>(this)->get_pos()); break;
+                case STONE:
+                    KillStone(dynamic_cast<GridObject *>(this)->get_pos()); break;
+            }
         }
         return Value();
     }

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-06-24 23:13:18 UTC (rev 1191)
+++ trunk/src/items.cc	2008-06-25 11:27:17 UTC (rev 1192)
@@ -3419,7 +3419,8 @@
             ACTORIMPULSE    =  4,
             SENSOR          =  8,
             LIGHTPASSENGER  = 16,
-            MAX             = 31
+            TRAP            = 32,
+            MAX             = 63
         };
         
         static void updateGlasses();
@@ -3569,10 +3570,12 @@
     }
     
     bool Trap::actor_hit(Actor *a) {
-        SendMessage(a, "fall");
-        if (state == 0) {
-            state = 1;
-            set_anim("it_trap_breaking");
+        if (!a->is_flying()) {
+            SendMessage(a, "fall");
+            if (state == 0) {
+                state = 1;
+                set_anim("it_trap_breaking");
+            }
         }
         return false;
     }
@@ -3601,9 +3604,11 @@
     
     bool Landmine::actor_hit (Actor *a) {
         const double ITEM_RADIUS = 0.3;
-        double dist = length(a->get_pos() - get_pos().center());
-        if (dist < ITEM_RADIUS)
-            explode();
+        if (!a->is_flying()) {
+            double dist = length(a->get_pos() - get_pos().center());
+            if (dist < ITEM_RADIUS)
+                explode();
+        }
         return false;
     }
     
@@ -3835,36 +3840,44 @@
 }
 
 /* -------------------- it-death -------------------- */
-namespace
-{
-    class Death : public Item {
-        CLONEOBJ(Death);
+    class DeathItem : public Item {
+        CLONEOBJ(DeathItem);
         DECL_TRAITS;
+        
+    public:
+        DeathItem();
+        
+        // ModelCallback interface
+        virtual void animcb();
 
-        bool active;
+        // Item interface
+        virtual bool actor_hit(Actor *a);
+        
+    };
+    
+    DeathItem::DeathItem() {
+    }
+    
+    void DeathItem::animcb() { 
+        set_model("it_death"); 
+        state = 0;
+     }
 
-        bool actor_hit(Actor *a) {
-            ActorInfo &ai = * a->get_actorinfo();
-            if (!ai.grabbed) {
-                SendMessage(a, "shatter");
-                if (!active) {
-                    active=true;
-                    set_anim("it-death-anim");
-                }
+    bool DeathItem::actor_hit(Actor *a) {
+        ActorInfo &ai = * a->get_actorinfo();
+        if (!ai.grabbed) {
+            SendMessage(a, "shatter");
+            if (state == 0) {
+                state = 1;
+                set_anim("it_death_anim");
             }
-            return false;
         }
+        return false;
+    }
+    
+    DEF_TRAITSF(DeathItem, "it_death", it_death, itf_static | itf_indestructible);
 
-    protected:
-        void animcb() { set_model("it-death"); active=false; }
 
-    public:
-        Death() : active(false) {}
-    };
-
-    DEF_TRAITSF(Death, "it-death", it_death, itf_static | itf_indestructible);
-}
-
 /* -------------------- HStrip and VStrip -------------------- */
 namespace
 {
@@ -4123,7 +4136,7 @@
     Coin::setup();
     Crack::setup();
     RegisterItem (new Cross);
-    RegisterItem (new Death);
+    RegisterItem (new DeathItem);
     RegisterItem (new Debris);
     RegisterItem (new Document);
     RegisterItem (new Drop);



From ral at mail.berlios.de  Wed Jun 25 20:38:51 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Wed, 25 Jun 2008 20:38:51 +0200
Subject: [Enigma-game-svn] r1193 - in trunk: data data/schemas src src/stones
Message-ID: <200806251838.m5PIcpEw002901@sheep.berlios.de>

Author: ral
Date: 2008-06-25 20:38:38 +0200 (Wed, 25 Jun 2008)
New Revision: 1193

Added:
   trunk/src/stones/ChessStone.cc
   trunk/src/stones/ChessStone.hh
   trunk/src/stones/DeathStone.cc
   trunk/src/stones/DeathStone.hh
Modified:
   trunk/data/api1init.lua
   trunk/data/api2init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/data/schemas/objects.xsd
   trunk/src/Makefile.am
   trunk/src/ox_extra.cc
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones_complex.cc
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering
- st-death reengineering
  - new name st_death, st_death_invisible
  - invisible death can be toggled for temporary visibility
- st-chess reengineering
  - new name st_chess, st_chess_black, st_chess_white
  - removed messages move_nne,...
  - message "move" takes a position as move direction
  - attributes direction1, direction2 are no longer supported
  - message made safe
  - constants for move directions NNE,NEE,...
Note:
- st-chess needs some internal cleanup as marked with TODOs


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/data/api1init.lua	2008-06-25 18:38:38 UTC (rev 1193)
@@ -113,7 +113,11 @@
     st_brick_new = "st-bigbrick-new",
     st_brick_nes = "st-bigbrick-nes",
     st_brick_nesw = "st-bigbrick-nesw",
+    st_chess_black = "st-chess_black",
+    st_chess_white = "st-chess_white",
     st_coinslot = "st-coinslot",
+    st_death = "st-death",
+    st_death_invisible = "st-death_invisible",
     st_floppy = "st-floppy",
     st_fourswitch = "st-fourswitch",
     st_laser_w = "st-laser-w",

Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/data/api2init.lua	2008-06-25 18:38:38 UTC (rev 1193)
@@ -107,6 +107,16 @@
 SLASH      = 2
 VERTICAL   = 3
 
+-- multidirections as used by st_chess
+NNE = po(1, -2)
+NEE = po(2, -1)
+SEE = po(2, 1)
+SSE = po(1, 2)
+SSW = po(-1, 2)
+SWW = po(-2, 1)
+NWW = po(-2, -1)
+NNW = po(-2, -1)
+
 -- essential
 DISPENSIBLE   = 0
 INDISPENSIBLE = 1
@@ -121,6 +131,7 @@
 SPOT_LIGHTPASSENGER =  16
 SPOT_TRAP           =  32
 
+
 -- Follower
 FOLLOW_NO     = 0
 FOLLOW_SCROLL = 1

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/data/models-2d.lua	2008-06-25 18:38:38 UTC (rev 1193)
@@ -849,11 +849,11 @@
         --local f2 = BuildFrames(img2, 40)
         local f2 = f1
         local f3 = BuildFrames(img1, 500)
-        DefAnim("st-chess"..colour.."-disappearing", f1);
-        DefAnim("st-chess"..colour.."-appearing", ReverseFrames(f1))
-        DefAnim("st-chess"..colour.."-captured", f2);
-        DefAnim("st-chess"..colour.."-swamp", f3);
-        DefRoundStone("st-chess"..colour, img1[1])
+        DefAnim("st_chess"..colour.."-disappearing", f1);
+        DefAnim("st_chess"..colour.."-appearing", ReverseFrames(f1))
+        DefAnim("st_chess"..colour.."-captured", f2);
+        DefAnim("st_chess"..colour.."-swamp", f3);
+        DefRoundStone("st_chess"..colour, img1[1])
     end
 
     make_chess("_black")

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/data/schemas/objects.xml	2008-06-25 18:38:38 UTC (rev 1193)
@@ -44,11 +44,14 @@
     <attr name="transparent" type="bool" default="false" rw="rw"/>
   </attributes>
   <messages>
+    <msg name="capture" type="nil"/>
     <msg name="close" type="nil"/>
     <msg name="closeall" type="nil"/>
+    <msg name="flip" type="nil"/>
     <msg name="hit" type="object"/>
     <msg name="inner_pull" type="dir"/>
     <msg name="kill" type="nil"/>
+    <msg name="move" type="pos"/>
     <msg name="off" type="nil"/>
     <msg name="on" type="nil"/>
     <msg name="open" type="nil"/>
@@ -343,6 +346,19 @@
     <object name="st_brick_nesw">
       <attr name="connections" value="nesw"/>
     </object>
+    <object name="st_chess">
+      <attr name="color" default="0"/>
+      <msg name="capture"/>
+      <msg name="flip"/>
+      <msg name="move"/>
+      <msg name="signal"/>
+    </object>
+    <object name="st_chess_black">
+      <attr name="color" value="0"/>
+    </object>
+    <object name="st_chess_white">
+      <attr name="color" value="1"/>
+    </object>
     <object name="st_coinslot">
       <attr name="instant"/>
       <attr name="interval_s"/>
@@ -353,6 +369,13 @@
     <object name="st_coinslot_instant">
       <attr name="instant" value="true"/>
     </object>
+    <object name="st_death">
+      <attr name="invisible"/>
+      <msg name="_model_reanimated"/>
+    </object>
+    <object name="st_death_invisible">
+      <attr name="invisible" value="true"/>
+    </object>
     <object name="st_floppy">
       <msg name="on"/>
       <msg name="off"/>

Modified: trunk/data/schemas/objects.xsd
===================================================================
--- trunk/data/schemas/objects.xsd	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/data/schemas/objects.xsd	2008-06-25 18:38:38 UTC (rev 1193)
@@ -113,7 +113,7 @@
       <xs:enumeration value="double"/>
       <xs:enumeration value="nil"/>
       <xs:enumeration value="dir"/>
-<!--      <xs:enumeration value="pos"/>  -->
+      <xs:enumeration value="pos"/>
       <xs:enumeration value="string"/>
       <xs:enumeration value="enum"/>
       <xs:enumeration value="object"/>

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/src/Makefile.am	2008-06-25 18:38:38 UTC (rev 1193)
@@ -203,12 +203,16 @@
 	stones/BlockerStone.hh	\
 	stones/BoulderStone.cc	\
 	stones/BoulderStone.hh	\
+	stones/ChessStone.cc	\
+	stones/ChessStone.hh	\
 	stones/ClusterStone.cc	\
 	stones/ClusterStone.hh	\
 	stones/CoinSlot.cc	\
 	stones/CoinSlot.hh	\
 	stones/ConnectiveStone.cc	\
 	stones/ConnectiveStone.hh	\
+	stones/DeathStone.cc	\
+	stones/DeathStone.hh	\
 	stones/FloppySwitch.cc   \
 	stones/FloppySwitch.hh   \
 	stones/FourSwitch.cc	\

Modified: trunk/src/ox_extra.cc
===================================================================
--- trunk/src/ox_extra.cc	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/src/ox_extra.cc	2008-06-25 18:38:38 UTC (rev 1193)
@@ -169,8 +169,8 @@
     UNUSED,              // OxydExtra stone 0x2c
     "st_floppy",         // OxydExtra stone 0x2d
     UNUSED,              // OxydExtra stone 0x2e
-    "st-death",          // OxydExtra stone 0x2f
-    "st-death_invisible", // OxydExtra stone 0x30
+    "st_death",          // OxydExtra stone 0x2f
+    "st_death_invisible", // OxydExtra stone 0x30
     "st-oneway_black-w", // OxydExtra stone 0x31
     UNUSED,              // OxydExtra stone 0x32
     "st-oneway_black-n", // OxydExtra stone 0x33

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/src/ox_magnum.cc	2008-06-25 18:38:38 UTC (rev 1193)
@@ -174,8 +174,8 @@
     "st_floppy",                // OxydMagnum stone 0x31
     "st-knight",                // OxydMagnum stone 0x32
     "st_fourswitch",            // OxydMagnum stone 0x33 (Level 51 and 100)
-    "st-death",                 // OxydMagnum stone 0x34
-    "st-death_invisible",       // OxydMagnum stone 0x35
+    "st_death",                 // OxydMagnum stone 0x34
+    "st_death_invisible",       // OxydMagnum stone 0x35
     "st-oneway_black-w",        // OxydMagnum stone 0x36
     "st-oneway_black-e",        // OxydMagnum stone 0x37
     "st-oneway_black-n",        // OxydMagnum stone 0x38

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/src/ox_oxyd1.cc	2008-06-25 18:38:38 UTC (rev 1193)
@@ -204,8 +204,8 @@
     "st_floppy",                // Oxyd1 stone 0x31
     "st-knight",                // Oxyd1 stone 0x32
     0,                          // Oxyd1 stone 0x33 oscillator (properties set in oxyd.cc)
-    "st-death",                 // Oxyd1 stone 0x34
-    "st-death_invisible",       // Oxyd1 stone 0x35
+    "st_death",                 // Oxyd1 stone 0x34
+    "st_death_invisible",       // Oxyd1 stone 0x35
     "st-oneway_black-w",        // Oxyd1 stone 0x36
     "st-oneway_black-e",        // Oxyd1 stone 0x37
     "st-oneway_black-n",        // Oxyd1 stone 0x38

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/src/ox_peroxyd.cc	2008-06-25 18:38:38 UTC (rev 1193)
@@ -241,8 +241,8 @@
     "st_key",                   // PerOxyd stone 0x2c
     "st_floppy",                // PerOxyd stone 0x2d
     "",                         // PerOxyd stone 0x2e (?)
-    "st-death",                 // PerOxyd stone 0x2f
-    "st-death_invisible",       // PerOxyd stone 0x30
+    "st_death",                 // PerOxyd stone 0x2f
+    "st_death_invisible",       // PerOxyd stone 0x30
     "st-oneway_black-w",        // PerOxyd stone 0x31
     "st-oneway_black-e",        // PerOxyd stone 0x32
     "st-oneway_black-n",        // PerOxyd stone 0x33

Added: trunk/src/stones/ChessStone.cc
===================================================================
--- trunk/src/stones/ChessStone.cc	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/src/stones/ChessStone.cc	2008-06-25 18:38:38 UTC (rev 1193)
@@ -0,0 +1,292 @@
+/*
+ * Copyright (C) 2007 Andreas Lochmann
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/ChessStone.hh"
+#include "errors.hh"
+//#include "main.hh"
+#include "player.hh"
+
+namespace enigma {
+    double ChessStone::capture_interval = 0.1;
+    double ChessStone::hit_threshold = 1.5;
+
+    ChessStone::ChessStone(int color) {
+        newcolor = color;
+        Stone::setAttr("color", color);
+        destination = GridPos(0,0);
+        capture_retry = 0;
+        rememberFalling = false;
+        rememberSwamp = false;
+        state = IDLE;
+    }
+
+    ChessStone::~ChessStone() {
+        GameTimer.remove_alarm (this);
+    }
+    
+    std::string ChessStone::getClass() const {
+        return "st_chess";
+    }
+    
+    void ChessStone::setAttr(const string& key, const Value &val) {
+        if (key == "color") {
+            set_color(to_int(val));
+        } else
+            Stone::setAttr(key, val);
+    }
+
+    Value ChessStone::message(const Message &m) {
+        if (m.message == "capture") {
+            if (isDisplayable() && state == IDLE && m.value.to_string() != getKind())
+                if (try_state(CAPTURED)) {
+                    set_anim(get_model_name() + "-captured");
+                    return true;
+                }
+            return Value();
+        } else if(m.message == "move") {
+            if (isDisplayable())
+                return message_move(m.value);
+            else
+                return Value();
+        } else if (m.message == "signal") {
+            set_color(to_int(m.value));
+            return Value();
+        } else if (m.message == "flip") {
+            set_color(1 - newcolor); //(int)getAttr("color"));
+            return Value();
+        }
+        return Stone::message(m);
+    }
+    
+    void setState(int extState) {
+        // block any write attempts
+    }
+
+    void ChessStone::init_model() { 
+        set_model(get_model_name());
+    }
+
+    void ChessStone::animcb() {
+        Stone *st;
+        switch (state) {
+            case APPEARING:
+                if (try_state(IDLE))
+                // Maybe falling in the meantime? Otherwise:
+                    init_model();
+                break;
+            case DISAPPEARING:
+                // Maybe the floor has changed into swamp or abyss?
+                if (!rememberFalling && !rememberSwamp) {
+                    if (try_state(APPEARING)) {
+                        st = GetStone(destination);
+                        if (st) {
+                            // Something went wrong while killing the old
+                            // stone, or maybe a third one intervened.
+                            // Don't move, just reappear at old position.                
+                        } else {
+                            move_stone(destination, "movesmall");
+                            SendMessage(GetFloor(destination), "capture");
+                        }
+                        // maybe a floor-change has happened, but during
+                        // state APPEARING this doesn't mean anything:
+                        set_anim(get_model_name()+"-appearing");
+                    }
+                    break;
+                }
+                // Else: If floor is swamp or abyss, kill the stone. Do this
+                // just by continuing to the next case:
+            case CAPTURED:
+            case FALLING:
+            case SWAMP:
+                KillStone(get_pos());
+                break;
+            default:
+               ASSERT(0, XLevelRuntime, "ChessStone: inconsistent state in animcb()");
+        }
+    }
+
+    void ChessStone::actor_hit(const StoneContact &sc) {
+         Value accolor = sc.actor->getAttr("color");
+         if (player::WieldedItemIs (sc.actor, "it-magicwand")) {
+             sound_event ("stonepaint");
+             set_color(1 - (int)getAttr("color"));
+             // If not IDLE, color will be set next time IDLE is set.
+         } else if (accolor && getAttr("color") == accolor) {
+            V2 v = sc.actor->get_vel();
+            Direction dir1 = get_push_direction(sc);
+            if(dir1 == NODIR)  return;
+            Direction dir2 = NODIR;
+            if (dir1 == SOUTH || dir1 == NORTH) {
+                dir2 = v[0] >  hit_threshold ? EAST :
+                       v[0] < -hit_threshold ? WEST : NODIR;
+            } else {
+                dir2 = v[1] >  hit_threshold ? SOUTH :
+                       v[1] < -hit_threshold ? NORTH : NODIR;
+            }
+            if(dir2 == NODIR)  return;
+            // maybe_move_to tests for state == IDLE by itself.
+            maybe_move_to(dir1, dir2);
+        }
+    }
+
+    void ChessStone::on_impulse(const Impulse& impulse) {
+    }
+    
+    bool ChessStone::is_removable() const {    // Interface for st-swap and st-pull
+        return state == IDLE;
+    }
+
+    void ChessStone::on_floor_change() {
+        Floor *fl = GetFloor(get_pos());
+        if (fl != NULL) {
+            if (fl->is_kind("fl-abyss"))
+                try_state(FALLING);
+            if (fl->is_kind("fl-swamp"))
+                try_state(SWAMP);
+        }
+    }
+    
+    void ChessStone::alarm() {
+        switch(state) {
+            case CAPTURING:
+                if(!GetStone(destination)) {
+                    if(try_state(DISAPPEARING))
+                        set_anim(get_model_name() + "-disappearing");
+                    break;
+                } else if(capture_retry < max_capture_retry) {
+                    ++capture_retry;
+                    GameTimer.set_alarm(this, capture_interval, false);
+                } else {
+                    // Cancel efforts to capture foreign stone.
+                    capture_retry = 0;
+                    try_state(IDLE);
+                }
+                break;
+            default:
+               ASSERT(0, XLevelRuntime, "ChessStone: inconsistent state in alarm()");
+        }
+    }
+
+
+    std::string ChessStone::get_model_name() {
+        return getClass() + ((getAttr("color") == 0) ? "_black" : "_white");
+    }
+    
+    Value ChessStone::maybe_move_to(Direction dir1, Direction dir2) {
+        if (state == IDLE) {
+            // check for fire, step by step
+            destination = move(get_pos(), dir1);
+            if (Item *it = GetItem(destination))
+                if (get_id(it) == it_burnable_burning)
+                    return Value();
+            destination = move(destination, dir2);
+            if (Item *it = GetItem(destination))
+                if (get_id(it) == it_burnable_burning)
+                    return Value();
+            destination = move(destination, dir1);
+            if (Item *it = GetItem(destination))
+                if (get_id(it) == it_burnable_burning)
+                    return Value();
+            // check for boundary
+            if (!IsInsideLevel(destination))  return Value();
+            // check for stone
+            if (!GetStone(destination)) {
+                // Simple case: Just move.
+                if (try_state(DISAPPEARING)) {
+                    set_anim(get_model_name() + "-disappearing");
+                    return true;
+                } else
+                    return Value();
+            } else {
+                // Test stone. Is it opposite chess stone or totally another one?
+                Stone *st = GetStone(destination);
+                if(to_int(SendMessage(st, "capture", Value(get_model_name()))) ) {
+                    // Give it some time for animation, then replace it.
+                    ASSERT(try_state(CAPTURING), XLevelRuntime,
+                        "ChessStone: strange things happening in maybe_move_to");
+                    // must work, because state is IDLE
+                    GameTimer.set_alarm(this, capture_interval, false);
+                    capture_retry = 0;
+                    return true;
+                }
+                return Value();
+            }
+        }
+        return Value();
+    }
+
+    Value ChessStone::message_move(Value moveDir) {
+        GridPos dir = moveDir;
+        if (std::abs(dir.x) == 2 && std::abs(dir.y) == 1)
+            return maybe_move_to(dir.x > 0 ? EAST : WEST, dir.y > 0 ? SOUTH : NORTH);
+        if (std::abs(dir.x) == 1 && std::abs(dir.y) == 2)
+            return maybe_move_to(dir.y > 0 ? SOUTH : NORTH, dir.x > 0 ? EAST : WEST);
+
+        return Value();
+    }
+
+    bool ChessStone::try_state(State newstate) {
+        if (state != FALLING && state != SWAMP) {
+            // Switch to FALLING or SWAMP only when IDLE,
+            // but remember them!
+            if (newstate == FALLING)
+                rememberFalling = true;
+            else if (newstate == SWAMP)
+                rememberSwamp = true;
+            else
+                state = newstate;        
+            if (state == IDLE &&  getAttr("color") != newcolor)
+                set_color(newcolor);
+            if (state == IDLE && rememberFalling) {
+                state = FALLING;
+                set_anim(get_model_name() + "-disappearing");
+            }
+            if (state == IDLE && rememberSwamp) {
+                state = SWAMP;
+                set_anim(get_model_name() + "-swamp");
+            }
+        }
+        return state == newstate;
+    }
+
+    void ChessStone::set_color(int color) {
+        if(color != 0 && color != 1) {
+            ASSERT(0, XLevelRuntime, "ChessStone: argument to color not 0 or 1");
+        }
+        if(state == IDLE) {
+            Stone::setAttr("color", color);
+            newcolor = color;
+            if (isDisplayable())
+                init_model();
+        } else {
+            // Remember this color and set it the next time IDLE is set.
+            newcolor = color;
+        }
+    }
+    
+    DEF_TRAITSM(ChessStone, "st_chess", st_chess, MOVABLE_IRREGULAR);
+    
+    BOOT_REGISTER_START
+        BootRegister(new ChessStone(0), "st_chess");
+        BootRegister(new ChessStone(0), "st_chess_black");
+        BootRegister(new ChessStone(1), "st_chess_white");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/ChessStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/ChessStone.hh
===================================================================
--- trunk/src/stones/ChessStone.hh	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/src/stones/ChessStone.hh	2008-06-25 18:38:38 UTC (rev 1193)
@@ -0,0 +1,91 @@
+/*
+ * Copyright (C) 2007 Andreas Lochmann
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef CHESSSTONE_HH
+#define CHESSSTONE_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     * Note: this stone is made safe for swap/pull grid take offs by restriction of
+     * all critical operations to the IDLE state.
+     */
+    class ChessStone : public Stone, public TimeHandler {
+        CLONEOBJ(ChessStone);
+        DECL_TRAITS;
+
+    private:
+        // Variables and Constants
+        enum State {IDLE, APPEARING, DISAPPEARING, CAPTURING,
+                    CAPTURED, FALLING, SWAMP};
+        
+    public:
+        ChessStone(int color);
+        virtual ~ChessStone();
+        
+        // Object interface
+        virtual std::string getClass() const;
+        virtual void setAttr(const string& key, const Value &val);
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+        virtual void on_impulse(const Impulse& impulse);
+        virtual bool is_removable() const;
+        virtual void on_floor_change();
+
+        // TimeHandler interface
+        void alarm();
+        
+    private:
+        static double capture_interval;
+        static double hit_threshold;
+        static const int max_capture_retry = 20;
+
+        GridPos destination;   // TODO -> attribute
+        int newcolor;  // Buffers a color-changing message while not IDLE.  // TODO -> objFlags
+        int capture_retry;    // TODO -> objFlags
+        bool rememberFalling; // TODO -> objFlags
+        bool rememberSwamp;   // TODO -> objFlags
+
+        // Methods
+        string get_model_name();
+        Value maybe_move_to(Direction dir1, Direction dir2);
+        Value message_move(Value moveDir);
+        bool try_state(State newstate);
+        void set_color(int color);
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/ChessStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/DeathStone.cc
===================================================================
--- trunk/src/stones/DeathStone.cc	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/src/stones/DeathStone.cc	2008-06-25 18:38:38 UTC (rev 1193)
@@ -0,0 +1,118 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/DeathStone.hh"
+//#include "main.hh"
+
+namespace enigma {
+    DeathStone::DeathStone(bool isInvisible) : Stone () {
+        if (isInvisible)
+            objFlags |= OBJBIT_INVISIBLE;
+            
+        state = IDLE;
+    }
+
+    std::string DeathStone::getClass() const {
+        return "st_death";
+    }
+        
+    void DeathStone::setAttr(const string& key, const Value &val) {
+        if (key == "invisible") {
+            if (val.to_bool() != ((objFlags & OBJBIT_INVISIBLE) != 0)) {
+                // change of visibility
+                objFlags ^= OBJBIT_INVISIBLE;
+                if (isDisplayable())
+                    init_model();
+            }
+        } else
+            Stone::setAttr(key, val);
+    }
+    
+    Value DeathStone::getAttr(const std::string &key) const {
+        if (key == "invisible") {
+            return (objFlags & OBJBIT_INVISIBLE) != 0;
+        } else
+            return Stone::getAttr(key);
+    }
+    
+    Value DeathStone::message(const Message &m) {
+        if (m.message == "_model_reanimated") {
+            state = IDLE;   // reset any running anim, be ready to bump again on new grid
+            init_model();   // visibility might have changed
+        } else if (m.message == "_glasses") {
+            init_model();
+            return Value();
+        }
+        return Stone::message(m);
+    }
+            
+    void DeathStone::setState(int extState) {
+        if (state == IDLE && extState == 1 && isDisplayable()) {
+            state = PULSING;
+            set_anim("st-death-anim");
+        }
+    }
+
+    void DeathStone::init_model() {
+        if (state == IDLE) {
+            if ((objFlags & OBJBIT_INVISIBLE) && ((server::GlassesVisibility & 1) == 0))
+                set_model("invisible");
+            else
+                set_model("st-death");
+        }
+        // PULSING anim is always visible and should continue independent on init_model calls
+    }
+    
+    void DeathStone::animcb() {
+        if (state == PULSING) {
+            state = IDLE;
+            init_model();
+        }
+    }
+    
+    void DeathStone::actor_hit(const StoneContact &sc) {
+        SendMessage(sc.actor, "shatter");
+        if (state == IDLE) {
+            state = PULSING;
+            set_anim("st-death-anim");
+        }
+    }
+
+    void DeathStone::actor_touch(const StoneContact &sc) {
+        // even a slight touch should shatter the actor: 
+         actor_hit(sc);
+    }
+
+    int DeathStone::traitsIdx() const {
+        return (objFlags & OBJBIT_INVISIBLE) ? 1 : 0;
+    }
+
+    
+    StoneTraits DeathStone::traits[2] = {
+        {"st_death", st_death, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+        {"st_death_invisible", st_death_invisible, stf_none, material_stone, 1.0, MOVABLE_PERSISTENT},
+    };
+    
+    BOOT_REGISTER_START
+        BootRegister(new DeathStone(false), "st_death");
+        BootRegister(new DeathStone(true), "st_death_invisible");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/DeathStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/DeathStone.hh
===================================================================
--- trunk/src/stones/DeathStone.hh	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/src/stones/DeathStone.hh	2008-06-25 18:38:38 UTC (rev 1193)
@@ -0,0 +1,72 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef DEATHSTONE_HH
+#define DEATHSTONE_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class DeathStone : public Stone {
+        CLONEOBJ(DeathStone);
+        DECL_TRAITS_ARRAY(2, traitsIdx());
+    private:
+        enum iState {
+            IDLE,     ///< 
+            PULSING   ///< kill animation
+        };
+        
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_INVISIBLE   =   1<<24,  ///< Object is invisible 
+        };
+    public:
+        DeathStone(bool isInvisible);
+        
+        // Object interface
+        virtual std::string getClass() const;
+        virtual void setAttr(const string& key, const Value &val);
+        virtual Value getAttr(const std::string &key) const;
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+        virtual void actor_touch (const StoneContact &sc);
+
+    private:
+        int traitsIdx() const;
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/DeathStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/src/stones_complex.cc	2008-06-25 18:38:38 UTC (rev 1193)
@@ -2298,293 +2298,6 @@
 }
 
 
-/* -------------------- Chess stone -------------------- */
-
-namespace
-{
-    class ChessStone : public Stone, public TimeHandler {
-        CLONEOBJ(ChessStone);
-        DECL_TRAITS;
-    public:
-        ChessStone (int color) {
-            newcolor = color;
-            Stone::setAttr("color", color);
-            destination = GridPos(0,0);
-            capture_retry = 0;
-            rememberFalling = false;
-            rememberSwamp = false;
-            state = IDLE;
-        }
-        virtual ~ChessStone() {
-            GameTimer.remove_alarm (this);
-        }
-        void init_model();
-        void animcb();
-        void setAttr(const string& key, const Value &val);
-        virtual Value message(const Message &m);
-        void actor_hit(const StoneContact &sc);
-        void on_impulse(const Impulse& impulse) {}
-        void alarm();
-    private:
-        // Variables and Constants
-        enum State {IDLE, APPEARING, DISAPPEARING, CAPTURING,
-                    CAPTURED, FALLING, SWAMP} state;
-        GridPos destination;
-        int newcolor;  // Buffers a color-changing message while not IDLE.
-        int capture_retry;
-        static const int max_capture_retry = 20;
-        static double capture_interval;
-        static double hit_threshold;
-        bool rememberFalling;
-        bool rememberSwamp;
-
-        // Methods
-        string get_model_name();
-        Value maybe_move_to(Direction dir1, Direction dir2);
-        virtual Value message_move(Direction dir1, Direction dir2);
-        bool try_state(State newstate);
-        void set_color(int color);
-        void on_floor_change();
-
-        // Interface for st-swap and st-pull
-        bool is_removable() const { return state == IDLE; }
-    };
-    DEF_TRAITSM(ChessStone, "st-chess", st_chess, MOVABLE_IRREGULAR);
-    
-    double ChessStone::capture_interval = 0.1;
-    double ChessStone::hit_threshold = 1.5;
-
-    string ChessStone::get_model_name() {
-        string mname = get_kind();
-        mname += (getAttr("color") == 0) ? "_black" : "_white";
-        return mname;
-    }
-
-    void ChessStone::init_model() { set_model(get_model_name()); }
-
-    void ChessStone::animcb() {
-        Stone *st;
-        switch (state) {
-        case APPEARING:
-            if(try_state(IDLE))
-            // Maybe falling in the meantime? Otherwise:
-                init_model();
-            break;
-        case DISAPPEARING:
-            // Maybe the floor has changed into swamp or abyss?
-            if(!rememberFalling && !rememberSwamp) {
-                if(try_state(APPEARING)) {
-                    st = GetStone(destination);
-                    if(st) {
-                        // Something went wrong while killing the old
-                        // stone, or maybe a third one intervened.
-                        // Don't move, just reappear at old position.                
-                    } else {
-                        move_stone(destination, "movesmall");
-                        SendMessage(GetFloor(destination), "capture");
-                    }
-                    // maybe a floor-change has happened, but during
-                    // state APPEARING this doesn't mean anything:
-                    set_anim(get_model_name()+"-appearing");
-                }
-                break;
-            }
-            // Else: If floor is swamp or abyss, kill the stone. Do this
-            // just by continuing to the next case:
-        case CAPTURED:
-        case FALLING:
-        case SWAMP:
-            KillStone(get_pos());
-            break;
-        default:
-           ASSERT(0, XLevelRuntime, "ChessStone: inconsistent state in animcb()");
-        }
-    }
-
-    void ChessStone::actor_hit(const StoneContact &sc) {
-         Value accolor = sc.actor->getAttr("color");
-         if (player::WieldedItemIs (sc.actor, "it-magicwand")) {
-             sound_event ("stonepaint");
-             set_color(1 - (int)getAttr("color"));
-             // If not IDLE, color will be set next time IDLE is set.
-         } else if (accolor && getAttr("color") == accolor) {
-            V2 v = sc.actor->get_vel();
-            Direction dir1 = get_push_direction(sc);
-            if(dir1 == NODIR)  return;
-            Direction dir2 = NODIR;
-            if (dir1 == SOUTH || dir1 == NORTH) {
-                dir2 = v[0] >  hit_threshold ? EAST :
-                       v[0] < -hit_threshold ? WEST : NODIR;
-            } else {
-                dir2 = v[1] >  hit_threshold ? SOUTH :
-                       v[1] < -hit_threshold ? NORTH : NODIR;
-            }
-            if(dir2 == NODIR)  return;
-            // maybe_move_to tests for state == IDLE by itself.
-            maybe_move_to(dir1, dir2);
-        }
-    }
-
-    Value ChessStone::maybe_move_to(Direction dir1, Direction dir2) {
-        if(state == IDLE) {
-            // check for fire, step by step
-            destination = move(get_pos(), dir1);
-            if(Item *it = GetItem(destination))
-                if(get_id(it) == it_burnable_burning)
-                    return Value();
-            destination = move(destination, dir2);
-            if(Item *it = GetItem(destination))
-                if(get_id(it) == it_burnable_burning)
-                    return Value();
-            destination = move(destination, dir1);
-            if(Item *it = GetItem(destination))
-                if(get_id(it) == it_burnable_burning)
-                    return Value();
-            // check for boundary
-            if(!IsInsideLevel(destination))  return Value();
-            // check for stone
-            if(!GetStone(destination)) {
-                // Simple case: Just move.
-                if(try_state(DISAPPEARING)) {
-                    set_anim(get_model_name() + "-disappearing");
-                    return true;
-                } else
-                    return Value();
-            } else {
-                // Test stone. Is it opposite chess stone or totally another one?
-                Stone *st = GetStone(destination);
-                if(to_int(SendMessage(st, "capture", Value(get_model_name()))) ) {
-                    // Give it some time for animation, then replace it.
-                    ASSERT(try_state(CAPTURING), XLevelRuntime,
-                        "ChessStone: strange things happening in maybe_move_to");
-                    // must work, because state is IDLE
-                    GameTimer.set_alarm(this, capture_interval, false);
-                    capture_retry = 0;
-                    return true;
-                }
-                return Value();
-            }
-        }
-        return Value();
-    }
-
-    void ChessStone::alarm() {
-        switch(state) {
-        case CAPTURING:
-            if(!GetStone(destination)) {
-                if(try_state(DISAPPEARING))
-                    set_anim(get_model_name() + "-disappearing");
-                break;
-            } else if(capture_retry < max_capture_retry) {
-                ++capture_retry;
-                GameTimer.set_alarm(this, capture_interval, false);
-            } else {
-                // Cancel efforts to capture foreign stone.
-                capture_retry = 0;
-                try_state(IDLE);
-            }
-            break;
-        default:
-           ASSERT(0, XLevelRuntime, "ChessStone: inconsistent state in alarm()");
-        }
-    }
-
-    Value ChessStone::message(const Message &m) {
-        if(m.message == "capture") {
-            if(state == IDLE && m.value.to_string() != get_model_name())
-                if(try_state(CAPTURED)) {
-                    set_anim(get_model_name() + "-captured");
-                    return true;
-                }
-            return Value();
-        } else if(m.message == "move_nne") { return message_move(NORTH, EAST); }
-        else   if(m.message == "move_een") { return message_move(EAST, NORTH); }
-        else   if(m.message == "move_ees") { return message_move(EAST, SOUTH); }
-        else   if(m.message == "move_sse") { return message_move(SOUTH, EAST); }
-        else   if(m.message == "move_ssw") { return message_move(SOUTH, WEST); }
-        else   if(m.message == "move_wws") { return message_move(WEST, SOUTH); }
-        else   if(m.message == "move_wwn") { return message_move(WEST, NORTH); }
-        else   if(m.message == "move_nnw") { return message_move(NORTH, WEST); }
-        else   if(m.message == "move") {
-            Direction dir1 = to_direction(getAttr("direction1"));
-            Direction dir2 = to_direction(getAttr("direction2"));
-            return message_move(dir1, dir2);
-        } else if(m.message == "signal") {
-            set_color(to_int(m.value));
-            return Value();
-        } else if(m.message == "flip") {
-            set_color(1 - newcolor); //(int)getAttr("color"));
-            return Value();
-        }
-        return Stone::message(m);
-    }
-
-    Value ChessStone::message_move(Direction dir1, Direction dir2) {
-        // Restrict message-moves to chess-knight-moves
-        // state == IDLE is tested by maybe_move_to.
-        if((((dir1==NORTH || dir1==SOUTH) && (dir2==EAST || dir2==WEST))
-           || ((dir1==EAST || dir1==WEST) && (dir2==SOUTH || dir2==NORTH))))
-            return maybe_move_to(dir1, dir2);
-        return Value();
-    }
-
-    bool ChessStone::try_state(State newstate) {
-        if (state != FALLING && state != SWAMP) {
-            // Switch to FALLING or SWAMP only when IDLE,
-            // but remember them!
-            if (newstate == FALLING)
-                rememberFalling = true;
-            else if (newstate == SWAMP)
-                rememberSwamp = true;
-            else
-                state = newstate;        
-            if(state == IDLE &&  getAttr("color") != newcolor)
-                set_color(newcolor);
-            if(state == IDLE && rememberFalling) {
-                state = FALLING;
-                set_anim(get_model_name() + "-disappearing");
-            }
-            if(state == IDLE && rememberSwamp) {
-                state = SWAMP;
-                set_anim(get_model_name() + "-swamp");
-            }
-        }
-        return state == newstate;
-    }
-
-    void ChessStone::setAttr(const string& key, const Value &val) {
-        if(key == "color") {
-            set_color(to_int(val));
-        } else
-            Stone::setAttr(key, val);
-    }
-
-    void ChessStone::set_color(int color) {
-        if(color != 0 && color != 1) {
-            ASSERT(0, XLevelRuntime, "ChessStone: argument to color not 0 or 1");
-        }
-        if(state == IDLE) {
-            Stone::setAttr("color", color);
-            newcolor = color;
-            init_model();
-        } else {
-            // Remember this color and set it the next time IDLE is set.
-            newcolor = color;
-        }
-    }
-
-    void ChessStone::on_floor_change() {
-        Floor *fl = GetFloor(get_pos());
-        if (fl != NULL) {
-            if (fl->is_kind("fl-abyss"))
-                try_state(FALLING);
-            if (fl->is_kind("fl-swamp"))
-                try_state(SWAMP);
-        }
-    }
-}
-
-
 // --------------------------------------------------------------------------------
 
 void Init_complex()
@@ -2683,9 +2396,6 @@
     Register (new Turnstile_E);
     Register (new Turnstile_W);
 
-    Register("st-chess_black", new ChessStone(0));
-    Register("st-chess_white", new ChessStone(1));
-
 }
 
 } // namespace enigma

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-06-25 11:27:17 UTC (rev 1192)
+++ trunk/src/stones_simple.cc	2008-06-25 18:38:38 UTC (rev 1193)
@@ -1688,94 +1688,6 @@
 }
 
 
-/* -------------------- DeathStone -------------------- */
-
-/** \page st-death Death's Head Stone
-
-Simply kills all actors that touch it (except for actors that are
-immune to these stones).
-
-\image html st-death.png
-*/
-namespace
-{
-    class DeathStone : public Stone {
-        CLONEOBJ(DeathStone);
-        DECL_TRAITS;
-        bool active;
-      
-        void actor_hit(const StoneContact &sc) {
-            SendMessage(sc.actor, "shatter");
-            if (!active) {
-                active=true;
-                set_anim("st-death-anim");
-            }
-        }
-
-        // even a slight touch should shatter the actor: 
-        void actor_touch(const StoneContact &sc) { actor_hit(sc); }
-
-    protected:
-        void animcb() { set_model("st-death"); active=false; }
-    public:
-        DeathStone() : active(false)
-        {}
-    };
-    DEF_TRAITS(DeathStone, "st-death", st_death);
-}
-
-
-/* -------------------- Invisible DeathStone -------------------- */
-
-/** \page st-death_invisible Death's Head Stone invivible
-
-Simply kills all actors that touch it (except for actors that are
-immune to these stones). This variant is invisible.
-
-\image html st-death.png
-*/
-namespace
-{
-    class DeathStoneInvisible : public DeathStone {
-        CLONEOBJ(DeathStoneInvisible);
-        DECL_TRAITS;
-
-        bool visible; // seen through glasses
-
-        void set_visible_model() {
-            set_model(visible ? "st-death" : "st-death_invisible");
-        }
-
-        void animcb() {
-            DeathStone::animcb();
-            set_visible_model();
-        }
-
-        virtual Value message(const Message &m) {
-            if (m.message == "_glasses") {
-                if (to_int(m.value) & 1) {   // Glasses::DEATH
-                    if (!visible) {
-                        visible = true;
-                        set_visible_model();
-                    }
-                }
-                else {
-                    if (visible) {
-                        visible = false;
-                        set_visible_model();
-                    }
-                }
-                return Value();
-            }
-            return DeathStone::message(m);
-        }
-    public:
-        DeathStoneInvisible() : visible(false) {}
-    };
-    DEF_TRAITS(DeathStoneInvisible, "st-death_invisible", st_death_invisible);
-}
-
-
 /* -------------------- Brake stone -------------------- */
 
 /** \page st-brake Brake
@@ -2102,8 +2014,6 @@
 
     RegisterStone (new ChameleonStone);
 
-    RegisterStone (new DeathStone);
-    RegisterStone (new DeathStoneInvisible);
     Register(new DiscoLight);
     Register(new DiscoMedium);
     Register(new DiscoDark);



From ral at mail.berlios.de  Wed Jun 25 22:44:50 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Wed, 25 Jun 2008 22:44:50 +0200
Subject: [Enigma-game-svn] r1194 - in trunk/src: . stones
Message-ID: <200806252044.m5PKiotX014760@sheep.berlios.de>

Author: ral
Date: 2008-06-25 22:44:48 +0200 (Wed, 25 Jun 2008)
New Revision: 1194

Modified:
   trunk/src/items.cc
   trunk/src/stones/ChessStone.cc
Log:
Trunk 1.1: new API reengineering
- fix st_chess linker bug
- rename class Rubberband to RubberbandItem


Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-06-25 18:38:38 UTC (rev 1193)
+++ trunk/src/items.cc	2008-06-25 20:44:48 UTC (rev 1194)
@@ -4057,11 +4057,11 @@
     DEF_TRAITS(Drop, "it-drop", it_drop);
 }
 
-/* -------------------- Rubberband -------------------- */
+/* -------------------- RubberbandItem -------------------- */
 namespace
 {
-    class Rubberband : public Item {
-        CLONEOBJ(Rubberband);
+    class RubberbandItem : public Item {
+        CLONEOBJ(RubberbandItem);
         DECL_TRAITS;
 
         ItemAction activate(Actor *a, GridPos p) {
@@ -4110,9 +4110,9 @@
         }
 
     public:
-        Rubberband() {}
+        RubberbandItem() {}
     };
-    DEF_TRAITS(Rubberband, "it-rubberband", it_rubberband);
+    DEF_TRAITS(RubberbandItem, "it-rubberband", it_rubberband);
 }
 
 /* -------------------- Functions -------------------- */
@@ -4175,7 +4175,6 @@
     Pipe::setup();
     Puller::setup();
     RegisterItem (new Ring);
-    RegisterItem (new Rubberband);
     RegisterItem (new SeedWood);
     RegisterItem (new SeedNowood);
     RegisterItem (new SeedVolcano);
@@ -4207,7 +4206,7 @@
     RegisterItem (new WormHole(true));
     Register ("it_wormhole", new WormHole(true));
     RegisterItem (new YinYang);
-    RegisterItem (new Rubberband);
+    RegisterItem (new RubberbandItem);
 }
 
 } // namespace enigma

Modified: trunk/src/stones/ChessStone.cc
===================================================================
--- trunk/src/stones/ChessStone.cc	2008-06-25 18:38:38 UTC (rev 1193)
+++ trunk/src/stones/ChessStone.cc	2008-06-25 20:44:48 UTC (rev 1194)
@@ -75,7 +75,7 @@
         return Stone::message(m);
     }
     
-    void setState(int extState) {
+    void ChessStone::setState(int extState) {
         // block any write attempts
     }
 



From andreasl at mail.berlios.de  Thu Jun 26 00:11:39 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Thu, 26 Jun 2008 00:11:39 +0200
Subject: [Enigma-game-svn] r1195 - trunk/src
Message-ID: <200806252211.m5PMBdZT021362@sheep.berlios.de>

Author: andreasl
Date: 2008-06-26 00:11:35 +0200 (Thu, 26 Jun 2008)
New Revision: 1195

Modified:
   trunk/src/MusicManager.cc
   trunk/src/MusicManager.hh
   trunk/src/SoundEffectManager.cc
   trunk/src/SoundEffectManager.hh
   trunk/src/SoundEngine.cc
   trunk/src/SoundEngine.hh
Log:
Trunk:
 - Removing "using namespace std" and "... OxydLib"
   from SoundEngine, SoundEffectManager and MusicManager,
   qualifying namespaces.


Modified: trunk/src/MusicManager.cc
===================================================================
--- trunk/src/MusicManager.cc	2008-06-25 20:44:48 UTC (rev 1194)
+++ trunk/src/MusicManager.cc	2008-06-25 22:11:35 UTC (rev 1195)
@@ -29,7 +29,6 @@
 #include <string>
 #include <cassert>
 
-using namespace std;
 using namespace enigma;
 using namespace sound;
 
@@ -72,7 +71,7 @@
     MusicManager::instance()->init();
 }
 
-void sound::DefineMusicSingle(string title, string filename) {
+void sound::DefineMusicSingle(std::string title, std::string filename) {
     // TODO: include play_till, replay_from, volume etc
     if(filename == "") {
         Log << "Warning: Tried to define music single '" << title
@@ -93,7 +92,7 @@
 
 int sound::GetOptionMenuMusic()
 {
-    string music_queue = app.state->getString("MenuMusicQueue");
+    std::string music_queue = app.state->getString("MenuMusicQueue");
     int pos = MusicManager::instance()->getMusicQueueButtonPosition(music_queue);
     assert(pos >= 0);
     return pos;
@@ -101,12 +100,12 @@
 
 void sound::SetOptionMenuMusic(int value)
 {
-    string music_queue = MusicManager::instance()->getMusicQueueByPosition(value);
+    std::string music_queue = MusicManager::instance()->getMusicQueueByPosition(value);
     app.state->setProperty("MenuMusicQueue", music_queue);
     MusicManager::instance()->setActiveMusicQueue(music_queue);
 }
 
-string sound::GetOptionMenuMusicText(int value)
+std::string sound::GetOptionMenuMusicText(int value)
 {
     return MusicManager::instance()->getMusicQueueByPosition(value);
 }
@@ -185,19 +184,19 @@
     tick(-1);
 }
 
-bool MusicManager::defineMusicSingle(string title, string filename)
+bool MusicManager::defineMusicSingle(std::string title, std::string filename)
 {
     music_singles[title] = MusicSingle(title, filename);
     Log << "Added music single '" << title << "'.\n";
     return true;
 }
 
-bool MusicManager::playMusicSingle(string title)
+bool MusicManager::playMusicSingle(std::string title)
 {
     return music_singles[title].start();
 }
 
-bool MusicManager::setActiveMusicQueue(string music_queue_title)
+bool MusicManager::setActiveMusicQueue(std::string music_queue_title)
 {
     if (music_queue_title == "") {
         Log << "Warning: Tried to choose empty music queue title as menu music queue.\n";
@@ -223,7 +222,7 @@
     }
 }
 
-string MusicManager::getMusicQueueByPosition(int button_position)
+std::string MusicManager::getMusicQueueByPosition(int button_position)
 {
     for (MusicQueueRepository::iterator i = music_queues.begin();
              i != music_queues.end(); ++i)
@@ -242,7 +241,7 @@
     return count;
 }
 
-string MusicManager::getCurrentMusicTitle() {
+std::string MusicManager::getCurrentMusicTitle() {
     if(sound::IsMusicPlaying() && (active_music_queue != ""))
         return music_queues[active_music_queue].getCurrentMusicTitle();
     else
@@ -285,7 +284,7 @@
 
 /* -------------------- Music Queue -------------------- */
 
-string MusicQueue::getCurrentMusicTitle()
+std::string MusicQueue::getCurrentMusicTitle()
 {
     if(current_position_in_queue == -1)
         return "";
@@ -293,7 +292,7 @@
         return single_title[current_position_in_queue];
 }
 
-void MusicQueue::appendSingle(string title)
+void MusicQueue::appendSingle(std::string title)
 {
     single_title.push_back(title);
 }
@@ -317,7 +316,7 @@
         current_position_in_queue++;
         if(current_position_in_queue >= single_title.size())
             current_position_in_queue = 0;
-        string single = single_title[current_position_in_queue];
+        std::string single = single_title[current_position_in_queue];
         Log << "Play next in queue " << title << ": " << single << ".\n";
         return MusicManager::instance()->playMusicSingle(single);
     }

Modified: trunk/src/MusicManager.hh
===================================================================
--- trunk/src/MusicManager.hh	2008-06-25 20:44:48 UTC (rev 1194)
+++ trunk/src/MusicManager.hh	2008-06-25 22:11:35 UTC (rev 1195)
@@ -26,14 +26,12 @@
 #include <vector>
 #include <map>
 
-using namespace std;
-
 namespace sound
 {
 
 /* -------------------- Interface Functions -------------------- */
 
-    void DefineMusicSingle(string title, string filename);
+    void DefineMusicSingle(std::string title, std::string filename);
 
     bool StartMenuMusic();
     bool StartLevelMusic();
@@ -45,7 +43,7 @@
     int GetOptionMenuMusicCount();
     int GetOptionMenuMusic();
     void SetOptionMenuMusic(int value);
-    string GetOptionMenuMusicText(int value);
+    std::string GetOptionMenuMusicText(int value);
 
 /* -------------------- Music and MusicQueue -------------------- */
 
@@ -57,13 +55,13 @@
 
     class MusicSingle {
     public:
-        MusicSingle(string title_, string filename_, Uint32 length_,
+        MusicSingle(std::string title_, std::string filename_, Uint32 length_,
                     Uint32 loop_start_, Uint32 loop_end_, bool allows_loop_)
         : title(title_), filename(filename_), length(length_),
           loop_start(loop_start_), loop_end(loop_end_),
           allows_loop(allows_loop_), start_time() {}
 
-        MusicSingle(string title_, string filename_)
+        MusicSingle(std::string title_, std::string filename_)
         : title(title_), filename(filename_), length(0),
           loop_start(0), loop_end(0), allows_loop(false), start_time() {}
 
@@ -75,8 +73,8 @@
         bool maybeLoopBack();
 
     private:
-        string title;
-        string filename;
+        std::string title;
+        std::string filename;
         Uint32 length;      // in milliseconds
         Uint32 loop_start;  // where the loop starts
         Uint32 loop_end;    // where the loop should end (but continues playing until next tick)
@@ -86,7 +84,7 @@
 
     class MusicQueue {
     public:
-        MusicQueue(string title_, int button_position_)
+        MusicQueue(std::string title_, int button_position_)
         : title(title_), button_position(button_position_),
           current_position_in_queue(-1), single_title() {}
 
@@ -97,20 +95,20 @@
         bool start();
         bool next();
         void leave();
-        string getCurrentMusicTitle();
+        std::string getCurrentMusicTitle();
         int getButtonPosition() { return button_position; }
         void setButtonPosition(int pos) { button_position = pos; }
-        void appendSingle(string title);
+        void appendSingle(std::string title);
 
     private:
         int current_position_in_queue;
-        string title;
+        std::string title;
         int button_position;
-        vector<string> single_title;
+        std::vector<std::string> single_title;
     };
 
-    typedef map<string, MusicSingle> MusicSingleRepository;
-    typedef map<string, MusicQueue> MusicQueueRepository;
+    typedef std::map<std::string, MusicSingle> MusicSingleRepository;
+    typedef std::map<std::string, MusicQueue> MusicQueueRepository;
 
     /*! MusicContext is a nominal condition to change the
       music during the next tick.
@@ -133,15 +131,15 @@
         void setMusicContext(MusicContext context) { music_context = context; }
         MusicContext getMusicContext() { return music_context; }
 
-        bool defineMusicSingle(string title, string filename);
-        bool playMusicSingle(string title);
-        string getCurrentMusicTitle();
+        bool defineMusicSingle(std::string title, std::string filename);
+        bool playMusicSingle(std::string title);
+        std::string getCurrentMusicTitle();
                 
-        bool setActiveMusicQueue(string music_queue_title);
-        string getActiveMusicQueueTitle() { return active_music_queue; }
-        string getMusicQueueByPosition(int button_position);
+        bool setActiveMusicQueue(std::string music_queue_title);
+        std::string getActiveMusicQueueTitle() { return active_music_queue; }
+        std::string getMusicQueueByPosition(int button_position);
         int getMenuMusicQueueCount();
-        int getMusicQueueButtonPosition(string music_queue_title) {
+        int getMusicQueueButtonPosition(std::string music_queue_title) {
             return music_queues[music_queue_title].getButtonPosition();
         }
 
@@ -152,7 +150,7 @@
         static MusicManager *theSingleton;
         MusicSingleRepository    music_singles;
         MusicQueueRepository     music_queues;
-        string                   active_music_queue;
+        std::string              active_music_queue;
         MusicContext             music_context;
     };
     

Modified: trunk/src/SoundEffectManager.cc
===================================================================
--- trunk/src/SoundEffectManager.cc	2008-06-25 20:44:48 UTC (rev 1194)
+++ trunk/src/SoundEffectManager.cc	2008-06-25 22:11:35 UTC (rev 1195)
@@ -30,15 +30,13 @@
 #include <cassert>
 #include <memory>
 
-using namespace std;
 using namespace enigma;
 using namespace sound;
-using namespace OxydLib;
 
 
 /* -------------------- Interface Functions -------------------- */
 
-string sound::GetOxydSoundSet(OxydVersion oxyd_ver)
+std::string sound::GetOxydSoundSet(OxydLib::OxydVersion oxyd_ver)
 {
     return SoundEffectManager::instance()->getOxydSoundSet(oxyd_ver);
 }
@@ -47,12 +45,12 @@
     SoundEffectManager::instance()->initSoundSets();
 }
 
-void sound::SetActiveSoundSet(string soundset_name)
+void sound::SetActiveSoundSet(std::string soundset_name)
 {
     SoundEffectManager::instance()->setActiveSoundSet(soundset_name);
 }
 
-void sound::SetDefaultSoundSet(string soundset_name)
+void sound::SetDefaultSoundSet(std::string soundset_name)
 {
     SoundEffectManager::instance()->setDefaultSoundSet(soundset_name);
     if(app.state->getString("SoundSetName") == "Default")
@@ -61,10 +59,10 @@
 
 /*! The following function is an interface to add sound events to Enigma.
   It is accessed via sound-defaults.lua and user sound definitions. */
-void sound::DefineSoundEffect(string soundset_key, string name, string filename,
+void sound::DefineSoundEffect(std::string soundset_key, std::string name, std::string filename,
                               double volume, bool loop, bool global, int priority,
                               double damp_max, double damp_inc, double damp_mult,
-                              double damp_min, double damp_tick, string silence_string) {
+                              double damp_min, double damp_tick, std::string silence_string) {
     if(soundset_key == "") {
         Log << "Warning: Tried to define sound event '" << name
             << "' without sound set key. Skipped.\n";
@@ -76,18 +74,18 @@
 }
 
 
-bool sound::EmitSoundEvent (const string &eventname, const ecl::V2 &pos,
+bool sound::EmitSoundEvent (const std::string &eventname, const ecl::V2 &pos,
                             double volume, bool force_global)
 {
     return SoundEffectManager::instance()->emitSoundEvent(eventname, pos, volume, force_global);
 }
 
-bool sound::EmitSoundEventGlobal (const string &eventname, double volume)
+bool sound::EmitSoundEventGlobal (const std::string &eventname, double volume)
 {
     return SoundEffectManager::instance()->emitSoundEvent(eventname, ecl::V2(), volume, true);
 }
 
-void sound::WriteSilenceString (const string &eventname)
+void sound::WriteSilenceString (const std::string &eventname)
 {
     SoundEffectManager::instance()->writeSilenceString(eventname);
 }
@@ -104,7 +102,7 @@
 
 int sound::GetOptionSoundSet()
 {
-    string soundSet = app.state->getString("SoundSetName");
+    std::string soundSet = app.state->getString("SoundSetName");
     if (soundSet == "Default")
         return 0;
     int pos = SoundEffectManager::instance()->getSoundSetButtonPosition(soundSet);
@@ -122,7 +120,7 @@
         options::SetOption("SoundSet", SoundEffectManager::instance()->convertToOldSoundSetNumber("Default"));
         SetActiveSoundSet(SoundEffectManager::instance()->getDefaultSoundSet());
     } else {
-        string newSet = SoundEffectManager::instance()->getSoundSetByPosition(value);
+        std::string newSet = SoundEffectManager::instance()->getSoundSetByPosition(value);
         assert(newSet != "");
         if (app.state->getString("SoundSetName") == newSet)
             return;
@@ -132,11 +130,11 @@
     }
 }
 
-string sound::GetOptionSoundSetText(int value)
+std::string sound::GetOptionSoundSetText(int value)
 {
     if(value == 0)
         return N_("Default");
-    string soundset_name = SoundEffectManager::instance()->getSoundSetByPosition(value);
+    std::string soundset_name = SoundEffectManager::instance()->getSoundSetByPosition(value);
     if(soundset_name == "")
         return "INVALID";
     return soundset_name;
@@ -152,7 +150,7 @@
 {}
 
 double SoundEvent::effectiveVolume(double dist) {
-    double reduced_dist = max(0.0, dist - fullvol_range);
+    double reduced_dist = std::max(0.0, dist - fullvol_range);
     return (1 - reduced_dist / range) * volume;
 }
 
@@ -166,7 +164,7 @@
            old center regions, and its volume is set to the maximum
            of the two volumes. */
         double dist = ecl::length(position - se.position);
-        volume = max(volume, se.volume);
+        volume = std::max(volume, se.volume);
         fullvol_range += dist/2;
         position = (number_events * position + se.number_events * se.position)
                        / (number_events + se.number_events);
@@ -199,7 +197,7 @@
 /*! This function defines how to put soundset_key and eventname together to
   create an eventkey. */
 
-string SoundEffectManager::effectKey(string effect_name, string soundset_name)
+std::string SoundEffectManager::effectKey(std::string effect_name, std::string soundset_name)
 {
     if (soundset_name == "")
         return getActiveSoundSetKey() + "#" + effect_name;
@@ -210,7 +208,7 @@
 /*! This function searches the known sound sets for a sound set with given
   oxyd version, and returns the sound set name (or empty string if none). */
 
-string SoundEffectManager::getOxydSoundSet(OxydVersion oxyd_ver)
+std::string SoundEffectManager::getOxydSoundSet(OxydLib::OxydVersion oxyd_ver)
 {
     for (SoundSetRepository::iterator i = sound_sets.begin();
              i != sound_sets.end(); ++i)
@@ -225,7 +223,7 @@
   if user wants to switch to <= 1.00 again; so here are the conversion
   functions. Any user sound set is mapped to 0 ("Default").  */
 
-int SoundEffectManager::convertToOldSoundSetNumber(string soundset_name)
+int SoundEffectManager::convertToOldSoundSetNumber(std::string soundset_name)
 {
     if(soundset_name == "Default")  return 0;
     if(soundset_name == "Enigma")   return 1;
@@ -235,11 +233,11 @@
     return 0;
 }
 
-string SoundEffectManager::convertFromOldSoundSetNumber(int soundset_number)
+std::string SoundEffectManager::convertFromOldSoundSetNumber(int soundset_number)
 {
     if(soundset_number == 0)  return "Default";
     if(soundset_number == 1)  return "Enigma";
-    return getOxydSoundSet((OxydVersion) (soundset_number - 2));
+    return getOxydSoundSet((OxydLib::OxydVersion) (soundset_number - 2));
 }
 
 /* -------------------- Sound set handling -------------------- */
@@ -249,7 +247,7 @@
   oxyd sound set is mentioned, but the corresponding oxyd version
   wasn't found. */
 
-bool SoundEffectManager::defineSoundSet(string soundset_name, string soundset_key,
+bool SoundEffectManager::defineSoundSet(std::string soundset_name, std::string soundset_key,
                                  int button_position)
 {
     sound_sets[soundset_name] = SoundSet(soundset_key, button_position);
@@ -258,12 +256,12 @@
     return true;
 }
 
-bool SoundEffectManager::defineSoundSetOxyd(string soundset_name, string soundset_key,
-                                     OxydVersion oxyd_ver, int button_position)
+bool SoundEffectManager::defineSoundSetOxyd(std::string soundset_name, std::string soundset_key,
+                                     OxydLib::OxydVersion oxyd_ver, int button_position)
 {
     if(oxyd::FoundOxyd(oxyd_ver)) {
         sound_sets[soundset_name] =
-            SoundSet(soundset_key, button_position, (OxydVersion) oxyd_ver);
+            SoundSet(soundset_key, button_position, (OxydLib::OxydVersion) oxyd_ver);
         Log << "Added sound set '" << soundset_name << "' (key '" << soundset_key
             << "') on position " << button_position << ".\n";
         return true;
@@ -291,15 +289,15 @@
     assert(sound_sets.empty());
     assert(defineSoundSet ("Enigma",   "Enigma",  1));
     int pos = 2; // position in options menu button
-    if (defineSoundSetOxyd ("Oxyd",     "Oxyd*",   OxydVersion_Oxyd1,          pos))  pos++;
-    if (defineSoundSetOxyd ("Magnum",   "Magnum*", OxydVersion_OxydMagnum,     pos))  pos++;
-    if (defineSoundSetOxyd ("Mag.Gold", "Magnum*", OxydVersion_OxydMagnumGold, pos))  pos++;
-    if (defineSoundSetOxyd ("Per.Oxyd", "Oxyd*",   OxydVersion_PerOxyd,        pos))  pos++;
-    if (defineSoundSetOxyd ("Extra",    "Oxyd*",   OxydVersion_OxydExtra,      pos))  pos++;
+    if (defineSoundSetOxyd ("Oxyd",     "Oxyd*",   OxydLib::OxydVersion_Oxyd1,          pos))  pos++;
+    if (defineSoundSetOxyd ("Magnum",   "Magnum*", OxydLib::OxydVersion_OxydMagnum,     pos))  pos++;
+    if (defineSoundSetOxyd ("Mag.Gold", "Magnum*", OxydLib::OxydVersion_OxydMagnumGold, pos))  pos++;
+    if (defineSoundSetOxyd ("Per.Oxyd", "Oxyd*",   OxydLib::OxydVersion_PerOxyd,        pos))  pos++;
+    if (defineSoundSetOxyd ("Extra",    "Oxyd*",   OxydLib::OxydVersion_OxydExtra,      pos))  pos++;
     // Define user sound sets, as given by sound_effects
     for (SoundEffectRepository::iterator i = sound_effects.begin();
          i != sound_effects.end(); ++i) {
-        string soundset_key = (*i).second.getSoundSetKey();
+        std::string soundset_key = (*i).second.getSoundSetKey();
         bool found = false;
         // ignore Oxyd* and Magnum* sound effects, if no 
         if ((soundset_key != "Oxyd*") && (soundset_key != "Magnum*")) {
@@ -315,7 +313,7 @@
     setSoundSetCount(pos - 1);
     setDefaultSoundSet("Enigma");
     // Extract sound set names and keys from options; activate!
-    string soundset_name = app.state->getString("SoundSetName");
+    std::string soundset_name = app.state->getString("SoundSetName");
     if (soundset_name == "") { // just switched from 1.00 to higher
         soundset_name = convertFromOldSoundSetNumber(options::GetInt("SoundSet"));
         app.state->setProperty("SoundSetName", soundset_name);
@@ -340,9 +338,9 @@
     }
 }
 
-void SoundEffectManager::setActiveSoundSet(string soundset_name)
+void SoundEffectManager::setActiveSoundSet(std::string soundset_name)
 {
-    string soundset_key = sound_sets[soundset_name].getSoundSetKey();
+    std::string soundset_key = sound_sets[soundset_name].getSoundSetKey();
     if (soundset_key == getActiveSoundSetKey())
         return;
     if (soundset_key == "Default") {
@@ -369,14 +367,14 @@
 {
     SoundEffectRepository::iterator i = sound_effects.begin(), 
         end = sound_effects.end();
-    string prefix = getActiveSoundSetKey() + "#";
+    std::string prefix = getActiveSoundSetKey() + "#";
     for (; i != end; ++i) {
         if (i->first.compare(0, prefix.size(), prefix) == 0)
             CacheSound(i->second);
     }
 }
 
-string SoundEffectManager::getSoundSetByPosition(int button_position)
+std::string SoundEffectManager::getSoundSetByPosition(int button_position)
 {
     for (SoundSetRepository::iterator i = sound_sets.begin();
              i != sound_sets.end(); ++i)
@@ -405,12 +403,12 @@
         return PlaySound (filename, pos, volume * vol, priority);
 }
 
-bool SoundEffectManager::emitSoundEvent (const string &eventname, const ecl::V2 &pos,
+bool SoundEffectManager::emitSoundEvent (const std::string &eventname, const ecl::V2 &pos,
                             double volume, bool force_global)
 {
     if((volume == 0) || sound::IsSoundMute())
         return false;
-    string effectkey = effectKey(eventname);
+    std::string effectkey = effectKey(eventname);
     SoundEffectRepository::iterator i = sound_effects.find(effectkey);
     if (i == sound_effects.end()) {
         Log << "Undefined sound event " << effectkey << " @ " 
@@ -421,12 +419,12 @@
     }
 }
 
-void SoundEffectManager::writeSilenceString (const string &eventname)
+void SoundEffectManager::writeSilenceString (const std::string &eventname)
 {
-    string effectkey = effectKey(eventname);
+    std::string effectkey = effectKey(eventname);
     SoundEffectRepository::iterator i = sound_effects.find(effectkey);
     if (i != sound_effects.end()) {
-        string silence_string = (*i).second.getSilenceString();
+        std::string silence_string = (*i).second.getSilenceString();
         if (silence_string != "")
             client::Msg_ShowText (silence_string, true);
     }
@@ -437,7 +435,7 @@
 /*! These methods are connected to the sound damping mechanism, designed
   to reduce the noise created by some objects like st_lightpassenger. */
 
-SoundDamping::SoundDamping(string effect_name_, const void *origin_)
+SoundDamping::SoundDamping(std::string effect_name_, const void *origin_)
 : effect_name(effect_name_), origin(origin_)
 {
     damp = SoundEffectManager::instance()->getDampingData(effect_name_);

Modified: trunk/src/SoundEffectManager.hh
===================================================================
--- trunk/src/SoundEffectManager.hh	2008-06-25 20:44:48 UTC (rev 1194)
+++ trunk/src/SoundEffectManager.hh	2008-06-25 22:11:35 UTC (rev 1195)
@@ -27,8 +27,6 @@
 #include <vector>
 #include <map>
 
-using namespace std;
-
 /** ----------- Survey of the formal data structure -----------
  *
  *  The wav-files are not to be accessed directly. There are several layers
@@ -136,9 +134,9 @@
 {
 /* -------------------- Data types -------------------- */
 
-    typedef string SoundName;
+    typedef std::string SoundName;
 
-    typedef vector <unsigned char> ByteVec;
+    typedef std::vector <unsigned char> ByteVec;
 
     struct SoundData {
         ByteVec  buf;
@@ -153,33 +151,33 @@
     void DefineSound (const SoundName &, const SoundData &);
     
     /*! Helper function for oxyd.cc */
-    string GetOxydSoundSet(OxydLib::OxydVersion oxyd_ver);
+    std::string GetOxydSoundSet(OxydLib::OxydVersion oxyd_ver);
 
     /*! Sound set handling */
     void InitSoundSets();
-    void SetActiveSoundSet(string soundset_name);
-    void SetDefaultSoundSet(string soundset_name);
+    void SetActiveSoundSet(std::string soundset_name);
+    void SetDefaultSoundSet(std::string soundset_name);
 
     /*! Define a new sound event. */
-    void DefineSoundEffect(string soundset_key, string name, string filename,
+    void DefineSoundEffect(std::string soundset_key, std::string name, std::string filename,
                            double volume, bool loop, bool global, int priority,
                            double damp_max, double damp_inc, double damp_mult,
-                           double damp_min, double damp_tick, string silence_string);
+                           double damp_min, double damp_tick, std::string silence_string);
 
     /*! Trigger a sound event.  Return whether the event was handled. */
-    bool EmitSoundEvent (const string &eventname,
+    bool EmitSoundEvent (const std::string &eventname,
                          const ecl::V2 &pos = ecl::V2 (), 
                          double volume = 1.0, bool force_global = false);
-    bool EmitSoundEventGlobal (const string &eventname, double volume = 1.0);
+    bool EmitSoundEventGlobal (const std::string &eventname, double volume = 1.0);
 
     /*! Send the silence string of a sound effect to command line. */
-    void WriteSilenceString (const string &eventname);
+    void WriteSilenceString (const std::string &eventname);
 
     /*! Helper functions for options menu */
     int GetOptionSoundSetCount();
     int GetOptionSoundSet();
     void SetOptionSoundSet(int value);
-    string GetOptionSoundSetText(int value);
+    std::string GetOptionSoundSetText(int value);
 
 /* -------------------- SoundDampingList ---------------- */
 
@@ -196,14 +194,14 @@
 
     class SoundDamping {
     private:
-        string effect_name;
+        std::string effect_name;
         const void *origin;
         float factor;
         DampingData damp;
 
     public:
-        SoundDamping(string effect_name_, const void *origin_);
-        bool is_equal(string name2, const void *origin2) {
+        SoundDamping(std::string effect_name_, const void *origin_);
+        bool is_equal(std::string name2, const void *origin2) {
             return (origin2 == origin) && (effect_name == name2);
         }
         float get_volume(float def_volume);
@@ -246,10 +244,10 @@
 
     class SoundEffect {
     public:
-        SoundEffect(string name_, string soundset_key_, string filename_,
+        SoundEffect(std::string name_, std::string soundset_key_, std::string filename_,
                        double volume_, bool loop_, bool global_, int priority_,
                        double damp_max_, double damp_inc_, double damp_mult_,
-                       double damp_min_, double damp_tick_, string silence_string_)
+                       double damp_min_, double damp_tick_, std::string silence_string_)
         : name(name_), soundset_key(soundset_key_), filename(filename_), volume(volume_),
           loop(loop_), global(global_), priority(priority_),
           silence_string(silence_string_) {
@@ -270,18 +268,18 @@
             damp.tick =  0.9;
         }
 
-        void setFilename(string filename_) { filename = filename_; }
-        string getFilename() const { return filename; }
+        void setFilename(std::string filename_) { filename = filename_; }
+        std::string getFilename() const { return filename; }
         bool play(const ecl::V2 &pos = ecl::V2(), double vol = 1.0, bool glob = false);
         DampingData getDampingData() { return damp; }
-        string getSoundSetKey() { return soundset_key; }
-        string getSilenceString() { return silence_string; }
+        std::string getSoundSetKey() { return soundset_key; }
+        std::string getSilenceString() { return silence_string; }
 
     private:
-        string name;
-        string filename;
-        string soundset_key;
-        string silence_string;
+        std::string name;
+        std::string filename;
+        std::string soundset_key;
+        std::string silence_string;
         double volume;
         bool loop;
         bool global;
@@ -291,11 +289,11 @@
 
     class SoundSet {
     public:
-        SoundSet(string soundset_key_, int button_position_, OxydLib::OxydVersion oxyd_ver_)
+        SoundSet(std::string soundset_key_, int button_position_, OxydLib::OxydVersion oxyd_ver_)
         : soundset_key(soundset_key_), is_oxyd(true), oxyd_ver(oxyd_ver_),
           button_position(button_position_) {}
 
-        SoundSet(string soundset_key_, int button_position_)
+        SoundSet(std::string soundset_key_, int button_position_)
         : soundset_key(soundset_key_), is_oxyd(false),
           oxyd_ver(OxydLib::OxydVersion_Invalid), button_position(button_position_) {}
 
@@ -306,19 +304,19 @@
         bool activate();
         OxydLib::OxydVersion getOxydVersion() { return oxyd_ver; }
         bool isOxyd() { return is_oxyd; }
-        string getSoundSetKey() { return soundset_key; }
+        std::string getSoundSetKey() { return soundset_key; }
         int getButtonPosition() { return button_position; }
         void setButtonPosition(int pos) { button_position = pos; }
 
     private:
-        string soundset_key;
+        std::string soundset_key;
         bool is_oxyd;
         OxydLib::OxydVersion oxyd_ver;
         int button_position;
     };
     
-    typedef map<string, SoundEffect> SoundEffectRepository;
-    typedef map<string, SoundSet> SoundSetRepository;
+    typedef std::map<std::string, SoundEffect> SoundEffectRepository;
+    typedef std::map<std::string, SoundSet> SoundSetRepository;
 
 
 /* -------------------- SoundEffectManager -------------------- */
@@ -330,38 +328,38 @@
 
         // ---------- Sound effect repository and sound sets ----------
 
-        void setActiveSoundSetKey(string soundset_key) {active_sound_set_key=soundset_key;}
-        string getActiveSoundSetKey() { return active_sound_set_key; }
-        void setDefaultSoundSet(string soundset_name) {default_sound_set=soundset_name;}
-        string getDefaultSoundSet() { return default_sound_set; }
-        string effectKey(string effect_name, string soundset_name = "");
-        DampingData getDampingData(string effect_name) {
+        void setActiveSoundSetKey(std::string soundset_key) {active_sound_set_key=soundset_key;}
+        std::string getActiveSoundSetKey() { return active_sound_set_key; }
+        void setDefaultSoundSet(std::string soundset_name) {default_sound_set=soundset_name;}
+        std::string getDefaultSoundSet() { return default_sound_set; }
+        std::string effectKey(std::string effect_name, std::string soundset_name = "");
+        DampingData getDampingData(std::string effect_name) {
             return sound_effects[effectKey(effect_name)].getDampingData(); }
-        void defineSoundEffect(string soundset_key, string name, SoundEffect se) {
+        void defineSoundEffect(std::string soundset_key, std::string name, SoundEffect se) {
             sound_effects[effectKey(name, soundset_key)] = se;
         }
-        bool emitSoundEvent (const string &eventname, const ecl::V2 &pos = ecl::V2 (), 
+        bool emitSoundEvent (const std::string &eventname, const ecl::V2 &pos = ecl::V2 (), 
                              double volume = 1.0, bool force_global = false);
-        void writeSilenceString (const string &eventname);
+        void writeSilenceString (const std::string &eventname);
         void initSoundSets();
-        bool defineSoundSet(string soundset_name, string soundset_key, int button_position);
-        bool defineSoundSetOxyd(string soundset_name, string soundset_key,
+        bool defineSoundSet(std::string soundset_name, std::string soundset_key, int button_position);
+        bool defineSoundSetOxyd(std::string soundset_name, std::string soundset_key,
                                 OxydLib::OxydVersion oxyd_ver, int button_position);
-        string getOxydSoundSet(OxydLib::OxydVersion oxyd_ver);
+        std::string getOxydSoundSet(OxydLib::OxydVersion oxyd_ver);
 
-        int convertToOldSoundSetNumber(string soundset_name);
-        string convertFromOldSoundSetNumber(int soundset_number);
+        int convertToOldSoundSetNumber(std::string soundset_name);
+        std::string convertFromOldSoundSetNumber(int soundset_number);
 
-        void setActiveSoundSet(string soundset_name);
+        void setActiveSoundSet(std::string soundset_name);
         void preloadSoundEffects();
 
         void setSoundSetCount(int count) { sound_set_count = count; }
         int getSoundSetCount() { return sound_set_count; }
         
-        int getSoundSetButtonPosition(string soundset_name) {
+        int getSoundSetButtonPosition(std::string soundset_name) {
             return sound_sets[soundset_name].getButtonPosition();
         }
-        string getSoundSetByPosition(int button_position);
+        std::string getSoundSetByPosition(int button_position);
         
     protected:
         SoundEffectManager();
@@ -370,8 +368,8 @@
         static SoundEffectManager *theSingleton;
         SoundSetRepository         sound_sets;
         SoundEffectRepository      sound_effects;
-        string                     active_sound_set_key;
-        string                     default_sound_set;
+        std::string                active_sound_set_key;
+        std::string                default_sound_set;
         int                        sound_set_count;
     };
 }

Modified: trunk/src/SoundEngine.cc
===================================================================
--- trunk/src/SoundEngine.cc	2008-06-25 20:44:48 UTC (rev 1194)
+++ trunk/src/SoundEngine.cc	2008-06-25 22:11:35 UTC (rev 1195)
@@ -28,15 +28,14 @@
 #include <string>
 #include <cassert>
 
-using namespace std;
-using namespace sound;
 using namespace enigma;
+using namespace sound;
 
 
 /* -------------------- Local variables -------------------- */
 namespace
 {
-    auto_ptr<SoundEngine> sound_engine;
+    std::auto_ptr<SoundEngine> sound_engine;
 
     bool sound_enabled      = true;
     bool music_enabled      = true;
@@ -168,12 +167,12 @@
     sound_engine->fadeout_music();
 }
 
-bool sound::PlayMusic (const string &name, double position) 
+bool sound::PlayMusic (const std::string &name, double position) 
 {
     if(sound::IsMusicMute() || name=="")
         return false;
     
-    string fname;
+    std::string fname;
     return app.resourceFS->findFile (name, fname) && sound_engine->play_music(fname, position);
 }
 
@@ -317,7 +316,7 @@
     m_current_music = 0;
 }
 
-bool SoundEngine_SDL::play_music (const string &filename, double position) 
+bool SoundEngine_SDL::play_music (const std::string &filename, double position) 
 {
     if (Mix_Music *music = Mix_LoadMUS(filename.c_str())) {
         if (m_current_music)
@@ -390,19 +389,19 @@
     return -1;
 }
 
-Mix_Chunk *SoundEngine_SDL::cache_sound(const string &name)
+Mix_Chunk *SoundEngine_SDL::cache_sound(const std::string &name)
 {
     ecl::Dict<Mix_Chunk*>::iterator i=wav_cache.find(name);
     if (i == wav_cache.end()) {
         Mix_Chunk *ch = 0;
-        string filename;
+        std::string filename;
         if (app.resourceFS->findFile("soundsets/" + name + ".wav", filename))
              ch = Mix_LoadWAV(filename.c_str());
         if (ch != 0)
             wav_cache.insert(name, ch);
         else
             enigma::Log << "Couldn't load sample '" << name << "': "
-                        << Mix_GetError() << endl;
+                        << Mix_GetError() << std::endl;
         return ch;
     } else
         return i->second;
@@ -410,7 +409,7 @@
 
 void SoundEngine_SDL::cache_sound(const SoundEffect &s) 
 {
-    string filename = s.getFilename();
+    std::string filename = s.getFilename();
     if (filename != "")
         cache_sound(filename);
 }

Modified: trunk/src/SoundEngine.hh
===================================================================
--- trunk/src/SoundEngine.hh	2008-06-25 20:44:48 UTC (rev 1194)
+++ trunk/src/SoundEngine.hh	2008-06-25 22:11:35 UTC (rev 1195)
@@ -31,8 +31,6 @@
 #include <string>
 #include <vector>
 
-using namespace std;
-
 namespace sound
 {
 
@@ -46,7 +44,7 @@
     void DisableSound();
     void EnableSound();
     void DisableMusic();
-    bool PlayMusic(const string &name, double position = 0.0);
+    bool PlayMusic(const std::string &name, double position = 0.0);
     void FadeoutMusic();
 
     /*! Stop any music currently playing. */
@@ -89,7 +87,7 @@
 
         // ---------- Music ----------
 
-        virtual bool play_music(const string &filename, double position) = 0;
+        virtual bool play_music(const std::string &filename, double position) = 0;
         virtual void stop_music() = 0;
         virtual void fadeout_music() = 0;
         virtual bool is_music_playing() = 0;
@@ -113,7 +111,7 @@
         bool is_initialized() const { return true; }
         void set_sound_volume(double /*soundvol*/) {}
         void set_music_volume(double /*musicvol*/) {}
-        bool play_music (const string &/*filename*/, double /*position*/) { return false; }
+        bool play_music (const std::string &/*filename*/, double /*position*/) { return false; }
         void stop_music() {}
         void fadeout_music() {}
         bool is_music_playing() { return false; }
@@ -136,7 +134,7 @@
         bool is_initialized() const { return m_initialized; }
         void set_sound_volume(double soundvol);
         void set_music_volume(double musicvol);
-        bool play_music (const string &filename, double position);
+        bool play_music (const std::string &filename, double position);
         void stop_music();
         void fadeout_music();
         bool is_music_playing();
@@ -158,7 +156,7 @@
 
     private:
         // ---------- Private methods ----------
-        Mix_Chunk *cache_sound(const string &name);
+        Mix_Chunk *cache_sound(const std::string &name);
 
         void update_channel (int channel);
         int already_playing (const SoundEvent &s);
@@ -176,7 +174,7 @@
         Uint16     m_format;
         int        m_channels;
         ecl::Dict<Mix_Chunk*> wav_cache;
-        vector<SoundEvent> m_channelinfo;
+        std::vector<SoundEvent> m_channelinfo;
         ecl::V2      m_listenerpos;
         SDL_mutex  *m_mutex;
         static SoundEngine_SDL *m_instance;



From raoulb at bluewin.ch  Thu Jun 26 13:58:08 2008
From: raoulb at bluewin.ch (Raoul)
Date: Thu, 26 Jun 2008 13:58:08 +0200
Subject: [Enigma-game-svn] Revision 1196
Message-ID: <20080626135808.4513fdf4@amarok.loinet.zh>

-> 14 new levels
-> Lots of bugfixes on older levels
-> Some API renamings / updates

=> Currently 93 new levels for Enigma 1.1!



Ge?nderte Dateien:
trunk/data/levels/enigma_cross/enigma0_92_1.xml
trunk/data/levels/enigma_cross/enigma0_92_2.xml
trunk/data/levels/enigma_cross/enigma0_92_3.xml
trunk/data/levels/enigma_cross/newlevels.xml
trunk/data/levels/enigma_cross/newlevels_1.0.2.xml
trunk/data/levels/enigma_esprit/index.xml
trunk/data/levels/enigma_i/duffy04_1.xml
trunk/data/levels/enigma_i/index.xml
trunk/data/levels/enigma_ii/ant07_1.xml
trunk/data/levels/enigma_ii/index.xml
trunk/data/levels/enigma_ii/martin26_2.xml
trunk/data/levels/enigma_iii/duffy28_1.xml
trunk/data/levels/enigma_iii/index.xml
trunk/data/levels/enigma_iv/index.xml
trunk/data/levels/enigma_iv/mp03_1.xml
trunk/data/levels/enigma_iv/ss08_1.xml
trunk/data/levels/enigma_iv/wb01_3.xml
trunk/data/levels/enigma_oxydmagnum/index.xml
trunk/data/levels/enigma_oxydmagnum/oxm96_1.xml
trunk/data/levels/enigma_tutorial/a_tut07.xml
trunk/data/levels/enigma_tutorial/index.xml
trunk/data/levels/enigma_v/index.xml
trunk/data/levels/enigma_vi/index.xml
trunk/data/levels/enigma_vii/index.xml
trunk/data/levels/enigma_vii/pulley07_1.xml
trunk/data/levels/enigma_viii/index.xml
trunk/data/levels/enigma_viii/mecke15_1.xml

Neue Dateien:
trunk/data/levels/enigma_esprit/esprit26_2.xml
trunk/data/levels/enigma_iii/wb05_2.xml
trunk/data/levels/enigma_iv/raywick01_2.xml
trunk/data/levels/enigma_iv/raywick02_2.xml
trunk/data/levels/enigma_iv/raywick03_2.xml
trunk/data/levels/enigma_v/ss03_2.xml
trunk/data/levels/enigma_vi/ral10_2.xml
trunk/data/levels/enigma_viii/andreas47_1.xml
trunk/data/levels/enigma_viii/dev02_1.xml
trunk/data/levels/enigma_viii/dpl03_3.xml
trunk/data/levels/enigma_viii/huffman01_1.xml
trunk/data/levels/enigma_viii/joe29_1.xml
trunk/data/levels/enigma_viii/johann03_1.xml
trunk/data/levels/enigma_viii/joona02_1.xml
trunk/data/levels/enigma_viii/mecke01_1.xml
trunk/data/levels/enigma_viii/mecke07_1.xml
trunk/data/levels/enigma_viii/mecke10_1.xml
trunk/data/levels/enigma_viii/mecke21_1.xml
trunk/data/levels/enigma_viii/mecke22_1.xml
trunk/data/levels/enigma_viii/raywick05_1.xml
trunk/data/levels/enigma_viii/ulf06_1.xml
trunk/data/levels/enigma_viii/welcometopack8_1.xml

Gel?schte Dateien:
/trunk/data/levels/enigma_esprit/esprit26_1.xml
/trunk/data/levels/enigma_iii/wb05_1.xml
/trunk/data/levels/enigma_iv/raywick01_1.xml
/trunk/data/levels/enigma_iv/raywick02_1.xml
/trunk/data/levels/enigma_iv/raywick03_1.xml
/trunk/data/levels/enigma_v/ss03_1.xml
/trunk/data/levels/enigma_vi/ral10_1.xml



From ral at mail.berlios.de  Fri Jun 27 22:51:32 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Fri, 27 Jun 2008 22:51:32 +0200
Subject: [Enigma-game-svn] r1197 - trunk/src
Message-ID: <200806272051.m5RKpWIL032013@sheep.berlios.de>

Author: ral
Date: 2008-06-27 22:51:22 +0200 (Fri, 27 Jun 2008)
New Revision: 1197

Modified:
   trunk/src/lua.cc
Log:


Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-06-26 02:04:17 UTC (rev 1196)
+++ trunk/src/lua.cc	2008-06-27 20:51:22 UTC (rev 1197)
@@ -1908,8 +1908,8 @@
             throwLuaError(L, "Error within tile key resolver");
             return 0;
         }
-        // check result - must be tile or table
-        if (!(is_tile(L, -1) || is_table(L, -1))) {
+        // check result - must be tile or table or nil
+        if (!(is_tile(L, -1) || is_table(L, -1) || lua_isnil(L, -1))) {
             throwLuaError(L, ecl::strf("World init undefined tile '%s' at %d, %d", 
                     key.c_str(), x, y).c_str());
             return 0;
@@ -1923,12 +1923,12 @@
         lua_pushvalue(L, -6);       // duplicate x
         lua_pushvalue(L, -6);       // duplicate y
         int retval=lua_pcall(L, 5, 1, 0);     // resolver(context,evaluator,key,x,y) ->  tile
-        if (retval!=0) {
+        if (retval!=0) { 
             throwLuaError(L, "Error within tile key resolver");
             return 0;
-        }        
-        // check result - must be tile or table
-        if (!(is_tile(L, -1) || is_table(L, -1))) {
+        }
+        // check result - must be tile or table or nil
+        if (!(is_tile(L, -1) || is_table(L, -1) || lua_isnil(L, -1))) {
             throwLuaError(L, ecl::strf("World init undefined tile '%s' at %d, %d", 
                     key.c_str(), x, y).c_str());
             return 0;



From andreasl at mail.berlios.de  Sat Jun 28 00:17:11 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Sat, 28 Jun 2008 00:17:11 +0200
Subject: [Enigma-game-svn] r1198 - in trunk: data data/levels/enigma_vi
	data/levels/lib src/stones
Message-ID: <200806272217.m5RMHBoo007280@sheep.berlios.de>

Author: andreasl
Date: 2008-06-28 00:17:06 +0200 (Sat, 28 Jun 2008)
New Revision: 1198

Modified:
   trunk/data/api1init.lua
   trunk/data/levels/enigma_vi/andreas31_1.xml
   trunk/data/levels/enigma_vi/luc34_1.xml
   trunk/data/levels/lib/libluatools.xml
   trunk/src/stones/ChessStone.cc
   trunk/src/stones/ChessStone.hh
Log:
Trunk:
 - did TODO for chess stones (ivars to flags and attributes)
 - fix andreas31 ("Chess, Bugs & Rock'n'Roll") by porting to API 2
 - fix luc34 ("Tandem Chess")
    - invisible trigger
    - add "st-chess" as api1 translation of "st_chess"
 - map handling functions for libluatools:
    - fuse_map_layers
    - split_map_layers
    - concat_maps_vertically
    - print_map
   fuse_map_layers can be used to port BBE-levels
   more easily to API 2, as seen in andreas31.


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-06-27 20:51:22 UTC (rev 1197)
+++ trunk/data/api1init.lua	2008-06-27 22:17:06 UTC (rev 1198)
@@ -113,6 +113,7 @@
     st_brick_new = "st-bigbrick-new",
     st_brick_nes = "st-bigbrick-nes",
     st_brick_nesw = "st-bigbrick-nesw",
+    st_chess = "st-chess",
     st_chess_black = "st-chess_black",
     st_chess_white = "st-chess_white",
     st_coinslot = "st-coinslot",

Modified: trunk/data/levels/enigma_vi/andreas31_1.xml
===================================================================
--- trunk/data/levels/enigma_vi/andreas31_1.xml	2008-06-27 20:51:22 UTC (rev 1197)
+++ trunk/data/levels/enigma_vi/andreas31_1.xml	2008-06-27 22:17:06 UTC (rev 1198)
@@ -3,12 +3,12 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Chess, Bugs &amp; Rock'n'Roll" el:subtitle="" el:id="andreas31"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="Andreas Lochmann" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2006 Andreas Lochmann</el:copyright>
+      <el:copyright>Copyright ? 2006, 2008 Andreas Lochmann</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="1.0">
-       <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libluatools" el:id="lib/libluatools" el:release="1" el:preload="true"/>
       </el:compatibility>
       <el:modes el:easy="false" el:single="true" el:network="false"/>
       <el:comments>
@@ -17,38 +17,13 @@
       <el:score el:easy="-" el:difficult="05:50"/>
     </el:info>
     <el:luamain><![CDATA[
--- Constructed with the help of BBE 1.05.
+-- Originally constructed with the help of BBE 1.05.
 
-levelh=25
-levelw=39
-enigma.FlatForce=30
-enigma.SlopeForce=40
-enigma.ElectricForce=30
-function file_oxyd(x,y,f)
-  oxyd_default_flavor=f
-  oxyd(x,y)
-end
-chess_number = 0
-function set_chess(x,y)
-  chess_number = chess_number + 1
-  set_stone("st-chess_black", x, y, {name = "chess"..tostring(chess_number)})
-end
-function set_trigger(x,y)
-  set_item("it-trigger", x, y, {action = "callback", target = "trigger_call"})
-end
-dirmessage = {}
-dirmessage[1] = "move_nne"
-dirmessage[2] = "move_nnw"
-dirmessage[3] = "move_wwn"
-dirmessage[4] = "move_wws"
-dirmessage[5] = "move_ssw"
-dirmessage[6] = "move_sse"
-dirmessage[7] = "move_ees"
-dirmessage[8] = "move_een"
 function trigger_call()
-  msg = dirmessage[random(1,8)]
-  SendMessage(enigma.GetNamedObject("chess"..tostring(random(1,chess_number))), msg)
+  local dir = ({NNE, NEE, SEE, SSE, SSW, SWW, NWW, NNW})[random(1,8)]
+  no["chess"..tostring(random(1,chess_number))]:message("move", dir)
 end
+
 myfloor = {}
 myfloor[1] = "fl-black"     -- "fl-lightgray"
 myfloor[2] = "fl-darkgray"  -- "fl-darkgray"
@@ -56,38 +31,41 @@
 myfloor[4] = "fl-wood"      -- "fl-lightgray"
 myfloor[5] = "fl-black"     -- "fl-lightgray"
 myfloor[6] = "fl-black"     -- "fl-lightgray"
-function set_grad(x, y, gx, gy)
-  set_floor(myfloor[random(1,6)], x, y,
-    {force_x = gx * 30 + random(-5, 5), force_y = gy * 30 + random(-5, 5),
-    friction = 3.0, mouseforce = 1.6})
+chess_number = 0
+
+function myresolver(key, x, y)
+  local gx = nil
+  local gy = nil
+  if key == "#  "  then  gx = 0.8   gy = 0.8   end
+  if key == "$  "  then  gx = 0     gy = -1    end
+  if key == "%  "  then  gx = 0.8   gy = -0.8  end
+  if key == "&  "  then  gx = 1     gy = 0     end
+  if key == "'  "  then  gx = 0     gy = 1     end
+  if key == ")  "  then  gx = -1    gy = 0     end
+  if key == ",  "  then  gx = -0.8  gy = 0.8   end
+  if key == "-  "  then  gx = -0.8  gy = -0.8  end
+  if gx and gy then
+    return ti({myfloor[random(1,6)],
+            force_x = gx * 30 + random(-5, 5),
+            force_y = gy * 30 + random(-5, 5),
+            friction = 3.0, mouseforce = 1.6})
+  end
+  if key == " C "  then
+      chess_number = chess_number + 1
+      return ti({"st_chess_black", name = "chess"..tostring(chess_number)})
+  end
+  return ti[key]
 end
-function set_blackball(x,y)
-  set_actor("ac-blackball", x + 0.5, y + 0.5, {mouseforce = 2.0, player = 0})
-end
-cells={}
-items={}
-actors={}
-stones={}
-actors[" "]=cell{}
-stones[" "]=cell{}
-cells[" "]=cell{}
-items[" "]=cell{}
-cells["!"]=cell{floor="fl-wood"}
-cells["#"]=cell{parent={{set_grad, 0.8, 0.8}}}
-cells["$"]=cell{parent={{set_grad, 0, -1}}}
-cells["%"]=cell{parent={{set_grad, 0.8, -0.8}}}
-cells["&"]=cell{parent={{set_grad, 1, 0}}}
-cells["'"]=cell{parent={{set_grad, 0, 1}}}
-cells[")"]=cell{parent={{set_grad, -1, 0}}}
-cells[","]=cell{parent={{set_grad, -0.8, 0.8}}}
-cells["-"]=cell{parent={{set_grad, -0.8, -0.8}}}
-stones["!"]=cell{stone="st-redrock"}   -- st-rock6
-stones["#"]=cell{parent={{file_oxyd,"b"}}}
-stones["C"]=cell{parent={{set_chess}}}
-stones["$"]=cell{stone="st-bug"}
-stones["T"]=cell{parent={{set_trigger}}}
-actors["!"]=cell{actor="ac-bug"}
-actors["#"]=cell{parent={{set_blackball}}}
+
+ti["   "] = {"fl-wood"}
+ti["!  "] = {"fl-wood"}
+ti[" ! "] = {"st-redrock"}  -- st-rock6
+ti[" # "] = {"st_oxyd", flavor = "b"}
+ti[" $ "] = {"st-bug"}
+ti[" T "] = {"it_trigger", target = "trigger_call"}
+ti["  !"] = {"ac-bug"}
+ti["  #"] = {"#ac-blackball", mouseforce = 2.0}
+
 level={"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!",
        "!#####&&&&&&&&&&&&&&&&&&&&&&&&&&&,,,,,!",
        "!#####&&&&&&&&&&&&&&&&&&&&&&&&&&&,,,,,!",
@@ -138,31 +116,6 @@
           "             !             !       !   ",
           "                                       ",
           "                                       "}
-  itmap={"                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       ",
-         "                                       "}
  stmap={"!!!!#!!!!!!!!!!!!!!!!!!!!!!!!!!!!!#!!!!",
         "!                  T                  !",
         "!                  T                  !",
@@ -188,12 +141,15 @@
         "!                  T                  !",
         "!                  T                  !",
         "!!!!#!!!!!!!!!!!!!!!!!!!!!!!!!!!!!#!!!!"}
-create_world_by_map(level)
-draw_map(0,0,stmap,stones)
-draw_map(0,0,itmap,items)
-draw_map(0,0,acmap,actors)
-oxyd_shuffle()
-display.SetFollowMode(display.FOLLOW_SMOOTH)
+
+map = luatools.fuse_map_layers(level, stmap, acmap)
+w, h = wo(res.composer(myresolver), "   ", map)
+
+wo:shuffleOxyd()
+
+wo["FollowGrid"] = false
+wo["FollowMethod"] = FOLLOW_SCROLL
+
     ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Modified: trunk/data/levels/enigma_vi/luc34_1.xml
===================================================================
--- trunk/data/levels/enigma_vi/luc34_1.xml	2008-06-27 20:51:22 UTC (rev 1197)
+++ trunk/data/levels/enigma_vi/luc34_1.xml	2008-06-27 22:17:06 UTC (rev 1198)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Tandem Chess" el:subtitle="Work together!" el:id="luc342007"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="Lukas Sch?ller" el:email="Lucky_Luc at web.de" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Lukas Sch?ller</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -57,20 +57,20 @@
     elseif(c =="K") then
       set_stone("st-chess_black",i-1,line)
     elseif(c =="B") then
-      set_item("it-trigger",i-1,line,{invisible="1",action="callback",target="flip_black"})
+      set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="flip_black"})
       set_floor("fl-black",i-1,line)
     elseif(c =="W") then
-      set_item("it-trigger",i-1,line,{invisible="1",action="callback",target="flip_white"})
+      set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="flip_white"})
       set_floor("fl-white",i-1,line)
     elseif(c =="x") then
       set_item("it-trigger",i-1,line)
     elseif(c =="O") then
       oxyd(i-1,line)
     elseif(c =="0") then
-      set_actor("ac-blackball",i-0.5,line+0.5,{player="0"})
+      set_actor("ac-blackball",i-0.5,line+0.5,{player=0})
       set_item("it-yinyang",i-1,line)
     elseif(c =="1") then
-      set_actor("ac-whiteball",i-0.5,line+0.5,{player="1"})
+      set_actor("ac-whiteball",i-0.5,line+0.5,{player=1})
       set_item("it-yinyang",i-1,line)
     end
   end

Modified: trunk/data/levels/lib/libluatools.xml
===================================================================
--- trunk/data/levels/lib/libluatools.xml	2008-06-27 20:51:22 UTC (rev 1197)
+++ trunk/data/levels/lib/libluatools.xml	2008-06-27 22:17:06 UTC (rev 1198)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="library">
       <el:identity el:title="" el:id="lib/libluatools"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
       <el:author  el:name="Enigma Team" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -246,6 +246,159 @@
   return all_combinations
 end
 
+---------------------------------------------------------------------
+--  MAP  HANDLING
+---------------------------------------------------------------------
+
+-- A "map" is a table of strings, like it's used in most
+-- graphical ways to describe a level, including API 2.
+
+-- fuse_map_layers takes a list of maps or a table of maps
+-- and returns a map, which is constructed from the others
+-- in the following way:
+--  Map1:  {"abc", "def"}
+--  Map2:  {"ABC", "DEF"}
+--  Map3:  {"123", "456"}
+--  fuse_map_layers(Map1, Map2, Map3):
+--         {"aA1bB2cC3", "dD4eE5fF6"}
+-- Missing letters are replaced by " ".
+-- This function can be used to combine several layers
+-- (e.g. floors, stones, items, actors) into a common
+-- (typically very large) map.
+-- fuse_map_layers assumes that the input maps are all
+-- using a key length of 1. Otherwise you should use
+-- split_map_layers before applying fuse_map_layers.
+function luatools.fuse_map_layers(layer1, ...)
+  -- Understand arguments
+  local layers = {layer1, ...}
+  if table.getn(layers) == 1 then
+    layers = layer1
+  end
+  if type(layers) ~= "table" then
+    error("fuse_map_layers: Argument is not a table (map).")
+  end
+  -- Calculate new height and width
+  local max_lines, max_length = 0, 0
+  for _, layer in pairs(layers) do
+    if type(layer) ~= "table" then
+      error("fuse_map_layers: Argument is not a table.")
+    end
+    max_lines = math.max(max_lines, table.getn(layer))
+    for _, line in pairs(layer) do
+      if type(line) ~= "string" then
+        error("fuse_map_layers: Line in table (map) is not a string.")
+      end
+      max_length = math.max(max_length, string.len(line))
+    end
+  end
+  local result = {}
+  -- Create result
+  local result = {}
+  for y = 1, max_lines do
+    result[y] = ""
+    for x = 1, max_length do
+      for _, layer in pairs(layers) do
+        if layer[y] and (string.len(layer[y]) >= x ) then
+          result[y] = result[y] .. string.sub(layer[y], x, x)
+        else
+          result[y] = result[y] .. " "
+        end
+      end
+    end
+  end
+  return result
+end
+
+-- split_map_layers takes a map, splits it into KEYLENGTH
+-- layers and returns a table of layers. It's the opposite
+-- to fuse_map_layers.
+function luatools.split_map_layers(keylength, map)
+  -- Analyse arguments
+  if type(keylength) ~= "number" then
+    error("split_map_layers: First argument should be a number (key length).")
+  end
+  if type(map) ~= "table" then
+    error("split_map_layers: Second argument should be a table (map).")
+  end
+  -- Split layers
+  local layers = {}
+  for j = 1, keylength do
+    layers[j] = {}
+  end
+  for y, line in pairs(map) do
+    if type(line) ~= "string" then
+      error("print_map: Line is not a string.")
+    end
+    for j = 1, keylength do
+      layers[j][y] = ""
+    end
+    for x = 1, string.len(line) do
+      local j = luatools.mod(x - 1, keylength) + 1
+      layers[j][y] = layers[j][y]..string.sub(line, x, x)
+    end
+  end
+  return layers
+end
+
+-- concat_maps_vertically takes a list of maps or a table of
+-- maps and returns a map, which is constructed from the others
+-- in the following way:
+--  Map1:  {"abc", "def"}
+--  Map2:  {"ABC", "DEF"}
+--  Map3:  {"123", "456"}
+--  fuse_map_layers(Map1, Map2, Map3):
+--         {"abcABC123", "defDEF456"}
+-- Missing letters are replaced by " ".
+-- This function can be used to combine several rooms
+-- or areas of a map to build a larger map.
+-- Note that concat_maps_vertically doesn't take an
+-- offset value for a vertical shift of the maps!
+function luatools.concat_maps_vertically(map1, ...)
+  -- Understand arguments
+  local maps = {map1, ...}
+  if table.getn(maps) == 1 then
+    maps = map1
+  end
+  if type(maps) ~= "table" then
+    error("concat_maps_vertically: Argument is not a table (map).")
+  end
+  -- Find maximal line lengths and height
+  local lengths = {}
+  local height = 0
+  for j, map in pairs(maps) do
+    lengths[j] = 0
+    for y, line in pairs(map) do
+      lengths[j] = math.max(lengths[j], string.len(line))
+      height = math.max(height, y)
+    end
+  end
+  -- Concat to result
+  local result = {}
+  for y = 1, height do
+    result[y] = ""
+    for j, map in pairs(maps) do
+      result[y] = result[y] .. map[y] .. string.rep(" ", lengths[j] - string.len(map[y])) 
+    end
+  end
+  return result
+end
+
+-- print_map uses the print command to print a map.
+-- It should be used for debug reasons only.
+-- SEP can be a separator like "|" to encase the map
+-- on the left and on the right.
+function luatools.print_map(map, sep)
+  if type(map) ~= "table" then
+    error("print_map: Argument is not a table (map).")
+  end
+  for _, line in pairs(map) do
+    if type(line) ~= "string" then
+      error("print_map: Line is not a string.")
+    end
+    print((sep or "")..line..(sep or ""))
+  end
+end
+
     ]]></el:luamain>
     <el:i18n>
     </el:i18n>

Modified: trunk/src/stones/ChessStone.cc
===================================================================
--- trunk/src/stones/ChessStone.cc	2008-06-27 20:51:22 UTC (rev 1197)
+++ trunk/src/stones/ChessStone.cc	2008-06-27 22:17:06 UTC (rev 1198)
@@ -20,7 +20,6 @@
 
 #include "stones/ChessStone.hh"
 #include "errors.hh"
-//#include "main.hh"
 #include "player.hh"
 
 namespace enigma {
@@ -28,13 +27,9 @@
     double ChessStone::hit_threshold = 1.5;
 
     ChessStone::ChessStone(int color) {
-        newcolor = color;
-        Stone::setAttr("color", color);
-        destination = GridPos(0,0);
-        capture_retry = 0;
-        rememberFalling = false;
-        rememberSwamp = false;
+        setAttr("$destination", GridPos(0,0));
         state = IDLE;
+        set_color(color);
     }
 
     ChessStone::~ChessStone() {
@@ -69,7 +64,7 @@
             set_color(to_int(m.value));
             return Value();
         } else if (m.message == "flip") {
-            set_color(1 - newcolor); //(int)getAttr("color"));
+            set_color((objFlags & OBJBIT_NEWCOLOR) ? 0 : 1);
             return Value();
         }
         return Stone::message(m);
@@ -93,16 +88,16 @@
                 break;
             case DISAPPEARING:
                 // Maybe the floor has changed into swamp or abyss?
-                if (!rememberFalling && !rememberSwamp) {
+                if (!(objFlags & (OBJBIT_FALL | OBJBIT_SINK))) {
                     if (try_state(APPEARING)) {
-                        st = GetStone(destination);
+                        st = GetStone(getAttr("$destination"));
                         if (st) {
                             // Something went wrong while killing the old
                             // stone, or maybe a third one intervened.
                             // Don't move, just reappear at old position.                
                         } else {
-                            move_stone(destination, "movesmall");
-                            SendMessage(GetFloor(destination), "capture");
+                            move_stone(getAttr("$destination"), "movesmall");
+                            SendMessage(GetFloor(getAttr("$destination")), "capture");
                         }
                         // maybe a floor-change has happened, but during
                         // state APPEARING this doesn't mean anything:
@@ -114,7 +109,7 @@
                 // just by continuing to the next case:
             case CAPTURED:
             case FALLING:
-            case SWAMP:
+            case SINKING:
                 KillStone(get_pos());
                 break;
             default:
@@ -159,32 +154,28 @@
             if (fl->is_kind("fl-abyss"))
                 try_state(FALLING);
             if (fl->is_kind("fl-swamp"))
-                try_state(SWAMP);
+                try_state(SINKING);
         }
     }
     
     void ChessStone::alarm() {
-        switch(state) {
-            case CAPTURING:
-                if(!GetStone(destination)) {
-                    if(try_state(DISAPPEARING))
-                        set_anim(get_model_name() + "-disappearing");
-                    break;
-                } else if(capture_retry < max_capture_retry) {
-                    ++capture_retry;
-                    GameTimer.set_alarm(this, capture_interval, false);
-                } else {
-                    // Cancel efforts to capture foreign stone.
-                    capture_retry = 0;
-                    try_state(IDLE);
-                }
-                break;
-            default:
-               ASSERT(0, XLevelRuntime, "ChessStone: inconsistent state in alarm()");
+        ASSERT(state == CAPTURING, XLevelRuntime,
+            "ChessStone: inconsistent state in alarm()");
+        int capture_retry = (objFlags & OBJBIT_CAPTURE_RETRY) >> 27;
+        if(!GetStone(getAttr("$destination"))) {
+            if(try_state(DISAPPEARING))
+                set_anim(get_model_name() + "-disappearing");
+        } else if(capture_retry < max_capture_retry) {
+            objFlags &= ~OBJBIT_CAPTURE_RETRY;
+            objFlags |= ((capture_retry + 1) << 27) & OBJBIT_CAPTURE_RETRY;
+            GameTimer.set_alarm(this, capture_interval, false);
+        } else {
+            // Cancel efforts to capture foreign stone.
+            objFlags &= ~OBJBIT_CAPTURE_RETRY;
+            try_state(IDLE);
         }
     }
 
-
     std::string ChessStone::get_model_name() {
         return getClass() + ((getAttr("color") == 0) ? "_black" : "_white");
     }
@@ -192,7 +183,7 @@
     Value ChessStone::maybe_move_to(Direction dir1, Direction dir2) {
         if (state == IDLE) {
             // check for fire, step by step
-            destination = move(get_pos(), dir1);
+            GridPos destination = move(get_pos(), dir1);
             if (Item *it = GetItem(destination))
                 if (get_id(it) == it_burnable_burning)
                     return Value();
@@ -205,7 +196,10 @@
                 if (get_id(it) == it_burnable_burning)
                     return Value();
             // check for boundary
-            if (!IsInsideLevel(destination))  return Value();
+            if (!IsInsideLevel(destination))
+                return Value();
+            // safe destination to attribute, needed after animation
+            setAttr("$destination", destination);
             // check for stone
             if (!GetStone(destination)) {
                 // Simple case: Just move.
@@ -223,7 +217,7 @@
                         "ChessStone: strange things happening in maybe_move_to");
                     // must work, because state is IDLE
                     GameTimer.set_alarm(this, capture_interval, false);
-                    capture_retry = 0;
+                    objFlags &= ~OBJBIT_CAPTURE_RETRY;
                     return true;
                 }
                 return Value();
@@ -243,23 +237,25 @@
     }
 
     bool ChessStone::try_state(State newstate) {
-        if (state != FALLING && state != SWAMP) {
-            // Switch to FALLING or SWAMP only when IDLE,
+        if (state != FALLING && state != SINKING) {
+            // Switch to FALLING or SINKING only when IDLE,
             // but remember them!
             if (newstate == FALLING)
-                rememberFalling = true;
-            else if (newstate == SWAMP)
-                rememberSwamp = true;
+                objFlags |= OBJBIT_FALL;
+            else if (newstate == SINKING)
+                objFlags |= OBJBIT_SINK;
             else
                 state = newstate;        
-            if (state == IDLE &&  getAttr("color") != newcolor)
-                set_color(newcolor);
-            if (state == IDLE && rememberFalling) {
+            // After changing the state to IDLE, do we
+            // have to make up for something?
+            if (state == IDLE && getAttr("color") != ((objFlags & OBJBIT_NEWCOLOR) ? 1 : 0))
+                set_color((objFlags & OBJBIT_NEWCOLOR) ? 1 : 0);
+            if (state == IDLE && (objFlags & OBJBIT_FALL)) {
                 state = FALLING;
                 set_anim(get_model_name() + "-disappearing");
             }
-            if (state == IDLE && rememberSwamp) {
-                state = SWAMP;
+            if (state == IDLE && (objFlags & OBJBIT_SINK)) {
+                state = SINKING;
                 set_anim(get_model_name() + "-swamp");
             }
         }
@@ -272,12 +268,14 @@
         }
         if(state == IDLE) {
             Stone::setAttr("color", color);
-            newcolor = color;
+            objFlags &= ~OBJBIT_NEWCOLOR;
+            objFlags |= (color == 1) ? OBJBIT_NEWCOLOR : false;
             if (isDisplayable())
                 init_model();
         } else {
             // Remember this color and set it the next time IDLE is set.
-            newcolor = color;
+            objFlags &= ~OBJBIT_NEWCOLOR;
+            objFlags |= (color == 1) ? OBJBIT_NEWCOLOR : false;
         }
     }
     

Modified: trunk/src/stones/ChessStone.hh
===================================================================
--- trunk/src/stones/ChessStone.hh	2008-06-27 20:51:22 UTC (rev 1197)
+++ trunk/src/stones/ChessStone.hh	2008-06-27 22:17:06 UTC (rev 1198)
@@ -37,9 +37,31 @@
 
     private:
         // Variables and Constants
+        // (APPEARING and DISAPPEARING are used when moving the stone.)
         enum State {IDLE, APPEARING, DISAPPEARING, CAPTURING,
-                    CAPTURED, FALLING, SWAMP};
-        
+                    CAPTURED, FALLING, SINKING};
+
+        // The first three boolean flags are meant as buffers to
+        // remember state-changes. When the horse is just jumping
+        // or capturing, no state-change can be done at once, but
+        // only after jumping. To avoid shortcuts, this is
+        // consequently done for floor-changes as well, which
+        // means that a horse can (retroactively) sink or fall
+        // though standing on normal floor after a jump, if the
+        // origin floor became swamp or abyss in meanwhile.
+        // The final 5 bits are used in the following way:
+        // During a capture, the capturing stone has to give the
+        // captured stone enough time to play its animation.
+        // So 20 alarms of 0.1 seconds each are scheduled, to
+        // wait before finally cancelling the capture.
+        // OBJBIT_CAPTURE_RETRY is the corresponding counter.
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_NEWCOLOR      =  1<<24, ///< change to this color next time possible
+            OBJBIT_FALL          =  1<<25, ///< fall next time possible
+            OBJBIT_SINK          =  1<<26, ///< sink next time possible
+            OBJBIT_CAPTURE_RETRY = 31<<27  ///< count retries for capturing
+        };
+
     public:
         ChessStone(int color);
         virtual ~ChessStone();
@@ -70,14 +92,8 @@
     private:
         static double capture_interval;
         static double hit_threshold;
-        static const int max_capture_retry = 20;
+        static const int max_capture_retry = 20; // note definition of OBJBIT_CAPTURE_RETRY
 
-        GridPos destination;   // TODO -> attribute
-        int newcolor;  // Buffers a color-changing message while not IDLE.  // TODO -> objFlags
-        int capture_retry;    // TODO -> objFlags
-        bool rememberFalling; // TODO -> objFlags
-        bool rememberSwamp;   // TODO -> objFlags
-
         // Methods
         string get_model_name();
         Value maybe_move_to(Direction dir1, Direction dir2);



From ral at mail.berlios.de  Sun Jun 29 14:53:13 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 29 Jun 2008 14:53:13 +0200
Subject: [Enigma-game-svn] r1199 - in trunk: data/schemas src src/stones
Message-ID: <200806291253.m5TCrD8J020682@sheep.berlios.de>

Author: ral
Date: 2008-06-29 14:53:04 +0200 (Sun, 29 Jun 2008)
New Revision: 1199

Modified:
   trunk/data/schemas/objects.xml
   trunk/src/floors.cc
   trunk/src/stones/ChessStone.cc
   trunk/src/stones/ChessStone.hh
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering
- chess: add attribute "movable" support - read only, true
- make message capture a system message "_capture"


Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-06-27 22:17:06 UTC (rev 1198)
+++ trunk/data/schemas/objects.xml	2008-06-29 12:53:04 UTC (rev 1199)
@@ -44,7 +44,6 @@
     <attr name="transparent" type="bool" default="false" rw="rw"/>
   </attributes>
   <messages>
-    <msg name="capture" type="nil"/>
     <msg name="close" type="nil"/>
     <msg name="closeall" type="nil"/>
     <msg name="flip" type="nil"/>
@@ -63,6 +62,7 @@
     <msg name="turnback" type="nil"/>
     <msg name="_bombstone" type="nil"/>
     <msg name="_brush" type="nil"/>
+    <msg name="_capture" type="nil"/>
     <msg name="_explosion" type="nil"/>
     <msg name="_glasses" type="nil"/>
     <msg name="_hit" type="object"/>
@@ -348,10 +348,11 @@
     </object>
     <object name="st_chess">
       <attr name="color" default="0"/>
-      <msg name="capture"/>
+      <attr name="movable" default="true" rw="r"/>
       <msg name="flip"/>
       <msg name="move"/>
       <msg name="signal"/>
+      <msg name="_capture"/>
     </object>
     <object name="st_chess_black">
       <attr name="color" value="0"/>

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2008-06-27 22:17:06 UTC (rev 1198)
+++ trunk/src/floors.cc	2008-06-29 12:53:04 UTC (rev 1199)
@@ -955,7 +955,7 @@
 }
 
 Value Thief::message(const Message &m) {
-    if(m.message == "capture" && state == IDLE) {
+    if(m.message == "_capture" && state == IDLE) {
         state = CAPTURED;
         Item * it =  GetItem(get_pos());
         

Modified: trunk/src/stones/ChessStone.cc
===================================================================
--- trunk/src/stones/ChessStone.cc	2008-06-27 22:17:06 UTC (rev 1198)
+++ trunk/src/stones/ChessStone.cc	2008-06-29 12:53:04 UTC (rev 1199)
@@ -48,7 +48,7 @@
     }
 
     Value ChessStone::message(const Message &m) {
-        if (m.message == "capture") {
+        if (m.message == "_capture") {
             if (isDisplayable() && state == IDLE && m.value.to_string() != getKind())
                 if (try_state(CAPTURED)) {
                     set_anim(get_model_name() + "-captured");
@@ -97,7 +97,7 @@
                             // Don't move, just reappear at old position.                
                         } else {
                             move_stone(getAttr("$destination"), "movesmall");
-                            SendMessage(GetFloor(getAttr("$destination")), "capture");
+                            SendMessage(GetFloor(getAttr("$destination")), "_capture");
                         }
                         // maybe a floor-change has happened, but during
                         // state APPEARING this doesn't mean anything:
@@ -211,7 +211,7 @@
             } else {
                 // Test stone. Is it opposite chess stone or totally another one?
                 Stone *st = GetStone(destination);
-                if(to_int(SendMessage(st, "capture", Value(get_model_name()))) ) {
+                if(to_int(SendMessage(st, "_capture", Value(get_model_name()))) ) {
                     // Give it some time for animation, then replace it.
                     ASSERT(try_state(CAPTURING), XLevelRuntime,
                         "ChessStone: strange things happening in maybe_move_to");

Modified: trunk/src/stones/ChessStone.hh
===================================================================
--- trunk/src/stones/ChessStone.hh	2008-06-27 22:17:06 UTC (rev 1198)
+++ trunk/src/stones/ChessStone.hh	2008-06-29 12:53:04 UTC (rev 1199)
@@ -36,25 +36,29 @@
         DECL_TRAITS;
 
     private:
-        // Variables and Constants
-        // (APPEARING and DISAPPEARING are used when moving the stone.)
+        /**
+         * Variables and Constants
+         * (APPEARING and DISAPPEARING are used when moving the stone.)
+         */
         enum State {IDLE, APPEARING, DISAPPEARING, CAPTURING,
                     CAPTURED, FALLING, SINKING};
 
-        // The first three boolean flags are meant as buffers to
-        // remember state-changes. When the horse is just jumping
-        // or capturing, no state-change can be done at once, but
-        // only after jumping. To avoid shortcuts, this is
-        // consequently done for floor-changes as well, which
-        // means that a horse can (retroactively) sink or fall
-        // though standing on normal floor after a jump, if the
-        // origin floor became swamp or abyss in meanwhile.
-        // The final 5 bits are used in the following way:
-        // During a capture, the capturing stone has to give the
-        // captured stone enough time to play its animation.
-        // So 20 alarms of 0.1 seconds each are scheduled, to
-        // wait before finally cancelling the capture.
-        // OBJBIT_CAPTURE_RETRY is the corresponding counter.
+        /**
+         * The first three boolean flags are meant as buffers to
+         * remember state-changes. When the horse is just jumping
+         * or capturing, no state-change can be done at once, but
+         * only after jumping. To avoid shortcuts, this is
+         * consequently done for floor-changes as well, which
+         * means that a horse can (retroactively) sink or fall
+         * though standing on normal floor after a jump, if the
+         * origin floor became swamp or abyss in meanwhile.
+         * The final 5 bits are used in the following way:
+         * During a capture, the capturing stone has to give the
+         * captured stone enough time to play its animation.
+         * So 20 alarms of 0.1 seconds each are scheduled, to
+         * wait before finally cancelling the capture.
+         * OBJBIT_CAPTURE_RETRY is the corresponding counter.
+         */
         enum ObjectPrivatFlagsBits {
             OBJBIT_NEWCOLOR      =  1<<24, ///< change to this color next time possible
             OBJBIT_FALL          =  1<<25, ///< fall next time possible

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-06-27 22:17:06 UTC (rev 1198)
+++ trunk/src/stones_simple.cc	2008-06-29 12:53:04 UTC (rev 1199)
@@ -1414,7 +1414,7 @@
     if(m.message == "signal" && server::GameCompatibility != GAMET_ENIGMA) {
         performAction(!m.value.to_bool());  // inverse signal multiplier
         return Value();
-    } else if (m.message == "capture" && state == IDLE) {
+    } else if (m.message == "_capture" && state == IDLE) {
         state = CAPTURED;
         Item * it =  GetItem(get_pos());
         



From ral at mail.berlios.de  Sun Jun 29 15:12:22 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 29 Jun 2008 15:12:22 +0200
Subject: [Enigma-game-svn] r1200 - team_levelpacks/team_test_new_api
Message-ID: <200806291312.m5TDCMWU022306@sheep.berlios.de>

Author: ral
Date: 2008-06-29 15:12:11 +0200 (Sun, 29 Jun 2008)
New Revision: 1200

Modified:
   team_levelpacks/team_test_new_api/andreasT01_1.xml
   team_levelpacks/team_test_new_api/ralT014_1.xml
   team_levelpacks/team_test_new_api/ralT024_1.xml
   team_levelpacks/team_test_new_api/ralT031_1.xml
   team_levelpacks/team_test_new_api/ralT049_1.xml
   team_levelpacks/team_test_new_api/ralT050_1.xml
Log:
Test Level new API:
- some updates on renamings

Modified: team_levelpacks/team_test_new_api/andreasT01_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/andreasT01_1.xml	2008-06-29 12:53:04 UTC (rev 1199)
+++ team_levelpacks/team_test_new_api/andreasT01_1.xml	2008-06-29 13:12:11 UTC (rev 1200)
@@ -24,6 +24,7 @@
 ti["."] = {"it_trap"}
 
 ti["@"] = {"#ac-blackball"}
+ti["0"] = {"#ac-bug"}
 
 ti["l"] = {"st_laser", state = ON, orientation = SOUTH}
 ti["p"] = {"st_polarswitch", state = OFF}
@@ -31,36 +32,38 @@
 ti["g"] = {"it_glasses", state = SPOT_TRAP}
 ti["h"] = {"it_glasses", state = SPOT_SENSOR}
 ti["u"] = {"it_umbrella"}
-ti["d"] = {"st-death_invisible"}
+ti["d"] = {"st_death_invisible"}
 ti["b"] = {"it-blackbomb"}
 ti["y"] = {"it-dynamite"}
 ti["w"] = ti["."] .. {"st_window", faces="e"}
 ti["r"] = {"it_wrench"}
+ti["t"] = {"it-spring1"}
+ti["m"] = {"it_landmine"}
 ti["s"] = {"it_sensor", invisible = true} --{"it-spring2"}
 
 ti["A"] = ti["."] .. {"fl-leaves"}
-ti["B"] = ti["."] .. {"fl-swamp"}
+ti["B"] = ti["."] .. {"fl-water"}
 ti["C"] = ti["."] .. {"fl-metal"}
 ti["D"] = ti["."] .. {"fl-black"}
 ti["E"] = ti["."] .. {"fl-inverse"}
 ti["F"] = ti["."] .. {"fl-rough-blue"}
-ti["G"] = ti["."] .. {"fl-rough"}
+ti["G"] = ti["."] .. {"fl-abyss"}
 ti["H"] = ti["."] .. {"fl-floor_001"}
 
 w, h = wo(ti, " ", {
 "@                   ",
 "   uuuu  CCCC  DDDD ",
 "g  uuuu  CCCC  DDDD ",
-"h                   ",
+"h             0     ",
 "   AAAA  BBBB  EEEE ",
-"   AAAA  BBBB  EEEE ",
+"t  AAAA  BBBB  EEEE ",
 "s                   ",
 "   FFFF  GGGG  HHHH ",
 "   FFFF  GGGG  HHHH ",
 "l    b              ",
 "p    y    wr        ",
 "                    ",
-"e                  d"
+"e    mm            d"
 })
 
   ]]></el:luamain>

Modified: team_levelpacks/team_test_new_api/ralT014_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT014_1.xml	2008-06-29 12:53:04 UTC (rev 1199)
+++ team_levelpacks/team_test_new_api/ralT014_1.xml	2008-06-29 13:12:11 UTC (rev 1200)
@@ -31,7 +31,7 @@
 ti["s"] = ti[" "] .. {"st_switch", action="callback", target="doit"}
 ti["b"] = ti[" "] .. {"st_blocker", name="blocker"}
 ti["d"] = ti[" "] .. {"st-door_b", name="door#"}
-ti["h"] = ti[" "] .. {"st-chess_black", name="chess#"}
+ti["h"] = ti[" "] .. {"st_chess_black", name="chess#"}
 ti["o"] = ti[" "] .. {"st_oxyd"}
 ti["B"] = ti[" "] .. {"it-bag"}
 ti["T"] = ti[" "] .. {"st-thief"}
@@ -103,6 +103,7 @@
         no.buggy["opendoors"] = not_all_doors + no["money"] + fl(3,4)
         no.buggy["mypos"] = po(no.money)
         chess_grp["color"] = 1
+        chess_grp:move(po(-2,-1))
         wo[mygrp] = {"st-wood"}
     else
         it(blocker_pos):close()

Modified: team_levelpacks/team_test_new_api/ralT024_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT024_1.xml	2008-06-29 12:53:04 UTC (rev 1199)
+++ team_levelpacks/team_test_new_api/ralT024_1.xml	2008-06-29 13:12:11 UTC (rev 1200)
@@ -29,7 +29,7 @@
 ti["L"] = {"st_laserswitch", target="door1", action="signal"}
 ti["I"] = {"st_laserswitch", inverse=true, target="door2", action="signal"}
 ti["E"] = {"st_laser", "laser"}
-ti["M"] = {"st-mirror-p|"}
+ti["M"] = {"st_mirror"}
 ti["e"] = {"st_switch", target="laser", action="toggle"}
 ti["F"] = {"st_laser", "laser2"}
 ti["f"] = {"st_switch_black", instant=true, state=1, inverse=true, target="laser2", action="signal"}

Modified: team_levelpacks/team_test_new_api/ralT031_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT031_1.xml	2008-06-29 12:53:04 UTC (rev 1199)
+++ team_levelpacks/team_test_new_api/ralT031_1.xml	2008-06-29 13:12:11 UTC (rev 1200)
@@ -52,7 +52,7 @@
 ti["V"] = ti[" "] .. {"st-brownie"}
 ti["u"] = ti[" "] .. {"it-spring1"}
 ti["v"] = ti[" "] .. {"it-brake"}
-ti["Y"] = ti[" "] .. {"st-death"}
+ti["Y"] = ti[" "] .. {"st_death"}
 ti["z"] = ti[" "] .. {"it-dynamite"}
 
 ti["M"] = ti[" "] .. {"st_switch", target="maketrigger"}

Modified: team_levelpacks/team_test_new_api/ralT049_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT049_1.xml	2008-06-29 12:53:04 UTC (rev 1199)
+++ team_levelpacks/team_test_new_api/ralT049_1.xml	2008-06-29 13:12:11 UTC (rev 1200)
@@ -21,7 +21,7 @@
 wo["ExtralifeGlasses"] = SPOT_DEATH + SPOT_LIGHTPASSENGER
 
 ti[" "] = {"fl-sahara"}
-ti["!"] = {"st-death_invisible"}
+ti["!"] = {"st_death_invisible"}
 ti["H"] = {"st-camouflage_hole"}
 ti["L"] = {"st_lightpassenger", state=OFF}
 ti["l"] = {"st_switch", target="newlp"}

Modified: team_levelpacks/team_test_new_api/ralT050_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT050_1.xml	2008-06-29 12:53:04 UTC (rev 1199)
+++ team_levelpacks/team_test_new_api/ralT050_1.xml	2008-06-29 13:12:11 UTC (rev 1200)
@@ -34,7 +34,7 @@
 
 
 ti["w"] = {"it-magicwand"}
-ti["c"] = {"st-chess_black"}
+ti["c"] = {"st_chess_black"}
 ti["3"] = {"#ac-blackball", player=DEFAULT, controllers=0}
 ti["4"] = {"#ac-whiteball", player=DEFAULT, controllers=0}
 



From ral at mail.berlios.de  Sun Jun 29 15:52:55 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 29 Jun 2008 15:52:55 +0200
Subject: [Enigma-game-svn] r1201 - trunk/doc/reference
Message-ID: <200806291352.m5TDqtq7029784@sheep.berlios.de>

Author: ral
Date: 2008-06-29 15:52:46 +0200 (Sun, 29 Jun 2008)
New Revision: 1201

Modified:
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk 1.1: new API
- refman docu for display follow strategy
- refman docu for some items and stones


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-06-29 13:12:11 UTC (rev 1200)
+++ trunk/doc/reference/enigma-ref.texi	2008-06-29 13:52:46 UTC (rev 1201)
@@ -2971,7 +2971,7 @@
 
 @example
 ti["c"] = @{it_coin_s", "magic#"@}
-ti["v"] = @{it_vortex", destination="@@@@magic#*@}
+ti["v"] = @{it_vortex", destination="@@@@magic#*"@}
 @end example
 
 Setting three magic coins and one vortex in your map will teleport the marble
@@ -3699,12 +3699,12 @@
 
 @table @asis
 @item @b{Type:} @ @ number
- at item @b{Values:} @ @ dependend on the individual object
+ at item @b{Values:} @ @ dependent on the individual object
 Please use the given upper case constants.
 @item @b{Default:} @ @ @code{0}
 @item @b{Access:} @ @ read/sometimes write
 While it is common to set the state attribute on object creation, it is 
-preferable to change the object state lateron by messages.
+preferable to change the object state later on by messages.
 @item @b{Support:} @ @ by all objects
 @end table
 
@@ -3714,7 +3714,7 @@
 All active objects react on being triggered by performing an action on their
 targets. This attribute is part of the @ref{Target - Action} paradigm that 
 guarantees pluggability of objects. You can either set a general @samp{target}
-attribute for an object, or you can set @ref{state} dependant attributes 
+attribute for an object, or you can set @ref{state} dependent attributes 
 @samp{target_0}, @samp{target_1},... (@pxref{Object State}). They all have the
 same syntax:
 
@@ -3741,7 +3741,7 @@
 All active objects react on being triggered by performing an action on their
 targets. This attribute is part of the @ref{Target - Action} paradigm that 
 guarantees pluggability of objects. You can either set a general @samp{action}
-attribute for an object, or you can set @ref{state} dependant attributes 
+attribute for an object, or you can set @ref{state} dependent attributes 
 @samp{action_0}, @samp{action_1},... (@pxref{Object State}). They all have the
 same syntax:
 
@@ -3887,10 +3887,10 @@
 @subsection toggle
 
 This is the default message that is always taken if no other message is provided.
-It toggels the @ref{Object State} quite independant of the very nature of the
+It toggles the @ref{Object State} quite independent of the very nature of the
 state. Two-stated objects like switches will toggle their state form @samp{ON}
 to @samp{OFF} or from @samp{OFF} to @samp{ON}. Door like objects will toggle 
-their state form @samp{OPEN} to @samp{CLOSED} or from @samp{CLOSED} to 
+their state from @samp{OPEN} to @samp{CLOSED} or from @samp{CLOSED} to 
 @samp{OPEN}. Other objects like @ref{st_fourswitch} will turn into the next
 direction. Generally the object will toggle to its next state.
 
@@ -3918,7 +3918,7 @@
 
 A signal message tries to set the object to the state 0 (@samp{OFF}, 
 @samp{CLOSED}) or state 1 (@samp{ON}, @samp{OPEN}) according to its value. This
-message allows you to keep the states of a action source and a receiving object
+message allows you to keep the states of an action source and a receiving object
 in sync. Note that values like @samp{true}, @samp{false} and direction values
 like @samp{WEST} to @samp{NORTH} are converted to 0 and 1. This allows you to
 use @samp{signal} as action message on most objects.
@@ -3987,6 +3987,10 @@
 @menu
 * ActorimpulseStrength::
 * ExtralifeGlasses::
+* FollowAction::
+* FollowGrid::
+* FollowMethod::
+* FollowThreshold::
 * Height::
 * IsDifficult:: 
 * MagnetRange:: 
@@ -4019,14 +4023,86 @@
 
 @table @asis
 @item @b{Type:} @ @ number
- at item @b{Values:} @ @ positiv integer number
+ at item @b{Values:} @ @ positive integer number
 A sum out of the constants @samp{SPOT_DEATH}, @samp{SPOT_HOLLOW},
- at samp{SPOT_ACTORIMPULSE}, @samp{SPOT_SENSOR}, @samp{SPOT_LIGHTPASSENGER}
+ at samp{SPOT_ACTORIMPULSE}, @samp{SPOT_SENSOR}, @samp{SPOT_LIGHTPASSENGER}, 
+ at samp{SPOT_TRAP}
 @item @b{Default:} @ @ @code{SPOT_DEATH + SPOT_HOLLOW + SPOT_LIGHTPASSENGER}
 @item @b{Access:} @ @ read/write
 @item @b{Support:} @ @ @ref{it_extralife}
 @end table
 
+ at node FollowAction
+ at subsection FollowAction
+
+A global variable that describes the action of the display on relocation. This
+attribute is introduced for future extensions, but is currently just partially
+supported. Just the values listed below are used. Please use this attribute
+just as explained in @ref{Display Follow Strategy}.
+
+ at table @asis
+ at item @b{Type:} @ @ number or position
+ at item @b{Values:} @ @ @code{0}, @code{FOLLOW_FULLSCREEN}, @code{HALFSCREEN}
+The distance of display readjustment. Positions are used to supply different 
+values for x and y. The value @samp{@{19, 12@}} is a standard full screen move.
+The value @samp{@{9.5, 6@}} is a standard half screen move. A value @samp{0}
+is a minimal smooth move or the default value for grid based moves.
+ at item @b{Default:} @ @ @code{@{19, 12@}}
+Actually the default is mode based (@pxref{Display Follow Strategy}).
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ no objects
+ at end table
+
+
+ at node FollowGrid
+ at subsection FollowGrid
+
+A global variable that determines if the display is fixed in its static
+positions to grids or if it can be scrolled to any pixel position 
+(@pxref{Display Follow Strategy}).
+
+ at table @asis
+ at item @b{Type:} @ @ bool
+ at item @b{Values:} @ @ @code{true}, @code{false}
+ at item @b{Default:} @ @ @code{true}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ no objects
+ at end table
+
+ at node FollowMethod
+ at subsection FollowMethod
+
+A global variable that describes the method how the display moves, either not
+at all, by pixelwise scrolling, or by flipping to another screen or region
+(@pxref{Display Follow Strategy}).
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ @code{FOLLOW_NO}, @code{FOLLOW_SCROLL}, @code{FOLLOW_FLIP}
+ at item @b{Default:} @ @ @code{FOLLOW_FLIP}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ no objects
+ at end table
+
+ at node FollowThreshold
+ at subsection FollowThreshold
+
+A global variable that describes the threshold at which a crossing active marble
+triggers the display to relocate. It is given as the distance to the screen
+boundary (@pxref{Display Follow Strategy}).
+
+ at table @asis
+ at item @b{Type:} @ @ number or position
+ at item @b{Values:} @ @ 0 or positive number, or a pair of two positive numbers
+The distance from the screen boundary at which the displays readjusts. Positions
+are used to supply different values for x and y. All values need to be less
+than half of the screen size.
+ at item @b{Default:} @ @ @code{0.5}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ no objects
+ at end table
+
+
 @node Height
 @subsection Height
 
@@ -4089,10 +4165,24 @@
 @item @b{Support:} @ @ @ref{it_magnet}
 @end table
 
+ at node MaxOxydColor
+ at subsection MaxOxydColor
+
+A global variable that limits the number of colors assigned to autocolored
+ at ref{st_oxyd}. Be careful with increasing this value beyond its default.
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ @code{OXYD_BLUE}, ... @code{OXYD_BROWN}
+ at item @b{Default:} @ @ @code{OXYD_BLACK}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{st_oxyd}
+ at end table
+
 @node Width
 @subsection Width
 
-A global read only variable reports the width of the the world in grid units.
+A global read only variable reports the width of the world in grid units.
 This is set by the initial world constructor call 
 (@pxref{World Creation and Resolver Chaining}).
 
@@ -4104,20 +4194,7 @@
 @item @b{Support:} @ @ object independent
 @end table
 
- at node MaxOxydColor
- at subsection MaxOxydColor
 
-A global variable that limits the number of colors assigned to autocolored
- at ref{st_oxyd}. Be careful with increasing this value beyond its default.
-
- at table @asis
- at item @b{Type:} @ @ number
- at item @b{Values:} @ @ @code{OXYD_BLUE}, ... @code{OXYD_BROWN}
- at item @b{Default:} @ @ @code{OXYD_BLACK}
- at item @b{Access:} @ @ read/write
- at item @b{Support:} @ @ @ref{st_oxyd}
- at end table
-
 @node WormholeRange
 @subsection WormholeRange
 
@@ -4167,16 +4244,19 @@
 @menu
 * it_blocker::         Shrinked Blocker Stone
 * it_brush::           
+* it_coin::            Enigma's currency
 * it_cross::           Floor switch for patient Actors
-* it_coin::            Enigma's currency
+* it_death::           Unpassable grid blocker
 * it_extralife::
 * it_floppy::          
 * it_glasses::         Glasses to spot certain objects
 * it_hammer::
 * it_key::             
+* it_landmine::        
 * it_magnet::
 * it_sensor::          Floor Switch for passing Actors
 * it_sword::
+* it_trap::            
 * it_trigger::         Floor Switch for Actors and Stones
 * it_umbrella::        Death Protection Item
 * it_vortex::          Teleport of Marbels
@@ -4361,7 +4441,30 @@
 
 @end table
 
+ at c ----------------- Death Item -------------------- 
+ at node it_death
+ at subsection it_death
+ at obindex it_death
 
+This item shatters any marble that tries to pass the grid. Even jumping marbles
+will be shattered. Just marbles protected by an activated @ref{it_umbrella} can
+pass without taking harm. Apart from that an @samp{it_death} barrier can only be 
+passed by walking around the complete barrier or by warping through an
+ at ref{it_vortex}, an @ref{it_wormhole} or by means of an @ref{it_ring}.
+
+The death item is the most secure barrier object. Comparable objects are
+ at ref{it_booze_broken}, @ref{fl_abyss}, @ref{fl_water}, @ref{it_trap} or simply
+any solid wall of stones. Usually these alternatives should be favored. The
+death item should mainly be used when all other alternatives are too unsecure.
+
+ at table @asis
+
+ at item @b{Attributes:} none
+
+ at item @b{Messages:} none
+
+ at end table
+
 @c ----------------- Extralife Item -------------------- 
 @node it_extralife
 @subsection it_extralife
@@ -4424,16 +4527,15 @@
 Glasses can make invisible @ref{st_death} visible, can uncover invisible
 passages by making hollow stones transparent, can make inactive
 @ref{st_lightpassenger} be distinguishable from @ref{st_glass}, can make
-invisble @ref{it_sensor} be visible and they can make invisble 
- at ref{st_actorimpulse} be visible.
+invisble @ref{it_sensor}, @ref{it_trap} and @ref{st_actorimpulse} be visible.
 
 All these features are configurable by the constants @samp{SPOT_DEATH},
- at samp{SPOT_HOLLOW}, @samp{SPOT_LIGHTPASSENGER}, @samp{SPOT_SENSOR} and
- at samp{SPOT_ACTORIMPULSE}. You can set the @samp{state} attribute to a sum
-of these constants that should apply to given glasses. The default is for 
-backward compatibility @samp{SPOT_DEATH + SPOT_HOLLOW + SPOT_LIGHTPASSENGER}.
-When a player wears several glasses he spots everything that any of the glasses
-could spot.
+ at samp{SPOT_HOLLOW}, @samp{SPOT_LIGHTPASSENGER}, @samp{SPOT_SENSOR}, 
+ at samp{SPOT_TRAP} and @samp{SPOT_ACTORIMPULSE}. You can set the @samp{state} 
+attribute to a sum of these constants that should apply to given glasses. The 
+default is for  backward compatibility 
+ at samp{SPOT_DEATH + SPOT_HOLLOW + SPOT_LIGHTPASSENGER}. When a player wears 
+several glasses he spots everything that any of the glasses could spot.
 
 Glasses break when a stone is pushed over them. Broken glasses spot nothing.
 
@@ -4447,8 +4549,8 @@
 @table @asis
 @item @b{state}, @ @ @i{values}: positive numbers; @ @ @i{default}: @code{SPOT_DEATH + SPOT_HOLLOW + SPOT_LIGHTPASSENGER} @ @ @xref{state}
 A sum of the constants @samp{SPOT_DEATH}, @samp{SPOT_HOLLOW}, 
- at samp{SPOT_LIGHTPASSENGER}, @samp{SPOT_SENSOR}, @samp{SPOT_ACTORIMPULSE}.
- at samp{SPOT_NOTHING} is the state of a broken glasses.
+ at samp{SPOT_LIGHTPASSENGER}, @samp{SPOT_SENSOR}, @samp{SPOT_ACTORIMPULSE},
+ at samp{SPOT_TRAP}. @samp{SPOT_NOTHING} is the state of a broken glasses.
 @end table
 
 @item @b{Messages:} none
@@ -4516,6 +4618,30 @@
 
 @end table
 
+ at c ----------------- Landmine Item -------------------- 
+ at node it_landmine
+ at subsection it_landmine
+ at obindex it_landmine
+
+A static item that explodes on actors stepping onto its critical center part and
+on stones being pushed onto the mine.
+
+The landmine explodes shattering nearby marbles on the same grid and leaves an
+ at ref{it_hollow} behind.
+
+Actors can jump over a landmine and pass carefully between two adjacent 
+landmines without activying the mines. Landmines do neither react on nearby
+explosions, nor fire, nor laserbeams.
+
+ at table @asis
+ at item @b{Attributes:} none
+
+ at item @b{Messages:} none
+
+ at item @b{Action:} none
+
+ at end table
+
 @c ----------------- Magnet Item -------------------- 
 @node it_magnet
 @subsection it_magnet
@@ -4588,8 +4714,15 @@
 Sensors do not cause any noise. Visible sensors will nevertheless flash on
 passing actors. You can make the trigger invisible by setting its attribute. 
 Be aware that the user will still notice that actors cannot drop items onto the
-same grid position.
+same grid position. 
 
+The level author can configure @ref{it_glasses} by addition of 
+ at samp{SPOT_SENSOR} to show invisible sensor items. An actor with such an
+ at ref{it_glasses} in its inventory will be able to spot invisible sensor items.
+With the global attribute @ref{ExtralifeGlasses} even glasses generated by laser
+lighting an @ref{it_extralife} can be configured not to show invisible sensor 
+items.
+
 Alternative objects that react on actors are @ref{it_trigger} and 
 @ref{it_cross}.
 
@@ -4641,6 +4774,46 @@
 
 @end table
 
+ at c ----------------- Trap Item -------------------- 
+ at node it_trap
+ at subsection it_trap
+ at obindex it_trap
+
+A classical trap that is camouflaged by a floor image. Any marble stepping onto
+this trap will break the trap and fall into the trap's abyss. But marbles can
+jump unharmed over a trap. Movable stones can be pushed over a trap without any
+reaction.
+
+Any marble falling into a trap causes it to break and to become visible by the
+remanents of the trap. The trap can be opened by messages, too.
+
+The level author can configure @ref{it_glasses} by addition of 
+ at samp{SPOT_TRAP} to show invisible traps. An actor with such an
+ at ref{it_glasses} in its inventory will be able to spot invisible traps.
+With the global attribute @ref{ExtralifeGlasses} even glasses generated by laser
+lighting an @ref{it_extralife} can be configured not to show invisible traps.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{state}, @ @ @i{values}: @code{CLOSED}, @code{OPEN}; @ @ @i{default}: @code{CLOSED} @ @ @xref{state}
+A @samp{CLOSED} trap is intact and invisible, an @samp{OPEN} trap is broken and
+visible.
+ at end table
+ at item @b{Messages:}
+
+ at table @asis
+ at item @b{signal} @ @ @xref{signal}
+Opens the trap on value @samp{1}
+ at item @b{toggle} @ @ @xref{toggle}
+Opens the trap.
+ at item @b{open} @ @ @xref{open}
+Opens the trap.
+ at end table
+
+ at end table
+
 @c ----------------- Trigger Item -------------------- 
 @node it_trigger
 @subsection it_trigger
@@ -5099,7 +5272,9 @@
 * st_actorimpulse::    Bumper Stone
 * st_blocker::         Shrinkable Blocker
 * st_boulder::         Moving Arrow Boulder
+* st_chess::           Movable Chess Knight Stone
 * st_coinslot::        Coin Driven Switch
+* st_death::           Skull Stone
 * st_floppy::          Floppy Driven Switch
 * st_fourswitch::      Four Direction Switch
 * st_key::             Key Driven Switch
@@ -5107,6 +5282,7 @@
 * st_laserflop::       Lightsensitive Monoflop
 * st_laserswitch::     Lightsensitive Switch
 * st_lightpassenger::  Stone pushed by Light
+* st_mirror::          Mirrors of all flavors
 * st_monoflop::        Monoflop Switch
 * st_oxyd::            Game Target Stone
 * st_polarswitch::     Transparency Switch for Light Beams
@@ -5325,6 +5501,69 @@
 
 @end table
 
+ at c ----------------- Chess Stone -------------------- 
+ at node st_chess
+ at subsection st_chess
+ at obindex st_chess
+
+A chess stone is like a chess knight. It exists in the two colors black and
+white, it can jump and make a chess knight move. It can even beat stones at
+the target position.
+
+A black chess can only be moved with a black marble, a white one with white
+marbles. The jump direction is given by the marble hit direction. It moves
+two grid steps into the direction, into which other movable stones move just one
+grid, plus one grid step vertical. The vertical direction is given by the
+marbles vertical velocity component.
+
+When there is a chess stone of opposite color or an @ref{st_thief} at the target
+position of a knight move, this stone is captured and destroyed.
+
+When hit with a revealed @ref{it_wand}, a chess stone changes color. 
+
+Chess stones fall into @ref{fl_abyss} and sink in @ref{fl_swamp}, but cross
+ at ref{fl_water} undamaged. 
+
+A chess stone that jumps onto a @ref{fl_thief} captures and inactivates the 
+thief.
+
+Chess stones can't jump over or into fire (see The 1.0-Fire System). At least, 
+a chess knight is brave enough not to panic when fire starts to burn beneath. 
+Note that fire can't ignite the floor below a chess stone. In this
+context it acts like an immovable stone. In the same sense, they don't act on 
+stone impulses of @ref{st_stoneimpulse} or @ref{it_puller}. 
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{color} @ @ @i{values}: @code{BLACK}, @code{WHITE}; @ @ @i{default}: @code{BLACK}
+The color of the chess stone
+ at item @b{movable} @ @ @i{values}: @code{true}; @ @ @i{default}: @code{true} @ @ @xref{movable}
+Read only attribute that states the movability of a chess stone.
+ at end table
+
+ at item @b{Messages:}
+
+ at table @asis
+ at item @b{flip}
+Flip the color of the stone.
+ at item @b{move}, @ @ @i{value type}: position; @ @ @i{values}: @code{NNE}, @code{NEE}, @code{SEE}, @code{SSE}, @code{SSW}, @code{SWW}, @code{NWW}, @code{NNW}
+Jump into the given dirction.
+ at end table
+
+ at item @b{Action:}  none
+
+ at item @b{Variants:}
+
+ at table @asis
+ at item @b{st_chess}: color = @code{BLACK}
+ at item @b{st_chess_black}: color = @code{BLACK}
+ at item @b{st_chess_white}: color = @code{WHITE}
+ at end table
+
+ at end table
+
 @c ----------------- Coinslot Stone -------------------- 
 @node st_coinslot
 @subsection st_coinslot
@@ -5383,6 +5622,54 @@
 
 @end table
 
+ at c ----------------- Death Stone -------------------- 
+ at node st_death
+ at subsection st_death
+ at obindex st_death
+
+Shatters any marble that hits or even just touches it. Just marbles protected
+by an activated @ref{it_umbrella} will bounce unharmed as other actors do which
+will not die anyway.
+
+Death stones can be configured by the @samp{invisible} attribute to
+be hidden while being idle. When hit by an actor any death stone becomes
+temporary visible. An actor with unbroken standard @ref{it_glasses} in its
+inventory will be able to spot invisible death stones.
+
+The level author can configure @ref{it_glasses} by elimination of 
+ at samp{SPOT_DEATH} not to show invisible death stones. With the global attribute
+ at ref{ExtralifeGlasses} even glasses generated by laser lighting an 
+ at ref{it_extralife} can be configured not to show invisible actorimpulse stones.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{state}, @ @ @i{values}: @code{ON}, @code{OFF}; @ @ @i{default}: @code{OFF}; @i{access}: @code{read only}  @ @ @xref{state}
+Current activity state of the death stone. A stone is usually activated by
+a hitting actor.
+ at item @b{invisible} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+Invisible death stones show only when hit by an actor or been toggled by a message.
+
+ at item @b{Messages:}
+ at table @asis
+ at item @b{toggle} @ @ @xref{toggle}
+Temporarily activy the stone to show its animation and to get visible for this
+period.
+ at end table
+
+ at item @b{Action:} none
+
+ at item @b{Variants:}
+
+ at table @asis
+ at item @b{st_death}: invisible = @code{false}
+ at item @b{st_death_invisible}: invisible = @code{true}
+ at end table
+
+ at end table
+
+
 @c ----------------- Floppy Stone -------------------- 
 @node st_floppy
 @subsection st_floppy
@@ -5741,6 +6028,92 @@
 
 @end table
 
+ at c ----------------- Mirror Stone -------------------- 
+ at node st_mirror
+ at subsection st_mirror
+ at obindex st_mirror
+
+Mirror stones redirect and fork laser beams. They exist in different shapes.
+You can set the shape by the attribute @samp{flavor} or by using the 
+appropriate subkind. There are two planar versions called @samp{slab} and 
+ at samp{sheets}, and a @samp{triangle} version.
+
+The mirror panes can either be non-transparent or semi-transparent. Even though
+you set this feature with the attribute @samp{transparent} you should be aware
+that even with a value of @samp{true} the mirror is not fully transparent. E.g.
+a @samp{slab} mirror will block any laser light that is parallel to its shape
+as the short ends are no mirrors at all. For this reason we provide the second
+planar version called @samp{sheets}, which lets light parallel to its sheets
+pass.
+
+Mirrors hit by an actor or impulsed by an @ref{st_stoneimpulse} will move if
+their attribute @samp{movable} is set to true. Mirrors that are not movable
+will differ slightly in a darker color.
+
+Mirros hit or just touched will turn their mirror panes by 90 degrees. The 
+standard turning direction is clockwise. But this standard can be changed with
+by the attribute @samp{counterclockwise}. An @ref{st_boulder} hitting a mirror
+will turn it in its standard direction, too.
+
+A mirror can be turned into the opposite direction either by a message 
+ at samp{turnback} or by an actor with a revealed @ref{it_wrench} in its 
+inventory.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{flavor} @ @ @i{values}: @code{"slab"}, @code{"sheets"}, @code{"triangle"}; @ @ @i{default}: @code{"slab"}
+Mirror panes either set up as an triangle or as a side intransparent slab or
+as a mandatory semi-transparent pair of sheets.
+ at item @b{state}, @ @ @i{values}: @code{NORTH}, @code{EAST}, @code{SOUTH}, @code{WEST}; @ @ @i{default}: @code{NORTH}; @ @ @xref{state}
+The orientation of the mirror. For a triangle mirror it is the triangles 
+pointing direction. For a planar mirror it the reflection direction of an 
+incoming northbound beam.
+ at item @b{orientation}, @ @ @i{values}: @code{NORTH}, @code{EAST}, @code{SOUTH}, @code{WEST}; @ @ @i{default}: @code{NORTH}
+The orientation of the mirror. For a triangle mirror it is the triangles 
+pointing direction. For a planar mirror it the reflection direction of an 
+incoing northbound beam.
+ at item @b{transparent} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+Semitransparency of the mirror panes.
+ at item @b{movable} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false} @ @ @xref{movable}
+Movability on actor hits and stone impulses.
+ at item @b{counterclockwise} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+The standard turning direction is clockwise. Use this attribute to revert the
+direction.
+ at end table
+
+ at item @b{Messages:}
+
+ at table @asis
+ at msindex orientate
+ at item @b{orientate}, @ @ @i{value type}: direction
+Change the orientation to the given direction value. The @ref{st_fourswitch}
+provides a compatible action which allows you to set a boulder as
+target and this message as action.
+ at item @b{turn}
+Turn the orientation in turning direction as defined by attribute 
+ at samp{counterclockwise}.
+ at item @b{turnback}
+Turn the orientation in opposite turning direction as defined by attribute 
+ at samp{counterclockwise}.
+ at item @b{signal} @ @ @xref{signal}
+Turn the orientation in turning direction as defined by attribute 
+ at samp{counterclockwise} on at value @samp{1}. A values of @samp{0} is ignored.
+
+ at end table
+
+ at item @b{Action:} none
+
+ at table @asis
+ at item @b{st_mirror}: flavor=@code{slab}, state = @code{NORTH}
+ at item @b{st_mirror_slab}: flavor=@code{slab}, state = @code{NORTH}
+ at item @b{st_mirror_sheets}: flavor=@code{sheets}, state = @code{NORTH}
+ at item @b{st_mirror_triangle}: flavor=@code{triangle}, state = @code{NORTH}
+ at end table
+
+ at end table
+
 @c ----------------- Monoflop Stone -------------------- 
 @node st_monoflop
 @subsection st_monoflop
@@ -6199,6 +6572,7 @@
 @menu 
 * World Advanced Methods::  Additional features provided by the world
 * Resolvers::               Standard tools for interpretation of tile maps
+* General Features::        Special features by various objects
 * Tips and Tricks::         Simple patterns that are valuable like a feature
 @end menu
 
@@ -6896,7 +7270,136 @@
 
 @end table
 
+ at node General Features
+ at section General Features
 
+ at menu 
+* Display Follow Strategy::    How the display view follows the active marble
+* Fire Spreading::
+* Freeze Checking::
+ at end menu
+
+ at node Display Follow Strategy
+ at subsection Display Follow Strategy
+
+As the world can be larger than a display screen the active marble can move
+out of the area that is visible at level start. Somehow the display has to
+follow the active marble. 
+
+Whereas prior Enigma versions did provide just a handful of fixed modes, future
+versions will give you a much more detailed control of the display following 
+strategy. We decided to switch the configuration to the future parameters
+already now. This allows us to give you some more follower control, even though
+some attributes are still limited in their values.
+
+The strategy is described by the following parameters.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @ref{FollowGrid}
+ at item @ref{FollowMethod}
+ at item @ref{FollowThreshold}
+ at item @ref{FollowAction}
+
+ at end table
+
+ at item @b{Syntax Samples:}
+ at example
+wo["FollowGrid"] = true
+wo["FollowMethod"] = FOLLOW_SCROLL
+ at end example
+
+ at item @b{Details:}
+The attributes should always be set in the sequence as given above. This is due
+to the fact that the first attributes may reset some of the later attributes
+to matching defaults. This way you will have to set just a two attributes for
+the most common cases.
+
+You can set the display follow strategy at any point. You are even allowed to
+switch the strategy during the running game.
+
+ at item @b{Valid Configurations as of Enigma 1.10:}
+
+ at table @asis
+ at item @b{Screen Flipping:}
+ at example
+wo["FollowGrid"] = true
+wo["FollowMethod"] = FOLLOW_FLIP
+ at end example
+The default strategy. The screen flips as soon as the marble reaches the outer
+half of the boundary grid tile. The screen moves by a full screen minus the
+common tile row or column.
+
+ at item @b{Half Screen Scrolling:}
+ at example
+wo["FollowGrid"] = true
+wo["FollowMethod"] = FOLLOW_SCROLL
+wo["FollowAction"] = FOLLOW_HALFSCREEN
+ at end example
+As soon as the marble reaches the outer half of the boundary grid tile the
+display scrolls pixel by pixel by half a screen. It realigns to the grid. As
+on a standard sized screen the display would have to scroll 9.5 grids in 
+horizontal direction such scrolls will alternate in scrolls of 9 and 10 grids.
+The follower will try to stabilize the reachable scroll positions.
+
+ at item @b{Permanent Smooth Scrolling:}
+ at example
+wo["FollowGrid"] = false
+wo["FollowMethod"] = FOLLOW_SCROLL
+ at end example
+The active actor will always stay in the center of the screen. The display
+compensates the actors movement pixel by pixel by scrolling. The display 
+positions are not aligned to grid tiles.
+
+ at item @b{Full Screen Scrolling:}
+ at example
+wo["FollowGrid"] = true
+wo["FollowMethod"] = FOLLOW_SCROLL
+wo["FollowAction"] = FOLLOW_FULLSCREEN
+ at end example
+As soon as the marble reaches the outer half of the boundary grid tile the
+display scrolls pixel by pixel by a full screen minus the common tile row or
+column.
+
+ at item @b{No Screen Scrolling:}
+ at example
+wo["FollowMethod"] = FOLLOW_NO
+ at end example
+No scrolling at all. Even if the active actor moves out of sight the display
+remains at its position.
+
+ at item @b{Screen Flipping at a given threshold:}
+ at example
+wo["FollowGrid"] = true
+wo["FollowMethod"] = FOLLOW_FLIP
+wo["FollowThreshold"] = po(2.5, 1.5)
+ at end example
+The screen flips as soon as the marble reaches the given distance to the screen
+boundary. The screen moves by a full screen minus twice the threshold distance.
+The final display realigns to the grid even on odd threshold distances.
+
+ at item @b{Full Screen Scrolling at a given threshold:}
+ at example
+wo["FollowGrid"] = true
+wo["FollowMethod"] = FOLLOW_SCROLL
+wo["FollowThreshold"] = po(2.5, 1.5)
+ at end example
+The screen scrolls as soon as the marble reaches the given distance to the screen
+boundary. The screen moves by a full screen minus twice the threshold distance.
+The final display realigns to the grid even on odd threshold distances.
+ at end table
+
+ at end table
+
+ at node Fire Spreading
+ at subsection Fire Spreading
+
+ at node Freeze Checking
+ at subsection Freeze Checking
+
+
 @node Tips and Tricks
 @section Tips and Tricks
 
@@ -6918,7 +7421,7 @@
 
 @example
 ti["F"] = @{"st_floppy", target="@@door#*"@}
-ti["D"] = @{"st_blocker", name="door#"@}
+ti["B"] = @{"st_blocker", name="door#"@}
 wo{ti, " ", {
 "       B            ",
 "       FB#####FB####",
@@ -6936,9 +7439,9 @@
 
 @example
 ti["F"] = @{"st_floppy", target="@@doorA#*"@}
-ti["D"] = @{"st_blocker", name="doorA#"@}
+ti["B"] = @{"st_blocker", name="doorA#"@}
 ti["f"] = @{"st_floppy", target="@@doorB#*"@}
-ti["d"] = @{"st_blocker", name="doorB#"@}
+ti["b"] = @{"st_blocker", name="doorB#"@}
 wo{ti, " ", {
 "       b            ",
 "       fB#####fb####",



From ral at mail.berlios.de  Sun Jun 29 20:13:46 2008
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sun, 29 Jun 2008 20:13:46 +0200
Subject: [Enigma-game-svn] r1202 - trunk/src
Message-ID: <200806291813.m5TIDkQj010848@sheep.berlios.de>

Author: ral
Date: 2008-06-29 20:13:38 +0200 (Sun, 29 Jun 2008)
New Revision: 1202

Modified:
   trunk/src/items.cc
   trunk/src/items.hh
Log:
Trunk 1.1: new API reengineering
- Strip item: first partial implementaion
  - 16 variations: it_strip, it_strip_w,... it_strip_nesw 
  - correct physics in width and height
- fix: potential memory smasher on shutdown caused by it_sensor
Note:
- stip uses bluesand images (edit getModelName() to set it to it_strip0...)
- objects.xml declarations missing
- it-hstrip, it-vstrip mappings to new strip still missing


Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-06-29 13:52:46 UTC (rev 1201)
+++ trunk/src/items.cc	2008-06-29 18:13:38 UTC (rev 1202)
@@ -3280,8 +3280,8 @@
     }
 
     ItemTraits Sensor::traits[4] = {
-        {"it_sensor",  it_sensor,  itf_static},
-        {"it_sensor",  it_inversesensor,  itf_static},
+        {"it_sensor",  it_sensor,  itf_static}, 
+        {"it_sensor_inverse",  it_inversesensor,  itf_static},
         {"it_sensor_filter1", it_signalfilter1, itf_static | itf_invisible, 0.0},  // DAT only
         {"it_sensor_filter0", it_signalfilter0, itf_static | itf_invisible, 0.0}   // DAT only
     };
@@ -3839,7 +3839,7 @@
     DEF_TRAITS(Pencil, "it-pencil", it_pencil);
 }
 
-/* -------------------- it-death -------------------- */
+/* -------------------- Death Item  -------------------- */
     class DeathItem : public Item {
         CLONEOBJ(DeathItem);
         DECL_TRAITS;
@@ -3877,7 +3877,115 @@
     
     DEF_TRAITSF(DeathItem, "it_death", it_death, itf_static | itf_indestructible);
 
+/* -------------------- Strip Items  -------------------- */
+    class StripItem : public Item {
+        CLONEOBJ(StripItem);
+        DECL_TRAITS_ARRAY(16, traitsIdx());
+        
+    public:
+        static void setup();
+                
+        StripItem(std::string connections);
+        
+        // Object interface
+        virtual std::string getClass() const;
 
+        // StateObject interface
+        virtual void setState(int extState);
+        
+        // GridObject interface
+        virtual std::string getModelName() const;
+        virtual void init_model();
+                
+        // Items interface
+        virtual bool covers_floor(ecl::V2 pos) const;
+        
+    private:
+        int traitsIdx() const;
+    };
+    
+    
+    void StripItem::setup() {
+        RegisterItem(new StripItem(""));
+        RegisterItem(new StripItem("w"));
+        RegisterItem(new StripItem("s"));
+        RegisterItem(new StripItem("sw"));
+        RegisterItem(new StripItem("e"));
+        RegisterItem(new StripItem("ew"));
+        RegisterItem(new StripItem("es"));
+        RegisterItem(new StripItem("esw"));
+        RegisterItem(new StripItem("n"));
+        RegisterItem(new StripItem("nw"));
+        RegisterItem(new StripItem("ns"));
+        RegisterItem(new StripItem("nsw"));
+        RegisterItem(new StripItem("ne"));
+        RegisterItem(new StripItem("new"));
+        RegisterItem(new StripItem("nes"));
+        RegisterItem(new StripItem("nesw"));
+    }
+    
+    StripItem::StripItem(std::string connections) {
+        setAttr("connections", connections);
+    }
+        
+    std::string StripItem::getClass() const {
+        return "it_strip";
+    }
+    
+    void StripItem::setState(int extState) {
+        // block state set
+    }
+    
+    std::string StripItem::getModelName() const {
+//        return getClass();
+        return "st_bluesand";
+    }
+    
+    void StripItem::init_model() {
+        // need to bypass Item's implementation
+        GridObject::init_model();
+    }
+
+    bool StripItem::covers_floor(ecl::V2 pos) const {
+        if (GridPos(pos) != get_pos())
+            return false;
+
+        const double MAXDIST = 6.0/32;
+        
+        double ycenter = get_pos().y + 0.5;
+        double xcenter = get_pos().x + 0.5;
+        DirectionBits cbits = getConnections();
+        
+        return (((fabs(pos[1] - ycenter) <= MAXDIST) 
+                && (((pos[0] <= xcenter) && (cbits & WESTBIT)) || ((pos[0] >= xcenter) && (cbits & EASTBIT))))
+                || ((fabs(pos[0] - xcenter) <= MAXDIST) 
+                && (((pos[1] <= ycenter) && (cbits & NORTHBIT)) || ((pos[1] >= ycenter) && (cbits & SOUTHBIT)))))
+                ? true : false;
+    }
+        
+    int StripItem::traitsIdx() const {
+        return getConnections();
+    }
+
+    ItemTraits StripItem::traits[16] = {
+        {"it_strip",  it_strip,  itf_static},
+        {"it_strip_w",  it_strip_w,  itf_static},
+        {"it_strip_s",  it_strip_s,  itf_static},
+        {"it_strip_sw",  it_strip_sw,  itf_static},
+        {"it_strip_e",  it_strip_e,  itf_static},
+        {"it_strip_ew",  it_strip_ew,  itf_static},
+        {"it_strip_es",  it_strip_es,  itf_static},
+        {"it_strip_esw",  it_strip_esw,  itf_static},
+        {"it_strip_n",  it_strip_n,  itf_static},
+        {"it_strip_nw",  it_strip_nw,  itf_static},
+        {"it_strip_ns",  it_strip_ns,  itf_static},
+        {"it_strip_nsw",  it_strip_nsw,  itf_static},
+        {"it_strip_ne",  it_strip_ne,  itf_static},
+        {"it_strip_new",  it_strip_new,  itf_static},
+        {"it_strip_nes",  it_strip_nes,  itf_static},
+        {"it_strip_nesw",  it_strip_nesw,  itf_static}
+    };
+
 /* -------------------- HStrip and VStrip -------------------- */
 namespace
 {
@@ -4186,6 +4294,7 @@
     RegisterItem (new Spring2);
     RegisterItem (new Springboard);
     RegisterItem (new Squashed);
+    StripItem::setup();
     RegisterItem (new SurpriseItem);
     RegisterItem (new Sword(false));
     Register ("it_sword_new", new Sword(true));

Modified: trunk/src/items.hh
===================================================================
--- trunk/src/items.hh	2008-06-29 13:52:46 UTC (rev 1201)
+++ trunk/src/items.hh	2008-06-29 18:13:38 UTC (rev 1202)
@@ -115,6 +115,22 @@
         it_spring2,
         it_springboard,
         it_squashed,
+        it_strip,
+        it_strip_w,
+        it_strip_s,
+        it_strip_sw,
+        it_strip_e,
+        it_strip_ew,
+        it_strip_es,
+        it_strip_esw,
+        it_strip_n,
+        it_strip_nw,
+        it_strip_ns,
+        it_strip_nsw,
+        it_strip_ne,
+        it_strip_new,
+        it_strip_nes,
+        it_strip_nesw,
         it_surprise,
         it_sword,
         it_tinyhill,



