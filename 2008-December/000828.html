<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1399 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/stones
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2008-December/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1399%20-%20in%20trunk%3A%20data%20data/gfx32%20data/gfx40%0A%09data/gfx48%20data/schemas%20src%20src/stones&In-Reply-To=%3C200812172344.mBHNijdo022481%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000827.html">
   <LINK REL="Next"  HREF="000829.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1399 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/stones</H1>
    <B>ral at BerliOS</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1399%20-%20in%20trunk%3A%20data%20data/gfx32%20data/gfx40%0A%09data/gfx48%20data/schemas%20src%20src/stones&In-Reply-To=%3C200812172344.mBHNijdo022481%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1399 - in trunk: data data/gfx32 data/gfx40	data/gfx48 data/schemas src src/stones">ral at mail.berlios.de
       </A><BR>
    <I>Thu Dec 18 00:44:45 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000827.html">[Enigma-game-svn] r1398 - homepage/input
</A></li>
        <LI>Next message: <A HREF="000829.html">[Enigma-game-svn] r1400 - trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#828">[ date ]</a>
              <a href="thread.html#828">[ thread ]</a>
              <a href="subject.html#828">[ subject ]</a>
              <a href="author.html#828">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ral
Date: 2008-12-18 00:44:42 +0100 (Thu, 18 Dec 2008)
New Revision: 1399

Added:
   trunk/data/gfx32/st_flash.png
   trunk/data/gfx40/st_flash.png
   trunk/data/gfx48/st_flash.png
   trunk/src/stones/CompatibilityStones.cc
   trunk/src/stones/CompatibilityStones.hh
   trunk/src/stones/FakeStone.cc
   trunk/src/stones/FakeStone.hh
   trunk/src/stones/QuakeStone.cc
   trunk/src/stones/QuakeStone.hh
   trunk/src/stones/SimpleStones.cc
   trunk/src/stones/SimpleStones.hh
Removed:
   trunk/data/gfx32/st-flash.png
   trunk/data/gfx40/st-flash.png
   trunk/data/gfx48/st-flash.png
   trunk/src/stones/FartStone.cc
   trunk/src/stones/FartStone.hh
Modified:
   trunk/data/api1init.lua
   trunk/data/api2init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/data/startup.lua
   trunk/src/Makefile.am
   trunk/src/ox_magnum.cc
   trunk/src/ox_oxyd1.cc
   trunk/src/ox_peroxyd.cc
   trunk/src/stones.cc
   trunk/src/stones.hh
   trunk/src/stones/ChessStone.cc
   trunk/src/stones/OxydStone.cc
   trunk/src/stones/OxydStone.hh
   trunk/src/stones_simple.cc
Log:
Trunk 1.1: new API reengineering
- renaming of &quot;fart&quot; to &quot;quake&quot;:
  - st_fart to st_quake
  - class QuakeStone
  - OxydStone color QUAKE
- new class &quot;st_fake&quot;:
  - &quot;st_fake_quake&quot; as successor of &quot;st-fakeoxyd&quot;
  - &quot;st_fake_oxyda&quot; to &quot;st_fake_oxyde&quot; as successor of &quot;st-likeoxyda&quot;,...
  - attribute flavor with suffix
  - attribute state with IDLE/ACTIVE for quake, CLOSED/OPEN for oxyds
- renaming of &quot;st-flash&quot; to &quot;st_flash&quot;
- code cleanup:
  - file CompatibilityStones for stones not used in Enigma mode
  - file SimpleStones for very simple implemented stones
  - remove obsolete ExplosionStone


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/data/api1init.lua	2008-12-17 23:44:42 UTC (rev 1399)
@@ -165,9 +165,14 @@
     st_door_a = &quot;st-door_a&quot;,
     st_door_b = &quot;st-door_b&quot;,
     st_door_c = &quot;st-door_c&quot;,
-    st_fart = &quot;st-fart&quot;,
+    st_fake_quake = &quot;st-fakeoxyd&quot;,
+    st_fake_oxyda = &quot;st-likeoxyda&quot;,
+    st_fake_oxydb = &quot;st-likeoxydb&quot;,
+    st_fake_oxydc = &quot;st-likeoxydc&quot;,
+    st_fake_oxydd = &quot;st-likeoxydd&quot;,
+    st_flash = &quot;st-flash&quot;,
+    st_flhay = &quot;st-flhay&quot;,
     st_floppy = &quot;st-floppy&quot;,
-    st_flhay = &quot;st-flhay&quot;,
     st_flrock = &quot;st-flrock&quot;,
     st_fourswitch = &quot;st-fourswitch&quot;,
     st_knight = &quot;st-knight&quot;,
@@ -278,6 +283,7 @@
     st_puzzle_yellow_nes = &quot;st-puzzle2-nes&quot;,
     st_puzzle_yellow_nesw = &quot;st-puzzle2-nesw&quot;,
     st_puzzle_yellow_nesw_hollow = &quot;st-puzzle2-hollow&quot;,
+    st_quake = &quot;st-fart&quot;,
     st_rotator_cw = &quot;st-rotator-right&quot;,
     st_rotator_ccw = &quot;st-rotator-left&quot;,
     st_rotator_cw_movable = &quot;st-rotator_move-right&quot;,
@@ -422,8 +428,23 @@
         enigma._SetAttrib(obj, &quot;faces&quot;, &quot;ew&quot;)
         enigma._SetAttrib(obj, &quot;state&quot;, 1)
         return obj
-    end
-    
+    elseif name == &quot;st-likeoxyda-open&quot; then
+        local obj = enigma._MakeObject(&quot;st_fake_oxyda&quot;)
+        enigma._SetAttrib(obj, &quot;state&quot;, 1)
+        return obj
+    elseif name == &quot;st-likeoxydb-open&quot; then
+        local obj = enigma._MakeObject(&quot;st_fake_oxydb&quot;)
+        enigma._SetAttrib(obj, &quot;state&quot;, 1)
+        return obj
+    elseif name == &quot;st-likeoxydc-open&quot; then
+        local obj = enigma._MakeObject(&quot;st_fake_oxydc&quot;)
+        enigma._SetAttrib(obj, &quot;state&quot;, 1)
+        return obj
+    elseif name == &quot;st-likeoxydd-open&quot; then
+        local obj = enigma._MakeObject(&quot;st_fake_oxydd&quot;)
+        enigma._SetAttrib(obj, &quot;state&quot;, 1)
+        return obj
+    end    
     newname = RenamingObjectsOld2New[name]
     
     if name == &quot;st-laser&quot; then
@@ -636,6 +657,9 @@
      if key == &quot;mousefactor&quot; then
          _key = &quot;adhesion&quot;
      end
+     if key == &quot;blinking&quot; then
+         _key = &quot;state&quot;
+     end
      enigma._SetAttrib(obj, _key, _val)
 end
 
@@ -679,6 +703,9 @@
      if key == &quot;on&quot; then
          _key = &quot;state&quot;
      end
+     if key == &quot;blinking&quot; then
+         _key = &quot;state&quot;
+     end
      if key == &quot;type&quot; and _obj_name == &quot;st-door&quot; then
          local faces = enigma._GetAttrib(obj, &quot;faces&quot;)
          if faces == &quot;ns&quot; then val = &quot;h&quot; else val = &quot;v&quot; end

Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/data/api2init.lua	2008-12-17 23:44:42 UTC (rev 1399)
@@ -100,7 +100,7 @@
 OXYD_BROWN  = 11
 OXYD_AUTO   = -1
 OXYD_FAKE   = -2
-OXYD_FART   = -3
+OXYD_QUAKE  = -3
 OXYD_BOLD   = -4
 
 -- direction

Deleted: trunk/data/gfx32/st-flash.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx32/st_flash.png (from rev 1398, trunk/data/gfx32/st-flash.png)

Deleted: trunk/data/gfx40/st-flash.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/st_flash.png (from rev 1398, trunk/data/gfx40/st-flash.png)

Deleted: trunk/data/gfx48/st-flash.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/st_flash.png (from rev 1398, trunk/data/gfx48/st-flash.png)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/data/models-2d.lua	2008-12-17 23:44:42 UTC (rev 1399)
@@ -943,8 +943,8 @@
 
 -- st-flash --
 do
-    local images = DefSubimages(&quot;st-flash&quot;, {h=1})
-    DefSolidStone(&quot;st-flash&quot;, &quot;st-flash1&quot;)
+    local images = DefSubimages(&quot;st_flash&quot;, {h=1})
+    DefSolidStone(&quot;st_flash&quot;, &quot;st_flash1&quot;)
 end
 
 -- st-fourswitch --
@@ -1511,6 +1511,8 @@
         DefAlias(&quot;st-oxyde&quot;..color..&quot;-open&quot;, &quot;st-oxydb&quot;..color..&quot;-open&quot;)
     end
     DefAlias(&quot;st-oxyde&quot;, &quot;st-oxydb&quot;)
+    DefAlias(&quot;st-likeoxyde&quot;, &quot;st-oxydb&quot;)
+    DefAlias(&quot;st-likeoxyde-open&quot;, &quot;st-likeoxydb-open&quot;)
     DefAlias(&quot;st-oxyde-3-opening&quot;, &quot;st-oxydb-3-opening&quot;)
     DefAlias(&quot;st-oxyde-pseudo-3&quot;, &quot;st-oxydb-pseudo-3&quot;)
     DefAlias(&quot;st-oxyde-3-closing&quot;, &quot;st-oxydb-3-closing&quot;)
@@ -1583,13 +1585,8 @@
     DefAnim(&quot;st-door_c-closing&quot;, ReverseFrames(frames))
 end
 
--- st-fakeoxyd --
+-- st-fakeoxyda --
 do
-    DefStone(&quot;st-fakeoxyd&quot;, &quot;sh-round&quot;, {filename=&quot;st-oxydb&quot;})
-    DefAnimImages(&quot;fakeoxyd-blink&quot;,
-        RepeatAnim(PingPong(BuildFrames(FrameNames(&quot;st-fakeoxyd-blink&quot;, 1,4),50))))
-    DefRoundStone(&quot;st-fakeoxyd-blink&quot;, &quot;fakeoxyd-blink&quot;)
-
     DefAlias(&quot;st-fakeoxyda&quot;, &quot;st-oxyda&quot;)
 end
 

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/data/schemas/objects.xml	2008-12-17 23:44:42 UTC (rev 1399)
@@ -734,27 +734,49 @@
     &lt;object name=&quot;st_door_d&quot;&gt;
       &lt;attr name=&quot;flavor&quot; value=&quot;d&quot;/&gt;
     &lt;/object&gt;
-    &lt;object name=&quot;st_fart&quot; states=&quot;3&quot;&gt;
-      &lt;msg name=&quot;ignite&quot;/&gt;
-      &lt;msg name=&quot;signal&quot;/&gt;
-      &lt;msg name=&quot;_explosion&quot;/&gt;
-      &lt;msg name=&quot;_trigger&quot;/&gt;
+    &lt;object name=&quot;st_fake&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; default=&quot;quake&quot;/&gt;
     &lt;/object&gt;
+    &lt;object name=&quot;st_fake_quake&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;quake&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_fake_oxyda&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;oxyda&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_fake_oxydb&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;oxydb&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_fake_oxydc&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;oxydc&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_fake_oxydd&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;oxydd&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_fake_oxyde&quot;&gt;
+      &lt;attr name=&quot;flavor&quot; value=&quot;oxyde&quot;/&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_flash&quot;&gt;
+      &lt;attr name=&quot;hit_factor&quot;/&gt;
+      &lt;attr name=&quot;hit_distortion_xx&quot;/&gt;
+      &lt;attr name=&quot;hit_distortion_xy&quot;/&gt;
+      &lt;attr name=&quot;hit_distortion_yx&quot;/&gt;
+      &lt;attr name=&quot;hit_distortion_yy&quot;/&gt;
+    &lt;/object&gt;
     &lt;object name=&quot;st_flhay&quot;&gt;
       &lt;msg name=&quot;fire&quot;/&gt;
       &lt;msg name=&quot;heat&quot;/&gt;
       &lt;msg name=&quot;fall&quot;/&gt;
     &lt;/object&gt;
+    &lt;object name=&quot;st_floppy&quot;&gt;
+      &lt;msg name=&quot;on&quot;/&gt;
+      &lt;msg name=&quot;off&quot;/&gt;
+      &lt;msg name=&quot;signal&quot;/&gt;
+    &lt;/object&gt;
     &lt;object name=&quot;st_flrock&quot;&gt;
       &lt;msg name=&quot;fire&quot;/&gt;
       &lt;msg name=&quot;heat&quot;/&gt;
       &lt;msg name=&quot;fall&quot;/&gt;
     &lt;/object&gt;
-    &lt;object name=&quot;st_floppy&quot;&gt;
-      &lt;msg name=&quot;on&quot;/&gt;
-      &lt;msg name=&quot;off&quot;/&gt;
-      &lt;msg name=&quot;signal&quot;/&gt;
-    &lt;/object&gt;
     &lt;object name=&quot;st_fourswitch&quot; states=&quot;4&quot;&gt;
       &lt;attr name=&quot;counterclock&quot;/&gt;
       &lt;action type=&quot;dir&quot; statetype=&quot;bool&quot;/&gt;
@@ -987,7 +1009,13 @@
     &lt;/object&gt;
     &lt;object name=&quot;st_puzzle_yellow&quot;&gt;
       &lt;attr name=&quot;color&quot; value=&quot;3&quot;/&gt;
-   &lt;/object&gt;
+    &lt;/object&gt;
+    &lt;object name=&quot;st_quake&quot; states=&quot;3&quot;&gt;
+      &lt;msg name=&quot;ignite&quot;/&gt;
+      &lt;msg name=&quot;signal&quot;/&gt;
+      &lt;msg name=&quot;_explosion&quot;/&gt;
+      &lt;msg name=&quot;_trigger&quot;/&gt;
+    &lt;/object&gt;
     &lt;object name=&quot;st_rotator&quot;&gt;
       &lt;attr name=&quot;counterclock&quot;/&gt;
       &lt;attr name=&quot;movable&quot; rw=&quot;rw&quot;/&gt;

Modified: trunk/data/startup.lua
===================================================================
--- trunk/data/startup.lua	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/data/startup.lua	2008-12-17 23:44:42 UTC (rev 1399)
@@ -161,14 +161,6 @@
 def_stone_hollow(&quot;st-glass2_hole&quot;)
 def_stone_glass(&quot;st-glass3&quot;)
 
-function mkoxydlikes(flavor)
-   def_stone(&quot;st-likeoxyd&quot;..flavor)
-   def_stone(&quot;st-likeoxyd&quot;..flavor..&quot;-open&quot;)
-end
-mkoxydlikes(&quot;a&quot;)
-mkoxydlikes(&quot;b&quot;)
-mkoxydlikes(&quot;c&quot;)
-mkoxydlikes(&quot;d&quot;)
 
 ------------------------------
 -- Define the simple floors --

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/Makefile.am	2008-12-17 23:44:42 UTC (rev 1399)
@@ -262,14 +262,16 @@
 	stones/ClusterStone.hh	\
 	stones/CoinSlot.cc	\
 	stones/CoinSlot.hh	\
+	stones/CompatibilityStones.cc	\
+	stones/CompatibilityStones.hh	\
 	stones/DeathStone.cc	\
 	stones/DeathStone.hh	\
 	stones/DiscoStone.cc	\
 	stones/DiscoStone.hh	\
 	stones/Door.cc		\
 	stones/Door.hh		\
-	stones/FartStone.cc	\
-	stones/FartStone.hh	\
+	stones/FakeStone.cc	\
+	stones/FakeStone.hh	\
 	stones/FloorBuilder.cc	\
 	stones/FloorBuilder.hh	\
 	stones/FloppySwitch.cc	\
@@ -304,6 +306,8 @@
 	stones/PullStone.hh	\
 	stones/PuzzleStone.cc	\
 	stones/PuzzleStone.hh	\
+	stones/QuakeStone.cc	\
+	stones/QuakeStone.hh	\
 	stones/RotatorStone.cc	\
 	stones/RotatorStone.hh	\
 	stones/RubberbandStone.cc	\
@@ -312,6 +316,8 @@
 	stones/ScissorsStone.hh	\
 	stones/ShogunStone.cc	\
 	stones/ShogunStone.hh	\
+	stones/SimpleStones.cc	\
+	stones/SimpleStones.hh	\
 	stones/StoneImpulse.cc	\
 	stones/StoneImpulse.hh	\
 	stones/SwapStone.cc	\

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/ox_magnum.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -133,7 +133,7 @@
     0,                          // OxydMagnum stone 0x00
     0,0,0,0,0,0,0,0,            // 0x01 -- 0x08  Oxyd stones
     0,0,0,0,0,0,0,0,            // 0x09 -- 0x10  Oxyd stones
-    &quot;st-likeoxydd&quot;,             // OxydMagnum stone 0x11
+    &quot;st_fake_oxydd&quot;,             // OxydMagnum stone 0x11
     &quot;st-plain&quot;,                 // OxydMagnum stone 0x12
     &quot;st_brick_es&quot;,              // OxydMagnum stone 0x13
     &quot;st_brick_sw&quot;,              // OxydMagnum stone 0x14

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/ox_oxyd1.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -165,7 +165,7 @@
 const char *oxyd::oxyd1_stone_map[256] = {
     0,                          // Oxyd1 stone 0x00
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
-    &quot;st-fakeoxyd&quot;,              // Oxyd1 stone 0x11
+    &quot;st_fake_quake&quot;,             // Oxyd1 stone 0x11
     &quot;st_door_c&quot;,                // Oxyd1 stone 0x12
     &quot;st_brick_es&quot;,              // Oxyd1 stone 0x13
     &quot;st_brick_sw&quot;,              // Oxyd1 stone 0x14

Modified: trunk/src/ox_peroxyd.cc
===================================================================
--- trunk/src/ox_peroxyd.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/ox_peroxyd.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -205,7 +205,7 @@
     0,                          // PerOxyd stone 0x00 no stone
     0,0,0,0,0,0,0,0,            // PerOxyd stone 0x01 - 0x08   oxyd stones
     0,0,0,0,0,0,0,0,            // PerOxyd stone 0x08 - 0x10   oxyd stones
-    &quot;st-likeoxydc&quot;,             // PerOxyd stone 0x11
+    &quot;st_fake_oxydc&quot;,             // PerOxyd stone 0x11
     &quot;st-plain_break&quot;,           // PerOxyd stone 0x12   no, should be destructible with hammer
     &quot;st-rock4&quot;,                 // PerOxyd stone 0x13
     &quot;st-beads&quot;,                 // PerOxyd stone 0x14
@@ -345,7 +345,7 @@
     &quot;st-grate1&quot;,                // PerOxyd stone 0x9a
     &quot;st-metal_hole&quot;,            // PerOxyd stone 0x9b
     &quot;st-stone1&quot;,                // PerOxyd stone 0x9c
-    &quot;st_fart&quot;,                  // PerOxyd stone 0x9d
+    &quot;st_quake&quot;,                 // PerOxyd stone 0x9d
     &quot;st_turnstile_red&quot;,         // PerOxyd stone 0x9e
     &quot;st_turnstilearm_n&quot;,        // PerOxyd stone 0x9f
     &quot;st_turnstilearm_s&quot;,        // PerOxyd stone 0xa0

Modified: trunk/src/stones/ChessStone.cc
===================================================================
--- trunk/src/stones/ChessStone.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/ChessStone.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -113,7 +113,7 @@
                 KillStone(get_pos());
                 break;
             default:
-               ASSERT(0, XLevelRuntime, &quot;ChessStone: inconsistent state in animcb()&quot;);
+               ASSERT(false, XLevelRuntime, &quot;ChessStone: inconsistent state in animcb()&quot;);
         }
     }
 

Added: trunk/src/stones/CompatibilityStones.cc
===================================================================
--- trunk/src/stones/CompatibilityStones.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/CompatibilityStones.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,71 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include &quot;stones/CompatibilityStones.hh&quot;
+#include &quot;errors.hh&quot;
+//#include &quot;main.hh&quot;
+
+namespace enigma {
+
+/* -------------------- Oxyd compatibility stones -------------------- */
+
+    /* I have no idea what these stones are _really_ supposed to do;
+       they seemingly do not appear in the landscape and they create
+       normal floor tiles on creation.  Other than that... who
+       knows... */
+
+    Peroxyd_0xb8::Peroxyd_0xb8() {
+    }
+
+    void Peroxyd_0xb8::on_creation (GridPos p) {
+        SetFloor(p, MakeFloor(&quot;fl-normal&quot;));
+        KillStone(p);
+    }
+
+    DEF_TRAITSM(Peroxyd_0xb8, &quot;st-peroxyd-0xb8&quot;, st_peroxyd_0xb8, MOVABLE_BREAKABLE);
+
+
+    Peroxyd_0xb9::Peroxyd_0xb9() {
+    }
+
+    void Peroxyd_0xb9::on_creation (GridPos p) {
+        SetFloor(p, MakeFloor(&quot;fl-normal&quot;));
+        KillStone(p);
+    }
+
+    DEF_TRAITSM(Peroxyd_0xb9, &quot;st-peroxyd-0xb9&quot;, st_peroxyd_0xb9, MOVABLE_BREAKABLE);
+
+  
+    Oxyd_0x18::Oxyd_0x18() {
+    }
+        
+    void Oxyd_0x18::on_creation (GridPos p) {
+        KillStone(p);
+    }
+
+    DEF_TRAITSM(Oxyd_0x18, &quot;st-oxyd-0x18&quot;, st_oxyd_0x18, MOVABLE_BREAKABLE);
+    
+    BOOT_REGISTER_START
+        BootRegister(new Peroxyd_0xb8(), &quot;st-peroxyd-0xb8&quot;);
+        BootRegister(new Peroxyd_0xb9(), &quot;st-peroxyd-0xb9&quot;);
+        BootRegister(new Oxyd_0x18(), &quot;st-oxyd-0x18&quot;);
+    BOOT_REGISTER_END
+
+} // namespace enigma
+


Property changes on: trunk/src/stones/CompatibilityStones.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/CompatibilityStones.hh
===================================================================
--- trunk/src/stones/CompatibilityStones.hh	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/CompatibilityStones.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,63 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef COMPATIBILITYSTONES_HH
+#define COMPATIBILITYSTONES_HH
+
+#include &quot;stones.hh&quot;
+
+#include &quot;stones_internal.hh&quot;
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class Peroxyd_0xb8 : public Stone {
+        CLONEOBJ(Peroxyd_0xb8);
+        DECL_TRAITS;
+    public:
+        Peroxyd_0xb8();
+
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+    };
+
+    class Peroxyd_0xb9 : public Stone {
+        CLONEOBJ(Peroxyd_0xb9);
+        DECL_TRAITS;
+    public:
+        Peroxyd_0xb9();
+
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+    };
+
+    class Oxyd_0x18 : public Stone {
+        CLONEOBJ(Oxyd_0x18);
+        DECL_TRAITS;
+    public:
+        Oxyd_0x18();
+        
+        // GridObject interface
+        virtual void on_creation(GridPos p);
+    };
+
+} // namespace enigma
+
+#endif /*COMPATIBILITYSTONES_HH*/


Property changes on: trunk/src/stones/CompatibilityStones.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/FakeStone.cc
===================================================================
--- trunk/src/stones/FakeStone.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/FakeStone.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,140 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include &quot;stones/FakeStone.hh&quot;
+#include &quot;errors.hh&quot;
+//#include &quot;main.hh&quot;
+
+namespace enigma {
+    FakeStone::FakeStone(int subtyp) : Stone() {
+        objFlags |= (subtyp &lt;&lt; 24);
+    }
+    
+    std::string FakeStone::getClass() const {
+        return &quot;st_fake&quot;;
+    }
+    
+    void FakeStone::setAttr(const string&amp; key, const Value &amp;val) {
+        if (key == &quot;flavor&quot;) {
+            std::string fl = val.to_string();
+            FakeStoneTyp typ = QUAKE;
+            if (fl == &quot;quake&quot;) typ = QUAKE;
+            else if (fl == &quot;oxyda&quot;) typ = OXYDA;
+            else if (fl == &quot;oxydb&quot;) typ = OXYDB;
+            else if (fl == &quot;oxydc&quot;) typ = OXYDC;
+            else if (fl == &quot;oxydd&quot;) typ = OXYDD;
+            else if (fl == &quot;oxyde&quot;) typ = OXYDE;
+            else
+                ASSERT(false, XLevelRuntime, ecl::strf(&quot;Fake stone with illegal flavor value: %s&quot;, fl.c_str()).c_str());
+            objFlags = objFlags &amp; OBJBIT_SUBTYP | (typ &lt;&lt; 24);
+            if (isDisplayable())
+                init_model();
+            return;
+        } else
+            Stone::setAttr(key, val);
+    }
+    
+    Value FakeStone::getAttr(const std::string &amp;key) const {
+        if (key == &quot;flavor&quot;) {
+            return getFlavor();
+        } else
+            return Stone::getAttr(key);
+    }
+
+    void FakeStone::setState(int extState) {
+        if (isDisplayable()) {
+            if (((objFlags &amp; OBJBIT_SUBTYP) &gt;&gt; 25) == QUAKE &amp;&amp; state != extState) {
+                state = extState;
+                init_model();
+            }
+            // oxyd fakes do not allow a state change once they are set
+        } else
+            Stone::setState(extState);
+    }
+    
+    void FakeStone::init_model() {
+        FakeStoneTyp typ = (FakeStoneTyp)((objFlags &amp; OBJBIT_SUBTYP) &gt;&gt; 24);
+        switch (typ) {
+            case QUAKE:
+                if (state == ACTIVE)
+                    set_anim(&quot;st-farting&quot;);
+                else
+                    set_model(&quot;st-fart&quot;);
+                break;
+            case OXYDA:
+            case OXYDB:
+            case OXYDC:
+            case OXYDD:
+            case OXYDE:
+                set_model(ecl::strf(&quot;st-like%s%s&quot;, getFlavor().c_str(), state == IDLE ? &quot;&quot; : &quot;-open&quot;).c_str());
+                break;
+        }
+    }
+    
+    void FakeStone::animcb() {
+        state = IDLE;
+        init_model();
+    }
+
+    const char * FakeStone::collision_sound() {
+        if ((FakeStoneTyp)((objFlags &amp; OBJBIT_SUBTYP) &gt;&gt; 24) == QUAKE)
+            return &quot;metal&quot;;
+        else
+            return &quot;stone&quot;;
+    }
+    
+    void FakeStone::actor_hit(const StoneContact &amp;sc) {
+        if (((objFlags &amp; OBJBIT_SUBTYP) &gt;&gt; 24) == QUAKE &amp;&amp; state == IDLE) {
+            sound_event (&quot;fakeoxyd&quot;);
+            state = ACTIVE;
+            init_model();
+        } else
+            Stone::actor_hit(sc);
+    }
+    
+    std::string FakeStone::getFlavor() const {
+        FakeStoneTyp typ = (FakeStoneTyp)((objFlags &amp; OBJBIT_SUBTYP) &gt;&gt; 24);
+        switch (typ) {
+            case QUAKE:
+                return &quot;quake&quot;;
+            case OXYDA:
+                return &quot;oxyda&quot;;
+            case OXYDB:
+                return &quot;oxydb&quot;;
+            case OXYDC:
+                return &quot;oxydc&quot;;
+            case OXYDD:
+                return &quot;oxydd&quot;;
+            case OXYDE:
+                return &quot;oxyde&quot;;
+        }
+    }
+    
+    BOOT_REGISTER_START
+        BootRegister(new FakeStone(0), &quot;st_fake_quake&quot;);
+        BootRegister(new FakeStone(1), &quot;st_fake_oxyda&quot;);
+        BootRegister(new FakeStone(2), &quot;st_fake_oxydb&quot;);
+        BootRegister(new FakeStone(3), &quot;st_fake_oxydc&quot;);
+        BootRegister(new FakeStone(4), &quot;st_fake_oxydd&quot;);
+        BootRegister(new FakeStone(5), &quot;st_fake_oxyde&quot;);
+    BOOT_REGISTER_END
+
+} // namespace enigma
+


Property changes on: trunk/src/stones/FakeStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/FakeStone.hh
===================================================================
--- trunk/src/stones/FakeStone.hh	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/FakeStone.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,80 @@
+/*
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef FAKESTONE_HH
+#define FAKESTONE_HH
+
+#include &quot;stones.hh&quot;
+
+#include &quot;stones_internal.hh&quot;
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class FakeStone : public Stone {
+         CLONEOBJ(FakeStone);
+
+    private:
+        enum iState {
+            IDLE,     ///&lt; standard fake stone - idle or closed
+            ACTIVE    ///&lt; a blinking quake or opened oxyd
+        };
+        
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_SUBTYP    =   7&lt;&lt;24   ///&lt; the FakeStoneTyp
+        };
+        
+        enum FakeStoneTyp {
+            QUAKE = 0,
+            OXYDA,
+            OXYDB,
+            OXYDC,
+            OXYDD,
+            OXYDE
+        };
+    public:
+        FakeStone(int subtyp);
+        
+        // Object interface
+        virtual std::string getClass() const;
+        virtual void setAttr(const string&amp; key, const Value &amp;val);
+        virtual Value getAttr(const std::string &amp;key) const;
+        
+        // StateObject interface
+        virtual void setState(int extState);
+        
+        // GridObject interface
+        virtual void init_model();
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual const char *collision_sound();
+        virtual void actor_hit(const StoneContact &amp;sc);
+    
+    private:
+        // Private methods.
+        std::string getFlavor() const;
+    };
+
+} // namespace enigma
+
+#endif /*FLOORBUILDERSTONE_HH*/


Property changes on: trunk/src/stones/FakeStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Deleted: trunk/src/stones/FartStone.cc
===================================================================
--- trunk/src/stones/FartStone.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/FartStone.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -1,119 +0,0 @@
-/*
- * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2008 Ronald Lamprecht
- *
- * This program is free software; you can redistribute it and/or
- * modify it under the terms of the GNU General Public License
- * as published by the Free Software Foundation; either version 2
- * of the License, or (at your option) any later version.
- *  
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along
- * with this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
- *
- */
-
-#include &quot;stones/FartStone.hh&quot;
-#include &quot;player.hh&quot;
-#include &quot;world.hh&quot;
-//#include &quot;main.hh&quot;
-
-namespace enigma {
-    FartStone::FartStone() {
-    }
-    
-    std::string FartStone::getClass() const {
-        return &quot;st_fart&quot;;
-    }
-    
-    Value FartStone::message(const Message &amp;m) {
-        if (m.message == &quot;toggle&quot; || (m.message == &quot;signal&quot; &amp;&amp; m.value != 0) ||
-                (m.message == &quot;_trigger&quot; &amp;&amp; m.value.to_bool())) {
-            setState(ACTIVE);
-            return Value();
-        } else if (m.message == &quot;ignite&quot; || m.message == &quot;_explosion&quot;) { 
-            setState(BREAKING);
-            return Value();
-        }
-        return Stone::message(m);
-    }
-
-    int FartStone::maxState() const {
-        return BREAKING;
-    }
-    
-    int FartStone::externalState() const {
-        return (state == ACTIVEBREAKING) ? BREAKING : state;
-    }
-    
-    void FartStone::setState(int extState) {
-        if (state == extState)
-            return;
-            
-        if ((state == IDLE &amp;&amp; extState == BREAKING) || (state == ACTIVEBREAKING &amp;&amp; extState == IDLE)) {
-            state = BREAKING;
-            if (isDisplayable()) {
-                fart();
-                sound_event(&quot;stonedestroy&quot;);
-            }
-        } else if (state == IDLE &amp;&amp; extState == ACTIVE) {
-            state = ACTIVE;
-            if (isDisplayable())            
-                fart();
-        } else if (state == ACTIVE &amp;&amp; extState == IDLE) {
-            state = IDLE;
-        } else if (state == ACTIVE &amp;&amp; extState == BREAKING) {
-            state = ACTIVEBREAKING;
-        } else
-            return;
-        
-        if (isDisplayable())
-            init_model();
-    }
-    
-    void FartStone::init_model() {
-        switch (state) {
-            case IDLE:     set_model(&quot;st-fart&quot;); break;
-            case ACTIVEBREAKING:
-            case ACTIVE:   set_anim(&quot;st-farting&quot;); break;
-            case BREAKING: set_anim(&quot;st-fartbreak-anim&quot;); break;
-        }
-    }
-    
-    void FartStone::processLight(Direction d) {
-        setState(BREAKING);
-    }
-
-    void FartStone::animcb() {
-        if (state == ACTIVE || state == ACTIVEBREAKING)
-            setState(IDLE);
-        else if (state == BREAKING)
-            KillStone(get_pos());
-    }
-
-    void FartStone::actor_hit(const StoneContact &amp;sc) {
-        if (player::WieldedItemIs(sc.actor, &quot;it_hammer&quot;))
-            setState(BREAKING);
-        else
-            setState(ACTIVE);
-    }
-    
-    void FartStone::fart() {
-        Object *ox = GetObjectTemplate(&quot;st_oxyd&quot;);
-        SendMessage(ox, &quot;closeall&quot;);
-        sound_event(&quot;fart&quot;);
-    }
-    
-        
-    DEF_TRAITSM(FartStone, &quot;st_fart&quot;, st_fart, MOVABLE_BREAKABLE);
-    
-    BOOT_REGISTER_START
-        BootRegister(new FartStone(), &quot;st_fart&quot;);
-    BOOT_REGISTER_END
-
-} // namespace enigma

Deleted: trunk/src/stones/FartStone.hh
===================================================================
--- trunk/src/stones/FartStone.hh	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/FartStone.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -1,71 +0,0 @@
-/*
- * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2008 Ronald Lamprecht
- *
- * This program is free software; you can redistribute it and/or
- * modify it under the terms of the GNU General Public License
- * as published by the Free Software Foundation; either version 2
- * of the License, or (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along
- * with this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
- *
- */
-#ifndef FARTSTONE_HH
-#define FARTSTONE_HH
-
-#include &quot;stones.hh&quot;
-
-#include &quot;stones_internal.hh&quot;
-
-namespace enigma {
-
-    /** 
-     * 
-     */
-    class FartStone : public Stone {
-        CLONEOBJ(FartStone);
-        DECL_TRAITS;
-    private:
-        enum iState {
-            IDLE,           ///&lt; 
-            ACTIVE,         ///&lt; 
-            BREAKING,       ///&lt; 
-            ACTIVEBREAKING  ///&lt; active state with a pending breaking 
-        };
-        
-    public:
-        FartStone();
-        
-        // Object interface
-        virtual std::string getClass() const;        
-        virtual Value message(const Message &amp;m);
-        
-        // StateObject interface
-        virtual int maxState() const;
-        virtual int externalState() const;
-        virtual void setState(int extState);
-
-        // GridObject interface
-        virtual void init_model();
-        virtual void processLight(Direction d);
-        
-        // ModelCallback interface
-        virtual void animcb();
-        
-        // Stone interface
-        virtual void actor_hit(const StoneContact &amp;sc);
-
-    private:
-        void fart();
-    };
-
-} // namespace enigma
-
-#endif

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/OxydStone.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -31,7 +31,7 @@
     bool OxydStone::isInit = false;
     std::vector&lt;unsigned short&gt; OxydStone::colorsUsageCount;
     unsigned short OxydStone::shuffledFakeCount;
-    unsigned short OxydStone::shuffledFartCount;
+    unsigned short OxydStone::shuffledQuakeCount;
     unsigned short OxydStone::shuffledBoldCount;
     bool OxydStone::oddUnshuffledColor;
     
@@ -115,7 +115,7 @@
         colorsUsageCount = std::vector&lt;unsigned short&gt;(numColors);
         std::vector&lt;unsigned short&gt;colorsUsageCountNoShuffle(numColors);
         shuffledFakeCount = 0;
-        shuffledFartCount = 0;
+        shuffledQuakeCount = 0;
         shuffledBoldCount = 0;
         oddUnshuffledColor = false;
         
@@ -137,8 +137,8 @@
                     case FAKE:
                         if (!declineShuffle) shuffledFakeCount++;
                         break;
-                    case FART:
-                        if (!declineShuffle) shuffledFartCount++;
+                    case QUAKE:
+                        if (!declineShuffle) shuffledQuakeCount++;
                         break;
                     case BOLD:
                         if (!declineShuffle) shuffledBoldCount++;
@@ -292,7 +292,7 @@
                 base.oxydsCandidatesCount.push_back(countOxyds(candidates));
             }
             base.freeOxydsMask = all;
-            base.freePseudoCount = shuffledFakeCount + shuffledFartCount + shuffledBoldCount;
+            base.freePseudoCount = shuffledFakeCount + shuffledQuakeCount + shuffledBoldCount;
             base.freePairsCount = 0;
             for (int i = 0; i &lt; numColorsAvailable(); i++) {
                 base.freePairsCount += colorsUsageCount[i];
@@ -666,7 +666,7 @@
         unsigned short numColors = numColorsAvailable();
         std::vector&lt;unsigned short&gt; colorsRemainCount = colorsUsageCount;
         unsigned short remainFakeCount = shuffledFakeCount;
-        unsigned short remainFartCount = shuffledFartCount;
+        unsigned short remainQuakeCount = shuffledQuakeCount;
         unsigned short remainBoldCount = shuffledBoldCount;
         
         // distribute colors of pairs with noshuffle, open, blinking oxyds and the pseudooxyds
@@ -676,14 +676,14 @@
                 if ((*itr).selOxyd2Mask == 0) {
                     // a single oxyd -- it must be a pseudo
                     OxydStone *oxyd = levelOxyds[oxydId((*itr).selOxyd1Mask)];
-                    ASSERT(remainFakeCount + remainFartCount + remainBoldCount &gt; 0, XLevelRuntime, &quot;Oxyd shuffle - to few pseudo colors&quot;);
-                    int i = IntegerRand(1, remainFakeCount + remainFartCount + remainBoldCount);  // use enigma's internal rand!
+                    ASSERT(remainFakeCount + remainQuakeCount + remainBoldCount &gt; 0, XLevelRuntime, &quot;Oxyd shuffle - to few pseudo colors&quot;);
+                    int i = IntegerRand(1, remainFakeCount + remainQuakeCount + remainBoldCount);  // use enigma's internal rand!
                     if (i &lt;= remainFakeCount) {
                         remainFakeCount--;
                         oxyd-&gt;setAttr(&quot;oxydcolor&quot;, FAKE);
-                    } else if ( i &lt;= remainFakeCount + remainFartCount) {
-                        remainFartCount--;
-                        oxyd-&gt;setAttr(&quot;oxydcolor&quot;, FART);
+                    } else if ( i &lt;= remainFakeCount + remainQuakeCount) {
+                        remainQuakeCount--;
+                        oxyd-&gt;setAttr(&quot;oxydcolor&quot;, QUAKE);
                     } else {
                         remainBoldCount--;
                         oxyd-&gt;setAttr(&quot;oxydcolor&quot;, BOLD);
@@ -1025,8 +1025,8 @@
                 // a standard single oxyd is open - close it
                 pairCandidate-&gt;set_iState(CLOSING);
             }
-            // open FART and BOLD, keep FAKE closed
-            if ((int)mycolor &lt;= FART)
+            // open QUAKE and BOLD, keep FAKE closed
+            if ((int)mycolor &lt;= QUAKE)
                 set_iState(OPENING);
         }
         else if (state == CLOSED || state == CLOSING) {
@@ -1095,7 +1095,7 @@
         
         state = newState;
         bool didShuffle = false;
-        bool didFart = false;
+        bool didQuake = false;
     
         switch (newState) {
             case CLOSED:
@@ -1108,11 +1108,11 @@
                 break;
         
             case OPEN_SINGLE:
-                if ((int)getAttr(&quot;oxydcolor&quot;) &lt;= FART) {
+                if ((int)getAttr(&quot;oxydcolor&quot;) &lt;= QUAKE) {
                     set_anim(basemodelname + &quot;-pseudo&quot; + color);
-                    if ((int)getAttr(&quot;oxydcolor&quot;) == FART) {
+                    if ((int)getAttr(&quot;oxydcolor&quot;) == QUAKE) {
                         closeAllStandardOxyds();
-                        didFart = true;
+                        didQuake = true;
                         sound_event(&quot;fart&quot;);
                     } else if ((int)getAttr(&quot;oxydcolor&quot;) == BOLD) {
                         sound_event(&quot;shuffle&quot;);
@@ -1161,7 +1161,7 @@
         }
         // perform action
         if (((int)getAttr(&quot;oxydcolor&quot;) &gt; AUTO &amp;&amp; oldExtState != externalState() &amp;&amp; (oldExtState != 1 || externalState() != 2)) // avoid second action of paired oxyd that changes from single to pair open state
-                || didShuffle || didFart)
+                || didShuffle || didQuake)
             performAction(externalState() != 0);
     }
     

Modified: trunk/src/stones/OxydStone.hh
===================================================================
--- trunk/src/stones/OxydStone.hh	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/OxydStone.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -66,11 +66,11 @@
         enum Color {BLUE = 0, RED, GREEN, YELLOW, CYAN, PURPLE, WHITE, BLACK, 
             GREY, ORANGE, PINE, BROWN,
             COLORCOUNT,
-            AUTO = -1,
-            FAKE = -2,
-            FART = -3,
-            BOLD = -4,
-            MIN  = -4
+            AUTO  = -1,
+            FAKE  = -2,
+            QUAKE = -3,
+            BOLD  = -4,
+            MIN   = -4
         };
         enum LogType {NOTHING, SOLUTION, COUNT, ALL};
             
@@ -152,7 +152,7 @@
         static bool isInit;
         static std::vector&lt;unsigned short&gt; colorsUsageCount;
         static unsigned short shuffledFakeCount;
-        static unsigned short shuffledFartCount;
+        static unsigned short shuffledQuakeCount;
         static unsigned short shuffledBoldCount;
         static bool oddUnshuffledColor;
         

Copied: trunk/src/stones/QuakeStone.cc (from rev 1397, trunk/src/stones/FartStone.cc)
===================================================================
--- trunk/src/stones/FartStone.cc	2008-12-15 23:51:27 UTC (rev 1397)
+++ trunk/src/stones/QuakeStone.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,119 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include &quot;stones/QuakeStone.hh&quot;
+#include &quot;player.hh&quot;
+#include &quot;world.hh&quot;
+//#include &quot;main.hh&quot;
+
+namespace enigma {
+    QuakeStone::QuakeStone() {
+    }
+    
+    std::string QuakeStone::getClass() const {
+        return &quot;st_quake&quot;;
+    }
+    
+    Value QuakeStone::message(const Message &amp;m) {
+        if (m.message == &quot;toggle&quot; || (m.message == &quot;signal&quot; &amp;&amp; m.value != 0) ||
+                (m.message == &quot;_trigger&quot; &amp;&amp; m.value.to_bool())) {
+            setState(ACTIVE);
+            return Value();
+        } else if (m.message == &quot;ignite&quot; || m.message == &quot;_explosion&quot;) { 
+            setState(BREAKING);
+            return Value();
+        }
+        return Stone::message(m);
+    }
+
+    int QuakeStone::maxState() const {
+        return BREAKING;
+    }
+    
+    int QuakeStone::externalState() const {
+        return (state == ACTIVEBREAKING) ? BREAKING : state;
+    }
+    
+    void QuakeStone::setState(int extState) {
+        if (state == extState)
+            return;
+            
+        if ((state == IDLE &amp;&amp; extState == BREAKING) || (state == ACTIVEBREAKING &amp;&amp; extState == IDLE)) {
+            state = BREAKING;
+            if (isDisplayable()) {
+                fart();
+                sound_event(&quot;stonedestroy&quot;);
+            }
+        } else if (state == IDLE &amp;&amp; extState == ACTIVE) {
+            state = ACTIVE;
+            if (isDisplayable())            
+                fart();
+        } else if (state == ACTIVE &amp;&amp; extState == IDLE) {
+            state = IDLE;
+        } else if (state == ACTIVE &amp;&amp; extState == BREAKING) {
+            state = ACTIVEBREAKING;
+        } else
+            return;
+        
+        if (isDisplayable())
+            init_model();
+    }
+    
+    void QuakeStone::init_model() {
+        switch (state) {
+            case IDLE:     set_model(&quot;st-fart&quot;); break;
+            case ACTIVEBREAKING:
+            case ACTIVE:   set_anim(&quot;st-farting&quot;); break;
+            case BREAKING: set_anim(&quot;st-fartbreak-anim&quot;); break;
+        }
+    }
+    
+    void QuakeStone::processLight(Direction d) {
+        setState(BREAKING);
+    }
+
+    void QuakeStone::animcb() {
+        if (state == ACTIVE || state == ACTIVEBREAKING)
+            setState(IDLE);
+        else if (state == BREAKING)
+            KillStone(get_pos());
+    }
+
+    void QuakeStone::actor_hit(const StoneContact &amp;sc) {
+        if (player::WieldedItemIs(sc.actor, &quot;it_hammer&quot;))
+            setState(BREAKING);
+        else
+            setState(ACTIVE);
+    }
+    
+    void QuakeStone::fart() {
+        Object *ox = GetObjectTemplate(&quot;st_oxyd&quot;);
+        SendMessage(ox, &quot;closeall&quot;);
+        sound_event(&quot;fart&quot;);
+    }
+    
+        
+    DEF_TRAITSM(QuakeStone, &quot;st_quake&quot;, st_quake, MOVABLE_BREAKABLE);
+    
+    BOOT_REGISTER_START
+        BootRegister(new QuakeStone(), &quot;st_quake&quot;);
+    BOOT_REGISTER_END
+
+} // namespace enigma

Copied: trunk/src/stones/QuakeStone.hh (from rev 1397, trunk/src/stones/FartStone.hh)
===================================================================
--- trunk/src/stones/FartStone.hh	2008-12-15 23:51:27 UTC (rev 1397)
+++ trunk/src/stones/QuakeStone.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,71 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef FARTSTONE_HH
+#define FARTSTONE_HH
+
+#include &quot;stones.hh&quot;
+
+#include &quot;stones_internal.hh&quot;
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class QuakeStone : public Stone {
+        CLONEOBJ(QuakeStone);
+        DECL_TRAITS;
+    private:
+        enum iState {
+            IDLE,           ///&lt; 
+            ACTIVE,         ///&lt; 
+            BREAKING,       ///&lt; 
+            ACTIVEBREAKING  ///&lt; active state with a pending breaking 
+        };
+        
+    public:
+        QuakeStone();
+        
+        // Object interface
+        virtual std::string getClass() const;        
+        virtual Value message(const Message &amp;m);
+        
+        // StateObject interface
+        virtual int maxState() const;
+        virtual int externalState() const;
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        virtual void processLight(Direction d);
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual void actor_hit(const StoneContact &amp;sc);
+
+    private:
+        void fart();
+    };
+
+} // namespace enigma
+
+#endif

Added: trunk/src/stones/SimpleStones.cc
===================================================================
--- trunk/src/stones/SimpleStones.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/SimpleStones.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,49 @@
+/*
+ * Copyright (C) 2002,2003,2004 Daniel Heck
+ * Copyright (C) 2008 Andreas Lochmann
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include &quot;stones/SimpleStones.hh&quot;
+#include &quot;errors.hh&quot;
+//#include &quot;main.hh&quot;
+#include &quot;world.hh&quot;
+
+namespace enigma {
+
+/* -------------------- Flash stone -------------------- */
+
+    FlashStone::FlashStone() : Stone (&quot;st_flash&quot;) {
+    }
+    
+    std::string FlashStone::getClass() const {
+        return &quot;st_flash&quot;;
+    }
+        
+    void FlashStone::actor_hit(const StoneContact &amp;sc) {
+        if (Actor *other = FindOtherMarble(sc.actor)) {
+            other-&gt;add_force (distortedVelocity(sc.actor-&gt;get_vel(), 20));
+        }
+    }
+    
+    BOOT_REGISTER_START
+        BootRegister(new FlashStone(), &quot;st_flash&quot;);
+    BOOT_REGISTER_END
+
+} // namespace enigma
+


Property changes on: trunk/src/stones/SimpleStones.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/SimpleStones.hh
===================================================================
--- trunk/src/stones/SimpleStones.hh	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones/SimpleStones.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -0,0 +1,47 @@
+/*
+ * Copyright (C) 2008 Andreas Lochmann
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef SIMPLESTONES_HH
+#define SIMPLESTONES_HH
+
+#include &quot;stones.hh&quot;
+
+#include &quot;stones_internal.hh&quot;
+
+namespace enigma {
+
+    /** 
+     * FlashStone
+     */
+    class FlashStone : public Stone {
+        CLONEOBJ(FlashStone);
+
+    public:
+        FlashStone();
+
+        // Object interface
+        virtual std::string getClass() const;
+
+        // Stone interface
+        virtual void actor_hit (const StoneContact &amp;sc);
+    };
+
+} // namespace enigma
+
+#endif /*SIMPLESTONES_HH*/


Property changes on: trunk/src/stones/SimpleStones.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -337,37 +337,6 @@
 //  Stones under development :
 
 
-
-/* -------------------- Explosion stone -------------------- */
-namespace
-{
-    class ExplosionStone : public Stone {
-        CLONEOBJ(ExplosionStone);
-        DECL_TRAITS;
-
-        StoneResponse collision_response(const StoneContact &amp;) {
-            return STONE_PASS;
-        }
-
-        void actor_contact (Actor *a) {
-            SendMessage(a, &quot;shatter&quot;);
-        }
-        void init_model() {
-            set_anim(&quot;st-explosion&quot;);
-        }
-
-        void animcb() {
-            KillStone(get_pos());
-        }
-
-    public:
-        ExplosionStone()
-        {}
-    };
-    DEF_TRAITSM(ExplosionStone, &quot;st-explosion&quot;, st_explosion, MOVABLE_BREAKABLE);
-}
-
-
 /* -------------------- Charge stone -------------------- */
 
 // Attributes:
@@ -467,77 +436,6 @@
     }
 }
 
-
-/* -------------------- Oxyd compatibility stones -------------------- */
-
-namespace
-{
-    /* I have no idea what these stones are _really_ supposed to do;
-       they seemingly do not appear in the landscape and they create
-       normal floor tiles on creation.  Other than that... who
-       knows... */
-    class Peroxyd_0xb8 : public Stone {
-        CLONEOBJ(Peroxyd_0xb8);
-        DECL_TRAITS;
-    public:
-        Peroxyd_0xb8()
-        {}
-
-        void on_creation (GridPos p) {
-            SetFloor (p, MakeFloor (&quot;fl-normal&quot;));
-            KillStone(p);
-        }
-    };
-    DEF_TRAITSM(Peroxyd_0xb8, &quot;st-peroxyd-0xb8&quot;, st_peroxyd_0xb8, MOVABLE_BREAKABLE);
-    
-    class Peroxyd_0xb9 : public Stone {
-        CLONEOBJ(Peroxyd_0xb9);
-        DECL_TRAITS;
-    public:
-        Peroxyd_0xb9()
-        {}
-
-        void on_creation (GridPos p) {
-            SetFloor (p, MakeFloor (&quot;fl-normal&quot;));
-            KillStone(p);
-        }
-    };
-    DEF_TRAITSM(Peroxyd_0xb9, &quot;st-peroxyd-0xb9&quot;, st_peroxyd_0xb9, MOVABLE_BREAKABLE);
-    
-    class Oxyd_0x18 : public Stone {
-        CLONEOBJ(Oxyd_0x18);
-        DECL_TRAITS;
-    public:
-        Oxyd_0x18()
-        {}
-        
-        void on_creation (GridPos p) {
-            KillStone (p);
-        }
-    };
-    DEF_TRAITSM(Oxyd_0x18, &quot;st-oxyd-0x18&quot;, st_oxyd_0x18, MOVABLE_BREAKABLE);
-}
-
-
-/* -------------------- Flash stone -------------------- */
-namespace
-{
-    class FlashStone : public Stone {
-        CLONEOBJ(FlashStone);
-
-        void actor_hit (const StoneContact &amp;sc) {
-            if (Actor *other = FindOtherMarble(sc.actor)) {
-                other-&gt;add_force (distortedVelocity(sc.actor-&gt;get_vel(), 20));
-            }
-        }
-
-    public:
-        FlashStone() : Stone (&quot;st-flash&quot;)
-        {}
-    };
-}
-
-
 /* -------------------- Surprise stone -------------------- */
 namespace 
 {
@@ -595,6 +493,9 @@
 /* -------------------- Breaking stone -------------------- */
 namespace
 {
+    
+    // only used by Bug stone as replacement!
+    
     class BreakingStone : public Stone {
         CLONEOBJ(BreakingStone);
         DECL_TRAITS;
@@ -973,15 +874,10 @@
 
     // Register(new ...);
 
-    Register (new ExplosionStone);
     Register (new ChargeStone (&quot;st-chargeplus&quot;, +1.0));
     Register (new ChargeStone (&quot;st-chargeminus&quot;, -1.0));
     Register (new ChargeStone (&quot;st-chargezero&quot;, 0.0));
     Register (new SpitterStone);
-    Register (new Peroxyd_0xb8);
-    Register (new Peroxyd_0xb9);
-    Register (new Oxyd_0x18);
-    Register (new FlashStone);
     Register (new SurpriseStone);
     Register (new CoffeeStone);
     Register (new BlackBallsStone);

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones.hh	2008-12-17 23:44:42 UTC (rev 1399)
@@ -58,7 +58,7 @@
         st_easymode,
         st_explosion,
         st_fakeoxyda,
-        st_fart,
+        st_quake,
         st_firebreak,
         st_firebreak_move,
         st_floorbuilder,

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-12-16 19:36:56 UTC (rev 1398)
+++ trunk/src/stones_simple.cc	2008-12-17 23:44:42 UTC (rev 1399)
@@ -968,46 +968,6 @@
     return Stone::message(m);
 }
 
-//----------------------------------------
-// FakeOxydStone
-//----------------------------------------
-
-/** \page st-fakeoxyd Fake Oxyd Stone
-
-These stones look like real Oxyd stones, but they only blink a little
-when touched and do not open or have other special abilities.
-
-\image html st-fakeoxyd-blink_0001.png
-*/
-namespace
-{
-    class FakeOxydStone : public Stone {
-        CLONEOBJ(FakeOxydStone);
-    public:
-        FakeOxydStone() : Stone(&quot;st-fakeoxyd&quot;), state(IDLE) {
-            setAttr(&quot;blinking&quot;, 0.0);
-        }
-    private:
-        enum State { IDLE, BLINKING } state;
-        void actor_hit(const StoneContact &amp;/*sc*/) {
-            if (state == IDLE) {
-                set_anim(&quot;st-fakeoxyd-blink&quot;);
-                sound_event (&quot;fakeoxyd&quot;);
-                state = BLINKING;
-                setAttr(&quot;blinking&quot;, 1.0);
-            }
-        }
-        const char *collision_sound() {
-            return &quot;metal&quot;;
-        }
-        void animcb() {
-            set_model(&quot;st-fakeoxyd&quot;);
-            state = IDLE;
-            setAttr(&quot;blinking&quot;, 0.0);
-        }
-    };
-}
-
 /* -------------------- YinYang stones -------------------- */
 namespace
 {
@@ -1288,7 +1248,6 @@
 
     Register(new DummyStone);
     Register(new EasyModeStone);
-    Register(new FakeOxydStone);
     Register(new Grate1);
     Register(new Grate2);
     Register(new Grate3);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000827.html">[Enigma-game-svn] r1398 - homepage/input
</A></li>
	<LI>Next message: <A HREF="000829.html">[Enigma-game-svn] r1400 - trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#828">[ date ]</a>
              <a href="thread.html#828">[ thread ]</a>
              <a href="subject.html#828">[ subject ]</a>
              <a href="author.html#828">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
