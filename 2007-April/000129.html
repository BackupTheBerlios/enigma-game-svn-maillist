<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r691 - in trunk: . attic/gfx-templates data	data/gfx32 data/gfx40 data/gfx48 data/gfx64
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2007-April/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r691%20-%20in%20trunk%3A%20.%20attic/gfx-templates%20data%0A%09data/gfx32%20data/gfx40%20data/gfx48%20data/gfx64&In-Reply-To=%3C200704152145.l3FLjJIg029212%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000128.html">
   <LINK REL="Next"  HREF="000130.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r691 - in trunk: . attic/gfx-templates data	data/gfx32 data/gfx40 data/gfx48 data/gfx64</H1>
    <B>raoul at BerliOS</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r691%20-%20in%20trunk%3A%20.%20attic/gfx-templates%20data%0A%09data/gfx32%20data/gfx40%20data/gfx48%20data/gfx64&In-Reply-To=%3C200704152145.l3FLjJIg029212%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r691 - in trunk: . attic/gfx-templates data	data/gfx32 data/gfx40 data/gfx48 data/gfx64">raoul at mail.berlios.de
       </A><BR>
    <I>Sun Apr 15 23:45:19 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000128.html">[Enigma-game-svn] r690 - in branches/1.0/src: . gui lev
</A></li>
        <LI>Next message: <A HREF="000130.html">[Enigma-game-svn] r692 - in branches/1.0/src: gui lev
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#129">[ date ]</a>
              <a href="thread.html#129">[ thread ]</a>
              <a href="subject.html#129">[ subject ]</a>
              <a href="author.html#129">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: raoul
Date: 2007-04-15 23:45:05 +0200 (Sun, 15 Apr 2007)
New Revision: 691

Added:
   trunk/attic/gfx-templates/banana.psd
   trunk/attic/gfx-templates/cherry.psd
   trunk/attic/gfx-templates/key.psd
   trunk/attic/gfx-templates/pin.psd
   trunk/attic/gfx-templates/ring.psd
   trunk/data/gfx32/fl-rock.png
   trunk/data/gfx32/st-beads.png
   trunk/data/gfx32/st-black1.png
   trunk/data/gfx32/st-black2.png
   trunk/data/gfx32/st-black3.png
   trunk/data/gfx32/st-black4.png
   trunk/data/gfx32/st-block.png
   trunk/data/gfx40/fl-rock.png
   trunk/data/gfx40/st-beads.png
   trunk/data/gfx40/st-black1.png
   trunk/data/gfx40/st-black2.png
   trunk/data/gfx40/st-black3.png
   trunk/data/gfx40/st-black4.png
   trunk/data/gfx40/st-block.png
   trunk/data/gfx48/fl-rock.png
   trunk/data/gfx48/st-beads.png
   trunk/data/gfx48/st-black1.png
   trunk/data/gfx48/st-black2.png
   trunk/data/gfx48/st-black3.png
   trunk/data/gfx48/st-black4.png
   trunk/data/gfx48/st-block.png
   trunk/data/gfx64/
   trunk/data/gfx64/Makefile.am
   trunk/data/gfx64/it-banana.png
   trunk/data/gfx64/it-cherry.png
   trunk/data/gfx64/it-key.png
   trunk/data/gfx64/it-pin.png
   trunk/data/gfx64/it-ring.png
Removed:
   trunk/data/gfx32/fl-bluegreen2.png
   trunk/data/gfx32/fl-bluegreenx2.png
   trunk/data/gfx32/fl-ice_001.png
   trunk/data/gfx32/fl-rock1.png
   trunk/data/gfx32/fl-rock2.png
   trunk/data/gfx32/it-brush.png.png
   trunk/data/gfx32/stones.png
   trunk/data/gfx40/fl-bluegreen2.png
   trunk/data/gfx40/fl-bluegreenx2.png
   trunk/data/gfx40/fl-ice_001.png
   trunk/data/gfx40/fl-rock1.png
   trunk/data/gfx40/fl-rock2.png
   trunk/data/gfx40/stones.png
   trunk/data/gfx48/fl-bluegreen2.png
   trunk/data/gfx48/fl-bluegreenx2.png
   trunk/data/gfx48/fl-ice_001.png
   trunk/data/gfx48/fl-rock1.png
   trunk/data/gfx48/fl-rock2.png
   trunk/data/gfx48/stones.png
Modified:
   trunk/configure.ac
   trunk/data/Makefile.am
   trunk/data/gfx32/fl-bluegreenx.png
   trunk/data/gfx32/fl-leaves.png
   trunk/data/gfx32/it-banana.png
   trunk/data/gfx32/it-cherry.png
   trunk/data/gfx32/it-key.png
   trunk/data/gfx32/it-pin.png
   trunk/data/gfx32/it-ring.png
   trunk/data/gfx40/fl-bluegreenx.png
   trunk/data/gfx40/fl-leaves.png
   trunk/data/gfx40/it-banana.png
   trunk/data/gfx40/it-cherry.png
   trunk/data/gfx40/it-key.png
   trunk/data/gfx40/it-pin.png
   trunk/data/gfx40/it-ring.png
   trunk/data/gfx48/fg-blackball.png
   trunk/data/gfx48/fg-whiteball-small.png
   trunk/data/gfx48/fg-whiteball.png
   trunk/data/gfx48/fl-bluegreenx.png
   trunk/data/gfx48/fl-leaves.png
   trunk/data/gfx48/inv-blackball.png
   trunk/data/gfx48/inv-whiteball.png
   trunk/data/gfx48/it-banana.png
   trunk/data/gfx48/it-cherry.png
   trunk/data/gfx48/it-key.png
   trunk/data/gfx48/it-pin.png
   trunk/data/gfx48/it-ring.png
   trunk/data/gfx48/sh-blackball.png
   trunk/data/gfx48/sh-brake.png
   trunk/data/gfx48/sh-floating.png
   trunk/data/gfx48/sh-glass.png
   trunk/data/gfx48/sh-grate1.png
   trunk/data/gfx48/sh-grate2.png
   trunk/data/gfx48/sh-grate3.png
   trunk/data/gfx48/sh-puzzle1.png
   trunk/data/gfx48/sh-round.png
   trunk/data/gfx48/sh-round2-growing.png
   trunk/data/gfx48/sh-round2.png
   trunk/data/gfx48/sh-shogun1.png
   trunk/data/gfx48/sh-shogun2.png
   trunk/data/gfx48/sh-shogun4.png
   trunk/data/gfx48/sh-solid.png
   trunk/data/gfx48/sh-white4.png
   trunk/data/gfx48/sh-whiteball-small.png
   trunk/data/models-2d.lua
   trunk/data/models.lua
Log:
-&gt; Added the new gfx from Jennifer Robertson
--&gt; Improved items and balls (only gfx48)
--&gt; First 64px tiles

-&gt; Cleaned up models.lua and models-2d.lua
--&gt; removed fl-rock{1,2} in favour of fl-rock
--&gt; fl-bluegreen[x] with two tilemodels each
--&gt; splited stones.png in its parts
--&gt; finally removed gfx for unsupported fl-ice_001



Added: trunk/attic/gfx-templates/banana.psd
===================================================================
(Binary files differ)


Property changes on: trunk/attic/gfx-templates/banana.psd
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/attic/gfx-templates/cherry.psd
===================================================================
(Binary files differ)


Property changes on: trunk/attic/gfx-templates/cherry.psd
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/attic/gfx-templates/key.psd
===================================================================
(Binary files differ)


Property changes on: trunk/attic/gfx-templates/key.psd
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/attic/gfx-templates/pin.psd
===================================================================
(Binary files differ)


Property changes on: trunk/attic/gfx-templates/pin.psd
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/attic/gfx-templates/ring.psd
===================================================================
(Binary files differ)


Property changes on: trunk/attic/gfx-templates/ring.psd
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2007-04-14 15:11:51 UTC (rev 690)
+++ trunk/configure.ac	2007-04-15 21:45:05 UTC (rev 691)
@@ -346,6 +346,7 @@
            data/gfx32/Makefile
            data/gfx40/Makefile
            data/gfx48/Makefile
+           data/gfx64/Makefile
            data/levels/Makefile
            data/levels/enigma_tutorial/Makefile
            data/levels/enigma_i/Makefile

Modified: trunk/data/Makefile.am
===================================================================
--- trunk/data/Makefile.am	2007-04-14 15:11:51 UTC (rev 690)
+++ trunk/data/Makefile.am	2007-04-15 21:45:05 UTC (rev 691)
@@ -1,4 +1,4 @@
-SUBDIRS = gfx fonts schemas levels sound gfx32 gfx40 gfx48 
+SUBDIRS = gfx fonts schemas levels sound gfx32 gfx40 gfx48 gfx64
 
 pkgdata_DATA = \
 	enigma_conf.lua \

Deleted: trunk/data/gfx32/fl-bluegreen2.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx32/fl-bluegreenx.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-bluegreenx2.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-ice_001.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx32/fl-leaves.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx32/fl-rock.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/fl-rock.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx32/fl-rock1.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/fl-rock2.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx32/it-banana.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/it-brush.png.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx32/it-cherry.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx32/it-key.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx32/it-pin.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx32/it-ring.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx32/st-beads.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-beads.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx32/st-black1.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-black1.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx32/st-black2.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-black2.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx32/st-black3.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-black3.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx32/st-black4.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-black4.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx32/st-block.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-block.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx32/stones.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-bluegreen2.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/fl-bluegreenx.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-bluegreenx2.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-ice_001.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/fl-leaves.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx40/fl-rock.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/fl-rock.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx40/fl-rock1.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/fl-rock2.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/it-banana.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/it-cherry.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/it-key.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/it-pin.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/it-ring.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx40/st-beads.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-beads.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st-black1.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-black1.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st-black2.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-black2.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st-black3.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-black3.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st-black4.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-black4.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st-block.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-block.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx40/stones.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/fg-blackball.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/fg-whiteball-small.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/fg-whiteball.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-bluegreen2.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/fl-bluegreenx.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-bluegreenx2.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-ice_001.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/fl-leaves.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx48/fl-rock.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/fl-rock.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx48/fl-rock1.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/fl-rock2.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/inv-blackball.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/inv-whiteball.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/it-banana.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/it-cherry.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/it-key.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/it-pin.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/it-ring.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-blackball.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-brake.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-floating.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-glass.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-grate1.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-grate2.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-grate3.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-puzzle1.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-round.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-round2-growing.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-round2.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-shogun1.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-shogun2.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-shogun4.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-solid.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-white4.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh-whiteball-small.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx48/st-beads.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-beads.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st-black1.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-black1.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st-black2.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-black2.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st-black3.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-black3.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st-black4.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-black4.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st-block.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-block.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx48/stones.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx64
___________________________________________________________________
Name: svn:ignore
   + Makefile.in
Makefile


Added: trunk/data/gfx64/Makefile.am
===================================================================
--- trunk/data/gfx64/Makefile.am	2007-04-14 15:11:51 UTC (rev 690)
+++ trunk/data/gfx64/Makefile.am	2007-04-15 21:45:05 UTC (rev 691)
@@ -0,0 +1,3 @@
+pkgdatadir = $(datadir)/@PACKAGE@/gfx64
+pkgdata_DATA = $(wildcard $(srcdir)/*.png $(srcdir)/*.jpg)
+EXTRA_DIST = $(pkgdata_DATA)


Property changes on: trunk/data/gfx64/Makefile.am
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/gfx64/it-banana.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx64/it-banana.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx64/it-cherry.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx64/it-cherry.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx64/it-key.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx64/it-key.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx64/it-pin.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx64/it-pin.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx64/it-ring.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx64/it-ring.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2007-04-14 15:11:51 UTC (rev 690)
+++ trunk/data/models-2d.lua	2007-04-15 21:45:05 UTC (rev 691)
@@ -18,537 +18,476 @@
 ------------------------------------------------------------------------
 
 -- This file defines the models used in Enigma.
-
 dofile(FindDataFile(&quot;models.lua&quot;))
 
-def_image(&quot;dummy&quot;)
-def_image(&quot;invisible&quot;)
+DefImage(&quot;dummy&quot;)
+DefImage(&quot;invisible&quot;)
 
-------------------------------------------------------------------------
--- padding is calculated as:
--- padding = (1.25 - 2*Actorradius)/2
+--------------------------------------------------------------------------------
+--                                 ACTOR MODELS                               --
+--------------------------------------------------------------------------------
+Progress(0, &quot;Loading actor models&quot;)
 
-function SpriteImages(spriteimg, n, offsetfactor, padding)
-    local factor = offsetfactor or 0.5
-    local offset = -SpriteSize * factor
-    local pad = (padding or 0) * TileSize
-    return def_subimages(spriteimg,
-                         {h = n, imgw=SpriteSize, imgh=SpriteSize,
-                             xoff = offset, yoff = offset, padding=pad})
-end
+------------------------
+-- ball-shaped actors --
+------------------------
 
-function SpriteImage(spriteimg, offsetfactor, padding)
-    local factor = offsetfactor or 0.5
-    local offset = -SpriteSize * factor
-    local padding = (padding or 0) * TileSize
-    return def_image(spriteimg, {xoff = offset, yoff = offset, padding=padding})
-end
+-- ac-blackball and ac-whiteball--
+do
+    local images,frames,shadows
 
-function SpriteWithShadow()
+    -- Normal Blackball
+    images = SpriteImages(&quot;fg-blackball&quot;, 2, 0.5, 0.32)
+    shadows = SpriteImage(&quot;sh-blackball&quot;, 0.4, 0.29)
+    DefShModel(&quot;ac-blackball&quot;, &quot;fg-blackball1&quot;, &quot;sh-blackball&quot;)
+    DefShModel(&quot;ac-blackball-shine&quot;, &quot;fg-blackball2&quot;, &quot;sh-blackball&quot;)
 
-end
+    -- Normal Whiteball
+    -- Use shadow from black ball
+    DefAlias(&quot;sh-whiteball&quot;, &quot;sh-blackball&quot;)
+    images = SpriteImages(&quot;fg-whiteball&quot;, 2, 0.5, 0.32)
+    DefShModel(&quot;ac-whiteball&quot;, &quot;fg-whiteball1&quot;, &quot;sh-whiteball&quot;)
+    DefShModel(&quot;ac-whiteball-shine&quot;, &quot;fg-whiteball2&quot;, &quot;sh-whiteball&quot;)
 
-function SpriteAnim(name, images, shadows, framelen, loop)
-    local frames={}
-    local nframes = getn(images)
-    for i=1,getn(images) do
-        def_shmodel(name..i, images[i], shadows[mod (i, getn(shadows))] )
-        table.insert(frames, name..i)
-    end
-    def_anim (name, buildframes(frames, framelen), loop)
-end
+    -- Falling Blackball
+    images = SpriteImages(&quot;ac-blackball-fall&quot;, 10)
+    frames = ComposeFrames(images,{70,65,60,55,50,50,50,50,50,50,50})
+    DefAnim(&quot;ac-blackball-fall&quot;, frames)
+    DefAlias(&quot;ac-blackball-fallen&quot;, &quot;invisible&quot;)
 
-function Sprite(descr)
-    local imgfile = descr.imgfile or descr.name
-    local loop    = descr.loop or false
-    local img     = SpriteImages(imgfile, descr.nimages, 0.5, descr.padding)
-    def_anim(descr.name, buildframes(img, descr.framelen), loop)
-end
+    -- Appearing / disappearing Blackball
+    -- use the images from falling
+    DefAnim(&quot;ac-blackball-appear&quot;, ReverseFrames(BuildFrames(images, 25)))
+    DefAnim(&quot;ac-blackball-disappear&quot;, BuildFrames(images, 25))
 
---------------------------------------------------------------------------------
---                                 ACTOR MODELS                               --
---------------------------------------------------------------------------------
-Progress(0, &quot;Loading sprite models&quot;)
+    -- Falling Whiteball
+    images = SpriteImages(&quot;ac-whiteball-fall&quot;, 10)
+    frames = ComposeFrames(images,{70,65,60,55,50,50,50,50,50,50,50})
+    DefAnim(&quot;ac-whiteball-fall&quot;, frames)
+    DefAlias(&quot;ac-whiteball-fallen&quot;, &quot;invisible&quot;)
 
-------------------
--- Spinning top --
-------------------
-do
-    local img=SpriteImages(&quot;fg-top&quot;, 9, 0.5, 0.3)
-    SpriteImage(&quot;sh-top&quot;, 0.4, 0.3)
+    -- Appearing / disappearing Whiteball
+    -- use the images from falling
+    DefAnim(&quot;ac-whiteball-appear&quot;, ReverseFrames(BuildFrames(images, 25)))
+    DefAnim(&quot;ac-whiteball-disappear&quot;, BuildFrames(images, 25))
 
-    frames={}
-    for i=1,9 do
-        def_shmodel(&quot;ac-top&quot;..i, img[i], &quot;sh-top&quot;)
-        table.insert(frames, &quot;ac-top&quot;..i)
+    -- Jumping Blackball
+    images  = SpriteImages(&quot;ac-blackball-jump&quot;, 4)
+    shadows = SpriteImages(&quot;sh-blackball-jump&quot;, 4, 0.4)
+    frames  = {}
+    for i=1,4 do
+        DefShModel(&quot;bb-jump&quot;..i, images[i], shadows[i])
+        table.insert(frames, &quot;bb-jump&quot;..i)
     end
-    def_anim(&quot;ac-top&quot;, buildframes(frames, 25), true)
-end
+    DefAnim(&quot;ac-blackball-jump&quot;, PingPong(BuildFrames(frames, 70)))
 
------------
--- Rotor --
------------
-do
-    local fg=SpriteImages(&quot;fg-rotor&quot;,9)
-    local bg=SpriteImages(&quot;sh-rotor&quot;, 9, 0.4)
+    -- Jumping Whiteball
+    -- Use shadow from black ball
+    images  = SpriteImages(&quot;ac-whiteball-jump&quot;, 4)
+    frames  = {}
+    for i=1,4 do
+        DefShModel(&quot;wb-jump&quot;..i, images[i], shadows[i])
+        table.insert(frames, &quot;wb-jump&quot;..i)
+    end
+    DefAnim(&quot;ac-whiteball-jump&quot;, PingPong(BuildFrames(frames, 70)))
 
-    frames={}
-    for i=1,9 do
-        def_shmodel(&quot;ac-rotor&quot;..i, fg[i], bg[i])
-        table.insert(frames, &quot;ac-rotor&quot;..i)
+    -- Sinking Blackball
+    shadows = SpriteImages(&quot;sh-blackball-sink&quot;, 7, 0.4)
+    images = SpriteImages(&quot;fg-blackball-sink&quot;, 7)
+    for i=1,table.getn(images) do
+        DefShModel(&quot;ac-blackball-sink&quot;..(i-1), images[i], shadows[i])
     end
-    def_anim(&quot;ac-rotor&quot;, buildframes(frames, 30), true)
-end
+    DefAlias(&quot;ac-blackball-sunk&quot;, &quot;invisible&quot;)
 
------------
--- Horse --
------------
-do
-    SpriteImage (&quot;fg-horse&quot;,0.5,0.18)
-    SpriteImage (&quot;sh-horse&quot;, 0.4)
-    def_shmodel (&quot;ac-horse&quot;, &quot;fg-horse&quot;, &quot;sh-horse&quot;)
+    -- Sinking Whiteball
+    -- Use shadow from black ball
+    images = SpriteImages(&quot;fg-whiteball-sink&quot;, 7)
+    for i=1,table.getn(images) do
+        DefShModel(&quot;ac-whiteball-sink&quot;..(i-1), images[i], shadows[i])
+    end
+    DefAlias(&quot;ac-whiteball-sunk&quot;, &quot;invisible&quot;)
+
+    -- Shattering Blackball
+    Sprite({name=&quot;ac-blackball-shatter&quot;, nimages=5, framelen=60})
+    DefAlias(&quot;ac-blackball-shattered&quot;, &quot;ac-blackball-shatter5&quot;)
+
+    -- Shattering Whiteball
+    Sprite({name=&quot;ac-whiteball-shatter&quot;, nimages=5, framelen=60})
+    DefAlias(&quot;ac-whiteball-shattered&quot;, &quot;ac-whiteball-shatter5&quot;)
 end
 
-----------------------
--- Small white ball --
-----------------------
+-- ac-whiteball-small --
 do
-    local fg,img
+    local images, frames, shadows
 
     -- Normal
     SpriteImage (&quot;sh-whiteball-small&quot;, 0.4, 0.41)
-    SpriteImage (&quot;fg-whiteball-small&quot;, 0.5, 0.43) 
-    def_shmodel(&quot;ac-whiteball-small&quot;, &quot;fg-whiteball-small&quot;, &quot;sh-whiteball-small&quot;)
-    def_alias (&quot;ac-whiteball-small-shine&quot;, &quot;ac-whiteball-small&quot;)
+    SpriteImage (&quot;fg-whiteball-small&quot;, 0.5, 0.43)
+    DefShModel(&quot;ac-whiteball-small&quot;, &quot;fg-whiteball-small&quot;, &quot;sh-whiteball-small&quot;)
+    DefAlias (&quot;ac-whiteball-small-shine&quot;, &quot;ac-whiteball-small&quot;)
 
     -- Falling
-    img=SpriteImages (&quot;ac-whiteball-small-fall&quot;, 5, 0.5, 0.43)
-    table.insert(img, &quot;invisible&quot;)
-    def_anim(&quot;ac-whiteball-small-fall&quot;, composeframes(img,{70,65,60,55,50,30}))
-    def_alias(&quot;ac-whiteball-small-fallen&quot;, &quot;invisible&quot;)
+    images = SpriteImages (&quot;ac-whiteball-small-fall&quot;, 5, 0.5, 0.43)
+    table.insert(images, &quot;invisible&quot;)
+    DefAnim(&quot;ac-whiteball-small-fall&quot;, ComposeFrames(images,{70,65,60,55,50,30}))
+    DefAlias(&quot;ac-whiteball-small-fallen&quot;, &quot;invisible&quot;)
 
     -- Appearing / disappearing
-    def_anim(&quot;ac-whiteball-small-appear&quot;, reverseframes(buildframes(img, 25)))
-    def_anim(&quot;ac-whiteball-small-disappear&quot;, buildframes(img, 25))
+    -- use the images from falling
+    DefAnim(&quot;ac-whiteball-small-appear&quot;, ReverseFrames(BuildFrames(images, 25)))
+    DefAnim(&quot;ac-whiteball-small-disappear&quot;, BuildFrames(images, 25))
 
-    -- Shattering
-    img=SpriteImages (&quot;ac-whiteball-small-shatter&quot;, 5)
-    def_anim(&quot;ac-whiteball-small-shatter&quot;, buildframes(img, 60))
-    SpriteImage (&quot;ac-whiteball-small-shattered&quot;)
-
-
-    -- sinking
-    def_alias (&quot;ac-whiteball-small-sink0&quot;, &quot;ac-whiteball-small-fall1&quot;)
-    def_alias (&quot;ac-whiteball-small-sink1&quot;, &quot;ac-whiteball-small-fall2&quot;)
-    def_alias (&quot;ac-whiteball-small-sink2&quot;, &quot;ac-whiteball-small-fall3&quot;)
-    def_alias (&quot;ac-whiteball-small-sink3&quot;, &quot;ac-whiteball-small-fall4&quot;)
-    def_alias (&quot;ac-whiteball-small-sink4&quot;, &quot;ac-whiteball-small-fall5&quot;)
-    def_alias (&quot;ac-whiteball-small-sink5&quot;, &quot;ac-whiteball-small-fall5&quot;)
-    def_alias (&quot;ac-whiteball-small-sink6&quot;, &quot;ac-whiteball-small-fall5&quot;)
-    def_alias (&quot;ac-whiteball-small-sunk&quot;, &quot;invisible&quot;)
-end
-
--- Jumping small balls --
-do
-    namelist = SpriteImages(&quot;ac-whiteball-small-jump&quot;, 4)
-    shadows  = SpriteImages(&quot;sh-whiteball-small-jump&quot;, 4, 0.4)
-    frames   = {}
+    -- Jumping
+    images  = SpriteImages(&quot;ac-whiteball-small-jump&quot;, 4)
+    shadows = SpriteImages(&quot;sh-whiteball-small-jump&quot;, 4, 0.4)
+    frames  = {}
     for i=1,4 do
-        def_shmodel(&quot;sb-jump&quot;..i, namelist[i], shadows[i])
+        DefShModel(&quot;sb-jump&quot;..i, images[i], shadows[i])
         table.insert(frames, &quot;sb-jump&quot;..i)
     end
-    def_anim(&quot;ac-whiteball-small-jump&quot;, pingpong(buildframes(frames, 70)))
-end
+    DefAnim(&quot;ac-whiteball-small-jump&quot;, PingPong(BuildFrames(frames, 70)))
 
-def_alias(&quot;ac-killerball&quot;, &quot;ac-whiteball-small&quot;)
+    -- sinking
+    DefAlias (&quot;ac-whiteball-small-sink0&quot;, &quot;ac-whiteball-small-fall1&quot;)
+    DefAlias (&quot;ac-whiteball-small-sink1&quot;, &quot;ac-whiteball-small-fall2&quot;)
+    DefAlias (&quot;ac-whiteball-small-sink2&quot;, &quot;ac-whiteball-small-fall3&quot;)
+    DefAlias (&quot;ac-whiteball-small-sink3&quot;, &quot;ac-whiteball-small-fall4&quot;)
+    DefAlias (&quot;ac-whiteball-small-sink4&quot;, &quot;ac-whiteball-small-fall5&quot;)
+    DefAlias (&quot;ac-whiteball-small-sink5&quot;, &quot;ac-whiteball-small-fall5&quot;)
+    DefAlias (&quot;ac-whiteball-small-sink6&quot;, &quot;ac-whiteball-small-fall5&quot;)
+    DefAlias (&quot;ac-whiteball-small-sunk&quot;, &quot;invisible&quot;)
 
--------------------------
--- Balls (both colors) --
--------------------------
+    -- Shattering
+    images = SpriteImages (&quot;ac-whiteball-small-shatter&quot;, 5)
+    DefAnim(&quot;ac-whiteball-small-shatter&quot;, BuildFrames(images, 60))
+    SpriteImage (&quot;ac-whiteball-small-shattered&quot;)
+end
 
--- Shattering
-Sprite{name=&quot;ac-blackball-shatter&quot;, nimages=5, framelen=60}
-Sprite{name=&quot;ac-whiteball-shatter&quot;, nimages=5, framelen=60}
-
--- Sinking
+-- ac-killerball --
 do
-    local img, sh
-
-    sh = SpriteImages(&quot;sh-blackball-sink&quot;, 7, 0.4)
-    img = SpriteImages(&quot;fg-blackball-sink&quot;, 7)
-    for i=1,getn(img) do
-        def_shmodel(&quot;ac-blackball-sink&quot;..(i-1), img[i], sh[i])
-    end
-    def_alias(&quot;ac-blackball-sunk&quot;, &quot;invisible&quot;)
-
-    img=SpriteImages(&quot;fg-whiteball-sink&quot;, 7)
-    for i=1,getn(img) do
-        def_shmodel(&quot;ac-whiteball-sink&quot;..(i-1), img[i], sh[i])
-    end
-    def_alias(&quot;ac-whiteball-sunk&quot;, &quot;invisible&quot;)
+    DefAlias(&quot;ac-killerball&quot;, &quot;ac-whiteball-small&quot;)
 end
 
-
-----------------
--- Black ball --
-----------------
+-- Marbles in inventory  --
 do
-    local img,f,sh
+    DefImage(&quot;inv-blackball&quot;)
+    DefImage(&quot;inv-whiteball&quot;)
+end
 
-    -- Normal
-    sh = SpriteImage(&quot;sh-blackball&quot;, 0.4, 0.29)
-    img = SpriteImages(&quot;fg-blackball&quot;, 2, 0.5, 0.32)
-    def_shmodel(&quot;ac-blackball&quot;, &quot;fg-blackball1&quot;, &quot;sh-blackball&quot;)
-    def_shmodel(&quot;ac-blackball-shine&quot;, &quot;fg-blackball2&quot;, &quot;sh-blackball&quot;)
+----------------------------
+-- not ball-shaped actors --
+----------------------------
 
-    -- Falling
-    img=SpriteImages(&quot;ac-blackball-fall&quot;, 10)
-    f=composeframes(img,{70,65,60,55,50,50,50,50,50,50,50})
-    def_anim(&quot;ac-blackball-fall&quot;, f)
-    def_alias(&quot;ac-blackball-fallen&quot;, &quot;invisible&quot;)
-
-    -- Appearing / disappearing
-    def_anim(&quot;ac-blackball-appear&quot;, reverseframes(buildframes(img, 25)))
-    def_anim(&quot;ac-blackball-disappear&quot;, buildframes(img, 25))
-
-    def_alias(&quot;ac-blackball-shattered&quot;, &quot;ac-blackball-shatter5&quot;)
+-- ac-bug --
+do
+    SpriteImage(&quot;fg-bug&quot;,0.5,0.44)
+    DefShModel(&quot;ac-bug&quot;, &quot;fg-bug&quot;, &quot;sh-whiteball-small&quot;)
 end
 
-
-
-----------------
--- White ball --
-----------------
-
+-- ac-cannonball --
 do
-    local img,f
+    DefAlias(&quot;ac-cannonball&quot;, &quot;ac-blackball-jump&quot;)
+end
 
-    -- Normal
-    def_alias(&quot;sh-whiteball&quot;, &quot;sh-blackball&quot;)
-    img=SpriteImage (&quot;fg-whiteball&quot;, 0.5, 0.32)
---    def_image(&quot;fg-wb&quot;, {filename=&quot;ac-whiteball&quot;, xoff=-9, yoff=-9})
-    def_shmodel(&quot;ac-whiteball&quot;, &quot;fg-whiteball&quot;, &quot;sh-whiteball&quot;)
-    def_alias(&quot;ac-whiteball-shine&quot;, &quot;ac-whiteball&quot;)
-
-    -- Falling
-    img=SpriteImages(&quot;ac-whiteball-fall&quot;, 10)
-    f=composeframes(img,{70,65,60,55,50,50,50,50,50,50,50})
-    def_anim(&quot;ac-whiteball-fall&quot;, f)
-    def_alias(&quot;ac-whiteball-fallen&quot;, &quot;invisible&quot;)
-
-    -- Appearing / disappearing
-    def_anim(&quot;ac-whiteball-appear&quot;, reverseframes(buildframes(img, 25)))
-    def_anim(&quot;ac-whiteball-disappear&quot;, buildframes(img, 25))
-
-    -- Shattering
-
-    def_alias(&quot;ac-whiteball-shattered&quot;, &quot;ac-whiteball-shatter5&quot;)
+-- ac-horse --
+do
+    SpriteImage(&quot;fg-horse&quot;,0.5,0.18)
+    SpriteImage(&quot;sh-horse&quot;, 0.4)
+    DefShModel(&quot;ac-horse&quot;, &quot;fg-horse&quot;, &quot;sh-horse&quot;)
 end
 
--- Jumping normal balls --
+-- ac-rotor --
 do
-    namelist = SpriteImages(&quot;ac-blackball-jump&quot;, 4)
-    shadows  = SpriteImages(&quot;sh-blackball-jump&quot;, 4, 0.4)
-    frames   = {}
-    for i=1,4 do
-        def_shmodel(&quot;bb-jump&quot;..i, namelist[i], shadows[i])
-        table.insert(frames, &quot;bb-jump&quot;..i)
-    end
-    def_anim(&quot;ac-blackball-jump&quot;, pingpong(buildframes(frames, 70)))
+    local fg = SpriteImages(&quot;fg-rotor&quot;,9)
+    local bg = SpriteImages(&quot;sh-rotor&quot;, 9, 0.4)
 
-    namelist = SpriteImages(&quot;ac-whiteball-jump&quot;, 4)
-    frames   = {}
-    for i=1,4 do
-        def_shmodel(&quot;wb-jump&quot;..i, namelist[i], shadows[i])
-        table.insert(frames, &quot;wb-jump&quot;..i)
+    frames = {}
+    for i=1,9 do
+        DefShModel(&quot;ac-rotor&quot;..i, fg[i], bg[i])
+        table.insert(frames, &quot;ac-rotor&quot;..i)
     end
-    def_anim(&quot;ac-whiteball-jump&quot;, pingpong(buildframes(frames, 70)))
+    DefAnim(&quot;ac-rotor&quot;, BuildFrames(frames, 30), true)
 end
 
-----------------
--- Cannonball --
-----------------
-
-def_alias (&quot;ac-cannonball&quot;, &quot;ac-blackball-jump&quot;)
-
-
-
----------
--- Bug --
----------
+-- ac-top --
 do
-    SpriteImage(&quot;fg-bug&quot;,0.5,0.44)
-    def_shmodel(&quot;ac-bug&quot;, &quot;fg-bug&quot;, &quot;sh-whiteball-small&quot;)
+    local fg = SpriteImages(&quot;fg-top&quot;, 9, 0.5, 0.3)
+    local bg = SpriteImage(&quot;sh-top&quot;, 0.4, 0.3)
+
+    frames = {}
+    for i=1,9 do
+        DefShModel(&quot;ac-top&quot;..i, fg[i], bg)
+        table.insert(frames, &quot;ac-top&quot;..i)
+    end
+    DefAnim(&quot;ac-top&quot;, BuildFrames(frames, 25), true)
 end
 
--- Marbles in inventory  --
-def_image(&quot;inv-blackball&quot;)
-def_image(&quot;inv-whiteball&quot;)
-
-
 --------------------------------------------------------------------------------
 --                                Floor models                                --
 --------------------------------------------------------------------------------
-Progress(10, &quot;Loading floor models&quot;)
+Progress(15, &quot;Loading floor models&quot;)
 
-function def_floors(floorlist)
-    for i,name in pairs(floorlist) do
-	def_image(name)
-    end
+------------------------
+-- single tile floors --
+------------------------
+do
+    floorlist = {
+        &quot;fl-abyss&quot;,
+        &quot;fl-acblack&quot;,
+        &quot;fl-acwhite&quot;,
+        &quot;fl-black&quot;,
+        &quot;fl-bluegreen&quot;,
+        &quot;fl-darkgray&quot;,
+        &quot;fl-dummy&quot;,
+        &quot;fl-dunes&quot;,
+        &quot;fl-floor_001&quot;,
+        &quot;fl-ice&quot;,
+        &quot;fl-inverse&quot;,
+        &quot;fl-inverse2&quot;,
+        &quot;fl-light&quot;,
+        &quot;fl-lightgray&quot;,
+        &quot;fl-nomouse&quot;,
+        &quot;fl-normal&quot;,
+        &quot;fl-sand&quot;,
+        &quot;fl-stone&quot;,
+        &quot;fl-springboard&quot;,
+        &quot;fl-trigger&quot;,
+        &quot;fl-white&quot;,
+    }
+
+    DefImages(floorlist)
 end
 
-function def_randfloor(name, imagelist)
-    def_floors(imagelist)
-    display.DefineRandModel(name, getn(imagelist), imagelist)
+-----------------------------------------
+-- Floors with multiple (random) tiles --
+-----------------------------------------
+do
+    DefSubimages(&quot;fl-gradient2&quot;, {w=6, h=4, modelname=&quot;fl-gradient&quot;})
+
+    DefRandFloorSi(&quot;fl-bluegray&quot;, 4)
+    DefRandFloorSi(&quot;fl-bluegreenx&quot;, 2)
+    DefRandFloorSi(&quot;fl-brick&quot;, 3)
+    DefRandFloorSi(&quot;fl-bumps&quot;, 2,2)
+    DefRandFloorSi(&quot;fl-concrete&quot;, 4)
+    DefRandFloorSi(&quot;fl-gravel&quot;, 4)
+    DefRandFloorSi(&quot;fl-gray&quot;, 5)
+    DefRandFloorSi(&quot;fl-hay&quot;, 4)
+    DefRandFloorSi(&quot;fl-himalaya&quot;, 4)
+    DefRandFloorSi(&quot;fl-marble&quot;, 4)
+    DefRandFloorSi(&quot;fl-metal&quot;, 6)
+    DefRandFloorSi(&quot;fl-mortar&quot;, 2, 2)
+    DefRandFloorSi(&quot;fl-plank&quot;, 4)
+    DefRandFloorSi(&quot;fl-red&quot;, 4)
+    DefRandFloorSi(&quot;fl-rock&quot;, 2)
+    DefRandFloorSi(&quot;fl-rough&quot;, 5)
+    DefRandFloorSi(&quot;fl-rough-blue&quot;, 4)
+    DefRandFloorSi(&quot;fl-rough-red&quot;, 4)
+    DefRandFloorSi(&quot;fl-sahara&quot;, 4)
+    DefRandFloorSi(&quot;fl-samba&quot;, 2)
+    DefRandFloorSi(&quot;fl-space&quot;, 3,2)
+    DefRandFloorSi(&quot;fl-stwood&quot;, 2)
+    DefRandFloorSi(&quot;fl-swamp&quot;, 4)
+    DefRandFloorSi(&quot;fl-tigris&quot;, 4)
+    DefRandFloorSi(&quot;fl-water&quot;, 4)
+    DefRandFloorSi(&quot;fl-woven&quot;, 5)
 end
 
--- _si for _subimage
-function def_randfloor_si(name, height, width)
-    imagelist=def_subimages(name, {h=height, w=width})
-    display.DefineRandModel(name, getn(imagelist), imagelist)
+-- leaves --
+do
+    DefSubimages(&quot;fl-leaves&quot;, {w=10, h=2, modelname=&quot;fl-leavesx&quot;})
+    DefRandFloor(&quot;fl-leaves&quot;, {&quot;fl-leavesx1&quot;, &quot;fl-leavesx2&quot;, &quot;fl-leavesx3&quot;, &quot;fl-leavesx4&quot;})
+    DefRandFloor(&quot;fl-leavesb&quot;, {&quot;fl-leavesx5&quot;, &quot;fl-leavesx6&quot;, &quot;fl-leavesx7&quot;, &quot;fl-leavesx8&quot;})
+    DefAlias(&quot;fl-leavesc1&quot;, &quot;fl-leavesx9&quot;)
+    DefAlias(&quot;fl-leavesc2&quot;, &quot;fl-leavesx10&quot;)
+    DefAlias(&quot;fl-leavesc3&quot;, &quot;fl-leavesx11&quot;)
+    DefAlias(&quot;fl-leavesc4&quot;, &quot;fl-leavesx12&quot;)
+    DefAlias(&quot;fl-leavesd1&quot;, &quot;fl-leavesx13&quot;)
+    DefAlias(&quot;fl-leavesd2&quot;, &quot;fl-leavesx14&quot;)
+    DefAlias(&quot;fl-leavesd3&quot;, &quot;fl-leavesx15&quot;)
+    DefAlias(&quot;fl-leavesd4&quot;, &quot;fl-leavesx16&quot;)
+    DefAlias(&quot;fl-leavese1&quot;, &quot;fl-leavesx17&quot;)
+    DefAlias(&quot;fl-leavese2&quot;, &quot;fl-leavesx18&quot;)
+    DefAlias(&quot;fl-leavese3&quot;, &quot;fl-leavesx19&quot;)
+    DefAlias(&quot;fl-leavese4&quot;, &quot;fl-leavesx20&quot;)
 end
 
---if options.WizardMode &gt; 0 then
---    def_subimages(&quot;fl-gradient-wiz&quot;, {modelname=&quot;fl-gradient&quot;,w=6, h=4})
---else
-def_subimages(&quot;fl-gradient2&quot;, {w=6, h=4, modelname=&quot;fl-gradient&quot;})
---end
-
+-- wooden floor --
 do
-    def_subimages(&quot;fl-leaves&quot;, {w=10, h=2, modelname=&quot;fl-leavesx&quot;})
-    display.DefineRandModel(&quot;fl-leaves&quot;, 4, {&quot;fl-leavesx1&quot;, &quot;fl-leavesx2&quot;, &quot;fl-leavesx3&quot;, &quot;fl-leavesx4&quot;})
-    display.DefineRandModel(&quot;fl-leavesb&quot;, 4, {&quot;fl-leavesx5&quot;, &quot;fl-leavesx6&quot;, &quot;fl-leavesx7&quot;, &quot;fl-leavesx8&quot;})
-    def_alias(&quot;fl-leavesc1&quot;, &quot;fl-leavesx9&quot;)
-    def_alias(&quot;fl-leavesc2&quot;, &quot;fl-leavesx10&quot;)
-    def_alias(&quot;fl-leavesc3&quot;, &quot;fl-leavesx11&quot;)
-    def_alias(&quot;fl-leavesc4&quot;, &quot;fl-leavesx12&quot;)
-    def_alias(&quot;fl-leavesd1&quot;, &quot;fl-leavesx13&quot;)
-    def_alias(&quot;fl-leavesd2&quot;, &quot;fl-leavesx14&quot;)
-    def_alias(&quot;fl-leavesd3&quot;, &quot;fl-leavesx15&quot;)
-    def_alias(&quot;fl-leavesd4&quot;, &quot;fl-leavesx16&quot;)
-    def_alias(&quot;fl-leavese1&quot;, &quot;fl-leavesx17&quot;)
-    def_alias(&quot;fl-leavese2&quot;, &quot;fl-leavesx18&quot;)
-    def_alias(&quot;fl-leavese3&quot;, &quot;fl-leavesx19&quot;)
-    def_alias(&quot;fl-leavese4&quot;, &quot;fl-leavesx20&quot;)
+    DefSubimages(&quot;fl-wood&quot;, {w=1, h=4, modelname=&quot;fl-woodx&quot;})
+    DefRandFloor(&quot;fl-wood&quot;, {&quot;fl-woodx1&quot;, &quot;fl-woodx2&quot;, &quot;fl-woodx3&quot;, &quot;fl-woodx4&quot;})
+    DefRandFloor(&quot;fl-wood1&quot;, {&quot;fl-woodx3&quot;, &quot;fl-woodx4&quot;})
+    DefRandFloor(&quot;fl-wood2&quot;, {&quot;fl-woodx1&quot;, &quot;fl-woodx2&quot;})
 end
 
--- To get different wood tiles with horizontal or vertical slats.
--- Each floortype has got 2 random images.
+--------------------------
+-- Simple floor aliases --
+--------------------------
 do
-    def_subimages(&quot;fl-wood&quot;, {w=1, h=4, modelname=&quot;fl-woodx&quot;})
-    display.DefineRandModel(&quot;fl-wood&quot;, 4, {&quot;fl-woodx1&quot;, &quot;fl-woodx2&quot;, &quot;fl-woodx3&quot;, &quot;fl-woodx4&quot;})
-    display.DefineRandModel(&quot;fl-wood1&quot;, 2, {&quot;fl-woodx3&quot;, &quot;fl-woodx4&quot;})
-    display.DefineRandModel(&quot;fl-wood2&quot;, 2, {&quot;fl-woodx1&quot;, &quot;fl-woodx2&quot;})
+    DefAlias(&quot;fl-abyss_fake&quot;, &quot;fl-abyss&quot;)
+    DefAlias(&quot;fl-normal_x&quot;, &quot;fl-normal&quot;)
+    DefAlias(&quot;fl-rough_medium&quot;, &quot;fl-rough&quot;)
+    DefAlias(&quot;fl-rough_slow&quot;, &quot;fl-rough&quot;)
+    DefAlias(&quot;fl-space-force&quot;, &quot;fl-space&quot;)
 end
 
-def_randfloor(&quot;fl-rock&quot;, {&quot;fl-rock1&quot;, &quot;fl-rock2&quot;})
-def_floors{&quot;fl-abyss&quot;}
-def_alias(&quot;fl-abyss_fake&quot;, &quot;fl-abyss&quot;)
-def_floors{&quot;fl-dunes&quot;, &quot;fl-sand&quot;, &quot;fl-bluegreen&quot;, &quot;fl-bluegreenx&quot;}
-def_floors{&quot;fl-inverse&quot;, &quot;fl-inverse2&quot;, &quot;fl-white&quot;, &quot;fl-black&quot;, &quot;fl-acwhite&quot;, &quot;fl-acblack&quot;}
-def_floors{&quot;fl-springboard&quot;}
-def_image(&quot;fl-normal&quot;)
-def_randfloor_si(&quot;fl-hay&quot;, 4)
-def_floors{&quot;fl-floor_001&quot;}
-def_floors{&quot;fl-ice&quot;}
-def_floors{&quot;fl-stone&quot;}
-def_alias(&quot;fl-normal_x&quot;, &quot;fl-normal&quot;)
-def_floors{&quot;fl-dummy&quot;}
-def_floors{&quot;fl-light&quot;, &quot;fl-lightgray&quot;, &quot;fl-darkgray&quot;}
-def_floors{&quot;fl-trigger&quot;}
-def_randfloor_si(&quot;fl-concrete&quot;, 4)
-def_randfloor_si(&quot;fl-gravel&quot;, 4)
-def_randfloor_si(&quot;fl-bumps&quot;, 2,2)
-def_randfloor_si(&quot;fl-mortar&quot;, 2, 2)
+----------------------
+-- Floor animations --
+----------------------
 
-def_randfloor_si(&quot;fl-brick&quot;, 3)
+-- bridges --
+do
+    DefImage(&quot;fl-bridgea-open&quot;)
+    DefImage(&quot;fl-bridgea-closed&quot;)
+    local namelist=DefSubimages(&quot;fl-bridgea&quot;, {h=10})
+    local frames = BuildFrames(namelist,70)
+    DefAnim(&quot;fl-bridgea-opening&quot;, ReverseFrames(frames))
+    DefAnim(&quot;fl-bridgea-closing&quot;, frames)
+end
 
-def_randfloor_si(&quot;fl-space&quot;, 3,2)
-def_alias(&quot;fl-space-force&quot;, &quot;fl-space&quot;)
+do
+    DefImage(&quot;fl-bridgex-open&quot;)
+    DefImage(&quot;fl-bridgex-closed&quot;)
+    local namelist=DefSubimages(&quot;fl-bridgex&quot;, {h=9})
+    local frames = BuildFrames(namelist,70)
+    DefAnim(&quot;fl-bridgex-opening&quot;, frames)
+    DefAnim(&quot;fl-bridgex-closing&quot;, ReverseFrames(frames))
+end
 
-def_randfloor_si(&quot;fl-rough&quot;, 5)
-def_alias(&quot;fl-rough_medium&quot;, &quot;fl-rough&quot;)
-def_alias(&quot;fl-rough_slow&quot;, &quot;fl-rough&quot;)
-def_randfloor_si(&quot;fl-gray&quot;, 5)
-def_randfloor_si(&quot;fl-metal&quot;, 6)
-def_randfloor_si(&quot;fl-plank&quot;, 4)
-def_randfloor_si(&quot;fl-water&quot;, 4)
-def_randfloor_si(&quot;fl-swamp&quot;, 4)
-def_randfloor_si(&quot;fl-woven&quot;, 5)
-def_randfloor_si(&quot;fl-marble&quot;, 4)
---def_subimages(&quot;fl-stwood&quot;, {h=2})
-def_randfloor_si(&quot;fl-stwood&quot;, 2)
-def_randfloor_si(&quot;fl-bluegray&quot;, 4)
-def_randfloor_si(&quot;fl-red&quot;, 4)
-def_randfloor_si(&quot;fl-rough-blue&quot;, 4)
-def_randfloor_si(&quot;fl-rough-red&quot;, 4)
-def_randfloor_si(&quot;fl-sahara&quot;, 4)
-def_randfloor_si(&quot;fl-tigris&quot;, 4)
-def_randfloor_si(&quot;fl-samba&quot;, 2)
-def_randfloor_si(&quot;fl-himalaya&quot;, 4)
-def_floors{&quot;fl-nomouse&quot;}
+do
+    DefImage(&quot;fl-bridgey-open&quot;)
+    DefImage(&quot;fl-bridgey-closed&quot;)
+    local namelist=DefSubimages(&quot;fl-bridgey&quot;, {h=9})
+    local frames = BuildFrames(namelist,70)
+    DefAnim(&quot;fl-bridgey-opening&quot;, frames)
+    DefAnim(&quot;fl-bridgey-closing&quot;, ReverseFrames(frames))
+end
 
---
--- Bridges
---
-def_image(&quot;fl-bridgea-open&quot;)
-def_image(&quot;fl-bridgea-closed&quot;)
-namelist=def_subimages(&quot;fl-bridgea&quot;, {h=10})
-frames = buildframes(namelist,70)
-def_anim(&quot;fl-bridgea-opening&quot;, reverseframes(frames))
-def_anim(&quot;fl-bridgea-closing&quot;, frames)
-
-
-def_image(&quot;fl-bridgex-open&quot;)
-def_image(&quot;fl-bridgex-closed&quot;)
-namelist=def_subimages(&quot;fl-bridgex&quot;, {h=9})
-frames = buildframes(namelist,70)
-def_anim(&quot;fl-bridgex-opening&quot;, frames)
-def_anim(&quot;fl-bridgex-closing&quot;, reverseframes(frames))
-
-
-def_image(&quot;fl-bridgey-open&quot;)
-def_image(&quot;fl-bridgey-closed&quot;)
-namelist=def_subimages(&quot;fl-bridgey&quot;, {h=9})
-frames = buildframes(namelist,70)
-def_anim(&quot;fl-bridgey-opening&quot;, frames)
-def_anim(&quot;fl-bridgey-closing&quot;, reverseframes(frames))
-
 ------------------------
 -- Heating animations --
 ------------------------
+do
+    function heating_animation(basemodel)
+        local images = DefSubimages(basemodel..&quot;-heating&quot;, {h=8});
+        local frames = BuildFrames(images, 240)
+        DefAnim(basemodel..&quot;-heating&quot;, frames);
+    end
 
-function heating_animation(basemodel)
-    local img = def_subimages(basemodel..&quot;-heating&quot;, {h=8});    
-    local f = buildframes(img, 240)
-    def_anim(basemodel..&quot;-heating&quot;, f);
+    heating_animation(&quot;fl-ice&quot;)
+    heating_animation(&quot;fl-water&quot;)
+    heating_animation(&quot;fl-swamp&quot;)
 end
 
-heating_animation(&quot;fl-ice&quot;)
-heating_animation(&quot;fl-water&quot;)
-heating_animation(&quot;fl-swamp&quot;)
-
-
 --------------------------------------------------------------------------------
 --                                ITEM MODELS                                 --
 --------------------------------------------------------------------------------
-Progress(20, &quot;Loading item models&quot;)
+Progress(25, &quot;Loading item models&quot;)
 ------------------------------------------------------
 -- Single-Image-Items, non animated, e.g. it-banana --
 ------------------------------------------------------
 
-itemlist = {
-    &quot;it-bag&quot;,
-    &quot;it-banana&quot;,
-    &quot;it-blackbomb&quot;,
-    &quot;it-blocker&quot;,
-    &quot;it-booze&quot;,
-    &quot;it-booze-broken&quot;,
-    &quot;it-brush&quot;,
-    &quot;it-cherry&quot;,
-    &quot;it-coin1&quot;,
-    &quot;it-coin2&quot;,
-    &quot;it-coin4&quot;,
-    &quot;it-cross&quot;,
-    &quot;it-document&quot;,
-    &quot;it-drop&quot;,
-    &quot;it-dummy&quot;,
-    &quot;it-dynamite&quot;,
-    &quot;it-extralife&quot;,
-    &quot;it-flagblack&quot;,
-    &quot;it-flagwhite&quot;,
-    &quot;it-floppy&quot;,
-    &quot;it-glasses&quot;,
-    &quot;it-glasses-broken&quot;,
-    &quot;it-hammer&quot;,
-    &quot;it-hill&quot;,
-    &quot;it-hollow&quot;,
-    &quot;it-hstrip&quot;,
-    &quot;it-key&quot;,
-    &quot;it-landmine&quot;,
-    &quot;it-magicwand&quot;,
-    &quot;it-odometer&quot;,
-    &quot;it-pencil&quot;,
-    &quot;it-pin&quot;,
-    &quot;it-ring&quot;,
-    &quot;it-rubberband&quot;,
-    &quot;it-spade&quot;,
-    &quot;it-spoon&quot;,
-    &quot;it-squashed&quot;,
-    &quot;it-spring1&quot;,
-    &quot;it-spring2&quot;,
-    &quot;it-surprise&quot;,
-    &quot;it-sword&quot;,
-    &quot;it-tinyhill&quot;,
-    &quot;it-tinyhollow&quot;,
-    &quot;it-umbrella&quot;,
-    &quot;it-vstrip&quot;,
-    &quot;it-weight&quot;,
-    &quot;it-whitebomb&quot;,
-    &quot;it-wrench&quot;
-}
+do
+    itemlist = {
+        &quot;it-bag&quot;,
+        &quot;it-banana&quot;,
+        &quot;it-blackbomb&quot;,
+        &quot;it-blocker&quot;,
+        &quot;it-booze&quot;,
+        &quot;it-booze-broken&quot;,
+        &quot;it-brush&quot;,
+        &quot;it-cherry&quot;,
+        &quot;it-coin1&quot;,
+        &quot;it-coin2&quot;,
+        &quot;it-coin4&quot;,
+        &quot;it-cross&quot;,
+        &quot;it-document&quot;,
+        &quot;it-drop&quot;,
+        &quot;it-dummy&quot;,
+        &quot;it-dynamite&quot;,
+        &quot;it-extralife&quot;,
+        &quot;it-flagblack&quot;,
+        &quot;it-flagwhite&quot;,
+        &quot;it-floppy&quot;,
+        &quot;it-glasses&quot;,
+        &quot;it-glasses-broken&quot;,
+        &quot;it-hammer&quot;,
+        &quot;it-hill&quot;,
+        &quot;it-hollow&quot;,
+        &quot;it-hstrip&quot;,
+        &quot;it-key&quot;,
+        &quot;it-landmine&quot;,
+        &quot;it-magicwand&quot;,
+        &quot;it-odometer&quot;,
+        &quot;it-pencil&quot;,
+        &quot;it-pin&quot;,
+        &quot;it-ring&quot;,
+        &quot;it-rubberband&quot;,
+        &quot;it-spade&quot;,
+        &quot;it-spoon&quot;,
+        &quot;it-squashed&quot;,
+        &quot;it-spring1&quot;,
+        &quot;it-spring2&quot;,
+        &quot;it-surprise&quot;,
+        &quot;it-sword&quot;,
+        &quot;it-tinyhill&quot;,
+        &quot;it-tinyhollow&quot;,
+        &quot;it-umbrella&quot;,
+        &quot;it-vstrip&quot;,
+        &quot;it-weight&quot;,
+        &quot;it-whitebomb&quot;,
+        &quot;it-wrench&quot;
+    }
 
-def_images(itemlist)
+    DefImages(itemlist)
 
--- Aliases:
-def_alias(&quot;it-key_a&quot;, &quot;it-key&quot;)
-def_alias(&quot;it-key_b&quot;, &quot;it-key&quot;)
-def_alias(&quot;it-key_c&quot;, &quot;it-key&quot;)
+    DefImage(&quot;it-brake&quot;, {filename=&quot;st-brake&quot;})
+end
 
--- def_alias(&quot;it-bridge-oxyd&quot;, &quot;invisible&quot;)
--- def_alias(&quot;it-sensor&quot;, &quot;invisible&quot;)
--- def_alias(&quot;it-inversesensor&quot;, &quot;invisible&quot;)
+-------------------------
+-- Simple item aliases --
+-------------------------
 
+do
+    DefAlias(&quot;it-key_a&quot;, &quot;it-key&quot;)
+    DefAlias(&quot;it-key_b&quot;, &quot;it-key&quot;)
+    DefAlias(&quot;it-key_c&quot;, &quot;it-key&quot;)
+    -- DefAlias(&quot;it-bridge-oxyd&quot;, &quot;invisible&quot;)
+    -- DefAlias(&quot;it-sensor&quot;, &quot;invisible&quot;)
+    -- DefAlias(&quot;it-inversesensor&quot;, &quot;invisible&quot;)
+end
+
 --------------------------------------------------------------
 -- Multiple-Image-Items, non animated, e.g. it-nurnable-oil --
 --------------------------------------------------------------
 
 -- it-extinguisher --
 do
-    local img = def_subimages(&quot;it-extinguisher&quot;, {h=3})
-    def_alias(&quot;it-extinguisher&quot;, img[1])
-    def_alias(&quot;it-extinguisher_medium&quot;, img[2])
-    def_alias(&quot;it-extinguisher_empty&quot;, img[3])
+    DefTiles(&quot;it-extinguisher&quot;, {&quot;it-extinguisher&quot;, &quot;it-extinguisher_medium&quot;, &quot;it-extinguisher_empty&quot;})
 end
 
 -- Oil --
-def_subimages(&quot;it-burnable_oil&quot;, {h=4})
+do
+    DefSubimages(&quot;it-burnable_oil&quot;, {h=4})
+end
 
 -- Laserbeams --
 do
-    local img = def_subimages(&quot;it-laser&quot;, {h=3})
-    def_alias(&quot;it-laserh&quot;, img[1])
-    def_alias(&quot;it-laserv&quot;, img[2])
-    def_alias(&quot;it-laserhv&quot;, img[3])
+    DefTiles(&quot;it-laser&quot;, {&quot;it-laserh&quot;, &quot;it-laserv&quot;, &quot;it-laserhv&quot;})
 end
 
 -- it-pipe --
-DefineTiles(&quot;it-pipe&quot;, {&quot;it-pipe-e&quot;, &quot;it-pipe-s&quot;, &quot;it-pipe-es&quot;, &quot;it-pipe-sw&quot;, &quot;it-pipe-h&quot;,
-                        &quot;it-pipe-w&quot;, &quot;it-pipe-n&quot;, &quot;it-pipe-ne&quot;, &quot;it-pipe-wn&quot;, &quot;it-pipe-v&quot;})
-
--- it-puller --
 do
-    local img = def_subimages(&quot;it-puller&quot;, {h=4})
-    def_alias(&quot;it-puller-n&quot;, img[1])
-    def_alias(&quot;it-puller-e&quot;, img[2])
-    def_alias(&quot;it-puller-s&quot;, img[3])
-    def_alias(&quot;it-puller-w&quot;, img[4])
+    DefTiles(&quot;it-pipe&quot;, {&quot;it-pipe-e&quot;, &quot;it-pipe-s&quot;, &quot;it-pipe-es&quot;, &quot;it-pipe-sw&quot;, &quot;it-pipe-h&quot;,
+                            &quot;it-pipe-w&quot;, &quot;it-pipe-n&quot;, &quot;it-pipe-ne&quot;, &quot;it-pipe-wn&quot;, &quot;it-pipe-v&quot;})
 end
 
 -- it-trigger --
 do
--- Why does this not work??
---    img = def_subimages(&quot;it-trigger&quot;, {h=2})
---    def_alias(&quot;it-trigger&quot;, img[1])
---    def_alias(&quot;it-trigger1&quot;, img[2])
-    DefineTiles(&quot;it-trigger&quot;, {&quot;it-trigger&quot;,&quot;it-trigger1&quot;})
+    DefTiles(&quot;it-trigger&quot;, {&quot;it-trigger&quot;,&quot;it-trigger1&quot;})
 end
 
 -- it-yinyang --
 do
-    local img = def_subimages(&quot;it-yinyang&quot;, {h=2})
-    def_alias(&quot;it-yinyang&quot;, img[1])
-    def_alias(&quot;it-yanying&quot;, img[2])
+    DefTiles(&quot;it-yinyang&quot;, {&quot;it-yinyang&quot;, &quot;it-yanying&quot;})
 end
 
 ----------------------------------------
@@ -556,419 +495,664 @@
 ----------------------------------------
 
 -- Burning black bomb --
-img = def_subimages(&quot;it-blackbomb-burning&quot;, {h=9})
-frames = buildframes(img, 100)
-def_anim(&quot;it-blackbomb-burning&quot;, frames) --repeat_frames(frames,3,2))
+do
+    local images = DefSubimages(&quot;it-blackbomb-burning&quot;, {h=9})
+    local frames = BuildFrames(images, 100)
+    DefAnim(&quot;it-blackbomb-burning&quot;, frames)
+end
 
--- Burning black bomb --
-img = def_subimages(&quot;it-whitebomb-burning&quot;, {h=9})
-frames = buildframes(img, 100)
-def_anim(&quot;it-whitebomb-burning&quot;, frames) --repeat_frames(frames,3,2))
+-- Burning white bomb --
+do
+    local images = DefSubimages(&quot;it-whitebomb-burning&quot;, {h=9})
+    local frames = BuildFrames(images, 100)
+    DefAnim(&quot;it-whitebomb-burning&quot;, frames)
+end
 
 -- Burning dynamite --
-img = def_subimages(&quot;it-dynamite-burning&quot;, {h=15})
-frames = buildframes(img, 100)
-def_anim(&quot;it-dynamite-burning&quot;, frames) --repeat_frames(dyn_frames,3,2))
+do
+    local images = DefSubimages(&quot;it-dynamite-burning&quot;, {h=15})
+    local frames = BuildFrames(images, 100)
+    DefAnim(&quot;it-dynamite-burning&quot;, frames)
+end
 
 -- Burning Floor --
 do
-    local img = def_subimages(&quot;it-burnable_ignite&quot;, {h=8})
-    local frames = buildframes(img, 100)
-    def_anim(&quot;it-burnable_ignited&quot;, frames)
+    local images = DefSubimages(&quot;it-burnable_ignite&quot;, {h=8})
+    local frames = BuildFrames(images, 100)
+    DefAnim(&quot;it-burnable_ignited&quot;, frames)
 
-    img = def_subimages(&quot;it-burnable_burning&quot;, {h=8})
-    frames = buildframes(img, 100)
-    def_anim(&quot;it-burnable_burning&quot;, frames)
+    local images = DefSubimages(&quot;it-burnable_burning&quot;, {h=8})
+    local frames = BuildFrames(images, 100)
+    DefAnim(&quot;it-burnable_burning&quot;, frames)
 
-    -- Simple items:
-    def_images({&quot;it-burnable_ash&quot;, &quot;it-burnable_fireproof&quot;})
-    def_alias(&quot;it-burnable&quot;, &quot;invisible&quot;)
+    -- Simple fire related items:
+    DefImages({&quot;it-burnable_ash&quot;, &quot;it-burnable_fireproof&quot;})
+    DefAlias(&quot;it-burnable&quot;, &quot;invisible&quot;)
 end
 
 -- it-coffee --
 do
-    local n = def_subimages(&quot;it-coffee&quot;, {h=4})
-    local frames = buildframes(n,150)
-    def_anim(&quot;it-coffee&quot;, frames, true)
+    local images = DefSubimages(&quot;it-coffee&quot;, {h=4})
+    local frames = BuildFrames(images,150)
+    DefAnim(&quot;it-coffee&quot;, frames, true)
 end
 
 -- Cracks --
 do
-    namelist = def_subimages(&quot;it-crack&quot;, {h=8})
-    --frames=buildframes({&quot;it-crack4&quot;, &quot;it-crack6&quot;, &quot;it-crack7&quot;, &quot;it-crack8&quot;},90)
-    frames = buildframes(namelist,50)
-    def_anim(&quot;it-debris&quot;, frames)
+    local images = DefSubimages(&quot;it-crack&quot;, {h=8})
+    local frames = BuildFrames(images,50)
+    DefAnim(&quot;it-debris&quot;, frames)
 
-    frames = buildframes({&quot;it-crack4&quot;, &quot;it-crack5&quot;},120)
-    def_anim(&quot;it-crack_anim1&quot;, frames)
+    local frames = BuildFrames({&quot;it-crack4&quot;, &quot;it-crack5&quot;},120)
+    DefAnim(&quot;it-crack_anim1&quot;, frames)
 
-    frames = buildframes({&quot;it-crack6&quot;, &quot;it-crack7&quot;, &quot;it-crack8&quot;},120)
-    def_anim(&quot;it-crack_anim2&quot;, frames)
+    local frames = BuildFrames({&quot;it-crack6&quot;, &quot;it-crack7&quot;, &quot;it-crack8&quot;},120)
+    DefAnim(&quot;it-crack_anim2&quot;, frames)
 end
 
 -- it-death --
 do
-    local img = def_subimages(&quot;it-death&quot;, {h=4})
-    def_alias(&quot;it-death&quot;, img[1])
-    def_anim(&quot;it-death-anim&quot;, buildframes(img, 100))
+    local images = DefSubimages(&quot;it-death&quot;, {h=4})
+    DefAlias(&quot;it-death&quot;, images[1])
+    DefAnim(&quot;it-death-anim&quot;, BuildFrames(images, 100))
 end
 
 -- Explosion --
-def_anim_images(&quot;expl&quot;, {{&quot;expl&quot;, 50}})
-def_alias(&quot;it-explosion1&quot;, &quot;expl&quot;)
-def_alias(&quot;it-explosion2&quot;, &quot;expl&quot;)
-def_alias(&quot;it-explosion3&quot;, &quot;expl&quot;)
+do
+    DefAnimImages(&quot;expl&quot;, {{&quot;expl&quot;, 50}})
+    DefAlias(&quot;it-explosion1&quot;, &quot;expl&quot;)
+    DefAlias(&quot;it-explosion2&quot;, &quot;expl&quot;)
+    DefAlias(&quot;it-explosion3&quot;, &quot;expl&quot;)
+end
 
 -- it-magnet --
-def_image(&quot;it-magnet-off&quot;)
-img = def_subimages(&quot;it-magnet-on&quot;, {h=5})
-frames = buildframes(img, 100)
-def_anim(&quot;it-magnet-on&quot;, frames, 1)
+do
+    DefImage(&quot;it-magnet-off&quot;)
+    local images = DefSubimages(&quot;it-magnet-on&quot;, {h=5})
+    local frames = BuildFrames(images, 100)
+    DefAnim(&quot;it-magnet-on&quot;, frames, 1)
+end
 
 -- it-puller --
 do
-    local img = {&quot;it-puller-n&quot;, &quot;it-puller-e&quot;, &quot;it-puller-s&quot;, &quot;it-puller-w&quot;}
-    local frames = buildframes(img, 100)
-    def_anim(&quot;it-puller-active&quot;, repeatanim(frames, 4), false)
+    local images = {&quot;it-puller-n&quot;, &quot;it-puller-e&quot;, &quot;it-puller-s&quot;, &quot;it-puller-w&quot;}
+    DefTiles(&quot;it-puller&quot;, images)
+    local frames = BuildFrames(images, 100)
+    DefAnim(&quot;it-puller-active&quot;, RepeatAnim(frames, 4), false)
 end
 
 -- it-seed --
 do
-    local n = def_subimages(&quot;it-seed&quot;, {h=5})
-    def_alias(&quot;it-seed&quot;, &quot;it-seed1&quot;)
-    def_alias(&quot;it-seed_nowood&quot;, &quot;it-seed&quot;)
-    def_alias(&quot;it-seed_volcano&quot;, &quot;it-seed&quot;)
+    local images = DefSubimages(&quot;it-seed&quot;, {h=5})
+    DefAlias(&quot;it-seed&quot;, &quot;it-seed1&quot;)
+    DefAlias(&quot;it-seed_nowood&quot;, &quot;it-seed1&quot;)
+    DefAlias(&quot;it-seed_volcano&quot;, &quot;it-seed1&quot;)
     local frames = {
         &quot;it-seed1&quot;, &quot;it-seed2&quot;, &quot;it-seed1&quot;, &quot;it-seed3&quot;, &quot;it-seed1&quot;, &quot;it-seed2&quot;,
         &quot;it-seed1&quot;, &quot;it-seed4&quot;, &quot;it-seed5&quot;, &quot;it-seed4&quot;, &quot;it-seed1&quot;,
         &quot;it-seed4&quot;, &quot;it-seed5&quot;,
     }
-    def_anim(&quot;it-seed-growing&quot;, buildframes(frames, 120))
+    DefAnim(&quot;it-seed-growing&quot;, BuildFrames(frames, 120))
 end
 
 -- it-shogun --
-NewAnim(&quot;it-shogun-s&quot;, {img=&quot;it-shogun-small&quot;, h=3, speed=160, pingpong=1, loop=1})
-NewAnim(&quot;it-shogun-m&quot;, {img=&quot;it-shogun-med&quot;,   h=3, speed=160, pingpong=1, loop=1})
-NewAnim(&quot;it-shogun-l&quot;, {img=&quot;it-shogun-big&quot;,   h=3, speed=160, pingpong=1, loop=1})
+do
+    NewAnim(&quot;it-shogun-s&quot;, {img=&quot;it-shogun-small&quot;, h=3, speed=160, pingpong=1, loop=1})
+    NewAnim(&quot;it-shogun-m&quot;, {img=&quot;it-shogun-med&quot;,   h=3, speed=160, pingpong=1, loop=1})
+    NewAnim(&quot;it-shogun-l&quot;, {img=&quot;it-shogun-big&quot;,   h=3, speed=160, pingpong=1, loop=1})
+end
 
 -- it-springboard --
 do
-    local img = {&quot;it-springboard1&quot;, &quot;it-springboard2&quot;}
-    DefineTiles (&quot;it-springboard&quot;, img)
-    def_alias (&quot;it-springboard&quot;, img[1])
-    def_anim(&quot;it-springboard_anim&quot;, buildframes(reverseframes(img),120))
+    local images = {&quot;it-springboard1&quot;, &quot;it-springboard2&quot;}
+    DefTiles (&quot;it-springboard&quot;, images)
+    DefAlias (&quot;it-springboard&quot;, images[1])
+    DefAnim(&quot;it-springboard_anim&quot;, BuildFrames(ReverseFrames(images),120))
 end
 
 -- it-vortex --
 do
-    local img = def_subimages(&quot;it-vortex&quot;, {h=4})
-    def_alias(&quot;it-vortex-open&quot;, img[1])
-    def_alias(&quot;it-vortex-closed&quot;, img[4])
+    local images = DefSubimages(&quot;it-vortex&quot;, {h=4})
+    DefAlias(&quot;it-vortex-open&quot;, images[1])
+    DefAlias(&quot;it-vortex-closed&quot;, images[4])
 
-    def_anim(&quot;it-vortex-opening&quot;, reverseframes(buildframes(img, 100)))
-    def_anim(&quot;it-vortex-closing&quot;, buildframes(img, 100))
+    DefAnim(&quot;it-vortex-opening&quot;, ReverseFrames(BuildFrames(images, 100)))
+    DefAnim(&quot;it-vortex-closing&quot;, BuildFrames(images, 100))
 end
 
 -- it-wormhole --
 do
-    local img = def_subimages(&quot;it-wormhole&quot;, {h=2})
-    local frames = buildframes(img, 100)
-    def_anim(&quot;it-wormhole&quot;, frames, true)
-    def_alias(&quot;it-wormhole-off&quot;, &quot;it-wormhole1&quot;)
+    local images = DefSubimages(&quot;it-wormhole&quot;, {h=2})
+    local frames = BuildFrames(images, 100)
+    DefAnim(&quot;it-wormhole&quot;, frames, true)
+    DefAlias(&quot;it-wormhole-off&quot;, &quot;it-wormhole1&quot;)
 end
 
 --------------------------------------------------------------------------------
 --                                STONE MODELS                                --
 --------------------------------------------------------------------------------
-Progress(30, &quot;Loading stone models&quot;)
+Progress(40, &quot;Loading stone models&quot;)
 
 -------------------
 -- Stone shadows --
 -------------------
-def_image(&quot;sh-solid&quot;)
-def_image(&quot;sh-round&quot;)
-def_image(&quot;sh-round2&quot;)
-def_image(&quot;sh-grate1&quot;)
-def_image(&quot;sh-grate2&quot;)
-def_image(&quot;sh-grate3&quot;)
-def_image(&quot;sh-glass&quot;)
-def_image(&quot;sh-white4&quot;)
-def_image(&quot;sh-puzzle1&quot;)
-def_image(&quot;sh-brake&quot;)
-def_image(&quot;sh-floating&quot;)
+do
+    DefImage(&quot;sh-solid&quot;)
+    DefImage(&quot;sh-round&quot;)
+    DefImage(&quot;sh-round2&quot;)
+    DefImage(&quot;sh-grate1&quot;)
+    DefImage(&quot;sh-grate2&quot;)
+    DefImage(&quot;sh-grate3&quot;)
+    DefImage(&quot;sh-glass&quot;)
+    DefImage(&quot;sh-white4&quot;)
+    DefImage(&quot;sh-puzzle1&quot;)
+    DefImage(&quot;sh-brake&quot;)
+    DefImage(&quot;sh-floating&quot;)
+end
 
--- stone models
-def_stone(&quot;st-glass&quot;, &quot;sh-glass&quot;);
+-------------------
+-- simple stones --
+-------------------
+do
+    DefStone(&quot;st-beads&quot;, &quot;sh-glass&quot;)
+    DefStone(&quot;st-black1&quot;)
+    DefStone(&quot;st-black2&quot;)
+    DefStone(&quot;st-black3&quot;)
+    DefStone(&quot;st-black4&quot;, &quot;sh-white4&quot;)
+    DefStone(&quot;st-blackballs&quot;)
+    DefStone(&quot;st-block&quot;)
+    DefStone(&quot;st-bluegray&quot;, &quot;sh-round&quot;)
+    DefStone(&quot;st-bluegray_hole&quot;, &quot;sh-round&quot;, {filename=&quot;st-bluegray&quot;})
+    DefStone(&quot;st-blue-sand&quot;)
+    DefStone(&quot;st-brake&quot;, &quot;sh-brake&quot;)
+    DefStone(&quot;st-brick&quot;)
+    DefStone(&quot;st-brick_magic&quot;, nil, {filename=&quot;st-brick&quot;})
+    DefStone(&quot;st-brownie&quot;, &quot;sh-round&quot;)
+    DefStone(&quot;st-bug&quot;)
+    DefStone(&quot;st-bumps&quot;)
+    DefStone(&quot;st-camouflage&quot;)
+    DefStone(&quot;st-dummy&quot;)
+    DefImage(&quot;st-easymode&quot;)
+    DefStone(&quot;st-flhay&quot;)
+    DefStone(&quot;st-firebreak&quot;)
+    DefStone(&quot;st-floppy0&quot;, &quot;sh-round&quot;, {filename=&quot;st-floppy1&quot;})
+    DefStone(&quot;st-floppy1&quot;, &quot;sh-round&quot;, {filename=&quot;st-floppy2&quot;})
+    DefStone(&quot;st-flrock&quot;)
+    DefStone(&quot;st-glass&quot;, &quot;sh-glass&quot;);
+    DefStone(&quot;st-glass1&quot;, &quot;sh-glass&quot;)
+    DefStone(&quot;st-glass2&quot;, &quot;sh-glass&quot;)
+    DefStone(&quot;st-glass3&quot;, &quot;sh-glass&quot;)
+    DefStone(&quot;st-grate1&quot;, &quot;sh-grate1&quot;)
+    DefStone(&quot;st-grate2&quot;, &quot;sh-grate2&quot;)
+    DefStone(&quot;st-grate3&quot;, &quot;sh-grate3&quot;)
+    DefStone(&quot;st-greenbrown&quot;, &quot;sh-round&quot;)
+    DefStone(&quot;st-key0&quot;, &quot;sh-round&quot;, {filename=&quot;st-key1&quot;})
+    DefStone(&quot;st-key1&quot;, &quot;sh-round&quot;, {filename=&quot;st-key2&quot;})
+    DefStone(&quot;st-marble&quot;, &quot;sh-round&quot;)
+    DefStone(&quot;st-metal&quot;)
+    DefStone(&quot;st-redrock&quot;)
+    DefStone(&quot;st-rock1&quot;, &quot;sh-round&quot;)
+    DefStone(&quot;st-rock2&quot;)
+    DefStone(&quot;st-rock3&quot;)
+    DefStone(&quot;st-rock3_cracked&quot;)
+    DefStone(&quot;st-rock4&quot;)
+    DefStone(&quot;st-rock5&quot;)
+    DefStone(&quot;st-rock6&quot;)
+    DefStone(&quot;st-rock7&quot;)
+    DefStone(&quot;st-rock8&quot;, &quot;sh-round&quot;)
+    DefStone(&quot;st-rock9&quot;, &quot;sh-round&quot;)
+    DefStone(&quot;st-rock10&quot;)
+    DefStone(&quot;st-rubberband&quot;)
+    DefStone(&quot;st-stone1&quot;)
+    DefStone(&quot;st-stone2&quot;)
+    DefStone(&quot;st-surprise&quot;)
+    DefStone(&quot;st-white1&quot;)
+    DefStone(&quot;st-white2&quot;)
+    DefStone(&quot;st-white3&quot;)
+    DefStone(&quot;st-white4&quot;, &quot;sh-white4&quot;)
+    DefStone(&quot;st-whiteballs&quot;)
+    DefStone(&quot;st-wood_001&quot;)
+    DefStone(&quot;st-woven&quot;)
+    DefStone(&quot;st-yellow&quot;)
+    DefStone(&quot;st-yinyang1&quot;)
+    DefStone(&quot;st-yinyang2&quot;)
+end
 
-def_stone(&quot;st-bug&quot;)
+---------------------
+-- Animated stones --
+---------------------
 
--- Scissors
+-- st-actorimpulse --
 do
-    def_stone(&quot;st-scissors&quot;)
-    local n=def_subimages(&quot;st-scissors-snip&quot;, {h=1})
-    def_anim(&quot;st-scissors-snip-anim&quot;, buildframes(n, 130))
-    def_solidstone(&quot;st-scissors-snip&quot;, &quot;st-scissors-snip-anim&quot;)
+    namelist = DefSubimages(&quot;st-actorimpulse&quot;, {h=3})
+    shnamelist = DefSubimages(&quot;sh-actorimpulse&quot;, {h=3,imgw=ShadowSize,imgh=ShadowSize})
+
+    DefAnim(&quot;st-ai-fg&quot;, PingPong(BuildFrames(namelist, 30)))
+    DefAnim(&quot;st-ai-sh&quot;, PingPong(BuildFrames(shnamelist, 30)))
+    DefShModel(&quot;st-actorimpulse-anim&quot;, &quot;st-ai-fg&quot;, &quot;st-ai-sh&quot;)
+
+    DefShModel(&quot;st-actorimpulse&quot;, namelist[1], shnamelist[1])
 end
 
-def_stone(&quot;st-rubberband&quot;)
+-- st-bigbluesand --
+do
+    DefSubimages(&quot;st-bigbluesand&quot;, {modelname=&quot;st-bigbluesandx&quot;,w=4,h=4})
+    for i=1,16 do DefSolidStone(&quot;st-bigbluesand&quot;..i, &quot;st-bigbluesandx&quot;..i) end
+end
 
+-- st-bigbrick --
+do
+    DefSubimages(&quot;st-bigbrick&quot;, {modelname=&quot;st-bigbrickx&quot;,w=4,h=4})
+    for i=1,16 do DefSolidStone(&quot;st-bigbrick&quot;..i, &quot;st-bigbrickx&quot;..i) end
+end
 
+-- st-bolder --
 do
-    local tiles = {
-        &quot;st-disco-light&quot;,
-        &quot;st-disco-medium&quot;,
-        &quot;st-disco-dark&quot;
-    }
-    map_tiles({h=3},
-              function (i, rect)
-                  local model = tiles[i]
-                  display.DefineSubImage(model, &quot;st-disco&quot;, 0,0, rect)
-              end)
+    local img=DefSubimages(&quot;st-bolder&quot;, {w=4,h=3})
+    local imgfall=DefSubimages(&quot;st-bolder-fall&quot;, {w=4,h=3})
+
+    function def_bolder(orient, start)
+        local animname=&quot;st-bolder&quot;..orient..&quot;a&quot;
+        local frames={img[start], img[start+1], img[start+2]}
+        DefAnim(animname, BuildFrames(frames, 120), false)
+        DefShModel(&quot;st-bolder-&quot;..orient, animname, &quot;sh-round&quot;)
+
+        animname=&quot;st-bolder-&quot;..orient..&quot;-fall-anim&quot;
+        frames={imgfall[start],imgfall[start+1],imgfall[start+2]}
+        DefAnim(animname, BuildFrames(frames, 120), false)
+    end
+
+    def_bolder(&quot;n&quot;,1)
+    def_bolder(&quot;e&quot;,4)
+    def_bolder(&quot;s&quot;,7)
+    def_bolder(&quot;w&quot;,10)
 end
 
--- other
+-- st-break_*, breakable stones --
+do
+    DefSolidStoneWithAnim (&quot;st-stone_break&quot;, 10, 50)
+    DefSolidStoneWithAnim (&quot;st-break_bolder&quot;, 10, 50)
+    DefRoundStoneWithAnim (&quot;st-break_acwhite&quot;, 10, 50)
+    DefRoundStoneWithAnim (&quot;st-break_acblack&quot;, 10, 50)
+    DefRoundStoneWithAnim (&quot;st-break_gray&quot;, 10, 50)
+end
 
+-- st-chage-plus, st-charge-zero, st-charge-minus --
 do
---    def_image(&quot;stones&quot;)
-    local stonetiles={
-        &quot;st-black1#&quot;,
-        &quot;st-black2#&quot;,
-        &quot;st-black3#&quot;,
-        &quot;st-black4#&quot;,
-        &quot;st-block#&quot;,
-        &quot;st-idontknowwhattonameit2&quot;,
-        &quot;st-beads#&quot;
-    }
-    DefineTiles(&quot;stones&quot;, stonetiles)
+    function def_chargestone(basename)
+        local n=DefSubimages(basename, {h=2})
+        DefSolidStone(basename, n[1])
+        DefAnim(basename..&quot;-animfg&quot;, {{n[2], 140}})
+        DefSolidStone(basename..&quot;-anim&quot;, basename..&quot;-animfg&quot;)
+    end
+
+    def_chargestone(&quot;st-chargeplus&quot;)
+    def_chargestone(&quot;st-chargeminus&quot;)
+    def_chargestone(&quot;st-chargezero&quot;)
 end
 
-def_alias(&quot;st-explosion&quot;, &quot;expl&quot;)
+-- st-chess_black, st-chess_white --
+do
+    function make_chess(colour)
+        local img1 = DefSubimages(&quot;st-chess&quot;..colour, {h=5});
+        --local img2 = DefSubimages(&quot;st-chess&quot;..colour..&quot;-captured&quot;, {h=5});
+        local f1 = BuildFrames(img1, 120)
+        --local f2 = BuildFrames(img2, 40)
+        local f2 = f1
+        local f3 = BuildFrames(img1, 500)
+        DefAnim(&quot;st-chess&quot;..colour..&quot;-disappearing&quot;, f1);
+        DefAnim(&quot;st-chess&quot;..colour..&quot;-appearing&quot;, ReverseFrames(f1))
+        DefAnim(&quot;st-chess&quot;..colour..&quot;-captured&quot;, f2);
+        DefAnim(&quot;st-chess&quot;..colour..&quot;-swamp&quot;, f3);
+        DefRoundStone(&quot;st-chess&quot;..colour, img1[1])
+    end
 
-def_stone2(&quot;st-black1&quot;)
-def_stone2(&quot;st-black2&quot;)
-def_stone2(&quot;st-black3&quot;)
-def_stone2(&quot;st-black4&quot;, &quot;sh-white4&quot;)
-def_stone2(&quot;st-block&quot;)
-def_stone2(&quot;st-beads&quot;, &quot;sh-glass&quot;)
+    make_chess(&quot;_black&quot;)
+    make_chess(&quot;_white&quot;)
+end
 
+-- st-coinslot --
+do
+    DefStone(&quot;st-coinslot&quot;)
+    local images = DefSubimages(&quot;st-coin2slot&quot;, {h=18})
+    DefAnim(&quot;st-coin2slot-anim&quot;, BuildFrames(images, 20))
+    DefSolidStone(&quot;st-coin2slot&quot;, &quot;st-coin2slot-anim&quot;)
+    DefSolidStone(&quot;st-coinslot-active&quot;, &quot;st-coin2slot18&quot;)
+end
 
-def_stone(&quot;st-glass1&quot;, &quot;sh-glass&quot;)
-def_stone(&quot;st-glass2&quot;, &quot;sh-glass&quot;)
-def_stone(&quot;st-glass3&quot;, &quot;sh-glass&quot;)
-def_stone(&quot;st-rock1&quot;, &quot;sh-round&quot;)
-def_stone(&quot;st-rock2&quot;)
-def_stone(&quot;st-rock3&quot;)
-def_stone(&quot;st-rock4&quot;)
-def_stone(&quot;st-rock5&quot;)
-def_stone(&quot;st-rock6&quot;)
-def_stone(&quot;st-rock7&quot;)
-def_stone(&quot;st-rock8&quot;, &quot;sh-round&quot;)
-def_stone(&quot;st-rock9&quot;, &quot;sh-round&quot;)
-def_stone(&quot;st-rock10&quot;)
-def_stone(&quot;st-redrock&quot;)
-def_stone(&quot;st-brownie&quot;, &quot;sh-round&quot;)
-def_stone(&quot;st-stone1&quot;)
-def_stone(&quot;st-stone2&quot;)
-def_stone(&quot;st-bumps&quot;)
+-- st-disco --
+do
+    DefTiles(&quot;st-disco&quot;, {&quot;st-disco-light&quot;,&quot;st-disco-medium&quot;,&quot;st-disco-dark&quot;})
+end
 
-def_stone(&quot;st-camouflage&quot;)
-def_alias(&quot;st-camouflage_move&quot;, &quot;st-camouflage&quot;)
-def_alias(&quot;st-camouflage_hole&quot;, &quot;st-camouflage&quot;)
+-- st-death --
+do
+    DefRoundStoneWithAnim (&quot;st-death&quot;, 3, 140)
+end
 
-def_alias(&quot;st-laserbreak&quot;, &quot;st-rock3&quot;)
-def_alias(&quot;st-laserbreak-anim&quot;, &quot;st-rock3_break-anim&quot;)
+-- st-dynamite, st-bombs, st-whitebombs --
+do
+    function make_bombstone(name)
+        local images = DefSubimages(name, {h=7})
+        DefRoundStone(name, name..&quot;1&quot;)
+        DefAnim(name..&quot;-anim&quot;, BuildFrames(images,50))
+    end
 
-def_alias(&quot;st-rock1_hole&quot;, &quot;st-rock1&quot;)
-def_alias(&quot;st-rock1_move&quot;, &quot;st-rock1&quot;)
+    make_bombstone(&quot;st-bombs&quot;)
+    make_bombstone(&quot;st-dynamite&quot;)
+    make_bombstone(&quot;st-whitebombs&quot;)
+end
 
-def_alias(&quot;st-rock2_hole&quot;, &quot;st-rock2&quot;)
+-- st-flash --
+do
+    local images = DefSubimages(&quot;st-flash&quot;, {h=1})
+    DefSolidStone(&quot;st-flash&quot;, &quot;st-flash1&quot;)
+end
 
-def_alias(&quot;st-rock3_hole&quot;, &quot;st-rock3&quot;)
-def_alias(&quot;st-rock3_move&quot;, &quot;st-rock3&quot;)
-def_alias(&quot;st-rock3_break&quot;, &quot;st-rock3&quot;)
+-- st-fourswitch --
+do
+   DefSubimages(&quot;st-fourswitch&quot;,{h=4})
+   DefShModel(&quot;st-fourswitch-n&quot;, &quot;st-fourswitch1&quot;, &quot;sh-round&quot;)
+   DefShModel(&quot;st-fourswitch-e&quot;, &quot;st-fourswitch2&quot;, &quot;sh-round&quot;)
+   DefShModel(&quot;st-fourswitch-s&quot;, &quot;st-fourswitch3&quot;, &quot;sh-round&quot;)
+   DefShModel(&quot;st-fourswitch-w&quot;, &quot;st-fourswitch4&quot;, &quot;sh-round&quot;)
+end
 
-def_stone(&quot;st-marble&quot;, &quot;sh-round&quot;)
-def_alias(&quot;st-marble_hole&quot;, &quot;st-marble&quot;)
-def_alias(&quot;st-marble_move&quot;, &quot;st-marble&quot;)
+-- st-knight --
+do
+    local images = DefSubimages(&quot;st-knight&quot;, {modelname=&quot;knight&quot;, h=5})
+    for i=1, table.getn(images) do
+        DefSolidStone(&quot;st-knight&quot;..i, images[i])
+    end
+end
 
-def_alias(&quot;st-glass_move&quot;, &quot;st-glass&quot;);
+-- st-laser --
+do
+    function make_laser(dir)
+        laseron=FrameNames(&quot;st-laser&quot;..dir, 1, 9)
 
-def_alias(&quot;st-glass1_hole&quot;, &quot;st-glass1&quot;)
-def_alias(&quot;st-glass1_move&quot;, &quot;st-glass1&quot;)
-def_alias(&quot;st-glass2_hole&quot;, &quot;st-glass2&quot;)
+        -- deactivated laser
+        DefOverlay(&quot;laser&quot;..dir, {&quot;st-laser-base&quot;, laseron[1]})
+        DefRoundStone(&quot;st-laser&quot;..dir, &quot;laser&quot;..dir)
 
-def_stone(&quot;st-metal&quot;)
-def_alias(&quot;st-metal_hole&quot;, &quot;st-metal&quot;)
-def_stone(&quot;st-blue-sand&quot;)
-def_stone(&quot;st-flrock&quot;)
-def_stone(&quot;st-flhay&quot;)
+        -- activated laser
+        names = {}
+        for i=1,table.getn(laseron) do
+	        names[i] = &quot;st-laseron&quot;..dir .. format(&quot;_%04d&quot;, i)
+	        DefOverlay (names[i], {&quot;st-laser-base&quot;, laseron[i]})
+        end
+        frames = BuildFrames(names, 100)
+        DefAnim(&quot;st-laseron-anim&quot;..dir, frames, 1)
+        DefRoundStone(&quot;st-laseron&quot;..dir, &quot;st-laseron-anim&quot;..dir)
+    end
 
-def_stone(&quot;st-firebreak&quot;)
-def_alias(&quot;st-firebreak_move&quot;, &quot;st-firebreak&quot;)
+    make_laser(&quot;-e&quot;)
+    make_laser(&quot;-s&quot;)
+    make_laser(&quot;-w&quot;)
+    make_laser(&quot;-n&quot;)
+end
 
+-- laserswitch --
 do
-   local sh=def_subimages(&quot;sh-round2-growing&quot;, {h=3,imgw=ShadowSize,imgh=ShadowSize})
+    DefStone(&quot;st-laserswitch0&quot;, nil, {filename=&quot;st-oxydb&quot;})
+    DefAnimImages(&quot;laserswitch-blink&quot;,
+        RepeatAnim(PingPong(BuildFrames(FrameNames(&quot;st-fakeoxyd-blink&quot;, 1,4),50))), {loop=1})
+    DefSolidStone(&quot;st-laserswitch1&quot;, &quot;laserswitch-blink&quot;)
+end
 
-   -- Wooden stones --
-   do
-      def_subimages(&quot;st-wood&quot;, {modelname=&quot;st-wood-fg&quot;,h=2})
-      def_shmodel(&quot;st-wood1&quot;, &quot;st-wood-fg1&quot;, &quot;sh-round&quot;)
-      def_shmodel(&quot;st-wood2&quot;, &quot;st-wood-fg2&quot;, &quot;sh-round&quot;)
+-- st-lightpassenger --
+do
+    local img = DefSubimages(&quot;st-lightpassenger&quot;, {h=7})
+    DefShModel(&quot;st-lightpassenger&quot;, img[1], &quot;sh-glass&quot;)
+    DefAlias(&quot;st-lightpassenger_off&quot;, &quot;st-glass2&quot;)
+    local frames = {img[2], img[3], img[4], img[5], img[6], img[7]}
+    DefAnim(&quot;st-lightpassenger-blink1&quot;, PingPong(BuildFrames(frames, 75)), true)
+    DefShModel(&quot;st-lightpassenger-blink&quot;, &quot;st-lightpassenger-blink1&quot;, &quot;sh-glass&quot;)
+    img = DefSubimages(&quot;st-lightpassenger-break-v&quot;, {h=7})
+    DefAnim(&quot;st-lightpassenger-break-v&quot;, BuildFrames(img, 50), false)
+    img = DefSubimages(&quot;st-lightpassenger-break-h&quot;, {h=7})
+    DefAnim(&quot;st-lightpassenger-break-h&quot;, BuildFrames(img, 50), false)
+    img = DefSubimages(&quot;st-lightpassenger-break-hv&quot;, {h=7})
+    DefAnim(&quot;st-lightpassenger-break-hv&quot;, BuildFrames(img, 50), false)
+end
 
-      local n=def_subimages(&quot;st-wood-growing&quot;, {h=3})
-      def_anim(&quot;wood-growing-fg&quot;, buildframes(n, 130))
-      def_anim(&quot;wood-growing-bg&quot;, buildframes(sh, 130))
-      def_shmodel(&quot;st-wood-growing&quot;, &quot;wood-growing-fg&quot;, &quot;wood-growing-bg&quot;)
-      def_shmodel(&quot;st-greenbrown-growing&quot;, &quot;wood-growing-fg&quot;, &quot;wood-growing-bg&quot;)
-   end
+-- st-magic :-) --
+do
+    local img = DefSubimages(&quot;st-magic&quot;, {h=4, modelname=&quot;st-magic-fg&quot;})
+    local nlist = {}
+    for i=1, table.getn(img) do
+        nlist[i] = &quot;st-magic&quot;..i
+        DefRoundStone(nlist[i], img[i])
+    end
+    display.DefineRandModel(&quot;st-magic&quot;, table.getn(nlist), nlist)
+end
 
-   -- Blocker stone
-   do
-      local n=def_subimages(&quot;st-blocker&quot;, {h=4})
-      def_roundstone(&quot;st-blocker&quot;, n[1])
-      frames={}
-      for i=4,2,-1 do
-         table.insert(frames, &quot;st-blocker&quot;..i)
-      end
-      def_anim(&quot;blocker-growing-fg&quot;, buildframes(frames, 60))
-      def_anim(&quot;blocker-growing-bg&quot;, buildframes(sh, 60))
-      def_anim(&quot;blocker-shrinking-fg&quot;, reverseframes(buildframes(frames, 60)))
-      def_anim(&quot;blocker-shrinking-bg&quot;, reverseframes(buildframes(sh, 60)))
-      def_shmodel(&quot;st-blocker-shrinking&quot;, &quot;blocker-shrinking-fg&quot;, &quot;blocker-shrinking-bg&quot;);
-      def_shmodel(&quot;st-blocker-growing&quot;, &quot;blocker-growing-fg&quot;, &quot;blocker-growing-bg&quot;);
-   end
+-- st-mail --
+do
+    local images = DefSubimages(&quot;st-mail&quot;, {h=4})
+    DefSolidStone(&quot;st-mail-n&quot;, images[1])
+    DefSolidStone(&quot;st-mail-e&quot;, images[2])
+    DefSolidStone(&quot;st-mail-w&quot;, images[3])
+    DefSolidStone(&quot;st-mail-s&quot;, images[4])
 end
 
-def_alias(&quot;st-volcano-growing&quot;, &quot;st-blocker-growing&quot;)
+-- st-oneway, st-oneway_black, st-oneway_white --
+do
+    local model_names = {
+        &quot;st-oneway-e&quot;, &quot;st-oneway-n&quot;, &quot;st-oneway-s&quot;, &quot;st-oneway-w&quot;,
+        &quot;st-oneway_black-e&quot;, &quot;st-oneway_black-n&quot;, &quot;st-oneway_black-s&quot;, &quot;st-oneway_black-w&quot;,
+        &quot;st-oneway_white-e&quot;, &quot;st-oneway_white-n&quot;, &quot;st-oneway_white-s&quot;, &quot;st-oneway_white-w&quot;
+    }
+    DefSubimages(&quot;st-oneway&quot;, {modelname=&quot;st-onewayx&quot;,w=3,h=4})
+    for i=1,12 do DefFloatingStone(model_names[i], &quot;st-onewayx&quot;..i) end
+end
 
--- Rotator stones
+-- st-pull, st-swap --
 do
-    local n=def_subimages(&quot;st-rotator-left&quot;, {h=8})
-    def_anim(&quot;st-rotator-left-anim&quot;, buildframes(n, 70), false)
-    def_roundstone(&quot;st-rotator-left&quot;, &quot;st-rotator-left-anim&quot;)
-    n=def_subimages(&quot;st-rotator-right&quot;, {h=8})
-    def_anim(&quot;st-rotator-right-anim&quot;, buildframes(n, 70), false)
-    def_roundstone(&quot;st-rotator-right&quot;, &quot;st-rotator-right-anim&quot;)
+   DefSubimages(&quot;st-pull&quot;,{modelname=&quot;st-pull-fg&quot;,h=5})
+   DefSubimages(&quot;st-swap&quot;,{modelname=&quot;st-swap-fg&quot;,h=5})
+   DefSubimages(&quot;sh-pull&quot;,{h=4,imgw=ShadowSize,imgh=ShadowSize})
+
+   DefShModel(&quot;st-pull&quot;,   &quot;st-pull-fg1&quot;, &quot;sh-glass&quot;)
+   DefShModel(&quot;st-pull-n&quot;, &quot;st-pull-fg2&quot;, &quot;sh-pull1&quot;)
+   DefShModel(&quot;st-pull-s&quot;, &quot;st-pull-fg3&quot;, &quot;sh-pull2&quot;)
+   DefShModel(&quot;st-pull-e&quot;, &quot;st-pull-fg4&quot;, &quot;sh-pull3&quot;)
+   DefShModel(&quot;st-pull-w&quot;, &quot;st-pull-fg5&quot;, &quot;sh-pull4&quot;)
+
+   DefShModel(&quot;st-swap&quot;,   &quot;st-swap-fg1&quot;, &quot;sh-round&quot;)
+   DefShModel(&quot;st-swap-n&quot;, &quot;st-swap-fg2&quot;, &quot;sh-pull1&quot;)
+   DefShModel(&quot;st-swap-s&quot;, &quot;st-swap-fg3&quot;, &quot;sh-pull2&quot;)
+   DefShModel(&quot;st-swap-e&quot;, &quot;st-swap-fg4&quot;, &quot;sh-pull3&quot;)
+   DefShModel(&quot;st-swap-w&quot;, &quot;st-swap-fg5&quot;, &quot;sh-pull4&quot;)
 end
 
-def_stone(&quot;st-grate1&quot;, &quot;sh-grate1&quot;)
-def_stone(&quot;st-grate2&quot;, &quot;sh-grate2&quot;)
-def_stone(&quot;st-grate3&quot;, &quot;sh-grate3&quot;)
+-- st-puzzle* --
+do
+    DefSubimages(&quot;st-puzzle&quot;, {modelname=&quot;st-puzzlex&quot;,w=8,h=4})
+    for i=2,16  do DefSolidStone(&quot;st-puzzle&quot;..i, &quot;st-puzzlex&quot;..i) end
+    for i=18,32 do DefSolidStone(&quot;st-puzzle&quot;..i, &quot;st-puzzlex&quot;..i) end
+    DefShModel(&quot;st-puzzle1&quot;, &quot;st-puzzlex1&quot;, &quot;sh-puzzle1&quot;)
+    DefShModel(&quot;st-puzzle17&quot;, &quot;st-puzzlex17&quot;, &quot;sh-puzzle1&quot;)
+end
 
-def_stone(&quot;st-brake&quot;, &quot;sh-brake&quot;)
-def_image(&quot;it-brake&quot;, {filename=&quot;st-brake&quot;})
+-- st-rock3-break --
+do
+    local images = DefSubimages(&quot;st-rock3-break&quot;, {h=6})
+    DefAnim(&quot;rock3_break-anim&quot;,BuildFrames(images,50))
+    DefSolidStone(&quot;st-rock3_break-anim&quot;, &quot;rock3_break-anim&quot;)
+    DefAlias(&quot;st-rock3_movebreak&quot;, &quot;st-rock3&quot;)
+end
 
-def_stone(&quot;st-greenbrown&quot;, &quot;sh-round&quot;)
-def_alias(&quot;st-greenbrown_hole&quot;, &quot;st-greenbrown&quot;)
-def_alias(&quot;st-greenbrown_move&quot;, &quot;st-greenbrown&quot;)
+-- st-rock3-falling --
+do
+    local images = DefSubimages(&quot;st-rock3-falling&quot;, {h=4})
+    DefAnim(&quot;st-rock3-falling&quot;, BuildFrames(images, 100))
+end
 
---Progress(40)
+-- st-rotator --
+do
+    local images = DefSubimages(&quot;st-rotator-left&quot;, {h=8})
+    DefAnim(&quot;st-rotator-left-anim&quot;, BuildFrames(images, 70), false)
+    DefRoundStone(&quot;st-rotator-left&quot;, &quot;st-rotator-left-anim&quot;)
+    local images = DefSubimages(&quot;st-rotator-right&quot;, {h=8})
+    DefAnim(&quot;st-rotator-right-anim&quot;, BuildFrames(images, 70), false)
+    DefRoundStone(&quot;st-rotator-right&quot;, &quot;st-rotator-right-anim&quot;)
+end
 
+-- st-scissors --
+do
+    DefStone(&quot;st-scissors&quot;)
+    local images = DefSubimages(&quot;st-scissors-snip&quot;, {h=1})
+    DefAnim(&quot;st-scissors-snip-anim&quot;, BuildFrames(images, 130))
+    DefSolidStone(&quot;st-scissors-snip&quot;, &quot;st-scissors-snip-anim&quot;)
+end
 
---def_stone(&quot;st-block&quot;)
-def_stone(&quot;st-brick&quot;)
-def_stone(&quot;st-woven&quot;)
-def_stone(&quot;st-brick_magic&quot;, nil, {filename=&quot;st-brick&quot;})
+-- st-shogun* --
+do
+    DefImages{&quot;sh-shogun1&quot;,&quot;sh-shogun2&quot;, &quot;sh-shogun4&quot;}
+    DefSubimages(&quot;st-shogun&quot;, {modelname=&quot;st-shogun-fg&quot;,h=7})
 
--- Switches --
+    DefShModel(&quot;st-shogun1&quot;, &quot;st-shogun-fg1&quot;, &quot;sh-shogun1&quot;)
+    DefShModel(&quot;st-shogun2&quot;, &quot;st-shogun-fg2&quot;, &quot;sh-shogun2&quot;)
+    DefShModel(&quot;st-shogun3&quot;, &quot;st-shogun-fg3&quot;, &quot;sh-shogun1&quot;)
+    DefShModel(&quot;st-shogun4&quot;, &quot;st-shogun-fg4&quot;, &quot;sh-shogun4&quot;)
+    DefShModel(&quot;st-shogun5&quot;, &quot;st-shogun-fg5&quot;, &quot;sh-shogun1&quot;)
+    DefShModel(&quot;st-shogun6&quot;, &quot;st-shogun-fg6&quot;, &quot;sh-shogun2&quot;)
+    DefShModel(&quot;st-shogun7&quot;, &quot;st-shogun-fg7&quot;, &quot;sh-shogun1&quot;)
+end
+
+-- st-stoneimpulse --
+--
+-- Note: It's important that the duration of the closing animation
+-- (anim2) is longer than the opening animation (anim1). Otherwise
+-- impulse stones do not work properly!
 do
+   local images = DefSubimages(&quot;st-stoneimpulse&quot;, {h=4})
+   DefRoundStone(&quot;st-stoneimpulse&quot;, images[1])
+   local frames = {}
+   for i=1,4 do table.insert(frames, images[i]) end
+   DefAnim(&quot;stoneimpulse-anim1&quot;, BuildFrames(frames, 55))
+   DefRoundStone(&quot;st-stoneimpulse-anim1&quot;, &quot;stoneimpulse-anim1&quot;)
+   table.insert(frames, images[4]) -- add 1 frame to make closing anim longer!
+   DefAnim(&quot;stoneimpulse-anim2&quot;, ReverseFrames(BuildFrames(frames, 55)))
+   DefRoundStone(&quot;st-stoneimpulse-anim2&quot;, &quot;stoneimpulse-anim2&quot;)
+end
+
+-- st-stoneimpulse-hollow --
+do
+   local images = DefSubimages(&quot;st-stoneimpulse-hollow&quot;, {h=4})
+   DefShModel(&quot;st-stoneimpulse-hollow&quot;, images[1], &quot;sh-floating&quot;)
+   local frames = {}
+   for i=1,4 do table.insert(frames, images[i]) end
+   DefAnim(&quot;stoneimpulse-hollow-anim1&quot;, BuildFrames(frames, 55))
+   DefShModel(&quot;st-stoneimpulse-hollow-anim1&quot;, &quot;stoneimpulse-hollow-anim1&quot;, &quot;sh-floating&quot;)
+   table.insert(frames, images[4]) -- add 1 frame to make closing anim longer!
+   DefAnim(&quot;stoneimpulse-hollow-anim2&quot;, ReverseFrames(BuildFrames(frames, 55)))
+   DefShModel(&quot;st-stoneimpulse-hollow-anim2&quot;, &quot;stoneimpulse-hollow-anim2&quot;, &quot;sh-floating&quot;)
+end
+
+-- st-switch, st-switch_black, st-switch_white --
+do
     function mkswitch(modelname, basename)
-	local n = def_subimages(modelname, {h=3, modelname=basename..&quot;-fg&quot;})
-	local f = buildframes(n, 60)
-	def_roundstone(modelname..&quot;-off&quot;, n[1])
-	def_roundstone(modelname..&quot;-on&quot;, n[3])
-	def_anim(basename..&quot;-turnon&quot;, f)
-	def_anim(basename..&quot;-turnoff&quot;, reverseframes(f))
-	def_roundstone(modelname..&quot;-turnon&quot;, basename..&quot;-turnon&quot;)
-	def_roundstone(modelname..&quot;-turnoff&quot;, basename..&quot;-turnoff&quot;)
+    	local n = DefSubimages(modelname, {h=3, modelname=basename..&quot;-fg&quot;})
+    	local f = BuildFrames(n, 60)
+    	DefRoundStone(modelname..&quot;-off&quot;, n[1])
+    	DefRoundStone(modelname..&quot;-on&quot;, n[3])
+      	DefAnim(basename..&quot;-turnon&quot;, f)
+	    DefAnim(basename..&quot;-turnoff&quot;, ReverseFrames(f))
+	    DefRoundStone(modelname..&quot;-turnon&quot;, basename..&quot;-turnon&quot;)
+	    DefRoundStone(modelname..&quot;-turnoff&quot;, basename..&quot;-turnoff&quot;)
     end
     mkswitch(&quot;st-switch&quot;, &quot;switch&quot;)
     mkswitch(&quot;st-switch_black&quot;, &quot;switch_black&quot;)
     mkswitch(&quot;st-switch_white&quot;, &quot;switch_white&quot;)
 end
 
--- 4-Switches --
+-- st-timer --
 do
-   def_subimages(&quot;st-fourswitch&quot;,{h=4})
+    local images = DefSubimages(&quot;st-timer&quot;, {h=4})
+    DefAnim(&quot;timer-anim&quot;, BuildFrames(images, 120), 1)
+    DefRoundStone(&quot;st-timer&quot;, &quot;timer-anim&quot;)
+    DefRoundStone(&quot;st-timeroff&quot;, &quot;st-timer1&quot;)
+end
 
-   def_shmodel(&quot;st-fourswitch-n&quot;, &quot;st-fourswitch1&quot;, &quot;sh-round&quot;)
-   def_shmodel(&quot;st-fourswitch-e&quot;, &quot;st-fourswitch2&quot;, &quot;sh-round&quot;)
-   def_shmodel(&quot;st-fourswitch-s&quot;, &quot;st-fourswitch3&quot;, &quot;sh-round&quot;)
-   def_shmodel(&quot;st-fourswitch-w&quot;, &quot;st-fourswitch4&quot;, &quot;sh-round&quot;)
+-- st-timeswitch --
+do
+    DefStone(&quot;st-timeswitch&quot;)
+    local images = DefSubimages(&quot;st-time1switch&quot;, {h=2})
+    DefAnim(&quot;st-time1switch-anim&quot;, BuildFrames (images, 180), 1)
+    DefSolidStone(&quot;st-time1switch&quot;, &quot;st-time1switch-anim&quot;)
 end
 
-def_stone(&quot;st-floppy0&quot;, &quot;sh-round&quot;, {filename=&quot;st-floppy1&quot;})
-def_stone(&quot;st-floppy1&quot;, &quot;sh-round&quot;, {filename=&quot;st-floppy2&quot;})
+-- st-turnstile --
+do
+    local images = DefSubimages(&quot;st-turnstile&quot;, {h=2})
+    DefAnim(&quot;turnstile-anim&quot;, ReverseFrames(BuildFrames(images, 30)))
+    DefSolidStone(&quot;st-turnstile&quot;, images[1])
+    DefSolidStone(&quot;st-turnstile-anim&quot;, &quot;turnstile-anim&quot;)
+end
 
-def_image(&quot;st-easymode&quot;)
+-- st-turnstle, arms --
+DefAlias(&quot;st-turnstile-e&quot;, &quot;st-puzzle2&quot;)
+DefAlias(&quot;st-turnstile-w&quot;, &quot;st-puzzle5&quot;)
+DefAlias(&quot;st-turnstile-s&quot;, &quot;st-puzzle9&quot;)
+DefAlias(&quot;st-turnstile-n&quot;, &quot;st-puzzle3&quot;)
 
+-- st-turnstile-green --
+do
+    local images = DefSubimages(&quot;st-turnstile-green&quot;, {h=2})
+    DefAnim(&quot;turnstile-green-anim&quot;, ReverseFrames(BuildFrames(images, 30)))
+    DefSolidStone(&quot;st-turnstile-green&quot;, images[1])
+    DefSolidStone(&quot;st-turnstile-green-anim&quot;, &quot;turnstile-green-anim&quot;)
+end
 
-def_stone(&quot;st-laserswitch0&quot;, nil, {filename=&quot;st-oxydb&quot;})
-def_anim_images(&quot;laserswitch-blink&quot;,
-                repeatanim(pingpong(
-                            buildframes(framenames(&quot;st-fakeoxyd-blink&quot;, 1,4),
-                            50))), {loop=1})
-def_solidstone(&quot;st-laserswitch1&quot;, &quot;laserswitch-blink&quot;)
+-- st-wood*, growing stones, st-volcano, st-blocker --
+do
+   local sh=DefSubimages(&quot;sh-round2-growing&quot;, {h=3,imgw=ShadowSize,imgh=ShadowSize})
 
-def_stone(&quot;st-wood_001&quot;)
-def_stone(&quot;st-key0&quot;, &quot;sh-round&quot;, {filename=&quot;st-key1&quot;})
-def_stone(&quot;st-key1&quot;, &quot;sh-round&quot;, {filename=&quot;st-key2&quot;})
-def_stone(&quot;st-white1&quot;)
-def_stone(&quot;st-white2&quot;)
-def_stone(&quot;st-white3&quot;)
-def_stone(&quot;st-white4&quot;, &quot;sh-white4&quot;)
-def_stone(&quot;st-yinyang1&quot;)
-def_stone(&quot;st-yinyang2&quot;)
-def_alias(&quot;st-yinyang3&quot;, &quot;st-yinyang1&quot;)
-def_stone(&quot;st-bluegray&quot;, &quot;sh-round&quot;)
-def_stone(&quot;st-bluegray_hole&quot;, &quot;sh-round&quot;, {filename=&quot;st-bluegray&quot;})
-def_stone(&quot;st-yellow&quot;)
-def_stone(&quot;st-dummy&quot;)
-def_stone(&quot;st-blackballs&quot;)
-def_stone(&quot;st-whiteballs&quot;)
+   -- Wooden stones --
+   do
+      DefSubimages(&quot;st-wood&quot;, {modelname=&quot;st-wood-fg&quot;,h=2})
+      DefShModel(&quot;st-wood1&quot;, &quot;st-wood-fg1&quot;, &quot;sh-round&quot;)
+      DefShModel(&quot;st-wood2&quot;, &quot;st-wood-fg2&quot;, &quot;sh-round&quot;)
 
+      local n=DefSubimages(&quot;st-wood-growing&quot;, {h=3})
+      DefAnim(&quot;wood-growing-fg&quot;, BuildFrames(n, 130))
+      DefAnim(&quot;wood-growing-bg&quot;, BuildFrames(sh, 130))
+      DefShModel(&quot;st-wood-growing&quot;, &quot;wood-growing-fg&quot;, &quot;wood-growing-bg&quot;)
+      DefShModel(&quot;st-greenbrown-growing&quot;, &quot;wood-growing-fg&quot;, &quot;wood-growing-bg&quot;)
+   end
 
-def_stone(&quot;st-rock3_cracked&quot;)
+   -- Blocker stone --
+   do
+      local n=DefSubimages(&quot;st-blocker&quot;, {h=4})
+      DefRoundStone(&quot;st-blocker&quot;, n[1])
+      frames={}
+      for i=4,2,-1 do
+         table.insert(frames, &quot;st-blocker&quot;..i)
+      end
+      DefAnim(&quot;blocker-growing-fg&quot;, BuildFrames(frames, 60))
+      DefAnim(&quot;blocker-growing-bg&quot;, BuildFrames(sh, 60))
+      DefAnim(&quot;blocker-shrinking-fg&quot;, ReverseFrames(BuildFrames(frames, 60)))
+      DefAnim(&quot;blocker-shrinking-bg&quot;, ReverseFrames(BuildFrames(sh, 60)))
+      DefShModel(&quot;st-blocker-shrinking&quot;, &quot;blocker-shrinking-fg&quot;, &quot;blocker-shrinking-bg&quot;);
+      DefShModel(&quot;st-blocker-growing&quot;, &quot;blocker-growing-fg&quot;, &quot;blocker-growing-bg&quot;);
+   end
+end
 
----------------
--- st-plain* --
----------------
-def_alias(&quot;st-plain&quot;, &quot;st-rock3&quot;)
-def_alias(&quot;st-plain_hole&quot;, &quot;st-rock3&quot;)
-def_alias(&quot;st-plain_breaking&quot;, &quot;st-rock3_break-anim&quot;)
-def_alias(&quot;st-plain_break&quot;, &quot;st-rock3&quot;)
-def_alias(&quot;st-plain_cracked&quot;, &quot;st-rock3_cracked&quot;)
-def_alias(&quot;st-plain_move&quot;, &quot;st-rock3&quot;)
-def_alias(&quot;st-plain_falling&quot;, &quot;st-rock3-falling&quot;)
-
---------------------------
--- pull and swap stones --
---------------------------
-
---def_stone(&quot;st-swap&quot;, &quot;sh-round&quot;)
-
 do
-   def_subimages(&quot;st-pull&quot;,{modelname=&quot;st-pull-fg&quot;,h=5})
-   def_subimages(&quot;st-swap&quot;,{modelname=&quot;st-swap-fg&quot;,h=5})
-   def_subimages(&quot;sh-pull&quot;,{h=4,imgw=ShadowSize,imgh=ShadowSize})
+    DefAlias(&quot;st-volcano-growing&quot;, &quot;st-blocker-growing&quot;)
+end
 
-   def_shmodel(&quot;st-pull&quot;,   &quot;st-pull-fg1&quot;, &quot;sh-glass&quot;)
-   def_shmodel(&quot;st-pull-n&quot;, &quot;st-pull-fg2&quot;, &quot;sh-pull1&quot;)
-   def_shmodel(&quot;st-pull-s&quot;, &quot;st-pull-fg3&quot;, &quot;sh-pull2&quot;)
-   def_shmodel(&quot;st-pull-e&quot;, &quot;st-pull-fg4&quot;, &quot;sh-pull3&quot;)
-   def_shmodel(&quot;st-pull-w&quot;, &quot;st-pull-fg5&quot;, &quot;sh-pull4&quot;)
-
-   def_shmodel(&quot;st-swap&quot;,   &quot;st-swap-fg1&quot;, &quot;sh-round&quot;)
-   def_shmodel(&quot;st-swap-n&quot;, &quot;st-swap-fg2&quot;, &quot;sh-pull1&quot;)
-   def_shmodel(&quot;st-swap-s&quot;, &quot;st-swap-fg3&quot;, &quot;sh-pull2&quot;)
-   def_shmodel(&quot;st-swap-e&quot;, &quot;st-swap-fg4&quot;, &quot;sh-pull3&quot;)
-   def_shmodel(&quot;st-swap-w&quot;, &quot;st-swap-fg5&quot;, &quot;sh-pull4&quot;)
+-- st-window --
+do
+    DefSolidStoneWithAnim (&quot;st-window&quot;, 4, 80)
 end
 
 -----------------
 -- Oxyd Stones --
 -----------------
-
+--
 -- Oxyd stones occur in different colors and different flavors and
 -- for each combination of these two attributes we need animations
 -- for the following internal states or state transitions:
@@ -982,8 +1166,8 @@
 -- them automatically.
 
 do
-    local colorspots = framenames(&quot;st-oxydbtempl&quot;, 2,9)
-    local openovls = framenames(&quot;st-oxydbtempl&quot;, 10,14)
+    local colorspots = FrameNames(&quot;st-oxydbtempl&quot;, 2,9)
+    local openovls = FrameNames(&quot;st-oxydbtempl&quot;, 10,14)
 
 -- Define &quot;fading in&quot; and &quot;fading out&quot; animations for oxyd stones.
 -- These two animations are combined with the stone images to
@@ -1002,16 +1186,16 @@
        d=&quot;sh-solid&quot;,
     }
     local fopening = {
-        a = buildframes(def_subimages(&quot;st-oxyda-opening&quot;, {h=9}), 60),
-        b = buildframes(def_subimages(&quot;st-oxydb-opening&quot;, {h=14}), 40),
-        c = buildframes(def_subimages(&quot;st-oxydc-opening&quot;, {h=5}), 70),
-        d = buildframes(def_subimages(&quot;st-oxydd-opening&quot;, {h=5}), 70),
+        a = BuildFrames(DefSubimages(&quot;st-oxyda-opening&quot;, {h=9}), 60),
+        b = BuildFrames(DefSubimages(&quot;st-oxydb-opening&quot;, {h=14}), 40),
+        c = BuildFrames(DefSubimages(&quot;st-oxydc-opening&quot;, {h=5}), 70),
+        d = BuildFrames(DefSubimages(&quot;st-oxydd-opening&quot;, {h=5}), 70),
     }
     local fclosing = {
-        a = reverseframes(fopening[&quot;a&quot;]),
-        b = reverseframes(fopening[&quot;b&quot;]),
-        c = reverseframes(fopening[&quot;c&quot;]),
-        d = reverseframes(fopening[&quot;d&quot;]),
+        a = ReverseFrames(fopening[&quot;a&quot;]),
+        b = ReverseFrames(fopening[&quot;b&quot;]),
+        c = ReverseFrames(fopening[&quot;c&quot;]),
+        d = ReverseFrames(fopening[&quot;d&quot;]),
     }
 
     function mkopenclose(flavor, color)
@@ -1019,51 +1203,51 @@
         local fadein = &quot;oxyd&quot;..flavor..&quot;-fadein&quot;
         local fadeout= &quot;oxyd&quot;..flavor..&quot;-fadeout&quot;
 
-        def_overlay(n..&quot;-base&quot;, {baseimg[flavor], colorspots[color+1]})
+        DefOverlay(n..&quot;-base&quot;, {baseimg[flavor], colorspots[color+1]})
         display.DefineComposite(n..&quot;-opening-fg&quot;, n..&quot;-base&quot;, fadein)
         display.DefineComposite(n..&quot;-closing-fg&quot;, n..&quot;-base&quot;, fadeout)
-        def_shmodel (n..&quot;-opening&quot;, n..&quot;-opening-fg&quot;, shadow[flavor])
-        def_shmodel (n..&quot;-closing&quot;, n..&quot;-closing-fg&quot;, shadow[flavor])
+        DefShModel (n..&quot;-opening&quot;, n..&quot;-opening-fg&quot;, shadow[flavor])
+        DefShModel (n..&quot;-closing&quot;, n..&quot;-closing-fg&quot;, shadow[flavor])
     end
 
     function mkblink(flavor, color)
         local n = &quot;st-oxyd&quot;..flavor..color..&quot;-blink&quot;
         local img={baseimg[flavor],colorspots[color+1], &quot;st-oxyd-questmark&quot;}
-        def_overlay(n..1, img)
-        def_overlay(n..2, {baseimg[flavor], colorspots[color+1]})
-        def_anim(n..&quot;-anim&quot;, buildframes({n..1,n..2}, 500), 1)
-        def_shmodel(n, n..&quot;-anim&quot;, shadow[flavor])
+        DefOverlay(n..1, img)
+        DefOverlay(n..2, {baseimg[flavor], colorspots[color+1]})
+        DefAnim(n..&quot;-anim&quot;, BuildFrames({n..1,n..2}, 500), 1)
+        DefShModel(n, n..&quot;-anim&quot;, shadow[flavor])
     end
 
     function mkopened(flavor, color)
         local n = &quot;st-oxyd&quot; .. flavor .. color .. &quot;-open&quot;
         local names = {}
 
-        for i=1,getn(openovls) do
+        for i=1, table.getn(openovls) do
             local images={baseimg[flavor],colorspots[color+1],openovls[i]}
             names[i] = n .. format(&quot;_%04d&quot;, i)
-            def_overlay(names[i], images)
+            DefOverlay(names[i], images)
         end
 
         -- compose these images into an animation
-        frames = pingpong(buildframes(names, 100))
-        def_anim(n..&quot;-anim&quot;, frames, true)
+        frames = PingPong(BuildFrames(names, 100))
+        DefAnim(n..&quot;-anim&quot;, frames, true)
 
         -- and finally add a shadow to make the model complete
-        def_shmodel(n, n..&quot;-anim&quot;, shadow[flavor])
+        DefShModel(n, n..&quot;-anim&quot;, shadow[flavor])
     end
 
     function mkoxyd(flavor)
-        def_stone(&quot;st-oxyd&quot;..flavor, shadow[flavor])
-        def_shmodel(&quot;st-likeoxyd&quot;..flavor, &quot;st-oxyd&quot;..flavor, shadow[flavor])
---        def_solidstone(&quot;st-likeoxyd&quot;..flavor, &quot;st-oxyd&quot;..flavor)
-        img=def_image(&quot;st-oxyd&quot;..flavor..&quot;-open&quot;)
-        def_shmodel(&quot;st-likeoxyd&quot;..flavor..&quot;-open&quot;, img, shadow[flavor])
+        DefStone(&quot;st-oxyd&quot;..flavor, shadow[flavor])
+        DefShModel(&quot;st-likeoxyd&quot;..flavor, &quot;st-oxyd&quot;..flavor, shadow[flavor])
+--        DefSolidStone(&quot;st-likeoxyd&quot;..flavor, &quot;st-oxyd&quot;..flavor)
+        img=DefImage(&quot;st-oxyd&quot;..flavor..&quot;-open&quot;)
+        DefShModel(&quot;st-likeoxyd&quot;..flavor..&quot;-open&quot;, img, shadow[flavor])
 
         local fadein = &quot;oxyd&quot;..flavor..&quot;-fadein&quot;
         local fadeout= &quot;oxyd&quot;..flavor..&quot;-fadeout&quot;
-        def_anim(fadein, fopening[flavor])
-        def_anim(fadeout, fclosing[flavor])
+        DefAnim(fadein, fopening[flavor])
+        DefAnim(fadeout, fclosing[flavor])
 
         for color=0,7 do
             mkopenclose(flavor, color)
@@ -1073,123 +1257,97 @@
     end
     mkoxyd(&quot;a&quot;)
     mkoxyd(&quot;b&quot;)
---    Progress(50)
     mkoxyd(&quot;d&quot;)
     mkoxyd(&quot;c&quot;)
 end
 
-def_alias(&quot;st-coffee&quot;, &quot;st-oxydc&quot;)
+-- st-coffee --
+do
+    DefAlias(&quot;st-coffee&quot;, &quot;st-oxydc&quot;)
+end
 
---Progress(60)
+-- st-doorh, st-doorv --
+do
+    local f,img,sh
 
------------------
--- Laser stone --
------------------
-function make_laser(dir)
-    laseron=framenames(&quot;st-laser&quot;..dir, 1, 9)
+    img=DefSubimages(&quot;st-doorh&quot;, {h=7})
+    sh=DefSubimages(&quot;sh-doorh&quot;, {h=7,imgw=ShadowSize,imgh=ShadowSize})
+    DefShModel(&quot;st-doorh-open&quot;, img[1], sh[1])
+    DefShModel(&quot;st-doorh-closed&quot;, img[7], sh[7])
+    DefAnim(&quot;doorh-opening-fg&quot;, ReverseFrames(BuildFrames(img, 60)))
+    DefAnim(&quot;doorh-opening-bg&quot;, ReverseFrames(BuildFrames(sh, 60)))
+    DefShModel(&quot;st-doorh-opening&quot;, &quot;doorh-opening-fg&quot;, &quot;doorh-opening-bg&quot;)
+    DefAnim(&quot;doorh-closing-fg&quot;, BuildFrames(img, 60))
+    DefAnim(&quot;doorh-closing-bg&quot;, BuildFrames(sh, 60))
+    DefShModel(&quot;st-doorh-closing&quot;, &quot;doorh-closing-fg&quot;, &quot;doorh-closing-bg&quot;)
 
-    -- deactivated laser
-    def_overlay(&quot;laser&quot;..dir, {&quot;st-laser-base&quot;, laseron[1]})
-    def_roundstone(&quot;st-laser&quot;..dir, &quot;laser&quot;..dir)
+    img=DefSubimages(&quot;st-doorv&quot;, {w=7})
+    sh=DefSubimages(&quot;sh-doorv&quot;, {w=7,imgw=ShadowSize,imgh=ShadowSize})
+    DefShModel(&quot;st-doorv-open&quot;, img[1], sh[1])
+    DefShModel(&quot;st-doorv-closed&quot;, img[7], sh[7])
+    DefAnim(&quot;doorv-opening-fg&quot;, ReverseFrames(BuildFrames(img, 60)))
+    DefAnim(&quot;doorv-opening-bg&quot;, ReverseFrames(BuildFrames(sh, 60)))
+    DefShModel(&quot;st-doorv-opening&quot;, &quot;doorv-opening-fg&quot;, &quot;doorv-opening-bg&quot;)
+    DefAnim(&quot;doorv-closing-fg&quot;, BuildFrames(img, 60))
+    DefAnim(&quot;doorv-closing-bg&quot;, BuildFrames(sh, 60))
+    DefShModel(&quot;st-doorv-closing&quot;, &quot;doorv-closing-fg&quot;, &quot;doorv-closing-bg&quot;)
+end
 
-    -- activated laser
-    names = {}
-    for i=1,getn(laseron) do
-	names[i] = &quot;st-laseron&quot;..dir .. format(&quot;_%04d&quot;, i)
-	def_overlay (names[i], {&quot;st-laser-base&quot;, laseron[i]})
-    end
-    frames = buildframes(names, 100)
-    def_anim(&quot;st-laseron-anim&quot;..dir, frames, 1)
-    def_roundstone(&quot;st-laseron&quot;..dir, &quot;st-laseron-anim&quot;..dir)
+-- st-door_a --
+do
+    DefAlias(&quot;st-door_a-open&quot;, &quot;st-grate1&quot;)
+    DefAlias(&quot;st-door_a-closed&quot;, &quot;st-oxyda&quot;)
+    local f = BuildFrames({&quot;st-door_a-closed&quot;, &quot;st-door_a-open&quot;},60)
+    DefAnim(&quot;st-door_a-opening&quot;, f)
+    DefAnim(&quot;st-door_a-closing&quot;, ReverseFrames(f))
 end
 
-make_laser(&quot;-e&quot;)
-make_laser(&quot;-s&quot;)
-make_laser(&quot;-w&quot;)
-make_laser(&quot;-n&quot;)
+-- st-door_b --
+do
+    DefAlias(&quot;st-door_b-open&quot;, &quot;invisible&quot;)
+    DefAlias(&quot;st-door_b-closed&quot;, &quot;st-rock3&quot;)
+    local img=DefSubimages(&quot;st-doorb&quot;, {modelname=&quot;doorb&quot;, h=8})
+    local f = BuildFrames(img,60)
+    DefAnim(&quot;st-door_b-opening&quot;, f)
+    DefAnim(&quot;st-door_b-closing&quot;, ReverseFrames(f))
+end
 
----------------------
--- Fake oxyd stone --
----------------------
-def_stone(&quot;st-fakeoxyd&quot;, &quot;sh-round&quot;, {filename=&quot;st-oxydb&quot;})
-def_anim_images(&quot;fakeoxyd-blink&quot;,
-                repeatanim(pingpong(
-                            buildframes(framenames(&quot;st-fakeoxyd-blink&quot;, 1,4),
-                                        50))))
-def_roundstone(&quot;st-fakeoxyd-blink&quot;, &quot;fakeoxyd-blink&quot;)
-
-def_alias(&quot;st-fakeoxyda&quot;, &quot;st-oxyda&quot;)
-
--- Fart stone
-def_stone(&quot;st-fart&quot;, &quot;sh-round&quot;, {filename=&quot;st-oxydb&quot;})
-def_anim_images(&quot;farting&quot;,
-                repeatanim(pingpong(
-                            buildframes(framenames(&quot;st-fakeoxyd-blink&quot;, 1,4),
-                                        50))))
-def_roundstone(&quot;st-farting&quot;, &quot;farting&quot;)
-
-namelist = def_subimages(&quot;st-fart-break&quot;,{h=6})
-def_anim(&quot;fartbreak-anim&quot;, buildframes(namelist,50))
-def_roundstone(&quot;st-fartbreak-anim&quot;, &quot;fartbreak-anim&quot;)
-
--- st-rock3_movebreak
-
-namelist = def_subimages(&quot;st-rock3-break&quot;, {h=6})
-def_anim(&quot;rock3_break-anim&quot;,buildframes(namelist,50))
-def_solidstone(&quot;st-rock3_break-anim&quot;, &quot;rock3_break-anim&quot;)
-def_alias(&quot;st-rock3_movebreak&quot;, &quot;st-rock3&quot;)
-
--- st-rock3-falling
-
+-- st-door_c --
 do
-    local n = def_subimages(&quot;st-rock3-falling&quot;, {h=4})
-    def_anim(&quot;st-rock3-falling&quot;, buildframes(n, 100))
+    DefAlias(&quot;st-door_c-open&quot;, &quot;st-grate2&quot;)
+    DefAlias(&quot;st-door_c-closed&quot;, &quot;st-rock3&quot;)
+    frames=BuildFrames({&quot;st-door_c-closed&quot;,&quot;st-door_c-open&quot;},60)
+    DefAnim(&quot;st-door_c-opening&quot;, frames)
+    DefAnim(&quot;st-door_c-closing&quot;, ReverseFrames(frames))
 end
 
--- Breaking stone
-
-def_alias(&quot;st-breaking&quot;, &quot;st-rock3_break-anim&quot;)
-
--- Actor impulse stone
+-- st-fakeoxyd --
 do
-   namelist = def_subimages(&quot;st-actorimpulse&quot;, {h=3})
-   shnamelist = def_subimages(&quot;sh-actorimpulse&quot;, {h=3,imgw=ShadowSize,imgh=ShadowSize})
+    DefStone(&quot;st-fakeoxyd&quot;, &quot;sh-round&quot;, {filename=&quot;st-oxydb&quot;})
+    DefAnimImages(&quot;fakeoxyd-blink&quot;,
+        RepeatAnim(PingPong(BuildFrames(FrameNames(&quot;st-fakeoxyd-blink&quot;, 1,4),50))))
+    DefRoundStone(&quot;st-fakeoxyd-blink&quot;, &quot;fakeoxyd-blink&quot;)
 
-   def_anim(&quot;st-ai-fg&quot;, pingpong(buildframes(namelist, 30)))
-   def_anim(&quot;st-ai-sh&quot;, pingpong(buildframes(shnamelist, 30)))
-   def_shmodel(&quot;st-actorimpulse-anim&quot;, &quot;st-ai-fg&quot;, &quot;st-ai-sh&quot;)
-
-   def_shmodel(&quot;st-actorimpulse&quot;, namelist[1], shnamelist[1])
+    DefAlias(&quot;st-fakeoxyda&quot;, &quot;st-oxyda&quot;)
 end
 
--- Stone impulse stone
---
--- Note: It's important that the duration of the closing animation
--- (anim2) is longer than the opening animation (anim1). Otherwise
--- impulse stones do not work properly!
-
+-- st-fart --
 do
-   namelist = def_subimages(&quot;st-stoneimpulse&quot;, {h=4})
-   def_roundstone(&quot;st-stoneimpulse&quot;, namelist[1])
-   frames={}
-   for i=1,4 do table.insert(frames, namelist[i]) end
-   def_anim(&quot;stoneimpulse-anim1&quot;, buildframes(frames, 55))
-   def_roundstone(&quot;st-stoneimpulse-anim1&quot;, &quot;stoneimpulse-anim1&quot;)
-   table.insert(frames, namelist[4]) -- add 1 frame to make closing anim longer!
-   def_anim(&quot;stoneimpulse-anim2&quot;, reverseframes(buildframes(frames, 55)))
-   def_roundstone(&quot;st-stoneimpulse-anim2&quot;, &quot;stoneimpulse-anim2&quot;)
+    DefStone(&quot;st-fart&quot;, &quot;sh-round&quot;, {filename=&quot;st-oxydb&quot;})
+    DefAnimImages(&quot;farting&quot;,
+        RepeatAnim(PingPong(BuildFrames(FrameNames(&quot;st-fakeoxyd-blink&quot;, 1,4),50))))
+    DefRoundStone(&quot;st-farting&quot;, &quot;farting&quot;)
+
+    namelist = DefSubimages(&quot;st-fart-break&quot;,{h=6})
+    DefAnim(&quot;fartbreak-anim&quot;, BuildFrames(namelist,50))
+    DefRoundStone(&quot;st-fartbreak-anim&quot;, &quot;fartbreak-anim&quot;)
 end
 
+-- st-spitter --
 do
-   namelist = def_subimages(&quot;st-stoneimpulse-hollow&quot;, {h=4})
-   def_shmodel(&quot;st-stoneimpulse-hollow&quot;, namelist[1], &quot;sh-floating&quot;)
-   frames={}
-   for i=1,4 do table.insert(frames, namelist[i]) end
-   def_anim(&quot;stoneimpulse-hollow-anim1&quot;, buildframes(frames, 55))
-   def_shmodel(&quot;st-stoneimpulse-hollow-anim1&quot;, &quot;stoneimpulse-hollow-anim1&quot;, &quot;sh-floating&quot;)
-   table.insert(frames, namelist[4]) -- add 1 frame to make closing anim longer!
-   def_anim(&quot;stoneimpulse-hollow-anim2&quot;, reverseframes(buildframes(frames, 55)))
-   def_shmodel(&quot;st-stoneimpulse-hollow-anim2&quot;, &quot;stoneimpulse-hollow-anim2&quot;, &quot;sh-floating&quot;)
+    DefAlias (&quot;st-spitter&quot;, &quot;st-timeswitch&quot;)
+    DefAlias (&quot;st-spitter-loading&quot;, &quot;st-fakeoxyd-blink&quot;)
+    DefAlias (&quot;st-spitter-spitting&quot;, &quot;st-fakeoxyd-blink&quot;)
 end
 
 ---------------------------
@@ -1200,203 +1358,73 @@
 
     local stonebase = &quot;st-bluegray&quot;
     local floorbase = &quot;fl-bluegray&quot;
-    local thiefovl = def_subimages(&quot;thief-template&quot;, {h = 7})
-    local capturedovl = def_subimages(&quot;thief-captured-template&quot;, {h = 12})
+    local thiefovl = DefSubimages(&quot;thief-template&quot;, {h = 7})
+    local capturedovl = DefSubimages(&quot;thief-captured-template&quot;, {h = 12})
 
     -- Creating st-thief
 
     local names = {}
-    for j = 1, getn(thiefovl) do
+    for j = 1, table.getn(thiefovl) do
         names[j] = &quot;st-thief&quot;..format(&quot;_%04d&quot;, j)
         display.DefineComposite(names[j], stonebase, thiefovl[j])
     end
 
-    local f1 = buildframes(names, 80)
-    def_anim(&quot;pre-st-thief-emerge&quot;, f1)
-    def_anim(&quot;pre-st-thief-retreat&quot;, reverseframes(f1))
-    def_roundstone(&quot;st-thief&quot;, stonebase)
-    def_roundstone(&quot;st-thief-emerge&quot;, &quot;pre-st-thief-emerge&quot;)
-    def_roundstone(&quot;st-thief-retreat&quot;, &quot;pre-st-thief-retreat&quot;)
+    local f1 = BuildFrames(names, 80)
+    DefAnim(&quot;pre-st-thief-emerge&quot;, f1)
+    DefAnim(&quot;pre-st-thief-retreat&quot;, ReverseFrames(f1))
+    DefRoundStone(&quot;st-thief&quot;, stonebase)
+    DefRoundStone(&quot;st-thief-emerge&quot;, &quot;pre-st-thief-emerge&quot;)
+    DefRoundStone(&quot;st-thief-retreat&quot;, &quot;pre-st-thief-retreat&quot;)
 
     -- Creating st-thief-captured
     --
     --   Note that this is done without template, as the whole
     --   stone has to disappear (e.g. via shrinking)
 
-    local img2 = def_subimages(&quot;st-thief-captured&quot;, {h = 12})
-    local f2 = buildframes(img2, 80)
-    def_anim(&quot;st-thief-captured&quot;, f2)
+    local img2 = DefSubimages(&quot;st-thief-captured&quot;, {h = 12})
+    local f2 = BuildFrames(img2, 80)
+    DefAnim(&quot;st-thief-captured&quot;, f2)
 
     -- Creating fl-thief
 
     local floornames = {}
     local floorcaptured = {}
-    local floorbases = def_subimages(floorbase, {h=4, modelname=&quot;fl-thief-base&quot;})
+    local floorbases = DefSubimages(floorbase, {h=4, modelname=&quot;fl-thief-base&quot;})
     for k = 1,4 do
       floornames[k] = {}
-      for j = 1, getn(thiefovl) do
+      for j = 1, table.getn(thiefovl) do
         floornames[k][j] = &quot;fl-thief&quot;..k..format(&quot;_%04d&quot;, j)
         display.DefineComposite(floornames[k][j], floorbases[k], thiefovl[j])
       end
       floorcaptured[k] = {}
-      for j = 1, getn(capturedovl) do
+      for j = 1, table.getn(capturedovl) do
         floorcaptured[k][j] = &quot;fl-thief&quot;..k..&quot;-captured&quot;..format(&quot;_%04d&quot;, j)
         display.DefineComposite(floorcaptured[k][j], floorbases[k], capturedovl[j])
       end
-      local f3 = buildframes(floornames[k], 80)
-      local f4 = buildframes(floorcaptured[k], 80)
-      def_alias(&quot;fl-thief&quot;..k, floorbases[k])
-      def_anim(&quot;fl-thief&quot;..k..&quot;-emerge&quot;, f3)
-      def_anim(&quot;fl-thief&quot;..k..&quot;-retreat&quot;, reverseframes(f3))
-      def_anim(&quot;fl-thief&quot;..k..&quot;-captured&quot;, f4)
+      local f3 = BuildFrames(floornames[k], 80)
+      local f4 = BuildFrames(floorcaptured[k], 80)
+      DefAlias(&quot;fl-thief&quot;..k, floorbases[k])
+      DefAnim(&quot;fl-thief&quot;..k..&quot;-emerge&quot;, f3)
+      DefAnim(&quot;fl-thief&quot;..k..&quot;-retreat&quot;, ReverseFrames(f3))
+      DefAnim(&quot;fl-thief&quot;..k..&quot;-captured&quot;, f4)
     end
 
 --do
---    local img = def_subimages(&quot;fl-thief&quot;, {h=7})
---    local f = buildframes(img, 80)
---    def_anim(&quot;thief-emerge&quot;, f)
---    def_anim(&quot;thief-retreat&quot;, reverseframes(f))
---    def_roundstone(&quot;fl-thief&quot;, img[1])
---    def_roundstone(&quot;fl-thief-emerge&quot;, &quot;thief-emerge&quot;)
---    def_roundstone(&quot;fl-thief-retreat&quot;, &quot;thief-retreat&quot;)
+--    local img = DefSubimages(&quot;fl-thief&quot;, {h=7})
+--    local f = BuildFrames(img, 80)
+--    DefAnim(&quot;thief-emerge&quot;, f)
+--    DefAnim(&quot;thief-retreat&quot;, ReverseFrames(f))
+--    DefRoundStone(&quot;fl-thief&quot;, img[1])
+--    DefRoundStone(&quot;fl-thief-emerge&quot;, &quot;thief-emerge&quot;)
+--    DefRoundStone(&quot;fl-thief-retreat&quot;, &quot;thief-retreat&quot;)
 --end
 
 end
 
------------------
--- Chess stone --
------------------
-function make_chess(colour)
-    local img1 = def_subimages(&quot;st-chess&quot;..colour, {h=5});
-    --local img2 = def_subimages(&quot;st-chess&quot;..colour..&quot;-captured&quot;, {h=5});
-    local f1 = buildframes(img1, 120)
-    --local f2 = buildframes(img2, 40)
-    local f2 = f1
-    local f3 = buildframes(img1, 500)
-    def_anim(&quot;st-chess&quot;..colour..&quot;-disappearing&quot;, f1);
-    def_anim(&quot;st-chess&quot;..colour..&quot;-appearing&quot;, reverseframes(f1))
-    def_anim(&quot;st-chess&quot;..colour..&quot;-captured&quot;, f2);
-    def_anim(&quot;st-chess&quot;..colour..&quot;-swamp&quot;, f3);
-    def_roundstone(&quot;st-chess&quot;..colour, img1[1])
-end
-
-make_chess(&quot;_black&quot;)
-make_chess(&quot;_white&quot;)
-
------------------
--- Timer stone --
------------------
-do
-    local img = def_subimages(&quot;st-timer&quot;, {h=4})
-    def_anim(&quot;timer-anim&quot;, buildframes(img, 120), 1)
-    def_roundstone(&quot;st-timer&quot;, &quot;timer-anim&quot;)
-    def_roundstone(&quot;st-timeroff&quot;, &quot;st-timer1&quot;)
-end
-
------------------
--- Bomb Stones --
------------------
-
-function make_bombstone(name)
-    local n=def_subimages(name, {h=7})
-    def_roundstone(name, name..&quot;1&quot;)
-    def_anim(name..&quot;-anim&quot;, buildframes(n,50))
-end
-
-make_bombstone(&quot;st-bombs&quot;)
-make_bombstone(&quot;st-dynamite&quot;)
-make_bombstone(&quot;st-whitebombs&quot;)
-
-----------------
--- Mail stone --
-----------------
-do
-    local n=def_subimages(&quot;st-mail&quot;, {h=4})
-    def_solidstone(&quot;st-mail-n&quot;, &quot;st-mail1&quot;)
-    def_solidstone(&quot;st-mail-e&quot;, &quot;st-mail2&quot;)
-    def_solidstone(&quot;st-mail-s&quot;, &quot;st-mail4&quot;)
-    def_solidstone(&quot;st-mail-w&quot;, &quot;st-mail3&quot;)
-end
-
-function def_solidstone_with_anim(name, npictures, frametime)
-    local n=def_subimages(name, {h=npictures})
-    def_anim(name..&quot;-animfg&quot;, buildframes(n,frametime))
-    def_solidstone(name..&quot;-anim&quot;, name..&quot;-animfg&quot;)
-    def_solidstone(name, n[1])
-end
-function def_roundstone_with_anim(name, npictures, frametime)
-    local n=def_subimages(name, {h=npictures})
-    def_anim(name..&quot;-animfg&quot;, buildframes(n,frametime))
-    def_roundstone(name..&quot;-anim&quot;, name..&quot;-animfg&quot;)
-    def_roundstone(name, n[1])
- end
-
-def_solidstone_with_anim (&quot;st-window&quot;, 4, 80)
-def_solidstone_with_anim (&quot;st-stone_break&quot;, 10, 50)
-def_solidstone_with_anim (&quot;st-break_bolder&quot;, 10, 50)
-def_roundstone_with_anim (&quot;st-break_acwhite&quot;, 10, 50)
-def_roundstone_with_anim (&quot;st-break_acblack&quot;, 10, 50)
-def_roundstone_with_anim (&quot;st-break_gray&quot;, 10, 50)
-def_roundstone_with_anim (&quot;st-death&quot;, 3, 140)
-
-
--- Flash stone --
-do
-    local n=def_subimages(&quot;st-flash&quot;, {h=1})
-    def_solidstone(&quot;st-flash&quot;, &quot;st-flash1&quot;)
-end
-
--- Surprise stone --
-do
-    def_stone (&quot;st-surprise&quot;)
-end
-
--- Charge stones --
-do
-    function def_chargestone(basename)
-        local n=def_subimages(basename, {h=2})
-        def_solidstone(basename, n[1])
-        def_anim(basename..&quot;-animfg&quot;, {{n[2], 140}})
-        def_solidstone(basename..&quot;-anim&quot;, basename..&quot;-animfg&quot;)
-    end
-    def_chargestone(&quot;st-chargeplus&quot;)
-    def_chargestone(&quot;st-chargeminus&quot;)
-    def_chargestone(&quot;st-chargezero&quot;)
-end
-
----------------
--- Turnstile --
----------------
-do
-   local img = def_subimages(&quot;st-turnstile&quot;, {h=2})
-   def_anim(&quot;turnstile-anim&quot;, reverseframes(buildframes(img, 30)))
-   def_solidstone(&quot;st-turnstile&quot;, img[1])
-   def_solidstone(&quot;st-turnstile-anim&quot;, &quot;turnstile-anim&quot;)
-end
-
-do
-   local img = def_subimages(&quot;st-turnstile-green&quot;, {h=2})
-   def_anim(&quot;turnstile-green-anim&quot;, reverseframes(buildframes(img, 30)))
-   def_solidstone(&quot;st-turnstile-green&quot;, img[1])
-   def_solidstone(&quot;st-turnstile-green-anim&quot;, &quot;turnstile-green-anim&quot;)
-end
-
-----------------
--- Timeswitch --
-----------------
-do
-    def_stone(&quot;st-timeswitch&quot;)
-    local img = def_subimages(&quot;st-time1switch&quot;, {h=2})
-    def_anim(&quot;st-time1switch-anim&quot;, buildframes (img, 180), 1)
-    def_solidstone(&quot;st-time1switch&quot;, &quot;st-time1switch-anim&quot;)
-end
-
---Progress(70)
-
 -------------
 -- Mirrors --
 -------------
-
+--
 -- naming scheme for mirror models:
 --
 --	st-{3mirror,pmirror}-{m,s}{o,t}[1234]
@@ -1411,310 +1439,124 @@
 --	2	west	  &quot;&lt;&quot;        &quot;\&quot;
 --	3	north	  &quot;^&quot;        &quot;|&quot;
 --	4	east	  &quot;&gt;&quot;        &quot;/&quot;
-
-function make_mirror(basename, baseimg, overlays)
-    for i=1,4 do
-	mname = basename .. i
-	def_overlay (mname .. &quot;-ovl&quot;, {baseimg, overlays[i]})
-	def_shmodel(mname, mname .. &quot;-ovl&quot;, &quot;sh-round2&quot;)
-    end
-end
-
-mirror3_opaque = framenames(&quot;st-mirrortempl&quot;, 1, 4)
-mirror3_transp = framenames(&quot;st-mirrortempl&quot;, 5, 8)
-mirrorp_opaque = framenames(&quot;st-mirrortempl&quot;, 9, 12)
-mirrorp_transp = framenames(&quot;st-mirrortempl&quot;, 13, 16)
-
-make_mirror(&quot;st-3mirror-mo&quot;, &quot;st-mirror-movable&quot;, mirror3_opaque)
-make_mirror(&quot;st-3mirror-so&quot;, &quot;st-mirror-static&quot;,  mirror3_opaque)
-make_mirror(&quot;st-3mirror-mt&quot;, &quot;st-mirror-movable&quot;, mirror3_transp)
-make_mirror(&quot;st-3mirror-st&quot;, &quot;st-mirror-static&quot;,  mirror3_transp)
-
-make_mirror(&quot;st-pmirror-mo&quot;, &quot;st-mirror-movable&quot;, mirrorp_opaque)
-make_mirror(&quot;st-pmirror-so&quot;, &quot;st-mirror-static&quot;,  mirrorp_opaque)
-make_mirror(&quot;st-pmirror-mt&quot;, &quot;st-mirror-movable&quot;, mirrorp_transp)
-make_mirror(&quot;st-pmirror-st&quot;, &quot;st-mirror-static&quot;,  mirrorp_transp)
-
--- OneWay --
 do
-   local model_names = {  
-       &quot;st-oneway-e&quot;, &quot;st-oneway-n&quot;, &quot;st-oneway-s&quot;, &quot;st-oneway-w&quot;,
-       &quot;st-oneway_black-e&quot;, &quot;st-oneway_black-n&quot;, &quot;st-oneway_black-s&quot;, &quot;st-oneway_black-w&quot;,
-       &quot;st-oneway_white-e&quot;, &quot;st-oneway_white-n&quot;, &quot;st-oneway_white-s&quot;, &quot;st-oneway_white-w&quot;
-   }
-   def_subimages(&quot;st-oneway&quot;, {modelname=&quot;st-onewayx&quot;,w=3,h=4})
-   for i=1,12 do def_floatingstone(model_names[i], &quot;st-onewayx&quot;..i) end
-end
-
----------------
--- Coin slot --
----------------
-do
-    def_stone(&quot;st-coinslot&quot;)
-    local img=def_subimages(&quot;st-coin2slot&quot;, {h=18})
-    def_anim(&quot;st-coin2slot-anim&quot;, buildframes(img, 20))
-    def_solidstone(&quot;st-coin2slot&quot;, &quot;st-coin2slot-anim&quot;)
-    def_solidstone(&quot;st-coinslot-active&quot;, &quot;st-coin2slot18&quot;)
-end
-
-
---Progress(80)
-
--------------------
--- Puzzle stones --
--------------------
-do
-    def_subimages(&quot;st-puzzle&quot;, {modelname=&quot;st-puzzlex&quot;,w=8,h=4})
-    for i=2,16  do def_solidstone(&quot;st-puzzle&quot;..i, &quot;st-puzzlex&quot;..i) end
-    for i=18,32 do def_solidstone(&quot;st-puzzle&quot;..i, &quot;st-puzzlex&quot;..i) end
-    def_shmodel(&quot;st-puzzle1&quot;, &quot;st-puzzlex1&quot;, &quot;sh-puzzle1&quot;)
-    def_shmodel(&quot;st-puzzle17&quot;, &quot;st-puzzlex17&quot;, &quot;sh-puzzle1&quot;)
-end
-
-def_alias(&quot;st-turnstile-e&quot;, &quot;st-puzzle2&quot;)
-def_alias(&quot;st-turnstile-w&quot;, &quot;st-puzzle5&quot;)
-def_alias(&quot;st-turnstile-s&quot;, &quot;st-puzzle9&quot;)
-def_alias(&quot;st-turnstile-n&quot;, &quot;st-puzzle3&quot;)
---def_stone(&quot;st-turnstile&quot;)
-
----------------
--- Big brick --
----------------
-
-do
-   def_subimages(&quot;st-bigbrick&quot;, {modelname=&quot;st-bigbrickx&quot;,w=4,h=4})
-   for i=1,16 do def_solidstone(&quot;st-bigbrick&quot;..i, &quot;st-bigbrickx&quot;..i) end
-end
-
---def_alias(&quot;st-bigbrick&quot;, &quot;st-bigbrick1&quot;);
---def_alias(&quot;st-bigbrick-n&quot;, &quot;st-bigbrick9&quot;);
---def_alias(&quot;st-bigbrick-e&quot;, &quot;st-bigbrick5&quot;);
---def_alias(&quot;st-bigbrick-s&quot;, &quot;st-bigbrick3&quot;);
---def_alias(&quot;st-bigbrick-w&quot;, &quot;st-bigbrick2&quot;);
---def_alias(&quot;st-bigbrick-ne&quot;, &quot;st-bigbrick13&quot;);
---def_alias(&quot;st-bigbrick-nw&quot;, &quot;st-bigbrick10&quot;);
---def_alias(&quot;st-bigbrick-es&quot;, &quot;st-bigbrick7&quot;);
---def_alias(&quot;st-bigbrick-sw&quot;, &quot;st-bigbrick4&quot;);
---def_alias(&quot;st-bigbrick-ns&quot;, &quot;st-bigbrick11&quot;);
---def_alias(&quot;st-bigbrick-ew&quot;, &quot;st-bigbrick6&quot;);
---def_alias(&quot;st-bigbrick-nes&quot;, &quot;st-bigbrick15&quot;);
---def_alias(&quot;st-bigbrick-new&quot;, &quot;st-bigbrick14&quot;);
---def_alias(&quot;st-bigbrick-nsw&quot;, &quot;st-bigbrick12&quot;);
---def_alias(&quot;st-bigbrick-esw&quot;, &quot;st-bigbrick8&quot;);
---def_alias(&quot;st-bigbrick-nesw&quot;, &quot;st-bigbrick16&quot;);
-
------------------
--- BigBlueSand --
------------------
-
-do
-   def_subimages(&quot;st-bigbluesand&quot;, {modelname=&quot;st-bigbluesandx&quot;,w=4,h=4})
-   for i=1,16 do def_solidstone(&quot;st-bigbluesand&quot;..i, &quot;st-bigbluesandx&quot;..i) end
-end
-
------------
--- Doors --
------------
-do
-    local f,img,sh
-
-    img=def_subimages(&quot;st-doorh&quot;, {h=7})
-    sh=def_subimages(&quot;sh-doorh&quot;, {h=7,imgw=ShadowSize,imgh=ShadowSize})
-    def_shmodel(&quot;st-doorh-open&quot;, img[1], sh[1])
-    def_shmodel(&quot;st-doorh-closed&quot;, img[7], sh[7])
-    def_anim(&quot;doorh-opening-fg&quot;, reverseframes(buildframes(img, 60)))
-    def_anim(&quot;doorh-opening-bg&quot;, reverseframes(buildframes(sh, 60)))
-    def_shmodel(&quot;st-doorh-opening&quot;, &quot;doorh-opening-fg&quot;, &quot;doorh-opening-bg&quot;)
-    def_anim(&quot;doorh-closing-fg&quot;, buildframes(img, 60))
-    def_anim(&quot;doorh-closing-bg&quot;, buildframes(sh, 60))
-    def_shmodel(&quot;st-doorh-closing&quot;, &quot;doorh-closing-fg&quot;, &quot;doorh-closing-bg&quot;)
-
-
-    img=def_subimages(&quot;st-doorv&quot;, {w=7})
-    sh=def_subimages(&quot;sh-doorv&quot;, {w=7,imgw=ShadowSize,imgh=ShadowSize})
-    def_shmodel(&quot;st-doorv-open&quot;, img[1], sh[1])
-    def_shmodel(&quot;st-doorv-closed&quot;, img[7], sh[7])
-    def_anim(&quot;doorv-opening-fg&quot;, reverseframes(buildframes(img, 60)))
-    def_anim(&quot;doorv-opening-bg&quot;, reverseframes(buildframes(sh, 60)))
-    def_shmodel(&quot;st-doorv-opening&quot;, &quot;doorv-opening-fg&quot;, &quot;doorv-opening-bg&quot;)
-    def_anim(&quot;doorv-closing-fg&quot;, buildframes(img, 60))
-    def_anim(&quot;doorv-closing-bg&quot;, buildframes(sh, 60))
-    def_shmodel(&quot;st-doorv-closing&quot;, &quot;doorv-closing-fg&quot;, &quot;doorv-closing-bg&quot;)
-end
-
--- Door_a --
-do
-    def_alias(&quot;st-door_a-open&quot;, &quot;st-grate1&quot;)
-    def_alias(&quot;st-door_a-closed&quot;, &quot;st-oxyda&quot;)
-    local f = buildframes({&quot;st-door_a-closed&quot;, &quot;st-door_a-open&quot;},60)
-    def_anim(&quot;st-door_a-opening&quot;, f)
-    def_anim(&quot;st-door_a-closing&quot;, reverseframes(f))
-end
-
--- Door_b --
-do
-    def_alias(&quot;st-door_b-open&quot;, &quot;invisible&quot;)
-    def_alias(&quot;st-door_b-closed&quot;, &quot;st-plain&quot;)
-    local img=def_subimages(&quot;st-doorb&quot;, {modelname=&quot;doorb&quot;, h=8})
-    local f = buildframes(img,60)
-    def_anim(&quot;st-door_b-opening&quot;, f)
-    def_anim(&quot;st-door_b-closing&quot;, reverseframes(f))
-end
-
--- Door_c --
-do
-    def_alias(&quot;st-door_c-open&quot;, &quot;st-grate2&quot;)
-    def_alias(&quot;st-door_c-closed&quot;, &quot;st-plain&quot;)
-    frames=buildframes({&quot;st-door_c-closed&quot;,&quot;st-door_c-open&quot;},60)
-    def_anim(&quot;st-door_c-opening&quot;, frames)
-    def_anim(&quot;st-door_c-closing&quot;, reverseframes(frames))
-end
-
-------------------
--- Knight stone --
-------------------
-do
-    local n = def_subimages(&quot;st-knight&quot;, {modelname=&quot;knight&quot;, h=5})
-    for i=1,getn(n) do
-        def_solidstone(&quot;st-knight&quot;..i, n[i])
+    function make_mirror(basename, baseimg, overlays)
+        for i=1,4 do
+	        mname = basename .. i
+	        DefOverlay (mname .. &quot;-ovl&quot;, {baseimg, overlays[i]})
+	        DefShModel(mname, mname .. &quot;-ovl&quot;, &quot;sh-round2&quot;)
+        end
     end
-end
 
--------------------
--- Shogun stones --
--------------------
-do
-    def_images{&quot;sh-shogun1&quot;,&quot;sh-shogun2&quot;, &quot;sh-shogun4&quot;}
-    def_subimages(&quot;st-shogun&quot;, {modelname=&quot;st-shogun-fg&quot;,h=7})
+    mirror3_opaque = FrameNames(&quot;st-mirrortempl&quot;, 1, 4)
+    mirror3_transp = FrameNames(&quot;st-mirrortempl&quot;, 5, 8)
+    mirrorp_opaque = FrameNames(&quot;st-mirrortempl&quot;, 9, 12)
+    mirrorp_transp = FrameNames(&quot;st-mirrortempl&quot;, 13, 16)
 
-    def_shmodel(&quot;st-shogun1&quot;, &quot;st-shogun-fg1&quot;, &quot;sh-shogun1&quot;)
-    def_shmodel(&quot;st-shogun2&quot;, &quot;st-shogun-fg2&quot;, &quot;sh-shogun2&quot;)
-    def_shmodel(&quot;st-shogun3&quot;, &quot;st-shogun-fg3&quot;, &quot;sh-shogun1&quot;)
-    def_shmodel(&quot;st-shogun4&quot;, &quot;st-shogun-fg4&quot;, &quot;sh-shogun4&quot;)
-    def_shmodel(&quot;st-shogun5&quot;, &quot;st-shogun-fg5&quot;, &quot;sh-shogun1&quot;)
-    def_shmodel(&quot;st-shogun6&quot;, &quot;st-shogun-fg6&quot;, &quot;sh-shogun2&quot;)
-    def_shmodel(&quot;st-shogun7&quot;, &quot;st-shogun-fg7&quot;, &quot;sh-shogun1&quot;)
-end
+    make_mirror(&quot;st-3mirror-mo&quot;, &quot;st-mirror-movable&quot;, mirror3_opaque)
+    make_mirror(&quot;st-3mirror-so&quot;, &quot;st-mirror-static&quot;,  mirror3_opaque)
+    make_mirror(&quot;st-3mirror-mt&quot;, &quot;st-mirror-movable&quot;, mirror3_transp)
+    make_mirror(&quot;st-3mirror-st&quot;, &quot;st-mirror-static&quot;,  mirror3_transp)
 
---Progress(90)
-
--------------------
--- Bolder stones --
--------------------
-
-do
-    local img=def_subimages(&quot;st-bolder&quot;, {w=4,h=3})
-    local imgfall=def_subimages(&quot;st-bolder-fall&quot;, {w=4,h=3})
-
-    function def_bolder(orient, start)
-       local animname=&quot;st-bolder&quot;..orient..&quot;a&quot;
-       local frames={img[start], img[start+1], img[start+2]}
-       def_anim(animname, buildframes(frames, 120), false)
-       def_shmodel(&quot;st-bolder-&quot;..orient, animname, &quot;sh-round&quot;)
-
-       animname=&quot;st-bolder-&quot;..orient..&quot;-fall-anim&quot;
-       frames={imgfall[start],imgfall[start+1],imgfall[start+2]}
-       def_anim(animname, buildframes(frames, 120), false)
-    end
-
-    def_bolder(&quot;n&quot;,1)
-    def_bolder(&quot;e&quot;,4)
-    def_bolder(&quot;s&quot;,7)
-    def_bolder(&quot;w&quot;,10)
+    make_mirror(&quot;st-pmirror-mo&quot;, &quot;st-mirror-movable&quot;, mirrorp_opaque)
+    make_mirror(&quot;st-pmirror-so&quot;, &quot;st-mirror-static&quot;,  mirrorp_opaque)
+    make_mirror(&quot;st-pmirror-mt&quot;, &quot;st-mirror-movable&quot;, mirrorp_transp)
+    make_mirror(&quot;st-pmirror-st&quot;, &quot;st-mirror-static&quot;,  mirrorp_transp)
 end
 
--- Invisible stone --
-def_alias(&quot;st-invisible&quot;, &quot;invisible&quot;)
-def_alias(&quot;st-invisible_magic&quot;, &quot;invisible&quot;)
-def_alias(&quot;st-stonebrush&quot;, &quot;invisible&quot;)
-def_alias(&quot;st-break_invisible&quot;, &quot;invisible&quot;)
-def_alias(&quot;st-actorimpulse_invisible&quot;, &quot;invisible&quot;)
-def_alias(&quot;st-death_invisible&quot;, &quot;invisible&quot;)
-
-----------------------
--- Magic stones :-) --
-----------------------
+--------------------------
+-- Simple stone aliases --
+--------------------------
 do
-    local img = def_subimages(&quot;st-magic&quot;, {h=4, modelname=&quot;st-magic-fg&quot;})
-    local nlist = {}
-    for i=1,getn(img) do
-        nlist[i] = &quot;st-magic&quot;..i
-        def_roundstone(nlist[i], img[i])
-    end
-    display.DefineRandModel(&quot;st-magic&quot;, getn(nlist), nlist)
+    DefAlias(&quot;st-breaking&quot;, &quot;st-rock3_break-anim&quot;)
+    DefAlias(&quot;st-camouflage_move&quot;, &quot;st-camouflage&quot;)
+    DefAlias(&quot;st-camouflage_hole&quot;, &quot;st-camouflage&quot;)
+    DefAlias(&quot;st-explosion&quot;, &quot;expl&quot;)
+    DefAlias(&quot;st-firebreak_move&quot;, &quot;st-firebreak&quot;)
+    DefAlias(&quot;st-glass_move&quot;, &quot;st-glass&quot;);
+    DefAlias(&quot;st-glass1_hole&quot;, &quot;st-glass1&quot;)
+    DefAlias(&quot;st-glass1_move&quot;, &quot;st-glass1&quot;)
+    DefAlias(&quot;st-glass2_hole&quot;, &quot;st-glass2&quot;)
+    DefAlias(&quot;st-greenbrown_hole&quot;, &quot;st-greenbrown&quot;)
+    DefAlias(&quot;st-greenbrown_move&quot;, &quot;st-greenbrown&quot;)
+    DefAlias(&quot;st-laserbreak&quot;, &quot;st-rock3&quot;)
+    DefAlias(&quot;st-laserbreak-anim&quot;, &quot;st-rock3_break-anim&quot;)
+    DefAlias(&quot;st-marble_hole&quot;, &quot;st-marble&quot;)
+    DefAlias(&quot;st-marble_move&quot;, &quot;st-marble&quot;)
+    DefAlias(&quot;st-metal_hole&quot;, &quot;st-metal&quot;)
+    DefAlias(&quot;st-plain&quot;, &quot;st-rock3&quot;)
+    DefAlias(&quot;st-plain_break&quot;, &quot;st-rock3&quot;)
+    DefAlias(&quot;st-plain_breaking&quot;, &quot;st-rock3_break-anim&quot;)
+    DefAlias(&quot;st-plain_cracked&quot;, &quot;st-rock3_cracked&quot;)
+    DefAlias(&quot;st-plain_falling&quot;, &quot;st-rock3-falling&quot;)
+    DefAlias(&quot;st-plain_hole&quot;, &quot;st-rock3&quot;)
+    DefAlias(&quot;st-plain_move&quot;, &quot;st-rock3&quot;)
+    DefAlias(&quot;st-rock1_hole&quot;, &quot;st-rock1&quot;)
+    DefAlias(&quot;st-rock1_move&quot;, &quot;st-rock1&quot;)
+    DefAlias(&quot;st-rock2_hole&quot;, &quot;st-rock2&quot;)
+    DefAlias(&quot;st-rock3_hole&quot;, &quot;st-rock3&quot;)
+    DefAlias(&quot;st-rock3_move&quot;, &quot;st-rock3&quot;)
+    DefAlias(&quot;st-rock3_break&quot;, &quot;st-rock3&quot;)
+    DefAlias(&quot;st-yinyang3&quot;, &quot;st-yinyang1&quot;)
 end
 
--------------------
--- Spitter stone --
--------------------
+-- Invisible stones --
 do
-    def_alias (&quot;st-spitter&quot;, &quot;st-timeswitch&quot;)
-    def_alias (&quot;st-spitter-loading&quot;, &quot;st-fakeoxyd-blink&quot;)
-    def_alias (&quot;st-spitter-spitting&quot;, &quot;st-fakeoxyd-blink&quot;)
+    DefAlias(&quot;st-actorimpulse_invisible&quot;, &quot;invisible&quot;)
+    DefAlias(&quot;st-break_invisible&quot;, &quot;invisible&quot;)
+    DefAlias(&quot;st-death_invisible&quot;, &quot;invisible&quot;)
+    DefAlias(&quot;st-invisible&quot;, &quot;invisible&quot;)
+    DefAlias(&quot;st-invisible_magic&quot;, &quot;invisible&quot;)
+    DefAlias(&quot;st-stonebrush&quot;, &quot;invisible&quot;)
 end
 
----------------------------
--- Light Passenger Stone --
----------------------------
-do
-    local img = def_subimages(&quot;st-lightpassenger&quot;, {h=7})
-    def_shmodel(&quot;st-lightpassenger&quot;, img[1], &quot;sh-glass&quot;)
-    def_alias(&quot;st-lightpassenger_off&quot;, &quot;st-glass2&quot;)
-    local frames={img[2], img[3], img[4], img[5], img[6], img[7]}
-    def_anim(&quot;st-lightpassenger-blink1&quot;, pingpong(buildframes(frames, 75)), true)
-    def_shmodel(&quot;st-lightpassenger-blink&quot;, &quot;st-lightpassenger-blink1&quot;, &quot;sh-glass&quot;)
-    img = def_subimages(&quot;st-lightpassenger-break-v&quot;, {h=7})
-    def_anim(&quot;st-lightpassenger-break-v&quot;, buildframes(img, 50), false)
-    img = def_subimages(&quot;st-lightpassenger-break-h&quot;, {h=7})
-    def_anim(&quot;st-lightpassenger-break-h&quot;, buildframes(img, 50), false)
-    img = def_subimages(&quot;st-lightpassenger-break-hv&quot;, {h=7})
-    def_anim(&quot;st-lightpassenger-break-hv&quot;, buildframes(img, 50), false)
-end
+--------------------------------------------------------------------------------
+--                               Sprite Effects                               --
+--------------------------------------------------------------------------------
+Progress(95, &quot;Loading Sprite Effects&quot;)
 
--------------
--- Effects --
--------------
-
-Sprite{
-    name     = &quot;ring-anim&quot;, 
+Sprite({
+    name     = &quot;ring-anim&quot;,
     nimages  = 8,
     framelen = 50,
-    padding = 0.3
-}
+    padding  = 0.3
+})
 
-Sprite{
-    name    = &quot;ac-drowned&quot;,
-    nimages = 5,
+Sprite({
+    name     = &quot;ac-drowned&quot;,
+    nimages  = 5,
     framelen = 80,
-    padding = 0.3
-}
+    padding  = 0.3
+})
 
 -- Halo --
-Sprite{
+Sprite({
     name     = &quot;halo&quot;,
     nimages  = 2,
     framelen = 30,
     loop     = true
-}
-Sprite{
+})
+
+Sprite({
     name     = &quot;halo-blink&quot;,
     nimages  = 2,
     framelen = 30,
     loop     = true
-}
+})
 
 -- Halo for small balls --
-Sprite{
+Sprite({
     name     = &quot;halo-small&quot;,
     nimages  = 2,
     framelen = 30,
     loop     = true
-}
-Sprite{
+})
+
+Sprite({
     name     = &quot;halo-small-blink&quot;,
     nimages  = 2,
     framelen = 30,
     loop     = true
-}
+})
 
-Progress(100, &quot;Loading Oxyd levels&quot;)
+Progress(100, &quot;Loading levels&quot;)

Modified: trunk/data/models.lua
===================================================================
--- trunk/data/models.lua	2007-04-14 15:11:51 UTC (rev 690)
+++ trunk/data/models.lua	2007-04-15 21:45:05 UTC (rev 691)
@@ -20,20 +20,17 @@
 -- This file contains common routines for defining new Enigma models.
 -- It is used by all other model*.lua files.
 
----------------
--- FUNCTIONS --
----------------
+-- Display the loading progress
 function Progress(percent, text)
-    local fontname = &quot;levelmenu&quot;
-    local scr      = video.GetScreen();
-    local d = scr:get_surface()
-
+    local fontname   = &quot;levelmenu&quot;
+    local scr        = video.GetScreen()
+    local d          = scr:get_surface()
     local background = enigma.GetImage (&quot;menu_bg&quot;, &quot;.jpg&quot;)
-    local logo = enigma.GetImage(&quot;enigma_logo3&quot;)
-    local x = (d:width()  - logo:width())/2
-    local y = (d:height() - logo:height())/2
-    local gs = ecl.GS:new(d:size())
-    local font2 = enigma.GetFont(&quot;menufontsel&quot;)
+    local logo       = enigma.GetImage(&quot;enigma_logo3&quot;)
+    local x          = (d:width()  - logo:width())/2
+    local y          = (d:height() - logo:height())/2
+    local gs         = ecl.GS:new(d:size())
+    local font2      = enigma.GetFont(&quot;menufontsel&quot;)
 
     d:blit(gs, 0, 0, background)
     d:blit(gs, x , y-logo:height(), logo)
@@ -48,23 +45,27 @@
     gs:delete()
 end
 
+-- Return an unique modelname.
 modeltag = 0
-function unique_modelname()
+function UniqueModelname()
     modeltag = modeltag + 1
     return &quot;xmodel&quot; .. modeltag
 end
 
--- Define a new image model.  'name' is the name of the model being created
--- and 'opt' contains optional information about the image file.  The following
--- fields can be set in 'opt':
---
---     * filename
---     * xoff,yoff (hotspot coordinates inside the image)
---
+--------------------------------------
+--   Basic Single Image Functions   --
+--------------------------------------
+
+-- Define a new image model.
+-- * 'name' is the name of the model being created
+-- * 'opt' contains optional information about the image file.
+--   The following fields can be set in 'opt':
+--    * filename
+--    * xoff,yoff (hotspot coordinates inside the image)
 -- Suitable default values are used for all options
-function def_image(name, opt)
+function DefImage(name, opt)
     opt = opt or {}
-    name = name or unique_modelname()
+    name = name or UniqueModelname()
     local fname = opt.filename or name
     local err = display.DefineImage(name, fname, opt.xoff or 0, opt.yoff or 0, opt.padding or 0)
     if err ~= 0 then
@@ -74,17 +75,22 @@
 end
 
 -- Define multiple image models at once.  Use the same options for all
--- of them.
-function def_images(names, opt)
+-- of them. The namelist contains the modelnames to be created.
+function DefImages(namelist, opt)
     opt = opt or {}
-    for i,name in pairs(names) do
-	def_image(name,opt)
+    for i,name in pairs(namelist) do
+	    DefImage(name,opt)
     end
 end
 
+-------------------------------------
+--   Basic Subdivision Functions   --
+-------------------------------------
+
 -- Define many image models from one single big image file.
-
-function def_subimages(name, options)
+-- Inputarguments are the imagefilename and the options.
+-- The defined models are named 'modelname1', 'modelname2' ...
+function DefSubimages(name, options)
     local opts = options or { }
     local w = opts.w or 1
     local h = opts.h or 1
@@ -117,26 +123,11 @@
     return imagelist
 end
 
-function map_tiles (imginfo, func)
-    local w = imginfo.w or 1
-    local h = imginfo.h or 1
-    local tilew = imginfo.tilew or TileSize
-    local tileh = imginfo.tileh or TileSize
-    local r=ecl.Rect:new(0,0,0,0)
-    local n=1
-    for y=0,h-1 do
-        for x=0,w-1 do
-            r.x,r.y = x*tilew,y*tileh
-            r.w,r.h = tilew, tileh
-            func(n, r)
-            n=n+1
-        end
-    end
-    r:delete()
-end
-
-
-function DefineTile (imagename, modelname, x, y)
+-- Generates an image model by cutting it out of a larger image.
+-- Arguments are the imagefilename, the modelname and the position
+-- where to cut a square with length TileSize. The position is
+-- measured in multiples of TileSize.
+function DefTile(imagename, modelname, x, y)
     local image = GetSurface (imagename)
     local r=ecl.Rect:new(x * TileSize, y*TileSize, TileSize, TileSize)
     local subsurface = CropSurface (image, r)
@@ -144,11 +135,11 @@
     r:delete()
 end
 
-
 -- Generate multiple image models by tiling a big image into many
--- smaller subimages.  The parameters are currently hardcoded, see
--- &quot;items.png&quot; for an example image.
-function DefineTiles(imagename, modelnames)
+-- smaller subimages.  The parameters are currently hardcoded.
+-- Arguments are the filename of the image and a list of
+-- modelnames to be generated out of this image.
+function DefTiles(imagename, modelnames)
     local xoff = 0
     local yoff = 0
     local tilew = TileSize
@@ -159,9 +150,7 @@
     local r=ecl.Rect:new(0,0,TileSize,TileSize)
     for i,mname in pairs(modelnames) do
         r.x,r.y,r.w,r.h = xoff,yoff,tilew,tileh
---        local subsurface = CropSurface (image, r)
---        DefineImageModel (mname, subsurface)
-        DefineTile (imagename, mname, xoff/TileSize, yoff/TileSize)
+        DefTile(imagename, mname, xoff/TileSize, yoff/TileSize)
         xoff = xoff + tilew
         if xoff &gt;= imgw then
             xoff = 0
@@ -171,73 +160,26 @@
     r:delete()
 end
 
+-----------------------------------
+--   Basic Animation Functions   --
+-----------------------------------
 
-function def_stone(name, shmodel, opt)
-    opt = opt or {}
-    shmodel = shmodel or &quot;sh-solid&quot;
-    opt.filename = opt.filename or name
-    display.DefineShadedModel(name, def_image(nil, opt), shmodel)
-end
-
-function def_stone2(model, shmodel)
-    shmodel = shmodel or &quot;sh-solid&quot;
-    display.DefineShadedModel (model, model..&quot;#&quot;, shmodel)
-end
-
-function def_stones(names)
-    for i,name in names do def_stone(name) end
-end
-function def_roundstones(names)
-    for i,name in names do def_stone(name, &quot;sh-round&quot;) end
-end
-
--- Define a shaded model named `name' with texture model `fg' and
--- shadow model `bg'.  Both are real models (not names of image files), so
--- you can combine animated images with shadows etc.
-function def_shmodel(name, fg, bg)
-    display.DefineShadedModel(name, fg, bg)
-end
-
-function def_overlay(name, imglist)
-    display.DefineOverlayImage(name, getn(imglist), imglist)
-end
-
-function def_solidstone(name, front)
-    def_shmodel(name, front, &quot;sh-solid&quot;)
-end
-function def_roundstone(name, front)
-    def_shmodel(name, front, &quot;sh-round&quot;)
-end
-
-function def_floatingstone(name, front)
-    def_shmodel(name, front, &quot;sh-floating&quot;)
-end
-
-function def_alias(name, othername)
-    display.DefineAlias(name,othername)
-end
-
-----------------
--- ANIMATIONS --
-----------------
-
 -- Generate a list of frame names by appending increasing numerical
--- prefixes to a base name.  For example, 'framenames(&quot;hello&quot;, 1,2)'
+-- prefixes to a base name.  For example, 'FrameNames(&quot;hello&quot;, 1,2)'
 -- yields {&quot;hello_0001&quot;, &quot;hello_0002&quot;}.
 -- [Filenames like this are created by Gimp's &quot;Video/Split Image..&quot;
 -- tool.]
-
-function framenames(prefix, first, last)
+function FrameNames(prefix, first, last)
     local fn = {}
     for i=first,last do
-	table.insert(fn, prefix .. format(&quot;_%04d&quot;, i))
+	    table.insert(fn, prefix .. format(&quot;_%04d&quot;, i))
     end
     return fn
 end
 
 -- Build a list of frames from a list of model names and a constant
 -- duration.
-function buildframes(names, msec)
+function BuildFrames(names, msec)
     local a={}
     for i,n in pairs(names) do a[i] = {n, msec} end
     return a
@@ -246,86 +188,210 @@
 -- Build a list of frames from (1) a list of names and (2) a list of
 -- frame durations.  These two list are assumed to have the same
 -- number of entries, or, more generally, to have the same index set.
-function composeframes(namelist, mseclist)
+function ComposeFrames(namelist, mseclist)
     local a={}
     for i=1,getn(namelist) do a[i] = {namelist[i], mseclist[i]} end
     return a
 end
 
-
 -- Given a list of frames, this function generates a new framelist
 -- with for a ping-pong style animation.  (For example, an &quot;abcd&quot;
 -- style animation would result in an &quot;abcddcba&quot;-style one.)
-
-function pingpong(framelist)
+function PingPong(framelist)
     local a=framelist
     local n=getn(framelist)
     for i = 0,n-1 do
-	a[n+i+1] = framelist[n-i]
+	    a[n+i+1] = framelist[n-i]
     end
     return a
 end
 
-function repeat_frames(framelist, blocksize, cnt)
+-- Given a list of frames, this function generates a new framelist
+-- with repeated framesequence.  (For example, an &quot;abcd&quot;
+-- style animation with a cnt of 3 would result in an &quot;abcdabcdabcd&quot;-style one.)
+function RepeatFrames(framelist, blocksize, cnt)
     local a={}
     for i=1,getn(framelist),blocksize do
-	for j=1,cnt do
-	    for k=i,i+blocksize-1 do
-		table.insert(a,framelist[k])
+	    for j=1,cnt do
+	        for k=i,i+blocksize-1 do
+		        table.insert(a,framelist[k])
+	        end
 	    end
-	end
     end
     return a
 end
 
-function repeatanim(framelist, cnt)
-    return repeat_frames(framelist, getn(framelist), cnt or 2)
+-- Given a list of frames, this function generates a new framelist
+-- with repeated framesequence.  (For example, an &quot;abcd&quot;
+-- style animation with a cnt of 3 would result in an &quot;abcdabcdabcd&quot;-style one.)
+function RepeatAnim(framelist, cnt)
+    return RepeatFrames(framelist, getn(framelist), cnt or 2)
 end
 
-function reverseframes(framelist)
+-- Given a list of frames, this function generates a new framelist
+-- with reversed frame order.  (For example, an &quot;abcd&quot;
+-- style animation would result in an &quot;dcba&quot;-style one.)
+function ReverseFrames(framelist)
     local a={}
     for i=getn(framelist),1,-1 do
-	table.insert(a, framelist[i])
+	    table.insert(a, framelist[i])
     end
     return a
 end
 
 -- Define an animation from a list of images.  `frames' is a
--- framelist, as built with `framenames()', but the model names in
+-- framelist, as built with `FrameNames()', but the model names in
 -- this list are interpreted as image filenames.
-
-function def_anim_images(name, frames, opt)
+function DefAnimImages(name, frames, opt)
     opt = opt or {}
     local loopbool = opt.loop and true or false
     display.DefineAnim(name, loopbool)
     for i=1,getn(frames) do
-	local frame=frames[i]
-	opt.filename = frame[1]
-	local immodel = def_image(nil, opt)
-	display.AddFrame(name, immodel, frame[2])
+	    local frame=frames[i]
+	    opt.filename = frame[1]
+	    local immodel = DefImage(nil, opt)
+	    display.AddFrame(name, immodel, frame[2])
     end
 end
 
-
 -- Define an animation from a list of models.
-
-function def_anim(name, frames, loop)
+-- * 'name' is the name of the animation being created
+-- * 'frames' is the list of modelnames used
+function DefAnim(name, frames, loop)
     local loopbool = loop and true or false
     display.DefineAnim(name,loopbool)
     for i=1,getn(frames) do
-	local frame = frames[i]
-	display.AddFrame(name, frame[1], frame[2])
+	    local frame = frames[i]
+	    display.AddFrame(name, frame[1], frame[2])
     end
 end
 
-function NewAnim(name,opts) -- name, img, h,w,speed,pingpong, loop)
+-- Define a new Animation.
+-- * 'name' is the name of the animation being created
+-- * 'opt' contains optional information about the animation.
+function NewAnim(name,opts)
     local imagefile = opts.img or name
-    local h=opts.h or 1
-    local w=opts.w or 1
+    local h = opts.h or 1
+    local w = opts.w or 1
     local speed = opts.speed or 100
-    local loop=opts.loop or 0
+    local loop = opts.loop or 0
 
-    local frames = def_subimages(imagefile, {[&quot;h&quot;]=h, [&quot;w&quot;]=w})
-    if opts.pingpong then frames=pingpong(frames) end
-    def_anim(name, buildframes(frames, speed), loop)
+    local frames = DefSubimages(imagefile, {[&quot;h&quot;]=h, [&quot;w&quot;]=w})
+    if opts.pingpong then frames=PingPong(frames) end
+    DefAnim(name, BuildFrames(frames, speed), loop)
 end
+
+--------------------------
+--   Sprite functions   --
+--------------------------
+
+-- padding is calculated as:
+-- padding = (1.25 - 2*Actorradius)/2
+function SpriteImages(spriteimg, n, offsetfactor, padding)
+    local factor = offsetfactor or 0.5
+    local offset = -SpriteSize * factor
+    local pad = (padding or 0) * TileSize
+    return DefSubimages(spriteimg,
+                         {h = n, imgw=SpriteSize, imgh=SpriteSize,
+                             xoff = offset, yoff = offset, padding=pad})
+end
+
+function SpriteImage(spriteimg, offsetfactor, padding)
+    local factor = offsetfactor or 0.5
+    local offset = -SpriteSize * factor
+    local padding = (padding or 0) * TileSize
+    return DefImage(spriteimg, {xoff = offset, yoff = offset, padding=padding})
+end
+
+function SpriteWithShadow()
+
+end
+
+function SpriteAnim(name, images, shadows, framelen, loop)
+    local frames={}
+    local nframes = getn(images)
+    for i=1,getn(images) do
+        DefShModel(name..i, images[i], shadows[mod (i, getn(shadows))] )
+        table.insert(frames, name..i)
+    end
+    DefAnim (name, BuildFrames(frames, framelen), loop)
+end
+
+function Sprite(descr)
+    local imgfile = descr.imgfile or descr.name
+    local loop    = descr.loop or false
+    local img     = SpriteImages(imgfile, descr.nimages, 0.5, descr.padding)
+    DefAnim(descr.name, BuildFrames(img, descr.framelen), loop)
+end
+
+---------------------------------
+--   Floor related Functions   --
+---------------------------------
+
+-- Defines a random floor tile out of a given list.
+function DefRandFloor(name, imagelist)
+    display.DefineRandModel(name, getn(imagelist), imagelist)
+end
+
+-- Defines a random floor tile out of a given image with multiple tiles.
+-- This is used for the most kinds of floors.
+function DefRandFloorSi(name, height, width)
+    imagelist = DefSubimages(name, {h=height, w=width})
+    display.DefineRandModel(name, getn(imagelist), imagelist)
+end
+
+---------------------------------
+--   Stone related Functions   --
+---------------------------------
+
+-- Define a stone together with its shadow model:
+function DefStone(name, shmodel, opt)
+    opt = opt or {}
+    shmodel = shmodel or &quot;sh-solid&quot;
+    opt.filename = opt.filename or name
+    display.DefineShadedModel(name, DefImage(nil, opt), shmodel)
+end
+
+-- Define a shaded model named `name' with texture model `fg' and
+-- shadow model `bg'.  Both are real models (not names of image files), so
+-- you can combine animated images with shadows etc.
+function DefShModel(name, fg, bg)
+    display.DefineShadedModel(name, fg, bg)
+end
+
+function DefSolidStone(name, front)
+    DefShModel(name, front, &quot;sh-solid&quot;)
+end
+
+function DefRoundStone(name, front)
+    DefShModel(name, front, &quot;sh-round&quot;)
+end
+
+function DefFloatingStone(name, front)
+    DefShModel(name, front, &quot;sh-floating&quot;)
+end
+
+-- Animated Stones --
+function DefSolidStoneWithAnim(name, npictures, frametime)
+    local n=DefSubimages(name, {h=npictures})
+    DefAnim(name..&quot;-animfg&quot;, BuildFrames(n,frametime))
+    DefSolidStone(name..&quot;-anim&quot;, name..&quot;-animfg&quot;)
+    DefSolidStone(name, n[1])
+end
+
+function DefRoundStoneWithAnim(name, npictures, frametime)
+    local n=DefSubimages(name, {h=npictures})
+    DefAnim(name..&quot;-animfg&quot;, BuildFrames(n,frametime))
+    DefRoundStone(name..&quot;-anim&quot;, name..&quot;-animfg&quot;)
+    DefRoundStone(name, n[1])
+end
+
+-- Aliases --
+function DefAlias(name, othername)
+    display.DefineAlias(name,othername)
+end
+
+-- Define an overlay --
+function DefOverlay(name, imglist)
+    display.DefineOverlayImage(name, getn(imglist), imglist)
+end


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000128.html">[Enigma-game-svn] r690 - in branches/1.0/src: . gui lev
</A></li>
	<LI>Next message: <A HREF="000130.html">[Enigma-game-svn] r692 - in branches/1.0/src: gui lev
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#129">[ date ]</a>
              <a href="thread.html#129">[ thread ]</a>
              <a href="subject.html#129">[ subject ]</a>
              <a href="author.html#129">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
