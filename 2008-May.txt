From ral at mail.berlios.de  Thu May  1 13:30:50 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 1 May 2008 13:30:50 +0200
Subject: [Enigma-game-svn] r1118 - in trunk: data data/schemas doc/reference
	src/stones
Message-ID: <200805011130.m41BUokC017519@sheep.berlios.de>

Author: ral
Date: 2008-05-01 13:30:49 +0200 (Thu, 01 May 2008)
New Revision: 1118

Modified:
   trunk/data/api2init.lua
   trunk/data/schemas/objects.xml
   trunk/doc/reference/enigma-ref.texi
   trunk/src/stones/BoulderStone.cc
   trunk/src/stones/RotatorStone.cc
   trunk/src/stones/RotatorStone.hh
Log:
Trunk 1.1: reengineering new API rotator stone
- fix rotator boulder interaction
- refman docu rotator 
- cleanup


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-04-29 21:58:07 UTC (rev 1117)
+++ trunk/data/api2init.lua	2008-05-01 11:30:49 UTC (rev 1118)
@@ -73,6 +73,10 @@
 WHITE = 1
 NOCOLOR = nil
 
+-- rotation direction
+CW  = 0
+CCW = 1
+
 -- oxyd color
 OXYD_BLUE   =  0
 OXYD_RED    =  1

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-04-29 21:58:07 UTC (rev 1117)
+++ trunk/data/schemas/objects.xml	2008-05-01 11:30:49 UTC (rev 1118)
@@ -442,7 +442,6 @@
     <object name="st_rotator">
       <attr name="counterclock"/>
       <attr name="movable"/>
-      <msg name="_model_reanimated"/>
     </object>
     <object name="st_rotator_cw">
       <attr name="state" value="0"/>

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-04-29 21:58:07 UTC (rev 1117)
+++ trunk/doc/reference/enigma-ref.texi	2008-05-01 11:30:49 UTC (rev 1118)
@@ -3397,6 +3397,7 @@
 * nopaction::
 * inverse::
 * destination::
+* movable::
 @end menu
 
 @node name
@@ -3485,6 +3486,27 @@
 @item @b{Support:} @ @ by teleporting objects
 @end table
 
+ at node movable
+ at subsection movable
+
+An attribute that describes if a stone is movable by actor impulses. It is 
+supported by all stones.
+
+Note that this attribute is not listed in the individual stone description
+if the stone is generally not movable.
+
+ at table @asis
+ at item @b{Type:} @ @ bool
+ at item @b{Values:} @ @ @code{true}, @code{false}
+ at item @b{Default:} @ @ usually @code{false}
+If a stone exists only in a movable variant this attribute will default to
+ at samp{true}.
+ at item @b{Access:} @ @ read/sometimes write
+This attribute is only writable for objects that exist in both variations.
+ at item @b{Support:} @ @ by all stones
+ at end table
+
+
 @node Common Messages
 @section Common Messages
 
@@ -4506,6 +4528,7 @@
 * st_monoflop::        Monoflop Switch
 * st_oxyd::            Game Target Stone
 * st_polarswitch::     Transparency Switch for Light Beams
+* st_rotator::         Rotating Stone Impulser
 * st_switch::          Classical on/off Switch
 * st_timer::           Animated Timer
 @end menu
@@ -5171,6 +5194,53 @@
 
 @end table
 
+ at c ----------------- Rotator Stone -------------------- 
+ at node st_rotator
+ at subsection st_rotator
+ at obindex st_rotator
+
+Rotators send impulses to neighboring stones, thus pushing them in the direction
+given by the rotation. @ref{st_boulder} additionally change their direction to
+the one they are pushed to.
+
+Rotators can either rotate in clockwise or counterclockwise direction. They can
+be movable or unmovable.
+
+The rotator changes its rotation direction when hit by an actor with a revealed
+ at ref{it_wrench} and by laser beams. Every additional laser beam causes a change
+in the rotation direction.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{state}, @ @ @i{values}: @code{CW}, @code{CCW}; @ @ @i{default}: @code{CW} @ @ @xref{state}
+The rotation direction - @samp{CW} for clockwise as default, or @samp{CCW} for
+counter clockwise. 
+ at item @b{counterclockwise} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+The standard rotation direction is clockwise. Use this attribute to revert the
+direction.
+ at item @b{movable} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false} @ @ @xref{movable}
+ at end table
+
+ at item @b{Messages:}
+
+ at table @asis
+ at item @b{toggle} @ @ @xref{toggle}
+Switches the rotation direction.
+ at end table
+
+ at item @b{Variants:}
+
+ at table @asis
+ at item @b{st_rotator}: state = @code{CW}
+ at item @b{st_rotator_cw}: state = @code{CW}
+ at item @b{st_rotator_ccw}: state = @code{CCW}
+ at end table
+
+
+ at end table
+
 @c ----------------- Switch Stone -------------------- 
 @node st_switch
 @subsection st_switch

Modified: trunk/src/stones/BoulderStone.cc
===================================================================
--- trunk/src/stones/BoulderStone.cc	2008-04-29 21:58:07 UTC (rev 1117)
+++ trunk/src/stones/BoulderStone.cc	2008-05-01 11:30:49 UTC (rev 1118)
@@ -138,7 +138,7 @@
         if (state == FALLING)
             return;
 
-        if (impulse.sender && impulse.sender->is_kind("st-rotator")) {
+        if (impulse.sender && impulse.sender->is_kind("st_rotator")) {
             setDir(impulse.dir);  // activate
         }
         move_stone(impulse.dir);  // due to rotator and impulsestone

Modified: trunk/src/stones/RotatorStone.cc
===================================================================
--- trunk/src/stones/RotatorStone.cc	2008-04-29 21:58:07 UTC (rev 1117)
+++ trunk/src/stones/RotatorStone.cc	2008-05-01 11:30:49 UTC (rev 1118)
@@ -30,6 +30,10 @@
         state = counterclockwise ? CCW : CW;
     }
 
+    RotatorStone::~RotatorStone() {
+        GameTimer.remove_alarm(this);
+    }
+    
     std::string RotatorStone::getClass() const {
         return "st_rotator";
     }
@@ -134,7 +138,7 @@
         GridPos p = get_pos();
         
         for (int i = WEST; i <= NORTH; i++) {
-            if (Value id = getAttr(ecl::strf("$neighbour%d",i))) {
+            if (Value id = getAttr(ecl::strf("$neighbor%d",i))) {
                 Stone *st = GetStone(move(get_pos(), (Direction)i));
                 if (st != NULL  && id == st->getId()) {
                     send_impulse(move(p, (Direction)i), state == CW ? rotate_cw((Direction)i) : rotate_ccw((Direction)i));
@@ -150,7 +154,7 @@
     void RotatorStone::send_impulses() {
         for (int i = WEST; i <= NORTH; i++) {
             Stone *st = GetStone(move(get_pos(), (Direction)i));
-            Stone::setAttr(ecl::strf("$neighbour%d",i), (st == NULL) ? Value() : Value(st->getId()));
+            Stone::setAttr(ecl::strf("$neighbor%d",i), (st == NULL) ? Value() : Value(st->getId()));
         }
         GameTimer.set_alarm(this, 0.1);
         

Modified: trunk/src/stones/RotatorStone.hh
===================================================================
--- trunk/src/stones/RotatorStone.hh	2008-04-29 21:58:07 UTC (rev 1117)
+++ trunk/src/stones/RotatorStone.hh	2008-05-01 11:30:49 UTC (rev 1118)
@@ -43,6 +43,7 @@
         };
     public:
         RotatorStone(bool isMovable, bool counterclockwise);
+        ~RotatorStone();
         
         // Object interface
         virtual std::string getClass() const;
@@ -78,7 +79,4 @@
 } // namespace enigma
 
 #endif
-#ifndef ROTATORSTONE_HH_
-#define ROTATORSTONE_HH_
 
-#endif /*ROTATORSTONE_HH_*/



From ral at mail.berlios.de  Thu May  1 20:13:36 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 1 May 2008 20:13:36 +0200
Subject: [Enigma-game-svn] r1119 - homepage/input
Message-ID: <200805011813.m41IDakT019554@sheep.berlios.de>

Author: ral
Date: 2008-05-01 20:13:35 +0200 (Thu, 01 May 2008)
New Revision: 1119

Modified:
   homepage/input/stat-other.html
   homepage/input/table-hcp.html
   homepage/input/table-rat.html
   homepage/input/table-solved.html
   homepage/input/table-wr.html
   homepage/input/userlist.html
Log:
Homepage:
- statistics April 2008


Modified: homepage/input/stat-other.html
===================================================================
--- homepage/input/stat-other.html	2008-05-01 11:30:49 UTC (rev 1118)
+++ homepage/input/stat-other.html	2008-05-01 18:13:35 UTC (rev 1119)
@@ -1,22 +1,22 @@
   <div class="stat-help">
     <h3>$$Other_Statistics$$</h3>
     <h4>$$Scores$$</h4>
-      75496 $$single_level_scores$$.
+      77232 $$single_level_scores$$.
     <h4>$$Ratings$$</h4>
-      14014 $$single_level_ratings$$ 4.90 $$and_distribution$$: 
+      14376 $$single_level_ratings$$ 4.91 $$and_distribution$$: 
       <table>
         <colgroup><col width="80"><col width="80"></colgroup>
         <tr><th>$$rating$$</th><th>$$count$$</th></tr>
-        <tr><td class="num">0</td><td class="num">58</td></tr>
-        <tr><td class="num">1</td><td class="num">269</td></tr>
-        <tr><td class="num">2</td><td class="num">731</td></tr>
-        <tr><td class="num">3</td><td class="num">2015</td></tr>
-        <tr><td class="num">4</td><td class="num">2679</td></tr>
-        <tr><td class="num">5</td><td class="num">3347</td></tr>
-        <tr><td class="num">6</td><td class="num">2344</td></tr>
-        <tr><td class="num">7</td><td class="num">1616</td></tr>
-        <tr><td class="num">8</td><td class="num">607</td></tr>
-        <tr><td class="num">9</td><td class="num">238</td></tr>
-        <tr><td class="num">10</td><td class="num">110</td></tr>
+        <tr><td class="num">0</td><td class="num">78</td></tr>
+        <tr><td class="num">1</td><td class="num">278</td></tr>
+        <tr><td class="num">2</td><td class="num">764</td></tr>
+        <tr><td class="num">3</td><td class="num">2050</td></tr>
+        <tr><td class="num">4</td><td class="num">2710</td></tr>
+        <tr><td class="num">5</td><td class="num">3424</td></tr>
+        <tr><td class="num">6</td><td class="num">2393</td></tr>
+        <tr><td class="num">7</td><td class="num">1650</td></tr>
+        <tr><td class="num">8</td><td class="num">650</td></tr>
+        <tr><td class="num">9</td><td class="num">260</td></tr>
+        <tr><td class="num">10</td><td class="num">119</td></tr>
       </table>
   </div>

Modified: homepage/input/table-hcp.html
===================================================================
--- homepage/input/table-hcp.html	2008-05-01 11:30:49 UTC (rev 1118)
+++ homepage/input/table-hcp.html	2008-05-01 18:13:35 UTC (rev 1119)
@@ -1,143 +1,151 @@
   <table>
-    <caption>$$Handicap_Statistics$$ $$March$$ 2008</caption>
+    <caption>$$Handicap_Statistics$$ $$April$$ 2008</caption>
     <colgroup><col width="130"><col width="220"></colgroup>
     <tr><th>$$solved_hcp$$</th><th class="left">$$user$$</th></tr>
-     <tr><td class="num">-143.6</td><td class="left">'Moneymaker'</td></tr>
-     <tr><td class="num"> -82.6</td><td class="left">'Johannes'</td></tr>
-     <tr><td class="num"> -82.4</td><td class="left">'Stupid'</td></tr>
-     <tr><td class="num"> -71.3</td><td class="left">'daydreamer'</td></tr>
-     <tr><td class="num"> -71.0</td><td class="left">'Great Scott'</td></tr>
-     <tr><td class="num"> -60.9</td><td class="left">'Duffy'</td></tr>
-     <tr><td class="num"> -59.5</td><td class="left">'Malla'</td></tr>
-     <tr><td class="num"> -52.8</td><td class="left">'ryujun'</td></tr>
-     <tr><td class="num"> -49.0</td><td class="left">'Django'</td></tr>
-     <tr><td class="num"> -43.6</td><td class="left">'Gloop'</td></tr>
-     <tr><td class="num"> -42.4</td><td class="left">'Alexandros'</td></tr>
-     <tr><td class="num"> -41.6</td><td class="left">'dev0'</td></tr>
-     <tr><td class="num"> -40.5</td><td class="left">'Taztunes'</td></tr>
-     <tr><td class="num"> -37.1</td><td class="left">'Safalra'</td></tr>
+     <tr><td class="num">-144.6</td><td class="left">'Moneymaker'</td></tr>
+     <tr><td class="num"> -82.4</td><td class="left">'Johannes'</td></tr>
+     <tr><td class="num"> -82.3</td><td class="left">'Stupid'</td></tr>
+     <tr><td class="num"> -73.9</td><td class="left">'daydreamer'</td></tr>
+     <tr><td class="num"> -70.9</td><td class="left">'Great Scott'</td></tr>
+     <tr><td class="num"> -60.7</td><td class="left">'Duffy'</td></tr>
+     <tr><td class="num"> -59.3</td><td class="left">'Malla'</td></tr>
+     <tr><td class="num"> -53.6</td><td class="left">'ryujun'</td></tr>
+     <tr><td class="num"> -48.8</td><td class="left">'Django'</td></tr>
+     <tr><td class="num"> -45.6</td><td class="left">'dev0'</td></tr>
+     <tr><td class="num"> -43.5</td><td class="left">'Gloop'</td></tr>
+     <tr><td class="num"> -42.6</td><td class="left">'Alexandros'</td></tr>
+     <tr><td class="num"> -40.3</td><td class="left">'Taztunes'</td></tr>
+     <tr><td class="num"> -36.9</td><td class="left">'Safalra'</td></tr>
      <tr><td class="num"> -31.7</td><td class="left">'B-Huff'</td></tr>
-     <tr><td class="num"> -30.8</td><td class="left">'Ludmian'</td></tr>
-     <tr><td class="num"> -27.0</td><td class="left">'Zekobah'</td></tr>
-     <tr><td class="num"> -27.0</td><td class="left">'bojster'</td></tr>
+     <tr><td class="num"> -31.3</td><td class="left">'Ludmian'</td></tr>
+     <tr><td class="num"> -27.1</td><td class="left">'Zekobah'</td></tr>
+     <tr><td class="num"> -26.9</td><td class="left">'bojster'</td></tr>
      <tr><td class="num"> -23.3</td><td class="left">'hendrik'</td></tr>
+     <tr><td class="num"> -23.1</td><td class="left">'Emmanuel'</td></tr>
+     <tr><td class="num"> -22.1</td><td class="left">'ged'</td></tr>
      <tr><td class="num"> -21.6</td><td class="left">'ABS'</td></tr>
-     <tr><td class="num"> -20.7</td><td class="left">'ged'</td></tr>
-     <tr><td class="num"> -19.8</td><td class="left">'dpl'</td></tr>
+     <tr><td class="num"> -21.4</td><td class="left">'dpl'</td></tr>
      <tr><td class="num"> -19.5</td><td class="left">'Raoul'</td></tr>
-     <tr><td class="num"> -18.9</td><td class="left">'Emmanuel'</td></tr>
-     <tr><td class="num"> -16.2</td><td class="left">'Ronald'</td></tr>
+     <tr><td class="num"> -16.1</td><td class="left">'Ronald'</td></tr>
      <tr><td class="num"> -15.7</td><td class="left">'Ghatotkacha'</td></tr>
-     <tr><td class="num"> -12.3</td><td class="left">'Lukas'</td></tr>
-     <tr><td class="num"> -11.5</td><td class="left">'HuB34'</td></tr>
-     <tr><td class="num"> -11.1</td><td class="left">'Daisy'</td></tr>
+     <tr><td class="num"> -12.2</td><td class="left">'Lukas'</td></tr>
+     <tr><td class="num"> -11.4</td><td class="left">'HuB34'</td></tr>
+     <tr><td class="num"> -11.3</td><td class="left">'Daisy'</td></tr>
      <tr><td class="num">  -8.2</td><td class="left">'joseba'</td></tr>
      <tr><td class="num">  -8.1</td><td class="left">'Iceshark7'</td></tr>
-     <tr><td class="num">  -4.3</td><td class="left">'Daniel'</td></tr>
+     <tr><td class="num">  -4.2</td><td class="left">'Daniel'</td></tr>
      <tr><td class="num">  -3.0</td><td class="left">'fabian'</td></tr>
-     <tr><td class="num">  -1.5</td><td class="left">'Craven'</td></tr>
-     <tr><td class="num">  -1.2</td><td class="left">'JuSt'</td></tr>
-     <tr><td class="num">  -1.0</td><td class="left">'Wuzzy'</td></tr>
-     <tr><td class="num">   1.5</td><td class="left">'para_doks'</td></tr>
-     <tr><td class="num">   1.7</td><td class="left">'Tobias'</td></tr>
+     <tr><td class="num">  -1.4</td><td class="left">'Craven'</td></tr>
+     <tr><td class="num">  -1.1</td><td class="left">'Wuzzy'</td></tr>
+     <tr><td class="num">  -1.1</td><td class="left">'JuSt'</td></tr>
+     <tr><td class="num">   0.3</td><td class="left">'mrduke'</td></tr>
+     <tr><td class="num">   1.6</td><td class="left">'para_doks'</td></tr>
+     <tr><td class="num">   1.8</td><td class="left">'Tobias'</td></tr>
      <tr><td class="num">   2.6</td><td class="left">'Guglielmo'</td></tr>
      <tr><td class="num">   3.7</td><td class="left">'Kevin'</td></tr>
      <tr><td class="num">   3.7</td><td class="left">'U-Punkt'</td></tr>
      <tr><td class="num">   4.0</td><td class="left">'Andy'</td></tr>
-     <tr><td class="num">   4.0</td><td class="left">'serpent'</td></tr>
-     <tr><td class="num">   6.3</td><td class="left">'Austin'</td></tr>
+     <tr><td class="num">   4.1</td><td class="left">'serpent'</td></tr>
+     <tr><td class="num">   6.2</td><td class="left">'Austin'</td></tr>
      <tr><td class="num">   8.1</td><td class="left">'shoki'</td></tr>
-     <tr><td class="num">   8.3</td><td class="left">'mrduke'</td></tr>
+     <tr><td class="num">   9.5</td><td class="left">'Tiza'</td></tr>
+     <tr><td class="num">  10.5</td><td class="left">'Freshman'</td></tr>
      <tr><td class="num">  10.8</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-     <tr><td class="num">  11.9</td><td class="left">'Tiza'</td></tr>
-     <tr><td class="num">  12.2</td><td class="left">'Andreas'</td></tr>
-     <tr><td class="num">  12.2</td><td class="left">'Freshman'</td></tr>
-     <tr><td class="num">  13.1</td><td class="left">'alfred69'</td></tr>
-     <tr><td class="num">  13.4</td><td class="left">'Chocolate Zero'</td></tr>
+     <tr><td class="num">  12.3</td><td class="left">'Andreas'</td></tr>
+     <tr><td class="num">  13.2</td><td class="left">'alfred69'</td></tr>
+     <tr><td class="num">  13.6</td><td class="left">'Chocolate Zero'</td></tr>
      <tr><td class="num">  14.4</td><td class="left">'Sim_Ed'</td></tr>
-     <tr><td class="num">  14.7</td><td class="left">'Agnieszka'</td></tr>
-     <tr><td class="num">  15.0</td><td class="left">'Mark P.'</td></tr>
-     <tr><td class="num">  19.2</td><td class="left">'Alex'</td></tr>
-     <tr><td class="num">  21.1</td><td class="left">'Antonio EE'</td></tr>
-     <tr><td class="num">  22.0</td><td class="left">'Klaus'</td></tr>
+     <tr><td class="num">  14.6</td><td class="left">'Agnieszka'</td></tr>
+     <tr><td class="num">  14.9</td><td class="left">'Mark P.'</td></tr>
+     <tr><td class="num">  19.3</td><td class="left">'Alex'</td></tr>
+     <tr><td class="num">  21.2</td><td class="left">'Antonio EE'</td></tr>
+     <tr><td class="num">  22.1</td><td class="left">'Klaus'</td></tr>
      <tr><td class="num">  22.2</td><td class="left">'Marc-Hendrik'</td></tr>
      <tr><td class="num">  22.4</td><td class="left">'Chris'</td></tr>
-     <tr><td class="num">  23.3</td><td class="left">'Thomas'</td></tr>
+     <tr><td class="num">  22.6</td><td class="left">'Angolino'</td></tr>
      <tr><td class="num">  23.4</td><td class="left">'Bent'</td></tr>
+     <tr><td class="num">  23.4</td><td class="left">'Thomas'</td></tr>
      <tr><td class="num">  24.1</td><td class="left">'hdwow'</td></tr>
-     <tr><td class="num">  24.7</td><td class="left">'Gottseinsohn'</td></tr>
-     <tr><td class="num">  25.2</td><td class="left">'Hans-HD'</td></tr>
-     <tr><td class="num">  25.7</td><td class="left">'Ale'</td></tr>
-     <tr><td class="num">  27.0</td><td class="left">'Little_Mole'</td></tr>
+     <tr><td class="num">  24.8</td><td class="left">'Gottseinsohn'</td></tr>
+     <tr><td class="num">  25.3</td><td class="left">'Hans-HD'</td></tr>
+     <tr><td class="num">  25.9</td><td class="left">'Ale'</td></tr>
      <tr><td class="num">  27.1</td><td class="left">'J3FF'</td></tr>
-     <tr><td class="num">  28.3</td><td class="left">'biotopa'</td></tr>
-     <tr><td class="num">  29.0</td><td class="left">'oblo'</td></tr>
-     <tr><td class="num">  29.3</td><td class="left">'redsantz'</td></tr>
-     <tr><td class="num">  29.7</td><td class="left">'geembo_90'</td></tr>
+     <tr><td class="num">  27.1</td><td class="left">'Little_Mole'</td></tr>
+     <tr><td class="num">  28.4</td><td class="left">'biotopa'</td></tr>
+     <tr><td class="num">  29.1</td><td class="left">'oblo'</td></tr>
+     <tr><td class="num">  29.4</td><td class="left">'redsantz'</td></tr>
+     <tr><td class="num">  29.8</td><td class="left">'geembo_90'</td></tr>
      <tr><td class="num">  30.4</td><td class="left">'Edgar_Flesk'</td></tr>
-     <tr><td class="num">  30.8</td><td class="left">'Melanie'</td></tr>
+     <tr><td class="num">  30.9</td><td class="left">'Melanie'</td></tr>
      <tr><td class="num">  31.0</td><td class="left">'IChrisI'</td></tr>
-     <tr><td class="num">  31.2</td><td class="left">'Vinksu'</td></tr>
-     <tr><td class="num">  31.3</td><td class="left">'erich'</td></tr>
-     <tr><td class="num">  31.4</td><td class="left">'NorthForty'</td></tr>
-     <tr><td class="num">  31.6</td><td class="left">'Gorn'</td></tr>
+     <tr><td class="num">  31.3</td><td class="left">'Vinksu'</td></tr>
+     <tr><td class="num">  31.4</td><td class="left">'erich'</td></tr>
+     <tr><td class="num">  31.5</td><td class="left">'NorthForty'</td></tr>
+     <tr><td class="num">  31.7</td><td class="left">'Gorn'</td></tr>
      <tr><td class="num">  31.8</td><td class="left">'Davacardo'</td></tr>
-     <tr><td class="num">  34.5</td><td class="left">'niebie'</td></tr>
      <tr><td class="num">  34.5</td><td class="left">'MicWa'</td></tr>
-     <tr><td class="num">  34.7</td><td class="left">'WP319'</td></tr>
+     <tr><td class="num">  34.6</td><td class="left">'niebie'</td></tr>
+     <tr><td class="num">  34.8</td><td class="left">'WP319'</td></tr>
      <tr><td class="num">  35.0</td><td class="left">'Kosby'</td></tr>
      <tr><td class="num">  36.7</td><td class="left">'Rugby4ever'</td></tr>
-     <tr><td class="num">  38.1</td><td class="left">'mecke'</td></tr>
-     <tr><td class="num">  38.2</td><td class="left">'Drotten'</td></tr>
+     <tr><td class="num">  38.0</td><td class="left">'mecke'</td></tr>
+     <tr><td class="num">  38.1</td><td class="left">'Drotten'</td></tr>
      <tr><td class="num">  38.6</td><td class="left">'Archcorenth'</td></tr>
      <tr><td class="num">  38.9</td><td class="left">'Harry Lim'</td></tr>
-     <tr><td class="num">  39.1</td><td class="left">'B-man'</td></tr>
-     <tr><td class="num">  39.5</td><td class="left">'Angolino'</td></tr>
+     <tr><td class="num">  39.0</td><td class="left">'B-man'</td></tr>
      <tr><td class="num">  40.0</td><td class="left">'Nfol'</td></tr>
      <tr><td class="num">  40.5</td><td class="left">'Tiger'</td></tr>
-     <tr><td class="num">  41.1</td><td class="left">'Snaily'</td></tr>
-     <tr><td class="num">  41.4</td><td class="left">'Vlad'</td></tr>
+     <tr><td class="num">  40.7</td><td class="left">'gringer'</td></tr>
+     <tr><td class="num">  41.0</td><td class="left">'Snaily'</td></tr>
+     <tr><td class="num">  41.1</td><td class="left">'Vlad'</td></tr>
      <tr><td class="num">  42.4</td><td class="left">'Momcat'</td></tr>
      <tr><td class="num">  42.5</td><td class="left">'Liam Sheehan'</td></tr>
      <tr><td class="num">  42.9</td><td class="left">'Breezy'</td></tr>
-     <tr><td class="num">  43.0</td><td class="left">'Uli'</td></tr>
-     <tr><td class="num">  44.8</td><td class="left">'Tarim'</td></tr>
+     <tr><td class="num">  43.1</td><td class="left">'Uli'</td></tr>
+     <tr><td class="num">  44.9</td><td class="left">'Tarim'</td></tr>
      <tr><td class="num">  45.4</td><td class="left">'IntKecsk'</td></tr>
      <tr><td class="num">  45.7</td><td class="left">'tjRaven'</td></tr>
      <tr><td class="num">  46.8</td><td class="left">'ntaeijr'</td></tr>
      <tr><td class="num">  47.0</td><td class="left">'mhatta'</td></tr>
      <tr><td class="num">  48.6</td><td class="left">'Zak'</td></tr>
+     <tr><td class="num">  49.0</td><td class="left">'rima'</td></tr>
      <tr><td class="num">  49.1</td><td class="left">'Valkyrie2'</td></tr>
      <tr><td class="num">  49.5</td><td class="left">'Sandra'</td></tr>
      <tr><td class="num">  50.4</td><td class="left">'jdcampo'</td></tr>
      <tr><td class="num">  50.9</td><td class="left">'Jeffrey S'</td></tr>
      <tr><td class="num">  51.2</td><td class="left">'brynn'</td></tr>
      <tr><td class="num">  51.3</td><td class="left">'Slav'</td></tr>
-     <tr><td class="num">  51.4</td><td class="left">'AkRa'</td></tr>
+     <tr><td class="num">  51.5</td><td class="left">'AkRa'</td></tr>
      <tr><td class="num">  51.8</td><td class="left">'Vaily'</td></tr>
      <tr><td class="num">  52.9</td><td class="left">'Turbogurk'</td></tr>
      <tr><td class="num">  52.9</td><td class="left">'Neophilus'</td></tr>
      <tr><td class="num">  52.9</td><td class="left">'Cyphase'</td></tr>
      <tr><td class="num">  55.3</td><td class="left">'krazy62'</td></tr>
      <tr><td class="num">  56.1</td><td class="left">'Adonica'</td></tr>
-     <tr><td class="num">  58.7</td><td class="left">'Mecki'</td></tr>
+     <tr><td class="num">  58.8</td><td class="left">'Mecki'</td></tr>
+     <tr><td class="num">  59.3</td><td class="left">'Sopoforic'</td></tr>
      <tr><td class="num">  61.4</td><td class="left">'Asbel'</td></tr>
      <tr><td class="num">  63.3</td><td class="left">'Meeve'</td></tr>
-     <tr><td class="num">  65.9</td><td class="left">'ael'</td></tr>
+     <tr><td class="num">  65.8</td><td class="left">'ael'</td></tr>
      <tr><td class="num">  66.3</td><td class="left">'Samuel'</td></tr>
      <tr><td class="num">  66.6</td><td class="left">'schmusi20'</td></tr>
-     <tr><td class="num">  67.2</td><td class="left">'Alf'</td></tr>
+     <tr><td class="num">  67.3</td><td class="left">'Alf'</td></tr>
      <tr><td class="num">  68.9</td><td class="left">'Magnus and Susi'</td></tr>
+     <tr><td class="num">  69.6</td><td class="left">'Zhura'</td></tr>
      <tr><td class="num">  70.0</td><td class="left">'xmouse'</td></tr>
+     <tr><td class="num">  70.6</td><td class="left">'tasker'</td></tr>
      <tr><td class="num">  71.6</td><td class="left">'Joona'</td></tr>
      <tr><td class="num">  71.8</td><td class="left">'AQZ'</td></tr>
      <tr><td class="num">  73.3</td><td class="left">'crypto_rsa'</td></tr>
-     <tr><td class="num">  73.8</td><td class="left">'Dvorhagen'</td></tr>
+     <tr><td class="num">  73.7</td><td class="left">'Dvorhagen'</td></tr>
+     <tr><td class="num">  74.7</td><td class="left">'Nicol?s'</td></tr>
      <tr><td class="num">  74.8</td><td class="left">'jojo'</td></tr>
      <tr><td class="num">  74.9</td><td class="left">'AsuCaga'</td></tr>
      <tr><td class="num">  78.2</td><td class="left">'colonel crayon'</td></tr>
+     <tr><td class="num">  79.9</td><td class="left">'Kroetchen'</td></tr>
      <tr><td class="num">  80.1</td><td class="left">'Agares'</td></tr>
      <tr><td class="num">  84.8</td><td class="left">'Miel56'</td></tr>
      <tr><td class="num">  89.9</td><td class="left">'The red O'</td></tr>
+     <tr><td class="num">  90.0</td><td class="left">'Sequoyah'</td></tr>
      <tr><td class="num">  92.2</td><td class="left">'Michael'</td></tr>
   </table>

Modified: homepage/input/table-rat.html
===================================================================
--- homepage/input/table-rat.html	2008-05-01 11:30:49 UTC (rev 1118)
+++ homepage/input/table-rat.html	2008-05-01 18:13:35 UTC (rev 1119)
@@ -1,22 +1,22 @@
   <table>
-    <caption>$$Rating_Statistics$$ $$March$$ 2008</caption>
+    <caption>$$Rating_Statistics$$ $$April$$ 2008</caption>
     <colgroup><col width="80"><col width="80"><col width="220"></colgroup>
     <tr><th>$$count$$</th><th>$$average$$</th><th class="left">$$user$$</th></tr>    <tr><td class="num">1062</td><td class="num"> 5.06</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1056</td><td class="num"> 4.83</td><td class="left">'Taztunes'</td></tr>
-    <tr><td class="num">880</td><td class="num"> 5.00</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num">921</td><td class="num"> 5.02</td><td class="left">'dev0'</td></tr>
     <tr><td class="num">871</td><td class="num"> 5.09</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num">864</td><td class="num"> 4.78</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num">868</td><td class="num"> 4.79</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">653</td><td class="num"> 5.01</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num">628</td><td class="num"> 5.00</td><td class="left">'Moneymaker'</td></tr>
     <tr><td class="num">622</td><td class="num"> 4.22</td><td class="left">'shoki'</td></tr>
     <tr><td class="num">596</td><td class="num"> 4.82</td><td class="left">'U-Punkt'</td></tr>
-    <tr><td class="num">539</td><td class="num"> 5.11</td><td class="left">'dpl'</td></tr>
+    <tr><td class="num">549</td><td class="num"> 5.13</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">534</td><td class="num"> 4.97</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num">511</td><td class="num"> 5.30</td><td class="left">'Lukas'</td></tr>
     <tr><td class="num">487</td><td class="num"> 5.02</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num">448</td><td class="num"> 5.08</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num">433</td><td class="num"> 4.24</td><td class="left">'Alexandros'</td></tr>
-    <tr><td class="num">424</td><td class="num"> 4.35</td><td class="left">'ged'</td></tr>
+    <tr><td class="num">438</td><td class="num"> 4.23</td><td class="left">'Alexandros'</td></tr>
+    <tr><td class="num">431</td><td class="num"> 4.36</td><td class="left">'ged'</td></tr>
     <tr><td class="num">388</td><td class="num"> 4.86</td><td class="left">'Gloop'</td></tr>
     <tr><td class="num">369</td><td class="num"> 4.04</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num">307</td><td class="num"> 4.01</td><td class="left">'Sim_Ed'</td></tr>
@@ -25,20 +25,24 @@
     <tr><td class="num">208</td><td class="num"> 6.15</td><td class="left">'Momcat'</td></tr>
     <tr><td class="num">200</td><td class="num"> 5.74</td><td class="left">'Malla'</td></tr>
     <tr><td class="num">187</td><td class="num"> 5.05</td><td class="left">'WP319'</td></tr>
-    <tr><td class="num">138</td><td class="num"> 5.00</td><td class="left">'Tiza'</td></tr>
+    <tr><td class="num">158</td><td class="num"> 5.05</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num">135</td><td class="num"> 4.13</td><td class="left">'Edgar_Flesk'</td></tr>
     <tr><td class="num">129</td><td class="num"> 5.64</td><td class="left">'Raoul'</td></tr>
     <tr><td class="num"> 97</td><td class="num"> 4.16</td><td class="left">'Safalra'</td></tr>
+    <tr><td class="num"> 91</td><td class="num"> 4.41</td><td class="left">'Zhura'</td></tr>
     <tr><td class="num"> 85</td><td class="num"> 4.76</td><td class="left">'para_doks'</td></tr>
+    <tr><td class="num"> 72</td><td class="num"> 4.49</td><td class="left">'Kroetchen'</td></tr>
     <tr><td class="num"> 72</td><td class="num"> 5.63</td><td class="left">'Wuzzy'</td></tr>
+    <tr><td class="num"> 62</td><td class="num"> 6.03</td><td class="left">'mecke'</td></tr>
     <tr><td class="num"> 51</td><td class="num"> 6.39</td><td class="left">'Little_Mole'</td></tr>
     <tr><td class="num"> 50</td><td class="num"> 5.26</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num"> 49</td><td class="num"> 6.02</td><td class="left">'oblo'</td></tr>
     <tr><td class="num"> 49</td><td class="num"> 4.90</td><td class="left">'hendrik'</td></tr>
     <tr><td class="num"> 43</td><td class="num"> 3.74</td><td class="left">'Iceshark7'</td></tr>
+    <tr><td class="num"> 39</td><td class="num"> 6.08</td><td class="left">'mrduke'</td></tr>
+    <tr><td class="num"> 33</td><td class="num"> 5.27</td><td class="left">'gringer'</td></tr>
     <tr><td class="num"> 31</td><td class="num"> 7.61</td><td class="left">'AkRa'</td></tr>
     <tr><td class="num"> 30</td><td class="num"> 4.40</td><td class="left">'Archcorenth'</td></tr>
-    <tr><td class="num"> 25</td><td class="num"> 6.04</td><td class="left">'mrduke'</td></tr>
     <tr><td class="num"> 25</td><td class="num"> 4.88</td><td class="left">'Drotten'</td></tr>
     <tr><td class="num"> 23</td><td class="num"> 7.22</td><td class="left">'Mark P.'</td></tr>
     <tr><td class="num"> 17</td><td class="num"> 5.53</td><td class="left">'Jeffrey S'</td></tr>
@@ -65,6 +69,7 @@
     <tr><td class="num">  3</td><td class="num"> 3.00</td><td class="left">'Rugby4ever'</td></tr>
     <tr><td class="num">  3</td><td class="num"> 4.33</td><td class="left">'krazy62'</td></tr>
     <tr><td class="num">  2</td><td class="num"> 6.50</td><td class="left">'tjRaven'</td></tr>
+    <tr><td class="num">  2</td><td class="num"> 6.00</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num">  2</td><td class="num"> 0.00</td><td class="left">'mhatta'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'ael'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 6.00</td><td class="left">'Slav'</td></tr>
@@ -72,6 +77,7 @@
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'Uli'</td></tr>
     <tr><td class="num">  1</td><td class="num">10.00</td><td class="left">'Cyphase'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 5.00</td><td class="left">'Harry Lim'</td></tr>
-    <tr><td class="num">  1</td><td class="num"> 6.00</td><td class="left">'Emmanuel'</td></tr>
+    <tr><td class="num">  1</td><td class="num"> 2.00</td><td class="left">'Sequoyah'</td></tr>
     <tr><td class="num">  1</td><td class="num"> 4.00</td><td class="left">'jojo'</td></tr>
+    <tr><td class="num">  1</td><td class="num"> 6.00</td><td class="left">'Sopoforic'</td></tr>
   </table>

Modified: homepage/input/table-solved.html
===================================================================
--- homepage/input/table-solved.html	2008-05-01 11:30:49 UTC (rev 1118)
+++ homepage/input/table-solved.html	2008-05-01 18:13:35 UTC (rev 1119)
@@ -1,26 +1,26 @@
   <table>
-    <caption>$$Solved_Level_Statistics$$ $$March$$ 2008</caption>
+    <caption>$$Solved_Level_Statistics$$ $$April$$ 2008</caption>
     <colgroup><col width="130"><col width="130"><col width="130"><col width="240"></colgroup>
     <tr><th>$$difficult$$</th><th>$$easy$$</th><th>$$total$$</th><th class="left">$$user$$</th></tr>
     <tr><td class="num">1045/1045</td><td class="num">189/189</td><td class="num">100.00%</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1043/1045</td><td class="num">189/189</td><td class="num"> 99.84%</td><td class="left">'Taztunes'</td></tr>
     <tr><td class="num">1029/1045</td><td class="num">183/189</td><td class="num"> 98.22%</td><td class="left">'Craven'</td></tr>
     <tr><td class="num">1031/1045</td><td class="num">179/189</td><td class="num"> 98.06%</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">1025/1045</td><td class="num">183/189</td><td class="num"> 97.89%</td><td class="left">'Freshman'</td></tr>
     <tr><td class="num">1016/1045</td><td class="num">182/189</td><td class="num"> 97.08%</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num">1021/1045</td><td class="num">177/189</td><td class="num"> 97.08%</td><td class="left">'Malla'</td></tr>
     <tr><td class="num">1014/1045</td><td class="num">175/189</td><td class="num"> 96.35%</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num"> 999/1045</td><td class="num">177/189</td><td class="num"> 95.30%</td><td class="left">'biotopa'</td></tr>
-    <tr><td class="num"> 984/1045</td><td class="num">173/189</td><td class="num"> 93.76%</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num"> 988/1045</td><td class="num">175/189</td><td class="num"> 94.25%</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num"> 970/1045</td><td class="num">166/189</td><td class="num"> 92.06%</td><td class="left">'Andy'</td></tr>
     <tr><td class="num"> 949/1045</td><td class="num">170/189</td><td class="num"> 90.68%</td><td class="left">'para_doks'</td></tr>
-    <tr><td class="num"> 943/1045</td><td class="num">172/189</td><td class="num"> 90.36%</td><td class="left">'Daisy'</td></tr>
-    <tr><td class="num"> 943/1045</td><td class="num">168/189</td><td class="num"> 90.03%</td><td class="left">'mecke'</td></tr>
+    <tr><td class="num"> 945/1045</td><td class="num">172/189</td><td class="num"> 90.52%</td><td class="left">'Daisy'</td></tr>
+    <tr><td class="num"> 947/1045</td><td class="num">169/189</td><td class="num"> 90.44%</td><td class="left">'mecke'</td></tr>
+    <tr><td class="num"> 925/1045</td><td class="num">169/189</td><td class="num"> 88.65%</td><td class="left">'dev0'</td></tr>
+    <tr><td class="num"> 922/1045</td><td class="num">154/189</td><td class="num"> 87.20%</td><td class="left">'mrduke'</td></tr>
     <tr><td class="num"> 933/1045</td><td class="num">125/189</td><td class="num"> 85.74%</td><td class="left">'Alex'</td></tr>
     <tr><td class="num"> 914/1045</td><td class="num">135/189</td><td class="num"> 85.01%</td><td class="left">'JuSt'</td></tr>
-    <tr><td class="num"> 879/1045</td><td class="num">163/189</td><td class="num"> 84.44%</td><td class="left">'dev0'</td></tr>
     <tr><td class="num"> 894/1045</td><td class="num">140/189</td><td class="num"> 83.79%</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num"> 887/1045</td><td class="num">143/189</td><td class="num"> 83.47%</td><td class="left">'mrduke'</td></tr>
-    <tr><td class="num">1020/1045</td><td class="num">  6/189</td><td class="num"> 83.14%</td><td class="left">'Freshman'</td></tr>
     <tr><td class="num"> 863/1045</td><td class="num">161/189</td><td class="num"> 82.98%</td><td class="left">'Tobias'</td></tr>
     <tr><td class="num"> 917/1045</td><td class="num">106/189</td><td class="num"> 82.90%</td><td class="left">'Django'</td></tr>
     <tr><td class="num"> 863/1045</td><td class="num">150/189</td><td class="num"> 82.09%</td><td class="left">'Gloop'</td></tr>
@@ -36,12 +36,12 @@
     <tr><td class="num"> 739/1045</td><td class="num">131/189</td><td class="num"> 70.50%</td><td class="left">'ABS'</td></tr>
     <tr><td class="num"> 728/1045</td><td class="num">126/189</td><td class="num"> 69.21%</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num"> 755/1045</td><td class="num"> 96/189</td><td class="num"> 68.96%</td><td class="left">'brynn'</td></tr>
+    <tr><td class="num"> 730/1045</td><td class="num">121/189</td><td class="num"> 68.96%</td><td class="left">'dpl'</td></tr>
     <tr><td class="num"> 762/1045</td><td class="num"> 73/189</td><td class="num"> 67.67%</td><td class="left">'redsantz'</td></tr>
     <tr><td class="num"> 734/1045</td><td class="num"> 82/189</td><td class="num"> 66.13%</td><td class="left">'bojster'</td></tr>
     <tr><td class="num"> 782/1045</td><td class="num"> 33/189</td><td class="num"> 66.05%</td><td class="left">'Sim_Ed'</td></tr>
-    <tr><td class="num"> 686/1045</td><td class="num">118/189</td><td class="num"> 65.15%</td><td class="left">'dpl'</td></tr>
+    <tr><td class="num"> 693/1045</td><td class="num">112/189</td><td class="num"> 65.24%</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 766/1045</td><td class="num"> 37/189</td><td class="num"> 65.07%</td><td class="left">'alfred69'</td></tr>
-    <tr><td class="num"> 670/1045</td><td class="num">107/189</td><td class="num"> 62.97%</td><td class="left">'Ludmian'</td></tr>
     <tr><td class="num"> 681/1045</td><td class="num"> 78/189</td><td class="num"> 61.51%</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 659/1045</td><td class="num"> 95/189</td><td class="num"> 61.10%</td><td class="left">'Marc-Hendrik'</td></tr>
     <tr><td class="num"> 633/1045</td><td class="num">110/189</td><td class="num"> 60.21%</td><td class="left">'Raoul'</td></tr>
@@ -49,11 +49,11 @@
     <tr><td class="num"> 714/1045</td><td class="num">  0/189</td><td class="num"> 57.86%</td><td class="left">'Gottseinsohn'</td></tr>
     <tr><td class="num"> 620/1045</td><td class="num"> 72/189</td><td class="num"> 56.08%</td><td class="left">'Breezy'</td></tr>
     <tr><td class="num"> 636/1045</td><td class="num"> 55/189</td><td class="num"> 56.00%</td><td class="left">'fabian'</td></tr>
+    <tr><td class="num"> 566/1045</td><td class="num">117/189</td><td class="num"> 55.35%</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 569/1045</td><td class="num">113/189</td><td class="num"> 55.27%</td><td class="left">'Mark P.'</td></tr>
     <tr><td class="num"> 588/1045</td><td class="num"> 93/189</td><td class="num"> 55.19%</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 599/1045</td><td class="num"> 80/189</td><td class="num"> 55.02%</td><td class="left">'serpent'</td></tr>
     <tr><td class="num"> 634/1045</td><td class="num"> 43/189</td><td class="num"> 54.86%</td><td class="left">'Klaus'</td></tr>
-    <tr><td class="num"> 557/1045</td><td class="num">117/189</td><td class="num"> 54.62%</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 576/1045</td><td class="num"> 93/189</td><td class="num"> 54.21%</td><td class="left">'Guglielmo'</td></tr>
     <tr><td class="num"> 565/1045</td><td class="num">100/189</td><td class="num"> 53.89%</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 525/1045</td><td class="num"> 95/189</td><td class="num"> 50.24%</td><td class="left">'ShadowPhrogg32642342'</td></tr>
@@ -69,26 +69,28 @@
     <tr><td class="num"> 516/1045</td><td class="num"> 24/189</td><td class="num"> 43.76%</td><td class="left">'niebie'</td></tr>
     <tr><td class="num"> 494/1045</td><td class="num"> 26/189</td><td class="num"> 42.14%</td><td class="left">'Daniel'</td></tr>
     <tr><td class="num"> 506/1045</td><td class="num"> 12/189</td><td class="num"> 41.98%</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num"> 446/1045</td><td class="num"> 65/189</td><td class="num"> 41.41%</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num"> 503/1045</td><td class="num">  7/189</td><td class="num"> 41.33%</td><td class="left">'Edgar_Flesk'</td></tr>
-    <tr><td class="num"> 419/1045</td><td class="num"> 59/189</td><td class="num"> 38.74%</td><td class="left">'Tiza'</td></tr>
-    <tr><td class="num"> 433/1045</td><td class="num"> 45/189</td><td class="num"> 38.74%</td><td class="left">'ged'</td></tr>
+    <tr><td class="num"> 439/1045</td><td class="num"> 49/189</td><td class="num"> 39.55%</td><td class="left">'ged'</td></tr>
+    <tr><td class="num"> 390/1045</td><td class="num"> 93/189</td><td class="num"> 39.14%</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 467/1045</td><td class="num">  6/189</td><td class="num"> 38.33%</td><td class="left">'Vinksu'</td></tr>
     <tr><td class="num"> 438/1045</td><td class="num">  3/189</td><td class="num"> 35.74%</td><td class="left">'oblo'</td></tr>
     <tr><td class="num"> 392/1045</td><td class="num"> 40/189</td><td class="num"> 35.01%</td><td class="left">'hendrik'</td></tr>
     <tr><td class="num"> 391/1045</td><td class="num"> 36/189</td><td class="num"> 34.60%</td><td class="left">'Iceshark7'</td></tr>
-    <tr><td class="num"> 336/1045</td><td class="num"> 86/189</td><td class="num"> 34.20%</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 397/1045</td><td class="num"> 24/189</td><td class="num"> 34.12%</td><td class="left">'Chocolate Zero'</td></tr>
     <tr><td class="num"> 368/1045</td><td class="num"> 44/189</td><td class="num"> 33.39%</td><td class="left">'Liam Sheehan'</td></tr>
     <tr><td class="num"> 376/1045</td><td class="num"> 35/189</td><td class="num"> 33.31%</td><td class="left">'Jeffrey S'</td></tr>
     <tr><td class="num"> 392/1045</td><td class="num"> 12/189</td><td class="num"> 32.74%</td><td class="left">'NorthForty'</td></tr>
     <tr><td class="num"> 344/1045</td><td class="num"> 51/189</td><td class="num"> 32.01%</td><td class="left">'Momcat'</td></tr>
     <tr><td class="num"> 382/1045</td><td class="num"> 10/189</td><td class="num"> 31.77%</td><td class="left">'J3FF'</td></tr>
+    <tr><td class="num"> 347/1045</td><td class="num"> 45/189</td><td class="num"> 31.77%</td><td class="left">'rima'</td></tr>
     <tr><td class="num"> 335/1045</td><td class="num"> 50/189</td><td class="num"> 31.20%</td><td class="left">'Harry Lim'</td></tr>
     <tr><td class="num"> 361/1045</td><td class="num"> 18/189</td><td class="num"> 30.71%</td><td class="left">'MicWa'</td></tr>
     <tr><td class="num"> 306/1045</td><td class="num"> 71/189</td><td class="num"> 30.55%</td><td class="left">'Davacardo'</td></tr>
     <tr><td class="num"> 370/1045</td><td class="num">  7/189</td><td class="num"> 30.55%</td><td class="left">'IChrisI'</td></tr>
     <tr><td class="num"> 350/1045</td><td class="num"> 25/189</td><td class="num"> 30.39%</td><td class="left">'IntKecsk'</td></tr>
     <tr><td class="num"> 323/1045</td><td class="num"> 52/189</td><td class="num"> 30.39%</td><td class="left">'Kevin'</td></tr>
+    <tr><td class="num"> 277/1045</td><td class="num"> 90/189</td><td class="num"> 29.74%</td><td class="left">'gringer'</td></tr>
     <tr><td class="num"> 331/1045</td><td class="num"> 14/189</td><td class="num"> 27.96%</td><td class="left">'Archcorenth'</td></tr>
     <tr><td class="num"> 281/1045</td><td class="num"> 63/189</td><td class="num"> 27.88%</td><td class="left">'erich'</td></tr>
     <tr><td class="num"> 295/1045</td><td class="num"> 29/189</td><td class="num"> 26.26%</td><td class="left">'Tiger'</td></tr>
@@ -107,6 +109,7 @@
     <tr><td class="num"> 214/1045</td><td class="num"> 19/189</td><td class="num"> 18.88%</td><td class="left">'Adonica'</td></tr>
     <tr><td class="num"> 206/1045</td><td class="num">  4/189</td><td class="num"> 17.02%</td><td class="left">'krazy62'</td></tr>
     <tr><td class="num"> 181/1045</td><td class="num"> 20/189</td><td class="num"> 16.29%</td><td class="left">'Vaily'</td></tr>
+    <tr><td class="num"> 152/1045</td><td class="num"> 32/189</td><td class="num"> 14.91%</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num"> 156/1045</td><td class="num"> 24/189</td><td class="num"> 14.59%</td><td class="left">'jdcampo'</td></tr>
     <tr><td class="num"> 125/1045</td><td class="num"> 55/189</td><td class="num"> 14.59%</td><td class="left">'Vlad'</td></tr>
     <tr><td class="num"> 149/1045</td><td class="num"> 30/189</td><td class="num"> 14.51%</td><td class="left">'Chris'</td></tr>
@@ -120,23 +123,28 @@
     <tr><td class="num"> 148/1045</td><td class="num">  5/189</td><td class="num"> 12.40%</td><td class="left">'Rugby4ever'</td></tr>
     <tr><td class="num"> 110/1045</td><td class="num"> 31/189</td><td class="num"> 11.43%</td><td class="left">'Cyphase'</td></tr>
     <tr><td class="num"> 124/1045</td><td class="num"> 15/189</td><td class="num"> 11.26%</td><td class="left">'Magnus and Susi'</td></tr>
-    <tr><td class="num"> 114/1045</td><td class="num"> 23/189</td><td class="num"> 11.10%</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num"> 131/1045</td><td class="num">  1/189</td><td class="num"> 10.70%</td><td class="left">'Asbel'</td></tr>
     <tr><td class="num"> 105/1045</td><td class="num"> 22/189</td><td class="num"> 10.29%</td><td class="left">'Neophilus'</td></tr>
+    <tr><td class="num">  89/1045</td><td class="num"> 24/189</td><td class="num">  9.16%</td><td class="left">'Zhura'</td></tr>
     <tr><td class="num"> 101/1045</td><td class="num">  0/189</td><td class="num">  8.18%</td><td class="left">'Alf'</td></tr>
     <tr><td class="num">  75/1045</td><td class="num"> 12/189</td><td class="num">  7.05%</td><td class="left">'schmusi20'</td></tr>
     <tr><td class="num">  67/1045</td><td class="num"> 19/189</td><td class="num">  6.97%</td><td class="left">'Dvorhagen'</td></tr>
+    <tr><td class="num">  75/1045</td><td class="num"> 10/189</td><td class="num">  6.89%</td><td class="left">'Kroetchen'</td></tr>
+    <tr><td class="num">  83/1045</td><td class="num">  1/189</td><td class="num">  6.81%</td><td class="left">'tasker'</td></tr>
     <tr><td class="num">  57/1045</td><td class="num"> 26/189</td><td class="num">  6.73%</td><td class="left">'Meeve'</td></tr>
     <tr><td class="num">  65/1045</td><td class="num"> 16/189</td><td class="num">  6.56%</td><td class="left">'Slav'</td></tr>
     <tr><td class="num">  64/1045</td><td class="num"> 16/189</td><td class="num">  6.48%</td><td class="left">'AQZ'</td></tr>
     <tr><td class="num">  59/1045</td><td class="num"> 21/189</td><td class="num">  6.48%</td><td class="left">'AsuCaga'</td></tr>
     <tr><td class="num">  58/1045</td><td class="num"> 19/189</td><td class="num">  6.24%</td><td class="left">'xmouse'</td></tr>
     <tr><td class="num">  67/1045</td><td class="num">  7/189</td><td class="num">  6.00%</td><td class="left">'Joona'</td></tr>
+    <tr><td class="num">  54/1045</td><td class="num"> 18/189</td><td class="num">  5.83%</td><td class="left">'Sopoforic'</td></tr>
     <tr><td class="num">  54/1045</td><td class="num"> 12/189</td><td class="num">  5.35%</td><td class="left">'Samuel'</td></tr>
     <tr><td class="num">  47/1045</td><td class="num"> 17/189</td><td class="num">  5.19%</td><td class="left">'crypto_rsa'</td></tr>
     <tr><td class="num">  44/1045</td><td class="num"> 16/189</td><td class="num">  4.86%</td><td class="left">'Agares'</td></tr>
+    <tr><td class="num">  40/1045</td><td class="num"> 15/189</td><td class="num">  4.46%</td><td class="left">'Nicol?s'</td></tr>
     <tr><td class="num">  39/1045</td><td class="num"> 14/189</td><td class="num">  4.29%</td><td class="left">'jojo'</td></tr>
     <tr><td class="num">  31/1045</td><td class="num"> 10/189</td><td class="num">  3.32%</td><td class="left">'colonel crayon'</td></tr>
+    <tr><td class="num">  39/1045</td><td class="num">  0/189</td><td class="num">  3.16%</td><td class="left">'Sequoyah'</td></tr>
     <tr><td class="num">  27/1045</td><td class="num">  5/189</td><td class="num">  2.59%</td><td class="left">'Miel56'</td></tr>
     <tr><td class="num">  23/1045</td><td class="num">  5/189</td><td class="num">  2.27%</td><td class="left">'The red O'</td></tr>
     <tr><td class="num">   7/1045</td><td class="num"> 12/189</td><td class="num">  1.54%</td><td class="left">'Michael'</td></tr>

Modified: homepage/input/table-wr.html
===================================================================
--- homepage/input/table-wr.html	2008-05-01 11:30:49 UTC (rev 1118)
+++ homepage/input/table-wr.html	2008-05-01 18:13:35 UTC (rev 1119)
@@ -1,52 +1,50 @@
   <table>
-    <caption>$$Worldrecord_Statistics$$ $$March$$ 2008</caption>
+    <caption>$$Worldrecord_Statistics$$ $$April$$ 2008</caption>
     <colgroup><col width="80"><col width="80"><col width="470"></colgroup>
     <tr><th>$$total$$</th><th>$$shared$$</th><th class="left">$$user$$</th></tr>
-    <tr><td class="num">977</td><td class="num">240</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">165</td><td class="num"> 96</td><td class="left">'Stupid'</td></tr>
-    <tr><td class="num">126</td><td class="num">115</td><td class="left">'Johannes'</td></tr>
-    <tr><td class="num"> 73</td><td class="num"> 57</td><td class="left">'daydreamer'</td></tr>
-    <tr><td class="num"> 62</td><td class="num"> 43</td><td class="left">'Duffy'</td></tr>
-    <tr><td class="num"> 48</td><td class="num"> 31</td><td class="left">'Malla'</td></tr>
+    <tr><td class="num">995</td><td class="num">238</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">161</td><td class="num"> 93</td><td class="left">'Stupid'</td></tr>
+    <tr><td class="num">118</td><td class="num">110</td><td class="left">'Johannes'</td></tr>
+    <tr><td class="num"> 79</td><td class="num"> 66</td><td class="left">'daydreamer'</td></tr>
+    <tr><td class="num"> 60</td><td class="num"> 42</td><td class="left">'Duffy'</td></tr>
     <tr><td class="num"> 47</td><td class="num"> 46</td><td class="left">'Great Scott'</td></tr>
-    <tr><td class="num"> 36</td><td class="num"> 30</td><td class="left">'dev0'</td></tr>
-    <tr><td class="num"> 36</td><td class="num"> 34</td><td class="left">'Django'</td></tr>
+    <tr><td class="num"> 45</td><td class="num"> 31</td><td class="left">'Malla'</td></tr>
+    <tr><td class="num"> 40</td><td class="num"> 34</td><td class="left">'dev0'</td></tr>
     <tr><td class="num"> 35</td><td class="num"> 27</td><td class="left">'Zekobah'</td></tr>
-    <tr><td class="num"> 34</td><td class="num"> 29</td><td class="left">'Iceshark7'</td></tr>
+    <tr><td class="num"> 35</td><td class="num"> 33</td><td class="left">'Django'</td></tr>
+    <tr><td class="num"> 34</td><td class="num"> 22</td><td class="left">'ryujun'</td></tr>
+    <tr><td class="num"> 33</td><td class="num"> 28</td><td class="left">'Iceshark7'</td></tr>
     <tr><td class="num"> 32</td><td class="num"> 26</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 30</td><td class="num"> 29</td><td class="left">'joseba'</td></tr>
-    <tr><td class="num"> 29</td><td class="num"> 15</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num"> 27</td><td class="num"> 26</td><td class="left">'Ghatotkacha'</td></tr>
+    <tr><td class="num"> 21</td><td class="num"> 19</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 20</td><td class="num"> 15</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 20</td><td class="num"> 17</td><td class="left">'Ludmian'</td></tr>
-    <tr><td class="num"> 20</td><td class="num"> 18</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 20</td><td class="num"> 19</td><td class="left">'Safalra'</td></tr>
     <tr><td class="num"> 19</td><td class="num"> 17</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num"> 17</td><td class="num"> 17</td><td class="left">'bojster'</td></tr>
-    <tr><td class="num"> 16</td><td class="num">  8</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num"> 16</td><td class="num"> 14</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num"> 15</td><td class="num"> 15</td><td class="left">'ABS'</td></tr>
+    <tr><td class="num"> 14</td><td class="num">  7</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num"> 11</td><td class="num">  8</td><td class="left">'Chocolate Zero'</td></tr>
     <tr><td class="num"> 10</td><td class="num">  6</td><td class="left">'Taztunes'</td></tr>
     <tr><td class="num">  9</td><td class="num">  5</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-    <tr><td class="num">  9</td><td class="num">  6</td><td class="left">'Gloop'</td></tr>
     <tr><td class="num">  9</td><td class="num">  9</td><td class="left">'fabian'</td></tr>
+    <tr><td class="num">  8</td><td class="num">  6</td><td class="left">'Gloop'</td></tr>
     <tr><td class="num">  8</td><td class="num">  8</td><td class="left">'dpl'</td></tr>
     <tr><td class="num">  7</td><td class="num">  6</td><td class="left">'Edgar_Flesk'</td></tr>
-    <tr><td class="num">  6</td><td class="num">  2</td><td class="left">'Breezy'</td></tr>
-    <tr><td class="num">  6</td><td class="num">  3</td><td class="left">'para_doks'</td></tr>
+    <tr><td class="num">  6</td><td class="num">  3</td><td class="left">'para_doks' + 'Breezy'</td></tr>
     <tr><td class="num">  6</td><td class="num">  4</td><td class="left">'Lukas'</td></tr>
-    <tr><td class="num">  6</td><td class="num">  5</td><td class="left">'Guglielmo'</td></tr>
+    <tr><td class="num">  6</td><td class="num">  5</td><td class="left">'Guglielmo' + 'Angolino'</td></tr>
     <tr><td class="num">  6</td><td class="num">  6</td><td class="left">'Tobias' + 'Wuzzy'</td></tr>
-    <tr><td class="num">  5</td><td class="num">  4</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num">  5</td><td class="num">  5</td><td class="left">'Raoul' + 'Cyphase' + 'Thomas' + 'Chris' + 'Ralf'</td></tr>
     <tr><td class="num">  4</td><td class="num">  2</td><td class="left">'Bent'</td></tr>
     <tr><td class="num">  4</td><td class="num">  4</td><td class="left">'U-Punkt' + 'J3FF'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'Craven' + 'colonel crayon' + 'Stephanie'</td></tr>
-    <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'geembo_90' + 'Neophilus' + 'Andy'</td></tr>
-    <tr><td class="num">  2</td><td class="num">  1</td><td class="left">'mrduke' + 'Daniel' + 'Slav' + 'tjRaven'</td></tr>
-    <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'Drotten' + 'Sim_Ed' + 'hendrik' + 'Austin' + 'Snaily' + 'Antonio EE' + 'Ingo' + 'serpent'</td></tr>
+    <tr><td class="num">  3</td><td class="num">  2</td><td class="left">'mrduke' + 'Craven' + 'colonel crayon' + 'Stephanie'</td></tr>
+    <tr><td class="num">  3</td><td class="num">  3</td><td class="left">'geembo_90' + 'Tiza' + 'Neophilus' + 'Nicol?s' + 'Andy' + 'Sopoforic'</td></tr>
+    <tr><td class="num">  2</td><td class="num">  1</td><td class="left">'Daniel'</td></tr>
+    <tr><td class="num">  2</td><td class="num">  2</td><td class="left">'Drotten' + 'tjRaven' + 'Sim_Ed' + 'hendrik' + 'Austin' + 'Snaily' + 'Antonio EE' + 'Ingo' + 'serpent'</td></tr>
     <tr><td class="num">  1</td><td class="num">  0</td><td class="left">'Ale' + 'Gorn' + 'Nat' + 'Daisy'</td></tr>
-    <tr><td class="num">  1</td><td class="num">  1</td><td class="left">'alfred69' + 'Agares' + 'ntaeijr' + 'Tiger' + 'Zak' + 'Tiza' + 'niebie' + 'Andreas' + 'Samuel' + 'Mark P.' + 'oblo' + 'hdwow' + 'B-man' + 'Asbel' + 'Vlad' + 'Vaily' + 'krazy62' + 'JuSt'</td></tr>
-    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'Miel56' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'ael' + 'biotopa' + 'brynn' + 'IntKecsk' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'crypto_rsa' + 'Harry Lim' + 'AkRa' + 'Momcat' + 'NorthForty' + 'Mecki' + 'The red O' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'shoki' + 'jojo' + 'Klaus' + 'Valkyrie2' + 'MicWa' + 'AsuCaga' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'mecke' + 'Dvorhagen' + 'Holger' + 'Ingo_K' + 'Ant' + 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Liam Sheehan' + 'Michael' + 'Tarim' + 'Agnieszka'</td></tr>
+    <tr><td class="num">  1</td><td class="num">  1</td><td class="left">'alfred69' + 'Agares' + 'ntaeijr' + 'Tiger' + 'Zak' + 'Slav' + 'niebie' + 'Andreas' + 'Samuel' + 'Mark P.' + 'oblo' + 'hdwow' + 'B-man' + 'Asbel' + 'Vlad' + 'Vaily' + 'krazy62' + 'JuSt'</td></tr>
+    <tr><td class="num">  0</td><td class="num">  0</td><td class="left">'AQZ' + 'tasker' + 'Miel56' + 'Zhura' + 'Alf' + 'Turbogurk' + 'Gottseinsohn' + 'ael' + 'biotopa' + 'brynn' + 'IntKecsk' + 'Davacardo' + 'Adonica' + 'Joona' + 'Sandra' + 'schmusi20' + 'Kosby' + 'Magnus and Susi' + 'WP319' + 'Kevin' + 'xmouse' + 'erich' + 'Vinksu' + 'Uli' + 'Alex' + 'jdcampo' + 'Freshman' + 'Little_Mole' + 'Kroetchen' + 'crypto_rsa' + 'Harry Lim' + 'Sequoyah' + 'AkRa' + 'Momcat' + 'NorthForty' + 'Mecki' + 'The red O' + 'gringer' + 'Jeffrey S' + 'Nfol' + 'Marc-Hendrik' + 'shoki' + 'jojo' + 'rima' + 'Klaus' + 'Valkyrie2' + 'MicWa' + 'AsuCaga' + 'Rugby4ever' + 'Archcorenth' + 'Meeve' + 'mhatta' + 'Hans-HD' + 'mecke' + 'Dvorhagen' + 'Holger' + 'Ingo_K' + 'Ant' + 'Melanie' + 'IChrisI' + 'redsantz' + 'Markus' + 'Liam Sheehan' + 'Michael' + 'Tarim' + 'Agnieszka'</td></tr>
   </table>

Modified: homepage/input/userlist.html
===================================================================
--- homepage/input/userlist.html	2008-05-01 11:30:49 UTC (rev 1118)
+++ homepage/input/userlist.html	2008-05-01 18:13:35 UTC (rev 1119)
@@ -57,6 +57,7 @@
     <li>Gorn</li>
     <li>Gottseinsohn</li>
     <li>Great Scott</li>
+    <li>gringer</li>
     <li>Guglielmo</li>
     <li>Hans-HD</li>
     <li>Harry Lim</li>
@@ -81,6 +82,7 @@
     <li>Klaus</li>
     <li>Kosby</li>
     <li>krazy62</li>
+    <li>Kroetchen</li>
     <li>Liam Sheehan</li>
     <li>Little_Mole</li>
     <li>Ludmian</li>
@@ -104,6 +106,7 @@
     <li>Nat</li>
     <li>Neophilus</li>
     <li>Nfol</li>
+    <li>Nicol?s</li>
     <li>niebie</li>
     <li>NorthForty</li>
     <li>ntaeijr</li>
@@ -112,6 +115,7 @@
     <li>Ralf</li>
     <li>Raoul</li>
     <li>redsantz</li>
+    <li>rima</li>
     <li>Ronald</li>
     <li>Rugby4ever</li>
     <li>ryujun</li>
@@ -119,15 +123,18 @@
     <li>Samuel</li>
     <li>Sandra</li>
     <li>schmusi20</li>
+    <li>Sequoyah</li>
     <li>serpent</li>
     <li>ShadowPhrogg32642342</li>
     <li>shoki</li>
     <li>Sim_Ed</li>
     <li>Slav</li>
     <li>Snaily</li>
+    <li>Sopoforic</li>
     <li>Stephanie</li>
     <li>Stupid</li>
     <li>Tarim</li>
+    <li>tasker</li>
     <li>Taztunes</li>
     <li>The red O</li>
     <li>Thomas</li>
@@ -147,5 +154,6 @@
     <li>xmouse</li>
     <li>Zak</li>
     <li>Zekobah</li>
+    <li>Zhura</li>
   </ul>
 </div>



From ral at mail.berlios.de  Sat May  3 00:11:18 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 3 May 2008 00:11:18 +0200
Subject: [Enigma-game-svn] r1120 - in trunk: data data/schemas src src/stones
Message-ID: <200805022211.m42MBIm6016504@sheep.berlios.de>

Author: ral
Date: 2008-05-03 00:11:15 +0200 (Sat, 03 May 2008)
New Revision: 1120

Added:
   trunk/src/stones/LightPassengerStone.cc
   trunk/src/stones/LightPassengerStone.hh
Modified:
   trunk/data/api1init.lua
   trunk/data/schemas/objects.xml
   trunk/src/Makefile.am
   trunk/src/Object.cc
   trunk/src/Object.hh
   trunk/src/laser.cc
   trunk/src/laser.hh
   trunk/src/ox_magnum.cc
   trunk/src/stones.cc
   trunk/src/stones/BoulderStone.cc
   trunk/src/stones/BoulderStone.hh
   trunk/src/stones_complex.cc
   trunk/src/world.cc
   trunk/src/world.hh
   trunk/src/world_internal.hh
Log:
Trunk 1.1: reengineering new API lightpassenger
- renaming to st_lightpassenger with _on and _off variants
- attribute renaming to "friction" and "gradient"
- full state support for on/off
- new laser support instead of PhotoStone
- removed usage of delayed impulses
- full swap support
- BoulderStone fix: full swap support of enlighted boulders
- remove obsolete PhotoStone
- remove obsolete delayed impulses

Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/data/api1init.lua	2008-05-02 22:11:15 UTC (rev 1120)
@@ -115,6 +115,8 @@
     st_laser_n = "st-laser-n",
     st_laserswitch = "st-laserswitch",
     st_laserflop = "st-lasertimeswitch",
+    st_lightpassenger = "st-lightpassenger",
+    st_lightpassenger_off = "st-lightpassenger_off",
     st_monoflop = "st-timeswitch",
     st_oxyd = "st-oxyd",
     st_panel = "st-wood_001",
@@ -310,6 +312,12 @@
      if key == "value" then
          _key = "coin_value"
      end
+     if key == "friction_factor" then
+         _key = "friction"
+     end
+     if key == "gradient_factor" then
+         _key = "gradient"
+     end
      if key == "targetx" then
          local d = enigma._GetAttrib(obj, "destination")
          if (en.usertype(d) == "position") then
@@ -370,6 +378,12 @@
      if key == "value" then
          _key = "coin_value"
      end
+     if key == "friction_factor" then
+         _key = "friction"
+     end
+     if key == "gradient_factor" then
+         _key = "gradient"
+     end
      if key == "blackball" or key == "whiteball" then
          _key = "color"
      end
@@ -478,8 +492,8 @@
     ["st-stoneimpulse__trigger"] = "signal",
     ["st-stoneimpulse-hollow__trigger"] = "signal",
     ["st-stoneimpulse_movable__trigger"] = "signal",
-    ["st-lightpassenger__trigger"] = "toggle",
-    ["st-lightpassenger__onoff"] = "toggle",
+    st_lightpassenger__trigger = "toggle",
+    st_lightpassenger__onoff = "toggle",
     ["st-mirror__trigger"] = "turn",
     ["st-oxyd__trigger"] = "toggle",
     ["st-plain__trigger"] = "signal",

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/data/schemas/objects.xml	2008-05-02 22:11:15 UTC (rev 1120)
@@ -12,6 +12,8 @@
     <attr name="destination" type="tokens" default="nil" rw="rw"/>
     <attr name="faces" type="string" default="nil" rw="rw"/>
     <attr name="flavor" type="string" default="b" rw="rw"/>
+    <attr name="friction" type="double" default="nil" rw="rw"/>
+    <attr name="gradient" type="double" default="nil" rw="rw"/>
     <attr name="instant" type="bool" default="false" rw="rw"/>
     <attr name="interval" type="double" default="1" rw="rw"/>
     <attr name="interval_s" type="double" default="3" rw="rw"/>
@@ -352,6 +354,23 @@
       <msg name="on"/>
       <msg name="signal"/>
     </object>
+    <object name="st_lightpassenger">
+      <attr name="interval" default="0.05"/>
+      <attr name="friction"/>
+      <attr name="gradient"/>
+      <msg name="on"/>
+      <msg name="off"/>
+      <msg name="signal"/>
+      <msg name="_init"/>
+      <msg name="_model_reanimated"/>
+      <msg name="_trigger"/>
+    </object>
+    <object name="st_lightpassenger_on">
+      <attr name="state" value="1"/>
+    </object>
+    <object name="st_lightpassenger_off">
+      <attr name="state" value="0"/>
+    </object>
     <object name="st_laserswitch">
       <attr name="state" rw="r"/>
       <msg name="_init"/>

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/Makefile.am	2008-05-02 22:11:15 UTC (rev 1120)
@@ -217,6 +217,8 @@
 	stones/LaserStone.hh	\
 	stones/LaserSwitch.cc	\
 	stones/LaserSwitch.hh	\
+	stones/LightPassengerStone.cc	\
+	stones/LightPassengerStone.hh	\
 	stones/MonoFlopStone.cc	\
 	stones/MonoFlopStone.hh	\
 	stones/OxydStone.cc	\

Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/Object.cc	2008-05-02 22:11:15 UTC (rev 1120)
@@ -323,12 +323,6 @@
     /* Like variant above, but the _result_ of the impulse is delayed.
      */
     
-    void Object::send_impulse(const GridPos& dest, Direction dir, double delay)
-    {
-        if (Stone *st = GetStone(dest)) {
-            addDelayedImpulse(Impulse(this, dest, dir), delay, st);
-        }
-    }
     
     bool Object::getDestinationByIndex(int idx, ecl::V2 &dstpos) const {
         int i = 0;  // counter for destination candidates

Modified: trunk/src/Object.hh
===================================================================
--- trunk/src/Object.hh	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/Object.hh	2008-05-02 22:11:15 UTC (rev 1120)
@@ -106,7 +106,6 @@
         /* ---------- Helper routines ---------- */
 
         void send_impulse(const GridPos& dest, Direction dir);
-        void send_impulse(const GridPos& dest, Direction dir, double delay);
 
         /* ---------- Object interface ---------- */
         

Modified: trunk/src/laser.cc
===================================================================
--- trunk/src/laser.cc	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/laser.cc	2008-05-02 22:11:15 UTC (rev 1120)
@@ -96,35 +96,6 @@
 }
 
 
-/* -------------------- PhotoStone -------------------- */
-
-PhotoStone::PhotoStone(const char *kind) : Stone(kind) 
-{
-    illuminated = false;
-}
-
-PhotoStone::PhotoStone()
-{
-    illuminated = false;
-}
-
-void PhotoStone::on_recalc_start() 
-{}
-
-void PhotoStone::on_recalc_finish() 
-{ 
-    GridPos p = get_pos();
-    bool illu = (LightFrom(p, NORTH) || LightFrom(p, EAST)
-                 || LightFrom(p, WEST) || LightFrom(p, SOUTH));
-
-    if (illu != illuminated) {
-        if (illu) notify_laseron();
-        else      notify_laseroff();
-        illuminated = illu;
-    }
-}
-
-
 /* -------------------- LaserBeam -------------------- */
 
 // The implementation of laser beams is a little tricky because, in

Modified: trunk/src/laser.hh
===================================================================
--- trunk/src/laser.hh	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/laser.hh	2008-05-02 22:11:15 UTC (rev 1120)
@@ -64,37 +64,6 @@
         static std::vector<void*> instances;
     };
 
-/* -------------------- PhotoStone -------------------- */
-
-    /*! Most stones are indifferent to laser beams: They either block
-      the light completely or they let it pass, but they do not change
-      their internal state when they are hit by light.  Certain kinds
-      of stones need to be notified whenever the `light' goes on or off
-      -- these can be derived from this class.
-    
-      The most prominent example are Oxyd stones -- they open when
-      they are hit by a laser beam.  See the remarks at the beginning
-      of this file to understand why overriding `processLight' is not
-      sufficient for a proper implementation of Oxyd stones.
-    */
-
-    class PhotoStone : public Stone, public PhotoCell {
-    protected:
-        PhotoStone();
-        PhotoStone(const char *kind);
-
-    private:
-        bool illuminated;
-
-        // PhotoCell interface
-        void on_recalc_start();
-        void on_recalc_finish();
-
-        // PhotoStone interface
-        virtual void notify_laseron() = 0;
-        virtual void notify_laseroff() = 0;
-    };
-    
 /* -------------------- LaserBeam -------------------- */
 
     class LaserBeam : public Item {

Modified: trunk/src/ox_magnum.cc
===================================================================
--- trunk/src/ox_magnum.cc	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/ox_magnum.cc	2008-05-02 22:11:15 UTC (rev 1120)
@@ -289,7 +289,7 @@
     "st-stoneimpulse-hollow",   // OxydMagnum stone 0xa4
     UNUSED,                     // OxydMagnum stone 0xa5
     UNUSED,                     // OxydMagnum stone 0xa6
-    "st-lightpassenger",        // OxydMagnum stone 0xa7
+    "st_lightpassenger",        // OxydMagnum stone 0xa7
     UNUSED,                     // OxydMagnum stone 0xa8
     UNUSED,                     // OxydMagnum stone 0xa9
     // codes >= 0xaa are unused

Modified: trunk/src/stones/BoulderStone.cc
===================================================================
--- trunk/src/stones/BoulderStone.cc	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/stones/BoulderStone.cc	2008-05-02 22:11:15 UTC (rev 1120)
@@ -19,6 +19,7 @@
  */
 
 #include "stones/BoulderStone.hh"
+#include "laser.hh"
 #include "player.hh"
 #include "world.hh"
 //#include "main.hh"
@@ -63,10 +64,20 @@
     }
     
     void BoulderStone::on_creation(GridPos p) {
+        // just update light status, do not react for new stones
+        // swapped and moved once are handled by the on_move method
+        updateCurrentLightDirs();
         activatePhoto();
         Stone::on_creation(p);
     }
     
+    void BoulderStone::on_removal(GridPos p) {
+        // remember last enlightment for stone moves and swaps
+        objFlags &= ~OBJBIT_LIGHT;
+        objFlags |= (objFlags & OBJBIT_LIGHTNEWDIRS) << 24;
+        Stone::on_removal(p);
+    }
+
     void BoulderStone::init_model() {
         std::string mname  = "st-bolder" + to_suffix(getDir());
         if (state == FALLING)
@@ -131,6 +142,11 @@
     void BoulderStone::on_move() {
         state = ACTIVE;
         triggerObstacle(getDir(), true);
+        
+        objFlags &= ~OBJBIT_LIGHTNEWDIRS;
+        objFlags |= (objFlags & OBJBIT_LIGHT) >> 24;
+        RecalcLight();   // necessary for rotators swapped out of light
+        
         Stone::on_move();
     }
     

Modified: trunk/src/stones/BoulderStone.hh
===================================================================
--- trunk/src/stones/BoulderStone.hh	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/stones/BoulderStone.hh	2008-05-02 22:11:15 UTC (rev 1120)
@@ -40,6 +40,10 @@
             IDLE,       ///< already sent trigger w/o success
             FALLING     ///< falling into abyss
         };
+        
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_LIGHT     =  15<<24   ///< Light status kept for move, swap, pull operations 
+        };
     public:
         BoulderStone(Direction dir = NORTH);
         
@@ -53,6 +57,7 @@
 
         // GridObject interface
         virtual void on_creation(GridPos p);
+        virtual void on_removal(GridPos p);
         virtual void init_model();
         virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
         

Added: trunk/src/stones/LightPassengerStone.cc
===================================================================
--- trunk/src/stones/LightPassengerStone.cc	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/stones/LightPassengerStone.cc	2008-05-02 22:11:15 UTC (rev 1120)
@@ -0,0 +1,236 @@
+/*
+ * Copyright (C) 2006 Andreas Lochmann
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *  
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+
+#include "stones/LightPassengerStone.hh"
+#include "errors.hh"
+#include "laser.hh"
+#include "main.hh"
+#include "player.hh"
+
+#include <algorithm>
+
+namespace enigma {
+    LightPassengerStone::LightPassengerStone(bool isActive) : Stone () {
+        state =  isActive ? ON : OFF;
+    }
+
+    LightPassengerStone::~LightPassengerStone() {
+        GameTimer.remove_alarm (this);
+    }
+            
+    Value LightPassengerStone::message(const Message &m) {
+        if (m.message == "_trigger") {
+            setState(1 - state);
+            return Value();
+        } else if (m.message == "_model_reanimated") {
+            objFlags &= ~OBJBIT_SKATEDIR;  // NODIR
+            if (state != BREAK) {     // continue break animation
+                init_model();         // adjust possible changed model in other cases
+            }
+            return Value();            
+        } else if (m.message == "_init") {
+            if (objFlags & OBJBIT_LIGHTNEWDIRS)
+                lightDirChanged(NODIRBIT, (DirectionBits)(objFlags & OBJBIT_LIGHTNEWDIRS));
+            return Value();            
+        }
+        return Stone::message(m);
+    }
+    
+    int LightPassengerStone::externalState() const {
+        return state == OFF ? 0 : 1;
+    }
+    
+    void LightPassengerStone::setState(int extState) {
+        if (state == OFF && extState == 1) {
+            state = ON;
+            if (isDisplayable()) {
+                init_model();
+                if (objFlags & OBJBIT_LIGHTNEWDIRS)  // currently enlighted?
+                    GameTimer.set_alarm(this, calcInterval(), false);
+            }
+        } else if ((state == ON || state == BLINK) && state == 0) {
+            state = OFF;
+            objFlags &= ~OBJBIT_SKATEDIR;  // NODIR
+            if (isDisplayable())
+                init_model();
+        }
+    }
+
+    void LightPassengerStone::init_model() {
+        switch(state) {
+            case OFF:
+                set_anim("st-lightpassenger_off"); break;
+            case ON:
+                set_anim("st-lightpassenger"); break;
+            case BLINK:
+                set_anim("st-lightpassenger-blink"); break;
+            case BREAK:
+                bool NorthSouth = objFlags & (NORTHBIT | SOUTHBIT);
+                bool EastWest = objFlags & (WESTBIT | EASTBIT);
+                sound_event ("stonedestroy");
+                if (NorthSouth && !EastWest)
+                    set_anim("st-lightpassenger-break-v");
+                else if (!NorthSouth && EastWest)
+                    set_anim("st-lightpassenger-break-h");
+                else // and this even in case the laser recently disappeared
+                    set_anim("st-lightpassenger-break-hv");
+                break;
+        }
+    }
+    
+    void LightPassengerStone::on_creation(GridPos p) {
+        activatePhoto();
+        Stone::on_creation(p);
+    }
+    
+    void LightPassengerStone::on_removal(GridPos p) {
+        GameTimer.remove_alarm(this);
+        objFlags &= ~OBJBIT_BLOCKED;
+        if (state == BLINK)
+            state = ON;
+        Stone::on_removal(p);
+    }
+
+    void LightPassengerStone::lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs) {
+        if (state == OFF)
+           return;
+        
+        if (newDirs == 0) {
+            // all lights switched off
+            GameTimer.remove_alarm(this);
+            if(state == BLINK) {                
+                state = ON;
+                init_model();
+            }
+        } else if (oldDirs == 0) {
+            // enlighted
+            GameTimer.set_alarm(this, calcInterval(), false);
+        }
+    }
+
+    void LightPassengerStone::animcb() {
+        ASSERT(state == BREAK, XLevelRuntime,
+            "LightPassengerStone: animcb called with inconsistent state");
+        KillStone(get_pos());
+    }
+    
+    void LightPassengerStone::actor_hit(const StoneContact &sc) {
+        Actor *a = sc.actor;
+        if (a != NULL && state == BLINK && player::WieldedItemIs(a, "it_hammer")) {
+            state = BREAK;
+            init_model();
+        }
+    }
+
+    void LightPassengerStone::on_impulse(const Impulse& impulse) {
+        Actor *a = dynamic_cast<Actor*>(impulse.sender);
+        if (a == NULL && ((objFlags & OBJBIT_LIGHTNEWDIRS) == NODIRBIT || state == OFF))
+            move_stone(impulse.dir);
+    }
+    
+    void LightPassengerStone::alarm() {
+        Direction skateDir = (Direction)((int)((objFlags & OBJBIT_SKATEDIR) >> 24) - 1);
+        if ((objFlags & OBJBIT_LIGHTNEWDIRS) && (state == ON || state == BLINK)) {
+            GridPos p = get_pos();
+            int toSouth = (objFlags & NORTHBIT ? -1 : 0) + (objFlags & SOUTHBIT ? +1 : 0);
+            int toWest =  (objFlags & EASTBIT ? -1 : 0) + (objFlags & WESTBIT ? +1 : 0);
+            if (toSouth * toWest != 0) {
+                // Light is coming from two directions. Choose the one you are
+                // *not* coming from (thus changing beams), in doubt: random.
+                if (skateDir == NORTH || skateDir == SOUTH)
+                    toSouth = 0;
+                if (skateDir == EAST || skateDir == WEST)
+                    toWest = 0;
+                if (skateDir == NODIR) {
+                    toSouth = IntegerRand(0,1) ? 0 : toSouth;
+                    toWest = toSouth ? 0 : toWest;
+                }
+            }
+            skateDir = (toSouth == 1) ? SOUTH : (toSouth == -1) ? NORTH :
+                (toWest == 1) ? WEST : (toWest == -1) ? EAST : NODIR;
+            objFlags &= ~OBJBIT_SKATEDIR;
+            objFlags |= ((int)skateDir + 1 << 24); // store new dir
+            if (skateDir == NODIR && state != BLINK) {
+                // No direction but lighted? Seems to be lasers from
+                // two opposite directions. Be sure and then start blinking.
+                if (objFlags & OBJBIT_LIGHTNEWDIRS) {
+                    state = BLINK;
+                    init_model();
+                }
+            } else if (skateDir != NODIR) {
+                if (state == BLINK) {
+                    state = ON;
+                    init_model();
+                }
+                if (GetStone(move(p, skateDir))) {
+                    // Skipping each second turn makes the passenger stone seem
+                    // slower when pushing another stone. This looks more
+                    // natural. That's why impulse is delayed:
+                    if (objFlags & OBJBIT_BLOCKED) {
+                        send_impulse(move(p, skateDir), skateDir);
+                        objFlags &= ~OBJBIT_BLOCKED;
+                    } else
+                        objFlags |= OBJBIT_BLOCKED;
+                } else {
+                    objFlags &= ~OBJBIT_BLOCKED;
+                }
+                move_stone(skateDir);
+            }
+            GameTimer.set_alarm(this, calcInterval(), false);
+        }
+    }
+
+    double LightPassengerStone::calcInterval() {
+        /*  Interval is calculated from
+                    1 + friction_stone * friction_floor
+        interval = ------------------------------------ * baseinterval
+                    1 + gradient_stone * gradient_floor
+            and min-maxed to sensible values. "gradient" is just
+            the force resulting from floor->add_force. "baseinterval"
+            is 50 ms or the interval given in "interval".
+        */
+        double base = getAttr("interval");
+        if (Value f = getAttr("friction"))
+            base *= 1.0 + (double)f * GetFloor(get_pos())->get_friction();
+        if (Value g = getAttr("gradient")) {
+            Direction skateDir = (Direction)((int)((objFlags & OBJBIT_SKATEDIR) >> 24) - 1);
+            if (skateDir != NODIR) {
+                V2 vec = V2(0.0,0.0);
+                double quot = 0;
+                GetFloor(get_pos())->add_force(0, vec);
+                quot = skateDir == NORTH ? -vec[1] : skateDir == SOUTH ? vec[1] :
+                    skateDir == EAST ? vec[0] : skateDir == WEST ? -vec[0] : 0;
+                base /= std::max(1.0 + (double)g * quot, 0.01);                    
+            }
+        }
+        return std::max(base, 0.02);
+    }
+
+    
+    DEF_TRAITSM(LightPassengerStone,"st_lightpassenger", st_lightpassenger,
+                MOVABLE_IRREGULAR);
+    
+    BOOT_REGISTER_START
+        BootRegister(new LightPassengerStone(true), "st_lightpassenger");
+        BootRegister(new LightPassengerStone(true), "st_lightpassenger_on");
+        BootRegister(new LightPassengerStone(false), "st_lightpassenger_off");
+    BOOT_REGISTER_END
+
+} // namespace enigma


Property changes on: trunk/src/stones/LightPassengerStone.cc
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/src/stones/LightPassengerStone.hh
===================================================================
--- trunk/src/stones/LightPassengerStone.hh	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/stones/LightPassengerStone.hh	2008-05-02 22:11:15 UTC (rev 1120)
@@ -0,0 +1,80 @@
+/*
+ * Copyright (C) 2006 Andreas Lochmann
+ * Copyright (C) 2008 Ronald Lamprecht
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License along
+ * with this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+ *
+ */
+#ifndef LIGHTPASSENGERSTONE_HH
+#define LIGHTPASSENGERSTONE_HH
+
+#include "stones.hh"
+
+#include "stones_internal.hh"
+
+namespace enigma {
+
+    /** 
+     * 
+     */
+    class LightPassengerStone : public Stone, public TimeHandler {
+        CLONEOBJ(LightPassengerStone);
+        DECL_TRAITS;
+    private:
+        enum iState {
+            OFF,     ///< inactive, does not react on laser 
+            ON,      ///< active, does react on laser
+            BLINK,   ///< active, double lasered, ready to break
+            BREAK    ///< active, breaking and dissolving
+        };
+        
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_SKATEDIR =   7<<24,   ///< current skate direction
+            OBJBIT_BLOCKED  =   1<<27    ///< have been blocked by a stone on last move attempt 
+        };
+    public:
+        LightPassengerStone(bool isActive);
+        virtual ~LightPassengerStone();
+        
+        // Object interface
+        virtual Value message(const Message &m);
+        
+        // StateObject interface
+        virtual int externalState() const;
+        virtual void setState(int extState);
+
+        // GridObject interface
+        virtual void init_model();
+        virtual void on_creation(GridPos p);
+        virtual void on_removal(GridPos p);
+        virtual void lightDirChanged(DirectionBits oldDirs, DirectionBits newDirs);
+        
+        // ModelCallback interface
+        virtual void animcb();
+        
+        // Stone interface
+        virtual void actor_hit(const StoneContact &sc);
+        virtual void on_impulse(const Impulse& impulse);
+
+        // TimeHandler interface
+        virtual void alarm();
+        
+    private:
+        double calcInterval();
+    };
+
+} // namespace enigma
+
+#endif


Property changes on: trunk/src/stones/LightPassengerStone.hh
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/stones.cc	2008-05-02 22:11:15 UTC (rev 1120)
@@ -116,7 +116,7 @@
 : GridObject (kind), freeze_check_running (false)
 {}
 
-Stone::~Stone() { revokeDelayedImpulses(this); }
+Stone::~Stone() {  }
 
 const StoneTraits &Stone::get_traits() const
 {

Modified: trunk/src/stones_complex.cc
===================================================================
--- trunk/src/stones_complex.cc	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/stones_complex.cc	2008-05-02 22:11:15 UTC (rev 1120)
@@ -2607,199 +2607,6 @@
 }
 
 
-/* -------------------- Light Passenger Stone -------------------- */
-namespace
-{
-    class LightPassengerStone : public PhotoStone, public TimeHandler {
-        CLONEOBJ(LightPassengerStone);
-        DECL_TRAITS;
-    public:
-        LightPassengerStone(bool active_) : PhotoStone("st-lightpassenger"),
-            skateDir (NODIR), state(active_ ? ACTIVE : INACTIVE),
-            isLighted (false) { }
-
-    virtual ~LightPassengerStone() {
-        GameTimer.remove_alarm (this);
-    }
-
-    private:
-        Direction skateDir;
-        //bool isActive;
-        bool isLighted;
-        enum State {INACTIVE, ACTIVE, BLINK, BREAK} state;
-        //bool isBlinking;
-
-        void on_creation(GridPos p) {
-            PhotoStone::on_creation(p);
-            photo_activate();
-        }
-        void on_removal(GridPos p) {
-            photo_deactivate();
-            PhotoStone::on_removal(p);
-        }
-        void init_model() {
-            switch(state) {
-            case INACTIVE:
-                set_anim("st-lightpassenger_off"); break;
-            case ACTIVE:
-                set_anim("st-lightpassenger"); break;
-            case BLINK:
-                set_anim("st-lightpassenger-blink"); break;
-            case BREAK:
-                GridPos p = get_pos();
-                bool NorthSouth = LightFrom(p,NORTH) &&
-		    LightFrom(p,SOUTH);
-                bool EastWest = LightFrom(p,EAST) &&
-		    LightFrom(p,WEST);
-                sound_event ("stonedestroy");
-                if(NorthSouth && !EastWest)
-                    set_anim("st-lightpassenger-break-v");
-                else if(!NorthSouth && EastWest)
-                    set_anim("st-lightpassenger-break-h");
-                else // and this even in case the laser recently disappeared
-                    set_anim("st-lightpassenger-break-hv");
-                break;
-            }
-        }
-        void animcb() {
-            ASSERT(state == BREAK, XLevelRuntime,
-                "LightPassengerStone: animcb called with inconsistent state");
-            KillStone(get_pos());
-        }
-        void notify_laseroff() {
-            if (isLighted) GameTimer.remove_alarm(this);
-            isLighted = false;
-            if(state == BLINK) {                
-                state = ACTIVE;
-                init_model();
-            }
-        }
-        void notify_laseron() {
-            if (!isLighted) GameTimer.set_alarm(this, get_interval(), false);
-            isLighted = true;
-        }        
-
-        double get_interval() {
-            /*  Interval is calculated from
-                        1 + friction_factor * friction
-            interval = -------------------------------- * baseinterval
-                        1 + gradient_factor * gradient
-                and min-maxed to sensible values. "gradient" is just
-                the force resulting from floor->add_force. "baseinterval"
-                is 50 ms or the interval given in "interval".
-            */
-            double base = getDefaultedAttr("interval", 0.05);
-            if (Value f = getAttr("friction_factor"))
-                base *= 1.0 + (double)f * GetFloor(get_pos())->get_friction();
-            if (Value g = getAttr("gradient_factor"))
-                if (skateDir != NODIR) {
-                    V2 vec = V2(0.0,0.0);
-                    double quot = 0;
-                    GetFloor(get_pos())->add_force(0, vec);
-                    quot = skateDir == NORTH ? -vec[1] : skateDir == SOUTH ? vec[1] :
-                        skateDir == EAST ? vec[0] : skateDir == WEST ? -vec[0] : 0;
-                    base /= max(1.0 + (double)g * quot, 0.01);                    
-                }
-            return max(base, 0.02);
-        }
-
-        void set_on(bool newon){
-            if(state == INACTIVE && newon) {
-                state = ACTIVE;
-                init_model();
-                if(isLighted)
-                    GameTimer.set_alarm(this, get_interval(), false);
-            } else if((state == ACTIVE || state == BLINK) && !newon) {
-                state = INACTIVE;
-                init_model();
-                skateDir = NODIR;
-            }
-        }
-
-        virtual Value message (const Message &m) {
-            if (m.message == "toggle") {
-                set_on(state == INACTIVE);
-                return Value();
-            } else if (m.message == "signal") {
-                set_on(to_int(m.value) != 0);
-                return Value();
-            } else if (m.message == "on") {
-                set_on(true);
-                return Value();
-            } else if (m.message == "off") {
-                set_on(false);
-                return Value();
-            } else if (m.message == "_trigger") {
-                set_on(state == INACTIVE);
-                return Value();
-            }
-            return PhotoStone::message(m);
-        }
-
-        void alarm() {
-            if(isLighted && (state == ACTIVE || state == BLINK)) {
-                GridPos p = get_pos();
-                int toSouth =    (LightFrom(p,NORTH)?1:0)
-                               + (LightFrom(p,SOUTH)?-1:0);
-                int toWest =   (LightFrom(p,EAST)?1:0)
-                             + (LightFrom(p,WEST)?-1:0);
-                if(toSouth * toWest != 0) {
-                    // Light is coming from two directions. Choose the one you are
-                    // *not* coming from (thus changing beams), in doubt: random.
-                    if(skateDir == NORTH || skateDir == SOUTH)
-                        toSouth = 0;
-                    if(skateDir == EAST || skateDir == WEST)
-                        toWest = 0;
-                    if(skateDir == NODIR) {
-                        toSouth = IntegerRand(0,1) ? 0 : toSouth;
-                        toWest = toSouth ? 0 : toWest;
-                    }
-                }
-                skateDir = (toSouth == 1) ? SOUTH : (toSouth == -1) ? NORTH :
-                    (toWest == 1) ? WEST : (toWest == -1) ? EAST : NODIR;
-                if(skateDir == NODIR && state != BLINK) {
-                    // No direction but lighted? Seems to be lasers from
-                    // two opposite directions. Be sure and then start blinking.
-                    if(LightFrom(p,EAST) || LightFrom(p,WEST) ||
-                       LightFrom(p,NORTH) || LightFrom(p,SOUTH)) {
-                        state = BLINK;
-                        init_model();
-                    }
-                } else if(skateDir != NODIR) {
-                    if(state == BLINK) {
-                        state = ACTIVE;
-                        init_model();
-                    }
-                    if(GetStone(move(p, skateDir))) {
-                        // Skipping each second turn makes the passenger stone seem
-                        // slower when pushing another stone. This looks more
-                        // natural. That's why impulse is delayed:
-                        send_impulse(move(p, skateDir), skateDir, get_interval());
-                    }
-                    move_stone(skateDir);
-                }
-                GameTimer.set_alarm(this, get_interval(), false);
-            }
-        }
-        
-        void on_impulse(const Impulse &impulse) {
-            Actor *a = dynamic_cast<Actor*>(impulse.sender);
-            if(!a && (!isLighted || state == INACTIVE))
-                move_stone(impulse.dir);
-        }
-        void actor_hit(const StoneContact &sc) {
-            Actor *a = sc.actor;
-            if(a && state == BLINK && player::WieldedItemIs(a, "it_hammer")) {
-                state = BREAK;
-                init_model();
-            }
-        }
-    };
-    DEF_TRAITSM(LightPassengerStone,"st-lightpassenger", st_lightpassenger,
-                MOVABLE_IRREGULAR);
-}
-
-
 // --------------------------------------------------------------------------------
 
 void Init_complex()
@@ -2901,8 +2708,6 @@
     Register("st-chess_black", new ChessStone(0));
     Register("st-chess_white", new ChessStone(1));
 
-    Register("st-lightpassenger", new LightPassengerStone(true));
-    Register("st-lightpassenger_off", new LightPassengerStone(false));
 }
 
 } // namespace enigma

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/world.cc	2008-05-02 22:11:15 UTC (rev 1120)
@@ -447,7 +447,6 @@
     // dtime is always 0.01 (cf. server.cc)
 
     move_actors (dtime);
-    handle_delayed_impulses (dtime);
     tick_sound_dampings();
 
     // Tell floors and items about new stones.
@@ -1456,42 +1455,7 @@
     
 }
 
-void World::handle_delayed_impulses (double dtime)
-{
-    // Handle delayed impulses
-    ImpulseList::iterator i = delayed_impulses.begin(),
-        end = delayed_impulses.end();
-    while (i != end) {
-        // shall the impulse take effect now ?
-        if (i->tick(dtime)) {
-            i->mark_referenced(true);
-            if (Stone *st = GetStone(i->destination()))
-                i->send_impulse(st);  // may delete stones and revoke delayed impuleses!
-            i = delayed_impulses.erase(i);
-        }
-        else
-            ++i;
-    }
-}
 
-void World::revoke_delayed_impulses(const Stone *target) {
-    // Revokes delayed impulses to and from target
-    ImpulseList::iterator i = delayed_impulses.begin(),
-        end = delayed_impulses.end();
-    while (i != end) {
-        if (i->is_receiver(target) || i->is_sender(target)) {
-            if (i->is_referenced()) {
-                i->mark_obsolete();
-                ++i;
-            } else {
-                i = delayed_impulses.erase(i);
-            }
-        } else {
-            ++i;
-        }
-    }
-}
-
 void World::tick_sound_dampings ()
 {
     if(sound::IsSoundMute())
@@ -2287,22 +2251,7 @@
     
 }
 
-void addDelayedImpulse (const Impulse& impulse, double delay, 
-                               const Stone *estimated_receiver) 
-{
-    // @@@ FIXME: is a special handling necessary if several impulses hit same destination ?
 
-    level->delayed_impulses.push_back(DelayedImpulse(impulse, delay, estimated_receiver));
-}
-
-void revokeDelayedImpulses(const Stone *target) {
-    // Any stone may call this function on deletion.
-    // When the repository shuts down no world is existing thus check
-    // world first.
-    if (level.get() != NULL) 
-        level->revoke_delayed_impulses(target);
-}
-
 float getVolume(const char *name, Object *obj, float def_volume)
 {
     if((def_volume == 0.0) || sound::IsSoundMute())

Modified: trunk/src/world.hh
===================================================================
--- trunk/src/world.hh	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/world.hh	2008-05-02 22:11:15 UTC (rev 1120)
@@ -331,15 +331,7 @@
     Floor *GetFloor (GridPos p);
     void   KillFloor (GridPos p);
 
-/* -------------------- Impulses -------------------- */
 
-    void addDelayedImpulse(const Impulse& impulse, double delay,
-                           const Stone *estimated_receiver);
-
-    /*! Revoke all delayed impulses with TARGET as sender or receiver. */
-    void revokeDelayedImpulses(const Stone *target);
-
-
 /* -------------------- Explosions -------------------- */
 
     enum ExplosionType { 

Modified: trunk/src/world_internal.hh
===================================================================
--- trunk/src/world_internal.hh	2008-05-01 18:13:35 UTC (rev 1119)
+++ trunk/src/world_internal.hh	2008-05-02 22:11:15 UTC (rev 1120)
@@ -293,8 +293,6 @@
         void did_move_actor(Actor *a);
         void tick_actor(Actor *a, double dtime);
 
-        void revoke_delayed_impulses(const Stone *target);
-
     private:
 
         /* ---------- Private methods ---------- */
@@ -319,7 +317,6 @@
         void handle_actor_contacts ();
         void handle_actor_contact (Actor *actor1, Actor *actor2);
         void handle_stone_contacts(unsigned actoridx);
-        void handle_delayed_impulses (double dtime);
         void stone_change (GridPos p);
         void tick_sound_dampings ();
 
@@ -347,7 +344,6 @@
         //! True if game is not running yet
         bool                 preparing_level;
 
-        ImpulseList          delayed_impulses;
         vector<GridPos>      changed_stones;
 
         SoundDampingList     sound_dampings; // see SoundEffectManager for details



From ral at mail.berlios.de  Sun May  4 22:51:58 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 4 May 2008 22:51:58 +0200
Subject: [Enigma-game-svn] r1121 - in trunk: data data/gfx16 data/gfx32
	data/gfx40 data/gfx48 data/gfx64 src src/stones
Message-ID: <200805042051.m44Kpw2A030185@sheep.berlios.de>

Author: ral
Date: 2008-05-04 22:51:56 +0200 (Sun, 04 May 2008)
New Revision: 1121

Added:
   trunk/data/gfx16/sh_window.png
   trunk/data/gfx32/sh_window.png
   trunk/data/gfx40/sh_window.png
   trunk/data/gfx48/sh_window.png
   trunk/data/gfx64/sh_window.png
Removed:
   trunk/data/gfx32/sh-window-e.png
   trunk/data/gfx32/sh-window-n.png
   trunk/data/gfx32/sh-window-s.png
   trunk/data/gfx32/sh-window-w.png
   trunk/data/gfx40/sh-window-e.png
   trunk/data/gfx40/sh-window-n.png
   trunk/data/gfx40/sh-window-s.png
   trunk/data/gfx40/sh-window-w.png
   trunk/data/gfx48/sh-window-e.png
   trunk/data/gfx48/sh-window-n.png
   trunk/data/gfx48/sh-window-s.png
   trunk/data/gfx48/sh-window-w.png
Modified:
   trunk/data/models-2d.lua
   trunk/data/models-64.lua
   trunk/src/d_models.hh
   trunk/src/ox_oxyd1.cc
   trunk/src/stones/LightPassengerStone.cc
   trunk/src/stones/WindowStone.cc
Log:
Trunk 1.1: 
- fix moving Lightpassenger swap behaviour
- Window stone part I:
  - finish shadow
  - fix breaking animation and add shadow
  - fix DAT window
Note:
- new API window is not yet finished


Added: trunk/data/gfx16/sh_window.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx16/sh_window.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx32/sh-window-e.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/sh-window-n.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/sh-window-s.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/sh-window-w.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx32/sh_window.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/sh_window.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx40/sh-window-e.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/sh-window-n.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/sh-window-s.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/sh-window-w.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx40/sh_window.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/sh_window.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx48/sh-window-e.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/sh-window-n.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/sh-window-s.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/sh-window-w.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx48/sh_window.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/sh_window.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx64/sh_window.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx64/sh_window.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-05-02 22:11:15 UTC (rev 1120)
+++ trunk/data/models-2d.lua	2008-05-04 20:51:56 UTC (rev 1121)
@@ -1187,30 +1187,11 @@
 -- st-window --
 do
     local fg_window = DefSubimages("st-window", {modelname="fg-window",w=4,h=4})
+    local sh_window = DefSubimages("sh_window", {modelname="sh_window",w=4,h=4,imgw=ShadowSize,imgh=ShadowSize})
 
-    local shadowlist = {{}, -- undefined "windowless" window stone
-                        {"sh-window-w"},
-                        {"sh-window-s"},
-                        {"sh-window-s","sh-window-w"},
-                        {"sh-window-e"},
-                        {"sh-window-e","sh-window-w"},
-                        {"sh-window-e","sh-window-s"},
-                        {"sh-window-e","sh-window-s","sh-window-w"},
-                        {"sh-window-n"},
-                        {"sh-window-n","sh-window-w"},
-                        {"sh-window-n","sh-window-s"},
-                        {"sh-window-n","sh-window-s","sh-window-w"},
-                        {"sh-window-n","sh-window-e"},
-                        {"sh-window-n","sh-window-e","sh-window-w"},
-                        {"sh-window-n","sh-window-e","sh-window-s"},
-                        {"sh-window-n","sh-window-e","sh-window-s","sh-window-w"}
-                       }
-
-    for i = 2, 16 do
-        DefMultipleComposite("sh-window"..i, shadowlist[i])
-        DefShModel("st_window"..(16-i), "fg-window"..i, "sh-window"..i)
+    for i = 2, 16 do  -- faces + 1
+        DefShModel("st_window"..(16-i), "fg-window"..i, "sh_window"..i)
     end
-
     -- 4 sided window stone:
     DefAlias("st_window","st_window0")
 
@@ -1218,16 +1199,15 @@
     local breaking_window_names = {}
     local breaking_images = DefSubimages("st-window-break", {h=4})
 
-    for i=1, table.getn(fg_window) do
+    for i=1, table.getn(fg_window) do   -- faces + 1
         breaking_window_names[i] = {}
         for j = 1, table.getn(breaking_images) do
-            breaking_window_names[i][j] = "st-window"..i.."-"..j
+            breaking_window_names[i][j] = "st-window-breaking"..i.."-"..j
             display.DefineComposite(breaking_window_names[i][j], fg_window[i], breaking_images[j])
         end
         local frames = BuildFrames(breaking_window_names[i], 130)
-        -- TODO: finish anim names used:
-        DefAnim("st_window"..i.."_anim", frames)
-        DefAnim("st_window_anim", frames)
+        DefAnim("st_window"..(16-i).."_anim_fg", frames)
+        DefShModel("st_window"..(16-i).."_anim", "st_window"..(16-i).."_anim_fg", sh_window[i]);
     end
 end
 

Modified: trunk/data/models-64.lua
===================================================================
--- trunk/data/models-64.lua	2008-05-02 22:11:15 UTC (rev 1120)
+++ trunk/data/models-64.lua	2008-05-04 20:51:56 UTC (rev 1121)
@@ -1,6 +1,6 @@
 TileSize = 64
 SpriteSize = 80
-ShadowSize = 81
+ShadowSize = 82
 
 DefineFont ("timefont", "vera_sans.ttf", 40, "timefont", 180, 180, 180)
 DefineFont ("smallalternative", "DejaVuSansCondensed.ttf", 14, "menufont")

Modified: trunk/src/d_models.hh
===================================================================
--- trunk/src/d_models.hh	2008-05-02 22:11:15 UTC (rev 1120)
+++ trunk/src/d_models.hh	2008-05-04 20:51:56 UTC (rev 1121)
@@ -131,6 +131,7 @@
         }
         void draw_shadow(ecl::GC &gc, int x, int y) {
             bg->draw_shadow(gc,x,y);
+//            fg->draw_shadow(gc,x,y);
         }
         Model *clone() {
             return new CompositeModel(bg->clone(), fg->clone());

Modified: trunk/src/ox_oxyd1.cc
===================================================================
--- trunk/src/ox_oxyd1.cc	2008-05-02 22:11:15 UTC (rev 1120)
+++ trunk/src/ox_oxyd1.cc	2008-05-04 20:51:56 UTC (rev 1121)
@@ -214,7 +214,7 @@
     "st-oneway_white-e",        // Oxyd1 stone 0x3b
     "st-oneway_white-n",        // Oxyd1 stone 0x3c
     "st-oneway_white-s",        // Oxyd1 stone 0x3d
-    "st-window",                // Oxyd1 stone 0x3e
+    "st_window",                // Oxyd1 stone 0x3e
     "",                         // Oxyd1 stone 0x3f magic stone
     "",                         // Oxyd1 stone 0x40 magic stone
     "",                         // Oxyd1 stone 0x41 magic stone

Modified: trunk/src/stones/LightPassengerStone.cc
===================================================================
--- trunk/src/stones/LightPassengerStone.cc	2008-05-02 22:11:15 UTC (rev 1120)
+++ trunk/src/stones/LightPassengerStone.cc	2008-05-04 20:51:56 UTC (rev 1121)
@@ -23,6 +23,7 @@
 #include "laser.hh"
 #include "main.hh"
 #include "player.hh"
+#include "server.hh"
 
 #include <algorithm>
 
@@ -97,6 +98,8 @@
     
     void LightPassengerStone::on_creation(GridPos p) {
         activatePhoto();
+        if (updateCurrentLightDirs() != NODIRBIT)
+            GameTimer.set_alarm(this, calcInterval(), false);
         Stone::on_creation(p);
     }
     
@@ -141,7 +144,8 @@
 
     void LightPassengerStone::on_impulse(const Impulse& impulse) {
         Actor *a = dynamic_cast<Actor*>(impulse.sender);
-        if (a == NULL && ((objFlags & OBJBIT_LIGHTNEWDIRS) == NODIRBIT || state == OFF))
+        if (a == NULL && ((objFlags & OBJBIT_LIGHTNEWDIRS) == NODIRBIT || state == OFF 
+                || server::GameCompatibility != GAMET_ENIGMA))
             move_stone(impulse.dir);
     }
     
@@ -207,17 +211,19 @@
             is 50 ms or the interval given in "interval".
         */
         double base = getAttr("interval");
-        if (Value f = getAttr("friction"))
-            base *= 1.0 + (double)f * GetFloor(get_pos())->get_friction();
-        if (Value g = getAttr("gradient")) {
-            Direction skateDir = (Direction)((int)((objFlags & OBJBIT_SKATEDIR) >> 24) - 1);
-            if (skateDir != NODIR) {
-                V2 vec = V2(0.0,0.0);
-                double quot = 0;
-                GetFloor(get_pos())->add_force(0, vec);
-                quot = skateDir == NORTH ? -vec[1] : skateDir == SOUTH ? vec[1] :
-                    skateDir == EAST ? vec[0] : skateDir == WEST ? -vec[0] : 0;
-                base /= std::max(1.0 + (double)g * quot, 0.01);                    
+        if (Floor *floor = GetFloor(get_pos())) {
+            if (Value f = getAttr("friction"))
+                base *= 1.0 + (double)f * floor->get_friction();
+            if (Value g = getAttr("gradient")) {
+                Direction skateDir = (Direction)((int)((objFlags & OBJBIT_SKATEDIR) >> 24) - 1);
+                if (skateDir != NODIR) {
+                    V2 vec = V2(0.0,0.0);
+                    double quot = 0;
+                    floor->add_force(0, vec);
+                    quot = skateDir == NORTH ? -vec[1] : skateDir == SOUTH ? vec[1] :
+                        skateDir == EAST ? vec[0] : skateDir == WEST ? -vec[0] : 0;
+                    base /= std::max(1.0 + (double)g * quot, 0.01);                    
+                }
             }
         }
         return std::max(base, 0.02);

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-05-02 22:11:15 UTC (rev 1120)
+++ trunk/src/stones/WindowStone.cc	2008-05-04 20:51:56 UTC (rev 1121)
@@ -58,7 +58,7 @@
                 Object::setAttr("$connections", ALL_DIRECTIONS ^ remainigFaces);     // avoid init of model
                 sound_event ("shatter");
                 state = (remainigFaces == NODIRBIT) ? FINALBREAK : BREAK;
-                set_anim("st_window_anim");  // TODO anim with remaining unbroken faces
+                set_anim(ecl::strf("st_window%d_anim", getConnections()));
             }
             
             else if (player::WieldedItemIs (sc.actor, "it_wrench")) {



From andreasl at mail.berlios.de  Sun May  4 23:08:04 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Sun, 4 May 2008 23:08:04 +0200
Subject: [Enigma-game-svn] r1122 - trunk/data
Message-ID: <200805042108.m44L84tw031514@sheep.berlios.de>

Author: andreasl
Date: 2008-05-04 23:08:04 +0200 (Sun, 04 May 2008)
New Revision: 1122

Modified:
   trunk/data/models-2d.lua
Log:
Trunk:
 - Fix r1121: models-2d.lua can't load because of
   obsolete window shadows reference.


Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-05-04 20:51:56 UTC (rev 1121)
+++ trunk/data/models-2d.lua	2008-05-04 21:08:04 UTC (rev 1122)
@@ -656,11 +656,7 @@
     DefImage("sh-puzzle1")
     DefImage("sh-brake")
     DefImage("sh-floating")
-    -- Windows shadows:
-    DefImage("sh-window-n")
-    DefImage("sh-window-e")
-    DefImage("sh-window-s")
-    DefImage("sh-window-w")
+    -- Note: Window shadows are defined where needed.
 end
 
 -------------------



From ral at mail.berlios.de  Sun May  4 23:21:05 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 4 May 2008 23:21:05 +0200
Subject: [Enigma-game-svn] r1123 - team_levelpacks/team_test_new_api
Message-ID: <200805042121.m44LL4KC032378@sheep.berlios.de>

Author: ral
Date: 2008-05-04 23:21:04 +0200 (Sun, 04 May 2008)
New Revision: 1123

Added:
   team_levelpacks/team_test_new_api/ralT042_1.xml
Log:
Test Level new API:
- new test level for lightpassenger


Added: team_levelpacks/team_test_new_api/ralT042_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT042_1.xml	2008-05-04 21:08:04 UTC (rev 1122)
+++ team_levelpacks/team_test_new_api/ralT042_1.xml	2008-05-04 21:21:04 UTC (rev 1123)
@@ -0,0 +1,74 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Lightpassenger new API" el:subtitle="" el:id="20080502ral681"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 1100 $" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2007 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["."] = {"fl-ice"}
+
+ti["A"] = {"#ac-blackball"}
+
+ti["l"] = {"st_lightpassenger"}
+ti["L"] = {"st_lightpassenger", friction=1}
+ti["P"] = {"st_lightpassenger_off"}
+
+ti["N"] = {"st_laser_n", state=ON}
+ti["E"] = {"st_laser_e", state=ON}
+ti["S"] = {"st_laser_s", state=ON}
+ti["W"] = {"st_laser_w", state=ON}
+ti["t"] = {"st_switch", target="Laser", action="turn"}
+ti["b"] = {"st_switch", target="Laser", action="turnback"}
+
+ti["T"] = {"st-turnstile"}
+ti["e"] = {"st-turnstile-e"}
+
+ti["s"] = {"st-swap"}
+ti["i"] = {"st-stoneimpulse_movable"}
+ti["w"] = {"st-wood"}
+ti["h"] = {"it_hammer"}
+ti["m"] = {"it-magicwand"}
+
+ti["B"] = {"st_boulder_s"}
+
+
+w, h = wo(ti, " ", {
+"                    ",
+"            E   l  W",
+"                s   ",
+"E     w    lW       ",
+"    il              ",
+"          Ahm       ",
+" ww     S           ",
+"E        w          ",
+"E    w              ",
+"        Ls    EP    ",
+"  N                 ",
+"  .......W          ",
+" N             B    "
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT042_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native



From andreasl at mail.berlios.de  Mon May  5 00:45:13 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Mon, 5 May 2008 00:45:13 +0200
Subject: [Enigma-game-svn] r1124 - team_levelpacks/team_test_new_api
Message-ID: <200805042245.m44MjD9U032304@sheep.berlios.de>

Author: andreasl
Date: 2008-05-05 00:45:10 +0200 (Mon, 05 May 2008)
New Revision: 1124

Modified:
   team_levelpacks/team_test_new_api/ralT016_1.xml
   team_levelpacks/team_test_new_api/ralT042_1.xml
Log:
Test Level new API:
 - Renaming of st-lightpassenger -> st_lightpassenger
 - Added a section in Lightpassenger Test Level to
   test two lightpassengers in the same beam.


Modified: team_levelpacks/team_test_new_api/ralT016_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT016_1.xml	2008-05-04 21:21:04 UTC (rev 1123)
+++ team_levelpacks/team_test_new_api/ralT016_1.xml	2008-05-04 22:45:10 UTC (rev 1124)
@@ -24,7 +24,7 @@
 ti[" "] = {"fl-sahara"}
 ti["."] = {"fl-abyss"}
 ti["#"] = {"st-rock1"}
-ti["l"] = {"st-lightpassenger_off"}
+ti["l"] = {"st_lightpassenger_off"}
 ti["B"] = {"st_boulder_n"}
 ti["W"] = {"st-white1"}
 ti["P"] = {"st-plain"}

Modified: team_levelpacks/team_test_new_api/ralT042_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT042_1.xml	2008-05-04 21:21:04 UTC (rev 1123)
+++ team_levelpacks/team_test_new_api/ralT042_1.xml	2008-05-04 22:45:10 UTC (rev 1124)
@@ -60,7 +60,19 @@
 "        Ls    EP    ",
 "  N                 ",
 "  .......W          ",
-" N             B    "
+" N             B    ",
+"        w      w    ",
+"                    ",
+"                    ",
+"    w               ",
+"         S          ",
+"  Ew LL   ww        ",
+"                    ",
+"                    ",
+"                    ",
+" w         W        ",
+"    N               ",
+"                    "
 })
 
   ]]></el:luamain>



From andreasl at mail.berlios.de  Mon May  5 23:41:05 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Mon, 5 May 2008 23:41:05 +0200
Subject: [Enigma-game-svn] r1125 - in trunk/data/levels: enigma_iii
	enigma_iv enigma_oxydmagnum enigma_v enigma_vi enigma_vii
Message-ID: <200805052141.m45Lf5Nq020683@sheep.berlios.de>

Author: andreasl
Date: 2008-05-05 23:41:03 +0200 (Mon, 05 May 2008)
New Revision: 1125

Modified:
   trunk/data/levels/enigma_iii/illmind11_1.xml
   trunk/data/levels/enigma_iv/just04_1.xml
   trunk/data/levels/enigma_oxydmagnum/oxm82_1.xml
   trunk/data/levels/enigma_v/andreas25_2.xml
   trunk/data/levels/enigma_v/luc30_1.xml
   trunk/data/levels/enigma_vi/just09_1.xml
   trunk/data/levels/enigma_vi/just11_1.xml
   trunk/data/levels/enigma_vi/raoul30_2.xml
   trunk/data/levels/enigma_vii/just21_2.xml
Log:
Trunk: Second level screening for API.
 - Attribute cleanup of various levels.
Note:
 - I have problems to verify that just21_2 is
   working---Enigma somehow loads the level from
   another location or I'm missing something.


Modified: trunk/data/levels/enigma_iii/illmind11_1.xml
===================================================================
--- trunk/data/levels/enigma_iii/illmind11_1.xml	2008-05-04 22:45:10 UTC (rev 1124)
+++ trunk/data/levels/enigma_iii/illmind11_1.xml	2008-05-05 21:41:03 UTC (rev 1125)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Waterworld" el:subtitle="" el:id="illmind11"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
       <el:author  el:name="illmind" el:email="support at mag-heut.net" el:homepage="http://www.mag-heut.net/"/>
       <el:copyright>Copyright ? 2003 illmind</el:copyright>
       <el:license el:type="GPL version 2" el:open="true"/>
@@ -250,9 +250,9 @@
 draw_map(0,0,acmap,actors)
 SetAttrib(enigma.GetItem(26,17),"text","text1")
 SetAttrib(enigma.GetItem(27,6),"text","text2")
-SetAttrib(enigma.GetStone(31,4),"init",FALSE)
-SetAttrib(enigma.GetStone(31,5),"init",FALSE)
-SetAttrib(enigma.GetStone(31,6),"init",FALSE)
+--SetAttrib(enigma.GetStone(31,4),"init",FALSE)
+--SetAttrib(enigma.GetStone(31,5),"init",FALSE)
+--SetAttrib(enigma.GetStone(31,6),"init",FALSE)
 SetAttrib(enigma.GetItem(49,18),"text","text3")
 SetAttrib(enigma.GetItem(61,26),"invisible",FALSE)
 SetAttrib(enigma.GetItem(69,17),"text","text1")

Modified: trunk/data/levels/enigma_iv/just04_1.xml
===================================================================
--- trunk/data/levels/enigma_iv/just04_1.xml	2008-05-04 22:45:10 UTC (rev 1124)
+++ trunk/data/levels/enigma_iv/just04_1.xml	2008-05-05 21:41:03 UTC (rev 1125)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Laser Pushing" el:subtitle="" el:id="just04"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="JuSt" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? JuSt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -25,7 +25,7 @@
 fill_floor("fl-rough-blue")
 
 -- Item Layer
-set_item("it-vortex-open", 37, 1, {name="vortex16", targetx="11.5", targety="11.5", strength="1"})
+set_item("it-vortex-open", 37, 1, {name="vortex16", targetx="11.5", targety="11.5"})
 set_item("it-trigger", 23, 3, {action="openclose", target="door17", invisible=FALSE})
 set_item("it-trigger", 29, 5, {action="openclose", target="door18", invisible=FALSE})
 set_item("it-trigger", 22, 8, {action="openclose", target="door20", invisible=FALSE})

Modified: trunk/data/levels/enigma_oxydmagnum/oxm82_1.xml
===================================================================
--- trunk/data/levels/enigma_oxydmagnum/oxm82_1.xml	2008-05-04 22:45:10 UTC (rev 1124)
+++ trunk/data/levels/enigma_oxydmagnum/oxm82_1.xml	2008-05-05 21:41:03 UTC (rev 1125)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Puller Mailing" el:subtitle="Oxyd Magnum 82" el:id="magnum82"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="anonymous" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? anonymous</el:copyright>
       <el:license el:type="Donated to Enigma under the projects license" el:open="true"/>
@@ -130,22 +130,6 @@
 draw_map(0,0,stmap,stones)
 draw_map(0,0,itmap,items)
 draw_map(0,0,acmap,actors)
-SetAttrib(enigma.GetStone(3,4),"init",FALSE)
-SetAttrib(enigma.GetStone(3,8),"init",FALSE)
-SetAttrib(enigma.GetStone(5,4),"init",FALSE)
-SetAttrib(enigma.GetStone(5,8),"init",FALSE)
-SetAttrib(enigma.GetStone(7,4),"init",FALSE)
-SetAttrib(enigma.GetStone(7,8),"init",FALSE)
-SetAttrib(enigma.GetStone(9,4),"init",FALSE)
-SetAttrib(enigma.GetStone(9,8),"init",FALSE)
-SetAttrib(enigma.GetStone(11,4),"init",FALSE)
-SetAttrib(enigma.GetStone(11,8),"init",FALSE)
-SetAttrib(enigma.GetStone(13,4),"init",FALSE)
-SetAttrib(enigma.GetStone(13,8),"init",FALSE)
-SetAttrib(enigma.GetStone(15,4),"init",FALSE)
-SetAttrib(enigma.GetStone(15,8),"init",FALSE)
-SetAttrib(enigma.GetStone(17,4),"init",FALSE)
-SetAttrib(enigma.GetStone(17,8),"init",FALSE)
 SetAttrib(enigma.GetItem(18,7),"invisible",TRUE)
 Signal ("st(3 4)","st(4 4)")
 Signal ("st(5 4)","st(6 4)")

Modified: trunk/data/levels/enigma_v/andreas25_2.xml
===================================================================
--- trunk/data/levels/enigma_v/andreas25_2.xml	2008-05-04 22:45:10 UTC (rev 1124)
+++ trunk/data/levels/enigma_v/andreas25_2.xml	2008-05-05 21:41:03 UTC (rev 1125)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Acoustic Reminiscence" el:subtitle="" el:id="andreas25"/>
-      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
       <el:author  el:name="Andreas Lochmann" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2006 Andreas Lochmann</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -124,20 +124,20 @@
     error("(3) Unexpected probability: Assume to be extraordinarily happy to have found this!")
   else
     set_item("it-sensor", x, y, {name = "trigger"..tostring(counter-1),
-      action = "callback", target = "triggerfunc", mynumber = found, mystate = 1})
+      action = "callback", target = "triggerfunc", _mynumber = found, _mystate = 1})
     set_floor("fl-trigger", x, y)
   end
 end
 function triggerfunc(onoff, sender)
-  if enigma.GetAttrib(sender, "mystate") == 1 then
-    local mynumber = enigma.GetAttrib(sender, "mynumber")
+  if enigma.GetAttrib(sender, "_mystate") == 1 then
+    local mynumber = enigma.GetAttrib(sender, "_mynumber")
     local mysound = oxydsound[mynumber]
     if difficult then
       soundstring = soundstring..diffsound[mysound]
     else
       soundstring = soundstring..strsub(choosefrom,mysound,mysound)
     end
-    enigma.SetAttrib(sender, "mystate", 0)
+    enigma.SetAttrib(sender, "_mystate", 0)
     set_floor("fl-samba", enigma.GetPos(sender))
     if lasttriggered == -1 then
       lasttriggered = mynumber
@@ -149,7 +149,7 @@
         local sum = 0
         for j = 0, 17 do
           sum = sum + enigma.GetAttrib(enigma.GetNamedObject(
-                           "trigger"..tostring(j)), "mystate")
+                           "trigger"..tostring(j)), "_mystate")
         end
         if sum == 0 then
           for j = 0, 1 do
@@ -164,7 +164,7 @@
           if trig == nil then
             error("Um... shouldn't happen: trig == nil.")
           end        
-          SetAttrib(trig, "mystate", 1)
+          SetAttrib(trig, "_mystate", 1)
           set_floor("fl-trigger", enigma.GetPos(trig))
           lasttriggered = -1          
         end

Modified: trunk/data/levels/enigma_v/luc30_1.xml
===================================================================
--- trunk/data/levels/enigma_v/luc30_1.xml	2008-05-04 22:45:10 UTC (rev 1124)
+++ trunk/data/levels/enigma_v/luc30_1.xml	2008-05-05 21:41:03 UTC (rev 1125)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="The Carousel" el:subtitle="" el:id="luc30"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="Lukas Sch?ller" el:email="Lucky_Luc at web.de" el:homepage=""/>
       <el:copyright>Copyright ? 2006 Lukas Sch?ller</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -111,76 +111,6 @@
 draw_map(0,0,stmap,stones)
 draw_map(0,0,itmap,items)
 draw_map(0,0,acmap,actors)
-SetAttrib(enigma.GetStone(0,0),"init",FALSE)
-SetAttrib(enigma.GetStone(0,2),"init",FALSE)
-SetAttrib(enigma.GetStone(0,3),"init",FALSE)
-SetAttrib(enigma.GetStone(0,4),"init",FALSE)
-SetAttrib(enigma.GetStone(0,5),"init",FALSE)
-SetAttrib(enigma.GetStone(0,6),"init",FALSE)
-SetAttrib(enigma.GetStone(0,7),"init",FALSE)
-SetAttrib(enigma.GetStone(0,8),"init",FALSE)
-SetAttrib(enigma.GetStone(0,9),"init",FALSE)
-SetAttrib(enigma.GetStone(0,10),"init",FALSE)
-SetAttrib(enigma.GetStone(0,11),"init",FALSE)
-SetAttrib(enigma.GetStone(0,12),"init",FALSE)
-SetAttrib(enigma.GetStone(1,0),"init",FALSE)
-SetAttrib(enigma.GetStone(1,5),"init",FALSE)
-SetAttrib(enigma.GetStone(1,12),"init",FALSE)
-SetAttrib(enigma.GetStone(2,0),"init",FALSE)
-SetAttrib(enigma.GetStone(2,4),"init",FALSE)
-SetAttrib(enigma.GetStone(2,5),"init",FALSE)
-SetAttrib(enigma.GetStone(2,12),"init",FALSE)
-SetAttrib(enigma.GetStone(3,0),"init",FALSE)
-SetAttrib(enigma.GetStone(3,4),"init",FALSE)
-SetAttrib(enigma.GetStone(3,5),"init",FALSE)
-SetAttrib(enigma.GetStone(3,12),"init",FALSE)
-SetAttrib(enigma.GetStone(4,0),"init",FALSE)
-SetAttrib(enigma.GetStone(4,12),"init",FALSE)
-SetAttrib(enigma.GetStone(5,0),"init",FALSE)
-SetAttrib(enigma.GetStone(5,12),"init",FALSE)
-SetAttrib(enigma.GetStone(6,0),"init",FALSE)
-SetAttrib(enigma.GetStone(6,12),"init",FALSE)
-SetAttrib(enigma.GetStone(7,0),"init",FALSE)
-SetAttrib(enigma.GetStone(7,12),"init",FALSE)
-SetAttrib(enigma.GetStone(8,0),"init",FALSE)
-SetAttrib(enigma.GetStone(8,12),"init",FALSE)
-SetAttrib(enigma.GetStone(9,0),"init",FALSE)
-SetAttrib(enigma.GetStone(9,12),"init",FALSE)
-SetAttrib(enigma.GetStone(10,0),"init",FALSE)
-SetAttrib(enigma.GetStone(10,12),"init",FALSE)
-SetAttrib(enigma.GetStone(11,0),"init",FALSE)
-SetAttrib(enigma.GetStone(11,12),"init",FALSE)
-SetAttrib(enigma.GetStone(12,0),"init",FALSE)
-SetAttrib(enigma.GetStone(12,12),"init",FALSE)
-SetAttrib(enigma.GetStone(13,0),"init",FALSE)
-SetAttrib(enigma.GetStone(13,12),"init",FALSE)
-SetAttrib(enigma.GetStone(14,0),"init",FALSE)
-SetAttrib(enigma.GetStone(14,12),"init",FALSE)
-SetAttrib(enigma.GetStone(15,0),"init",FALSE)
-SetAttrib(enigma.GetStone(15,12),"init",FALSE)
-SetAttrib(enigma.GetStone(16,0),"init",FALSE)
-SetAttrib(enigma.GetStone(16,4),"init",FALSE)
-SetAttrib(enigma.GetStone(16,5),"init",FALSE)
-SetAttrib(enigma.GetStone(16,12),"init",FALSE)
-SetAttrib(enigma.GetStone(17,0),"init",FALSE)
-SetAttrib(enigma.GetStone(17,4),"init",FALSE)
-SetAttrib(enigma.GetStone(17,5),"init",FALSE)
-SetAttrib(enigma.GetStone(17,12),"init",FALSE)
-SetAttrib(enigma.GetStone(18,4),"init",FALSE)
-SetAttrib(enigma.GetStone(18,5),"init",FALSE)
-SetAttrib(enigma.GetStone(18,12),"init",FALSE)
-SetAttrib(enigma.GetStone(19,0),"init",FALSE)
-SetAttrib(enigma.GetStone(19,1),"init",FALSE)
-SetAttrib(enigma.GetStone(19,2),"init",FALSE)
-SetAttrib(enigma.GetStone(19,4),"init",FALSE)
-SetAttrib(enigma.GetStone(19,5),"init",FALSE)
-SetAttrib(enigma.GetStone(19,6),"init",FALSE)
-SetAttrib(enigma.GetStone(19,7),"init",FALSE)
-SetAttrib(enigma.GetStone(19,8),"init",FALSE)
-SetAttrib(enigma.GetStone(19,9),"init",FALSE)
-SetAttrib(enigma.GetStone(19,10),"init",FALSE)
-SetAttrib(enigma.GetStone(19,11),"init",FALSE)
-SetAttrib(enigma.GetStone(19,12),"init",FALSE)
 oxyd_shuffle()
     ]]></el:luamain>
     <el:i18n>

Modified: trunk/data/levels/enigma_vi/just09_1.xml
===================================================================
--- trunk/data/levels/enigma_vi/just09_1.xml	2008-05-04 22:45:10 UTC (rev 1124)
+++ trunk/data/levels/enigma_vi/just09_1.xml	2008-05-05 21:41:03 UTC (rev 1125)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Playing with Lasers" el:subtitle="" el:id="just09_1"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="JuSt" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2005 JuSt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -53,7 +53,7 @@
 
 set_stone("st-wood", 13, 5)
 
-set_stone("st-lightpassenger", 4, 8, {name="bolder3", direction=EAST})
+set_stone("st-lightpassenger", 4, 8, {name="bolder3"})
 
 set_stone("st-stoneimpulse_movable", 14, 5, {name="stoneimpulse16"})
 set_stone("st-stoneimpulse", 15, 5, {name="stoneimpulse15"})

Modified: trunk/data/levels/enigma_vi/just11_1.xml
===================================================================
--- trunk/data/levels/enigma_vi/just11_1.xml	2008-05-04 22:45:10 UTC (rev 1124)
+++ trunk/data/levels/enigma_vi/just11_1.xml	2008-05-05 21:41:03 UTC (rev 1125)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="The Passage" el:subtitle="" el:id="just11"/>
-      <el:version el:score="1" el:release="1" el:revision="6" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="7" el:status="released"/>
       <el:author  el:name="JuSt" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 JuSt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -59,7 +59,7 @@
 set_item("it-coin1", 17, 15)
 set_item("it-trigger", 1, 18, {action="openclose", target="vortex1", invisible=FALSE})
 set_item("it-trigger", 32, 11, {action="callback", target="bolder_run", invisible=TRUE})
-set_item("it-vortex-closed", 3, 19, {name="vortex1", targetx="2.5", targety="22.5", strength="0"})
+set_item("it-vortex-closed", 3, 19, {name="vortex1", targetx="2.5", targety="22.5"})
 set_item("it-coin1", 9, 21)
 set_item("it-cross", 2, 22)
 set_item("it-blocker", 26, 2)

Modified: trunk/data/levels/enigma_vi/raoul30_2.xml
===================================================================
--- trunk/data/levels/enigma_vi/raoul30_2.xml	2008-05-04 22:45:10 UTC (rev 1124)
+++ trunk/data/levels/enigma_vi/raoul30_2.xml	2008-05-05 21:41:03 UTC (rev 1125)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Industrial Puzzles" el:subtitle="" el:id="raoul30"/>
-      <el:version el:score="2" el:release="2" el:revision="5" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="6" el:status="released"/>
       <el:author  el:name="Raoul Bourquin" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Raoul Bourquin</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -84,7 +84,7 @@
         elseif c=="|" then
             set_stone("st-mirror-p|t",i-1, line)
         elseif c=="*" then
-            set_stone("st-oxyd",i-1, line,{flavour="c", color="1"})
+            set_stone("st-oxyd",i-1, line,{color="1"})
         elseif c=="K" then
             set_stone("st-key",i-1, line,{keycode="5", action="on", target="la_2"})
         elseif c=="k" then

Modified: trunk/data/levels/enigma_vii/just21_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/just21_2.xml	2008-05-04 22:45:10 UTC (rev 1124)
+++ trunk/data/levels/enigma_vii/just21_2.xml	2008-05-05 21:41:03 UTC (rev 1125)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Give more Way" el:subtitle="" el:id="just21"/>
-      <el:version el:score="2" el:release="2" el:revision="2" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="3" el:status="released"/>
       <el:author  el:name="JuSt" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 JuSt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -64,7 +64,7 @@
     set_stones("st-stone_break", {{8, 4}, {3, 7}, {13, 7}, {7, 9}})
 end
 set_stone("st-glass", 11, 9, {type="0"})
-set_stone("st-lightpassenger", 13, 11, {name="bolder4", direction=NORTH})
+set_stone("st-lightpassenger", 13, 11, {name="bolder4"})
 set_stones("st-laser", {{3, 12}, {13, 12}}, {dir=NORTH, on="1"})
 
 -- Actor Layer



From ral at mail.berlios.de  Mon May  5 23:52:15 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 5 May 2008 23:52:15 +0200
Subject: [Enigma-game-svn] r1126 - in trunk: data data/schemas src src/stones
Message-ID: <200805052152.m45LqFvl021890@sheep.berlios.de>

Author: ral
Date: 2008-05-05 23:52:14 +0200 (Mon, 05 May 2008)
New Revision: 1126

Modified:
   trunk/data/api1init.lua
   trunk/data/schemas/objects.xml
   trunk/src/items.cc
   trunk/src/stones/LightPassengerStone.cc
Log:
Trunk 1.1: 
- fix oxyd stone api1 trigger message mapping
- fix Lightpassenger stone pushing
- fix Vortex: allow exit if stone is not sticky instead of floating
- "movable" attribute readable for all stones.


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-05-05 21:41:03 UTC (rev 1125)
+++ trunk/data/api1init.lua	2008-05-05 21:52:14 UTC (rev 1126)
@@ -495,7 +495,7 @@
     st_lightpassenger__trigger = "toggle",
     st_lightpassenger__onoff = "toggle",
     ["st-mirror__trigger"] = "turn",
-    ["st-oxyd__trigger"] = "toggle",
+    st_oxyd__trigger = "open",
     ["st-plain__trigger"] = "signal",
     ["st-plain_hole__trigger"] = "signal",
     st_polarswitch__onoff = "toggle",

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-05-05 21:41:03 UTC (rev 1125)
+++ trunk/data/schemas/objects.xml	2008-05-05 21:52:14 UTC (rev 1126)
@@ -179,6 +179,9 @@
       <attr name="faces"/>
       <msg name="_model_reanimated"/>
     </object>
+    <object name="st" abstract="true">
+      <attr name="movable" rw="r"/>
+    </object>
     <object name="st_blocker">
       <attr name="autoclose"/>
       <msg name="close"/>
@@ -460,7 +463,7 @@
     </object>
     <object name="st_rotator">
       <attr name="counterclock"/>
-      <attr name="movable"/>
+      <attr name="movable" rw="rw"/>
     </object>
     <object name="st_rotator_cw">
       <attr name="state" value="0"/>

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-05-05 21:41:03 UTC (rev 1125)
+++ trunk/src/items.cc	2008-05-05 21:52:14 UTC (rev 1126)
@@ -2310,7 +2310,7 @@
             if (v) {                // Destination is also a vortex
                 Stone *st = GetStone(p_target);
     
-                if (st && !st->is_floating()) {
+                if (st && st->is_sticky(actor)) {
                     // is destination vortex blocked? redirect
                     setAttr("$dest_idx", dest_idx + 1);
                     client::Msg_Sparkle(v_target);

Modified: trunk/src/stones/LightPassengerStone.cc
===================================================================
--- trunk/src/stones/LightPassengerStone.cc	2008-05-05 21:41:03 UTC (rev 1125)
+++ trunk/src/stones/LightPassengerStone.cc	2008-05-05 21:52:14 UTC (rev 1126)
@@ -153,6 +153,10 @@
         Direction skateDir = (Direction)((int)((objFlags & OBJBIT_SKATEDIR) >> 24) - 1);
         if ((objFlags & OBJBIT_LIGHTNEWDIRS) && (state == ON || state == BLINK)) {
             GridPos p = get_pos();
+            if (objFlags & OBJBIT_BLOCKED) {
+                send_impulse(move(p, skateDir), skateDir);
+                objFlags &= ~OBJBIT_BLOCKED;
+            }
             int toSouth = (objFlags & NORTHBIT ? -1 : 0) + (objFlags & SOUTHBIT ? +1 : 0);
             int toWest =  (objFlags & EASTBIT ? -1 : 0) + (objFlags & WESTBIT ? +1 : 0);
             if (toSouth * toWest != 0) {
@@ -187,13 +191,7 @@
                     // Skipping each second turn makes the passenger stone seem
                     // slower when pushing another stone. This looks more
                     // natural. That's why impulse is delayed:
-                    if (objFlags & OBJBIT_BLOCKED) {
-                        send_impulse(move(p, skateDir), skateDir);
-                        objFlags &= ~OBJBIT_BLOCKED;
-                    } else
-                        objFlags |= OBJBIT_BLOCKED;
-                } else {
-                    objFlags &= ~OBJBIT_BLOCKED;
+                    objFlags |= OBJBIT_BLOCKED;
                 }
                 move_stone(skateDir);
             }



From ral at mail.berlios.de  Wed May  7 00:32:33 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 7 May 2008 00:32:33 +0200
Subject: [Enigma-game-svn] r1127 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 src/stones
Message-ID: <200805062232.m46MWXiR032638@sheep.berlios.de>

Author: ral
Date: 2008-05-07 00:32:23 +0200 (Wed, 07 May 2008)
New Revision: 1127

Added:
   trunk/data/gfx32/st_window_blue.png
   trunk/data/gfx32/st_window_blue_break.png
   trunk/data/gfx32/st_window_green.png
   trunk/data/gfx32/st_window_green_break.png
   trunk/data/gfx40/st_window_blue.png
   trunk/data/gfx40/st_window_blue_break.png
   trunk/data/gfx40/st_window_green.png
   trunk/data/gfx40/st_window_green_break.png
   trunk/data/gfx48/st_window_blue.png
   trunk/data/gfx48/st_window_blue_break.png
   trunk/data/gfx48/st_window_green.png
   trunk/data/gfx48/st_window_green_break.png
Removed:
   trunk/data/gfx32/st-window-break.png
   trunk/data/gfx32/st-window.png
   trunk/data/gfx40/st-window-break.png
   trunk/data/gfx40/st-window.png
   trunk/data/gfx48/st-window-break.png
   trunk/data/gfx48/st-window.png
Modified:
   trunk/data/models-2d.lua
   trunk/src/stones/WindowStone.cc
   trunk/src/stones/WindowStone.hh
Log:
Trunk 1.1: Window Stone
- new images for blue and green windows
- added "secure" attribute, secure windows are green
- kill items on break for OXYD1 compatibility
Note:
- secure and other window gaming features are not yet finished


Deleted: trunk/data/gfx32/st-window-break.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-window.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx32/st_window_blue.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st_window_blue.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx32/st_window_blue_break.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st_window_blue_break.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx32/st_window_green.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st_window_green.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx32/st_window_green_break.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st_window_green_break.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx40/st-window-break.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-window.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx40/st_window_blue.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st_window_blue.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st_window_blue_break.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st_window_blue_break.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st_window_green.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st_window_green.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx40/st_window_green_break.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st_window_green_break.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Deleted: trunk/data/gfx48/st-window-break.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-window.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx48/st_window_blue.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st_window_blue.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st_window_blue_break.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st_window_blue_break.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st_window_green.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st_window_green.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx48/st_window_green_break.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st_window_green_break.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-05-05 21:52:14 UTC (rev 1126)
+++ trunk/data/models-2d.lua	2008-05-06 22:32:23 UTC (rev 1127)
@@ -1182,28 +1182,39 @@
 
 -- st-window --
 do
-    local fg_window = DefSubimages("st-window", {modelname="fg-window",w=4,h=4})
-    local sh_window = DefSubimages("sh_window", {modelname="sh_window",w=4,h=4,imgw=ShadowSize,imgh=ShadowSize})
+    local fg_window_blue = DefSubimages("st_window_blue", {modelname="fg-window_blue",w=4,h=4})
+    local fg_window_green = DefSubimages("st_window_green", {modelname="fg-window_green",w=4,h=4})
+    local sh_window = DefSubimages("sh_window", {modelname="sh-window",w=4,h=4,imgw=ShadowSize,imgh=ShadowSize})
 
     for i = 2, 16 do  -- faces + 1
-        DefShModel("st_window"..(16-i), "fg-window"..i, "sh_window"..i)
+        DefShModel("st_window_blue"..(16-i), "fg-window_blue"..i, "sh-window"..i)
+        DefShModel("st_window_green"..(16-i), "fg-window_green"..i, "sh-window"..i)
     end
     -- 4 sided window stone:
-    DefAlias("st_window","st_window0")
+    DefAlias("st_window_blue","st_window_blue0")
+    DefAlias("st_window_green","st_window_green0")
 
     -- Breaking animimation:
-    local breaking_window_names = {}
-    local breaking_images = DefSubimages("st-window-break", {h=4})
+    local breaking_window_blue_names = {}
+    local breaking_window_green_names = {}
+    local breaking_images_blue = DefSubimages("st_window_blue_break", {h=4})
+    local breaking_images_green = DefSubimages("st_window_green_break", {h=4})
 
-    for i=1, table.getn(fg_window) do   -- faces + 1
-        breaking_window_names[i] = {}
-        for j = 1, table.getn(breaking_images) do
-            breaking_window_names[i][j] = "st-window-breaking"..i.."-"..j
-            display.DefineComposite(breaking_window_names[i][j], fg_window[i], breaking_images[j])
+    for i=1, table.getn(fg_window_blue) do   -- faces + 1
+        breaking_window_blue_names[i] = {}
+        breaking_window_green_names[i] = {}
+        for j = 1, table.getn(breaking_images_blue) do
+            breaking_window_blue_names[i][j] = "st-window_blue_breaking"..i.."-"..j
+            breaking_window_green_names[i][j] = "st-window_green_breaking"..i.."-"..j
+            display.DefineComposite(breaking_window_blue_names[i][j], fg_window_blue[i], breaking_images_blue[j])
+            display.DefineComposite(breaking_window_green_names[i][j], fg_window_green[i], breaking_images_green[j])
         end
-        local frames = BuildFrames(breaking_window_names[i], 130)
-        DefAnim("st_window"..(16-i).."_anim_fg", frames)
-        DefShModel("st_window"..(16-i).."_anim", "st_window"..(16-i).."_anim_fg", sh_window[i]);
+        local frames_blue = BuildFrames(breaking_window_blue_names[i], 130)
+        local frames_green = BuildFrames(breaking_window_green_names[i], 130)
+        DefAnim("st-window_blue"..(16-i).."_anim_fg", frames_blue)
+        DefAnim("st-window_green"..(16-i).."_anim_fg", frames_green)
+        DefShModel("st_window_blue"..(16-i).."_anim", "st-window_blue"..(16-i).."_anim_fg", sh_window[i]);
+        DefShModel("st_window_green"..(16-i).."_anim", "st-window_green"..(16-i).."_anim_fg", sh_window[i]);
     end
 end
 

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-05-05 21:52:14 UTC (rev 1126)
+++ trunk/src/stones/WindowStone.cc	2008-05-06 22:32:23 UTC (rev 1127)
@@ -19,15 +19,38 @@
  */
 
 #include "stones/WindowStone.hh"
-//#include "main.hh"
+#include "main.hh"
 #include "server.hh"
 #include "world.hh"
 
 namespace enigma {
-    WindowStone::WindowStone(std::string faces) : Stone(), breakingFaces(NODIRBIT) {
+    WindowStone::WindowStone(std::string faces) : Stone() {
         setAttr("faces", faces);
     }
     
+    void WindowStone::setAttr(const std::string &key, const Value &val) {
+        if (key == "secure") {
+            if (val.to_bool() != (objFlags & OBJBIT_SECURE)) {
+                if (val.to_bool()) {
+                    objFlags |= OBJBIT_SECURE;
+                } else {
+                    objFlags &= ~OBJBIT_SECURE;
+                }
+                if (isDisplayable())
+                    init_model();
+                return;
+            }
+        }
+        Stone::setAttr(key, val);
+    }
+    
+    Value WindowStone::getAttr(const std::string &key) const {
+        if (key == "secure") {
+            return (bool)(objFlags & OBJBIT_SECURE);
+        }
+        return Stone::getAttr(key);
+    }
+    
     Value WindowStone::message(const Message &m) {
         if (m.message == "inner_pull" ) {
             return Value(tryInnerPull(to_direction(m.value)));
@@ -35,6 +58,20 @@
         return Stone::message(m);
     }
     
+    int WindowStone::externalState() const {
+        return 0;
+    }
+    
+    void WindowStone::setState(int extState) {
+        // ignore any state access
+    }
+
+    void WindowStone::init_model() {
+        if (state == IDLE) {   // anims will not be cleared 
+            set_model(ecl::strf("st_window_%s%d", objFlags & OBJBIT_SECURE ? "green" : "blue" , getConnections()));
+        }
+    }
+
     void WindowStone::animcb() {
         if (state == FINALBREAK)
             KillStone(get_pos());
@@ -46,7 +83,6 @@
     
     void WindowStone::actor_hit(const StoneContact &sc) {
         Actor *a = sc.actor;
-        // TODO do we want to allow breaks while breaking?
         if (state == IDLE) {
             double impulse = -(a->get_vel() * sc.normal) * get_mass(a);
             if (impulse > 35) {
@@ -58,7 +94,9 @@
                 Object::setAttr("$connections", ALL_DIRECTIONS ^ remainigFaces);     // avoid init of model
                 sound_event ("shatter");
                 state = (remainigFaces == NODIRBIT) ? FINALBREAK : BREAK;
-                set_anim(ecl::strf("st_window%d_anim", getConnections()));
+                set_anim(ecl::strf("st_window_%s%d_anim",  objFlags & OBJBIT_SECURE ? "green" : "blue", getConnections()));
+                if (server::GameCompatibility == GAMET_OXYD1)
+                    KillItem(get_pos());
             }
             
             else if (player::WieldedItemIs (sc.actor, "it_wrench")) {

Modified: trunk/src/stones/WindowStone.hh
===================================================================
--- trunk/src/stones/WindowStone.hh	2008-05-05 21:52:14 UTC (rev 1126)
+++ trunk/src/stones/WindowStone.hh	2008-05-06 22:32:23 UTC (rev 1127)
@@ -30,11 +30,10 @@
 
 /* -------------------- Window -------------------- */
 
-/** \page st_window Breakable Stone
+/**  st_window Breakable Stone
 
 Hit this window heavily with your marble to blast it into smithereens.
 
-\image html st_window.png
 */
 
 namespace enigma {
@@ -44,27 +43,39 @@
         DECL_TRAITS;
     private:
         enum iState { IDLE, BREAK, FINALBREAK };
+
+        enum ObjectPrivatFlagsBits {
+            OBJBIT_SCRATCHDIRS  =   3<<24,   ///< faces that are scratched
+            OBJBIT_SECURE       =   1<<26    ///<  
+        };
         
     public:
         WindowStone(std::string faces);
         
         // Object interface
+        virtual void setAttr(const std::string &key, const Value &val);
+        virtual Value getAttr(const std::string &key) const;
         virtual Value message(const Message &m);
+        
+         // StateObject interface
+        virtual int externalState() const;
+        virtual void setState(int extState);
+       
+        // GridObject interface
+        virtual void init_model();
 
         // ModelCallback interface
-        void animcb();
+        virtual void animcb();
 
         // Stone interface
-        void actor_hit(const StoneContact &sc);
-        StoneResponse collision_response(const StoneContact &sc);
-        const char *collision_sound() {return "glass";}
-        bool is_transparent (Direction) const { return true; }
-        bool is_floating() const { return state != IDLE; }
+        virtual void actor_hit(const StoneContact &sc);
+        virtual StoneResponse collision_response(const StoneContact &sc);
+        virtual const char *collision_sound() {return "glass";}
+        virtual bool is_transparent (Direction) const { return true; }
+        virtual bool is_floating() const { return state != IDLE; }
         virtual bool is_sticky(const Actor *a) const;
 
-
     private:
-        DirectionBits breakingFaces;
         bool tryInnerPull(Direction dir);
     };
 



From andreasl at mail.berlios.de  Wed May  7 02:11:27 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Wed, 7 May 2008 02:11:27 +0200
Subject: [Enigma-game-svn] r1128 - in feature_branches/hp_lotm: images/lotm
	input/lotm
Message-ID: <200805070011.m470BRfT031246@sheep.berlios.de>

Author: andreasl
Date: 2008-05-07 02:11:14 +0200 (Wed, 07 May 2008)
New Revision: 1128

Added:
   feature_branches/hp_lotm/images/lotm/lotm_200805.png
   feature_branches/hp_lotm/images/lotm/lotm_200805_b.png
   feature_branches/hp_lotm/images/lotm/lotm_200805_c.png
   feature_branches/hp_lotm/images/lotm/lotm_200805_e.png
   feature_branches/hp_lotm/images/lotm/lotm_200805_h.png
   feature_branches/hp_lotm/images/lotm/lotm_200805_j.png
   feature_branches/hp_lotm/input/lotm/lotm_200805.html
Modified:
   feature_branches/hp_lotm/images/lotm/lotm-history.png
   feature_branches/hp_lotm/input/lotm/lotm_200804.html
   feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua
Log:
LotM Feature branch:
 - English LotM April 2008
Todo:
 - Proofread
 - German translation
 - Russian translation
 - Possibly a comment from Jacob


Modified: feature_branches/hp_lotm/images/lotm/lotm-history.png
===================================================================
(Binary files differ)

Added: feature_branches/hp_lotm/images/lotm/lotm_200805.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200805.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200805_b.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200805_b.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200805_c.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200805_c.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200805_e.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200805_e.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200805_h.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200805_h.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: feature_branches/hp_lotm/images/lotm/lotm_200805_j.png
===================================================================
(Binary files differ)


Property changes on: feature_branches/hp_lotm/images/lotm/lotm_200805_j.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: feature_branches/hp_lotm/input/lotm/lotm_200804.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200804.html	2008-05-06 22:32:23 UTC (rev 1127)
+++ feature_branches/hp_lotm/input/lotm/lotm_200804.html	2008-05-07 00:11:14 UTC (rev 1128)
@@ -18,7 +18,7 @@
 </p>
 
 <div class="lotmpic">
-<img src="$$imagedir$$/lotm/lotm_200804_a.png" alt="of the Month" border="0">
+<img src="$$imagedir$$/lotm/lotm_200804_a.png" alt="Level of the Month" border="0">
 <div class="imagetitle">Enigma VI # 77</div>
 </div>
 
@@ -332,6 +332,6 @@
 Many thanks to Ronald Lamprecht for this musical masterpiece.
 </p>
 
-<p><i>NObby</i><p>
+<p><i>NObby</i></p>
 
 </div>

Added: feature_branches/hp_lotm/input/lotm/lotm_200805.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805.html	2008-05-06 22:32:23 UTC (rev 1127)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805.html	2008-05-07 00:11:14 UTC (rev 1128)
@@ -0,0 +1,243 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">May 2008: </span>
+    &quot;Pleasure Garden&quot; by Jacob Scott
+  </h3>
+
+<p>I've got a bit of a conflicting relationship with &quot;Pleasure Garden&quot;: 
+If all's going well, it's a pleasure indeed to go for a stroll in 
+the garden, but if I have a bad day, it seems to me more like a 
+building site - just if it were still in the planning stage but not yet
+complete. What are the single components representing then - and where 
+have all the &quot;flowers&quot; gone?</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_c.png" alt="Level of the Month" border="0">
+<div class="imagetitle">Enigma VI # 95</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Some records of March 2008</caption>
+<colgroup>
+   <col width="80">
+   <col width="160">
+</colgroup>
+    <tr><td class="num">8:17</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">10:18</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">11:19</td>
+        <td class="left">Freshman</td></tr>
+    <tr><td class="num">11:57</td>
+        <td class="left">Alex</td></tr>
+    <tr><td class="num">12:03</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">12:13</td>
+        <td class="left">Malla</td></tr>
+    <tr><td class="num">12:46</td>
+        <td class="left">dev0</td></tr>
+    <tr><td class="num">13:03</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">13:09</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">13:22</td>
+        <td class="left">shoki</td></tr>
+    <tr><td class="num">13:30</td>
+        <td class="left">para_doks</td></tr>
+    <tr><td class="num">13:59</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">16:04</td>
+        <td class="left">Tobias</td></tr>
+    <tr><td class="num">16:59</td>
+        <td class="left">WP319</td></tr>
+    <tr><td class="num">17:08</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">19:50</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">21:29</td>
+        <td class="left">JuSt</td></tr>
+    <tr><td class="num">24:10</td>
+        <td class="left">Daisy</td></tr>
+    <tr><td class="num">41:43</td>
+        <td class="left">alfred69</td></tr>
+    <tr><td class="num">56:43</td>
+        <td class="left">mecke</td></tr>
+</table>
+
+<p>In the beginning a few planks, which are stored behind some 
+hoarding full of holes, have to be laid - to be able to place the 
+border for the &quot;small fountain&quot; in the lake. Until I found out how 
+it works. ... Must have accidentally banged my head with one of those 
+planks. ;-) Nevertheless, that's done. So off we go to the next part.</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_b.png" alt="Level of the month" border="0">
+<div class="imagetitle">The fountain in the lake.<br>Messed it up again!<br>Where's the gardener?!</div>
+</div>
+
+<p>What's going on? Toolshed, &quot;mission control&quot;, lots of trellis 
+and three unfinished &quot;large fountains&quot;, but only two borders. 
+Fortunately they're not overgrown with tendrils, otherwise 
+it would be impossible to get through to the toolshed or the 
+&quot;mission control&quot;. But before we get in there, we'll have to 
+take care of the &quot;fountains&quot;. So, now the toolshed's open.
+Oh boy, it's pretty dark inside this shack, too dark to see 
+where you're going. Ah! here's the tool, bag it, then off we go 
+next door to operate the switch, and now it's time to leave this 
+part of the garden behind.</p>
+
+<p>Now that we've got our tool, we can go on. We need it badly
+to uncover our path which &quot;kindly&quot; is surrounded by deep ditches. 
+In the following area of the garden we come across some labyrinth,
+which strangely enough is in good repair. At least it's granted 
+to us to have a look at some &quot;flowers&quot;. Then let's see what comes next.</p>
+
+<p>The two exits from this labyrinth lead to an area, where some
+roadworks are awaiting us. Blastings at various places have to be
+carried out. But before we start the fireworks, two planks need to be 
+laid across some pit. One of them's leaning against a wall, the other's 
+stored behind a fence. ... That's that!</p>
+
+<h4>&quot;I really get a lot of pleasure from solving such a fantastic
+level!&quot;</h4>
+
+<div class="quote">So I here I am to say something about &quot;Pleasure
+Garden&quot;. All right then. It's quite a while ago that I dealt with it. It
+was a fantastic level, that I can remember. As far as I know there had not been
+too much players which had solved the level at the time, when I was playing it.
+Had it not yet been discovered by others or had nobody dared to deal with it so
+far? Anyway, I tried, and once again I was thoroughly convinced that it can't be
+that difficult.</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_e.png" alt="Level of the Month" border="0">
+<div class="imagetitle">In the quarry - <br>Discovering the path</div>
+</div>
+
+<div class="quote">Moving blocks to the right place. Opening the door. Because
+of the breakable stones to the left: probably finding a hammer. Breaking the
+stones. Done. That's what I thought. Moving blocks somewhat worked, after a few
+tries I got it. Door opens. Hammer??</div>
+
+<div class="quote">Sure thing! Well embedded in a bunch of one-way-stones. And
+which of the blue lights is in charge? Believe me, you'll always choose the
+wrong one, guaranteed. The hammer-light's the other one. But never mind, it
+still works out well.</div>
+
+<div class="quote">So back again, knocking down stones. Lotsa stones. Did you
+unlock the door? Well done. Go on. A mini-labyrinth. Not much of a problem for
+experienced lab-runners.</div>
+
+<div class="quote">Oh dear. A minefield. The original Oxyd manual says: bombs
+can be ignited by pushing stones over them. Great. If I'll move one of the
+blocks within here, the whole room will blow up. I thought as much.</div>
+
+<div class="quote">But these accursed bombs won't work this way, neither in the
+lower area, which really is a pleasure, nor in the upper area where it would
+come in quite handy. But first of all you have your brains, and secondly there's
+a fuse. After replaying the level for another time I finally got the bomb
+thing.</div>
+
+<div class="quote">A boulder. Well, well! I got it moving and listened. Listened
+to the sound of decline of the garden's pleasures, so to say. Restart. This time
+I was faster. Light up all oxyds within reach, then hurry on. Mirrors. Great. I
+like mirror levels. Supposing I can take my time. Which wasn't true in this
+case. I believe I had to restart the level for at least another 5 times before I
+finally lit up the last oxyd. It was fantastic. And once again I was being asked
+if everything's alright with me. Why can't this man understand, that I really
+get a lot of pleasure from solving such a fantastic level?!</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_h.png" alt="Level of the Month" border="0">
+<div class="imagetitle">Industrial accident: <br>Hopefully the life insurance pays off!</div>
+</div>
+
+<div class="quote">By the way, I could achieve quite a decent score back then.
+This morning it took me even more time just to handle the blocks. After all it's
+all just a matter of practise.</div>
+
+<div class="author">Shoki</div>
+
+<p>We enter another part of the garden. What's that? Finally: behind 
+some mound we actually catch sight of our &quot;flowers&quot;, pleasantly 
+lined up. Unfortunately there's no direct approach.
+Before we can get out of here, several of these idle bulldozers  
+must be started and driven to their points of destination. 
+(Who finds it difficult to do so, might want to get some practise
+with &quot;Boulder-Puzzle&quot; (IV - #8) by the same author.) If you're 
+getting bulldozed, it actually isn't that dramatic, if you've acted
+foresighted in the previous area. If not, one more time it's time 
+for Shift-F3. (Who would think of something like this the first time?
+Not me.) Eventually we've got our little repairs done here too.</p>
+
+<p>Now we reach the last part of the labyrinth. The way, that leads
+to the &quot;flowers&quot;, seems to be obvious - too obvious? After a bit of
+wandering around we arrive at the last (Really the last? Somehow 
+I can't quite believe it.) obstacle: One of these bulldozers, 
+stopped by a stone, blocks our way. Behind it the first &quot;flowers&quot; and 
+a sign, that can't be deciphered from here. Well, let's get the 
+bulldozer going and roll away the stone. Wait a minute! Have a closer
+look to the right first. There's a whole company of bulldozers waiting
+for the order to go into action. Also there's a greenhouse light with a 
+switch nearby. What's going on?? It's not possible to get to the 
+other side and examine the region more closely. So let's see what 
+happens. ...</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_j.png" alt="Level of the Month" border="0">
+<div class="imagetitle">The giant clockwork - a detail</div>
+</div>
+
+<p>Let's start work and push the stone aside. All right, the way's
+cleared. Now we can read what's written on the sign: &quot;Quickly!&quot; Oh no!
+stress of examinations close to the ending. But now that we've finally
+reached our &quot;flowers&quot;, we won't be that badly off. That's what you
+think! Count the &quot;flowers&quot; first! Didn't you notice the small passage 
+to the right? And did you forget about the greenhouse light and these 
+duff bulldozers? &quot;:->&quot; or &quot;.'P&quot; or even &quot;-/-&quot;, I'm never feeling too 
+good from this point on.</p>
+
+<p>So quickly off into the greenhouse to adjust everything so that this
+&quot;flower&quot; is provided with light as well. By the way, why has it actually
+been blocked up in this way? Perhaps it's no &quot;flower&quot; at all, but some 
+kind of plant which the gardener has reserved for himself? No, of course
+not what you're thinking of! ... However, we've got no time for such 
+things. Let's quickly pick all of the &quot;flowers&quot; within reach. One 
+remains, but as I said before, the gardener will collect it, when it
+has received enough light.</p>
+
+<p>Actually the single tasks, you'll have to carry out in the 
+&quot;Pleasure Garden&quot;, aren't that difficult. But somehow the mass
+of problems is a problem. And the final countdown's really 
+pretty tough. I can't remember how often I messed things up in the
+greenhouse or picked the wrong &quot;flowers&quot; at the wrong time. Though I'm
+really not fond of levels which demand quickness (Sorry! Actually 
+I can't stand them), in my opinion the final part of &quot;Pleasure Garden&quot;
+in contrast to the other parts adds much to the pleasure of the level
+as a whole.</p>
+
+<p>Definitely &quot;Pleasure Garden&quot; has taken its seat high up in my 
+private Top 10. Many thanks to Jacob Scott for this terrific level.</p>
+
+<p><i>NObby</i></p>
+
+<p>Dear reader, we have a constant need for articles from you about Enigma's
+great levels. Please, send us any articles, even comments, you write to</p>
+<pre>
+<a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
+</pre>
+<p>We're particularly interested in articles about the following levels:
+</p>
+<ul>
+<li>&quot;Gods of Enigma II&quot; by moonpearl</li>
+<li>&quot;Industrial Puzzles&quot; by Raoul Bourquin</li>
+<li>&quot;Plan Ahead&quot; by Jacob Scott</li>
+<li>&quot;Block its way!&quot; by Jon 'WB' Sneyers</li>
+</ul>
+<p>Many thanks in advance, only your help can keep the LotM alive!</p>
+
+<p><i>Your Enigma Team</i></p>
+
+</div>

Modified: feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua	2008-05-06 22:32:23 UTC (rev 1127)
+++ feature_branches/hp_lotm/input/lotm/lotm_archive_data.lua	2008-05-07 00:11:14 UTC (rev 1128)
@@ -121,26 +121,36 @@
   position_num   = "6077"
 }
 
+lotm_archive_data[14] = {
+  date           = { month = 5, year = 2008 },
+  chronological  = 14,
+  name           = "Pleasure Garden",
+  author         = "Jacob Scott",
+  position       = "VI/95",
+  position_num   = "6095"
+}
+
 -- LotM variable data
 -- format: Level Title, current_rating, current_votes, additional text
 
-lotm_rating(    "Island Labyrinth",  9.20,  10,  "")
-lotm_rating(  "Pneumatic Delivery",  8.07,  14,  "")
+lotm_rating(    "Island Labyrinth",  9.27,  11,  "")
+lotm_rating(  "Pneumatic Delivery",  8.13,  15,  "")
 lotm_rating(    "The Aztec Temple",  9.00,  11,  "")
 lotm_rating("Labyrinth of Puzzles",  8.81,  16,  "")
-lotm_rating(           "Elaborate",  8.63,   8,  "")
-lotm_rating(             "Houdini",  9.18,  10,  "")
+lotm_rating(           "Elaborate",  8.44,   9,  "")
+lotm_rating(             "Houdini",  9.22,   7,  "")
 lotm_rating(           "Tool Time",  8.52,  21,  "")
 lotm_rating(         "Quadropolis",  9.20,  10,  "")
 lotm_rating(      "Big Adventures",  8.39,  23,  "")
-lotm_rating(      "Temple of Gold",  9.17,   6,  "")
+lotm_rating(      "Temple of Gold",  9.29,   7,  "")
 lotm_rating(      "Puzzle Puzzles",  8.83,   6,  "")
-lotm_rating(      "Psycho Pushing",  8.38,   8,  "")
-lotm_rating(  "Turnstiles for Two",  9.00,   5,  "<b>(newcomer)</b>")
+lotm_rating(      "Psycho Pushing",  8.20,  10,  "")
+lotm_rating(  "Turnstiles for Two",  9.00,   4,  "")
+lotm_rating(     "Pleasure Garden",  8.36,  14,  "<b>(newcomer)</b>")
 
 -- Don't forget to adjust the archive dates:
 
-lotm_archive_data_from = { month = 2, year = 2008 }
+lotm_archive_data_from = { month = 3, year = 2008 }
 
 lotm_current = lotm_archive_data[table.getn(lotm_archive_data)]
 



From ral at mail.berlios.de  Thu May  8 21:11:45 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 8 May 2008 21:11:45 +0200
Subject: [Enigma-game-svn] r1129 - team_levelpacks/team_test_new_api
Message-ID: <200805081911.m48JBjRp002917@sheep.berlios.de>

Author: ral
Date: 2008-05-08 21:11:45 +0200 (Thu, 08 May 2008)
New Revision: 1129

Modified:
   team_levelpacks/team_test_new_api/raoulT03_1.xml
Log:
Test Level new API:
- update test level for window stone


Modified: team_levelpacks/team_test_new_api/raoulT03_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-05-07 00:11:14 UTC (rev 1128)
+++ team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-05-08 19:11:45 UTC (rev 1129)
@@ -20,49 +20,78 @@
 ti[" "] = {"fl-sahara"}
 ti["."] = {"fl-space"}
 
-ti["0"] = ti[" "] .. {"#ac-blackball"}
+ti["0"] = {"#ac-blackball"}
+ti["'"] = {"#ac-whiteball"}
 
-ti["#"] = ti[" "] .. {"st-glass"}
-ti["+"] = ti[" "] .. {"st_window_nesw"}
-ti["a"] = ti[" "] .. {"st_window_nes"}
-ti["b"] = ti[" "] .. {"st_window_esw"}
-ti["c"] = ti[" "] .. {"st_window_nsw"}
-ti["d"] = ti[" "] .. {"st_window_new"}
-ti["A"] = ti[" "] .. {"st_window_n"}
-ti["B"] = ti[" "] .. {"st_window_e"}
-ti["C"] = ti[" "] .. {"st_window_s"}
-ti["D"] = ti[" "] .. {"st_window_w"}
-ti["1"] = ti[" "] .. {"st_window_sw"}
-ti["2"] = ti[" "] .. {"st_window_nw"}
-ti["3"] = ti[" "] .. {"st_window_ne"}
-ti["4"] = ti[" "] .. {"st_window_es"}
-ti["h"] = ti[" "] .. {"st_window_ns"}
-ti["v"] = ti[" "] .. {"st_window_ew"}
+ti["#"] = {"st-glass"}
+ti["+"] = {"st_window_nesw"}
+ti["-"] = {"st_window_nesw", secure=true}
+ti["a"] = {"st_window_nes"}
+ti["b"] = {"st_window_esw"}
+ti["c"] = {"st_window_nsw"}
+ti["d"] = {"st_window_new"}
+ti["e"] = {"st_window_new", secure=true}
+ti["A"] = {"st_window_n"}
+ti["B"] = {"st_window_e"}
+ti["C"] = {"st_window_s"}
+ti["D"] = {"st_window_w"}
+ti["1"] = {"st_window_sw"}
+ti["2"] = {"st_window_nw"}
+ti["3"] = {"st_window_ne"}
+ti["4"] = {"st_window_es"}
+ti["h"] = {"st_window_ns"}
+ti["H"] = {"st_window_ns", secure=true}
+ti["v"] = {"st_window_ew"}
 
 ti["V"] = ti["."] .. {"st_window", faces="we"}
 ti["*"] = ti["."] .. {"st_window", faces="esw"}
 
-ti["w"] = ti[" "] .. {"it_wrench"}
-ti["I"] = ti[" "] .. {"st-stoneimpulse"}
-ti["W"] = ti[" "] .. {"it-puller-w"}
-ti["E"] = ti[" "] .. {"it-puller-e"}
-ti["F"] = ti[" "] .. {"st_fourswitch", target="pullwindow", action="inner_pull"}
-ti["G"] = ti[" "] .. {"st_window", faces="ws", "pullwindow"}
+ti["w"] = {"it_wrench"}
+ti["i"] = {"it_hammer"}
+ti["r"] = {"it-ring"}
+ti["s"] = {"it-seed"}
+ti["k"] = {"it-coffee"}
+ti["K"] = {"it-cherry"}
+ti[":"] = {"it-dynamite"}
+ti["I"] = {"st-stoneimpulse"}
+ti["&"] = {"st-bombs"}
+ti["W"] = {"it-puller-w"}
+ti["E"] = {"it-puller-e"}
+ti["F"] = {"st_fourswitch", target="pullwindow", action="inner_pull"}
+ti["G"] = {"st_window", faces="ws", "pullwindow"}
+ti["L"] = {"st_laser_w", "laser"}
+ti["S"] = {"st_switch", target="laser"}
 
+
+ti["x"] = ti["C"] .. {"it_vortex", "vortexx", destination="vortexy"}
+ti["y"] = ti["4"] .. {"it_vortex", "vortexy", destination="vortexx"}
+
 w, h = wo(ti, " ", {
 "###23 232323##14####",
-"#  14  1414   23   #",
+"#  1y  1414   23   #",
 "#               BD #",
-"BAD B   a b c d BD #",
-" BCCB   a b c d BDv#",
+"BAD B   a b c e BD S",
+" BCCB   a b c e BDvL",
 "  B     a b c d   v#",
 "#               G v#",
 "# 2AAAA3 B + D FV v#",
 "#IDWE0wB B   D  V v#",
-"# 1CCCC4 B + D  V v#",
-"#I              V v#",
-"# hhhhhhhhhhhh  V  #",
-"################*###"
+"# 1CxCC4 B - D  V v#",
+"#I    KK        V v#",
+"# hhhhhhhhHHHH  V  #",
+"##########&### #*###",
+"#  sssssssssi    rk#",
+"#  :::::          k#",
+"#                ' #",
+"#  a     d     e   #",
+"#                  #",
+"#  a     b     -   #",
+"#                  #",
+"#  a     +     H   #",
+"#                  #",
+"#                  #",
+"#                  #",
+"####################"
 })
 
   ]]></el:luamain>



From ral at mail.berlios.de  Thu May  8 23:03:32 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 8 May 2008 23:03:32 +0200
Subject: [Enigma-game-svn] r1130 - in trunk: data/gfx32 data/gfx40
	data/gfx48 data/schemas src src/stones
Message-ID: <200805082103.m48L3WmG012990@sheep.berlios.de>

Author: ral
Date: 2008-05-08 23:03:31 +0200 (Thu, 08 May 2008)
New Revision: 1130

Modified:
   trunk/data/gfx32/sh_window.png
   trunk/data/gfx40/sh_window.png
   trunk/data/gfx48/st_window_blue.png
   trunk/data/gfx48/st_window_green.png
   trunk/data/schemas/objects.xml
   trunk/src/items.cc
   trunk/src/items.hh
   trunk/src/oxyd.cc
   trunk/src/stones/WindowStone.cc
   trunk/src/stones/WindowStone.hh
   trunk/src/world.cc
Log:
Trunk 1.1: Window Stone
- added object declarations
- invisible actors pass blue window but not green ones
- green windows unbreakable by actors
- moving window faces do move non static items on the grid position
- moving window faces do move actors on the grid position
- hit with ring scratches window faces
- break faces on direct adjacent bomb explosions if face is blue or 
  green and scratched (the only method to break secure window)
- break all faces on bomb explosion on window grid if face is blue or
  green and scratched
- lowered impuls to break blue window on scratches and wielded hammer
- add general stone "_explosion" message for grid of center of explosion
- fix some pixels on window graphics
- fix Sensor DAT inverse problems


Modified: trunk/data/gfx32/sh_window.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/sh_window.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/st_window_blue.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/st_window_green.png
===================================================================
(Binary files differ)

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-05-08 19:11:45 UTC (rev 1129)
+++ trunk/data/schemas/objects.xml	2008-05-08 21:03:31 UTC (rev 1130)
@@ -29,6 +29,7 @@
     <attr name="orientation" type="int" default="0" min="0" max="3" rw="rw"/>
     <attr name="oxydcolor" type="int" default="-1" min="-4" max="7" rw="rw"/>
     <attr name="range" type="double" default="1.0" rw="rw"/>
+    <attr name="secure" type="bool" default="false" rw="rw"/>
     <attr name="scissor" type="bool" default="true" rw="rw"/>
     <attr name="state" type="int" default="0" min="0" max="1" rw="rw"/>
     <attr name="static" type="bool" default="false" rw="rw"/>
@@ -493,5 +494,56 @@
       <msg name="off"/>
       <msg name="signal"/>
     </object>
+    <object name="st_window">
+      <attr name="faces" default="s"/>
+      <attr name="secure"/>
+      <msg name="inner_pull"/>
+      <msg name="_explosion"/>
+    </object>
+    <object name="st_window_w">
+      <attr name="faces" value="w"/>
+    </object>
+    <object name="st_window_s">
+      <attr name="faces" value="s"/>
+    </object>
+    <object name="st_window_sw">
+      <attr name="faces" value="sw"/>
+    </object>
+    <object name="st_window_e">
+      <attr name="faces" value="e"/>
+    </object>
+    <object name="st_window_ew">
+      <attr name="faces" value="ew"/>
+    </object>
+    <object name="st_window_es">
+      <attr name="faces" value="es"/>
+    </object>
+    <object name="st_window_esw">
+      <attr name="faces" value="esw"/>
+    </object>
+    <object name="st_window_n">
+      <attr name="faces" value="n"/>
+    </object>
+    <object name="st_window_nw">
+      <attr name="faces" value="nw"/>
+    </object>
+    <object name="st_window_ns">
+      <attr name="faces" value="ns"/>
+    </object>
+    <object name="st_window_nsw">
+      <attr name="faces" value="nsw"/>
+    </object>
+    <object name="st_window_ne">
+      <attr name="faces" value="ne"/>
+    </object>
+    <object name="st_window_new">
+      <attr name="faces" value="new"/>
+    </object>
+    <object name="st_window_nes">
+      <attr name="faces" value="nes"/>
+    </object>
+    <object name="st_window_nesw">
+      <attr name="faces" value="nesw"/>
+    </object>
   </zoo>
 </objects>

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-05-08 19:11:45 UTC (rev 1129)
+++ trunk/src/items.cc	2008-05-08 21:03:31 UTC (rev 1130)
@@ -163,6 +163,10 @@
     return ITEM_DROP;
 }
 
+bool Item::isStatic() const {
+    return get_traits().flags & itf_static;
+}
+
 void Item::add_force(Actor *, V2 &) {
 }
 
@@ -1628,6 +1632,10 @@
            SetStone (p, st);
            kill();
         }
+        
+        virtual bool isStatic() const {
+            return activep;  // active seed is static
+        }
 
         virtual const char* get_stone_name() = 0;
     public:
@@ -2490,6 +2498,11 @@
         Puller(Direction dir)
         : active(false), m_direction(dir)
 	{ }
+    
+        virtual bool isStatic() const {
+            return active;  // active puller is static
+        }
+        
     public:
         static void setup() {
             RegisterItem (new Puller(NORTH));
@@ -3154,9 +3167,11 @@
    activated only once. */
     class Sensor : public Item {
         CLONEOBJ(Sensor);
-        DECL_TRAITS;
+        DECL_TRAITS_ARRAY(2, traitsIdx());
     public:
-        Sensor() {}
+        static void setup();
+            
+        Sensor(bool inverse);
         
         // Object interface
         virtual Value message(const Message &m);
@@ -3169,8 +3184,20 @@
 
         // Item interface
         virtual void actor_enter(Actor *a);
+    
+    private:
+        int traitsIdx() const;
     };
     
+    void Sensor::setup() {
+        RegisterItem (new Sensor(false));
+        RegisterItem (new Sensor(true));
+    }
+    
+    Sensor::Sensor(bool inverse) {
+        Object::setAttr("inverse", inverse);
+    }
+    
     Value Sensor::message(const Message &m) {
         if (m.message == "_hit") {   // door knocking forward to black/whitballstone
             setAttr("$hitactor", m.value);
@@ -3200,7 +3227,14 @@
         performAction(true);
     }
     
-    DEF_TRAITSF(Sensor, "it_sensor", it_sensor, itf_static);
+    int Sensor::traitsIdx() const {
+        return getAttr("inverse").to_bool() ? 1 : 0;
+    }
+//    DEF_TRAITSF(Sensor, "it_sensor", it_sensor, itf_static);
+    ItemTraits Sensor::traits[2] = {
+        {"it_sensor",  it_sensor,  itf_static},
+        {"it_sensor",  it_inversesensor,  itf_static}
+    };
 
 /* -------------------- Signal filters -------------------- */
 namespace
@@ -3989,7 +4023,8 @@
     RegisterItem (new SeedWood);
     RegisterItem (new SeedNowood);
     RegisterItem (new SeedVolcano);
-    RegisterItem (new Sensor);
+//    RegisterItem (new Sensor);
+    Sensor::setup();
     ShogunDot::setup();
     SignalFilterItem::setup();
     RegisterItem (new Spade);

Modified: trunk/src/items.hh
===================================================================
--- trunk/src/items.hh	2008-05-08 19:11:45 UTC (rev 1129)
+++ trunk/src/items.hh	2008-05-08 21:03:31 UTC (rev 1130)
@@ -181,6 +181,8 @@
         virtual Item *clone() = 0;
 
         virtual const ItemTraits &get_traits() const = 0;
+        
+        virtual bool isStatic() const;
 
         /*! Return true if item completely covers the floor. In this
           case the Floor::actor_contact() will not be called

Modified: trunk/src/oxyd.cc
===================================================================
--- trunk/src/oxyd.cc	2008-05-08 19:11:45 UTC (rev 1129)
+++ trunk/src/oxyd.cc	2008-05-08 21:03:31 UTC (rev 1130)
@@ -407,12 +407,6 @@
         it->setAttr ("code", 3);
     }
     break;
-    case 0x2a:                  // sensor inverse
-    {
-        it = MakeItem(it_sensor);
-        it->setAttr("inverse", true);
-    }
-    break;
     default:
         {
             ItemID id = config.itemtable[type];

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-05-08 19:11:45 UTC (rev 1129)
+++ trunk/src/stones/WindowStone.cc	2008-05-08 21:03:31 UTC (rev 1130)
@@ -19,11 +19,15 @@
  */
 
 #include "stones/WindowStone.hh"
-#include "main.hh"
+#include "actors.hh"
+#include "items.hh"
+//#include "main.hh"
 #include "server.hh"
 #include "world.hh"
+#include <vector>
 
 namespace enigma {
+    
     WindowStone::WindowStone(std::string faces) : Stone() {
         setAttr("faces", faces);
     }
@@ -54,6 +58,24 @@
     Value WindowStone::message(const Message &m) {
         if (m.message == "inner_pull" ) {
             return Value(tryInnerPull(to_direction(m.value)));
+        } else if (m.message == "_explosion") {
+            GridPos expl = m.value;
+            DirectionBits faces = getFaces();
+            DirectionBits scratchDirs = (DirectionBits)((objFlags & OBJBIT_SCRATCHDIRS) >> 24);
+            if ((faces & WESTBIT) && ((move(get_pos(), WEST) == expl) || (get_pos() == expl)) 
+                    && (!(objFlags & OBJBIT_SECURE) || (scratchDirs & WESTBIT)))
+                breakFaces(WESTBIT);
+            if ((faces & SOUTHBIT) && ((move(get_pos(), SOUTH) == expl) || (get_pos() == expl))
+                    && (!(objFlags & OBJBIT_SECURE) || (scratchDirs & SOUTHBIT)))
+                breakFaces(SOUTHBIT);
+            if ((faces & EASTBIT) && ((move(get_pos(), EAST) == expl) || (get_pos() == expl))
+                    && (!(objFlags & OBJBIT_SECURE) || (scratchDirs & EASTBIT)))
+                breakFaces(EASTBIT);
+            if ((faces & NORTHBIT) && ((move(get_pos(), NORTH) == expl) || (get_pos() == expl))
+                    && (!(objFlags & OBJBIT_SECURE) || (scratchDirs & NORTHBIT)))
+                breakFaces(NORTHBIT);
+            
+            return Value();
         }
         return Stone::message(m);
     }
@@ -68,6 +90,10 @@
 
     void WindowStone::init_model() {
         if (state == IDLE) {   // anims will not be cleared 
+            if (getFaces() == NODIRBIT) {   // a tease of level author tried to set a faceless window!
+                KillStone(get_pos());
+                return;
+            }
             set_model(ecl::strf("st_window_%s%d", objFlags & OBJBIT_SECURE ? "green" : "blue" , getConnections()));
         }
     }
@@ -83,20 +109,21 @@
     
     void WindowStone::actor_hit(const StoneContact &sc) {
         Actor *a = sc.actor;
+        
         if (state == IDLE) {
             double impulse = -(a->get_vel() * sc.normal) * get_mass(a);
+            double threshold = 22;
+            if (player::WieldedItemIs (sc.actor, "it_hammer"))
+                threshold -= 7;
+            if (objFlags & (sc.faces << 24))  // face is scratched
+                threshold -= 10;
+            
             if (impulse > 35) {
                 SendMessage(a, "shatter");
             }
 
-            else if (impulse > 20) {
-                DirectionBits remainigFaces = (DirectionBits)(getFaces() & ~sc.faces);  // remove breaking face
-                Object::setAttr("$connections", ALL_DIRECTIONS ^ remainigFaces);     // avoid init of model
-                sound_event ("shatter");
-                state = (remainigFaces == NODIRBIT) ? FINALBREAK : BREAK;
-                set_anim(ecl::strf("st_window_%s%d_anim",  objFlags & OBJBIT_SECURE ? "green" : "blue", getConnections()));
-                if (server::GameCompatibility == GAMET_OXYD1)
-                    KillItem(get_pos());
+            else if (!(objFlags & OBJBIT_SECURE) && impulse > threshold) {
+                breakFaces(sc.faces);
             }
             
             else if (player::WieldedItemIs (sc.actor, "it_wrench")) {
@@ -109,6 +136,9 @@
                 } else if (sc.faces == NORTHBIT && sc.normal[1] < 0) {
                     tryInnerPull(SOUTH);
                 }
+            } else if (player::WieldedItemIs (sc.actor, "it-ring")) {
+                objFlags |= (sc.faces << 24);   // scratch face
+                sound_event("crack");
             }
         }
     }
@@ -119,6 +149,11 @@
     
     StoneResponse WindowStone::collision_response(const StoneContact &sc) {
         const double face_width = 3.0/32.0; 
+        
+        // blue windows let invisible actors pass
+        if (!(objFlags & OBJBIT_SECURE) && sc.actor->is_invisible()) 
+            return STONE_PASS;
+            
         DirectionBits faces = getFaces();
 
         if (((sc.contact_point[0] <= get_pos().x + face_width) && faces&WESTBIT) ||
@@ -131,6 +166,17 @@
         }
     }
     
+    void WindowStone::breakFaces(DirectionBits faces) {
+        DirectionBits remainigFaces = (DirectionBits)(getFaces() & ~faces);  // remove breaking face
+        objFlags &= ~(faces << 24);  // remove scratch mark from old position
+        Object::setAttr("$connections", ALL_DIRECTIONS ^ remainigFaces);     // avoid init of model
+        sound_event("shatter");
+        state = (remainigFaces == NODIRBIT) ? FINALBREAK : BREAK;
+        set_anim(ecl::strf("st_window_%s%d_anim",  objFlags & OBJBIT_SECURE ? "green" : "blue", getConnections()));
+        if (server::GameCompatibility == GAMET_OXYD1)
+            KillItem(get_pos());
+    }
+    
     bool WindowStone::tryInnerPull(Direction dir) {
         DirectionBits faces = getFaces();
         if (!has_dir(faces, dir) && has_dir(faces, reverse(dir))){
@@ -141,10 +187,37 @@
                         |to_bits(dir));  // move face
                 Object::setAttr("$connections", ALL_DIRECTIONS ^ remainigFaces);     // avoid init of model
                 init_model();
+                // transfer scratches
+                if (((objFlags & OBJBIT_SCRATCHDIRS) >> 24) & to_bits(reverse(dir)))
+                    objFlags |= ((to_bits(dir)) << 24);       // mark moved face as scratched
+                objFlags &= ~(to_bits(reverse(dir)) << 24);  // remove scratch mark from old position
+                
+                // move items
+                Item *it = GetItem(get_pos());
+                if (it != NULL && !it->isStatic())
+                    SetItem(move(get_pos(), dir), YieldItem(get_pos()));
+                
+                // move actors
+                std::vector<Actor*> found_actors;
+                const double range_one_field = 1.415; // approx. 1 field [ > sqrt(1+1) ]
+                GetActorsInRange(get_pos().center(), range_one_field, found_actors);
+                std::vector<Actor*>::iterator e = found_actors.end();
+                for (std::vector<Actor*>::iterator i = found_actors.begin(); i != e; ++i) {
+                    Actor   *actor     = *i;
+                    GridPos  actor_pos(actor->get_pos());
+                    if (actor_pos == get_pos()) { // if the actor is in the field
+                        V2 dest = actor->get_pos();
+                        // we do not have to worry about the level border as no face can be pushed to the border
+                        dest[0] += (dir == EAST) ? 1 : (dir == WEST) ? -1 : 0;
+                        dest[1] += (dir == SOUTH) ? 1 : (dir == NORTH) ? -1 : 0;
+                        WarpActor(actor, dest[0], dest[1], true);
+                    }
+                }
+                
                 return true;
             }
         }
-        return has_dir(faces, dir);
+        return false;
     }
     
     DEF_TRAITSM(WindowStone, "st_window", st_window, MOVABLE_BREAKABLE);

Modified: trunk/src/stones/WindowStone.hh
===================================================================
--- trunk/src/stones/WindowStone.hh	2008-05-08 19:11:45 UTC (rev 1129)
+++ trunk/src/stones/WindowStone.hh	2008-05-08 21:03:31 UTC (rev 1130)
@@ -45,8 +45,8 @@
         enum iState { IDLE, BREAK, FINALBREAK };
 
         enum ObjectPrivatFlagsBits {
-            OBJBIT_SCRATCHDIRS  =   3<<24,   ///< faces that are scratched
-            OBJBIT_SECURE       =   1<<26    ///<  
+            OBJBIT_SCRATCHDIRS  =   ALL_DIRECTIONS<<24,   ///< faces that are scratched
+            OBJBIT_SECURE       =   1<<29    ///<  
         };
         
     public:
@@ -76,6 +76,7 @@
         virtual bool is_sticky(const Actor *a) const;
 
     private:
+        void breakFaces(DirectionBits faces);
         bool tryInnerPull(Direction dir);
     };
 

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-05-08 19:11:45 UTC (rev 1129)
+++ trunk/src/world.cc	2008-05-08 21:03:31 UTC (rev 1130)
@@ -1914,69 +1914,71 @@
 
 namespace
 {
-    void explosion (GridPos p, ItemID explosion_item)
+    void explosion(GridPos source, GridPos dest, ItemID explosion_item)
     {
-        if (Stone *stone = GetStone(p))
-            SendMessage(stone, "_explosion");
-        if (Item  *item  = GetItem(p)) {
+        if (Stone *stone = GetStone(dest))
+            SendMessage(stone, "_explosion", source);
+        if (source == dest)  // item and floor handling on explosion center is specific
+            return;
+        if (Item  *item  = GetItem(dest)) {
             if (has_flags(item, itf_indestructible))
-                SendMessage(item, "_explosion");
+                SendMessage(item, "_explosion", source);
             else
-                SetItem(p, explosion_item);
+                SetItem(dest, explosion_item);
         }
         else
-            SetItem(p, explosion_item);
-        if (Floor *floor = GetFloor(p))
+            SetItem(dest, explosion_item);
+        if (Floor *floor = GetFloor(dest))
             SendMessage(floor, "_explosion");
     }
 }
 
 void SendExplosionEffect(GridPos center, ExplosionType type) 
 {
-    const int AFFECTED_FIELDS       = 8;
+    const int AFFECTED_FIELDS       = 9;
 
     for (int a = 0; a<AFFECTED_FIELDS; ++a) {
-        GridPos  dest            = get_neighbour (center, a+1);
-        Item    *item            = GetItem (dest);
-        Stone   *stone           = GetStone (dest);
-        Floor   *floor           = GetFloor (dest);
-        bool     direct_neighbor = a<4;
+        GridPos  dest            = get_neighbour(center, a);
+        Item    *item            = GetItem(dest);
+        Stone   *stone           = GetStone(dest);
+        Floor   *floor           = GetFloor(dest);
+        bool     direct_neighbor = a<=4;
 
         switch (type) {
-        case EXPLOSION_DYNAMITE:
-            if (stone) SendMessage(stone, "ignite");
-            if (item) SendMessage(item, "ignite");
-            if (floor) SendMessage(floor, "ignite");
-            break;
-
-        case EXPLOSION_BLACKBOMB:
-            if (direct_neighbor) {
-                explosion (dest, it_explosion1);
-            } else {
-                // Note: should not ignite in non-enigma-mode!
+            case EXPLOSION_DYNAMITE:
                 if (stone) SendMessage(stone, "ignite");
-                if (item) SendMessage(item, "ignite");
+                if (item)  SendMessage(item, "ignite");
                 if (floor) SendMessage(floor, "ignite");
-            }
-            break;
+                break;
 
-        case EXPLOSION_WHITEBOMB:
-            // Note: at least in oxyd1 only direct neighbors
-            // explode, and the others not even ignite
-            explosion (dest, it_explosion3);            
-            break;
-
-        case EXPLOSION_BOMBSTONE:
-            if (direct_neighbor) {
-                if (stone) SendMessage(stone, "_bombstone");
-                if (item) SendMessage(item, "_bombstone");
-                if (floor) SendMessage(floor, "_bombstone");
-            }
-            break;
-
-        case EXPLOSION_SPITTER:
-            // TODO: spitter explosions
-            break;
+            case EXPLOSION_BLACKBOMB:
+                if (direct_neighbor) {
+                    explosion(center, dest, it_explosion1);
+                } else {
+                    // Note: should not ignite in non-enigma-mode!
+                    if (stone) SendMessage(stone, "ignite");
+                    if (item)  SendMessage(item, "ignite");
+                    if (floor) SendMessage(floor, "ignite");
+                }
+                break;
+    
+            case EXPLOSION_WHITEBOMB:
+                // Note: at least in oxyd1 only direct neighbors
+                // explode, and the others not even ignite
+                explosion(center, dest, it_explosion3);            
+                break;
+    
+            case EXPLOSION_BOMBSTONE:
+                if (direct_neighbor) {
+                    if (stone) SendMessage(stone, "_bombstone");
+                    if (item) SendMessage(item, "_bombstone");
+                    if (floor) SendMessage(floor, "_bombstone");
+                }
+                break;
+    
+            case EXPLOSION_SPITTER:
+                // TODO: spitter explosions
+                break;
         }
     }
 }



From ged at mail.berlios.de  Fri May  9 13:57:40 2008
From: ged at mail.berlios.de (ged at mail.berlios.de)
Date: Fri, 9 May 2008 13:57:40 +0200
Subject: [Enigma-game-svn] r1131 - feature_branches/hp_lotm/input/lotm
Message-ID: <200805091157.m49BvedV021165@sheep.berlios.de>

Author: ged
Date: 2008-05-09 13:57:38 +0200 (Fri, 09 May 2008)
New Revision: 1131

Added:
   feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html
Log:
Homepage:

- Russian translation of May 2008 LotM

Added: feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html	2008-05-08 21:03:31 UTC (rev 1130)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html	2008-05-09 11:57:38 UTC (rev 1131)
@@ -0,0 +1,229 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">??? 2008: </span>
+    &quot;Pleasure Garden&quot; ?? Jacob Scott
+  </h3>
+
+<p>? ???? ????????? ?????????????? ??????????? ? &quot;Pleasure Garden&quot;: 
+???? ??? ???????????? ??????, ?? ???????? ?? ???? ??????????? ????????? ?????????????,
+?? ???? ???? ?? ?????????, ??? ?? ?????? ???????? ?? ???? ???????????? ???????? ??
+????????? ?????, ????? ??? ??? ?? ?????????. ??? ???????? ?????????????? ????? ?????????
+?????????? ? ???? ?????????? ??? &quot;?????&quot;?</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_c.png" alt="Level of the Month" border="0">
+<div class="imagetitle">Enigma VI # 95</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">????????? ???????? ????? 2008</caption>
+<colgroup>
+   <col width="80">
+   <col width="160">
+</colgroup>
+    <tr><td class="num">8:17</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">10:18</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">11:19</td>
+        <td class="left">Freshman</td></tr>
+    <tr><td class="num">11:57</td>
+        <td class="left">Alex</td></tr>
+    <tr><td class="num">12:03</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">12:13</td>
+        <td class="left">Malla</td></tr>
+    <tr><td class="num">12:46</td>
+        <td class="left">dev0</td></tr>
+    <tr><td class="num">13:03</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">13:09</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">13:22</td>
+        <td class="left">shoki</td></tr>
+    <tr><td class="num">13:30</td>
+        <td class="left">para_doks</td></tr>
+    <tr><td class="num">13:59</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">16:04</td>
+        <td class="left">Tobias</td></tr>
+    <tr><td class="num">16:59</td>
+        <td class="left">WP319</td></tr>
+    <tr><td class="num">17:08</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">19:50</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">21:29</td>
+        <td class="left">JuSt</td></tr>
+    <tr><td class="num">24:10</td>
+        <td class="left">Daisy</td></tr>
+    <tr><td class="num">41:43</td>
+        <td class="left">alfred69</td></tr>
+    <tr><td class="num">56:43</td>
+        <td class="left">mecke</td></tr>
+</table>
+
+<p>? ??????, ??? ????, ????? ?????????? ? ????? &quot;????????? ??????&quot;,
+?????????? ???? ???????? ????????? ????????? ??? ?????? ?????.
+???? ? ?? ????? ??? ??? ????????. ... ???? ?? ???? ????? ?????? ???? ???????
+???? ?? ???, ????? ? ?????????.  ;-) ? ????? ??????, ?????? ??? ??????. ???????,
+??????? ???????? ? ????????? ?????.</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_b.png" alt="Level of the month" border="0">
+<div class="imagetitle">?????? ? ?????.<br>????? ????????!<br>??? ?? ?????????!</div>
+</div>
+
+<p>??? ??????????? ???????? ? ?????????????, &quot;????????? ?????&quot;, ????????? ??????? 
+? ???? ???????????? &quot;??????? ????????&quot;, ?? ????? ??? ??????. 
+? ??????? ??? ?? ??????? ????????, ????? ???? ?? ?????????? ??????????
+? ???????? ??? &quot;????????? ?????&quot;. ?? ????? ??? ??? ?? ???????? ? ????, ?? ??????
+???????????? ? &quot;????????&quot;. ????, ?????? ???? ? ???????? ??????.
+???????, ? ???? ??????? ???????? ?????, ???????? ?????, ????? ??????
+???? ?????. ???! ??? ? ??????????, ? ????? ??? ? ?????? ? ????????? ?????,
+????? ???????? ?????????????, ? ?????? ?????? ????? ???????? ??? ????? ???? ??????.</p>
+
+<p>??????, ????? ? ??? ???? ??????????, ?? ????? ??????????. ?? ??? ????? ?????,
+????? ?????????? ????, &quot;??????????&quot; ????????????? ????????? ????????. 
+? ????????? ????? ???? ?? ??????? ????? ?????? ???? ????????, ??????? ?????????? ? ?? ?????????
+??????? ?????????. ?? ??????? ???? ??? ??????? ????????? ?? ????????? &quot;?????????&quot;.
+?????????, ??? ????? ??????.</p>
+
+<p>??? ?????? ?? ????? ????????? ????? ? ?????, ??? ??? ????
+???????? ??????. ?????????? ???????? ? ?????????? ?????? ??????????.
+??, ????? ??? ??? ?? ?????? ?????????, ????? ????????? ?? ????? ??????????? ?????.
+???? ?? ??? ????????? ???????? ?????, ????????? - ?? ???????. ... ??? ??? ???!</p>
+
+<h4>&quot;?? ??????? ?????? ??????????????? ?????? ? ??????? ????? ????????????!&quot;</h4>
+
+<div class="quote">??? ?? ? ?????, ?? ????? ???? ???? ?  &quot;Pleasure
+Garden&quot;. ????. ? ?????????? ? ??? ???????? ?????. ???? ??? ?? ???????? ??????,
+??? ??? ?????????????? ???????. ????????? ? ????, ? ?? ?????, ????? ? ? ???? ?????, ?? ??? ????? ???????
+?????? ??? ??????. ????????, ?????? ??? ?? ????? ??? ??? ?????? ????? ????? ??????? ??? ??????. ? ????? ??????,
+? ??????????, ? ????? ?? ????????, ??? ?? ?? ??? ??????.</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_e.png" alt="Level of the Month" border="0">
+<div class="imagetitle">? ???????? - <br>????? ????</div>
+</div>
+
+<div class="quote">????????? ????? ? ?????? ?????. ??????? ?????. ??? ???
+????? ???? ????? ? ????????, ???????? ????? ????? ???????. ????????? ?????. ???.
+????? ??? ? ???? ???? ?????. ??????? ?????? ???-??? ???????? - ?????
+?????????? ??????? ? ???????? ????. ????? ?????????. ?????????</div>
+
+<div class="quote">???????! ???????? ????????????? ????? ????????????? ??????.
+? ????? ?? ??????? ???????? ??????? ???????? ???, ?? ?????? ?????? ???????? ?? ???,
+?????????????. ??????, ?????????? ?? ???????, ??????. ??????? ?? ?? ???????, ??? ???
+??? ??? ????????.</div>
+
+<div class="quote">?????, ???????? ??????? ? ???????? ?? ??????. ???? ??????. ?? ????????? ??
+?????? ??????. ????????. ????-????????. ?? ????? ??????? ???????? ??? ??? ??? ?????
+?? ????????????.</div>
+
+<div class="quote">???????. ?????? ????. ???????????? ??????????? ? Oxyd ??????: ????? ????? ?????????
+?????? ?? ??? ?????. ???????????. ???? ? ????????? ????? ???? ?? ??????, ??? ??????? ?????????.
+? ??? ????? ??????.</div>
+
+<div class="quote">?? ??? ????????? ????? ?? ???????? ??????????, ?? ?
+?????? ???????, ??????? ????? ??????? ????????????, ?? ? ???????,
+??? ??? ???????? ?? ??????. ??, ??-??????, ? ??? ???? ?????, ? ??-??????
+????? ????? ?????. ????? ? ? ????????? ??? ??????????? ???????, ??
+??????? ????????? ? ???????.</div>
+
+<div class="quote">??????. ?????, ?????! ? ???????? ??? ????????? ? ?????????.
+????????? ????? ????????? ?? ???????????? ????, ??? ???????. ??????????.
+? ???? ??? ? ??? ???????. ?????? ??? ??????, ?? ??????? ? ???? ????????? ?
+?????????. ???????. ????????????. ??? ???????? ?????? ? ?????????. ? ???????,
+??? ????? ?????? ???????? ?????. ?? ???? ??? ??? ????????? ?? ???. ? ??? ??????,
+??? ?????? ????????????? ??????? ??? ??? ??????? 5 ???, ???? ??????? ????? ??????
+????????? ?????. ??? ???? ?????????????. ? ????? ? ??????? ????: ??? ?? ? ????????
+?????? ???? ??????? ?? ????? ??????, ??? ?? ??????? ?????? ???????????????
+?????? ? ??????? ????? ?????????????!</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_h.png" alt="Level of the Month" border="0">
+<div class="imagetitle">?????????? ?????? ?? ????????????: <br>??????? ????????? ????????!</div>
+</div>
+
+<div class="quote">??????, ?????? ??????? ? ???? ???????, ? ??????? ??????? ?????
+???????? ?????????. ???? ????? ??? ???????????? ?????? ???????, ?????? ?? ??,
+????? ??????? ?????. ? ????? ?????? ??? ??? ?????? ??????????.</div>
+
+<div class="author">Shoki</div>
+
+<p>?? ?????? ? ?????? ????? ????. ??? ???? ???????-??: ????? ??????????
+?????? ?? ????????????? ???? ????? ?? &quot;??????&quot;, ?????????? ? ???.
+? ????????? ? ??? ?? ????????????. ????? ??? ??? ????? ??????,
+????? ??????? ????????? ??????????? ? ????????? ?? ? ?????? ??????????. 
+(???? ??? ??? ????-?? ????? ??????, ?? ?? ????? ??????? ????????????????
+? &quot;Boulder-Puzzle&quot; (IV - #8) ???? ?? ??????.) ???? ??? ???????? ???????????,
+?????? ?????????, ???? ? ?????????? ??????? ?? ??????????? ?????????????????.
+???? ???, ??????? ????? ??? Shift-F3. (??? ? ?????? ??? ??? ?? ???????? ? ???-?? ?????????
+?? ?.) ???????, ? ????? ??? ???????????????.</p>
+
+<p>?????? ?? ???????? ????????? ????? ?????????. ??????, ??????? ? 
+&quot;??????&quot;, ??????? ????????? - ???????? ?????????? ???????
+???????? ??????, ?? ???????? ? ????????? (?????? ?????????? ???-?? ?? ??????? ? ???.)
+????????: ???? ?? ??? ??????????? ?????????? ? ?????? ??????????? ??? ????. ?????
+??? ?????? &quot;?????&quot; ? ???????, ????? ??????? ???? ?????? ????????????.
+??????, ??????? ??????? ????????? ? ??????? ??????. ????????? ???????! ???????
+??????????? ?????????? ???????. ??? ????? ??????? ???????????, ????????? ???????
+???????? ? ????. ??? ????? ????????? ???? ????????? ? ??????????????. ??? ????????????
+??????? ?? ?????? ????? ? ??????????? ??????? ????? ????????? ??????????. ???????,
+??????? ????????? ??? ??????????. ...</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_j.png" alt="Level of the Month" border="0">
+<div class="imagetitle">?????????? ??????? ???????? ??? ??????? ????????????</div>
+</div>
+
+<p>??????? ????????? ? ??????? ?????? ????. ??????, ???? ????????.
+?????? ?? ????? ?????????, ??? ???????? ? ???????: &quot;??????!&quot; ?, ???!
+?????????? ????????? ???????? ? ?????? ??????. ?? ??????, ????? ?? ???????
+????????? ? &quot;??????&quot;, ??? ?????? ??? ??????. ??? ?? ??? ???????!
+??????? ???????????? &quot;?????&quot;! ?? ???? ???????? ????????? ?????? ???????
+? ?? ???? ?? ?????? ? ????? ????????? ? ???? ?????????? ???????????? &quot;:->&quot;
+??? &quot;.'P&quot; ??? ???? &quot;-/-&quot;, ??? ??? ??????? ?? ???? ??? ??????.</p>
+
+<p>????, ?????? ???????? ? ?????????, ????? ????????? ???, ??? ???? ????
+????? &quot;????????&quot;. ??????, ?????? ???? ???? ????????? ?????????
+?????, ??? ?????? ??? &quot;??????&quot;, ?? ???? ?????-?? ????????, ???????
+???????? ??????? ??? ????? ???, ??????? ??? ?? ??, ? ??? ?? ????????! ... ??????, ??
+??? ? ??? ??? ???????. ??????? ?????? ?????????? ?? ???? &quot;??????&quot;, ?? ???????
+?????? ??????????. ??????? ????, ?? ??? ? ??? ???????, ???????? ?????? ???, ????? ?????
+?????????? ?????.</p>
+
+<p>?????????? ????????? ??????, ??????? ?? ??????? ? &quot;Pleasure Garden&quot;,
+?? ????? ? ???????. ?? ??????-?? ????? ??????? ??? ???? ????????.
+? ????????? ????????? ?????? ????????????? ????????. ? ?? ???? ?????????? ??? ?????
+? ????? ???? ? ????????? ??? ??????? ?? ?? &quot;?????&quot; ?? ? ?? ?????. ?????? ?
+????????????? ?? ????? ???????, ??????? ??????? ???????? (?????????! ?? ????? ????
+? ?? ?? ????????), ??-????? ????????? ????? &quot;Pleasure Garden&quot; ? ??????? ?? ?????????,
+????????? ??????? ????? ???? ????????????, ??????? ???????? ???? ???????.</p>
+
+<p>??????????? &quot;Pleasure Garden&quot; ????? ???? ??????? ????? ? ???? ?????? Top 10.
+??????? ??????? Jacob Scott ?? ???? ???????? ???????.</p>
+
+<p><i>NObby</i></p>
+
+<p>????????? ????????, ??? ?????? ????? ???? ?????? ? ??????? ??????? Enigma.
+?????????? ?????????? ??? ????? ??????, ??? ???? ???????????, ??????? ?? ???????? ?? ?????????? ??????:</p>
+<pre>
+<a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
+</pre>
+<p>?? ???????? ?????????????? ? ??????? ? ????????? ???????:
+</p>
+<ul>
+<li>&quot;Gods of Enigma II&quot; ?? moonpearl</li>
+<li>&quot;Industrial Puzzles&quot; ?? Raoul Bourquin</li>
+<li>&quot;Plan Ahead&quot; ?? Jacob Scott</li>
+<li>&quot;Block its way!&quot; ?? Jon 'WB' Sneyers</li>
+</ul>
+<p>??????? ??????? ???????, ?????? ???? ?????? ???????? ????????? ?????? ??!</p>
+
+<p><i>???? ??????? Enigma</i></p>
+
+</div>


Property changes on: feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html
___________________________________________________________________
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Fri May  9 21:31:17 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 9 May 2008 21:31:17 +0200
Subject: [Enigma-game-svn] r1132 - trunk/doc/reference
Message-ID: <200805091931.m49JVHfa000723@sheep.berlios.de>

Author: ral
Date: 2008-05-09 21:31:16 +0200 (Fri, 09 May 2008)
New Revision: 1132

Modified:
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk 1.1:
- refman new API additions: st_window, st_lightpassenger



Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-05-09 11:57:38 UTC (rev 1131)
+++ trunk/doc/reference/enigma-ref.texi	2008-05-09 19:31:16 UTC (rev 1132)
@@ -4525,12 +4525,14 @@
 * st_laser::           Lightemitting Laser
 * st_laserflop::       Lightsensitive Monoflop
 * st_laserswitch::     Lightsensitive Switch
+* st_lightpassenger::  Stone pushed by Light
 * st_monoflop::        Monoflop Switch
 * st_oxyd::            Game Target Stone
 * st_polarswitch::     Transparency Switch for Light Beams
 * st_rotator::         Rotating Stone Impulser
 * st_switch::          Classical on/off Switch
 * st_timer::           Animated Timer
+* st_window::          Faced Window
 @end menu
 
 
@@ -5005,6 +5007,87 @@
 
 @end table
 
+ at c ----------------- Lightpassenger Stone -------------------- 
+
+ at node st_lightpassenger
+ at subsection st_lightpassenger
+ at obindex st_lightpassenger
+
+The light passenger skates on a laser beam, and may push up to one
+movable stone in front of it. Opposing laser beams are ignored.
+When another laser beam crosses the actual laser beam on which the
+passenger skates, the passenger switches beams. If it is initially
+lighted by two rectangular beams, one of them will be chosen by
+random. The light passenger's skating ability can be turned off
+and on.
+
+When a stone is in its way, the passenger sends an impulse to the
+blocking stone, which may move it, but it may also have other effects;
+e.g., a turnstile turns around and an impulse-stone starts pulsing,
+but it does not open oxyds (this is intended).
+
+The light passenger can't be pushed by actors, but, e.g., by
+ at ref{st_stoneimpulse}.
+
+The speed of the light passenger can be changed with the
+ at samp{interval}-attribute (default 50 ms, which is quite fast) and may
+include the floor friction and local gradient via
+ at samp{friction} and @code{gradient}. The resulting interval results as
+
+ at example
+interval  =  base * (1 + stone_friction * floor_friction) / (1 + stone_gradient * floor_gradient)
+ at end example
+
+with @samp{base} the value of the @samp{interval}-attribute,
+ at samp{floor_friction} the friction of the floor below the light passenger,
+and @floor{floor_gradient} the parallel part of the force of the floor,
+i.e., the sum of gradient-force and @code{force_x/y}-attributes.
+
+The light passenger can be switched on and off by messages (see
+below), and appears as @samp{st_glass2} when inactive.  The variant
+ at samp{st_lightpassenger_off} is deactivated from the beginning.
+
+When an active @samp{st_lightpassenger} is trapped between exactly two
+opposing light beams or light beams from all four directions, it
+starts blinking.  In this state, it can be destroyed with
+ at ref{it_hammer}.
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{state}, @ @ @i{values}: @code{ON}, @code{OFF}; @ @ @i{default}: @code{ON}; @ @ @xref{state}
+Represents the activity state.
+ at item @b{interval} @ @ @i{values}: positive number; @ @ @i{default}: @code{0.05}
+The base interval for movements.
+ at item @b{friction} @ @ @i{values}: positive number; @ @ @i{default}: @code{0.0}
+Stone friction of the speed of the light passenger.
+ at item @b{gradient} @ @ @i{values}: positive number; @ @ @i{default}: @code{0.0}
+Stone gradient of the speed of the light passenger.
+
+ at end table
+
+ at item @b{Messages:}
+
+ at table @asis
+ at item @b{signal} @ @ @xref{signal}
+Switches on at value @samp{1}. A values of @samp{0} is ignored.
+ at item @b{on} @ @ @xref{on}
+Switch the lightpassenger on.
+ at item @b{off} @ @ @xref{off}
+Switch the lightpassenger off.
+ at end table
+
+ at item @b{Variants:}
+
+ at table @asis
+ at item @b{st_lightpassenger}: state = @code{ON}
+ at item @b{st_lightpassenger_on}: state = @code{ON}
+ at item @b{st_lightpassenger_off}: state = @code{OFF}
+ at end table
+
+ at end table
+
 @c ----------------- Monoflop Stone -------------------- 
 @node st_monoflop
 @subsection st_monoflop
@@ -5351,6 +5434,88 @@
 @end table
 
 
+ at c ----------------- Window Stone -------------------- 
+ at node st_window
+ at subsection st_window
+ at obindex st_window
+
+A stone made up just of glass window faces. All combination of window faces with
+at least one face are possible. There exist two versions of windows, normal
+blue colored glass and green colored saftey glass, that is nearly undistructable.
+Saftey glass is seleted by setting the attribute @samp{secure} to @samp{true}.
+
+All windows are transparent to laser light.
+
+Slowly moving actors will bounce from window faces on any side. They can freely
+move within the inner part of the window stone. Invisible actors can even pass
+the normal blue window faces, but not the green saftey glass faces.
+
+Fast moving actors can blast normal blue window faces into smithereens. But too
+strong hits will cause marbles to shatter themselves. An actor can lower the
+required speed by adding @ref{it_weight}, by revealing an @ref{it_hammer}, or by
+weakening the window faces by prior scratching it with an @ref{it_ring}. Green
+safty glass windows will never break on actor attacks.
+
+Bomb explosions can shatter window faces, too. Normal blue window faces adjacent
+to a bomb explosion will break. Green saftey glass faces will break only if 
+prior weakened by an @ref{it_ring} scratch.
+
+Window faces can be rearranged by actors with a revealed @ref{it_wrench}.
+Pushing a face from the outside may move it to the opposite side of the window.
+But it will only move to the opposite side if there is not already a window face.
+And additionally the grid position adjacent to the opposite side must be free
+of a stone. Just another window stone without an adjacent window face is allowed
+on this position. The reason is, that the moving window face will push
+non static items and any actors positioned on the affected window grid to the
+next grid.
+
+Window face rearrangements can also be initiated by an @ref{it_puller} dropped 
+within the window and by the message @samp{inner_pull}.
+
+
+ at table @asis
+ at item @b{Attributes:}
+
+ at table @asis
+ at item @b{faces} @ @ @i{values}: string; @ @ @i{default}: @code{"s"}
+Describes the window faces of the stone. The string is a substring of 
+ at samp{"nesw"} listing the faces. The sequence of the sides, north, east, south,
+west, is guaranteed on read access but arbitrary on write access.
+ at item @b{secure} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
+Green saftey glass is secure, whereas normal blue is not.
+ at end table
+
+ at item @b{Messages:}
+
+ at table @asis
+ at item @b{inner_pull}, @ @ @i{value type}: direction
+Try to tear the opposite window face into the given direction.
+ at end table
+
+ at item @b{Variants:}
+ at table @asis
+ at item @b{st_window}: faces = @code{"s"}
+ at item @b{st_window_w}: faces = @code{"w"}
+ at item @b{st_window_s}: faces = @code{"s"}
+ at item @b{st_window_sw}: faces = @code{"sw"}
+ at item @b{st_window_e}: faces = @code{"e"}
+ at item @b{st_window_ew}: faces = @code{"ew"}
+ at item @b{st_window_es}: faces = @code{"es"}
+ at item @b{st_window_esw}: faces = @code{"esw"}
+ at item @b{st_window_n}: faces = @code{"n"}
+ at item @b{st_window_nw}: faces = @code{"nw"}
+ at item @b{st_window_ns}: faces = @code{"ns"}
+ at item @b{st_window_nsw}: faces = @code{"nsw"}
+ at item @b{st_window_ne}: faces = @code{"ne"}
+ at item @b{st_window_new}: faces = @code{"new"}
+ at item @b{st_window_nes}: faces = @code{"nes"}
+ at item @b{st_window_nesw}: faces = @code{"nesw"}
+
+ at end table
+
+ at end table
+
+
 @c ===================  Actors  =======================
 
 @node Actor Objects



From andreasl at mail.berlios.de  Fri May  9 22:03:34 2008
From: andreasl at mail.berlios.de (andreasl at mail.berlios.de)
Date: Fri, 9 May 2008 22:03:34 +0200
Subject: [Enigma-game-svn] r1133 - feature_branches/hp_lotm/input/lotm
Message-ID: <200805092003.m49K3Yic003146@sheep.berlios.de>

Author: andreasl
Date: 2008-05-09 22:03:32 +0200 (Fri, 09 May 2008)
New Revision: 1133

Added:
   feature_branches/hp_lotm/input/lotm/lotm_200805_de.html
Modified:
   feature_branches/hp_lotm/input/lotm/lotm_200805.html
Log:
LotM Feature branch:
 - German translation and proofread of LotM April 2008
 - Proofread of English version
Todo:
 - Validation
 - Upload


Modified: feature_branches/hp_lotm/input/lotm/lotm_200805.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805.html	2008-05-09 19:31:16 UTC (rev 1132)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805.html	2008-05-09 20:03:32 UTC (rev 1133)
@@ -6,10 +6,10 @@
     &quot;Pleasure Garden&quot; by Jacob Scott
   </h3>
 
-<p>I've got a bit of a conflicting relationship with &quot;Pleasure Garden&quot;: 
+<p>I've got a bit of a conflicted relationship with &quot;Pleasure Garden&quot;: 
 If all's going well, it's a pleasure indeed to go for a stroll in 
 the garden, but if I have a bad day, it seems to me more like a 
-building site - just if it were still in the planning stage but not yet
+construction site - just as if it were still in the planning stage but not yet
 complete. What are the single components representing then - and where 
 have all the &quot;flowers&quot; gone?</p>
 
@@ -67,9 +67,9 @@
 </table>
 
 <p>In the beginning a few planks, which are stored behind some 
-hoarding full of holes, have to be laid - to be able to place the 
-border for the &quot;small fountain&quot; in the lake. Until I found out how 
-it works. ... Must have accidentally banged my head with one of those 
+wire-netting fence, have to be laid - to form the 
+border for the &quot;small fountain&quot; in the lake. Until I discovered how
+to do it, I must have accidentally banged my head with one of those 
 planks. ;-) Nevertheless, that's done. So off we go to the next part.</p>
 
 <div class="lotmpic">
@@ -77,39 +77,38 @@
 <div class="imagetitle">The fountain in the lake.<br>Messed it up again!<br>Where's the gardener?!</div>
 </div>
 
-<p>What's going on? Toolshed, &quot;mission control&quot;, lots of trellis 
+<p>What's going on? Toolshed, &quot;mission control&quot;, lots of trellises 
 and three unfinished &quot;large fountains&quot;, but only two borders. 
 Fortunately they're not overgrown with tendrils, otherwise 
 it would be impossible to get through to the toolshed or the 
 &quot;mission control&quot;. But before we get in there, we'll have to 
 take care of the &quot;fountains&quot;. So, now the toolshed's open.
 Oh boy, it's pretty dark inside this shack, too dark to see 
-where you're going. Ah! here's the tool, bag it, then off we go 
+where you're going. Ah! here's the tool. Let's put it in the bag, then off we go 
 next door to operate the switch, and now it's time to leave this 
 part of the garden behind.</p>
 
 <p>Now that we've got our tool, we can go on. We need it badly
-to uncover our path which &quot;kindly&quot; is surrounded by deep ditches. 
+to uncover our path. Oh, it's surrounded by deep ditches! How convenient!
 In the following area of the garden we come across some labyrinth,
-which strangely enough is in good repair. At least it's granted 
-to us to have a look at some &quot;flowers&quot;. Then let's see what comes next.</p>
+which strangely enough is in good repair. At least it allows us a peek at the 
+&quot;flowers&quot;. Then let's see what comes next.</p>
 
-<p>The two exits from this labyrinth lead to an area, where some
-roadworks are awaiting us. Blastings at various places have to be
-carried out. But before we start the fireworks, two planks need to be 
-laid across some pit. One of them's leaning against a wall, the other's 
-stored behind a fence. ... That's that!</p>
+<p>The two exits from this labyrinth lead to an area where road work is taking
+place. Demolition is being carried out. But before we start the fireworks, two
+planks have to be laid across a pit. One of them's leaning against a wall, the other's 
+stored behind a fence. &hellip; That's that!</p>
 
 <h4>&quot;I really get a lot of pleasure from solving such a fantastic
 level!&quot;</h4>
 
-<div class="quote">So I here I am to say something about &quot;Pleasure
-Garden&quot;. All right then. It's quite a while ago that I dealt with it. It
-was a fantastic level, that I can remember. As far as I know there had not been
-too much players which had solved the level at the time, when I was playing it.
-Had it not yet been discovered by others or had nobody dared to deal with it so
-far? Anyway, I tried, and once again I was thoroughly convinced that it can't be
-that difficult.</div>
+<div class="quote">So here I am to say something about &quot;Pleasure
+Garden&quot;. All right then. It's quite a while ago that I dealt with it. I
+recall it as a fantastic level. As far as I know there had not been
+too many players who had solved the level at the time, when I was playing it.
+Had it not yet been discovered by others or had nobody dared to take it on so
+far? Anyway, I tried, and once again I was thoroughly convinced that it couldn't
+be that difficult.</div>
 
 <div class="lotmpic">
 <img src="$$imagedir$$/lotm/lotm_200805_e.png" alt="Level of the Month" border="0">
@@ -118,7 +117,7 @@
 
 <div class="quote">Moving blocks to the right place. Opening the door. Because
 of the breakable stones to the left: probably finding a hammer. Breaking the
-stones. Done. That's what I thought. Moving blocks somewhat worked, after a few
+stones. Done. That's what I thought. Moving blocks seemed to work. After a few
 tries I got it. Door opens. Hammer??</div>
 
 <div class="quote">Sure thing! Well embedded in a bunch of one-way-stones. And
@@ -137,14 +136,14 @@
 <div class="quote">But these accursed bombs won't work this way, neither in the
 lower area, which really is a pleasure, nor in the upper area where it would
 come in quite handy. But first of all you have your brains, and secondly there's
-a fuse. After replaying the level for another time I finally got the bomb
+a fuse. After replaying the level another time I finally got the bomb
 thing.</div>
 
 <div class="quote">A boulder. Well, well! I got it moving and listened. Listened
 to the sound of decline of the garden's pleasures, so to say. Restart. This time
 I was faster. Light up all oxyds within reach, then hurry on. Mirrors. Great. I
 like mirror levels. Supposing I can take my time. Which wasn't true in this
-case. I believe I had to restart the level for at least another 5 times before I
+case. I believe I had to restart the level at least another 5 times before I
 finally lit up the last oxyd. It was fantastic. And once again I was being asked
 if everything's alright with me. Why can't this man understand, that I really
 get a lot of pleasure from solving such a fantastic level?!</div>
@@ -165,15 +164,15 @@
 lined up. Unfortunately there's no direct approach.
 Before we can get out of here, several of these idle bulldozers  
 must be started and driven to their points of destination. 
-(Who finds it difficult to do so, might want to get some practise
+(Whoever finds it difficult to do so, might want to get some practise
 with &quot;Boulder-Puzzle&quot; (IV - #8) by the same author.) If you're 
 getting bulldozed, it actually isn't that dramatic, if you've acted
-foresighted in the previous area. If not, one more time it's time 
-for Shift-F3. (Who would think of something like this the first time?
+with foresight in the previous area. If not, it's time 
+for Shift-F3 again. (Who would think of something like this the first time?
 Not me.) Eventually we've got our little repairs done here too.</p>
 
-<p>Now we reach the last part of the labyrinth. The way, that leads
-to the &quot;flowers&quot;, seems to be obvious - too obvious? After a bit of
+<p>Now we reach the last part of the labyrinth. The way that leads
+to the &quot;flowers&quot; seems to be obvious - too obvious? After a bit of
 wandering around we arrive at the last (Really the last? Somehow 
 I can't quite believe it.) obstacle: One of these bulldozers, 
 stopped by a stone, blocks our way. Behind it the first &quot;flowers&quot; and 
@@ -183,7 +182,7 @@
 for the order to go into action. Also there's a greenhouse light with a 
 switch nearby. What's going on?? It's not possible to get to the 
 other side and examine the region more closely. So let's see what 
-happens. ...</p>
+happens. &hellip;</p>
 
 <div class="lotmpic">
 <img src="$$imagedir$$/lotm/lotm_200805_j.png" alt="Level of the Month" border="0">
@@ -192,18 +191,18 @@
 
 <p>Let's start work and push the stone aside. All right, the way's
 cleared. Now we can read what's written on the sign: &quot;Quickly!&quot; Oh no!
-stress of examinations close to the ending. But now that we've finally
+Stress of examinations close to the ending. But now that we've finally
 reached our &quot;flowers&quot;, we won't be that badly off. That's what you
 think! Count the &quot;flowers&quot; first! Didn't you notice the small passage 
 to the right? And did you forget about the greenhouse light and these 
-duff bulldozers? &quot;:->&quot; or &quot;.'P&quot; or even &quot;-/-&quot;, I'm never feeling too 
-good from this point on.</p>
+pesky bulldozers? &quot;:->&quot; or &quot;.'P&quot; or even &quot;-/-&quot;, I
+never feel very well from this point on.</p>
 
 <p>So quickly off into the greenhouse to adjust everything so that this
 &quot;flower&quot; is provided with light as well. By the way, why has it actually
-been blocked up in this way? Perhaps it's no &quot;flower&quot; at all, but some 
+been hidden away like this? Perhaps it's no &quot;flower&quot; at all, but some 
 kind of plant which the gardener has reserved for himself? No, of course
-not what you're thinking of! ... However, we've got no time for such 
+not what you're thinking of! &hellip; However, we've got no time for such 
 things. Let's quickly pick all of the &quot;flowers&quot; within reach. One 
 remains, but as I said before, the gardener will collect it, when it
 has received enough light.</p>
@@ -213,7 +212,7 @@
 of problems is a problem. And the final countdown's really 
 pretty tough. I can't remember how often I messed things up in the
 greenhouse or picked the wrong &quot;flowers&quot; at the wrong time. Though I'm
-really not fond of levels which demand quickness (Sorry! Actually 
+really not fond of levels which demand speed (Sorry! Actually 
 I can't stand them), in my opinion the final part of &quot;Pleasure Garden&quot;
 in contrast to the other parts adds much to the pleasure of the level
 as a whole.</p>
@@ -224,7 +223,7 @@
 <p><i>NObby</i></p>
 
 <p>Dear reader, we have a constant need for articles from you about Enigma's
-great levels. Please, send us any articles, even comments, you write to</p>
+great levels. Please, send us any articles, even comments, you write to:</p>
 <pre>
 <a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
 </pre>

Added: feature_branches/hp_lotm/input/lotm/lotm_200805_de.html
===================================================================
--- feature_branches/hp_lotm/input/lotm/lotm_200805_de.html	2008-05-09 19:31:16 UTC (rev 1132)
+++ feature_branches/hp_lotm/input/lotm/lotm_200805_de.html	2008-05-09 20:03:32 UTC (rev 1133)
@@ -0,0 +1,253 @@
+<div class="lotm">
+$$lotm_header$$
+
+  <h3 class="lotm">
+    <span class="date">Mai 2008: </span>
+    &quot;Pleasure Garden&quot; von Jacob Scott
+  </h3>
+
+<p>Mein Verh&auml;ltnis zum &quot;Lustgarten&quot; ist ein bisschen zwiesp&auml;ltig. 
+Wenn's gut l&auml;uft, ist es wirklich eine Lust, entspannt durch 
+den ganzen Garten zu schlendern. Hab ich allerdings einen 
+schlechten Tag, erscheint er mir vielmehr wie eine Baustelle - 
+so als w&auml;re er noch in der Planung, aber noch nicht so richtig 
+fertig. Wie stellen sich dann die einzelnen Teile dar - wo 
+bitte sind denn die &quot;Blumen&quot;?</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_c.png" alt="Level des Monats" border="0">
+<div class="imagetitle">Enigma VI # 95</div>
+</div>
+
+<table cellpadding="0" cellspacing="1" class="statistics">
+<caption class="normalcaption">Einige Rekorde vom M&auml;rz 2008</caption>
+<colgroup>
+   <col width="80">
+   <col width="160">
+</colgroup>
+    <tr><td class="num">8:17</td>
+        <td class="left">Moneymaker</td></tr>
+    <tr><td class="num">10:18</td>
+        <td class="left">Craven</td></tr>
+    <tr><td class="num">11:19</td>
+        <td class="left">Freshman</td></tr>
+    <tr><td class="num">11:57</td>
+        <td class="left">Alex</td></tr>
+    <tr><td class="num">12:03</td>
+        <td class="left">Ronald</td></tr>
+    <tr><td class="num">12:13</td>
+        <td class="left">Malla</td></tr>
+    <tr><td class="num">12:46</td>
+        <td class="left">dev0</td></tr>
+    <tr><td class="num">13:03</td>
+        <td class="left">Ale</td></tr>
+    <tr><td class="num">13:09</td>
+        <td class="left">Lukas</td></tr>
+    <tr><td class="num">13:22</td>
+        <td class="left">shoki</td></tr>
+    <tr><td class="num">13:30</td>
+        <td class="left">para_doks</td></tr>
+    <tr><td class="num">13:59</td>
+        <td class="left">daydreamer</td></tr>
+    <tr><td class="num">16:04</td>
+        <td class="left">Tobias</td></tr>
+    <tr><td class="num">16:59</td>
+        <td class="left">WP319</td></tr>
+    <tr><td class="num">17:08</td>
+        <td class="left">Taztunes</td></tr>
+    <tr><td class="num">19:50</td>
+        <td class="left">ryujun</td></tr>
+    <tr><td class="num">21:29</td>
+        <td class="left">JuSt</td></tr>
+    <tr><td class="num">24:10</td>
+        <td class="left">Daisy</td></tr>
+    <tr><td class="num">41:43</td>
+        <td class="left">alfred69</td></tr>
+    <tr><td class="num">56:43</td>
+        <td class="left">mecke</td></tr>
+</table>
+
+<p>Am Anfang m&uuml;ssen erst mal ein paar Holzbohlen, die auch noch 
+hinter einem l&ouml;chrigen Zaun rumliegen, verlegt werden, um die 
+Einfassung f&uuml;r den &quot;kleinen Springbrunnen&quot; im See plazieren 
+zu k&ouml;nnen. Bis ich raus hatte, wie das geht &hellip; Hatte mir wohl 
+versehentlich eine der Holzbohlen vor den Kopf geklatscht ;-). 
+Aber geschafft. Also ab in den n&auml;chsten Teil.</p> 
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_b.png" alt="Level des Monats" border="0">
+<div class="imagetitle">Der Springbrunnen im See.<br>Hab's mal wieder vermasselt!<br>Wo steckt nur der G&auml;rtner?!</div>
+</div>
+
+<p>Wie sieht's denn hier aus? Werkzeugschuppen, Schalterraum, 'ne 
+Masse Spaliere und drei unfertige &quot;gro&szlig;e Springbrunnen&quot;, aber 
+nur zwei Einfassungen. Zum Gl&uuml;ck w&auml;chst an den Spalieren noch 
+nichts hoch; denn sonst w&auml;re kein Durchkommen zum Schuppen und 
+Schalterraum. Doch bevor wir da reinkommen, m&uuml;ssen wir uns 
+zun&auml;chst der &quot;Springbrunnen&quot; annehmen. Jetzt ist auch der 
+Schuppen offen. Mann, was herrscht da f&uuml;r ein Verhau, da sieht man 
+gar nicht, wo man ist. &hellip; Ah, da ist das Werkzeug, einsacken, 
+im Nebenraum noch den Schalter umlegen und raus aus diesem 
+Teil des Gartens.</p> 
+
+<p>Nachdem wir nun unser Werkzeug haben, k&ouml;nnen wir weiter. Das 
+Werkzeug haben wir auch bitter n&ouml;tig zum Freilegen des Weges, 
+der &quot;netterweise&quot; von einem tiefen Graben umgeben ist.
+Im folgenden Gartenabschnitt treffen wir auf ein Labyrinth, wo 
+wir ausnahmsweise nicht nachbessern m&uuml;ssen. Zumindest kann 
+man einen Blick auf ein paar &quot;Blumen&quot; werfen. Also schauen wir 
+mal, wie's weitergeht.</p>
+
+<p>Die beiden Ausg&auml;nge des Labyrinths f&uuml;hren uns weiter in einen 
+Bereich, wo noch diverse Erdarbeiten mittels Sprengungen n&ouml;tig 
+sind. Doch bevor wir's krachen lassen, m&uuml;ssen wir noch zwei 
+Holzbohlen (die eine lehnt an der Wand, die andere ist hinter 
+einem Drahtzaun) &uuml;ber eine Grube legen. &hellip; Erledigt.</p> 
+
+<h4>&quot;Ich freue mich wirklich, wenn ich so ein tolles Level gel&ouml;st
+habe!&quot;</h4>
+
+<div class="quote">Ich soll also was zu &quot;Pleasure Garden&quot; sagen. Na
+gut. Es ist ja schon eine Weile her, da&szlig; ich mich damit besch&auml;ftigt
+habe. Es war ein tolles Level, daran erinnere ich mich, und als ich es spielte,
+gab es, soweit ich wei&szlig;, noch so gut wie keine L&ouml;sungen.</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_e.png" alt="Level des Monats" border="0">
+<div class="imagetitle">Im Steinbruch - <br>Den Weg freilegen</div>
+</div>
+
+<div class="quote">Hatten die anderen es nicht gefunden oder sich nur noch nicht
+drangetraut? Ich traute mich jedenfalls und war wiedermal der festen
+&Uuml;berzeugung, da&szlig; es so schwer nicht sein k&ouml;nne. Kl&ouml;tzchen
+an die richtige Stelle schieben, T&uuml;r &ouml;ffnen, wegen der Bruchsteine
+links wahrscheinlich einen Hammer finden, Steine weghauen, fertig. Von wegen.
+Kl&ouml;tzchen schieben ging noch. Nach einigen Versuchen hatte ich es raus.
+T&uuml;r auf. Hammer??</div>
+
+<div class="quote">Aber sicher. Gut eingebettet in einem Haufen Einbahnsteine.
+Und welches blaue Licht ist zust&auml;ndig? Glaubt mir, auch ihr werdet unter
+Garantie das falsche w&auml;hlen. Das Hammerlicht ist das andere. Macht aber
+nix, ist trotzdem noch gut l&ouml;sbar.</div>
+
+<div class="quote">Also wieder zur&uuml;ck, Steine kloppen. Jede Menge Steine.
+Hast Du die T&uuml;r aufgeschlossen? Gut. Also weiter. Ein Winz-Labyrinth.
+F&uuml;r ge&uuml;bte Lab-L&auml;ufer kein Problem.</div>
+
+<div class="quote">Weia, ein Minenfeld. Im original Oxyd-Handbuch steht: Bomben
+k&ouml;nnen durch &Uuml;berschieben gez&uuml;ndet werden. Na prima. Wenn ich
+hier ein Kl&ouml;tzchen bewege, fliegt mir der ganze Raum um die Ohren. Hab ich
+gedacht.</div>
+
+<div class="quote">Nur, die vermaledeiten Bomben z&uuml;nden nicht so, weder im
+unteren Bereich, was ja noch ganz angenehm ist, aber auch nicht im oberen, wo es
+hilfreich w&auml;re. Aber man hat ja erstens Grips und zweitens einen
+Z&uuml;nder. Nachdem ich also zum wiederholten Male von vorn angefangen hatte,
+hatte ich auch die Sache mit den Bomben kapiert.</div>
+
+<div class="quote">Ein Boulder, soso. Ich setzte ihn in Bewegung und lauschte.
+Lauschte meinem Untergang, sozusagen. Neustart. Diesmal war ich schneller. Alle
+erreichbaren Oxyds anmachen und weiterhetzen. Spiegel. Super. Ich mag
+Spiegellevels. Wenn ich Zeit habe, und die hatte ich hier nicht. Ich glaube, es
+kostete mich noch mindestens 5 Neustarts, bis ich den letzten Oxyd zum leuchten
+brachte. Es war toll. Und ich wurde wiedermal gefragt, ob alles mit mir in
+Ordnung sei. Wieso versteht dieser Mann nicht, da&szlig; ich mich wirklich
+freue, wenn ich so ein tolles Level gel&ouml;st habe?</div>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_h.png" alt="Level des Monats" border="0">
+<div class="imagetitle">Arbeitsunfall!<br>Hoffentlich zahlt die Lebensversicherung!</div>
+</div>
+
+<div class="quote">&Uuml;brigens, ich hab damals eine recht gute Zeit hingelegt.
+Heute morgen hab ich allein f&uuml;r die Kl&ouml;tzchen schon l&auml;nger
+gebraucht. Ist eben alles &Uuml;bungssache.</div>
+
+<div class="author">Shoki</div>
+
+<p>Wir betreten einen weiteren Teil des Gartens. Und was ist das? 
+Tats&auml;chlich, hinter einem Erdwall sehen wir endlich unsere 
+&quot;Blumen&quot; sch&ouml;n aufgereiht. Tja, das Dumme ist nur, es gibt von 
+hier keinen direkten Zugang. Um von hier wegzukommen, m&uuml;ssen 
+einige der herumstehenden Planierraupen erst an die richtigen 
+Stellen (wer hier seine Probleme hat, kann das in IV - #8 
+(&quot;Boulder-Puzzle&quot;) vom selben Autor &uuml;ben). Wird man &uuml;berrollt, 
+ist das eigentlich nicht so dramatisch, wenn man im vorigen 
+Bereich vorausschauend war, wenn nicht d&uuml;rfen wir Shift-F3 
+dr&uuml;cken. (Wer denkt beim ersten Mal an so was? Ich jedenfalls 
+nicht.) Schlie&szlig;lich sind wir auch hier mit unseren kleineren 
+Reparaturarbeiten fertig.</p>
+
+<p>Wir erreichen nun den Rest des Labyrinths. Der Weg, der zu den 
+&quot;Blumen&quot; f&uuml;hrt, ist offensichtlich - zu offensichtlich? Mit ein 
+wenig &quot;Herumirren&quot; erreichen wir das letzte (wirklich? - ich 
+kann's irgendwie nicht so ganz glauben) Hindernis: eine dieser 
+Planierraupe blockiert von einem Brocken versperrt den Weg. 
+Dahinter die ersten &quot;Blumen&quot; und ein Schild, das sich von hier nur
+nicht entziffern l&auml;sst. Naja, der Planierraupe kann zur freien 
+Fahrt verholfen werden, schubsen wir halt den Brocken weg. 
+Halt! Werft zuerst mal einen Blick nach rechts. Da steht 'ne 
+ganze Batterie von Planierraupen, die nur darauf warten 
+loszulegen, 'ne Lampe f&uuml;r ein Gew&auml;chshaus inklusive Schalter. 
+Was geht da ab?? Auf die Seite kommen wir auch nicht r&uuml;ber, um 
+uns das genauer anzusehen, also schauen wir mal &hellip;</p>
+
+<div class="lotmpic">
+<img src="$$imagedir$$/lotm/lotm_200805_j.png" alt="Level des Monats" border="0">
+<div class="imagetitle">Das Riesenuhrwerk - <br>Ein kleiner Ausschnitt</div>
+</div>
+
+<p>Also an die Arbeit und den Brocken auf die Seite schieben. So, 
+der Weg ist frei. Jetzt k&ouml;nnen wir auch lesen, was auf dem 
+Schild steht: &quot;Schnell&quot;. Oh nein, zum Ende auch noch Stress.
+Da wir ja endlich bei den &quot;Blumen&quot; sind, wird es schon nicht 
+sooo schlimm werden. Hast du dir so gedacht. Z&auml;hl mal die 
+Blumen, den kleinen Durchgang nach rechts nicht gesehen, die 
+Gew&auml;chshauslampe und die doofen Planierraupen vergessen? :-> 
+oder vielleicht .'P oder doch -/-, so geht's mir immer ab hier.</p> 
+
+<p>Also schnell ins Gew&auml;chshaus und hier alles so einstellen, 
+dass diese &quot;Blume&quot; auch noch Licht bekommt. Apropos, warum ist 
+die eigentlich so verbaut? Ist das vielleicht gar keine Blume 
+sondern eine Pflanze, die der G&auml;rnter f&uuml;r sich reserviert hat? 
+Nein, nat&uuml;rlich nicht das, an was ihr jetzt denkt! &hellip; Egal.
+F&uuml;r so was haben wir jetzt keine Zeit. Also schnell alle 
+erreichbaren &quot;Blumen&quot; pfl&uuml;cken. Eine bleibt zwar &uuml;brig, aber, 
+wie gesagt, die kassiert sich der G&auml;rtner, wenn sie gen&uuml;gend 
+Licht hatte.</p> 
+
+<p>Eigentlich sind die Aufgaben, die man im Lustgarten zu erledigen 
+hat, im Einzelnen gar nicht so schwierig. Aber irgendwie macht's 
+dann doch die Masse. Und der Schluss hat's wirklich in sich. Ich 
+wei&szlig; nicht mehr, wie oft ich's im Gew&auml;chshaus verdaddelt habe, 
+oder zur falschen Zeit die falschen Blumen gepfl&uuml;ckt habe. 
+Obwohl ich &uuml;berhaupt kein Freund von Leveln bin, wo es auf 
+Geschwindigkeit ankommt (sorry, aber eigentlich kann ich die 
+Dinger nicht ausstehen), gibt das Ende von Lustgarten - als 
+Gegenpol zum Rest - diesem meines Erachtens seinen ganz besonderen 
+Reiz.</p>
+
+<p>Auf jeden Fall steht Lustgarten in meinen Top 10 gaaanz weit 
+oben. Vielen Dank an Jacob Scott f&uuml;r diesen geilen Level.</p>
+
+<p><i>NObby</i></p>
+
+<p>Liebe Leserin, lieber Leser, wir haben ein st&auml;ndiges Bed&uuml;rfnis nach
+Ihren Artikeln &uuml;ber Enigmas gro&szlig;e Levels. Bitte, schicken Sie uns
+jeden Artikel, sogar Kommentare, die Sie geschrieben haben, an:</p>
+<pre>
+<a href="mailto:enigma-devel at nongnu.org">enigma-devel at nongnu.org</a>
+</pre>
+<p>Wir sind besonders interessiert an Artikeln &uuml;ber die folgenden Levels:
+</p>
+<ul>
+<li>&quot;Gods of Enigma II&quot; von moonpearl</li>
+<li>&quot;Industrial Puzzles&quot; von Raoul Bourquin</li>
+<li>&quot;Plan Ahead&quot; von Jacob Scott</li>
+<li>&quot;Block its way!&quot; von Jon 'WB' Sneyers</li>
+</ul>
+<p>Vielen Dank im voraus, nur Ihre Mithilfe kann den LdM am Leben erhalten!</p>
+
+<p><i>Ihr Enigma-Team</i></p>
+
+</div>



From andreasl at mail.berlios.de  Fri May  9 22:24:23 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Fri, 9 May 2008 22:24:23 +0200
Subject: [Enigma-game-svn] r1134 - in homepage: images/lotm input/lotm
Message-ID: <200805092024.m49KONnO006182@sheep.berlios.de>

Author: andreasl
Date: 2008-05-09 22:24:18 +0200 (Fri, 09 May 2008)
New Revision: 1134

Added:
   homepage/images/lotm/lotm_200805.png
   homepage/images/lotm/lotm_200805_b.png
   homepage/images/lotm/lotm_200805_c.png
   homepage/images/lotm/lotm_200805_e.png
   homepage/images/lotm/lotm_200805_h.png
   homepage/images/lotm/lotm_200805_j.png
   homepage/input/lotm/lotm_200805.html
   homepage/input/lotm/lotm_200805_de.html
   homepage/input/lotm/lotm_200805_ru.html
Modified:
   homepage/images/lotm/lotm-history.png
   homepage/input/lotm/lotm_200804.html
   homepage/input/lotm/lotm_archive_data.lua
Log:
Homepage:
 - Merged LotM-feature branch back to homepage.
   Please do validation here.


Modified: homepage/images/lotm/lotm-history.png
===================================================================
(Binary files differ)

Copied: homepage/images/lotm/lotm_200805.png (from rev 1133, feature_branches/hp_lotm/images/lotm/lotm_200805.png)

Copied: homepage/images/lotm/lotm_200805_b.png (from rev 1133, feature_branches/hp_lotm/images/lotm/lotm_200805_b.png)

Copied: homepage/images/lotm/lotm_200805_c.png (from rev 1133, feature_branches/hp_lotm/images/lotm/lotm_200805_c.png)

Copied: homepage/images/lotm/lotm_200805_e.png (from rev 1133, feature_branches/hp_lotm/images/lotm/lotm_200805_e.png)

Copied: homepage/images/lotm/lotm_200805_h.png (from rev 1133, feature_branches/hp_lotm/images/lotm/lotm_200805_h.png)

Copied: homepage/images/lotm/lotm_200805_j.png (from rev 1133, feature_branches/hp_lotm/images/lotm/lotm_200805_j.png)

Modified: homepage/input/lotm/lotm_200804.html
===================================================================
--- homepage/input/lotm/lotm_200804.html	2008-05-09 20:03:32 UTC (rev 1133)
+++ homepage/input/lotm/lotm_200804.html	2008-05-09 20:24:18 UTC (rev 1134)
@@ -18,7 +18,7 @@
 </p>
 
 <div class="lotmpic">
-<img src="$$imagedir$$/lotm/lotm_200804_a.png" alt="of the Month" border="0">
+<img src="$$imagedir$$/lotm/lotm_200804_a.png" alt="Level of the Month" border="0">
 <div class="imagetitle">Enigma VI # 77</div>
 </div>
 
@@ -332,6 +332,6 @@
 Many thanks to Ronald Lamprecht for this musical masterpiece.
 </p>
 
-<p><i>NObby</i><p>
+<p><i>NObby</i></p>
 
 </div>

Copied: homepage/input/lotm/lotm_200805.html (from rev 1133, feature_branches/hp_lotm/input/lotm/lotm_200805.html)

Copied: homepage/input/lotm/lotm_200805_de.html (from rev 1133, feature_branches/hp_lotm/input/lotm/lotm_200805_de.html)

Copied: homepage/input/lotm/lotm_200805_ru.html (from rev 1133, feature_branches/hp_lotm/input/lotm/lotm_200805_ru.html)

Modified: homepage/input/lotm/lotm_archive_data.lua
===================================================================
--- homepage/input/lotm/lotm_archive_data.lua	2008-05-09 20:03:32 UTC (rev 1133)
+++ homepage/input/lotm/lotm_archive_data.lua	2008-05-09 20:24:18 UTC (rev 1134)
@@ -121,26 +121,36 @@
   position_num   = "6077"
 }
 
+lotm_archive_data[14] = {
+  date           = { month = 5, year = 2008 },
+  chronological  = 14,
+  name           = "Pleasure Garden",
+  author         = "Jacob Scott",
+  position       = "VI/95",
+  position_num   = "6095"
+}
+
 -- LotM variable data
 -- format: Level Title, current_rating, current_votes, additional text
 
-lotm_rating(    "Island Labyrinth",  9.20,  10,  "")
-lotm_rating(  "Pneumatic Delivery",  8.07,  14,  "")
+lotm_rating(    "Island Labyrinth",  9.27,  11,  "")
+lotm_rating(  "Pneumatic Delivery",  8.13,  15,  "")
 lotm_rating(    "The Aztec Temple",  9.00,  11,  "")
 lotm_rating("Labyrinth of Puzzles",  8.81,  16,  "")
-lotm_rating(           "Elaborate",  8.63,   8,  "")
-lotm_rating(             "Houdini",  9.18,  10,  "")
+lotm_rating(           "Elaborate",  8.44,   9,  "")
+lotm_rating(             "Houdini",  9.22,   7,  "")
 lotm_rating(           "Tool Time",  8.52,  21,  "")
 lotm_rating(         "Quadropolis",  9.20,  10,  "")
 lotm_rating(      "Big Adventures",  8.39,  23,  "")
-lotm_rating(      "Temple of Gold",  9.17,   6,  "")
+lotm_rating(      "Temple of Gold",  9.29,   7,  "")
 lotm_rating(      "Puzzle Puzzles",  8.83,   6,  "")
-lotm_rating(      "Psycho Pushing",  8.38,   8,  "")
-lotm_rating(  "Turnstiles for Two",  9.00,   5,  "<b>(newcomer)</b>")
+lotm_rating(      "Psycho Pushing",  8.20,  10,  "")
+lotm_rating(  "Turnstiles for Two",  9.00,   4,  "")
+lotm_rating(     "Pleasure Garden",  8.36,  14,  "<b>(newcomer)</b>")
 
 -- Don't forget to adjust the archive dates:
 
-lotm_archive_data_from = { month = 2, year = 2008 }
+lotm_archive_data_from = { month = 3, year = 2008 }
 
 lotm_current = lotm_archive_data[table.getn(lotm_archive_data)]
 



From andreasl at mail.berlios.de  Fri May  9 22:39:58 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Fri, 9 May 2008 22:39:58 +0200
Subject: [Enigma-game-svn] r1135 - homepage/input/lotm
Message-ID: <200805092039.m49Kdwjn007450@sheep.berlios.de>

Author: andreasl
Date: 2008-05-09 22:39:57 +0200 (Fri, 09 May 2008)
New Revision: 1135

Modified:
   homepage/input/lotm/lotm_200805.html
   homepage/input/lotm/lotm_200805_de.html
   homepage/input/lotm/lotm_200805_ru.html
Log:
Homepage:
 - Added one more level to the article request.
   (No translation neccessary.)


Modified: homepage/input/lotm/lotm_200805.html
===================================================================
--- homepage/input/lotm/lotm_200805.html	2008-05-09 20:24:18 UTC (rev 1134)
+++ homepage/input/lotm/lotm_200805.html	2008-05-09 20:39:57 UTC (rev 1135)
@@ -234,6 +234,7 @@
 <li>&quot;Industrial Puzzles&quot; by Raoul Bourquin</li>
 <li>&quot;Plan Ahead&quot; by Jacob Scott</li>
 <li>&quot;Block its way!&quot; by Jon 'WB' Sneyers</li>
+<li>&quot;River of Challenges&quot; by Lukas Sch&uuml;ller</li>
 </ul>
 <p>Many thanks in advance, only your help can keep the LotM alive!</p>
 

Modified: homepage/input/lotm/lotm_200805_de.html
===================================================================
--- homepage/input/lotm/lotm_200805_de.html	2008-05-09 20:24:18 UTC (rev 1134)
+++ homepage/input/lotm/lotm_200805_de.html	2008-05-09 20:39:57 UTC (rev 1135)
@@ -245,6 +245,7 @@
 <li>&quot;Industrial Puzzles&quot; von Raoul Bourquin</li>
 <li>&quot;Plan Ahead&quot; von Jacob Scott</li>
 <li>&quot;Block its way!&quot; von Jon 'WB' Sneyers</li>
+<li>&quot;River of Challenges&quot; von Lukas Sch&uuml;ller</li>
 </ul>
 <p>Vielen Dank im voraus, nur Ihre Mithilfe kann den LdM am Leben erhalten!</p>
 

Modified: homepage/input/lotm/lotm_200805_ru.html
===================================================================
--- homepage/input/lotm/lotm_200805_ru.html	2008-05-09 20:24:18 UTC (rev 1134)
+++ homepage/input/lotm/lotm_200805_ru.html	2008-05-09 20:39:57 UTC (rev 1135)
@@ -221,6 +221,7 @@
 <li>&quot;Industrial Puzzles&quot; ?? Raoul Bourquin</li>
 <li>&quot;Plan Ahead&quot; ?? Jacob Scott</li>
 <li>&quot;Block its way!&quot; ?? Jon 'WB' Sneyers</li>
+<li>&quot;River of Challenges&quot; ?? Lukas Sch&uuml;ller</li>
 </ul>
 <p>??????? ??????? ???????, ?????? ???? ?????? ???????? ????????? ?????? ??!</p>
 



From andreasl at mail.berlios.de  Sat May 10 00:02:58 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Sat, 10 May 2008 00:02:58 +0200
Subject: [Enigma-game-svn] r1136 - in homepage: images/lotm input/lotm
Message-ID: <200805092202.m49M2w29014078@sheep.berlios.de>

Author: andreasl
Date: 2008-05-10 00:02:55 +0200 (Sat, 10 May 2008)
New Revision: 1136

Modified:
   homepage/images/lotm/lotm-history.png
   homepage/input/lotm/lotm_archive_data.lua
Log:
Homepage:
 - Updated LotM archive and diagram


Modified: homepage/images/lotm/lotm-history.png
===================================================================
(Binary files differ)

Modified: homepage/input/lotm/lotm_archive_data.lua
===================================================================
--- homepage/input/lotm/lotm_archive_data.lua	2008-05-09 20:39:57 UTC (rev 1135)
+++ homepage/input/lotm/lotm_archive_data.lua	2008-05-09 22:02:55 UTC (rev 1136)
@@ -133,24 +133,24 @@
 -- LotM variable data
 -- format: Level Title, current_rating, current_votes, additional text
 
-lotm_rating(    "Island Labyrinth",  9.27,  11,  "")
-lotm_rating(  "Pneumatic Delivery",  8.13,  15,  "")
+lotm_rating(    "Island Labyrinth",  9.31,  13,  "(1 up)")
+lotm_rating(  "Pneumatic Delivery",  8.19,  16,  "(1 up)")
 lotm_rating(    "The Aztec Temple",  9.00,  11,  "")
-lotm_rating("Labyrinth of Puzzles",  8.81,  16,  "")
-lotm_rating(           "Elaborate",  8.44,   9,  "")
-lotm_rating(             "Houdini",  9.22,   7,  "")
+lotm_rating("Labyrinth of Puzzles",  8.82,  17,  "")
+lotm_rating(           "Elaborate",  8.50,  10,  "")
+lotm_rating(             "Houdini",  9.28,   8,  "")
 lotm_rating(           "Tool Time",  8.52,  21,  "")
 lotm_rating(         "Quadropolis",  9.20,  10,  "")
-lotm_rating(      "Big Adventures",  8.39,  23,  "")
-lotm_rating(      "Temple of Gold",  9.29,   7,  "")
+lotm_rating(      "Big Adventures",  8.42,  24,  "")
+lotm_rating(      "Temple of Gold",  9.29,   7,  "(1 down)")
 lotm_rating(      "Puzzle Puzzles",  8.83,   6,  "")
-lotm_rating(      "Psycho Pushing",  8.20,  10,  "")
-lotm_rating(  "Turnstiles for Two",  9.00,   4,  "")
-lotm_rating(     "Pleasure Garden",  8.36,  14,  "<b>(newcomer)</b>")
+lotm_rating(      "Psycho Pushing",  8.18,  11,  "(1 down)")
+lotm_rating(  "Turnstiles for Two",  9.00,   5,  "")
+lotm_rating(     "Pleasure Garden",  8.43,  14,  "<b>(newcomer)</b>")
 
 -- Don't forget to adjust the archive dates:
 
-lotm_archive_data_from = { month = 3, year = 2008 }
+lotm_archive_data_from = { month = 4, year = 2008 }
 
 lotm_current = lotm_archive_data[table.getn(lotm_archive_data)]
 



From ral at mail.berlios.de  Sat May 10 12:55:06 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 10 May 2008 12:55:06 +0200
Subject: [Enigma-game-svn] r1137 - in trunk/src: . stones
Message-ID: <200805101055.m4AAt6VE026541@sheep.berlios.de>

Author: ral
Date: 2008-05-10 12:55:05 +0200 (Sat, 10 May 2008)
New Revision: 1137

Modified:
   trunk/src/GridObject.cc
   trunk/src/GridObject.hh
   trunk/src/stones/WindowStone.cc
   trunk/src/stones/WindowStone.hh
   trunk/src/world.cc
Log:
Trunk 1.1: Window Stone
- fix problems of invisible actors moving from inside blue windows into
  not transparent neighbors
- move actors on face movements just as far as necessary
- move even actors on neighbor grids that would otherwise intersect the face
- replace item on window grid by a squashed on face move, if an item is on
  the neighbor grid


Modified: trunk/src/GridObject.cc
===================================================================
--- trunk/src/GridObject.cc	2008-05-09 22:02:55 UTC (rev 1136)
+++ trunk/src/GridObject.cc	2008-05-10 10:55:05 UTC (rev 1137)
@@ -172,7 +172,7 @@
             return NODIRBIT;
     }
     
-    DirectionBits GridObject::getFaces() const {
+    DirectionBits GridObject::getFaces(bool actorUnvisible) const {
         return DirectionBits(ALL_DIRECTIONS ^ getConnections());
     }
     

Modified: trunk/src/GridObject.hh
===================================================================
--- trunk/src/GridObject.hh	2008-05-09 22:02:55 UTC (rev 1136)
+++ trunk/src/GridObject.hh	2008-05-10 10:55:05 UTC (rev 1137)
@@ -106,7 +106,7 @@
         display::Model *set_anim (const std::string &mname);
 
         DirectionBits getConnections() const;
-        DirectionBits getFaces() const;
+        virtual DirectionBits getFaces(bool actorInvisible = false) const;
         
 
     protected:

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-05-09 22:02:55 UTC (rev 1136)
+++ trunk/src/stones/WindowStone.cc	2008-05-10 10:55:05 UTC (rev 1137)
@@ -21,7 +21,8 @@
 #include "stones/WindowStone.hh"
 #include "actors.hh"
 #include "items.hh"
-//#include "main.hh"
+#include "main.hh"
+#include "player.hh"
 #include "server.hh"
 #include "world.hh"
 #include <vector>
@@ -88,6 +89,13 @@
         // ignore any state access
     }
 
+    DirectionBits WindowStone::getFaces(bool actorInvisible) const {
+        if (!actorInvisible || objFlags & OBJBIT_SECURE)
+            return Stone::getFaces(actorInvisible);
+        else
+            return NODIRBIT;
+    }
+    
     void WindowStone::init_model() {
         if (state == IDLE) {   // anims will not be cleared 
             if (getFaces() == NODIRBIT) {   // a tease of level author tried to set a faceless window!
@@ -128,13 +136,13 @@
             
             else if (player::WieldedItemIs (sc.actor, "it_wrench")) {
                 if (sc.faces == WESTBIT && sc.normal[0] < 0){
-                    tryInnerPull(EAST);
+                    tryInnerPull(EAST, a);
                 } else if (sc.faces == EASTBIT && sc.normal[0] > 0) {
-                    tryInnerPull(WEST);
+                    tryInnerPull(WEST, a);
                 } else if (sc.faces == SOUTHBIT && sc.normal[1] > 0) {
-                    tryInnerPull(NORTH);
+                    tryInnerPull(NORTH, a);
                 } else if (sc.faces == NORTHBIT && sc.normal[1] < 0) {
-                    tryInnerPull(SOUTH);
+                    tryInnerPull(SOUTH, a);
                 }
             } else if (player::WieldedItemIs (sc.actor, "it-ring")) {
                 objFlags |= (sc.faces << 24);   // scratch face
@@ -177,10 +185,13 @@
             KillItem(get_pos());
     }
     
-    bool WindowStone::tryInnerPull(Direction dir) {
+    bool WindowStone::tryInnerPull(Direction dir, Actor *initiator) {
         DirectionBits faces = getFaces();
+        GridPos w_pos(get_pos());
+        GridPos w_pos_neighbor = move(w_pos, dir);
+        
         if (!has_dir(faces, dir) && has_dir(faces, reverse(dir))){
-            Stone *stone = GetStone(move(get_pos(), dir));
+            Stone *stone = GetStone(w_pos_neighbor);
             if (!stone || ((stone->get_traits().id == st_window) &&  
                     !has_dir(stone->getFaces(), reverse(dir)))) {
                 DirectionBits remainigFaces = (DirectionBits)((faces & ~to_bits(reverse(dir)))
@@ -193,24 +204,35 @@
                 objFlags &= ~(to_bits(reverse(dir)) << 24);  // remove scratch mark from old position
                 
                 // move items
-                Item *it = GetItem(get_pos());
+                Item *it = GetItem(w_pos);
+                Item *it_neighbor = GetItem(w_pos_neighbor);
                 if (it != NULL && !it->isStatic())
-                    SetItem(move(get_pos(), dir), YieldItem(get_pos()));
+                    if (it_neighbor == NULL)
+                        SetItem(w_pos_neighbor, YieldItem(w_pos));
+                    else
+                        SetItem(w_pos, MakeItem(it_squashed));
                 
                 // move actors
                 std::vector<Actor*> found_actors;
-                const double range_one_field = 1.415; // approx. 1 field [ > sqrt(1+1) ]
+                const double range_one_field = 1.415 + Actor::get_max_radius(); // approx. 1 field [ > sqrt(1+1) ]
                 GetActorsInRange(get_pos().center(), range_one_field, found_actors);
                 std::vector<Actor*>::iterator e = found_actors.end();
                 for (std::vector<Actor*>::iterator i = found_actors.begin(); i != e; ++i) {
-                    Actor   *actor     = *i;
-                    GridPos  actor_pos(actor->get_pos());
-                    if (actor_pos == get_pos()) { // if the actor is in the field
-                        V2 dest = actor->get_pos();
-                        // we do not have to worry about the level border as no face can be pushed to the border
-                        dest[0] += (dir == EAST) ? 1 : (dir == WEST) ? -1 : 0;
-                        dest[1] += (dir == SOUTH) ? 1 : (dir == NORTH) ? -1 : 0;
-                        WarpActor(actor, dest[0], dest[1], true);
+                    Actor *a = *i;
+                    if (a != initiator) {
+                        V2 dest = a->get_pos();
+                        GridPos a_pos(dest);
+                        double r = get_radius(a);
+                        if ((a_pos == w_pos)  // if the actor is in the field
+                                || ((dir == EAST) && (dest[0] - r < w_pos.x + 1) && (a_pos == w_pos_neighbor))
+                                || ((dir == WEST) && (dest[0] + r > w_pos.x) && (a_pos == w_pos_neighbor))
+                                || ((dir == SOUTH) && (dest[1] - r < w_pos.y + 1) && (a_pos == w_pos_neighbor))
+                                || ((dir == NORTH) && (dest[1] + r > w_pos.y) && (a_pos == w_pos_neighbor))) {
+                            // we do not have to worry about the level border as no face can be pushed to the border
+                            dest[0] = (dir == EAST) ? (w_pos.x + 1 + r) : ((dir == WEST) ? (w_pos.x - r) : dest[0]);
+                            dest[1] = (dir == SOUTH) ? (w_pos.y + 1 + r): ((dir == NORTH) ? (w_pos.y - r) : dest[1]);
+                            WarpActor(a, dest[0], dest[1], true);
+                        }
                     }
                 }
                 

Modified: trunk/src/stones/WindowStone.hh
===================================================================
--- trunk/src/stones/WindowStone.hh	2008-05-09 22:02:55 UTC (rev 1136)
+++ trunk/src/stones/WindowStone.hh	2008-05-10 10:55:05 UTC (rev 1137)
@@ -21,12 +21,9 @@
 #define WINDOWSTONE_HH_INCLUDED
 
 #include "stones.hh"
-#include "stones/ConnectiveStone.hh"
 
 #include "actors.hh"
-#include "player.hh"
 #include "stones_internal.hh"
-#include "world.hh"
 
 /* -------------------- Window -------------------- */
 
@@ -62,6 +59,7 @@
         virtual void setState(int extState);
        
         // GridObject interface
+        virtual DirectionBits getFaces(bool actorInvisible = false) const;
         virtual void init_model();
 
         // ModelCallback interface
@@ -77,7 +75,7 @@
 
     private:
         void breakFaces(DirectionBits faces);
-        bool tryInnerPull(Direction dir);
+        bool tryInnerPull(Direction dir, Actor *initiator = NULL);
     };
 
 } // namespace enigma

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-05-09 22:02:55 UTC (rev 1136)
+++ trunk/src/world.cc	2008-05-10 10:55:05 UTC (rev 1137)
@@ -631,7 +631,7 @@
     bool isWindow = stone->get_traits().id == st_window;
     DirectionBits wsides;
     if (isWindow) {
-        wsides = stone->getFaces();
+        wsides = stone->getFaces(a->is_invisible());
     }
     
     const ActorInfo &ai = *a->get_actorinfo();
@@ -681,7 +681,7 @@
             // the faces that the neighbour window owns
             Stone * neighbour = GetStone(GridPos(x+xoff_neighbour, y+yoff_neighbour));
             DirectionBits face_neighbour = (neighbour != NULL && neighbour->get_traits().id == st_window) 
-                    ? neighbour->getFaces() : NODIRBIT;
+                    ? neighbour->getFaces(a->is_invisible()) : NODIRBIT;
             
             
             if ((winFacesActorStone&face) && !(face_neighbour&face)) {
@@ -947,7 +947,7 @@
     // contacts within the grid
     Stone * actorWinStone = GetStone(g);
     DirectionBits winFacesActorStone = (actorWinStone != NULL && actorWinStone->get_traits().id == st_window)
-            ? actorWinStone->getFaces() : NODIRBIT;
+            ? actorWinStone->getFaces(a->is_invisible()) : NODIRBIT;
     
     // distinguish 9 squares within gridpos that may cause contacts
     // low cost reduction of cases that need to be examined in detail:



From ral at mail.berlios.de  Sat May 10 22:27:18 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 10 May 2008 22:27:18 +0200
Subject: [Enigma-game-svn] r1138 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 src src/stones
Message-ID: <200805102027.m4AKRIGj012792@sheep.berlios.de>

Author: ral
Date: 2008-05-10 22:27:18 +0200 (Sat, 10 May 2008)
New Revision: 1138

Modified:
   trunk/data/gfx32/sh_window.png
   trunk/data/gfx40/sh_window.png
   trunk/data/gfx48/sh_window.png
   trunk/data/models-2d.lua
   trunk/data/models.lua
   trunk/src/ObjectValidator.cc
   trunk/src/stones/WindowStone.cc
Log:
Trunk 1.1: Window Stone
- shadows with scratch visualization
- block validator logs
Note:
- model lua code needs cleanup to minimize resources.


Modified: trunk/data/gfx32/sh_window.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/sh_window.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/sh_window.png
===================================================================
(Binary files differ)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-05-10 10:55:05 UTC (rev 1137)
+++ trunk/data/models-2d.lua	2008-05-10 20:27:18 UTC (rev 1138)
@@ -1184,38 +1184,90 @@
 do
     local fg_window_blue = DefSubimages("st_window_blue", {modelname="fg-window_blue",w=4,h=4})
     local fg_window_green = DefSubimages("st_window_green", {modelname="fg-window_green",w=4,h=4})
-    local sh_window = DefSubimages("sh_window", {modelname="sh-window",w=4,h=4,imgw=ShadowSize,imgh=ShadowSize})
-
-    for i = 2, 16 do  -- faces + 1
-        DefShModel("st_window_blue"..(16-i), "fg-window_blue"..i, "sh-window"..i)
-        DefShModel("st_window_green"..(16-i), "fg-window_green"..i, "sh-window"..i)
-    end
-    -- 4 sided window stone:
-    DefAlias("st_window_blue","st_window_blue0")
-    DefAlias("st_window_green","st_window_green0")
-
-    -- Breaking animimation:
-    local breaking_window_blue_names = {}
-    local breaking_window_green_names = {}
+    local sh_windowx = DefSubimages("sh_window", {modelname="sh-windowx",w=2,h=4,imgw=ShadowSize,imgh=ShadowSize})
     local breaking_images_blue = DefSubimages("st_window_blue_break", {h=4})
     local breaking_images_green = DefSubimages("st_window_green_break", {h=4})
+    
+    local faces = 0
+    local broken = 0
+    local shadows = {}
+    for W = 0, 1 do
+      local Wfaces = faces
+      for S = 0, 1 do
+        local Sfaces = faces
+        local shadows = shadows
+        for E = 0, 1 do
+          local Efaces = faces
+          local shadows = shadows
+          for N = 0, 1 do
+            local Nfaces = faces
+            local shadows = shadows
+            for w = 0, 1-W do
+              local wbroken = broken
+              local shadows = shadows
+              for s = 0, 1-S do
+                local sbroken = broken
+                local shadows = shadows
+                for e = 0, 1-E do
+                  local ebroken = broken
+                  local shadows = shadows
+                  for n = 0, 1-N do
+                    local nbroken = broken
+                    local shadows = {}
+                    if W==1 then table.insert(shadows,"sh-windowx1") end
+                    if S==1 then table.insert(shadows,"sh-windowx2") end
+                    if E==1 then table.insert(shadows,"sh-windowx3") end
+                    if N==1 then table.insert(shadows,"sh-windowx4") end
+                    if w==1 then table.insert(shadows,"sh-windowx5") end
+                    if s==1 then table.insert(shadows,"sh-windowx6") end
+                    if e==1 then table.insert(shadows,"sh-windowx7") end
+                    if n==1 then table.insert(shadows,"sh-windowx8") end
+                    DefMultipleComposite("sh-windowx"..faces.."-"..broken, shadows)
+                    DefShModel("st_window_blue"..faces.."_"..broken, "fg-window_blue"..(faces+broken+1), "sh-windowx"..faces.."-"..broken)
+                    DefShModel("st_window_green"..faces.."_"..broken, "fg-window_green"..(faces+broken+1), "sh-windowx"..faces.."-"..broken)
 
-    for i=1, table.getn(fg_window_blue) do   -- faces + 1
-        breaking_window_blue_names[i] = {}
-        breaking_window_green_names[i] = {}
-        for j = 1, table.getn(breaking_images_blue) do
-            breaking_window_blue_names[i][j] = "st-window_blue_breaking"..i.."-"..j
-            breaking_window_green_names[i][j] = "st-window_green_breaking"..i.."-"..j
-            display.DefineComposite(breaking_window_blue_names[i][j], fg_window_blue[i], breaking_images_blue[j])
-            display.DefineComposite(breaking_window_green_names[i][j], fg_window_green[i], breaking_images_green[j])
+                    local breaking_window_blue_names = {}
+                    local breaking_window_green_names = {}
+                    for j = 1, table.getn(breaking_images_blue) do
+                        breaking_window_blue_names[j] = "st-window_blue_breaking"..faces.."_"..broken.."-"..j
+                        breaking_window_green_names[j] = "st-window_green_breaking"..faces.."_"..broken.."-"..j
+                        display.DefineComposite(breaking_window_blue_names[j], fg_window_blue[faces+broken+1], breaking_images_blue[j])
+                        display.DefineComposite(breaking_window_green_names[j], fg_window_green[faces+broken+1], breaking_images_green[j])
+                    end
+                    local frames_blue = BuildFrames(breaking_window_blue_names, 130)
+                    local frames_green = BuildFrames(breaking_window_green_names, 130)
+                    DefAnim("st-window_blue"..faces.."_"..broken.."_anim_fg", frames_blue)
+                    DefAnim("st-window_green"..faces.."_"..broken.."_anim_fg", frames_green)
+                    DefShModel("st_window_blue"..faces.."_"..broken.."_anim", "st-window_blue"..faces.."_"..broken.."_anim_fg", "sh-windowx"..faces.."-"..broken);
+                    DefShModel("st_window_green"..faces.."_"..broken.."_anim", "st-window_green"..faces.."_"..broken.."_anim_fg", "sh-windowx"..faces.."-"..broken);
+
+
+                    table.insert(shadows,"sh-windowx8")
+                    broken = nbroken + 8
+                  end
+                  table.insert(shadows,"sh-windowx7")
+                  broken = ebroken + 4
+                end
+                table.insert(shadows,"sh-windowx6")
+                broken = sbroken + 2
+              end
+              table.insert(shadows,"sh-windowx5")
+              broken = wbroken + 1
+            end
+            table.insert(shadows,"sh-windowx4")
+            broken = 0
+            faces = Nfaces + 8
+          end
+          table.insert(shadows,"sh-windowx3")
+          faces = Efaces + 4
         end
-        local frames_blue = BuildFrames(breaking_window_blue_names[i], 130)
-        local frames_green = BuildFrames(breaking_window_green_names[i], 130)
-        DefAnim("st-window_blue"..(16-i).."_anim_fg", frames_blue)
-        DefAnim("st-window_green"..(16-i).."_anim_fg", frames_green)
-        DefShModel("st_window_blue"..(16-i).."_anim", "st-window_blue"..(16-i).."_anim_fg", sh_window[i]);
-        DefShModel("st_window_green"..(16-i).."_anim", "st-window_green"..(16-i).."_anim_fg", sh_window[i]);
+        table.insert(shadows,"sh-windowx2")
+        faces = Sfaces + 2
+      end
+      table.insert(shadows,"sh-windowx1")
+      faces = Wfaces + 1
     end
+    
 end
 
 -----------------

Modified: trunk/data/models.lua
===================================================================
--- trunk/data/models.lua	2008-05-10 10:55:05 UTC (rev 1137)
+++ trunk/data/models.lua	2008-05-10 20:27:18 UTC (rev 1138)
@@ -410,15 +410,18 @@
 function DefMultipleComposite(name, imglist)
     -- Assert imglist >= 1!
     local listsize = table.getn(imglist)
-    if listsize == 1 then
-        display.DefineComposite(name, imglist[1], imglist[1])
+    if listsize == 0 then
+        DefAlias(name, "invisible")
+    elseif listsize == 1 then
+        DefAlias(name, imglist[1])
     elseif listsize == 2 then
         display.DefineComposite(name, imglist[1], imglist[2])
     elseif listsize > 2 then
-        display.DefineComposite(name, imglist[1], imglist[2])
-        for i = 3, table.getn(imglist) do
-            display.DefineComposite(name, name, imglist[i])
+        display.DefineComposite(name.."-2", imglist[1], imglist[2])
+        for i = 3, table.getn(imglist)-1 do
+            display.DefineComposite(name.."-"..i, name.."-"..(i-1), imglist[i])
         end
+        display.DefineComposite(name, name.."-"..(table.getn(imglist)-1), imglist[table.getn(imglist)])
     end
 end
 

Modified: trunk/src/ObjectValidator.cc
===================================================================
--- trunk/src/ObjectValidator.cc	2008-05-10 10:55:05 UTC (rev 1137)
+++ trunk/src/ObjectValidator.cc	2008-05-10 20:27:18 UTC (rev 1138)
@@ -286,7 +286,7 @@
         
         AttributeDescriptor *attr = new AttributeDescriptor(name, valType, defaultValue, allowRead, allowWrite, minVal, maxVal);
         defaultAttributes[name] = attr;
-        Log << "Default Attribute " << name << "\n";
+//        Log << "Default Attribute " << name << "\n";
     }
     
     void ObjectValidator::scanMessageElement(DOMElement *msgElement) {
@@ -360,7 +360,7 @@
             }
         }
         
-        kd->log();
+//        kd->log();
     }
     
     Value ObjectValidator::parseTypedValue(const XMLCh* xmlSource, const std::string &strSource, validationType type) {

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-05-10 10:55:05 UTC (rev 1137)
+++ trunk/src/stones/WindowStone.cc	2008-05-10 20:27:18 UTC (rev 1138)
@@ -102,7 +102,10 @@
                 KillStone(get_pos());
                 return;
             }
-            set_model(ecl::strf("st_window_%s%d", objFlags & OBJBIT_SECURE ? "green" : "blue" , getConnections()));
+            uint32_t scratchDirs = ((objFlags & OBJBIT_SCRATCHDIRS) >> 24);
+            set_model(ecl::strf("st_window_%s%d_%d", objFlags & OBJBIT_SECURE ? "green" : "blue" , 
+                    getFaces() & ~scratchDirs, scratchDirs));
+                    
         }
     }
 
@@ -117,7 +120,7 @@
     
     void WindowStone::actor_hit(const StoneContact &sc) {
         Actor *a = sc.actor;
-        
+            
         if (state == IDLE) {
             double impulse = -(a->get_vel() * sc.normal) * get_mass(a);
             double threshold = 22;
@@ -145,8 +148,9 @@
                     tryInnerPull(SOUTH, a);
                 }
             } else if (player::WieldedItemIs (sc.actor, "it-ring")) {
-                objFlags |= (sc.faces << 24);   // scratch face
+                objFlags |= ((sc.faces & getFaces())<< 24) ;   // scratch face
                 sound_event("crack");
+                init_model();
             }
         }
     }
@@ -180,7 +184,10 @@
         Object::setAttr("$connections", ALL_DIRECTIONS ^ remainigFaces);     // avoid init of model
         sound_event("shatter");
         state = (remainigFaces == NODIRBIT) ? FINALBREAK : BREAK;
-        set_anim(ecl::strf("st_window_%s%d_anim",  objFlags & OBJBIT_SECURE ? "green" : "blue", getConnections()));
+        
+        uint32_t scratchDirs = ((objFlags & OBJBIT_SCRATCHDIRS) >> 24);
+        set_anim(ecl::strf("st_window_%s%d_%d_anim",  objFlags & OBJBIT_SECURE ? "green" : "blue",
+            getFaces() & ~scratchDirs, scratchDirs));
         if (server::GameCompatibility == GAMET_OXYD1)
             KillItem(get_pos());
     }
@@ -197,11 +204,11 @@
                 DirectionBits remainigFaces = (DirectionBits)((faces & ~to_bits(reverse(dir)))
                         |to_bits(dir));  // move face
                 Object::setAttr("$connections", ALL_DIRECTIONS ^ remainigFaces);     // avoid init of model
-                init_model();
                 // transfer scratches
                 if (((objFlags & OBJBIT_SCRATCHDIRS) >> 24) & to_bits(reverse(dir)))
                     objFlags |= ((to_bits(dir)) << 24);       // mark moved face as scratched
                 objFlags &= ~(to_bits(reverse(dir)) << 24);  // remove scratch mark from old position
+                init_model();
                 
                 // move items
                 Item *it = GetItem(w_pos);



From ral at mail.berlios.de  Sun May 11 13:00:24 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 11 May 2008 13:00:24 +0200
Subject: [Enigma-game-svn] r1139 - in trunk: data/schemas doc/reference src
	src/stones
Message-ID: <200805111100.m4BB0OWH002183@sheep.berlios.de>

Author: ral
Date: 2008-05-11 13:00:15 +0200 (Sun, 11 May 2008)
New Revision: 1139

Modified:
   trunk/data/schemas/objects.xml
   trunk/doc/reference/enigma-ref.texi
   trunk/src/items.cc
   trunk/src/stones/WindowStone.cc
Log:
Trunk 1.1: Window Stone
- add rw attribute "scratches" - values "nesw" like faces
- refman update and some typo fixes
- fix it-dynamite: make it static while burning


Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-05-10 20:27:18 UTC (rev 1138)
+++ trunk/data/schemas/objects.xml	2008-05-11 11:00:15 UTC (rev 1139)
@@ -31,6 +31,7 @@
     <attr name="range" type="double" default="1.0" rw="rw"/>
     <attr name="secure" type="bool" default="false" rw="rw"/>
     <attr name="scissor" type="bool" default="true" rw="rw"/>
+    <attr name="scratches" type="string" default="" rw="rw"/>
     <attr name="state" type="int" default="0" min="0" max="1" rw="rw"/>
     <attr name="static" type="bool" default="false" rw="rw"/>
     <attr name="strength" type="double" default="1" rw="rw"/>
@@ -496,6 +497,7 @@
     </object>
     <object name="st_window">
       <attr name="faces" default="s"/>
+      <attr name="scratches"/>
       <attr name="secure"/>
       <msg name="inner_pull"/>
       <msg name="_explosion"/>

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-05-10 20:27:18 UTC (rev 1138)
+++ trunk/doc/reference/enigma-ref.texi	2008-05-11 11:00:15 UTC (rev 1139)
@@ -2707,7 +2707,7 @@
 
 A position of an actor like the black marble needs to be given by two floating
 numbers as coordinates like @{1.5,@ 2.5@} for an actor positioned in the center
-of the tile that is one row right and two columns down of the upper left corner
+of the tile that is one column right and two rows down of the upper left corner
 tile.
 
 @cindex grid position
@@ -2750,7 +2750,7 @@
 may burn. A whole set of attributes let you control the details of the fire
 behaviour.
 
-The item layer is shared between items that an actor can pickup and items that
+The item layer is shared between items that an actor can pick up and items that
 are static. The first category are items like keys, banana, etc. Static items
 are bombs, landmines, triggers, hollows and items that will only be set by the
 system itself like laserbeams, fire animations, ash, etc. As only one item can
@@ -2840,7 +2840,7 @@
 position.
 
 With an object reference, that is of a special Lua type @samp{object}, you can
-request the objects on its current state and attributes, modifiy the
+request the objects on its current state and attributes, modify the
 object, send messages or perform any supported methods of the object.
 
 Objects can be grouped for efficient handling of common operations on
@@ -5443,6 +5443,8 @@
 at least one face are possible. There exist two versions of windows, normal
 blue colored glass and green colored saftey glass, that is nearly undistructable.
 Saftey glass is seleted by setting the attribute @samp{secure} to @samp{true}.
+Every glass face can be weakened by @samp{scratches} which are visible in the
+shadows.
 
 All windows are transparent to laser light.
 
@@ -5467,7 +5469,8 @@
 of a stone. Just another window stone without an adjacent window face is allowed
 on this position. The reason is, that the moving window face will push
 non static items and any actors positioned on the affected window grid to the
-next grid.
+next grid. If this grid is already occupied by an item, the window grid item
+will be @ref{it_squashed}.
 
 Window face rearrangements can also be initiated by an @ref{it_puller} dropped 
 within the window and by the message @samp{inner_pull}.
@@ -5479,10 +5482,14 @@
 @table @asis
 @item @b{faces} @ @ @i{values}: string; @ @ @i{default}: @code{"s"}
 Describes the window faces of the stone. The string is a substring of 
- at samp{"nesw"} listing the faces. The sequence of the sides, north, east, south,
+ at code{"nesw"} listing the faces. The sequence of the sides, north, east, south,
 west, is guaranteed on read access but arbitrary on write access.
 @item @b{secure} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 Green saftey glass is secure, whereas normal blue is not.
+ at item @b{scatches} @ @ @i{values}: string; @ @ @i{default}: @code{""}
+Describes the scratched window faces of the stone. The string is a substring of 
+ at code{"nesw"} listing the affected faces. The sequence of the sides, north, east,
+south, west, is guaranteed on read access but arbitrary on write access.
 @end table
 
 @item @b{Messages:}

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-05-10 20:27:18 UTC (rev 1138)
+++ trunk/src/items.cc	2008-05-11 11:00:15 UTC (rev 1139)
@@ -1244,6 +1244,10 @@
             }
         }
 
+        virtual bool isStatic() const {
+            return state == BURNING;  // burning dynamite cannot be picked up
+        }
+
         void explode () {
             GridPos p = get_pos();
             SendExplosionEffect(p, EXPLOSION_DYNAMITE);

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-05-10 20:27:18 UTC (rev 1138)
+++ trunk/src/stones/WindowStone.cc	2008-05-11 11:00:15 UTC (rev 1139)
@@ -45,6 +45,18 @@
                     init_model();
                 return;
             }
+        } else if (key == "scratches") {
+            int d = NODIRBIT;
+            std::string vs(val);
+            if (vs.find('n') != std::string::npos) d |= NORTHBIT;
+            if (vs.find('e') != std::string::npos) d |= EASTBIT;
+            if (vs.find('s') != std::string::npos) d |= SOUTHBIT;
+            if (vs.find('w') != std::string::npos) d |= WESTBIT;
+            objFlags &= ~OBJBIT_SCRATCHDIRS;
+            objFlags |= ((d & getFaces())<< 24) ;
+            if (isDisplayable())
+                init_model();
+            return;
         }
         Stone::setAttr(key, val);
     }
@@ -52,6 +64,14 @@
     Value WindowStone::getAttr(const std::string &key) const {
         if (key == "secure") {
             return (bool)(objFlags & OBJBIT_SECURE);
+        } else if (key == "scratches") {
+            std::string result;
+            DirectionBits db = (DirectionBits)((objFlags & OBJBIT_SCRATCHDIRS) >> 24);
+            if (db & NORTHBIT) result += "n";
+            if (db & EASTBIT)  result += "e";
+            if (db & SOUTHBIT) result += "s";
+            if (db & WESTBIT)  result += "w";
+            return result;
         }
         return Stone::getAttr(key);
     }
@@ -148,7 +168,7 @@
                     tryInnerPull(SOUTH, a);
                 }
             } else if (player::WieldedItemIs (sc.actor, "it-ring")) {
-                objFlags |= ((sc.faces & getFaces())<< 24) ;   // scratch face
+                objFlags |= ((sc.faces & getFaces())<< 24);   // scratch face
                 sound_event("crack");
                 init_model();
             }



From ral at mail.berlios.de  Mon May 12 12:11:19 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 12 May 2008 12:11:19 +0200
Subject: [Enigma-game-svn] r1140 - trunk/src
Message-ID: <200805121011.m4CABJEG028969@sheep.berlios.de>

Author: ral
Date: 2008-05-12 12:11:18 +0200 (Mon, 12 May 2008)
New Revision: 1140

Modified:
   trunk/src/GridObject.cc
   trunk/src/GridObject.hh
   trunk/src/Object.cc
   trunk/src/Object.hh
   trunk/src/Value.cc
   trunk/src/Value.hh
   trunk/src/actors.cc
   trunk/src/actors.hh
   trunk/src/world.cc
   trunk/src/world.hh
   trunk/src/world_internal.hh
Log:
Trunk 1.1: new API extention
- "@" as prefix of object name in a target or destination group
  selects the nearest candidate to the object itself
  (see test level for usage patterns)


Modified: trunk/src/GridObject.cc
===================================================================
--- trunk/src/GridObject.cc	2008-05-11 11:00:15 UTC (rev 1139)
+++ trunk/src/GridObject.cc	2008-05-12 10:11:18 UTC (rev 1140)
@@ -84,7 +84,7 @@
             return pos;
     }
     
-    bool GridObject::isDisplayable() {
+    bool GridObject::isDisplayable() const {
         return pos.x >= 0;
     }
     
@@ -186,7 +186,38 @@
             deactivatePhoto();
     }
     
+    double GridObject::squareDistance(const Object *other) const {
+        if (isDisplayable()) {
+            const Actor *a = dynamic_cast<const Actor *>(other);
+            if (a != NULL) {
+                ecl::V2 apos = a->get_pos();
+                return (apos[0] - pos.x)*(apos[0] - pos.x) + (apos[1] - pos.y)*(apos[1] - pos.y);
+            }
+            const GridObject *g = dynamic_cast<const GridObject *>(other);
+            if  (g != NULL && g->isDisplayable()) {
+                return (g->pos.x - pos.x)*(g->pos.x -  pos.x) + (g->pos.y -  pos.y)*(g->pos.y -  pos.y);
+            }
+        }
+        return Object::squareDistance(other);  // infinity
+    }
     
+    bool GridObject::isSouthOrEastOf(const Object *other) const {
+        if (isDisplayable()) {
+            const Actor *a = dynamic_cast<const Actor *>(other);
+            if (a != NULL) {
+                ecl::V2 apos = a->get_pos();
+                return (apos[1] < pos.y) || ((apos[1] == pos.y) && (apos[0] < pos.x));
+            }
+            const GridObject *g = dynamic_cast<const GridObject *>(other);
+            if  (g != NULL && g->isDisplayable()) {
+                return (g->pos.y < pos.y) || ((g->pos.y ==  pos.y) && (g->pos.x <  pos.x));
+            } else 
+                return true;  // other GridObject is not on Grid
+        }
+        return false;        
+    }
+    
+    
     // GridObject laser light support
     
     std::list<GridObject *> GridObject::photoSensorList;

Modified: trunk/src/GridObject.hh
===================================================================
--- trunk/src/GridObject.hh	2008-05-11 11:00:15 UTC (rev 1139)
+++ trunk/src/GridObject.hh	2008-05-12 10:11:18 UTC (rev 1140)
@@ -91,7 +91,7 @@
          * updated, too.
          * @return   true if display access is possible, false otherwise
          */
-        bool isDisplayable();
+        bool isDisplayable() const;
 
         // GridObject interface
         
@@ -108,6 +108,8 @@
         DirectionBits getConnections() const;
         virtual DirectionBits getFaces(bool actorInvisible = false) const;
         
+        virtual double squareDistance(const Object *other) const;
+        virtual bool isSouthOrEastOf(const Object *other) const;
 
     protected:
         // GridObject interface

Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2008-05-11 11:00:15 UTC (rev 1139)
+++ trunk/src/Object.cc	2008-05-12 10:11:18 UTC (rev 1140)
@@ -269,7 +269,7 @@
         for (TokenList::iterator tit = targets.begin(); tit != targets.end(); ++tit) {
             action = (ait != actions.end()) ? ait->to_string() : "";
             
-            ObjectList ol = *tit;  // get all objects described by target token
+            ObjectList ol = (*tit).getObjectList(this);  // get all or nearest objects described by target token
             if (ol.size() == 0 || (ol.size() == 1 && ol.front() == NULL)) {  // no target object
                 if ((action == "callback" || action == "") && (tit->getType() == Value::STRING) 
                         && lua::IsFunc(lua::LevelState(), tit->get_string())) {
@@ -335,7 +335,7 @@
             // evaluate destination objects in sequence up to "idx"
             TokenList tl = dest;  // convert any object type value to a tokenlist 
             for (TokenList::iterator tit = tl.begin(); tit != tl.end(); ++tit) {
-                ObjectList ol = *tit;  // convert next token to an objectlist
+                ObjectList ol = (*tit).getObjectList(this);  // convert next token to an objectlist
                 for (ObjectList::iterator oit = ol.begin(); oit != ol.end(); ++oit) {
                     GridObject *go = dynamic_cast<GridObject *>(*oit);  // get the object
                     if (go != NULL) {   // no actors as destination!
@@ -370,4 +370,12 @@
         return OTHER;
     }
     
+    double Object::squareDistance(const Object *other) const {
+        return 1e15;   // inifinity in enigma world
+    }
+    
+    bool Object::isSouthOrEastOf(const Object *other) const {
+        return true;
+    }
+    
 } // namespace enigma

Modified: trunk/src/Object.hh
===================================================================
--- trunk/src/Object.hh	2008-05-11 11:00:15 UTC (rev 1139)
+++ trunk/src/Object.hh	2008-05-12 10:11:18 UTC (rev 1140)
@@ -197,6 +197,8 @@
         virtual ObjectType getObjectType() const;
         void transferName(Object *target);
         virtual void transferIdentity(Object *target);
+        virtual double squareDistance(const Object *other) const;
+        virtual bool isSouthOrEastOf(const Object *other) const;
 
     protected:
         /** This function is used by all triggers, switches etc. that

Modified: trunk/src/Value.cc
===================================================================
--- trunk/src/Value.cc	2008-05-11 11:00:15 UTC (rev 1139)
+++ trunk/src/Value.cc	2008-05-12 10:11:18 UTC (rev 1140)
@@ -283,34 +283,7 @@
     }
     
     Value::operator ObjectList() const {
-        ObjectList result;
-        switch (type) {
-            case STRING:
-                if (std::string(val.str).find_first_of("*?") != std::string::npos) {
-                    // wildcards in object name - we need to add all objects
-                    result = GetNamedGroup(val.str);
-                    break;
-                }
-                // else it is a single object name - fall through
-            case NAMEDOBJECT:
-            case OBJECT:
-                result.push_back(*this);
-                break;
-            case GROUP:
-                std::vector<std::string> vs;
-                ecl::split_copy(std::string(val.str), ',', back_inserter(vs));
-                for (std::vector<std::string>::iterator it = vs.begin(); it != vs.end(); ++it) {
-                    if (it->size() > 0) {
-                        if ((*it)[0] == '#') {
-                            result.push_back(Object::getObject(atoi((*it).c_str() + 1)));
-                        } else {
-                            result.push_back(GetNamedObject(*it));
-                        }
-                    }
-                }
-                break;
-        }
-        return result;
+        return getObjectList(NULL);
     }
     
     Value::operator TokenList() const {
@@ -448,7 +421,38 @@
         }
     }
     
+    ObjectList Value::getObjectList(const Object *reference) const {
+        ObjectList result;
+        switch (type) {
+            case STRING:
+                if (std::string(val.str).find_first_of("*?") != std::string::npos) {
+                    // wildcards in object name - we need to add all objects
+                    result = GetNamedGroup(val.str, reference);
+                    break;
+                }
+                // else it is a single object name - fall through
+            case NAMEDOBJECT:
+            case OBJECT:
+                result.push_back(*this);
+                break;
+            case GROUP:
+                std::vector<std::string> vs;
+                ecl::split_copy(std::string(val.str), ',', back_inserter(vs));
+                for (std::vector<std::string>::iterator it = vs.begin(); it != vs.end(); ++it) {
+                    if (it->size() > 0) {
+                        if ((*it)[0] == '#') {
+                            result.push_back(Object::getObject(atoi((*it).c_str() + 1)));
+                        } else {
+                            result.push_back(GetNamedObject(*it));
+                        }
+                    }
+                }
+                break;
+        }
+        return result;
+    }
     
+    
     int to_int(const Value &v) {
         return v;
     }

Modified: trunk/src/Value.hh
===================================================================
--- trunk/src/Value.hh	2008-05-11 11:00:15 UTC (rev 1139)
+++ trunk/src/Value.hh	2008-05-12 10:11:18 UTC (rev 1140)
@@ -233,6 +233,11 @@
          * for any other value.
          */
         bool to_bool() const;
+        
+        /**
+         * 
+         */
+        ObjectList getObjectList(const Object *reference = NULL) const;
     private:
         void clear();      ///< Release resources and assign type NIL
 

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2008-05-11 11:00:15 UTC (rev 1139)
+++ trunk/src/actors.cc	2008-05-12 10:11:18 UTC (rev 1140)
@@ -285,7 +285,22 @@
     Object::setAttr(key, val);
 }
 
+    double Actor::squareDistance(const Object *other) const {
+        const Actor *a = dynamic_cast<const Actor *>(other);
+        if (a != NULL)
+            return ecl::square(get_pos() - a->get_pos());
+        else
+            return other->squareDistance(this);
+    }
 
+    bool Actor::isSouthOrEastOf(const Object *other) const {
+        const Actor *a = dynamic_cast<const Actor *>(other);
+        if (a != NULL)
+            return (get_pos()[1] > - a->get_pos()[1]) || ((get_pos()[1] ==  a->get_pos()[1]) && (get_pos()[0] > - a->get_pos()[0]));
+        else
+            return !(other->isSouthOrEastOf(this));
+    }
+
 /* -------------------- RotorBase -------------------- */
 
 namespace

Modified: trunk/src/actors.hh
===================================================================
--- trunk/src/actors.hh	2008-05-11 11:00:15 UTC (rev 1139)
+++ trunk/src/actors.hh	2008-05-12 10:11:18 UTC (rev 1140)
@@ -182,6 +182,8 @@
         }
 
         const GridPos &get_gridpos() const { return m_actorinfo.gridpos; }
+        virtual double squareDistance(const Object *other) const;
+        virtual bool isSouthOrEastOf(const Object *other) const;
 
     protected:
         virtual Object::ObjectType getObjectType() const {return Object::ACTOR;}

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-05-11 11:00:15 UTC (rev 1139)
+++ trunk/src/world.cc	2008-05-12 10:11:18 UTC (rev 1140)
@@ -325,21 +325,47 @@
         forces.erase(i);
 }
 
-Object * World::get_named(const string &name)
-{
-    ecl::Dict<Object*>::iterator found = m_objnames.find(name);
+Object * World::get_named(const std::string &name) {
+    std::string wanted = name;
+    if (wanted.size() > 0 && wanted[0] == '@')
+        wanted.erase(0, 1); // erase the leading @ 
+    ecl::Dict<Object*>::iterator found = m_objnames.find(wanted);
     if (found != m_objnames.end()) 
         return found->second;
 //    Log << "Did not find named object: " << name << '\n';
     return NULL;
 }
 
-std::list<Object *> World::get_group(const std::string &tmpl) {
+std::list<Object *> World::get_group(const std::string &tmpl, const Object *reference) {
     std::list<Object *> result;
     ecl::Dict<Object *>::iterator it = m_objnames.begin();
+    std::string pattern = tmpl;
+    bool nearest = false;         // limit result to nearest object
+    double mindist = -1;
+    if (pattern.size() > 0 && pattern[0] == '@') {
+        pattern.erase(0, 1); // erase the leading @
+        if (reference != NULL)
+            nearest = true;
+    } 
+
     for (; it != m_objnames.end(); ++it) {
-        if (string_match(it->first, tmpl))
-            result.push_back(it->second);
+        if (string_match(it->first, pattern)) {
+            if (!nearest || mindist < 0) {
+                result.push_back(it->second);
+                if (nearest) {
+                    mindist = reference->squareDistance(it->second);
+                }
+            } else {
+                double newdist = reference->squareDistance(it->second);
+                
+                // replace last candidate by new closer object, choose a unique candidate
+                if (mindist > newdist || ((mindist == newdist) && it->second->isSouthOrEastOf(result.back()))) {
+                    result.pop_back();
+                    result.push_back(it->second);
+                    mindist = newdist;
+                }
+            }
+        }
     }
     return result;
 }
@@ -1623,8 +1649,8 @@
     return level->get_named (name);
 }
 
-std::list<Object *> GetNamedGroup(const std::string &name) {
-    return level->get_group(name);
+std::list<Object *> GetNamedGroup(const std::string &name, const Object *reference) {
+    return level->get_group(name, reference);
 }
 
 bool IsLevelBorder(const GridPos &p) {

Modified: trunk/src/world.hh
===================================================================
--- trunk/src/world.hh	2008-05-11 11:00:15 UTC (rev 1139)
+++ trunk/src/world.hh	2008-05-12 10:11:18 UTC (rev 1140)
@@ -167,7 +167,7 @@
     void    NameObject (Object *obj, const string &name);
     void    UnnameObject (Object *obj);
     Object *GetNamedObject (const string &name);
-    std::list<Object *> GetNamedGroup(const std::string &templ);
+    std::list<Object *> GetNamedGroup(const std::string &templ, const Object *reference = NULL);
 
 /* -------------------- Force Fields -------------------- */
 

Modified: trunk/src/world_internal.hh
===================================================================
--- trunk/src/world_internal.hh	2008-05-11 11:00:15 UTC (rev 1139)
+++ trunk/src/world_internal.hh	2008-05-12 10:11:18 UTC (rev 1140)
@@ -278,7 +278,7 @@
         void    name_object (Object *obj, const string &name);
         void    unname (Object *);
         Object *get_named (const string &);
-        std::list<Object *> get_group(const std::string &tmpl);
+        std::list<Object *> get_group(const std::string &tmpl, const Object *reference = NULL);
 
         void tick (double dtime);
         void remove (ForceField *ff);



From ral at mail.berlios.de  Mon May 12 12:36:40 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 12 May 2008 12:36:40 +0200
Subject: [Enigma-game-svn] r1141 - team_levelpacks/team_test_new_api
Message-ID: <200805121036.m4CAaeD2007043@sheep.berlios.de>

Author: ral
Date: 2008-05-12 12:36:39 +0200 (Mon, 12 May 2008)
New Revision: 1141

Added:
   team_levelpacks/team_test_new_api/ralT043_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT041_1.xml
   team_levelpacks/team_test_new_api/ralT042_1.xml
   team_levelpacks/team_test_new_api/raoulT03_1.xml
Log:
Test Level new API:
- update test level for window stone add initial scratch
- add test level for nearest object


Modified: team_levelpacks/team_test_new_api/ralT041_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT041_1.xml	2008-05-12 10:11:18 UTC (rev 1140)
+++ team_levelpacks/team_test_new_api/ralT041_1.xml	2008-05-12 10:36:39 UTC (rev 1141)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Test Sensor new API" el:subtitle="" el:id="20080420ral550"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 1011 $" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2007 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>


Property changes on: team_levelpacks/team_test_new_api/ralT041_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision

Modified: team_levelpacks/team_test_new_api/ralT042_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT042_1.xml	2008-05-12 10:11:18 UTC (rev 1140)
+++ team_levelpacks/team_test_new_api/ralT042_1.xml	2008-05-12 10:36:39 UTC (rev 1141)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Test Lightpassenger new API" el:subtitle="" el:id="20080502ral681"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 1100 $" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
       <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
       <el:copyright>Copyright ? 2007 Ronald Lamprecht</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>


Property changes on: team_levelpacks/team_test_new_api/ralT042_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision

Added: team_levelpacks/team_test_new_api/ralT043_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT043_1.xml	2008-05-12 10:11:18 UTC (rev 1140)
+++ team_levelpacks/team_test_new_api/ralT043_1.xml	2008-05-12 10:36:39 UTC (rev 1141)
@@ -0,0 +1,60 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test nearest object new API" el:subtitle="" el:id="20080512ral228"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+ti["#"] = {"st-rock1"}
+
+ti["f"] = {"it_floppy"}
+ti["F"] = {"st_floppy", target="@door#*", action="toggle"}
+ti["B"] = {"st_blocker", "door#"}
+
+ti["c"] = {"it_coin_s", "coin#"}
+ti["V"] = {"it_vortex", destination="@coin#*"}
+
+
+ti["1"] = ti["f"] .. {"#ac-blackball"} 
+
+
+w, h = wo(ti, " ", {
+" B #        c       ",
+"BF #####            ",
+"   F   FB##BFB##B##F",
+"   B                ",
+"   #                ",
+"   #                ",
+"   B      1         ",
+"   F   c            ",
+"   B                ",
+"   #            c   ",
+"   #        V       ",
+"   #              FB",
+"   #              B "
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT043_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Modified: team_levelpacks/team_test_new_api/raoulT03_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-05-12 10:11:18 UTC (rev 1140)
+++ team_levelpacks/team_test_new_api/raoulT03_1.xml	2008-05-12 10:36:39 UTC (rev 1141)
@@ -32,6 +32,7 @@
 ti["d"] = {"st_window_new"}
 ti["e"] = {"st_window_new", secure=true}
 ti["A"] = {"st_window_n"}
+ti["@"] = {"st_window_n", scratches="n"}
 ti["B"] = {"st_window_e"}
 ti["C"] = {"st_window_s"}
 ti["D"] = {"st_window_w"}
@@ -45,6 +46,7 @@
 
 ti["V"] = ti["."] .. {"st_window", faces="we"}
 ti["*"] = ti["."] .. {"st_window", faces="esw"}
+ti["%"] = {"st_window", faces=""}
 
 ti["w"] = {"it_wrench"}
 ti["i"] = {"it_hammer"}
@@ -74,10 +76,10 @@
 " BCCB   a b c e BDvL",
 "  B     a b c d   v#",
 "#               G v#",
-"# 2AAAA3 B + D FV v#",
+"# 2A at AA3 B + D FV v#",
 "#IDWE0wB B   D  V v#",
 "# 1CxCC4 B - D  V v#",
-"#I    KK        V v#",
+"#I    KK     %  V v#",
 "# hhhhhhhhHHHH  V  #",
 "##########&### #*###",
 "#  sssssssssi    rk#",



From andreasl at mail.berlios.de  Tue May 13 22:42:21 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Tue, 13 May 2008 22:42:21 +0200
Subject: [Enigma-game-svn] r1142 - in trunk: data data/levels/lib src/stones
Message-ID: <200805132042.m4DKgLaP018592@sheep.berlios.de>

Author: andreasl
Date: 2008-05-13 22:42:16 +0200 (Tue, 13 May 2008)
New Revision: 1142

Modified:
   trunk/data/levels/lib/andreas_itemfreeze.xml
   trunk/data/levels/lib/libluatools.xml
   trunk/data/models-2d.lua
   trunk/data/models.lua
   trunk/src/stones/WindowStone.cc
Log:
Trunk:
 - Adding libluatools.combinations: Effectively, create
   a list of all n-ary numbers between 0 and 2^DEPTH,
   with arbitrary digits of a given set.
 - Fix crash when swapping an itemfreeze.
 - Proposal for a rewrite of window-shadow-code
   

Modified: trunk/data/levels/lib/andreas_itemfreeze.xml
===================================================================
--- trunk/data/levels/lib/andreas_itemfreeze.xml	2008-05-12 10:36:39 UTC (rev 1141)
+++ trunk/data/levels/lib/andreas_itemfreeze.xml	2008-05-13 20:42:16 UTC (rev 1142)
@@ -516,14 +516,20 @@
         local current_stone = itemfreeze_stone[j]
         local old_x = itemfreeze_pos_x[j]
         local old_y = itemfreeze_pos_y[j]
-        itemfreeze_pos_x[j], itemfreeze_pos_y[j] = enigma.GetPos(current_stone)
-        --if (enigma.GetStone(itemfreeze_pos_x[j], itemfreeze_pos_y[j])
-        --    ~= itemfreeze_stone[j]) then -- this doesn't work in lua 5!
-        if (old_x ~= itemfreeze_pos_x[j]) or (old_y ~= itemfreeze_pos_y[j]) then
-          -- Obviously, this stone has moved!
-          enigma.EmitSound(current_stone, "ballcollision")
-          itemfreeze_look_for_floor(j, old_x, old_y)
-          itemfreeze_look_for_item(j, old_x, old_y)
+        local new_x, new_y = enigma.GetPos(current_stone)
+        if (new_x >= 0) and (new_y >= 0) then
+          itemfreeze_pos_x[j], itemfreeze_pos_y[j] = new_x, new_y
+          --if (enigma.GetStone(itemfreeze_pos_x[j], itemfreeze_pos_y[j])
+          --    ~= itemfreeze_stone[j]) then -- this doesn't work in lua 5!
+          if (old_x ~= itemfreeze_pos_x[j]) or (old_y ~= itemfreeze_pos_y[j]) then
+            -- Obviously, this stone has moved!
+            enigma.EmitSound(current_stone, "ballcollision")
+            itemfreeze_look_for_floor(j, old_x, old_y)
+            itemfreeze_look_for_item(j, old_x, old_y)
+          end
+        else
+          -- Stone has disappeared - probably swapped. Just do
+          -- as if nothing happened and wait.
         end  
       end
     end

Modified: trunk/data/levels/lib/libluatools.xml
===================================================================
--- trunk/data/levels/lib/libluatools.xml	2008-05-12 10:36:39 UTC (rev 1141)
+++ trunk/data/levels/lib/libluatools.xml	2008-05-13 20:42:16 UTC (rev 1142)
@@ -170,6 +170,29 @@
   return sequence2
 end
 
+-- Return a table of all combinations of DEPTH entries,
+-- each of which is chosen from DIGITS.
+-- Example: luatools.combinations(3, {7, 8, "a"}) will return
+--   { {7,7,7}, {7,7,8}, {7,7,"a"}, {7,8,7}, {7,8,8}, {7,8,"a"},
+--     {7,"a",7}, {7,"a",8}, {7,"a","a"}, {8,7,7}, ... }
+-- Mathematically, it builds the leafs of an #DIGITS-ary tree
+-- of depth DEPTH.
+function luatools.combinations(depth, digits)
+  local all_combinations = {{}}
+  for _ = 1, depth do
+    local next_step = {}
+    for _, old_combination in pairs(all_combinations) do
+      for _, new_digit in pairs(digits) do
+        local new_combination = luatools.deep_copy(old_combination)
+        table.insert(new_combination, new_digit)
+        table.insert(next, new_combination)
+      end
+    end
+    all_combinations = next_step
+  end
+  return all_combinations
+end
+
     ]]></el:luamain>
     <el:i18n>
     </el:i18n>

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-05-12 10:36:39 UTC (rev 1141)
+++ trunk/data/models-2d.lua	2008-05-13 20:42:16 UTC (rev 1142)
@@ -1182,92 +1182,102 @@
 
 -- st-window --
 do
-    local fg_window_blue = DefSubimages("st_window_blue", {modelname="fg-window_blue",w=4,h=4})
-    local fg_window_green = DefSubimages("st_window_green", {modelname="fg-window_green",w=4,h=4})
+    local fg_window = {blue = DefSubimages("st_window_blue", {modelname="fg-window_blue",w=4,h=4}),
+                       green = DefSubimages("st_window_green", {modelname="fg-window_green",w=4,h=4}) }
     local sh_windowx = DefSubimages("sh_window", {modelname="sh-windowx",w=2,h=4,imgw=ShadowSize,imgh=ShadowSize})
-    local breaking_images_blue = DefSubimages("st_window_blue_break", {h=4})
-    local breaking_images_green = DefSubimages("st_window_green_break", {h=4})
-    
-    local faces = 0
-    local broken = 0
-    local shadows = {}
-    for W = 0, 1 do
-      local Wfaces = faces
-      for S = 0, 1 do
-        local Sfaces = faces
-        local shadows = shadows
-        for E = 0, 1 do
-          local Efaces = faces
-          local shadows = shadows
-          for N = 0, 1 do
-            local Nfaces = faces
-            local shadows = shadows
-            for w = 0, 1-W do
-              local wbroken = broken
-              local shadows = shadows
-              for s = 0, 1-S do
-                local sbroken = broken
-                local shadows = shadows
-                for e = 0, 1-E do
-                  local ebroken = broken
-                  local shadows = shadows
-                  for n = 0, 1-N do
-                    local nbroken = broken
-                    local shadows = {}
-                    if W==1 then table.insert(shadows,"sh-windowx1") end
-                    if S==1 then table.insert(shadows,"sh-windowx2") end
-                    if E==1 then table.insert(shadows,"sh-windowx3") end
-                    if N==1 then table.insert(shadows,"sh-windowx4") end
-                    if w==1 then table.insert(shadows,"sh-windowx5") end
-                    if s==1 then table.insert(shadows,"sh-windowx6") end
-                    if e==1 then table.insert(shadows,"sh-windowx7") end
-                    if n==1 then table.insert(shadows,"sh-windowx8") end
-                    DefMultipleComposite("sh-windowx"..faces.."-"..broken, shadows)
-                    DefShModel("st_window_blue"..faces.."_"..broken, "fg-window_blue"..(faces+broken+1), "sh-windowx"..faces.."-"..broken)
-                    DefShModel("st_window_green"..faces.."_"..broken, "fg-window_green"..(faces+broken+1), "sh-windowx"..faces.."-"..broken)
+    local breaking_images = {blue = DefSubimages("st_window_blue_break", {h=4}),
+                             green = DefSubimages("st_window_green_break", {h=4})}
 
-                    local breaking_window_blue_names = {}
-                    local breaking_window_green_names = {}
-                    for j = 1, table.getn(breaking_images_blue) do
-                        breaking_window_blue_names[j] = "st-window_blue_breaking"..faces.."_"..broken.."-"..j
-                        breaking_window_green_names[j] = "st-window_green_breaking"..faces.."_"..broken.."-"..j
-                        display.DefineComposite(breaking_window_blue_names[j], fg_window_blue[faces+broken+1], breaking_images_blue[j])
-                        display.DefineComposite(breaking_window_green_names[j], fg_window_green[faces+broken+1], breaking_images_green[j])
-                    end
-                    local frames_blue = BuildFrames(breaking_window_blue_names, 130)
-                    local frames_green = BuildFrames(breaking_window_green_names, 130)
-                    DefAnim("st-window_blue"..faces.."_"..broken.."_anim_fg", frames_blue)
-                    DefAnim("st-window_green"..faces.."_"..broken.."_anim_fg", frames_green)
-                    DefShModel("st_window_blue"..faces.."_"..broken.."_anim", "st-window_blue"..faces.."_"..broken.."_anim_fg", "sh-windowx"..faces.."-"..broken);
-                    DefShModel("st_window_green"..faces.."_"..broken.."_anim", "st-window_green"..faces.."_"..broken.."_anim_fg", "sh-windowx"..faces.."-"..broken);
+    local function name(combination, separator)
+      return combination.normal_faces..separator..combination.scratched_faces
+    end
 
-
-                    table.insert(shadows,"sh-windowx8")
-                    broken = nbroken + 8
-                  end
-                  table.insert(shadows,"sh-windowx7")
-                  broken = ebroken + 4
+    -- The window images are constructed in two steps.
+    -- 1) All possible combinations of the shadows are constructed
+    --    (for each direction: "no shadow", "normal face", "scratched face",
+    --    represented as "0, 1, 2" in a table).
+    -- 2) Using the table of all possible combinations, all images
+    --    and animations of the window stones are constructed.
+    -- Step 1 works as follows: We start with direction 1 (North),
+    -- and all three possibilities for shadows to the North. At this
+    -- point, the images for shadows to North only are build.
+    -- As next, for each of the three North-possibilities, we
+    -- construct the East-possibilities, i.e. we now have 3*3 combinations
+    -- and 3*3-1 shadow-images. We continue with South and West.
+    -- The table "all_combinations" is after each pass of the "direction"-loop:
+    --  0) {{}}
+    --  1) {{0}, {1}, {2}}
+    --  2) {{0,0}, {0,1}, {0,2}, {1,0}, {1,1}, {1,2}, {2,0}, {2,1}, {2,2}}
+    --  3) {{0,0,0}, {0,0,1}, {0,0,2}, {0,1,0}, {0,1,1}, ... }
+    --  4) {{0,0,0,0}, {0,0,0,1}, {0,0,0,2}, {0,0,1,0}, ... }
+    -- Plus extra entries to count the number of normal_faces and
+    -- scratched_faces (to be exactly, the numbers binarily represent
+    -- the existence of the face).
+    local all_combinations = {{normal_faces = 0, scratched_faces = 0}}
+    DefAlias("sh-windowx0-0", "invisible")
+    local base = {0, 1, 2}
+    for direction = 1, 4 do
+        local next_list = {}
+        for _, old_combination in pairs(all_combinations) do
+            for _, new_digit in pairs(base) do
+                -- Deep-copy old_combination to new_combination.
+                local new_combination = {}
+                for k, digit in pairs(old_combination) do
+                    new_combination[k] = digit
                 end
-                table.insert(shadows,"sh-windowx6")
-                broken = sbroken + 2
-              end
-              table.insert(shadows,"sh-windowx5")
-              broken = wbroken + 1
+                -- Add a new digit to new_combination and save it.
+                new_combination[direction] = new_digit
+                table.insert(next_list, new_combination)
+                -- If this combination adds a new face, create
+                -- the corresponding composite image, based on the
+                -- image of old_combination.
+                if new_digit ~= 0 then
+                    -- First, increase the "number" of faces.
+                    if new_digit == 1 then
+                        new_combination.normal_faces = new_combination.normal_faces
+                                + ({1,2,4,8})[direction]
+                    elseif new_digit == 2 then
+                        new_combination.scratched_faces = new_combination.scratched_faces
+                                + ({1,2,4,8})[direction]
+                    end
+                    -- Now compose the shadow image.
+                    display.DefineComposite(
+                            "sh-windowx"..name(new_combination, "-"),
+                            "sh-windowx"..name(old_combination, "-"),
+                            "sh-windowx"..(direction + ({0,4})[new_digit]))
+                end
             end
-            table.insert(shadows,"sh-windowx4")
-            broken = 0
-            faces = Nfaces + 8
-          end
-          table.insert(shadows,"sh-windowx3")
-          faces = Efaces + 4
         end
-        table.insert(shadows,"sh-windowx2")
-        faces = Sfaces + 2
-      end
-      table.insert(shadows,"sh-windowx1")
-      faces = Wfaces + 1
+        all_combinations = next_list
     end
-    
+
+    for _, combination in pairs(all_combinations) do
+        -- Abbreviations. Note that sometimes "-" and sometimes "_" is
+        -- used as separator. Don't expect a pattern.
+        local total_faces = combination.normal_faces + combination.scratched_faces
+        local name1 = name(combination, "-")
+        local name2 = name(combination, "_")
+        for _, color in pairs({"blue", "green"}) do
+            -- Normal stone (= not breaking)
+            DefShModel("st_window_"..color..name2,
+                       "fg-window_"..color..(total_faces + 1),
+                       "sh-windowx"..name1)
+            -- Breaking animation
+            local breaking_window_names = {}
+            for j = 1, table.getn(breaking_images[color]) do
+                breaking_window_names[j] =
+                          "st-window_"..color.."_breaking"..name1.."-"..j
+                display.DefineComposite(breaking_window_names[j],
+                          fg_window[color][total_faces + 1],
+                          breaking_images[color][j])
+            end
+            local frames = BuildFrames(breaking_window_names, 130)
+            DefAnim("st-window_"..color..name2.."_anim_fg", frames)
+            DefShModel("st_window_"..color..name2.."_anim",
+                       "st-window_"..color..name2.."_anim_fg",
+                       "sh-windowx"..name1);
+        end
+    end
 end
 
 -----------------

Modified: trunk/data/models.lua
===================================================================
--- trunk/data/models.lua	2008-05-12 10:36:39 UTC (rev 1141)
+++ trunk/data/models.lua	2008-05-13 20:42:16 UTC (rev 1142)
@@ -405,8 +405,7 @@
 -- Define a multiple composite --
 -- This function will compose a list of images
 -- and store the result in "name".
--- At the moment, this function is only used for the
--- shadows of "st-window".
+-- As this function needs lots of memory, it's use is deprecated.
 function DefMultipleComposite(name, imglist)
     -- Assert imglist >= 1!
     local listsize = table.getn(imglist)

Modified: trunk/src/stones/WindowStone.cc
===================================================================
--- trunk/src/stones/WindowStone.cc	2008-05-12 10:36:39 UTC (rev 1141)
+++ trunk/src/stones/WindowStone.cc	2008-05-13 20:42:16 UTC (rev 1142)
@@ -124,8 +124,7 @@
             }
             uint32_t scratchDirs = ((objFlags & OBJBIT_SCRATCHDIRS) >> 24);
             set_model(ecl::strf("st_window_%s%d_%d", objFlags & OBJBIT_SECURE ? "green" : "blue" , 
-                    getFaces() & ~scratchDirs, scratchDirs));
-                    
+                    getFaces() & ~scratchDirs, scratchDirs));                    
         }
     }
 



From andreasl at mail.berlios.de  Wed May 14 00:27:21 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Wed, 14 May 2008 00:27:21 +0200
Subject: [Enigma-game-svn] r1143 - in trunk/src: . gui
Message-ID: <200805132227.m4DMRLGW004549@sheep.berlios.de>

Author: andreasl
Date: 2008-05-14 00:27:21 +0200 (Wed, 14 May 2008)
New Revision: 1143

Modified:
   trunk/src/SoundEffectManager.cc
   trunk/src/SoundEffectManager.hh
   trunk/src/SoundEngine.cc
   trunk/src/gui/GameMenu.cc
   trunk/src/gui/OptionsMenu.cc
Log:
Trunk:
 - Fix Bug #10928: Sound merging.
   Volume is set to maximum, position calculation
   is more robust, merging and effective volume
   had been extracted to own functions.
 - Fix Bug #8032: Border in Levelpause-screen.
   Bug was due to conversion from int to double,
   division and multiplication by the same factor,
   and subsequent implicit conversion to int.
   Made in total a loss of 1 pixel in height and
   width.
 - Small adjustment in options menu.

   
   

Modified: trunk/src/SoundEffectManager.cc
===================================================================
--- trunk/src/SoundEffectManager.cc	2008-05-13 20:42:16 UTC (rev 1142)
+++ trunk/src/SoundEffectManager.cc	2008-05-13 22:27:21 UTC (rev 1143)
@@ -146,11 +146,38 @@
 
 SoundEvent::SoundEvent ()
 : name(""), has_position(false), position(),
-  priority (0), volume (0.0),
-  left (0), right(0), active (false),
-  playing_time (0)
+  priority(0), volume(0.0), range(30.0), fullvol_range(0.2),
+  number_events(1), left(0), right(0), active(false),
+  playing_time(0)
 {}
 
+double SoundEvent::effectiveVolume(double dist) {
+    double reduced_dist = max(0.0, dist - fullvol_range);
+    return (1 - reduced_dist / range) * volume;
+}
+
+bool SoundEvent::merge(SoundEvent se) {
+    if (has_position && se.has_position) {
+        /*! Merge the soundevent se onto this one. The loudness profile
+           of a soundevent se is that of a cylinder shaped center region
+           with height se.volume and radius se.fullvol_range,
+           surrounded by a linearly decreasing area of breadth se.range.
+           The merged soundevent will have a center region covering both
+           old center regions, and its volume is set to the maximum
+           of the two volumes. */
+        double dist = ecl::length(position - se.position);
+        volume = max(volume, se.volume);
+        fullvol_range += dist/2;
+        position = (number_events * position + se.number_events * se.position)
+                       / (number_events + se.number_events);
+        number_events += se.number_events;
+        return true;
+    } else {
+        // Don't merge global sounds.
+        return false;
+    }
+}            
+
 /* -------------------- SoundEffectManager -------------------- */
 
 SoundEffectManager *SoundEffectManager::theSingleton = 0;

Modified: trunk/src/SoundEffectManager.hh
===================================================================
--- trunk/src/SoundEffectManager.hh	2008-05-13 20:42:16 UTC (rev 1142)
+++ trunk/src/SoundEffectManager.hh	2008-05-13 22:27:21 UTC (rev 1143)
@@ -219,6 +219,9 @@
         ecl::V2   position;
         int       priority;
         double    volume;           // Volume between 0.0 and 1.0
+        double    range;            // How far can sound travel? (Default: 30.0)
+        double    fullvol_range;    // If distance sound origin <= this value, play at full volume
+        int       number_events;    // Increased when soundevents are merged
         int       left;
         int       right;
 
@@ -228,6 +231,12 @@
 
         // Constructor
         SoundEvent ();
+        
+        // Effective volume calculation
+        double    effectiveVolume(double dist);
+        
+        // Merge another sound event onto this one.
+        bool      merge(SoundEvent se);
     };
 
 /* -------------------- SoundEffect and SoundEffectRepository ---------------- */

Modified: trunk/src/SoundEngine.cc
===================================================================
--- trunk/src/SoundEngine.cc	2008-05-13 20:42:16 UTC (rev 1142)
+++ trunk/src/SoundEngine.cc	2008-05-13 22:27:21 UTC (rev 1143)
@@ -351,12 +351,6 @@
 
 void SoundEngine_SDL::update_channel (int channel)
 {
-    // If distance sound origin <= this value, play at full volume
-    const double fullvol_range = 0.2;
-
-    // How far can sound travel?
-    const double range = 30;    
-
     SoundEvent &se = m_channelinfo[channel];
 
     double volume;
@@ -364,13 +358,10 @@
     int    right;
     if (se.has_position) {
         ecl::V2 distv = se.position - m_listenerpos;
-        double dist = max(0.0, length(distv) - fullvol_range);
-
         int xdist = int(distv[0] * options::GetDouble("StereoSeparation"));
-
         left  = ecl::Clamp (255 - xdist, 0, 255);
         right = ecl::Clamp (255 + xdist, 0, 255);
-        volume = (1 - dist/range) * se.volume;
+        volume = se.effectiveVolume(length(distv));
     }
     else
     {
@@ -392,7 +383,7 @@
 
         if (se.active && se.name == s.name && se.playing_time < 0.05
             && (!se.has_position || !s.has_position ||
-		ecl::length(se.position - s.position) < 30))
+		ecl::length(se.position - s.position) < se.range + se.fullvol_range))
             return static_cast<int> (i);
     }
     return -1;
@@ -429,9 +420,8 @@
     if (channel != -1) {
         MutexLock (m_instance->m_mutex);
         SoundEvent &se = m_channelinfo [channel];
-        if (se.has_position) {
-            se.position = (se.position + s.position) / 2;
-            update_channel (channel);
+        if(se.merge(s)) {
+            update_channel(channel);
             return true;
         }
     }

Modified: trunk/src/gui/GameMenu.cc
===================================================================
--- trunk/src/gui/GameMenu.cc	2008-05-13 20:42:16 UTC (rev 1142)
+++ trunk/src/gui/GameMenu.cc	2008-05-13 22:27:21 UTC (rev 1143)
@@ -123,7 +123,7 @@
     //             delete src;
     //             src = tmp;
     //         }
-            zoomed = src->zoom(vminfo->width, vminfo->height);
+            zoomed = src->zoom(vminfo->width+1, vminfo->height+1);
             delete src;
         }
     

Modified: trunk/src/gui/OptionsMenu.cc
===================================================================
--- trunk/src/gui/OptionsMenu.cc	2008-05-13 20:42:16 UTC (rev 1142)
+++ trunk/src/gui/OptionsMenu.cc	2008-05-13 22:27:21 UTC (rev 1143)
@@ -461,7 +461,8 @@
 #define OPTIONS_NEW_L(label) lb = new HList;\
         lb->set_spacing(param[vtt].hoption_option); \
         lb->set_alignment(HALIGN_LEFT, VALIGN_TOP); \
-        lb->set_default_size(param[vtt].optionb_width, param[vtt].button_height); \
+        lb->set_default_size(2*param[vtt].optionb_width + param[vtt].hoption_option, \
+                             param[vtt].button_height); \
         lb->add_back(new Label(label, HALIGN_LEFT, VALIGN_BOTTOM)); \
         optionsVList->add_back(lb); \
 // end define



From andreasl at mail.berlios.de  Wed May 14 03:01:15 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Wed, 14 May 2008 03:01:15 +0200
Subject: [Enigma-game-svn] r1144 - team_levelpacks/team_test_new_api
Message-ID: <200805140101.m4E11F7Y005004@sheep.berlios.de>

Author: andreasl
Date: 2008-05-14 03:01:14 +0200 (Wed, 14 May 2008)
New Revision: 1144

Modified:
   team_levelpacks/team_test_new_api/ralT042_1.xml
   team_levelpacks/team_test_new_api/ralT043_1.xml
Log:
Test Level new API:
 - Add st_brake to "Test nearest object new API".
 - Add it_glasses to "Test Lightpassenger new API".


Modified: team_levelpacks/team_test_new_api/ralT042_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT042_1.xml	2008-05-13 22:27:21 UTC (rev 1143)
+++ team_levelpacks/team_test_new_api/ralT042_1.xml	2008-05-14 01:01:14 UTC (rev 1144)
@@ -46,6 +46,7 @@
 
 ti["B"] = {"st_boulder_s"}
 
+ti["g"] = {"it-glasses"}
 
 w, h = wo(ti, " ", {
 "                    ",
@@ -54,14 +55,14 @@
 "E     w    lW       ",
 "    il              ",
 "          Ahm       ",
-" ww     S           ",
+" ww     S       g   ",
 "E        w          ",
 "E    w              ",
-"        Ls    EP    ",
+"        Ls    EP   w",
 "  N                 ",
-"  .......W          ",
-" N             B    ",
-"        w      w    ",
+"  .......W     B  B ",
+" N             w  w ",
+"        w           ",
 "                    ",
 "                    ",
 "    w               ",

Modified: team_levelpacks/team_test_new_api/ralT043_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT043_1.xml	2008-05-13 22:27:21 UTC (rev 1143)
+++ team_levelpacks/team_test_new_api/ralT043_1.xml	2008-05-14 01:01:14 UTC (rev 1144)
@@ -32,14 +32,15 @@
 
 ti["1"] = ti["f"] .. {"#ac-blackball"} 
 
+ti["r"] = {"st-brake"}
 
 w, h = wo(ti, " ", {
 " B #        c       ",
 "BF #####            ",
 "   F   FB##BFB##B##F",
 "   B                ",
+"   #           r    ",
 "   #                ",
-"   #                ",
 "   B      1         ",
 "   F   c            ",
 "   B                ",



From andreasl at mail.berlios.de  Thu May 15 01:59:07 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Thu, 15 May 2008 01:59:07 +0200
Subject: [Enigma-game-svn] r1145 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 src/stones
Message-ID: <200805142359.m4ENx7ST003035@sheep.berlios.de>

Author: andreasl
Date: 2008-05-15 01:59:04 +0200 (Thu, 15 May 2008)
New Revision: 1145

Added:
   trunk/data/gfx32/st-lightpassenger-break.png
   trunk/data/gfx32/st-lightpassenger_off.png
   trunk/data/gfx40/st-lightpassenger-break.png
   trunk/data/gfx40/st-lightpassenger_off.png
   trunk/data/gfx48/st-lightpassenger-break.png
   trunk/data/gfx48/st-lightpassenger_off.png
Removed:
   trunk/data/gfx32/st-lightpassenger-break-h.png
   trunk/data/gfx32/st-lightpassenger-break-hv.png
   trunk/data/gfx32/st-lightpassenger-break-v.png
   trunk/data/gfx40/st-lightpassenger-break-h.png
   trunk/data/gfx40/st-lightpassenger-break-hv.png
   trunk/data/gfx40/st-lightpassenger-break-v.png
   trunk/data/gfx48/st-lightpassenger-break-h.png
   trunk/data/gfx48/st-lightpassenger-break-hv.png
   trunk/data/gfx48/st-lightpassenger-break-v.png
Modified:
   trunk/data/models-2d.lua
   trunk/src/stones/LightPassengerStone.cc
   trunk/src/stones/LightPassengerStone.hh
Log:
Trunk:
 - Minor changes to lightpassenger:
    - switched off lp can is visible with glasses
    - combined the three break animations to one
Note:
 - Glasses have not been reworked yet.
   There are certain bugs, like: A freshly set
   lightpassenger_off is always invisible.
   These bugs are with all glasses-visible stones.


Deleted: trunk/data/gfx32/st-lightpassenger-break-h.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-lightpassenger-break-hv.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-lightpassenger-break-v.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx32/st-lightpassenger-break.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-lightpassenger-break.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx32/st-lightpassenger_off.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-lightpassenger_off.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: trunk/data/gfx40/st-lightpassenger-break-h.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-lightpassenger-break-hv.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-lightpassenger-break-v.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx40/st-lightpassenger-break.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-lightpassenger-break.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx40/st-lightpassenger_off.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-lightpassenger_off.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: trunk/data/gfx48/st-lightpassenger-break-h.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-lightpassenger-break-hv.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-lightpassenger-break-v.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx48/st-lightpassenger-break.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-lightpassenger-break.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx48/st-lightpassenger_off.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-lightpassenger_off.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-05-14 01:01:14 UTC (rev 1144)
+++ trunk/data/models-2d.lua	2008-05-14 23:59:04 UTC (rev 1145)
@@ -941,16 +941,27 @@
 do
     local img = DefSubimages("st-lightpassenger", {h=7})
     DefShModel("st-lightpassenger", img[1], "sh-glass")
-    DefAlias("st-lightpassenger_off", "st-glass2")
+    DefImage("st-lightpassenger_offx", {filename = "st-lightpassenger_off"})
+    DefShModel("st-lightpassenger_off", "st-lightpassenger_offx", "sh-glass")
+    DefAlias("st-lightpassenger_hidden", "st-glass2")
+    -- Blink animation
     local frames = {img[2], img[3], img[4], img[5], img[6], img[7]}
     DefAnim("st-lightpassenger-blink1", PingPong(BuildFrames(frames, 75)), true)
     DefShModel("st-lightpassenger-blink", "st-lightpassenger-blink1", "sh-glass")
-    img = DefSubimages("st-lightpassenger-break-v", {h=7})
-    DefAnim("st-lightpassenger-break-v", BuildFrames(img, 50), false)
-    img = DefSubimages("st-lightpassenger-break-h", {h=7})
-    DefAnim("st-lightpassenger-break-h", BuildFrames(img, 50), false)
-    img = DefSubimages("st-lightpassenger-break-hv", {h=7})
-    DefAnim("st-lightpassenger-break-hv", BuildFrames(img, 50), false)
+    -- Break animation
+    img = DefSubimages("st-lightpassenger-break", {h=7})
+    local anim_v, anim_h, anim_hv = {}, {}, {}
+    for j = 1, 7 do
+      anim_v[j] = "st-lightpassenger-break-v"..j
+      display.DefineComposite(anim_v[j], "it-laserv", img[j])
+      anim_h[j] = "st-lightpassenger-break-h"..j
+      display.DefineComposite(anim_h[j], "it-laserh", img[j])
+      anim_hv[j] = "st-lightpassenger-break-hv"..j
+      display.DefineComposite(anim_hv[j], "it-laserhv", img[j])
+    end
+    DefAnim("st-lightpassenger-break-v", BuildFrames(anim_v, 50), false)
+    DefAnim("st-lightpassenger-break-h", BuildFrames(anim_h, 50), false)
+    DefAnim("st-lightpassenger-break-hv", BuildFrames(anim_hv, 50), false)
 end
 
 -- st-magic :-) --

Modified: trunk/src/stones/LightPassengerStone.cc
===================================================================
--- trunk/src/stones/LightPassengerStone.cc	2008-05-14 01:01:14 UTC (rev 1144)
+++ trunk/src/stones/LightPassengerStone.cc	2008-05-14 23:59:04 UTC (rev 1145)
@@ -50,6 +50,12 @@
             if (objFlags & OBJBIT_LIGHTNEWDIRS)
                 lightDirChanged(NODIRBIT, (DirectionBits)(objFlags & OBJBIT_LIGHTNEWDIRS));
             return Value();            
+        } else if (m.message == "glasses") {
+            if (to_bool(m.value) != (objFlags & OBJBIT_VISIBLE)) {
+                objFlags ^= OBJBIT_VISIBLE; // toggle visibility bit
+                init_model();
+            }
+            return Value();
         }
         return Stone::message(m);
     }
@@ -77,7 +83,8 @@
     void LightPassengerStone::init_model() {
         switch(state) {
             case OFF:
-                set_anim("st-lightpassenger_off"); break;
+                set_anim(objFlags & OBJBIT_VISIBLE ?
+                    "st-lightpassenger_off" : "st-lightpassenger_hidden"); break;
             case ON:
                 set_anim("st-lightpassenger"); break;
             case BLINK:

Modified: trunk/src/stones/LightPassengerStone.hh
===================================================================
--- trunk/src/stones/LightPassengerStone.hh	2008-05-14 01:01:14 UTC (rev 1144)
+++ trunk/src/stones/LightPassengerStone.hh	2008-05-14 23:59:04 UTC (rev 1145)
@@ -42,7 +42,8 @@
         
         enum ObjectPrivatFlagsBits {
             OBJBIT_SKATEDIR =   7<<24,   ///< current skate direction
-            OBJBIT_BLOCKED  =   1<<27    ///< have been blocked by a stone on last move attempt 
+            OBJBIT_BLOCKED  =   1<<27,   ///< have been blocked by a stone on last move attempt 
+            OBJBIT_VISIBLE  =   1<<28    ///< this stone isn't hidden when inactive
         };
     public:
         LightPassengerStone(bool isActive);



From ral at mail.berlios.de  Thu May 15 23:35:57 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 15 May 2008 23:35:57 +0200
Subject: [Enigma-game-svn] r1146 - in trunk: data src
Message-ID: <200805152135.m4FLZve4009755@sheep.berlios.de>

Author: ral
Date: 2008-05-15 23:35:57 +0200 (Thu, 15 May 2008)
New Revision: 1146

Modified:
   trunk/data/api2init.lua
   trunk/src/lua.cc
Log:
Trunk 1.1: new API
- autotiling resolver added
  generates tile declarations based on templates - see upcoming samples
  and refman docu


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-05-14 23:59:04 UTC (rev 1145)
+++ trunk/data/api2init.lua	2008-05-15 21:35:57 UTC (rev 1146)
@@ -133,22 +133,22 @@
 res = {}
 
 function res.random_implementation(context, evaluator, key, x, y)
-    for hit_itr, hit_pair in ipairs(context[3]) do
+    for hit_itr, hit_pair in ipairs(context[4]) do
         if key == hit_pair[1] then
             local super = nil
             if hit_pair[2] ~= nil then
-                super = evaluator(context[2], hit_pair[2], x, y)
+                super = evaluator(context[3], hit_pair[2], x, y)
             end
             local repl_key
-            local r = math.random(context[5])
+            local r = math.random(context[6])
             local i = 1
-            local s = context[4][i][2]
+            local s = context[5][i][2]
             while s < r do
                 i = i + 1
-                s = s + context[4][i][2]
+                s = s + context[5][i][2]
             end
-            repl_key = context[4][i][1]
-            local replacement = evaluator(context[2], repl_key, x, y)
+            repl_key = context[5][i][1]
+            local replacement = evaluator(context[3], repl_key, x, y)
             if super == nil then
                 return replacement
             elseif type(super) == "table" then
@@ -159,7 +159,7 @@
         end
     end
     -- key not found
-    return evaluator(context[2], key, x, y)
+    return evaluator(context[3], key, x, y)
 end
 
 function res.random(subresolver, hits, replacements)
@@ -192,9 +192,109 @@
     for i, v in ipairs(repl_table) do
         repl_sum = repl_sum + v[2]
     end
-    local context = {res.random_implementation, subresolver, hit_table, 
+    local context = {res.random_implementation, nil, subresolver, hit_table, 
                       repl_table, repl_sum}
     return context
 end
 
+function res.autotile_newtile(key, template, substitution)
+    local decl = template:_declaration()  -- get a deep copy
+    local result
+    for i, tile in ipairs(decl) do
+        if type(tile) == "string" then
+            if result == nil then
+                result = ti[tile]
+            else
+                result = result .. ti[tile]
+            end
+        else
+            local at = {}   -- attribute table
+            for key, val in pairs(tile) do   -- a table
+                if type(val) ~= "table" then
+                    if type(val) == "string" then
+                        at[key] = string.gsub(val, "%%%%", "%%"..substitution)
+                    else
+                        at[key] = val
+                    end
+                else
+                    local tt = {} 
+                    for j, token in ipairs(val) do
+                        if type(token) == "string" then
+                            tt[j] = string.gsub(token, "%%%%", "%%"..substitution)
+                        else
+                            tt[j] = token
+                        end
+                    end
+                    at[key] = tt
+                end
+            end
+            if result == nil then
+                result = ti(at)
+            else
+                result = result .. ti(at)
+            end
+        end
+    end
+    ti[key] = result
+end
 
+function res.autotile_implementation(context, evaluator, key, x, y)
+    for i, rule in ipairs (context[4]) do
+        if #rule == 3 then   -- from, to substitution
+            --
+            local first = string.byte(rule[1], #rule[1])
+            local last = string.byte(rule[2], #rule[2])
+            local candidate = string.byte(key, #key)
+            
+            if #key == #rule[1] and string.sub(key, 1, -2) == string.sub(rule[1], 1, -2)
+                    and first <= candidate and candidate <= last then
+                if ti[key] == nil then
+                    res.autotile_newtile(key, ti[rule[3]], candidate - first)
+                end
+                return ti[key]
+            end
+        elseif string.find(key, rule[1], 1, true) == 1 then
+            -- prefix based substitution
+            if ti[key] == nil then
+                res.autotile_newtile(key, ti[rule[2]], string.sub(key, #(rule[1]) + 1))
+            end
+            return ti[key]
+        end
+    end
+    return evaluator(context[3], key, x, y)
+end
+
+function res.autotile(subresolver, ...)
+    -- syntax: ... = <{prefixkey, template} | {fistkey, lastkey, template}>
+    local args = {...}
+    -- TODO check args!
+    -- check tables contain only strings (2 or 3)
+    -- check in case of 3 that last > first in last char, but equal in first chars,
+    for i, rule in ipairs(args) do
+        if type(rule) ~= "table" then
+            error("Resolver autotile rule " .. i.." is not a table", 2)
+        else
+            if #rule < 2 or #rule > 3 then
+                error("Resolver autotile rule "..i.." wrong number of arguments", 2)
+            end
+            for j, str in ipairs(rule) do
+                if type(str) ~= "string" then
+                    error("Resolver autotile rule "..i.." has not a string in position "..j, 2)
+                end
+            end
+            if #rule == 3 then
+                local first = string.byte(rule[1], #rule[1])
+                local last  = string.byte(rule[2], #rule[2])
+                if #rule[2] ~= #rule[1] or string.sub(rule[2], 1, -2) ~= string.sub(rule[1], 1, -2)
+                        or first > last then
+                    error("Resolver autotile rule "..i.." bad range start-end strings", 2)
+                end
+            end
+            if ti[rule[#rule]] == nil then
+                error("Resolver autotile missing template tile '"..rule[#rule].."'", 2)
+            end
+        end
+    end
+    local context = {res.autotile_implementation, nil, subresolver, args}
+    return context
+end

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-05-14 23:59:04 UTC (rev 1145)
+++ trunk/src/lua.cc	2008-05-15 21:35:57 UTC (rev 1146)
@@ -63,8 +63,8 @@
 /**
  * The tile dictionary or function that should be used to resolve tile keys.
  */
-#define LUA_ID_RESOLVER "_RESOLVER"
-#define LUA_ID_FLOORKEY "_FLOORKEY"
+#define LUA_ID_RESOLVER  "_RESOLVER"
+#define LUA_ID_FLOORKEY  "_FLOORKEY"
 
 using namespace std;
 
@@ -1060,7 +1060,7 @@
     return 1;
 }
 
-static int pushNewTile(lua_State *L, int numArgs) {
+static int pushNewTile(lua_State *L, int numArgs, std::string key="") {
     // numArgs 1 or 2 of type (table|tile)
     int *udata;
     udata=(int *)lua_newuserdata(L,sizeof(int));   // position user object
@@ -1084,6 +1084,10 @@
         lua_pushvalue(L, -3);
         lua_rawseti(L, -2, 2);
     }
+    if (key != "") {
+        lua_pushstring(L, key.c_str());
+        lua_rawseti(L, -2, 3);
+    }
     lua_setmetatable(L, -2);    
     return 1;
 }
@@ -1878,6 +1882,10 @@
         throwLuaError(L, "Resolver with false argument types");
         return 0;
     }
+    std::string key = lua_tostring(L, -3);
+    int x = lua_tointeger(L, -2);
+    int y = lua_tointeger(L, -1);
+    
     if (is_tiles(L, -4)) {
         lua_pushvalue(L, -3);       // duplicate key
         lua_gettable(L, -5);        // get tile entry in table, remove key duplicate
@@ -1894,7 +1902,8 @@
         }
         // check result - must be tile or table
         if (!(is_tile(L, -1) || is_table(L, -1))) {
-            throwLuaError(L, "Tile key resolver error - expected tile or table as return value");
+            throwLuaError(L, ecl::strf("World init undefined tile '%s' at %d, %d", 
+                    key.c_str(), x, y).c_str());
             return 0;
         }
         return 1;
@@ -1912,7 +1921,8 @@
         }        
         // check result - must be tile or table
         if (!(is_tile(L, -1) || is_table(L, -1))) {
-            throwLuaError(L, "Tile key resolver error - expected tile or table as return value");
+            throwLuaError(L, ecl::strf("World init undefined tile '%s' at %d, %d", 
+                    key.c_str(), x, y).c_str());
             return 0;
         }
         return 1;
@@ -1978,7 +1988,7 @@
         return 0;
     }
     
-    // remember resolver and default key for missing floors
+    // remember top resolver and default key for missing floors
     lua_pushvalue(L, 2);
     lua_setfield(L, LUA_REGISTRYINDEX, LUA_ID_RESOLVER);  
     lua_pushvalue(L, 3);
@@ -2042,6 +2052,9 @@
             setObjectByKey(L, key, j, i, isDefault);
         }
     }
+    
+    // TODO finalization of resolvers
+    
     lua_pushinteger(L, width);
     lua_pushinteger(L, height);
     return 2;
@@ -2246,10 +2259,106 @@
 }
 
 static int dispatchTileReadAccess(lua_State *L) {
+    // tile, key
+    if (lua_isstring(L, 2)) {
+        std::string keyStr = lua_tostring(L, 2);
+        MethodMap::iterator iter = tileMethodeMap.find(keyStr);
+        if (iter != tileMethodeMap.end()) {
+            // call method
+            lua_pushcfunction(L, iter->second);
+            return 1;
+        }
+    }
     throwLuaError(L, "Tile: illegal read access");
     return 0;
 }
 
+static void tileDeclForTable(lua_State *L) {
+    // table (declaration), table (the result copy)
+    if (lua_objlen(L, -2) == 0)   // empty declaration table 
+        return;
+    // deep copy of all table entries
+    lua_newtable(L);    // the table copy for the result
+    lua_pushnil(L);  // first key
+    while (lua_next(L, -4) != 0) {
+         // key is at index -2 and value at index -1
+         // ignore all keys besides strings - ignore key 1, the object type
+         lua_pushvalue(L, -2); // a copy of key for work
+         if (lua_istable(L, -2)) {
+            // a token as value - we need a deep copy
+            lua_newtable(L);    // the table copy for the result
+            lua_pushnil(L);  // first key
+            while (lua_next(L, -4) != 0) {
+                 // key is at index -2 and value at index -1
+                 // ignore all keys besides strings - ignore key 1, the object type
+                 lua_pushvalue(L, -2); // a copy of key for work
+                 lua_pushvalue(L, -2); // a copy of value for work - no tokens within tokens allowed!
+                 lua_rawset(L, -5);    // store
+                 lua_pop(L, 1);  // remove value, leave original key for loop
+            }
+         } else {
+            // all other values are no references - a copy is sufficient
+            lua_pushvalue(L, -2); // a copy of value for work
+         }
+         lua_rawset(L, -5);    // store
+         lua_pop(L, 1);  // remove original value, leave original key for loop
+    }
+    
+    int resultsize = lua_objlen(L, -2);   // last index of result table
+    lua_rawseti(L, -2, resultsize + 1);   // append tile key
+    return;
+}
+
+static int tileDeclForTile(lua_State *L, bool isTop = false) {
+    // tile, table (the result)
+    
+    // this is a recursive function - ensure enough space on the stack
+    if (lua_gettop(L) >  LUA_MINSTACK - 5)
+        lua_checkstack(L, 10);         // guarantee another 10 free slots
+        
+    lua_getmetatable(L, -2);
+    if (!isTop) {
+        lua_rawgeti(L, -1, 3);    // tile key or nil
+        if (!lua_isnil(L, -1)) {
+            int resultsize = lua_objlen(L, -3);   // last index of result table
+            lua_rawseti(L, -3, resultsize + 1);   // append tile key
+            lua_pop(L, 1);     // metatable
+            return 0;
+        }
+        lua_pop(L, 1);     // tile key 
+    }
+    
+    lua_rawgeti(L, -1, 1);    // first tile part
+    lua_pushvalue(L, -3);     // result table
+    if (is_tile(L, -2))
+        tileDeclForTile(L);
+    else
+        tileDeclForTable(L);
+    lua_pop(L, 2);  // tile or table and 
+    lua_rawgeti(L, -1, 2);    // second optional tile part
+    if (!lua_isnil(L, -1)) {
+        lua_pushvalue(L, -3);     // result table
+        if (is_tile(L, -2))
+            tileDeclForTile(L);
+        else
+            tileDeclForTable(L);
+        lua_pop(L, 1);  // result table
+    }
+    lua_pop(L, 2);  // tile or table or nil + metatable
+    return 0;
+}
+
+static int tileDeclaration(lua_State *L) {
+    // tile
+    if (lua_gettop(L) != 1) {
+        throwLuaError(L, "Tile declaration with illegal arguments");
+        return 0;
+    }
+    lua_newtable(L); // the result
+    tileDeclForTile(L, true);
+    return 1;
+}
+
 static int appendTile(lua_State *L) {
     // (tile|table) .. (tile|table)
     if (!((is_tile(L, 1)||is_table(L, 1)) && (is_tile(L, 1)||is_table(L, 1)))) {
@@ -2278,7 +2387,7 @@
         return 0;
     }
     lua_getmetatable(L, 1);
-    lua_rawgeti(L, -1, 1);   // content table
+    lua_rawgeti(L, -1, 1);    // content table
     lua_pushvalue(L, 2);      // copy key
     lua_rawget(L, -2);        // check for existing entry in table
     return 1;
@@ -2290,11 +2399,11 @@
         throwLuaError(L, "Tiles: key is not a string");
         return 0;
     }
-    if (is_table(L, 3)) {
+    if (is_table(L, 3) || is_tile(L, 3)) {
         // convert table to a tile
-        pushNewTile(L, 1);
+        pushNewTile(L, 1, lua_tostring(L, 2));
         lua_remove(L, 3);   
-    } else if (!is_tile(L, 3)) {
+    } else {
         throwLuaError(L, "Tiles: value is not a tile or table");
         return 0;
     }
@@ -2571,7 +2680,7 @@
 static CFunction worldMethods[] = {
     {createWorld,                   "create"},
     {registerWorldUserMethod,       "_register"},
-    {evaluateKey,                    "_evaluate"},
+    {evaluateKey,                   "_evaluate"},
     {getFloor,                      "fl"},
     {getItem,                       "it"},
     {getStone,                      "st"},
@@ -2587,6 +2696,7 @@
 };
 
 static CFunction tileMethods[] = {
+    {tileDeclaration,               "_declaration"},
     {0,0}
 };
 



From ral at mail.berlios.de  Fri May 16 00:10:58 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 16 May 2008 00:10:58 +0200
Subject: [Enigma-game-svn] r1147 - team_levelpacks/team_test_new_api
Message-ID: <200805152210.m4FMAwos014232@sheep.berlios.de>

Author: ral
Date: 2008-05-16 00:10:57 +0200 (Fri, 16 May 2008)
New Revision: 1147

Added:
   team_levelpacks/team_test_new_api/ralT044_1.xml
   team_levelpacks/team_test_new_api/ralT045_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT042_1.xml
Log:
Test Level new API:
- update test level for lightpassenger stone add pencil, brush
- add test levels demoing autotiling for 1 and 2 char base


Modified: team_levelpacks/team_test_new_api/ralT042_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT042_1.xml	2008-05-15 21:35:57 UTC (rev 1146)
+++ team_levelpacks/team_test_new_api/ralT042_1.xml	2008-05-15 22:10:57 UTC (rev 1147)
@@ -33,7 +33,6 @@
 ti["S"] = {"st_laser_s", state=ON}
 ti["W"] = {"st_laser_w", state=ON}
 ti["t"] = {"st_switch", target="Laser", action="turn"}
-ti["b"] = {"st_switch", target="Laser", action="turnback"}
 
 ti["T"] = {"st-turnstile"}
 ti["e"] = {"st-turnstile-e"}
@@ -43,6 +42,8 @@
 ti["w"] = {"st-wood"}
 ti["h"] = {"it_hammer"}
 ti["m"] = {"it-magicwand"}
+ti["b"] = {"it_brush"}
+ti["p"] = {"it-pencil"}
 
 ti["B"] = {"st_boulder_s"}
 
@@ -54,7 +55,7 @@
 "                s   ",
 "E     w    lW       ",
 "    il              ",
-"          Ahm       ",
+"          Ahmbppp   ",
 " ww     S       g   ",
 "E        w          ",
 "E    w              ",

Added: team_levelpacks/team_test_new_api/ralT044_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT044_1.xml	2008-05-15 21:35:57 UTC (rev 1146)
+++ team_levelpacks/team_test_new_api/ralT044_1.xml	2008-05-15 22:10:57 UTC (rev 1147)
@@ -0,0 +1,55 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test autotile new API" el:subtitle="" el:id="20080514ral595"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-sahara"}
+
+ti["f"] = {"it_floppy"}
+ti["template_a"] = {"st_floppy", target={"door%%#*","laser%%"}}
+ti["template_A"] = {"st_blocker", "door%%#"}
+ti["template_1"] = {"st_laser_s", "laser%%"}
+
+ti["x"] = ti["f"] .. {"#ac-blackball"} 
+
+local resolver = res.autotile(ti, {"a", "e", "template_a"}, 
+    {"A", "E", "template_A"},  {"1", "5", "template_1"})
+
+w, h = wo(resolver, " ", {
+"                    ",
+"                    ",
+"   a   DB  e    BC  ",
+"                    ",
+"   CD  b   AE   c   ",
+"                    ",
+"   d   EA           ",
+"                    ",
+"           x        ",
+"                    ",
+"                    ",
+"   4  2  5  1  3    ",
+"                    "
+})
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT044_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralT045_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT045_1.xml	2008-05-15 21:35:57 UTC (rev 1146)
+++ team_levelpacks/team_test_new_api/ralT045_1.xml	2008-05-15 22:10:57 UTC (rev 1147)
@@ -0,0 +1,60 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test autotile 2 new API" el:subtitle="" el:id="20080514ral541"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+
+ti["  "] = {"fl-sahara"}
+
+ti["ff"] = {"it_floppy"}
+ti["template_a"] = {"st_floppy", target={"door%%#*","laser%%"}}
+ti["template_A"] = {"st_blocker", "door%%#"}
+ti["template_L"] = {"st_laser_s", "laser%%"}
+
+ti["xx"] = ti["ff"] .. {"#ac-blackball"} 
+
+local resolver = res.autotile(ti, {"a0", "a5", "template_a"}, 
+--local resolver = res.autotile(ti, {"a", "template_a"}, 
+    {"A", "template_A"}, {"L", "template_L"})
+
+w, h = wo(resolver, "  ", {
+"                                        ",
+"                                        ",
+"      a1      A4A2      a5      A2A3    ",
+"                                        ",
+"      A3A4    a2      A1A5      a3      ",
+"                                        ",
+"      a4      A5A1                      ",
+"                                        ",
+"            xx                          ",
+"                                        ",
+"                                        ",
+"      L4    L2    L5    L1    L3        ",
+"                                        "
+})
+
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT045_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Fri May 16 22:34:30 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Fri, 16 May 2008 22:34:30 +0200
Subject: [Enigma-game-svn] r1148 - trunk/data
Message-ID: <200805162034.m4GKYUvc013402@sheep.berlios.de>

Author: ral
Date: 2008-05-16 22:34:30 +0200 (Fri, 16 May 2008)
New Revision: 1148

Modified:
   trunk/data/api2init.lua
Log:
Trunk 1.1: new API
- composer resolver added
  generates tile declarations base tiles - see upcoming samples
  and refman docu


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-05-15 22:10:57 UTC (rev 1147)
+++ trunk/data/api2init.lua	2008-05-16 20:34:30 UTC (rev 1148)
@@ -266,10 +266,8 @@
 
 function res.autotile(subresolver, ...)
     -- syntax: ... = <{prefixkey, template} | {fistkey, lastkey, template}>
+    -- context: [4] = table with unmodified rule tables
     local args = {...}
-    -- TODO check args!
-    -- check tables contain only strings (2 or 3)
-    -- check in case of 3 that last > first in last char, but equal in first chars,
     for i, rule in ipairs(args) do
         if type(rule) ~= "table" then
             error("Resolver autotile rule " .. i.." is not a table", 2)
@@ -298,3 +296,30 @@
     local context = {res.autotile_implementation, nil, subresolver, args}
     return context
 end
+
+function res.composer_implementation(context, evaluator, key, x, y)
+    local tile = evaluator(context[3], key, x, y)
+    if tile ~= nil then
+        return tile
+    end
+    -- try to compose tile
+    for i = 1, #key do
+        local subkey = string.rep(" ", i-1) .. string.sub(key, i, i) .. string.rep(" ", #key - i)
+        local subtile = evaluator(context[3], subkey, x, y)
+        if subtile == nil then
+            return nil
+        end
+        if tile == nil then
+            tile = subtile
+        else
+            tile = tile .. subtile
+        end
+    end
+    return tile
+end
+
+function res.composer(subresolver)
+    local context = {res.composer_implementation, nil, subresolver}
+    return context
+end
+



From raoulb at bluewin.ch  Sat May 17 12:01:26 2008
From: raoulb at bluewin.ch (Raoul)
Date: Sat, 17 May 2008 12:01:26 +0200
Subject: [Enigma-game-svn] Revision 1149
Message-ID: <20080517120126.144d0a88@amarok.loinet.zh>

-> Added 16 new levels
=> Currently 79 new levels for Enigma 1.1


From ral at mail.berlios.de  Sat May 17 23:03:32 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 17 May 2008 23:03:32 +0200
Subject: [Enigma-game-svn] r1150 - in trunk: data src src/stones
Message-ID: <200805172103.m4HL3W8k010695@sheep.berlios.de>

Author: ral
Date: 2008-05-17 23:03:31 +0200 (Sat, 17 May 2008)
New Revision: 1150

Modified:
   trunk/data/api2init.lua
   trunk/src/items.cc
   trunk/src/lua.cc
   trunk/src/stones/LightPassengerStone.cc
Log:
Trunk 1.1: new API
- resolver finalization added
- res.composer specila 3 char tile key handling added 
- fix Coin - disable state changes due to message like toggle, signal
- LightPassenger fix state set of 0


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-05-17 09:55:43 UTC (rev 1149)
+++ trunk/data/api2init.lua	2008-05-17 21:03:31 UTC (rev 1150)
@@ -303,7 +303,7 @@
         return tile
     end
     -- try to compose tile
-    for i = 1, #key do
+    for i = #key, 1, -1 do
         local subkey = string.rep(" ", i-1) .. string.sub(key, i, i) .. string.rep(" ", #key - i)
         local subtile = evaluator(context[3], subkey, x, y)
         if subtile == nil then
@@ -314,6 +314,13 @@
         else
             tile = tile .. subtile
         end
+        if #key == 3 then
+            subkey = string.sub(key, 1, i-1) .. " " .. string.sub(key, i+1)
+            local subtile2 = evaluator(context[3], subkey, x, y)
+            if subtile2 ~= nil then
+                return subtile2 .. subtile
+            end
+        end
     end
     return tile
 end

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-05-17 09:55:43 UTC (rev 1149)
+++ trunk/src/items.cc	2008-05-17 21:03:31 UTC (rev 1150)
@@ -667,6 +667,9 @@
         // Object interface
         virtual std::string getClass() const;
 
+        // StateObject interface
+        virtual void setState(int extState);
+
         // GridObject interface
         virtual void processLight(Direction d);
         
@@ -689,6 +692,10 @@
         return "Coin";
     }
     
+    void Coin::setState(int extState) {
+        // ignore any state access
+    }
+
     void Coin::processLight(Direction d) {
         sound_event("itemtransform");
         switch (state) {

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2008-05-17 09:55:43 UTC (rev 1149)
+++ trunk/src/lua.cc	2008-05-17 21:03:31 UTC (rev 1150)
@@ -2054,6 +2054,23 @@
     }
     
     // TODO finalization of resolvers
+    lua_getfield(L, LUA_REGISTRYINDEX, LUA_ID_RESOLVER);
+    while (is_table(L, -1)) {
+        lua_rawgeti(L, -1, 2);      // get resolver finalization at index 2
+        if (!lua_isnil(L, -1)) {
+            lua_pushvalue(L, -2);       // duplicate table as resolver context
+            int retval=lua_pcall(L, 1, 0, 0);     // resolver(context,evaluator,key,x,y) ->  tile
+            if (retval!=0) {
+                throwLuaError(L, "Error within tile key resolver finalization");
+                return 0;
+            }
+        } else {
+            lua_pop(L, 1);  // nil
+        }
+        lua_rawgeti(L, -1, 3);      // get subresolver at index 3
+        lua_remove(L, -2);          // substitute current resolver table by subresolver
+    }
+    lua_pop(L, 1);   // final resolver
     
     lua_pushinteger(L, width);
     lua_pushinteger(L, height);

Modified: trunk/src/stones/LightPassengerStone.cc
===================================================================
--- trunk/src/stones/LightPassengerStone.cc	2008-05-17 09:55:43 UTC (rev 1149)
+++ trunk/src/stones/LightPassengerStone.cc	2008-05-17 21:03:31 UTC (rev 1150)
@@ -72,7 +72,7 @@
                 if (objFlags & OBJBIT_LIGHTNEWDIRS)  // currently enlighted?
                     GameTimer.set_alarm(this, calcInterval(), false);
             }
-        } else if ((state == ON || state == BLINK) && state == 0) {
+        } else if ((state == ON || state == BLINK) && extState == 0) {
             state = OFF;
             objFlags &= ~OBJBIT_SKATEDIR;  // NODIR
             if (isDisplayable())



From ral at mail.berlios.de  Sat May 17 23:25:09 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sat, 17 May 2008 23:25:09 +0200
Subject: [Enigma-game-svn] r1151 - team_levelpacks/team_test_new_api
Message-ID: <200805172125.m4HLP92G012095@sheep.berlios.de>

Author: ral
Date: 2008-05-17 23:25:09 +0200 (Sat, 17 May 2008)
New Revision: 1151

Added:
   team_levelpacks/team_test_new_api/ralD001_1.xml
   team_levelpacks/team_test_new_api/ralD002_1.xml
   team_levelpacks/team_test_new_api/ralT046_1.xml
   team_levelpacks/team_test_new_api/ralT047_1.xml
Log:
Test Level new API:
- add test levels demoing tile composing for 2 and 3 char base
- add demo levels for resolver chaining and custom resolver

Added: team_levelpacks/team_test_new_api/ralD001_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD001_1.xml	2008-05-17 21:03:31 UTC (rev 1150)
+++ team_levelpacks/team_test_new_api/ralD001_1.xml	2008-05-17 21:25:09 UTC (rev 1151)
@@ -0,0 +1,62 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Demo User Resolver" el:subtitle="" el:id="20080516ral198"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2007 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti["r"] = {"fl-rough-red"}
+ti["b"] = {"fl-rough-blue"}
+ti["1"] = {"#ac-blackball"}
+
+ti["x"] = {"it_cross"}
+
+function myresolver(key, x, y)
+    if key == " " then
+        local center = ((x%3) * (y%3))%2 
+        local checker = ((math.modf(x/3) %2) + (math.modf(y/3) %2))%2
+        if center + checker == 1 then
+            return ti["r"]
+        else
+            return ti["b"]
+        end
+    else
+        return ti[key]
+    end
+end
+
+w, h = wo(myresolver, " ", {
+"                    ",
+"                    ",
+"                    ",
+"      x x           ",
+"       x            ",
+"      x x           ",
+"                    ",
+"          1         ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    "
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralD001_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralD002_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralD002_1.xml	2008-05-17 21:03:31 UTC (rev 1150)
+++ team_levelpacks/team_test_new_api/ralD002_1.xml	2008-05-17 21:25:09 UTC (rev 1151)
@@ -0,0 +1,56 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Demo Resolver Chain" el:subtitle="" el:id="20080516ral274"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti["~"] = {"fl-water"}
+ti["s"] = {"fl-sahara"}
+ti["t"] = {"fl-tigris"}
+ti["1"] = {"ac-blackball", 0, 0.5}
+
+ti["template_trigger"] = {"it_trigger", target="myoxyd%%", action="open"}
+ti["template_oxyd"]    = ti["~"] .. {"st_oxyd", "myoxyd%%"}
+
+myrandom = res.random(ti, " ", {"s", "t"})
+
+myautotile = res.autotile(myrandom, {"a", "h", "template_trigger"}, 
+                              {"A", "H", "template_oxyd"})
+                                    
+w, h = wo(myautotile, " ", {
+"A~                ~E",
+"~~                ~~",
+"~~   h        b   ~~",
+"~~                ~~",
+"B~     c    d     ~F",
+"~~                ~~",
+"~~        1       ~~",
+"~~                ~~",
+"C~     f    e     ~G",
+"~~                ~~",
+"~~   g        a   ~~",
+"~~                ~~",
+"D~                ~H"
+})
+
+wo:shuffleOxyd()
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralD002_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralT046_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT046_1.xml	2008-05-17 21:03:31 UTC (rev 1150)
+++ team_levelpacks/team_test_new_api/ralT046_1.xml	2008-05-17 21:25:09 UTC (rev 1151)
@@ -0,0 +1,58 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test composer new API" el:subtitle="" el:id="20080516ral373"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti["  "] = {"fl-sahara"}
+ti[" ="] = {"fl-tigris"}
+ti[" ."] = {"fl-abyss"}
+ti[" ~"] = {"fl-water"}
+ti[" ;"] = {"fl-leaves"}
+
+ti["# "] = {"st-rock1"}
+ti["W "] = {"st-wood"}
+ti["X "] = {"st_oxyd"}
+ti["G "] = {"st-grate1"}
+
+ti["2 "] = {"it_coin_s"}
+ti["s "] = {"it-seed"}
+ti["c "] = {"it-cherry"}
+ti["h "] = {"it_hammer"}
+
+ti["k "] = {"it_key"} .. ti({"st-glass1"})
+
+ti["xx"] = {"#ac-blackball"} 
+
+local resolver = res.composer(ti)
+
+w, h = wo(resolver, "  ", {
+"                                        ",
+"  h= ;W;2;c G~ ~# #.2.X X~k=k;          ",
+"                                        ",
+"  2;s;    2.s.    2=s=                  ",
+"  c;h;    c.h.    c=h=    xx            ",
+"                                        "
+})
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT046_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native

Added: team_levelpacks/team_test_new_api/ralT047_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT047_1.xml	2008-05-17 21:03:31 UTC (rev 1150)
+++ team_levelpacks/team_test_new_api/ralT047_1.xml	2008-05-17 21:25:09 UTC (rev 1151)
@@ -0,0 +1,62 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test composer 3 new API" el:subtitle="" el:id="20080517ral601"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti["   "] = {"fl-sahara"}
+ti["  ="] = {"fl-tigris"}
+ti["  ."] = {"fl-abyss"}
+ti["  ~"] = {"fl-water"}
+ti["  ;"] = {"fl-leaves"}
+
+ti["#  "] = {"st-rock1"}
+ti["W  "] = {"st-wood"}
+ti["X  "] = {"st_oxyd"}
+ti["G  "] = {"st-grate1"}
+
+ti[" 2 "] = {"it_coin_s"}
+ti[" s "] = {"it-seed"}
+ti[" c "] = {"it-cherry"}
+ti[" h "] = {"it_hammer"}
+
+ti[" k "] = {"it_key"} 
+
+ti["#2 "] = {"it_sword"}
+ti["# ~"] = {"fl-hay"}
+ti[" 2~"] = {"fl-gray"}
+
+ti["xxx"] = {"#ac-blackball"} 
+
+local resolver = res.composer(ti)
+
+w, h = wo(resolver, "   ", {
+"                                                            ",
+"    h=  ;W ; 2; c G ~  ~#  # . 2.X  X ~Gk=Gk;   Gc          ",
+"                                                Gh          ",
+"    2; s;       2. s.       2= s=               #2=         ",
+"    c; h;       c. h.       c= h=      xxx      #k~         ",
+"                                                G2~         "
+})
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT047_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Sun May 18 15:22:58 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 18 May 2008 15:22:58 +0200
Subject: [Enigma-game-svn] r1152 - trunk/doc/reference
Message-ID: <200805181322.m4IDMwM1004364@sheep.berlios.de>

Author: ral
Date: 2008-05-18 15:22:55 +0200 (Sun, 18 May 2008)
New Revision: 1152

Modified:
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk 1.1: new API
- refman docu for resolvers: application, lib, development
- refman some typo fixes

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-05-17 21:25:09 UTC (rev 1151)
+++ trunk/doc/reference/enigma-ref.texi	2008-05-18 13:22:55 UTC (rev 1152)
@@ -39,6 +39,7 @@
 * Actor Objects::
 * Other Objects::               Rubberbands, etc.
 * Advanced Features::           Fire, ...
+* Extension Development::       Resolver, Library Development
 * Old API - Objects::           Description of all objects in Enigma
 * Old API - Variables::         Lua variables that influence the game
 * Old API - Functions::               Predefined functions
@@ -2878,15 +2879,15 @@
 @samp{A..Z}, numbers @samp{0..9} and the underscore @samp{_}. Other special
 charcters are only allowed as far as they are explained in the following text.
 
+ at cindex auto naming
 It is up to you to ensure unique names. Reusage of an already assigned name
 will unname the prior object and assign the name to the new object. To simplify
 the naming of larger groups of similar objects you can add the hash sign 
 @samp{#} as the last character to a name, e.g. @samp{mydoor#}. This causes Enigma
-to add a unique number to the given string. The number will start with 1, the
-first unused number will be taken. Thus the first door will be named
- at samp{mydoor#1} the second one @samp{mydoor#2} and so on. If you delete the
-object named @samp{mydoor#2} lateron and if you name another object 
- at samp{mydoor#} it will be assigned the unused name @samp{mydoor#2}.
+to add a unique random number to the given string. Thus an auto named object
+will never unname another prior auto named object. But if you delete an 
+auto named object that has been named e.g. @samp{mydoor#132} the number and
+the same name may be assigned to another that is created lateron.
 
 All named objects are registered by the @dfn{named object} repository. The API
 provides a variable @samp{no} that allows you to retrieve any named object, e.g.
@@ -2906,6 +2907,31 @@
 references, a table of object names or a object name with wildcards. Thus
 the string @samp{"mydoor#*"} is a valid target.
 
+ at cindex nearest object
+Often switches are located near by their target object. As a major shortcut
+you can reference the nearest object out of a group by prefixing its name
+with an @samp{@@} character.
+
+ at example
+ti["F"] = @{"st_floppy", target="@@door#*"@}
+ti["D"] = @{"st_blocker", name="door#"@}
+ at end example
+
+With this tile declaration you can describe arbitrary number of floppy switches
+and nearby blocker doors in a world map all by the same two tile key characters.
+Every floppy switch will target the nearest blocker door. If two target are
+given within the same distance the one located in the south will win. If the
+targets are additionally horizontally aligned the one located in east will win.
+In the rare case of objects located on the same position stones will preceed
+items, floors and actors. The chosen target or destination depends just on the
+location of these objects and their type, but nothing else. Thus you can rely
+on a stable selection mechanism.
+
+By usage of this nearest object feature you can drastically reduce the number
+of needed tile declarations. @ref{Nearest Object Clustering} may help you in
+case of wrong selected equidistant targets. @ref{Auto Tiling} is another 
+feature for reducing the need of tile declarations.
+
 Another unique feature of object names is their late on access evaluation. This
 allows you to reference an object prior to its existence. E.g. if you want to
 set two vortices each declaring the other one as its destination, object names
@@ -3100,7 +3126,7 @@
 
 Objects like the switch can be triggered on and off. Each time they will
 perform the action. If you would like the door to open and close in turn to
-the switch you another action than @samp{open}. The universal message for
+the switch you need another action than @samp{open}. The universal message for
 changing targets in their alternate states is @samp{toggle}.
 
 @example
@@ -3120,7 +3146,7 @@
 switch states and the door.
 
 As you remember messages can take a value. Action messages are no exception.
-Every objects sends its actions with a value, usually a bool value. A switch
+Every object sends its actions with a value, usually a bool value. A switch
 sends a value @samp{true} if it just switched on, and a value @samp{false} if
 it just switched off. The appropriate message for the door would be the 
 universal message @samp{signal}:
@@ -3132,11 +3158,11 @@
 Now the door will open when the switch is turned on and close if the switch is
 turned off.
 
-If you look at @ref{signal} you will notice that this messages takes an integer
-value of @samp{0} or @samp{1}. Indeed the action value does not match. But in
-this as in many other cases the messages and values are designed in a way that
-they are autoconverted to the appropriated type. This compatibility is the basis
-for a seamless plugging of objects.
+The message @ref{signal} takes an integer value of @samp{0} or @samp{1}. 
+Indeed the action value does not match. But in this as in many other cases 
+the messages and values are designed in a way that they are autoconverted to
+the appropriated type. This compatibility is the basis for a seamless plugging
+of objects.
 
 In many cases authors face the task of triggering two or more objects by a
 single object. @samp{target} and @samp{action} are both able to take 
@@ -3180,10 +3206,12 @@
 standard action @ref{signal}. But sometimes you may want to perform very state
 specific actions. Let us look how this can be done.
 
-E.g. a @ref{st_fourswitch} that switches two @ref{st_laser} beaming in 3 states
-but one of them being switched off while in @samp{EAST} state and the other being
-switched off while in @samp{WEST} state. This can be done by usage of state
-dependent target and actions:
+E.g. let us take an @ref{st_fourswitch}, that has four states, and two 
+ at ref{st_laser} which should be switched on and off. Both lasers should emit
+their beams while the fourswitch is in 3 of its states. But one of them should
+be off just while the fourswitch is in the @samp{EAST} state and the other
+should be off just while the fourswitch is in the @samp{WEST} state. 
+This can be done by usage of state dependent target and actions:
 
 @example
 @{st_fourswitch, target_3="laser#2", action_3="on",
@@ -3312,7 +3340,7 @@
 
 Some objects do process internal state transformations that cannot be configured
 by attributes. But some of these states may be of interest on describing a
-snapshot of a level. Where possible special object subkinds exists with a suffix
+snapshot of a level. Where possible a special object subkind exists with a suffix
 of @samp{_new}. These objects can be used in the initial level description to
 set objects in special initial states. E.g. @ref{it_blocker} provides such a
 special subkind. Note that these objects will never report their initial
@@ -3346,6 +3374,9 @@
 * Enigma Lua Types::   
 * Object Definitions and Tiles::
 * Lua Positions::
+* World Creation and Resolver Chaining::
+* Custom Resolver::
+
 @end menu
 
 @c ----------------- Lua Example -------------------- 
@@ -3369,8 +3400,176 @@
 
 @node Lua Positions
 @section Lua Positions
+ at c ----------------- World Creation and Resolver Chaining -------------------- 
 
+ at node World Creation and Resolver Chaining
+ at section World Creation and Resolver Chaining
 
+Once all parameters have been set and all tiles have been declared it is time
+to create the level world with all its objects. This is done by the following
+constructor that appears in two variations.
+
+ at table @asis
+ at item @b{Syntax:}
+width, height = @b{wo}(@i{topresolver}, @i{defaultkey}, @i{map})
+
+width, height = @b{wo}(@i{topresolver}, @i{defaultkey}, @i{width}, @i{height})
+
+ at table @asis
+ at item @i{topresolver} = @code{ti} | @i{resolver} | @i{localresolver}
+Every tile in the world is given by a key that needs to be resolved to its
+declaration. This can be done either by the tiles repository @samp{ti}, or
+by given library @ref{Resolvers} or by local @ref{Custom Resolver} function.
+This argument takes the top resolver that is requested first.
+ at item @i{defaultkey}
+A string that defines the key that should be taken as default. It is taken
+if no other key is given and it is added to a tile if a floor object is
+missing. The character length of this key defines the key size within the map
+ at item @i{map}
+A table of strings. Each string describes a row of tiles by its tile keys.
+If a map is given, the worlds size is determined from the longest string and
+the number of rows.
+ at item @i{width}
+As an argument that is given instead of a map it describes the width of the
+desired world.
+ at item @i{height}
+As an argument that is given instead of a map it describes the height of the
+desired world.
+ at end table
+
+ at item @b{Syntax Samples:}
+ at example
+w, h = wo(ti, "  ", 20, 13)
+w, h = wo(resolver, " ", {
+       "                    ",
+       ...
+       "                    "})
+ at end example
+
+ at item @b{Details:}
+This world constructor may just be called once. Every subsequent call causes
+an error. This call sets the size of the world to fixed values that are reported
+by its two return values. The world size can lateron be retrieved by the world
+attributes @ref{Width} and @ref{Height}, too.
+
+A mapless world is filled with default tiles. Rows in a given map that are
+shorter than others are filled with default tiles, too. Any tile that does
+not define a floor object will add the floor object of the default tile.
+
+Every key is resolved to its tile declaration via the given resolver chain.
+The top resolver is given to this call as a parameter. If it is @samp{ti} the
+chain consists just of one element and the tile delaration stored in the tiles
+repository at the given key is taken. But there exist several useful 
+ at ref{Resolvers} that may simplify the task of level writing or provide dynamic
+features like randomness, mazes, etc. If you like to use one or several of them
+you provide the instance of the resolver to be requested first in this 
+constructor. The instance that should be requested next is set in the top
+resolver as first argument, and so on. The last library resolver takes usually
+ at samp{ti} as its subresolver. For even more flexibility you can provide an
+own @ref{Custom Resolver} function within the level to take influence on the key
+interpretation. This function has to be the last resolver in the chain.
+
+ at item @b{Example:}
+ at example
+ti["~"] = @{"fl_water"@}
+ti["s"] = @{"fl_sahara"@}
+ti["t"] = @{"fl_tigris"@}
+ti["1"] = @{"ac-blackball", 0, 0.5@}
+
+ti["template_trigger"] = @{"it_trigger", target="myoxyd%%", action="open"@}
+ti["template_oxyd"]    = ti["~"] .. @{"st_oxyd", "myoxyd%%"@}
+
+myrandom = res.random(ti, " ", @{"s", "t"@})
+
+myautotile = res.autotile(myrandom, @{"a", "h", "template_trigger"@}, 
+                              @{"A", "H", "template_oxyd"@})
+                                    
+w, h = wo(myautotile, " ", @{
+"A~                ~E",
+"~~                ~~",
+"~~   h        b   ~~",
+"~~                ~~",
+"B~     c    d     ~F",
+"~~                ~~",
+"~~        1       ~~",
+"~~                ~~",
+"C~     f    e     ~G",
+"~~                ~~",
+"~~   g        a   ~~",
+"~~                ~~",
+"D~                ~H"
+@})
+
+wo:shuffleOxyd()
+ at end example
+ at end table
+
+ at c ----------------- Custom Resolver -------------------- 
+
+ at node Custom Resolver
+ at section Custom Resolver
+
+A customer resolver is a function in the level that allows a dynamic remapping
+of tiles. When this function is registered in the resolver chain it is called
+once for every tile to be set. The tile that this function return will be set.
+
+Typical use cases are design patterns that are easy to calculate, but tedious
+to draw in the map and dynamic generated levels that differ slightly on every
+restart.
+
+ at table @asis
+ at item @b{Syntax:}
+tile = @b{myresolver}(@i{key}, @i{x}, @i{y})
+
+ at table @asis
+ at item @i{key}
+String that contains the tile key to be resolved.
+ at item @i{x}
+The world x coordinate of the tile.
+ at item @i{x}
+The world y coordinate of the tile.
+ at end table
+
+ at item @b{Example:}
+ at example
+ti["r"] = @{"fl_rough_red"@}
+ti["b"] = @{"fl_rough_blue"@}
+ti["1"] = @{"#ac-blackball"@}
+
+ti["x"] = @{"it_cross"@}
+
+function myresolver(key, x, y)
+    if key == " " then
+        local center = ((x%3) * (y%3))%2 
+        local checker = ((math.modf(x/3) %2) + (math.modf(y/3) %2))%2
+        if center + checker == 1 then
+            return ti["r"]
+        else
+            return ti["b"]
+        end
+    else
+        return ti[key]
+    end
+end
+
+w, h = wo(myresolver, " ", @{
+"                    ",
+"                    ",
+"                    ",
+"      x x           ",
+"       x            ",
+"      x x           ",
+"                    ",
+"          1         ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    "
+@})
+ at end example
+ at end table
+
 @c ===================  Commons  =======================
 @node Common Attributes and Messages
 @chapter Common Attributes and Messages
@@ -3545,13 +3744,30 @@
 @section Global Attributes
 
 @menu
+* Height::
 * IsDifficult:: 
 * MagnetRange:: 
-* MagnetStrength:: 
+* MagnetStrength::
+* Width::
 * WormholeRange:: 
 * WormholeStrength:: 
 @end menu
 
+ at node Height
+ at subsection Height
+
+A global read only variable reports the height of the the world in grid units.
+This is set by the initial world constructor call 
+(@pxref{World Creation and Resolver Chaining}).
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ positiv integer number
+ at item @b{Default:} @ @ @code{?}
+ at item @b{Access:} @ @ read only
+ at item @b{Support:} @ @ object independent
+ at end table
+
 @node IsDifficult
 @subsection IsDifficult
 
@@ -3598,6 +3814,21 @@
 @item @b{Support:} @ @ @ref{it_magnet}
 @end table
 
+ at node Width
+ at subsection Width
+
+A global read only variable reports the width of the the world in grid units.
+This is set by the initial world constructor call 
+(@pxref{World Creation and Resolver Chaining}).
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ positiv integer number
+ at item @b{Default:} @ @ @code{?}
+ at item @b{Access:} @ @ read only
+ at item @b{Support:} @ @ object independent
+ at end table
+
 @node WormholeRange
 @subsection WormholeRange
 
@@ -5140,10 +5371,10 @@
 
 Even though most levels make use of just a single pair of each color, there
 is no limit on a single color. If you like you can define 3 blue pairs of oxyds
-together with 2 yellow pairs. You do this by setting explicit @samp{color}
+together with 2 yellow pairs. You do this by setting explicit @samp{oxydcolor}
 attributes to the oxyds.
 
-For standard levels the @samp{color} can be set to its default @samp{OXYD_AUTO}.
+For standard levels the @samp{oxydcolor} can be set to its default @samp{OXYD_AUTO}.
 This causes an automatic coloring by pairs of colors in the standard color
 sequence.
 
@@ -5206,7 +5437,7 @@
 @item @code{"c"} blue, flat stone that opens by a concentric animation
 @item @code{"d"} dark blue, pyramid like stone that opens like a flower
 @end table
- at item @b{color}, @ @ @i{values}: @code{OXYD_AUTO}, @code{OXYD_FAKE}, @code{OXYD_FART}, @code{OXYD_BOLD}, @code{OXYD_BLUE}, @code{OXYD_RED}, @code{OXYD_GREEN}, @code{OXYD_YELLOW}, @code{OXYD_CYAN}, @code{OXYD_PURPLE}, @code{OXYD_WHITE}, @code{OXYD_BLACK}, ; @ @ @i{default}: @code{OXYD_AUTO}
+ at item @b{oxydcolor}, @ @ @i{values}: @code{OXYD_AUTO}, @code{OXYD_FAKE}, @code{OXYD_FART}, @code{OXYD_BOLD}, @code{OXYD_BLUE}, @code{OXYD_RED}, @code{OXYD_GREEN}, @code{OXYD_YELLOW}, @code{OXYD_CYAN}, @code{OXYD_PURPLE}, @code{OXYD_WHITE}, @code{OXYD_BLACK}, ; @ @ @i{default}: @code{OXYD_AUTO}
 @item @b{noshuffle} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 @item @b{static} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 Static oxyds are neither swappable nor pullable.
@@ -5539,14 +5770,579 @@
 @chapter Advanced Features
 
 @menu 
-* Oxyd Shuffling Rules::       
+* World Advanced Methods::  Additional features provided by the world
+* Resolvers::               Standard tools for interpretation of tile maps
+* Tips and Tricks::         Simple patterns that are valuable like a feature
 @end menu
 
- at node Oxyd Shuffling Rules
- at section Oxyd Shuffling Rules
+ at node World Advanced Methods
+ at section World Advanced Methods
 
+ at menu 
+* wo:shuffleOxyd::  Oxyd Shuffling Rules
+* wo:drawMap::      
+ at end menu
+
+ at c ----------------- shuffleOxyd -------------------- 
+ at node wo:shuffleOxyd
+ at subsection wo:shuffleOxyd
+
 Read API Concept Draft
 
+Work in progress!
+
+ at table @asis
+ at item @b{Syntax:}
+
+ at b{wo:shuffleOxyd}(@i{rules})
+
+ at table @asis
+ at item @i{rules} = @i{rule}, @i{rule},...
+No rule or as many as you like, all seperated by a comma.
+ at item @i{rule} = @{@i{group1}, @i{group2}, @i{maxrule}, @i{minrule}, @i{circularrule}, @i{linearrule}, @i{logrule}@}
+Each rule is a table with a subset of the listed entries. The @i{group1} entry
+is mandatory. All other entries are optional and can be added in any combination.
+ at item @i{group1} = @i{group} | @i{objectreference} | @i{objectspecifier}
+A description of oxyd objects that are part of the first rule group. Either
+a group or a single object reference or a string specifier that resolves to a
+single or via wildcard to several oxyd objects are legal descriptors.
+ at item @i{group2} = @i{group} | @i{objectreference} | @i{objectspecifier}
+A description of oxyd objects that are part of the second rule group. Either
+a group or a single object reference or a string specifier that resolves to a 
+single or via wildcard to several oxyd objects are legal descriptors.
+ at item @i{maxrule} = @code{max = }@i{number}
+The maximum number of oxyd pairs.
+ at item @i{minrule} = @code{min = }@i{number}
+The minimum number of oxyd pairs.
+ at item @i{circularrule} = @code{circular = true}
+Avoid any pair of neighboring oxyds in group1. Avoid an oxyd pair of first and
+last oxyd in group1, too.
+ at item @i{linearrule} = @code{linear = true}
+Avoid any pair of neighboring oxyds in group1.
+ at item @i{logrule} = @code{log = } @ @  @code{"solution"} |@code{"count"} |@code{"all"} 
+Log additional information to the log stream for debugging purposes and 
+security checks by the level author.
+ at end table
+
+ at item @b{Syntax Samples:}
+ at example
+wo:shuffleOxyd()
+wo:shuffleOxyd(@{"borderoxyds#*", circular=true@})
+wo:shuffleOxyd(@{"leftoxyds#*","rightoxyds#*", min=3@}, @{"islandoxyds#*", max=0@})
+ at end example
+
+ at item @b{Details:}
+
+ at item @b{Full Example:}
+ at example
+ at end example
+ at end table
+
+ at c ----------------- drawMap -------------------- 
+ at node wo:drawMap
+ at subsection wo:drawMap
+
+
+ at node Resolvers
+ at section Resolvers
+
+ at menu 
+* res.autotile::  Generate tiles from given template declarations
+* res.composer::  Compose tiles from given base tiles
+* res.maze::      Generate arbitrary chaped mazes
+* res.random::    Choosing random tiles in a given distribution
+ at end menu
+
+ at c ----------------- Autotile Resolver -------------------- 
+
+ at node res.autotile
+ at subsection res.autotile
+
+Autotiling reduces the number of required tile declarations by generating them
+according to given simple rules. The most common application are a bunch of
+identical switch like objects that target all target the same type of object
+like a door or a laser. As each of them has its individual target object it
+would require to write a separate tile declaration with a unique tile key, e.g.
+
+ at example
+ti["A"] = @{"st_floppy", target="laserA"@} 
+ti["B"] = @{"st_floppy", target="laserB"@} 
+ti["C"] = @{"st_floppy", target="laserC"@} 
+ti["a"] = @{"st_laser", name="laserA"@} 
+ti["b"] = @{"st_laser", name="laserB"@} 
+ti["c"] = @{"st_laser", name="laserC"@} 
+ at end example
+
+Autotiling requires just one template tile of each type and substitutes any
+pattern @samp{%%} by a unique substitution.
+
+ at example
+ti["template_switch"] = @{"st_floppy", target="laser%%"@} 
+ti["template_laser"]  = @{"st_laser", name="laser%%"@} 
+ at end example
+
+Independent on the number of required unique objects you have just one template.
+You just declare the used ranged of tile keys by a rule and are free to use
+them within your level map.
+
+ at table @asis
+ at item @b{Syntax:}
+
+ at b{res.autotile}(@i{subresolver}, @i{rules})
+
+ at table @asis
+ at item @i{subresolver}
+Resolver to which unresolved requests should be forwarded. May be @samp{ti}
+as the final resolver of the resolver chain.
+ at item @i{rules} = @i{rule}, @i{rule},...
+One rule or as many as you like, all seperated by a comma.
+ at item @i{rule} = @i{prefixrule} | @i{rangerule}
+Each rule can be either a prefixrule or a rangerule in any mixture
+ at item @i{prefixrule} = @{@i{prefix}, @i{template}@}
+A table with two entries. First a prefix string that is common to all tile
+keys that should be handeled followed by key string of the template tile.
+ at item @i{rangerule} = @{@i{first}, @i{last}, @i{template}@}
+A table with three entries. A string with the first key to be handled, followed
+by a string with the last key to be handled. The third value is the key string
+of the template tile.
+ at end table
+
+ at item @b{Syntax Samples:}
+ at example
+res.autotile(ti, @{"A", "template_switch"@}, @{"L", "template_laser@})
+res.autotile(ti, @{"a", "e", "template_trigger@}, @{"A", "E", "template_door"@}
+ at end example
+
+ at item @b{Details:}
+Prefix rules need a key length of at least 2. You can not use it with maps
+of just one character per tile. The resolver will create a tile declaration for
+any tile key in the map that matches the given prefix. A copy of the template
+will be taken and all occurences of the two characters @samp{%%} will be
+substituted by a single percent sign followed by the suffix of the used tile
+key. Thus a key of @samp{AD} will target the laser @samp{laser%D}. You need to
+use the key @samp{LD} in the map for the matching laser.
+
+Rangerules match any tile key in the given range. It can well be used in one
+character key maps. But it can be used in multicharacter maps, too. In this case
+the given first and last keys may just differ in the last character. Again a
+copy of the template rule will be generated and the @samp{%%} patterns will be
+substituted. But in this case the substitution is composed of a single percent
+sign followed by an interger number that counts the key position within the
+given range. Thus a key of @samp{c} will target the door @samp{door%3}. 
+You need to use the key @samp{C} in the map for the matching door.
+
+The template tile definitions can well be composed of several concatenated 
+tiles even with references of base tiles. The pattern substitution takes place
+on any attribute value containing string descriptions. A valid template would
+be:
+ at example
+ti["template"] = ti["~"] .. ti(@{"it_trigger", target=@{"door%%#*","laser%%"@}@}) .. @{"st_grate1"@}
+ at end example
+
+ at item @b{Full Example:}
+ at example
+ti[" "] = @{"fl-sahara"@}
+
+ti["template_a"] = @{"st_floppy", target=@{"door%%#*","laser%%"@}@}
+ti["template_A"] = @{"st_blocker", "door%%#"@}
+ti["template_1"] = @{"st_laser_s", "laser%%"@}
+
+ti["x"] = @{"#ac-blackball"@} .. ti(@{"it_floppy"@})
+
+local resolver = res.autotile(ti, @{"a", "e", "template_a"@}, 
+    @{"A", "E", "template_A"@},  @{"1", "5", "template_1"@})
+
+w, h = wo(resolver, " ", @{
+"                    ",
+"                    ",
+"   a   DB  e    BC  ",
+"                    ",
+"   CD  b   AE   c   ",
+"                    ",
+"   d   EA           ",
+"                    ",
+"           x        ",
+"                    ",
+"                    ",
+"   4  2  5  1  3    ",
+"                    "
+@})
+ at end example
+ at end table
+
+ at c ----------------- Composer Resolver -------------------- 
+
+ at node res.composer
+ at subsection res.composer
+
+The composer resolver reduces the number of required tile declarations by
+geneating them by composition of base tiles. Small motley levels and nearly
+every large level will use many different objects in numerous tile compositions.
+As the usable one character tile key candidates will not suffice you will need
+to use two or three character tile keys. But you will need numerous tile
+declarations, one for every used object combination.
+
+The composer frees you from declaring every used combination. You just declare
+the base objects, e.g. the floors and all stones, items, actors and use 
+combinations of these base tiles keys. The composer constructs the required
+tile declarations on the fly. E.g. with the following base tile declarations:
+
+ at example
+ti[" ."] = @{"fl_space"@}
+ti[" ~"] = @{"fl_water"@}
+ti["X "] = @{"st_grate"@}
+ti["h "] = @{"it_hammer"@}
+ at end example
+
+You can freely use any of the additional combination like @code{"X."} - a grate
+on space, @code{"X~"} - a grate on water, @code{"h."} - a hammer on space, 
+ at code{"h~"} - a hammer on water.
+
+ at table @asis
+ at item @b{Syntax:}
+
+ at b{res.composer}(@i{subresolver})
+
+ at table @asis
+ at item @i{subresolver}
+Resolver to which unresolved requests should be forwarded. May be @samp{ti}
+as the final resolver of the resolver chain.
+ at end table
+
+ at item @b{Syntax Samples:}
+ at example
+res.composer(ti)
+ at end example
+
+ at item @b{Details:}
+For every key in the map the subresolver will be first requested for a tile
+declaration. Thus any given declaration will preceede the auto composition.
+
+Just in case that no declaration exists the search starts for existing subkey
+tiles. Subkeys are keys with some characters replaced by a whitespace @samp{ }.
+For all key lengths the basic subkeys with just one character different from a
+whitespace will be examined. Additional just for three character key length
+the three keys with just one whitespace replacement and two remaining 
+original characters will be examined and these compositions will preceed the
+composition of three one character tiles.
+
+Thus for the key @code{"h~"} the composer will look for @code{"h "} and 
+ at code{" ~"}. For the three character key @code{"#h~"} The compser will look for
+ at code{"#h "} plus @code{"  ~"}, @code{"# ~"} plus @code{" h "}, @code{" h~"}
+plus @code{"#  "} and finally @code{"#  "} plus @code{" h "} plus @code{"  ~"}.
+For the 4 character key @code{"A#h~"} the compser will just look for 
+ at code{"A   "} plus @code{" #  "} plus @code{"  h "} plus @code{"   ~"}. The
+same holds for any larger key length.
+
+It is recommended to add the composer resolver behind most other library
+resolvers in the resolver chain.
+
+ at item @b{Full Example:}
+ at example
+ti["  "] = @{"fl_sahara"@}
+ti[" ="] = @{"fl_tigris"@}
+ti[" ."] = @{"fl_abyss"@}
+ti[" ~"] = @{"fl_water"@}
+ti[" ;"] = @{"fl_leaves"@}
+
+ti["# "] = @{"st_rock1"@}
+ti["W "] = @{"st_wood"@}
+ti["X "] = @{"st_oxyd"@}
+ti["G "] = @{"st_grate1"@}
+
+ti["2 "] = @{"it_coin_s"@}
+ti["s "] = @{"it_seed"@}
+ti["c "] = @{"it_cherry"@}
+ti["h "] = @{"it_hammer"@}
+
+ti["k "] = @{"it_key"@} .. ti(@{"st_glass1"@})
+
+ti["xx"] = @{"#ac-blackball"@} 
+
+local resolver = res.composer(ti)
+
+w, h = wo(resolver, "  ", @{
+"                                        ",
+"  h= ;W;2;c G~ ~# #.2.X X~k=k;          ",
+"                                        ",
+"  2;s;    2.s.    2=s=                  ",
+"  c;h;    c.h.    c=h=    xx            ",
+"                                        "
+@})
+ at end example
+
+ at end table
+
+
+ at node res.maze
+ at subsection res.maze
+
+ at node res.random
+ at subsection res.random
+
+
+
+
+ at node Tips and Tricks
+ at section Tips and Tricks
+
+ at menu 
+* Nearest Object Clustering::    When nearest object address wrong target
+ at end menu
+
+ at node Nearest Object Clustering
+ at subsection Nearest Object Clustering
+
+The nearest object as described in @ref{Object Naming} provides a major feature
+for reducing the number of needed tile declarations. As the selection needs
+to be unique a rule had to be defined in case of equal distances. South wins, 
+then East, Stone are favored to Items, Floors and Actors.
+
+In most cases level authors can arrange their objects to fit these rules. But
+sometimes the level design does not allow the straight forward usage of a
+simple nearest object selection. E.g.
+
+ at example
+ti["F"] = @{"st_floppy", target="@@door#*"@}
+ti["D"] = @{"st_blocker", name="door#"@}
+wo{ti, " ", {
+"       B            ",
+"       FB#####FB####",
+"       # F    B     ",
+"       # #    F#####",
+ at end example
+
+In both cases the floppy switch that is located at the crossing of to blocker
+doors will open the false one.
+
+But you can use a cluster concept like the one we introduced for
+ at ref{Cluster Stones}. Just add one or in rare cases two or three additional
+groups. Assign all standard cases to group A and the out of line cases in 
+group B:
+
+ at example
+ti["F"] = @{"st_floppy", target="@@doorA#*"@}
+ti["D"] = @{"st_blocker", name="doorA#"@}
+ti["f"] = @{"st_floppy", target="@@doorB#*"@}
+ti["d"] = @{"st_blocker", name="doorB#"@}
+wo{ti, " ", {
+"       b            ",
+"       fB#####fb####",
+"       # F    B     ",
+"       # #    F#####",
+ at end example
+
+By clustering the doors in two groups you just need two additional tile
+declarations. But you will likely be able to handle a dozen of additional
+switch/door combinations.
+
+
+
+ at c ==================  Extension Development  =======================
+
+ at node Extension Development
+ at chapter Extension Development
+
+ at menu 
+* Resolver Development::    
+ at end menu
+
+ at node Resolver Development
+ at section Resolver Development
+
+Resolvers are designed to provide easy pluggable extensions for usage by level 
+authors. Furtheron resolvers should be as flexible as possible. To reach these
+goals each resolver consists of three parts: the configurator, the implemention
+and the finalizer.
+
+ at menu 
+* Resolver Configurator::      
+* Resolver Implementation::      
+* Resolver Finalizer::      
+ at end menu
+
+
+ at node Resolver Configurator
+ at subsection Resolver Configurator
+
+The configurator is the function that is being called, when the author
+supplies the resolver specific parameters.
+
+ at table @asis
+ at item @b{Syntax:}
+context = @b{res.resolvername}(@i{subresolver},...)
+
+ at table @asis
+ at item @i{subresolver}
+Resolver to which unresolved requests should be forwarded. May be @samp{ti}
+as the final resolver of the resolver chain.
+ at end table
+
+ at item @b{Details:}
+This function has just one mandatory paramenter, the subresolver. You are free
+to specify arbitrary further parameters due to the needs of the resolvers task.
+
+All official resolvers will be registered in the registry table @samp{res} under
+their official name:
+
+ at example
+function res.composer(subresolver)
+    ...
+end
+ at end example
+
+This configurator function will be called just once per level start. It is 
+called after the tile declarations and before the first tile is set and the
+implementation part may be called.
+
+It is the task of the configurator function to check the user supplied
+parameters thoroughly and to provide appropriate error messages on bad
+parameters. Do this with an lua error message call at level 2:
+ at example
+error("Resolver autotile rule " .. i.." is not a table", 2)
+ at end example
+
+The configuration function has to return a table that contains the context
+for subsequent calls of the implementation. This table has three predefined
+entries:
+
+ at table @asis
+ at item @b{[1]} = @i{implementation function}
+ at item @b{[2]} = @i{finalizer function}
+ at item @b{[3]} = @i{subresolver}
+ at item @b{...} = resolver specific additional entries
+ at end table
+
+All the checked and preprocessed parameters have to be stored in this context
+table for later usage. The resolver implementation function is usually 
+registered as @samp{res.resolvername_implementation}. The finalizer can be
+ at samp{nil} if no finalization is necessary. The subresolver given as the
+first parameter of the configurator call needs to be the third context
+table entry.
+
+ at item @b{Full Example:}
+ at example
+function res.composer(subresolver)
+    local context = @{res.composer_implementation, nil, subresolver@}
+    return context
+end
+ at end example
+ at end table
+
+ at node Resolver Implementation
+ at subsection Resolver Implementation
+
+When the map gets evaluated on the world creation the top resolver is asked
+for every key to return the valid tile declaration. This is done with the
+following call.
+
+ at table @asis
+ at item @b{Syntax:}
+tile = @b{resolver_implementation}(@i{context}, @i{evaluator}, @i{key}, @i{x}, @i{y})
+
+ at table @asis
+ at item @i{context}
+The context as provided as return value by the @ref{Resolver Configurator}.
+ at item @i{evaluator}
+A system function that needs to be called whenever this resolver needs to
+look up the key by its subresolver.
+ at item @i{key}
+The key string that should be resolved
+ at item @i{x}, @i{y}
+The position of the tile.
+
+ at item @b{Details:}
+Based on the given parameters, the key, the position, the resolver parameters
+stored in the context and the existing tiles that can be requested via the
+evaluator function the implementation needs to decide if it takes influence on
+the key. Note that it is not possible to access any world object via its
+coordinate at this time. On every call you have to assume that it may be the
+first tile that is set.
+
+If the key is not resolved to a final tile by this resolver, the subresolver
+must be called via the evaluator function:
+ at example
+local tile = evaluator(context[3], key, x, y)
+ at end example
+
+Remember that the subresolver is stored at position 3 of the context. As no
+influence should be taken this tile is the one that should be returned.
+
+But if you want to return another tile you are free to do it. You can decide
+on another key and ask the subresolver for the appropriate tile. You can
+even concatenate two tiles returned by subsequent subresolver calls. You are
+allowed to return a new tile with a table declaration of an object. Some valid
+return statements:
+ at example
+return evaluator(context[3], "a", x, y)
+return evaluator(context[3], "a", x, y) .. evaluator(context[3], "b", x, y)
+return evaluator(context[3], "a", x, y) .. ti({"st_laser_n", state=ON})
+ at end example
+
+You are even allowed to add new tile declartions to the tiles repository to
+speed up subsequent calls:
+ at example
+ti["newkey"] = evaluator(context[3], "a", x, y) .. ti({"st_laser_n", state=ON})
+ at end example
+
+A resolver implementation can store and modifiy any of its private parameters
+in the context table for subsequent calls. Especially it can enlist all 
+coordinates for postprocessing operations in the finalizer.
+
+ at item @b{Full Example:}
+The implementatio of the composer (without the special 3 character key treatment)
+ at example
+function res.composer_implementation(context, evaluator, key, x, y)
+    local tile = evaluator(context[3], key, x, y)
+    if tile ~= nil then
+        return tile
+    end
+    -- try to compose tile
+    for i = 1, #key do
+        local subkey = string.rep(" ", i-1) .. string.sub(key, i, i) .. string.rep(" ", #key - i)
+        local subtile = evaluator(context[3], subkey, x, y)
+        if subtile == nil then
+            return nil
+        end
+        if tile == nil then
+            tile = subtile
+        else
+            tile = tile .. subtile
+        end
+    end
+    return tile
+end
+ at end
+
+ at node Resolver Finalizer
+ at subsection Resolver Finalizer
+
+If the @ref{Resolver Configurator} provides a finalizer function in its context
+this function will be called once when all tiles from the map have been set.
+
+ at table @asis
+ at item @b{Syntax:}
+ at b{resolver_finalization}(@i{context})
+
+ at table @asis
+ at item @i{context}
+The context as provided as return value by the @ref{Resolver Configurator}.
+ at end table
+
+ at item @b{Details:}
+The finalization functions of chained resolvers are called from top to bottom.
+
+Many resolvers have no need of a finalization. But some like a maze constructor
+need to know all participating tiles until they can do their final work.
+
+As all tiles from the map have been processed the objects can now be accessed.
+Further information may be stored in the resolvers context.
+
+The finalizer does neither call its subresolver nor does it return a value.
+ at end table
+
+ at c ===================  Old API - Objects  =======================
+
 @node Old API - Objects
 @chapter Old API - Objects
 



From ral at mail.berlios.de  Mon May 19 22:21:03 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 19 May 2008 22:21:03 +0200
Subject: [Enigma-game-svn] r1153 - in trunk: data src src/stones
Message-ID: <200805192021.m4JKL3fh001255@sheep.berlios.de>

Author: ral
Date: 2008-05-19 22:21:02 +0200 (Mon, 19 May 2008)
New Revision: 1153

Modified:
   trunk/data/api2init.lua
   trunk/src/WorldProxy.cc
   trunk/src/server.cc
   trunk/src/server.hh
   trunk/src/stones/OxydStone.cc
Log:
Trunk 1.1: new API
- new world attribute "MaxOxydColor" allows limitation of color usage,
  defaults to 7 (BLACK), allows compatible addition of new oxydcolors
- resolver autotile: range rule number chars starting with 1 for first char


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-05-18 13:22:55 UTC (rev 1152)
+++ trunk/data/api2init.lua	2008-05-19 20:21:02 UTC (rev 1153)
@@ -249,7 +249,7 @@
             if #key == #rule[1] and string.sub(key, 1, -2) == string.sub(rule[1], 1, -2)
                     and first <= candidate and candidate <= last then
                 if ti[key] == nil then
-                    res.autotile_newtile(key, ti[rule[3]], candidate - first)
+                    res.autotile_newtile(key, ti[rule[3]], candidate - first + 1)
                 end
                 return ti[key]
             end

Modified: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2008-05-18 13:22:55 UTC (rev 1152)
+++ trunk/src/WorldProxy.cc	2008-05-19 20:21:02 UTC (rev 1153)
@@ -19,8 +19,10 @@
 
 #include "WorldProxy.hh"
 #include "display.hh"
+#include "errors.hh"
 #include "server.hh"
 #include "world.hh"
+#include "stones/OxydStone.hh"
 
 namespace enigma {
  
@@ -77,6 +79,8 @@
             return server::MagnetForce;
         } else if (key == "MagnetRange") {
             return server::MagnetRange;
+        } else if (key == "MaxOxydColor") {
+            return server::MaxOxydColor;
         } else if (key == "SlopeForce") {
             return server::SlopeForce;
         } else if (key == "SwampSinkSpeed") {
@@ -123,6 +127,10 @@
         } else if (key == "MagnetRange") {
             server::MagnetRange = val;
             BroadcastMessage("_updateglobals", "it_magnet", GRID_ITEMS_BIT);
+        } else if (key == "MaxOxydColor") {
+            server::MaxOxydColor = val;
+            ASSERT(server::MaxOxydColor >= 0 && server::MaxOxydColor < OxydStone::COLORCOUNT, XLevelRuntime,
+                    "Attribute 'MaxOxydColor' value is out of range.");
         } else if (key == "SlopeForce") {
             server::SlopeForce = val;
         } else if (key == "SwampSinkSpeed") {

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2008-05-18 13:22:55 UTC (rev 1152)
+++ trunk/src/server.cc	2008-05-19 20:21:02 UTC (rev 1153)
@@ -100,6 +100,7 @@
 lev::levelStatusType   server::LevelStatus; // no Lua access
 double   server::MagnetForce;
 double   server::MagnetRange;
+int      server::MaxOxydColor;
 int32_t  server::RandomState;               // no Lua access
 double   server::SlopeForce;
 double   server::SwampSinkSpeed;
@@ -250,6 +251,7 @@
     server::SwampSinkSpeed    = 4;
     server::MagnetForce       = 30;
     server::MagnetRange       = 10;
+    server::MaxOxydColor      = 7;    // for compatibility
     server::WormholeForce     = 30;
     server::WormholeRange     = 10;
     server::HoleForce         = 1.0;

Modified: trunk/src/server.hh
===================================================================
--- trunk/src/server.hh	2008-05-18 13:22:55 UTC (rev 1152)
+++ trunk/src/server.hh	2008-05-19 20:21:02 UTC (rev 1153)
@@ -89,6 +89,8 @@
     // Really: probability that a floor tile will crack when an actor
     // enters or leaves it.
     extern double   Brittleness;
+    
+    extern int      MaxOxydColor;
 
     extern double   WaterSinkSpeed;
 

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-05-18 13:22:55 UTC (rev 1152)
+++ trunk/src/stones/OxydStone.cc	2008-05-19 20:21:02 UTC (rev 1153)
@@ -46,7 +46,7 @@
     unsigned int OxydStone::logBadFrameCount;
     
     unsigned short OxydStone::numColorsAvailable() {
-        return COLORCOUNT;  // may dependent on enigma compatibility in future!
+        return  server::MaxOxydColor + 1;
     }
     
     void OxydStone::addShuffleRule(RuleType type, unsigned short limit, Value group1, Value group2) {



From ral at mail.berlios.de  Tue May 20 00:54:07 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 20 May 2008 00:54:07 +0200
Subject: [Enigma-game-svn] r1154 - in trunk/src: . stones
Message-ID: <200805192254.m4JMs7qQ012845@sheep.berlios.de>

Author: ral
Date: 2008-05-20 00:54:05 +0200 (Tue, 20 May 2008)
New Revision: 1154

Modified:
   trunk/src/Object.cc
   trunk/src/Object.hh
   trunk/src/StateObject.cc
   trunk/src/StateObject.hh
   trunk/src/Value.cc
   trunk/src/Value.hh
   trunk/src/stones/FourSwitch.cc
   trunk/src/stones/FourSwitch.hh
   trunk/src/world.cc
Log:
Trunk 1.1: new API
- neareast object:
  - prefix "@" finalizes object on level init
  - prefix "@@" keeps nearest resolve dynamic


Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2008-05-19 20:21:02 UTC (rev 1153)
+++ trunk/src/Object.cc	2008-05-19 22:54:05 UTC (rev 1154)
@@ -147,6 +147,10 @@
     }
     
     Value Object::message(const Message &m) {
+        if (m.message == "_init") {
+            // finalize nearest target and destination
+            finalizeNearestObjectReferences();
+        }
         return Value();
     }
     
@@ -354,6 +358,27 @@
         return false;
     }
     
+    void Object::finalizeNearestObjectReferences(std::string attr) {
+        bool modified = false;
+        TokenList targets = getAttr(attr);
+        
+        for (TokenList::iterator tit = targets.begin(); tit != targets.end(); ++tit) {
+            modified |= (*tit).finalizeNearestObjectReference(this);
+        }
+        if (modified)
+            setAttr(attr, targets);
+    }
+    
+    void Object::finalizeNearestObjectReferences() {
+        finalizeNearestObjectReferences("target");
+        finalizeNearestObjectReferences("destination");
+        int min = getAttr("$minState");
+        int max = getAttr("$maxState");
+        for (int i = min; i <= max; i++) {
+            finalizeNearestObjectReferences(ecl::strf("target_%d", i));
+        }
+    }
+    
     void Object::warning(const char *format, ...) const {
         va_list arg_ptr;
     

Modified: trunk/src/Object.hh
===================================================================
--- trunk/src/Object.hh	2008-05-19 20:21:02 UTC (rev 1153)
+++ trunk/src/Object.hh	2008-05-19 22:54:05 UTC (rev 1154)
@@ -250,6 +250,9 @@
         int       id;
         AttribMap attribs;
         
+        void finalizeNearestObjectReferences(std::string attr);
+        void finalizeNearestObjectReferences();
+        
         static int getNextId(Object *obj, bool bootFinished);
         static void bootFinished();
         static void freeId(int id);

Modified: trunk/src/StateObject.cc
===================================================================
--- trunk/src/StateObject.cc	2008-05-19 20:21:02 UTC (rev 1153)
+++ trunk/src/StateObject.cc	2008-05-19 22:54:05 UTC (rev 1154)
@@ -52,6 +52,10 @@
     Value StateObject::getAttr(const string &key) const {
         if (key == "state")
             return externalState();
+        else if (key == "$maxState")
+            return maxState();
+        else if (key == "$minState")
+            return minState();
         return Object::getAttr(key);
     }
     
@@ -64,11 +68,11 @@
         Object::setAttr(key, val);
     }
     
-    int StateObject::maxState() {
+    int StateObject::maxState() const {
         return 1;  // default 2 state
     }
     
-    int StateObject::minState() {
+    int StateObject::minState() const {
         return 0;  // default 2 state
     }
     

Modified: trunk/src/StateObject.hh
===================================================================
--- trunk/src/StateObject.hh	2008-05-19 20:21:02 UTC (rev 1153)
+++ trunk/src/StateObject.hh	2008-05-19 22:54:05 UTC (rev 1154)
@@ -97,13 +97,13 @@
          * The maximum number of the external state. It defaults to 1, and 
          * should be overridden by the final subclass just on demand. 
          */
-        virtual int maxState();
+        virtual int maxState() const;
         
         /**
          * The minimum number of the external state. It defaults to 0, and
          * should be overridden by the final subclass just on demand.
          */
-        virtual int minState();
+        virtual int minState() const;
         
         /**
          * The method that is called on toggle messages to switch the object

Modified: trunk/src/Value.cc
===================================================================
--- trunk/src/Value.cc	2008-05-19 20:21:02 UTC (rev 1153)
+++ trunk/src/Value.cc	2008-05-19 22:54:05 UTC (rev 1154)
@@ -452,7 +452,30 @@
         return result;
     }
     
+    bool Value::finalizeNearestObjectReference(const Object *reference) {
+        if (type == STRING && std::string(val.str).find("@@") != 0 && std::string(val.str).find("@") == 0
+                && std::string(val.str).find_first_of("*?") != std::string::npos) {
+            //
+            ObjectList result = GetNamedGroup(val.str, reference);
+            clear();
+            if (!result.empty() && result.front() != NULL) {
+                Value v = result.front()->getAttr("name");
+                if (v && v.type == STRING && strcmp(v.val.str, "") != 0) {
+                    val.str = new char[strlen(v.val.str)+1];
+                    strcpy(val.str, v.val.str);
+                    type = NAMEDOBJECT;
+                    return true;
+                }
+            }
+            // otherwise it resolves to no object
+            type = NAMEDOBJECT;
+            val.dval[0] = 0;
+            return true;
+        }
+        return false;
+    }
     
+    
     int to_int(const Value &v) {
         return v;
     }

Modified: trunk/src/Value.hh
===================================================================
--- trunk/src/Value.hh	2008-05-19 20:21:02 UTC (rev 1153)
+++ trunk/src/Value.hh	2008-05-19 22:54:05 UTC (rev 1154)
@@ -238,6 +238,7 @@
          * 
          */
         ObjectList getObjectList(const Object *reference = NULL) const;
+        bool finalizeNearestObjectReference(const Object *reference = NULL);
     private:
         void clear();      ///< Release resources and assign type NIL
 

Modified: trunk/src/stones/FourSwitch.cc
===================================================================
--- trunk/src/stones/FourSwitch.cc	2008-05-19 20:21:02 UTC (rev 1153)
+++ trunk/src/stones/FourSwitch.cc	2008-05-19 22:54:05 UTC (rev 1154)
@@ -48,7 +48,7 @@
         return Stone::invertActionValue(val);
     }
     
-    int FourSwitch::maxState() {
+    int FourSwitch::maxState() const {
         return 3;  // dir representing state
     }
     

Modified: trunk/src/stones/FourSwitch.hh
===================================================================
--- trunk/src/stones/FourSwitch.hh	2008-05-19 20:21:02 UTC (rev 1153)
+++ trunk/src/stones/FourSwitch.hh	2008-05-19 22:54:05 UTC (rev 1154)
@@ -64,7 +64,7 @@
         virtual Value invertActionValue(const Value &val) const;
         
         // StateObject interface
-        virtual int maxState();
+        virtual int maxState() const;
         virtual void toggleState();
         virtual void setState(int extState);
 

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2008-05-19 20:21:02 UTC (rev 1153)
+++ trunk/src/world.cc	2008-05-19 22:54:05 UTC (rev 1154)
@@ -328,7 +328,9 @@
 Object * World::get_named(const std::string &name) {
     std::string wanted = name;
     if (wanted.size() > 0 && wanted[0] == '@')
-        wanted.erase(0, 1); // erase the leading @ 
+        wanted.erase(0, 1); // erase a leading @ 
+    if (wanted.size() > 0 && wanted[0] == '@')
+        wanted.erase(0, 1); // erase a leading @@ 
     ecl::Dict<Object*>::iterator found = m_objnames.find(wanted);
     if (found != m_objnames.end()) 
         return found->second;
@@ -344,6 +346,9 @@
     double mindist = -1;
     if (pattern.size() > 0 && pattern[0] == '@') {
         pattern.erase(0, 1); // erase the leading @
+        if (pattern.size() > 0 && pattern[0] == '@') {
+            pattern.erase(0, 1); // erase the leading @@
+        }
         if (reference != NULL)
             nearest = true;
     } 



From ral at mail.berlios.de  Tue May 20 01:01:22 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 20 May 2008 01:01:22 +0200
Subject: [Enigma-game-svn] r1155 - team_levelpacks/team_test_new_api
Message-ID: <200805192301.m4JN1MhG022965@sheep.berlios.de>

Author: ral
Date: 2008-05-20 01:01:17 +0200 (Tue, 20 May 2008)
New Revision: 1155

Modified:
   team_levelpacks/team_test_new_api/ralT043_1.xml
   team_levelpacks/team_test_new_api/ralT045_1.xml
Log:
Test Level new API:
- update test level for autotile resolver and nearest object

Modified: team_levelpacks/team_test_new_api/ralT043_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT043_1.xml	2008-05-19 22:54:05 UTC (rev 1154)
+++ team_levelpacks/team_test_new_api/ralT043_1.xml	2008-05-19 23:01:17 UTC (rev 1155)
@@ -24,10 +24,13 @@
 
 ti["f"] = {"it_floppy"}
 ti["F"] = {"st_floppy", target="@door#*", action="toggle"}
+ti["G"] = {"st_floppy", target="@@door#*", action="toggle"}
+ti["H"] = {"st_fourswitch", target_2="door#1", target_1="@@door#*", target_3="@door#*"}
 ti["B"] = {"st_blocker", "door#"}
 
 ti["c"] = {"it_coin_s", "coin#"}
 ti["V"] = {"it_vortex", destination="@coin#*"}
+ti["v"] = {"it_vortex", destination="@@coin#*"}
 
 
 ti["1"] = ti["f"] .. {"#ac-blackball"} 
@@ -39,10 +42,10 @@
 "BF #####            ",
 "   F   FB##BFB##B##F",
 "   B                ",
-"   #           r    ",
-"   #                ",
+"   #      H    r    ",
+"   # v              ",
 "   B      1         ",
-"   F   c            ",
+"   G   c            ",
 "   B                ",
 "   #            c   ",
 "   #        V       ",

Modified: team_levelpacks/team_test_new_api/ralT045_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT045_1.xml	2008-05-19 22:54:05 UTC (rev 1154)
+++ team_levelpacks/team_test_new_api/ralT045_1.xml	2008-05-19 23:01:17 UTC (rev 1155)
@@ -28,7 +28,7 @@
 
 ti["xx"] = ti["ff"] .. {"#ac-blackball"} 
 
-local resolver = res.autotile(ti, {"a0", "a5", "template_a"}, 
+local resolver = res.autotile(ti, {"a1", "a5", "template_a"}, 
 --local resolver = res.autotile(ti, {"a", "template_a"}, 
     {"A", "template_A"}, {"L", "template_L"})
 



From andreasl at mail.berlios.de  Tue May 20 01:43:27 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Tue, 20 May 2008 01:43:27 +0200
Subject: [Enigma-game-svn] r1156 - in trunk: data data/gfx32 data/gfx40
	data/gfx48 src/stones
Message-ID: <200805192343.m4JNhRRe008777@sheep.berlios.de>

Author: andreasl
Date: 2008-05-20 01:43:24 +0200 (Tue, 20 May 2008)
New Revision: 1156

Added:
   trunk/data/gfx32/st-oxyd-blink_0001.png
   trunk/data/gfx32/st-oxyd-blink_0002.png
   trunk/data/gfx32/st-oxyd-blink_0003.png
   trunk/data/gfx32/st-oxyd-blink_0004.png
   trunk/data/gfx32/st-oxyd-blink_0005.png
   trunk/data/gfx32/st-oxyd-color_0001.png
   trunk/data/gfx32/st-oxyd-color_0002.png
   trunk/data/gfx32/st-oxyd-color_0003.png
   trunk/data/gfx32/st-oxyd-color_0004.png
   trunk/data/gfx32/st-oxyd-color_0005.png
   trunk/data/gfx32/st-oxyd-color_0006.png
   trunk/data/gfx32/st-oxyd-color_0007.png
   trunk/data/gfx32/st-oxyd-color_0008.png
   trunk/data/gfx32/st-oxyd-color_0009.png
   trunk/data/gfx32/st-oxyd-color_0010.png
   trunk/data/gfx32/st-oxyd-color_0011.png
   trunk/data/gfx32/st-oxyd-color_0012.png
   trunk/data/gfx32/st-oxyd-color_0096.png
   trunk/data/gfx32/st-oxyd-color_0097.png
   trunk/data/gfx32/st-oxyd-pseudo-3_0001.png
   trunk/data/gfx32/st-oxyd-pseudo-3_0002.png
   trunk/data/gfx32/st-oxyd-pseudo-3_0003.png
   trunk/data/gfx32/st-oxyd-pseudo-3_0004.png
   trunk/data/gfx32/st-oxyd-pseudo-4_0001.png
   trunk/data/gfx32/st-oxyd-pseudo-4_0002.png
   trunk/data/gfx32/st-oxyd-pseudo-4_0003.png
   trunk/data/gfx32/st-oxyd-pseudo-4_0004.png
   trunk/data/gfx32/st-oxyd-pseudo-4_0005.png
   trunk/data/gfx32/st-oxyd-pseudo-4_0006.png
   trunk/data/gfx32/st-oxyd-pseudo-4_0007.png
   trunk/data/gfx32/st-oxyd-pseudo-4_0008.png
   trunk/data/gfx40/st-oxyd-blink_0001.png
   trunk/data/gfx40/st-oxyd-blink_0002.png
   trunk/data/gfx40/st-oxyd-blink_0003.png
   trunk/data/gfx40/st-oxyd-blink_0004.png
   trunk/data/gfx40/st-oxyd-blink_0005.png
   trunk/data/gfx40/st-oxyd-color_0001.png
   trunk/data/gfx40/st-oxyd-color_0002.png
   trunk/data/gfx40/st-oxyd-color_0003.png
   trunk/data/gfx40/st-oxyd-color_0004.png
   trunk/data/gfx40/st-oxyd-color_0005.png
   trunk/data/gfx40/st-oxyd-color_0006.png
   trunk/data/gfx40/st-oxyd-color_0007.png
   trunk/data/gfx40/st-oxyd-color_0008.png
   trunk/data/gfx40/st-oxyd-color_0009.png
   trunk/data/gfx40/st-oxyd-color_0010.png
   trunk/data/gfx40/st-oxyd-color_0011.png
   trunk/data/gfx40/st-oxyd-color_0012.png
   trunk/data/gfx40/st-oxyd-color_0096.png
   trunk/data/gfx40/st-oxyd-color_0097.png
   trunk/data/gfx40/st-oxyd-pseudo-3_0001.png
   trunk/data/gfx40/st-oxyd-pseudo-3_0002.png
   trunk/data/gfx40/st-oxyd-pseudo-3_0003.png
   trunk/data/gfx40/st-oxyd-pseudo-3_0004.png
   trunk/data/gfx40/st-oxyd-pseudo-4_0001.png
   trunk/data/gfx40/st-oxyd-pseudo-4_0002.png
   trunk/data/gfx40/st-oxyd-pseudo-4_0003.png
   trunk/data/gfx40/st-oxyd-pseudo-4_0004.png
   trunk/data/gfx40/st-oxyd-pseudo-4_0005.png
   trunk/data/gfx40/st-oxyd-pseudo-4_0006.png
   trunk/data/gfx40/st-oxyd-pseudo-4_0007.png
   trunk/data/gfx40/st-oxyd-pseudo-4_0008.png
   trunk/data/gfx48/st-oxyd-blink_0001.png
   trunk/data/gfx48/st-oxyd-blink_0002.png
   trunk/data/gfx48/st-oxyd-blink_0003.png
   trunk/data/gfx48/st-oxyd-blink_0004.png
   trunk/data/gfx48/st-oxyd-blink_0005.png
   trunk/data/gfx48/st-oxyd-color_0001.png
   trunk/data/gfx48/st-oxyd-color_0002.png
   trunk/data/gfx48/st-oxyd-color_0003.png
   trunk/data/gfx48/st-oxyd-color_0004.png
   trunk/data/gfx48/st-oxyd-color_0005.png
   trunk/data/gfx48/st-oxyd-color_0006.png
   trunk/data/gfx48/st-oxyd-color_0007.png
   trunk/data/gfx48/st-oxyd-color_0008.png
   trunk/data/gfx48/st-oxyd-color_0009.png
   trunk/data/gfx48/st-oxyd-color_0010.png
   trunk/data/gfx48/st-oxyd-color_0011.png
   trunk/data/gfx48/st-oxyd-color_0012.png
   trunk/data/gfx48/st-oxyd-color_0096.png
   trunk/data/gfx48/st-oxyd-color_0097.png
   trunk/data/gfx48/st-oxyd-pseudo-3_0001.png
   trunk/data/gfx48/st-oxyd-pseudo-3_0002.png
   trunk/data/gfx48/st-oxyd-pseudo-3_0003.png
   trunk/data/gfx48/st-oxyd-pseudo-3_0004.png
   trunk/data/gfx48/st-oxyd-pseudo-4_0001.png
   trunk/data/gfx48/st-oxyd-pseudo-4_0002.png
   trunk/data/gfx48/st-oxyd-pseudo-4_0003.png
   trunk/data/gfx48/st-oxyd-pseudo-4_0004.png
   trunk/data/gfx48/st-oxyd-pseudo-4_0005.png
   trunk/data/gfx48/st-oxyd-pseudo-4_0006.png
   trunk/data/gfx48/st-oxyd-pseudo-4_0007.png
   trunk/data/gfx48/st-oxyd-pseudo-4_0008.png
Removed:
   trunk/data/gfx32/st-oxydbtempl_0001.png
   trunk/data/gfx32/st-oxydbtempl_0002.png
   trunk/data/gfx32/st-oxydbtempl_0003.png
   trunk/data/gfx32/st-oxydbtempl_0004.png
   trunk/data/gfx32/st-oxydbtempl_0005.png
   trunk/data/gfx32/st-oxydbtempl_0006.png
   trunk/data/gfx32/st-oxydbtempl_0007.png
   trunk/data/gfx32/st-oxydbtempl_0008.png
   trunk/data/gfx32/st-oxydbtempl_0009.png
   trunk/data/gfx32/st-oxydbtempl_0010.png
   trunk/data/gfx32/st-oxydbtempl_0011.png
   trunk/data/gfx32/st-oxydbtempl_0012.png
   trunk/data/gfx32/st-oxydbtempl_0013.png
   trunk/data/gfx32/st-oxydbtempl_0014.png
   trunk/data/gfx32/st-oxydbtempl_0096.png
   trunk/data/gfx32/st-oxydbtempl_0097.png
   trunk/data/gfx32/st-oxydbtempl_0101.png
   trunk/data/gfx32/st-oxydbtempl_0102.png
   trunk/data/gfx32/st-oxydbtempl_0103.png
   trunk/data/gfx32/st-oxydbtempl_0104.png
   trunk/data/gfx32/st-oxydbtempl_0111.png
   trunk/data/gfx32/st-oxydbtempl_0112.png
   trunk/data/gfx32/st-oxydbtempl_0113.png
   trunk/data/gfx32/st-oxydbtempl_0114.png
   trunk/data/gfx32/st-oxydbtempl_0115.png
   trunk/data/gfx32/st-oxydbtempl_0116.png
   trunk/data/gfx32/st-oxydbtempl_0117.png
   trunk/data/gfx32/st-oxydbtempl_0118.png
   trunk/data/gfx40/st-oxydbtempl_0001.png
   trunk/data/gfx40/st-oxydbtempl_0002.png
   trunk/data/gfx40/st-oxydbtempl_0003.png
   trunk/data/gfx40/st-oxydbtempl_0004.png
   trunk/data/gfx40/st-oxydbtempl_0005.png
   trunk/data/gfx40/st-oxydbtempl_0006.png
   trunk/data/gfx40/st-oxydbtempl_0007.png
   trunk/data/gfx40/st-oxydbtempl_0008.png
   trunk/data/gfx40/st-oxydbtempl_0009.png
   trunk/data/gfx40/st-oxydbtempl_0010.png
   trunk/data/gfx40/st-oxydbtempl_0011.png
   trunk/data/gfx40/st-oxydbtempl_0012.png
   trunk/data/gfx40/st-oxydbtempl_0013.png
   trunk/data/gfx40/st-oxydbtempl_0014.png
   trunk/data/gfx40/st-oxydbtempl_0096.png
   trunk/data/gfx40/st-oxydbtempl_0097.png
   trunk/data/gfx40/st-oxydbtempl_0101.png
   trunk/data/gfx40/st-oxydbtempl_0102.png
   trunk/data/gfx40/st-oxydbtempl_0103.png
   trunk/data/gfx40/st-oxydbtempl_0104.png
   trunk/data/gfx40/st-oxydbtempl_0111.png
   trunk/data/gfx40/st-oxydbtempl_0112.png
   trunk/data/gfx40/st-oxydbtempl_0113.png
   trunk/data/gfx40/st-oxydbtempl_0114.png
   trunk/data/gfx40/st-oxydbtempl_0115.png
   trunk/data/gfx40/st-oxydbtempl_0116.png
   trunk/data/gfx40/st-oxydbtempl_0117.png
   trunk/data/gfx40/st-oxydbtempl_0118.png
   trunk/data/gfx48/st-oxydbtempl_0001.png
   trunk/data/gfx48/st-oxydbtempl_0002.png
   trunk/data/gfx48/st-oxydbtempl_0003.png
   trunk/data/gfx48/st-oxydbtempl_0004.png
   trunk/data/gfx48/st-oxydbtempl_0005.png
   trunk/data/gfx48/st-oxydbtempl_0006.png
   trunk/data/gfx48/st-oxydbtempl_0007.png
   trunk/data/gfx48/st-oxydbtempl_0008.png
   trunk/data/gfx48/st-oxydbtempl_0009.png
   trunk/data/gfx48/st-oxydbtempl_0010.png
   trunk/data/gfx48/st-oxydbtempl_0011.png
   trunk/data/gfx48/st-oxydbtempl_0012.png
   trunk/data/gfx48/st-oxydbtempl_0013.png
   trunk/data/gfx48/st-oxydbtempl_0014.png
   trunk/data/gfx48/st-oxydbtempl_0096.png
   trunk/data/gfx48/st-oxydbtempl_0097.png
   trunk/data/gfx48/st-oxydbtempl_0101.png
   trunk/data/gfx48/st-oxydbtempl_0102.png
   trunk/data/gfx48/st-oxydbtempl_0103.png
   trunk/data/gfx48/st-oxydbtempl_0104.png
   trunk/data/gfx48/st-oxydbtempl_0111.png
   trunk/data/gfx48/st-oxydbtempl_0112.png
   trunk/data/gfx48/st-oxydbtempl_0113.png
   trunk/data/gfx48/st-oxydbtempl_0114.png
   trunk/data/gfx48/st-oxydbtempl_0115.png
   trunk/data/gfx48/st-oxydbtempl_0116.png
   trunk/data/gfx48/st-oxydbtempl_0117.png
   trunk/data/gfx48/st-oxydbtempl_0118.png
Modified:
   trunk/data/api2init.lua
   trunk/data/models-2d.lua
   trunk/src/stones/OxydStone.hh
Log:
Trunk:
 - Add four oxyd colors: Grey, Orange, Pine and Brown.
 - Rename st-oxydbtempl* to more appropriate names.
   (no fusion of images yet).
 - Minor rename in window-shadow model code,
   corrected remarks.


Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-05-19 23:01:17 UTC (rev 1155)
+++ trunk/data/api2init.lua	2008-05-19 23:43:24 UTC (rev 1156)
@@ -86,6 +86,10 @@
 OXYD_PURPLE =  5
 OXYD_WHITE  =  6
 OXYD_BLACK  =  7
+OXYD_GREY   =  8
+OXYD_ORANGE =  9
+OXYD_PINE   = 10
+OXYD_BROWN  = 11
 OXYD_AUTO   = -1
 OXYD_FAKE   = -2
 OXYD_FART   = -3

Copied: trunk/data/gfx32/st-oxyd-blink_0001.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0010.png)

Copied: trunk/data/gfx32/st-oxyd-blink_0002.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0011.png)

Copied: trunk/data/gfx32/st-oxyd-blink_0003.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0012.png)

Copied: trunk/data/gfx32/st-oxyd-blink_0004.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0013.png)

Copied: trunk/data/gfx32/st-oxyd-blink_0005.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0014.png)

Copied: trunk/data/gfx32/st-oxyd-color_0001.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0002.png)

Copied: trunk/data/gfx32/st-oxyd-color_0002.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0003.png)

Copied: trunk/data/gfx32/st-oxyd-color_0003.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0004.png)

Copied: trunk/data/gfx32/st-oxyd-color_0004.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0005.png)

Copied: trunk/data/gfx32/st-oxyd-color_0005.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0006.png)

Copied: trunk/data/gfx32/st-oxyd-color_0006.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0007.png)

Copied: trunk/data/gfx32/st-oxyd-color_0007.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0008.png)

Copied: trunk/data/gfx32/st-oxyd-color_0008.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0009.png)

Added: trunk/data/gfx32/st-oxyd-color_0009.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-oxyd-color_0009.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx32/st-oxyd-color_0010.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-oxyd-color_0010.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx32/st-oxyd-color_0011.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-oxyd-color_0011.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx32/st-oxyd-color_0012.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx32/st-oxyd-color_0012.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Copied: trunk/data/gfx32/st-oxyd-color_0096.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0096.png)

Copied: trunk/data/gfx32/st-oxyd-color_0097.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0097.png)

Copied: trunk/data/gfx32/st-oxyd-pseudo-3_0001.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0101.png)

Copied: trunk/data/gfx32/st-oxyd-pseudo-3_0002.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0102.png)

Copied: trunk/data/gfx32/st-oxyd-pseudo-3_0003.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0103.png)

Copied: trunk/data/gfx32/st-oxyd-pseudo-3_0004.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0104.png)

Copied: trunk/data/gfx32/st-oxyd-pseudo-4_0001.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0111.png)

Copied: trunk/data/gfx32/st-oxyd-pseudo-4_0002.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0112.png)

Copied: trunk/data/gfx32/st-oxyd-pseudo-4_0003.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0113.png)

Copied: trunk/data/gfx32/st-oxyd-pseudo-4_0004.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0114.png)

Copied: trunk/data/gfx32/st-oxyd-pseudo-4_0005.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0115.png)

Copied: trunk/data/gfx32/st-oxyd-pseudo-4_0006.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0116.png)

Copied: trunk/data/gfx32/st-oxyd-pseudo-4_0007.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0117.png)

Copied: trunk/data/gfx32/st-oxyd-pseudo-4_0008.png (from rev 1152, trunk/data/gfx32/st-oxydbtempl_0118.png)

Deleted: trunk/data/gfx32/st-oxydbtempl_0001.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0002.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0003.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0004.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0005.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0006.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0007.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0008.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0009.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0010.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0011.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0012.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0013.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0014.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0096.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0097.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0101.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0102.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0103.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0104.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0111.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0112.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0113.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0114.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0115.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0116.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0117.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx32/st-oxydbtempl_0118.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx40/st-oxyd-blink_0001.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0010.png)

Copied: trunk/data/gfx40/st-oxyd-blink_0002.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0011.png)

Copied: trunk/data/gfx40/st-oxyd-blink_0003.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0012.png)

Copied: trunk/data/gfx40/st-oxyd-blink_0004.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0013.png)

Copied: trunk/data/gfx40/st-oxyd-blink_0005.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0014.png)

Copied: trunk/data/gfx40/st-oxyd-color_0001.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0002.png)

Copied: trunk/data/gfx40/st-oxyd-color_0002.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0003.png)

Copied: trunk/data/gfx40/st-oxyd-color_0003.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0004.png)

Copied: trunk/data/gfx40/st-oxyd-color_0004.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0005.png)

Copied: trunk/data/gfx40/st-oxyd-color_0005.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0006.png)

Copied: trunk/data/gfx40/st-oxyd-color_0006.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0007.png)

Copied: trunk/data/gfx40/st-oxyd-color_0007.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0008.png)

Copied: trunk/data/gfx40/st-oxyd-color_0008.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0009.png)

Added: trunk/data/gfx40/st-oxyd-color_0009.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-oxyd-color_0009.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx40/st-oxyd-color_0010.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-oxyd-color_0010.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx40/st-oxyd-color_0011.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-oxyd-color_0011.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx40/st-oxyd-color_0012.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx40/st-oxyd-color_0012.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Copied: trunk/data/gfx40/st-oxyd-color_0096.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0096.png)

Copied: trunk/data/gfx40/st-oxyd-color_0097.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0097.png)

Copied: trunk/data/gfx40/st-oxyd-pseudo-3_0001.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0101.png)

Copied: trunk/data/gfx40/st-oxyd-pseudo-3_0002.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0102.png)

Copied: trunk/data/gfx40/st-oxyd-pseudo-3_0003.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0103.png)

Copied: trunk/data/gfx40/st-oxyd-pseudo-3_0004.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0104.png)

Copied: trunk/data/gfx40/st-oxyd-pseudo-4_0001.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0111.png)

Copied: trunk/data/gfx40/st-oxyd-pseudo-4_0002.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0112.png)

Copied: trunk/data/gfx40/st-oxyd-pseudo-4_0003.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0113.png)

Copied: trunk/data/gfx40/st-oxyd-pseudo-4_0004.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0114.png)

Copied: trunk/data/gfx40/st-oxyd-pseudo-4_0005.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0115.png)

Copied: trunk/data/gfx40/st-oxyd-pseudo-4_0006.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0116.png)

Copied: trunk/data/gfx40/st-oxyd-pseudo-4_0007.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0117.png)

Copied: trunk/data/gfx40/st-oxyd-pseudo-4_0008.png (from rev 1152, trunk/data/gfx40/st-oxydbtempl_0118.png)

Deleted: trunk/data/gfx40/st-oxydbtempl_0001.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0002.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0003.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0004.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0005.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0006.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0007.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0008.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0009.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0010.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0011.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0012.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0013.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0014.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0096.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0097.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0101.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0102.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0103.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0104.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0111.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0112.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0113.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0114.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0115.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0116.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0117.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx40/st-oxydbtempl_0118.png
===================================================================
(Binary files differ)

Copied: trunk/data/gfx48/st-oxyd-blink_0001.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0010.png)

Copied: trunk/data/gfx48/st-oxyd-blink_0002.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0011.png)

Copied: trunk/data/gfx48/st-oxyd-blink_0003.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0012.png)

Copied: trunk/data/gfx48/st-oxyd-blink_0004.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0013.png)

Copied: trunk/data/gfx48/st-oxyd-blink_0005.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0014.png)

Copied: trunk/data/gfx48/st-oxyd-color_0001.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0002.png)

Copied: trunk/data/gfx48/st-oxyd-color_0002.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0003.png)

Copied: trunk/data/gfx48/st-oxyd-color_0003.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0004.png)

Copied: trunk/data/gfx48/st-oxyd-color_0004.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0005.png)

Copied: trunk/data/gfx48/st-oxyd-color_0005.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0006.png)

Copied: trunk/data/gfx48/st-oxyd-color_0006.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0007.png)

Copied: trunk/data/gfx48/st-oxyd-color_0007.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0008.png)

Copied: trunk/data/gfx48/st-oxyd-color_0008.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0009.png)

Added: trunk/data/gfx48/st-oxyd-color_0009.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-oxyd-color_0009.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx48/st-oxyd-color_0010.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-oxyd-color_0010.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx48/st-oxyd-color_0011.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-oxyd-color_0011.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx48/st-oxyd-color_0012.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx48/st-oxyd-color_0012.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Copied: trunk/data/gfx48/st-oxyd-color_0096.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0096.png)

Copied: trunk/data/gfx48/st-oxyd-color_0097.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0097.png)

Copied: trunk/data/gfx48/st-oxyd-pseudo-3_0001.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0101.png)

Copied: trunk/data/gfx48/st-oxyd-pseudo-3_0002.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0102.png)

Copied: trunk/data/gfx48/st-oxyd-pseudo-3_0003.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0103.png)

Copied: trunk/data/gfx48/st-oxyd-pseudo-3_0004.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0104.png)

Copied: trunk/data/gfx48/st-oxyd-pseudo-4_0001.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0111.png)

Copied: trunk/data/gfx48/st-oxyd-pseudo-4_0002.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0112.png)

Copied: trunk/data/gfx48/st-oxyd-pseudo-4_0003.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0113.png)

Copied: trunk/data/gfx48/st-oxyd-pseudo-4_0004.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0114.png)

Copied: trunk/data/gfx48/st-oxyd-pseudo-4_0005.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0115.png)

Copied: trunk/data/gfx48/st-oxyd-pseudo-4_0006.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0116.png)

Copied: trunk/data/gfx48/st-oxyd-pseudo-4_0007.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0117.png)

Copied: trunk/data/gfx48/st-oxyd-pseudo-4_0008.png (from rev 1152, trunk/data/gfx48/st-oxydbtempl_0118.png)

Deleted: trunk/data/gfx48/st-oxydbtempl_0001.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0002.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0003.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0004.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0005.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0006.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0007.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0008.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0009.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0010.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0011.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0012.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0013.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0014.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0096.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0097.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0101.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0102.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0103.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0104.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0111.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0112.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0113.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0114.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0115.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0116.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0117.png
===================================================================
(Binary files differ)

Deleted: trunk/data/gfx48/st-oxydbtempl_0118.png
===================================================================
(Binary files differ)

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-05-19 23:01:17 UTC (rev 1155)
+++ trunk/data/models-2d.lua	2008-05-19 23:43:24 UTC (rev 1156)
@@ -1195,7 +1195,7 @@
 do
     local fg_window = {blue = DefSubimages("st_window_blue", {modelname="fg-window_blue",w=4,h=4}),
                        green = DefSubimages("st_window_green", {modelname="fg-window_green",w=4,h=4}) }
-    local sh_windowx = DefSubimages("sh_window", {modelname="sh-windowx",w=2,h=4,imgw=ShadowSize,imgh=ShadowSize})
+    local sh_window = DefSubimages("sh_window", {w=2,h=4,imgw=ShadowSize,imgh=ShadowSize})
     local breaking_images = {blue = DefSubimages("st_window_blue_break", {h=4}),
                              green = DefSubimages("st_window_green_break", {h=4})}
 
@@ -1209,12 +1209,12 @@
     --    represented as "0, 1, 2" in a table).
     -- 2) Using the table of all possible combinations, all images
     --    and animations of the window stones are constructed.
-    -- Step 1 works as follows: We start with direction 1 (North),
-    -- and all three possibilities for shadows to the North. At this
-    -- point, the images for shadows to North only are build.
-    -- As next, for each of the three North-possibilities, we
-    -- construct the East-possibilities, i.e. we now have 3*3 combinations
-    -- and 3*3-1 shadow-images. We continue with South and West.
+    -- Step 1 works as follows: We start with direction 1 (West),
+    -- and all three possibilities for shadows to the West. At this
+    -- point, the images for shadows to West only are build.
+    -- As next, for each of the three West-possibilities, we
+    -- construct the South-possibilities, i.e. we now have 3*3 combinations
+    -- and 3*3-1 shadow-images. We continue with East and North.
     -- The table "all_combinations" is after each pass of the "direction"-loop:
     --  0) {{}}
     --  1) {{0}, {1}, {2}}
@@ -1225,7 +1225,7 @@
     -- scratched_faces (to be exactly, the numbers binarily represent
     -- the existence of the face).
     local all_combinations = {{normal_faces = 0, scratched_faces = 0}}
-    DefAlias("sh-windowx0-0", "invisible")
+    DefAlias("sh_window0-0", "invisible")
     local base = {0, 1, 2}
     for direction = 1, 4 do
         local next_list = {}
@@ -1253,9 +1253,9 @@
                     end
                     -- Now compose the shadow image.
                     display.DefineComposite(
-                            "sh-windowx"..name(new_combination, "-"),
-                            "sh-windowx"..name(old_combination, "-"),
-                            "sh-windowx"..(direction + ({0,4})[new_digit]))
+                            "sh_window"..name(new_combination, "-"),
+                            "sh_window"..name(old_combination, "-"),
+                            "sh_window"..(direction + ({0,4})[new_digit]))
                 end
             end
         end
@@ -1272,7 +1272,7 @@
             -- Normal stone (= not breaking)
             DefShModel("st_window_"..color..name2,
                        "fg-window_"..color..(total_faces + 1),
-                       "sh-windowx"..name1)
+                       "sh_window"..name1)
             -- Breaking animation
             local breaking_window_names = {}
             for j = 1, table.getn(breaking_images[color]) do
@@ -1286,7 +1286,7 @@
             DefAnim("st-window_"..color..name2.."_anim_fg", frames)
             DefShModel("st_window_"..color..name2.."_anim",
                        "st-window_"..color..name2.."_anim_fg",
-                       "sh-windowx"..name1);
+                       "sh_window"..name1);
         end
     end
 end
@@ -1308,18 +1308,17 @@
 -- them automatically.
 
 do
-    local colorspots = FrameNames("st-oxydbtempl", 2,9)
-    AddFrameNames(colorspots, "st-oxydbtempl", 96,97)
-    local openovls = FrameNames("st-oxydbtempl", 10,14)
+    local num_colors = 12
+    local colorspots = FrameNames("st-oxyd-color", 1, num_colors)
+    AddFrameNames(colorspots, "st-oxyd-color", 96, 97)
+    local blink_ovls = FrameNames("st-oxyd-blink", 1, 5)
     local pseudospots = {}
-    pseudospots[-3] = FrameNames("st-oxydbtempl", 101,104)
-    pseudospots[-4] = FrameNames("st-oxydbtempl", 111,118)
+    pseudospots[-3] = FrameNames("st-oxyd-pseudo-3", 1, 4)
+    pseudospots[-4] = FrameNames("st-oxyd-pseudo-4", 1, 8)
 
-
 -- Define "fading in" and "fading out" animations for oxyd stones.
 -- These two animations are combined with the stone images to
 -- produce the opening and closing animations for oxyd stones.
-
     local baseimg = {
         a="st-oxyda-open",
         b="st-oxydb-open",
@@ -1352,7 +1351,7 @@
         local spotcolor = color
         
         if (color >= 0) then
-            spotcolor = color + 1   -- oxyd color 0..7, file 2..9, frames 1..8
+            spotcolor = color + 1 -- oxyd color 0..num_colors-1, file 1.., frames 1..
         else
             spotcolor = 100 + color -- pseudo colors
         end
@@ -1377,8 +1376,8 @@
         local n = "st-oxyd" .. flavor .. color .. "-open"
         local names = {}
 
-        for i=1, table.getn(openovls) do
-            local images={baseimg[flavor],colorspots[color+1],openovls[i]}
+        for i=1, table.getn(blink_ovls) do
+            local images={baseimg[flavor],colorspots[color+1],blink_ovls[i]}
             names[i] = n .. format("_%04d", i)
             DefOverlay(names[i], images)
         end
@@ -1417,7 +1416,7 @@
         DefStone("st-oxyd"..flavor, shadow[flavor])
         DefShModel("st-likeoxyd"..flavor, "st-oxyd"..flavor, shadow[flavor])
 --        DefSolidStone("st-likeoxyd"..flavor, "st-oxyd"..flavor)
-        img=DefImage("st-oxyd"..flavor.."-open")
+        img = DefImage("st-oxyd"..flavor.."-open")
         DefShModel("st-likeoxyd"..flavor.."-open", img, shadow[flavor])
 
         local fadein = "oxyd"..flavor.."-fadein"
@@ -1425,7 +1424,7 @@
         DefAnim(fadein, fopening[flavor])
         DefAnim(fadeout, fclosing[flavor])
 
-        for color=0,7 do
+        for color = 0, num_colors - 1 do
             mkopenclose(flavor, color)
             mkblink(flavor, color)
             mkopened(flavor, color)
@@ -1437,8 +1436,8 @@
     end
     mkoxyd("a")
     mkoxyd("b")
-    mkoxyd("d")
     mkoxyd("c")
+    mkoxyd("d")
 end
 
 -- st-coffee --

Modified: trunk/src/stones/OxydStone.hh
===================================================================
--- trunk/src/stones/OxydStone.hh	2008-05-19 23:01:17 UTC (rev 1155)
+++ trunk/src/stones/OxydStone.hh	2008-05-19 23:43:24 UTC (rev 1156)
@@ -64,6 +64,7 @@
     public:
         enum RuleType {RULE_SINGLE_MIN, RULE_SINGLE_MAX, RULE_PAIR_MIN, RULE_PAIR_MAX};
         enum Color {BLUE = 0, RED, GREEN, YELLOW, CYAN, PURPLE, WHITE, BLACK, 
+            GREY, ORANGE, PINE, BROWN,
             COLORCOUNT,
             AUTO = -1,
             FAKE = -2,



From andreasl at mail.berlios.de  Tue May 20 01:51:30 2008
From: andreasl at mail.berlios.de (andreasl at BerliOS)
Date: Tue, 20 May 2008 01:51:30 +0200
Subject: [Enigma-game-svn] r1157 - team_levelpacks/team_test_new_api
Message-ID: <200805192351.m4JNpUQD010004@sheep.berlios.de>

Author: andreasl
Date: 2008-05-20 01:51:30 +0200 (Tue, 20 May 2008)
New Revision: 1157

Modified:
   team_levelpacks/team_test_new_api/ralT028_1.xml
Log:
Test Level new API:
 - add all current combinations of colors
   and flavors to "Test Oxyd new API".


Modified: team_levelpacks/team_test_new_api/ralT028_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT028_1.xml	2008-05-19 23:43:24 UTC (rev 1156)
+++ team_levelpacks/team_test_new_api/ralT028_1.xml	2008-05-19 23:51:30 UTC (rev 1157)
@@ -59,11 +59,29 @@
 "  os   ps           ",
 "    f    p          ",
 "  F      C Bs       ",
-"    Y  X      wL b  "
+"    Y  X      wL b  ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    ",
+"                    "
 })
 
 wo:shuffleOxyd({no["p#*"],min=1})
 
+for col = 0, 11 do
+  for j, fla in pairs({"a", "b", "c", "d"}) do
+    wo[{col + 2, 2*j + 14}] = {"st_oxyd", oxydcolor = col, flavor = fla}
+  end
+end
+
 function statetest(value)
     local newstate = 0
     if value then newstate = 1 end



From ral at mail.berlios.de  Thu May 22 22:08:47 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 22 May 2008 22:08:47 +0200
Subject: [Enigma-game-svn] r1158 - in trunk: data/levels/enigma_vii
	doc/reference
Message-ID: <200805222008.m4MK8lk3017672@sheep.berlios.de>

Author: ral
Date: 2008-05-22 22:08:45 +0200 (Thu, 22 May 2008)
New Revision: 1158

Modified:
   trunk/data/levels/enigma_vii/index.xml
   trunk/doc/reference/enigma-ref.texi
Log:
Log:
Trunk 1.1: new API
- refman docu update for nearest object (Object Naming)
- refman some typo fixes
- levelpack VII index fix for level "Bold Boulder"

Modified: trunk/data/levels/enigma_vii/index.xml
===================================================================
--- trunk/data/levels/enigma_vii/index.xml	2008-05-19 23:51:30 UTC (rev 1157)
+++ trunk/data/levels/enigma_vii/index.xml	2008-05-22 20:08:45 UTC (rev 1158)
@@ -93,7 +93,7 @@
     <level _seq="85" _title="Triggered Triggers" _xpath="./just19_1" author="JuSt" ctrl="force" easy="true" id="just19" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="86" _title="Lady in Red" _xpath="./just30_1" author="Just" ctrl="force" easy="true" id="just30" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="87" _title="Crawling the Abyss" _xpath="./sph02_1" author="ShadowPhrogg32642342" ctrl="force" easy="true" id="sph02" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="88" _title="Bold Boulder" _xpath="./ral14_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20061124ral279" rel="1" rev="95" score="1" target="time" unit="duration"/>
+    <level _seq="88" _title="Bold Boulder" _xpath="./ral14_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20061124ral279" rel="1" rev="96" score="1" target="time" unit="duration"/>
     <level _seq="89" _title="Tinker, Tailor" _xpath="./andreas46_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas46" rel="4" rev="2" score="2" target="time" unit="duration"/>
     <level _seq="90" _title="Elbow Society" _xpath="./andreas45_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas45" rel="2" rev="5" score="2" target="time" unit="duration"/>
     <level _seq="91" _title="Watchmaker" _xpath="./huesing01_1" author="Johannes H?sing" ctrl="force" easy="false" id="huesing01" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-05-19 23:51:30 UTC (rev 1157)
+++ trunk/doc/reference/enigma-ref.texi	2008-05-22 20:08:45 UTC (rev 1158)
@@ -1954,7 +1954,7 @@
 
 @b{Contents - Elements:}
 
-The comments element itself contains only subelements as content.
+The compatibility element itself contains only subelements as content.
 
 @table @asis
 @item @b{dependency}, @i{optional, mutiple occurence}
@@ -2344,7 +2344,7 @@
 the English string as we will see later.
 
 If the author is not native English-speaking, he should add his own @samp{translation}
-subelement to the @samp{sting} element. The @samp{translation} element has a
+subelement to the @samp{string} element. The @samp{translation} element has a
 single mandatory attribute @samp{lang} that takes the 2-character language
 abbreviation. The contents of the element is the translation itself.
 
@@ -2886,12 +2886,12 @@
 @samp{#} as the last character to a name, e.g. @samp{mydoor#}. This causes Enigma
 to add a unique random number to the given string. Thus an auto named object
 will never unname another prior auto named object. But if you delete an 
-auto named object that has been named e.g. @samp{mydoor#132} the number and
+auto named object that has been named e.g. @samp{mydoor#103284} the number and
 the same name may be assigned to another that is created lateron.
 
 All named objects are registered by the @dfn{named object} repository. The API
 provides a variable @samp{no} that allows you to retrieve any named object, e.g.
- at samp{no["mydoor#1"]}. You get an @ref{Object Reference} or @samp{nil} if no
+ at samp{no["mylaser_a"]}. You get an @ref{Object Reference} or @samp{nil}, if no
 object is registered by the given name.
 
 As you can auto name groups of objects you are allowed to use the wildcard
@@ -2925,12 +2925,12 @@
 In the rare case of objects located on the same position stones will preceed
 items, floors and actors. The chosen target or destination depends just on the
 location of these objects and their type, but nothing else. Thus you can rely
-on a stable selection mechanism.
+on a stable selection mechanism. @ref{Nearest Object Clustering} may help you in
+case of unexpected selected equidistant targets. 
 
-By usage of this nearest object feature you can drastically reduce the number
-of needed tile declarations. @ref{Nearest Object Clustering} may help you in
-case of wrong selected equidistant targets. @ref{Auto Tiling} is another 
-feature for reducing the need of tile declarations.
+Auto naming and nearest object features help you to reduce the number
+of needed tile declarations. Resolvers like @ref{res.autotile} and
+ at ref{res.composer} are other feature for reducing the need of tile declarations.
 
 Another unique feature of object names is their late on access evaluation. This
 allows you to reference an object prior to its existence. E.g. if you want to
@@ -2955,8 +2955,33 @@
 @ref{st_blocker} and it it shrinks to an @ref{it_blocker} you will retrieve this
 item if you ask the name object repository for the named object.
 
+When an object like a door is completly killed, e.g. by an @ref{it_seed},
+it can no longer be targeted by active objects like switches. A still existing
+reference to a no longer existing object does not cause problems on 
+ at ref{Messages}. But what about the nearest object references? To avoid problems
+due to killed objects the standard nearest object reference with just one 
+ at samp{@@} as prefix are finalized on @ref{Level Initialization}. This means that
+they get substituted by the unique name of the nearest object that exists after
+the creation of all objects and before the user takes action and can kill a
+candidate.
+
+But sometimes you may like a dynamic nearest object target or destination. One
+that is evaluated when it gets accessed. By prefixing a name with @samp{@@@@}
+the reference will not get finalized on initialization but remains dynamic.
+
+ at example
+ti["c"] = @{it_coin_s", "magic#"@}
+ti["v"] = @{it_vortex", destination="@@@@magic#*@}
+ at end example
+
+Setting three magic coins and one vortex in your map will teleport the marble
+to the grid of that coin that is nearest to the vortex at the moment of 
+teleportation.
+
 To avoid unexpected problems with invalid object references a few critical
 objects are internally autonamed if the level author does not provide a name.
+But these unique names should never interfere with the user assigned object
+names.
 
 @node Object Attributes
 @subsection Object Attributes
@@ -3748,6 +3773,7 @@
 * IsDifficult:: 
 * MagnetRange:: 
 * MagnetStrength::
+* MaxOxydColor::
 * Width::
 * WormholeRange:: 
 * WormholeStrength:: 
@@ -3814,10 +3840,10 @@
 @item @b{Support:} @ @ @ref{it_magnet}
 @end table
 
- at node Width
- at subsection Width
+ at node Height
+ at subsection Height
 
-A global read only variable reports the width of the the world in grid units.
+A global read only variable reports the height of the the world in grid units.
 This is set by the initial world constructor call 
 (@pxref{World Creation and Resolver Chaining}).
 
@@ -3829,6 +3855,20 @@
 @item @b{Support:} @ @ object independent
 @end table
 
+ at node MaxOxydColor
+ at subsection MaxOxydColor
+
+A global variable that limits the number of colors assigned to autocolored
+ at ref{st_oxyd}. Be careful with increasing this value beyond its default.
+
+ at table @asis
+ at item @b{Type:} @ @ number
+ at item @b{Values:} @ @ @code{OXYD_BLUE}, ... @code{OXYD_BROWN}
+ at item @b{Default:} @ @ @code{OXYD_BLACK}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{st_oxyd}
+ at end table
+
 @node WormholeRange
 @subsection WormholeRange
 
@@ -5370,7 +5410,7 @@
 sequence, otherwise the first one closes again.
 
 Even though most levels make use of just a single pair of each color, there
-is no limit on a single color. If you like you can define 3 blue pairs of oxyds
+is no limit on a single color. If you like you can define 3 pairs of blue oxyds
 together with 2 yellow pairs. You do this by setting explicit @samp{oxydcolor}
 attributes to the oxyds.
 
@@ -5378,16 +5418,21 @@
 This causes an automatic coloring by pairs of colors in the standard color
 sequence.
 
-There is no limit on the number of used oxyd pairs. But as just 8 colors do exist
-the colors will repeat from the 9th pair giving the user the possibility to
-build arbitrary couples within a single color. Uneven number of regular colored
-oxyds are not allowed.
+There is no limit on the number of used oxyd pairs. There exists 12 different
+regular colors for oxyds. But per default just the first 8 colors will be
+assigned to @samp{OXYD_AUTO} colored oxyds. The colors will repeat from the
+9th pair giving the user the possibility to build arbitrary couples within a
+single color. With the world attribute @ref{MaxOxydColor} you can lower or
+increase this limit. By setting this attribute to @samp{OXYD_GREEN} you can
+enforce the engine to assign just the first three colors. Be careful in usage
+of more than 8 colors as levels can get incredible difficult. Uneven number of
+regular colored oxyds are not allowed.
 
 Usually oxyds are shuffled by a @samp{wo:shuffleOxyd()} statement after setting
 of all oxyds. All @samp{CLOSED} oxyds that are not explicitly excluded by the
 @samp{noshuffle} attribute take place in shuffling. But you can define
 arbitrary rules to limit and influence the shuffling process to guarantee
-solvabitlity and fairness (@pxref{Oxyd Shuffling Rules}).
+solvabitlity and fairness (@pxref{shuffleOxyd}).
 
 Oxyds are opened either by an actor hit, an additional laser beam, an
 @ref{st_boulder} triggering or a message call. A single opened oxyd is in the
@@ -5395,7 +5440,7 @@
 @samp{OXYDPAIR}. Note that this state can be requested, but it can not be set
 directly.
 
-Single opened oxyds close on not matching partner oxyds being opened and on 
+Single opened oxyds close on a not matching partner oxyd being opened and on 
 @samp{close} messages and state setting operations. But oxyds being part of
 an opened pair will not be closed this way.
 
@@ -5409,8 +5454,8 @@
 part in the oxyd shuffling you can use an oxyd of color @samp{OXYD_FAKE}.
 
 During the game oxyds can be reshuffled. Just those oxyds that are still closed
-will take part in the new shuffle process. @ref{Oxyd Shuffling Rules} will be
-still guranteed for these partial in game reshuffles. It can be initiated either
+will take part in the new shuffle process. Oxyd shuffling rules will still be
+guranteed for these partial in game reshuffles. It can be initiated either
 by a @samp{shuffle} message that is send to any of the oxyd objects, or by
 usage of an oxyd of color @samp{OXYD_BOLD}. If such a special oxyd is opened,
 e.g. by an actor hit, it shuffles all remaining oxyds including itself.
@@ -5437,7 +5482,7 @@
 @item @code{"c"} blue, flat stone that opens by a concentric animation
 @item @code{"d"} dark blue, pyramid like stone that opens like a flower
 @end table
- at item @b{oxydcolor}, @ @ @i{values}: @code{OXYD_AUTO}, @code{OXYD_FAKE}, @code{OXYD_FART}, @code{OXYD_BOLD}, @code{OXYD_BLUE}, @code{OXYD_RED}, @code{OXYD_GREEN}, @code{OXYD_YELLOW}, @code{OXYD_CYAN}, @code{OXYD_PURPLE}, @code{OXYD_WHITE}, @code{OXYD_BLACK}, ; @ @ @i{default}: @code{OXYD_AUTO}
+ at item @b{oxydcolor}, @ @ @i{values}: @code{OXYD_AUTO}, @code{OXYD_FAKE}, @code{OXYD_FART}, @code{OXYD_BOLD}, @code{OXYD_BLUE}, @code{OXYD_RED}, @code{OXYD_GREEN}, @code{OXYD_YELLOW}, @code{OXYD_CYAN}, @code{OXYD_PURPLE}, @code{OXYD_WHITE}, @code{OXYD_BLACK}, @code{OXYD_GREY}, @code{OXYD_ORANGE}, @code{OXYD_PINE}, @code{OXYD_BROWN}; @ @ @i{default}: @code{OXYD_AUTO}
 @item @b{noshuffle} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 @item @b{static} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 Static oxyds are neither swappable nor pullable.
@@ -5779,18 +5824,21 @@
 @section World Advanced Methods
 
 @menu 
-* wo:shuffleOxyd::  Oxyd Shuffling Rules
-* wo:drawMap::      
+* shuffleOxyd::  Oxyd Shuffling Rules
+* drawMap::      
 @end menu
 
 @c ----------------- shuffleOxyd -------------------- 
- at node wo:shuffleOxyd
- at subsection wo:shuffleOxyd
+ at node shuffleOxyd
+ at subsection shuffleOxyd
 
 Read API Concept Draft
 
 Work in progress!
 
+
+ at ref{st_oxyd}
+
 @table @asis
 @item @b{Syntax:}
 
@@ -5839,8 +5887,8 @@
 @end table
 
 @c ----------------- drawMap -------------------- 
- at node wo:drawMap
- at subsection wo:drawMap
+ at node drawMap
+ at subsection drawMap
 
 
 @node Resolvers
@@ -5927,7 +5975,7 @@
 the given first and last keys may just differ in the last character. Again a
 copy of the template rule will be generated and the @samp{%%} patterns will be
 substituted. But in this case the substitution is composed of a single percent
-sign followed by an interger number that counts the key position within the
+sign followed by an integer number that counts the key position within the
 given range. Thus a key of @samp{c} will target the door @samp{door%3}. 
 You need to use the key @samp{C} in the map for the matching door.
 



From raoul at mail.berlios.de  Sat May 17 11:55:46 2008
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sat, 17 May 2008 11:55:46 +0200
Subject: [Enigma-game-svn] r1149 - in trunk: . data/levels
	data/levels/enigma_cross data/levels/enigma_tutorial
	data/levels/enigma_vi data/levels/enigma_vii data/levels/enigma_viii
Message-ID: <200805170955.m4H9tkwL004698@sheep.berlios.de>

Author: raoul
Date: 2008-05-17 11:55:43 +0200 (Sat, 17 May 2008)
New Revision: 1149

Added:
   trunk/data/levels/enigma_tutorial/a_tut07.xml
   trunk/data/levels/enigma_vi/ral17_2.xml
   trunk/data/levels/enigma_vii/andreas45_2.xml
   trunk/data/levels/enigma_vii/andreas46_3.xml
   trunk/data/levels/enigma_vii/huesing01_1.xml
   trunk/data/levels/enigma_vii/joe12_2.xml
   trunk/data/levels/enigma_vii/joe26_1.xml
   trunk/data/levels/enigma_vii/joe27_1.xml
   trunk/data/levels/enigma_vii/joe28_1.xml
   trunk/data/levels/enigma_vii/just37_1.xml
   trunk/data/levels/enigma_vii/manuel01_1.xml
   trunk/data/levels/enigma_vii/mecke09_1.xml
   trunk/data/levels/enigma_vii/mecke11_1.xml
   trunk/data/levels/enigma_vii/pulley10_2.xml
   trunk/data/levels/enigma_vii/ral14_1.xml
   trunk/data/levels/enigma_viii/
   trunk/data/levels/enigma_viii/.gitignore
   trunk/data/levels/enigma_viii/Makefile.am
   trunk/data/levels/enigma_viii/index.xml
   trunk/data/levels/enigma_viii/mecke12_1.xml
   trunk/data/levels/enigma_viii/mecke15_1.xml
   trunk/data/levels/enigma_viii/mecke20_1.xml
Removed:
   trunk/data/levels/enigma_vi/ral17_1.xml
Modified:
   trunk/configure.ac
   trunk/data/levels/Makefile.am
   trunk/data/levels/enigma_cross/newlevels_1.0.1.xml
   trunk/data/levels/enigma_cross/newlevels_1.0.2.xml
   trunk/data/levels/enigma_tutorial/index.xml
   trunk/data/levels/enigma_vi/index.xml
   trunk/data/levels/enigma_vii/index.xml
   trunk/data/levels/enigma_vii/just23_1.xml
Log:
-> Added 16 new levels
=> Currently 79 new levels for Enigma 1.1



Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/configure.ac	2008-05-17 09:55:43 UTC (rev 1149)
@@ -368,6 +368,7 @@
            data/levels/enigma_v/Makefile
            data/levels/enigma_vi/Makefile
            data/levels/enigma_vii/Makefile
+           data/levels/enigma_viii/Makefile
            data/levels/enigma_cross/Makefile
            data/levels/enigma_esprit/Makefile
            data/levels/enigma_oxyd/Makefile

Modified: trunk/data/levels/Makefile.am
===================================================================
--- trunk/data/levels/Makefile.am	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/Makefile.am	2008-05-17 09:55:43 UTC (rev 1149)
@@ -1,5 +1,5 @@
 SUBDIRS = enigma_tutorial enigma_i enigma_ii enigma_iii enigma_iv enigma_v \
-	enigma_vi enigma_vii \
+	enigma_vi enigma_vii enigma_viii \
 	enigma_esprit enigma_oxyd enigma_peroxyd enigma_oxydmagnum \
 	enigma_oxydextra \
 	enigma_sokoban enigma_microban enigma_mas_microban \

Modified: trunk/data/levels/enigma_cross/newlevels_1.0.1.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.0.1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_cross/newlevels_1.0.1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Facets" location="15500" network="false" owner="Enigma Team" release="1" revision="10" title="Enigma 1.01 new"/>
+  <info enigma="1.00" group="Facets" location="15500" network="false" owner="Enigma Team" release="1" revision="11" title="Enigma 1.01 new"/>
 
   <attributes/>
 
@@ -9,35 +9,35 @@
     <level _seq="1" _title="Walk the line" _xpath="enigma_vi/erich02_1" author="Erich Schubert" ctrl="force" easy="true" id="erich02" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="2" _title="Chess and Boxes" _xpath="enigma_vi/johannes01_1" author="Johannes Laire" ctrl="force" easy="false" id="20061201johannes313" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="3" _title="Knight's Journey" _xpath="enigma_vi/johannes02_1" author="Johannes Laire" ctrl="force" easy="false" id="20061210johannes313" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="4" _title="Blitz Chess" _xpath="enigma_vi/luc32_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc322006" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="5" _title="River of Challenges" _xpath="enigma_vi/luc33_1" author="Lukas Sch?ller" ctrl="force" easy="true" id="luc332006" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="4" _title="Blitz Chess" _xpath="enigma_vi/luc32_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc322006" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="5" _title="River of Challenges" _xpath="enigma_vi/luc33_1" author="Lukas Sch?ller" ctrl="force" easy="true" id="luc332006" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="6" _title="Red Herrings" _xpath="enigma_vi/andy01_3" author="Andy Geldmacher" ctrl="force" easy="false" id="20070116money001" rel="3" rev="1" score="3" target="time" unit="duration"/>
-    <level _seq="7" _title="Playing with Lasers" _xpath="enigma_vi/just09_1" author="JuSt" ctrl="force" easy="false" id="just09_1" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="7" _title="Playing with Lasers" _xpath="enigma_vi/just09_1" author="JuSt" ctrl="force" easy="false" id="just09_1" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="8" _title="Hot Hurdle Race" _xpath="enigma_vi/ulf04_1" author="Ulf Stegemann" ctrl="force" easy="true" id="20070124ulf019" rel="1" rev="93" score="1" target="time" unit="duration"/>
     <level _seq="9" _title="Counterclockwise" _xpath="enigma_vi/ulf05_1" author="Ulf Stegemann" ctrl="force" easy="true" id="20070126ulf020" rel="1" rev="93" score="1" target="time" unit="duration"/>
-    <level _seq="10" _title="Check the light" _xpath="enigma_vi/just10_2" author="JuSt" ctrl="force" easy="false" id="just10" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="10" _title="Check the light" _xpath="enigma_vi/just10_2" author="JuSt" ctrl="force" easy="false" id="just10" rel="2" rev="6" score="2" target="time" unit="duration"/>
     <level _seq="11" _title="Twokoban I" _xpath="enigma_vi/raoul28_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul28" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="12" _title="The Passage" _xpath="enigma_vi/just11_1" author="JuSt" ctrl="force" easy="false" id="just11" rel="1" rev="6" score="1" target="time" unit="duration"/>
+    <level _seq="12" _title="The Passage" _xpath="enigma_vi/just11_1" author="JuSt" ctrl="force" easy="false" id="just11" rel="1" rev="7" score="1" target="time" unit="duration"/>
     <level _seq="13" _title="Magic Triangle" _xpath="enigma_vi/just13_1" author="JuSt" ctrl="force" easy="false" id="just13" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="14" _title="Revolver" _xpath="enigma_vi/ral16_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070214ral703" rel="1" rev="59" score="1" target="time" unit="duration"/>
     <level _seq="15" _title="Devil's Bolder" _xpath="enigma_vi/just14_1" author="JuSt" ctrl="force" easy="true" id="just14" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="16" _title="Turnstiles for Two" _xpath="enigma_vi/ral17_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070314ral189" rel="1" rev="64" score="1" target="time" unit="duration"/>
+    <level _seq="16" _title="Turnstiles for Two" _xpath="enigma_vi/ral17_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070314ral189" rel="2" rev="94" score="2" target="time" unit="duration"/>
     <level _seq="17" _title="The wrong Place?" _xpath="enigma_vi/just17_1" author="JuSt" ctrl="force" easy="false" id="just17" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="18" _title="Your Friend, the Light" _xpath="enigma_vi/just15_1" author="JuSt" ctrl="force" easy="true" id="just15" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="19" _title="jumping ball flash" _xpath="enigma_vi/illmind13_1" author="illmind" ctrl="force" easy="false" id="2007ill001" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="20" _title="Cold Meditation" _xpath="enigma_vii/ral18_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070314ral728" rel="1" rev="67" score="1" target="time" unit="duration"/>
     <level _seq="21" _title="Same task ..." _xpath="enigma_vi/raoul29_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul29" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="22" _title="Industrial Puzzles" _xpath="enigma_vi/raoul30_2" author="Raoul Bourquin" ctrl="force" easy="false" id="raoul30" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="22" _title="Industrial Puzzles" _xpath="enigma_vi/raoul30_2" author="Raoul Bourquin" ctrl="force" easy="false" id="raoul30" rel="2" rev="6" score="2" target="time" unit="duration"/>
     <level _seq="23" _title="Odyssey" _xpath="enigma_vi/ant39_1" author="Petr Machata" ctrl="force" easy="false" id="ant39" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="24" _title="Tandem Chess" _xpath="enigma_vi/luc34_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc342007" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="25" _title="Magic Trinity" _xpath="enigma_vi/duffy146_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy146" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="26" _title="Rotor Guards" _xpath="enigma_vi/duffy144_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy144" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="27" _title="Group Trip to Meditation" _xpath="enigma_vi/duffy136_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy136" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="27" _title="Group Trip to Meditation" _xpath="enigma_vi/duffy136_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy136" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="28" _title="Oxyd Drilling" _xpath="enigma_vi/duffy140_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy140" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="29" _title="Pleasure Garden" _xpath="enigma_vi/duffy134_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy134" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="30" _title="Idempotency" _xpath="enigma_vi/duffy145_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy145" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="31" _title="Pontoon Bridges" _xpath="enigma_vi/duffy137_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy137" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="32" _title="Parish Fair" _xpath="enigma_vi/duffy143_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy143" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="32" _title="Parish Fair" _xpath="enigma_vi/duffy143_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy143" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="33" _title="In the Middle" _xpath="enigma_vi/duffy141_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy141" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="34" _title="Construction Workers" _xpath="enigma_vi/duffy142_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy142" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="35" _title="One-Way Woods" _xpath="enigma_vi/duffy135_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy135" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -46,7 +46,7 @@
     <level _seq="38" _title="DownDown" _xpath="enigma_vii/joona01_1" author="Joona Laire" ctrl="force" easy="true" id="20070406joona005" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="39" _title="City Life" _xpath="enigma_vi/joona03_1" author="Joona Laire" ctrl="force" easy="true" id="20061119joona503" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="40" _title="Diving" _xpath="enigma_vii/joona13_1" author="Joona Laire" ctrl="force" easy="true" id="20061203joona500" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="41" _title="Speed Meditation" _xpath="enigma_vii/duffy148_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy148" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="41" _title="Speed Meditation" _xpath="enigma_vii/duffy148_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy148" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="42" _title="Upstairs Meditation" _xpath="enigma_vii/duffy138_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy138" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="43" _title="Correspondence Chess" _xpath="enigma_vi/luc35_3" author="Lukas Sch?ller" ctrl="force" easy="true" id="luc352007" rel="3" rev="4" score="3" target="time" unit="duration"/>
     <level _seq="44" _title="Exclusive Pole Positions" _xpath="enigma_vii/duffy149_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy149" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -60,7 +60,7 @@
     <level _seq="52" _title="Advancing" _xpath="enigma_vii/joe01_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="53" _title="Free Riders" _xpath="enigma_vii/duffy155_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy155" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="54" _title="Meditation in Peace" _xpath="enigma_vii/ral20_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070502ral466" rel="1" rev="70" score="1" target="time" unit="duration"/>
-    <level _seq="55" _title="Laser Squad" _xpath="enigma_vii/duffy153_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy153" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="55" _title="Laser Squad" _xpath="enigma_vii/duffy153_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy153" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="56" _title="Protected Exhibition" _xpath="enigma_vii/duffy156_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy156" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="57" _title="Oneway for White" _xpath="enigma_vii/duffy157_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy157" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="58" _title="Widgets in the Attic" _xpath="enigma_vii/duffy158_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy158" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels_1.0.2.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.0.2.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_cross/newlevels_1.0.2.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="7" title="Enigma 1.02 new"/>
+  <info enigma="1.00" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="8" title="Enigma 1.1 new"/>
 
   <attributes/>
 
@@ -21,7 +21,7 @@
     <level _seq="13" _title="Horseshoes" _xpath="enigma_vii/duffy163_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy163" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="14" _title="Knot Garden" _xpath="enigma_vii/duffy165_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy165" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="15" _title="Impulse-phobia" _xpath="enigma_vii/duffy166_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy166" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="16" _title="Slopes, Jumps &amp; Falls" _xpath="enigma_vii/duffy167_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy167" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="16" _title="Slopes, Jumps &amp; Falls" _xpath="enigma_vii/duffy167_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy167" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="17" _title="Arctic Jumping" _xpath="enigma_vii/duffy168_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy168" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="18" _title="Breakthrough" _xpath="enigma_vii/duffy170_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy170" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="19" _title="Seasonal Patterns" _xpath="enigma_vii/duffy164_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy164" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -37,9 +37,9 @@
     <level _seq="29" _title="Re-entry Circuit" _xpath="enigma_vii/pulley05_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley05" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="30" _title="Not Fast Enough" _xpath="enigma_vii/jet04_3" author="James Taylor, Ronald Lamprecht" ctrl="force" easy="true" id="20070413jet001" rel="3" rev="3" score="3" target="time" unit="duration"/>
     <level _seq="31" _title="Give Way" _xpath="enigma_vii/just20_1" author="JuSt" ctrl="force" easy="false" id="just20" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="32" _title="Give more Way" _xpath="enigma_vii/just21_2" author="JuSt" ctrl="force" easy="true" id="just21" rel="2" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="32" _title="Give more Way" _xpath="enigma_vii/just21_2" author="JuSt" ctrl="force" easy="true" id="just21" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="33" _title="Give Way 4 two" _xpath="enigma_vii/just22_2" author="JuSt" ctrl="force" easy="true" id="just22" rel="2" rev="2" score="2" target="time" unit="duration"/>
-    <level _seq="34" _title="Lost in Time and Space" _xpath="enigma_vii/just23_1" author="JuSt" ctrl="force" easy="false" id="just23" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="34" _title="Lost in Time and Space" _xpath="enigma_vii/just23_1" author="JuSt" ctrl="force" easy="false" id="just23" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="35" _title="Alternatives?" _xpath="enigma_vii/just24_1" author="JuSt" ctrl="force" easy="true" id="just24" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="36" _title="No More Alternatives" _xpath="enigma_vii/just25_1" author="JuSt" ctrl="force" easy="true" id="just25" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="37" _title="The Walls" _xpath="enigma_vii/just26_1" author="JuSt" ctrl="force" easy="true" id="just26" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -61,14 +61,30 @@
     <level _seq="53" _title="Multiban" _xpath="enigma_vii/dpl01_1" author="Dominik Leipold" ctrl="force" easy="false" id="dpl01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="54" _title="Riverside" _xpath="enigma_vii/johann02_2" author="Johann Freymuth" ctrl="force" easy="false" id="johann02" rel="2" rev="0" score="2" target="time" unit="duration"/>
     <level _seq="55" _title="The Lone Ranger" _xpath="enigma_vii/pulley04_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley04" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="56" _title="Little Shop Of Horrors" _xpath="enigma_vii/pulley07_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley01" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="56" _title="Little Shop Of Horrors" _xpath="enigma_vii/pulley07_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley01" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="57" _title="Spaceship Control" _xpath="enigma_vii/safalra01_1" author="Safalra" ctrl="force" easy="false" id="safalra01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="58" _title="Ball Alley" _xpath="enigma_vii/johann01_1" author="Johann Freymuth" ctrl="force" easy="false" id="johann01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="59" _title="Action Potential" _xpath="enigma_vii/pulley02_1" author="Mark Pulley" ctrl="force" easy="true" id="pulley02" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="60" _title="Remote Meditation" _xpath="enigma_vii/dpl02_1" author="Dominik Leipold" ctrl="force" easy="true" id="dpl02" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="61" _title="Triggered Triggers" _xpath="enigma_vii/just19_1" author="JuSt" ctrl="force" easy="true" id="just19" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="62" _title="Lady in Red" _xpath="enigma_vii/just30_1" author="Just" ctrl="force" easy="true" id="just30" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="61" _title="Triggered Triggers" _xpath="enigma_vii/just19_1" author="JuSt" ctrl="force" easy="true" id="just19" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="62" _title="Lady in Red" _xpath="enigma_vii/just30_1" author="Just" ctrl="force" easy="true" id="just30" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="63" _title="Crawling the Abyss" _xpath="enigma_vii/sph02_1" author="ShadowPhrogg32642342" ctrl="force" easy="true" id="sph02" rel="1" rev="5" score="1" target="time" unit="duration"/>
+    <level _seq="64" _title="Bold Boulder" _xpath="enigma_vii/ral14_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20061124ral279" rel="1" rev="95" score="1" target="time" unit="duration"/>
+    <level _seq="65" _title="Tinker, Tailor" _xpath="enigma_vii/andreas46_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas46" rel="4" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="66" _title="Elbow Society" _xpath="enigma_vii/andreas45_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas45" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="67" _title="Watchmaker" _xpath="enigma_vii/huesing01_1" author="Johannes H?sing" ctrl="force" easy="false" id="huesing01" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="68" _title="Map it out II" _xpath="enigma_vii/manuel01_1" author="Manuel Eisentraut" ctrl="force" easy="true" id="manuel01" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="69" _title="Underground Temple" _xpath="enigma_vii/joe12_2" author="Joseph Dunne" ctrl="force" easy="true" id="joe_12" rel="2" rev="0" score="2" target="time" unit="duration"/>
+    <level _seq="70" _title="Mountain Climbing III" _xpath="enigma_vii/joe26_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe26" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="71" _title="Recover the Stone" _xpath="enigma_vii/joe28_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe28" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="72" _title="Pick-Up" _xpath="enigma_vii/joe27_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe27" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="73" _title="A Kind of Magic" _xpath="enigma_vii/just37_1" author="JuSt" ctrl="force" easy="true" id="JuStA Kind of Magic" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="74" _title="Blue Screen Of Death" _xpath="enigma_vii/pulley10_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley10" rel="2" rev="1" score="2" target="time" unit="duration"/>
+    <level _seq="75" _title="Audience in Venice" _xpath="enigma_vii/mecke09_1" author="mecke" ctrl="force" easy="true" id="mecke9" rel="1" rev="20" score="1" target="time" unit="duration"/>
+    <level _seq="76" _title="Black Liberation" _xpath="enigma_vii/mecke11_1" author="mecke" ctrl="force" easy="true" id="mecke11" rel="1" rev="25" score="1" target="time" unit="duration"/>
+    <level _seq="77" _title="Jack-Of-All-Trades" _xpath="enigma_viii/mecke12_1" author="mecke" ctrl="force" easy="true" id="mecke12" rel="1" rev="31" score="1" target="time" unit="duration"/>
+    <level _seq="78" _title="Enigmaparcour" _xpath="enigma_viii/mecke15_1" author="mecke" ctrl="force" easy="true" id="mecke15" rel="1" rev="11" score="1" target="time" unit="duration"/>
+    <level _seq="79" _title="Rhythm of Space" _xpath="enigma_viii/mecke20_1" author="mecke" ctrl="force" easy="true" id="mecke20" rel="1" rev="21" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Added: trunk/data/levels/enigma_tutorial/a_tut07.xml
===================================================================
--- trunk/data/levels/enigma_tutorial/a_tut07.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_tutorial/a_tut07.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,99 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Chess Stones" el:subtitle="" el:id="c_tut01"/>
+      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:author  el:name="Raoul Bourquin, ShadowPhrogg32642342, Andreas Lochmann" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 Raoul Bourquin, Andreas Lochmann</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libluatools" el:id="lib/libluatools" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="2:22"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-leavesb"}
+ti["1"] = {"fl-leavesc1"}
+ti["2"] = {"fl-leavesc2"}
+ti["3"] = {"fl-leavesc3"}
+ti["4"] = {"fl-leavesc4"}
+ti["."] = {"fl-leaves"}
+ti["~"] = {"fl-water"}
+
+ti["#"] = ti[" "] .. {"st-likeoxyda"}
+ti["@"] = ti["."] .. {"#ac-blackball"}
+ti["C"] = ti["."] .. {"st-chess_black"}
+ti["c"] = ti["."] .. {"st-chess_black", "it_cross"}
+ti["D"] = ti[" "] .. {"st-door_a", name="door#"}
+ti["T"] = ti["."] .. {"it_trigger", name="trigger#", target="open_door"}
+ti["B"] = ti["."] .. {"#ac-blackball", controllers=0, player=1, name="second_marble"}
+ti["S"] = ti["."] .. {"st_switch", target="let_marble_run"}
+ti["d"] = ti["."] .. {"st-door_a", name="first_door"}
+ti["t"] = ti["."] .. {"it_trigger", target="first_door"}
+ti["i"] = ti["."] .. {"it-document", text="text1"}
+ti["I"] = ti["."] .. {"it-document", text="text2"}
+ti["x"] = ti[" "] .. {"st_oxyd", flavor="d"}
+
+w, h = wo(ti, " ", {
+ -- 01234567890123456789
+   "#x###########x####x#",
+   "xD           D    Dx",
+   "# 1.....3          #",
+   "# .......  1...3   #",
+   "# ..C.... 1.T.T.3  #",
+   "# 2...... .T...T.  #",
+   "xD ...... ...~... Dx",
+   "# 1...... .T...T.  #",
+   "# ..C.... 2.T.T.4  #",
+   "# .......  2...4   #",
+   "# 2...I.4          #",
+   "xD    .      D    Dx",
+   "#x####.######x####x#",
+   "#    #.#           #",
+   "#    #.#           #",
+   "#    #d#     1.3   #",
+   "#    #.#     .B.   #",
+   "#    #.#     ...   #",
+   "######.####  2..3  #",
+   "#     .   #   .c.  #",
+   "#  1...3  #   2..3 #",
+   "#  . at .i...S    .t. #",
+   "#  2...4  #    2.4 #",
+   "#         #        #",
+   "####################",
+})
+
+function let_marble_run(onoff, sender)
+  wo:fl(no["second_marble"]):set({force_x = 65, force_y = 155})
+  sender:set({target = ""})
+end
+
+trigger_to_doors = luatools.permutation(8)
+
+function open_door(onoff, sender)
+  local trigger_name = sender["name"]
+  local number = tonumber(string.sub(trigger_name, 9, -1))
+  local door_name = "door#"..trigger_to_doors[number]
+  no[door_name]:message("toggle")
+end
+
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+      <el:string el:key="text1">
+        <el:english el:translate="true">The stone with the horse's head is called ''chess stone''. Watch how the other marble hits one of them to move it. The angle is important.</el:english>
+      </el:string> 
+      <el:string el:key="text2">
+        <el:english el:translate="true">Now try to move these chess stones onto the triggers. They always move two steps plus one step, the crosses might give you some idea.</el:english>
+      </el:string> 
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_tutorial/a_tut07.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/data/levels/enigma_tutorial/index.xml
===================================================================
--- trunk/data/levels/enigma_tutorial/index.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_tutorial/index.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -27,7 +27,7 @@
     <level _seq="19" _title="Sierpinski" _xpath="enigma_iv/alain10_1" author="Alain Busser" ctrl="force" easy="false" id="alain10" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="20" _title="- Meditation -" _xpath="enigma_i/alain03_1" author="Alain Busser" ctrl="force" easy="false" id="alain03" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="21" _title="(Counter)Clockwise" _xpath="enigma_i/wb13_1" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb13" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="22" _title="Hurry!" _xpath="enigma_i/jc01_1" author="Jens-Christian Korth" ctrl="force" easy="false" id="jc01" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="22" _title="Hurry!" _xpath="enigma_i/jc01_1" author="Jens-Christian Korth" ctrl="force" easy="false" id="jc01" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="23" _title="Watery Grave" _xpath="enigma_i/martin37_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin37" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="24" _title="Blocks and Slopes" _xpath="./a_tut03" author="Andreas Lochmann" ctrl="force" easy="false" id="a_tut03" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="25" _title="Round Trip" _xpath="enigma_ii/martin35_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin35" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -56,7 +56,7 @@
     <level _seq="48" _title="Brittle Floor!" _xpath="enigma_iii/martin91_1" author="Martin Hawlisch" ctrl="force" easy="true" id="martin91" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="49" _title="Inverted Laser Spiral" _xpath="enigma_ii/duffy42_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy42" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="50" _title="- Meditation -" _xpath="enigma_i/siegfried35_1" author="Siegfried Fennig" ctrl="force" easy="false" id="meditation14" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="51" _title="Laser Games" _xpath="enigma_iv/mp03_1" author="moonpearl" ctrl="force" easy="false" id="mp03" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="51" _title="Laser Games" _xpath="enigma_iv/mp03_1" author="moonpearl" ctrl="force" easy="false" id="mp03" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="52" _title="Items" _xpath="./a_tut05" author="Andreas Lochmann" ctrl="force" easy="false" id="a_tut05" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="53" _title="Flying" _xpath="enigma_i/luc07_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc07" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="54" _title="Annoying little balls" _xpath="enigma_i/wb09_2" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb9" rel="2" rev="0" score="2" target="time" unit="duration"/>
@@ -69,8 +69,9 @@
     <level _seq="61" _title="Is It Easy?" _xpath="enigma_i/martin06_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin06" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="62" _title="Beam0r" _xpath="enigma_ii/peter01_1" author="Peter Santo" ctrl="force" easy="false" id="peter_001" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="63" _title="Slalom Skiing" _xpath="enigma_ii/martin93_1" author="Martin Hawlisch" ctrl="force" easy="true" id="martin93" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="64" _title="Bye!" _xpath="./a_tut06" author="Andreas Lochmann" ctrl="force" easy="false" id="a_tut06" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="65" _title="Advanced Tutorial" _xpath="./adv_tutorial" author="Jacob Scott" ctrl="force" easy="false" id="m_tutor/adv_tutorial" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="64" _title="Chess Stones" _xpath="./a_tut07" author="Raoul Bourquin, ShadowPhrogg32642342, Andreas Lochmann" ctrl="force" easy="false" id="c_tut01" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="65" _title="Bye!" _xpath="./a_tut06" author="Andreas Lochmann" ctrl="force" easy="false" id="a_tut06" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="66" _title="Advanced Tutorial" _xpath="./adv_tutorial" author="Jacob Scott" ctrl="force" easy="false" id="m_tutor/adv_tutorial" rel="1" rev="0" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Modified: trunk/data/levels/enigma_vi/index.xml
===================================================================
--- trunk/data/levels/enigma_vi/index.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vi/index.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10700" network="false" owner="Enigma Team" release="1" revision="9" title="Enigma VI"/>
+  <info enigma="1.00" group="Enigma" location="10700" network="false" owner="Enigma Team" release="1" revision="10" title="Enigma VI"/>
 
   <attributes/>
 
@@ -11,7 +11,7 @@
     <level _seq="3" _title="Just another pretty level" _xpath="./edward26_1" author="Edward" ctrl="force" easy="true" id="edward26" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="4" _title="A-way" _xpath="./richi06_1" author="Richi B?tzer" ctrl="force" easy="true" id="richi06" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="5" _title="Pac Marble" _xpath="./andreas22_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas22" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="6" _title="Laser Splitting" _xpath="./luc29_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc29" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="6" _title="Laser Splitting" _xpath="./luc29_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc29" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="7" _title="No Memory" _xpath="./edward01_1" author="Edward" ctrl="force" easy="false" id="edward01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="8" _title="Orbitting" _xpath="./andreas26_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas26" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="9" _title="Im-pull-se" _xpath="./ralf07_1" author="Ralf Westram" ctrl="force" easy="false" id="ralf07" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -46,7 +46,7 @@
     <level _seq="38" _title="Janus" _xpath="./andreas38_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas38" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="39" _title="Odyssey" _xpath="./ant39_1" author="Petr Machata" ctrl="force" easy="false" id="ant39" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="40" _title="- Meditation -" _xpath="./andreas36_1" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas36" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="41" _title="Laserpowered" _xpath="./raoul20_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul20" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="41" _title="Laserpowered" _xpath="./raoul20_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul20" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="42" _title="Basketball" _xpath="./ral03_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20060213ral005" rel="2" rev="43" score="2" target="time" unit="duration"/>
     <level _seq="43" _title="Edwards Mountain" _xpath="./edward11_1" author="Edward" ctrl="force" easy="true" id="edward11" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="44" _title="Dancing on Light Beams" _xpath="./andreas28_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas28" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -66,14 +66,14 @@
     <level _seq="58" _title="Chess and Boxes" _xpath="./johannes01_1" author="Johannes Laire" ctrl="force" easy="false" id="20061201johannes313" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="59" _title="Walk the line" _xpath="./erich02_1" author="Erich Schubert" ctrl="force" easy="true" id="erich02" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="60" _title="Jump into Meditation" _xpath="./ral07_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20060525ral009" rel="1" rev="42" score="1" target="time" unit="duration"/>
-    <level _seq="61" _title="River of Challenges" _xpath="./luc33_1" author="Lukas Sch?ller" ctrl="force" easy="true" id="luc332006" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="61" _title="River of Challenges" _xpath="./luc33_1" author="Lukas Sch?ller" ctrl="force" easy="true" id="luc332006" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="62" _title="Hot Hurdle Race" _xpath="./ulf04_1" author="Ulf Stegemann" ctrl="force" easy="true" id="20070124ulf019" rel="1" rev="93" score="1" target="time" unit="duration"/>
-    <level _seq="63" _title="Playing with Lasers" _xpath="./just09_1" author="JuSt" ctrl="force" easy="false" id="just09_1" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="63" _title="Playing with Lasers" _xpath="./just09_1" author="JuSt" ctrl="force" easy="false" id="just09_1" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="64" _title="Rotor Guards" _xpath="./duffy144_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy144" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="65" _title="Knight's Journey" _xpath="./johannes02_1" author="Johannes Laire" ctrl="force" easy="false" id="20061210johannes313" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="66" _title="A Cooler Spot in Hell" _xpath="./andreas43_2" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas43" rel="2" rev="3" score="2" target="time" unit="duration"/>
-    <level _seq="67" _title="Check the light" _xpath="./just10_2" author="JuSt" ctrl="force" easy="false" id="just10" rel="2" rev="5" score="2" target="time" unit="duration"/>
-    <level _seq="68" _title="The Passage" _xpath="./just11_1" author="JuSt" ctrl="force" easy="false" id="just11" rel="1" rev="6" score="1" target="time" unit="duration"/>
+    <level _seq="67" _title="Check the light" _xpath="./just10_2" author="JuSt" ctrl="force" easy="false" id="just10" rel="2" rev="6" score="2" target="time" unit="duration"/>
+    <level _seq="68" _title="The Passage" _xpath="./just11_1" author="JuSt" ctrl="force" easy="false" id="just11" rel="1" rev="7" score="1" target="time" unit="duration"/>
     <level _seq="69" _title="Devil's Bolder" _xpath="./just14_1" author="JuSt" ctrl="force" easy="true" id="just14" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="70" _title="Twisting by the pool" _xpath="./alain23_1" author="Alain Busser" ctrl="force" easy="true" id="alain23" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="71" _title="Revolver" _xpath="./ral16_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070214ral703" rel="1" rev="59" score="1" target="time" unit="duration"/>
@@ -82,28 +82,28 @@
     <level _seq="74" _title="Houdini" _xpath="./ral11_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20060816ral719" rel="2" rev="58" score="2" target="time" unit="duration"/>
     <level _seq="75" _title="The wrong Place?" _xpath="./just17_1" author="JuSt" ctrl="force" easy="false" id="just17" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="76" _title="Idempotency" _xpath="./duffy145_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy145" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="77" _title="Turnstiles for Two" _xpath="./ral17_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070314ral189" rel="1" rev="64" score="1" target="time" unit="duration"/>
+    <level _seq="77" _title="Turnstiles for Two" _xpath="./ral17_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070314ral189" rel="2" rev="94" score="2" target="time" unit="duration"/>
     <level _seq="78" _title="jumping ball flash" _xpath="./illmind13_1" author="illmind" ctrl="force" easy="false" id="2007ill001" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="79" _title="Quadropolis" _xpath="./cel1_1" author="Johannes Laire, Jacob Scott, Raoul Bourquin, Andreas Lochmann" ctrl="force" easy="false" id="cel2007_364" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="80" _title="- Meditation -" _xpath="./raoul18_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul18" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="81" _title="Magic Trinity" _xpath="./duffy146_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy146" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="82" _title="Pontoon Bridges" _xpath="./duffy137_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy137" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="83" _title="The Cube" _xpath="./malaire01_1" author="Markus Laire" ctrl="force" easy="true" id="20061120malaire901" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="84" _title="Blitz Chess" _xpath="./luc32_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc322006" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="84" _title="Blitz Chess" _xpath="./luc32_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc322006" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="85" _title="One-Way Woods" _xpath="./duffy135_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy135" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="86" _title="Tandem Chess" _xpath="./luc34_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc342007" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="87" _title="Your Friend, the Light" _xpath="./just15_1" author="JuSt" ctrl="force" easy="true" id="just15" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="88" _title="Correspondence Chess" _xpath="./luc35_3" author="Lukas Sch?ller" ctrl="force" easy="true" id="luc352007" rel="3" rev="4" score="3" target="time" unit="duration"/>
     <level _seq="89" _title="Magic Triangle" _xpath="./just13_1" author="JuSt" ctrl="force" easy="false" id="just13" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="90" _title="Group Trip to Meditation" _xpath="./duffy136_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy136" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="90" _title="Group Trip to Meditation" _xpath="./duffy136_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy136" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="91" _title="Twokoban I" _xpath="./raoul28_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul28" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="92" _title="Oxyd Drilling" _xpath="./duffy140_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy140" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="93" _title="Parish Fair" _xpath="./duffy143_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy143" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="93" _title="Parish Fair" _xpath="./duffy143_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy143" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="94" _title="In the Middle" _xpath="./duffy141_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy141" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="95" _title="Pleasure Garden" _xpath="./duffy134_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy134" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="96" _title="Construction Workers" _xpath="./duffy142_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy142" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="97" _title="City Life" _xpath="./joona03_1" author="Joona Laire" ctrl="force" easy="true" id="20061119joona503" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="98" _title="Industrial Puzzles" _xpath="./raoul30_2" author="Raoul Bourquin" ctrl="force" easy="false" id="raoul30" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="98" _title="Industrial Puzzles" _xpath="./raoul30_2" author="Raoul Bourquin" ctrl="force" easy="false" id="raoul30" rel="2" rev="6" score="2" target="time" unit="duration"/>
     <level _seq="99" _title="Polar Bears' Paradise" _xpath="./ral19_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070314ral394" rel="1" rev="68" score="1" target="time" unit="duration"/>
     <level _seq="100" _title="The Aztec Temple" _xpath="./zogga01_1" author="Dominik Lehmann" ctrl="force" easy="true" id="zogga01" rel="1" rev="1" score="1" target="time" unit="duration"/>
   </levels>

Deleted: trunk/data/levels/enigma_vi/ral17_1.xml
===================================================================
--- trunk/data/levels/enigma_vi/ral17_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vi/ral17_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -1,260 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected >
-    <el:info el:type="level">
-      <el:identity el:title="Turnstiles for Two" el:subtitle="Rhapsody on Turnstiles in Blue and Green" el:id="20070314ral189"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 64 $" el:status="released"/>
-      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
-      <el:copyright>Copyright ? 2006 Ronald Lamprecht</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="1.00"/>
-      <el:modes el:easy="true" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:credits el:showinfo="true" el:showstart="false">Thanks to Nat Pryce for his libs and code examples</el:credits>
-        <el:code>Lua 5.1</el:code>
-      </el:comments>
-      <el:score el:easy="12:29" el:difficult="16:36"/>
-    </el:info>
-    <el:luamain><![CDATA[
-enigma.ConserveLevel = FALSE
-math_floor = floor
-
-set_oxyd = oxyd
-oxyds = {}
-oxyd_num = 0
-
-function oxyd( x, y, tiles )
-    local o = set_oxyd( x, y )
-    oxyd_num = oxyd_num + 1
-    oxyds[oxyd_num] = o
-    return o
-end
-
-function nothing(x, y, tiles)
-    -- create nothing
-end
-
-function horizontal_bolder(x,y,tiles)
-    if random() >= 0.5 then
-        return set_stone( "st-bolder-w", x, y )
-    else
-        return set_stone( "st-bolder-e", x, y )
-    end
-end
-
-function vertical_bolder(x,y,tiles)
-    if random() >= 0.5 then
-        return set_stone( "st-bolder-n", x, y )
-    else
-        return set_stone( "st-bolder-s", x, y )
-    end
-end
-
-function checkerboard_floor( type1, type2, attribs1, attribs2 )
-    return function( x, y, tiles )
-        if mod(x,2) == mod(y,2) then
-            return set_floor( type1, x, y, attribs1 or {} )
-        else
-            return set_floor( type2, x, y, attribs2 or {} )
-        end
-    end
-end
-
-function floor( floor_type, attribs )
-    return function( x, y, tiles )
-        return set_floor( floor_type, x, y, attribs or {} )
-    end
-end
-
-function stone( stone_type, attribs )
-    return function( x, y, tiles )
-        return set_stone( stone_type, x, y, attribs or {} )
-    end
-end
-
-function item( item_type, attribs )
-    return function( x, y, tiles )
-        return set_item( item_type, x, y, attribs or {} )
-    end
-end
-
-function actor( actor_type, attribs )
-    return function( x, y, tiles )
-        return set_actor( actor_type, x+0.5, y+0.5, attribs or {} )
-    end
-end
-
-function gradient( gradient_type )
-    return function( x, y, tiles )
-        return set_floor( "fl-gradient", x, y, {type=gradient_type} )
-    end
-end
-
-function inherit(tile_type)
-    return function( x, y, tiles )
-        return create_tile( tiles, x, y, tile_type )
-    end
-end
-
-function group( array, constructor )
-    return function( x, y, tiles )
-        object = constructor( x, y, tiles )
-        tinsert( array, object )
-        return object
-    end
-end
-
-function difficulty( d, constructor )
-    if options.Difficulty == d then
-        return constructor
-    else
-        return nothing
-    end
-end
-
-function create_world_from_map( tiles, map )
-    create_world( strlen(map[1]), getn(map) )
-    
-    for y = 1,getn(map) do
-        local line = map[y]
-        for x = 1,strlen(line) do
-            local tile = strchar(strbyte(line,x))
-            create_tile( tiles, x-1, y-1, tile )
-        end
-    end
-end
-
-function create_tile( tiles, x, y, tile_type )
-    local constructors = tiles[tile_type]
-
-    if constructors then
-    for i = 1,getn(constructors) do
-        constructors[i](x,y,tiles)
-    end
-    else
-    error("invalid tile identifier " .. tile_type )
-    end
-end
-
-oxyd_default_flavor = "a"
-
-tiles = {}
-tiles[" "] = {floor("fl-sahara")}
-tiles["~"] = {floor("fl-water")}
-tiles["v"] = {floor("fl-acwhite")}
-tiles["b"] = {floor("fl-acblack")}
-tiles["#"] = {inherit(" "), stone("st-wood_001")}
-tiles["H"] = {inherit(" "), stone("st-wood")}
-tiles["x"] = {inherit(" "), oxyd}
-tiles["N"] = {inherit("~"), stone("st-turnstile-n")}
-tiles["n"] = {inherit(" "), stone("st-turnstile-n")}
-tiles["S"] = {inherit("~"), stone("st-turnstile-s")}
-tiles["s"] = {inherit(" "), stone("st-turnstile-s")}
-tiles["W"] = {inherit("~"), stone("st-turnstile-w")}
-tiles["w"] = {inherit(" "), stone("st-turnstile-w")}
-tiles["E"] = {inherit("~"), stone("st-turnstile-e")}
-tiles["e"] = {inherit(" "), stone("st-turnstile-e")}
-tiles["T"] = {inherit("~"), stone("st-turnstile-green")}
-tiles["J"] = {inherit(" "), stone("st-oneway_white-e")}
-tiles["I"] = {inherit(" "), stone("st-oneway_white-n")}
-tiles["K"] = {inherit(" "), stone("st-oneway_white-s")}
-tiles["k"] = {inherit(" "), stone("st-oneway_black-s")}
-tiles["B"] = {inherit(" "), stone("st-black3")}
-tiles["V"] = {inherit(" "), stone("st-white3")}
-tiles["p"] = {inherit(" "), stone("st-brake")}
-tiles["R"] = {inherit("~"), stone("st-rotator-right")}
-tiles["r"] = {inherit(" "), stone("st-rotator_move-right")}
-tiles["L"] = {inherit("~"), stone("st-rotator-left")}
-tiles["ch"] = {inherit(" "), item("it-cherry")}
-tiles["G"] = {inherit("ch"), stone("st-glass")}
-tiles["U"] = {inherit(" "), item("it-vortex-closed", {name="vortex1",targetx=7, targety=17})}
-tiles["u"] = {inherit(" "), item("it-vortex-closed", {targetx=7, targety=17})}
-
-
-tiles["yb"] = {inherit(" "), item("it-yinyang")}
-tiles["yw"] = {inherit(" "), item("it-yinyang")}
-
-tiles["1"] = {inherit("yb"), actor("ac-blackball", {essential=1})}
-tiles["2"] = {inherit("yw"), actor("ac-whiteball", {essential=1})}
-tiles["8"] = {inherit(" "), actor("ac-top",{force=0, range=0})}
-
-if difficult then
-    tiles["P"] = tiles[" "]
-else
-    tiles["P"] = {inherit(" "), item("it-pin")}
-end
-
-create_world_from_map( tiles, {
-"####################",
-"#x ~  x  JJ  x  ~ x#",
-"#  ~     ~~     ~  #",
-"#  ~     ~~  n  ~  #",
-"#BB~~~T~~~~~~T~~~BB#",
-"#  R  s      s  ~  #",
-"# b~b  P2  1P  vNv #",
-"# wTe          wTe #",
-"# vSv    n     vSv #",
-"#~~~~I~~~T~R~~k~~~~#",
-"#     ~      ~     #",
-"# ~~~~~ r    ~~~~~ #",
-"# ~ B ~   p  ~ V ~ #",
-"# ~xBwTe    wTeVx~ #",
-"# ~ B ~    r ~ V ~ #",
-"# ~~~~~U     ~~~~~ #",
-"# N   ~~R~T~~~   N #",
-"#wT x ~u  s  ~ x Te#",
-"# S   ~      ~   S #",
-"# ~~~~~R    L~~~~~ #",
-"# ~   ~      ~   ~ #",
-"# ~   Te    wT   ~ #",
-"# ~   ~      ~   ~ #",
-"#V~~~~~  n   ~~~~~B#",
-"#     ~~WTE~~~     #",
-"#~~      s      ####",
-"#x~      ~~~  ###x##",
-"# ~      ~x~  #VVVV#",
-"# ~  ~~~V~B~  #GGGG#",
-"#wTe ~xB N V  #    #",
-"# ~~ ~~~~T~~~~   w #",
-"# ~~   B S Vx~  r  #",
-"# L~~  ~V~B~~~     #",
-"# ~8~  ~x~  N   G  #",
-"L T~L  ~~~  T    T #",
-"# s B       S      #",
-"####################"
-})
-SendMessage(enigma.GetNamedObject("vortex1"), "open")
-
-repeat
-    local good_oxyds = 0
-    oxyd_shuffle()
-    for i = 1, 4 do
-        local c = enigma.GetAttrib(oxyds[i], "color")
-        for j = 9, 14 do
-            if (c == enigma.GetAttrib(oxyds[j], "color")) then
-                good_oxyds = good_oxyds + 1
-            end
-        end
-    end
-until good_oxyds >= 2
-
-c = math.random(8) - 1
-set_oxyd( 4, 21, oxyd_default_flavor, c)
-set_oxyd(15, 21, oxyd_default_flavor, c)
-if (c < 7) then
-    for i = 1, 14 do
-        if (c == (enigma.GetAttrib(oxyds[i], "color") + 0)) then
-            enigma.SetAttrib(oxyds[i], "color", "7")
-        end
-    end
-end
-
-display.SetFollowMode (display.FOLLOW_SCROLLING )
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Added: trunk/data/levels/enigma_vi/ral17_2.xml
===================================================================
--- trunk/data/levels/enigma_vi/ral17_2.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vi/ral17_2.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,289 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Turnstiles for Two" el:subtitle="Rhapsody on Turnstiles in Blue and Green" el:id="20070314ral189"/>
+      <el:version el:score="2" el:release="2" el:revision="$Revision: 94 $" el:status="released"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2006, 2007, 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.00"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+        <el:credits el:showinfo="true" el:showstart="false">Thanks to Clifford and NObby for valuable feedback</el:credits>
+        <el:code>Lua 5.1</el:code>
+      </el:comments>
+      <el:score el:easy="10:36" el:difficult="19:56"/>
+    </el:info>
+    <el:luamain><![CDATA[
+enigma.ConserveLevel = FALSE
+math_floor = floor
+
+set_oxyd = oxyd
+oxyds = {}
+oxyd_num = 0
+
+function oxyd( x, y, tiles )
+    local o = set_oxyd( x, y )
+    oxyd_num = oxyd_num + 1
+    oxyds[oxyd_num] = o
+    return o
+end
+
+function nothing(x, y, tiles)
+    -- create nothing
+end
+
+function horizontal_bolder(x,y,tiles)
+    if random() >= 0.5 then
+        return set_stone( "st-bolder-w", x, y )
+    else
+        return set_stone( "st-bolder-e", x, y )
+    end
+end
+
+function vertical_bolder(x,y,tiles)
+    if random() >= 0.5 then
+        return set_stone( "st-bolder-n", x, y )
+    else
+        return set_stone( "st-bolder-s", x, y )
+    end
+end
+
+function checkerboard_floor( type1, type2, attribs1, attribs2 )
+    return function( x, y, tiles )
+        if mod(x,2) == mod(y,2) then
+            return set_floor( type1, x, y, attribs1 or {} )
+        else
+            return set_floor( type2, x, y, attribs2 or {} )
+        end
+    end
+end
+
+function floor( floor_type, attribs )
+    return function( x, y, tiles )
+        return set_floor( floor_type, x, y, attribs or {} )
+    end
+end
+
+function stone( stone_type, attribs )
+    return function( x, y, tiles )
+        return set_stone( stone_type, x, y, attribs or {} )
+    end
+end
+
+function item( item_type, attribs )
+    return function( x, y, tiles )
+        return set_item( item_type, x, y, attribs or {} )
+    end
+end
+
+function actor( actor_type, attribs )
+    return function( x, y, tiles )
+        return set_actor( actor_type, x+0.5, y+0.5, attribs or {} )
+    end
+end
+
+function gradient( gradient_type )
+    return function( x, y, tiles )
+        return set_floor( "fl-gradient", x, y, {type=gradient_type} )
+    end
+end
+
+function inherit(tile_type)
+    return function( x, y, tiles )
+        return create_tile( tiles, x, y, tile_type )
+    end
+end
+
+function group( array, constructor )
+    return function( x, y, tiles )
+        object = constructor( x, y, tiles )
+        tinsert( array, object )
+        return object
+    end
+end
+
+function difficulty( d, constructor )
+    if options.Difficulty == d then
+        return constructor
+    else
+        return nothing
+    end
+end
+
+function create_world_from_map( tiles, map )
+    create_world( strlen(map[1]), getn(map) )
+    
+    for y = 1,getn(map) do
+        local line = map[y]
+        for x = 1,strlen(line) do
+            local tile = strchar(strbyte(line,x))
+            create_tile( tiles, x-1, y-1, tile )
+        end
+    end
+end
+
+function create_tile( tiles, x, y, tile_type )
+    local constructors = tiles[tile_type]
+
+    if constructors then
+    for i = 1,getn(constructors) do
+        constructors[i](x,y,tiles)
+    end
+    else
+    error("invalid tile identifier " .. tile_type )
+    end
+end
+
+oxyd_default_flavor = "a"
+
+tiles = {}
+tiles[" "] = {floor("fl-sahara")}
+tiles["."] = {floor("fl-sahara",{friction=18, mousefactor=3.0})}
+tiles["!"] = {floor("fl-sahara",{force_y=30})}
+tiles["~"] = {floor("fl-water")}
+tiles["v"] = {floor("fl-acwhite")}
+tiles["b"] = {floor("fl-acblack")}
+tiles["#"] = {inherit(" "), stone("st-wood_001")}
+tiles["H"] = {inherit(" "), stone("st-wood")}
+tiles["x"] = {inherit(" "), oxyd}
+tiles["N"] = {inherit("~"), stone("st-turnstile-n")}
+tiles["n"] = {inherit(" "), stone("st-turnstile-n")}
+tiles["S"] = {inherit("~"), stone("st-turnstile-s")}
+tiles["s"] = {inherit(" "), stone("st-turnstile-s")}
+tiles["W"] = {inherit("~"), stone("st-turnstile-w")}
+tiles["w"] = {inherit(" "), stone("st-turnstile-w")}
+tiles["E"] = {inherit("~"), stone("st-turnstile-e")}
+tiles["e"] = {inherit(" "), stone("st-turnstile-e")}
+tiles["T"] = {inherit("~"), stone("st-turnstile-green")}
+tiles["J"] = {inherit(" "), stone("st-oneway_white-e")}
+tiles["I"] = {inherit(" "), stone("st-oneway_white-n")}
+tiles["K"] = {inherit(" "), stone("st-oneway_white-s")}
+tiles["k"] = {inherit(" "), stone("st-oneway_black-s")}
+tiles["B"] = {inherit(" "), stone("st-black3")}
+tiles["C"] = {inherit("."), stone("st-black3")}
+tiles["V"] = {inherit(" "), stone("st-white3")}
+tiles["X"] = {inherit("."), stone("st-white3")}
+tiles["R"] = {inherit("~"), stone("st-rotator-right")}
+tiles["r"] = {inherit(" "), stone("st-rotator_move-right")}
+tiles["L"] = {inherit("~"), stone("st-rotator-left")}
+tiles["ch"] = {inherit(" "), item("it-cherry")}
+tiles["G"] = {inherit("ch"), stone("st-glass")}
+tiles["ba"] = {inherit("~"), item("it-cherry")}
+tiles["g"] = {inherit("ba"), stone("st-glass_move")}
+
+
+tiles["yb"] = {inherit(" "), item("it-yinyang")}
+tiles["yw"] = {inherit(" "), item("it-yinyang")}
+
+tiles["1"] = {inherit("yb"), actor("ac-blackball", {essential=1})}
+tiles["2"] = {inherit("yw"), actor("ac-whiteball", {essential=1})}
+tiles["8"] = {inherit(" "), actor("ac-top",{force=0, range=0})}
+
+if difficult then
+    tiles["P"] = tiles[" "]
+    tiles["p"] = tiles[" "]
+    tiles["U"] = {inherit(" "), stone("st-grate1")}
+    tiles["u"] = tiles["r"]
+    tiles["t"] = tiles[" "]
+    tiles["A"] = {inherit("!"), item("it-blocker")}
+    tiles["a"] = {inherit(" "), item("it-trigger",{target="doblock", action="callback"})}
+    tiles["="] = tiles["~"]
+    tiles["i"] = tiles["~"]
+    tiles["m"] = {inherit("~"), stone("st-mail-e")}
+else
+    tiles["P"] = {inherit(" "), item("it-pin")}
+    tiles["p"] = {inherit(" "), stone("st-brake")}
+    tiles["U"] = tiles[" "]
+    tiles["u"] = tiles[" "]
+    tiles["t"] = tiles["r"]
+    tiles["A"] = tiles[" "]
+    tiles["a"] = tiles[" "]
+    tiles["="] = tiles[" "]
+    tiles["i"] = {inherit("~"), stone("st-invisible")}
+    tiles["m"] = tiles["~"]
+end
+
+function doblock(value, sender)
+    if value == TRUE then
+        enigma.SendMessage(enigma.GetItem(8, 10), "close", nil)
+    else
+        enigma.SendMessage(enigma.GetStone(8, 10), "open", nil)
+    end
+end
+
+
+create_world_from_map( tiles, {
+"####################",
+"#x m  x  JJ  x  ~ x#",
+"#  ~     ~~     ~  #",
+"#  ~     ~~  n  ~  #",
+"#BB~~~T~~~~~~T~~~BB#",
+"#  R  s      s  ~  #",
+"# b~b  P2  1P  vNv #",
+"# wTe          wTe #",
+"# vSv    n     vSv #",
+"#~~~~I~~~T~R~~k~~~~#",
+"#     ~ A~a  ~     #",
+"# ~~~~~      ~~~~~ #",
+"# ~ B ~ r p  ~ V ~ #",
+"# ~xBwTe UU wTeVx~ #",
+"# ~ B ~    u ~ V ~ #",
+"# ~~~~~      ~~~~~ #",
+"# N   ~~R~T~~~   N #",
+"#wT x ~   s  ~ x Te#",
+"# S   ~   U  ~   S #",
+"# ~~~~~R=  =L~~~~~ #",
+"# ~   ~      ~   ~ #",
+"# ~   Te UtUwT   ~ #",
+"# ~   ~      ~   ~ #",
+"#V~~~~~  n   ~~~~~B#",
+"#     ~~WTE~~~     #",
+"#~~      s      ####",
+"#x~      ~~~  ###x##",
+"# ~      ~x~  #VVVV#",
+"# ~  ~~iXiBi  #GGGG#",
+"#wTe ~xB.N.X  R    #",
+"# ~~ ~~i~T~i~~ g w #",
+"# ~~   C.S.Vx~  r  #",
+"# L~~  iViCi~~     #",
+"# ~8~  ~x~  N   G  #",
+"L T~L  ~~~  T    T #",
+"# s B       S      #",
+"####################"
+})
+
+repeat
+    local good_oxyds = 0
+    oxyd_shuffle()
+    for i = 1, 4 do
+        local c = enigma.GetAttrib(oxyds[i], "color")
+        for j = 9, 14 do
+            if (c == enigma.GetAttrib(oxyds[j], "color")) then
+                good_oxyds = good_oxyds + 1
+            end
+        end
+    end
+until good_oxyds >= 2
+
+c = math.random(8) - 1
+set_oxyd( 4, 21, oxyd_default_flavor, c)
+set_oxyd(15, 21, oxyd_default_flavor, c)
+if (c < 7) then
+    for i = 1, 14 do
+        if (c == (enigma.GetAttrib(oxyds[i], "color") + 0)) then
+            enigma.SetAttrib(oxyds[i], "color", "7")
+        end
+    end
+end
+
+display.SetFollowMode (display.FOLLOW_SCROLLING )
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_vi/ral17_2.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_vii/andreas45_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/andreas45_2.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/andreas45_2.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,206 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Elbow Society" el:subtitle="" el:id="andreas45"/>
+      <el:version el:score="2" el:release="2" el:revision="5" el:status="released"/>
+      <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2007 Andreas Lochmann</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="0.92">
+        <el:dependency el:path="lib/natmaze" el:id="lib/natmaze" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+        <el:dedication>Thanks to Nat for his maze-library!</el:dedication>
+      </el:comments>
+      <el:score el:easy="0:52" el:difficult="1:56"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+originx = 1
+originy = 1
+mainfloor = "fl-black"
+mainstone = "st-death"
+friction = 3.0
+mousefactor = 1.0
+
+function set_deathly(x, y)
+  set_item("it-death", x, y)
+end
+
+function cell_to_level( cellx, celly )
+  return originx + cellx * 2, originy + celly * 2
+end
+
+mod = math.mod or math.fmod
+
+function close_tile(x, y)
+  -- Set the death-item on the left or right side?
+  -- Choosing this randomly doesn't look very well,
+  -- as a random distribution is too clustered.
+  -- Instead, we use some modulo magic, yielding a
+  -- repeating pattern of size 3x5 (maze) or 5x3
+  -- (puzzle).
+  local result
+  if y < 25 then
+    -- 3x5 looks better in the maze.
+    result = mod(mod(x, 3) + mod(y, 5), 2)
+  else
+    -- 5x3 looks better in the puzzle area.
+    result = mod(mod(x, 5) + mod(y, 3), 2)
+  end
+  if result == 0 then
+    set_deathly(x, y)
+  else
+    set_deathly(x + 9, y)
+  end
+end
+  
+function render_cell( maze, cellx, celly )
+  x, y = cell_to_level( cellx, celly )
+  if not maze:can_go_south(cellx,celly) then
+    close_tile(x, y+1)
+  end
+  if x == 9 then
+    return
+  end
+  close_tile(x+1, y+1)
+  if not maze:can_go_east(cellx,celly) then
+    close_tile(x+1, y)
+  end
+end
+
+function call_trigger(onoff, sender)
+  local x, y = enigma.GetPos(sender)
+  x = x + 9
+  y = y + 4
+  SendMessage(enigma.GetFloor(x,y), "open")
+end
+
+function renderLine(line, pattern)
+  for j = 1, strlen(pattern) do
+    local c = strsub(pattern, j, j)
+    if c == " " then
+      --set_floor(mainfloor, j-1, line)
+    elseif c == "#" then
+      set_stone(mainstone, j-1, line)
+    elseif c == "." then
+      --set_deathly(j-1, line)       
+    elseif c == "+" then
+      close_tile(j-1, line)
+    elseif c == "*" then
+      set_deathly(j-1, line)       
+    elseif c == "t" then
+      set_item("it-trigger", j-1, line,
+               {action = "callback", target = "call_trigger"})
+    elseif c == "b" then
+      set_floor("fl-bridge-closed", j-1, line,
+                {friction = friction, mousefactor = mousefactor})
+    elseif c == "B" then
+      set_floor("fl-bridge-closed", j-1, line,
+                {friction = friction, mousefactor = mousefactor})
+      set_deathly(j-1, line)
+    end
+  end
+end
+
+
+levelw = 20
+if difficult then
+  levelh = (5*12) + 1
+else
+  levelh = (3*12) + 1
+end
+
+create_world(levelw, levelh)
+
+for x = 0, levelw - 1 do
+  for y = 0, levelh - 1 do
+    set_floor(mainfloor, x, y, {friction = friction, mousefactor = mousefactor})
+  end
+end
+
+draw_border(mainstone)
+render_maze(new_kruskal_maze(5, 12), render_cell)
+kill_item(9, 24)
+kill_item(18, 24)
+set_stone("st-oxyd",  1, levelh - 1, {color="7"})
+set_stone("st-oxyd",  9, levelh - 1, {color="7"})
+set_stone("st-oxyd", 10, levelh - 1, {color="7"})
+set_stone("st-oxyd", 18, levelh - 1, {color="7"})
+
+if difficult then
+  set_stone("st-oxyd",  1, 35, {color="7"})
+  set_stone("st-oxyd", 10, 35, {color="7"})
+  set_stone("st-oxyd",  1, 35+12, {color="7"})
+  set_stone("st-oxyd", 10, 35+12, {color="7"})
+end
+
+set_actor("ac-blackball", 1.5, 1.5, {essential = -1})
+set_actor("ac-blackball", 10.5, 1.5, {essential = -1})
+
+enigma.ConserveLevel = FALSE
+
+if difficult then
+  --              01234567890123456789
+  renderLine(25, "#                  #")
+  renderLine(26, "#ttttttttt.. ......#")
+  renderLine(27, "#tt tttttt.. ......#")
+  renderLine(28, "#ttttttttt   .*....#")
+  renderLine(29, "#ttttttttt .......*#")
+  renderLine(30, "#ttt*ttt tbbbbBbbbb#")
+  renderLine(31, "#tttttttttbb bbbbbb#")
+  renderLine(32, "#+.+  +..+bbbbbbbbb#")
+  renderLine(33, "#...+ .++.bbbbbbbbb#")
+  renderLine(34, "#.    +   bbb bbb b#")
+  renderLine(35, "#....   + bbbbbbbbb#")
+  renderLine(36, "######### ######## #")
+  renderLine(37, "#                  #")
+  renderLine(38, "#ttttttttt.. ......#")
+  renderLine(39, "#tt tttttt.. ......#")
+  renderLine(40, "#ttttttttt.. .*....#")
+  renderLine(41, "#ttttttttt*.      *#")
+  renderLine(42, "#ttt*ttt tbbbbBbbbb#")
+  renderLine(43, "#tttttttttbb bbbbbb#")
+  renderLine(44, "#+ +     +bbbbbbbbb#")
+  renderLine(45, "#. .+..++.bbbbbbbbb#")
+  renderLine(46, "#.    +   bbb bbb b#")
+  renderLine(47, "#....   + bbbbbbbbb#")
+  renderLine(48, "######### ######## #")
+  renderLine(49, "#                  #")
+  renderLine(50, "#ttttttttt..... ...#")
+  renderLine(51, "#tt tttttt..... ...#")
+  renderLine(52, "#ttttttttt....* ...#")
+  renderLine(53, "#ttttttttt*.     .*#")
+  renderLine(54, "#ttt*ttt tbbbbBbbbb#")
+  renderLine(55, "#tttttttttbb bbbbbb#")
+  renderLine(56, "#+ +..+  +bbbbbbbbb#")
+  renderLine(57, "#. .+..+  bbbbbbbbb#")
+  renderLine(58, "#  ...+.. bbb bbb b#")
+  renderLine(59, "# ......+ bbbbbbbbb#")
+  --              012345678901234567890123456789012345678
+else
+  --              01234567890123456789
+  renderLine(25, "#                  #")
+  renderLine(26, "#ttttttttt.........#")
+  renderLine(27, "#tt tttttt.........#")
+  renderLine(28, "#ttttttttt....*....#")
+  renderLine(29, "#ttttttttt........*#")
+  renderLine(30, "#ttt*ttt tbbbbBbbbb#")
+  renderLine(31, "#tttttttttbb bbbbbb#")
+  renderLine(32, "#+.+.....+bbbbbbbbb#")
+  renderLine(33, "#...+..+..bbbbbbbbb#")
+  renderLine(34, "#.....+...bbb bbb b#")
+  renderLine(35, "#.......+.bbbbbbbbb#")
+  --              012345678901234567890123456789012345678
+end
+
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_vii/andreas45_2.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_vii/andreas46_3.xml
===================================================================
--- trunk/data/levels/enigma_vii/andreas46_3.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/andreas46_3.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,197 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Tinker, Tailor" el:subtitle="" el:id="andreas46"/>
+      <el:version el:score="2" el:release="4" el:revision="2" el:status="released"/>
+      <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2007 Andreas Lochmann</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libluatools" el:id="lib/libluatools" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:score el:easy="3:25" el:difficult="5:44"/>
+    </el:info>
+    <el:luamain><![CDATA[
+parastonekind = "st-grate2"  --"st-likeoxyda-open"
+
+if wo["IsDifficult"] then
+  maxstrength = 1000
+else
+  maxstrength = 0
+end
+
+function myrandom()
+  -- Return a random number of the following: 3, 2, 1, -1, -2, -3.
+  return ({3,2,1,-1,-2,-3})[random(6)]
+end
+
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-leavesb"}
+ti["1"] = {"fl-leavesc1"}
+ti["2"] = {"fl-leavesc2"}
+ti["3"] = {"fl-leavesc3"}
+ti["4"] = {"fl-leavesc4"}
+ti["."] = {"fl-leavesb", force_x = myrandom(), force_y = myrandom()}
+
+ti["#"] = ti[" "] .. {"st-glass2"}
+ti["G"] = ti[" "] .. {"st-glass2"}
+ti["@"] = ti[" "] .. {"#ac-blackball", name = "marble"}
+ti["o"] = ti[" "] .. {"st_oxyd", flavor = "b"}
+ti["S"] = ti[" "] .. {"st-scissors", name = "scissors#", target = "call_scissors"}
+ti["C"] = ti[" "] .. {"st-scissors", name = "scissors_central", target = "call_scissors"}
+ti["X"] = (ti[" "] .. {"st-glass1"}) .. {"#ac-horse", name = "horse#"}
+ti["s"] = ti[" "] .. {parastonekind, name = "parascissors#"}
+ti["c"] = ti[" "] .. {parastonekind, name = "parascissors_central"}
+ti["x"] = (ti[" "] .. {"st-glass1_hole", name = "paraplace#"})
+ti["u"] = ti[" "] .. {"st_switch", target = "next_pattern"}
+ti["v"] = ti[" "] .. {"st_switch", target = "solve"}
+ti["r"] = {"fl-leavesb", "parafloor#"}
+ti["t"] = ti[" "] .. {"st_timer", interval = 2.0, name = "timer", loop = false,
+                      invisible = true}
+
+w, h = wo(ti, " ", {
+ -- 01234567890123456789
+   "####################",
+   "#         GG  r r  #",
+   "#   X X   GGr.....r#",
+   "#   S S   GG..x.x..#",
+   "#         GG..s.s..#",
+   "#XS @   SXGGxs...sx#",
+   "#    C    GG...c...#",
+   "#XS     SXGGxs...sx#",
+   "#         GG..s.s..#",
+   "#   S S   GG..x.x..#",
+   "#   X X   GGr.....r#",
+   "#         GG  r r  #",
+   "####################",
+   "t                   ",
+})
+
+function connect(obj1, obj2, strength)
+  enigma.AddRubberBand(obj1, obj2, strength or maxstrength, 2.5)
+  obj1:set({_partner = obj2})
+  obj2:set({_partner = obj1})
+end
+
+function call_scissors(onoff, sender)
+  local marbles_partner = no["marble"]["_partner"]
+  local scissors_partner = sender["_partner"]
+  if sender == marbles_partner then
+    -- Marble hit its own partner, recreate rubberband
+    -- and everything is fine
+    connect(no["marble"], sender)
+  else
+    -- This is the interesting case:
+    -- Rubberband of marble is already cut, now delete the other one
+    -- We do some trick while rubberbands can't be killed yet:
+    -- Recreate the stone!
+    --no["rb_"..scissors_partner["name"]]:kill()
+    local sname = sender["name"]
+    wo[sender] = {"st-scissors", name = sname, target = "call_scissors"}
+    -- Reconnect
+    connect(no["marble"], no[sname])
+    connect(scissors_partner, marbles_partner, 0)
+    -- Check for correct pattern
+    local correct = true
+    for j = 1, 8 do
+      correct = correct and
+          (no["horse#"..j]["_partner"] == no["scissors#"..Goal[j]])
+    end
+    if correct then
+      next_pattern()
+    end
+  end
+end
+
+function solve()
+  for j = 1, 8 do
+    wo[no["scissors#"..j]] = {"st-scissors", name = "scissors#"..j}
+  end
+  for j = 1, 8 do
+    connect(no["horse#"..j], no["scissors#"..Goal[j]])
+  end
+end
+
+pattern_count = 0
+function next_pattern()
+  pattern_count = pattern_count + 1
+  if pattern_count < 8 then
+    -- create new permutation with one horse less
+    local p = luatools.cyclic_permutation(8 - pattern_count)
+    for j = 8 - pattern_count + 1, 8 do
+      p[j] = j
+    end
+    for j = 1, 8 do
+      Goal[fixpoint_permutation[j]] = fixpoint_permutation[p[j]]
+    end
+    -- create temporary goals for the horses to untangle
+    local TemporaryGoal = luatools.permutation(8)
+    for j = 1, 8 do
+      no["parahorse#"..j]:set(
+          {destination = {no["parafloor#"..TemporaryGoal[j]]}})
+    end
+    -- use timer to set real goals
+    no["timer"]:set({target = "fix_horses", interval = 2.0, loop = false})
+    no["timer"]:message("on")
+  else
+    -- set oxyds
+    for j = 1, 8 do
+      wo[no["scissors#"..j]] = {"st_oxyd"}
+    end
+    wo:shuffleOxyd()
+  end
+end
+
+function fix_horses()
+  for j = 1, 8 do
+    no["parahorse#"..Goal[j]]:set({destination = {no["paraplace#"..j]}})
+  end
+  -- taint the glass of the new "fixpoint"
+  local k = 8 - pattern_count + 1  --first_permutation[pattern_count]
+  wo[no["paraplace#"..fixpoint_permutation[k]]]
+    = {"st-glass2_hole", name = "paraplace#"..fixpoint_permutation[k]}
+  if pattern_count == 7 then
+    wo[no["paraplace#"..fixpoint_permutation[1]]]
+      = {"st-glass2_hole", name = "paraplace#"..fixpoint_permutation[1]}
+  end
+end
+
+Goal = luatools.cyclic_permutation(8)
+connect(no["marble"], no["scissors_central"])
+
+if wo["IsDifficult"] then
+  fixpoint_permutation = luatools.permutation(8)
+else
+  fixpoint_permutation = {}
+  for j = 1, 8 do
+    fixpoint_permutation[j] = j
+  end
+end
+
+for j = 1, 8 do
+  -- Note: The parahorses have the same number as the stones
+  --       they're connected to. It's the paraplace which Goal
+  --       references to, in contrast to the real situation on
+  --       the left side.
+  wo[no["paraplace#"..j]] = {"#ac-horse", name = "parahorse#"..Goal[j],
+                                          force = 4 + j/10}
+end
+
+for j = 1, 8 do
+  connect(no["parahorse#"..j], no["parascissors#"..j], 0)
+  connect(no["horse#"..j], no["scissors#"..j], 0)
+end
+
+wo:shuffleOxyd()
+
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_vii/andreas46_3.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_vii/huesing01_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/huesing01_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/huesing01_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,78 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+     <el:info el:type="level">
+       <el:identity el:title="Watchmaker" el:subtitle="Mend the clockwork" el:id="huesing01"/>
+       <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+       <el:author el:name="Johannes H?sing" el:email="hannes at ruhrau.de" el:homepage="http://derwisch.wikidot.com"/>
+       <el:copyright>Copyright ? 2008 Johannes H?sing </el:copyright>
+       <el:license el:type="GPL v2.0 or above" el:open="true"/>
+       <el:compatibility el:enigma="1.10"/>
+       <el:modes el:easy="false" el:single="true" el:network="false"/>
+       <el:score el:easy="-" el:difficult="-"/>
+     </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-metal4"}
+ti["-"] = {"fl-metal2"}
+ti["+"] = {"fl-metal3"}
+ti["|"] = {"fl-metal6"}
+ti["~"] = {"fl-water"}
+ti["#"] = {"st-metal"}
+ti["W"] = ti["+"] .. {"st-wood"}
+ti["X"] = {"st_oxyd"}
+ti[":"] = {"st-door-v","door#"}
+ti["A"] = ti["~"] .. {"st_boulder_n", "boulderA"}
+ti["a"] = {"it_trigger", target="boulderA", action_1="turn"}
+ti["B"] = ti["~"] .. {"st_boulder_s", "boulderB"}
+ti["b"] = {"it_trigger", target="boulderB", action_1="turn"}
+ti["1"] = {"it_trigger", target={"door#5","door#6"}, action_1={"open","close"}, action_0={"nope","nope"}}
+ti["2"] = {"it_trigger", target={"door#4","door#3"}, action_1={"open","close"}, action_0={"nope","nope"}}
+ti["3"] = {"it_trigger", target={"door#7","door#8"}, action_1={"open","close"}, action_0={"nope","nope"}}
+ti["4"] = {"it_trigger", target={"door#2","door#1"}, action_1={"open","close"}, action_0={"nope","nope"}}
+ti["5"] = {"it_trigger", target={"door#6","door#7"}, action_1={"open","close"}, action_0={"nope","nope"}}
+ti["6"] = {"it_trigger", target={"door#3","door#2"}, action_1={"open","close"}, action_0={"nope","nope"}}
+ti["7"] = {"it_trigger", target={"door#8","door#5"}, action_1={"open","close"}, action_0={"nope","nope"}}
+ti["8"] = {"it_trigger", target={"door#1","door#4"}, action_1={"open","close"}, action_0={"nope","nope"}}
+ti["D"] = ti["+"] .. {"it-document", text="text1"}
+
+ti["0"] = {"ac-blackball", 0.0, 0.5}
+
+w, h = wo(ti, " ", {
+"####################",
+"#X : : : :A        #",
+"###########        #",
+"#                  #",
+"#   1-a-2  5-b-6   #",
+"#   |+++|  |+++|   #",
+"#   a+W+a 0b+W+b   #",
+"#   |+D+|  |+++|   #",
+"#   3-a-4  7-b-8   #",
+"#                  #",
+"#        ###########",
+"#        B: : : : X#",
+"####################"
+})
+
+  ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="true"/>
+        <el:translation el:lang="de">Uhrmacher</el:translation>
+        <el:translation el:lang="nl">Klokkenmaker</el:translation>
+        <el:translation el:lang="ru">????????</el:translation>
+      </el:string>
+      <el:string el:key="subtitle">
+        <el:english el:translate="true"/>
+        <el:translation el:lang="de">repariere das Uhrwerk</el:translation>
+        <el:translation el:lang="nl">repareer het uurwerk</el:translation>
+        <el:translation el:lang="ru">?????????? ??????? ????????</el:translation>
+      </el:string>
+      <el:string el:key="text1">
+        <el:english el:translate="true">Don't close the pools before the clockwork is done, unless you are Fred Astaire</el:english>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: trunk/data/levels/enigma_vii/huesing01_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/data/levels/enigma_vii/index.xml
===================================================================
--- trunk/data/levels/enigma_vii/index.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/index.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Enigma" location="10800" network="false" owner="Enigma Team" release="1" revision="12" title="Enigma VII"/>
+  <info enigma="1.00" group="Enigma" location="10800" network="false" owner="Enigma Team" release="1" revision="13" title="Enigma VII"/>
 
   <attributes/>
 
@@ -16,14 +16,14 @@
     <level _seq="8" _title="Temple of Ganesha" _xpath="./duffy154_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy154" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="9" _title="Open Path" _xpath="./duffy152_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy152" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="10" _title="- Meditation -" _xpath="./edward30_1" author="Edward" ctrl="force" easy="true" id="edward30" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="11" _title="Laser Squad" _xpath="./duffy153_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy153" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="11" _title="Laser Squad" _xpath="./duffy153_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy153" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="12" _title="Free Riders" _xpath="./duffy155_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy155" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="13" _title="Oneway for White" _xpath="./duffy157_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy157" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="14" _title="The Wild Hunt" _xpath="./duffy159_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy159" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="15" _title="Widgets in the Attic" _xpath="./duffy158_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy158" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="16" _title="Protected Exhibition" _xpath="./duffy156_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy156" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="17" _title="Upstairs Meditation" _xpath="./duffy138_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy138" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="18" _title="Speed Meditation" _xpath="./duffy148_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy148" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="18" _title="Speed Meditation" _xpath="./duffy148_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy148" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="19" _title="Pool with a pole" _xpath="./alain28_1" author="Alain Busser" ctrl="force" easy="false" id="alain28" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="20" _title="Meditation in Peace" _xpath="./ral20_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070502ral466" rel="1" rev="70" score="1" target="time" unit="duration"/>
     <level _seq="21" _title="Cold Meditation" _xpath="./ral18_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070314ral728" rel="1" rev="67" score="1" target="time" unit="duration"/>
@@ -45,7 +45,7 @@
     <level _seq="37" _title="Horseshoes" _xpath="./duffy163_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy163" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="38" _title="Knot Garden" _xpath="./duffy165_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy165" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="39" _title="Impulse-phobia" _xpath="./duffy166_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy166" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="40" _title="Slopes, Jumps &amp; Falls" _xpath="./duffy167_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy167" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="40" _title="Slopes, Jumps &amp; Falls" _xpath="./duffy167_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy167" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="41" _title="Arctic Jumping" _xpath="./duffy168_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy168" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="42" _title="Breakthrough" _xpath="./duffy170_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy170" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="43" _title="Seasonal Patterns" _xpath="./duffy164_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy164" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -61,9 +61,9 @@
     <level _seq="53" _title="Re-entry Circuit" _xpath="./pulley05_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley05" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="54" _title="Not Fast Enough" _xpath="./jet04_3" author="James Taylor, Ronald Lamprecht" ctrl="force" easy="true" id="20070413jet001" rel="3" rev="3" score="3" target="time" unit="duration"/>
     <level _seq="55" _title="Give Way" _xpath="./just20_1" author="JuSt" ctrl="force" easy="false" id="just20" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="56" _title="Give more Way" _xpath="./just21_2" author="JuSt" ctrl="force" easy="true" id="just21" rel="2" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="56" _title="Give more Way" _xpath="./just21_2" author="JuSt" ctrl="force" easy="true" id="just21" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="57" _title="Give Way 4 two" _xpath="./just22_2" author="JuSt" ctrl="force" easy="true" id="just22" rel="2" rev="2" score="2" target="time" unit="duration"/>
-    <level _seq="58" _title="Lost in Time and Space" _xpath="./just23_1" author="JuSt" ctrl="force" easy="false" id="just23" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="58" _title="Lost in Time and Space" _xpath="./just23_1" author="JuSt" ctrl="force" easy="false" id="just23" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="59" _title="Alternatives?" _xpath="./just24_1" author="JuSt" ctrl="force" easy="true" id="just24" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="60" _title="No More Alternatives" _xpath="./just25_1" author="JuSt" ctrl="force" easy="true" id="just25" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="61" _title="The Walls" _xpath="./just26_1" author="JuSt" ctrl="force" easy="true" id="just26" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -85,14 +85,27 @@
     <level _seq="77" _title="Multiban" _xpath="./dpl01_1" author="Dominik Leipold" ctrl="force" easy="false" id="dpl01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="78" _title="Riverside" _xpath="./johann02_2" author="Johann Freymuth" ctrl="force" easy="false" id="johann02" rel="2" rev="0" score="2" target="time" unit="duration"/>
     <level _seq="79" _title="The Lone Ranger" _xpath="./pulley04_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley04" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="80" _title="Little Shop Of Horrors" _xpath="./pulley07_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley01" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="80" _title="Little Shop Of Horrors" _xpath="./pulley07_1" author="Mark Pulley" ctrl="force" easy="false" id="pulley01" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="81" _title="Spaceship Control" _xpath="./safalra01_1" author="Safalra" ctrl="force" easy="false" id="safalra01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="82" _title="Ball Alley" _xpath="./johann01_1" author="Johann Freymuth" ctrl="force" easy="false" id="johann01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="83" _title="Action Potential" _xpath="./pulley02_1" author="Mark Pulley" ctrl="force" easy="true" id="pulley02" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="84" _title="Remote Meditation" _xpath="./dpl02_1" author="Dominik Leipold" ctrl="force" easy="true" id="dpl02" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="85" _title="Triggered Triggers" _xpath="./just19_1" author="JuSt" ctrl="force" easy="true" id="just19" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="86" _title="Lady in Red" _xpath="./just30_1" author="Just" ctrl="force" easy="true" id="just30" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="85" _title="Triggered Triggers" _xpath="./just19_1" author="JuSt" ctrl="force" easy="true" id="just19" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="86" _title="Lady in Red" _xpath="./just30_1" author="Just" ctrl="force" easy="true" id="just30" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="87" _title="Crawling the Abyss" _xpath="./sph02_1" author="ShadowPhrogg32642342" ctrl="force" easy="true" id="sph02" rel="1" rev="5" score="1" target="time" unit="duration"/>
+    <level _seq="88" _title="Bold Boulder" _xpath="./ral14_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20061124ral279" rel="1" rev="95" score="1" target="time" unit="duration"/>
+    <level _seq="89" _title="Tinker, Tailor" _xpath="./andreas46_3" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas46" rel="4" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="90" _title="Elbow Society" _xpath="./andreas45_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas45" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="91" _title="Watchmaker" _xpath="./huesing01_1" author="Johannes H?sing" ctrl="force" easy="false" id="huesing01" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="92" _title="Map it out II" _xpath="./manuel01_1" author="Manuel Eisentraut" ctrl="force" easy="true" id="manuel01" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="93" _title="Underground Temple" _xpath="./joe12_2" author="Joseph Dunne" ctrl="force" easy="true" id="joe_12" rel="2" rev="0" score="2" target="time" unit="duration"/>
+    <level _seq="94" _title="Mountain Climbing III" _xpath="./joe26_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe26" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="95" _title="Recover the Stone" _xpath="./joe28_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe28" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="96" _title="Pick-Up" _xpath="./joe27_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe27" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="97" _title="A Kind of Magic" _xpath="./just37_1" author="JuSt" ctrl="force" easy="true" id="JuStA Kind of Magic" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="98" _title="Blue Screen Of Death" _xpath="./pulley10_2" author="Mark Pulley" ctrl="force" easy="true" id="pulley10" rel="2" rev="1" score="2" target="time" unit="duration"/>
+    <level _seq="99" _title="Audience in Venice" _xpath="./mecke09_1" author="mecke" ctrl="force" easy="true" id="mecke9" rel="1" rev="20" score="1" target="time" unit="duration"/>
+    <level _seq="100" _title="Black Liberation" _xpath="./mecke11_1" author="mecke" ctrl="force" easy="true" id="mecke11" rel="1" rev="25" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Added: trunk/data/levels/enigma_vii/joe12_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/joe12_2.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/joe12_2.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,213 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Underground Temple" el:subtitle="" el:id="joe_12"/>
+      <el:version el:score="2" el:release="2" el:revision="0" el:status="released"/>
+      <el:author  el:name="Joseph Dunne" el:email="josephdunne1993 at hotmail.com" el:homepage=""/>
+      <el:copyright>Copyright ? 2006 Joseph Dunne</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.00">
+       <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+cells={}
+cells[" "]=cell{floor="fl-sahara"}
+cells["."]=cell{floor="fl-sand"}
+cells["'"]=cell{floor="fl-metal"}
+cells["`"]=cell{floor="fl-red"}
+cells[","]=cell{floor="fl-leaves"}
+cells["-"]=cell{floor="fl-space"}
+cells[":"]=cell{floor="fl-water"}
+cells["w"]=cell{floor="fl-gradient2"}
+cells["y"]=cell{floor="fl-gradient7"}
+cells["d"]=cell{floor="fl-gradient3"}
+cells["n"]=cell{floor="fl-gradient5"}
+cells["x"]=cell{floor="fl-gradient1"}
+cells["v"]=cell{floor="fl-gradient6"}
+cells["a"]=cell{floor="fl-gradient4"}
+cells["r"]=cell{floor="fl-gradient8"}
+cells["e"]=cell{floor="fl-gradient10"}
+cells["c"]=cell{floor="fl-gradient9"}
+cells["z"]=cell{floor="fl-gradient11"}
+cells["q"]=cell{floor="fl-gradient12"}
+cells["0"]=cell{floor="fl-abyss"}
+cells["f"]=cell{stone="st-puzzle-w"}
+cells["b"]=cell{stone="st-puzzle-s"}
+cells["h"]=cell{stone="st-puzzle-e"}
+cells["t"]=cell{stone="st-puzzle-n"}
+cells["W"]=cell{stone="st-puzzle2-n"}
+cells["R"]=cell{stone="st-puzzle2-ns"}
+cells["V"]=cell{stone="st-puzzle2-ew"}
+cells["A"]=cell{stone="st-puzzle2-w"}
+cells["X"]=cell{stone="st-puzzle2-s"}
+cells["D"]=cell{stone="st-puzzle2-e"}
+cells["Q"]=cell{stone="st-puzzle2-nw"}
+cells["Z"]=cell{stone="st-puzzle2-sw"}
+cells["C"]=cell{stone="st-puzzle2-es"}
+cells["E"]=cell{stone="st-puzzle2-ne"}
+cells["F"]=cell{stone="st-puzzle2-nsw"}
+cells["B"]=cell{stone="st-puzzle2-esw"}
+cells["H"]=cell{stone="st-puzzle2-nes"}
+cells["T"]=cell{stone="st-puzzle2-new"}
+cells["S"]=cell{stone="st-puzzle2-nesw"}
+cells["&"]=cell{stone="st-yellow"}
+cells["@"]=cell{stone="st-metal"}
+cells["!"]=cell{stone="st-bolder-e"}
+cells["{"]=cell{stone="st-stoneimpulse"}
+cells["#"]=cell{stone="st-blue-sand"}
+cells["%"]=cell{stone="st-brick"}
+cells[">"]=cell{stone="st-oneway-e"}
+cells["<"]=cell{stone="st-oneway-w"}
+cells[")"]=cell{stone="st-oneway_black-e"}
+cells["~"]=cell{stone="st-oneway_black-w"}
+cells["("]=cell{stone="st-oneway_white-w"}
+cells["I"]=cell{stone="st-blocker"}
+cells["7"]=cell{stone="st-oxyd"}
+cells["$"]=cell{stone="st-wood"}
+cells["*"]=cell{stone="st-break_gray"}
+cells["o"]=cell{actor={"ac-blackball", {player=0}}}
+cells["p"]=cell{actor={"ac-whiteball", {player=1}}}
+cells["}"]=cell{actor="ac-whiteball"}
+cells["+"]=cell{item="it-hollow"}
+cells["m"]=cell{item="it-magicwand"}
+cells["]"]=cell{item="it-yinyang"}
+cells["="]=cell{item="it-dynamite"}
+cells["/"]=cell{item="it-hammer"}
+cells["1"]=cell{item={"it-vortex-open", {targetx="43.5", targety="22.5"}}}
+cells["2"]=cell{item={"it-vortex-open", {targetx="73.5", targety="22.5"}}}
+cells["3"]=cell{item={"it-vortex-open", {targetx="2.5", targety="1.5"}}}
+cells["4"]=cell{item={"it-vortex-open", {targetx="2.5", targety="14.5"}}}
+cells["5"]=cell{item={"it-vortex-open", {targetx="2.5", targety="14.5"}}}
+cells["6"]=cell{item={"it-vortex-open", {targetx="2.5", targety="14.5"}}}
+cells["9"]=cell{item={"it-document", {text="'We are outside a recently discovered temple underneath the Simpson Desert'"}}}
+cells["8"]=cell{item={"it-document", {text="'It appears that we have found a magic hammer of some kind, i say we report back to camp'"}}}
+cells["_"]=cell{item={"it-document", {text=":All Delicate Objects Inside Here:"}}}
+cells["^"]=cell{item={"it-document", {text="'So have you found anything yet?'"}}}
+
+
+if difficult then
+ -- Normal Mode
+level = {
+"####################000000000000000000000000000000000000000000000000000000000",
+"#6 # ~nxxxxxxxxxxxv#000000000000000000000000000000000000000000000000000000000",
+"## $ (d           a#000000000000000000000000000000000000000000000000000000000",
+"##   #ywwwwwe     a#000000000000000000000000000000000000000000000000000000000",
+"####:#&&&&&&d     a#0000000000000000000&&&&&&&0000000000000000000000000000000",
+"#  ( )     {d  /  a#0000000000000000000& V   &0000000000000000000000000000000",
+"#  &{{  V  {d  8  a#0000000000000000000& VDR &0000000000000000000000000000000",
+"#     VQRCV&d     a#0000000000000000000& R]H &0000000000000000000000000000000",
+"#     RDQXV&d     a#0000000000000000000&QZZE &0000000000000000000000000000000",
+"# ]  RVCVQD&d     a#0000000000000000000&     &0000000000000000000000000000000",
+"#     RZVEV&d     a#0000000000000000000&&& &&&0000000000000000000000000000000",
+"#     RFEVZ)ywwwwwr#000000000000000000000& &000000000000000000000000000000000",
+"####{{##############000000000000000000000&:&000000000000000000000000000000000",
+"#nxxxxxxxxxxxxxxxxv#00000000000000000000&&:&@@@@@@@@@@@00000&&&&&&&&&&&&&0000",
+"#d                a#00000000000000000000&III         !@00000&      :    &0000",
+"#d   qwe          a#00000000000000000000&& @@@@@@@@@::@00000& QCRB &    &0000",
+"#d   a1d          a#000000000000000000000@:@@@@@@@@@::@00000& QCFZ &  m &0000",
+"#d   zxc          a#000000000000000000000@ :  @@@@@@::@00000& WE$E &    &0000",
+"#d         qwwwe  a#000000000000000000000@:$hf@   b : @@0000& EADR &&&&&&&&&0",
+"#d         aqwed  a#000000000000000000000{ :: @{$ t::${@0000& DFZX &VEBHC  &0",
+"#d    qwe  aa3dd  a#000000000000000000000{  hf $@   {$ @0000&      :TB$BHV &0",
+"#d    a2d  azxcd  a#000000000000000000000 at hfb   { ::@  @0000&&&&&&&&TFAFQ  &0",
+"#d    zxc  zxxxc  a#000000000000000000000 at 4 t     ::   @00000000000&      5&0",
+"#ywwwwwwwe qwwwwwwr#000000000000000000000@@{{@@{{{@@@@@@00000000000&&&&&&&&&0",
+"##########w#########000000000000000000000000000000000000000000000000000000000",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+"##########w#########.........................................................",
+"#,,,,,,,,,,,,,,,,,,#.........................................................",
+"#,,,,,,,,,,,,,,,,,,#.........................................................",
+"#,,,,,,,,,...,....,#.........................................................",
+"#,,,,,,,...........#.........................................................",
+"#,,,,,,...&&&&&&&&.#.........................................................",
+"#,.,,.,,..>,,,,o}&.#.........................................................",
+"#.........<,,9p,^&.#.........................................................",
+"#..._.....&&&&&&&&.#.........................................................",
+"####*#.,,..........#.........................................................",
+"#    #..,,..,,...,,#.........................................................",
+"#7777#..,,,,,,,,,,,#.........................................................",
+"####################.........................................................",
+}
+else
+ -- Easy Mode
+level = {
+"####################000000000000000000000000000000000000000000000000000000000",
+"#6 # ~nxxxxxxxxxxxv#000000000000000000000000000000000000000000000000000000000",
+"## $ (d           a#000000000000000000000000000000000000000000000000000000000",
+"##   #ywwwwwe     a#000000000000000000000000000000000000000000000000000000000",
+"####:#&&&&&&d     a#0000000000000000000&&&&&&&0000000000000000000000000000000",
+"#  ( )     &d  /  a#0000000000000000000&     &0000000000000000000000000000000",
+"#  &&&     &d  8  a#0000000000000000000& CQR &0000000000000000000000000000000",
+"#     VQRCV&d     a#0000000000000000000& R]V &0000000000000000000000000000000",
+"#  ]  RRAVV&d     a#0000000000000000000& VZE &0000000000000000000000000000000",
+"#     VCVQD&d     a#0000000000000000000&     &0000000000000000000000000000000",
+"#     RZVEV&d     a#0000000000000000000&&& &&&0000000000000000000000000000000",
+"#     RREVZ)ywwwwwr#000000000000000000000& &000000000000000000000000000000000",
+"####################000000000000000000000&:&000000000000000000000000000000000",
+"#nxxxxxxxxxxxxxxxxv#00000000000000000000&&:&@@@@@@@@@@@00000&&&&&&&&&&&&&0000",
+"#d                a#00000000000000000000&III         !@00000&      :    &0000",
+"#d   qwe          a#00000000000000000000&& @@@@@@@@@::@00000& QCRB &    &0000",
+"#d   a1d          a#000000000000000000000@:@@@@@@@@@::@00000& QCFZ &  m &0000",
+"#d   zxc          a#000000000000000000000@ :  @@@@@@::@00000& WE$E &    &0000",
+"#d         qwwwe  a#000000000000000000000@:$hf@   b : @@0000& EADR &&&&&&&&&0",
+"#d         aqwed  a#000000000000000000000{ :: @{$ t::${@0000& DFZX &VEZHC  &0",
+"#d    qwe  aa3dd  a#000000000000000000000{  hf $@   {$ @0000&      :TB$BH  &0",
+"#d    a2d  azxcd  a#000000000000000000000 at hfb   { ::@  @0000&&&&&&&&TFVFQ  &0",
+"#d    zxc  zxxxc  a#000000000000000000000 at 4 t     ::   @00000000000&      5&0",
+"#ywwwwwwwe qwwwwwwr#000000000000000000000@@{{@@{{{@@@@@@00000000000&&&&&&&&&0",
+"##########w#########000000000000000000000000000000000000000000000000000000000",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+".........#w#.................................................................",
+"##########w#########.........................................................",
+"#,,,,,,,,,,,,,,,,,,#.........................................................",
+"#,,,,,,,,,,,,,,,,,,#.........................................................",
+"#,,,,,,,,,...,....,#.........................................................",
+"#,,,,,,,...........#.........................................................",
+"#,,,,,,...&&&&&&&&.#.........................................................",
+"#,.,,.,,..>,,,,o}&.#.........................................................",
+"#.........<,,9p,^&.#.........................................................",
+"#..._.....&&&&&&&&.#.........................................................",
+"####*#.,,..........#.........................................................",
+"#    #..,,..,,...,,#.........................................................",
+"#7777#..,,,,,,,,,,,#.........................................................",
+"####################.........................................................",
+}
+end
+
+set_default_parent(cells[" "])
+create_world_by_map(level,cells)
+oxyd_shuffle()
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_vii/joe12_2.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_vii/joe26_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/joe26_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/joe26_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,355 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Mountain Climbing III" el:subtitle="" el:id="joe26"/>
+      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
+      <el:author  el:name="Joseph Dunne" el:email="josephdunne1993 at hotmail.com" el:homepage=""/>
+      <el:copyright>Copyright ? 2006 Joseph Dunne</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.00">
+       <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+cells={}
+cells[" "]=cell{floor="fl-darkgray"}
+cells["!"]=cell{floor="fl-red"}
+cells["`"]=cell{floor="fl-lightgray"}
+cells["'"]=cell{floor="fl-light"}
+cells["w"]=cell{floor="fl-gradient2"}
+cells["y"]=cell{floor="fl-gradient7"}
+cells["d"]=cell{floor="fl-gradient3"}
+cells["n"]=cell{floor="fl-gradient5"}
+cells["x"]=cell{floor="fl-gradient1"}
+cells["v"]=cell{floor="fl-gradient6"}
+cells["a"]=cell{floor="fl-gradient4"}
+cells["r"]=cell{floor="fl-gradient8"}
+cells["e"]=cell{floor="fl-gradient10"}
+cells["c"]=cell{floor="fl-gradient9"}
+cells["z"]=cell{floor="fl-gradient11"}
+cells["q"]=cell{floor="fl-gradient12"}
+cells["G"]=cell{stone="st-puzzle-hollow"}
+cells["W"]=cell{stone="st-puzzle-n"}
+cells["R"]=cell{stone="st-puzzle-ns"}
+cells["V"]=cell{stone="st-puzzle-ew"}
+cells["A"]=cell{stone="st-puzzle-w"}
+cells["X"]=cell{stone="st-puzzle-s"}
+cells["D"]=cell{stone="st-puzzle-e"}
+cells["Q"]=cell{stone="st-puzzle-nw"}
+cells["Z"]=cell{stone="st-puzzle-sw"}
+cells["C"]=cell{stone="st-puzzle-es"}
+cells["E"]=cell{stone="st-puzzle-ne"}
+cells["F"]=cell{stone="st-puzzle-nsw"}
+cells["B"]=cell{stone="st-puzzle-esw"}
+cells["H"]=cell{stone="st-puzzle-nes"}
+cells["T"]=cell{stone="st-puzzle-new"}
+cells["S"]=cell{stone="st-puzzle-nesw"}
+cells["0"]=cell{floor="fl-abyss"}
+cells["&"]=cell{stone="st-wood_001"}
+cells["#"]=cell{stone="st-rock4"}
+cells["$"]=cell{stone="st-wood"}
+cells["@"]=cell{stone="st-rock5"}
+cells["%"]=cell{stone="st-rock10"}
+cells["8"]=cell{stone="st-oneway-n"}
+cells["2"]=cell{stone="st-oneway-s"}
+cells["6"]=cell{stone="st-oneway-e"}
+cells["4"]=cell{stone="st-oneway-w"}
+cells["<"]=cell{stone="st-white1"}
+cells[">"]=cell{stone="st-white4"}
+cells["o"]=cell{actor={"ac-whiteball-small", {player=0}}}
+cells["+"]=cell{item="it-hollow"}
+cells[":"]=cell{item="it-extralife"}
+
+if difficult then
+ -- Normal Mode
+ level = {
+"00000000000000000000",
+"0!000!0!0!!!!0!!!!00",
+"0!!00!000!0000!00000",
+"0!0!0!0!0!0000!!!!00",
+"0!00!!0!0!0000!00000",
+"0!000!0!0!!!!0!!!!00",
+"00000000000000000000",
+"000000&&&&&&&&000000",
+"000000&+'`'`+&&&&&&&",
+"000000&'`'`'`'`'`'`&",
+"000000&`'`'`'`'`'`'&",
+"000000&&&&&&&&&&&'`&",
+"0000000000000000&&'&",
+"00000000000000000  0",
+"00000000000000000$20",
+"000000&0000000000''0",
+"00000qr`'` `'4 4' `0",
+"0000&r `'` `'`4`'` 0",
+"00000``0000000000000",
+"00000''0000000000000",
+"00000``0000000000000",
+"000002 0000000000000",
+"0000&`2&000000000000",
+"0000&''&000000000000",
+"&&&&&  &&&&&&&&&&&&&",
+"&nv0   qwwww0nv 000&",
+"&daqwweaqwwedyrnxv0&",
+"&dazxxcaa&0dd00d a0&",
+"&da0 00aa&0dd00d a0&",
+"&da0 & azxxcd  d a &",
+"&dzxv  zxxxxcnvywr &",
+"&ywwr&000000&yr00  &",
+"&&&&&&&&&&&&&00&&&&&",
+"#############$$#####",
+"#######     $00$   #",
+"#######88########88#",
+"#00000#nv########  #",
+"#000000da0######0qe#",
+"##0##0#da0###0###ad0",
+"#nxxxxxca##nvqwwead#",
+"#dqwwwwwr##yrzxxczc#",
+"#da0#0#00##qe0###0##",
+"#da#0######zc##0####",
+"#dzxxxxxv##qwe qe  #",
+"#ywwwwwwr##zxc zc  #",
+"####### ######### ##",
+"`@      @``@      @`",
+"`@888888@``@888888@`",
+"0044644>0000>6448600",
+"0062288>0000>4468200",
+"008>>>>>0000>2620800",
+"000088220000>6682200",
+"000086000000>6244800",
+"006>>>420000>>>>2400",
+"00444>4600008200>200",
+"00682>6200006800>800",
+"00068>8800004602>400",
+"00866>4200004286>600",
+"004>>>8600008%46>400",
+"006>624800002286>200",
+"002>62%800004048>800",
+"004>480400006628>400",
+"006>862400004682>600",
+"002>>>42000086>>>800",
+"00682>46000024>24200",
+"00846>86000064>84200",
+"00868>42000068>62800",
+"00080000000008000000",
+"`@      @``@      @`",
+"`@nxxxxv@``@nxxxxv@`",
+"`@ywwwwr@``@ywwwwr@`",
+"`@888888@``@888888@`",
+"0#0aaaaa#00#%ddd#0#0",
+"0#0aaaaa#00#%ddd#0#0",
+"0#0#aaa%#00#ddddf0#0",
+"0#0#aaa%#00#ddddd0#0",
+"0#0aaaaa#00#%ddd#0#0",
+"0#0aaaaa#00#%ddd#0#0",
+"0#0#aaa%#00#ddddd0#0",
+"0#0#aaa%#00#ddddd0#0",
+"0#0aaaaa#00#ddddd0#0",
+"0###  ###00###  ###0",
+"`@ 2222 @``@ 2222 @`",
+"`@      @``@      @`",
+"`@888888@``@888888@`",
+"0#nxxxxv#00#nxxxxv#0",
+"0#dnxxva#00#dnxxva#0",
+"0#%d00a%#00#%d00a%#0",
+"0#dywwra#00#dywwra#0",
+"0#ywwwwr#00#ywwwwr#0",
+"0#>0<<><#00#<<< >>#0",
+"0#<> < 0#00#0 %><>#0",
+"0#>%>%<>#00#><>>0<#0",
+"0#>><<><#00#<<>%>>#0",
+"0#<0<<%<#00#<0<>>%#0",
+"0#<  <><#00#>><<> #0",
+"0#      #00#      #0",
+"0# > %> #00#0><0<<#0",
+"0#<0<> 0#00#< %><>#0",
+"0#%>  < #00#>> 0<%#0",
+"0#><%0%>#00#0<  >%#0",
+"0##>> < #00#<<%><##0",
+"0#d #<0 #00#  <# a#0",
+"0#w##############w#0",
+"0#waaaaa4ad6dddddw#0",
+"0#@%@%@%@  @%@%@%@#0",
+"0#%@%@%@%  %@%@%@%#0",
+"0######### ########0",
+"000000000#0#00000000",
+"000#######0######000",
+"000####%        #000",
+"000###%%'%0%    #000",
+"000###%''''%#####000",
+"000##%%''X''  #00000",
+"000##%22DSZ'$ #00000",
+"000#    'HF'% #00000",
+"000# #6$'HF$%####000",
+"000#   %%EQ'%   #000",
+"000#      %%%   #000",
+"000######     # #000",
+"00000000#  #### #000",
+"00000000%%%%00# #000",
+"00000000#  #### #000",
+"00000000#       #000",
+"00000000#  ######000",
+"00000000%''%00000000",
+"0####@###nv###@####0",
+"0#qwe`nxxczxxv`qwe#0",
+"0#zxc`ywwwwwwr`zxc#0",
+"0#:##@########@##:#0",
+"0#o#000000000000#o#0",
+"0###0!!!!!!!!!!0###0",
+"00000000000000000000",
+ }
+else
+ -- Easy Mode
+ level = {
+"00000000000000000000",
+"0!000!0!0!!!!0!!!!00",
+"0!!00!000!0000!00000",
+"0!0!0!0!0!0000!!!!00",
+"0!00!!0!0!0000!00000",
+"0!000!0!0!!!!0!!!!00",
+"00000000000000000000",
+"000000&&&&&&&&000000",
+"000000&+'`'`+&&&&&&&",
+"000000&'`'`'`'`'`'`&",
+"000000&`'`'`'`'`'`'&",
+"000000&&&&&&&&&&&'`&",
+"0000000000000000&`'&",
+"00000000000000000  0",
+"00000000000000000%`0",
+"00000000000000000''0",
+"00000  `'` `'` `' `0",
+"00000  `'` `'`%`'` 0",
+"00000``0000000000000",
+"00000''0000000000000",
+"00000``0000000000000",
+"000002 0000000000000",
+"0000&`2&000000000000",
+"0000&''&000000000000",
+"&&&&&  &&&&&&&&&&&&&",
+"&nv0   qwwww0   000&",
+"&daqwweaqwwed  nxv0&",
+"&dazxxcaa&0dd00d a0&",
+"&da0 00aa 0dd00d a0&",
+"&da0 & azxxcd  d a &",
+"&dzxv  zxxxxcnvywr &",
+"&ywwr&  0000&yr00  &",
+"&&&&&&&&&&&&&00&&&&&",
+"#############$$#####",
+"#######     $00$   #",
+"#######88########88#",
+"#00000#nv########  #",
+"#000000da0######0qe#",
+"##0##0#da####0###ad#",
+"#nxxxxxca##nvqwwead#",
+"#dqwwwwwr##yrzxxczc#",
+"#da0###00##qe####0##",
+"#da#0######zc##0####",
+"#dzxxxxxv##qwe qe  #",
+"#ywwwwwwr##zxc zc  #",
+"####### ######### ##",
+"`@      @``@      @`",
+"`@888888@``@888888@`",
+"0#4464>>#00#>>4486#0",
+"0#>>>>>>#00#>>4682#0",
+"0#>>>>>>#00#>>6208#0",
+"0#008822#00#>>6822#0",
+"0#008600#00#>>>>48#0",
+"0#>>>>42#00#>>>>24#0",
+"0#>>>>46#00#8200>>#0",
+"0#68>>62#00#6800>>#0",
+"0#06>>88#00#4602>>#0",
+"0#>>>>42#00#4286>>#0",
+"0#>>>>86#00#8%46>>#0",
+"0#>>6248#00#2286>>#0",
+"0#>>62%8#00#4048>>#0",
+"0#>>4804#00#6628>>#0",
+"0#>>8624#00#4682>>#0",
+"0#>>>>42#00#86>>>>#0",
+"0#>>>>46#00#24>>>>#0",
+"0#84>>86#00#64>>42#0",
+"0#86>>42#00#68>>28#0",
+"0#008800#00#008800#0",
+"`@      @``@      @`",
+"`@nxxxxv@``@nxxxxv@`",
+"`@ywwwwr@``@ywwwwr@`",
+"`@888888@``@888888@`",
+"0#0#aaaa#00#dddd#0#0",
+"0#0aaaaa#00#dddd#0#0",
+"0#0#aaaa#00#dddd#0#0",
+"0#0#aaaa#00#ddddd0#0",
+"0#0#aaaa#00#dddd#0#0",
+"0#0aaaaa#00#dddd#0#0",
+"0#0#aaaa#00#dddd#0#0",
+"0#0#aaaa#00#ddddd0#0",
+"0#0#aaaa#00#dddd#0#0",
+"0###  ###00###  ###0",
+"`@ 2222 @``@ 2222 @`",
+"`@      @``@      @`",
+"`@888888@``@888888@`",
+"0#nxxxxv#00#nxxxxv#0",
+"0#dnxxva#00#dnxxva#0",
+"0#dd00aa#00#dd00aa#0",
+"0#dywwra#00#dywwra#0",
+"0#ywwwwr#00#ywwwwr#0",
+"0#>0<<><#00#<<< >>#0",
+"0#<> < >#00#< %><>#0",
+"0#>>>%<>#00#><>>0<#0",
+"0#>><<><#00#<<>%>>#0",
+"0#<0<<%<#00#<0<>><#0",
+"0#<  <><#00#>><<> #0",
+"0#      #00#      #0",
+"0# > %> #00# ><0<<#0",
+"0#<0<>  #00#< %><>#0",
+"0#%>  < #00#>>  <%#0",
+"0#><%>%>#00#0<  >%#0",
+"0##>> < #00#<<%><##0",
+"0#d #<0 #00#  <# a#0",
+"0#w##############w#0",
+"0#waaaaa4ad6dddddw#0",
+"0#@%@%@%@  @%@%@%@#0",
+"0#%@%@%@%  %@%@%@%#0",
+"0########  ########0",
+"00000000#  #00000000",
+"000######  ######000",
+"000#            #000",
+"000#    #  #    #000",
+"000# ###%  %#####000",
+"000#    'CZ'  #00000",
+"000#####%HF%# #00000",
+"000#    'GG'  #00000",
+"000# ###%HF%#####000",
+"000#    #EQ#    #000",
+"000#            #000",
+"000######  #### #000",
+"00000000#  #00# #000",
+"00000000%%%%00# #000",
+"00000000#  #### #000",
+"00000000#       #000",
+"00000000#  ######000",
+"00000000%''%00000000",
+"0####@###nv###@####0",
+"0#qwe`nxxczxxv`qwe#0",
+"0#zxc`ywwwwwwr`zxc#0",
+"0#:##@########@##:#0",
+"0#o#000000000000#o#0",
+"0###000000000000###0",
+"00000000000000000000",
+ }
+end
+
+set_default_parent(cells[" "])
+create_world_by_map(level,cells)
+oxyd_shuffle()
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_vii/joe26_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_vii/joe27_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/joe27_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/joe27_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,113 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Pick-Up" el:subtitle="" el:id="joe27"/>
+      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
+      <el:author  el:name="Joseph Dunne" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 Joseph Dunne</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.00">
+       <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+cells={}
+stones={}
+
+stones[" "]=cell{}
+cells[" "]=cell{}
+
+cells[" "]=cell{floor="fl-sahara"}
+cells["0"]=cell{floor="fl-abyss"}
+
+stones["#"]=cell{stone="st-yellow"}
+stones["%"]=cell{stone="st-black1"}
+stones["G"]=cell{stone="st-puzzle-hollow"}
+stones["W"]=cell{stone="st-puzzle-n"}
+stones["R"]=cell{stone="st-puzzle-ns"}
+stones["V"]=cell{stone="st-puzzle-ew"}
+stones["A"]=cell{stone="st-puzzle-w"}
+stones["X"]=cell{stone="st-puzzle-s"}
+stones["D"]=cell{stone="st-puzzle-e"}
+stones["Q"]=cell{stone="st-puzzle-nw"}
+stones["Z"]=cell{stone="st-puzzle-sw"}
+stones["C"]=cell{stone="st-puzzle-es"}
+stones["E"]=cell{stone="st-puzzle-ne"}
+stones["F"]=cell{stone="st-puzzle-nsw"}
+stones["B"]=cell{stone="st-puzzle-esw"}
+stones["H"]=cell{stone="st-puzzle-nes"}
+stones["T"]=cell{stone="st-puzzle-new"}
+stones["S"]=cell{stone="st-puzzle-nesw"}
+
+level={"                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       " 000                ",
+       " 000                ",
+       " 000                ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    "}
+
+stmap={"####################",
+       "####################",
+       "####################",
+       "####################",
+       "#######CVVVVVZ######",
+       "#######R     R######",
+       "#######R   0 R######",
+       "#######R     R######",
+       "#######EVVVVVQ######",
+       "####################",
+       "####################",
+       "####################",
+       "#000################",
+       "0    #########     #",
+       "0   0########B     #",
+       "0                  #",
+       "#                  %",
+       "#                  %",
+       "#E   H      #      #",
+       "##%#####T###C      A",
+       "#      ###         #",
+       "#  Z               #",
+       "# S Q              #",
+       "#                  #",
+       "####################"}
+
+create_world_by_map(level)
+draw_map(0,0,stmap,stones)
+
+set_actor("ac-blackball",1.5,23.5,{player=0})
+set_item("it-vortex-closed",19,17,{name="vortex1",targetx="9.5",targety="6.5"})
+set_item("it-vortex-open",8,6,{targetx="18.5",targety="15.5"})
+set_stone("st-switch",4,13,{action="openclose",target="vortex1"})
+
+oxyd_shuffle()
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_vii/joe27_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_vii/joe28_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/joe28_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/joe28_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,90 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Recover the Stone" el:subtitle="" el:id="joe28"/>
+      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
+      <el:author  el:name="Joseph Dunne" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 Joseph Dunne</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.00">
+       <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+cells={}
+stones={}
+
+stones[" "]=cell{}
+cells[" "]=cell{}
+
+cells[" "]=cell{floor="fl-black"}
+cells["0"]=cell{floor="fl-abyss"}
+
+stones["#"]=cell{stone="st-likeoxydc-open"}
+stones["!"]=cell{stone="st-oxyd"}
+stones["$"]=cell{stone="st-wood"}
+stones["%"]=cell{stone="st-grate2"}
+stones["W"]=cell{stone="st-puzzle-n"}
+stones["A"]=cell{stone="st-puzzle-w"}
+stones["X"]=cell{stone="st-puzzle-s"}
+stones["D"]=cell{stone="st-puzzle-e"}
+stones["C"]=cell{stone="st-puzzle-es"}
+stones["G"]=cell{stone="st-turnstile"}
+stones["T"]=cell{stone="st-turnstile-s"}
+stones["H"]=cell{stone="st-turnstile-w"}
+stones["B"]=cell{stone="st-turnstile-n"}
+stones["F"]=cell{stone="st-turnstile-e"}
+
+level={"                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "                    ",
+       "         0000       ",
+       "          000       ",
+       "         0000       ",
+       "                    "}
+
+stmap={"####################",
+       "#        G B    ####",
+       "#        T G    ####",
+       "#       GF T    ####",
+       "#       T G     ####",
+       "###%#     T     ####",
+       "#   ################",
+       "#   ###  #  ########",
+       "###%#    #  #   ####",
+       "#     X         ####",
+       "# CA  W   W     ####",
+       "#               ####",
+       "####################"}
+
+create_world_by_map(level)
+draw_map(0,0,stmap,stones)
+
+set_actor("ac-blackball",3.5,6.5,{player=0})
+set_stone("st-oxyd",1,6)
+set_stone("st-oxyd",1,7)
+set_stone("st-door_c",2,6,{name="door1"})
+set_stone("st-door_c",2,7,{name="door2"})
+set_stone("st-shogun-s",14,4)
+set_stone("st-shogun-s",11,8)
+set_item("it-shogun-s",1,4,{action="openclose",target="door1"})
+set_item("it-shogun-s",1,9,{action="openclose",target="door2"})
+
+oxyd_shuffle()
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="true"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_vii/joe28_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/data/levels/enigma_vii/just23_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/just23_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/just23_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -17,7 +17,7 @@
      <el:score el:easy="-" el:difficult="-"/>
     </el:info>
     <el:luamain><![CDATA[
-enigma.ConserveLevel = 0
+enigma.ConserveLevel = FALSE
 
 create_world(191, 97)
 oxyd_default_flavor="b"
@@ -250,7 +250,7 @@
     set_item("it-document", 61, 74, {text="text15"})
     set_item("it-document", 5, 57, {text="text15"})
     set_item("it-document", 66, 25, {text="text15"})
-    set_item("it-document", 151,53, {text="text16"})
+    set_item("it-document", 151,53, {text=">"})
 end
 
 function random_hole()
@@ -893,6 +893,22 @@
 set_item("it-umbrella", 134, 85)
 set_item("it-umbrella", 110, 50)
 set_item("it-glasses", 140, 38)
+draw_items("it-cross", {114, 60}, {1, 0}, 9)
+draw_items("it-cross", {124, 60}, {1, 0}, 10)
+draw_items("it-cross", {114, 61}, {0, 1}, 5)
+draw_items("it-cross", {133, 61}, {0, 1}, 12)
+draw_items("it-cross", {118, 63}, {1, 0}, 2)
+set_item("it-cross", 117, 64)
+draw_items("it-cross", {120, 64}, {1, 1}, 3)
+draw_items("it-cross", {122, 65}, {1, 1}, 2)
+draw_items("it-cross", {127, 65}, {1, 1}, 4)
+draw_items("it-cross", {128, 65}, {-1, 1}, 2)
+draw_items("it-cross", {132, 65}, {0, 1}, 3)
+draw_items("it-cross", {124, 66}, {1, 0}, 2)
+draw_items("it-cross", {114, 67}, {0, 1}, 6)
+set_item("it-cross", 125, 67)
+set_item("it-cross", 131, 68)
+draw_items("it-cross", {115, 72}, {1, 0}, 18)
 set_item("it-shogun-s", 83, 74, {target="door12", action="openclose"})
 set_item("it-shogun-s", 84, 80, {target="door11", action="openclose"})
 set_item("it-trigger", 132, 37, {action="callback", target="door_99_f1", invisible=false})
@@ -1731,7 +1747,7 @@
 set_stone("st-key_c", 34, 74, {action="openclose", target="door5"})
 set_stone("st-door_b", 35, 74, {name="door5"})
 set_stone("st-laser", 18, 77, {name="laser50", dir=WEST, on="0"})
-set_stone("st-timer", 143, 78, {action="callback", target="start_timing", interval="2", name="timer1"})
+set_stone("st-timer", 143, 78, {action="callback", target="start_timing", interval="2", name="timer1", loop="1"})
 set_stone("st-laser", 18, 80, {name="laser51", dir=WEST, on="0"})
 set_stones("st-oxyd", {{149, 89}, {149, 91}})
 set_stone("st-actorimpulse_invisible", 32, 19)
@@ -1863,6 +1879,10 @@
 fire()
 documents()
 oxyd_shuffle()
+
+-- for tests only
+
+
   ]]></el:luamain>
     <el:i18n>
      <el:string el:key="title">
@@ -1927,9 +1947,6 @@
      <el:string el:key="text15">
        <el:english el:translate="true">Useful things may also be hidden!</el:english>
        <el:translation el:lang="de">N?tzliche Sachen k?nnen auch versteckt sein!</el:translation>    
-     </el:string>
-     <el:string el:key="text16">
-       <el:english el:translate="false">&gt;</el:english>
      </el:string> 
    </el:i18n>
   </el:protected>

Added: trunk/data/levels/enigma_vii/just37_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/just37_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/just37_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,117 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="A Kind of Magic" el:subtitle="" el:id="JuStA Kind of Magic"/>
+      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
+      <el:author  el:name="JuSt" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2007 JuSt</el:copyright>
+      <el:license el:type="GPL version 2" el:open="true"/>
+      <el:compatibility el:enigma="1.0">
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:score el:easy="3:01" el:difficult="5:34"/>
+    </el:info>
+    <el:luamain><![CDATA[
+levelw=20
+levelh=13
+
+create_world( levelw, levelh)
+enigma.ConserveLevel=FALSE
+
+fill_floor("fl-woven")
+
+draw_border("st-woven")
+
+set_stone("st-oxyd", 00, 11, {flavor="a", color="3"})
+set_stone("st-woven", 01, 01)
+set_stone("st-woven", 01, 07)
+set_stone("st-turnstile-w", 01, 10)
+set_stone("st-oxyd", 01, 12, {flavor="a", color="3"})
+set_stone("st-woven", 02, 03)
+set_stone("st-woven", 02, 07)
+set_stone("st-turnstile-green", 02, 10)
+set_stone("st-woven", 02, 11)
+set_stone("st-turnstile-w", 03, 04)
+set_stone("st-woven", 03, 05)
+set_stone("st-woven", 03, 07)
+set_stone("st-woven", 04, 02)
+set_stone("st-turnstile-n", 04, 03)
+set_stone("st-turnstile-green", 04, 04)
+set_stone("st-woven", 04, 08)
+set_stone("st-woven", 05, 01)
+set_stone("st-turnstile-e", 05, 04)
+set_stone("st-woven", 05, 06)
+set_stone("st-woven", 05, 09)
+set_stone("st-woven", 05, 11)
+set_stone("st-woven", 06, 02)
+set_stone("st-woven", 06, 04)
+set_stone("st-oneway_black-e", 06, 05)
+set_stone("st-oneway_black-n", 06, 06)
+set_stone("st-woven", 07, 06)
+set_stone("st-woven", 07, 07)
+set_stone("st-woven", 07, 08)
+set_stone("st-woven", 07, 11)
+set_stone("st-turnstile-w", 08, 07)
+set_stone("st-woven", 08, 10)
+set_stone("st-woven", 09, 01)
+set_stone("st-turnstile-w", 09, 03)
+set_stone("st-turnstile-n", 09, 06)
+set_stone("st-turnstile-green", 09, 07)
+set_stone("st-turnstile-s", 09, 08)
+set_stone("st-woven", 09, 10)
+set_stone("st-woven", 09, 11)
+set_stone("st-turnstile-n", 10, 02)
+set_stone("st-turnstile-green", 10, 03)
+set_stone("st-turnstile-s", 10, 04)
+set_stone("st-rotator-left", 10, 05)
+set_stone("st-turnstile-e", 10, 07)
+set_stone("st-turnstile-n", 10, 09)
+set_stone("st-turnstile-green", 10, 10)
+set_stone("st-woven", 11, 01)
+set_stone("st-turnstile-e", 11, 03)
+set_stone("st-turnstile-w", 11, 05)
+set_stone("st-woven", 11, 07)
+set_stone("st-turnstile-e", 11, 10)
+set_stone("st-turnstile-n", 12, 04)
+set_stone("st-turnstile-green", 12, 05)
+set_stone("st-woven", 12, 07)
+set_stone("st-turnstile-e", 13, 05)
+set_stone("st-woven", 13, 07)
+set_stone("st-turnstile-n", 13, 08)
+set_stone("st-turnstile-green", 13, 09)
+set_stone("st-woven", 13, 10)
+set_stone("st-woven", 13, 11)
+set_stone("st-oneway_black-e", 14, 06)
+set_stone("st-turnstile-e", 14, 09)
+set_stone("st-swap", 15, 02)
+set_stone("st-woven", 15, 09)
+set_stone("st-woven", 15, 10)
+set_stone("st-woven", 16, 03)
+set_stone("st-woven", 16, 04)
+set_stone("st-turnstile-n", 16, 07)
+set_stone("st-turnstile-green", 16, 08)
+set_stone("st-woven", 16, 10)
+set_stone("st-turnstile-n", 17, 01)
+set_stone("st-turnstile-green", 17, 02)
+set_stone("st-woven", 17, 06)
+set_stone("st-woven", 17, 08)
+set_stone("st-woven", 17, 09)
+set_stone("st-woven", 17, 10)
+set_stone("st-turnstile-e", 18, 02)
+set_stone("st-woven", 18, 06)
+if difficult then
+	set_stone("st-pull", 18, 11)
+else
+	set_stone("st-brake", 18, 11)
+end
+set_actor("ac-blackball", 18.5, 01.5)
+oxyd_shuffle()
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="true"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_vii/just37_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_vii/manuel01_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/manuel01_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/manuel01_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,465 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+ <el:protected>
+ <el:info el:type="level">
+  <el:identity el:title="Map it out II" el:subtitle="4D Confusion ..." el:id="manuel01"/>
+  <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
+  <el:author el:name="Manuel Eisentraut" el:email="" el:homepage=""/>
+  <el:copyright>Copyright ? 2006 Manuel Eisentraut </el:copyright>
+  <el:license el:type="GPL v2.0 or above" el:open="true"/>
+  <el:compatibility el:enigma="1.01"/>
+  <el:modes el:easy="true" el:single="true" el:network="false"/>
+  <el:score el:easy="3:10" el:difficult="5:12"/>
+ </el:info>
+ <el:luamain><![CDATA[
+rooms_wide=19
+rooms_high=1
+
+levelw=1+(19*rooms_wide)
+levelh=1+(12*rooms_high)
+
+create_world( levelw, levelh)
+enigma.ConserveLevel=FALSE
+
+fill_floor("fl-normal", 0,0,levelw,levelh)
+
+function renderline( line, pattern)
+ for i=1, strlen(pattern) do
+  local c = strsub( pattern, i, i)
+  if c=="#" then
+   set_stone("st-rock6", i-1, line)
+  elseif c=="!" then
+   abyss(i-1,line)
+  elseif c=="A" then
+   set_item("it-wormhole", i-1, line, {strength=0,targetx="9.5",targety="6.5"})
+  elseif c=="B" then
+   set_item("it-wormhole", i-1, line, {strength=0,targetx="351.5",targety="6.5"})
+  elseif c=="1" then
+   set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="richtung1"})
+  elseif c=="2" then
+   set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="richtung2"})
+  elseif c=="3" then
+   set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="richtung3"})
+  elseif c=="4" then
+   set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="richtung4"})
+  elseif c=="5" then
+   set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="richtung5"})
+  elseif c=="6" then
+   set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="richtung6"})
+  elseif c=="7" then
+   set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="richtung7"})
+  elseif c=="8" then
+   set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="richtung8"})
+  elseif c=="x" then
+   set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="stoprichtung"})
+  elseif c==" " then
+   set_item("it-trigger",i-1,line,{invisible=1})
+  elseif c=="o" then
+   set_stone("st-oxyd", i-1, line,{color="0"})
+  elseif c=="Q" then
+   set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="ziehe"})
+  elseif c=="S" then
+   set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="zieheA"})
+  elseif c=="s" then
+   set_item("it-trigger",i-1,line,{invisible=1,action="callback",target="zieheB"})
+  elseif c=="." then
+   set_actor("ac-blackball",i-.5,line+.5,{name="b1",player=0})
+   if difficult then
+    document(i-1,line,"text1") 
+   else
+    document(i-1,line,"text2")
+   end
+  end
+ end
+end
+
+renderline(00,"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!")
+renderline(01,"!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!")
+renderline(02,"!!!!#B ##,## B#!!!!!!!!#A ##A## A#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#A ##A## A#!!!!!")
+renderline(03,"!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!!!!# 8 #1# 2 #!!!!!")
+renderline(04,"!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!")
+renderline(05,"!!!!###     ###!!!!!!!!###     ###!!!!!!!!###  o  ###!!!!!!!!###   o ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!### o   ###!!!!!!!!###  o  ###!!!!!!!!###   o ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!### o   ###!!!!!!!!###     ###!!!!!")
+renderline(06,"!!!!#B7x S x3B#!!!!!!!!#A7x . x3A#!!!!!!!!#,7x Q x3,#!!!!!!!!#,7x Q x3,#!!!!!!!!#,7x Qox3,#!!!!!!!!#,7x Q x3,#!!!!!!!!#,7x Q x3,#!!!!!!!!#,7x Q x3,#!!!!!!!!#,7xoQ x3,#!!!!!!!!#,7x Q x3,#!!!!!!!!#,7x Q x3,#!!!!!!!!#,7x Q x3,#!!!!!!!!#,7x Qox3,#!!!!!!!!#,7x Q x3,#!!!!!!!!#,7x Q x3,#!!!!!!!!#,7x Q x3,#!!!!!!!!#,7xoQ x3,#!!!!!!!!#,7x Q x3,#!!!!!!!!#A7x s x3A#!!!!!")
+renderline(07,"!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###   o ###!!!!!!!!###  o  ###!!!!!!!!### o   ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###   o ###!!!!!!!!###  o  ###!!!!!!!!### o   ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!!!!###     ###!!!!!")
+renderline(08,"!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!!!!## x x x ##!!!!!")
+renderline(09,"!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!!!!# 6 #5# 4 #!!!!!")
+renderline(10,"!!!!#B ##,## B#!!!!!!!!#A ##A## A#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#, ##,## ,#!!!!!!!!#A ##A## A#!!!!!")
+renderline(11,"!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!!!!###########!!!!!")
+renderline(12,"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!")
+
+
+if difficult then
+ tab={
+ 1,1,0,1,1,1,1,1,0,1,0,0,1,1,1,1,0,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,
+ 1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,0,0,1,0,1,1,1,1,1,1,
+ 1,1,1,0,1,1,1,1,0,1,1,0,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,0,
+ 1,1,0,0,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,
+ 1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1,0,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,0,1,0,0,0,1,1,1,1,0,1,
+ 1,0,1,0,1,1,0,1,1,0,0,1,1,0,0,0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,0,0,1,1,0,1,1,1,0,1,1,
+ 0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,
+ 0,1,1,1,1,0,0,1,0,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,0,
+ 1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,
+ 0,0,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,0,1,1,1,1,1,0,1,0,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,
+ 1,0,0,0,1,0,1,1,1,0,1,1,0,1,1,0,1,1,1,0,0,1,1,1,1,1,1,1,0,1,1,0,0,1,0,1,1,1,0,1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,0,1,0,1,1,1,1,1,1,
+ 1,0,1,1,1,0,0,1,1,0,0,1,1,1,1,1,0,1,0,0,1,0,1,1,1,1,1,1,0,0,1,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,0,0,1,1,1,1,1,1,
+ 0,1,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,0,1,0,0,1,0,1,0,0,1,1,1,0,0,0,0,
+ 1,1,0,0,1,0,1,1,0,0,1,0,1,0,1,0,1,0,1,1,0,1,0,0,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,
+ 1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,1,1,
+ 1,1,1,1,0,1,1,1,0,1,0,1,0,0,1,1,1,1,1,0,1,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,
+ 1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,1,0,1,0,1,0,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,
+ 1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,0,0,1,1,1,1,0,0,1,0,1,1,1,1,1,1,
+ 1,1,0,1,1,1,1,1,0,1,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,0,1,1,0,1,0,0,0,1,0,1,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,1,0,1,1,1,1,1,
+ 1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,0,1,0,0,1,0,0,1,1,0,0,0,0,
+ 1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0,1,1,1,
+ 1,0,0,1,1,1,0,1,1,1,1,0,0,1,1,1,0,1,1,0,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,1,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,1,1,
+ 1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,0,0,1,0,1,1,0,1,1,1,0,0,1,0,1,1,0,1,0,1,0,1,1,1,0,1,0,1,1,1,1,1,1,1,1,0,0,1,1,1,0,1,1,1,1,1,
+ 1,1,1,0,1,0,0,1,0,1,1,1,0,1,0,0,0,1,1,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,1,0,0,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,
+ 1,1,0,0,1,1,1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,
+ 1,0,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,0,1,1,1,1,1,1,
+ 1,0,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,1,1,0,1,0,1,1,1,0,0,0,
+ 1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,0,0,1,1,1,0,1,1,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,1,1,
+ 1,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,0,1,1,1,0,1,1,
+ 1,0,1,0,1,1,1,1,1,0,0,1,1,1,1,0,1,1,1,1,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,0,0,0,0,0,1,0,1,0,1,0,1,0,1,1,1,1,1,1,1,0,
+ 1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,0,1,1,1,1,0,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,
+ 1,1,0,1,1,0,0,1,1,1,0,0,0,0,1,1,1,1,1,0,0,1,0,0,1,1,0,1,1,0,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,0,1}
+ w=1
+ x=2
+ y=2
+ z=1
+ w_max=4
+ x_max=4
+ y_max=4
+ z_max=4
+ enigma.KillItem(28,2)
+ enigma.KillItem(32,6)
+ enigma.KillItem(24,6)
+else
+ tab={
+ 0,1,0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,0,1,
+ 1,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,1,0,1,1,1,1,0,1,1,1,1,
+ 1,0,1,1,1,1,1,0,0,0,1,1,1,0,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,0,1,0,1,1,1,1,0,0,1,
+ 0,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,0,1,1,1,1,0,1,0,1,1,1,0,0,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,
+ 1,1,0,1,0,1,0,1,1,0,1,1,0,1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,1,1,1,0,1,1,1,1,0,1,0,0,1,1,1,0,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,
+ 1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,1,0,1,1,0,1,1,1,1,1,0,0,0,0,0,1,1,0,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,
+ 1,1,1,0,1,1,1,1,0,1,0,0,0,1,1,0,1,1,1,1,0,1,1,0,0,1,1,0,0,0,1,1,1,1,1,0,1,1,0,0,0,1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,
+ 1,1,0,1,1,1,1,0,1,1,1,0,1,1,0,1,1,1,1,0,1,1,1,0,1,1,0,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,1,0,1,1,1,1,1,1,
+ 1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,0,0,1,1,1,0,0,1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,
+ 1,1,0,1,0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,0,1,
+ 1,1,1,1,0,0,1,1}
+ w=1
+ x=1
+ y=1
+ z=1
+ w_max=3
+ x_max=3
+ y_max=3
+ z_max=3
+ enigma.KillItem(28,2)
+ enigma.KillItem(32,2)
+ enigma.KillItem(32,10)
+ enigma.KillItem(28,10)
+ enigma.KillItem(24,10)
+ enigma.KillItem(24,2) 
+end
+
+richtung=-1
+
+function S(w,x,y,z,d)
+ return tab[d+8*z+(8*z_max*y)+(8*z_max*y_max*x)+(8*z_max*y_max*x_max*w)]
+end
+
+
+function richtung1()
+ richtung=1
+end
+
+function richtung2()
+ richtung=2
+end
+
+function richtung3()
+ richtung=3
+end
+
+function richtung4()
+ richtung=4
+end
+
+function richtung5()
+ richtung=5
+end
+
+function richtung6()
+ richtung=6
+end
+
+function richtung7()
+ richtung=7
+end
+
+function richtung8()
+ richtung=8
+end
+
+function stoprichtung()
+ richtung=-1
+end
+
+function welche_Ecke(aa,bb,cc,dd)
+ if aa~=0 and aa~=w_max-1 then return -1 end
+ if bb~=0 and bb~=x_max-1 then return -1 end
+ if cc~=0 and cc~=y_max-1 then return -1 end
+ if dd~=0 and dd~=z_max-1 then return -1 end
+ ee = 0
+ if aa==w_max-1 then ee=ee+8 end
+ if bb==x_max-1 then ee=ee+4 end
+ if cc==y_max-1 then ee=ee+2 end
+ if dd==z_max-1 then ee=ee+1 end
+ return ee
+end
+
+function ziehe()
+
+ if richtung==1 then
+  w=w-1
+ elseif richtung==2 then
+  x=x+1
+ elseif richtung==3 then
+  y=y+1
+ elseif richtung==4 then
+  z=z+1
+ elseif richtung==5 then
+  w=w+1
+ elseif richtung==6 then
+  x=x-1
+ elseif richtung==7 then
+  y=y-1
+ elseif richtung==8 then
+  z=z-1
+ end 
+
+ richtung=-1
+
+end
+
+
+function zieheA()
+
+ ziehe();
+
+ enigma.KillItem(9,2)
+ enigma.KillItem(13,2)
+ enigma.KillItem(13,6)
+ enigma.KillItem(13,10)
+ enigma.KillItem(9,10)
+ enigma.KillItem(5,10)
+ enigma.KillItem(5,6)
+ enigma.KillItem(5,2)
+
+ if S(w,x,y,z,5)==0 then
+  if welche_Ecke(w-1,x,y,z)~=-1 then
+   set_item("it-wormhole",9,2, {strength=0, targetx=47.5+19*welche_Ecke(w-1,x,y,z), targety="6.5"})
+  else
+   set_item("it-wormhole",9,2, {strength=0, targetx="351.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,2)==0 then
+  if welche_Ecke(w,x+1,y,z)~=-1 then
+   set_item("it-wormhole",13,2, {strength=0, targetx=47.5+19*welche_Ecke(w,x+1,y,z), targety="6.5"})
+  else
+   set_item("it-wormhole",13,2, {strength=0, targetx="351.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,3)==0 then
+  if welche_Ecke(w,x,y+1,z)~=-1 then
+   set_item("it-wormhole",13,6, {strength=0, targetx=47.5+19*welche_Ecke(w,x,y+1,z), targety="6.5"})
+  else
+   set_item("it-wormhole",13,6, {strength=0, targetx="351.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,4)==0 then
+  if welche_Ecke(w,x,y,z+1)~=-1 then
+   set_item("it-wormhole",13,10, {strength=0, targetx=47.5+19*welche_Ecke(w,x,y,z+1), targety="6.5"})
+  else
+   set_item("it-wormhole",13,10, {strength=0, targetx="351.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,1)==0 then
+  if welche_Ecke(w+1,x,y,z)~=-1 then
+   set_item("it-wormhole",9,10, {strength=0, targetx=47.5+19*welche_Ecke(w+1,x,y,z), targety="6.5"})
+  else
+   set_item("it-wormhole",9,10, {strength=0, targetx="351.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,6)==0 then
+  if welche_Ecke(w,x-1,y,z)~=-1 then
+   set_item("it-wormhole",5,10, {strength=0, targetx=47.5+19*welche_Ecke(w,x-1,y,z), targety="6.5"})
+  else
+   set_item("it-wormhole",5,10, {strength=0, targetx="351.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,7)==0 then
+  if welche_Ecke(w,x,y-1,z)~=-1 then
+   set_item("it-wormhole",5,6, {strength=0, targetx=47.5+19*welche_Ecke(w,x,y-1,z), targety="6.5"})
+  else
+   set_item("it-wormhole",5,6, {strength=0, targetx="351.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,8)==0 then
+  if welche_Ecke(w,x,y,z-1)~=-1 then
+   set_item("it-wormhole",5,2, {strength=0, targetx=47.5+19*welche_Ecke(w,x,y,z-1), targety="6.5"})
+  else
+   set_item("it-wormhole",5,2, {strength=0, targetx="351.5", targety="6.5"})
+  end
+ end
+end
+
+
+function zieheB()
+ 
+ ziehe();
+
+ enigma.KillItem(351,2)
+ enigma.KillItem(355,2)
+ enigma.KillItem(355,6)
+ enigma.KillItem(355,10)
+ enigma.KillItem(351,10)
+ enigma.KillItem(347,10)
+ enigma.KillItem(347,6)
+ enigma.KillItem(347,2)
+
+ if S(w,x,y,z,5)==0 then
+  if welche_Ecke(w-1,x,y,z)~=-1 then
+   set_item("it-wormhole",351,2, {strength=0, targetx=47.5+19*welche_Ecke(w-1,x,y,z), targety="6.5"})
+  else
+   set_item("it-wormhole",351,2, {strength=0, targetx="9.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,2)==0 then
+  if welche_Ecke(w,x+1,y,z)~=-1 then
+   set_item("it-wormhole",355,2, {strength=0, targetx=47.5+19*welche_Ecke(w,x+1,y,z), targety="6.5"})
+  else
+   set_item("it-wormhole",355,2, {strength=0, targetx="9.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,3)==0 then
+  if welche_Ecke(w,x,y+1,z)~=-1 then
+   set_item("it-wormhole",355,6, {strength=0, targetx=47.5+19*welche_Ecke(w,x,y+1,z), targety="6.5"})
+  else
+   set_item("it-wormhole",355,6, {strength=0, targetx="9.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,4)==0 then
+  if welche_Ecke(w,x,y,z+1)~=-1 then
+   set_item("it-wormhole",355,10, {strength=0, targetx=47.5+19*welche_Ecke(w,x,y,z+1), targety="6.5"})
+  else
+   set_item("it-wormhole",355,10, {strength=0, targetx="9.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,1)==0 then
+  if welche_Ecke(w+1,x,y,z)~=-1 then
+   set_item("it-wormhole",351,10, {strength=0, targetx=47.5+19*welche_Ecke(w+1,x,y,z), targety="6.5"})
+  else
+   set_item("it-wormhole",351,10, {strength=0, targetx="9.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,6)==0 then
+  if welche_Ecke(w,x-1,y,z)~=-1 then
+   set_item("it-wormhole",347,10, {strength=0, targetx=47.5+19*welche_Ecke(w,x-1,y,z), targety="6.5"})
+  else
+   set_item("it-wormhole",347,10, {strength=0, targetx="9.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,7)==0 then
+  if welche_Ecke(w,x,y-1,z)~=-1 then
+   set_item("it-wormhole",347,6, {strength=0, targetx=47.5+19*welche_Ecke(w,x,y-1,z), targety="6.5"})
+  else
+   set_item("it-wormhole",347,6, {strength=0, targetx="9.5", targety="6.5"})
+  end
+ end
+
+ if S(w,x,y,z,8)==0 then
+  if welche_Ecke(w,x,y,z-1)~=-1 then
+   set_item("it-wormhole",347,2, {strength=0, targetx=47.5+19*welche_Ecke(w,x,y,z-1), targety="6.5"})
+  else
+   set_item("it-wormhole",347,2, {strength=0, targetx="9.5", targety="6.5"})
+  end
+ end
+end
+
+ecke_nr=-1
+
+for qqq = 0,w_max-1,w_max-1 do
+ for www = 0,x_max-1,x_max-1 do
+  for eee = 0,y_max-1,y_max-1 do
+   for rrr = 0,z_max-1,z_max-1 do
+
+    ecke_nr = welche_Ecke(qqq,www,eee,rrr)
+    if S(qqq,www,eee,rrr,5)==0 then
+     set_item("it-wormhole",9+19*(ecke_nr+2),2, {strength=0, targetx="9.5", targety="6.5"})
+    end
+
+    if S(qqq,www,eee,rrr,2)==0 then
+     set_item("it-wormhole",13+19*(ecke_nr+2),2, {strength=0, targetx="9.5", targety="6.5"})
+    end
+
+    if S(qqq,www,eee,rrr,3)==0 then
+     set_item("it-wormhole",13+19*(ecke_nr+2),6, {strength=0, targetx="9.5", targety="6.5"})
+    end
+
+    if S(qqq,www,eee,rrr,4)==0 then
+     set_item("it-wormhole",13+19*(ecke_nr+2),10, {strength=0, targetx="9.5", targety="6.5"})
+    end
+
+    if S(qqq,www,eee,rrr,1)==0 then
+     set_item("it-wormhole",9+19*(ecke_nr+2),10, {strength=0, targetx="9.5", targety="6.5"})
+    end
+
+    if S(qqq,www,eee,rrr,6)==0 then
+     set_item("it-wormhole",5+19*(ecke_nr+2),10, {strength=0, targetx="9.5", targety="6.5"})
+    end
+
+    if S(qqq,www,eee,rrr,7)==0 then
+     set_item("it-wormhole",5+19*(ecke_nr+2),6, {strength=0, targetx="9.5", targety="6.5"})
+    end
+
+    if S(qqq,www,eee,rrr,8)==0 then
+     set_item("it-wormhole",5+19*(ecke_nr+2),2, {strength=0, targetx="9.5", targety="6.5"})
+    end
+
+   end
+  end
+ end
+end
+
+ ]]></el:luamain>
+ <el:i18n>
+	 <el:string el:key="title">
+		 <el:english el:translate="false"/>
+	 </el:string>
+	 <el:string el:key="subtitle">
+		 <el:english el:translate="false"/>
+	 </el:string>
+	 <el:string el:key="text1">
+		 <el:english el:translate="true">Ever mapped out a 4D-Labyrinth? Well, it's time to learn thinking in four dimensions ... Some hints: size of the labyrinth is 4x4x4x4; your current position is (2|3|3|2); in all of the 16 corners of the hypercube is a blue oxyd ...</el:english>
+	 </el:string>
+	 <el:string el:key="text2">
+		 <el:english el:translate="true">Ever mapped out a 4D-Labyrinth? Well, it's time to learn thinking in four dimensions ... Some hints: size of the labyrinth is 3x3x3x3; your current position is (2|2|2|2); in all of the 16 corners of the hypercube is a blue oxyd ...</el:english>
+	 </el:string>
+    </el:i18n>
+ </el:protected>
+</el:level>
+


Property changes on: trunk/data/levels/enigma_vii/manuel01_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_vii/mecke09_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/mecke09_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/mecke09_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,472 @@
+?<?xml version="1.0" encoding="utf-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+  xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd"
+  xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Audience in Venice" el:subtitle="Press the Triggers" el:id="mecke9"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 20 $" el:status="released"/>
+      <el:author  el:name="mecke" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="0.92">
+        <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false" el:control="force"
+        el:scoreunit="duration" el:scoretarget="time"/>
+      <el:score el:easy="12:01" el:difficult="14:39"/>
+    </el:info>
+    <el:luamain><![CDATA[
+function file_oxyd(x,y,f)
+    oxyd_default_flavor=f
+    oxyd(x,y)
+end
+levelh=37
+levelw=76
+enigma.FlatForce=30
+enigma.SlopeForce=30
+enigma.ElectricForce=30
+cells={}
+items={}
+actors={}
+stones={}
+actors[" "]=cell{}
+stones[" "]=cell{}
+cells[" "]=cell{}
+items[" "]=cell{}
+cells["!"]=cell{floor="fl-brick"}
+function ac_blackball(x,y)
+n=""
+p=0
+f=0
+ if (x==0) and (y==0) then
+  n="ac0x0"
+  p=0
+  mf=1
+ end
+set_actor("ac-blackball",x+0.5,y+0.5,{player=p,name=n,mouseforce=mf})
+end
+actors["!"]=cell{parent={{ac_blackball}}}
+cells["#"]=cell{floor="fl-gradient1"}
+cells["$"]=cell{floor="fl-dunes"}
+cells["%"]=cell{floor="fl-water"}
+stones["!"]=cell{stone="st-death"}
+stones["#"]=cell{stone="st-rock1"}
+cells["&"]=cell{floor="fl-normal"}
+stones["$"]=cell{stone="st-thief"}
+stones["%"]=cell{stone="st-black3"}
+stones["&"]=cell{stone="st-stone_break"}
+items["!"]=cell{item="it-document"}
+stones["'"]=cell{stone="st-glass_move"}
+stones["("]=cell{stone="st-bumps"}
+stones[")"]=cell{stone="st-grate1"}
+items["#"]=cell{item="it-hstrip"}
+stones["*"]=cell{stone="st-brick"}
+stones["+"]=cell{stone="st-mirror-3>"}
+stones[","]=cell{stone="st-mirror-p|"}
+stones["-"]=cell{stone="st-laser-n"}
+cells["'"]=cell{floor="fl-himalaya"}
+cells["("]=cell{floor="fl-leavesc2"}
+items["$"]=cell{item="it-glasses"}
+stones["."]=cell{stone="st-wood_001"}
+stones["?"]=cell{stone="st-brake"}
+stones["/"]=cell{stone="st-mirror-3vm"}
+stones["0"]=cell{stone="st-mirror-p\\tm"}
+function ac_top(x,y)
+n=""
+r=0
+f=0
+ init=false
+ if (x==7) and (y==4) then
+  n="ac7x4"
+  r=1
+  f=1
+  init=FALSE
+ end
+ if (x==10) and (y==27) then
+  n="ac10x27"
+  r=1
+  f=1
+  init=FALSE
+ end
+ if (x==13) and (y==27) then
+  n="ac13x27"
+  r=1
+  f=1
+  init=FALSE
+ end
+set_actor("ac-top",x+0.5,y+0.5,{range=r,force=f,name=n,gohome=init})
+end
+actors["#"]=cell{parent={{ac_top}}}
+cells[")"]=cell{floor="fl-red"}
+stones["1"]=cell{stone="st-brownie"}
+stones["2"]=cell{stone="st-rock4"}
+cells["*"]=cell{floor="fl-plank"}
+items["%"]=cell{item="it-umbrella"}
+cells["+"]=cell{floor="fl-bluegreenx"}
+stones["3"]=cell{stone="st-yellow"}
+stones["4"]=cell{stone="st-door-v"}
+items["&"]=cell{item="it-extralife"}
+stones["5"]=cell{stone="st-door-h"}
+cells[","]=cell{floor="fl-swamp"}
+items["'"]=cell{item="it-coin2"}
+stones["6"]=cell{stone="st-glass"}
+stones["7"]=cell{parent={{file_oxyd,"d"}}}
+stones["8"]=cell{stone="st-knight"}
+stones["9"]=cell{stone="st-bolder-e"}
+items["("]=cell{item="it-vstrip"}
+stones[":"]=cell{stone="st-bolder-w"}
+stones[";"]=cell{stone="st-wood"}
+items[")"]=cell{item="it-key_b"}
+stones["<"]=cell{stone="st-mirror-p\\"}
+stones["="]=cell{stone="st-key_a"}
+items["*"]=cell{item="it-trigger"}
+cells["-"]=cell{floor="fl-sahara"}
+items["+"]=cell{item="it-flagblack"}
+stones[">"]=cell{stone="st-bolder-n"}
+stones["?"]=cell{stone="st-blue-sand"}
+cells["."]=cell{floor="fl-samba"}
+items[","]=cell{item="it-magicwand"}
+cells["/"]=cell{floor="fl-gravel"}
+stones["@"]=cell{stone="st-rubberband"}
+stones["A"]=cell{stone="st-rock3"}
+items["-"]=cell{item="it-banana"}
+stones["B"]=cell{stone="st-actorimpulse"}
+stones["C"]=cell{stone="st-rotator-left"}
+cells["0"]=cell{floor="fl-sand"}
+cells["1"]=cell{floor="fl-rough-blue"}
+stones["D"]=cell{stone="st-rock1_hole"}
+stones["E"]=cell{stone="st-stoneimpulse-hollow"}
+stones["F"]=cell{stone="st-stoneimpulse"}
+cells["2"]=cell{floor="fl-light"}
+items["."]=cell{item="it-sword"}
+cells["3"]=cell{floor="fl-leavesc4"}
+items["/"]=cell{item="it-coffee"}
+stones["G"]=cell{stone="st-actorimpulse_invisible"}
+items["0"]=cell{item="it-cherry"}
+cells["4"]=cell{floor="fl-leavesc1"}
+stones["H"]=cell{stone="st-marble"}
+items["1"]=cell{item="it-wormhole"}
+cells["5"]=cell{floor="fl-leavese2"}
+stones["I"]=cell{stone="st-swap"}
+items["2"]=cell{item="it-flagwhite"}
+items["3"]=cell{item="it-key_a"}
+cells["6"]=cell{floor="fl-leaves"}
+stones["J"]=cell{stone="st-white3"}
+stones["K"]=cell{stone="st-likeoxydd"}
+items["4"]=cell{item="it-crack3"}
+stones["L"]=cell{stone="st-coffee"}
+stones["M"]=cell{stone="st-shogun-sml"}
+stones["N"]=cell{stone="st-door_a"}
+items["5"]=cell{item="it-springboard"}
+stones["O"]=cell{stone="st-rock6"}
+items["6"]=cell{item="it-coin4"}
+stones["P"]=cell{stone="st-grate3"}
+stones["Q"]=cell{stone="st-chess_white"}
+stones["R"]=cell{stone="st-grate2"}
+cells["7"]=cell{floor="fl-space"}
+stones["S"]=cell{stone="st-break_invisible"}
+cells["8"]=cell{floor="fl-bluegray"}
+stones["T"]=cell{stone="st-bolder-s"}
+cells["9"]=cell{floor="fl-hay"}
+stones["U"]=cell{stone="st-rock3_break"}
+stones["V"]=cell{stone="st-rock5"}
+stones["W"]=cell{stone="st-mirror-p-m"}
+items["7"]=cell{item="it-surprise"}
+stones["X"]=cell{stone="st-oneway_black-n"}
+items["8"]=cell{item="it-squashed"}
+stones["Y"]=cell{stone="st-oneway_black-w"}
+cells[":"]=cell{floor="fl-leavesd1"}
+stones["Z"]=cell{stone="st-lightpassenger_off"}
+stones["?"]=cell{stone="st-laser-e"}
+stones["^"]=cell{stone="st-brake"}
+level={"!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%&%%%,,%%%%%%89,%%%%%%%%%%%%%%",
+       "####%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%///////0%000%%//////%%%%%%/%%%%%:::::",
+       "####%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%/%%%%%60%0%0%%/%%%%/%%,+%%/%%%%%:::::",
+       "####%%%%%%%%%%%%!!%%%%%%%%%%%%%%%%%%%%%!!%%%%%0%0%0%%//,/%/%%%%%%..%%%%:::::",
+       "####%%''%%%%%%&&!!%---%)%---%%%%%%1111%!!!%%/%0%0,///%///%/%%%%***%%%%%:::::",
+       "$$$$%%''%%%%!!!%!!%---%)%---'''%%%1111%%%!!%%%060%%%%,%%%%/%/88***%%%%%:::::",
+       "%%%%%%%)%%%%%%%%%%%'%%%%%%%'%''%%%/%%%%%%!!%%%0%000%////%,/%/%%***%%%%%%%%%%",
+       "%%%%%%()!!!!!%%%%%%'%%%%%%%'%''%%%/%%%%%%%%%%%0,%20%/%%/,%/%/%%%8!%%%%%%%%%%",
+       "%%%%%%%%%%%,%%%%%%%'%%%%%%%''''%%//%%%%%%.%%%10%-%0%/%,////%/%%%8%6%%.%%%%%%",
+       "%%%%%%%%%%%,%%%%%%%%%%%%%%%.%/%%//%%%%%%%.%%%%02,%0%/,%%%%%%/%7%&&67770%%%%%",
+       "%%%%%%%%%%%,%%%%%%%%%%%%%%%.%/%//%///%%%%.%.%%00000%/////////%7%%%&%%%%%%%%%",
+       "%%%%%%%%%%%%%%%%%%%%%%%%%%%%%/%/%%/%/%%%%%%.%%%%%%%%%%%%%%%%%%7%%%%%%%%%%%%%",
+       "%%%%%%%%%%%%%%%%%%%!%%%%%%%%%/%////%/%%%%%%2%%%%%%2%%%%%%%/////////%%%%%%%%%",
+       "%%%%%%%%%%%%%%%%%%%%%%%%%%%%%/%%%%%%/%%+++%2%++++%2%%%%%%%/%%%%%%%/%%%%%%%%%",
+       "%%%%%%%%%%%%%%%%%%%%%%%%%%%///%//////%%+222222222222222222/%%%%%%%/%%%%%%%%%",
+       "%%%%%%%%*+!!!!+*%%%%%%%%%%%/%%%/%%%%%%%+2222222222222%%%%%7%%%%%%%/%%%%%%%%%",
+       "%%%%%%!!*+!!!!+*!!%%%%%%%%%/%%%/%%%%%%%+22222222222%%%%%%%77///////%%%%%%%%%",
+       "%%%%%%!!*+!!!!+*!!%%%%%%%%%/%%%//////%222222222222%%%%%%%%%%0%%%%%%%%%%%%%%%",
+       "%%%%%%%%*++++++*%%%%%%%%%%%/%%%%%%%%/%%+2222222222%%%%%%%%%%0%%%000%%%%%%%%%",
+       "%%%%%%%%********%%%%%%%%%%%/////%%%%/%%++++++22222%%%%%%%%%%0%%%0%0%%%%%%%%%",
+       "%%%%%%%%++++++++%%%%%%%%%%%%%%%/%%%%/%%%%%%%%+2222%%%%%%%%7700000%0%%%%%%%%%",
+       "%%%%%%%%+))))))+%%%%%%%%%%%.%%%/%%%%/%%%%%%%%+2222))))%%%%%%%%%%%%0%%%00%%%%",
+       "%%%%%%%%+))))))+%%%%%%%%%%%.%%%/%%%%/%%%%%%%%+2222%%%%%%%%%00000000%%&00&%%%",
+       "%%%%%%%%+))))))+%%%%%%%%%%%..%%/%%%%/%%%3345%+2222%%%%%%%%%7%%%%%%%%%&%%&%%%",
+       "%%%%%%%%+))))))+%%%!%%%%%%%%%%%//////%!%222222222222222%%!%7%%%%%%%%%&000%%!",
+       "%%%%%%%%+))))))+%%%%%%%%%%%%%%%%%%%%%%%%%.%.%%%%%%%%.%%%%.%000000000//00::::",
+       "%%%%%%%%+))))))+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%.%%::::",
+       "%%%%%%%%+))))))+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%//%%::::",
+       "%%%%%%%%+))))))+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%.%%::::",
+       "%%%%%%%%++++++++%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%//%%::::",
+       "%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%0%%%%%%%%%%%%%%%%%%0%%%%%%%%%%%%%%%%%%%%%%.",
+       "%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%.",
+       "%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%,%%%%%%%%%%%%%%%%%%%%%%%%%%%.",
+       "%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%44%44444%%%%%%%%%%%%%%%%%%%%%%%%%//",
+       "%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%44444444%%%%%%%%%%%%%%%%%%%%%%%%%%.",
+       "%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%4)444444%%%%%%%%%%%%%%%%%%%%%%%%%//",
+       "%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%4)444444%%%%%%%%%%%%%%%%%%%%%%%%%%0"}
+acmap={"!                                                                           ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "       #                                                                    ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "          #  #                                                              ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            "}
+itmap={"                                          ..   **                7          ",
+       "                                                             (              ",
+       "                                                                            ",
+       "                                                     &            !         ",
+       "                  # !                 #     * !     5 5 ,                   ",
+       "  ! ##         #  # !    !      ##             4                 /          ",
+       "            (              +   -                   2                        ",
+       "      $                        -         (         2          .  *          ",
+       "                   &           -             *     2             # #        ",
+       "           '               ,                       2                        ",
+       "                                         &#        2                        ",
+       "                                                                  (         ",
+       "                                     #                                      ",
+       "                                                                            ",
+       "                                     #   /    /                             ",
+       "          &                                                                 ",
+       "                                                                            ",
+       "        % !     )                       !                                   ",
+       "                                           /              ++                ",
+       "                                                                            ",
+       "                   +                                 6                      ",
+       "                   +      *             . .      !/  1                      ",
+       "                                                     6 #               ,    ",
+       "                  *                      0 0  +  2                          ",
+       "                                           !           ##                  &",
+       "                   +                                      # // // //8!      ",
+       "                   +                       2                             8 !",
+       "                                           2                        8   8 81",
+       "                  *                        2                             8  ",
+       "                                           2                     2228       ",
+       "                  *                        2                                ",
+       "                                           2                                ",
+       "                                               !                            ",
+       "                                           2                                ",
+       "                                           3                                ",
+       "                                                                            ",
+       "                                          1 !                               "}
+stmap={" $&(#                      ## 222    22!      !            Z  U             ",
+       "    ##   #     ###                A  22                     # UOO      ZZZZZ",
+       "    ### ###   ## ##         ##222 AA     AA .  # # ##  #    DU UO      Z   Z",
+       "    ######## ###  # .  .  . ##2A2 AAA    AA222 @           T# V?6          Z",
+       "    )   #  ###  ;    ;      ##222          2             9DD# U W O    Z   Z",
+       "    )   #  #       ; ;         %       AA  222    %          ^  I O    ZZZZZ",
+       "!% %)## #### ###### .  .  .     2)  ## AA                         OO        ",
+       "## ###       # ## #             )C  ####  HH##       6   6         OO       ",
+       "## ###.1222 #######             2     C#  HH#      6  6  Q 6 VVV  W O O     ",
+       "                          %           ##A5% ##   $           VBV  U         ",
+       "## ########6#######%      >            AA                    V!V  ! UUOO    ",
+       "## ########  # ## #%:      ##   2     AA                               OO   ",
+       "             ######        ##         EFFFFEEFFEFFEEFFEFF            (((((( ",
+       "                           ##   2 ##  FAAAA)AAALAKMKOOOOFO BBAAABB   (      ",
+       "                            4     DD  EA                 4   ABA     (      ",
+       "    **** 3    3 ****        ### 2 ##  FA           3N3)OOO   AAA     (  ((((",
+       "         4    4             #@# 2 $$  FA     JJJ   NK3     6         (  (   ",
+       "      /  3    3  =          ###       E)     JKJ   3N3  2296 BBB     (  (   ",
+       "         333333    *                  FA     JJJ        2R 6 BAB     (  (   ",
+       "      0         0  *            B ##  FAAAAAA     33333 22 6 BBB     (  (   ",
+       "        335335336           ### B #6  FFFFEFFA    33363    6         (  (   ",
+       "        3      36           #3# B ##   A'A'AFA    484 3 OOSSSSSSSS   (  (   ",
+       "     ++ 3      30<        % ### C   :  AAAAAFA    33363 PO6          8  8   ",
+       "        3  33  36: *                 C   G GFA    33333 OO6 33 22 AA 8  8   ",
+       "        3 3773 36  *                                   )) 6 33 22 AA XXYX   ",
+       "        3 3883 36                                         6           YXY   ",
+       "        3  9:  36                                                   S SS  $ ",
+       "     ,, 3      3<<                                                    SS   '",
+       "     -  3      36: *                                                S SS  $ ",
+       "        33!33!336  *                                                  SS    ",
+       "                 %                                                  9%      ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                                                            ",
+       "                                             AKA                            ",
+       "                                         ( ( A.A                            ",
+       "                                         ( ( A3A                            "}
+create_world_by_map(level)
+draw_map(0,0,stmap,stones)
+draw_map(0,0,itmap,items)
+draw_map(0,0,acmap,actors)
+SetAttrib(enigma.GetItem(2,5),"text","text1")
+SetAttrib(enigma.GetStone(5,28),"on",FALSE)
+SetAttrib(enigma.GetItem(10,17),"text","text2")
+SetAttrib(enigma.GetItem(18,23),"invisible",FALSE)
+SetAttrib(enigma.GetItem(18,28),"invisible",FALSE)
+SetAttrib(enigma.GetItem(18,30),"invisible",FALSE)
+SetAttrib(enigma.GetItem(20,4),"text","text3")
+SetAttrib(enigma.GetItem(20,5),"text","text4")
+SetAttrib(enigma.GetItem(25,5),"text","text5")
+SetAttrib(enigma.GetItem(26,21),"invisible",FALSE)
+SetAttrib(enigma.GetItem(40,17),"text","text6")
+SetAttrib(enigma.GetItem(43,24),"text","text7")
+SetAttrib(enigma.GetItem(44,4),"invisible",FALSE)
+SetAttrib(enigma.GetItem(44,36),"text","text8")
+SetAttrib(enigma.GetItem(46,4),"text","text9")
+SetAttrib(enigma.GetItem(47,32),"text","text10")
+SetAttrib(enigma.GetItem(49,21),"text","text11")
+SetAttrib(enigma.GetStone(63,3),"on",FALSE)
+SetAttrib(enigma.GetItem(65,7),"invisible",FALSE)
+SetAttrib(enigma.GetItem(66,3),"text","text12")
+SetAttrib(enigma.GetItem(69,25),"text","text13")
+SetAttrib(enigma.GetItem(75,26),"text","hurry to san giorgio")
+
+if (not difficult) then
+set_floor("fl-swamp",2,6)
+set_floor("fl-swamp",2,7)
+set_floor("fl-swamp",2,8)
+set_floor("fl-swamp",2,10)
+set_floor("fl-swamp",2,11)
+set_floor("fl-bluegray",2,9)
+draw_floor("fl-bluegray",{2,12},{0,1},18)
+set_stone("st-black3",2,30)
+set_stone("st-brake",57,8)
+set_floor("fl-swamp",47,1)
+set_item("it-umbrella",8,16)
+SetAttrib(enigma.GetItem(75,27),"strength",3)
+SetAttrib(enigma.GetItem(75,27),"range",3)
+SetAttrib(enigma.GetItem(53,21),"strength",3)
+SetAttrib(enigma.GetItem(53,21),"range",3)
+SetAttrib(enigma.GetItem(42,36),"strength",3)
+SetAttrib(enigma.GetItem(42,36),"range",3)
+else
+draw_floor("fl-water",{2,6},{0,1},24)
+set_floor("fl-water",47,1)
+set_stone("st-glass_move",2,6)
+set_stone("st-chess_white",57,8)
+SetAttrib(enigma.GetItem(75,27),"strength",10)
+SetAttrib(enigma.GetItem(75,27),"range",10)
+SetAttrib(enigma.GetItem(53,21),"strength",10)
+SetAttrib(enigma.GetItem(53,21),"range",10)
+SetAttrib(enigma.GetItem(42,36),"strength",10)
+SetAttrib(enigma.GetItem(42,36),"range",10)
+end
+Signal ("it(44 4)","st(50 21)")
+Signal ("it(18 23)","st(13 20)")
+Signal ("it(18 28)","st(10 20)")
+Signal ("it(18 30)","st(14 16)")
+Signal ("it(42 36)","fl(42 24)")
+Signal ("it(53 21)","fl(11 16)")
+Signal ("it(75 27)","fl(44 35)")
+Signal ("st(17 17)","st(5 28)")
+Signal ("st(5 28)","st(5 28)")
+Signal ("it(65 7)","st(63 3)")
+Signal ("it(26 21)","st(28 14)")
+Signal ("it(45 8)","st(41 9)")
+Signal ("it(47 0)","st(57 14)")
+Signal ("it(48 0)","st(52 21)")
+
+oxyd_shuffle()
+ ]]></el:luamain>
+      <el:i18n>
+        <el:string el:key="title">
+          <el:english el:translate="true"/>
+		  <el:translation el:lang="de">Audienz in Venedig</el:translation>
+        </el:string>
+        <el:string el:key="subtitle">
+          <el:english el:translate="true"/>
+		  <el:translation el:lang="de">Dr?cke den Bodenschalter</el:translation>
+        </el:string>
+		<el:string el:key="text1">
+        <el:english el:translate="true">Welcome to Venice</el:english>
+        <el:translation el:lang="de">Willkommen in Venedig</el:translation>
+      </el:string> 
+		<el:string el:key="text2">
+        <el:english el:translate="true">Welcome to the Audience</el:english>
+        <el:translation el:lang="de">Willkommen nun zur Audienz!</el:translation>
+      </el:string> 		
+	  <el:string el:key="text3">
+        <el:english el:translate="true">rialto</el:english>
+        <el:translation el:lang="de">Rialtobr?cke...</el:translation>
+      </el:string> 		
+	  <el:string el:key="text4">
+        <el:english el:translate="true">...under construction</el:english>
+        <el:translation el:lang="de">Baustelle!</el:translation>
+      </el:string> 		
+	  <el:string el:key="text5">
+        <el:english el:translate="true">try the bolders as gondola</el:english>
+        <el:translation el:lang="de">Nutze die Bolder als Gondeln</el:translation>
+      </el:string> 		
+	  <el:string el:key="text6">
+        <el:english el:translate="true">piazza san marco</el:english>
+        <el:translation el:lang="de">Markusplatz</el:translation>
+      </el:string> 		
+	  <el:string el:key="text7">
+        <el:english el:translate="true">danger</el:english>
+        <el:translation el:lang="de">Gefahr</el:translation>
+      </el:string> 		
+	  <el:string el:key="text8">
+        <el:english el:translate="true">san giorgio</el:english>
+        <el:translation el:lang="de">San Giorgio</el:translation>
+      </el:string> 		
+	  <el:string el:key="text9">
+        <el:english el:translate="true">guardian ducale</el:english>
+        <el:translation el:lang="de">Residenz der Palastwache</el:translation>
+      </el:string> 		
+	  <el:string el:key="text10">
+        <el:english el:translate="true">gondoliere on strike</el:english>
+        <el:translation el:lang="de">Gondoliere streiken!</el:translation>
+      </el:string> 		
+	  <el:string el:key="text11">
+        <el:english el:translate="true">palace ducale</el:english>
+        <el:translation el:lang="de">Dogenpalast</el:translation>
+      </el:string> 		
+	  <el:string el:key="text12">
+        <el:english el:translate="true">look at san michele</el:english>
+        <el:translation el:lang="de">Da dr?ben liegt San Michele</el:translation>
+      </el:string> 		
+	  <el:string el:key="text13">
+        <el:english el:translate="true">use the gondola below</el:english>
+        <el:translation el:lang="de">Unten die Gondel...Schick sie los!</el:translation>
+      </el:string> 		
+	   <el:string el:key="text14">
+        <el:english el:translate="true">hurry to san giorgio</el:english>
+        <el:translation el:lang="de">Auf nach San Giorgio...</el:translation>
+      </el:string> 		
+     </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_vii/mecke09_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_vii/mecke11_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/mecke11_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/mecke11_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,427 @@
+?<?xml version="1.0" encoding="utf-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+  xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd"
+  xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Black Liberation" el:subtitle="Black is Beautiful" el:id="mecke11"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 25 $" el:status="released"/>
+      <el:author  el:name="mecke" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="0.92">
+        <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false" el:control="force"
+        el:scoreunit="duration" el:scoretarget="time"/>
+      <el:comments>
+        <el:credits el:showinfo="true" el:showstart="false">Thanks to Ronald Lamprecht for testing and feedback</el:credits> 
+      </el:comments>
+      <el:score el:easy="28:51" el:difficult="33:44"/>
+    </el:info>
+    <el:luamain><![CDATA[
+function file_oxyd(x,y,f)
+    oxyd_default_flavor=f
+    oxyd(x,y)
+end
+levelh=36
+levelw=57
+enigma.FlatForce=30
+enigma.SlopeForce=30
+enigma.ElectricForce=30
+cells={}
+items={}
+actors={}
+stones={}
+actors[" "]=cell{}
+stones[" "]=cell{}
+cells[" "]=cell{}
+items[" "]=cell{}
+cells["!"]=cell{floor="fl-abyss"}
+stones["!"]=cell{stone="st-block"}
+cells["#"]=cell{floor="fl-acblack"}
+stones["#"]=cell{stone="st-death"}
+cells["$"]=cell{floor="fl-normal"}
+stones["$"]=cell{stone="st-laser-s"}
+stones["%"]=cell{stone="st-bolder-w"}
+stones["&"]=cell{stone="st-fart"}
+stones["'"]=cell{stone="st-door-h"}
+cells["%"]=cell{floor="fl-bluegray"}
+stones["("]=cell{stone="st-actorimpulse_invisible"}
+cells["&"]=cell{floor="fl-bluegreenx"}
+stones[")"]=cell{stone="st-grate1"}
+items["!"]=cell{item="it-hstrip"}
+stones["*"]=cell{stone="st-mirror-p-m"}
+stones["+"]=cell{stone="st-rock2"}
+cells["'"]=cell{floor="fl-water"}
+stones[","]=cell{stone="st-rock1_hole"}
+items["#"]=cell{item="it-trigger"}
+stones["-"]=cell{stone="st-thief"}
+items["$"]=cell{item="it-puller-s"}
+stones["."]=cell{stone="st-puzzle2-es"}
+items["%"]=cell{item="it-extralife"}
+stones["/"]=cell{stone="st-puzzle2-ns"}
+stones["0"]=cell{stone="st-puzzle2-ne"}
+cells["("]=cell{floor="fl-swamp"}
+stones["1"]=cell{stone="st-puzzle2-ew"}
+stones["2"]=cell{stone="st-glass"}
+items["&"]=cell{item="it-key_b"}
+stones["3"]=cell{stone="st-laser-e"}
+stones["4"]=cell{stone="st-puzzle2-sw"}
+stones["5"]=cell{stone="st-break_invisible"}
+stones["6"]=cell{parent={{file_oxyd,"a"}}}
+stones["7"]=cell{stone="st-lasertimeswitch"}
+stones["8"]=cell{stone="st-oneway-w"}
+stones["9"]=cell{stone="st-wood"}
+stones[":"]=cell{stone="st-puzzle2-nw"}
+stones[";"]=cell{stone="st-key_b"}
+cells[")"]=cell{floor="fl-space"}
+stones["<"]=cell{stone="st-actorimpulse"}
+stones["="]=cell{stone="st-yellow"}
+stones[">"]=cell{stone="st-death_invisible"}
+stones["?"]=cell{stone="st-brownie"}
+items["'"]=cell{item="it-flagblack"}
+items["("]=cell{item="it-glasses"}
+function ac_top(x,y)
+n=""
+r=0
+f=0
+ init=false
+ if (x==19) and (y==25) then
+  n="ac19x25"
+  r=1
+  f=1
+  init=FALSE
+ end
+ if (x==20) and (y==26) then
+  n="ac20x26"
+  r=1
+  f=1
+  init=FALSE
+ end
+ if (x==21) and (y==27) then
+  n="ac21x27"
+  r=1
+  f=1
+  init=FALSE
+ end
+ if (x==22) and (y==28) then
+  n="ac22x28"
+  r=1
+  f=1
+  init=FALSE
+ end
+ if (x==23) and (y==29) then
+  n="ac23x29"
+  r=3
+  f=3
+  init=TRUE
+ end
+ if (x==34) and (y==22) then
+  n="ac34x22"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==34) and (y==26) then
+  n="ac34x26"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==36) and (y==22) then
+  n="ac36x22"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==36) and (y==26) then
+  n="ac36x26"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==38) and (y==22) then
+  n="ac38x22"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==38) and (y==26) then
+  n="ac38x26"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==40) and (y==22) then
+  n="ac40x22"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==40) and (y==26) then
+  n="ac40x26"
+  r=10
+  f=10
+  init=FALSE
+ end
+set_actor("ac-top",x+0.5,y+0.5,{range=r,force=f,name=n,gohome=init})
+end
+actors["!"]=cell{parent={{ac_top}}}
+stones["@"]=cell{stone="st-stone_break"}
+items[")"]=cell{item="it-shogun-l"}
+items["*"]=cell{item="it-seed"}
+stones["A"]=cell{stone="st-door-v"}
+stones["B"]=cell{stone="st-stoneimpulse-hollow"}
+items["+"]=cell{item="it-magicwand"}
+stones["C"]=cell{stone="st-stoneimpulse"}
+stones["D"]=cell{stone="st-glass_move"}
+stones["E"]=cell{stone="st-rock3"}
+cells["*"]=cell{floor="fl-light"}
+stones["F"]=cell{stone="st-oneway-s"}
+cells["+"]=cell{floor="fl-sahara"}
+stones["G"]=cell{stone="st-rock6"}
+stones["H"]=cell{stone="st-oneway-e"}
+stones["I"]=cell{stone="st-oneway-n"}
+stones["Y"]=cell{stone="st-knight"}
+items[","]=cell{item="it-coin2"}
+items["-"]=cell{item="it-cherry"}
+items["9"]=cell{item="it-springboard"}
+function ac_blackball(x,y)
+n=""
+p=0
+f=0
+ if (x==36) and (y==17) then
+  n="ac36x17"
+  p=0
+  mf=1
+ end
+set_actor("ac-blackball",x+0.5,y+0.5,{player=p,name=n,mouseforce=mf})
+end
+actors["#"]=cell{parent={{ac_blackball}}}
+items["."]=cell{item="it-vstrip"}
+cells[","]=cell{floor="fl-red"}
+stones["J"]=cell{stone="st-black4"}
+items["/"]=cell{item="it-key_a"}
+stones["K"]=cell{stone="st-laser-w"}
+stones["L"]=cell{stone="st-key_a"}
+level={"!!##########################!!!!!########################",
+       "!!##############!!!#########!!!!!########################",
+       "!!#####!########!!!#!#######!!!!!########################",
+       "!!##############!!!#########!!!!!########################",
+       "!!#####################!#!##!!!!!########################",
+       "!!##!#####!##########!######!!!!!#'''''''################",
+       "!!#####################!####!!!!!#'''''''################",
+       "!!##############!!!######!##!!!!!#''*)*''################",
+       "!!#####!########!!!#########!!!!!#'')')''################",
+       "!!!#############!!!#########!!!!!#''*)*''################",
+       "!!##!!!!!!!!!!!!!!!!!#!!!!!#!!!!!#'''''''################",
+       "!!%!####!###!#!####%!#!#####!!!!!#'''''''################",
+       "!!#!##(#!###!#!#####!#!#####!!!!!########################",
+       "!!#!####!###!#!#)))#!#!#####!!!!!########################",
+       "!!#!##(#!###!#!#)))#!#!#####!!!!!########################",
+       "!!#!####!###!#!#)))#!#!##################################",
+       "!!#!##(#!###!#!#)))#!#)##################################",
+       "!!#!####!###!#!#)#)#!#)####)##%%%%%%%%%%#%#%#%#%#%%%%%#%#",
+       "!!#!##(#!###!#!#)))#!#)##################################",
+       "!!#!####!###!#!#)))#!#!##################################",
+       "!!#!##(#!###!#!#)))#!#!##################################",
+       "!!#!####!###!#!#)))#!#!###################!!!!!!!!!!!!!!!",
+       "!!#!##(#!###!#!#####!#!###################!!!!!!!!!!!!!!!",
+       "!!%!####!###!#!####%!#!###################!!!!!!!!!!!!!!!",
+       "##&!!!!!!!!!!#!!!!!!!#!!!!!+++++++#######+###############",
+       "######################!####################,,,,,,,,,,,,,#",
+       "#######################!###################,,,,,,,,,,,,,#",
+       "########################!##################,,,,,,,,,,,,,#",
+       "#########################!#################,,,,,,,,,,,,,#",
+       "########################'#'################,,,,,,,,,,,,,#",
+       "###'!'!'!'!!!!!!!!!!!!!!!!!################,,,,,,,,,,,,,#",
+       "###'########((((!((((!((((!################,,,,,,,,,,,,,#",
+       "###'#'!'!'#!((((#((((!((((!################,,,,,,,,,,,,,#",
+       "#####'#'#'#!((((!((((#((((!##########)###)#,,,,,,,,,,,,,#",
+       "#!!'!'!'!'!!((((!((((!((((#############)#################",
+       "###########!!!!!!!!!!!!!!!!##############################"}
+   acmap={"                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                    #                    ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                  ! ! ! !                ",
+          "                                                         ",
+          "                                                         ",
+          "                   !                                     ",
+          "                    !             ! ! ! !                ",
+          "                     !                                   ",
+          "                      !                                  ",
+          "                       !                                 ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         ",
+          "                                                         "}
+  itmap={"                                                         ",
+         "                                                         ",
+         "                       **                                ",
+         "                     )                                   ",
+         "      % %             *                                  ",
+         "       &                )            .            *      ",
+         "      % %             *  )           .           * *     ",
+         "                     ) **           - -           *      ",
+         "                                  !!9   !                ",
+         "                                    - -                  ",
+         "                 '                   .                   ",
+         "     #             (                 .                   ",
+         "   !                                                     ",
+         "     #                                                   ",
+         "   !                                                     ",
+         "     #                                                   ",
+         "   !                                                     ",
+         "     #                   +      #               #        ",
+         "   !                                                     ",
+         "     #                                                   ",
+         "   !                                                     ",
+         "     #                                                   ",
+         "   !                                                     ",
+         "     #             (                                     ",
+         "                                  ,                      ",
+         "                                                         ",
+         "     $                                                   ",
+         "                                                         ",
+         "                 #       #                               ",
+         "              $                                  /       ",
+         "                   $                                     ",
+         "      #                                                  ",
+         "                                                         ",
+         "                                                         ",
+         "                                                         ",
+         "                                                         "}
+ stmap={"!!!!!!!!!!!!!!!!#<#!!!!!!!!EEEEEEE#######EEEEEEEEEEEEEEEE",
+        "!            9 9 < 9       9  ( 5            ? ? ? ? ? ?E",
+        "!  #       #     <  @@@@@@@   ( 5             ? ? ? ? ? E",
+        "!    )   )       <  @@@@@@@   ( 5            ? ? ? ? ? ?E",
+        "!     .14    ####<# @@@@@@@   ( 5             ? ? ? ? ? E",
+        "! &   /2/    #;##<# @@@@@@@   ( 5            ? ? ? ? ? ?E",
+        "!     01     #9##<# @@@@@@@   ( 5             ? ? # ? ? E",
+        "!    )   )      5<5 @@@@@@@   ( 5    !       ? ? ? ? ? ?E",
+        "!  #       #    5<5 @@@@@@@   ( 5   ! D       ? ? ? ? ? E",
+        "!            9 95<59       9  ( 5    !       ? ? ? ? ? ?E",
+        "!!'!55555555           (((5F5((55             ? ? ? ? 9 E",
+        "55Y)% #3  65     <     =                     ? ? ? ? ? ?E",
+        "   ),- 3 (((           (=                               E",
+        "  Y)% #3  6(           ( =                              E",
+        "   ),- 3   (    < <    =  =               ##############!",
+        "  Y)% #3  6(           #=   GGGGG                       !",
+        "   ),- 3   (    = =     #=  G                           !",
+        "  Y)% #3  6( :  >6> 5   A = 3                 %       K =",
+        "   ),- 3   (    = =     #=  G                           !",
+        "  Y)% #3  6(           #=   GGGGG555555555              !",
+        "   ),- 3   (    < <    =  =      5 5 5 5 5##############!",
+        "  Y)% #3  6(           ( =       5 5 5 5 5               ",
+        "   ),- 3 (((           (=        5 5 5 5 5               ",
+        "55()% #3  65     <     =         5 5 5 5 5               ",
+        "!!'!55555555        5'5((C() )))))2222222)              (",
+        "!$ *     +     *   J    BBBG!!!!!5 5 5 5 5   <  <   <  <(",
+        "!    *   +7++*+   J     BBBAHIIHI5 5 5 5 5  <  <<< <  < (",
+        "!  + ++*+++#+ +  J      CDCGHHIHI5 5 5 5 5 <  <J < J<   (",
+        "!  +     *        J     B B!HHIII5 5 5 5 5   <<  J<   <<(",
+        "!     #      +     J    BCBGHHFHI5 5 5 5 5    < J J G   L",
+        "!          5555555555555555!8HFHI5 5 5 5 5  < < <J <  < (",
+        "!%         8  # ?    ?    5GHHHHH5 5 5 5 5 < < J < J<   (",
+        "!          5    ?  # ?    5!FHFFH555555555     < <<<    (",
+        "!          5    ?    ?  # 5GIHH8H          < <<  <      (",
+        "!          5    ?    ?    8AIHHH8                       (",
+        "###########               5G!!!!!!!!!--------------------"}
+create_world_by_map(level)
+draw_map(0,0,stmap,stones)
+draw_map(0,0,itmap,items)
+draw_map(0,0,acmap,actors)
+SetAttrib(enigma.GetStone(1,25),"on",FALSE)
+SetAttrib(enigma.GetItem(5,11),"invisible",FALSE)
+SetAttrib(enigma.GetItem(5,13),"invisible",FALSE)
+SetAttrib(enigma.GetItem(5,15),"invisible",FALSE)
+SetAttrib(enigma.GetItem(5,17),"invisible",FALSE)
+SetAttrib(enigma.GetItem(5,19),"invisible",FALSE)
+SetAttrib(enigma.GetItem(5,21),"invisible",FALSE)
+SetAttrib(enigma.GetItem(5,23),"invisible",FALSE)
+SetAttrib(enigma.GetItem(6,31),"invisible",FALSE)
+SetAttrib(enigma.GetStone(7,11),"on",FALSE)
+SetAttrib(enigma.GetStone(7,12),"on",FALSE)
+SetAttrib(enigma.GetStone(7,13),"on",FALSE)
+SetAttrib(enigma.GetStone(7,14),"on",FALSE)
+SetAttrib(enigma.GetStone(7,15),"on",FALSE)
+SetAttrib(enigma.GetStone(7,16),"on",FALSE)
+SetAttrib(enigma.GetStone(7,17),"on",FALSE)
+SetAttrib(enigma.GetStone(7,18),"on",FALSE)
+SetAttrib(enigma.GetStone(7,19),"on",FALSE)
+SetAttrib(enigma.GetStone(7,20),"on",FALSE)
+SetAttrib(enigma.GetStone(7,21),"on",FALSE)
+SetAttrib(enigma.GetStone(7,22),"on",FALSE)
+SetAttrib(enigma.GetStone(7,23),"on",FALSE)
+SetAttrib(enigma.GetStone(10,26),"on",FALSE)
+SetAttrib(enigma.GetItem(17,28),"invisible",FALSE)
+SetAttrib(enigma.GetItem(25,28),"invisible",FALSE)
+SetAttrib(enigma.GetStone(28,17),"on",FALSE)
+SetAttrib(enigma.GetItem(32,17),"invisible",FALSE)
+SetAttrib(enigma.GetItem(48,17),"invisible",FALSE)
+SetAttrib(enigma.GetStone(54,17),"on",FALSE)
+if (not difficult) then
+set_floor("fl-acblack",39,8)
+set_item("it-extralife",41,7)
+set_item("it-extralife",41,8)
+set_item("it-extralife",41,9)
+set_item("it-cherry",39,8)
+else
+set_stone("st-glass",49,29)
+set_stone("st-glass",55,29)
+set_item("it-hstrip",39,8)
+end
+Signal ("it(5 23)","st(7 23)")
+Signal ("it(5 21)","st(7 21)")
+Signal ("it(5 19)","st(7 19)")
+Signal ("it(5 17)","st(7 17)")
+Signal ("it(5 15)","st(7 15)")
+Signal ("it(5 13)","st(7 13)")
+Signal ("it(5 11)","st(7 11)")
+Signal ("it(32 17)","st(28 17)")
+Signal ("it(32 17)","st(54 17)")
+Signal ("it(6 31)","st(1 25)")
+Signal ("st(1 25)","st(10 26)")
+Signal ("st(56 29)","st(27 34)")
+Signal ("st(56 29)","st(27 26)")
+Signal ("st(10 26)","st(2 24)")
+Signal ("st(14 5)","st(2 10)")
+Signal ("it(48 17)","st(54 17)")
+Signal ("it(48 17)","st(28 17)")
+Signal ("st(10 26)","st(21 24)")
+Signal ("it(17 28)","st(1 25)")
+Signal ("it(25 28)","st(24 17)")
+oxyd_shuffle()
+    ]]></el:luamain>
+      <el:i18n>
+        <el:string el:key="title">
+          <el:english el:translate="false"/>
+        </el:string>
+        <el:string el:key="subtitle">
+          <el:english el:translate="false"/>
+        </el:string>
+     </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_vii/mecke11_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_vii/pulley10_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/pulley10_2.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/pulley10_2.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,115 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Blue Screen Of Death" el:subtitle="" el:id="pulley10"/>
+      <el:version el:score="2" el:release="2" el:revision="1" el:status="released"/>
+      <el:author  el:name="Mark Pulley" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 Mark Pulley</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.00">
+       <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:score el:easy="4:46" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+function file_oxyd(x,y,f)
+    oxyd_default_flavor=f
+    oxyd(x,y)
+end
+
+create_world(21,13)
+cells={}
+cells[" "]=cell{floor="fl-rough-blue"}
+cells["*"]=cell{stone="st-blue-sand"}
+cells["0"]=cell{parent={{file_oxyd,"b"}}}
+cells["1"]=cell{stone="st-likeoxydc"}
+cells["_"]=cell{stone="st-window"}
+cells["A"]=cell{floor="fl-swamp"}
+cells["B"]=cell{stone="st-stone_break"}
+cells["D"]=cell{stone={face="st-door_a",attr={name="Gate10"}}}
+cells["E"]=cell{item={face="it-trigger",attr={action="close",target="Gate10"}}}
+cells["F"]=cell{stone={face="st-door_a",attr={name="Gate9"}}}
+cells["G"]=cell{stone={face="st-door_a",attr={name="Gate1"}}}
+cells["H"]=cell{stone={face="st-coffee"},item={"it-hammer"}} --hammer hidden under stone
+cells["I"]=cell{stone={face="st-door_a",attr={name="Gate2"}}}
+cells["J"]=cell{stone={face="st-door_a",attr={name="Gate3"}}}
+cells["K"]=cell{stone={face="st-door_a",attr={name="Gate4"}}}
+cells["L"]=cell{stone={face="st-door_a",attr={name="Gate5"}}}
+cells["M"]=cell{stone={face="st-door_a",attr={name="Gate6"}}}
+cells["N"]=cell{stone={face="st-door_a",attr={name="Gate7"}}}
+cells["O"]=cell{stone={face="st-door_a",attr={name="Gate8"}}}
+cells["P"]=cell{stone={face="st-coffee"},item={"it-pin"}} --pin hidden under stone
+cells["Q"]=cell{item={face="it-trigger",attr={action="openclose",target="Gate9"}}}
+cells["R"]=cell{item={face="it-trigger",attr={action="openclose",target="Gate8"}}}
+cells["S"]=cell{item={face="it-trigger",attr={action="callback",target="GateS"}}}
+cells["T"]=cell{item={face="it-trigger",attr={action="openclose",target="Gate1"}}}
+cells["U"]=cell{item={face="it-trigger",attr={action="openclose",target="Gate2"}}}
+cells["V"]=cell{item={face="it-trigger",attr={action="openclose",target="Gate3"}}}
+cells["W"]=cell{item={face="it-trigger",attr={action="openclose",target="Gate4"}}}
+cells["X"]=cell{item={face="it-trigger",attr={action="openclose",target="Gate5"}}}
+cells["Y"]=cell{item={face="it-trigger",attr={action="openclose",target="Gate6"}}}
+cells["Z"]=cell{item={face="it-trigger",attr={action="openclose",target="Gate7"}}}
+cells["a"]=cell{floor="fl-water"}
+cells["c"]=cell{stone="st-coffee"}
+cells["d"]=cell{stone="st-death"}
+cells["e"]=cell{stone={face="st-coffee"},floor={"fl-water"},actor={"ac-top"}} --water hidden under stone
+cells["g"]=cell{stone={face="st-glass1"},floor={"fl-water"}} --water under glass stone
+cells["i"]=cell{floor="fl-ice"}
+cells["k"]=cell{item={face="it-trigger",attr={action="openclose",target="Gate11"}}}
+cells["l"]=cell{stone={face="st-laser-w", attr={on=TRUE}}} -- Laser
+cells["m"]=cell{stone={face="st-door_a",attr={name="Gate11"}}}
+cells["o"]=cell{stone={face="st-door_a",attr={name="Gate12"}}}
+cells["p"]=cell{stone={face="st-door_a",attr={name="Gate13"}}}
+cells["q"]=cell{item={face="it-trigger",attr={action="openclose",target="Gate13"}}}
+cells["r"]=cell{stone={face="st-door_a",attr={name="Gate14"}}}
+cells["s"]=cell{item={face="it-trigger",attr={action="openclose",target="Gate14"}}}
+cells["t"]=cell{stone={face="st-coffee"},actor={"ac-top"}} --Top hidden under stone
+cells["u"]=cell{item="it-blackbomb"}
+cells["v"]=cell{item={face="it-vortex-open", attr={targetx=15.5, targety=11.5}},floor="fl-ice"}
+cells["w"]=cell{item={face="it-vortex-open", attr={targetx=1.5, targety=11.5}},floor="fl-ice"}
+if difficult then
+  cells["f"]=cell{stone="st-death"}
+  cells["h"]=cell{floor="fl-ice"}
+  cells["j"]=cell{stone="st-death"}
+else
+  cells["f"]=cell{stone="st-likeoxydc"}
+  cells["h"]=cell{floor="fl-rough-blue"}
+  cells["j"]=cell{stone="st-blue-sand"}
+end
+
+--      |         1    1    2
+--      |1   5    0    5    0
+level={"*0*******j********0* ",
+       "0rwhfhK  o  O  h  h0 ", -- 1
+       "1pfcht11cccf11111fFcl",
+       "1N1_fs iaaai B L B cl",
+       "fhhheq1iaaai1c1f1Mccl ",
+       "1   fZfiAAAit   c Qcl", -- 5
+       "11c1111t1f1f1 1f1hhcl",
+       "1uuuI hhhh hhhJS1hhcl",
+       "1PfHcGf111c11cfc1fhcl",
+       "f   f hhhm hhhh  cccl",
+       "1 d 1Df111E111fcf  cl", --10
+       "0   t vkTUVWXY  c Rcl",
+       "*0*j*************j** "}
+
+set_default_parent(cells[" "])
+draw_map(0,0,level,cells)
+enigma.SendMessage(enigma.GetNamedObject("Gate10"), "open", nil)
+set_actor("ac-blackball",1.5,11.5,{player=0,name="bb"})
+oxyd_shuffle()
+
+function GateS()
+  enigma.SendMessage(enigma.GetNamedObject("Gate2"), "close", nil)
+  enigma.SendMessage(enigma.GetNamedObject("Gate12"), "openclose", nil)
+end
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_vii/pulley10_2.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_vii/ral14_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/ral14_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_vii/ral14_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,62 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Bold Boulder" el:subtitle="" el:id="20061124ral279"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 96 $" el:status="released"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2006 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+        <el:credits el:showinfo="true">Thanks to Andreas for the idea of a color reduced easy mode</el:credits>
+      </el:comments>
+      <el:score el:easy="5:55" el:difficult="16:56"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+ti[" "] = {"fl-wood"}
+ti["-"] = {"fl-abyss"}
+ti["~"] = {"fl-water"}
+ti["x"] = {"st_oxyd", "oxyd#", flavor="d"}
+ti["#"] = {"st-likeoxydd"}
+ti["N"] = {"st_boulder_n"}
+ti["R"] = {"st_rotator_ccw"}
+ti["B"] = {"st_blocker"}
+ti["b"] = {"it_blocker"}
+ti["I"] = {"st-stoneimpulse_movable"}
+ti["1"] = {"#ac-blackball"}
+
+
+w, h = wo(ti, " ", {
+"-----Rxxxxxxxxx-----",
+"----RbBbBbBbBbBR----",
+"---RBBbbBBbbBBbbR---",
+"--RbbbbBBBBbbbbBBR--",
+"-RB              bR-",
+"xBB              BBR",
+"xbb N 1 ~~~~  I  Bbx",
+"RBb              bBx",
+"-RB              bR-",
+"--RbbbbBBBBbbbbBBR--",
+"---RBBbbBBbbBBbbR---",
+"----RbBbBbBbBbBR----",
+"-----xxxxxxxxxR-----"
+})
+
+if not wo["IsDifficult"] then
+    no["oxyd#*"]["oxydcolor"] = OXYD_BLUE
+end
+
+wo:shuffleOxyd()
+    ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_vii/ral14_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_viii/.gitignore
===================================================================
--- trunk/data/levels/enigma_viii/.gitignore	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_viii/.gitignore	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,2 @@
+/Makefile.in
+/Makefile

Added: trunk/data/levels/enigma_viii/Makefile.am
===================================================================
--- trunk/data/levels/enigma_viii/Makefile.am	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_viii/Makefile.am	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,3 @@
+pkgdatadir = $(datadir)/@PACKAGE@/levels/enigma_viii
+pkgdata_DATA = $(wildcard $(srcdir)/*.xml)
+EXTRA_DIST = $(pkgdata_DATA)


Property changes on: trunk/data/levels/enigma_viii/Makefile.am
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_viii/index.xml
===================================================================
--- trunk/data/levels/enigma_viii/index.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_viii/index.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,14 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
+
+  <info enigma="1.00" group="Enigma" location="10900" network="false" owner="Enigma Team" release="1" revision="1" title="Enigma VIII"/>
+
+  <attributes/>
+
+  <levels>
+    <level _seq="1" _title="Jack-Of-All-Trades" _xpath="./mecke12_1" author="mecke" ctrl="force" easy="true" id="mecke12" rel="1" rev="31" score="1" target="time" unit="duration"/>
+    <level _seq="2" _title="Enigmaparcour" _xpath="./mecke15_1" author="mecke" ctrl="force" easy="true" id="mecke15" rel="1" rev="11" score="1" target="time" unit="duration"/>
+    <level _seq="3" _title="Rhythm of Space" _xpath="./mecke20_1" author="mecke" ctrl="force" easy="true" id="mecke20" rel="1" rev="21" score="1" target="time" unit="duration"/>
+  </levels>
+
+</index>


Property changes on: trunk/data/levels/enigma_viii/index.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_viii/mecke12_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke12_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_viii/mecke12_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,478 @@
+?<?xml version="1.0" encoding="utf-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+  xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd"
+  xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Jack-Of-All-Trades" el:subtitle="Find The Paradise" el:id="mecke12"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 31 $" el:status="released"/>
+      <el:author  el:name="mecke" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="0.92">
+        <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false" el:control="force"
+        el:scoreunit="duration" el:scoretarget="time"/>
+      <el:comments>
+        <el:credits el:showinfo="true" el:showstart="false">Thanks to Ronald Lamprecht for some patterns and code examples</el:credits>
+      </el:comments>
+      <el:score el:easy="20:18" el:difficult="25:52"/>
+    </el:info>
+    <el:luamain><![CDATA[
+function file_oxyd(x,y,f)
+    oxyd_default_flavor=f
+    oxyd(x,y)
+end
+levelh=39
+levelw=60
+enigma.FlatForce=30
+enigma.SlopeForce=30
+enigma.ElectricForce=30
+cells={}
+items={}
+actors={}
+stones={}
+actors[" "]=cell{}
+stones[" "]=cell{}
+cells[" "]=cell{}
+items[" "]=cell{}
+cells["!"]=cell{floor="fl-normal"}
+stones["!"]=cell{stone="st-yellow"}
+stones["#"]=cell{stone="st-death"}
+cells["#"]=cell{floor="fl-rough-blue"}
+cells["$"]=cell{floor="fl-light"}
+stones["$"]=cell{stone="st-knight"}
+stones["%"]=cell{stone="st-grate1"}
+cells["%"]=cell{floor="fl-abyss"}
+cells["&"]=cell{floor="fl-water"}
+cells["'"]=cell{floor="fl-sahara"}
+cells["("]=cell{floor="fl-bluegray"}
+stones["&"]=cell{parent={{file_oxyd,"d"}}}
+cells[")"]=cell{floor="fl-leavesc1"}
+cells["*"]=cell{floor="fl-gradient9"}
+cells["+"]=cell{floor="fl-himalaya"}
+cells[","]=cell{floor="fl-gradient10"}
+stones["'"]=cell{stone="st-actorimpulse_invisible"}
+stones["U"]=cell{stone="st-switch_black"}
+cells["i"]=cell{floor="fl-ice"}
+
+function ac_blackball(x,y)
+n=""
+p=0
+f=0
+ if (x==8) and (y==18) then
+  n="ac8x18"
+  p=0
+  mf=1
+ end
+set_actor("ac-blackball",x+0.5,y+0.5,{player=p,name=n,mouseforce=mf})
+end
+actors["!"]=cell{parent={{ac_blackball}}}
+items["!"]=cell{item="it-extralife"}
+items["#"]=cell{item="it-spring2"}
+items["$"]=cell{item="it-vstrip"}
+stones["("]=cell{stone="st-key_a"}
+stones[")"]=cell{stone="st-key_b"}
+cells["-"]=cell{floor="fl-gradient11"}
+cells["."]=cell{floor="fl-gradient12"}
+items["%"]=cell{item="it-brush"}
+stones["*"]=cell{stone="st-break_bolder"}
+cells["/"]=cell{floor="fl-bluegreenx"}
+stones["+"]=cell{stone="st-glass_move"}
+stones[","]=cell{stone="st-door-v"}
+cells["0"]=cell{floor="fl-space"}
+stones["-"]=cell{stone="st-blue-sand"}
+stones["."]=cell{stone="st-oneway_black-w"}
+stones["/"]=cell{stone="st-oneway_black-e"}
+stones["P"]=cell{stone="st-oneway_black-s"}
+items["&"]=cell{item="it-crack3"}
+stones["0"]=cell{stone="st-brick_magic"}
+stones["1"]=cell{stone="st-rock1_hole"}
+stones["B"]=cell{stone="st-black4"}
+stones["2"]=cell{stone="st-bolder-w"}
+items["'"]=cell{item="it-trigger"}
+items["("]=cell{item="it-springboard"}
+stones["3"]=cell{stone="st-door-h"}
+function ac_top(x,y)
+n=""
+r=0
+f=0
+ init=false
+ if (x==25) and (y==4) then
+  n="ac25x4"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==26) and (y==9) then
+  n="ac26x9"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==27) and (y==4) then
+  n="ac27x4"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==28) and (y==11) then
+  n="ac28x11"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==29) and (y==4) then
+  n="ac29x4"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==30) and (y==9) then
+  n="ac30x9"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==31) and (y==4) then
+  n="ac31x4"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==26) and (y==26) then
+  n="ac31x4"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==26) and (y==28) then
+  n="ac31x4"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==26) and (y==30) then
+  n="ac31x4"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==26) and (y==32) then
+  n="ac31x4"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==26) and (y==34) then
+  n="ac31x4"
+  r=10
+  f=10
+  init=FALSE
+ end
+ if (x==26) and (y==36) then
+  n="ac31x4"
+  r=10
+  f=10
+  init=FALSE
+ end
+set_actor("ac-top",x+0.5,y+0.5,{range=r,force=f,name=n,gohome=init})
+end
+actors["#"]=cell{parent={{ac_top}}}
+stones["4"]=cell{stone="st-laser-e"}
+items[")"]=cell{item="it-coffee"}
+items["*"]=cell{item="it-key_b"}
+items["+"]=cell{item="it-blackbomb"}
+stones["5"]=cell{stone="st-black3"}
+stones["6"]=cell{stone="st-rock1"}
+cells["1"]=cell{floor="fl-rough-red"}
+stones["7"]=cell{stone="st-bolder-e"}
+stones["Z"]=cell{stone="st-bolder-n"}
+stones["Y"]=cell{stone="st-bolder-s"}
+cells["2"]=cell{floor="fl-samba"}
+stones["8"]=cell{stone="st-rock4"}
+items[","]=cell{item="it-wormhole"}
+items["-"]=cell{item="it-puller-n"}
+items["."]=cell{item="it-hstrip"}
+cells["3"]=cell{floor="fl-swamp"}
+stones["9"]=cell{stone="st-actorimpulse"}
+cells["4"]=cell{floor="fl-bluegreen"}
+stones[":"]=cell{stone="st-puzzle-hollow"}
+items["/"]=cell{item="it-hammer"}
+cells["5"]=cell{floor="fl-gradient4"}
+items["0"]=cell{item="it-key_a"}
+items["1"]=cell{item="it-magicwand"}
+items["3"]=cell{item="it-floppy"}
+stones[";"]=cell{stone="st-black4"}
+stones["<"]=cell{stone="st-laser-s"}
+stones["="]=cell{stone="st-laser-n"}
+stones[">"]=cell{stone="st-wood"}
+cells["6"]=cell{floor="fl-acwhite"}
+cells["7"]=cell{floor="fl-gradient14"}
+stones["?"]=cell{stone="st-likeoxydd"}
+stones["@"]=cell{stone="st-glass"}
+stones["A"]=cell{stone="st-door-h-open"}
+items["2"]=cell{item="it-cherry"}
+stones["V"]=cell{stone="st-floppy"}
+stones["W"]=cell{stone="st-stone_break"}
+function ac_rotor(x,y)
+n=""
+r=0
+f=0
+ init=false
+ if (x==58) and (y==18) then
+  n="ac58x18"
+  r=7
+  f=7
+  init=FALSE
+ end
+set_actor("ac-rotor",x+0.5,y+0.5,{range=r,force=f,name=n,gohome=init})
+end
+actors["$"]=cell{parent={{ac_rotor}}}
+level={"!!!!!!!!!!!!!!!!!!!!!!!!!!0!0!0!!!!!!!!!!!!!!!!!!!!!!!!!!!!!",
+       "!%#%################!!!!!!!!!!!!!!!!!%%%%$44$44$2%!!!!!!!!!!",
+       "!#%!!!!!&!&!&!!!!!!#!!!!!0!0!0!0!!!!!22%%%3333322%%!%6%%%%(!",
+       "!%!&&&&&&&&&&&&&&&!#!!!!!!!!!!!!!!!!!%2%%%%32322%%!!!!!&!&!!",
+       "!#!&&&&&)i&i)&&&&&!#!!!!0!0!0!0!0!!!!%2%%%%3032$%%%!(%(&%%(!",
+       "!#!&&&)iiiiiii)&&&!#!!!!!!!!!!!!!!!!!%2222200024%4!!!&!&!!!!",
+       "!#!&!'&iii!iii&'!&!#!!!0!0!0!0!0!0!!!%2%33330334%4%!%&%%(%6!",
+       "!#!&&&)iiiiiii)&&&!#!!!!!!!!!!!!!!!!!22%3$332534%4!!!&!!!&!!",
+       "!#!&&&&&)i&i)&&&&&!#!!0!0!0!0!0!0!0!!%%%33333!5$%%%!%%%%(&%!",
+       "!#!&&&&&&&&&&&&&&&!%!!!!!!!!!!!!!!!!!%%%333333*5%%!!!!!!!&!!",
+       "!#!!!!!!&!!!&!!!!!%#!0!0!0!0!0!0!0!0!%%%%%%%%%$55%%!(%&%%(%!",
+       "!################%#%!!!!!!!!!!!!!!!!!%%%%%%%%%%%*5!!!!!!!!!!",
+       "!!!!!!!!!!!!!!!!!!!!0!0!0!0!0!0!0!0!0!!!!!!!!!!!!*5!%%&%&!%!",
+       "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*!!!!!!!!!",
+       "!!!!!!!!!!!!!!!!!!!//////////////////!!!!!!!!!!!!!!!!!!!$$$!",
+       "!!!!!!!!!!!!!!!!!!!/((((((((((((((((/!!!!!!!!!!!!!!!!!!!$$$!",
+       "!!!!!!*+%%+-!!!!!!!/(!&&&&&&&&&&&&!(/!!!!!!!!!!!!!!!!!!!$$$!",
+       "!!!!!!+%%%%+!!!!!!!/(!!!!!&!!&!!!!!(/!!!!!!!!!!!!!!!!!!!$$$!",
+       "!!!!!!%%''%%!!!!!!!/(!!!&!&!!&!!!!1(/!1!1!1!1!1!1!!!!-!!$$$!",
+       "!!!!!!%%''%%!!!!!!!/(!!!&!&!!&!!!!1(/!1!1!1!1!1!1!!!!7!!$$$!",
+       "!!!!!!+%%%%+!!!!!!!/(!!!!!&!!&!!!!!(/!!!!!!!!!!!!!!!!!!!$$$!",
+       "!!!!!!,+%%+.!!!!!!!/(!&&&&&&&&&&&&!(/!!!!!!!!!!!!!!!!!!!$$$!",
+       "!!!!!!!!!!!!!!!!!!!/((((((((((((((((/!!!!!!!!!!!!!!!!!!!$$$!",
+       "!!!!!!!!!!!!!!!!!!!//////////////////!!!!!!!!!!!!!!!!!!!$$$!",
+       "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!",
+       "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!222%%%%%%%22!!!!!!!!!!",
+       "!iiiiiiiiiiiiiiiiii!!!!!!!!!i!!!!!!!!!2%22%%%%%22%%!!!!!!!!!",
+       "!iiiiiiiiiiiiiiiiii!!!!!!!!!i!!!!!!!!!%%%22%%%22%%!!!!!!!!!!",
+       "!iiiiiiiiiiiiiiiiii!!!!!!!!!i!!!!!!!!!%%%%22%22%%%%!!!!!!!!!",
+       "!ii&&&&&&&&&&&&&&ii!!!!!!!!!!!!!!!!!!!%%%%%222%%%%!!!!!!!!!!",
+       "!ii&&&&&&&&&&&&&&ii!!!!!&!!!i!!!&&!!&!%%%%/%%%/%%%%!!!!!!!!!",
+       "!ii&&&&&&&&&&&&&&ii!!!!&!&!!i!!&!!&!!!%%%%%%%%%%%%!!!!!!!!!!",
+       "!$i&&&&&&&&&&&&&&i$!!!&!0!&!i!&!00!&&!%%/%/%%%/%/%%!!!!!!!!!",
+       "!$$&&&&&&&&&&&&&&$$!!!!&!&!!!!!&!!&!!!%%%%%%%%%%%%!!!!!!!!!!",
+       "!$$&&&&&&&&&&&&&&$$!!!!!&!!!i!!!&&!!&!/%/%%($(%%/%/!!!!!!!!!",
+       "!$$&&&&&&&&&&&&&&$$!!!!!!!!!i!!!!!!!!!%%%%(%$%(%%%!!!!!!!!!!",
+       "!$$i$$i$i$$i$i$$i$$!!!!!!!!!i!!!!!!!&!%%%(33333(%%%!!!!!!!!!",
+       "!$$$$$$$$ii$$$$$$$$!!!!!!!!!!!!!!!!!!!2%%%%242%%%%!!!!!!!!!!",
+       "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"}
+   acmap={"                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "                         # # # #                            ",
+          "                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "                          #   #                             ",
+          "                                                            ",
+          "                            #                               ",
+          "                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "        !                                                 $ ",
+          "                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "                                                            ",
+          "                          #                                 ",
+          "                                                            ",
+          "                          #                                 ",
+          "                                                            ",
+          "                          #                                 ",
+          "                                                            ",
+          "                          #                                 ",
+          "                                                            ",
+          "                          #                                 ",
+          "                                                            ",
+          "                          #                                 ",
+          "                                                            ",
+          "                                                            "}
+  itmap={"                                                            ",
+         "                                            /    .          ",
+         "                       '  '   '  '                          ",
+         "                                                            ",
+         "                                                            ",
+         "                                                .           ",
+         "         ! !                                                ",
+         "                          ) * )  +       !     0.           ",
+         "                                                            ",
+         "                                                            ",
+         "                                                            ",
+         "                                                            ",
+         "                                                            ",
+         "                                                            ",
+         "                                                            ",
+         "                           !!                            2  ",
+         "                                                            ",
+         "                     &     && &                          2  ",
+         "                                '                   '       ",
+         "         #                      '                   '    2  ",
+         "                     &     && &                             ",
+         "                                                         2  ",
+         "                                                            ",
+         "                                                            ",
+         "                     222222 2 2222222                       ",
+         "                                                            ",
+         "                                                            ",
+         "                            2                               ",
+         "                                                            ",
+         "                            2             $   $             ",
+         "                                                            ",
+         "                            2             $   $             ",
+         "                                         .     .            ",
+         "                            2           $       $           ",
+         "                                      3.         .1         ",
+         "                            2                               ",
+         "                                            /               ",
+         "                                                            ",
+         "                                                            "}
+ stmap={"!!!!!!!!!!!!!!!!!!!!$---------------$6666666U66666688#888888",
+        "!          WWW*W*WWW$-- - - - - - --$    6     6   ;       8",
+        "! %%%%%%%%%%%%%%%%%W$.             .$.   +6   6  6 #   #   8",
+        "! %               %W$-- -3-3-3-3- --$    + 6 6  6 68       8",
+        "! %     >   >     % $- -         - -$    + #:# 6   #   #   8",
+        "! %      0(0      % #-- - - - - - --#    + :::    68       8",
+        "! % >     >W    > > $-             -$    + #:# 6 + #   #   8",
+        "! %      0)0      % $/;;;         5/$/   + 6  6   68       8",
+        "! %     >   >     % $-             -$    +  6  6   #   #   8",
+        "! %               % $-  -   -   -  -#    +   6  6 68       8",
+        "! %%%%%%%%P%%%%%%%% $-     = =     -$    +    6  6 #   #   8",
+        "!                   #--   -   -   --$    +     6  68       8",
+        "!!!!!!!PPPP!!!!!!!!!$-             -$666666666666  8       8",
+        "#######PPPP########*-*-*-*-*-*-*-*-*-!!!!!!!!!!!!! !!!!!6A66",
+        "#                 %                  %  9              9   6",
+        "#                 %                  %       9           + 6",
+        "#                 %                  %             9       6",
+        "#                 %   #### %%  %%%6  %88888888888888<8!8 @ 6",
+        "#                 %   ## 4     %                  2   ?8   6",
+        "#                 %   ## 4     %                  2   ?8 @ 6",
+        "#                 %   #### %%  %%%6  %88888888888888=8!8   6",
+        "#                 %                  %             9     @ 6",
+        "#                 %                  %       9             6",
+        "#                 %                  %   9             9   6",
+        "###################000000000000000000!!!!!!!!!!!!! !!!!!6366",
+        "!!!!!!!!!!!!!!!!!!!!6      #B#       6            -.%%%6@@@8",
+        "!$$$$$$$$$$$$$$$$$$!6      $B$       6      #      #%%%#6@@8",
+        "!                  !61     #B#      16      #     68>%>6@@@8",
+        "!3!%%%%%%%%%%%%%%!3!62     $B$      76      #      # > #6@@8",
+        "!  %ZZ Z ZZ Z ZZ%  !62     #B#      76            68   6@@@8",
+        "!  %            %  !62     $B$      76      #      # > #6>>8",
+        "!  %            %  !62     #B#      76   #3###3#  68> >6   8",
+        "V  %&& & && & &&% B,$2     $B$      76      #      #   #6  8",
+        "!  %            %  !62     #B#      76      #     68>>>6>>>8",
+        "!W %            %  !62     $B$      76     6 6     #   #6  8",
+        "!*W%YY Y YY Y YY%  !62     #B#      76    6   6   68>>>6@  8",
+        "!A!%%%%%%%%%%%%%%!A!62     $B$      76   6     6   #   #6@ 8",
+        "!WWWWW*WW WWW*     !62     #B#      .     6   6   68 # .  @8",
+        "!!!!!!!!!!!!!!!!!!!!-----------------6666666U666666888888888"}
+
+create_world_by_map(level)
+draw_map(0,0,stmap,stones)
+draw_map(0,0,itmap,items)
+draw_map(0,0,acmap,actors)
+set_item("it-vortex-open",50,24,{targetx= 44.5,targety = 35.5 })
+set_item("it-vortex-open",44,35)
+Signal ("it(44 35)", "it(53 35)")
+Signal ("it(44 35)", "it(50 24)")
+set_item("it-vortex-open",51,25,{targetx= 48.5,targety = 25.5 })
+set_item("it-vortex-open",48,25,{targetx= 51.5,targety = 25.5 })
+set_item("it-vortex-open",38,25,{targetx= 38.5,targety = 37.5 })
+set_item("it-vortex-open",38,37,{targetx= 38.5,targety = 25.5 })
+set_item("it-vortex-open",53,35,{targetx= 50.5,targety = 24.5 }) 
+--set_item("it-vortex-open",44,34,{targetx= 50.5,targety = 24.5 }) 
+SetAttrib(enigma.GetItem(23,2),"invisible",FALSE)
+SetAttrib(enigma.GetStone(25,18),"on",FALSE)
+SetAttrib(enigma.GetStone(25,19),"on",FALSE)
+SetAttrib(enigma.GetItem(26,2),"invisible",FALSE)
+SetAttrib(enigma.GetItem(30,2),"invisible",FALSE)
+SetAttrib(enigma.GetItem(32,18),"invisible",FALSE)
+SetAttrib(enigma.GetItem(32,19),"invisible",FALSE)
+SetAttrib(enigma.GetItem(33,2),"invisible",FALSE)
+--SetAttrib(enigma.GetItem(38,25),"strength",2)
+--SetAttrib(enigma.GetItem(38,25),"range",2)
+--SetAttrib(enigma.GetItem(51,25),"strength",2)
+--SetAttrib(enigma.GetItem(51,25),"range",2)
+SetAttrib(enigma.GetStone(52,17),"on",FALSE)
+SetAttrib(enigma.GetItem(52,18),"invisible",FALSE)
+SetAttrib(enigma.GetItem(52,19),"invisible",FALSE)
+SetAttrib(enigma.GetStone(52,20),"on",FALSE)
+SetAttrib(enigma.GetStone(27,10),"on",FALSE)
+SetAttrib(enigma.GetStone(29,10),"on",FALSE)
+SetAttrib(enigma.GetStone(0,32),"on",FALSE)
+
+if (not difficult) then
+set_item("it-flagblack",12,18)
+set_item("it-extralife",12,19)
+set_item("it-pin",58,37)
+set_floor("fl-ice",32,30)
+set_floor("fl-ice",33,30)
+set_floor("fl-ice",32,34)
+set_floor("fl-ice",33,34)
+else
+set_item("it-death",12,14)
+set_item("it-death",12,16)
+set_item("it-death",12,18)
+set_item("it-death",12,20)
+set_item("it-death",12,22)
+set_item("it-death",12,24)
+set_item("it-death",4,14)
+set_item("it-death",16,16)
+set_item("it-death",6,18)
+set_item("it-death",17,20)
+end
+Signal ("it(52 18)","st(52 17)")
+Signal ("it(52 19)","st(52 20)")
+Signal ("it(32 18)","st(25 18)")
+Signal ("it(32 19)","st(25 19)")
+Signal ("it(52 18)","st(27 10)")
+Signal ("it(52 19)","st(29 10)")
+Signal ("it(32 18)","st(27 10)")
+Signal ("it(32 19)","st(29 10)")
+Signal ("it(33 2)","st(31 3)")
+Signal ("it(30 2)","st(29 3)")
+Signal ("it(26 2)","st(27 3)")
+Signal ("it(23 2)","st(25 3)")
+Signal ("st(10 5)","st(19 32)")
+Signal ("st(10 7)","st(57 24)")
+--Signal ("it(51 25)","fl(49 25)")
+--Signal ("it(38 25)","fl(38 37)")
+Signal ("st(44 38)","st(42 31)")
+Signal ("st(44 0)","st(46 31)")
+Signal ("st(28 25)","st(22 32)")
+Signal ("st(0 32)","st(1 28)")
+Signal ("st(0 32)","st(18 28)")
+oxyd_shuffle()
+    ]]></el:luamain>
+      <el:i18n>
+        <el:string el:key="title">
+          <el:english el:translate="true"/>
+          <el:translation el:lang="de">Sei ein Hans Dampf ... in allen Gassen</el:translation>
+        </el:string>
+        <el:string el:key="subtitle">
+          <el:english el:translate="true"/>
+          <el:translation el:lang="de">Finde das Paradies</el:translation>
+        </el:string>
+      </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_viii/mecke12_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_viii/mecke15_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke15_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_viii/mecke15_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,159 @@
+<?xml version="1.0" encoding="utf-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+  xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd"
+  xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Enigmaparcour" el:subtitle="Open the Doors" el:id="mecke15"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 11 $" el:status="released"/>
+      <el:author  el:name="mecke" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false" el:control="force"
+        el:scoreunit="duration" el:scoretarget="time"/>
+      <el:comments>
+        <el:credits el:showinfo="true" el:showstart="false">Thanks to Raoul Bourquin for the patterns, in the new API,
+		and to Ronald Lamprecht for the "bottlepattern"</el:credits>
+      </el:comments>
+      <el:score el:easy="14:51" el:difficult="18:10"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = true
+
+if wo ["IsDifficult"] then
+ti[" "] = {"fl-abyss_fake"}
+ti["v"] = {"fl-ice"}
+ti["+"] = {"ac-rotor", 0.5, 0.5,}
+else
+ti[" "] = {"fl-rough"}
+ti["v"] = {"fl-rough"}
+ti["+"] = {"ac-rotor", 0.5, 0.5}
+end
+ti["~"] = {"fl-water"}
+ti["_"] = {"fl-swamp"}
+ti["."] = {"fl-space"}
+
+ti["t"] = {"st-stone_break"}
+ti["U"] = ti[" "] .. {"st-black4"}
+ti["u"] = ti["_"] .. {"st-grate2"}
+ti["i"] = ti["U"] .. {"fl-inverse"}
+ti["w"] = ti["U"] .. {"fl-water"}
+ti["("] = {"fl-gradient", type=3}
+ti["#"] = ti[" "] .. {"st_lightpassenger"}
+ti["K"] = ti[" "] .. {"st-knight"}
+ti["D"] = ti[" "] .. {"st-death"}
+ti["d"] = ti[" "] .. {"st-death_invisible"}
+ti["B"] = ti[" "] .. {"st-brick_magic"}
+ti["O"] = ti[" "] .. {"st_rotator_ccw", movable=true}
+ti["R"] = ti[" "] .. {"st-rubberband"}
+ti["T"] = ti[" "] .. {"st-thief"}
+ti["r"] = ti[" "] .. {"st-brownie"}
+ti["H"] = ti["i"] .. {"st_key", code=1, target={"door#5"}}
+ti["G"] = ti["_"] .. {"st-glass"}
+ti["Y"] = ti[" "] .. {"st-glass"}
+ti["L"] = ti["_"] .. {"st_laser_e", name="laser", state=ON}
+ti["h"] = ti[" "] .. {"st-bluegray_hole"}
+ti["A"] = ti["~"] .. {"st-actorimpulse"}
+ti["I"] = ti[" "] .. {"st-oneway_black-w"}
+ti["^"] = ti[" "] .. {"st_boulder_n"}
+ti[">"] = ti["v"] .. {"st_boulder_e"}
+ti["<"] = ti[" "] .. {"st_boulder_w"}
+ti["3"] = ti["v"] .. {"st-wood"}
+ti["2"] = ti[" "] .. {"st-oneway_black-s"}
+ti["4"] = ti[" "] .. {"st-oneway-w"}
+ti["6"] = ti[" "] .. {"st-oneway-e"}
+ti["8"] = ti[" "] .. {"st-oneway_black-n"}
+ti["Q"] = ti[" "] .. {"st-stone_break"}
+ti["m"] = ti["_"] .. {"st-pmirror", movable=false, transparent=true, orientation=2}
+ti["M"] = ti["_"] .. {"st-pmirror", movable=false, orientation=1}
+ti["X"] = ti["~"] .. {"st_oxyd", flavor="a"}
+ti["S"] = ti["_"] .. {"st_laserswitch", target={"door#7", "door#8"}}
+ti[":"] = ti[" "] .. {"st-door-v", name="door#"}
+ti["9"] = ti[" "] .. {"st-turnstile"}
+ti["?"] = ti["~"] .. {"st-actorimpulse_invisible"}
+ti["z"] = ti["v"] .. {"st-stone_break"}
+ti["N"] = ti["t"] .. {"fl-ice"}
+ti["-"] = ti["~"] .. {"it-hstrip"}
+ti["b"] = ti["~"] .. {"it-booze"}
+ti["o"] = {"it-springboard"}
+ti["P"] = {"st-grate1"}
+
+ti["*"] = {"ac-blackball", 0.5, 0.5}
+
+ti["="] = {"ac-horse", 0.5, 0.5}
+
+w, h = wo(ti, " ", {
+"#########################",
+"#iHwiiidddddd . = . #vvv#",
+"#iwwiww hhh d~~.D.~~#vXv#",
+"#iiwiiw TTT  r      #vvv#",
+"#wiiwii  *  DAAAAA2##vXv#",
+"#MGGmGM- ~ -6+vvvv6v#vvv#",
+"#__GGGG~~9~~K########vXv#",
+"#L_GMGM- ~ -:::::::::KKK#",
+"#__GGGG~~9~~K########vXv#",
+"#SuGmGM- ~ -43<Nvvv #vvv#",
+"#>^^^ Y     D Q888Q #vXv#",
+"#^^^^UU hTh BO  O  D#vvv#",
+"#    UU ThT B ??o?? #vXv#",
+"#RRRRRR hhh B  Pb   #vvv#",
+"#########################"
+})
+
+base = st({1,1})
+if wo ["IsDifficult"] then
+wo[base+{12, 4}] = {"fl-rough"}
+else
+wo[base+{12, 4}] = {"fl-rough"}
+end
+wo[base+{8, 9}] = {"ac-top", 0.5, 0.5, range=1, force=1} 
+wo[base+{8, 3}] = {"it-crack3"} 
+wo[base+{8, 4}] = {"st-turnstile-n"}
+wo[base+{8, 6}] = {"st-turnstile-s"}
+wo[base+{7, 7}] = {"st-turnstile-w"}
+wo[base+{9, 7}] = {"st-turnstile-e"}
+
+wo[base+{18, 11}] = {"it_key", code=1}
+wo[base+{8, 1}] = {"it-glasses"}
+wo[base+{8, 0}] = {"it_umbrella_new"}
+wo[base+{0, 11}] = {"it-magicwand"}
+wo[base+{5, 11}] = {"it_extralife"}
+wo[base+{8, 11}] = {"it-cherry"}
+wo[base+{8, 12}] = {"it-cherry"}
+wo[base+{5, 0}] = {"it_hammer"}
+wo[base+{11, 8}] = {"it_wrench"}
+wo[base+{12, 0}] = {"it_brush"}
+wo[base+{12, 0}] = {"fl-gradient", type=3}
+
+wo[base+{3, 8}] = {"it_cross"}
+wo[base+{3, 9}] = {"it_cross"}
+
+wo[base+{2,3}] = {"it_vortex_open", name="vortex1", destination="vortex2"}
+wo[base+{3,2}] = {"it_vortex_open", name="vortex2", destination="vortex1"}
+
+wo[base+{3, 9}] = ti["~"]
+wo[base+{2, 9}] = ti["~"]
+wo[base+{3, 6}] = {"st-pmirror", movable=false, orientation=4}
+
+wo[base+{18, 0}] = {"it_trigger", target="door#2"}
+wo[base+{18, 4}] = {"it_trigger", target="door#1"}
+wo[base+{11, 2}] = {"it_trigger", target="laser"}
+wo[base+{4, 9}] = {"it_trigger", target="door#3"}
+wo[base+{18, 8}] = {"it_trigger", target="door#4"}
+wo[base+{18, 12}] = {"it_trigger", target="door#9"}
+wo[base+{18, 9}] = {"it_trigger", target="door#6"}
+
+wo:shuffleOxyd()
+    ]]></el:luamain>
+      <el:i18n>
+        <el:string el:key="title">
+          <el:english el:translate="false"/>
+        </el:string>
+        <el:string el:key="subtitle">
+          <el:english el:translate="true"/>
+	  <el:translation el:lang="de">?ffne die Tore</el:translation>
+        </el:string>
+     </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_viii/mecke15_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_viii/mecke20_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke20_1.xml	2008-05-16 20:34:30 UTC (rev 1148)
+++ trunk/data/levels/enigma_viii/mecke20_1.xml	2008-05-17 09:55:43 UTC (rev 1149)
@@ -0,0 +1,422 @@
+?<?xml version="1.0" encoding="utf-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+  xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd"
+  xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected >
+    <el:info el:type="level">
+      <el:identity el:title="Rhythm of Space" el:subtitle="Only A Labyrinth" el:id="mecke20"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 21 $" el:status="released"/>
+      <el:author  el:name="mecke" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="0.92">
+        <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false" el:control="force"
+        el:scoreunit="duration" el:scoretarget="time"/>
+      <el:score el:easy="25:13" el:difficult="29:14"/>
+    </el:info>
+    <el:luamain><![CDATA[
+function file_oxyd(x,y,f)
+    oxyd_default_flavor=f
+    oxyd(x,y)
+end
+levelh=49
+levelw=77
+enigma.FlatForce=30
+enigma.SlopeForce=30
+enigma.ElectricForce=30
+cells={}
+items={}
+actors={}
+stones={}
+actors[" "]=cell{}
+stones[" "]=cell{}
+cells[" "]=cell{}
+items[" "]=cell{}
+cells["!"]=cell{floor="fl-abyss"}
+stones["!"]=cell{stone="st-puzzle-nesw"}
+stones["#"]=cell{stone="st-death"}
+cells["#"]=cell{floor="fl-normal"}
+stones["$"]=cell{parent={{file_oxyd,"b"}}}
+cells["$"]=cell{floor="fl-space"}
+stones["%"]=cell{stone="st-glass"}
+cells["%"]=cell{floor="fl-rough-blue"}
+stones["&"]=cell{stone="st-actorimpulse_invisible"}
+cells["&"]=cell{floor="fl-rough-red"}
+items["!"]=cell{item="it-extralife"}
+stones["'"]=cell{stone="st-yellow"}
+cells["'"]=cell{floor="fl-bluegray"}
+stones["("]=cell{stone="st-grate3"}
+cells["("]=cell{floor="fl-sahara"}
+stones[")"]=cell{stone="st-door-h"}
+items["#"]=cell{item="it-wormhole"}
+stones["*"]=cell{stone="st-stone_break"}
+function ac_top(x,y)
+n=""
+r=0
+f=0
+ init=false
+ if (x==6) and (y==3) then
+  n="ac6x3"
+  r=1
+  f=1
+  init=FALSE
+ end
+ if (x==6) and (y==4) then
+  n="ac6x4"
+  r=1
+  f=1
+  init=FALSE
+ end
+ if (x==6) and (y==5) then
+  n="ac6x5"
+  r=1
+  f=1
+  init=FALSE
+ end
+ if (x==6) and (y==6) then
+  n="ac6x6"
+  r=1
+  f=1
+  init=TRUE
+ end
+set_actor("ac-top",x+0.5,y+0.5,{range=r,force=f,name=n,gohome=init})
+end
+actors["!"]=cell{parent={{ac_top}}}
+cells[")"]=cell{floor="fl-acblack"}
+stones["+"]=cell{stone="st-white3"}
+stones[","]=cell{stone="st-black3"}
+stones["-"]=cell{stone="st-grate1"}
+items["$"]=cell{item="it-seed_nowood"}
+stones["."]=cell{stone="st-block"}
+stones["/"]=cell{stone="st-break_invisible"}
+stones["0"]=cell{stone="st-puzzle-e"}
+stones["1"]=cell{stone="st-rock6"}
+stones["2"]=cell{stone="st-puzzle-s"}
+stones["3"]=cell{stone="st-turnstile-green"}
+stones["4"]=cell{stone="st-puzzle-n"}
+stones["5"]=cell{stone="st-puzzle-w"}
+stones["6"]=cell{stone="st-key_a"}
+stones["7"]=cell{stone="st-key_b"}
+stones["8"]=cell{stone="st-key_c"}
+stones["9"]=cell{stone="st-rotator_move-left"}
+stones[":"]=cell{stone="st-puzzle-es"}
+stones[";"]=cell{stone="st-puzzle-ns"}
+stones["<"]=cell{stone="st-puzzle-hollow"}
+stones["="]=cell{stone="st-puzzle-ne"}
+items["%"]=cell{item="it-spring2"}
+stones[">"]=cell{stone="st-puzzle-ew"}
+cells["*"]=cell{floor="fl-abyss_fake"}
+items["&"]=cell{item="it-trigger"}
+cells["+"]=cell{floor="fl-water"}
+stones["?"]=cell{stone="st-puzzle-sw"}
+stones["@"]=cell{stone="st-puzzle-esw"}
+stones["A"]=cell{stone="st-puzzle-nw"}
+items["'"]=cell{item="it-key_a"}
+stones["B"]=cell{stone="st-puzzle-nes"}
+function ac_blackball(x,y)
+n=""
+p=0
+f=0
+set_actor("ac-blackball",x+0.5,y+0.5,{player=p,name=n,mouseforce=mf})
+end
+actors["#"]=cell{parent={{ac_blackball}}}
+stones["C"]=cell{stone="st-puzzle-nsw"}
+items["("]=cell{item="it-key_c"}
+items[")"]=cell{item="it-pipe-h"}
+stones["D"]=cell{stone="st-break_bolder"}
+items["*"]=cell{item="it-pipe-sw"}
+items["+"]=cell{item="it-pipe-ne"}
+stones["E"]=cell{stone="st-oneway_black-s"}
+stones["F"]=cell{stone="st-mirror-p-tm"}
+items[","]=cell{item="it-puller-e"}
+cells[","]=cell{floor="fl-swamp"}
+stones["G"]=cell{stone="st-laser-w"}
+items["-"]=cell{item="it-spoon"}
+stones["H"]=cell{stone="st-oneway_black-e"}
+items["."]=cell{item="it-key_b"}
+items["/"]=cell{item="it-crack2"}
+items["0"]=cell{item="it-document"}
+items["1"]=cell{item="it-hstrip"}
+items["2"]=cell{item="it-puller-w"}
+items["3"]=cell{item="it-pipe-es"}
+items["4"]=cell{item="it-blackbomb"}
+stones["I"]=cell{stone="st-door-v"}
+items["5"]=cell{item="it-flagblack"}
+stones["J"]=cell{stone="st-oneway_black-n"}
+stones["K"]=cell{stone="st-bluegray"}
+stones["L"]=cell{stone="st-mail-n"}
+stones["M"]=cell{stone="st-brake"}
+items["6"]=cell{item="it-shogun-m"}
+items["7"]=cell{item="it-vstrip"}
+stones["N"]=cell{stone="st-pull"}
+items["8"]=cell{item="it-springboard"}
+cells["-"]=cell{floor="fl-stwood1"}
+cells["."]=cell{floor="fl-stwood2"}
+stones["O"]=cell{stone="st-wood"}
+level={"!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!",
+       "!!$$$$%('(!!!!!!('(!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&!!",
+       "!$&$$$%('(''''''''''''''''''''''''''(!'''''''''''''!!!!!!+!!!!!!!!!!!!!!+!%&!",
+       "!$$&$$%('(!!!!!!('(!!!!!!!!!!!!!!!!!!!'!!!(!!!(!!!'!!!!!!!+!!!!!!!!!!!!+!!!!!",
+       "!$$$&$%('(!!!!!!!!!!!!!!!!!!!!!!!!!!!!'!!!(((((!!!'!!!!!!!!+!!!!!!!!!!+!!!)!!",
+       "!$$$$&%('(!!!!!!!!!!!!!!!!!!!!!!!!!!!!'!!()!(!)(!!'!!!)$)!!!+!!!!!!!!!!!!((!!",
+       "!%%%%%%('(!!!!!!!!!!!!!!!!!!!!!!!!!!!!'(()(!(!()(('()($($()($()(!!!!!!!!!((!!",
+       "!!!!!!!!'!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'!!()!(!)(!!'!!!)$)!!!+!!$!!!!!!!!!!!!!",
+       "!!!!!!!!'!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'!!$($!$($!!'!!!!(!!!!!+!(!!!!!!!+!!!!!",
+       "!!!!!!!!'!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'!$$$$$$$$!!'!!!!$!!!!!!+$!!!!!!+!!((!!",
+       "!!!!!!!!'!!!!!!!**************!!!!!!!!'!$$$$$$$$$!'!))!(!!!!!!!+!!!!!+!!!((!!",
+       "!!!!!!!'(!!!!!!!*******!******!!!!!!!!%&%'','',''',($!!$!($(!!&%&!!!!!!!!)!!!",
+       "!!!!!!'(!!!!!!!!**%!%&*!!!&!%*!!!!!!!!&!&!!+$$+!!!+!))!()(!(!!%!%+!!!!!!!!)!!",
+       "!!!!!'(!!!!!!!!!***%&%*!*!!%&*!!!!!!!!%&%!!+''+!!!+!!!!!!!!!!!&%&!+!!!!!!((!!",
+       "!!!!'(!!!!!!!!!!****%&*!**!!%*!!!!!!!!!!+!!+$$+!!!+!!!!!!!!!!!!!!+!!!+!!!((-!",
+       "!!!'(!!!!!!!!!!!!******!******!!!!!!!!!!!!!!''!!!!!!!!!!!!!!!!!!!!!!!!+!!!!.!",
+       "!!!!'(!!!!!!!!!!!******!******!!!!!!!((((!!((((!!!(((($$$$$$$$$'!!!!!!!+!!!.-",
+       "!!!!!'(!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!(!!(!!(!!(!!!(*(!!!!!!!!!'!'!!!!!!!!!!-.",
+       "!!!!!!'(!!!!!!!!!!!!!!!!!!!!!!!!!!!!!(!!((((!!((((((!!!!!!!!!!!'!!!!!!!!!!!!.",
+       "!!!!!!!'(!!!!!!!!!!!!!!!!!!!!!!!!!!!!(!!+!!+!!+!!!('!!!!!!!!!!!!!!!!!!!!!!!!.",
+       "!!!!!!!!'!!!!!!!('((!!!!!!!!!!!!!!!!!(!!!!!!!!!!!!!'!!!!!!!!!!!!!!!!!!!!!!!!.",
+       "!!!!!!!!'!!!!!!!!'!(((((((((((((!!!!!(!!+!!!!!+!!!('!!!!!!!!!!!!!!!!!!!!!!!..",
+       "!!!!!!!!'!!!!!!!!'!!!!!!!!!!!!!(((((((!!!!!+!!+!!!((!!!!!!!!!!!!!!!!!!!!!!!-.",
+       "!!!!!!!!'!!!!!!!!'!!!!!!!!!!!!!!('$'$(!!+!!+!!)'!!(((!!!!!!!!!!!!!!!!!!!!!!-!",
+       "!!!!!!!!'!!!!!!!!'!!!!!!!!!!!!!!!('$'(!!+!!!!!+!!!((((!!!!!!!!!!!!!!!!!!!!!.!",
+       "!!!!!!!!'!!!!!!!!'!!!!!!!!!!!!!!!!('(!!!!!!!!!+!!!+!!$!!!!!!!!!!!!!!!!!!!!!$!",
+       "!!!!!!!!'!!!!!!!!'!!!!!!!!!!!!!!!!!(!!!!!!!+!!!!!!+!!$$!!!!!!!!!!!!!!!!!!!!$!",
+       "!!!!!!!!'!!!!!!!!((!!!!!!!!!!!!!!!!!!!!!+!!+!!+!!!+!!&%&!!!!!!!!!!!!!!!!!!!$!",
+       "!!!!!!!!'!!!!!!!!!((!!!!!!!!!!!!!!!!!!!!$!!$!!$!!!$!!%!%$!!!!!!!!!!!!!!!!!!'!",
+       "!!!!!!)))))!!!!!!!!((!!!!!!!!!!!!!!!!!!!$!!$!!$!!!!!!&%&))!!!!!!!!!!!!!!!!'$!",
+       "!!!!$!)((()!!!!!!!!!(!!!!!!!!(!!!!!!!!!!$!!$!!!!!!$!!!!!)$(!!!!!!!!!!!!!!'&%!",
+       "!!!$(((((((((((((((((''''''(*(*(!!!!!!!!$!!(*!$!!!$!!!!!$($(!!!'((((((((((%!!",
+       "!!!!$!)((()!!!!!!!!!(!!!!!!!!*!'!!!!!!!!$!!'(*$!!!!!!!!!($($(!!!!!!!!!!!!'&%!",
+       "!!!!!!))())!!!!!!!!((!!!!!!!!*!'!!!!!!!!$!!'!(*!!!!!!!!!$($(!!!!!!!!!!!!!!'$!",
+       "!!!!!!!!(!!!!!!!!!((!!!!!!!!!!!'!!!!!!!!$!!'!!(*!!$!!!!!$$(!!!!!!!!!!!!!!!!'!",
+       "!!!!!!!!(!!!!!!!!((!!!!!!!!!!!!'!!!!!*!!!!!'!!!(*!$!!%&%$$!!!!!!!!!!!!!!!!!$!",
+       "!!!!!!!!(!!!!!!!!(!!!!!!!!!!!!!'!!!!&*&!!!!'!!!!(*$!!&!&$!!!!!!!!!!!!!!!!!!'!",
+       "!!!!!!!!(!!!!!!!!'!!!!!!!!!!!!!'(!!**!**((('!!!!!(*!$%&%!!!!!!!!!!!!!!!!!!!$!",
+       "!!!!!!!!(!!!!!!!!'!!!!!!!(!!!!!!((!!&*&(((('!!!!!!(*($!!!!!!!!!!!!!!!!!!!!!'!",
+       "!!!!!!!!(!!!!!!!!'!!!!!!!(!!!!!!(((!!*!((((!!!!!!!!(!!!!!!!!!!!!!!!!!!!!!!!$!",
+       "!!!!!!!!(!!!!!!!!'!!!!!!!!!!!!!!!(((!!!(((!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'!",
+       "!%%%%%&($(!!!!!!!'!!!!!!!!!!!!!!!!!(((((((!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!$!",
+       "!%%&%&%&(!!!!!!!!'!!!!!!!!!!!!!!!!!((((((!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'!",
+       "!%&$&$&%%!!!!!!!!'!!!!!!!!!!!!!!!!!!((((!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!$!",
+       "!&$$$$$&%&%$(!!!!+!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'!!!!!!!!!!!!!!!!!!!!!!!'!",
+       "!$$$$$$$&%&!($!!!+!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'$'!!!!!!!!!!!!!!!!'!!!!!$!",
+       "!$$$$$$$$&%!$($!!+!!!!!!!!!!!!!!!'!!!!!!!!!!!!!!!'$!$'!!!!!!!!!!!!!!'$'!!!%&!",
+       "!!$$$$$$&%%!$(((!+!((($$$$$$$$$$$$$$$'$$$$$$$$$$'$!!!$'$$$$$$$$$$$$'$+$'''&!!",
+       "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"}
+   acmap={"                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "      !                                                                      ",
+          "      !                                                                      ",
+          "      !                                                                      ",
+          "      !                                                                      ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                             #                                               ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             ",
+          "                                                                             "}
+  itmap={"                                                                             ",
+         "       $$$                                                                #  ",
+         "                 &                          ,                                ",
+         "                                                                             ",
+         "                                          !   !                           8  ",
+         "                                                                             ",
+         "                                                                         !   ",
+         "                                            #                             7  ",
+         "                                                                          7  ",
+         "                                        ****----                             ",
+         "                                        ++++----0  4  )                      ",
+         "                                                   5    )                8   ",
+         "                                                   4      )               8  ",
+         "                    #       #                               )                ",
+         "                                                                         !   ",
+         "                                                                             ",
+         "                                      )           3                          ",
+         "                                                                             ",
+         "                                                                             ",
+         "                                                                             ",
+         "                                                                             ",
+         "                                                                             ",
+         "                                                                             ",
+         "                                              ./11                           ",
+         "                                                                             ",
+         "                                                                             ",
+         "                                                                    7        ",
+         "                                                                             ",
+         "                                                                   76        ",
+         "                                                                 67          ",
+         "                                                                  6 7        ",
+         "    #                      '   (                                             ",
+         "                                                                  76         ",
+         "                                                                 6  7        ",
+         "                                                                   6         ",
+         "                                                                   76        ",
+         "                                      #                             7        ",
+         "                                                                             ",
+         "                                                                    7        ",
+         "                                                                             ",
+         "                                                                             ",
+         "                                                                             ",
+         "   !                                                                         ",
+         "  !                                                                          ",
+         " !                                                                           ",
+         "                                                                             ",
+         "                                  )))))))))))))))  )  ))))))))))))))   )))   ",
+         "                111                                                          ",
+         "                                                                             "}
+ stmap={"!!#!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!#      #!!!!",
+        "!$   %**** % % %   % % % * * * * *                                  2 1    $!",
+        "#   %                                              D                ;  1    !",
+        "!  %   ... % % %   % % % * * * * *  D       G       D               ;   1   !",
+        "! %                                D D  !       !    D              ;    1  !",
+        "!%     ...                          D    < 1)1 <      D    %        ;       !",
+        "!                                    D   F!   !F                    ;    N  !",
+        "!      . .     :>>>>>>>>>>>>>>>>?          ! !            M  %      ;       !",
+        "!              ;                ;    D /D%D%!%D%D/       % M  %     ;       !",
+        "!      . .     ;                ;      /    /   //        % M  %    ;     N !",
+        "!              ;                ;    D /    /    / %K      % M      ;       !",
+        "!              ; :>>>>@@@>>>>?  ;                  I L      %       ;       !",
+        "!              ; ; $  ;;=? $ ;  ;      $           %K        % $    ;       !",
+        "!              ; =?   ;; =?  ;  ;    9                              ;       !",
+        "!              ;  =?  ;;  =? ;  ;                                   ;    N  #",
+        "!  ()(         ;   =>>A;   =?;  =>>>>>>>>>>><<>>>>>>>>>>>>>>>>>>>>>>C        ",
+        "!              ;       ;    =A                                      =?       ",
+        "!              ;       ;                E          J                 =?      ",
+        "!              ;      -=>>>>>>>>>>?                                   =?     ",
+        "!              ;       -          =?                0?-                =@>>5 ",
+        "!      . .     ;                   =><>>>>>>>>>>>>><>!5                 ;    ",
+        "!      / /     ;             -                      0A-                 ;    ",
+        "!      . .     ; <>>>>>>>>>>>?-  ...              JJ%                   ; 9  ",
+        "!      / /   9 ;             ;    . ..       #    !J %    !             ;    ",
+        "!      . .     ;             ;     ..<                %                 ;   #",
+        "!      / /     ;             ;      .;              1 1                 ;   !",
+        "!      . .     ;             ;       ;              1  1           '    ;   !",
+        "!     '/ /     ;             ;       ;              1   %         '     ;   !",
+        "!    ' . .     ;             ;       ;              1 $  %       '      ;   !",
+        "!   ' +,,,-    ;            :!?      ;              %     %     '       ;   !",
+        "!  '  + 2 ,    ;            ;-;      ;              1%11   %   '        ;   !",
+        "! '   ,035,    <            <-<      ;      H           %   % '         <  $!",
+        "!  '  , 4 +    ;            B<C      ;       H    !    %  !  % '        ;   !",
+        "!   ' -,,,+    ;            B<C      ;        H             %   '       ;   !",
+        "!    ' 1 6     ;            =!A     :!?        H           %     '      ;   !",
+        "!     '/       ;             ;   :?:A-=?:?      H                 '     ;   !",
+        "!      1 7     ;             ;   ;=A - =A;       H    $            '    ;   !",
+        "!      /       ;             ;   =?--$--:A        H                     ;   !",
+        "!      - 8     ;          :? ;    =? - :A          H                    ;   !",
+        "!      &-&     ;         :A; ;     =?-:A                                ;   !",
+        "!&&&&&&& -&    ;        :A ; <      =>A                                 ;   !",
+        "!         -&   ;       :A  ; 4  :>?     :>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>A   !",
+        "!        &&-   ;      :A   ;   :A =?   :A                                   !",
+        "!        &&&   =><>>>>A    ;  :A   =? :A                                    !",
+        "!                          ; :A     =>A                                     !",
+        "!          &               ;:A       9                                      !",
+        "!          &               =A    1                                          !",
+        "!$         &                                                               $!",
+        "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"}
+
+create_world_by_map(level)
+draw_map(0,0,stmap,stones)
+draw_map(0,0,itmap,items)
+draw_map(0,0,acmap,actors)
+SetAttrib(enigma.GetItem(17,2),"invisible",FALSE)
+SetAttrib(enigma.GetStone(44,3),"on",FALSE)
+SetAttrib(enigma.GetItem(48,10),"text","beginnings")
+	
+if (not difficult) then
+  set_item("it-wormhole",63,31)
+  SetAttrib(enigma.GetItem(4,31),"strength",3)
+  SetAttrib(enigma.GetItem(4,31),"range",3)
+  SetAttrib(enigma.GetItem(20,13),"strength",3)
+  SetAttrib(enigma.GetItem(20,13),"range",3)
+  SetAttrib(enigma.GetItem(28,13),"strength",3)
+  SetAttrib(enigma.GetItem(28,13),"range",3)
+  SetAttrib(enigma.GetItem(38,36),"strength",3)
+  SetAttrib(enigma.GetItem(38,36),"range",3)
+  SetAttrib(enigma.GetItem(44,7),"strength",3)
+  SetAttrib(enigma.GetItem(44,7),"range",3)
+  SetAttrib(enigma.GetItem(63,31),"strength",3)
+  SetAttrib(enigma.GetItem(63,31),"range",3)
+  SetAttrib(enigma.GetItem(74,1),"strength",3)
+  SetAttrib(enigma.GetItem(74,1),"range",3)
+  set_item("it-extralife",25,31)
+  else
+  set_floor("fl-abyss",41,5)
+  set_floor("fl-abyss",47,5)
+  set_item("it-puller-e",43,2)
+  set_item("it-puller-e",45,2)
+  SetAttrib(enigma.GetItem(4,31),"strength",10)
+  SetAttrib(enigma.GetItem(4,31),"range",10)
+  SetAttrib(enigma.GetItem(20,13),"strength",10)
+  SetAttrib(enigma.GetItem(20,13),"range",10)
+  SetAttrib(enigma.GetItem(28,13),"strength",10)
+  SetAttrib(enigma.GetItem(28,13),"range",10)
+  SetAttrib(enigma.GetItem(38,36),"strength",10)
+  SetAttrib(enigma.GetItem(38,36),"range",10)
+  SetAttrib(enigma.GetItem(44,7),"strength",10)
+  SetAttrib(enigma.GetItem(44,7),"range",10)
+  SetAttrib(enigma.GetItem(74,1),"strength",3)
+  SetAttrib(enigma.GetItem(74,1),"range",3)
+end
+
+Signal ("it(74 1)","fl(28 31)")
+Signal ("it(4 31)","fl(36 38)")
+Signal ("it(38 36)","fl(27 13)")
+Signal ("it(28 13)","fl(19 13)")
+Signal ("it(20 13)","fl(29 30)")
+Signal ("it(44 7)","fl(67 31)")
+Signal ("st(9 34)","st(44 5)")
+Signal ("st(9 38)","st(51 11)")
+Signal ("st(9 36)","st(4 15)")
+Signal ("it(63 31)","fl(63 6)")
+Signal ("it(17 2)","st(44 3)")
+oxyd_shuffle()
+    ]]></el:luamain>
+      <el:i18n>
+        <el:string el:key="title">
+          <el:english el:translate="false"/>
+        </el:string>
+        <el:string el:key="subtitle">
+          <el:english el:translate="true"/>
+	  <el:translation el:lang="de">Nur ein Labyrinth</el:translation>
+        </el:string>
+     </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_viii/mecke20_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Sun May 25 23:44:31 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 25 May 2008 23:44:31 +0200
Subject: [Enigma-game-svn] r1159 - trunk/src
Message-ID: <200805252144.m4PLiVMH029112@sheep.berlios.de>

Author: ral
Date: 2008-05-25 23:44:30 +0200 (Sun, 25 May 2008)
New Revision: 1159

Modified:
   trunk/src/client.cc
   trunk/src/d_engine.hh
   trunk/src/display.cc
   trunk/src/display.hh
Log:
Trunk 1.1: 
- crash fix: on canon ball creation when too many sparkles are shown.
  (level Armageddon).


Modified: trunk/src/client.cc
===================================================================
--- trunk/src/client.cc	2008-05-22 20:08:45 UTC (rev 1158)
+++ trunk/src/client.cc	2008-05-25 21:44:30 UTC (rev 1159)
@@ -960,7 +960,7 @@
 }
 
 void client::Msg_Sparkle (const ecl::V2 &pos) {
-    display::AddEffect (pos, "ring-anim");
+    display::AddEffect (pos, "ring-anim", true);
 }
 
 

Modified: trunk/src/d_engine.hh
===================================================================
--- trunk/src/d_engine.hh	2008-05-22 20:08:45 UTC (rev 1158)
+++ trunk/src/d_engine.hh	2008-05-25 21:44:30 UTC (rev 1159)
@@ -223,7 +223,7 @@
         void new_world (int, int);
 
         /* ---------- Member functions ---------- */
-        SpriteId add_sprite (Sprite *sprite);
+        SpriteId add_sprite (Sprite *sprite, bool isDispensible = false);
         void kill_sprite (SpriteId id);
         void move_sprite (SpriteId, const ecl::V2& newpos);
         void replace_sprite (SpriteId id, Model *m);
@@ -233,7 +233,7 @@
 
         Model *get_model (SpriteId id) { return sprites[id]->model; }
 
-        void set_maxsprites (unsigned m) { maxsprites = m; }
+        void set_maxsprites (unsigned m, unsigned c) { maxsprites = m; dispensiblesprites = c;}
 
         Sprite *get_sprite(SpriteId id);
 
@@ -250,6 +250,7 @@
         // Variables.
         unsigned numsprites;    // Current number of sprites
         unsigned maxsprites;    // Maximum number of sprites
+        unsigned dispensiblesprites;    // Threshold above which just critical sprites are accepted
     };
 
 
@@ -347,7 +348,7 @@
 
         DisplayEngine *get_engine() const { return m_engine; }
 
-        SpriteHandle add_effect (const V2& pos, Model *m);
+        SpriteHandle add_effect (const V2& pos, Model *m, bool isDispensible = false);
         SpriteHandle add_sprite (const V2 &pos, Model *m);
 
         RubberHandle add_line (V2 p1, V2 p2);

Modified: trunk/src/display.cc
===================================================================
--- trunk/src/display.cc	2008-05-22 20:08:45 UTC (rev 1158)
+++ trunk/src/display.cc	2008-05-25 21:44:30 UTC (rev 1159)
@@ -24,6 +24,7 @@
  */
 
 #include "display_internal.hh"
+#include "errors.hh"
 #include "video.hh"
 #include "main.hh"
 
@@ -868,7 +869,7 @@
 /* -------------------- Sprite layer -------------------- */
 
 DL_Sprites::DL_Sprites()
-: numsprites(0), maxsprites(1000)
+: numsprites(0), maxsprites(1000), dispensiblesprites(1000)
 {}
 
 DL_Sprites::~DL_Sprites() {
@@ -876,7 +877,8 @@
 }
 
 Sprite *DL_Sprites::get_sprite(SpriteId id) {
-    return (id == MAGIC_SPRITEID) ? 0 : sprites[id];
+    ASSERT(id != MAGIC_SPRITEID, XLevelRuntime, "Sprite layer fatal error: request of not existing sprite");
+    return sprites[id];
 }
 
 void DL_Sprites::new_world (int w, int h) {
@@ -906,9 +908,9 @@
     }
 }
 
-SpriteId DL_Sprites::add_sprite (Sprite *sprite) 
+SpriteId DL_Sprites::add_sprite (Sprite *sprite, bool isDispensible) 
 {
-    if (numsprites >= maxsprites) {
+    if (numsprites >= maxsprites || (isDispensible && numsprites >= dispensiblesprites)) {
         delete sprite;
         return MAGIC_SPRITEID;
     }
@@ -1807,7 +1809,7 @@
     shadow_layer  = new DL_Shadows(stone_layer, sprite_layer);
     line_layer    = new DL_Lines;
     effects_layer = new DL_Sprites;
-    effects_layer->set_maxsprites(50);
+    effects_layer->set_maxsprites(70, 50);
 
     // Register display layers
     m_engine->add_layer (floor_layer);
@@ -1875,10 +1877,10 @@
 }
 
 SpriteHandle
-CommonDisplay::add_effect (const V2& pos, Model *m)
+CommonDisplay::add_effect (const V2& pos, Model *m, bool isDispensible)
 {
     Sprite *spr = new Sprite (pos, SPRITE_EFFECT, m);
-    return SpriteHandle (effects_layer, effects_layer->add_sprite(spr));
+    return SpriteHandle (effects_layer, effects_layer->add_sprite(spr, isDispensible));
 }
 
 SpriteHandle
@@ -2152,8 +2154,8 @@
     return gamedpy->yield_model (l);
 }
 
-SpriteHandle display::AddEffect (const V2& pos, const char *modelname) {
-    return gamedpy->add_effect (pos, MakeModel(modelname));
+SpriteHandle display::AddEffect (const V2& pos, const char *modelname, bool isDispensible) {
+    return gamedpy->add_effect (pos, MakeModel(modelname), isDispensible);
 }
 
 SpriteHandle

Modified: trunk/src/display.hh
===================================================================
--- trunk/src/display.hh	2008-05-22 20:08:45 UTC (rev 1158)
+++ trunk/src/display.hh	2008-05-25 21:44:30 UTC (rev 1159)
@@ -154,7 +154,7 @@
 
     /*! Add a new effect sprite.  Sprites of this type are
       automatically deleted once the animation has finished.  */
-    SpriteHandle AddEffect (const ecl::V2 &pos, const char *modelname);
+    SpriteHandle AddEffect (const ecl::V2 &pos, const char *modelname, bool isDispensible = false);
 
     /*! Create a new sprite.  If modelname==0, the sprite is
       considered invisible.  Sprites of this type are _never_



From ral at mail.berlios.de  Mon May 26 23:38:27 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Mon, 26 May 2008 23:38:27 +0200
Subject: [Enigma-game-svn] r1160 - in trunk: data data/schemas src src/stones
Message-ID: <200805262138.m4QLcRip006054@sheep.berlios.de>

Author: ral
Date: 2008-05-26 23:38:26 +0200 (Mon, 26 May 2008)
New Revision: 1160

Modified:
   trunk/data/api2init.lua
   trunk/data/models-2d.lua
   trunk/data/schemas/objects.xml
   trunk/src/Inventory.hh
   trunk/src/WorldProxy.cc
   trunk/src/items.cc
   trunk/src/player.cc
   trunk/src/server.cc
   trunk/src/server.hh
   trunk/src/stones/LightPassengerStone.cc
   trunk/src/stones/OxydStone.cc
   trunk/src/stones/OxydStone.hh
   trunk/src/stones_simple.cc
   trunk/src/world.hh
Log:
Trunk 1.1: new API reengineering item glasses
- it-glasses renamed to it_glasses
- fix glasses for multiple instances in inventory
- fix glasses for black plus white marbles
- glasses made configurable what to show - state
- global variable to request current glasses type
- world attribute "ExtralifeGlasses" for type of glasses on lasered extralife
Note:
- glasses use some code hacks, should be improved when items get separated
- all glasses affected objects need special handling for swapping, etc.

Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/data/api2init.lua	2008-05-26 21:38:26 UTC (rev 1160)
@@ -106,6 +106,13 @@
 INDISPENSIBLE = 1
 PERKIND       = 2
 
+-- glasses
+SPOT_DEATH          =   1
+SPOT_HOLLOW         =   2
+SPOT_ACTORIMPULSE   =   4
+SPOT_SENSOR         =   8
+SPOT_LIGHTPASSENGER =  16
+
 ---------------------
 -- Utility Methods --
 ---------------------

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/data/models-2d.lua	2008-05-26 21:38:26 UTC (rev 1160)
@@ -401,7 +401,6 @@
         "it-dynamite",
         "it-flagblack",
         "it-flagwhite",
-        "it-glasses",
         "it-glasses-broken",
         "it-hill",
         "it-hollow",
@@ -436,6 +435,7 @@
     DefImage("it_cross", {filename="it-cross"})
     DefImage("it_extralife", {filename="it-extralife"})
     DefImage("it_floppy", {filename="it-floppy"})
+    DefImage("it_glasses", {filename="it-glasses"})
     DefImage("it_hammer", {filename="it-hammer"})
     DefImage("it_key", {filename="it-key"})
     DefImage("it_sword", {filename="it-sword"})

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/data/schemas/objects.xml	2008-05-26 21:38:26 UTC (rev 1160)
@@ -54,6 +54,7 @@
     <msg name="_bombstone" type="nil"/>
     <msg name="_brush" type="nil"/>
     <msg name="_explosion" type="nil"/>
+    <msg name="_glasses" type="nil"/>
     <msg name="_hit" type="object"/>
     <msg name="_init" type="nil"/>
     <msg name="_jumping" type="bool"/>
@@ -111,6 +112,9 @@
     <object name="it_extralife"/>
     <object name="it_extralife_new" init="true"/>
     <object name="it_floppy"/>
+    <object name="it_glasses">
+      <attr name="state" max="31"/>
+    </object>
     <object name="it_hammer"/>
     <object name="it_hammer_new" init="true"/>
     <object name="it_key">

Modified: trunk/src/Inventory.hh
===================================================================
--- trunk/src/Inventory.hh	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/src/Inventory.hh	2008-05-26 21:38:26 UTC (rev 1160)
@@ -26,7 +26,6 @@
 
 namespace enigma
 {
-//    using Item;          // TODO: remove this after moving Item into enigma namespace
     class Item;
     class Inventory : public ItemHolder {
     public:

Modified: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/src/WorldProxy.cc	2008-05-26 21:38:26 UTC (rev 1160)
@@ -67,6 +67,8 @@
             return server::BumperForce;
         } else if (key == "ElectricForce") {
             return server::ElectricForce;
+        } else if (key == "ExtralifeGlasses") {
+            return server::ExtralifeGlasses;
         } else if (key == "FlatForce") {
             return server::FlatForce;
         } else if (key == "FrictionFactor") {
@@ -113,6 +115,8 @@
             server::BumperForce = val;
         } else if (key == "ElectricForce") {
             server::ElectricForce = val;
+        } else if (key == "ExtralifeGlasses") {
+            server::ExtralifeGlasses = val;
         } else if (key == "FlatForce") {
             server::FlatForce = val;
         } else if (key == "FrictionFactor") {

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/src/items.cc	2008-05-26 21:38:26 UTC (rev 1160)
@@ -441,6 +441,7 @@
         
         // Item interface
         virtual string get_inventory_model();
+        virtual void setup_successor(Item *newitem);
 
         // TimeHandler interface
         virtual void alarm();
@@ -483,6 +484,10 @@
         }
     }
     
+    void  ExtraLife::setup_successor(Item *newitem) {
+        newitem->setState(server::ExtralifeGlasses);
+    }
+    
     void ExtraLife::alarm() {
             DirectionBits db = updateCurrentLightDirs();
             activatePhoto();        
@@ -3410,34 +3415,74 @@
 
 
 /* -------------------- Glasses -------------------- */
-namespace
-{
     class Glasses : public Item {
         CLONEOBJ(Glasses);
         DECL_TRAITS;
 
-        static bool wears_glasses(Actor *a) {
-            return player::GetInventory(a)->find("it-glasses") != -1;
+    public:
+        enum Spot {
+            NOTHING         =  0,   // broken glasses
+            DEATH           =  1,
+            HOLLOW          =  2,
+            ACTORIMPULSE    =  4,
+            SENSOR          =  8,
+            LIGHTPASSENGER  = 16,
+            MAX             = 31
+        };
+        
+        static void updateGlasses();
+        
+        Glasses();
+        
+        // StateObject interface
+        virtual int maxState() const;
+        virtual void toggleState();
+        
+        // Items interface
+        virtual void on_drop(Actor *a);
+        virtual void on_pickup(Actor *a);
+        virtual void on_stonehit(Stone *st);
+        
+    };
+    
+    void Glasses::updateGlasses() {
+        Inventory *ci = player::GetInventory(player::CurrentPlayer());
+        int newVisibility = 0;
+        int i = -1;
+        while ((i = ci->find("it_glasses", i+1)) != -1) {
+            Glasses *gl = dynamic_cast<Glasses *>(ci->get_item(i));
+            newVisibility |= gl->state;
         }
-
-        void on_drop(Actor *a) {
-            if (!wears_glasses(a)) // 'this' was the only it-glasses
-                BroadcastMessage("glasses", 0.0, GRID_STONES_BIT);
+        if (newVisibility != server::GlassesVisibility) {
+            server::GlassesVisibility = newVisibility;
+            BroadcastMessage("_glasses", newVisibility, GRID_STONES_BIT);
         }
-        void on_pickup(Actor *a) {
-            if (!wears_glasses(a)) // no glasses before
-                BroadcastMessage("glasses", 1.0, GRID_STONES_BIT);
-        }
-        void on_stonehit(Stone *) {
-            sound_event ("shatter");
-            replace (it_glasses_broken);
-        }
-    public:
-        Glasses()
-        {}
-    };
-    DEF_TRAITS(Glasses, "it-glasses", it_glasses);
-}
+    }
+    
+    Glasses::Glasses() {
+        state = DEATH + HOLLOW + LIGHTPASSENGER;
+    }
+    
+    int Glasses::maxState() const {
+        return MAX;
+    }
+    
+    void Glasses::toggleState() {
+        // ignore toggle
+    }
+    
+    void Glasses::on_drop(Actor *a) {
+        updateGlasses();
+    }
+    void Glasses::on_pickup(Actor *a) {
+        updateGlasses();
+    }
+    void Glasses::on_stonehit(Stone *) {
+        sound_event ("shatter");
+        replace(it_glasses_broken);
+    }
+        
+    DEF_TRAITS(Glasses, "it_glasses", it_glasses);
 
 
 /* -------------------- Invisible abyss -------------------- */
@@ -3571,6 +3616,7 @@
                 if (Inventory *inv = player::MayPickup(a, NULL)) {
                     std::vector<Item *>::size_type oldSize = m_contents.size();
                     inv->takeItemsFrom(this);
+                    Glasses::updateGlasses();
                     if (oldSize != m_contents.size() && !inv->willAddItem(this)) {
                         // some items have been picked up but the bag will not
                         // be picked up (and cause the following actions)

Modified: trunk/src/player.cc
===================================================================
--- trunk/src/player.cc	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/src/player.cc	2008-05-26 21:38:26 UTC (rev 1160)
@@ -270,6 +270,7 @@
     else {
         icurrent_player = iplayer;
         RedrawInventory (GetInventory(iplayer));
+        dynamic_cast<Item *>(GetObjectTemplate("it_glasses"))->on_pickup(NULL);  // ugly hack to call updateGlasses
     }
 }
 
@@ -566,8 +567,8 @@
 {
     if (Inventory *inv = MayPickup(a, GetField(p)->item)) {
         if (Item *item = YieldItem(p)) {
+            inv->add_item(item);
             item->on_pickup(a);
-            inv->add_item(item);
             RedrawInventory (inv);
             sound::EmitSoundEvent ("pickup", p.center());
         }

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/src/server.cc	2008-05-26 21:38:26 UTC (rev 1160)
@@ -95,6 +95,8 @@
 double   server::EnigmaCompatibility;       // no Lua access
 double   server::FlatForce;
 double   server::FrictionFactor;
+int      server::GlassesVisibility;         // no Lua access
+int      server::ExtralifeGlasses;
 double   server::HoleForce;
 double   server::IceFriction;
 lev::levelStatusType   server::LevelStatus; // no Lua access
@@ -244,6 +246,8 @@
     server::SlopeForce        = 25.0;
     server::FlatForce         = 0.0;
     server::FrictionFactor    = 1.0;
+    server::GlassesVisibility = 0;     // nothing
+    server::ExtralifeGlasses  = 19;  // death + hollow + lightpassenger
     server::IceFriction       = 1.0;
     server::ElectricForce     = 15.0;
     server::BumperForce       = 200.0;

Modified: trunk/src/server.hh
===================================================================
--- trunk/src/server.hh	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/src/server.hh	2008-05-26 21:38:26 UTC (rev 1160)
@@ -95,6 +95,9 @@
     extern double   WaterSinkSpeed;
 
     extern double   SwampSinkSpeed;
+    
+    extern int      GlassesVisibility;
+    extern int      ExtralifeGlasses;
 
 /* --------------------  Force multipliers... -------------------- */
 

Modified: trunk/src/stones/LightPassengerStone.cc
===================================================================
--- trunk/src/stones/LightPassengerStone.cc	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/src/stones/LightPassengerStone.cc	2008-05-26 21:38:26 UTC (rev 1160)
@@ -50,8 +50,8 @@
             if (objFlags & OBJBIT_LIGHTNEWDIRS)
                 lightDirChanged(NODIRBIT, (DirectionBits)(objFlags & OBJBIT_LIGHTNEWDIRS));
             return Value();            
-        } else if (m.message == "glasses") {
-            if (to_bool(m.value) != (objFlags & OBJBIT_VISIBLE)) {
+        } else if (m.message == "_glasses") {
+            if ((((int)(m.value) & 16) != 0) != ((objFlags & OBJBIT_VISIBLE) != 0)) {
                 objFlags ^= OBJBIT_VISIBLE; // toggle visibility bit
                 init_model();
             }
@@ -146,6 +146,11 @@
         if (a != NULL && state == BLINK && player::WieldedItemIs(a, "it_hammer")) {
             state = BREAK;
             init_model();
+        } else if (state == OFF && player::WieldedItemIs(a, "it_brush")) {
+            Item * it = GetItem(get_pos());
+            if (it != NULL && get_id(it) == it_cross)
+                KillItem(get_pos());
+            setState(1);
         }
     }
 
@@ -201,6 +206,10 @@
                     objFlags |= OBJBIT_BLOCKED;
                 }
                 move_stone(skateDir);
+                Item * it = GetItem(get_pos());
+                if (it != NULL && get_id(it) == it_cross) {
+                    setState(0);
+                }
             }
             GameTimer.set_alarm(this, calcInterval(), false);
         }

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/src/stones/OxydStone.cc	2008-05-26 21:38:26 UTC (rev 1160)
@@ -902,7 +902,7 @@
             set_model(string("st-oxyd")+(std::string)val);
     }
         
-    int OxydStone::maxState() {
+    int OxydStone::maxState() const {
         return 2;
     }
     

Modified: trunk/src/stones/OxydStone.hh
===================================================================
--- trunk/src/stones/OxydStone.hh	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/src/stones/OxydStone.hh	2008-05-26 21:38:26 UTC (rev 1160)
@@ -87,7 +87,7 @@
         virtual void setAttr(const string& key, const Value &val);
 
         // StateObject interface
-        virtual int maxState();
+        virtual int maxState() const;
         virtual void toggleState();
         virtual int externalState() const;
         virtual void setState(int extState);

Modified: trunk/src/stones_simple.cc
===================================================================
--- trunk/src/stones_simple.cc	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/src/stones_simple.cc	2008-05-26 21:38:26 UTC (rev 1160)
@@ -132,8 +132,8 @@
 
         virtual Value message(const Message &m)
         {
-            if (traits->hollow && m.message == "glasses") {
-                if (to_int(m.value)) {
+            if (traits->hollow && m.message == "_glasses") {
+                if (to_int(m.value) & 2) {  // hollow
                     if (!sunglasses) {
                         sunglasses = true;
                         set_model( "invisible");
@@ -1860,8 +1860,8 @@
         }
 
         virtual Value message(const Message &m) {
-            if (m.message == "glasses") {
-                if (to_int(m.value)) {
+            if (m.message == "_glasses") {
+                if (to_int(m.value) & 1) {   // Glasses::DEATH
                     if (!visible) {
                         visible = true;
                         set_visible_model();

Modified: trunk/src/world.hh
===================================================================
--- trunk/src/world.hh	2008-05-25 21:44:30 UTC (rev 1159)
+++ trunk/src/world.hh	2008-05-26 21:38:26 UTC (rev 1160)
@@ -129,9 +129,6 @@
     /* Output a message whenever a message is being sent. */
     extern bool TrackMessages;
 
-    /* A hack to implement BlackBallsStone and WhiteBallsStone. */
-    extern Actor *CurrentCollisionActor;
-
 //----------------------------------------------------------------------
 // FUNCTIONS
 //----------------------------------------------------------------------



From ral at mail.berlios.de  Wed May 28 00:21:03 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 28 May 2008 00:21:03 +0200
Subject: [Enigma-game-svn] r1161 - in trunk: data data/schemas src src/stones
Message-ID: <200805272221.m4RML3GD017568@sheep.berlios.de>

Author: ral
Date: 2008-05-28 00:21:02 +0200 (Wed, 28 May 2008)
New Revision: 1161

Modified:
   trunk/data/api1init.lua
   trunk/data/schemas/objects.xml
   trunk/src/items.cc
   trunk/src/stones/LightPassengerStone.cc
   trunk/src/stones/LightPassengerStone.hh
Log:
Trunk 1.1: new API reengineering
- it_glasses fix API1 compatibility
- st_lightpassenger:
  - stop if moved onto an it_cross and switch to state OFF
  - finish glasses visibility
- it_sensor:
  - fix model update on attribute "invisible"
  - add visibility on glasses with SPOT_SENSOR


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2008-05-26 21:38:26 UTC (rev 1160)
+++ trunk/data/api1init.lua	2008-05-27 22:21:02 UTC (rev 1161)
@@ -54,6 +54,7 @@
     it_cross = "it-cross",
     it_extralife = "it-extralife",
     it_floppy = "it-floppy",
+    it_glasses = "it-glasses",
     it_hammer = "it-hammer",
     it_magnet = "it-magnet",
     it_magnet_on = "it-magnet-on",

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2008-05-26 21:38:26 UTC (rev 1160)
+++ trunk/data/schemas/objects.xml	2008-05-27 22:21:02 UTC (rev 1161)
@@ -135,6 +135,7 @@
     </object>
     <object name="it_sensor">
       <attr name="invisible"/>
+      <msg name="_glasses"/>
       <msg name="_hit"/>
     </object>
     <object name="it_sword"/>
@@ -371,6 +372,7 @@
       <msg name="off"/>
       <msg name="signal"/>
       <msg name="_init"/>
+      <msg name="_glasses"/>
       <msg name="_model_reanimated"/>
       <msg name="_trigger"/>
     </object>

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2008-05-26 21:38:26 UTC (rev 1160)
+++ trunk/src/items.cc	2008-05-27 22:21:02 UTC (rev 1161)
@@ -3192,6 +3192,9 @@
         // Object interface
         virtual Value message(const Message &m);
         
+        // StateObject interface
+        virtual void setAttr(const string& key, const Value &val);
+        
         // GridObject interface
         virtual void init_model();
 
@@ -3222,12 +3225,25 @@
             return Value();
         } else if (m.message == "_hitactor") {
             return getAttr("$hitactor");
+        } else if (m.message == "_glasses") {
+            if (isDisplayable())
+                init_model();            
         }
         return Item::message(m);
     }
     
+    void Sensor::setAttr(const string& key, const Value &val) {
+        if (key == "invisible") {
+            Item::setAttr(key, val);
+            if (isDisplayable())
+                init_model();
+            return;
+        }
+        Item::setAttr(key, val);
+    }
+    
     void Sensor::init_model() {
-        if (getAttr("invisible").to_bool())
+        if (getAttr("invisible").to_bool() && ((server::GlassesVisibility & 8) == 0))
             set_model("invisible");
         else
             set_model("it_sensor");
@@ -3246,7 +3262,7 @@
     int Sensor::traitsIdx() const {
         return getAttr("inverse").to_bool() ? 1 : 0;
     }
-//    DEF_TRAITSF(Sensor, "it_sensor", it_sensor, itf_static);
+
     ItemTraits Sensor::traits[2] = {
         {"it_sensor",  it_sensor,  itf_static},
         {"it_sensor",  it_inversesensor,  itf_static}
@@ -3455,7 +3471,7 @@
         }
         if (newVisibility != server::GlassesVisibility) {
             server::GlassesVisibility = newVisibility;
-            BroadcastMessage("_glasses", newVisibility, GRID_STONES_BIT);
+            BroadcastMessage("_glasses", newVisibility, GridLayerBits(GRID_ITEMS_BIT | GRID_STONES_BIT));
         }
     }
     

Modified: trunk/src/stones/LightPassengerStone.cc
===================================================================
--- trunk/src/stones/LightPassengerStone.cc	2008-05-26 21:38:26 UTC (rev 1160)
+++ trunk/src/stones/LightPassengerStone.cc	2008-05-27 22:21:02 UTC (rev 1161)
@@ -29,7 +29,7 @@
 
 namespace enigma {
     LightPassengerStone::LightPassengerStone(bool isActive) : Stone () {
-        state =  isActive ? ON : OFF;
+        state =  isActive ? ON_NEW : OFF;
     }
 
     LightPassengerStone::~LightPassengerStone() {
@@ -66,13 +66,15 @@
     
     void LightPassengerStone::setState(int extState) {
         if (state == OFF && extState == 1) {
-            state = ON;
             if (isDisplayable()) {
+                state = ON;
                 init_model();
                 if (objFlags & OBJBIT_LIGHTNEWDIRS)  // currently enlighted?
                     GameTimer.set_alarm(this, calcInterval(), false);
+            } else {
+                state = ON_NEW;
             }
-        } else if ((state == ON || state == BLINK) && extState == 0) {
+        } else if ((state == ON || state == ON_NEW || state == BLINK) && extState == 0) {
             state = OFF;
             objFlags &= ~OBJBIT_SKATEDIR;  // NODIR
             if (isDisplayable())
@@ -83,12 +85,12 @@
     void LightPassengerStone::init_model() {
         switch(state) {
             case OFF:
-                set_anim(objFlags & OBJBIT_VISIBLE ?
+                set_model(objFlags & OBJBIT_VISIBLE ?
                     "st-lightpassenger_off" : "st-lightpassenger_hidden"); break;
             case ON:
-                set_anim("st-lightpassenger"); break;
+                set_model("st-lightpassenger"); break;
             case BLINK:
-                set_anim("st-lightpassenger-blink"); break;
+                set_model("st-lightpassenger-blink"); break;
             case BREAK:
                 bool NorthSouth = objFlags & (NORTHBIT | SOUTHBIT);
                 bool EastWest = objFlags & (WESTBIT | EASTBIT);
@@ -107,6 +109,17 @@
         activatePhoto();
         if (updateCurrentLightDirs() != NODIRBIT)
             GameTimer.set_alarm(this, calcInterval(), false);
+        if (((server::GlassesVisibility & 16) != 0) != ((objFlags & OBJBIT_VISIBLE) != 0)) {
+            objFlags ^= OBJBIT_VISIBLE; // toggle visibility bit
+        }
+        if (state == ON || state == BLINK) {
+            Item *it = GetItem(p);
+            if (it != NULL && get_id(it) == it_cross) {
+                setState(0);
+            }
+        } else if (state == ON_NEW) {
+            state = ON;
+        }
         Stone::on_creation(p);
     }
     

Modified: trunk/src/stones/LightPassengerStone.hh
===================================================================
--- trunk/src/stones/LightPassengerStone.hh	2008-05-26 21:38:26 UTC (rev 1160)
+++ trunk/src/stones/LightPassengerStone.hh	2008-05-27 22:21:02 UTC (rev 1161)
@@ -37,13 +37,14 @@
             OFF,     ///< inactive, does not react on laser 
             ON,      ///< active, does react on laser
             BLINK,   ///< active, double lasered, ready to break
-            BREAK    ///< active, breaking and dissolving
+            BREAK,   ///< active, breaking and dissolving
+            ON_NEW   ///< a new lightpassenger that should start in ON on first grid set
         };
         
         enum ObjectPrivatFlagsBits {
             OBJBIT_SKATEDIR =   7<<24,   ///< current skate direction
             OBJBIT_BLOCKED  =   1<<27,   ///< have been blocked by a stone on last move attempt 
-            OBJBIT_VISIBLE  =   1<<28    ///< this stone isn't hidden when inactive
+            OBJBIT_VISIBLE  =   1<<28    ///< can be distinguished from glass when inactive
         };
     public:
         LightPassengerStone(bool isActive);



From ral at mail.berlios.de  Wed May 28 21:49:29 2008
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 28 May 2008 21:49:29 +0200
Subject: [Enigma-game-svn] r1162 - team_levelpacks/team_test_new_api
Message-ID: <200805281949.m4SJnTJ7005950@sheep.berlios.de>

Author: ral
Date: 2008-05-28 21:49:29 +0200 (Wed, 28 May 2008)
New Revision: 1162

Added:
   team_levelpacks/team_test_new_api/ralT049_1.xml
Modified:
   team_levelpacks/team_test_new_api/ralT041_1.xml
   team_levelpacks/team_test_new_api/ralT042_1.xml
Log:
Test Level new API:
- lightpassenger updates for it_cross and glasses
- add glasses test level


Modified: team_levelpacks/team_test_new_api/ralT041_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT041_1.xml	2008-05-27 22:21:02 UTC (rev 1161)
+++ team_levelpacks/team_test_new_api/ralT041_1.xml	2008-05-28 19:49:29 UTC (rev 1162)
@@ -24,7 +24,7 @@
 ti["b"] = {"it_brush"}
 ti["w"] = {"it_wrench"}
 
-ti["e"] = {"it_sensor", invisible=true, target="sensorlaseri", action="signal"}
+ti["e"] = {"it_sensor", "sensorinvisible", invisible=true, target="sensorlaseri", action="signal"}
 ti["f"] = {"it_sensor", invisible=true, inverse=true, target="sensorlaseri", action="signal"}
 ti["l"] = {"st_laser_n", "sensorlaseri"}
 
@@ -54,6 +54,7 @@
 ti["u"] = {"st_switch", target="rotlasern1"}
 ti["U"] = {"st_switch", target="rotlasern2"}
 
+ti["I"] = {"st_switch", target="switchsensor"}
 
 ti["1"] = ti["y"] .. {"#ac-blackball"} 
 ti["2"] = ti["y"] .. {"#ac-whiteball"}
@@ -63,7 +64,7 @@
 "                    ",
 " l   L     M   m    ",
 "                    ",
-" e   E     C   c    ",
+"Ie   E     C   c    ",
 " f   F              ",
 "          1 2  b w  ",
 "S   X               ",
@@ -78,6 +79,10 @@
 function addrot()
     wo[no["rotlaser"] + {0, 2}] = ti["r"]
 end
+
+function switchsensor()
+    no["sensorinvisible"]["invisible"] = not no["sensorinvisible"]["invisible"]
+end
   ]]></el:luamain>
     <el:i18n>
 	 <el:string el:key="title">

Modified: team_levelpacks/team_test_new_api/ralT042_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT042_1.xml	2008-05-27 22:21:02 UTC (rev 1161)
+++ team_levelpacks/team_test_new_api/ralT042_1.xml	2008-05-28 19:49:29 UTC (rev 1162)
@@ -21,6 +21,7 @@
 
 ti[" "] = {"fl-sahara"}
 ti["."] = {"fl-ice"}
+ti["c"] = {"it_cross"}
 
 ti["A"] = {"#ac-blackball"}
 
@@ -33,6 +34,7 @@
 ti["S"] = {"st_laser_s", state=ON}
 ti["W"] = {"st_laser_w", state=ON}
 ti["t"] = {"st_switch", target="Laser", action="turn"}
+ti["M"] = ti["c"] .. ti["l"]
 
 ti["T"] = {"st-turnstile"}
 ti["e"] = {"st-turnstile-e"}
@@ -47,14 +49,14 @@
 
 ti["B"] = {"st_boulder_s"}
 
-ti["g"] = {"it-glasses"}
+ti["g"] = {"it_glasses"}
 
 w, h = wo(ti, " ", {
 "                    ",
 "            E   l  W",
 "                s   ",
 "E     w    lW       ",
-"    il              ",
+"    iM              ",
 "          Ahmbppp   ",
 " ww     S       g   ",
 "E        w          ",

Added: team_levelpacks/team_test_new_api/ralT049_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT049_1.xml	2008-05-27 22:21:02 UTC (rev 1161)
+++ team_levelpacks/team_test_new_api/ralT049_1.xml	2008-05-28 19:49:29 UTC (rev 1162)
@@ -0,0 +1,74 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test Glasses new API" el:subtitle="" el:id="20080524ral097"/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision$" el:status="experimental"/>
+      <el:author  el:name="Ronald Lamprecht" el:email="ral at users.berlios.de"/>
+      <el:copyright>Copyright ? 2008 Ronald Lamprecht</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments>
+      </el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+
+
+wo["ConserveLevel"] = true
+wo["ExtralifeGlasses"] = SPOT_DEATH + SPOT_LIGHTPASSENGER
+
+ti[" "] = {"fl-sahara"}
+ti["!"] = {"st-death_invisible"}
+ti["H"] = {"st-camouflage_hole"}
+ti["L"] = {"st_lightpassenger", state=OFF}
+ti["l"] = {"st_switch", target="newlp"}
+ti["A"] = {"st-actorimpulse_invisible"}
+ti["S"] = {"it_sensor", invisible=true}
+ti["#"] = {"st-wood"}
+ti["N"] = {"st_laser_n", "laser", state=OFF}
+ti["n"] = {"st_switch", target="laser"}
+
+
+ti["G"] = {"it_glasses"}
+ti["g"] = {"it_glasses", state=SPOT_HOLLOW}
+ti["f"] = {"it_glasses", state=SPOT_DEATH}
+ti["h"] = {"it_glasses", state=SPOT_LIGHTPASSENGER}
+ti["s"] = {"it_glasses", state=SPOT_SENSOR}
+ti["a"] = {"it_glasses", state=SPOT_ACTORIMPULSE}
+
+ti["b"] = {"it-bag"}
+ti["y"] = {"it-yinyang"}
+ti["1"] = ti["y"] .. {"#ac-blackball"} 
+ti["2"] = ti["y"] .. {"#ac-whiteball"} 
+
+w, h = wo(ti, " ", {
+"!!!             HHHH",
+"                    ",
+" f       Nn       g ",
+"                    ",
+"                    ",
+"         G          ",
+"     b  1  2  b     ",
+"                    ",
+"                    ",
+"                    ",
+"hh       s       a  ",
+"                    ",
+"LLL l   SSS      AAA"
+})
+
+function newlp(value, sender)
+    wo[sender - {1,0}] = ti["L"]
+end
+  ]]></el:luamain>
+    <el:i18n>
+	 <el:string el:key="title">
+	   <el:english el:translate="false"/>
+	 </el:string>
+   </el:i18n>
+  </el:protected>
+</el:level>
+


Property changes on: team_levelpacks/team_test_new_api/ralT049_1.xml
___________________________________________________________________
Name: svn:keywords
   + Revision
Name: svn:eol-style
   + native



