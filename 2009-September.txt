From raoul at mail.berlios.de  Tue Sep  1 22:40:01 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Tue, 1 Sep 2009 22:40:01 +0200
Subject: [Enigma-game-svn] r1790 - in trunk/data/levels: enigma_cross
	enigma_ix enigma_viii pentomino_i
Message-ID: <200909012040.n81Ke1CX017017@sheep.berlios.de>

Author: raoul
Date: 2009-09-01 22:40:00 +0200 (Tue, 01 Sep 2009)
New Revision: 1790

Added:
   trunk/data/levels/enigma_ix/devnull31_1.xml
   trunk/data/levels/enigma_ix/devnull36_1.xml
   trunk/data/levels/enigma_ix/devnull38_1.xml
   trunk/data/levels/enigma_ix/devnull39_1.xml
   trunk/data/levels/enigma_ix/devnull44_1.xml
   trunk/data/levels/enigma_ix/devnull45_1.xml
Modified:
   trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
   trunk/data/levels/enigma_ix/index.xml
   trunk/data/levels/enigma_viii/andreas49_1.xml
   trunk/data/levels/enigma_viii/index.xml
   trunk/data/levels/enigma_viii/welcometopack8_1.xml
   trunk/data/levels/pentomino_i/index.xml
   trunk/data/levels/pentomino_i/pento64_1.xml
   trunk/data/levels/pentomino_i/pento77_1.xml
   trunk/data/levels/pentomino_i/pento78_1.xml
   trunk/data/levels/pentomino_i/pento79_1.xml
Log:
-> New levels from /dev/null
-> A few pento fixes
-> adhesion-floor attribute renamings



Modified: trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -100,7 +100,7 @@
     <level _seq="92" _title="Color Maze" _xpath="enigma_viii/pulley16_3" author="Mark Pulley" ctrl="force" easy="false" id="pulley16" rel="3" rev="10" score="3" target="time" unit="duration"/>
     <level _seq="93" _title="Earthlink" _xpath="enigma_viii/pulley15_1" author="Mark Pulley" ctrl="force" easy="true" id="pulley15" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="94" _title="Vanity's Constrictions" _xpath="enigma_viii/andreas53_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas53" rel="2" rev="10" score="2" target="time" unit="duration"/>
-    <level _seq="95" _title="Weirdly Wired" _xpath="enigma_viii/andreas49_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas49" rel="1" rev="10" score="1" target="time" unit="duration"/>
+    <level _seq="95" _title="Weirdly Wired" _xpath="enigma_viii/andreas49_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas49" rel="1" rev="11" score="1" target="time" unit="duration"/>
     <level _seq="96" _title="Push Wires" _xpath="enigma_viii/ral24_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080708ral196" rel="1" rev="129" score="1" target="time" unit="duration"/>
     <level _seq="97" _title="Wired Five" _xpath="enigma_viii/ral25_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080721ral073" rel="1" rev="130" score="1" target="time" unit="duration"/>
     <level _seq="98" _title="Wireban Premiere" _xpath="enigma_viii/ral26_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080715ral161" rel="1" rev="130" score="1" target="time" unit="duration"/>
@@ -189,6 +189,12 @@
     <level _seq="181" _title="Wired Strips" _xpath="enigma_viii/ral38_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20081223ral510" rel="1" rev="151" score="1" target="time" unit="duration"/>
     <level _seq="182" _title="Pentachromos" _xpath="enigma_viii/cel2_1" author="Joseph Dunne, Ronald Lamprecht, Dominik Lehmann, Mark Pulley, Lukas Sch?ller" ctrl="force" easy="false" id="cel2" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="183" _title="Wired pulls" _xpath="enigma_ix/raoul36_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul36" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="184" _title="Crabwise III" _xpath="enigma_ix/devnull38_1" author="/dev/null" ctrl="force" easy="true" id="devnull38" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="185" _title="Bicolor" _xpath="enigma_ix/devnull31_1" author="/dev/null" ctrl="force" easy="false" id="devnull31" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="186" _title="lower i" _xpath="enigma_ix/devnull39_1" author="/dev/null" ctrl="force" easy="true" id="devnull39" rel="1" rev="4" score="1" target="time" unit="duration"/>
+    <level _seq="187" _title="At the pool" _xpath="enigma_ix/devnull36_1" author="/dev/null" ctrl="force" easy="true" id="devnull36" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="188" _title="Hide them" _xpath="enigma_ix/devnull44_1" author="/dev/null" ctrl="force" easy="false" id="devnull44" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="189" _title="Crabwise IV" _xpath="enigma_ix/devnull45_1" author="/dev/null" ctrl="force" easy="true" id="devnull45" rel="1" rev="4" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Added: trunk/data/levels/enigma_ix/devnull31_1.xml
===================================================================
--- trunk/data/levels/enigma_ix/devnull31_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/enigma_ix/devnull31_1.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -0,0 +1,57 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Bicolor" el:subtitle="" el:id="devnull31"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
+      <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2009 dev0</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libpuzzle" el:id="lib/libpuzzle" el:release="3" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="true"/>
+      <el:score el:easy="-" el:difficult="3:45"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ProvideExtralifes"] = false
+wo["FrictionStrength"] = 2.0
+
+ti["##"] = {"st_granite"}
+ti["  "] = {"fl_red", friction = 5.0, adhesion = 3.0}
+ti[" ~"] = {"fl_gray"}
+ti[" ."] = {"fl_abyss"}
+ti["X "] = {"st_grate_cross"}
+ti["B "] = {"st_passage_black", flavor = "frame"}
+ti["W "] = {"st_passage_white", flavor = "frame"}
+ti["P"] = {"st_puzzle", color = BLUE, intensity = 0}
+ti["Q"] = ti[" ."] .. {"st_puzzle", color = YELLOW, cluster = 0, intensity = 2}
+ti["o "] = {"st_oxyd", "oxydsB#"}
+ti["O "] = {"st_oxyd", "oxydsW#"}
+ti["@ "] = {"#ac_marble_black", 0.5, 0.0, essential = INDISPENSABLE}
+ti["* "] = {"#ac_marble_white", essential = INDISPENSABLE}
+
+wo(res.composer(res.puzzle(ti, "P", "Q")), "  ", {
+    " . . . . . . .O. . . . .O. . . . . . . .",
+    " . . . . . .O.W         W O. . . . . . .",
+    " . . . . . . .X.  PbPf  X. . . . . . . .",
+    " . . .O. . . .X.  @     X. . . .o. . . .",
+    " . .O.W X.X.X.X.   . .  X.X.X.X.B o. . .",
+    " . . .         .Q Q Q Q   Pe       . . .",
+    " . . .          Q X.X.Q * PhPa     . . .",
+    " . . .  Pb  Pl  Q Q Q Q   Pa       . . .",
+    " . .O.W X.X.X.X.   . .  X.X.X.X.B o. . .",
+    " . . .O. . . .X.      PdX. . . .o. . . .",
+    " . . . . . . .X.  PePi  X. . . . . . . .",
+    " . . . . . .o.B         B o. . . . . . .",
+    " . . . . . . .o. . . . .o. . . . . . . ."})
+
+wo:shuffleOxyd({"oxydsB#*", max = 0}, {"oxydsW#*", max = 0})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_ix/devnull31_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_ix/devnull36_1.xml
===================================================================
--- trunk/data/levels/enigma_ix/devnull36_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/enigma_ix/devnull36_1.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -0,0 +1,56 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="At the pool" el:subtitle="" el:id="devnull36"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
+      <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2009 dev0</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:score el:easy="6:00" el:difficult="6:00"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["AllowSuicide"] = false
+
+ti[" "] = {"fl_rock"}
+ti["~"] = {"fl_water"}
+if wo["IsDifficult"] then
+    ti["#"] = ti["~"] .. {"st_grate_cross"}
+    wo["ProvideExtralifes"] = false
+else
+    ti["#"] = ti["~"] .. {"st_portal"}
+end
+ti["W"] = {"st_box_rock"}
+ti["D"] = {"st_door", "door#", faces = "ew"}
+ti["keys"] = {"it_key", code = "%%"}
+ti["holes"] = {"st_key", code = "%%", target = "@door#*"}
+ti["o"] = {"st_oxyd_c", "oxydsBorder#"}
+ti["O"] = {"st_oxyd_c", "oxydsCenter#"}
+ti["@"] = {"#ac_marble_black", 0.5}
+
+wo(res.autotile(ti, {"a", "b", "keys"}, {"A", "B", "holes"}), " ", {
+  "####################",
+  "#~~     ~##~     ~~#",
+  "#~ W~  W~##~W  ~W ~#",
+  "#~  W  Wa##bW  W  ~#",
+  "#~  ####~~~~####  ~#",
+  "#~ W#~~~~~~~~~~#W ~#",
+  "#~  #   ~~~~   #  ~#",
+  "#~ ~#W W ~~ W W#~ ~#",
+  "#~~~    W@ W    ~~~#",
+  "#~~~   ######   ~~~#",
+  "##~~~###OOOO###~~~##",
+  "#o~~~D        D~~~o#",
+  "##o#A##########B#o##"})
+
+wo:shuffleOxyd({"oxydsCenter#*", max = 0}, {"oxydsBorder#*", max = 0})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_ix/devnull36_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_ix/devnull38_1.xml
===================================================================
--- trunk/data/levels/enigma_ix/devnull38_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/enigma_ix/devnull38_1.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -0,0 +1,79 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Crabwise III" el:subtitle="" el:id="devnull38"/>
+      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2009 dev0</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libpuzzle" el:id="lib/libpuzzle" el:release="3" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:score el:easy="3:45" el:difficult="3:45"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["AllowSuicide"] = false
+wo["ProvideExtralifes"] = not wo["IsDifficult"]
+
+ti[" "] = {"fl_rock"}
+ti["~"] = {"fl_water"}
+ti["."] = {"fl_abyss"}
+ti["#"] = ti({"fl_bridge"}) .. {"st_redrock"}
+ti["X"] = ti[" "] .. {"st_grate_cross"}
+ti["x"] = cond(wo["IsDifficult"], ti["~"] .. {"st_grate_cross"}, ti["~"])
+ti["+"] = cond(wo["IsDifficult"], ti[" "], ti["X"])
+ti["w"] = {"st_puzzle_blue", "pa", connections = "w", intensity = 0}
+ti["s"] = {"st_puzzle_blue", "pb", connections = "se", intensity = 0}
+ti["n"] = {"st_puzzle_blue", "pc", connections = "nw", intensity = 0}
+ti["e"] = {"st_puzzle_blue", "pd", connections = "e", intensity = 0}
+ti["W"] = {"st_puzzle_blue", "pA", connections = "w", intensity = 0}
+ti["-"] = {"st_puzzle_blue", "pB", connections = "ew", intensity = 0}
+ti["E"] = {"st_puzzle_blue", "pC", connections = "e", intensity = 0}
+ti["a"] = ti({"fl_hay_framed"}) .. {"it_trigger", target = "toggleDoors", action = "signal", invisible = true}
+ti["A"] = {"st_door_a", "doors#"}
+ti["b"] = ti({"fl_hay_framed"}) .. {"it_trigger", target = "toggleBridges", action = "signal", invisible = true}
+ti["B"] = {"fl_bridge", "bridges#"}
+ti["1"] = {"st_pull", "nav01"}
+ti["2"] = {"st_swap"}
+ti["3"] = {"st_box_rock"}
+ti["4"] = {"st_pull", "nav02"}
+ti["O"] = {"st_oxyd_a", oxydcolor = OXYD_RED, static = true}
+ti["@"] = {"#ac_marble_black"}
+
+wo(ti, " ", {
+    "##################O#",
+    "#     ~~x~X        #",
+    "#  ne ~x~~X        #",
+    "#     ~~~~X@ 2a1a3 #",
+    "# ws  ~~x~X        #",
+    "#     ~x~~X        #",
+    "##A#A###############",
+    "#       .....X     #",
+    "#       ..BBBX  E  #",
+    "#   4   ..B..+ b-b #",
+    "#       BBB..X  W  #",
+    "#       .....X     #",
+    "##################O#"})
+
+if wo["IsDifficult"] then
+    wo:add({"ot_wire", anchor1 = "nav01", anchor2 = "pa"})
+    wo:add({"ot_wire", anchor1 = "nav01", anchor2 = "pd"})
+    wo:add({"ot_wire", anchor1 = "nav02", anchor2 = "pA"})
+    wo:add({"ot_wire", anchor1 = "nav02", anchor2 = "pC"})
+else
+    wo:add({"ot_wire", anchor1 = "nav01", anchor2 = "pa"})
+    wo:add({"ot_wire", anchor1 = "nav02", anchor2 = "pC"})
+end
+wo:add({"ot_counter", "toggleDoors", state = 0, target = "doors#*", action_2 = "open", action_1 = "close"})
+wo:add({"ot_counter", "toggleBridges", state = 0, target = "bridges#*", action_2 = "close", action_1 = "open"})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="true"/>
+        <el:translation el:lang="de">Hintenrum III</el:translation>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_ix/devnull38_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_ix/devnull39_1.xml
===================================================================
--- trunk/data/levels/enigma_ix/devnull39_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/enigma_ix/devnull39_1.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -0,0 +1,70 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="lower i" el:subtitle="" el:id="devnull39"/>
+      <el:version el:score="1" el:release="1" el:revision="4" el:status="released"/>
+      <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2009 dev0</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:score el:easy="4:32" el:difficult="4:32"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["FollowMethod"] = FOLLOW_SCROLL
+wo["FollowThreshold"] = po(0, 0)
+wo["AllowSuicide"] = false
+wo["ProvideExtralifes"] = not wo["IsDifficult"]
+wo["FrictionStrength"] = cond(wo["IsDifficult"], 1.5, 1.0)
+wo["WormholeRange"] = 0.0
+
+ti["~"] = {"fl_water"}
+ti["."] = {"fl_abyss"}
+ti[" "] = {"fl_bridge_gc", state = CLOSED}
+ti["#"] = {"st_fake_oxyda"}
+ti["S"] = {"st_chess_black"}
+ti["triggers"] = {"it_trigger", target = "bridge%%"}
+ti["bridges"] = {"fl_bridge_gc", "bridge%%", state = OPEN}
+ti["w"] = {"it_wormhole", destination = po(6.0, 4.0)}
+ti["O"] = {"st_oxyd_a", "oxyds#"}
+ti["@"] = {"#ac_marble_black", 0.5, 0.0}
+
+wo(res.autotile(ti, {"a", "h", "bridges"}, {"A", "H", "triggers"}), " ", {
+    "............",
+    ".....##.....",
+    "...#O  O#...",
+    "..#O    O#..",
+    "..#O    O#..",
+    "...#O  O#...",
+    ".....##.....",
+    "............",
+    "............",
+    "............",
+    ".##########.",
+    "############",
+    "##whgfedcb##",
+    "##~~~~~~~a##",
+    "##  SSSS  ##",
+    "## ~SSSS~ ##",
+    "##  ~  ~  ##",
+    "##  ~  ~  ##",
+    "## ~    ~ ##",
+    "## ~~~~~~~##",
+    "##   @    ##",
+    "##ABCDEFGH##",
+    "############",
+    "############"})
+
+wo:shuffleOxyd({no["oxyds#*"]:sort("circular"), circular=true})
+if not wo["IsDifficult"] then
+    wo:add(YIN, {"it_pin"})
+end
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_ix/devnull39_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_ix/devnull44_1.xml
===================================================================
--- trunk/data/levels/enigma_ix/devnull44_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/enigma_ix/devnull44_1.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -0,0 +1,52 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Hide them" el:subtitle="" el:id="devnull44"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2009 dev0</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:score el:easy="-" el:difficult="4:44"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["AllowSuicide"] = false
+wo["WormholeRange"] = 0.0
+
+ti[" "] = {"fl_dark"}
+ti["~"] = {"fl_water"}
+ti["+"] = {"st_box_hay"}
+ti["x"] = {"st_grate"}
+ti["X"] = ti["~"] .. {"st_grate"}
+ti["#"] = {"st_redrock"}
+ti["medi"] = {"it_meditation_hill"}
+ti["T"] = {"fl_dark", name="bump%%"} .. ti["medi"]
+ti["t"] = ti["+"] .. {"it_wormhole", destination = "bump%%"}
+ti["s"] = {"it_wormhole", destination = "bump%1"}
+ti["S"] = {"it_wormhole", destination = "bump%4"}
+ti["@"] = {"#ac_pearl_white", essential = INDISPENSABLE}
+
+wo(res.autotile(ti, {"A","D","T"},{"a","d","t"}), " ", {
+    "####################",
+    "#   ~ ~ #  # ~~ ~  #",
+    "#   c  X#  # ++b ~ #",
+    "#~~~~ + #  #   + ~~#",
+    "# ++#   #@@#   #   #",
+    "# A #####  ##### D #",
+    "#   #   #sS#   #   #",
+    "##### B #  # C #####",
+    "#   #   #@@#   #   #",
+    "# ++~~  #  #~ ~~ ~~#",
+    "# ~d   +#  #  + a+~#",
+    "# ~  X~~#  # ~x +~~#",
+    "####################" })
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_ix/devnull44_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Added: trunk/data/levels/enigma_ix/devnull45_1.xml
===================================================================
--- trunk/data/levels/enigma_ix/devnull45_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/enigma_ix/devnull45_1.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -0,0 +1,76 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Crabwise IV" el:subtitle="" el:id="devnull45"/>
+      <el:version el:score="1" el:release="1" el:revision="4" el:status="released"/>
+      <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2009 dev0</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libpuzzle" el:id="lib/libpuzzle" el:release="3" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments>
+        <el:credits el:showinfo="true" el:showstart="false">Level idea: Ronald Lamprecht. Thanks alot.</el:credits>
+      </el:comments>
+      <el:score el:easy="6:00" el:difficult="8:00"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["AllowSuicide"] = false
+wo["ProvideExtralifes"] = not wo["IsDifficult"]
+
+ti[" "] = {"fl_rock"}
+ti["."] = {"fl_abyss"}
+ti["X"] = ti["."] .. {"st_grate"}
+ti["#"] = ti({"fl_bridge"}) .. {"st_redrock"}
+ti["n"] = {"st_puzzle_blue", "pa", connections = "n", intensity = 0}
+ti["e"] = {"st_puzzle_blue", "pb", connections = "e", intensity = 0}
+ti["i"] = {"st_puzzle_blue_nw", intensity = 0}
+ti["E"] = {"st_puzzle_blue", "pA", connections = "e", intensity = 0}
+ti["C"] = {"st_puzzle_blue", "pC", connections = "nw", intensity = 0}
+ti["c"] = {"st_puzzle_blue", "pc", connections = "sw", intensity = 0}
+ti["S"] = {"st_puzzle_blue", "pB", connections = "s", intensity = 0}
+ti["-"] = {"st_puzzle_blue_ew", intensity = 0}
+ti["^"] = {"st_puzzle_blue_s", intensity = 0}
+ti["<"] = {"st_puzzle_blue_e", intensity = 0}
+ti["1"] = {"st_pull", "nav01"}
+ti["2"] = {"st_pull", "nav02"}
+ti["O"] = {"st_oxyd_a", oxydcolor = OXYD_RED, static = true}
+ti["@"] = {"#ac_marble_black"}
+
+wo(ti, " ", {
+    "####################",
+    "#        ..X       #",
+    "#        ...  n    #",
+    "# 1@     ...  i  - O",
+    "#        ...  e    #",
+    "#        ..#       #",
+    "##^########X########",
+    "#<.      ..#       #",
+    "#..      ...  E    #",
+    "# 2      ...  Cc-  O",
+    "#        ...  S    #",
+    "#        ..X       #",
+    "####################"})
+
+if wo["IsDifficult"] then
+    wo:add({"ot_wire", anchor1 = "nav01", anchor2 = "pb"})
+    wo:add({"ot_wire", anchor1 = "nav02", anchor2 = "pC"})
+else
+    wo:add({"ot_wire", anchor1 = "nav01", anchor2 = "pa"})
+    wo:add({"ot_wire", anchor1 = "nav01", anchor2 = "pb"})
+    wo:add({"ot_wire", anchor1 = "nav02", anchor2 = "pc"})
+    wo:add({"ot_wire", anchor1 = "nav02", anchor2 = "pC"})
+end
+
+wo:add(YIN, {"it_magicwand"})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="true"/>
+        <el:translation el:lang="de">Hintenrum IV</el:translation>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: trunk/data/levels/enigma_ix/devnull45_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native

Modified: trunk/data/levels/enigma_ix/index.xml
===================================================================
--- trunk/data/levels/enigma_ix/index.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/enigma_ix/index.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="11100" network="false" owner="Enigma Team" release="1" revision="4" title="Enigma IX"/>
+  <info enigma="1.10" group="Enigma" location="11100" network="false" owner="Enigma Team" release="1" revision="5" title="Enigma IX"/>
 
   <attributes/>
 
@@ -17,6 +17,12 @@
     <level _seq="9" _title="Behind glass" _xpath="./rudolf01_1" author="Rudolf" ctrl="force" easy="false" id="rudolf01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="10" _title="Perennial Creek" _xpath="./pulley20_2" author="Mark Pulley" ctrl="force" easy="true" id="20080614pulley001" rel="2" rev="2" score="2" target="time" unit="duration"/>
     <level _seq="11" _title="Wired pulls" _xpath="./raoul36_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul36" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="12" _title="Crabwise III" _xpath="./devnull38_1" author="/dev/null" ctrl="force" easy="true" id="devnull38" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="13" _title="Bicolor" _xpath="./devnull31_1" author="/dev/null" ctrl="force" easy="false" id="devnull31" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="14" _title="lower i" _xpath="./devnull39_1" author="/dev/null" ctrl="force" easy="true" id="devnull39" rel="1" rev="4" score="1" target="time" unit="duration"/>
+    <level _seq="15" _title="At the pool" _xpath="./devnull36_1" author="/dev/null" ctrl="force" easy="true" id="devnull36" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="16" _title="Hide them" _xpath="./devnull44_1" author="/dev/null" ctrl="force" easy="false" id="devnull44" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="17" _title="Crabwise IV" _xpath="./devnull45_1" author="/dev/null" ctrl="force" easy="true" id="devnull45" rel="1" rev="4" score="1" target="time" unit="duration"/>
   </levels>
 
 </index>

Modified: trunk/data/levels/enigma_viii/andreas49_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/andreas49_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/enigma_viii/andreas49_1.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Weirdly Wired" el:subtitle="" el:id="andreas49"/>
-      <el:version el:score="1" el:release="1" el:revision="10" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="11" el:status="released"/>
       <el:author el:name="Andreas Lochmann" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008, 2009 Andreas Lochmann</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -14,11 +14,11 @@
       <el:score el:easy="0:37" el:difficult="8:49"/>
     </el:info>
     <el:luamain><![CDATA[
-    
-ti[" "] = {"fl_sahara", friction = 3.5, mouseforce = 4.0}
-ti["a"] = {"fl_ivory", friction = 3.5, mouseforce = 4.0}
-ti["b"] = {"fl_bright", friction = 3.5, mouseforce = 4.0}
-ti["c"] = {"fl_platinum", friction = 3.5, mouseforce = 4.0}
+
+ti[" "] = {"fl_sahara", friction = 3.5, adhesion = 4.0}
+ti["a"] = {"fl_ivory", friction = 3.5, adhesion = 4.0}
+ti["b"] = {"fl_bright", friction = 3.5, adhesion = 4.0}
+ti["c"] = {"fl_platinum", friction = 3.5, adhesion = 4.0}
 ti["_"] = {"fl_water"}
 ti["@"] = {"#ac_marble_black"}
 ti["w"] = {"st_flat_movable", "wood#"}
@@ -34,7 +34,7 @@
 polynom = lib.math.random_vector(10, 4)
 
 function myresolver(key, x, y)
-  if key == " " then  
+  if key == " " then
     return floors[lib.math.cubic_polynomial(polynom, x, y) % (#floors) + 1]
   elseif    (key == "#")
          or ((key == "_") and (random(4) == 1))

Modified: trunk/data/levels/enigma_viii/index.xml
===================================================================
--- trunk/data/levels/enigma_viii/index.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/enigma_viii/index.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10900" network="false" owner="Enigma Team" release="1" revision="52" title="Enigma VIII"/>
+  <info enigma="1.10" group="Enigma" location="10900" network="false" owner="Enigma Team" release="1" revision="53" title="Enigma VIII"/>
 
   <attributes/>
 
   <levels>
-    <level _seq="1" _title="Welcome" _xpath="./welcometopack8_1" author="Raoul Bourquin" ctrl="force" easy="true" id="welcometopack8" rel="1" rev="6" score="1" target="time" unit="duration"/>
+    <level _seq="1" _title="Welcome" _xpath="./welcometopack8_1" author="Raoul Bourquin" ctrl="force" easy="true" id="welcometopack8" rel="1" rev="7" score="1" target="time" unit="duration"/>
     <level _seq="2" _title="Enigmaparcour I" _xpath="./mecke15_1" author="mecke" ctrl="force" easy="true" id="mecke15" rel="1" rev="36" score="1" target="time" unit="duration"/>
     <level _seq="3" _title="Rhythm of Space" _xpath="./mecke20_2" author="mecke" ctrl="force" easy="true" id="mecke20" rel="2" rev="37" score="1" target="time" unit="duration"/>
     <level _seq="4" _title="The Show Jumper" _xpath="./andreas47_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas47" rel="1" rev="12" score="1" target="time" unit="duration"/>
@@ -26,7 +26,7 @@
     <level _seq="18" _title="Color Maze" _xpath="./pulley16_3" author="Mark Pulley" ctrl="force" easy="false" id="pulley16" rel="3" rev="10" score="3" target="time" unit="duration"/>
     <level _seq="19" _title="Earthlink" _xpath="./pulley15_1" author="Mark Pulley" ctrl="force" easy="true" id="pulley15" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="20" _title="Vanity's Constrictions" _xpath="./andreas53_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas53" rel="2" rev="10" score="2" target="time" unit="duration"/>
-    <level _seq="21" _title="Weirdly Wired" _xpath="./andreas49_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas49" rel="1" rev="10" score="1" target="time" unit="duration"/>
+    <level _seq="21" _title="Weirdly Wired" _xpath="./andreas49_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas49" rel="1" rev="11" score="1" target="time" unit="duration"/>
     <level _seq="22" _title="Push Wires" _xpath="./ral24_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080708ral196" rel="1" rev="129" score="1" target="time" unit="duration"/>
     <level _seq="23" _title="Wired Five" _xpath="./ral25_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20080721ral073" rel="1" rev="130" score="1" target="time" unit="duration"/>
     <level _seq="24" _title="Wireban Premiere" _xpath="./ral26_1" author="Ronald Lamprecht" ctrl="force" easy="false" id="20080715ral161" rel="1" rev="130" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_viii/welcometopack8_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/welcometopack8_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/enigma_viii/welcometopack8_1.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Welcome" el:subtitle="" el:id="welcometopack8"/>
-      <el:version el:score="1" el:release="1" el:revision="6" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="7" el:status="released"/>
       <el:author  el:name="Raoul Bourquin" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Raoul Bourquin</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -12,6 +12,8 @@
       <el:score el:easy="-" el:difficult="-"/>
     </el:info>
     <el:luamain><![CDATA[
+wo["MaxOxydColor"] = OXYD_GRAY
+
 ti[" "] = {"fl_red"}
 ti["#"] = {"st_redfiber"}
 ti["t"] = {"st_oxyd", name="group1#"}

Modified: trunk/data/levels/pentomino_i/index.xml
===================================================================
--- trunk/data/levels/pentomino_i/index.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/pentomino_i/index.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.00" group="Sokoban" location="69000" network="false" owner="Enigma Team" release="1" revision="2" title="Pentomino I"/>
+  <info enigma="1.00" group="Sokoban" location="69000" network="false" owner="Enigma Team" release="1" revision="3" title="Pentomino I"/>
 
   <attributes/>
 
@@ -68,7 +68,7 @@
     <level _seq="60" _title="Pentomino LXI" _xpath="./pento61_1" author="Enigma Team" ctrl="force" easy="false" id="pento61" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="61" _title="Pentomino LXII" _xpath="./pento62_1" author="Enigma Team" ctrl="force" easy="false" id="pento62" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="62" _title="Pentomino LXIII" _xpath="./pento63_1" author="Enigma Team" ctrl="force" easy="false" id="pento63" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="63" _title="Pentomino LXIV" _xpath="./pento64_1" author="Enigma Team" ctrl="force" easy="false" id="pento64" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="63" _title="Pentomino LXIV" _xpath="./pento64_1" author="Enigma Team" ctrl="force" easy="false" id="pento64" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="64" _title="Pentomino LXV" _xpath="./pento65_1" author="Enigma Team" ctrl="force" easy="false" id="pento65" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="65" _title="Pentomino LXVI" _xpath="./pento66_1" author="Enigma Team" ctrl="force" easy="false" id="pento66" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="66" _title="Pentomino LXVII" _xpath="./pento67_1" author="Enigma Team" ctrl="force" easy="false" id="pento67" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -81,9 +81,9 @@
     <level _seq="73" _title="Pentomino LXXIV" _xpath="./pento74_1" author="Enigma Team" ctrl="force" easy="false" id="pento74" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="74" _title="Pentomino LXXV" _xpath="./pento75_1" author="Enigma Team" ctrl="force" easy="false" id="pento75" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="75" _title="Pentomino LXXVI" _xpath="./pento76_1" author="Enigma Team" ctrl="force" easy="false" id="pento76" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="76" _title="Pentomino LXXVII" _xpath="./pento77_1" author="Enigma Team" ctrl="force" easy="false" id="pento77" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="77" _title="Pentomino LXXVIII" _xpath="./pento78_1" author="Enigma Team" ctrl="force" easy="false" id="pento78" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="78" _title="Pentomino LXXIX" _xpath="./pento79_1" author="Enigma Team" ctrl="force" easy="false" id="pento79" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="76" _title="Pentomino LXXVII" _xpath="./pento77_1" author="Enigma Team" ctrl="force" easy="false" id="pento77" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="77" _title="Pentomino LXXVIII" _xpath="./pento78_1" author="Enigma Team" ctrl="force" easy="false" id="pento78" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="78" _title="Pentomino LXXIX" _xpath="./pento79_1" author="Enigma Team" ctrl="force" easy="false" id="pento79" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="79" _title="Pentomino LXXX" _xpath="./pento80_1" author="Enigma Team" ctrl="force" easy="false" id="pento80" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="80" _title="Pentomino LXXXI" _xpath="./pento81_1" author="Enigma Team" ctrl="force" easy="false" id="pento81" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="81" _title="Pentomino LXXXII" _xpath="./pento82_1" author="Enigma Team" ctrl="force" easy="false" id="pento82" rel="1" rev="2" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/pentomino_i/pento64_1.xml
===================================================================
--- trunk/data/levels/pentomino_i/pento64_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/pentomino_i/pento64_1.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -2,8 +2,8 @@
 <el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
   <el:protected >
     <el:info el:type="level">
-      <el:identity el:title="Pentomino LXIV" el:subtitle="8 solutions" el:id="pento64"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:identity el:title="Pentomino LXIV" el:subtitle="15 solutions" el:id="pento64"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author el:name="Enigma Team" el:email=""/>
       <el:copyright>Copyright ? 2009 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>

Modified: trunk/data/levels/pentomino_i/pento77_1.xml
===================================================================
--- trunk/data/levels/pentomino_i/pento77_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/pentomino_i/pento77_1.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -2,8 +2,8 @@
 <el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
   <el:protected >
     <el:info el:type="level">
-      <el:identity el:title="Pentomino LXXVII" el:subtitle="6 solutions" el:id="pento77"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:identity el:title="Pentomino LXXVII" el:subtitle="4 solutions" el:id="pento77"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author el:name="Enigma Team" el:email=""/>
       <el:copyright>Copyright ? 2009 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>

Modified: trunk/data/levels/pentomino_i/pento78_1.xml
===================================================================
--- trunk/data/levels/pentomino_i/pento78_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/pentomino_i/pento78_1.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -2,8 +2,8 @@
 <el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
   <el:protected >
     <el:info el:type="level">
-      <el:identity el:title="Pentomino LXXVIII" el:subtitle="210 solutions" el:id="pento78"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:identity el:title="Pentomino LXXVIII" el:subtitle="420 solutions" el:id="pento78"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author el:name="Enigma Team" el:email=""/>
       <el:copyright>Copyright ? 2009 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>

Modified: trunk/data/levels/pentomino_i/pento79_1.xml
===================================================================
--- trunk/data/levels/pentomino_i/pento79_1.xml	2009-08-29 19:18:36 UTC (rev 1789)
+++ trunk/data/levels/pentomino_i/pento79_1.xml	2009-09-01 20:40:00 UTC (rev 1790)
@@ -2,8 +2,8 @@
 <el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
   <el:protected >
     <el:info el:type="level">
-      <el:identity el:title="Pentomino LXXIX" el:subtitle="210 solutions" el:id="pento79"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:identity el:title="Pentomino LXXIX" el:subtitle="19 solutions" el:id="pento79"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author el:name="Enigma Team" el:email=""/>
       <el:copyright>Copyright ? 2009 Enigma Team</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>



From ral at mail.berlios.de  Wed Sep  2 23:13:10 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Wed, 2 Sep 2009 23:13:10 +0200
Subject: [Enigma-game-svn] r1791 - in trunk: doc/reference src/floors
Message-ID: <200909022113.n82LDAMK013548@sheep.berlios.de>

Author: ral
Date: 2009-09-02 23:13:02 +0200 (Wed, 02 Sep 2009)
New Revision: 1791

Modified:
   trunk/doc/reference/enigma-ref.texi
   trunk/src/floors/StandardFloors.cc
Log:
Trunk 1.1:
- fix r1787 wrong adhesion and friction for standard floors 
- refman: additions for pseudo tiles fl_nil, st_nil, it_nil, nil


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-09-01 20:40:00 UTC (rev 1790)
+++ trunk/doc/reference/enigma-ref.texi	2009-09-02 21:13:02 UTC (rev 1791)
@@ -4999,9 +4999,9 @@
 not part of the source code itself!
 
 @example
-01	  <el:compatibility el:enigma="1.10">
-02	    <el:dependency el:path="lib/libmath" el:id="lib/libmath" el:release="1" el:preload="true"/>
-03	  </el:compatibility>
+01      <el:compatibility el:enigma="1.10">
+02         <el:dependency el:path="lib/libmath" el:id="lib/libmath" el:release="1" el:preload="true"/>
+03      </el:compatibility>
 ...
 04    @i{ti}["@var{ }"] = @{"@b{fl_sahara}", @b{friction} = @var{3.5}, @b{adhesion} = @var{4.0}@}
 05    @i{ti}["@var{a}"] = @{"@b{fl_ivory}", @b{friction} = @var{3.5}, @b{adhesion} = @var{4.0}@}
@@ -5023,7 +5023,7 @@
 21
 22    function @var{myresolver}(@var{key}, @var{x}, @var{y})
 23      if @var{key} == "@var{ }" then
-24	  return @var{floors}[@i{lib}. at i{math}. at i{cubic_polynomial}(@var{polynom}, @var{x}, @var{y}) % (#@var{floors}) + @var{1}]
+24        return @var{floors}[@i{lib}. at i{math}. at i{cubic_polynomial}(@var{polynom}, @var{x}, @var{y}) % (#@var{floors}) + @var{1}]
 25      elseif    (@var{key} == "@var{#}")
 26            or ((@var{key} == "@var{_}") and (@i{random}(@var{4}) == @var{1}))
 27            or ((@var{key} == "@var{S}") and @i{wo}["@b{IsDifficult}"]) then
@@ -5086,9 +5086,9 @@
 that do the real work.
 
 @example
-01	  <el:compatibility el:enigma="1.10">
-02	    <el:dependency el:path="lib/libmath" el:id="lib/libmath" el:release="1" el:preload="true"/>
-03	  </el:compatibility>
+01       <el:compatibility el:enigma="1.10">
+02         <el:dependency el:path="lib/libmath" el:id="lib/libmath" el:release="1" el:preload="true"/>
+03       </el:compatibility>
 @end example
 We make use of some functions of the @ref{libmath} library. Thus we need to
 preload it, besides declaration of compatibility to Enigma 1.10.
@@ -5154,7 +5154,7 @@
 
 @example
 23      if @var{key} == "@var{ }" then
-24	  return @var{floors}[@i{lib}. at i{math}. at i{cubic_polynomial}(@var{polynom}, @var{x}, @var{y}) % (#@var{floors}) + @var{1}]
+24        return @var{floors}[@i{lib}. at i{math}. at i{cubic_polynomial}(@var{polynom}, @var{x}, @var{y}) % (#@var{floors}) + @var{1}]
 @end example
 These two lines generate the always changing floor design. For every map key
 @samp{ } we calculate the cubic polynomial that is randomized due to the
@@ -6878,6 +6878,46 @@
 Enigma guarantees that the objects will be set to the world in the sequence
 of declarations in the tile.
 
+ at obindex fl_nil
+ at obindex it_nil
+ at obindex st_nil
+ at obindex nil
+Even though in most cases you use object declarations and tiles to set objects
+you may need in some advanced usage cases to supply such a datatype in 
+situations where you want to add nothing at all or even want to kill an
+possibly existing object. In these cases you can supply on of the pseudo object
+kind names @code{"fl_nil"}, @code{"it_nil"}, @code{"st_nil"} or @code{"nil"}.
+While the first three pseudo kinds will kill existing objects on the given
+layer, the last pseudo kind will just do nothing. It is equivalent, but more
+expressive than an empty Lua table being used as an object declaration:
+
+ at example
+ at i{ti}["@var{D}"] = @i{cond}(@i{wo}["@b{IsDifficult"}], @{"@b{st_death}"@}, @{"@b{nil}"@})
+ at i{ti}["@var{S}"] = @{"@b{st_surprise}", @b{selection}=@{"@b{st_box}", "@b{st_nil}"@}@}
+function @var{customresolver}(@var{key}, @var{x}, @var{y})
+    if @var{key} == "@var{a}" then
+        return @{"@b{nil}"@}
+    elseif @var{key} == "@var{b}" then
+        return @{@}
+    else
+        return @i{ti}[@var{key}]
+    end
+end
+ at end example
+
+The first sample uses the pseudo to supply a valid third arguement to the
+ at ref{cond} function that causes no syntax error when being passed to the
+world in easy mode.
+
+The second sample uses the pseudo to kill the @ref{st_surprise} even when
+no substitution stone is being set.
+
+The last example of an @ref{Custom Resolver} provides a solution of avoiding
+the change of the world on a given key in the world map. Usually you will always
+set at least a floor object. But if you draw a map during runtime there is no
+longer the need of setting inital floors. In cases where this can not be handled
+by proper usage of default keys the pseudo kind @code{"nil"} is your friend.
+
 For task driven samples @pxref{Tiles and World Tasks}.
 
 @menu
@@ -7786,6 +7826,7 @@
 @item @b{Syntax Samples:}
 @example
 @i{ti}["@var{x}"] = @i{cond}(@i{wo}["@b{IsDifficult}"], @{"@b{st_death}"@}, @i{ti}["@var{#}"])
+ at i{ti}["@var{D}"] = @i{cond}(@i{wo}["@b{IsDifficult"}], @{"@b{st_death}"@}, @{"@b{nil}"@})
 @end example
 
 @item @b{Details:}
@@ -22570,7 +22611,7 @@
 like @samp{return ti(@{"st_switch", state=ON@})}.
 
 If you decide not to draw any tile at all, you must return an empty tile
-declaration: @samp{return ti(@{@})}.
+declaration: @samp{return @{"nil"@}} or @samp{return @{@}}.
 
 @samp{return nil} indicates an error of usage of an unknown tile key.
 

Modified: trunk/src/floors/StandardFloors.cc
===================================================================
--- trunk/src/floors/StandardFloors.cc	2009-09-01 20:40:00 UTC (rev 1790)
+++ trunk/src/floors/StandardFloors.cc	2009-09-02 21:13:02 UTC (rev 1791)
@@ -95,7 +95,7 @@
     StandardFloor::StandardFloor(int type, bool framed) : Floor(StandardFloorNames[type].classname.c_str()) {
         state = type;
         Floor::setAttr("faces", framed ? "nesw" : "");
-        if  (type = 40) { // fl_metal_7n -- legacy normal floor with special values
+        if  (type == 40) { // fl_metal_7n -- legacy normal floor with special values
             setAttr("friction", 4.0);
             setAttr("adhesion", 2.0);
         }



From raoul at mail.berlios.de  Fri Sep  4 01:21:44 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Fri, 4 Sep 2009 01:21:44 +0200
Subject: [Enigma-game-svn] r1792 - in trunk: attic/images-stones data
	data/gfx16 data/gfx32 data/gfx40 data/gfx48 data/gfx64
Message-ID: <200909032321.n83NLiI7010756@sheep.berlios.de>

Author: raoul
Date: 2009-09-04 01:21:26 +0200 (Fri, 04 Sep 2009)
New Revision: 1792

Added:
   trunk/attic/images-stones/st_dispenser_extralife_break-gfx16.xcf
   trunk/attic/images-stones/st_dispenser_extralife_break-gfx32.xcf
   trunk/attic/images-stones/st_dispenser_extralife_break-gfx40.xcf
   trunk/attic/images-stones/st_dispenser_extralife_break-gfx48.xcf
   trunk/attic/images-stones/st_dispenser_extralife_break-gfx64.xcf
   trunk/attic/images-stones/st_rotator-gfx32.xcf
   trunk/attic/images-stones/st_rotator_ccw-gfx16.xcf
   trunk/attic/images-stones/st_rotator_ccw-gfx40.xcf
   trunk/attic/images-stones/st_rotator_ccw-gfx48.xcf
   trunk/attic/images-stones/st_rotator_ccw-gfx64.xcf
   trunk/attic/images-stones/st_rotator_cw-gfx16.xcf
   trunk/attic/images-stones/st_rotator_cw-gfx40.xcf
   trunk/attic/images-stones/st_rotator_cw-gfx48.xcf
   trunk/attic/images-stones/st_rotator_cw-gfx64.xcf
   trunk/attic/images-stones/yinyang_symbols.svg
   trunk/data/gfx16/st_rotator_ccw.png
   trunk/data/gfx16/st_rotator_cw.png
   trunk/data/gfx64/st_rotator_ccw.png
   trunk/data/gfx64/st_rotator_cw.png
Removed:
   trunk/attic/images-stones/yinyang_sombols.svg
Modified:
   trunk/data/gfx16/st_dispenser_extralife.png
   trunk/data/gfx32/st_dispenser_extralife.png
   trunk/data/gfx32/st_rotator_ccw.png
   trunk/data/gfx32/st_rotator_cw.png
   trunk/data/gfx40/st_dispenser_extralife.png
   trunk/data/gfx40/st_rotator_ccw.png
   trunk/data/gfx40/st_rotator_cw.png
   trunk/data/gfx48/st_dispenser_extralife.png
   trunk/data/gfx48/st_rotator_ccw.png
   trunk/data/gfx48/st_rotator_cw.png
   trunk/data/gfx64/st_dispenser_extralife.png
   trunk/data/models-2d.lua
Log:
-> Added st_dispenser_extralife break anim
-> Unified models-2d code for dispenser stones
-> Improved gfx for st_rotator
-> Fixed typo in attic yinyang symbols



Added: trunk/attic/images-stones/st_dispenser_extralife_break-gfx16.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_dispenser_extralife_break-gfx16.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_dispenser_extralife_break-gfx32.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_dispenser_extralife_break-gfx32.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_dispenser_extralife_break-gfx40.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_dispenser_extralife_break-gfx40.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_dispenser_extralife_break-gfx48.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_dispenser_extralife_break-gfx48.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_dispenser_extralife_break-gfx64.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_dispenser_extralife_break-gfx64.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_rotator-gfx32.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_rotator-gfx32.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_rotator_ccw-gfx16.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_rotator_ccw-gfx16.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_rotator_ccw-gfx40.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_rotator_ccw-gfx40.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_rotator_ccw-gfx48.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_rotator_ccw-gfx48.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_rotator_ccw-gfx64.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_rotator_ccw-gfx64.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_rotator_cw-gfx16.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_rotator_cw-gfx16.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_rotator_cw-gfx40.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_rotator_cw-gfx40.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_rotator_cw-gfx48.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_rotator_cw-gfx48.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Added: trunk/attic/images-stones/st_rotator_cw-gfx64.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/attic/images-stones/st_rotator_cw-gfx64.xcf
___________________________________________________________________
Name: svn:mime-type
   + image/x-xcf

Deleted: trunk/attic/images-stones/yinyang_sombols.svg
===================================================================
--- trunk/attic/images-stones/yinyang_sombols.svg	2009-09-02 21:13:02 UTC (rev 1791)
+++ trunk/attic/images-stones/yinyang_sombols.svg	2009-09-03 23:21:26 UTC (rev 1792)
@@ -1,636 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no"?>
-<!-- Created with Inkscape (http://www.inkscape.org/) -->
-<svg
-   xmlns:svg="http://www.w3.org/2000/svg"
-   xmlns="http://www.w3.org/2000/svg"
-   version="1.0"
-   width="210mm"
-   height="297mm"
-   id="svg2">
-  <defs
-     id="defs4" />
-  <g
-     id="layer1">
-    <g
-       transform="matrix(0.7071068,0.7071068,-0.7071068,0.7071068,-2392.9517,-1322.9221)"
-       id="g2540">
-      <g
-         id="g2542">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2544"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2546"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2548"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2550">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2552"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2554"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="matrix(0,1,-1,0,-606.4814,-1146.8814)"
-       id="g2556">
-      <g
-         id="g2558">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2560"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2562"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2564"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2566">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2568"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2570"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="matrix(-0.7071068,0.7071068,-0.7071068,-0.7071068,931.02946,-721.88143)"
-       id="g2572">
-      <g
-         id="g2574">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2576"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2578"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2580"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2582">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2584"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2586"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="translate(-4179.4215,-1146.8814)"
-       id="g2604">
-      <g
-         id="g2606">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2608"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2610"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2612"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2614">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2616"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2618"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="translate(1266.4587,-1146.8814)"
-       id="g2732">
-      <g
-         transform="matrix(-1,0,0,-1,850,850)"
-         id="g2734">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2736"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2738"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2740"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2742">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2744"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2746"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="matrix(0.7071068,0.7071068,-0.7071068,0.7071068,3052.9291,-1322.9222)"
-       id="g2780">
-      <g
-         transform="matrix(-1,0,0,-1,850,850)"
-         id="g2782">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2784"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2786"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2788"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2790">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2792"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2794"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="matrix(0,1,-1,0,4839.3991,-1146.8814)"
-       id="g2828">
-      <g
-         transform="matrix(-1,0,0,-1,850,850)"
-         id="g2830">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2832"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2834"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2836"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2838">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2840"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2842"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="matrix(-0.7071068,0.7071068,-0.7071068,-0.7071068,6376.9094,-721.8814)"
-       id="g2876">
-      <g
-         transform="matrix(-1,0,0,-1,850,850)"
-         id="g2878">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2880"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2882"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2884"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2886">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2888"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2890"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="translate(-4179.4215,93.227713)"
-       id="g2620">
-      <g
-         id="g2622">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2624"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2626"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2628"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2630">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2632"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2634"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="matrix(0.5,0.8660254,-0.8660254,0.5,-1793.3611,-62.333082)"
-       id="g2636">
-      <g
-         id="g2638">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2640"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2642"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2644"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2646">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2648"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2650"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="matrix(-0.5,0.8660254,-0.8660254,-0.5,437.13852,362.66692)"
-       id="g2652">
-      <g
-         id="g2654">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2656"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2658"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2660"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2662">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2664"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2666"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="translate(1237.0774,93.227713)"
-       id="g2748">
-      <g
-         transform="matrix(-1,0,0,-1,850,850)"
-         id="g2750">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2752"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2754"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2756"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2758">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2760"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2762"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="matrix(0.5,0.8660254,-0.8660254,0.5,3623.1377,-62.333082)"
-       id="g2844">
-      <g
-         transform="matrix(-1,0,0,-1,850,850)"
-         id="g2846">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2848"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2850"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2852"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2854">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2856"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2858"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="matrix(-0.5,0.8660254,-0.8660254,-0.5,5853.6375,362.66692)"
-       id="g2892">
-      <g
-         transform="matrix(-1,0,0,-1,850,850)"
-         id="g2894">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2896"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2898"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2900"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2902">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2904"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2906"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="translate(-4179.4215,1168.8407)"
-       id="g2684">
-      <g
-         id="g2686">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2688"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2690"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2692"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2694">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2696"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2698"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="matrix(0,1,-1,0,-551.46899,1168.8407)"
-       id="g2700">
-      <g
-         id="g2702">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2704"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2706"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2708"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2710">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2712"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2714"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="translate(1376.4834,1168.8407)"
-       id="g2764">
-      <g
-         transform="matrix(-1,0,0,-1,850,850)"
-         id="g2766">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2768"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2770"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2772"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2774">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2776"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2778"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-    <g
-       transform="matrix(0,1,-1,0,5004.4357,1168.8407)"
-       id="g2908">
-      <g
-         transform="matrix(-1,0,0,-1,850,850)"
-         id="g2910">
-        <g
-           transform="matrix(-1,0,0,-1,825,825)"
-           id="g2912"
-           style="fill:#000000;fill-opacity:1">
-          <path
-             d="M 425,25 C 204.2,25 25,204.2 25,425 C 25,645.8 204.2,825 425,825 C 314.6,825 225,735.4 225,625 C 225,514.6 314.6,425 425,425 C 535.4,425 625,335.4 625,225 C 625,114.6 535.4,25 425,25 z M 425,162.5 C 459.5,162.5 487.5,190.5 487.5,225 C 487.5,259.5 459.5,287.5 425,287.5 C 390.5,287.5 362.5,259.5 362.5,225 C 362.5,190.5 390.5,162.5 425,162.5 z"
-             transform="matrix(-1,0,0,-1,825,825)"
-             id="path2914"
-             style="fill:#000000;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,1.25,-100,-50)"
-             id="path2916"
-             style="opacity:1;fill:#000000;fill-opacity:1;stroke:none" />
-        </g>
-        <g
-           id="g2918">
-          <path
-             d="M 425,25 C 535.4,25 625,114.6 625,225 C 625,335.4 535.4,425 425,425 C 314.6,425 225,514.6 225,625 C 225,735.4 314.6,825 425,825 C 645.8,825 825,645.8 825,425 C 825,204.2 645.8,25 425,25 z M 425,562.5 C 459.5,562.5 487.5,590.5 487.5,625 C 487.5,659.5 459.5,687.5 425,687.5 C 390.5,687.5 362.5,659.5 362.5,625 C 362.5,590.5 390.5,562.5 425,562.5 z"
-             id="path2920"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-          <path
-             d="M 450,200 A 50,50 0 1 1 350,200 A 50,50 0 1 1 450,200 z"
-             transform="matrix(1.25,0,0,-1.25,-75,475)"
-             id="path2922"
-             style="fill:#ffffff;fill-opacity:1;stroke:none" />
-        </g>
-      </g>
-    </g>
-  </g>
-</svg>

Copied: trunk/attic/images-stones/yinyang_symbols.svg (from rev 1789, trunk/attic/images-stones/yinyang_sombols.svg)

Modified: trunk/data/gfx16/st_dispenser_extralife.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx16/st_rotator_ccw.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx16/st_rotator_ccw.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx16/st_rotator_cw.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx16/st_rotator_cw.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Modified: trunk/data/gfx32/st_dispenser_extralife.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx32/st_rotator_ccw.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx32/st_rotator_cw.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/st_dispenser_extralife.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/st_rotator_ccw.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx40/st_rotator_cw.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/st_dispenser_extralife.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/st_rotator_ccw.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx48/st_rotator_cw.png
===================================================================
(Binary files differ)

Modified: trunk/data/gfx64/st_dispenser_extralife.png
===================================================================
(Binary files differ)

Added: trunk/data/gfx64/st_rotator_ccw.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx64/st_rotator_ccw.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/data/gfx64/st_rotator_cw.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx64/st_rotator_cw.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2009-09-02 21:13:02 UTC (rev 1791)
+++ trunk/data/models-2d.lua	2009-09-03 23:21:26 UTC (rev 1792)
@@ -956,23 +956,18 @@
 
 -- st_dispenser --
 do
-    function make_bombstone(name)
+    function make_dispenser(name)
         local images = DefSubimages(name, {h=7})
         DefRoundStone(name, name.."1")
         DefAnim(name.."_breaking", BuildFrames(images,50))
     end
 
-    make_bombstone("st_dispenser_bombblack")
-    make_bombstone("st_dispenser_dynamite")
-    make_bombstone("st_dispenser_bombwhite")
+    make_dispenser("st_dispenser_bombblack")
+    make_dispenser("st_dispenser_dynamite")
+    make_dispenser("st_dispenser_bombwhite")
+    make_dispenser("st_dispenser_extralife")
 end
 
--- st_dispenser_extralife --
-do
-    local images = DefSubimages("st_dispenser_extralife", {h=7})
-    DefRoundStone("st_dispenser_extralife", "st_dispenser_extralife1")
-end
-
 -- st-flash --
 do
     local images = DefSubimages("st_flash", {h=1})



From ral at mail.berlios.de  Sun Sep  6 01:26:15 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 6 Sep 2009 01:26:15 +0200
Subject: [Enigma-game-svn] r1793 - in trunk: data
	data/levels/enigma_experimental src src/actors src/floors
	src/items src/stones
Message-ID: <200909052326.n85NQF1B000602@sheep.berlios.de>

Author: ral
Date: 2009-09-06 01:26:05 +0200 (Sun, 06 Sep 2009)
New Revision: 1793

Modified:
   trunk/data/api1init.lua
   trunk/data/levels/enigma_experimental/floors_1.xml
   trunk/data/models-2d.lua
   trunk/src/GridObject.cc
   trunk/src/GridObject.hh
   trunk/src/Inventory.cc
   trunk/src/Object.cc
   trunk/src/Object.hh
   trunk/src/WorldProxy.cc
   trunk/src/WorldProxy.hh
   trunk/src/actors.cc
   trunk/src/actors/Balls.cc
   trunk/src/actors/Balls.hh
   trunk/src/actors/BugActor.cc
   trunk/src/actors/BugActor.hh
   trunk/src/actors/HorseActor.cc
   trunk/src/actors/HorseActor.hh
   trunk/src/actors/KillerActor.cc
   trunk/src/actors/KillerActor.hh
   trunk/src/actors/Rotors.cc
   trunk/src/actors/Rotors.hh
   trunk/src/display.hh
   trunk/src/floors.cc
   trunk/src/floors.hh
   trunk/src/floors/BridgeFloor.cc
   trunk/src/floors/BridgeFloor.hh
   trunk/src/floors/FloodStream.cc
   trunk/src/floors/FloodStream.hh
   trunk/src/floors/SimpleFloors.cc
   trunk/src/floors/SimpleFloors.hh
   trunk/src/floors/SlopeFloor.cc
   trunk/src/floors/SlopeFloor.hh
   trunk/src/floors/StandardFloors.cc
   trunk/src/floors/StandardFloors.hh
   trunk/src/floors/ThiefFloor.cc
   trunk/src/floors/ThiefFloor.hh
   trunk/src/items.cc
   trunk/src/items.hh
   trunk/src/items/BlockerItem.cc
   trunk/src/items/CompatibilityItems.cc
   trunk/src/items/PipeItem.cc
   trunk/src/items/PipeItem.hh
   trunk/src/items/StripItem.cc
   trunk/src/lua.cc
   trunk/src/player.cc
   trunk/src/player.hh
   trunk/src/stones.cc
   trunk/src/stones.hh
   trunk/src/stones/BlockerStone.cc
   trunk/src/stones/BlockerStone.hh
   trunk/src/stones/BoulderStone.cc
   trunk/src/stones/BoxStone.cc
   trunk/src/stones/BoxStone.hh
   trunk/src/stones/BrakeStone.cc
   trunk/src/stones/ChameleonStone.cc
   trunk/src/stones/ChessStone.cc
   trunk/src/stones/ClusterStone.cc
   trunk/src/stones/ClusterStone.hh
   trunk/src/stones/CompatibilityStones.cc
   trunk/src/stones/CompatibilityStones.hh
   trunk/src/stones/FakeStone.cc
   trunk/src/stones/FakeStone.hh
   trunk/src/stones/FlatStone.cc
   trunk/src/stones/LaserStone.cc
   trunk/src/stones/LaserSwitch.cc
   trunk/src/stones/MailStone.cc
   trunk/src/stones/MonoFlopStone.cc
   trunk/src/stones/OxydStone.cc
   trunk/src/stones/OxydStone.hh
   trunk/src/stones/PuzzleStone.cc
   trunk/src/stones/SimpleStones.cc
   trunk/src/stones/TimerStone.cc
   trunk/src/world.cc
   trunk/src/world.hh
Log:
Trunk 1.1: internal reengineering
- abolish get_kind(), is_kind() with their mixture of class, variation and
    model name results
- simulate old API GetKind in api1init by addition of a GetClass function
- do no longer store kind as an object attribute
- resolve kind always via object validator
- prefer usage of getClass where possible
- introduce getModelName - currently used model of an object
    - support all static floors in all variations and most other objects
    - used by st_chameleon
    - used by default init_model()
    - objects with own init_model do not yet support this method
- all floors test level: add st_chameleon vs. floor test
Note:
- this patch affects most objects in essential parts - please report any
  unexpected behaviour changes


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/data/api1init.lua	2009-09-05 23:26:05 UTC (rev 1793)
@@ -701,8 +701,12 @@
 end
 
 function enigma.GetKind(obj)
-    local _newname = enigma._GetKind(obj)
+    local _newname = enigma.GetClass(obj)
     local _oldname = RenamingObjectsNew2Old[_newname]
+    
+    if _oldname == nil then
+        _oldname = RenamingObjectsNew2Old[enigma._GetKind(obj)]
+    end
 
     if _newname == "st_key" then
         local code = enigma._GetAttrib(obj, "code")

Modified: trunk/data/levels/enigma_experimental/floors_1.xml
===================================================================
--- trunk/data/levels/enigma_experimental/floors_1.xml	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/data/levels/enigma_experimental/floors_1.xml	2009-09-05 23:26:05 UTC (rev 1793)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="All Floors as of Enigma 1.10" el:subtitle="" el:id="floors"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="experimental"/>
       <el:author  el:name="Raoul Bourquin" el:email=""/>
       <el:copyright>Copyright ? 2009 Raoul Bourquin</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -196,6 +196,12 @@
         wo[no["here"]] = floors[sender.x-5]
     end
 end
+
+wo[{0,9}] = {"st_switch", target="chameleon"}
+wo[{1,9}] = {"it_document", text="Add st_chameleon on this row"}
+function chameleon(value, sender)
+    wo:drawBorder(sender + 6*E, wo["Width"] - 12, 1, {"st_chameleon"})
+end
  ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/data/models-2d.lua	2009-09-05 23:26:05 UTC (rev 1793)
@@ -573,7 +573,7 @@
 -- it_strip --
 do
     DefSubimages("it_strip", {modelname="it_strip", w=4, h=4, startindex=0})
-    DefAlias("it_strip", "it_strip0")
+--    DefAlias("it_strip", "it_strip0")
 end
 
 ----------------------------------------
@@ -847,21 +847,21 @@
 do
     DefSubimages("st_bluesand", {modelname="st_bluesandx",w=4,h=4})
     for i=0,15 do DefSolidStone("st_bluesand"..i, "st_bluesandx"..(i+1)) end
-    DefSolidStone("st_bluesand", "st_bluesandx1")
+--    DefSolidStone("st_bluesand", "st_bluesandx1")
 end
 
 -- st_brick --
 do
     DefSubimages("st_brick", {modelname="st_brickx",w=4,h=4})
     for i=0,15 do DefSolidStone("st_brick"..i, "st_brickx"..(i+1)) end
-    DefSolidStone("st_brick", "st_brickx1")
+--    DefSolidStone("st_brick", "st_brickx1")
 end
 
 -- st_panel --
 do
     DefSubimages("st_panel", {modelname="st_panelx",w=4,h=4})
     for i=0,15 do DefSolidStone("st_panel"..i, "st_panelx"..(i+1)) end
-    DefSolidStone("st_panel", "st_panelx1")
+--    DefSolidStone("st_panel", "st_panelx1")
 end
 
 -- st_boulder --
@@ -1599,7 +1599,7 @@
 
 -- st_magic --
 do
-    DefAlias("st_magic_brick", "st_brick")
+    DefAlias("st_magic_brick", "st_brick0")
     DefAlias("st_magic_oxyda", "st_oxyda")
     DefAlias("st_magic_oxydc", "st_oxydc")
 end

Modified: trunk/src/GridObject.cc
===================================================================
--- trunk/src/GridObject.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/GridObject.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -1,6 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004,2005 Daniel Heck
- * Copyright (C) 2007 Ronald Lamprecht
+ * Copyright (C) 2007,2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -88,14 +88,6 @@
         return pos.x >= 0;
     }
     
-    display::Model *GridObject::set_anim (const std::string &mname) 
-    {
-        set_model (mname);
-        display::Model *m = get_model();
-        m->set_callback(this);
-        return m;
-    }
-    
     bool GridObject::sound_event (const char *name, double vol)
     {
         return sound::EmitSoundEvent (name, get_pos().center(), getVolume(name, this, vol));
@@ -108,7 +100,7 @@
     
         va_start(arg_ptr, format);
     
-        fprintf(stderr, "%p \"%s\" at %i/%i: ", this, get_kind(), position.x, position.y);
+        fprintf(stderr, "%p \"%s\" at %i/%i: ", this, getKind().c_str(), position.x, position.y);
         vfprintf(stderr, format, arg_ptr);
         fputc('\n', stderr);
     
@@ -155,17 +147,20 @@
     }
     
     std::string GridObject::getModelName() const {
-        return get_kind();
+        return getClass();
     }
     
     void GridObject::init_model() {
-        DirectionBits c = getConnections();
-        if (c != NODIRBIT)
-            set_model(getModelName() + ecl::strf("%d", c));
-        else
-            set_model(getModelName());
+        set_model(getModelName());
     }
 
+    void GridObject::set_anim (const std::string &mname) 
+    {
+        set_model (mname);
+        display::Model *m = get_model();
+        m->set_callback(this);
+    }
+    
     DirectionBits GridObject::getConnections() const {
         if (Value v = getAttr("$connections"))
             return DirectionBits((int)v);

Modified: trunk/src/GridObject.hh
===================================================================
--- trunk/src/GridObject.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/GridObject.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -103,7 +103,6 @@
 
         // Helper functions
         bool sound_event (const char *name, double vol = 1.0);
-        display::Model *set_anim (const std::string &mname);
 
         DirectionBits getConnections() const;
         virtual DirectionBits getFaces(bool actorInvisible = false) const;
@@ -111,11 +110,14 @@
         virtual double squareDistance(const Object *other) const;
         virtual bool isSouthOrEastOf(const Object *other) const;
 
+        virtual std::string getModelName() const;
+        virtual display::Model *get_model () = 0;
+
     protected:
         // GridObject interface
-        virtual std::string getModelName() const;
         virtual void set_model (const std::string &mname) = 0;
-        virtual display::Model *get_model () = 0;
+        void set_anim (const std::string &mname);
+
         virtual void kill_model (GridPos p) = 0;
 
         virtual void init_model();

Modified: trunk/src/Inventory.cc
===================================================================
--- trunk/src/Inventory.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/Inventory.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -192,7 +192,7 @@
 {
     size_t size_ = size();
     for (size_t i = start_idx; i<size_; ++i) {
-        if (get_item(i)->is_kind(kind))
+        if (get_item(i)->isKind(kind))
             return static_cast<int> (i);
     }
     return -1;

Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/Object.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -106,34 +106,13 @@
     
     Object::~Object() {
         freeId(id);
-    //cerr << "obj del " << id << " - " << this->get_kind() <<"\n";
+    //cerr << "obj del " << id << " - " << this->getKind() <<"\n";
     }
     
     int Object::getId() const {
         return id;
-    }
+    }    
     
-    const char * Object::get_kind() const {      // To be made pure virtual
-        AttribMap::const_iterator i = attribs.find("kind");
-        ASSERT(i != attribs.end() && i->second.getType() == Value::STRING, XLevelRuntime,
-                ecl::strf("Object: attribute kind not found - class '%s'", getClass().c_str()).c_str());
-        return i->second.get_string();
-    }
-    
-    // check kind of object
-    // kind_templ may contain wildcards ( ? and * )
-    bool Object::is_kind(const char *kind_templ) const {
-        return ecl::string_match(get_kind(), kind_templ);
-    }
-    
-    bool Object::is_kind(const string& kind_templ) const {
-        return ecl::string_match(get_kind(), kind_templ.c_str());
-    }
-    
-    std::string Object::getClass() const {
-        return get_kind();  // should be abstract, but until end of the reengineering we need compatibility
-    }
-    
     std::string Object::getKind() const {
         return ObjectValidator::instance()->getKind(this);
     }
@@ -375,7 +354,7 @@
                             // we may need to translate the new API message to old API
                             obj_action = lua::NewMessageName(lua::LevelState(), *oit, action);
 //                            if (obj_action != action)
-//                                Log << "PerformAction renamed '" << action << "' to '" << obj_action << "' for receiver '" << (*oit)->get_kind() << "'\n";
+//                                Log << "PerformAction renamed '" << action << "' to '" << obj_action << "' for receiver '" << (*oit)->getKind() << "'\n";
                         }
                         // check if message is valid, otherwise ignore message
                         if (obj_action != "nop" && (*oit)->validateMessage(obj_action, messageValue))
@@ -457,7 +436,7 @@
     
         va_start(arg_ptr, format);
     
-        fprintf(stderr, "%p non-grid-\"%s\": ", this, get_kind());
+        fprintf(stderr, "%p non-grid-\"%s\": ", this, getKind().c_str());
         vfprintf(stderr, format, arg_ptr);
         fputc('\n', stderr);
     

Modified: trunk/src/Object.hh
===================================================================
--- trunk/src/Object.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/Object.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -100,9 +100,6 @@
         
         /* ---------- depreceated methods ---------- */
 
-        bool is_kind(const char *kind) const;
-        bool is_kind(const string& kind) const;
-        virtual const char *get_kind() const;
         const AttribMap &get_attribs() const { return attribs; }  // just used by ObjectRepos::dump_info()        
 
         /* ---------- Helper routines ---------- */
@@ -121,7 +118,7 @@
          * both impleneted by the class "ClusterStone". In this case we talk about a 
          * common "familiy". 
          */
-        virtual std::string getClass() const;
+        virtual std::string getClass() const =0;
         
         /**
          * The most specific object category name. Many objects change their kind during
@@ -192,8 +189,8 @@
         Value getDefaultedAttr(const string &key, Value defaultValue) const;
         
         
-        virtual Object *clone()=0;
-        virtual void dispose()=0;
+        virtual Object *clone() =0;
+        virtual void dispose() =0;
 
         virtual void warning(const char *format, ...) const;
         virtual ObjectType getObjectType() const;

Modified: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/WorldProxy.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -42,6 +42,10 @@
     WorldProxy::WorldProxy() {
     }
 
+    std::string WorldProxy::getClass() const {
+        return "WorldProxy";
+    }
+    
     Value WorldProxy::getAttr(const std::string &key) const {
         if (key == "AllowSingleOxyds") {
             return server::AllowSingleOxyds;

Modified: trunk/src/WorldProxy.hh
===================================================================
--- trunk/src/WorldProxy.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/WorldProxy.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -27,6 +27,7 @@
     public:
         static WorldProxy *instance();
         static void shutdown();
+        virtual std::string getClass() const;
         virtual Value getAttr(const string& key) const;
         virtual void setAttr(const string& key, const Value &val);
         

Modified: trunk/src/actors/Balls.cc
===================================================================
--- trunk/src/actors/Balls.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/actors/Balls.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -245,7 +245,7 @@
     }
     
     void BasicBall::animcb() {
-        string kind=get_kind();
+        std::string kind = getModelBaseName();
     
         switch (state) {
             case SHATTERING:
@@ -294,6 +294,10 @@
         }
     }
     
+    std::string BasicBall::getModelBaseName() const {
+        return getKind();
+    }
+    
     void BasicBall::sink(double dtime) {
         double sink_speed  = 0.0;
         double raise_speed = 0.0;   // at this velocity don't sink; above: raise
@@ -313,7 +317,7 @@
             sinkDepth += sinkSpeed*dtime;
     
             if (sinkDepth >= maxSinkDepth) {
-                set_model(string(get_kind())+"-sunk");
+                set_model(getModelBaseName() + "-sunk");
                 ai->vel = V2();     // stop!
                 sound_event ("swamp");
                 change_state(BUBBLING);
@@ -341,7 +345,7 @@
         if (newstate == state)
             return;
     
-        std::string kind = get_kind();
+        std::string kind = getModelBaseName();
         iState oldstate = (iState)state;
         
         if (oldstate == JUMPING) {
@@ -438,7 +442,7 @@
         switch (state) {
             case NORMAL:
                 if (sinkDepth > minSinkDepth && sinkDepth < maxSinkDepth) {
-                    set_sink_model(get_kind());
+                    set_sink_model(getModelBaseName());
                 }
                 else {
                     ActorInfo *ai = get_actorinfo();
@@ -472,7 +476,7 @@
     void BasicBall::set_shine_model (bool shinep)
     {
         if (shinep != lastshinep) {
-            string modelname = get_kind();
+            std::string modelname = getModelBaseName();
             if (shinep)
                 set_model (modelname + "-shine");
             else
@@ -524,6 +528,7 @@
             m_halosprite.move (get_pos());
         }
     }
+    
 
 /* -------------------- Marble  -------------------- */
     Marble::Marble(int color) : BasicBall(traits[color]) {
@@ -537,10 +542,6 @@
         return "ac_marble";
     }
 
-    const char *Marble::get_kind() const {
-        return getAttr("color") == BLACK ? "ac_marble_black" : "ac_marble_white";
-    }
-
     int Marble::traitsIdx() const {
         return getAttr("color");
     }
@@ -562,10 +563,6 @@
         return "ac_pearl";
     }
 
-    const char *Pearl::get_kind() const {
-        return "ac_pearl_white";
-    }
-    
     void Pearl::sink(double dtime) {
         if (server::GameCompatibility != GAMET_ENIGMA) {
             if (m_actorinfo.field->floor->isKind("fl_swamp"))  

Modified: trunk/src/actors/Balls.hh
===================================================================
--- trunk/src/actors/Balls.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/actors/Balls.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -85,6 +85,7 @@
         virtual void animcb();
 
     protected:
+        virtual std::string getModelBaseName() const;
         virtual void sink(double dtime);
 
     private:
@@ -126,7 +127,6 @@
         
         // Object interface.
         virtual std::string getClass() const;
-        virtual const char *get_kind() const;
         
     private:
         int traitsIdx() const;
@@ -142,7 +142,6 @@
         
         // Object interface.
         virtual std::string getClass() const;
-        virtual const char *get_kind() const;
         
     protected:
         virtual void sink(double dtime);

Modified: trunk/src/actors/BugActor.cc
===================================================================
--- trunk/src/actors/BugActor.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/actors/BugActor.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -34,10 +34,6 @@
         return "ac_bug";
     }
 
-    const char *Bug::get_kind() const {
-        return "ac_bug";
-    }
-
     bool Bug::is_dead() const {
         return false;
     }

Modified: trunk/src/actors/BugActor.hh
===================================================================
--- trunk/src/actors/BugActor.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/actors/BugActor.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -37,7 +37,6 @@
         
         // Object interface.
         virtual std::string getClass() const;
-        virtual const char *get_kind() const;
 
         // Actor interface
         virtual bool is_dead() const;

Modified: trunk/src/actors/HorseActor.cc
===================================================================
--- trunk/src/actors/HorseActor.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/actors/HorseActor.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -35,10 +35,6 @@
         return "ac_horse";
     }
 
-    const char *Horse::get_kind() const {
-        return "ac_horse";
-    }
-
     bool Horse::is_dead() const {
         return false;
     }

Modified: trunk/src/actors/HorseActor.hh
===================================================================
--- trunk/src/actors/HorseActor.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/actors/HorseActor.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -37,8 +37,6 @@
         
         // Object interface.
         virtual std::string getClass() const;
-        virtual const char *get_kind() const;
-//        virtual void setAttr(const string& key, const Value &val);
 
         // Actor interface
         virtual bool is_dead() const;

Modified: trunk/src/actors/KillerActor.cc
===================================================================
--- trunk/src/actors/KillerActor.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/actors/KillerActor.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -37,10 +37,6 @@
         return "ac_killer";
     }
 
-    const char *Killer::get_kind() const {
-        return "ac_killer";
-    }
-
     bool Killer::is_dead() const {
         return false;
     }

Modified: trunk/src/actors/KillerActor.hh
===================================================================
--- trunk/src/actors/KillerActor.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/actors/KillerActor.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -36,8 +36,6 @@
         
         // Object interface.
         virtual std::string getClass() const;
-        virtual const char *get_kind() const;
-//        virtual void setAttr(const string& key, const Value &val);
 
         // Actor interface
         virtual bool is_dead() const;

Modified: trunk/src/actors/Rotors.cc
===================================================================
--- trunk/src/actors/Rotors.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/actors/Rotors.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -108,10 +108,6 @@
         return "ac_rotor";
     }
 
-    const char *Rotor::get_kind() const {
-        return "ac_rotor";
-    }
-
     bool Rotor::on_collision (Actor *a) {
         if (a->is_on_floor())
             SendMessage(a, "_shatter");
@@ -128,10 +124,6 @@
         return "ac_top";
     }
 
-    const char *Top::get_kind() const {
-        return "ac_top";
-    }
-
     bool Top::on_collision (Actor *a) {
         // tops shatter and collide independent on flying status of oponent 
         SendMessage(a, "_shatter");

Modified: trunk/src/actors/Rotors.hh
===================================================================
--- trunk/src/actors/Rotors.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/actors/Rotors.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -61,7 +61,6 @@
         
         // Object interface.
         virtual std::string getClass() const;
-        virtual const char *get_kind() const;
 
         // Actor interface
         virtual bool on_collision(Actor *a);
@@ -77,7 +76,6 @@
         
         // Object interface.
         virtual std::string getClass() const;
-        virtual const char *get_kind() const;
 
         // Actor interface
         virtual bool on_collision(Actor *a);

Modified: trunk/src/actors.cc
===================================================================
--- trunk/src/actors.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/actors.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -229,7 +229,7 @@
     if (Value vy = getAttr("velocity_y")) {
         m_actorinfo.vel = V2(m_actorinfo.vel[0], vy);
     }
-    set_model(get_kind());
+    set_model(getKind());
     m_sprite.move(p);
     move();
 }

Modified: trunk/src/display.hh
===================================================================
--- trunk/src/display.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/display.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -39,7 +39,6 @@
     public:
         virtual ~ModelCallback() {}
         virtual void animcb() = 0;
-        virtual bool isDisplayable() {return true;}
     };
 
     class Animation {

Modified: trunk/src/floors/BridgeFloor.cc
===================================================================
--- trunk/src/floors/BridgeFloor.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors/BridgeFloor.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -95,8 +95,8 @@
             setState(0);
     }
 
-    void BridgeFloor::init_model()  {
-        set_model(model_basename() + ((state==OPEN) ? "open" : "closed"));
+    std::string BridgeFloor::getModelName() const {
+        return model_basename() + ((state==OPEN) ? "open" : "closed");
     }
     
     void BridgeFloor::on_creation(GridPos p) {

Modified: trunk/src/floors/BridgeFloor.hh
===================================================================
--- trunk/src/floors/BridgeFloor.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors/BridgeFloor.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -54,7 +54,7 @@
         virtual void toggleState();
 
         // GridObject interface
-        virtual void init_model();
+        virtual std::string getModelName() const;
         virtual void on_creation(GridPos p);
                 
         // ModelCallback interface  - Animation callback

Modified: trunk/src/floors/FloodStream.cc
===================================================================
--- trunk/src/floors/FloodStream.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors/FloodStream.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -45,24 +45,6 @@
         }   
     }
 
-    // temporary hack for backward compatibility during reengineering
-    const char * FloodStream::get_kind() const {
-        if (getAttr("faces").to_string() == "nesw")
-            switch (getTyp()) { 
-                case WATER : return "fl_water_framed";
-                case WOOD :  return "fl_wood_framed";
-                case HAY :   return "fl_hay_framed";
-                case ROCK :  return "fl_rock_framed";
-            }
-        else
-            switch (getTyp()) { 
-                case WATER : return "fl_water";
-                case WOOD :  return "fl_wood";
-                case HAY :   return "fl_hay";
-                case ROCK :  return "fl_rock";
-            }   
-    }
-        
     Value FloodStream::message(const Message &m) {
         if (m.message == "_checkflood") {
             Item *it = GetItem(get_pos());
@@ -86,14 +68,15 @@
             state = extState;
     }
     
-    void FloodStream::init_model()  {
-        bool isFramed = (getAttr("faces").to_string() == "nesw");
+    std::string FloodStream::getModelName() const {
+        std::string modelbase = getClass();
+        if (getAttr("faces").to_string() == "nesw")
+             modelbase += "_framed";
         if (getTyp() == WOOD) {
             int modelnr = (objFlags & OBJBIT_MODEL) >> 26;
-            set_model((std::string)get_kind() + ((modelnr == 0 )? "" : ecl::strf("%d", modelnr))); 
-        } else {
-            set_model(get_kind());
-        } 
+            modelbase += (modelnr == 0 ) ? "" : ecl::strf("%d", modelnr); 
+        }
+        return modelbase;
     }
     
     void FloodStream::on_creation(GridPos p) {

Modified: trunk/src/floors/FloodStream.hh
===================================================================
--- trunk/src/floors/FloodStream.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors/FloodStream.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -53,14 +53,13 @@
 
         // Object interface
         virtual std::string getClass() const;
-        virtual const char *get_kind() const;
         virtual Value message(const Message &m);
         
         // StateObject interface
         virtual void setState(int extState);
 
         // GridObject interface
-        virtual void init_model();
+        virtual std::string getModelName() const;
         virtual void on_creation(GridPos p);
                 
         // Floor interface

Modified: trunk/src/floors/SimpleFloors.cc
===================================================================
--- trunk/src/floors/SimpleFloors.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors/SimpleFloors.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -69,10 +69,10 @@
         return "fl_fake";
     }
     
-    void FakeFloor::init_model()  {
-        set_model("fl_fake_" + getAttr("flavor").to_string());
+    std::string FakeFloor::getModelName() const {
+        return "fl_fake_" + getAttr("flavor").to_string();
     }
-
+    
 /* -------------------- Ice -------------------- */
 
     IceFloor::IceFloor() : Floor ("fl_ice") {
@@ -92,8 +92,8 @@
         return "fl_inverse";
     }
     
-    void InverseFloor::init_model()  {
-        set_model("fl_inverse_" + getAttr("flavor").to_string());
+    std::string InverseFloor::getModelName() const {
+        return "fl_inverse_" + getAttr("flavor").to_string();
     }
 
 /* -------------------- Space -------------------- */
@@ -144,13 +144,6 @@
         return "fl_yinyang";
     }
     
-    const char *YinyangFloor::get_kind() const {   //just for st_chameleon support
-        if (state == YIN)
-           return (objFlags & OBJBIT_INVISIBLE) ? "fl_yinyang_yin_invisible" : "fl_yinyang_yin";
-        else
-           return (objFlags & OBJBIT_INVISIBLE) ? "fl_yinyang_yang_invisible" : "fl_yinyang_yang";
-    }
-    
     void YinyangFloor::setAttr(const std::string &key, const Value &val) {
         if (key == "invisible") {
             objFlags = (objFlags & ~OBJBIT_INVISIBLE) | (val.to_bool() ? OBJBIT_INVISIBLE : 0);
@@ -168,9 +161,9 @@
         return Floor::getAttr(key);
     }
         
-    void YinyangFloor::init_model()  {
-        set_model(ecl::strf("fl_yinyang_%s%s", (state == YIN) ? "yin" : "yang", 
-                objFlags & OBJBIT_INVISIBLE ? "_invisible" : ""));
+    std::string YinyangFloor::getModelName() const {
+        return ecl::strf("fl_yinyang_%s%s", (state == YIN) ? "yin" : "yang", 
+                objFlags & OBJBIT_INVISIBLE ? "_invisible" : "");
     }
     
     ecl::V2 YinyangFloor::process_mouseforce (Actor *a, ecl::V2 force) {

Modified: trunk/src/floors/SimpleFloors.hh
===================================================================
--- trunk/src/floors/SimpleFloors.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors/SimpleFloors.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -70,7 +70,7 @@
         virtual std::string getClass() const;
         
         // GridObject interface
-        virtual void init_model();
+        virtual std::string getModelName() const;
     };
 
     /** 
@@ -99,7 +99,7 @@
         virtual std::string getClass() const;
         
         // GridObject interface
-        virtual void init_model();
+        virtual std::string getModelName() const;
     };
 
     /** 
@@ -161,12 +161,11 @@
 
         // Object interface
         virtual std::string getClass() const;
-        virtual const char *get_kind() const;
         virtual void setAttr(const std::string &key, const Value &val);
         virtual Value getAttr(const std::string &key) const;
         
         // GridObject interface
-        virtual void init_model();
+        virtual std::string getModelName() const;
                 
         // Floor interface
         virtual ecl::V2 process_mouseforce (Actor *a, ecl::V2 force);

Modified: trunk/src/floors/SlopeFloor.cc
===================================================================
--- trunk/src/floors/SlopeFloor.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors/SlopeFloor.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -77,12 +77,12 @@
         // ignore any state change attempts
     }
     
-    void SlopeFloor::init_model()  {
+    std::string SlopeFloor::getModelName() const {
         std::string shape = getAttr("shape").to_string();
         if (shape == "")
-            set_model("fl_slope");
+            return "fl_slope";
         else
-            set_model(std::string("fl_slope_") + shape);
+            return std::string("fl_slope_") + shape;
     }
     
     void SlopeFloor::add_force(Actor *a, ecl::V2 &f) {

Modified: trunk/src/floors/SlopeFloor.hh
===================================================================
--- trunk/src/floors/SlopeFloor.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors/SlopeFloor.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -46,7 +46,7 @@
         virtual void setState(int extState);
 
         // GridObject interface
-        virtual void init_model();
+        virtual std::string getModelName() const;
                 
         // Floor interface
         virtual void add_force(Actor *, ecl::V2 &);

Modified: trunk/src/floors/StandardFloors.cc
===================================================================
--- trunk/src/floors/StandardFloors.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors/StandardFloors.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -113,10 +113,10 @@
         // no external states
     }
     
-    void StandardFloor::init_model()  {
+    std::string StandardFloor::getModelName() const {
         bool isFramed = (getAttr("faces").to_string() == "nesw");
-        set_model((StandardFloorNames[state].submodel.length() > 0 ? StandardFloorNames[state].submodel :
-                StandardFloorNames[state].classname) +  (isFramed ? "_framed" : ""));
+        return ((StandardFloorNames[state].submodel.length() > 0) ? StandardFloorNames[state].submodel :
+                StandardFloorNames[state].classname) +  (isFramed ? "_framed" : "");
     }
     
     BOOT_REGISTER_START

Modified: trunk/src/floors/StandardFloors.hh
===================================================================
--- trunk/src/floors/StandardFloors.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors/StandardFloors.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -37,7 +37,7 @@
         virtual void setState(int extState);
 
         // GridObject interface
-        virtual void init_model();
+        virtual std::string getModelName() const;
     };
 } // namespace enigma
 

Modified: trunk/src/floors/ThiefFloor.cc
===================================================================
--- trunk/src/floors/ThiefFloor.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors/ThiefFloor.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -69,8 +69,12 @@
         Floor::on_creation(p);
     }
     
+    std::string ThiefFloor::getModelName() const {
+        return ecl::strf("fl_thief%d", ((objFlags & OBJBIT_MODEL) >> 24) + 1);
+    }
+    
     void ThiefFloor::init_model() {
-        std::string basename = ecl::strf("fl_thief%d", ((objFlags & OBJBIT_MODEL) >> 24) + 1);
+        std::string basename = getModelName();
         switch (state) {
             case IDLE:
             case CAPTURED:

Modified: trunk/src/floors/ThiefFloor.hh
===================================================================
--- trunk/src/floors/ThiefFloor.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors/ThiefFloor.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -58,6 +58,7 @@
         virtual void setState(int extState);
 
         // GridObject interface
+        virtual std::string getModelName() const;
         virtual void init_model();
         virtual void on_creation(GridPos p);
         virtual void actor_enter(Actor *a);

Modified: trunk/src/floors.cc
===================================================================
--- trunk/src/floors.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -49,18 +49,6 @@
   fire_countdown(1)
 {}
 
-const char * Floor::get_kind() const {
-    return traits.name.c_str();
-}
-
-Floor *Floor::clone() {
-    return new Floor(*this);
-}
-
-void Floor::dispose() {
-    delete this;
-}
-
 Value Floor::message(const Message &m) {
     // "_init"     : Start burning, if "initfire" is set.
     // "heat"     : Heat the item, heat-transform floor
@@ -314,8 +302,8 @@
             // non-Enigma-compatibility-mode it should, when its neighbor
             // is of the same kind and burns also.
             if (Floor *fl = GetFloor(move(p, sourcedir))) {
-                string sourcekind = fl->get_kind();
-                string mykind = this->get_kind();
+                string sourcekind = fl->getClass();
+                string mykind = this->getClass();
                 if (no_closing_stone && sourcekind == mykind)
                     if (has_firetype(flft_fastfire))
                         return force_fire();
@@ -378,7 +366,7 @@
     if (!doHeatTransform || get_heattransform(false) == "")
         return false;
     if (doHeatTransform && get_heattransform(false) != "" && !heating_animation) {
-        set_anim(((string) this->get_kind()) + "_heating");
+        set_anim(getClass() + "_heating");
         heating_animation = true;
     }
     return true;

Modified: trunk/src/floors.hh
===================================================================
--- trunk/src/floors.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/floors.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -88,9 +88,6 @@
                const char *firetransform_ = "", const char *heattransform_ = "");
 
         // Object interface
-        virtual const char *get_kind() const;
-        Floor *clone();
-        void dispose();
         virtual Value message(const Message &m);
         virtual void setAttr(const string& key, const Value &val);
         virtual Value getAttr(const std::string &key) const;

Modified: trunk/src/items/BlockerItem.cc
===================================================================
--- trunk/src/items/BlockerItem.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/items/BlockerItem.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -46,7 +46,7 @@
     Value BlockerItem::message(const Message &m) {
         if (m.message == "_init") { 
             if (Stone *st = GetStone(get_pos())) {
-                if (st->is_kind("st_boulder"))
+                if (st->getClass() == "st_boulder")
                     if (state == IDLE && server::GameCompatibility != GAMET_PEROXYD)
                         setIState(UNLOCKED);
                     else if (state == NEW || server::GameCompatibility != GAMET_PEROXYD)
@@ -121,7 +121,7 @@
     
     void BlockerItem::stone_change(Stone *st) {
         if (st != NULL) {
-            if (st->is_kind("st_boulder")) { // boulder arrived
+            if (st->getClass() == "st_boulder") { // boulder arrived
                 switch (state) {
                     case IDLE:
                         setIState(UNLOCKED);  // will grow when boulder moves away

Modified: trunk/src/items/CompatibilityItems.cc
===================================================================
--- trunk/src/items/CompatibilityItems.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/items/CompatibilityItems.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -68,11 +68,11 @@
             // before stones are created.
             if (server::GetDifficulty() == DIFFICULTY_EASY) {
                 if (Stone *st = GetStone (get_pos())) {
-                    if (st->is_kind ("st_death") ||
-                        st->is_kind ("st_flash") ||
-                        st->is_kind ("st_thief"))
+                    if (st->getClass() == "st_death" ||
+                        st->getClass() == "st_flash" ||
+                        st->getClass() == "st_thief")
                     {
-                        SetStone (get_pos(), MakeStone ("st_flat"));
+                        SetStone (get_pos(), MakeStone("st_flat"));
                     }
                     else
                         KillStone(get_pos());

Modified: trunk/src/items/PipeItem.cc
===================================================================
--- trunk/src/items/PipeItem.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/items/PipeItem.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -74,11 +74,7 @@
     std::string PipeItem::getClass() const {
         return "it_pipe";
     }
-    
-    std::string PipeItem::getModelName() const {
-        return "it_pipe_";
-    }
-    
+        
     int PipeItem::traitsIdx() const {
         static int idx[] = { 0, 0, 1, 2, 3, 4, 5, 0, 6, 7, 8, 0, 9, 0, 0, 0};
         return idx[getConnections()];

Modified: trunk/src/items/PipeItem.hh
===================================================================
--- trunk/src/items/PipeItem.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/items/PipeItem.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -35,9 +35,6 @@
 
         // Object interface
         virtual std::string getClass() const;
-
-        // Gridobject interface
-        virtual std::string getModelName() const;
         
         // Item interface
         

Modified: trunk/src/items/StripItem.cc
===================================================================
--- trunk/src/items/StripItem.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/items/StripItem.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -37,7 +37,7 @@
     }
     
     std::string StripItem::getModelName() const {
-        return getClass();
+        return getClass() +  ecl::strf("%d", getConnections());
     }
     
     void StripItem::init_model() {

Modified: trunk/src/items.cc
===================================================================
--- trunk/src/items.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/items.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -66,8 +66,7 @@
     SetItem(get_pos(), newitem);
 }
 
-const char *Item::get_kind() const
-{
+std::string Item::getClass() const {
     return get_traits().name;
 }
 
@@ -82,9 +81,9 @@
         return GridObject::getAttr(key);
     }
 
-string Item::get_inventory_model()
+std::string Item::get_inventory_model()
 {
-    return get_kind();
+    return getKind();
 }
 
 void Item::init_model()

Modified: trunk/src/items.hh
===================================================================
--- trunk/src/items.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/items.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -198,7 +198,7 @@
         void replace(std::string kind);
 
         /* ---------- Virtual functions ---------- */
-        const char *get_kind() const;
+        virtual std::string getClass() const;
         virtual Value getAttr(const std::string &key) const;
 
         void init_model();

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/lua.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -574,6 +574,28 @@
 }
 
 static int
+en_get_class(lua_State *L)
+{
+    Object *obj = to_object(L,1);
+
+    if (!obj) {
+        throwLuaError(L, "GetClass: invalid object");
+        return 0;
+    }
+
+    try {
+        push_value(L, Value(obj->getClass()));
+    }  
+    catch (const XLevelRuntime &e) {
+        throwLuaError (L, e.what());
+    }
+    catch (...) {
+        throwLuaError (L, "uncaught exception");
+    }
+    return 1;
+}
+
+static int
 en_get_kind(lua_State *L)
 {
     Object *obj = to_object(L,1);
@@ -584,7 +606,7 @@
     }
 
     try {
-        push_value(L, Value(obj->get_kind()));
+        push_value(L, Value(obj->getKind()));
     }  
     catch (const XLevelRuntime &e) {
         throwLuaError (L, e.what());
@@ -3406,6 +3428,7 @@
 
     {en_get_pos,            "GetPos"},
     {en_get_attrib,         "GetAttrib"},
+    {en_get_class,          "GetClass"},
     {en_get_kind,           "GetKind"},
     {en_is_same_object,     "IsSameObject"},
 

Modified: trunk/src/player.cc
===================================================================
--- trunk/src/player.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/player.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -261,7 +261,7 @@
 {
     if (Inventory *inv = GetInventory(a))
         if (Item *it = inv->get_item(0))
-            return it->is_kind(kind);
+            return it->isKind(kind);
     return false;
 }
 
@@ -581,23 +581,19 @@
     }
 }
 
-void player::PickupStoneAsItem (Actor *a, enigma::GridPos p) 
-{
-    if (Inventory *inv = MayPickup(a, GetField(p)->item, true)) {
-        if (Stone *stone = GetStone(p))  {
-            string kind = stone->get_kind();
-            if (kind[0] == 's') 
-                kind[0] = 'i';
-
-            if (Item *item = MakeItem(kind.c_str())) {
-                inv->add_item(item);
-                stone->transferIdentity(item);
-                KillStone(p);
-                player::RedrawInventory(inv);
-                sound::EmitSoundEvent ("pickup", p.center());
-            }
+bool player::PickupAsItem(Actor *a, GridObject *obj, std::string kind) {
+    if (Item *item = MakeItem(kind.c_str())) {
+        if (Inventory *inv = MayPickup(a, item, true)) {
+            inv->add_item(item);
+            obj->transferIdentity(item);
+            player::RedrawInventory(inv);
+            sound::EmitSoundEvent("pickup", a->get_pos());
+            return true;
+        } else {
+            DisposeObject(item);
         }
     }
+    return false;
 }
 
 void player::ActivateFirstItem() 

Modified: trunk/src/player.hh
===================================================================
--- trunk/src/player.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/player.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -89,7 +89,7 @@
 
         void InhibitPickup (bool yesno);
         void PickupItem (Actor *a, enigma::GridPos p);
-        void PickupStoneAsItem (Actor *a, enigma::GridPos p);
+        bool PickupAsItem(Actor *a, GridObject *obj, std::string kind);
         void RotateInventory (int dir=1);
 
         void ActivateFirstItem();

Modified: trunk/src/stones/BlockerStone.cc
===================================================================
--- trunk/src/stones/BlockerStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/BlockerStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -1,6 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -25,10 +25,14 @@
 
 namespace enigma {
     
-    BlockerStone::BlockerStone(bool solid) : Stone (solid ? "st_blocker" : "st_blocker_new") {
+    BlockerStone::BlockerStone(bool solid) {
         state = solid ? SOLID : GROWING; 
     }
 
+    std::string BlockerStone::getClass() const {
+        return "st_blocker";
+    }
+    
     BlockerStone * BlockerStone::clone() {
         BlockerStone * dup = new BlockerStone(*this);
         NameObject(dup, "$BlockerStone#");  // auto name object to avoid problems with object values

Modified: trunk/src/stones/BlockerStone.hh
===================================================================
--- trunk/src/stones/BlockerStone.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/BlockerStone.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -48,6 +48,7 @@
         BlockerStone(bool solid);
         
         // Object interface
+        virtual std::string getClass() const;
         virtual BlockerStone *clone();
         virtual void dispose();
         virtual Value message(const Message &m);

Modified: trunk/src/stones/BoulderStone.cc
===================================================================
--- trunk/src/stones/BoulderStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/BoulderStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -139,7 +139,7 @@
 
     void BoulderStone::on_floor_change() {
         Floor *fl = GetFloor(get_pos());
-        if (fl->is_kind("fl_abyss")) {
+        if (fl->getClass() == "fl_abyss") {
             state = FALLING;
             init_model();
         }
@@ -160,7 +160,7 @@
         if (state == FALLING)
             return;
 
-        if (impulse.sender && impulse.sender->is_kind("st_rotator")) {
+        if (impulse.sender && impulse.sender->getClass() == "st_rotator") {
             setDir(impulse.dir);  // activate
         }
         move_stone(impulse.dir);  // due to rotator and impulsestone

Modified: trunk/src/stones/BoxStone.cc
===================================================================
--- trunk/src/stones/BoxStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/BoxStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -49,22 +49,6 @@
         return "st_box";
     }
     
-    const char *BoxStone::get_kind() const {
-        BoxStoneTyp typ = (BoxStoneTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
-        switch (typ) {
-            case WOOD:
-                return "st_box_wood";
-            case WOOD1:
-                return "st_box_wood_h";
-            case WOOD2:
-                return "st_box_wood_v";
-            case HAY:
-                return "st_box_hay";
-            case ROCK:
-                return "st_box_rock";
-        }
-    }
-
     Value BoxStone::getAttr(const std::string &key) const {
         if (key == "flavor") {
             BoxStoneTyp typ = (BoxStoneTyp)((objFlags & OBJBIT_SUBTYP) >> 25);
@@ -173,7 +157,7 @@
         if (server::GameCompatibility != GAMET_ENIGMA && IsLevelBorder(p))
             return;
         if (Floor *oldfl = GetFloor(p)) {
-            const std::string &k = oldfl->get_kind();
+            std::string k = oldfl->getClass();
             if (objFlags & OBJBIT_BLOCKFIRE)
                 SendMessage(oldfl, "stopfire");
             if (k == "fl_abyss" || k == "fl_water" || k == "fl_swamp") {

Modified: trunk/src/stones/BoxStone.hh
===================================================================
--- trunk/src/stones/BoxStone.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/BoxStone.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -58,7 +58,6 @@
         virtual BoxStone* clone();
         virtual void dispose();
         virtual std::string getClass() const;
-        virtual const char *get_kind() const;  // for backward compatibility
         virtual Value getAttr(const std::string &key) const;
         virtual Value message(const Message &m);
         

Modified: trunk/src/stones/BrakeStone.cc
===================================================================
--- trunk/src/stones/BrakeStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/BrakeStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -47,7 +47,7 @@
         Stone::on_creation(p);
 
         Item    *it = GetItem(p);
-        if (it && it->is_kind("it_blocker")) {
+        if (it && it->getClass() == "it_blocker") {
             KillItem(p);
         }
     }
@@ -70,7 +70,8 @@
         double dist = ecl::length(a->get_pos() - p.center());
 
         if (dist < BRAKE_RADIUS) {
-            player::PickupStoneAsItem(a, p);
+            if (player::PickupAsItem(a, this, "it_brake"))
+                KillStone(p);
         }
     }
     

Modified: trunk/src/stones/ChameleonStone.cc
===================================================================
--- trunk/src/stones/ChameleonStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/ChameleonStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -41,7 +41,7 @@
     
     void ChameleonStone::init_model()  {
         if (Floor *fl = GetFloor(get_pos())) {
-            set_model(fl->get_kind());
+            set_model(fl->getModelName());
         } else
             ASSERT(false, XLevelRuntime, "Chameleon Stone: Floor must be set before stone");
     }

Modified: trunk/src/stones/ChessStone.cc
===================================================================
--- trunk/src/stones/ChessStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/ChessStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -151,9 +151,9 @@
     void ChessStone::on_floor_change() {
         Floor *fl = GetFloor(get_pos());
         if (fl != NULL) {
-            if (fl->is_kind("fl_abyss"))
+            if (fl->getClass() == "fl_abyss")
                 try_state(FALLING);
-            if (fl->is_kind("fl_swamp"))
+            if (fl->getClass() =="fl_swamp")
                 try_state(SINKING);
         }
     }

Modified: trunk/src/stones/ClusterStone.cc
===================================================================
--- trunk/src/stones/ClusterStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/ClusterStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -30,10 +30,6 @@
         return getAttr("$class").to_string();
     }
     
-    const char *ClusterStone::get_kind() const {
-        return getClass().c_str();
-    }
-    
     void ClusterStone::setAttr(const string& key, const Value &val) {
         if (key == "connections" || key == "faces" || key == "cluster") {
             Stone::setAttr(key, val);
@@ -64,7 +60,7 @@
     }
     
     std::string ClusterStone::getModelName() const {
-        return getClass();
+        return getClass() +  ecl::strf("%d", getConnections());
     }
 
     bool ClusterStone::is_removable() const {

Modified: trunk/src/stones/ClusterStone.hh
===================================================================
--- trunk/src/stones/ClusterStone.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/ClusterStone.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -35,7 +35,6 @@
         
         // Object interface
         virtual std::string getClass() const;
-        virtual const char *get_kind() const;  // for backward compatibility
         virtual void setAttr(const string& key, const Value &val);
         virtual Value message(const Message &m);
         

Modified: trunk/src/stones/CompatibilityStones.cc
===================================================================
--- trunk/src/stones/CompatibilityStones.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/CompatibilityStones.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -45,9 +45,13 @@
 
 /* -------------------- DummyStone -------------------- */
 
-    DummyStone::DummyStone() : Stone("st_dummy"){
+    DummyStone::DummyStone() {
     }
     
+    std::string DummyStone::getClass() const {
+        return "st_dummy";
+    }
+    
     StoneResponse DummyStone::collision_response(const StoneContact &/*sc*/) {
         static int lastCode = -1;
         int        code     = getAttr("code");

Modified: trunk/src/stones/CompatibilityStones.hh
===================================================================
--- trunk/src/stones/CompatibilityStones.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/CompatibilityStones.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -43,6 +43,9 @@
     public:
         DummyStone();
     
+        // Object interface
+        virtual std::string getClass() const;
+
         // Stone interface
         virtual StoneResponse collision_response(const StoneContact &sc);
     };

Modified: trunk/src/stones/FakeStone.cc
===================================================================
--- trunk/src/stones/FakeStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/FakeStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -32,16 +32,6 @@
         return "st_fake";
     }
     
-    const char *FakeStone::get_kind() const {
-        std::string fl = getAttr("flavor").to_string();
-        if (fl == "quake") return "st_fake_quake";
-        else if (fl == "oxyda") return "st_fake_oxyda";
-        else if (fl == "oxydb") return "st_fake_oxydb";
-        else if (fl == "oxydc") return "st_fake_oxydc";
-        else if (fl == "oxydd") return "st_fake_oxydd";
-        else if (fl == "oxyde") return "st_fake_oxyde";
-    }
-    
     void FakeStone::setAttr(const string& key, const Value &val) {
         if (key == "flavor") {
             std::string fl = val.to_string();

Modified: trunk/src/stones/FakeStone.hh
===================================================================
--- trunk/src/stones/FakeStone.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/FakeStone.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -54,7 +54,6 @@
         
         // Object interface
         virtual std::string getClass() const;
-        virtual const char *get_kind() const;
         virtual void setAttr(const string& key, const Value &val);
         virtual Value getAttr(const std::string &key) const;
         

Modified: trunk/src/stones/FlatStone.cc
===================================================================
--- trunk/src/stones/FlatStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/FlatStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -137,7 +137,7 @@
                     state == FALLING;
                     init_model();
                 }
-                else if ((objFlags & OBJBIT_MOVABLE) && ((fl->is_kind("fl_swamp") || fl->is_kind("fl_water")))) {
+                else if ((objFlags & OBJBIT_MOVABLE) && (fl->getClass() == "fl_swamp" || fl->getClass() =="fl_water")) {
                     sound_event("drown");
                     client::Msg_Sparkle(p.center());
                     KillStone(p);

Modified: trunk/src/stones/LaserStone.cc
===================================================================
--- trunk/src/stones/LaserStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/LaserStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -34,7 +34,7 @@
         }
     }
 
-    LaserStone::LaserStone(Direction dir) : Stone("st_laser") {
+    LaserStone::LaserStone(Direction dir) {
         setAttr("orientation", Value(dir));
     }
     

Modified: trunk/src/stones/LaserSwitch.cc
===================================================================
--- trunk/src/stones/LaserSwitch.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/LaserSwitch.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -25,7 +25,7 @@
 
 namespace enigma {
 
-    LaserSwitch::LaserSwitch() : Stone("st_laserswitch") {
+    LaserSwitch::LaserSwitch() {
         state = NEW;
     }
 

Modified: trunk/src/stones/MailStone.cc
===================================================================
--- trunk/src/stones/MailStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/MailStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -26,7 +26,7 @@
 //#include "main.hh"
 
 namespace enigma {
-    MailStone::MailStone(Direction dir) : Stone("st_mail") {
+    MailStone::MailStone(Direction dir) {
         setAttr("orientation", Value(dir));
     }
     

Modified: trunk/src/stones/MonoFlopStone.cc
===================================================================
--- trunk/src/stones/MonoFlopStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/MonoFlopStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -26,7 +26,7 @@
 
 namespace enigma {
     
-    MonoFlopStone::MonoFlopStone(bool lightsensitive, bool isOn) : Stone("st_monoflop") {
+    MonoFlopStone::MonoFlopStone(bool lightsensitive, bool isOn) {
         if (lightsensitive)
             objFlags |= OBJBIT_LASER;
         state = isOn ? ON_PENDING : OFF_NEW;

Modified: trunk/src/stones/OxydStone.cc
===================================================================
--- trunk/src/stones/OxydStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/OxydStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -840,11 +840,15 @@
     
     // Instance Methods
     
-    OxydStone::OxydStone(std::string flavor) : Stone("st_oxyd") {
+    OxydStone::OxydStone(std::string flavor) {
         setAttr("flavor", flavor);
         setAttr("oxydcolor", AUTO);
     }
     
+    std::string OxydStone::getClass() const {
+        return "st_oxyd";
+    }
+
     OxydStone * OxydStone::clone() { 
         OxydStone *o = new OxydStone(*this); 
         levelOxyds.push_back(o);

Modified: trunk/src/stones/OxydStone.hh
===================================================================
--- trunk/src/stones/OxydStone.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/OxydStone.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -81,6 +81,7 @@
         OxydStone(std::string flavor = "b");
         
         // Object interface
+        virtual std::string getClass() const;
         virtual OxydStone * clone();
         virtual void dispose();
         virtual Value message(const Message &m);

Modified: trunk/src/stones/PuzzleStone.cc
===================================================================
--- trunk/src/stones/PuzzleStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/PuzzleStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -433,7 +433,7 @@
 
         for (PuzzleList::iterator itr = cluster.begin(); itr != cluster.end(); ++itr) {
             if (Floor *fl = GetFloor(move((*itr)->get_pos(), dir))) {
-                if (!((fl->is_kind("fl_abyss") && isComplete) || (fl->is_kind("fl_water") && (isComplete || waterSink)))) {
+                if (!((fl->getClass() == "fl_abyss" && isComplete) || (fl->getClass() == "fl_water" && (isComplete || waterSink)))) {
                     createBridge = false;
                     break;
                 }

Modified: trunk/src/stones/SimpleStones.cc
===================================================================
--- trunk/src/stones/SimpleStones.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/SimpleStones.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -228,7 +228,7 @@
     
     void PlopStone::on_floor_change() {
         if (Floor *fl = GetFloor(get_pos())) {
-            const std::string &k = fl->get_kind();
+            std::string k = fl->getClass();
             if (k=="fl_water" || k=="fl_abyss" || k == "fl_swamp") {
                 sound_event("drown");
                 client::Msg_Sparkle(get_pos().center());

Modified: trunk/src/stones/TimerStone.cc
===================================================================
--- trunk/src/stones/TimerStone.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones/TimerStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -26,7 +26,7 @@
 
 namespace enigma {
     
-    TimerStone::TimerStone() : Stone("st_timer") {
+    TimerStone::TimerStone() {
         state = ON;
     }
     

Modified: trunk/src/stones.cc
===================================================================
--- trunk/src/stones.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -100,13 +100,10 @@
     return default_traits;
 }
 
-const char *Stone::get_kind() const
-{
+std::string Stone::getClass() const {
     const StoneTraits &tr = get_traits();
-    if (tr.id != st_INVALID)
-        return tr.name;
-    else
-        return Object::get_kind();
+    ASSERT(tr.id != st_INVALID, XLevelRuntime, "Stone with invalid traits based class name");
+    return tr.name;
 }
 
 StoneResponse Stone::collision_response(const StoneContact &) {

Modified: trunk/src/stones.hh
===================================================================
--- trunk/src/stones.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/stones.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -172,7 +172,7 @@
 
         /* ---------- Virtual functions ---------- */
         virtual Stone *clone() = 0;
-        const char *get_kind() const;
+        virtual std::string getClass() const;
 
         /* ---------- Stone interface (properties) ---------- */
 

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/world.cc	2009-09-05 23:26:05 UTC (rev 1793)
@@ -1838,7 +1838,7 @@
     if (dst == NULL && dstloc.layer == GRID_ITEMS) {
         GridLoc altloc(GRID_STONES, dstloc.pos);
         dst = GetObject(altloc);
-        if (dst && !(dst->is_kind("st_blocker")))
+        if (dst && !(dst->isKind("st_blocker")))
             // just use blocker stone instead of blocker item as substitution
             dst = NULL;
     }
@@ -1850,26 +1850,26 @@
         return; // ignore signal
     }
 //    Log << ecl::strf("AddSignal: Valid signal destination src=%i/%i-%d (%s) dest=%i/%i-%d (%s) msg='%s'\n",
-//        srcloc.pos.x, srcloc.pos.y, srcloc.layer, src->get_kind(), dstloc.pos.x, dstloc.pos.y, dstloc.layer, dst->get_kind(), msg.c_str());
+//        srcloc.pos.x, srcloc.pos.y, srcloc.layer, src->getKind(), dstloc.pos.x, dstloc.pos.y, dstloc.layer, dst->getKind(), msg.c_str());
     
     Value dstValue(dst);
     
-    if (dst->is_kind("st_blocker") || dst->is_kind("st_blocker_new") ||
-            dst->is_kind("it_blocker")) {
+    if (dst->isKind("st_blocker") || dst->isKind("st_blocker_new") ||
+            dst->isKind("it_blocker")) {
         if (!dst->getAttr("name")) {
             NameObject(dst, ecl::strf("$!oxyd!blocker%d", dst->getId()));
         }
         dstValue = dst->getAttr("name");
     }
     
-    if (dst->is_kind("it_meditation_hill") || dst->is_kind("it_meditaion_bump") ||
-            dst->is_kind("it_meditation_hollow") || dst->is_kind("it_meditation_dent")) {
+    if (dst->isKind("it_meditation_hill") || dst->isKind("it_meditaion_bump") ||
+            dst->isKind("it_meditation_hollow") || dst->isKind("it_meditation_dent")) {
         if (!dst->getAttr("name"))
             NameObject(dst, ecl::strf("$!oxyd!hillhollow%d", dst->getId()));
         dstValue = dst->getAttr("name");
     }
     
-    if (src->is_kind("st_actorimpulse")) {
+    if (src->isKind("st_actorimpulse")) {
         ObjectList ol = src->getDefaultedAttr("$!oxyd!destinations", Value(Value::GROUP));
         ol.push_back(dstValue);
         src->setAttr("$!oxyd!destinations", ol);
@@ -1895,7 +1895,7 @@
     // activate which key hole
     if (src->getObjectType() == Object::ITEM) {
         ItemID src_id = get_id(dynamic_cast<Item *>(src));
-        if (src_id == it_key && dst->is_kind("st_key")) {
+        if (src_id == it_key && dst->isKind("st_key")) {
             dst->setAttr("code", src->getAttr("code"));
             return;
         }
@@ -2405,7 +2405,6 @@
     public:
         ObjectRepos();
         ~ObjectRepos();
-        void add_templ(Object *o);
         void add_templ (const string &name, Object *o);
         bool has_templ(const string &name);
         Object *make(const string &name);
@@ -2437,14 +2436,6 @@
         objmap[kind] = o;
 }
 
-void ObjectRepos::add_templ (Object *o) {
-    string kind = o->get_kind();
-    if (has_templ(kind))
-        enigma::Log << "add_templ: redefinition of object `" <<kind<< "'.\n";
-    else
-        objmap[kind] = o;
-}
-
 bool ObjectRepos::has_templ(const string &name) {
     return objmap.find(name) != objmap.end();
 }
@@ -2503,11 +2494,7 @@
     } else {
         int count = 0;
         for (std::list<BootKindObject *>::iterator itr = templates.begin(); itr != templates.end(); ++itr) {
-            if ((*itr)->kind.empty()) {
-                Register((*itr)->object);
-            } else {
-                Register((*itr)->kind.c_str(), (*itr)->object);                
-            }
+            Register((*itr)->kind, (*itr)->object);
             delete (*itr);
             count++;
         }
@@ -2515,39 +2502,22 @@
     }
 }
 
-void Register (const string &kind, Object *obj) {
+void Register(const std::string &kind, Object *obj) {
     if (!repos)
         repos = new ObjectRepos;
-    if (kind.empty())
-        repos->add_templ(obj->get_kind(), obj);
-    else
-        repos->add_templ(kind, obj);
+    ASSERT(!kind.empty(), XLevelRuntime, "Registration of object without kind");
+    repos->add_templ(kind, obj);
 }
 
 
-void Register (Object *obj) {
-    Register (obj->get_kind(), obj);
-}
+//void RegisterActor (Actor *actor) 
+//{
+//    Register(static_cast<Object*>(actor));
+//    ActorID id = get_id(actor);
+//    ASSERT (id != ac_INVALID, XLevelRuntime,
+//        "RegisterActor: trying to register with invalid ID");
+//}
 
-void Register (const string &kind, Floor *obj)
-{
-    Object *o = obj;
-    Register(kind, o);
-}
-
-void Register (const string &kind, Stone *obj) {
-    Object *o = obj;
-    Register(kind, o);
-}
-
-void RegisterActor (Actor *actor) 
-{
-    Register(static_cast<Object*>(actor));
-    ActorID id = get_id(actor);
-    ASSERT (id != ac_INVALID, XLevelRuntime,
-        "RegisterActor: trying to register with invalid ID");
-}
-
 void Repos_Shutdown() {
     delete repos;
 }
@@ -2581,6 +2551,9 @@
     return dynamic_cast<Floor*>(MakeObject(kind));
 }
 
+Item * MakeItem(const char *kind) {
+    return dynamic_cast<Item*>(MakeObject(kind));
+}
 Stone * MakeStone (const char *kind) {
     return dynamic_cast<Stone*>(MakeObject(kind));
 }
@@ -2601,33 +2574,12 @@
                               double mousefactor, bool burnable,
                               const std::string &firetransform)
 {
-    Register(new Floor(kind.c_str(), friction, mousefactor,
-             flf_default, burnable ? flft_burnable : flft_default,
-             firetransform.c_str(), ""));
+    // TBD
 }
 
 void DumpObjectInfo() {
     repos->dump_info();
 }
 
-/* ------------------- Item repository ------------------- */
 
-void Register (const string &kind, Item *obj) 
-{
-    Object *o = obj;
-    Register(kind, o);
-}
-
-void RegisterItem (Item *item) 
-{
-    Register(static_cast<Object*>(item));
-    ItemID id = get_id(item);
-    ASSERT(id != it_INVALID, XLevelRuntime,
-        "RegisterItem: trying to register with invalid ID");
-}
-
-
-Item * MakeItem(const char *kind) {
-    return dynamic_cast<Item*>(MakeObject(kind));
-}
 } // namespace enigma

Modified: trunk/src/world.hh
===================================================================
--- trunk/src/world.hh	2009-09-03 23:21:26 UTC (rev 1792)
+++ trunk/src/world.hh	2009-09-05 23:26:05 UTC (rev 1793)
@@ -331,6 +331,7 @@
 
     Object *MakeObject (const char *kind);
     Floor  *MakeFloor (const char *kind);
+    Item   *MakeItem (const char *kind);
     Stone  *MakeStone (const char *kind);
     Actor  *MakeActor (const char *kind);
 
@@ -348,18 +349,10 @@
 
     /* Register a new object. */
     void BootRegister(Object *obj, const char * kind = NULL, bool isRegistration = true);
-    void Register (Object *obj);
     void Register (const string &kind, Object *obj);
-    void Register (const string &kind, Floor *obj);
-    void Register (const string &kind, Stone *obj);
-    void RegisterActor (Actor *ac);
+//    void RegisterActor (Actor *ac);
 
 
-
-    void Register (const string &kind, Item *obj);
-    void RegisterItem (Item *it);
-    Item   *MakeItem (const char *kind);
-
     /* Shutdown object repository */
     void Repos_Shutdown();
 



From ral at mail.berlios.de  Sun Sep  6 01:28:03 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 6 Sep 2009 01:28:03 +0200
Subject: [Enigma-game-svn] r1794 - trunk/src/stones
Message-ID: <200909052328.n85NS3I3003248@sheep.berlios.de>

Author: ral
Date: 2009-09-06 01:28:00 +0200 (Sun, 06 Sep 2009)
New Revision: 1794

Modified:
   trunk/src/stones/BoulderStone.cc
   trunk/src/stones/LightPassengerStone.cc
Log:
Trunk 1.1: 
- fix st_lightpassenger: do not switch off when being set on top of an it_cross
    during level initialization according snapshot principle
- st_boulder on swap: do not activate boulder by swapping. Give swap causing
    actor a fair chance to retreat.


Modified: trunk/src/stones/BoulderStone.cc
===================================================================
--- trunk/src/stones/BoulderStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
+++ trunk/src/stones/BoulderStone.cc	2009-09-05 23:28:00 UTC (rev 1794)
@@ -57,6 +57,8 @@
         } else if (m.message == "_cannonball" && server::GameCompatibility == enigma::GAMET_PEROXYD) {
             KillStone(get_pos());
             return Value();
+        } else if (m.message == "_model_reanimated") {
+            state == IDLE;  // revoke activation of on_move() to allow swapping actor to retreat
         }
         return Stone::message(m);
     }

Modified: trunk/src/stones/LightPassengerStone.cc
===================================================================
--- trunk/src/stones/LightPassengerStone.cc	2009-09-05 23:26:05 UTC (rev 1793)
+++ trunk/src/stones/LightPassengerStone.cc	2009-09-05 23:28:00 UTC (rev 1794)
@@ -220,12 +220,13 @@
                     // slower when pushing another stone. This looks more
                     // natural. That's why impulse is delayed:
                     objFlags |= OBJBIT_BLOCKED;
+                } else {
+                    move_stone(skateDir);
+                    Item * it = GetItem(get_pos());
+                    if (it != NULL && get_id(it) == it_cross) {
+                        setState(0);
+                    }
                 }
-                move_stone(skateDir);
-                Item * it = GetItem(get_pos());
-                if (it != NULL && get_id(it) == it_cross) {
-                    setState(0);
-                }
             }
             GameTimer.set_alarm(this, calcInterval(), false);
         }



From raoulb at bluewin.ch  Sun Sep  6 01:56:14 2009
From: raoulb at bluewin.ch (Raoul)
Date: Sun, 6 Sep 2009 01:56:14 +0200
Subject: [Enigma-game-svn] Rev 1795
Message-ID: <20090906015614.315f3753@loipc.loinet.home>

-> New levels from various authors
-> Some Rewrites
-> A few bugfixes and other updates
-> autoopening vortex in items testlevel


From ral at mail.berlios.de  Sun Sep  6 17:55:26 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 6 Sep 2009 17:55:26 +0200
Subject: [Enigma-game-svn] r1796 - in trunk: data data/schemas src src/items
Message-ID: <200909061555.n86FtQuC001252@sheep.berlios.de>

Author: ral
Date: 2009-09-06 17:55:26 +0200 (Sun, 06 Sep 2009)
New Revision: 1796

Modified:
   trunk/data/api1init.lua
   trunk/data/schemas/objects.xml
   trunk/src/items/SimpleItems.hh
   trunk/src/player.cc
   trunk/src/server.cc
Log:
Trunk 1.1: internal reengineering
- add missing simple item object.xml declarations that caused problems with
    r1793
- reengineer actor essential attribute according refman, 
    - keep old API compatible
- fix ConserveLevel=false, that caused 2 extralifes on first death


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2009-09-05 23:49:04 UTC (rev 1795)
+++ trunk/data/api1init.lua	2009-09-06 15:55:26 UTC (rev 1796)
@@ -1021,6 +1021,13 @@
      if key == "player" then
          _key = "owner"
      end
+     if key == "essential" then
+        if val == -1 then
+            _val = 1
+        elseif val == 1 then
+            _val = 2
+        end
+     end
      enigma._SetAttrib(obj, _key, _val)
 end
 
@@ -1158,6 +1165,13 @@
      if key == "gohome" then
          if val == false then val = 0 else val = 1 end
      end
+     if key == "essential" then
+        if val == 1 then
+            val = -1
+        elseif val == 2 then
+            val = 1
+        end
+     end
      return val
 end
 

Modified: trunk/data/schemas/objects.xml
===================================================================
--- trunk/data/schemas/objects.xml	2009-09-05 23:49:04 UTC (rev 1795)
+++ trunk/data/schemas/objects.xml	2009-09-06 15:55:26 UTC (rev 1796)
@@ -853,11 +853,6 @@
     </object>
     <object name="it_brake"/>
     <object name="it_brush"/>
-    <object name="it_cherry"/>
-    <object name="it_coin">
-      <attr name="coin_value" default="3"/>
-      <attr name="state" rw="r"/>
-    </object>
     <object name="it_burnable">
       <attr name="state" max="5" rw="r"/>
       <msg name="extinguish"/>
@@ -883,6 +878,12 @@
     <object name="it_burnable_fireproof">
       <attr name="state" value="5"/>
     </object>
+    <object name="it_cherry"/>
+    <object name="it_coffee"/>
+    <object name="it_coin">
+      <attr name="coin_value" default="3"/>
+      <attr name="state" rw="r"/>
+    </object>
     <object name="it_coin_s">
       <attr name="state" value="0"/>
     </object>
@@ -922,6 +923,7 @@
     <object name="it_document">
       <attr name="text"/>
     </object>
+    <object name="it_debris"/>
     <object name="it_drop"/>
     <object name="it_extinguisher">
       <attr name="state" max="2"/>
@@ -963,7 +965,6 @@
     </object>
     <object name="it_extralife"/>
     <object name="it_extralife_new" init="true"/>
-    <object name="it_floppy"/>
     <object name="it_flag">
       <attr name="color"/>
     </object>
@@ -973,6 +974,7 @@
     <object name="it_flag_white">
       <attr name="color" value="1"/>
     </object>
+    <object name="it_floppy"/>
     <object name="it_glasses">
       <attr name="state" max="31"/>
     </object>
@@ -985,6 +987,7 @@
       <attr name="code"/>
     </object>
     <object name="it_landmine"/>
+    <object name="it_magicwand"/>
     <object name="it_magnet">
       <attr name="range" default="nil"/>
       <attr name="strength" default="nil"/>
@@ -1077,6 +1080,7 @@
     <object name="it_puller_n">
       <attr name="orientation" value="3"/>
     </object>
+    <object name="it_ring"/>
     <object name="it_rubberband">
       <attr name="anchor2"/>
       <attr name="strength" default="10"/>
@@ -1123,6 +1127,7 @@
     <object name="it_shogun_l">
       <attr name="flavor" value="l"/>
     </object>
+    <object name="it_spoon"/>
     <object name="it_spring">
     </object>
     <object name="it_spring_keep">
@@ -1135,6 +1140,7 @@
     <object name="it_squashed">
       <msg name="_brush"/>
     </object>
+    <object name="it_squashed"/>
     <object name="it_strip">
       <attr name="connections"/>
       <attr name="friction"/>
@@ -1240,6 +1246,7 @@
     <object name="it_wrench"/>
     <object name="ot" abstract="true">
     </object>
+    <object name="it_yinyang"/>
     <object name="ot_counter">
       <msg name="signal"/>
     </object>

Modified: trunk/src/items/SimpleItems.hh
===================================================================
--- trunk/src/items/SimpleItems.hh	2009-09-05 23:49:04 UTC (rev 1795)
+++ trunk/src/items/SimpleItems.hh	2009-09-06 15:55:26 UTC (rev 1796)
@@ -172,14 +172,14 @@
     DEF_ITEM(Floppy, "it_floppy", it_floppy);
 
     /**
-     * MagicWand
+     * Key
      */
-    DEF_ITEM(MagicWand, "it_magicwand", it_magicwand);
+    DEF_ITEM(Key, "it_key", it_key);
 
     /**
-     * Key
+     * MagicWand
      */
-    DEF_ITEM(Key, "it_key", it_key);
+    DEF_ITEM(MagicWand, "it_magicwand", it_magicwand);
 
     /**
      * Pencil

Modified: trunk/src/player.cc
===================================================================
--- trunk/src/player.cc	2009-09-05 23:49:04 UTC (rev 1795)
+++ trunk/src/player.cc	2009-09-06 15:55:26 UTC (rev 1796)
@@ -431,7 +431,7 @@
                 essId = a->get_traits().name;
             int essential = a->getAttr("essential");
             // count number of necessary actors per kind
-            if (essential == 1)
+            if (essential == 2)
                 --essMap[essId];
 
             if (!a->is_dead() ||
@@ -441,12 +441,12 @@
                     has_living_actor = true;
                 }
                 // count number of alive actors per kind
-                if (essential >= 0)
+                if (essential == 0 || essential == 2)
                     ++essMap[essId];
             }
             else {
                 // player is dead and could not resurrect
-                if (essential == -1) {
+                if (essential == 1) {
                     // actor is personnally essential but dead
                     new_game = true;
                 }

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2009-09-05 23:49:04 UTC (rev 1795)
+++ trunk/src/server.cc	2009-09-06 15:55:26 UTC (rev 1796)
@@ -156,8 +156,8 @@
             sound::StartLevelMusic(false);
             
         server::LoadedProxy = levelProxy;
+        IsLevelRestart = isRestart;
         server::PrepareLevel();
-        IsLevelRestart = isRestart;
 
         // clear inventory before level load and give us 2 extralives
         player::NewGame();



From ral at mail.berlios.de  Tue Sep  8 00:46:40 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Tue, 8 Sep 2009 00:46:40 +0200
Subject: [Enigma-game-svn] r1797 - in trunk: data src
Message-ID: <200909072246.n87Mkel0031853@sheep.berlios.de>

Author: ral
Date: 2009-09-08 00:46:36 +0200 (Tue, 08 Sep 2009)
New Revision: 1797

Modified:
   trunk/data/api1init.lua
   trunk/src/AttributeDescriptor.cc
   trunk/src/AttributeDescriptor.hh
   trunk/src/KindDescriptor.cc
   trunk/src/KindDescriptor.hh
   trunk/src/Object.cc
   trunk/src/Object.hh
   trunk/src/ObjectValidator.cc
   trunk/src/ObjectValidator.hh
   trunk/src/lua.cc
Log:
Trunk 1.1: 
- validate Lua attribute write operations on value type mismatches
- fix old api fire attribute mapping
Note:
- many levels will now fail to load due to level typos

Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2009-09-06 15:55:26 UTC (rev 1796)
+++ trunk/data/api1init.lua	2009-09-07 22:46:36 UTC (rev 1797)
@@ -902,6 +902,27 @@
      if key == "movable" then
          if val == 1 then _val = true else _val = false end
      end
+     if key == "burnable" then
+         if val == 1 then _val = true else _val = false end
+     end
+     if key == "eternal" then
+         if val == 1 then _val = true else _val = false end
+     end
+     if key == "fastfire" then
+         if val == 1 then _val = true else _val = false end
+     end
+     if key == "ignitable" then
+         if val == 1 then _val = true else _val = false end
+     end
+     if key == "initfire" then
+         if val == 1 then _val = true else _val = false end
+     end
+     if key == "noash" then
+         if val == 1 then _val = true else _val = false end
+     end
+     if key == "secure" then
+         if val == 1 then _val = true else _val = false end
+     end
      if key == "type" and _obj_name == "st-door" then
          _key = "faces"
          if val == "h" then _val = "ns" else _val = "ew" end

Modified: trunk/src/AttributeDescriptor.cc
===================================================================
--- trunk/src/AttributeDescriptor.cc	2009-09-06 15:55:26 UTC (rev 1796)
+++ trunk/src/AttributeDescriptor.cc	2009-09-07 22:46:36 UTC (rev 1797)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -54,6 +54,39 @@
         return value;
     }
     
+    ValidationResult AttributeDescriptor::checkValue(Value val) {
+        switch (type) {
+            case VAL_BOOL :
+                return val.getType() == Value::BOOL ? VALID_OK : VALID_TYPE_MISMATCH;
+                break;
+            case VAL_INT :
+                // TBD add int, min, max check
+                if (name != "code")
+                    return val.getType() == Value::DOUBLE  ? VALID_OK : VALID_TYPE_MISMATCH;
+                else
+                    return (val.getType() == Value::DOUBLE || val.getType() == Value::STRING)  ? 
+                            VALID_OK : VALID_TYPE_MISMATCH;                    
+                break;
+            case VAL_DOUBLE :
+                return val.getType() == Value::DOUBLE  ? VALID_OK : VALID_TYPE_MISMATCH;
+                break;
+            case VAL_STRING :
+                return val.getType() == Value::STRING  ? VALID_OK : VALID_TYPE_MISMATCH;
+                break;
+            case VAL_TOKENS : {
+                Value::Type vt = val.getType();
+                bool result = (vt == Value::STRING || vt == Value::TOKENS || vt == Value::OBJECT || vt == Value::GROUP);
+                if (name == "destination")
+                    return (result || vt == Value::POSITION)  ? VALID_OK : VALID_TYPE_MISMATCH;
+                else
+                    return result  ? VALID_OK : VALID_TYPE_MISMATCH;
+                break;
+            }
+            default :
+                return VALID_OK;
+        }
+    }
+    
     void AttributeDescriptor::setReadable(bool allowRead) {
         ASSERT(!isKindValue, XFrontend, 
                 ecl::strf("Object description initialization error - attribute '%s' made readable for a subkind",

Modified: trunk/src/AttributeDescriptor.hh
===================================================================
--- trunk/src/AttributeDescriptor.hh	2009-09-06 15:55:26 UTC (rev 1796)
+++ trunk/src/AttributeDescriptor.hh	2009-09-07 22:46:36 UTC (rev 1797)
@@ -20,6 +20,7 @@
 #define ATTRIBUTEDESCRIPTOR_HH_INCLUDED
 
 #include "Value.hh"
+#include "Object.hh"
 #include <string>
 
 namespace enigma
@@ -46,6 +47,7 @@
         bool isWritable();
         Value getDefaultValue();
         Value getValue();
+        ValidationResult checkValue(Value val);
         void setReadable(bool allowRead);
         void setWritable(bool allowWrite);
         void setDefaultValue(const Value &newDefault);

Modified: trunk/src/KindDescriptor.cc
===================================================================
--- trunk/src/KindDescriptor.cc	2009-09-06 15:55:26 UTC (rev 1796)
+++ trunk/src/KindDescriptor.cc	2009-09-07 22:46:36 UTC (rev 1797)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -97,13 +97,16 @@
         return cloneAttribute;
     }
     
-    bool KindDescriptor::validateAttributeWrite(std::string key, Value val) {
+    ValidationResult KindDescriptor::validateAttributeWrite(std::string key, Value val) {
         std::map<std::string, AttributeDescriptor *>::iterator it = attributes.find(key);
         if (it == attributes.end())
-            return false;
+            return VALID_UNKNOWN_KEY;
+        else if (!it->second->isWritable())
+            return VALID_ACCESS_DENIED;
+        else if (val.getType() == Value::NIL)  // reset to default value
+            return VALID_OK;
         else
-            // TODO validate value - DEFAULT is the type that matches anything
-            return it->second->isWritable();
+            return it->second->checkValue(val);
     }
     
     bool KindDescriptor::validateAttributeRead(std::string key) {

Modified: trunk/src/KindDescriptor.hh
===================================================================
--- trunk/src/KindDescriptor.hh	2009-09-06 15:55:26 UTC (rev 1796)
+++ trunk/src/KindDescriptor.hh	2009-09-07 22:46:36 UTC (rev 1797)
@@ -19,6 +19,7 @@
 #ifndef KINDDESCRIPTOR_HH_INCLUDED
 #define KINDDESCRIPTOR_HH_INCLUDED
 
+#include "Object.hh"
 #include "AttributeDescriptor.hh"
 #include "MessageDescriptor.hh"
 #include <list>
@@ -34,7 +35,7 @@
         bool validateMessage(std::string msg);
         void addAttribute(std::string name);
         AttributeDescriptor * addModifiedAttribute(std::string name);
-        bool validateAttributeWrite(std::string key, Value val);
+        ValidationResult validateAttributeWrite(std::string key, Value val);
         bool validateAttributeRead(std::string key);
         Value getDefaultValue(std::string key);
         std::string getKind(const Object *obj);

Modified: trunk/src/Object.cc
===================================================================
--- trunk/src/Object.cc	2009-09-06 15:55:26 UTC (rev 1796)
+++ trunk/src/Object.cc	2009-09-07 22:46:36 UTC (rev 1797)
@@ -219,14 +219,24 @@
                     (*itr)->setAttr("fellows", olist2);
                 }
             }
-        } else if (key.find('_') == 0 || ObjectValidator::instance()->validateAttributeWrite(this, key, val)) {
-            if (key == "destination" || key.find("target") == 0)
-                 if (val.maybeNearestObjectReference())
-                     objFlags |= OBJBIT_INIT; 
-            setAttr(key, val);
-        } else
-            ASSERT(false, XLevelRuntime, ecl::strf("Object: attribute '%s' write not allowed for kind '%s'",
-                    key.c_str(), getKind().c_str()).c_str());
+        } else {
+            ValidationResult result = VALID_OK;
+            if (key.find('_') != 0) 
+                result = ObjectValidator::instance()->validateAttributeWrite(this, key, val);
+            if (result == VALID_OK) {
+                if (key == "destination" || key.find("target") == 0)
+                     if (val.maybeNearestObjectReference())
+                         objFlags |= OBJBIT_INIT; 
+                setAttr(key, val);
+            } else {
+                std::string reason;
+                if (result == VALID_UNKNOWN_KEY) reason = "attribute name unknown";
+                else if (result == VALID_ACCESS_DENIED) reason = "no write access allowed";
+                else if (result == VALID_TYPE_MISMATCH) reason = "value typ mismatch";
+                ASSERT(false, XLevelRuntime, ecl::strf("Object: attribute '%s' write failed for kind '%s', %s",
+                        key.c_str(), getKind().c_str(), reason.c_str()).c_str());
+            }
+        }
     }
     
     Value Object::getAttrChecked(const std::string &key) const {

Modified: trunk/src/Object.hh
===================================================================
--- trunk/src/Object.hh	2009-09-06 15:55:26 UTC (rev 1796)
+++ trunk/src/Object.hh	2009-09-07 22:46:36 UTC (rev 1797)
@@ -43,6 +43,14 @@
         OBJBIT_INIT          =  1<<11  ///< Object needs init message for @ finalization
     };
     
+    enum ValidationResult {
+        VALID_OK,
+        VALID_ACCESS_DENIED,
+        VALID_UNKNOWN_KEY,
+        VALID_TYPE_MISMATCH,
+        VALID_ILLEAGAL_VALUE
+    };    
+        
     class Value;
 
     /**

Modified: trunk/src/ObjectValidator.cc
===================================================================
--- trunk/src/ObjectValidator.cc	2009-09-06 15:55:26 UTC (rev 1796)
+++ trunk/src/ObjectValidator.cc	2009-09-07 22:46:36 UTC (rev 1797)
@@ -184,10 +184,10 @@
         return clone;
     }
 
-    bool ObjectValidator::validateAttributeWrite(const Object *obj, std::string key, Value val) {
+    ValidationResult ObjectValidator::validateAttributeWrite(const Object *obj, std::string key, Value val) {
         KindDescriptor *kind = getKindDesc(obj->getClass());
         if (kind == NULL) {
-            return true;    // object is not under validator control - allow write
+            return VALID_OK;    // object is not under validator control - allow write
         }
         // state dependent target/action support
         if (key.find("target_") == 0)

Modified: trunk/src/ObjectValidator.hh
===================================================================
--- trunk/src/ObjectValidator.hh	2009-09-06 15:55:26 UTC (rev 1796)
+++ trunk/src/ObjectValidator.hh	2009-09-07 22:46:36 UTC (rev 1797)
@@ -44,7 +44,6 @@
      */
     class ObjectValidator {
     public:
-        
         static ObjectValidator *instance();
         static void didInitXML();
         
@@ -56,7 +55,7 @@
         bool validateMessage(Object *obj, std::string msg, Value val);
         AttributeDescriptor *getDefaultAttributeDesc(std::string name);
         AttributeDescriptor *cloneAttribute(AttributeDescriptor *masterAttr);
-        bool validateAttributeWrite(const Object *obj, std::string key, Value val);
+        ValidationResult validateAttributeWrite(const Object *obj, std::string key, Value val);
         bool validateAttributeRead(const Object *obj, std::string key);
         Value getDefaultValue(const Object *obj, std::string key);
         std::string getKind(const Object *obj);

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2009-09-06 15:55:26 UTC (rev 1796)
+++ trunk/src/lua.cc	2009-09-07 22:46:36 UTC (rev 1797)
@@ -1318,7 +1318,15 @@
          lua_pushvalue(L, -2); // a copy of key for work
          if (!lua_isnumber(L, -1) && lua_isstring(L, -1)) {
             std::string key = lua_tostring(L, -1);
-            obj->setAttrChecked(key, to_value(L, -2));  // name set gets handeled by Object
+            try {
+                obj->setAttrChecked(key, to_value(L, -2));  // name set gets handeled by Object
+            }  
+            catch (const XLevelRuntime &e) {
+                throwLuaError (L, e.what());
+            }
+            catch (...) {
+                throwLuaError (L, "uncaught exception");
+            }
          } else if (lua_tointeger(L, -1) == 2) {  // second entry without a string key is taken as name
              if (!lua_isnumber(L, -2) && lua_isstring(L, -2))
                  obj->setAttrChecked("name", lua_tostring(L, -2));



From raoulb at bluewin.ch  Tue Sep  8 01:12:29 2009
From: raoulb at bluewin.ch (Raoul)
Date: Tue, 8 Sep 2009 01:12:29 +0200
Subject: [Enigma-game-svn] Rev 1798
Message-ID: <20090908011229.4f433668@loipc.loinet.home>

-> Replaced values of the attributes "owner", "controllers", "essential" by the equivalent new api constants
-> Rewrote all enigma levels which depend on libterrain
-> Rewrote levels which depend on old itemfreezer, part 1
-> Fixed some wrong floors of type fl_slope_t*
-> Some other new rewrites and improvements


From ral at mail.berlios.de  Tue Sep  8 23:04:24 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Tue, 8 Sep 2009 23:04:24 +0200
Subject: [Enigma-game-svn] r1799 - homepage/input
Message-ID: <200909082104.n88L4OlK004582@sheep.berlios.de>

Author: ral
Date: 2009-09-08 23:04:14 +0200 (Tue, 08 Sep 2009)
New Revision: 1799

Modified:
   homepage/input/stat-other.html
   homepage/input/table-hcp.html
   homepage/input/table-rat.html
   homepage/input/table-solved.html
   homepage/input/table-wr.html
Log:
Homepage:
- statistics August 2009



Modified: homepage/input/stat-other.html
===================================================================
--- homepage/input/stat-other.html	2009-09-07 23:09:00 UTC (rev 1798)
+++ homepage/input/stat-other.html	2009-09-08 21:04:14 UTC (rev 1799)
@@ -1,22 +1,22 @@
   <div class="stat-help">
     <h3>$$Other_Statistics$$</h3>
     <h4>$$Scores$$</h4>
-      95183 $$single_level_scores$$.
+      95359 $$single_level_scores$$.
     <h4>$$Ratings$$</h4>
-      17860 $$single_level_ratings$$ 4.93 $$and_distribution$$: 
+      17870 $$single_level_ratings$$ 4.93 $$and_distribution$$: 
       <table>
         <colgroup><col width="80"><col width="80"></colgroup>
         <tr><th>$$rating$$</th><th>$$count$$</th></tr>
         <tr><td class="num">0</td><td class="num">118</td></tr>
-        <tr><td class="num">1</td><td class="num">320</td></tr>
+        <tr><td class="num">1</td><td class="num">321</td></tr>
         <tr><td class="num">2</td><td class="num">919</td></tr>
         <tr><td class="num">3</td><td class="num">2455</td></tr>
         <tr><td class="num">4</td><td class="num">3398</td></tr>
-        <tr><td class="num">5</td><td class="num">4262</td></tr>
-        <tr><td class="num">6</td><td class="num">3050</td></tr>
-        <tr><td class="num">7</td><td class="num">2033</td></tr>
+        <tr><td class="num">5</td><td class="num">4265</td></tr>
+        <tr><td class="num">6</td><td class="num">3053</td></tr>
+        <tr><td class="num">7</td><td class="num">2035</td></tr>
         <tr><td class="num">8</td><td class="num">803</td></tr>
         <tr><td class="num">9</td><td class="num">333</td></tr>
-        <tr><td class="num">10</td><td class="num">169</td></tr>
+        <tr><td class="num">10</td><td class="num">170</td></tr>
       </table>
   </div>

Modified: homepage/input/table-hcp.html
===================================================================
--- homepage/input/table-hcp.html	2009-09-07 23:09:00 UTC (rev 1798)
+++ homepage/input/table-hcp.html	2009-09-08 21:04:14 UTC (rev 1799)
@@ -1,186 +1,186 @@
   <table>
-    <caption>$$Handicap_Statistics$$ $$July$$ 2009</caption>
+    <caption>$$Handicap_Statistics$$ $$August$$ 2009</caption>
     <colgroup><col width="130"><col width="220"></colgroup>
     <tr><th>$$solved_hcp$$</th><th class="left">$$user$$</th></tr>
-     <tr><td class="num">-153.1</td><td class="left">'Moneymaker'</td></tr>
-     <tr><td class="num">-129.0</td><td class="left">'Medimaster'</td></tr>
-     <tr><td class="num">-108.1</td><td class="left">'daydreamer'</td></tr>
-     <tr><td class="num"> -74.6</td><td class="left">'Stupid'</td></tr>
-     <tr><td class="num"> -74.0</td><td class="left">'Johannes'</td></tr>
-     <tr><td class="num"> -66.3</td><td class="left">'Mentist'</td></tr>
-     <tr><td class="num"> -63.1</td><td class="left">'dev0'</td></tr>
-     <tr><td class="num"> -62.5</td><td class="left">'Great Scott'</td></tr>
-     <tr><td class="num"> -62.4</td><td class="left">'Daisy'</td></tr>
-     <tr><td class="num"> -54.3</td><td class="left">'Crystalicum'</td></tr>
-     <tr><td class="num"> -53.2</td><td class="left">'Duffy'</td></tr>
-     <tr><td class="num"> -52.1</td><td class="left">'Malla'</td></tr>
-     <tr><td class="num"> -48.8</td><td class="left">'ryujun'</td></tr>
-     <tr><td class="num"> -43.4</td><td class="left">'Alexandros'</td></tr>
-     <tr><td class="num"> -41.3</td><td class="left">'Django'</td></tr>
-     <tr><td class="num"> -38.9</td><td class="left">'Gloop'</td></tr>
-     <tr><td class="num"> -32.1</td><td class="left">'Taztunes'</td></tr>
-     <tr><td class="num"> -29.9</td><td class="left">'Safalra'</td></tr>
-     <tr><td class="num"> -29.3</td><td class="left">'Angolino'</td></tr>
-     <tr><td class="num"> -28.8</td><td class="left">'Emmanuel'</td></tr>
-     <tr><td class="num"> -27.1</td><td class="left">'Ludmian'</td></tr>
-     <tr><td class="num"> -24.0</td><td class="left">'B-Huff'</td></tr>
-     <tr><td class="num"> -23.0</td><td class="left">'dpl'</td></tr>
-     <tr><td class="num"> -21.4</td><td class="left">'Zekobah'</td></tr>
-     <tr><td class="num"> -21.2</td><td class="left">'bojster'</td></tr>
-     <tr><td class="num"> -20.5</td><td class="left">'Ghatotkacha'</td></tr>
-     <tr><td class="num"> -17.2</td><td class="left">'ged'</td></tr>
-     <tr><td class="num"> -15.8</td><td class="left">'hendrik'</td></tr>
-     <tr><td class="num"> -15.2</td><td class="left">'Raoul'</td></tr>
-     <tr><td class="num"> -15.2</td><td class="left">'ABS'</td></tr>
-     <tr><td class="num"> -12.4</td><td class="left">'Ronald'</td></tr>
-     <tr><td class="num"> -12.0</td><td class="left">'Dime'</td></tr>
-     <tr><td class="num">  -7.2</td><td class="left">'Lukas'</td></tr>
-     <tr><td class="num">  -6.1</td><td class="left">'HuB34'</td></tr>
-     <tr><td class="num">  -3.3</td><td class="left">'Timo'</td></tr>
-     <tr><td class="num">  -2.8</td><td class="left">'Iceshark7'</td></tr>
-     <tr><td class="num">  -2.1</td><td class="left">'joseba'</td></tr>
-     <tr><td class="num">   0.0</td><td class="left">'mecke'</td></tr>
-     <tr><td class="num">   1.3</td><td class="left">'Daniel'</td></tr>
-     <tr><td class="num">   1.7</td><td class="left">'fabian'</td></tr>
-     <tr><td class="num">   2.1</td><td class="left">'U-Punkt'</td></tr>
-     <tr><td class="num">   2.8</td><td class="left">'Hairball'</td></tr>
-     <tr><td class="num">   2.8</td><td class="left">'Craven'</td></tr>
-     <tr><td class="num">   3.0</td><td class="left">'JuSt'</td></tr>
-     <tr><td class="num">   3.6</td><td class="left">'Wuzzy'</td></tr>
+     <tr><td class="num">-152.4</td><td class="left">'Moneymaker'</td></tr>
+     <tr><td class="num">-128.4</td><td class="left">'Medimaster'</td></tr>
+     <tr><td class="num">-107.6</td><td class="left">'daydreamer'</td></tr>
+     <tr><td class="num"> -74.1</td><td class="left">'Stupid'</td></tr>
+     <tr><td class="num"> -73.4</td><td class="left">'Johannes'</td></tr>
+     <tr><td class="num"> -65.7</td><td class="left">'Mentist'</td></tr>
+     <tr><td class="num"> -62.5</td><td class="left">'dev0'</td></tr>
+     <tr><td class="num"> -62.3</td><td class="left">'Daisy'</td></tr>
+     <tr><td class="num"> -62.1</td><td class="left">'Great Scott'</td></tr>
+     <tr><td class="num"> -53.8</td><td class="left">'Crystalicum'</td></tr>
+     <tr><td class="num"> -52.9</td><td class="left">'Duffy'</td></tr>
+     <tr><td class="num"> -51.6</td><td class="left">'Malla'</td></tr>
+     <tr><td class="num"> -48.2</td><td class="left">'ryujun'</td></tr>
+     <tr><td class="num"> -46.6</td><td class="left">'Alexandros'</td></tr>
+     <tr><td class="num"> -40.8</td><td class="left">'Django'</td></tr>
+     <tr><td class="num"> -40.8</td><td class="left">'Emmanuel'</td></tr>
+     <tr><td class="num"> -38.3</td><td class="left">'Gloop'</td></tr>
+     <tr><td class="num"> -31.6</td><td class="left">'Taztunes'</td></tr>
+     <tr><td class="num"> -29.3</td><td class="left">'Safalra'</td></tr>
+     <tr><td class="num"> -28.8</td><td class="left">'Angolino'</td></tr>
+     <tr><td class="num"> -26.6</td><td class="left">'Ludmian'</td></tr>
+     <tr><td class="num"> -23.6</td><td class="left">'B-Huff'</td></tr>
+     <tr><td class="num"> -22.6</td><td class="left">'dpl'</td></tr>
+     <tr><td class="num"> -20.9</td><td class="left">'Zekobah'</td></tr>
+     <tr><td class="num"> -20.7</td><td class="left">'bojster'</td></tr>
+     <tr><td class="num"> -20.1</td><td class="left">'Ghatotkacha'</td></tr>
+     <tr><td class="num"> -16.7</td><td class="left">'ged'</td></tr>
+     <tr><td class="num"> -15.4</td><td class="left">'hendrik'</td></tr>
+     <tr><td class="num"> -14.9</td><td class="left">'Raoul'</td></tr>
+     <tr><td class="num"> -14.9</td><td class="left">'ABS'</td></tr>
+     <tr><td class="num"> -12.0</td><td class="left">'Ronald'</td></tr>
+     <tr><td class="num"> -11.6</td><td class="left">'Dime'</td></tr>
+     <tr><td class="num">  -6.9</td><td class="left">'Lukas'</td></tr>
+     <tr><td class="num">  -5.8</td><td class="left">'HuB34'</td></tr>
+     <tr><td class="num">  -4.1</td><td class="left">'H-J.Epting'</td></tr>
+     <tr><td class="num">  -2.8</td><td class="left">'Timo'</td></tr>
+     <tr><td class="num">  -2.5</td><td class="left">'Iceshark7'</td></tr>
+     <tr><td class="num">  -1.7</td><td class="left">'joseba'</td></tr>
+     <tr><td class="num">   0.4</td><td class="left">'mecke'</td></tr>
+     <tr><td class="num">   1.6</td><td class="left">'Daniel'</td></tr>
+     <tr><td class="num">   1.9</td><td class="left">'fabian'</td></tr>
+     <tr><td class="num">   2.4</td><td class="left">'U-Punkt'</td></tr>
+     <tr><td class="num">   3.0</td><td class="left">'Hairball'</td></tr>
+     <tr><td class="num">   3.2</td><td class="left">'Craven'</td></tr>
+     <tr><td class="num">   3.3</td><td class="left">'JuSt'</td></tr>
      <tr><td class="num">   3.7</td><td class="left">'Kevin'</td></tr>
-     <tr><td class="num">   3.8</td><td class="left">'Freshman'</td></tr>
-     <tr><td class="num">   4.0</td><td class="left">'H-J.Epting'</td></tr>
-     <tr><td class="num">   4.6</td><td class="left">'mrduke'</td></tr>
-     <tr><td class="num">   4.6</td><td class="left">'Tiza'</td></tr>
-     <tr><td class="num">   5.5</td><td class="left">'para_doks'</td></tr>
-     <tr><td class="num">   6.0</td><td class="left">'Tobias'</td></tr>
-     <tr><td class="num">   6.5</td><td class="left">'Another'</td></tr>
-     <tr><td class="num">   7.0</td><td class="left">'alfred69'</td></tr>
-     <tr><td class="num">   7.5</td><td class="left">'Guglielmo'</td></tr>
-     <tr><td class="num">   8.5</td><td class="left">'Sigma'</td></tr>
-     <tr><td class="num">   8.5</td><td class="left">'serpent'</td></tr>
-     <tr><td class="num">   8.6</td><td class="left">'Andy'</td></tr>
-     <tr><td class="num">  10.8</td><td class="left">'Austin'</td></tr>
-     <tr><td class="num">  11.9</td><td class="left">'shoki'</td></tr>
-     <tr><td class="num">  13.8</td><td class="left">'oxyd4ever'</td></tr>
-     <tr><td class="num">  14.6</td><td class="left">'ShadowPhrogg32642342'</td></tr>
-     <tr><td class="num">  16.6</td><td class="left">'Mark P.'</td></tr>
-     <tr><td class="num">  16.8</td><td class="left">'Andreas'</td></tr>
-     <tr><td class="num">  17.4</td><td class="left">'AlephD'</td></tr>
-     <tr><td class="num">  17.7</td><td class="left">'Sim_Ed'</td></tr>
-     <tr><td class="num">  18.4</td><td class="left">'Chocolate Zero'</td></tr>
-     <tr><td class="num">  18.4</td><td class="left">'Agnieszka'</td></tr>
-     <tr><td class="num">  19.3</td><td class="left">'casmith_789'</td></tr>
-     <tr><td class="num">  20.0</td><td class="left">'ais523'</td></tr>
-     <tr><td class="num">  21.8</td><td class="left">'Ale'</td></tr>
-     <tr><td class="num">  22.1</td><td class="left">'Alex'</td></tr>
-     <tr><td class="num">  24.6</td><td class="left">'Antonio EE'</td></tr>
-     <tr><td class="num">  24.8</td><td class="left">'Klaus'</td></tr>
-     <tr><td class="num">  25.0</td><td class="left">'Jinajon'</td></tr>
-     <tr><td class="num">  25.5</td><td class="left">'Marc-Hendrik'</td></tr>
-     <tr><td class="num">  26.0</td><td class="left">'Chris'</td></tr>
-     <tr><td class="num">  26.4</td><td class="left">'Thomas'</td></tr>
-     <tr><td class="num">  26.6</td><td class="left">'Feynman'</td></tr>
-     <tr><td class="num">  27.2</td><td class="left">'hdwow'</td></tr>
-     <tr><td class="num">  27.3</td><td class="left">'Gottseinsohn'</td></tr>
-     <tr><td class="num">  28.3</td><td class="left">'Bent'</td></tr>
-     <tr><td class="num">  28.3</td><td class="left">'Hans-HD'</td></tr>
-     <tr><td class="num">  29.1</td><td class="left">'un_guru'</td></tr>
-     <tr><td class="num">  29.6</td><td class="left">'Little_Mole'</td></tr>
-     <tr><td class="num">  30.1</td><td class="left">'J3FF'</td></tr>
-     <tr><td class="num">  30.9</td><td class="left">'biotopa'</td></tr>
-     <tr><td class="num">  30.9</td><td class="left">'Vinksu'</td></tr>
-     <tr><td class="num">  31.1</td><td class="left">'evane'</td></tr>
-     <tr><td class="num">  31.3</td><td class="left">'oblo'</td></tr>
-     <tr><td class="num">  31.4</td><td class="left">'GiannuzzITA'</td></tr>
-     <tr><td class="num">  31.8</td><td class="left">'redsantz'</td></tr>
-     <tr><td class="num">  33.1</td><td class="left">'geembo_90'</td></tr>
-     <tr><td class="num">  33.2</td><td class="left">'Edgar_Flesk'</td></tr>
-     <tr><td class="num">  33.3</td><td class="left">'Melanie'</td></tr>
-     <tr><td class="num">  33.5</td><td class="left">'NorthForty'</td></tr>
-     <tr><td class="num">  33.8</td><td class="left">'IChrisI'</td></tr>
-     <tr><td class="num">  34.2</td><td class="left">'erich'</td></tr>
-     <tr><td class="num">  34.2</td><td class="left">'Gorn'</td></tr>
-     <tr><td class="num">  36.9</td><td class="left">'niebie'</td></tr>
-     <tr><td class="num">  37.0</td><td class="left">'MicWa'</td></tr>
-     <tr><td class="num">  37.1</td><td class="left">'WP319'</td></tr>
-     <tr><td class="num">  37.5</td><td class="left">'Kosby'</td></tr>
-     <tr><td class="num">  38.2</td><td class="left">'alain'</td></tr>
-     <tr><td class="num">  39.2</td><td class="left">'Liam Sheehan'</td></tr>
-     <tr><td class="num">  39.7</td><td class="left">'Rugby4ever'</td></tr>
-     <tr><td class="num">  40.6</td><td class="left">'Drotten'</td></tr>
-     <tr><td class="num">  40.6</td><td class="left">'WesleyCrusher'</td></tr>
-     <tr><td class="num">  41.0</td><td class="left">'Archcorenth'</td></tr>
-     <tr><td class="num">  41.1</td><td class="left">'Harry Lim'</td></tr>
-     <tr><td class="num">  41.2</td><td class="left">'purplerainbow'</td></tr>
-     <tr><td class="num">  41.6</td><td class="left">'B-man'</td></tr>
-     <tr><td class="num">  42.0</td><td class="left">'Nfol'</td></tr>
-     <tr><td class="num">  42.7</td><td class="left">'Tiger'</td></tr>
-     <tr><td class="num">  42.8</td><td class="left">'gringer'</td></tr>
-     <tr><td class="num">  43.3</td><td class="left">'Vlad'</td></tr>
-     <tr><td class="num">  43.6</td><td class="left">'Snaily'</td></tr>
-     <tr><td class="num">  44.4</td><td class="left">'Momcat'</td></tr>
-     <tr><td class="num">  45.1</td><td class="left">'Breezy'</td></tr>
+     <tr><td class="num">   3.9</td><td class="left">'Wuzzy'</td></tr>
+     <tr><td class="num">   4.2</td><td class="left">'Freshman'</td></tr>
+     <tr><td class="num">   4.9</td><td class="left">'mrduke'</td></tr>
+     <tr><td class="num">   4.9</td><td class="left">'Tiza'</td></tr>
+     <tr><td class="num">   5.9</td><td class="left">'para_doks'</td></tr>
+     <tr><td class="num">   6.3</td><td class="left">'Tobias'</td></tr>
+     <tr><td class="num">   6.9</td><td class="left">'Another'</td></tr>
+     <tr><td class="num">   7.4</td><td class="left">'alfred69'</td></tr>
+     <tr><td class="num">   7.7</td><td class="left">'Guglielmo'</td></tr>
+     <tr><td class="num">   8.7</td><td class="left">'serpent'</td></tr>
+     <tr><td class="num">   8.8</td><td class="left">'Sigma'</td></tr>
+     <tr><td class="num">   8.9</td><td class="left">'Andy'</td></tr>
+     <tr><td class="num">  11.1</td><td class="left">'Austin'</td></tr>
+     <tr><td class="num">  12.2</td><td class="left">'shoki'</td></tr>
+     <tr><td class="num">  14.0</td><td class="left">'oxyd4ever'</td></tr>
+     <tr><td class="num">  14.8</td><td class="left">'ShadowPhrogg32642342'</td></tr>
+     <tr><td class="num">  16.8</td><td class="left">'Mark P.'</td></tr>
+     <tr><td class="num">  17.0</td><td class="left">'Andreas'</td></tr>
+     <tr><td class="num">  17.7</td><td class="left">'AlephD'</td></tr>
+     <tr><td class="num">  18.0</td><td class="left">'Sim_Ed'</td></tr>
+     <tr><td class="num">  18.6</td><td class="left">'Chocolate Zero'</td></tr>
+     <tr><td class="num">  18.6</td><td class="left">'Agnieszka'</td></tr>
+     <tr><td class="num">  19.6</td><td class="left">'casmith_789'</td></tr>
+     <tr><td class="num">  20.2</td><td class="left">'ais523'</td></tr>
+     <tr><td class="num">  22.0</td><td class="left">'Ale'</td></tr>
+     <tr><td class="num">  22.3</td><td class="left">'Alex'</td></tr>
+     <tr><td class="num">  24.8</td><td class="left">'Antonio EE'</td></tr>
+     <tr><td class="num">  25.0</td><td class="left">'Klaus'</td></tr>
+     <tr><td class="num">  25.2</td><td class="left">'Jinajon'</td></tr>
+     <tr><td class="num">  25.6</td><td class="left">'Marc-Hendrik'</td></tr>
+     <tr><td class="num">  26.4</td><td class="left">'Chris'</td></tr>
+     <tr><td class="num">  26.5</td><td class="left">'Thomas'</td></tr>
+     <tr><td class="num">  26.8</td><td class="left">'Feynman'</td></tr>
+     <tr><td class="num">  27.3</td><td class="left">'hdwow'</td></tr>
+     <tr><td class="num">  27.5</td><td class="left">'Gottseinsohn'</td></tr>
+     <tr><td class="num">  28.4</td><td class="left">'Bent'</td></tr>
+     <tr><td class="num">  28.5</td><td class="left">'Hans-HD'</td></tr>
+     <tr><td class="num">  29.5</td><td class="left">'un_guru'</td></tr>
+     <tr><td class="num">  29.8</td><td class="left">'Little_Mole'</td></tr>
+     <tr><td class="num">  30.3</td><td class="left">'J3FF'</td></tr>
+     <tr><td class="num">  31.0</td><td class="left">'Vinksu'</td></tr>
+     <tr><td class="num">  31.1</td><td class="left">'biotopa'</td></tr>
+     <tr><td class="num">  31.3</td><td class="left">'evane'</td></tr>
+     <tr><td class="num">  31.5</td><td class="left">'oblo'</td></tr>
+     <tr><td class="num">  31.5</td><td class="left">'GiannuzzITA'</td></tr>
+     <tr><td class="num">  32.0</td><td class="left">'redsantz'</td></tr>
+     <tr><td class="num">  33.3</td><td class="left">'geembo_90'</td></tr>
+     <tr><td class="num">  33.3</td><td class="left">'Edgar_Flesk'</td></tr>
+     <tr><td class="num">  33.5</td><td class="left">'Melanie'</td></tr>
+     <tr><td class="num">  33.6</td><td class="left">'NorthForty'</td></tr>
+     <tr><td class="num">  34.0</td><td class="left">'IChrisI'</td></tr>
+     <tr><td class="num">  34.3</td><td class="left">'Gorn'</td></tr>
+     <tr><td class="num">  34.4</td><td class="left">'erich'</td></tr>
+     <tr><td class="num">  37.1</td><td class="left">'niebie'</td></tr>
+     <tr><td class="num">  37.2</td><td class="left">'MicWa'</td></tr>
+     <tr><td class="num">  37.3</td><td class="left">'WP319'</td></tr>
+     <tr><td class="num">  37.7</td><td class="left">'Kosby'</td></tr>
+     <tr><td class="num">  38.4</td><td class="left">'alain'</td></tr>
+     <tr><td class="num">  39.3</td><td class="left">'Liam Sheehan'</td></tr>
+     <tr><td class="num">  39.9</td><td class="left">'Rugby4ever'</td></tr>
+     <tr><td class="num">  40.7</td><td class="left">'WesleyCrusher'</td></tr>
+     <tr><td class="num">  40.8</td><td class="left">'Drotten'</td></tr>
+     <tr><td class="num">  41.2</td><td class="left">'Archcorenth'</td></tr>
+     <tr><td class="num">  41.3</td><td class="left">'Harry Lim'</td></tr>
+     <tr><td class="num">  41.4</td><td class="left">'purplerainbow'</td></tr>
+     <tr><td class="num">  41.7</td><td class="left">'B-man'</td></tr>
+     <tr><td class="num">  42.1</td><td class="left">'Nfol'</td></tr>
+     <tr><td class="num">  42.9</td><td class="left">'Tiger'</td></tr>
+     <tr><td class="num">  43.0</td><td class="left">'gringer'</td></tr>
+     <tr><td class="num">  43.5</td><td class="left">'Vlad'</td></tr>
+     <tr><td class="num">  43.8</td><td class="left">'Snaily'</td></tr>
+     <tr><td class="num">  44.6</td><td class="left">'Momcat'</td></tr>
+     <tr><td class="num">  45.3</td><td class="left">'Breezy'</td></tr>
      <tr><td class="num">  45.6</td><td class="left">'Paulus'</td></tr>
-     <tr><td class="num">  45.9</td><td class="left">'Uli'</td></tr>
-     <tr><td class="num">  46.7</td><td class="left">'Tarim'</td></tr>
-     <tr><td class="num">  47.7</td><td class="left">'IntKecsk'</td></tr>
-     <tr><td class="num">  48.1</td><td class="left">'tjRaven'</td></tr>
-     <tr><td class="num">  48.2</td><td class="left">'Jonyzz'</td></tr>
-     <tr><td class="num">  48.5</td><td class="left">'Valkyrie2'</td></tr>
-     <tr><td class="num">  48.8</td><td class="left">'mhatta'</td></tr>
-     <tr><td class="num">  49.0</td><td class="left">'ntaeijr'</td></tr>
-     <tr><td class="num">  51.0</td><td class="left">'Zak'</td></tr>
-     <tr><td class="num">  51.1</td><td class="left">'rima'</td></tr>
-     <tr><td class="num">  51.2</td><td class="left">'Tomson'</td></tr>
-     <tr><td class="num">  51.2</td><td class="left">'Mecki'</td></tr>
-     <tr><td class="num">  51.4</td><td class="left">'brynn'</td></tr>
-     <tr><td class="num">  51.5</td><td class="left">'Sandra'</td></tr>
-     <tr><td class="num">  51.5</td><td class="left">'Jeffrey S'</td></tr>
-     <tr><td class="num">  52.2</td><td class="left">'jdcampo'</td></tr>
-     <tr><td class="num">  52.6</td><td class="left">'ReasonAnce'</td></tr>
-     <tr><td class="num">  53.1</td><td class="left">'AkRa'</td></tr>
-     <tr><td class="num">  53.9</td><td class="left">'Vaily'</td></tr>
-     <tr><td class="num">  54.0</td><td class="left">'Pascal'</td></tr>
-     <tr><td class="num">  54.1</td><td class="left">'Slav'</td></tr>
-     <tr><td class="num">  54.8</td><td class="left">'Cyphase'</td></tr>
-     <tr><td class="num">  55.3</td><td class="left">'Neophilus'</td></tr>
-     <tr><td class="num">  55.4</td><td class="left">'Turbogurk'</td></tr>
-     <tr><td class="num">  57.0</td><td class="left">'krazy62'</td></tr>
-     <tr><td class="num">  58.2</td><td class="left">'Adonica'</td></tr>
-     <tr><td class="num">  58.6</td><td class="left">'Kadu'</td></tr>
-     <tr><td class="num">  60.2</td><td class="left">'Enrymather'</td></tr>
-     <tr><td class="num">  61.5</td><td class="left">'Sopoforic'</td></tr>
-     <tr><td class="num">  61.8</td><td class="left">'jumbo'</td></tr>
-     <tr><td class="num">  62.5</td><td class="left">'jdrexler'</td></tr>
-     <tr><td class="num">  62.6</td><td class="left">'Jan'</td></tr>
-     <tr><td class="num">  63.2</td><td class="left">'Asbel'</td></tr>
-     <tr><td class="num">  64.9</td><td class="left">'tasker'</td></tr>
-     <tr><td class="num">  65.3</td><td class="left">'Meeve'</td></tr>
-     <tr><td class="num">  67.1</td><td class="left">'ael'</td></tr>
-     <tr><td class="num">  67.7</td><td class="left">'Samuel'</td></tr>
-     <tr><td class="num">  68.0</td><td class="left">'Fred_the_wise'</td></tr>
-     <tr><td class="num">  68.1</td><td class="left">'schmusi20'</td></tr>
-     <tr><td class="num">  68.1</td><td class="left">'Sparkey'</td></tr>
+     <tr><td class="num">  46.0</td><td class="left">'Uli'</td></tr>
+     <tr><td class="num">  46.8</td><td class="left">'Tarim'</td></tr>
+     <tr><td class="num">  47.8</td><td class="left">'IntKecsk'</td></tr>
+     <tr><td class="num">  48.2</td><td class="left">'tjRaven'</td></tr>
+     <tr><td class="num">  48.4</td><td class="left">'Jonyzz'</td></tr>
+     <tr><td class="num">  48.7</td><td class="left">'Valkyrie2'</td></tr>
+     <tr><td class="num">  49.0</td><td class="left">'mhatta'</td></tr>
+     <tr><td class="num">  49.1</td><td class="left">'ntaeijr'</td></tr>
+     <tr><td class="num">  51.1</td><td class="left">'Zak'</td></tr>
+     <tr><td class="num">  51.2</td><td class="left">'rima'</td></tr>
+     <tr><td class="num">  51.3</td><td class="left">'Tomson'</td></tr>
+     <tr><td class="num">  51.4</td><td class="left">'Mecki'</td></tr>
+     <tr><td class="num">  51.5</td><td class="left">'brynn'</td></tr>
+     <tr><td class="num">  51.6</td><td class="left">'Sandra'</td></tr>
+     <tr><td class="num">  51.6</td><td class="left">'Jeffrey S'</td></tr>
+     <tr><td class="num">  52.4</td><td class="left">'jdcampo'</td></tr>
+     <tr><td class="num">  52.8</td><td class="left">'ReasonAnce'</td></tr>
+     <tr><td class="num">  53.4</td><td class="left">'AkRa'</td></tr>
+     <tr><td class="num">  54.0</td><td class="left">'Vaily'</td></tr>
+     <tr><td class="num">  54.2</td><td class="left">'Pascal'</td></tr>
+     <tr><td class="num">  54.3</td><td class="left">'Slav'</td></tr>
+     <tr><td class="num">  55.0</td><td class="left">'Cyphase'</td></tr>
+     <tr><td class="num">  55.4</td><td class="left">'Neophilus'</td></tr>
+     <tr><td class="num">  55.5</td><td class="left">'Turbogurk'</td></tr>
+     <tr><td class="num">  57.1</td><td class="left">'krazy62'</td></tr>
+     <tr><td class="num">  58.3</td><td class="left">'Adonica'</td></tr>
+     <tr><td class="num">  58.8</td><td class="left">'Kadu'</td></tr>
+     <tr><td class="num">  60.3</td><td class="left">'Enrymather'</td></tr>
+     <tr><td class="num">  61.7</td><td class="left">'Sopoforic'</td></tr>
+     <tr><td class="num">  62.0</td><td class="left">'jumbo'</td></tr>
+     <tr><td class="num">  62.7</td><td class="left">'jdrexler'</td></tr>
+     <tr><td class="num">  62.7</td><td class="left">'Jan'</td></tr>
+     <tr><td class="num">  63.4</td><td class="left">'Asbel'</td></tr>
+     <tr><td class="num">  65.0</td><td class="left">'tasker'</td></tr>
+     <tr><td class="num">  65.5</td><td class="left">'Meeve'</td></tr>
+     <tr><td class="num">  67.2</td><td class="left">'ael'</td></tr>
+     <tr><td class="num">  67.9</td><td class="left">'Samuel'</td></tr>
+     <tr><td class="num">  68.2</td><td class="left">'Sparkey'</td></tr>
      <tr><td class="num">  68.3</td><td class="left">'Alf'</td></tr>
-     <tr><td class="num">  69.7</td><td class="left">'Shaez'</td></tr>
+     <tr><td class="num">  68.3</td><td class="left">'schmusi20'</td></tr>
+     <tr><td class="num">  68.3</td><td class="left">'Fred_the_wise'</td></tr>
+     <tr><td class="num">  69.9</td><td class="left">'Shaez'</td></tr>
      <tr><td class="num">  70.1</td><td class="left">'Magnus and Susi'</td></tr>
-     <tr><td class="num">  70.8</td><td class="left">'Zhura'</td></tr>
-     <tr><td class="num">  71.6</td><td class="left">'xmouse'</td></tr>
+     <tr><td class="num">  70.9</td><td class="left">'Zhura'</td></tr>
+     <tr><td class="num">  71.7</td><td class="left">'xmouse'</td></tr>
      <tr><td class="num">  72.9</td><td class="left">'Joona'</td></tr>
-     <tr><td class="num">  73.0</td><td class="left">'AQZ'</td></tr>
-     <tr><td class="num">  74.7</td><td class="left">'crypto_rsa'</td></tr>
-     <tr><td class="num">  74.8</td><td class="left">'Dvorhagen'</td></tr>
-     <tr><td class="num">  75.6</td><td class="left">'Eselchen'</td></tr>
-     <tr><td class="num">  75.9</td><td class="left">'Nicol?s'</td></tr>
-     <tr><td class="num">  75.9</td><td class="left">'AsuCaga'</td></tr>
-     <tr><td class="num">  76.0</td><td class="left">'jojo'</td></tr>
-     <tr><td class="num">  79.1</td><td class="left">'colonel crayon'</td></tr>
-     <tr><td class="num">  79.9</td><td class="left">'Kroetchen'</td></tr>
-     <tr><td class="num">  80.8</td><td class="left">'Agares'</td></tr>
+     <tr><td class="num">  73.2</td><td class="left">'AQZ'</td></tr>
+     <tr><td class="num">  74.8</td><td class="left">'crypto_rsa'</td></tr>
+     <tr><td class="num">  74.9</td><td class="left">'Dvorhagen'</td></tr>
+     <tr><td class="num">  75.7</td><td class="left">'Eselchen'</td></tr>
+     <tr><td class="num">  76.1</td><td class="left">'AsuCaga'</td></tr>
+     <tr><td class="num">  76.2</td><td class="left">'Nicol?s'</td></tr>
+     <tr><td class="num">  76.2</td><td class="left">'jojo'</td></tr>
+     <tr><td class="num">  79.2</td><td class="left">'colonel crayon'</td></tr>
+     <tr><td class="num">  80.0</td><td class="left">'Kroetchen'</td></tr>
+     <tr><td class="num">  80.9</td><td class="left">'Agares'</td></tr>
      <tr><td class="num">  81.9</td><td class="left">'IIkka'</td></tr>
-     <tr><td class="num">  85.6</td><td class="left">'Miel56'</td></tr>
+     <tr><td class="num">  85.7</td><td class="left">'Miel56'</td></tr>
      <tr><td class="num">  90.2</td><td class="left">'The red O'</td></tr>
      <tr><td class="num">  90.7</td><td class="left">'Sequoyah'</td></tr>
-     <tr><td class="num">  92.6</td><td class="left">'Michael'</td></tr>
+     <tr><td class="num">  92.8</td><td class="left">'Michael'</td></tr>
   </table>

Modified: homepage/input/table-rat.html
===================================================================
--- homepage/input/table-rat.html	2009-09-07 23:09:00 UTC (rev 1798)
+++ homepage/input/table-rat.html	2009-09-08 21:04:14 UTC (rev 1799)
@@ -1,5 +1,5 @@
   <table>
-    <caption>$$Rating_Statistics$$ $$July$$ 2009</caption>
+    <caption>$$Rating_Statistics$$ $$August$$ 2009</caption>
     <colgroup><col width="80"><col width="80"><col width="220"></colgroup>
     <tr><th>$$count$$</th><th>$$average$$</th><th class="left">$$user$$</th></tr>    <tr><td class="num">1062</td><td class="num"> 5.06</td><td class="left">'ryujun'</td></tr>
     <tr><td class="num">1056</td><td class="num"> 4.83</td><td class="left">'Taztunes'</td></tr>
@@ -13,7 +13,7 @@
     <tr><td class="num">622</td><td class="num"> 4.22</td><td class="left">'shoki'</td></tr>
     <tr><td class="num">604</td><td class="num"> 5.31</td><td class="left">'Mentist'</td></tr>
     <tr><td class="num">573</td><td class="num"> 5.16</td><td class="left">'dpl'</td></tr>
-    <tr><td class="num">562</td><td class="num"> 4.48</td><td class="left">'Alexandros'</td></tr>
+    <tr><td class="num">570</td><td class="num"> 4.51</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num">534</td><td class="num"> 4.97</td><td class="left">'B-Huff'</td></tr>
     <tr><td class="num">512</td><td class="num"> 5.05</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num">511</td><td class="num"> 5.05</td><td class="left">'Tiza'</td></tr>
@@ -72,13 +72,13 @@
     <tr><td class="num">  8</td><td class="num"> 7.63</td><td class="left">'Antonio EE'</td></tr>
     <tr><td class="num">  7</td><td class="num"> 4.29</td><td class="left">'Snaily'</td></tr>
     <tr><td class="num">  7</td><td class="num"> 5.29</td><td class="left">'oxyd4ever'</td></tr>
+    <tr><td class="num">  6</td><td class="num"> 5.17</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num">  5</td><td class="num"> 6.80</td><td class="left">'Breezy'</td></tr>
     <tr><td class="num">  5</td><td class="num"> 9.20</td><td class="left">'HuB34'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 6.75</td><td class="left">'Agares'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 2.00</td><td class="left">'casmith_789'</td></tr>
     <tr><td class="num">  4</td><td class="num">10.00</td><td class="left">'Kevin'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 5.75</td><td class="left">'joseba'</td></tr>
-    <tr><td class="num">  4</td><td class="num"> 5.75</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 1.00</td><td class="left">'Hans-HD'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 6.50</td><td class="left">'serpent'</td></tr>
     <tr><td class="num">  4</td><td class="num"> 7.00</td><td class="left">'redsantz'</td></tr>

Modified: homepage/input/table-solved.html
===================================================================
--- homepage/input/table-solved.html	2009-09-07 23:09:00 UTC (rev 1798)
+++ homepage/input/table-solved.html	2009-09-08 21:04:14 UTC (rev 1799)
@@ -1,5 +1,5 @@
   <table>
-    <caption>$$Solved_Level_Statistics$$ $$July$$ 2009</caption>
+    <caption>$$Solved_Level_Statistics$$ $$August$$ 2009</caption>
     <colgroup><col width="130"><col width="130"><col width="130"><col width="240"></colgroup>
     <tr><th>$$difficult$$</th><th>$$easy$$</th><th>$$total$$</th><th class="left">$$user$$</th></tr>
     <tr><td class="num">1045/1045</td><td class="num">189/189</td><td class="num">100.00%</td><td class="left">'ryujun'</td></tr>
@@ -16,7 +16,7 @@
     <tr><td class="num">1014/1045</td><td class="num">175/189</td><td class="num"> 96.35%</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num"> 999/1045</td><td class="num">177/189</td><td class="num"> 95.30%</td><td class="left">'biotopa'</td></tr>
     <tr><td class="num"> 989/1045</td><td class="num">176/189</td><td class="num"> 94.41%</td><td class="left">'Daisy'</td></tr>
-    <tr><td class="num"> 969/1045</td><td class="num">167/189</td><td class="num"> 92.06%</td><td class="left">'H-J.Epting'</td></tr>
+    <tr><td class="num"> 973/1045</td><td class="num">168/189</td><td class="num"> 92.46%</td><td class="left">'H-J.Epting'</td></tr>
     <tr><td class="num"> 970/1045</td><td class="num">166/189</td><td class="num"> 92.06%</td><td class="left">'Andy'</td></tr>
     <tr><td class="num"> 962/1045</td><td class="num">173/189</td><td class="num"> 91.98%</td><td class="left">'mecke'</td></tr>
     <tr><td class="num"> 949/1045</td><td class="num">170/189</td><td class="num"> 90.68%</td><td class="left">'para_doks'</td></tr>
@@ -46,12 +46,13 @@
     <tr><td class="num"> 734/1045</td><td class="num">108/189</td><td class="num"> 68.23%</td><td class="left">'Another'</td></tr>
     <tr><td class="num"> 762/1045</td><td class="num"> 73/189</td><td class="num"> 67.67%</td><td class="left">'redsantz'</td></tr>
     <tr><td class="num"> 791/1045</td><td class="num"> 38/189</td><td class="num"> 67.18%</td><td class="left">'alfred69'</td></tr>
+    <tr><td class="num"> 694/1045</td><td class="num">133/189</td><td class="num"> 67.02%</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 734/1045</td><td class="num"> 82/189</td><td class="num"> 66.13%</td><td class="left">'bojster'</td></tr>
     <tr><td class="num"> 782/1045</td><td class="num"> 33/189</td><td class="num"> 66.05%</td><td class="left">'Sim_Ed'</td></tr>
-    <tr><td class="num"> 680/1045</td><td class="num">130/189</td><td class="num"> 65.64%</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 651/1045</td><td class="num">111/189</td><td class="num"> 61.75%</td><td class="left">'Raoul'</td></tr>
     <tr><td class="num"> 650/1045</td><td class="num">110/189</td><td class="num"> 61.59%</td><td class="left">'Ghatotkacha'</td></tr>
     <tr><td class="num"> 681/1045</td><td class="num"> 78/189</td><td class="num"> 61.51%</td><td class="left">'HuB34'</td></tr>
+    <tr><td class="num"> 627/1045</td><td class="num">128/189</td><td class="num"> 61.18%</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 659/1045</td><td class="num"> 95/189</td><td class="num"> 61.10%</td><td class="left">'Marc-Hendrik'</td></tr>
     <tr><td class="num"> 654/1045</td><td class="num"> 99/189</td><td class="num"> 61.02%</td><td class="left">'Tiza'</td></tr>
     <tr><td class="num"> 665/1045</td><td class="num"> 64/189</td><td class="num"> 59.08%</td><td class="left">'alain'</td></tr>
@@ -62,17 +63,16 @@
     <tr><td class="num"> 636/1045</td><td class="num"> 55/189</td><td class="num"> 56.00%</td><td class="left">'fabian'</td></tr>
     <tr><td class="num"> 575/1045</td><td class="num">115/189</td><td class="num"> 55.92%</td><td class="left">'Mark P.'</td></tr>
     <tr><td class="num"> 647/1045</td><td class="num"> 38/189</td><td class="num"> 55.51%</td><td class="left">'Valkyrie2'</td></tr>
+    <tr><td class="num"> 569/1045</td><td class="num">111/189</td><td class="num"> 55.11%</td><td class="left">'oxyd4ever'</td></tr>
     <tr><td class="num"> 599/1045</td><td class="num"> 80/189</td><td class="num"> 55.02%</td><td class="left">'serpent'</td></tr>
     <tr><td class="num"> 577/1045</td><td class="num">100/189</td><td class="num"> 54.86%</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 634/1045</td><td class="num"> 43/189</td><td class="num"> 54.86%</td><td class="left">'Klaus'</td></tr>
-    <tr><td class="num"> 561/1045</td><td class="num">110/189</td><td class="num"> 54.38%</td><td class="left">'oxyd4ever'</td></tr>
     <tr><td class="num"> 576/1045</td><td class="num"> 93/189</td><td class="num"> 54.21%</td><td class="left">'Guglielmo'</td></tr>
     <tr><td class="num"> 525/1045</td><td class="num"> 95/189</td><td class="num"> 50.24%</td><td class="left">'ShadowPhrogg32642342'</td></tr>
     <tr><td class="num"> 589/1045</td><td class="num"> 26/189</td><td class="num"> 49.84%</td><td class="left">'hdwow'</td></tr>
     <tr><td class="num"> 533/1045</td><td class="num"> 82/189</td><td class="num"> 49.84%</td><td class="left">'Wuzzy'</td></tr>
     <tr><td class="num"> 506/1045</td><td class="num">108/189</td><td class="num"> 49.76%</td><td class="left">'Agnieszka'</td></tr>
     <tr><td class="num"> 613/1045</td><td class="num">  0/189</td><td class="num"> 49.68%</td><td class="left">'Little_Mole'</td></tr>
-    <tr><td class="num"> 499/1045</td><td class="num">111/189</td><td class="num"> 49.43%</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 500/1045</td><td class="num"> 92/189</td><td class="num"> 47.97%</td><td class="left">'Kosby'</td></tr>
     <tr><td class="num"> 522/1045</td><td class="num"> 66/189</td><td class="num"> 47.65%</td><td class="left">'Timo'</td></tr>
     <tr><td class="num"> 478/1045</td><td class="num">101/189</td><td class="num"> 46.92%</td><td class="left">'Austin'</td></tr>

Modified: homepage/input/table-wr.html
===================================================================
--- homepage/input/table-wr.html	2009-09-07 23:09:00 UTC (rev 1798)
+++ homepage/input/table-wr.html	2009-09-08 21:04:14 UTC (rev 1799)
@@ -1,27 +1,27 @@
   <table>
-    <caption>$$Worldrecord_Statistics$$ $$July$$ 2009</caption>
+    <caption>$$Worldrecord_Statistics$$ $$August$$ 2009</caption>
     <colgroup><col width="80"><col width="80"><col width="470"></colgroup>
     <tr><th>$$total$$</th><th>$$shared$$</th><th class="left">$$user$$</th></tr>
-    <tr><td class="num">894</td><td class="num">251</td><td class="left">'Moneymaker'</td></tr>
-    <tr><td class="num">365</td><td class="num">175</td><td class="left">'Medimaster'</td></tr>
+    <tr><td class="num">884</td><td class="num">249</td><td class="left">'Moneymaker'</td></tr>
+    <tr><td class="num">364</td><td class="num">174</td><td class="left">'Medimaster'</td></tr>
     <tr><td class="num">140</td><td class="num">112</td><td class="left">'daydreamer'</td></tr>
     <tr><td class="num">119</td><td class="num">117</td><td class="left">'Crystalicum'</td></tr>
-    <tr><td class="num">101</td><td class="num"> 68</td><td class="left">'Stupid'</td></tr>
+    <tr><td class="num">100</td><td class="num"> 67</td><td class="left">'Stupid'</td></tr>
     <tr><td class="num"> 71</td><td class="num"> 66</td><td class="left">'Johannes'</td></tr>
     <tr><td class="num"> 59</td><td class="num"> 54</td><td class="left">'dev0'</td></tr>
     <tr><td class="num"> 59</td><td class="num"> 58</td><td class="left">'Mentist'</td></tr>
-    <tr><td class="num"> 48</td><td class="num"> 41</td><td class="left">'Daisy'</td></tr>
-    <tr><td class="num"> 31</td><td class="num"> 22</td><td class="left">'Malla'</td></tr>
+    <tr><td class="num"> 50</td><td class="num"> 41</td><td class="left">'Daisy'</td></tr>
+    <tr><td class="num"> 34</td><td class="num"> 30</td><td class="left">'Alexandros'</td></tr>
+    <tr><td class="num"> 32</td><td class="num"> 23</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 31</td><td class="num"> 26</td><td class="left">'Duffy'</td></tr>
+    <tr><td class="num"> 30</td><td class="num"> 22</td><td class="left">'Malla'</td></tr>
     <tr><td class="num"> 29</td><td class="num"> 28</td><td class="left">'Ghatotkacha'</td></tr>
-    <tr><td class="num"> 23</td><td class="num"> 21</td><td class="left">'Alexandros'</td></tr>
     <tr><td class="num"> 23</td><td class="num"> 23</td><td class="left">'Great Scott'</td></tr>
     <tr><td class="num"> 22</td><td class="num"> 20</td><td class="left">'Zekobah'</td></tr>
     <tr><td class="num"> 22</td><td class="num"> 21</td><td class="left">'Angolino'</td></tr>
     <tr><td class="num"> 21</td><td class="num"> 21</td><td class="left">'joseba' + 'Iceshark7'</td></tr>
     <tr><td class="num"> 20</td><td class="num"> 19</td><td class="left">'Django'</td></tr>
     <tr><td class="num"> 18</td><td class="num"> 18</td><td class="left">'ryujun'</td></tr>
-    <tr><td class="num"> 15</td><td class="num"> 13</td><td class="left">'Emmanuel'</td></tr>
     <tr><td class="num"> 14</td><td class="num"> 14</td><td class="left">'ged'</td></tr>
     <tr><td class="num"> 13</td><td class="num">  9</td><td class="left">'Ronald'</td></tr>
     <tr><td class="num"> 13</td><td class="num"> 12</td><td class="left">'HuB34'</td></tr>



From ral at mail.berlios.de  Wed Sep  9 00:05:35 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 9 Sep 2009 00:05:35 +0200
Subject: [Enigma-game-svn] r1800 - trunk/src
Message-ID: <200909082205.n88M5ZSL012196@sheep.berlios.de>

Author: ral
Date: 2009-09-09 00:05:34 +0200 (Wed, 09 Sep 2009)
New Revision: 1800

Modified:
   trunk/src/AttributeDescriptor.cc
Log:
Trunk 1.1: 
- attribute validation:
  - add support for string type "cluster" attributes
  - add support for int type attributes with autotiling string value "%%"


Modified: trunk/src/AttributeDescriptor.cc
===================================================================
--- trunk/src/AttributeDescriptor.cc	2009-09-08 21:04:14 UTC (rev 1799)
+++ trunk/src/AttributeDescriptor.cc	2009-09-08 22:05:34 UTC (rev 1800)
@@ -55,26 +55,31 @@
     }
     
     ValidationResult AttributeDescriptor::checkValue(Value val) {
+        Value::Type vt = val.getType();
         switch (type) {
             case VAL_BOOL :
-                return val.getType() == Value::BOOL ? VALID_OK : VALID_TYPE_MISMATCH;
+                return vt == Value::BOOL ? VALID_OK : VALID_TYPE_MISMATCH;
                 break;
-            case VAL_INT :
-                // TBD add int, min, max check
-                if (name != "code")
-                    return val.getType() == Value::DOUBLE  ? VALID_OK : VALID_TYPE_MISMATCH;
-                else
-                    return (val.getType() == Value::DOUBLE || val.getType() == Value::STRING)  ? 
-                            VALID_OK : VALID_TYPE_MISMATCH;                    
-                break;
+            case VAL_INT : {
+                bool isNumber = (vt == Value::DOUBLE);
+                if (!isNumber && vt == Value::STRING) {
+                    if (name == "code" || name == "cluster")    // these attributes accept all strings
+                        return VALID_OK;
+                    std::string str = value.to_string();
+                    if (str[0] == '%')
+                        isNumber = true;
+                }
+                double d = val;
+                // TBD add int, min, max check                
+                return isNumber ? VALID_OK : VALID_TYPE_MISMATCH;
+            }
             case VAL_DOUBLE :
-                return val.getType() == Value::DOUBLE  ? VALID_OK : VALID_TYPE_MISMATCH;
+                return vt == Value::DOUBLE  ? VALID_OK : VALID_TYPE_MISMATCH;
                 break;
             case VAL_STRING :
-                return val.getType() == Value::STRING  ? VALID_OK : VALID_TYPE_MISMATCH;
+                return vt == Value::STRING  ? VALID_OK : VALID_TYPE_MISMATCH;
                 break;
             case VAL_TOKENS : {
-                Value::Type vt = val.getType();
                 bool result = (vt == Value::STRING || vt == Value::TOKENS || vt == Value::OBJECT || vt == Value::GROUP);
                 if (name == "destination")
                     return (result || vt == Value::POSITION)  ? VALID_OK : VALID_TYPE_MISMATCH;



From ral at mail.berlios.de  Wed Sep  9 00:26:00 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 9 Sep 2009 00:26:00 +0200
Subject: [Enigma-game-svn] r1801 - trunk/src
Message-ID: <200909082226.n88MQ00J014421@sheep.berlios.de>

Author: ral
Date: 2009-09-09 00:25:59 +0200 (Wed, 09 Sep 2009)
New Revision: 1801

Modified:
   trunk/src/player.cc
Log:
Trunk 1.1: 
- fix number of extralifes on ProvideExtralifes and ConserveLevel both being
    false valued

Modified: trunk/src/player.cc
===================================================================
--- trunk/src/player.cc	2009-09-08 22:05:34 UTC (rev 1800)
+++ trunk/src/player.cc	2009-09-08 22:25:59 UTC (rev 1801)
@@ -164,13 +164,16 @@
     // calculate number of extralives
     for (int i=0; i<nplayers; ++i) {
         if (server::IsLevelRestart) {
-            // count existing number of extralives
-            int idxLife = -1;
-            extralives[i] = -1;
-            do {
-                ++extralives[i];
-                idxLife = players[i].inventory.find("it_extralife", ++idxLife);
-            } while (idxLife != -1);
+            if (server::ProvideExtralifes) {
+                // count existing number of extralives
+                int idxLife = -1;
+                extralives[i] = -1;
+                do {
+                    ++extralives[i];
+                    idxLife = players[i].inventory.find("it_extralife", ++idxLife);
+                } while (idxLife != -1);
+            } else 
+                extralives[i] = 0;
         } else {
             // new game provides 2 extralives
             extralives[i] = (server::ProvideExtralifes) ? 2 : 0;



From raoulb at bluewin.ch  Wed Sep  9 02:11:37 2009
From: raoulb at bluewin.ch (Raoul)
Date: Wed, 9 Sep 2009 02:11:37 +0200
Subject: [Enigma-game-svn] r1802
Message-ID: <20090909021137.3a7018f2@loipc.loinet.home>

-> Fixed type validator level load errors, part I
--> Some rewrites to new API
--> Many just in place old API fixes


From ral at mail.berlios.de  Thu Sep 10 00:10:37 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Thu, 10 Sep 2009 00:10:37 +0200
Subject: [Enigma-game-svn] r1803 - in trunk: data src
Message-ID: <200909092210.n89MAb04014499@sheep.berlios.de>

Author: ral
Date: 2009-09-10 00:10:36 +0200 (Thu, 10 Sep 2009)
New Revision: 1803

Modified:
   trunk/data/api1init.lua
   trunk/data/startup.lua
   trunk/src/AttributeDescriptor.cc
   trunk/src/enigma-lua.pkg
   trunk/src/lua-display.cc
   trunk/src/lua-display.hh
   trunk/src/lua-ecl.cc
   trunk/src/lua-ecl.hh
   trunk/src/lua-editor.cc
   trunk/src/lua-editor.hh
   trunk/src/lua-enigma.cc
   trunk/src/lua-enigma.hh
   trunk/src/lua-global.cc
   trunk/src/lua-global.hh
   trunk/src/lua.cc
   trunk/src/world.cc
Log:
Trunk 1.1: 
- remove DefineSimpleFloor from Lua API
- fix attribute "loop" mapping old API to new API
- fix exception handling on set of new objects
    - exception on attribute set caused objects to be lost on stack
    - st_oxyd did not dispose and deregister from instance vector causing
      strange behaviour on subsequent loaded levels
- fix support for int type attributes with autotiling string value "%%"


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/data/api1init.lua	2009-09-09 22:10:36 UTC (rev 1803)
@@ -893,6 +893,9 @@
      if key == "invisible" then
          if val == 1 then _val = true else _val = false end
      end
+     if key == "loop" then
+         if val == 1 then _val = true else _val = false end
+     end
      if key == "orientation" and _obj_name == "st-mirror" then
          _val = (6 - val) % 4
      end

Modified: trunk/data/startup.lua
===================================================================
--- trunk/data/startup.lua	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/data/startup.lua	2009-09-09 22:10:36 UTC (rev 1803)
@@ -93,29 +93,4 @@
     dofile(filename)
 end
 
-------------------------------
--- Define the simple stones --
-------------------------------
-function def_stone(name, sound)
-    world.DefineSimpleStone(name,sound or "stone",0,0)
-end
-function def_stone_hollow(name)
-    world.DefineSimpleStone(name,"",1,0)
-end
-function def_stone_movable(name, sound)
-    world.DefineSimpleStoneMovable(name,sound or "stone",0)
-end
 
-
-------------------------------
--- Define the simple floors --
-------------------------------
-function def_floor(name, frict, mfactor, burnable, firetransform, frames)
-    world.DefineSimpleFloor(name, frict, mfactor, burnable, firetransform)
-    if frames then
-        world.DefineSimpleFloor(name.."_framed", frict, mfactor, burnable, firetransform)    
-    end
-end
-
--- Floor(kind, friction, adhesion, burnable, firetransform, frames)
-

Modified: trunk/src/AttributeDescriptor.cc
===================================================================
--- trunk/src/AttributeDescriptor.cc	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/AttributeDescriptor.cc	2009-09-09 22:10:36 UTC (rev 1803)
@@ -65,7 +65,7 @@
                 if (!isNumber && vt == Value::STRING) {
                     if (name == "code" || name == "cluster")    // these attributes accept all strings
                         return VALID_OK;
-                    std::string str = value.to_string();
+                    std::string str = val.to_string();
                     if (str[0] == '%')
                         isNumber = true;
                 }

Modified: trunk/src/enigma-lua.pkg
===================================================================
--- trunk/src/enigma-lua.pkg	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/enigma-lua.pkg	2009-09-09 22:10:36 UTC (rev 1803)
@@ -92,8 +92,6 @@
     Object *GetNamedObject(const char *name);
 
     void Resize(int w, int h);
-    void DefineSimpleFloor(const char *kind, double friction, double mousefactor,
-                           bool burnable, const char *firetransform);
 }
 
 /* -------------------- video.cc -------------------- */

Modified: trunk/src/lua-display.cc
===================================================================
--- trunk/src/lua-display.cc	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/lua-display.cc	2009-09-09 22:10:36 UTC (rev 1803)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: display
-** Generated automatically by tolua++-1.0.92 on Tue Jan 20 20:18:15 2009.
+** Generated automatically by tolua++-1.0.93 on Wed Sep  9 01:10:11 2009.
 */
 
 #ifndef __cplusplus

Modified: trunk/src/lua-display.hh
===================================================================
--- trunk/src/lua-display.hh	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/lua-display.hh	2009-09-09 22:10:36 UTC (rev 1803)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: display
-** Generated automatically by tolua++-1.0.92 on Tue Jan 20 20:18:15 2009.
+** Generated automatically by tolua++-1.0.93 on Wed Sep  9 01:10:11 2009.
 */
 
 /* Exported function */

Modified: trunk/src/lua-ecl.cc
===================================================================
--- trunk/src/lua-ecl.cc	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/lua-ecl.cc	2009-09-09 22:10:36 UTC (rev 1803)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: px
-** Generated automatically by tolua++-1.0.92 on Tue Jan 20 20:18:15 2009.
+** Generated automatically by tolua++-1.0.93 on Wed Sep  9 01:10:11 2009.
 */
 
 #ifndef __cplusplus

Modified: trunk/src/lua-ecl.hh
===================================================================
--- trunk/src/lua-ecl.hh	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/lua-ecl.hh	2009-09-09 22:10:36 UTC (rev 1803)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: px
-** Generated automatically by tolua++-1.0.92 on Tue Jan 20 20:18:15 2009.
+** Generated automatically by tolua++-1.0.93 on Wed Sep  9 01:10:11 2009.
 */
 
 /* Exported function */

Modified: trunk/src/lua-editor.cc
===================================================================
--- trunk/src/lua-editor.cc	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/lua-editor.cc	2009-09-09 22:10:36 UTC (rev 1803)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: editor
-** Generated automatically by tolua++-1.0.92 on Tue Jan 20 20:18:15 2009.
+** Generated automatically by tolua++-1.0.93 on Wed Sep  9 01:10:11 2009.
 */
 
 #ifndef __cplusplus

Modified: trunk/src/lua-editor.hh
===================================================================
--- trunk/src/lua-editor.hh	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/lua-editor.hh	2009-09-09 22:10:36 UTC (rev 1803)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: editor
-** Generated automatically by tolua++-1.0.92 on Tue Jan 20 20:18:15 2009.
+** Generated automatically by tolua++-1.0.93 on Wed Sep  9 01:10:11 2009.
 */
 
 /* Exported function */

Modified: trunk/src/lua-enigma.cc
===================================================================
--- trunk/src/lua-enigma.cc	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/lua-enigma.cc	2009-09-09 22:10:36 UTC (rev 1803)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: enigma
-** Generated automatically by tolua++-1.0.92 on Tue Jan 20 20:18:15 2009.
+** Generated automatically by tolua++-1.0.93 on Wed Sep  9 01:10:11 2009.
 */
 
 #ifndef __cplusplus
@@ -930,42 +930,6 @@
 }
 #endif //#ifndef TOLUA_DISABLE
 
-/* function: DefineSimpleFloor */
-#ifndef TOLUA_DISABLE_tolua_enigma_world_DefineSimpleFloor00
-static int tolua_enigma_world_DefineSimpleFloor00(lua_State* tolua_S)
-{
-#ifndef TOLUA_RELEASE
- tolua_Error tolua_err;
- if (
-     !tolua_isstring(tolua_S,1,0,&tolua_err) ||
-     !tolua_isnumber(tolua_S,2,0,&tolua_err) ||
-     !tolua_isnumber(tolua_S,3,0,&tolua_err) ||
-     !tolua_isboolean(tolua_S,4,0,&tolua_err) ||
-     !tolua_isstring(tolua_S,5,0,&tolua_err) ||
-     !tolua_isnoobj(tolua_S,6,&tolua_err)
- )
-  goto tolua_lerror;
- else
-#endif
- {
-  const char* kind = ((const char*)  tolua_tostring(tolua_S,1,0));
-  double friction = ((double)  tolua_tonumber(tolua_S,2,0));
-  double mousefactor = ((double)  tolua_tonumber(tolua_S,3,0));
-  bool burnable = ((bool)  tolua_toboolean(tolua_S,4,0));
-  const char* firetransform = ((const char*)  tolua_tostring(tolua_S,5,0));
-  {
-   DefineSimpleFloor(kind,friction,mousefactor,burnable,firetransform);
-  }
- }
- return 0;
-#ifndef TOLUA_RELEASE
- tolua_lerror:
- tolua_error(tolua_S,"#ferror in function 'DefineSimpleFloor'.",&tolua_err);
- return 0;
-#endif
-}
-#endif //#ifndef TOLUA_DISABLE
-
 /* function: GetScreen */
 #ifndef TOLUA_DISABLE_tolua_enigma_video_GetScreen00
 static int tolua_enigma_video_GetScreen00(lua_State* tolua_S)
@@ -1191,7 +1155,6 @@
    tolua_function(tolua_S,"MakeStone",tolua_enigma_world_MakeStone00);
    tolua_function(tolua_S,"GetNamedObject",tolua_enigma_world_GetNamedObject00);
    tolua_function(tolua_S,"Resize",tolua_enigma_world_Resize00);
-   tolua_function(tolua_S,"DefineSimpleFloor",tolua_enigma_world_DefineSimpleFloor00);
   tolua_endmodule(tolua_S);
   tolua_module(tolua_S,"video",0);
   tolua_beginmodule(tolua_S,"video");

Modified: trunk/src/lua-enigma.hh
===================================================================
--- trunk/src/lua-enigma.hh	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/lua-enigma.hh	2009-09-09 22:10:36 UTC (rev 1803)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: enigma
-** Generated automatically by tolua++-1.0.92 on Tue Jan 20 20:18:15 2009.
+** Generated automatically by tolua++-1.0.93 on Wed Sep  9 01:10:11 2009.
 */
 
 /* Exported function */

Modified: trunk/src/lua-global.cc
===================================================================
--- trunk/src/lua-global.cc	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/lua-global.cc	2009-09-09 22:10:36 UTC (rev 1803)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: global
-** Generated automatically by tolua++-1.0.92 on Tue Jan 20 20:18:15 2009.
+** Generated automatically by tolua++-1.0.93 on Wed Sep  9 01:10:11 2009.
 */
 
 #ifndef __cplusplus

Modified: trunk/src/lua-global.hh
===================================================================
--- trunk/src/lua-global.hh	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/lua-global.hh	2009-09-09 22:10:36 UTC (rev 1803)
@@ -1,6 +1,6 @@
 /*
 ** Lua binding: global
-** Generated automatically by tolua++-1.0.92 on Tue Jan 20 20:18:15 2009.
+** Generated automatically by tolua++-1.0.93 on Wed Sep  9 01:10:11 2009.
 */
 
 /* Exported function */

Modified: trunk/src/lua.cc
===================================================================
--- trunk/src/lua.cc	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/lua.cc	2009-09-09 22:10:36 UTC (rev 1803)
@@ -1318,15 +1318,7 @@
          lua_pushvalue(L, -2); // a copy of key for work
          if (!lua_isnumber(L, -1) && lua_isstring(L, -1)) {
             std::string key = lua_tostring(L, -1);
-            try {
-                obj->setAttrChecked(key, to_value(L, -2));  // name set gets handeled by Object
-            }  
-            catch (const XLevelRuntime &e) {
-                throwLuaError (L, e.what());
-            }
-            catch (...) {
-                throwLuaError (L, "uncaught exception");
-            }
+            obj->setAttrChecked(key, to_value(L, -2));  // name set gets handeled by Object
          } else if (lua_tointeger(L, -1) == 2) {  // second entry without a string key is taken as name
              if (!lua_isnumber(L, -2) && lua_isstring(L, -2))
                  obj->setAttrChecked("name", lua_tostring(L, -2));
@@ -2263,7 +2255,16 @@
         return 0;
     }
     lua_pop(L, 1);   // object type
-    setObjectAttributes(obj, L);
+    try {
+        setObjectAttributes(obj, L);
+    } catch (const XLevelRuntime &e) {
+        DisposeObject(obj);  // obj not yet part of world - essential for OxydStone
+        throwLuaError (L, e.what());
+    } catch (...) {
+        DisposeObject(obj);
+        throwLuaError (L, "uncaught exception");
+    }
+    
     if (itemHolder != NULL) {
         if (obj->getObjectType() != Object::ITEM) {
             DisposeObject(obj);

Modified: trunk/src/world.cc
===================================================================
--- trunk/src/world.cc	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/src/world.cc	2009-09-09 22:10:36 UTC (rev 1803)
@@ -2509,15 +2509,6 @@
     repos->add_templ(kind, obj);
 }
 
-
-//void RegisterActor (Actor *actor) 
-//{
-//    Register(static_cast<Object*>(actor));
-//    ActorID id = get_id(actor);
-//    ASSERT (id != ac_INVALID, XLevelRuntime,
-//        "RegisterActor: trying to register with invalid ID");
-//}
-
 void Repos_Shutdown() {
     delete repos;
 }
@@ -2570,13 +2561,6 @@
     }
 }
 
-void DefineSimpleFloor(const std::string &kind, double friction,
-                              double mousefactor, bool burnable,
-                              const std::string &firetransform)
-{
-    // TBD
-}
-
 void DumpObjectInfo() {
     repos->dump_info();
 }



From raoul at mail.berlios.de  Thu Sep 10 01:33:08 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Thu, 10 Sep 2009 01:33:08 +0200
Subject: [Enigma-game-svn] r1804 - in trunk/data/levels: enigma_cross
	enigma_i enigma_ii enigma_iii enigma_iv enigma_ix enigma_v
	enigma_vi enigma_vii enigma_viii
Message-ID: <200909092333.n89NX8cO000987@sheep.berlios.de>

Author: raoul
Date: 2009-09-10 01:32:58 +0200 (Thu, 10 Sep 2009)
New Revision: 1804

Added:
   trunk/data/levels/enigma_ii/capkoh02_2.xml
   trunk/data/levels/enigma_ii/duffy120_3.xml
   trunk/data/levels/enigma_ii/luc18_2.xml
   trunk/data/levels/enigma_ii/luc26_2.xml
   trunk/data/levels/enigma_iii/luc27_2.xml
   trunk/data/levels/enigma_v/luc21_2.xml
   trunk/data/levels/enigma_vii/just26_2.xml
Removed:
   trunk/data/levels/enigma_ii/capkoh02_1.xml
   trunk/data/levels/enigma_ii/duffy120_2.xml
   trunk/data/levels/enigma_ii/luc18_1.xml
   trunk/data/levels/enigma_ii/luc26_1.xml
   trunk/data/levels/enigma_iii/luc27_1.xml
   trunk/data/levels/enigma_v/luc21_1.xml
   trunk/data/levels/enigma_vii/just26_1.xml
Modified:
   trunk/data/levels/enigma_cross/enigma0_92_2.xml
   trunk/data/levels/enigma_cross/enigma0_92_3.xml
   trunk/data/levels/enigma_cross/newlevels.xml
   trunk/data/levels/enigma_cross/newlevels_1.0.1.xml
   trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
   trunk/data/levels/enigma_i/duffy19_1.xml
   trunk/data/levels/enigma_i/index.xml
   trunk/data/levels/enigma_i/jc01_2.xml
   trunk/data/levels/enigma_ii/duffy118_1.xml
   trunk/data/levels/enigma_ii/duffy128_1.xml
   trunk/data/levels/enigma_ii/illmind04_1.xml
   trunk/data/levels/enigma_ii/illmind05_1.xml
   trunk/data/levels/enigma_ii/index.xml
   trunk/data/levels/enigma_iii/duffy29_1.xml
   trunk/data/levels/enigma_iii/duffy66_1.xml
   trunk/data/levels/enigma_iii/duffy69_1.xml
   trunk/data/levels/enigma_iii/index.xml
   trunk/data/levels/enigma_iv/index.xml
   trunk/data/levels/enigma_iv/ss09_2.xml
   trunk/data/levels/enigma_ix/devnull10_1.xml
   trunk/data/levels/enigma_ix/index.xml
   trunk/data/levels/enigma_ix/pulley17_2.xml
   trunk/data/levels/enigma_v/duffy71_2.xml
   trunk/data/levels/enigma_v/index.xml
   trunk/data/levels/enigma_vi/cel1_1.xml
   trunk/data/levels/enigma_vi/duffy116_1.xml
   trunk/data/levels/enigma_vi/duffy144_1.xml
   trunk/data/levels/enigma_vi/index.xml
   trunk/data/levels/enigma_vii/duffy139_1.xml
   trunk/data/levels/enigma_vii/duffy147_1.xml
   trunk/data/levels/enigma_vii/duffy153_2.xml
   trunk/data/levels/enigma_vii/duffy179_1.xml
   trunk/data/levels/enigma_vii/index.xml
   trunk/data/levels/enigma_vii/just23_2.xml
   trunk/data/levels/enigma_vii/pulley03_3.xml
   trunk/data/levels/enigma_viii/devnull03_1.xml
Log:
-> Fixes for level loading errors caused by attribute type validator
--> This is part Ib which fixes some mistakes of part I (rev 1802)
--> A few other rewrites
-> Updates for devnull{03,10}



Modified: trunk/data/levels/enigma_cross/enigma0_92_2.xml
===================================================================
--- trunk/data/levels/enigma_cross/enigma0_92_2.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_cross/enigma0_92_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Facets" location="15200" network="false" owner="Enigma Team" release="1" revision="43" title="Enigma 0.92 - 2"/>
+  <info enigma="1.10" group="Facets" location="15200" network="false" owner="Enigma Team" release="1" revision="44" title="Enigma 0.92 - 2"/>
 
   <attributes/>
 
@@ -13,7 +13,7 @@
     <level _seq="5" _title="Spidering Around Death" _xpath="enigma_iii/martin89_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin89" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="6" _title="Brittle Floor!" _xpath="enigma_iii/martin91_1" author="Martin Hawlisch" ctrl="force" easy="true" id="martin91" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="7" _title="Alcatraz" _xpath="enigma_vi/ralf14_2" author="Ralf Westram" ctrl="force" easy="true" id="ralf14" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="8" _title="Snakes" _xpath="enigma_i/duffy19_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy19" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="8" _title="Snakes" _xpath="enigma_i/duffy19_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy19" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="9" _title="Push the Hammer" _xpath="enigma_iii/martin79_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin79" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="10" _title="- Snow White -" _xpath="enigma_iii/ant15_2" author="Petr Machata" ctrl="force" easy="false" id="ant15" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="11" _title="FIRE, FIRE!" _xpath="enigma_iv/ss07_1" author="Sven Siggelkow" ctrl="force" easy="false" id="ss7" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -89,7 +89,7 @@
     <level _seq="81" _title="Lock Them In" _xpath="enigma_iii/duffy26_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy26" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="82" _title="Lost In Space" _xpath="enigma_iii/martin90_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin90" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="83" _title="Emergency Exit" _xpath="enigma_iii/ss05_1" author="Sven Siggelkow" ctrl="force" easy="false" id="ss5" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="84" _title="Run!" _xpath="enigma_iii/duffy29_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy29" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="84" _title="Run!" _xpath="enigma_iii/duffy29_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy29" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="85" _title="Puzzling Controls" _xpath="enigma_ii/duffy30_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy30" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="86" _title="Khun Phan" _xpath="enigma_ii/ralf10_1" author="Ralf Westram" ctrl="force" easy="false" id="ralf10" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="87" _title="Electric Funeral" _xpath="enigma_iv/ss15_1" author="Sven Siggelkow" ctrl="force" easy="false" id="ss15" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -101,7 +101,7 @@
     <level _seq="93" _title="Look Closely" _xpath="enigma_ii/martin102_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin102" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="94" _title=".-R-.-U-.-N-." _xpath="enigma_ii/martin103_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin103" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="95" _title="Bavarian Madness" _xpath="enigma_iv/ss08_1" author="Sven Siggelkow" ctrl="force" easy="false" id="ss8" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="96" _title="The Builder" _xpath="enigma_iv/ss09_2" author="Sven Siggelkow" ctrl="force" easy="false" id="ss9" rel="2" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="96" _title="The Builder" _xpath="enigma_iv/ss09_2" author="Sven Siggelkow" ctrl="force" easy="false" id="ss9" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="97" _title="Seven Friends" _xpath="enigma_iii/ss16_2" author="Sven Siggelkow" ctrl="force" easy="false" id="ss16" rel="2" rev="0" score="2" target="time" unit="duration"/>
     <level _seq="98" _title="Something Went Wrong" _xpath="enigma_iii/ss17_1" author="Sven Siggelkow" ctrl="force" easy="false" id="ss17" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="99" _title="Beam0r" _xpath="enigma_ii/peter01_2" author="Peter Santo" ctrl="force" easy="false" id="peter_001" rel="2" rev="1" score="1" target="time" unit="duration"/>
@@ -146,10 +146,10 @@
     <level _seq="138" _title="Wildfire" _xpath="enigma_iv/duffy63_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy63" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="139" _title="Slinky Mayhem" _xpath="enigma_iii/duffy64_2" author="Jacob Scott" ctrl="force" easy="true" id="duffy64" rel="2" rev="5" score="2" target="time" unit="duration"/>
     <level _seq="140" _title="Overwhelming" _xpath="enigma_iii/duffy65_2" author="Jacob Scott" ctrl="force" easy="true" id="duffy65" rel="2" rev="3" score="1" target="time" unit="duration"/>
-    <level _seq="141" _title="Tilt Control" _xpath="enigma_iii/duffy66_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy66" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="141" _title="Tilt Control" _xpath="enigma_iii/duffy66_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy66" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="142" _title="Anticipation" _xpath="enigma_v/duffy67_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy67" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="143" _title="What a Mess" _xpath="enigma_iv/duffy68_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy68" rel="2" rev="3" score="2" target="time" unit="duration"/>
-    <level _seq="144" _title="Tilt Maze" _xpath="enigma_iii/duffy69_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy69" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="144" _title="Tilt Maze" _xpath="enigma_iii/duffy69_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy69" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="145" _title="Build Up and Tear Down" _xpath="enigma_v/duffy70_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy70" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="146" _title="Don't Be Greedy" _xpath="enigma_v/duffy71_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy71" rel="2" rev="2" score="2" target="time" unit="duration"/>
     <level _seq="147" _title="Where Am I?" _xpath="enigma_iv/duffy72_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy72" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/enigma0_92_3.xml
===================================================================
--- trunk/data/levels/enigma_cross/enigma0_92_3.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_cross/enigma0_92_3.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Facets" location="15300" network="false" owner="Enigma Team" release="1" revision="27" title="Enigma 0.92 - 3"/>
+  <info enigma="1.10" group="Facets" location="15300" network="false" owner="Enigma Team" release="1" revision="28" title="Enigma 0.92 - 3"/>
 
   <attributes/>
 
@@ -56,9 +56,9 @@
     <level _seq="48" _title="Randomizer" _xpath="enigma_v/duffy115_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy115" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="49" _title="Just Stay Calm" _xpath="enigma_vi/duffy116_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy116" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="50" _title="Bad Nightmare" _xpath="enigma_iv/duffy117_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy117" rel="3" rev="5" score="2" target="time" unit="duration"/>
-    <level _seq="51" _title="Kaleidoscope" _xpath="enigma_ii/duffy118_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy118" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="51" _title="Kaleidoscope" _xpath="enigma_ii/duffy118_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy118" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="52" _title="Reach the Dock" _xpath="enigma_v/duffy119_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy119" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="53" _title="Snowing" _xpath="enigma_ii/duffy120_2" author="Jacob Scott" ctrl="force" easy="true" id="duffy120" rel="2" rev="4" score="2" target="time" unit="duration"/>
+    <level _seq="53" _title="Snowing" _xpath="enigma_ii/duffy120_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy120" rel="3" rev="5" score="2" target="time" unit="duration"/>
     <level _seq="54" _title="Action at a Distance" _xpath="enigma_iv/duffy121_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy121" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="55" _title="Civil Engineer" _xpath="enigma_i/duffy122_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy122" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="56" _title="Electric Meditation" _xpath="enigma_iv/duffy123_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy123" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_cross/newlevels.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Facets" location="15400" network="false" owner="Enigma Team" release="1" revision="52" title="Enigma 1.00 new"/>
+  <info enigma="1.10" group="Facets" location="15400" network="false" owner="Enigma Team" release="1" revision="53" title="Enigma 1.00 new"/>
 
   <attributes/>
 
@@ -33,20 +33,20 @@
     <level _seq="25" _title="Enignimm" _xpath="enigma_ii/alain02_1" author="Alain Busser" ctrl="force" easy="false" id="alain02" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="26" _title="One Way Ticket" _xpath="enigma_ii/luc25_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc25" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="27" _title="- Meditation -" _xpath="enigma_ii/andreas17_2" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas17" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="28" _title="Growing Boxes" _xpath="enigma_ii/luc26_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc26" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="28" _title="Growing Boxes" _xpath="enigma_ii/luc26_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc26" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="29" _title="Enigmastermind" _xpath="enigma_ii/alain16_1" author="Alain Busser" ctrl="force" easy="false" id="alain16" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="30" _title="Guitar" _xpath="enigma_ii/guy01_1" author="Guy Busser" ctrl="force" easy="false" id="guy01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="31" _title="Koosnab" _xpath="enigma_ii/rb02_2" author="Roberto Bardin" ctrl="force" easy="false" id="rb02" rel="2" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="32" _title="More Black Holes" _xpath="enigma_ii/luc18_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc18" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="32" _title="More Black Holes" _xpath="enigma_ii/luc18_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc18" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="33" _title="Robin's Wood" _xpath="enigma_ii/andreas13_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas13" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="34" _title="Road to Eden" _xpath="enigma_ii/alain22_1" author="Alain Busser" ctrl="force" easy="false" id="alain22" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="35" _title="Disk Royal" _xpath="enigma_ii/illmind02_1" author="illmind" ctrl="force" easy="false" id="illmind02" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="36" _title="Spaceless" _xpath="enigma_ii/andreas02_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas02" rel="2" rev="3" score="1" target="time" unit="duration"/>
-    <level _seq="37" _title="Laser Paradise" _xpath="enigma_ii/illmind05_1" author="illmind" ctrl="force" easy="false" id="illmind05" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="37" _title="Laser Paradise" _xpath="enigma_ii/illmind05_1" author="illmind" ctrl="force" easy="false" id="illmind05" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="38" _title="Spaceleast" _xpath="enigma_ii/andreas15_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas15" rel="2" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="39" _title="The Fuse" _xpath="enigma_ii/capkoh02_1" author="capkoh" ctrl="force" easy="false" id="capkoh02" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="39" _title="The Fuse" _xpath="enigma_ii/capkoh02_2" author="capkoh" ctrl="force" easy="false" id="capkoh02" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="40" _title="- Meditation -" _xpath="enigma_ii/edward10_2" author="Edward" ctrl="force" easy="false" id="edward10" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="41" _title="Knight Moves" _xpath="enigma_ii/illmind04_1" author="illmind" ctrl="force" easy="false" id="illmind04" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="41" _title="Knight Moves" _xpath="enigma_ii/illmind04_1" author="illmind" ctrl="force" easy="false" id="illmind04" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="42" _title="Buridan" _xpath="enigma_ii/alain01_1" author="Alain Busser" ctrl="force" easy="false" id="alain01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="43" _title="Moure-Switches" _xpath="enigma_ii/andreas10_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas10" rel="2" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="44" _title="Turn Around" _xpath="enigma_ii/andreas07_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas07" rel="2" rev="5" score="1" target="time" unit="duration"/>
@@ -75,7 +75,7 @@
     <level _seq="67" _title="Remote Control" _xpath="enigma_iii/luc22_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc22" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="68" _title="Walk the Dog" _xpath="enigma_iii/luc04_2" author="Lukas Sch?ller" ctrl="force" easy="true" id="luc04" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="69" _title="Triple Threat" _xpath="enigma_iii/illmind10_1" author="illmind" ctrl="force" easy="false" id="illmind10" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="70" _title="Changing Positions" _xpath="enigma_iii/luc27_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc27" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="70" _title="Changing Positions" _xpath="enigma_iii/luc27_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc27" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="71" _title="Waterworld" _xpath="enigma_iii/illmind11_2" author="illmind" ctrl="force" easy="true" id="illmind11" rel="2" rev="6" score="2" target="time" unit="duration"/>
     <level _seq="72" _title="Wood robbing" _xpath="enigma_iv/alain08_1" author="Alain Busser" ctrl="force" easy="false" id="alain08" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="73" _title="Hurry!" _xpath="enigma_iv/wb01_4" author="Jon 'WB' Sneyers" ctrl="force" easy="true" id="wb1" rel="4" rev="3" score="3" target="time" unit="duration"/>
@@ -99,7 +99,7 @@
     <level _seq="91" _title="Send me the keys !" _xpath="enigma_v/alain09_1" author="Alain Busser" ctrl="force" easy="false" id="alain09" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="92" _title="Laser Path" _xpath="enigma_v/andreas06_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas06" rel="2" rev="15" score="2" target="time" unit="duration"/>
     <level _seq="93" _title="Hobbyte" _xpath="enigma_v/alain15_1" author="Alain Busser" ctrl="force" easy="false" id="alain15" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="94" _title="Water Castle" _xpath="enigma_v/luc21_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc21" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="94" _title="Water Castle" _xpath="enigma_v/luc21_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc21" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="95" _title="Moving Puzzles" _xpath="enigma_v/luc13_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc13" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="96" _title="Table Hockey" _xpath="enigma_v/capkoh01_1" author="capkoh" ctrl="force" easy="false" id="capkoh01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="97" _title="Jesusbond" _xpath="enigma_v/richi02_2" author="Richi B?tzer" ctrl="force" easy="false" id="richi02" rel="2" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels_1.0.1.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.0.1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_cross/newlevels_1.0.1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Facets" location="15500" network="false" owner="Enigma Team" release="1" revision="35" title="Enigma 1.01 new"/>
+  <info enigma="1.10" group="Facets" location="15500" network="false" owner="Enigma Team" release="1" revision="36" title="Enigma 1.01 new"/>
 
   <attributes/>
 
@@ -31,7 +31,7 @@
     <level _seq="23" _title="Odyssey" _xpath="enigma_vi/ant39_2" author="Petr Machata" ctrl="force" easy="false" id="ant39" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="24" _title="Tandem Chess" _xpath="enigma_vi/luc34_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc342007" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="25" _title="Magic Trinity" _xpath="enigma_vi/duffy146_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy146" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="26" _title="Rotor Guards" _xpath="enigma_vi/duffy144_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy144" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="26" _title="Rotor Guards" _xpath="enigma_vi/duffy144_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy144" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="27" _title="Group Trip to Meditation" _xpath="enigma_vi/duffy136_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy136" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="28" _title="Oxyd Drilling" _xpath="enigma_vi/duffy140_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy140" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="29" _title="Pleasure Garden" _xpath="enigma_vi/duffy134_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy134" rel="1" rev="5" score="1" target="time" unit="duration"/>
@@ -41,8 +41,8 @@
     <level _seq="33" _title="In the Middle" _xpath="enigma_vi/duffy141_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy141" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="34" _title="Construction Workers" _xpath="enigma_vi/duffy142_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy142" rel="2" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="35" _title="One-Way Woods" _xpath="enigma_vi/duffy135_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy135" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="36" _title="Comet" _xpath="enigma_vii/duffy147_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy147" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="37" _title="Caribbean Waters" _xpath="enigma_vii/duffy139_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy139" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="36" _title="Comet" _xpath="enigma_vii/duffy147_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy147" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="37" _title="Caribbean Waters" _xpath="enigma_vii/duffy139_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy139" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="38" _title="DownDown" _xpath="enigma_vii/joona01_2" author="Joona Laire" ctrl="force" easy="true" id="20070406joona005" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="39" _title="City Life" _xpath="enigma_vi/joona03_1" author="Joona Laire" ctrl="force" easy="true" id="20061119joona503" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="40" _title="Diving" _xpath="enigma_vii/joona13_1" author="Joona Laire" ctrl="force" easy="true" id="20061203joona500" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -60,7 +60,7 @@
     <level _seq="52" _title="Advancing" _xpath="enigma_vii/joe01_1" author="Joseph Dunne" ctrl="force" easy="false" id="joe01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="53" _title="Free Riders" _xpath="enigma_vii/duffy155_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy155" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="54" _title="Meditation in Peace" _xpath="enigma_vii/ral20_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070502ral466" rel="2" rev="184" score="2" target="time" unit="duration"/>
-    <level _seq="55" _title="Laser Squad" _xpath="enigma_vii/duffy153_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy153" rel="2" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="55" _title="Laser Squad" _xpath="enigma_vii/duffy153_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy153" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="56" _title="Protected Exhibition" _xpath="enigma_vii/duffy156_2" author="Jacob Scott" ctrl="force" easy="true" id="duffy156" rel="2" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="57" _title="Oneway for White" _xpath="enigma_vii/duffy157_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy157" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="58" _title="Widgets in the Attic" _xpath="enigma_vii/duffy158_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy158" rel="2" rev="2" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="61" title="Enigma 1.1 new"/>
+  <info enigma="1.10" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="62" title="Enigma 1.1 new"/>
 
   <attributes/>
 
@@ -37,19 +37,19 @@
     <level _seq="29" _title="Give Way" _xpath="enigma_vii/just20_2" author="JuSt" ctrl="force" easy="false" id="just20" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="30" _title="Give more Way" _xpath="enigma_vii/just21_2" author="JuSt" ctrl="force" easy="true" id="just21" rel="2" rev="4" score="2" target="time" unit="duration"/>
     <level _seq="31" _title="Give Way 4 two" _xpath="enigma_vii/just22_2" author="JuSt" ctrl="force" easy="true" id="just22" rel="2" rev="3" score="2" target="time" unit="duration"/>
-    <level _seq="32" _title="Lost in Time and Space" _xpath="enigma_vii/just23_2" author="JuSt" ctrl="force" easy="false" id="just23" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="32" _title="Lost in Time and Space" _xpath="enigma_vii/just23_2" author="JuSt" ctrl="force" easy="false" id="just23" rel="2" rev="6" score="2" target="time" unit="duration"/>
     <level _seq="33" _title="Alternatives?" _xpath="enigma_vii/just24_1" author="JuSt" ctrl="force" easy="true" id="just24" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="34" _title="No More Alternatives" _xpath="enigma_vii/just25_1" author="JuSt" ctrl="force" easy="true" id="just25" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="35" _title="The Walls" _xpath="enigma_vii/just26_1" author="JuSt" ctrl="force" easy="true" id="just26" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="35" _title="The Walls" _xpath="enigma_vii/just26_2" author="JuSt" ctrl="force" easy="true" id="just26" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="36" _title="Pull the Puller" _xpath="enigma_vii/just28_1" author="JuSt" ctrl="force" easy="false" id="just28" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="37" _title="Double Sense" _xpath="enigma_vii/joe14_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe14" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="38" _title="Double Sense II" _xpath="enigma_vii/joe15_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe15" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="39" _title="Lightyears" _xpath="enigma_vii/duffy177_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy177" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="40" _title="Zero Magnetism Lab" _xpath="enigma_vii/duffy178_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy178" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="41" _title="Armageddon" _xpath="enigma_vii/duffy179_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy179" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="41" _title="Armageddon" _xpath="enigma_vii/duffy179_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy179" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="42" _title="Mountain Climbing II" _xpath="enigma_vii/joe25_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe25" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="43" _title="Minor Tangler" _xpath="enigma_vii/joe24_2" author="Joseph Dunne" ctrl="force" easy="false" id="joe24" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="44" _title="Circulation" _xpath="enigma_vii/pulley03_3" author="Mark Pulley" ctrl="force" easy="false" id="pulley03" rel="3" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="44" _title="Circulation" _xpath="enigma_vii/pulley03_3" author="Mark Pulley" ctrl="force" easy="false" id="pulley03" rel="3" rev="6" score="2" target="time" unit="duration"/>
     <level _seq="45" _title="Maze for Two" _xpath="enigma_vii/ral22_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20071017ral096" rel="2" rev="182" score="1" target="time" unit="duration"/>
     <level _seq="46" _title="Making Shapes" _xpath="enigma_vii/joe18_2" author="Joseph Dunne" ctrl="force" easy="false" id="joe18" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="47" _title="Clever Pushing" _xpath="enigma_vii/joe19_2" author="Joseph Dunne" ctrl="force" easy="false" id="joe19" rel="2" rev="1" score="2" target="time" unit="duration"/>
@@ -183,7 +183,7 @@
     <level _seq="175" _title="Pinnacles I" _xpath="enigma_ix/mecke36_1" author="mecke" ctrl="force" easy="true" id="mecke36" rel="1" rev="16" score="1" target="time" unit="duration"/>
     <level _seq="176" _title="Symopal" _xpath="enigma_ix/andreas58_1" author="Andreas Lochmann, Ronald Lamprecht" ctrl="force" easy="true" id="andreas58" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="177" _title="The Pilgrim's Progress" _xpath="enigma_ix/pulley14_2" author="Mark Pulley" ctrl="force" easy="false" id="20080101pulley001" rel="2" rev="2" score="2" target="time" unit="duration"/>
-    <level _seq="178" _title="Logic Gates" _xpath="enigma_ix/pulley17_2" author="Mark Pulley" ctrl="force" easy="true" id="20080601pulley001" rel="2" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="178" _title="Logic Gates" _xpath="enigma_ix/pulley17_2" author="Mark Pulley" ctrl="force" easy="true" id="20080601pulley001" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="179" _title="Behind glass" _xpath="enigma_ix/rudolf01_1" author="Rudolf" ctrl="force" easy="false" id="rudolf01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="180" _title="Perennial Creek" _xpath="enigma_ix/pulley20_2" author="Mark Pulley" ctrl="force" easy="true" id="20080614pulley001" rel="2" rev="2" score="2" target="time" unit="duration"/>
     <level _seq="181" _title="Wired Strips" _xpath="enigma_viii/ral38_1" author="Ronald Lamprecht" ctrl="force" easy="true" id="20081223ral510" rel="1" rev="151" score="1" target="time" unit="duration"/>
@@ -199,7 +199,7 @@
     <level _seq="191" _title="Hip to be square" _xpath="enigma_ix/devnull37_1" author="/dev/null" ctrl="force" easy="true" id="devnull37" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="192" _title="Across The Waterbyss" _xpath="enigma_ix/harry03_1" author="daydreamer" ctrl="force" easy="false" id="harry03" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="193" _title="Collapsing Building" _xpath="enigma_ix/pulley28_1" author="Mark Pulley" ctrl="force" easy="true" id="20081018pulley001" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="194" _title="Flashback" _xpath="enigma_ix/devnull10_1" author="/dev/null" ctrl="force" easy="false" id="devnull10" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="194" _title="Flashback" _xpath="enigma_ix/devnull10_1" author="/dev/null" ctrl="force" easy="false" id="devnull10" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="195" _title="Pillar" _xpath="enigma_ix/raoul39_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul39" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="196" _title="The Inferno" _xpath="enigma_ix/duffy181" author="Jacob Scott" ctrl="force" easy="true" id="duffy181" rel="2" rev="20" score="1" target="time" unit="duration"/>
     <level _seq="197" _title="Caving" _xpath="enigma_ix/pulley31_1" author="Mark Pulley" ctrl="force" easy="false" id="20090424pulley001" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_i/duffy19_1.xml
===================================================================
--- trunk/data/levels/enigma_i/duffy19_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_i/duffy19_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Snakes" el:subtitle="" el:id="duffy19"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -976,7 +976,7 @@
 
 end
 
-set_stone("st-timer", 21,0, {loop=true, action="callback", target="timer_callback", interval=.12})
+set_stone("st-timer", 21,0, {action="callback", target="timer_callback", interval=.12})
     ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Modified: trunk/data/levels/enigma_i/index.xml
===================================================================
--- trunk/data/levels/enigma_i/index.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_i/index.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10200" network="false" owner="Enigma Team" release="1" revision="28" title="Enigma I"/>
+  <info enigma="1.10" group="Enigma" location="10200" network="false" owner="Enigma Team" release="1" revision="29" title="Enigma I"/>
 
   <attributes/>
 
@@ -10,7 +10,7 @@
     <level _seq="2" _title="The Doors" _xpath="./siegfried11_2" author="Siegfried Fennig" ctrl="force" easy="false" id="level4a" rel="2" rev="2" score="2" target="time" unit="duration"/>
     <level _seq="3" _title="Archipelago" _xpath="./martin12_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin12" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="4" _title="Flying" _xpath="./luc07_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc07" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="5" _title="Snakes" _xpath="./duffy19_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy19" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="5" _title="Snakes" _xpath="./duffy19_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy19" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="6" _title="Welcome to the Machine" _xpath="./ralf03_2" author="Ralf Westram" ctrl="force" easy="false" id="ralf03" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="7" _title="Sok It To 'Em" _xpath="./nat07_2" author="Nat Pryce" ctrl="force" easy="false" id="nat7" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="8" _title="Easy?" _xpath="./ss01_2" author="Sven Siggelkow" ctrl="force" easy="false" id="ss1" rel="2" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_i/jc01_2.xml
===================================================================
--- trunk/data/levels/enigma_i/jc01_2.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_i/jc01_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -43,8 +43,7 @@
     "X           #......#",
     "X o   o   o #.O..Q.#",
     "X           #......#",
-    "XXXXXXXXXXXX########"
-})
+    "XXXXXXXXXXXX########"})
 
 if wo["IsDifficult"] then
     wo:shuffleOxyd({"lefto#*", "righto#*", max = 4}, {"righto#*", min=0, max=0})

Deleted: trunk/data/levels/enigma_ii/capkoh02_1.xml
===================================================================
--- trunk/data/levels/enigma_ii/capkoh02_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_ii/capkoh02_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,128 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="The Fuse" el:subtitle="" el:id="capkoh02"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
-      <el:author  el:name="capkoh" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2005 capkoh</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-create_world(39, 13)
-oxyd_default_flavor="b"
-
--- Code
-function grow_wall()
-  set_stone("st-rock1", 21, 10)
-end
-
-function grow_line()
-  for i = 3, 11 do
-    set_stone("st-rock1", 36, i)
-  end
-  document(35, 11, "text1")
-end
-
--- Floor Layer
-fill_floor("fl-hay")
-
--- Item Layer
-set_item("it-trigger", 4, 1, {action="open", target="door1"})
-set_item("it-trigger", 12, 1, {action="open", target="door2"})
-set_item("it-trigger", 21, 1, {action="callback", target="grow_wall", invisible=FALSE})
-set_item("it-trigger", 37, 1, {action="callback", target="grow_line"})
-set_item("it-trigger", 1, 3, {action="onoff", target="laser1"})
-set_item("it-hammer", 10, 4)
-set_item("it-document", 7, 7, {text="text2"})
-set_item("it-sword", 11, 8)
-set_item("it-document", 15, 10, {text="text3"})
-set_item("it-coin4", 6, 4)
-
--- Stone Layer
-oxyd(38, 10)
-oxyd(38, 4)
-draw_stones("st-marble", {0, 0}, {1, 0}, 39)
-draw_stones("st-marble", {0, 1}, {0, 1}, 12)
-draw_stones("st-break_bolder", {5, 1}, {1, 0}, 7)
-draw_stones("st-break_bolder", {13, 1}, {1, 0}, 8)
-draw_stones("st-break_bolder", {30, 1}, {1, 0}, 7)
-draw_stones("st-marble", {38, 1}, {0, 1}, 3)
-draw_stones("st-marble", {3, 2}, {1, 0}, 35)
-draw_stones("st-marble", {4, 3}, {0, 1}, 7)
-draw_stones("st-marble", {12, 3}, {0, 1}, 4)
-draw_stones("st-marble", {21, 3}, {0, 1}, 4)
-draw_stones("st-marble", {23, 3}, {0, 1}, 4)
-draw_stones("st-marble", {29, 3}, {0, 1}, 3)
-draw_stones("st-marble", {31, 3}, {1, 0}, 4)
-draw_stones("st-marble", {14, 4}, {0, 1}, 5)
-draw_stones("st-marble", {25, 4}, {1, 0}, 3)
-draw_stones("st-marble", {34, 4}, {0, 1}, 6)
-draw_stones("st-marble", {27, 5}, {0, 1}, 6)
-draw_stones("st-marble", {30, 5}, {1, 0}, 3)
-draw_stones("st-marble", {38, 5}, {0, 1}, 5)
-draw_stones("st-marble", {10, 6}, {0, 1}, 4)
-draw_stones("st-stone_break", {11, 6}, {0, 1}, 3)
-draw_stones("st-marble", {19, 6}, {0, 1}, 5)
-draw_stones("st-marble", {24, 6}, {1, 0}, 2)
-draw_stones("st-marble", {32, 6}, {0, 1}, 2)
-draw_stones("st-marble", {25, 7}, {0, 1}, 2)
-draw_stones("st-marble", {28, 7}, {1, 1}, 3)
-draw_stones("st-marble", {12, 8}, {0, 1}, 5)
-draw_stones("st-marble", {21, 8}, {0, 1}, 2)
-draw_stones("st-marble", {23, 8}, {0, 1}, 5)
-draw_stones("st-marble", {29, 9}, {0, 1}, 4)
-draw_stones("st-marble", {31, 9}, {1, 0}, 2)
-draw_stones("st-marble", {25, 10}, {0, 1}, 3)
-draw_stones("st-marble", {4, 11}, {0, 1}, 2)
-draw_stones("st-marble", {21, 11}, {0, 1}, 2)
-fill_stones("st-marble", 31, 11, 2, 2)
-draw_stones("st-marble", {34, 11}, {0, 1}, 2)
-draw_stones("st-marble", {38, 11}, {0, 1}, 2)
-draw_stones("st-marble", {5, 12}, {1, 0}, 7)
-draw_stones("st-marble", {13, 12}, {1, 0}, 8)
-draw_stones("st-marble", {26, 12}, {1, 0}, 3)
-draw_stones("st-marble", {35, 12}, {1, 0}, 3)
-set_stone("st-bolder", 1, 1, {name="bolder1", direction=EAST})
-set_stone("st-stone_break", 2, 1)
-set_stone("st-break_bolder", 3, 1)
-set_stones("st-marble", {{1, 2}, {29, 7}, {31, 7}, {11, 9}, {1, 12}, {3, 12}, {22, 12}, {24, 12}, {30, 12}, {33, 12}})
-set_stone("st-glass", 2, 2)
-set_stone("st-brownie", 6, 4)
-set_stone("st-door", 12, 7, {name="door2", type="v"})
-set_stone("st-rock1", 21, 7)
-set_stone("st-knight", 23, 7)
-set_stone("st-coinslot", 28, 8, {action="openclose", target="door3"})
-set_stone("st-door", 4, 10, {name="door1", type="v"})
-set_stone("st-marble_hole", 21, 10)
-set_stone("st-door", 34, 10, {name="door3", type="v"})
-set_stone("st-laser", 2, 12, {name="laser1", dir=NORTH, on=0})
-
--- Actor Layer
-set_actor("ac-blackball", 2.5, 7.5, {player=0, mouseforce=1})
-
-oxyd_shuffle()
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-      <el:string el:key="text1">
-        <el:english el:translate="true">Dead end!</el:english>
-      </el:string>
-      <el:string el:key="text2">
-        <el:english el:translate="true">There are two HIDDEN items!</el:english>
-      </el:string>
-      <el:string el:key="text3">
-        <el:english el:translate="true">Third stone from the rock is the hole!</el:english>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_ii/capkoh02_2.xml (from rev 1802, trunk/data/levels/enigma_ii/capkoh02_1.xml)
===================================================================
--- trunk/data/levels/enigma_ii/capkoh02_1.xml	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/data/levels/enigma_ii/capkoh02_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -0,0 +1,81 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="The Fuse" el:subtitle="" el:id="capkoh02"/>
+      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
+      <el:author  el:name="capkoh" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2005 capkoh</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_hay"}
+ti["."] = {"fl_hay", name="wall#"}
+ti["#"] = {"st_redbrown"}
+ti["H"] = {"st_redbrown_hollow", name="hollow"}
+ti["G"] = {"st_rawglass"}
+ti["R"] = {"st_granite"}
+ti["L"] = {"st_laser", orientation=NORTH, name="laser"}
+ti["D"] = ti({"st_brownie"}) .. {"it_coin_l"}
+ti["E"] = {"st_break_boulder"}
+ti["F"] = {"st_break_oxydc"}
+ti[">"] = {"st_boulder", orientation=EAST}
+ti["K"] = {"st_knight"}
+ti["S"] = {"st_coinslot", target="door%3", action="open"}
+ti["door"] = {"st_door", flavor="d", faces="ew", name="door%%"}
+ti["trigger"] = {"it_trigger", target="door%%", action="open"}
+ti["doc"] = {"it_document", text="text%%"}
+ti["l"] = {"it_trigger", target="laser"}
+ti["t"] = {"it_trigger", target="granite"}
+ti["u"] = {"it_trigger", target="wall"}
+ti["h"] = {"it_hammer"}
+ti["f"] = ti["F"] .. {"it_sword"}
+ti["O"] = {"st_oxyd"}
+ti["@"] = {"#ac_marble_black"}
+
+wo(res.autotile(ti, {"a", "b", "trigger"}, {"A", "C", "door"}, {"1", "3", "doc"}), " ", {
+    "#######################################",
+    "#>FEaEEEEEEEbEEEEEEEEt        EEEEEEEu#",
+    "##G####################################",
+    "#l  #       #        # #     # #### . #",
+    "#   # D   h # #      # # ### #    # . O",
+    "#   #       # #      # #   # #### # . #",
+    "#   #     #F# #    # # ### #    # # . #",
+    "# @ #  2  #FB #    # R K # ### ## # . #",
+    "#   #     #f# #    # # # # #S#    # . #",
+    "#   #     ###      # H #   # #### # . #",
+    "#   A       #  3   # # # # # #    C . O",
+    "#   #       #        # # #   # ## # . #",
+    "##L####################################"})
+
+wo:shuffleOxyd()
+
+function granite()
+    wo[no["hollow"]] = ti["R"]
+end
+
+function wall()
+    wo[no["wall#*"]] = ti["R"]
+    wo[no["door%3"]+SE] = {"it_document", text="text%1"}
+end
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+      <el:string el:key="text%1">
+        <el:english el:translate="true">Dead end!</el:english>
+      </el:string>
+      <el:string el:key="text%2">
+        <el:english el:translate="true">There are two HIDDEN items!</el:english>
+      </el:string>
+      <el:string el:key="text%3">
+        <el:english el:translate="true">Third stone from the rock is the hole!</el:english>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_ii/duffy118_1.xml
===================================================================
--- trunk/data/levels/enigma_ii/duffy118_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_ii/duffy118_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Kaleidoscope" el:subtitle="" el:id="duffy118"/>
-      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="4" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2004 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -54,7 +54,7 @@
         elseif c=="=" then
             set_floor("fl-space",i-1,line)
         elseif c=="T" then
-            set_stone("st-timer",i-1,line,{interval=1,loop=true,action="callback",target="funcctimer"})
+            set_stone("st-timer",i-1,line,{interval=1,action="callback",target="funcctimer"})
         end
     end
 end

Deleted: trunk/data/levels/enigma_ii/duffy120_2.xml
===================================================================
--- trunk/data/levels/enigma_ii/duffy120_2.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_ii/duffy120_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,94 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Snowing" el:subtitle="" el:id="duffy120"/>
-      <el:version el:score="2" el:release="2" el:revision="4" el:status="released"/>
-      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2004 Jacob Scott</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="true" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-rooms_wide=1
-rooms_high=1
-
-levelw=1+(19*rooms_wide)+1
-levelh=1+(12*rooms_high)
-
-create_world( levelw, levelh)
-
-difficult = (options.Difficulty==2)
-
-fill_floor("fl-leaves", 0,0,levelw,levelh)
-
-function renderLine( line, pattern)
-    for i=1, strlen(pattern) do
-        local c = strsub( pattern, i, i)
-        if c =="#" then
-            set_stone( "st-death", i-1, line)
-        elseif c == "o" then
-            oxyd( i-1, line)
-        elseif c == "*" then
-            set_stone( "st-brownie", i-1, line)
-        elseif c == "!" then
-            abyss(i-1,line)
-        elseif c == "~" then
-            set_floor("fl-water",i-1,line)
-        elseif c=="z" then
-            set_actor("ac-blackball", i-.5,line+.5, {player=0})
-        elseif c=="y" then
-            set_actor("ac-whiteball", i-1,line+.5, {player=1})
-        elseif c=="t" then
-            if difficult==false then
-                set_actor("ac-top", i-.5,line+.5, {force=25,range=30,controllers=0,player=1})
-            else
-                set_actor("ac-top", i-.5,line+.5, {force=40,range=30,controllers=0,player=1})
-            end
-        elseif c == "g" then
-            draw_stones("st-grate1",{i-1,line}, {1,1}, 1)
-        elseif c=="+" then
-            set_stone( "st-wood", i-1, line)
-        elseif c=="=" then
-            set_floor("fl-space",i-1,line)
-        elseif c=="T" then
-            set_stone("st-timer",i-1,line,{loop=true,interval=0.2,action="callback",target="funcc1"})
-        end
-    end
-end
-
-renderLine(00,"####################T")
-renderLine(01,"#       o  o       # ")
-renderLine(02,"#    o        o    # ")
-renderLine(03,"#  o            o  # ")
-renderLine(04,"#                  # ")
-renderLine(05,"#o                o# ")
-renderLine(06,"#    t   ##  z     # ")
-renderLine(07,"#o                o# ")
-renderLine(08,"#                  # ")
-renderLine(09,"#  o            o  # ")
-renderLine(10,"#    o        o    # ")
-renderLine(11,"#       o  o       # ")
-renderLine(12,"#################### ")
-
-oxyd_shuffle()
-
-function funcc1()
-   x=random(21)-1
-   y=random(13)-1
-   set_floor("fl-ice",x,y)
-end
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_ii/duffy120_3.xml (from rev 1802, trunk/data/levels/enigma_ii/duffy120_2.xml)
===================================================================
--- trunk/data/levels/enigma_ii/duffy120_2.xml	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/data/levels/enigma_ii/duffy120_3.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -0,0 +1,54 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Snowing" el:subtitle="" el:id="duffy120"/>
+      <el:version el:score="2" el:release="3" el:revision="5" el:status="released"/>
+      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2004 Jacob Scott</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_lawn", name="lawn#"}
+ti["#"] = {"st_death"}
+ti["O"] = {"st_oxyd", name="oxyds#"}
+ti["*"] = cond(wo["IsDifficult"], {"#ac_top", range=30.0, strength=40.0}, {"#ac_top", range=30.0, strength=25.0})
+ti["@"] = {"#ac_marble"}
+
+wo(ti, " ", {
+    "####################",
+    "#       O  O       #",
+    "#    O        O    #",
+    "#  O            O  #",
+    "#                  #",
+    "#O                O#",
+    "#    *   ##  @     #",
+    "#O                O#",
+    "#                  #",
+    "#  O            O  #",
+    "#    O        O    #",
+    "#       O  O       #",
+    "####################"})
+
+wo:add({"ot_timer", target="snow", interval=0.2})
+wo:shuffleOxyd({no["oxyds#*"]:sort("circular"), circular=true})
+
+local lawngrp = no["lawn#*"]:shuffle()
+
+function snow()
+    flake = lawngrp:sub(1)
+    wo[flake] = {"fl_ice"}
+    lawngrp = lawngrp - flake
+end
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_ii/duffy128_1.xml
===================================================================
--- trunk/data/levels/enigma_ii/duffy128_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_ii/duffy128_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -234,7 +234,7 @@
         elseif c == "s" then --9-ur
             set_floor("fl-gradient",  i-1,  line, {type=10})
         elseif c == "t" then --9-ur
-           set_stone("st-timer",  i-1,  line, {loop=true,interval=.45,name="tt",action="callback",target="funcctchange"})
+           set_stone("st-timer",  i-1,  line, {interval=.45,name="tt",action="callback",target="funcctchange"})
         elseif c=="C" then
             set_attrib(laser(i-1,line, FALSE, EAST), "name", "laser1")
          elseif c=="/" then

Modified: trunk/data/levels/enigma_ii/illmind04_1.xml
===================================================================
--- trunk/data/levels/enigma_ii/illmind04_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_ii/illmind04_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Knight Moves" el:subtitle="" el:id="illmind04"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="illmind" el:email="support at mag-heut.net" el:homepage="http://www.mag-heut.net/"/>
       <el:copyright>Copyright ? 2005 illmind</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -69,25 +69,25 @@
 set_item("it-trigger", 18, 3, {action="openclose", target="illdoor21"})
 
 -- door timers
-set_stone("st-timer", 21,1, {loop=true, action="openclose", target="illdoor01", interval=3})
-set_stone("st-timer", 21,2, {loop=true, action="openclose", target="illdoor02", interval=2})
-set_stone("st-timer", 21,3, {loop=true, action="openclose", target="illdoor03", interval=3})
-set_stone("st-timer", 21,4, {loop=true, action="openclose", target="illdoor04", interval=4})
-set_stone("st-timer", 21,5, {loop=true, action="openclose", target="illdoor05", interval=3})
-set_stone("st-timer", 21,6, {loop=true, action="openclose", target="illdoor06", interval=2})
-set_stone("st-timer", 21,7, {loop=true, action="openclose", target="illdoor07", interval=3})
-set_stone("st-timer", 21,8, {loop=true, action="openclose", target="illdoor08", interval=4})
-set_stone("st-timer", 21,9, {loop=true, action="openclose", target="illdoor09", interval=3})
-set_stone("st-timer", 21,10, {loop=true, action="openclose", target="illdoor10", interval=2})
-set_stone("st-timer", 21,11, {loop=true, action="openclose", target="illdoor11", interval=3})
-set_stone("st-timer", 22,1, {loop=true, action="openclose", target="illdoor12", interval=4})
-set_stone("st-timer", 22,2, {loop=true, action="openclose", target="illdoor13", interval=3})
-set_stone("st-timer", 22,3, {loop=true, action="openclose", target="illdoor14", interval=2})
-set_stone("st-timer", 22,4, {loop=true, action="openclose", target="illdoor15", interval=3})
-set_stone("st-timer", 22,5, {loop=true, action="openclose", target="illdoor16", interval=4})
-set_stone("st-timer", 22,6, {loop=true, action="openclose", target="illdoor17", interval=3})
-set_stone("st-timer", 22,7, {loop=true, action="openclose", target="illdoor18", interval=2})
-set_stone("st-timer", 22,8, {loop=true, action="openclose", target="illdoor19", interval=3})
+set_stone("st-timer", 21,1, {action="openclose", target="illdoor01", interval=3})
+set_stone("st-timer", 21,2, {action="openclose", target="illdoor02", interval=2})
+set_stone("st-timer", 21,3, {action="openclose", target="illdoor03", interval=3})
+set_stone("st-timer", 21,4, {action="openclose", target="illdoor04", interval=4})
+set_stone("st-timer", 21,5, {action="openclose", target="illdoor05", interval=3})
+set_stone("st-timer", 21,6, {action="openclose", target="illdoor06", interval=2})
+set_stone("st-timer", 21,7, {action="openclose", target="illdoor07", interval=3})
+set_stone("st-timer", 21,8, {action="openclose", target="illdoor08", interval=4})
+set_stone("st-timer", 21,9, {action="openclose", target="illdoor09", interval=3})
+set_stone("st-timer", 21,10, {action="openclose", target="illdoor10", interval=2})
+set_stone("st-timer", 21,11, {action="openclose", target="illdoor11", interval=3})
+set_stone("st-timer", 22,1, {action="openclose", target="illdoor12", interval=4})
+set_stone("st-timer", 22,2, {action="openclose", target="illdoor13", interval=3})
+set_stone("st-timer", 22,3, {action="openclose", target="illdoor14", interval=2})
+set_stone("st-timer", 22,4, {action="openclose", target="illdoor15", interval=3})
+set_stone("st-timer", 22,5, {action="openclose", target="illdoor16", interval=4})
+set_stone("st-timer", 22,6, {action="openclose", target="illdoor17", interval=3})
+set_stone("st-timer", 22,7, {action="openclose", target="illdoor18", interval=2})
+set_stone("st-timer", 22,8, {action="openclose", target="illdoor19", interval=3})
 
 -- stationary lasers
 set_stone("st-laser", 16, 2, {on=TRUE, dir=SOUTH, name="illkill01"})
@@ -102,16 +102,16 @@
 set_stone("st-laser", 18, 10, {on=TRUE, dir=WEST, name="illkill10"})
 
 -- laser timers
-set_stone("st-timer", 23,2, {loop=true, action="onoff", target="illkill01", interval=4})
-set_stone("st-timer", 23,3, {loop=true, action="onoff", target="illkill02", interval=4})
-set_stone("st-timer", 23,4, {loop=true, action="onoff", target="illkill03", interval=2})
-set_stone("st-timer", 23,5, {loop=true, action="onoff", target="illkill04", interval=2})
-set_stone("st-timer", 23,6, {loop=true, action="onoff", target="illkill05", interval=2})
-set_stone("st-timer", 23,7, {loop=true, action="onoff", target="illkill06", interval=3})
-set_stone("st-timer", 23,8, {loop=true, action="onoff", target="illkill07", interval=3})
-set_stone("st-timer", 23,9, {loop=true, action="onoff", target="illkill08", interval=3})
-set_stone("st-timer", 23,10, {loop=true, action="onoff", target="illkill09", interval=3})
-set_stone("st-timer", 23,11, {loop=true, action="onoff", target="illkill10", interval=3})
+set_stone("st-timer", 23,2, {action="onoff", target="illkill01", interval=4})
+set_stone("st-timer", 23,3, {action="onoff", target="illkill02", interval=4})
+set_stone("st-timer", 23,4, {action="onoff", target="illkill03", interval=2})
+set_stone("st-timer", 23,5, {action="onoff", target="illkill04", interval=2})
+set_stone("st-timer", 23,6, {action="onoff", target="illkill05", interval=2})
+set_stone("st-timer", 23,7, {action="onoff", target="illkill06", interval=3})
+set_stone("st-timer", 23,8, {action="onoff", target="illkill07", interval=3})
+set_stone("st-timer", 23,9, {action="onoff", target="illkill08", interval=3})
+set_stone("st-timer", 23,10, {action="onoff", target="illkill09", interval=3})
+set_stone("st-timer", 23,11, {action="onoff", target="illkill10", interval=3})
 
 
 
@@ -323,27 +323,6 @@
 
 -- blackball
 set_actor("ac-blackball", 1.5, 1.5, {player=0})
-
--- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
--- -- you may edit beyond this point ! -- -- --
--- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
-
--- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
--- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
--- extralife:  for experimenting purposes -- --
--- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
--- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
--- set_item("it-extralife", 5,1)
--- set_item("it-extralife", 7,1)
--- set_item("it-extralife", 9,1)
--- set_item("it-extralife", 11,1)
--- set_item("it-extralife", 13,1)
--- set_item("it-extralife", 15,1)
--- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
--- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
--- delete minus signs infront of set_item -- --
--- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
--- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
     ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Modified: trunk/data/levels/enigma_ii/illmind05_1.xml
===================================================================
--- trunk/data/levels/enigma_ii/illmind05_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_ii/illmind05_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Laser Paradise" el:subtitle="" el:id="illmind05"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="illmind" el:email="support at mag-heut.net" el:homepage="http://www.mag-heut.net/"/>
       <el:copyright>Copyright ? 2005 illmind</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -93,37 +93,37 @@
 set_stone("st-laser", 1,9, {name="ill26", on=TRUE, dir=EAST})
 
 -- southbound laser triggers
-set_stone("st-timer", 42,1, {loop=true, action="onoff", target="ill02", interval=5})
-set_stone("st-timer", 42,2, {loop=true, action="onoff", target="ill03", interval=4})
-set_stone("st-timer", 42,3, {loop=true, action="onoff", target="ill04", interval=5})
-set_stone("st-timer", 42,4, {loop=true, action="onoff", target="ill05", interval=4})
-set_stone("st-timer", 42,5, {loop=true, action="onoff", target="ill06", interval=5})
-set_stone("st-timer", 42,6, {loop=true, action="onoff", target="ill07", interval=4})
-set_stone("st-timer", 42,7, {loop=true, action="onoff", target="ill08", interval=5})
-set_stone("st-timer", 42,8, {loop=true, action="onoff", target="ill09", interval=4})
+set_stone("st-timer", 42,1, {action="onoff", target="ill02", interval=5})
+set_stone("st-timer", 42,2, {action="onoff", target="ill03", interval=4})
+set_stone("st-timer", 42,3, {action="onoff", target="ill04", interval=5})
+set_stone("st-timer", 42,4, {action="onoff", target="ill05", interval=4})
+set_stone("st-timer", 42,5, {action="onoff", target="ill06", interval=5})
+set_stone("st-timer", 42,6, {action="onoff", target="ill07", interval=4})
+set_stone("st-timer", 42,7, {action="onoff", target="ill08", interval=5})
+set_stone("st-timer", 42,8, {action="onoff", target="ill09", interval=4})
 
 -- northbound laser triggers
-set_stone("st-timer", 43,1, {loop=true, action="onoff", target="ill10", interval=5})
-set_stone("st-timer", 43,2, {loop=true, action="onoff", target="ill11", interval=4})
-set_stone("st-timer", 43,3, {loop=true, action="onoff", target="ill12", interval=5})
-set_stone("st-timer", 43,4, {loop=true, action="onoff", target="ill13", interval=4})
-set_stone("st-timer", 43,5, {loop=true, action="onoff", target="ill14", interval=5})
-set_stone("st-timer", 43,6, {loop=true, action="onoff", target="ill15", interval=4})
-set_stone("st-timer", 43,7, {loop=true, action="onoff", target="ill16", interval=5})
-set_stone("st-timer", 43,8, {loop=true, action="onoff", target="ill17", interval=4})
+set_stone("st-timer", 43,1, {action="onoff", target="ill10", interval=5})
+set_stone("st-timer", 43,2, {action="onoff", target="ill11", interval=4})
+set_stone("st-timer", 43,3, {action="onoff", target="ill12", interval=5})
+set_stone("st-timer", 43,4, {action="onoff", target="ill13", interval=4})
+set_stone("st-timer", 43,5, {action="onoff", target="ill14", interval=5})
+set_stone("st-timer", 43,6, {action="onoff", target="ill15", interval=4})
+set_stone("st-timer", 43,7, {action="onoff", target="ill16", interval=5})
+set_stone("st-timer", 43,8, {action="onoff", target="ill17", interval=4})
 
 -- westbound laser triggers
-set_stone("st-timer", 44,1, {loop=true, action="onoff", target="ill18", interval=5})
-set_stone("st-timer", 44,2, {loop=true, action="onoff", target="ill19", interval=4})
-set_stone("st-timer", 44,3, {loop=true, action="onoff", target="ill20", interval=5})
-set_stone("st-timer", 44,4, {loop=true, action="onoff", target="ill21", interval=4})
-set_stone("st-timer", 44,5, {loop=true, action="onoff", target="ill22", interval=5})
+set_stone("st-timer", 44,1, {action="onoff", target="ill18", interval=5})
+set_stone("st-timer", 44,2, {action="onoff", target="ill19", interval=4})
+set_stone("st-timer", 44,3, {action="onoff", target="ill20", interval=5})
+set_stone("st-timer", 44,4, {action="onoff", target="ill21", interval=4})
+set_stone("st-timer", 44,5, {action="onoff", target="ill22", interval=5})
 
 -- eastbound laser triggers
-set_stone("st-timer", 45,1, {loop=true, action="onoff", target="ill23", interval=4})
-set_stone("st-timer", 45,2, {loop=true, action="onoff", target="ill24", interval=5})
-set_stone("st-timer", 45,3, {loop=true, action="onoff", target="ill25", interval=4})
-set_stone("st-timer", 45,4, {loop=true, action="onoff", target="ill26", interval=5, name="ill27"})
+set_stone("st-timer", 45,1, {action="onoff", target="ill23", interval=4})
+set_stone("st-timer", 45,2, {action="onoff", target="ill24", interval=5})
+set_stone("st-timer", 45,3, {action="onoff", target="ill25", interval=4})
+set_stone("st-timer", 45,4, {action="onoff", target="ill26", interval=5, name="ill27"})
 
 -- override trigger switch
 set_stone("st-switch", 20,7, {on=0, action="onoff", target="ill27"})

Modified: trunk/data/levels/enigma_ii/index.xml
===================================================================
--- trunk/data/levels/enigma_ii/index.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_ii/index.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10300" network="false" owner="Enigma Team" release="1" revision="33" title="Enigma II"/>
+  <info enigma="1.10" group="Enigma" location="10300" network="false" owner="Enigma Team" release="1" revision="34" title="Enigma II"/>
 
   <attributes/>
 
@@ -26,8 +26,8 @@
     <level _seq="18" _title="Send More Money" _xpath="./siegfried18_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level5f" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="19" _title="Stay in the Spotlight" _xpath="./nat24_1" author="Nat Pryce" ctrl="force" easy="false" id="nat24" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="20" _title="- Meditation -" _xpath="./andreas17_2" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas17" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="21" _title="Growing Boxes" _xpath="./luc26_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc26" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="22" _title="Kaleidoscope" _xpath="./duffy118_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy118" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="21" _title="Growing Boxes" _xpath="./luc26_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc26" rel="2" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="22" _title="Kaleidoscope" _xpath="./duffy118_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy118" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="23" _title="Enigmastermind" _xpath="./alain16_1" author="Alain Busser" ctrl="force" easy="false" id="alain16" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="24" _title="Gopher It" _xpath="./nat34_2" author="Nat Pryce" ctrl="force" easy="false" id="natmaze3" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="25" _title="Look Closely" _xpath="./martin102_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin102" rel="2" rev="1" score="1" target="time" unit="duration"/>
@@ -42,7 +42,7 @@
     <level _seq="34" _title="When Gravity Fails" _xpath="./nat10_2" author="Nat Pryce" ctrl="force" easy="false" id="nat10" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="35" _title="Alien Glyphs 2" _xpath="./duffy96_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy96" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="36" _title="Koosnab" _xpath="./rb02_2" author="Roberto Bardin" ctrl="force" easy="false" id="rb02" rel="2" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="37" _title="More Black Holes" _xpath="./luc18_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc18" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="37" _title="More Black Holes" _xpath="./luc18_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc18" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="38" _title="Alien Glyphs 3" _xpath="./duffy97_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy97" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="39" _title="Solar System" _xpath="./duffy98_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy98" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="40" _title="Space Meditation" _xpath="./duffy59_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy59" rel="2" rev="2" score="1" target="time" unit="duration"/>
@@ -59,14 +59,14 @@
     <level _seq="51" _title="Disk Royal" _xpath="./illmind02_1" author="illmind" ctrl="force" easy="false" id="illmind02" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="52" _title="Back And Forth" _xpath="./martin26_3" author="Martin Hawlisch" ctrl="force" easy="false" id="martin26" rel="3" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="53" _title="Spaceless" _xpath="./andreas02_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas02" rel="2" rev="3" score="1" target="time" unit="duration"/>
-    <level _seq="54" _title="Laser Paradise" _xpath="./illmind05_1" author="illmind" ctrl="force" easy="false" id="illmind05" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="54" _title="Laser Paradise" _xpath="./illmind05_1" author="illmind" ctrl="force" easy="false" id="illmind05" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="55" _title="Spaceleast" _xpath="./andreas15_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas15" rel="2" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="56" _title="Easy Shifting.." _xpath="./ralf01_1" author="Ralf Westram" ctrl="force" easy="false" id="ralf01" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="57" _title="Floppy Swapping" _xpath="./martin19_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin19" rel="2" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="58" _title="The Fuse" _xpath="./capkoh02_1" author="capkoh" ctrl="force" easy="false" id="capkoh02" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="58" _title="The Fuse" _xpath="./capkoh02_2" author="capkoh" ctrl="force" easy="false" id="capkoh02" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="59" _title="The Disappearing Block" _xpath="./duffy02_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy2" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="60" _title="- Meditation -" _xpath="./edward10_2" author="Edward" ctrl="force" easy="false" id="edward10" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="61" _title="Knight Moves" _xpath="./illmind04_1" author="illmind" ctrl="force" easy="false" id="illmind04" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="61" _title="Knight Moves" _xpath="./illmind04_1" author="illmind" ctrl="force" easy="false" id="illmind04" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="62" _title="Drunk" _xpath="./duffy38_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy38" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="63" _title="Do It Yourself" _xpath="./martin97_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin97" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="64" _title="Buridan" _xpath="./alain01_1" author="Alain Busser" ctrl="force" easy="false" id="alain01" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -99,7 +99,7 @@
     <level _seq="91" _title="It's Magic" _xpath="./martin27_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin27" rel="2" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="92" _title="Dirt Clod" _xpath="./xerxes02_1" author="Xerxes M. Dynatos" ctrl="force" easy="false" id="xerxes02" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="93" _title="Painting" _xpath="./siegfried21_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level6d" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="94" _title="Snowing" _xpath="./duffy120_2" author="Jacob Scott" ctrl="force" easy="true" id="duffy120" rel="2" rev="4" score="2" target="time" unit="duration"/>
+    <level _seq="94" _title="Snowing" _xpath="./duffy120_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy120" rel="3" rev="5" score="2" target="time" unit="duration"/>
     <level _seq="95" _title="Eraser Please!" _xpath="./martin39_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin39" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="96" _title="Friend or Foe?" _xpath="./andreas05_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas05" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="97" _title="Tool Time" _xpath="./barry03_1" author="Barry &amp; Lori Mead" ctrl="force" easy="false" id="barry03" rel="1" rev="2" score="1" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_ii/luc18_1.xml
===================================================================
--- trunk/data/levels/enigma_ii/luc18_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_ii/luc18_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,54 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="More Black Holes" el:subtitle="" el:id="luc18"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
-      <el:author  el:name="Lukas Sch?ller" el:email="Lucky_Luc at web.de" el:homepage=""/>
-      <el:copyright>Copyright ? 2005 Lukas Sch?ller</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-       <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:credits>Thanks to Petr Machata for his ant.lua script</el:credits>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
--- Environment
-cells={}
-cells[","]=cell{floor="fl-gravel"}
-cells[" "]=cell{floor="fl-space"}
-cells["#"]=cell{stone="st-invisible"}
-map_cell_meaning("x", cell{item={"it-wormhole", {targetx="0.5", targety="0.5", range=3, strength=10}}})
-level = {
-".###################",
-"#0    x      x    0#",
-"#                  #",
-"#   x    xx    x   #",
-"#                  #",
-"#      ,,,,,,      #",
-"#0  x  ,,,,,,  x  0#",
-"#      ,,,,,,      #",
-"#                  #",
-"#   x    xx    x   #",
-"#                  #",
-"#0    x      x    0#",
-"####################"
-}
-oxyd_default_flavor = "d"
-set_default_parent(cells[" "])
-create_world_by_map(level)
-oxyd_shuffle()
-set_actor("ac-blackball", 10,6.5, {player=0})
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_ii/luc18_2.xml (from rev 1802, trunk/data/levels/enigma_ii/luc18_1.xml)
===================================================================
--- trunk/data/levels/enigma_ii/luc18_1.xml	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/data/levels/enigma_ii/luc18_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -0,0 +1,47 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="More Black Holes" el:subtitle="" el:id="luc18"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Lukas Sch?ller" el:email="Lucky_Luc at web.de" el:homepage=""/>
+      <el:copyright>Copyright ? 2005 Lukas Sch?ller</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_space"}
+ti["-"] = {"fl_gravel"}
+ti["."] = {"fl_abyss", name="singularity"}
+ti["#"] = {"st_invisible"}
+ti["*"] = {"it_wormhole", range=3.0, strength=10.0, destination="singularity"}
+ti["O"] = {"st_oxyd", flavor="d"}
+ti["@"] = ti["-"] .. {"ac_marble_black", 0.0, 0.5}
+
+wo(ti, " ", {
+    ".###################",
+    "#O    *      *    O#",
+    "#                  #",
+    "#   *    **    *   #",
+    "#                  #",
+    "#      ------      #",
+    "#O  *  --- at --  *  O#",
+    "#      ------      #",
+    "#                  #",
+    "#   *    **    *   #",
+    "#                  #",
+    "#O    *      *    O#",
+    "####################"})
+
+wo:shuffleOxyd()
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_ii/luc26_1.xml
===================================================================
--- trunk/data/levels/enigma_ii/luc26_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_ii/luc26_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,112 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Growing Boxes" el:subtitle="" el:id="luc26"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
-      <el:author  el:name="Lukas Sch?ller" el:email="Lucky_Luc at web.de" el:homepage=""/>
-      <el:copyright>Copyright ? 2006 Lukas Sch?ller</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-function bad()
-  enigma.SendMessage(enigma.GetNamedObject("bridgeb"),"openclose",nil)
-  enigma.SendMessage(enigma.GetNamedObject("doord"),"openclose",nil)
-end
-function writeLine( line, cells)
-  for i=1, strlen(cells) do
-    local c = strsub(cells,i,i)
-    if(c =="#") then
-      set_stone("st-marble",i-1,line)
-    elseif(c =="h") then
-      set_stone("st-marble_hole",i-1,line)
-    elseif(c =="1") then
-      set_stone("st-greenbrown",i-1,line)
-    elseif(c =="2") then
-      set_stone("st-plain",i-1,line)
-    elseif(c ==".") then
-      set_floor("fl-abyss",i-1,line)
-    elseif(c =="-") then
-      set_floor("fl-bridge",i-1,line,{name="bridgeb"})
-    elseif(c =="s") then
-      set_item("it-seed",i-1,line)
-    elseif(c =="n") then
-      set_item("it-seed_nowood",i-1,line)
-    elseif(c =="v") then
-      set_item("it-seed_volcano",i-1,line)
-    elseif(c =="a") then
-      document(i-1,line,"text1")
-    elseif(c =="b") then
-      document(i-1,line,"text2")
-    elseif(c =="c") then
-      document(i-1,line,"text3")
-    elseif(c =="d") then
-      document(i-1,line,"text4")
-    elseif(c =="e") then
-      document(i-1,line,"text5")
-    elseif(c =="+") then
-      set_stone("st-wood",i-1,line)
-    elseif(c =="x") then
-      set_stone("st-grate1",i-1,line)
-      set_item("it-tinyhill",i-1,line)
-    elseif(c =="=") then
-      set_stone("st-door_a",i-1,line,{name="doord"})
-    elseif(c =="*") then
-      set_stone("st-switch",i-1,line,{action="callback",target="bad"})
-    elseif(c =="o") then
-      oxyd(i-1,line)
-    elseif(c =="0") then
-      set_actor("ac-blackball",i-0.5,line+0.5,{player=0})
-    end
-  end
-end
-
-CreateWorld(58,13)
-fill_floor("fl-tigris",0,0,58,13)
-----------------------------------
---Environment
-writeLine(00,"...................#########################+12###########")
-writeLine(01,"...................#..................#     snv        #o#")
-writeLine(02,"...................h.     #..       ..#                # #")
-writeLine(03,"...................h. + + #..       ..#                # #")
-writeLine(04,"...................h.     #..       ..#                # #")
-writeLine(05,"...................h.     #..s####  ..#                # #")
-writeLine(06,"..................sh. 0e+ xa.s=c*#  ..-d               . #")
-writeLine(07,"..................bh.     #..s####  ..#                # #")
-writeLine(08,"...................h.     #..       ..#                # #")
-writeLine(09,"...................h. + + #..       ..#                # #")
-writeLine(10,"...................h.     #..       ..#                # #")
-writeLine(11,"...................#..................#                #o#")
-writeLine(12,"...................#######################################")
-enigma.SendMessage(enigma.GetNamedObject("doord"),"openclose",nil)
-enigma.ConserveLevel = FALSE
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-      <el:string el:key="text1">
-        <el:english el:translate="true">You'd need a portable box!</el:english>
-      </el:string> 
-      <el:string el:key="text2">
-        <el:english el:translate="true">Congratulations! You found a seed! Try to use it behind the grate (and move away quickly)</el:english>
-      </el:string> 
-      <el:string el:key="text3">
-        <el:english el:translate="true">Remember that you can't fill a closed bridge with a box ...                                           but maybe you can use the 3rd seed differently!</el:english>
-      </el:string> 
-      <el:string el:key="text4">
-        <el:english el:translate="true">There are different kinds of seeds ... Try to use them!</el:english>
-      </el:string> 
-      <el:string el:key="text5">
-        <el:english el:translate="true" el:comment="read from the right">Noitcerid etisoppo eht yrt! Tuo syaw owt? Rorrim, rorrim ...</el:english>
-      </el:string> 
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_ii/luc26_2.xml (from rev 1802, trunk/data/levels/enigma_ii/luc26_1.xml)
===================================================================
--- trunk/data/levels/enigma_ii/luc26_1.xml	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/data/levels/enigma_ii/luc26_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -0,0 +1,72 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Growing Boxes" el:subtitle="" el:id="luc26"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Lukas Sch?ller" el:email="Lucky_Luc at web.de" el:homepage=""/>
+      <el:copyright>Copyright ? 2006 Lukas Sch?ller</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = false
+
+ti[" "] = {"fl_tigris"}
+ti["."] = {"fl_abyss"}
+ti["-"] = {"fl_bridge", name="bridge"}
+ti["#"] = {"st_redbrown"}
+ti["H"] = {"st_redbrown_hollow"}
+ti["X"] = {"st_grate", flavor="cross"} .. ti({"it_meditation_bump"})
+ti["+"] = {"st_box"}
+ti["G"] = {"st_greenbrown"}
+ti["V"] = {"st_flat"}
+ti["D"] = {"st_door", flavor="a", name="door", state=OPEN}
+ti["S"] = {"st_switch", target={"bridge", "door"}}
+ti["s"] = {"it_seed"}
+ti["n"] = {"it_seed", flavor="greenbrown"}
+ti["v"] = {"it_seed", flavor="volcano"}
+ti["doc"] = {"it_document", text="text%%"}
+ti["O"] = {"st_oxyd"}
+ti["@"] = {"#ac_marble"}
+
+wo(res.autotile(ti, {"1", "5", "doc"}), " ", {
+    "...................#########################+GV###########",
+    "...................#..................#     snv        #O#",
+    "...................H.     #..       ..#                # #",
+    "...................H. + + #..       ..#                # #",
+    "...................H.     #..       ..#                # #",
+    "...................H.     #..s####  ..#                # #",
+    "..................sH. @5+ X1.sD3S#  ..-4               . #",
+    "..................2H.     #..s####  ..#                # #",
+    "...................H.     #..       ..#                # #",
+    "...................H. + + #..       ..#                # #",
+    "...................H.     #..       ..#                # #",
+    "...................#..................#                #O#",
+    "...................#######################################"})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+      <el:string el:key="text%1">
+        <el:english el:translate="true">You'd need a portable box!</el:english>
+      </el:string>
+      <el:string el:key="text%2">
+        <el:english el:translate="true">Congratulations! You found a seed! Try to use it behind the grate (and move away quickly)</el:english>
+      </el:string>
+      <el:string el:key="text%3">
+        <el:english el:translate="true">Remember that you can't fill a closed bridge with a box ...                                           but maybe you can use the 3rd seed differently!</el:english>
+      </el:string>
+      <el:string el:key="text%4">
+        <el:english el:translate="true">There are different kinds of seeds ... Try to use them!</el:english>
+      </el:string>
+      <el:string el:key="text%5">
+        <el:english el:translate="true" el:comment="read from the right">Noitcerid etisoppo eht yrt! Tuo syaw owt? Rorrim, rorrim ...</el:english>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_iii/duffy29_1.xml
===================================================================
--- trunk/data/levels/enigma_iii/duffy29_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_iii/duffy29_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Run!" el:subtitle="" el:id="duffy29"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -443,7 +443,7 @@
     end
 end
 
-set_stone("st-timer", 21,0, {loop=true, action="callback", target="timer_callback", interval=.35})
+set_stone("st-timer", 21,0, {action="callback", target="timer_callback", interval=.35})
     ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Modified: trunk/data/levels/enigma_iii/duffy66_1.xml
===================================================================
--- trunk/data/levels/enigma_iii/duffy66_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_iii/duffy66_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Tilt Control" el:subtitle="" el:id="duffy66"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -24,12 +24,6 @@
 
 create_world( levelw, levelh)
 
---for i=0,20 do
---   for j=0,13 do
---      set_floor("fl-gradient",i,j,{type=20})
---   end
---end
-
 fill_floor("fl-normal", 0,0,levelw,levelh)
 
 enigma.SlopeForce=10
@@ -663,7 +657,7 @@
         end
     end
 
-    set_stone("st-timer", 20,0, {loop=true, action="callback", target="timer_callback", interval=0.1})
+    set_stone("st-timer", 20,0, {action="callback", target="timer_callback", interval=0.1})
 end
     ]]></el:luamain>
     <el:i18n>

Modified: trunk/data/levels/enigma_iii/duffy69_1.xml
===================================================================
--- trunk/data/levels/enigma_iii/duffy69_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_iii/duffy69_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Tilt Maze" el:subtitle="" el:id="duffy69"/>
-      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="4" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -615,7 +615,7 @@
     set_floor("fl-gradient",  16,  8, {type=24})
 end
 
-set_stone("st-timer", 39,0, {loop=true, action="callback", target="timer_callback", interval=0.1})
+set_stone("st-timer", 39,0, {action="callback", target="timer_callback", interval=0.1})
     ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Modified: trunk/data/levels/enigma_iii/index.xml
===================================================================
--- trunk/data/levels/enigma_iii/index.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_iii/index.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10400" network="false" owner="Enigma Team" release="1" revision="33" title="Enigma III"/>
+  <info enigma="1.10" group="Enigma" location="10400" network="false" owner="Enigma Team" release="1" revision="34" title="Enigma III"/>
 
   <attributes/>
 
@@ -83,16 +83,16 @@
     <level _seq="75" _title="Fox in the Henhouse" _xpath="./nat26_1" author="Nat Pryce" ctrl="force" easy="false" id="nat26" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="76" _title="Bumperball" _xpath="./duffy15_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy15" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="77" _title="Versailles" _xpath="./duffy112_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy112" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="78" _title="Run!" _xpath="./duffy29_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy29" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="78" _title="Run!" _xpath="./duffy29_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy29" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="79" _title="Dance with the Death" _xpath="./luc05_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc05" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="80" _title="Lock Them In" _xpath="./duffy26_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy26" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="81" _title="Remote Control" _xpath="./luc22_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc22" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="82" _title="Walk the Dog" _xpath="./luc04_2" author="Lukas Sch?ller" ctrl="force" easy="true" id="luc04" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="83" _title="In Sync" _xpath="./daniel06_2" author="Daniel Heck" ctrl="force" easy="false" id="daniel6" rel="2" rev="2" score="2" target="time" unit="duration"/>
-    <level _seq="84" _title="Tilt Control" _xpath="./duffy66_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy66" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="84" _title="Tilt Control" _xpath="./duffy66_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy66" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="85" _title="Lost In Space" _xpath="./martin90_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin90" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="86" _title="Triple Threat" _xpath="./illmind10_1" author="illmind" ctrl="force" easy="false" id="illmind10" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="87" _title="Tilt Maze" _xpath="./duffy69_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy69" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="87" _title="Tilt Maze" _xpath="./duffy69_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy69" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="88" _title="Think Fast" _xpath="./duffy85_2" author="Jacob Scott" ctrl="force" easy="true" id="duffy85" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="89" _title="Overshoot" _xpath="./ss02_1" author="Sven Siggelkow" ctrl="force" easy="true" id="ss2" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="90" _title="Fool the Watchdog" _xpath="./duffy57_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy57" rel="2" rev="2" score="1" target="time" unit="duration"/>
@@ -102,7 +102,7 @@
     <level _seq="94" _title="Build Up Speed" _xpath="./duffy55_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy55" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="95" _title="Jump And Run" _xpath="./siegfried40_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level6c" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="96" _title="Space Walk" _xpath="./nat35_2" author="Nat Pryce" ctrl="force" easy="false" id="natmaze4" rel="2" rev="0" score="2" target="time" unit="duration"/>
-    <level _seq="97" _title="Changing Positions" _xpath="./luc27_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc27" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="97" _title="Changing Positions" _xpath="./luc27_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc27" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="98" _title="Guardian Angel" _xpath="./duffy102_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy102" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="99" _title="Unfair!" _xpath="./ant33_1" author="Petr Machata" ctrl="force" easy="false" id="ant33" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="100" _title="Waterworld" _xpath="./illmind11_2" author="illmind" ctrl="force" easy="true" id="illmind11" rel="2" rev="6" score="2" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_iii/luc27_1.xml
===================================================================
--- trunk/data/levels/enigma_iii/luc27_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_iii/luc27_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,122 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Changing Positions" el:subtitle="" el:id="luc27"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
-      <el:author  el:name="Lukas Sch?ller" el:email="Lucky_Luc at web.de" el:homepage=""/>
-      <el:copyright>Copyright ? 2006 Lukas Sch?ller</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-done=0
-function change_grates()
-  if(done == 0) then
-    writeLine(03,"      k   x   k")
-    writeLine(04,"      k   x   k")
-    writeLine(05,"      k   x   k")
-    writeLine(06,"      k   x   k")
-    writeLine(07,"      k   x   k")
-    writeLine(08,"      k   x   k")
-    writeLine(09,"      k   x   k")
-    done=1
-  end
-end
-function writeLine( line, cells)
-  for i=1, strlen(cells) do
-    local c = strsub(cells,i,i)
-    if(c =="#") then
-      set_stone("st-rock8",i-1,line)
-    elseif(c =="~") then
-      set_floor("fl-water",i-1,line)
-    elseif(c =="+") then
-      set_stone("st-wood",i-1,line)
-    elseif(c =="*") then
-      set_stone("st-brownie",i-1,line)
-    elseif(c =="x") then
-      set_stone("st-grate1",i-1,line)
-    elseif(c =="s") then
-      set_stone("st-switch",i-1,line,{action="callback",target="change_grates"})
-    elseif(c =="A") then
-      set_stone("st-door",i-1,line,{name="doora",type="v"})
-    elseif(c =="B") then
-      set_stone("st-door",i-1,line,{name="doorb",type="v"})
-    elseif(c =="C") then
-      set_stone("st-door",i-1,line,{name="doorc",type="v"})
-    elseif(c =="D") then
-      set_stone("st-door",i-1,line,{name="doord",type="v"})
-    elseif(c =="E") then
-      set_stone("st-door",i-1,line,{name="doore",type="v"})
-    elseif(c =="F") then
-      set_stone("st-door",i-1,line,{name="doorf",type="v"})
-    elseif(c =="G") then
-      set_stone("st-door",i-1,line,{name="doorg",type="v"})
-    elseif(c =="H") then
-      set_stone("st-door",i-1,line,{name="doorh",type="v"})
-    elseif(c =="I") then
-      set_stone("st-door",i-1,line,{name="doori",type="v"})
-    elseif(c =="J") then
-      set_stone("st-door",i-1,line,{name="doorj",type="v"})
-    elseif(c =="a") then
-      set_item("it-trigger",i-1,line,{action="openclose",target="doora"})
-    elseif(c =="b") then
-      set_item("it-trigger",i-1,line,{action="openclose",target="doorb"})
-    elseif(c =="c") then
-      set_item("it-trigger",i-1,line,{action="openclose",target="doorc"})
-    elseif(c =="d") then
-      set_item("it-trigger",i-1,line,{action="openclose",target="doord"})
-    elseif(c =="e") then
-      set_item("it-trigger",i-1,line,{action="openclose",target="doore"})
-    elseif(c =="f") then
-      set_item("it-trigger",i-1,line,{action="openclose",target="doorf"})
-    elseif(c =="g") then
-      set_item("it-trigger",i-1,line,{action="openclose",target="doorg"})
-    elseif(c =="h") then
-      set_item("it-trigger",i-1,line,{action="openclose",target="doorh"})
-    elseif(c =="i") then
-      set_item("it-trigger",i-1,line,{action="openclose",target="doori"})
-    elseif(c =="j") then
-      set_item("it-trigger",i-1,line,{action="openclose",target="doorj"})
-    elseif(c =="k") then
-      kill_stone(i-1,line)
-    elseif(c =="o")  then
-      oxyd(i-1,line)
-    elseif(c =="0") then
-      set_actor("ac-blackball",i-0.5,line+0.5,{player=0})
-    end
-  end
-end
-
-CreateWorld(20,13)
-fill_floor("fl-sand",0,0,20,13)
-----------------------------------
---Environment
-writeLine(00,"####################")
-writeLine(01,"##########oABCDE ###")
-writeLine(02,"################~###")
-writeLine(03,"###ab#x   0   x#~###")
-writeLine(04,"###cd x ++ ** x~~###")
-writeLine(05,"###e #x++   **x~~###")
-writeLine(06,"##s  #x ++ ** x~ ###")
-writeLine(07,"### f#x++   **x~~###")
-writeLine(08,"###gh x ++ ** x~~###")
-writeLine(09,"###ij#x       x#~###")
-writeLine(10,"################~###")
-writeLine(11,"##########oFGHIJ ###")
-writeLine(12,"####################")
-enigma.ConserveLevel = FALSE
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_iii/luc27_2.xml (from rev 1802, trunk/data/levels/enigma_iii/luc27_1.xml)
===================================================================
--- trunk/data/levels/enigma_iii/luc27_1.xml	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/data/levels/enigma_iii/luc27_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -0,0 +1,59 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Changing Positions" el:subtitle="" el:id="luc27"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Lukas Sch?ller" el:email="Lucky_Luc at web.de" el:homepage=""/>
+      <el:copyright>Copyright ? 2006 Lukas Sch?ller</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = false
+
+ti[" "] = {"fl_sand"}
+ti["."] = {"fl_sand", name="newgrates#"}
+ti["~"] = {"fl_water"}
+ti["#"] = {"st_concrete"}
+ti["+"] = {"st_box"}
+ti["*"] = {"st_brownie"}
+ti["X"] = {"st_grate", flavor="cross", name="oldgrates#"}
+ti["door"] = {"st_door", flavor="d", faces="ew", name="door%%"}
+ti["trigger"] = {"it_trigger", target="door%%"}
+ti["S"] = {"st_switch", target="changegrates"}
+ti["O"] = {"st_oxyd"}
+ti["@"] = ti["."] .. {"#ac_marble_black"}
+
+wo(res.autotile(ti, {"A", "J", "door"}, {"a","j","trigger"}), " ", {
+    "####################",
+    "##########OABCDE ###",
+    "################~###",
+    "###ab#X   @   X#~###",
+    "###cd X ++.** X~~###",
+    "###e #X++ . **X~~###",
+    "##S  #X ++.** X~ ###",
+    "### f#X++ . **X~~###",
+    "###gh X ++.** X~~###",
+    "###ij#X   .   X#~###",
+    "################~###",
+    "##########OFGHIJ ###",
+    "####################"})
+
+wo:shuffleOxyd()
+
+function changegrates(value, sender)
+    wo[no["oldgrates#*"]] = {"st_nil"}
+    wo[no["newgrates#*"]] = {"st_grate", flavor="cross"}
+end
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_iv/index.xml
===================================================================
--- trunk/data/levels/enigma_iv/index.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_iv/index.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10500" network="false" owner="Enigma Team" release="1" revision="48" title="Enigma IV"/>
+  <info enigma="1.10" group="Enigma" location="10500" network="false" owner="Enigma Team" release="1" revision="49" title="Enigma IV"/>
 
   <attributes/>
 
@@ -61,7 +61,7 @@
     <level _seq="53" _title="Chain Reaction" _xpath="./siegfried17_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level5e" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="54" _title="Fire Safety" _xpath="./duffy83_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy83" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="55" _title="Easily Inflammable" _xpath="./martin95_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin95" rel="2" rev="0" score="2" target="time" unit="duration"/>
-    <level _seq="56" _title="The Builder" _xpath="./ss09_2" author="Sven Siggelkow" ctrl="force" easy="false" id="ss9" rel="2" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="56" _title="The Builder" _xpath="./ss09_2" author="Sven Siggelkow" ctrl="force" easy="false" id="ss9" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="57" _title="Run Like Hell" _xpath="./ralf09_2" author="Ralf Westram" ctrl="force" easy="false" id="ralf09" rel="2" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="58" _title="What a Mess" _xpath="./duffy68_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy68" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="59" _title="Sleeping Serpent" _xpath="./raoul10_2" author="Raoul Bourquin" ctrl="force" easy="false" id="raoul10" rel="2" rev="2" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_iv/ss09_2.xml
===================================================================
--- trunk/data/levels/enigma_iv/ss09_2.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_iv/ss09_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="The Builder" el:subtitle="" el:id="ss9"/>
-      <el:version el:score="2" el:release="2" el:revision="2" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="3" el:status="released"/>
       <el:author  el:name="Sven Siggelkow" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2003 Sven Siggelkow</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -58,7 +58,7 @@
       elseif c=="o" then
          set_item("it-seed_nowood", i-1,line)
       elseif c=="T" then
-         set_stone("st-timer", i-1,line, {loop = true, interval = 1, action="callback", target="end_fire"})
+         set_stone("st-timer", i-1,line, {interval = 1, action="callback", target="end_fire"})
       end
     end  
 end

Modified: trunk/data/levels/enigma_ix/devnull10_1.xml
===================================================================
--- trunk/data/levels/enigma_ix/devnull10_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_ix/devnull10_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,30 +3,30 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Flashback" el:subtitle="" el:id="devnull10"/>
-      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="4" el:status="released"/>
       <el:author  el:name="/dev/null" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2009 dev0</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
       <el:compatibility el:enigma="1.10"/>
       <el:modes el:easy="false" el:single="true" el:network="true"/>
-      <el:score el:easy="-" el:difficult="10:00"/>
+      <el:score el:easy="-" el:difficult="6:00"/>
     </el:info>
     <el:luamain><![CDATA[
 wo["ProvideExtralifes"] = false
 
 ti["  "] = {"fl_dark", adhesion = 0.8}
 ti[" ."] = {"fl_abyss"}
-ti["bridges"] = {"fl_bridge_gc", "bridge%%"}
 ti["shogunS"] = {"it_shogun_s", target = "bridge%%"}
-ti[" +"] = {"fl_bridge_gc", "oxydBridges#"}
 ti["1 "] = {"it_shogun_m", "shogunM#", target = {"toggleOxydBridges","bridge%Z", "bridge%Y"}, action = "signal"}
 ti["2 "] = {"it_shogun_m", "shogunM#", target = {"toggleOxydBridges","bridge%F", "bridge%G"}, action = "signal"}
 ti["3 "] = {"it_shogun_m", "shogunM#", target = {"toggleOxydBridges","bridge%X", "bridge%E", "bridge%W"}, action = "signal"}
+ti["bridges"] = {"fl_bridge_gc", "bridge%%"}
+ti[" +"] = {"fl_bridge_gc", "oxydBridges#"}
 ti["S "] = {"st_shogun_s"}
 ti["M "] = {"st_shogun_m"}
 ti["O "] = {"st_oxyd_b"}
-ti["* "] = {"#ac_marble_white"}
-ti["@ "] = {"#ac_marble_black"}
+ti["* "] = {"#ac_marble_white", essential = INDISPENSABLE}
+ti["@ "] = {"#ac_marble_black", essential = INDISPENSABLE}
 
 wo(res.composer(res.autotile(ti, {"s", "shogunS"}, {"-", "bridges"})), "  ", {
     " . . . . . . . . . . . . . . . . . . . .",

Modified: trunk/data/levels/enigma_ix/index.xml
===================================================================
--- trunk/data/levels/enigma_ix/index.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_ix/index.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="11100" network="false" owner="Enigma Team" release="1" revision="8" title="Enigma IX"/>
+  <info enigma="1.10" group="Enigma" location="11100" network="false" owner="Enigma Team" release="1" revision="9" title="Enigma IX"/>
 
   <attributes/>
 
@@ -13,7 +13,7 @@
     <level _seq="5" _title="Pinnacles I" _xpath="./mecke36_1" author="mecke" ctrl="force" easy="true" id="mecke36" rel="1" rev="16" score="1" target="time" unit="duration"/>
     <level _seq="6" _title="Symopal" _xpath="./andreas58_1" author="Andreas Lochmann, Ronald Lamprecht" ctrl="force" easy="true" id="andreas58" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="7" _title="The Pilgrim's Progress" _xpath="./pulley14_2" author="Mark Pulley" ctrl="force" easy="false" id="20080101pulley001" rel="2" rev="2" score="2" target="time" unit="duration"/>
-    <level _seq="8" _title="Logic Gates" _xpath="./pulley17_2" author="Mark Pulley" ctrl="force" easy="true" id="20080601pulley001" rel="2" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="8" _title="Logic Gates" _xpath="./pulley17_2" author="Mark Pulley" ctrl="force" easy="true" id="20080601pulley001" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="9" _title="Behind glass" _xpath="./rudolf01_1" author="Rudolf" ctrl="force" easy="false" id="rudolf01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="10" _title="Perennial Creek" _xpath="./pulley20_2" author="Mark Pulley" ctrl="force" easy="true" id="20080614pulley001" rel="2" rev="2" score="2" target="time" unit="duration"/>
     <level _seq="11" _title="Wired pulls" _xpath="./raoul36_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul36" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -27,7 +27,7 @@
     <level _seq="19" _title="Hip to be square" _xpath="./devnull37_1" author="/dev/null" ctrl="force" easy="true" id="devnull37" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="20" _title="Across The Waterbyss" _xpath="./harry03_1" author="daydreamer" ctrl="force" easy="false" id="harry03" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="21" _title="Collapsing Building" _xpath="./pulley28_1" author="Mark Pulley" ctrl="force" easy="true" id="20081018pulley001" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="22" _title="Flashback" _xpath="./devnull10_1" author="/dev/null" ctrl="force" easy="false" id="devnull10" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="22" _title="Flashback" _xpath="./devnull10_1" author="/dev/null" ctrl="force" easy="false" id="devnull10" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="23" _title="Pillar" _xpath="./raoul39_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul39" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="24" _title="The Inferno" _xpath="./duffy181" author="Jacob Scott" ctrl="force" easy="true" id="duffy181" rel="2" rev="20" score="1" target="time" unit="duration"/>
     <level _seq="25" _title="Caving" _xpath="./pulley31_1" author="Mark Pulley" ctrl="force" easy="false" id="20090424pulley001" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_ix/pulley17_2.xml
===================================================================
--- trunk/data/levels/enigma_ix/pulley17_2.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_ix/pulley17_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Logic Gates" el:subtitle="" el:id="20080601pulley001"/>
-      <el:version el:score="2" el:release="2" el:revision="2" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="3" el:status="released"/>
       <el:author  el:name="Mark Pulley" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Mark Pulley</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -79,7 +79,7 @@
 --          1    1    2    2    3    3    4    4    5    5    6    6    7    7    8    8
 --0    5    0    5    0    5    0    5    0    5    0    5    0    5    0    5    0    5
 
-wo:add({"ot_timer", target="rotate", state=ON, interval=0.1, loop=true})
+wo:add({"ot_timer", target="rotate", interval=0.1})
 wo:shuffleOxyd()
 
 function flip(value, sender)

Modified: trunk/data/levels/enigma_v/duffy71_2.xml
===================================================================
--- trunk/data/levels/enigma_v/duffy71_2.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_v/duffy71_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -188,7 +188,7 @@
     tt = mod (tt+1, 10)
 end
 
-set_stone("st-timer", 39,0, {loop=true, action="callback", target="timer_callback", interval=0.5})
+set_stone("st-timer", 39,0, {action="callback", target="timer_callback", interval=0.5})
     ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Modified: trunk/data/levels/enigma_v/index.xml
===================================================================
--- trunk/data/levels/enigma_v/index.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_v/index.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10600" network="false" owner="Enigma Team" release="1" revision="43" title="Enigma V"/>
+  <info enigma="1.10" group="Enigma" location="10600" network="false" owner="Enigma Team" release="1" revision="44" title="Enigma V"/>
 
   <attributes/>
 
@@ -11,7 +11,7 @@
     <level _seq="3" _title="Send me the keys !" _xpath="./alain09_1" author="Alain Busser" ctrl="force" easy="false" id="alain09" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="4" _title="Laser Path" _xpath="./andreas06_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas06" rel="2" rev="15" score="2" target="time" unit="duration"/>
     <level _seq="5" _title="Hobbyte" _xpath="./alain15_1" author="Alain Busser" ctrl="force" easy="false" id="alain15" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="6" _title="Water Castle" _xpath="./luc21_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc21" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="6" _title="Water Castle" _xpath="./luc21_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc21" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="7" _title="Moving Puzzles" _xpath="./luc13_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc13" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="8" _title="Spiders" _xpath="./ant26_1" author="Petr Machata" ctrl="force" easy="false" id="ant26" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="9" _title="Table Hockey" _xpath="./capkoh01_1" author="capkoh" ctrl="force" easy="false" id="capkoh01" rel="1" rev="1" score="1" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_v/luc21_1.xml
===================================================================
--- trunk/data/levels/enigma_v/luc21_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_v/luc21_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,77 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Water Castle" el:subtitle="" el:id="luc21"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
-      <el:author  el:name="Lukas Sch?ller" el:email="Lucky_Luc at web.de" el:homepage=""/>
-      <el:copyright>Copyright ? 2006 Lukas Sch?ller</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-box = 0
-function setBox()
-  if(box == 0) then
-    set_stone("st-wood",12,2)
-    box = 1
-  else
-    box = 0
-  end
-end
-
-function writeLine( line, cells)
-  for i=1, strlen(cells) do
-    local c = strsub(cells,i,i)
-    if(c =="#") then
-      set_stone("st-rock6",i-1,line)
-    elseif(c =="~") then
-      set_floor("fl-water",i-1,line)
-    elseif(c =="+") then
-      set_stone("st-wood",i-1,line)
-    elseif(c =="c") then
-      set_item("it-coin1",i-1,line)
-    elseif(c =="b") then
-      set_stone("st-coinslot",i-1,line,{action="callback",target="setBox"})
-    elseif(c =="o") then
-      oxyd(i-1,line)
-    elseif(c =="0") then
-      set_actor("ac-blackball",i-0.5,line+0.5,{player=0})
-      set_item("it-yinyang",i-1,line)
-    elseif(c =="1") then
-      set_actor("ac-whiteball",i-0.5,line+0.5,{player=1})
-      set_item("it-yinyang",i-1,line)
-    end
-  end
-end
-
-CreateWorld(20,13)
-fill_floor("fl-bluegray",0,0,20,13)
-writeLine(00,"~~~########b#####~~~")
-writeLine(01,"~~~#~    ~#  c ~#~~~")
-writeLine(02,"~~~#  +~  # 1c+ #~~~")
-writeLine(03,"~~~# ~  + # +c~ #~~~")
-writeLine(04,"~~~# +0 ~ # +c+~#~~~")
-writeLine(05,"~~~#  ~+  #~+c  #~~~")
-writeLine(06,"~~~#~    ~#~cc~ #~~~")
-writeLine(07,"~~~##### ### ####~~~")
-writeLine(08,"~~~o ~~~~~  ~  ~#~~~")
-writeLine(09,"~~~#~~~~~ ~  ~~ #~~~")
-writeLine(10,"~~~#~~~~#########~~~")
-writeLine(11,"~~~o~~~~     #~~#~~~")
-writeLine(12,"~~~#######o#o####~~~")
-oxyd_shuffle()
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_v/luc21_2.xml (from rev 1802, trunk/data/levels/enigma_v/luc21_1.xml)
===================================================================
--- trunk/data/levels/enigma_v/luc21_1.xml	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/data/levels/enigma_v/luc21_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -0,0 +1,55 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Water Castle" el:subtitle="" el:id="luc21"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Lukas Sch?ller" el:email="Lucky_Luc at web.de" el:homepage=""/>
+      <el:copyright>Copyright ? 2006 Lukas Sch?ller</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="true"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_bluegray"}
+ti["~"] = {"fl_water"}
+ti["#"] = {"st_purplegray"}
+ti["+"] = {"st_box"}
+ti["C"] = {"st_coinslot", target="getbox"}
+ti["c"] = {"it_coin"}
+ti["O"] = {"st_oxyd"}
+ti["A"] = {"#ac_marble_white"}
+ti["@"] = {"#ac_marble_black"}
+
+wo(ti, " ", {
+    "~~~########C#####~~~",
+    "~~~#~    ~#  c ~#~~~",
+    "~~~#  +~  # Ac+ #~~~",
+    "~~~# ~  + # +c~ #~~~",
+    "~~~# +@ ~ # +c+~#~~~",
+    "~~~#  ~+  #~+c  #~~~",
+    "~~~#~    ~#~cc~ #~~~",
+    "~~~##### ### ####~~~",
+    "~~~O ~~~~~  ~  ~#~~~",
+    "~~~#~~~~~ ~  ~~ #~~~",
+    "~~~#~~~~#########~~~",
+    "~~~O~~~~     #~~#~~~",
+    "~~~#######O#O####~~~"})
+
+wo:shuffleOxyd()
+
+function getbox(value, sender)
+    if value then
+        wo[sender+SSE] = ti["+"]
+    end
+end
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_vi/cel1_1.xml
===================================================================
--- trunk/data/levels/enigma_vi/cel1_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_vi/cel1_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -67,7 +67,7 @@
 
             -- the last room has no wormhole (no exit):
             if room_number == rooms_v*rooms_h then
-                -- Note: we will leave the two loops here and never an their "normal" end!
+                -- Note: we will leave the two loops here and never at their "normal" end!
                 return
             end
 

Modified: trunk/data/levels/enigma_vi/duffy116_1.xml
===================================================================
--- trunk/data/levels/enigma_vi/duffy116_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_vi/duffy116_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -73,13 +73,13 @@
         elseif c=="W" then
             fill_floor("fl-wood",i-1,line+1,5,8)
         elseif c=="T" then
-            set_stone("st-timer",i-1,line,{loop=true,interval=0.15,action="callback",target="funcc1"})
+            set_stone("st-timer",i-1,line,{interval=0.15,action="callback",target="funcc1"})
             set_floor("fl-gradient",i-1,line,{type=21})
         elseif c=="U" then
-            set_stone("st-timer",i-1,line,{loop=true,interval=0.15,action="callback",target="funcc3"})
+            set_stone("st-timer",i-1,line,{interval=0.15,action="callback",target="funcc3"})
             set_floor("fl-gradient",i-1,line,{type=21})
         elseif c=="V" then
-            set_stone("st-timer",i-1,line,{loop=true,interval=0.5,action="callback",target="funcc2"})
+            set_stone("st-timer",i-1,line,{interval=0.5,action="callback",target="funcc2"})
             set_floor("fl-gradient",i-1,line,{type=21})
         elseif c=="R" then
             set_stone("st-oneway", i-1,line, {orientation=enigma.EAST})

Modified: trunk/data/levels/enigma_vi/duffy144_1.xml
===================================================================
--- trunk/data/levels/enigma_vi/duffy144_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_vi/duffy144_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Rotor Guards" el:subtitle="Hoisting guards with their own petard" el:id="duffy144"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -71,7 +71,7 @@
         elseif c=="R" then
             set_stone("st-oneway-e", i-1,line)
         elseif c == "T" then
-            set_stone("st-timer",i-1,line,{loop=true,interval=0.1,action="callback",target="funcc1"})
+            set_stone("st-timer",i-1,line,{interval=0.1,action="callback",target="funcc1"})
         end
     end
 end

Modified: trunk/data/levels/enigma_vi/index.xml
===================================================================
--- trunk/data/levels/enigma_vi/index.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_vi/index.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10700" network="false" owner="Enigma Team" release="1" revision="51" title="Enigma VI"/>
+  <info enigma="1.10" group="Enigma" location="10700" network="false" owner="Enigma Team" release="1" revision="52" title="Enigma VI"/>
 
   <attributes/>
 
@@ -69,7 +69,7 @@
     <level _seq="61" _title="River of Challenges" _xpath="./luc33_1" author="Lukas Sch?ller" ctrl="force" easy="true" id="luc332006" rel="1" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="62" _title="Hot Hurdle Race" _xpath="./ulf04_1" author="Ulf Stegemann" ctrl="force" easy="true" id="20070124ulf019" rel="1" rev="93" score="1" target="time" unit="duration"/>
     <level _seq="63" _title="Playing with Lasers" _xpath="./just09_2" author="JuSt" ctrl="force" easy="false" id="just09_1" rel="2" rev="3" score="1" target="time" unit="duration"/>
-    <level _seq="64" _title="Rotor Guards" _xpath="./duffy144_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy144" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="64" _title="Rotor Guards" _xpath="./duffy144_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy144" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="65" _title="Knight's Journey" _xpath="./johannes02_2" author="Johannes Laire" ctrl="force" easy="false" id="20061210johannes313" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="66" _title="A Cooler Spot in Hell" _xpath="./andreas43_4" author="Andreas Lochmann" ctrl="force" easy="false" id="andreas43" rel="4" rev="7" score="3" target="time" unit="duration"/>
     <level _seq="67" _title="Check the light" _xpath="./just10_4" author="JuSt" ctrl="force" easy="false" id="just10" rel="4" rev="9" score="3" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_vii/duffy139_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/duffy139_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_vii/duffy139_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Caribbean Waters" el:subtitle="" el:id="duffy139"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -276,7 +276,7 @@
     step=0.3
 end
 
-set_stone("st-timer", 1, 1, {on=1,loop=true, action="callback", target="timer_callback", interval=step})
+set_stone("st-timer", 1, 1, {on=1, action="callback", target="timer_callback", interval=step})
     ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Modified: trunk/data/levels/enigma_vii/duffy147_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/duffy147_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_vii/duffy147_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Comet" el:subtitle="" el:id="duffy147"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -54,7 +54,7 @@
             set_actor("ac-killerball", i-.5,line+.5, {controllers=0})
             set_floor("fl-gradient",  i-1,  line, {type=4})
         elseif c=="T" then
-            set_stone("st-timer",i-1,line,{loop=true,interval=0.7,action="callback",target="funcc1"})
+            set_stone("st-timer",i-1,line,{interval=0.7,action="callback",target="funcc1"})
         end
     end
 end

Modified: trunk/data/levels/enigma_vii/duffy153_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/duffy153_2.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_vii/duffy153_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Laser Squad" el:subtitle="Fight the Light" el:id="duffy153"/>
-      <el:version el:score="2" el:release="2" el:revision="2" el:status="released"/>
+      <el:version el:score="2" el:release="2" el:revision="3" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -42,8 +42,8 @@
     "#aB@          cd A #",
     "########CD######b#o#"})
 
-wo:shuffleOxyd({"north#*", max = 0}, {"south#*", max = 0})
-wo:add({"ot_timer", state = ON, interval = 1.25, loop = true, target = "laser"})
+wo:shuffleOxyd({"north#*", max=0}, {"south#*", max=0})
+wo:add({"ot_timer", interval=1.25, target="laser"})
  ]]></el:luamain>
     <el:i18n>
       <el:string el:key="title">

Modified: trunk/data/levels/enigma_vii/duffy179_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/duffy179_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_vii/duffy179_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Armageddon" el:subtitle="" el:id="duffy179"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
+      <el:version el:score="1" el:release="1" el:revision="3" el:status="released"/>
       <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2007 Jacob Scott</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -162,9 +162,9 @@
             set_item("it-sensor",i-1,line,{action="callback",target="funcc2"})
             set_floor("fl-black",i-1,line,{burnable=TRUE,secure=TRUE,ignitable=TRUE})
         elseif c=="x" then
-            set_stone("st-timer",i-1,line,{on=0,loop=true,interval=random(random(800)+1)/20+0.2,action="callback",target="funcc3",name="t1"})
+            set_stone("st-timer",i-1,line,{on=0,interval=random(random(800)+1)/20+0.2,action="callback",target="funcc3",name="t1"})
         elseif c=="3" then
-            set_stone("st-timer",i-1,line,{on=0,loop=true,interval=random(random(600)+1)/20+0.2,action="callback",target="funcc4",name="t2"})
+            set_stone("st-timer",i-1,line,{on=0,interval=random(random(600)+1)/20+0.2,action="callback",target="funcc4",name="t2"})
         elseif c=="X" then
             set_stone("st-death",i-1,line)
         elseif c=="n" then
@@ -296,9 +296,9 @@
     enigma.SetAttrib(z1,"mouseforce",enigma.GetAttrib(z1,"mouseforce")+random(300)/400-.375)
     enigma.KillStone(0,0)
     if difficult then
-        set_stone("st-timer",0,0,{on=1,loop=true,interval=random(random(800)+1)/20+0.2,action="callback",target="funcc3",name="t1"})
+        set_stone("st-timer",0,0,{on=1,interval=random(random(800)+1)/20+0.2,action="callback",target="funcc3",name="t1"})
     else
-        set_stone("st-timer",0,0,{on=1,loop=true,interval=random(random(1600)+1)/20+0.2,action="callback",target="funcc3",name="t1"})
+        set_stone("st-timer",0,0,{on=1,interval=random(random(1600)+1)/20+0.2,action="callback",target="funcc3",name="t1"})
     end
 end
 
@@ -316,7 +316,7 @@
         end
     end
     enigma.KillStone(1,0)
-    set_stone("st-timer",1,0,{on=1,loop=true,interval=random(random(600)+1)/20+0.2,action="callback",target="funcc4",name="t2"})
+    set_stone("st-timer",1,0,{on=1,interval=random(random(600)+1)/20+0.2,action="callback",target="funcc4",name="t2"})
 end
 
 done=false

Modified: trunk/data/levels/enigma_vii/index.xml
===================================================================
--- trunk/data/levels/enigma_vii/index.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_vii/index.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,22 +1,22 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10800" network="false" owner="Enigma Team" release="1" revision="56" title="Enigma VII"/>
+  <info enigma="1.10" group="Enigma" location="10800" network="false" owner="Enigma Team" release="1" revision="57" title="Enigma VII"/>
 
   <attributes/>
 
   <levels>
     <level _seq="1" _title="Welcome" _xpath="./welcometopack7_2" author="Raoul Bourquin" ctrl="force" easy="true" id="welcometopack7" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="2" _title="Diving" _xpath="./joona13_1" author="Joona Laire" ctrl="force" easy="true" id="20061203joona500" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="3" _title="Comet" _xpath="./duffy147_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy147" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="4" _title="Caribbean Waters" _xpath="./duffy139_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy139" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="3" _title="Comet" _xpath="./duffy147_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy147" rel="1" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="4" _title="Caribbean Waters" _xpath="./duffy139_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy139" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="5" _title="DownDown" _xpath="./joona01_2" author="Joona Laire" ctrl="force" easy="true" id="20070406joona005" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="6" _title="Exclusive Pole Positions" _xpath="./duffy149_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy149" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="7" _title="Mirror Sharing" _xpath="./duffy150_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy150" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="8" _title="Temple of Ganesha" _xpath="./duffy154_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy154" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="9" _title="Open Path" _xpath="./duffy152_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy152" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="10" _title="- Meditation -" _xpath="./edward30_1" author="Edward" ctrl="force" easy="true" id="edward30" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="11" _title="Laser Squad" _xpath="./duffy153_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy153" rel="2" rev="2" score="2" target="time" unit="duration"/>
+    <level _seq="11" _title="Laser Squad" _xpath="./duffy153_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy153" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="12" _title="Free Riders" _xpath="./duffy155_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy155" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="13" _title="Oneway for White" _xpath="./duffy157_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy157" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="14" _title="The Wild Hunt" _xpath="./duffy159_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy159" rel="1" rev="1" score="1" target="time" unit="duration"/>
@@ -61,19 +61,19 @@
     <level _seq="53" _title="Give Way" _xpath="./just20_2" author="JuSt" ctrl="force" easy="false" id="just20" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="54" _title="Give more Way" _xpath="./just21_2" author="JuSt" ctrl="force" easy="true" id="just21" rel="2" rev="4" score="2" target="time" unit="duration"/>
     <level _seq="55" _title="Give Way 4 two" _xpath="./just22_2" author="JuSt" ctrl="force" easy="true" id="just22" rel="2" rev="3" score="2" target="time" unit="duration"/>
-    <level _seq="56" _title="Lost in Time and Space" _xpath="./just23_2" author="JuSt" ctrl="force" easy="false" id="just23" rel="2" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="56" _title="Lost in Time and Space" _xpath="./just23_2" author="JuSt" ctrl="force" easy="false" id="just23" rel="2" rev="6" score="2" target="time" unit="duration"/>
     <level _seq="57" _title="Alternatives?" _xpath="./just24_1" author="JuSt" ctrl="force" easy="true" id="just24" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="58" _title="No More Alternatives" _xpath="./just25_1" author="JuSt" ctrl="force" easy="true" id="just25" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="59" _title="The Walls" _xpath="./just26_1" author="JuSt" ctrl="force" easy="true" id="just26" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="59" _title="The Walls" _xpath="./just26_2" author="JuSt" ctrl="force" easy="true" id="just26" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="60" _title="Pull the Puller" _xpath="./just28_1" author="JuSt" ctrl="force" easy="false" id="just28" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="61" _title="Double Sense" _xpath="./joe14_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe14" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="62" _title="Double Sense II" _xpath="./joe15_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe15" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="63" _title="Lightyears" _xpath="./duffy177_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy177" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="64" _title="Zero Magnetism Lab" _xpath="./duffy178_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy178" rel="1" rev="5" score="1" target="time" unit="duration"/>
-    <level _seq="65" _title="Armageddon" _xpath="./duffy179_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy179" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="65" _title="Armageddon" _xpath="./duffy179_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy179" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="66" _title="Mountain Climbing II" _xpath="./joe25_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe25" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="67" _title="Minor Tangler" _xpath="./joe24_2" author="Joseph Dunne" ctrl="force" easy="false" id="joe24" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="68" _title="Circulation" _xpath="./pulley03_3" author="Mark Pulley" ctrl="force" easy="false" id="pulley03" rel="3" rev="5" score="2" target="time" unit="duration"/>
+    <level _seq="68" _title="Circulation" _xpath="./pulley03_3" author="Mark Pulley" ctrl="force" easy="false" id="pulley03" rel="3" rev="6" score="2" target="time" unit="duration"/>
     <level _seq="69" _title="Maze for Two" _xpath="./ral22_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20071017ral096" rel="2" rev="182" score="1" target="time" unit="duration"/>
     <level _seq="70" _title="Making Shapes" _xpath="./joe18_2" author="Joseph Dunne" ctrl="force" easy="false" id="joe18" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="71" _title="Clever Pushing" _xpath="./joe19_2" author="Joseph Dunne" ctrl="force" easy="false" id="joe19" rel="2" rev="1" score="2" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_vii/just23_2.xml
===================================================================
--- trunk/data/levels/enigma_vii/just23_2.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_vii/just23_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
      <el:identity el:title="Lost in Time and Space" el:subtitle="" el:id="just23"/>
-     <el:version el:score="2" el:release="2" el:revision="5" el:status="released"/>
+     <el:version el:score="2" el:release="2" el:revision="6" el:status="released"/>
      <el:author  el:name="JuSt" el:email="" el:homepage=""/>
      <el:copyright>Copyright ? 2007 JuSt</el:copyright>
      <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -1748,7 +1748,7 @@
 set_stone("st-key_c", 34, 74, {action="openclose", target="door5"})
 set_stone("st-door_b", 35, 74, {name="door5"})
 set_stone("st-laser", 18, 77, {name="laser50", dir=WEST, on=0})
-set_stone("st-timer", 143, 78, {action="callback", target="start_timing", interval=2, name="timer1", loop=true})
+set_stone("st-timer", 143, 78, {action="callback", target="start_timing", interval=2, name="timer1"})
 set_stone("st-laser", 18, 80, {name="laser51", dir=WEST, on=0})
 set_stones("st-oxyd", {{149, 89}, {149, 91}})
 set_stone("st-actorimpulse_invisible", 32, 19)

Deleted: trunk/data/levels/enigma_vii/just26_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/just26_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_vii/just26_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -1,65 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-     <el:identity el:title="The Walls" el:subtitle="" el:id="just26"/>
-     <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
-     <el:author  el:name="JuSt" el:email="" el:homepage=""/>
-     <el:copyright>Copyright ? 2007 JuSt</el:copyright>
-     <el:license el:type="GPL v2.0 or above" el:open="true"/>
-     <el:compatibility el:enigma="1.01">
-     </el:compatibility>
-     <el:modes el:easy="true" el:single="true" el:network="false"/>
-     <el:comments>
-     </el:comments>
-     <el:score el:easy="4:04" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-enigma.MouseFactor = 2.0
-enigma.FrictionFactor = 2.0
-enigma.ConserveLevel = 0
-
-create_world(20, 13)
-oxyd_default_flavor="b"
-
--- Floor Layer
-fill_floor("fl-black")
-draw_floor("fl-water", {1, 1}, {0, 1}, 5)
-
--- Item Layer
-set_item("it-trigger", 0, 1, {action="on", target="laser"})
-if not difficult then
-    set_item("it-wrench", 18, 2)
-end
-
--- Stone Layer
-oxyd(0, 4)
-oxyd(0, 2)
-draw_stones("st-glass2", {0, 0}, {1, 0}, 20)
-draw_stones("st-glass2", {19, 1}, {0, 1}, 12)
-draw_stones("st-glass", {1, 2}, {0, 1}, 4)
-draw_stones("st-glass2", {3, 2}, {0, 1}, 8)
-draw_stones("st-glass2", {7, 2}, {0, 1}, 8)
-draw_stones("st-glass2", {11, 2}, {0, 1}, 8)
-draw_stones("st-glass2", {15, 2}, {0, 1}, 8)
-draw_stones("st-glass2", {0, 5}, {0, 1}, 8)
-draw_stones("st-glass2", {1, 12}, {1, 0}, 18)
-set_stone("st-mirror-3>", 0, 3)
-set_stones("st-mirror-p\\", {{4, 3}, {12, 4}, {4, 6}, {12, 8}})
-set_stones("st-mirror-p/", {{16, 3}, {8, 4}, {8, 6}, {16, 8}})
-set_stone("st-laser-w", 18, 3, {name="laser", on=0})
-set_stone("st-rotator_move-left", 12, 10)
-set_stone("st-pull", 1, 11)
-
--- Actor Layer
-set_actor("ac-blackball", 2.5, 10.5, {player=0, mouseforce=1})
-
-oxyd_shuffle()
-  ]]></el:luamain>
-    <el:i18n>
-     <el:string el:key="title">
-       <el:english el:translate="false"/>
-     </el:string>
-   </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_vii/just26_2.xml (from rev 1802, trunk/data/levels/enigma_vii/just26_1.xml)
===================================================================
--- trunk/data/levels/enigma_vii/just26_1.xml	2009-09-09 00:09:24 UTC (rev 1802)
+++ trunk/data/levels/enigma_vii/just26_2.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -0,0 +1,54 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="The Walls" el:subtitle="" el:id="just26"/>
+      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
+      <el:author  el:name="JuSt" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2007 JuSt</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="4:04" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = false
+
+ti[" "] = {"fl_dark"}
+ti["~"] = {"fl_water"}
+ti["#"] = {"st_darkglass"}
+ti["G"] = ti["~"] .. {"st_rawglass"}
+ti["<"] = {"st_laser", orientation=WEST, state=OFF, name="laser"}
+ti[">"] = {"st_mirror", flavor="triangle", orientation=EAST}
+ti["M"] = {"st_mirror", orientation=SLASH}
+ti["N"] = {"st_mirror", orientation=BACKSLASH}
+ti["P"] = {"st_pull"}
+ti["R"] = {"st_rotator_ccw", movable=true}
+ti["t"] = {"it_trigger", target="laser"}
+ti["w"] = cond(wo["IsDifficult"], ti[" "], {"it_wrench"})
+ti["O"] = {"st_oxyd"}
+ti["@"] = {"#ac_marble"}
+
+wo(ti, " ", {
+    "####################",
+    "t~                 #",
+    "OG #   #   #   #  w#",
+    ">G #N  #   #   #M <#",
+    "OG #   #M  #N  #   #",
+    "#G #   #   #   #   #",
+    "#  #N  #M  #   #   #",
+    "#  #   #   #   #   #",
+    "#  #   #   #N  #M  #",
+    "#  #   #   #   #   #",
+    "# @         R      #",
+    "#P                 #",
+    "####################"})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_vii/pulley03_3.xml
===================================================================
--- trunk/data/levels/enigma_vii/pulley03_3.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_vii/pulley03_3.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -3,7 +3,7 @@
   <el:protected>
     <el:info el:type="level">
       <el:identity el:title="Circulation" el:subtitle="" el:id="pulley03"/>
-      <el:version el:score="2" el:release="3" el:revision="5" el:status="released"/>
+      <el:version el:score="2" el:release="3" el:revision="6" el:status="released"/>
       <el:author  el:name="Mark Pulley" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Mark Pulley</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
@@ -42,7 +42,7 @@
 ti["y "] = ti({"st_stoneimpulse_hollow"}) .. {"fl_slope_isw"} -- Down and left - gut
 ti["z "] = ti({"it_bottle_broken"}) .. {"fl_pinkbumps"}
 
-ti["B "] = {"st_timer", loop=true,interval=10,action="signal",target="peristalsis"}
+ti["B "] = {"st_timer", interval=10, action="signal", target="peristalsis"}
 ti["D "] = {"st_oneway_white", state=SOUTH}
 ti["E "] = ti({"st_oneway_black", state=EAST}) .. {"fl_slope_te"}
 ti["F "] = {"fl_gravel"} -- Foot
@@ -85,7 +85,7 @@
 ti[") "] = {"fl_slope_inw"} -- Up and left
 
 ti["` "] = ti({"it_strip_ne"}) .. {"fl_water"}
-ti["~ "] = {"st_timer", loop=true,interval=0.25,action="callback",target="heartbeat"}
+ti["~ "] = {"st_timer", interval=0.25, action="callback", target="heartbeat"}
 ti["_ "] = ti({"it_strip_es"}) .. {"fl_water"}
 ti["= "] = {"fl_tigris"} -- Gut
 ti["[ "] = ti({"it_strip_ew"}) .. {"fl_water"}

Modified: trunk/data/levels/enigma_viii/devnull03_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/devnull03_1.xml	2009-09-09 22:10:36 UTC (rev 1803)
+++ trunk/data/levels/enigma_viii/devnull03_1.xml	2009-09-09 23:32:58 UTC (rev 1804)
@@ -89,55 +89,45 @@
 ti["2"] = ti["J"] .. {"it_trigger", name = "trigger02", action = "callback", target = "bridge02"}
 ti["3"] = {"it_trigger", name = "trigger03", action = "callback", target = "bridge03"}
 ti["!"] = ti["."] .. {"it_sensor", name = "sensor01", action = "open", target = "bridge02#*", invisible = true}
-ti["@"] = ti["."] .. {"#ac_marble_black", owner = YIN}
-ti["*"] = ti["."] .. {"#ac_marble_white", owner = YANG}
+ti["@"] = ti["."] .. {"#ac_marble_black"}
+ti["*"] = ti["."] .. {"#ac_marble_white"}
+ti["~"] = {"fl_bluegray"}
+ti["("] = {"fl_bridge_gc", state = CLOSED}
+ti[";"] = ti["("] .. {"it_yinyang"}
+ti["R"] = ti["~"] .. {"it_document", text = "doc2"}
+ti["&"] = ti["."] .. {"it_wormhole", destination = po(94.5, 6.5), strength = 1.0, range = 1.0}
+ti["["] = ti["("] .. {"it_sensor", name = "sensorEW01", action = "callback", target ="sensorEasyWhite01", invisible = true}
+ti["]"] = ti["."] .. {"it_sensor", name = "sensorEB01", action = "callback", target ="sensorEasyBlack01", invisible = true}
 
-if wo["IsDifficult"] ~= TRUE then
-    ti["~"] = {"fl_bluegray"}
-    ti["("] = {"fl_bridge_gc", state = CLOSED}
-    ti[";"] = ti["("] .. {"it_yinyang"}
-    ti["R"] = ti["~"] .. {"it_document", text = "doc2"}
-    ti["&"] = ti["."] .. {"it_wormhole", destination = po(94.5, 6.5), strength = 1.0, range = 1.0}
-    ti["["] = ti["("] .. {"it_sensor", name = "sensorEW01", action = "callback", target ="sensorEasyWhite01", invisible = true}
-    ti["]"] = ti["."] .. {"it_sensor", name = "sensorEB01", action = "callback", target ="sensorEasyBlack01", invisible = true}
-end
-
 mainMap = wo:newMap(" ",
---                    #                  #                  #                  #                  #
--- 0         1         2         3         4         5         6         7         8         9
--- 012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345
-{ "##n##################################l                    ###########iI######################gG#", --  0
-  "# p                                                                     ..w   w w            pu#", --  1
-  "#          2                                                            ..wwwwww..             #", --  2
-  "# ....                ... ............                                  ....    w      ...   Wt#", --  3
-  "# ..-.                .           9                                         #  q       .r.   w #", --  4
-  "#......               7           w                        ..               # x x      ..w   .w#", --  5
-  "#*w....    .........!w.           .                       www               # .              w@#", --  6
-  "#%w   .    .....r...!.y888v       .                       ...               #  w      .w.    ww#", --  7
-  "#..   ..w...........!w.           .                       ......w w.w..     h ww0...55.w.  w   h", --  8
-  "#............         8           f                       ...        y.     H   w     .ww      H", --  9
-  "#      ......         .           9                       xx        .       x.ww-     ... w.  :#", -- 10
-  "#                      ..............S                    ..........X.X.....X w .             e#", -- 11
-  "######################################                    k#####################################", -- 12
-  "#                                    #########.##.#########                                    #", -- 13
-  "#                                     #......#.##.#......#                                     #", -- 14
-  "#                                     #..o...#=##=#...o..#                                     #", -- 15
-  "#                                     #...o..#.##.#..o...#                                     #", -- 16
-  "#######################################..o...# ## #...o..#                                     #", -- 17
-  "#;((((((((((((([~~R~R~~].............&#...o....##....o...#                                     #", -- 18
-  "#######################################..o...######...o..#                                     #", -- 19
-  "#                                     #...o..#    #..o...#                                     #", -- 20
-  "#                                     #..o...#    #...o..#                                     #", -- 21
-  "#                                     #...o..#    #..o...#                                     #", -- 22
-  "#                                     #......#z  z#......#                                     #", -- 23
-  "################################################################################################"  -- 24
--- 0         1         2         3         4         5         6         7         8
--- 012345678901234567890123456789012345678901234567890123456789012345678901234567890
+{ "##n##################################l                    ###########iI######################gG#",
+  "# p                                                                     ..w   w w            pu#",
+  "#          2                                                            ..wwwwww..             #",
+  "# ....                ... ............                                  ....    w      ...   Wt#",
+  "# ..-.                .           9                                         #  q       .r.   w #",
+  "#......               7           w                        ..               # x x      ..w   .w#",
+  "#*w....    .........!w.           .                       www               # .              w@#",
+  "#%w   .    .....r...!.y888v       .                       ...               #  w      .w.    ww#",
+  "#..   ..w...........!w.           .                       ......w w.w..     h ww0...55.w.  w   h",
+  "#............         8           f                       ...        y.     H   w     .ww      H",
+  "#      ......         .           9                       xx        .       x.ww-     ... w.  :#",
+  "#                      ..............S                    ..........X.X.....X w .             e#",
+  "######################################                    k#####################################",
+  "#                                    #########.##.#########                                    #",
+  "#                                     #......#.##.#......#                                     #",
+  "#                                     #..o...#=##=#...o..#                                     #",
+  "#                                     #...o..#.##.#..o...#                                     #",
+  "#######################################..o...# ## #...o..#                                     #",
+  "#;((((((((((((([~~R~R~~].............&#...o....##....o...#                                     #",
+  "#######################################..o...######...o..#                                     #",
+  "#                                     #...o..#    #..o...#                                     #",
+  "#                                     #..o...#    #...o..#                                     #",
+  "#                                     #...o..#    #..o...#                                     #",
+  "#                                     #......#z  z#......#                                     #",
+  "################################################################################################"
 })
 
 easyCenterWhiteMap = wo:newMap(" ",
-  -- 3 4         5         6
-  -- 89012345678901234567890
   { "####################",
     "# 3                #",
     "    x              #",
@@ -154,8 +144,6 @@
   })
 
 easyCenterBlackMap = wo:newMap(" ",
-  -- 3 4         5         6
-  -- 89012345678901234567890
   { "####################",
     "#                1 #",
     "#              x    ",
@@ -172,8 +160,6 @@
   })
 
 normalCenterMap = wo:newMap(" ",
-  -- 3 4         5         6
-  -- 89012345678901234567890
   { "####################",
      "# 3              1 #",
      "    x    ><    x    ",



From raoulb at bluewin.ch  Sat Sep 12 01:01:14 2009
From: raoulb at bluewin.ch (Raoul)
Date: Sat, 12 Sep 2009 01:01:14 +0200
Subject: [Enigma-game-svn] r1805
Message-ID: <20090912010114.79243d23@loipc.loinet.home>

-> Level loading errors caused by attribute type validator fix part II
--> Now all levels should load again
-> Some other level rewrites


From ral at mail.berlios.de  Sun Sep 13 00:02:05 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Sun, 13 Sep 2009 00:02:05 +0200
Subject: [Enigma-game-svn] r1806 - in trunk: data src src/items src/others
Message-ID: <200909122202.n8CM25YI010437@sheep.berlios.de>

Author: ral
Date: 2009-09-13 00:02:03 +0200 (Sun, 13 Sep 2009)
New Revision: 1806

Modified:
   trunk/data/api1init.lua
   trunk/data/api2init.lua
   trunk/src/WorldProxy.cc
   trunk/src/items/SimpleItems.cc
   trunk/src/others/Rubberband.cc
   trunk/src/server.cc
   trunk/src/server.hh
Log:
Trunk 1.1: 
- fix bool attribute "scissor" and "static" mapping old API to new API
- fix ot_rubberband default attribute values
- add global attribute "SubSoil", values SUBSOIL_ABYSS (default), 
    SUBSOIL_WATER, SUBSOIL_AUTO:
    - bomb explosion dissolve floor to this subsoil floor
    - auto dissolves to water if one of the 4 neighbour floors is water,
      otherwise to abyss


Modified: trunk/data/api1init.lua
===================================================================
--- trunk/data/api1init.lua	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/api1init.lua	2009-09-12 22:02:03 UTC (rev 1806)
@@ -896,6 +896,12 @@
      if key == "loop" then
          if val == 1 then _val = true else _val = false end
      end
+     if key == "scissor" then
+         if val == 1 then _val = true else _val = false end
+     end
+     if key == "static" then
+         if val == 1 then _val = true else _val = false end
+     end
      if key == "orientation" and _obj_name == "st-mirror" then
          _val = (6 - val) % 4
      end

Modified: trunk/data/api2init.lua
===================================================================
--- trunk/data/api2init.lua	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/api2init.lua	2009-09-12 22:02:03 UTC (rev 1806)
@@ -192,6 +192,11 @@
 COIN_IGNORE = -1
 COIN_REJECT = -2
 
+-- subsoil
+SUBSOIL_ABYSS = 0
+SUBSOIL_WATER = 1
+SUBSOIL_AUTO  = 2
+
 -- follower
 FOLLOW_NO     = 0
 FOLLOW_SCROLL = 1

Modified: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/src/WorldProxy.cc	2009-09-12 22:02:03 UTC (rev 1806)
@@ -112,6 +112,8 @@
             return server::RubberViolationStrength;
         } else if (key == "SlopeStrength") {
             return server::SlopeForce;
+        } else if (key == "SubSoil") {
+            return server::SubSoil;
         } else if (key == "SwampSinkTime") {
             if (server::SwampSinkSpeed > 0) {
                 if (server::SwampSinkSpeed >= 10000)
@@ -221,6 +223,10 @@
             server::RubberViolationStrength = val;
         } else if (key == "SlopeStrength") {
             server::SlopeForce = val;
+        } else if (key == "SubSoil") {
+            server::SubSoil = val;
+            ASSERT(server::SubSoil >= 0 && server::SubSoil <= 2, XLevelRuntime,
+                    "Attribute 'SubSoil' value is out of range.");
         } else if (key == "SwampSinkTime") {
             if (val.getType() == Value::NIL)
                 server::SwampSinkSpeed = 0;

Modified: trunk/src/items/SimpleItems.cc
===================================================================
--- trunk/src/items/SimpleItems.cc	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/src/items/SimpleItems.cc	2009-09-12 22:02:03 UTC (rev 1806)
@@ -166,8 +166,21 @@
                 replace("it_meditation_hollow");
             else if (state == 2)
                 replace("it_crack_m_water");
-            else
-                replace("it_debris");
+            else {
+                bool isAbyss = true;
+                if (server::SubSoil == 1)
+                    isAbyss = false;
+                else if (server::SubSoil == 2) {
+                    for (Direction d = NORTH; d != NODIR; d = previous(d)) {
+                        Floor *fl = GetFloor(move(get_pos(), d));
+                        if (fl != NULL && fl->getClass() == "fl_water") {
+                            isAbyss = false;
+                            break;
+                        }
+                    }
+                }
+                replace(isAbyss ? "it_debris" : "it_debris_water");
+            }
         else
             kill();
      }

Modified: trunk/src/others/Rubberband.cc
===================================================================
--- trunk/src/others/Rubberband.cc	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/src/others/Rubberband.cc	2009-09-12 22:02:03 UTC (rev 1806)
@@ -25,7 +25,7 @@
 #include "world.hh"
 
 namespace enigma {
-    Rubberband::Rubberband() {
+    Rubberband::Rubberband() : strength (10), outerThreshold (1), innerThreshold (0), minLength (0), maxLength (0) {
     }
     
     std::string Rubberband::getClass() const {
@@ -54,9 +54,9 @@
             } else
                 ASSERT(false, XLevelRuntime, "Rubberband: 'anchor2' is neither actor nor stone");
         } else if (key == "strength") {
-            strength = val;
+            strength =  (val.getType() == Value::NIL) ? 10.0 : (double)val;
         } else if (key == "length") {
-            outerThreshold = val;
+            outerThreshold = (val.getType() == Value::NIL) ? 1.0 : (double)val;
             ASSERT(outerThreshold >= 0, XLevelRuntime, "Rubberband: length is negative");
         } else if (key == "threshold") {
             innerThreshold = val;

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/src/server.cc	2009-09-12 22:02:03 UTC (rev 1806)
@@ -127,6 +127,7 @@
 int32_t  server::RandomState;               // no Lua access
 double   server::RubberViolationStrength;
 double   server::SlopeForce;
+int      server::SubSoil;
 double   server::SwampSinkSpeed;
 double   server::WaterSinkSpeed;
 double   server::WormholeForce;
@@ -300,6 +301,7 @@
     server::MagnetForce       = 30;
     server::MagnetRange       = 10;
     server::MaxOxydColor      = 7;    // for compatibility
+    server::SubSoil           = 0;
     server::RubberViolationStrength = 50;
     server::WormholeForce     = 30;
     server::WormholeRange     = 10;

Modified: trunk/src/server.hh
===================================================================
--- trunk/src/server.hh	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/src/server.hh	2009-09-12 22:02:03 UTC (rev 1806)
@@ -111,6 +111,7 @@
     extern ecl::V2  ConstantForce;  // global gravitation
     
     extern int      MaxOxydColor;
+    extern int      SubSoil;
 
     extern double   WaterSinkSpeed;
 



From raoul at mail.berlios.de  Sun Sep 13 00:38:30 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sun, 13 Sep 2009 00:38:30 +0200
Subject: [Enigma-game-svn] r1807 - in trunk/data/levels: enigma_cross
	enigma_i enigma_iii enigma_tutorial enigma_v enigma_vii enigma_viii
Message-ID: <200909122238.n8CMcU8b016610@sheep.berlios.de>

Author: raoul
Date: 2009-09-13 00:38:22 +0200 (Sun, 13 Sep 2009)
New Revision: 1807

Added:
   trunk/data/levels/enigma_i/ant12_2.xml
   trunk/data/levels/enigma_i/duffy21_2.xml
   trunk/data/levels/enigma_i/duffy24_2.xml
   trunk/data/levels/enigma_i/duffy47_2.xml
   trunk/data/levels/enigma_i/nat11_3.xml
   trunk/data/levels/enigma_i/ralf02_2.xml
   trunk/data/levels/enigma_i/siegfried08_2.xml
   trunk/data/levels/enigma_iii/duffy16_2.xml
   trunk/data/levels/enigma_v/alain24_2.xml
   trunk/data/levels/enigma_v/duffy95_2.xml
   trunk/data/levels/enigma_v/luc08_2.xml
   trunk/data/levels/enigma_v/martin101_2.xml
   trunk/data/levels/enigma_vii/just24_2.xml
   trunk/data/levels/enigma_vii/just25_2.xml
Removed:
   trunk/data/levels/enigma_i/ant12_1.xml
   trunk/data/levels/enigma_i/duffy21_1.xml
   trunk/data/levels/enigma_i/duffy24_1.xml
   trunk/data/levels/enigma_i/duffy47_1.xml
   trunk/data/levels/enigma_i/nat11_2.xml
   trunk/data/levels/enigma_i/ralf02_1.xml
   trunk/data/levels/enigma_i/siegfried08_1.xml
   trunk/data/levels/enigma_iii/duffy16_1.xml
   trunk/data/levels/enigma_v/alain24_1.xml
   trunk/data/levels/enigma_v/duffy95_1.xml
   trunk/data/levels/enigma_v/luc08_1.xml
   trunk/data/levels/enigma_v/martin101_1.xml
   trunk/data/levels/enigma_vii/just24_1.xml
   trunk/data/levels/enigma_vii/just25_1.xml
Modified:
   trunk/data/levels/enigma_cross/enigma0_92_1.xml
   trunk/data/levels/enigma_cross/enigma0_92_2.xml
   trunk/data/levels/enigma_cross/enigma0_92_3.xml
   trunk/data/levels/enigma_cross/newlevels.xml
   trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
   trunk/data/levels/enigma_i/index.xml
   trunk/data/levels/enigma_iii/index.xml
   trunk/data/levels/enigma_tutorial/index.xml
   trunk/data/levels/enigma_v/index.xml
   trunk/data/levels/enigma_vii/index.xml
   trunk/data/levels/enigma_viii/mecke05_1.xml
   trunk/data/levels/enigma_viii/mecke06_1.xml
Log:
-> Many new rewrites
-> Updates from mecke

Note: Right now we have 822 pure enigma levels of which 60% are in new API



Modified: trunk/data/levels/enigma_cross/enigma0_92_1.xml
===================================================================
--- trunk/data/levels/enigma_cross/enigma0_92_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_cross/enigma0_92_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Facets" location="15100" network="false" owner="Enigma Team" release="1" revision="38" title="Enigma 0.92 - 1"/>
+  <info enigma="1.10" group="Facets" location="15100" network="false" owner="Enigma Team" release="1" revision="39" title="Enigma 0.92 - 1"/>
 
   <attributes/>
 
@@ -65,7 +65,7 @@
     <level _seq="57" _title="Mossy Paths" _xpath="enigma_i/martin02_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin02" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="58" _title="Light Barriers" _xpath="enigma_ii/qq01_1" author="Andrzej Szombierski" ctrl="force" easy="false" id="qq1" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="59" _title="- Meditation -" _xpath="enigma_oxyd/oxyd10_1" author="Daniel Heck" ctrl="force" easy="false" id="daniel1" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="60" _title="Good Luck!" _xpath="enigma_i/siegfried08_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level3d" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="60" _title="Good Luck!" _xpath="enigma_i/siegfried08_2" author="Siegfried Fennig" ctrl="force" easy="false" id="level3d" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="61" _title="Mirror Shop" _xpath="enigma_v/siegfried25_2" author="Siegfried Fennig" ctrl="force" easy="false" id="level9a" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="62" _title="Stomp Stomp" _xpath="enigma_ii/qq03_2" author="Andrzej Szombierski" ctrl="force" easy="false" id="qq3" rel="2" rev="4" score="2" target="time" unit="duration"/>
     <level _seq="63" _title="Find The Way Out" _xpath="enigma_peroxyd/peroxyd46_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level2c" rel="1" rev="0" score="1" target="time" unit="duration"/>
@@ -85,7 +85,7 @@
     <level _seq="77" _title="The Tomb" _xpath="enigma_iv/ant04_2" author="Petr Machata" ctrl="force" easy="false" id="ant04" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="78" _title="Desert Ruins" _xpath="enigma_i/nat32_2" author="Nat Pryce" ctrl="force" easy="false" id="natmaze1" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="79" _title="- Meditation -" _xpath="enigma_i/siegfried35_1" author="Siegfried Fennig" ctrl="force" easy="false" id="meditation14" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="80" _title="Black Lava" _xpath="enigma_i/ant12_1" author="Petr Machata" ctrl="force" easy="false" id="ant12" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="80" _title="Black Lava" _xpath="enigma_i/ant12_2" author="Petr Machata" ctrl="force" easy="false" id="ant12" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="81" _title="Flood Gates" _xpath="enigma_iv/nat08_2" author="Nat Pryce" ctrl="force" easy="false" id="nat8" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="82" _title="Balancing Act" _xpath="enigma_i/nat09_2" author="Nat Pryce" ctrl="force" easy="false" id="nat9" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="83" _title="Automaton Magic" _xpath="enigma_ii/ant07_1" author="Petr Machata" ctrl="force" easy="false" id="ant07" rel="1" rev="6" score="1" target="time" unit="duration"/>
@@ -140,7 +140,7 @@
     <level _seq="132" _title="The Race" _xpath="enigma_iv/duffy11_2" author="Jacob Scott" ctrl="force" easy="true" id="duffy11" rel="2" rev="2" score="2" target="time" unit="duration"/>
     <level _seq="133" _title="Double-Spiral" _xpath="enigma_iv/duffy17_3" author="Jacob Scott" ctrl="force" easy="false" id="duffy17" rel="3" rev="4" score="2" target="time" unit="duration"/>
     <level _seq="134" _title="Mourning Palace" _xpath="enigma_iv/ant08_1" author="Petr Machata" ctrl="force" easy="false" id="ant08" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="135" _title="Control Panel" _xpath="enigma_iii/duffy16_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy16" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="135" _title="Control Panel" _xpath="enigma_iii/duffy16_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy16" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="136" _title="Dependants" _xpath="enigma_iii/ant25_2" author="Petr Machata" ctrl="force" easy="true" id="ant25" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="137" _title="Question of Speed" _xpath="enigma_ii/siegfried32_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level11b" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="138" _title="Pain" _xpath="enigma_iv/ant27_1" author="Petr Machata" ctrl="force" easy="false" id="ant27" rel="1" rev="0" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/enigma0_92_2.xml
===================================================================
--- trunk/data/levels/enigma_cross/enigma0_92_2.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_cross/enigma0_92_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Facets" location="15200" network="false" owner="Enigma Team" release="1" revision="45" title="Enigma 0.92 - 2"/>
+  <info enigma="1.10" group="Facets" location="15200" network="false" owner="Enigma Team" release="1" revision="46" title="Enigma 0.92 - 2"/>
 
   <attributes/>
 
@@ -22,7 +22,7 @@
     <level _seq="14" _title="Hidden Danger" _xpath="enigma_iii/martin81_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin81" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="15" _title="Slalom" _xpath="enigma_i/martin76_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin76" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="16" _title="Wells" _xpath="enigma_iii/ant19_2" author="Petr Machata" ctrl="force" easy="false" id="ant19" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="17" _title="Ibiza!" _xpath="enigma_i/ralf02_1" author="Ralf Westram" ctrl="force" easy="false" id="ralf02" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="17" _title="Ibiza!" _xpath="enigma_i/ralf02_2" author="Ralf Westram" ctrl="force" easy="false" id="ralf02" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="18" _title="Enigris" _xpath="enigma_v/ralf04_1" author="Ralf Westram" ctrl="force" easy="false" id="ralf04" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="19" _title="Gateway" _xpath="enigma_ii/martin85_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin85" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="20" _title="- No Meditation -" _xpath="enigma_iv/ralf08_2" author="Ralf Westram" ctrl="force" easy="false" id="ralf08" rel="2" rev="2" score="1" target="time" unit="duration"/>
@@ -64,14 +64,14 @@
     <level _seq="56" _title="Overshoot" _xpath="enigma_iii/ss02_1" author="Sven Siggelkow" ctrl="force" easy="true" id="ss2" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="57" _title="Slide it in" _xpath="enigma_iv/ss13_1" author="Sven Siggelkow" ctrl="force" easy="true" id="ss13" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="58" _title="Do It Yourself" _xpath="enigma_ii/martin97_1" author="Martin Hawlisch" ctrl="force" easy="false" id="martin97" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="59" _title="If They'd Just Hold Still" _xpath="enigma_i/duffy21_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy21" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="60" _title="Too Heavy?" _xpath="enigma_v/martin101_1" author="Martin Hawlisch" ctrl="force" easy="true" id="martin101" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="59" _title="If They'd Just Hold Still" _xpath="enigma_i/duffy21_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy21" rel="2" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="60" _title="Too Heavy?" _xpath="enigma_v/martin101_2" author="Martin Hawlisch" ctrl="force" easy="true" id="martin101" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="61" _title="Island of Safety" _xpath="enigma_v/duffy27_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy27" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="62" _title="TNT Shortage?" _xpath="enigma_iv/siegfried74_1" author="Siegfried Fennig" ctrl="force" easy="false" id="siegfried74" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="63" _title="Tunnels" _xpath="enigma_iv/martin82_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin82" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="64" _title="Growing The Doors" _xpath="enigma_i/martin88_3" author="Martin Hawlisch" ctrl="force" easy="false" id="martin88" rel="3" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="65" _title="Doors Galore" _xpath="enigma_iv/raywick01_3" author="Ray Wick" ctrl="force" easy="true" id="RayWick001" rel="3" rev="3" score="3" target="time" unit="duration"/>
-    <level _seq="66" _title="Time is Money" _xpath="enigma_i/nat11_2" author="Nat Pryce" ctrl="force" easy="false" id="nat11" rel="2" rev="0" score="2" target="time" unit="duration"/>
+    <level _seq="66" _title="Time is Money" _xpath="enigma_i/nat11_3" author="Nat Pryce" ctrl="force" easy="false" id="nat11" rel="3" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="67" _title="What's the Problem?" _xpath="enigma_iv/ss14_1" author="Sven Siggelkow" ctrl="force" easy="true" id="ss14" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="68" _title="Family Business" _xpath="enigma_iii/duffy20_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy20" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="69" _title="Stay There!" _xpath="enigma_iv/ralf05_3" author="Ralf Westram" ctrl="force" easy="false" id="ralf05" rel="3" rev="2" score="2" target="time" unit="duration"/>
@@ -81,7 +81,7 @@
     <level _seq="73" _title="The Exchange" _xpath="enigma_iii/raywick04_2" author="Ray Wick" ctrl="force" easy="true" id="RayWick004" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="74" _title="Choo-Choo" _xpath="enigma_v/duffy22_2" author="Jacob Scott" ctrl="force" easy="true" id="duffy22" rel="2" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="75" _title="Switch-Switch" _xpath="enigma_iv/raywick02_2" author="Ray Wick" ctrl="force" easy="false" id="RayWick002" rel="2" rev="1" score="2" target="time" unit="duration"/>
-    <level _seq="76" _title="Turbulence" _xpath="enigma_i/duffy24_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy24" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="76" _title="Turbulence" _xpath="enigma_i/duffy24_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy24" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="77" _title="Shrinking Pits" _xpath="enigma_v/duffy23_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy23" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="78" _title="Run Like Hell" _xpath="enigma_iv/ralf09_2" author="Ralf Westram" ctrl="force" easy="false" id="ralf09" rel="2" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="79" _title="Be Faster!" _xpath="enigma_iv/martin98_2" author="Martin Hawlisch" ctrl="force" easy="true" id="martin98" rel="2" rev="2" score="1" target="time" unit="duration"/>
@@ -127,7 +127,7 @@
     <level _seq="119" _title="Speed Jump" _xpath="enigma_iv/duffy44_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy44" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="120" _title="Washing Machine" _xpath="enigma_ii/duffy45_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy45" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="121" _title="No Jumping Necessary" _xpath="enigma_i/duffy46_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy46" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="122" _title="Cage The Lions" _xpath="enigma_i/duffy47_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy47" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="122" _title="Cage The Lions" _xpath="enigma_i/duffy47_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy47" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="123" _title="Blocks and Grates" _xpath="enigma_ii/duffy48_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy48" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="124" _title="Sacrifice" _xpath="enigma_iii/duffy49_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy49" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="125" _title="Take Turns" _xpath="enigma_v/duffy50_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy50" rel="2" rev="2" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/enigma0_92_3.xml
===================================================================
--- trunk/data/levels/enigma_cross/enigma0_92_3.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_cross/enigma0_92_3.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Facets" location="15300" network="false" owner="Enigma Team" release="1" revision="29" title="Enigma 0.92 - 3"/>
+  <info enigma="1.10" group="Facets" location="15300" network="false" owner="Enigma Team" release="1" revision="30" title="Enigma 0.92 - 3"/>
 
   <attributes/>
 
@@ -27,7 +27,7 @@
     <level _seq="19" _title="Map It Out" _xpath="enigma_iii/duffy92_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy92" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="20" _title="Seed Puzzle 2" _xpath="enigma_iv/duffy93_3" author="Jacob Scott" ctrl="force" easy="false" id="duffy93" rel="3" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="21" _title="Graduated Puzzles" _xpath="enigma_iv/duffy94_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy94" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="22" _title="Automaton" _xpath="enigma_v/duffy95_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy95" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="22" _title="Automaton" _xpath="enigma_v/duffy95_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy95" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="23" _title="Alien Glyphs 2" _xpath="enigma_ii/duffy96_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy96" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="24" _title="Alien Glyphs 3" _xpath="enigma_ii/duffy97_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy97" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="25" _title="Solar System" _xpath="enigma_ii/duffy98_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy98" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_cross/newlevels.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Facets" location="15400" network="false" owner="Enigma Team" release="1" revision="54" title="Enigma 1.00 new"/>
+  <info enigma="1.10" group="Facets" location="15400" network="false" owner="Enigma Team" release="1" revision="55" title="Enigma 1.00 new"/>
 
   <attributes/>
 
@@ -117,10 +117,10 @@
     <level _seq="109" _title="Ghost Islands" _xpath="enigma_v/raoul15_2" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul15" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="110" _title="- Giza Meditation -" _xpath="enigma_v/raoul02_2" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul02" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="111" _title="Humid Maze" _xpath="enigma_v/duffy133_3" author="Jacob Scott" ctrl="force" easy="true" id="duffy133" rel="3" rev="5" score="2" target="time" unit="duration"/>
-    <level _seq="112" _title="Swamp of Balls" _xpath="enigma_v/luc08_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc08" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="112" _title="Swamp of Balls" _xpath="enigma_v/luc08_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc08" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="113" _title="Designed with love" _xpath="enigma_v/just01_1" author="JuSt" ctrl="force" easy="false" id="just01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="114" _title="A bayou by you" _xpath="enigma_v/alain21_1" author="Alain Busser" ctrl="force" easy="false" id="alain21" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="115" _title="Blet" _xpath="enigma_v/alain24_1" author="Alain Busser" ctrl="force" easy="true" id="alain24" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="115" _title="Blet" _xpath="enigma_v/alain24_2" author="Alain Busser" ctrl="force" easy="true" id="alain24" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="116" _title="Venice I" _xpath="enigma_v/raoul16_2" author="Raoul Bourquin" ctrl="force" easy="false" id="raoul16" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="117" _title="No way out?" _xpath="enigma_v/just08_1" author="JuSt" ctrl="force" easy="false" id="just08" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="118" _title="Venice II" _xpath="enigma_v/raoul17_2" author="Raoul Bourquin" ctrl="force" easy="false" id="raoul17" rel="2" rev="3" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="63" title="Enigma 1.1 new"/>
+  <info enigma="1.10" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="64" title="Enigma 1.1 new"/>
 
   <attributes/>
 
@@ -38,8 +38,8 @@
     <level _seq="30" _title="Give more Way" _xpath="enigma_vii/just21_2" author="JuSt" ctrl="force" easy="true" id="just21" rel="2" rev="4" score="2" target="time" unit="duration"/>
     <level _seq="31" _title="Give Way 4 two" _xpath="enigma_vii/just22_2" author="JuSt" ctrl="force" easy="true" id="just22" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="32" _title="Lost in Time and Space" _xpath="enigma_vii/just23_2" author="JuSt" ctrl="force" easy="false" id="just23" rel="2" rev="6" score="2" target="time" unit="duration"/>
-    <level _seq="33" _title="Alternatives?" _xpath="enigma_vii/just24_1" author="JuSt" ctrl="force" easy="true" id="just24" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="34" _title="No More Alternatives" _xpath="enigma_vii/just25_1" author="JuSt" ctrl="force" easy="true" id="just25" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="33" _title="Alternatives?" _xpath="enigma_vii/just24_2" author="JuSt" ctrl="force" easy="true" id="just24" rel="2" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="34" _title="No More Alternatives" _xpath="enigma_vii/just25_2" author="JuSt" ctrl="force" easy="true" id="just25" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="35" _title="The Walls" _xpath="enigma_vii/just26_2" author="JuSt" ctrl="force" easy="true" id="just26" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="36" _title="Pull the Puller" _xpath="enigma_vii/just28_2" author="JuSt" ctrl="force" easy="false" id="just28" rel="2" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="37" _title="Double Sense" _xpath="enigma_vii/joe14_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe14" rel="1" rev="1" score="1" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_i/ant12_1.xml
===================================================================
--- trunk/data/levels/enigma_i/ant12_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_i/ant12_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,77 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Black Lava" el:subtitle="" el:id="ant12"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
-      <el:author  el:name="Petr Machata" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Petr Machata</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-       <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
--- 2003-02-10 -- keeping up to date with latest additions to ant.lua
-
-cells={}
-
-cells["n"]=cell{floor={face="fl-normal"}}
-
-grada1=cell{{{gradient, 5}}}
-grada2=cell{{{gradient, 6}}}
-grada3=cell{{{gradient, 7}}}
-grada4=cell{{{gradient, 8}}}
-gradb1=cell{{{gradient, 9}}}
-gradb2=cell{{{gradient, 10}}}
-gradb3=cell{{{gradient, 11}}}
-gradb4=cell{{{gradient, 12}}}
-gradc1=cell{{{gradient, 21}}}
-gradc2=cell{{{gradient, 22}}}
-gradc3=cell{{{gradient, 23}}}
-gradc4=cell{{{gradient, 24}}}
-
-gradaa=cell{{{randomfloor,{grada1, grada2, grada3, grada4}}}}
-gradbb=cell{{{randomfloor,{gradb1, gradb2, gradb3, gradb4}}}}
-gradcc=cell{{{randomfloor,{gradc1, gradc2, gradc3, gradc4}}}}
-
-cells[" "]=cell{{{randomfloor,{gradaa, gradbb, gradcc}}}}
-
-cells["#"]=cell{stone="st-rock6"}
-cells["D"]=cell{stone="st-death"}
-cells["0"]=oxyd
-cells["O"]=cell{parent=cells["n"],actor={"ac-blackball", {player=0}}}
-
-level = {
-   "####################",
-   "#O       ##       n#",
-   "#        ##        #",
-   "0  D  D  DD  D  D  0",
-   "#                  #",
-   "#                  #",
-   "0  D  D      D  D  0",
-   "#                  #",
-   "#                  #",
-   "0  D  D  DD  D  D  0",
-   "#        ##        #",
-   "#n       ##       n#",
-   "####################"
-}
-
-oxyd_default_flavor = "b"
-set_default_parent(cells[" "])
-create_world_by_map(level)
-oxyd_shuffle()
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_i/ant12_2.xml (from rev 1805, trunk/data/levels/enigma_i/ant12_1.xml)
===================================================================
--- trunk/data/levels/enigma_i/ant12_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_i/ant12_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,58 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Black Lava" el:subtitle="" el:id="ant12"/>
+      <el:version el:score="2" el:release="2" el:revision="1" el:status="released"/>
+      <el:author  el:name="Petr Machata" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2003 Petr Machata</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti["-"] = {"fl_metal_7"}
+ti["v"] = {"fl_slope_ts"}
+ti["^"] = {"fl_slope_tn"}
+ti[">"] = {"fl_slope_te"}
+ti["<"] = {"fl_slope_tw"}
+ti["7"] = {"fl_slope_ose"}
+ti["9"] = {"fl_slope_osw"}
+ti["1"] = {"fl_slope_one"}
+ti["3"] = {"fl_slope_onw"}
+ti["s"] = {"fl_slope_ise"}
+ti["a"] = {"fl_slope_isw"}
+ti["w"] = {"fl_slope_ine"}
+ti["q"] = {"fl_slope_inw"}
+ti["#"] = {"st_purplegray"}
+ti["D"] = {"st_death"}
+ti["O"] = {"st_oxyd", name="left#"}
+ti["o"] = {"st_oxyd", name="right#"}
+ti["@"] = ti["-"] .. {"#ac_marble_black"}
+
+wo(res.random(ti, " ", {"v", "^", "<", ">", "1", "3", "7", "9", "q", "w", "a", "s"}), " ", {
+    "####################",
+    "#@       ##       -#",
+    "#        ##        #",
+    "O  D  D  DD  D  D  o",
+    "#                  #",
+    "#                  #",
+    "O  D  D      D  D  o",
+    "#                  #",
+    "#                  #",
+    "O  D  D  DD  D  D  o",
+    "#        ##        #",
+    "#-       ##       -#",
+    "####################"})
+
+wo:shuffleOxyd({"left#*", "right#*", min=2})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_i/duffy21_1.xml
===================================================================
--- trunk/data/levels/enigma_i/duffy21_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_i/duffy21_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,86 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="If They'd Just Hold Still" el:subtitle="" el:id="duffy21"/>
-      <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
-      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-rooms_wide=1
-rooms_high=1
-
-levelw=1+(19*rooms_wide)
-levelh=1+(12*rooms_high)
-
-create_world( levelw, levelh)
-
-fill_floor("fl-metal", 0,0,levelw,levelh)
-
-function renderLine( line, pattern)
-    for i=1, strlen(pattern) do
-        local c = strsub( pattern, i, i)
-        if c =="#" then
-            set_stone( "st-greenbrown", i-1, line)
-        elseif c == "o" then
-            oxyd( i-1, line)
-        elseif c == "D" then
-            set_stone( "st-death", i-1, line)
-        elseif c == "!" then
-            fill_floor("fl-water", i-1,line, 1,1)
-        elseif c == " " then
-            abyss(i-1,line)
-        elseif c=="H" then
-            hollow(i-1,line)
-        elseif c=="*" then
-            set_stone("st-greenbrown",i-1,line)
-        elseif c=="r" then
-            set_floor("fl-gradient", i-1,line , {type=23})
-        elseif c=="l" then
-            set_floor("fl-gradient", i-1,line , {type=24})
-        elseif c=="R" then
-            set_floor("fl-gradient", i-1,line , {type=23})
-            set_actor("ac-whiteball-small", i-.5,line+.5, {player=0, essential=1})
-        elseif c=="L" then
-            set_floor("fl-gradient", i-1,line , {type=24})
-            set_actor("ac-whiteball-small", i-.5,line+.5, {player=0, essential=1})
-        elseif c=="x" then
-            set_floor("fl-metal", i-1,line)
-        elseif c=="X" then
-            set_floor("fl-metal", i-1,line)
-            set_actor("ac-whiteball-small", i-.5,line+.5, {player=0, essential=1})
-        end
-    end
-end
-
-renderLine(00,"   ###    ###       ")
-renderLine(01," ###r#o####r#o##### ")
-renderLine(02," DrrrrrrrrRrrrrrrr# ")
-renderLine(03," ##r##o######o##r## ")
-renderLine(04,"  ###    ###   ###  ")
-renderLine(05," ##x##o###x##o##### ")
-renderLine(06," DxxxxxxxxXxxxxxxxD ")
-renderLine(07," #####o###x##o##x## ")
-renderLine(08,"  ###    ###   ###  ")
-renderLine(09," ##l##o###l##o##### ")
-renderLine(10," #llllllllLlllllllD ")
-renderLine(11," #####o#l####o##l## ")
-renderLine(12,"       ###     ###  ")
-oxyd_shuffle()
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_i/duffy21_2.xml (from rev 1805, trunk/data/levels/enigma_i/duffy21_1.xml)
===================================================================
--- trunk/data/levels/enigma_i/duffy21_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_i/duffy21_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,52 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="If They'd Just Hold Still" el:subtitle="" el:id="duffy21"/>
+      <el:version el:score="1" el:release="2" el:revision="1" el:status="released"/>
+      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_abyss"}
+ti["-"] = {"fl_metal"}
+ti[">"] = {"fl_slope_te"}
+ti["<"] = {"fl_slope_tw"}
+ti["#"] = ti["-"] .. {"st_greenbrown"}
+ti["D"] = ti["-"] .. {"st_death"}
+ti["o"] = ti["-"] .. {"st_oxyd", name="upper#"}
+ti["O"] = ti["-"] .. {"st_oxyd", name="middle#"}
+ti["0"] = ti["-"] .. {"st_oxyd", name="lower#"}
+ti["1"] = ti[">"] .. {"#ac_pearl"}
+ti["2"] = ti["-"] .. {"#ac_pearl"}
+ti["3"] = ti["<"] .. {"#ac_pearl"}
+
+wo(ti, " ", {
+    "   ###    ###       ",
+    " ###>#o####>#o##### ",
+    " D>>>>>>>>1>>>>>>># ",
+    " ##>##o######o##>## ",
+    "  ###    ###   ###  ",
+    " ##-##O###-##O##### ",
+    " D--------2-------D ",
+    " #####O###-##O##-## ",
+    "  ###    ###   ###  ",
+    " ##<##0###<##0##### ",
+    " #<<<<<<<<3<<<<<<<D ",
+    " #####0#<####0##<## ",
+    "       ###     ###  "})
+
+wo:shuffleOxyd({"upper#*", max=1}, {"middle#*", max=1}, {"lower#*", max=1})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_i/duffy24_1.xml
===================================================================
--- trunk/data/levels/enigma_i/duffy24_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_i/duffy24_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,96 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Turbulence" el:subtitle="" el:id="duffy24"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
-      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-rooms_wide=1
-rooms_high=1
-
-levelw=1+(19*rooms_wide)
-levelh=1+(12*rooms_high)
-
-create_world( levelw, levelh)
-
-fill_floor("fl-bluegreen", 0,0,levelw,levelh)
-
-function renderLine( line, pattern)
-    for i=1, strlen(pattern) do
-        local c = strsub( pattern, i, i)
-        if c =="#" then
-            set_stone( "st-greenbrown", i-1, line)
-        elseif c == "o" then
-            oxyd( i-1, line)
-        elseif c == "D" then
-            set_stone( "st-death", i-1, line)
-        elseif c == "!" then
-            abyss(i-1,line)
-        elseif c == "=" then
-            fill_floor("fl-bluegreen", i-1,line, 1,1)
-        elseif c == "+" then
-            fill_floor("fl-space", i-1,line, 1,1)
-        elseif c == "a" then
-            set_stone("st-switch", i-1,line, {action="openclose", target="door1"})
-        elseif c == "A" then
-            set_stone("st-door", i-1, line , {name="door1", type="v"})
-        elseif c == "z" then
-            set_actor("ac-blackball", i-1+1,line+.5)
-        elseif c == "d" then --1-d
-            set_floor("fl-gradient",  i-1,  line, {type=1})
-        elseif c == "u" then --2-u
-            set_floor("fl-gradient",  i-1,  line, {type=2})
-        elseif c == "r" then --3-r
-            set_floor("fl-gradient",  i-1,  line, {type=3})
-        elseif c == "l" then --4-l
-            set_floor("fl-gradient",  i-1,  line, {type=4})
-        elseif c == "1" then --ur
-            set_floor("fl-gradient",  i-1,  line, {type=11})
-        elseif c == "3" then --dl
-            set_floor("fl-gradient",  i-1,  line, {type=9})
-        elseif c == "7" then --dr
-            set_floor("fl-gradient",  i-1,  line, {type=12})
-        elseif c == "9" then --ul
-            set_floor("fl-gradient",  i-1,  line, {type=10})
-        end
-    end
-end
-
--- Floor:  " "
--- Border: "#"
--- Oxyd:   "o"
-
-renderLine(00,"!!!!!!!!!!!!!!!!!!!!")
-renderLine(01,"!DdulrdulDDulrdulrD!")
-renderLine(02,"!uordulrdulrdulrdol!")
-renderLine(03,"!rdulrDulrdulDdulrd!")
-renderLine(04,"!ulrdolrdulrduordul!")
-renderLine(05,"!rdulrdulrdulrdulrd!")
-renderLine(06,"!oDrdulrdz=rdulrdDo!")
-renderLine(07,"!rdulrdulrdulrdulrd!")
-renderLine(08,"!ulrdolrdulrduordul!")
-renderLine(09,"!rdulrDulrdulDdulrd!")
-renderLine(10,"!uordulrdulrdulrdol!")
-renderLine(11,"!DdulrdulDDulrdulrD!")
-renderLine(12,"!!!!!!!!!!!!!!!!!!!!")
-
-oxyd_shuffle()
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_i/duffy24_2.xml (from rev 1805, trunk/data/levels/enigma_i/duffy24_1.xml)
===================================================================
--- trunk/data/levels/enigma_i/duffy24_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_i/duffy24_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,49 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Turbulence" el:subtitle="" el:id="duffy24"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_bluegreen"}
+ti["-"] = {"fl_abyss"}
+ti["^"] = {"fl_slope_pn"}
+ti[">"] = {"fl_slope_pe"}
+ti["v"] = {"fl_slope_ps"}
+ti["<"] = {"fl_slope_pw"}
+ti["D"] = {"st_death"}
+ti["O"] = {"st_oxyd"}
+ti["@"] = {"ac_marble_black", 0.0, 0.5}
+
+wo(ti, " ", {
+    "--------------------",
+    "-Dv^<>v^<DD^<>v^<>D-",
+    "-^O>v^<>v^<>v^<>vO<-",
+    "->v^<>D^<>v^<Dv^<>v-",
+    "-^<>vO<>v^<>v^O>v^<-",
+    "->v^<>v^<>v^<>v^<>v-",
+    "-OD>v^<>v @>v^<>vDO-",
+    "->v^<>v^<>v^<>v^<>v-",
+    "-^<>vO<>v^<>v^O>v^<-",
+    "->v^<>D^<>v^<Dv^<>v-",
+    "-^O>v^<>v^<>v^<>vO<-",
+    "-Dv^<>v^<DD^<>v^<>D-",
+    "--------------------"})
+
+wo:shuffleOxyd()
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_i/duffy47_1.xml
===================================================================
--- trunk/data/levels/enigma_i/duffy47_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_i/duffy47_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,130 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Cage The Lions" el:subtitle="" el:id="duffy47"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
-      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-rooms_wide=1
-rooms_high=1
-
-levelw=1+(19*rooms_wide)
-levelh=1+(12*rooms_high)
-
-create_world( levelw, levelh)
-
-fill_floor("fl-hay", 0,0,levelw,levelh)
-
-function renderLine( line, pattern)
-    for i=1, strlen(pattern) do
-        local c = strsub( pattern, i, i)
-        if c =="#" then
-            set_stone( "st-greenbrown", i-1, line)
-        elseif c =="X" then
-            set_stone( "st-death", i-1, line)
-        elseif c == "o" then
-            oxyd( i-1, line)
-        elseif c == "*" then
-            set_stone( "st-brownie", i-1, line)
-        elseif c == "!" then
-            abyss(i-1,line)
-        elseif c == "~" then
-            fill_floor("fl-water", i-1,line, 1,1)
-        elseif c=="z" then
-            set_actor("ac-blackball", i,line+.5)
-        elseif c == "g" then
-            draw_stones("st-grate1",{i-1,line}, {1,1}, 1)
-        elseif c=="+" then
-            set_stone( "st-wood", i-1, line)
-        elseif c=="=" then
-            set_floor("fl-space",i-1,line)
-        elseif c == "d" then --1-d
-            set_floor("fl-gradient",  i-1,  line, {type=1})
-        elseif c == "u" then --2-u
-            set_floor("fl-gradient",  i-1,  line, {type=2})
-        elseif c == "r" then --3-r
-            set_floor("fl-gradient",  i-1,  line, {type=3})
-        elseif c == "l" then --4-l
-            set_floor("fl-gradient",  i-1,  line, {type=4})
-        elseif c == "1" then --ur
-            set_floor("fl-gradient",  i-1,  line, {type=11})
-        elseif c == "3" then --dl
-            set_floor("fl-gradient",  i-1,  line, {type=9})
-        elseif c == "7" then --dr
-            set_floor("fl-gradient",  i-1,  line, {type=12})
-        elseif c == "9" then --ul
-            set_floor("fl-gradient",  i-1,  line, {type=10})
-        elseif c=="T" then
-            set_actor("ac-top", i-.5,line+.5, {player=1, mouseforce=0, range=30, force=30})
-        elseif c=="R" then
-            set_actor("ac-rotor", i-.5,line+.5, {player=1, mouseforce=0, range=30, force=30})
-        elseif c =="H" then
-            set_stone("st-switch", i-1,line, {action="callback", target="funcc1"})
-        elseif c =="F" then
-            set_stone("st-door_b",i-1,line,{name="door1"})
-        elseif c =="G" then
-            set_stone("st-door_b",i-1,line,{name="door2"})
-        elseif c =="a" then
-            set_item("it-trigger", i-1,line, {action="openclose", target="door3"})
-        elseif c =="b" then
-            set_item("it-trigger", i-1,line, {action="openclose", target="door4"})
-        elseif c =="c" then
-            set_item("it-trigger", i-1,line, {action="openclose", target="door5"})
-        elseif c =="e" then
-            set_item("it-trigger", i-1,line, {action="openclose", target="door6"})
-        elseif c=="A" then
-            doorv( i-1,line, {name="door3"})
-        elseif c=="B" then
-            doorv( i-1,line, {name="door4"})
-        elseif c=="C" then
-            doorv( i-1,line, {name="door5"})
-        elseif c=="D" then
-            doorv( i-1,line, {name="door6"})
-        end
-    end
-end
-
-function yy1( color, x, y)
-       stone = format( "st-%s4", color)
-       set_stone( stone, x, y)
-end
-
-renderLine(00,"####################")
-renderLine(01,"#RF  3d1         ABo")
-renderLine(02,"###  r l         ###")
-renderLine(03,"#    9u7  # #  3d1 #")
-renderLine(04,"#  ###    #e#  r l #")
-renderLine(05,"#   a#    ###  9u7 #")
-renderLine(06,"H  ###   z    ###  H")
-renderLine(07,"# 3d1  ###    #c   #")
-renderLine(08,"# r l  #b#    ###  #")
-renderLine(09,"# 9u7  # #  3d1    #")
-renderLine(10,"###         r l  ###")
-renderLine(11,"oDC         9u7  GR#")
-renderLine(12,"####################")
-
-oxyd_shuffle()
-
-function funcc1()
-    SendMessage("door1", "openclose")
-    SendMessage("door2", "openclose")
-end
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_i/duffy47_2.xml (from rev 1805, trunk/data/levels/enigma_i/duffy47_1.xml)
===================================================================
--- trunk/data/levels/enigma_i/duffy47_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_i/duffy47_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,55 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Cage The Lions" el:subtitle="" el:id="duffy47"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_hay"}
+ti["v"] = {"fl_slope_ps"}
+ti["^"] = {"fl_slope_pn"}
+ti[">"] = {"fl_slope_pe"}
+ti["<"] = {"fl_slope_pw"}
+ti["7"] = {"fl_slope_ise"}
+ti["9"] = {"fl_slope_isw"}
+ti["1"] = {"fl_slope_ine"}
+ti["3"] = {"fl_slope_inw"}
+ti["#"] = {"st_greenbrown"}
+ti["|"] = {"st_door", flavor="c", name="doors#"}
+ti["S"] = {"st_switch", target="doors#*"}
+ti["door"] = {"st_door", flavor="d", faces="ew", name="door%%"}
+ti["trigger"] = {"it_trigger", target="door%%"}
+ti["O"] = {"st_oxyd"}
+ti["R"] = {"#ac_rotor", range=30.0, strength=30.0, gohome=false}
+ti["@"] = {"#ac_marble_black"}
+
+wo(res.autotile(ti, {"A", "D", "door"}, {"a", "d", "trigger"}), " ", {
+    "####################",
+    "#R|  7v9         ABO",
+    "###  > <         ###",
+    "#    1^3  # #  7v9 #",
+    "#  ###    #d#  > < #",
+    "#   a#    ###  1^3 #",
+    "S  ###   @    ###  S",
+    "# 7v9  ###    #c   #",
+    "# > <  #b#    ###  #",
+    "# 1^3  # #  7v9    #",
+    "###         > <  ###",
+    "ODC         1^3  |R#",
+    "####################"})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_i/index.xml
===================================================================
--- trunk/data/levels/enigma_i/index.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_i/index.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10200" network="false" owner="Enigma Team" release="1" revision="30" title="Enigma I"/>
+  <info enigma="1.10" group="Enigma" location="10200" network="false" owner="Enigma Team" release="1" revision="31" title="Enigma I"/>
 
   <attributes/>
 
@@ -67,22 +67,22 @@
     <level _seq="59" _title="Simon Says" _xpath="./nat12_2" author="Nat Pryce" ctrl="force" easy="false" id="nat12" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="60" _title="- Meditation -" _xpath="./siegfried35_1" author="Siegfried Fennig" ctrl="force" easy="false" id="meditation14" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="61" _title="Feel Your Way" _xpath="./siegfried06_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level3a" rel="1" rev="0" score="1" target="time" unit="duration"/>
-    <level _seq="62" _title="Good Luck!" _xpath="./siegfried08_1" author="Siegfried Fennig" ctrl="force" easy="false" id="level3d" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="62" _title="Good Luck!" _xpath="./siegfried08_2" author="Siegfried Fennig" ctrl="force" easy="false" id="level3d" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="63" _title="Tubes" _xpath="./siegfried09_2" author="Siegfried Fennig" ctrl="force" easy="false" id="level3e" rel="2" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="64" _title="Turbulence" _xpath="./duffy24_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy24" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="64" _title="Turbulence" _xpath="./duffy24_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy24" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="65" _title="Lasers 101" _xpath="./daniel08_2" author="Daniel Heck" ctrl="force" easy="false" id="lasers101" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="66" _title="Not Hard Atoll" _xpath="./martin33_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin33" rel="2" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="67" _title="Black Lava" _xpath="./ant12_1" author="Petr Machata" ctrl="force" easy="false" id="ant12" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="67" _title="Black Lava" _xpath="./ant12_2" author="Petr Machata" ctrl="force" easy="false" id="ant12" rel="2" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="68" _title="Laser Arena" _xpath="./andreas14_2" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas14" rel="2" rev="5" score="1" target="time" unit="duration"/>
     <level _seq="69" _title="Advanced Lasers" _xpath="./luc23_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc23" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="70" _title="- Meditation -" _xpath="./ant24_2" author="Petr Machata" ctrl="force" easy="false" id="ant24" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="71" _title="Spiral Race" _xpath="./wb06_2" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb6" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="72" _title="Way To Go" _xpath="./daniel09_1" author="Daniel Heck" ctrl="force" easy="false" id="mirrors" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="73" _title="Formentera!" _xpath="./luc06_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc06" rel="2" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="74" _title="If They'd Just Hold Still" _xpath="./duffy21_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy21" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="75" _title="Ibiza!" _xpath="./ralf02_1" author="Ralf Westram" ctrl="force" easy="false" id="ralf02" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="74" _title="If They'd Just Hold Still" _xpath="./duffy21_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy21" rel="2" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="75" _title="Ibiza!" _xpath="./ralf02_2" author="Ralf Westram" ctrl="force" easy="false" id="ralf02" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="76" _title="Puzzle Hacker" _xpath="./ant01_2" author="Petr Machata" ctrl="force" easy="false" id="ant01" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="77" _title="Cage The Lions" _xpath="./duffy47_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy47" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="77" _title="Cage The Lions" _xpath="./duffy47_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy47" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="78" _title="Confetti" _xpath="./duffy74_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy74" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="79" _title="Why So Slow?" _xpath="./jc03_1" author="Jens-Christian Korth" ctrl="force" easy="false" id="jc03" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="80" _title="- Meditation -" _xpath="./siegfried38_2" author="Siegfried Fennig" ctrl="force" easy="false" id="meditation5" rel="2" rev="1" score="1" target="time" unit="duration"/>
@@ -98,7 +98,7 @@
     <level _seq="90" _title="- Meditation -" _xpath="./raoul04_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul04" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="91" _title="Civil Engineer" _xpath="./duffy122_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy122" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="92" _title="Security Guards" _xpath="./duffy108_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy108" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="93" _title="Time is Money" _xpath="./nat11_2" author="Nat Pryce" ctrl="force" easy="false" id="nat11" rel="2" rev="0" score="2" target="time" unit="duration"/>
+    <level _seq="93" _title="Time is Money" _xpath="./nat11_3" author="Nat Pryce" ctrl="force" easy="false" id="nat11" rel="3" rev="1" score="2" target="time" unit="duration"/>
     <level _seq="94" _title="Growing The Doors" _xpath="./martin88_3" author="Martin Hawlisch" ctrl="force" easy="false" id="martin88" rel="3" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="95" _title="Impulsive" _xpath="./ant13_1" author="Petr Machata" ctrl="force" easy="false" id="ant13" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="96" _title="Jump!" _xpath="./duffy07_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy7" rel="2" rev="2" score="1" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_i/nat11_2.xml
===================================================================
--- trunk/data/levels/enigma_i/nat11_2.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_i/nat11_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,143 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Time is Money" el:subtitle="" el:id="nat11"/>
-      <el:version el:score="2" el:release="2" el:revision="0" el:status="released"/>
-      <el:author  el:name="Nat Pryce" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Nat Pryce</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-enigma.ConserveLevel=FALSE
-
---time constants changed in Enigma
-function floor( floor_type, attribs )
-    return function( x, y )
-        set_floor( floor_type, x, y, attribs or {} )
-    end
-end
-
-function stone( stone_type, attribs )
-    return function( x, y )
-        set_stone( stone_type, x, y, attribs or {} )
-    end
-end
-
-function item( item_type, attribs )
-    return function( x, y )
-        set_item( item_type, x, y, attribs or {} )
-    end
-end
-
-function actor( actor_type, attribs )
-    return function( x, y )
-        set_actor( actor_type, x+0.5, y+0.5, attribs
-or {} )
-    end
-end
-
-function gradient( gradient_type )
-    return function( x, y )
-        set_floor( "fl-gradient", x, y, {type=gradient_type} )
-    end
-end
-
-function create_world_from_map( tiles, map )
-    create_world( strlen(map[1]), getn(map) )
-    
-    for y,line in pairs(map) do
-        for x = 1,strlen(line) do
-            local tile = strchar(strbyte(line,x))
-            local constructors = tiles[tile]
-            
-            if constructors then
-                for i,constructor in pairs(constructors) do
-                    constructor(x-1,y-1)
-                end
-            else
-                error("invalid tile identifier " ..
-tile )
-            end
-        end
-    end
-end
-
-default_floor = floor("fl-normal")
-
-oxyd_default_flavor = "b"
-
-tiles = {
-    [" "] = { abyss },
-    ["S"] = { floor("fl-normal") },
-    ["W"] = { gradient(SLOPE_S) },
-    ["X"] = { gradient(SLOPE_N) },
-    ["A"] = { gradient(SLOPE_E) },
-    ["D"] = { gradient(SLOPE_W) },
-    ["Q"] = { gradient(SLOPE_LARGE_SE) },
-    ["Z"] = { gradient(SLOPE_LARGE_NE) },
-    ["E"] = { gradient(SLOPE_LARGE_SW) },
-    ["C"] = { gradient(SLOPE_LARGE_NW) },
-    ["q"] = { gradient(SLOPE_SMALL_SE) },
-    ["z"] = { gradient(SLOPE_SMALL_NE) },
-    ["e"] = { gradient(SLOPE_SMALL_SW) },
-    ["c"] = { gradient(SLOPE_SMALL_NW) },
-    ["o"] = { default_floor, 
-              actor("ac-blackball",{player=0}) },
-    ["#"] = { default_floor, 
-              stone("st-rock1") },
-    ["="] = { default_floor, 
-              stone("st-coinslot",
-              {target="laser",action="onoff"})},
-    ["$"] = { default_floor,
-              item("it-coin2") },
-    ["x"] = { default_floor, oxyd },
-    [">"] = { default_floor, 
-              stone("st-laser",
-                    {name="laser",on=TRUE,dir=EAST})},
-}
-
-create_world_from_map( tiles, {
-"                                       ",
-" ##################################### ",
-" #QWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWE# ",
-" =ASoS$SSSSSSSSSSSSSSSSSSSSSSSSSSSSSD# ",
-" #ZXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXzSD# ",
-" #################################ASD# ",
-"                                 #ASD# ",
-" #x#x# ###########################ASD# ",
-" #QWE# #QWWWWWWWWWWWWWWWWWWWWWWWWWqSD# ",
-" #ASD# #ASSSSSSSSSSSSSSSSSSSSSSSSSSSD# ",
-" #ASD# #AScXXXXXXXXXXXXXXXXXXXXXXXXXC# ",
-" >ASD# #ASD########################### ",
-" #ASD# #ASD#                           ",
-" #ASD# #ASD########################### ",
-" #ASD# #ASeWWWWWWWWWWWWWWWWWWWWWWWWWE# ",
-" #ASD# #ASSSSSSSSSSSSSSSSSSSSSSSSSSSD# ",
-" #ASD# #ZXXXXXXXXXXXXXXXXXXXXXXXXXzSD# ",
-" #ASD# ###########################ASD# ",
-" #ASD#                           #ASD# ",
-" #ASD#############################ASD# ",
-" #ASeWWWWWWWWWWWWWWWWWWWWWWWWWWWWWqSD# ",
-" #ASSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSD# ",
-" #ZXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXC# ",
-" ##################################### ",
-"                                       ",
-})
-
-oxyd_shuffle()
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_i/nat11_3.xml (from rev 1805, trunk/data/levels/enigma_i/nat11_2.xml)
===================================================================
--- trunk/data/levels/enigma_i/nat11_2.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_i/nat11_3.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,72 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Time is Money" el:subtitle="" el:id="nat11"/>
+      <el:version el:score="2" el:release="3" el:revision="1" el:status="released"/>
+      <el:author  el:name="Nat Pryce" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2003 Nat Pryce</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = false
+
+ti[" "] = {"fl_abyss"}
+ti["-"] = {"fl_metal_7"}
+ti["v"] = {"fl_slope_ps"}
+ti["^"] = {"fl_slope_pn"}
+ti[">"] = {"fl_slope_pe"}
+ti["<"] = {"fl_slope_pw"}
+ti["7"] = {"fl_slope_ose"}
+ti["9"] = {"fl_slope_osw"}
+ti["1"] = {"fl_slope_one"}
+ti["3"] = {"fl_slope_onw"}
+ti["s"] = {"fl_slope_ise"}
+ti["a"] = {"fl_slope_isw"}
+ti["w"] = {"fl_slope_ine"}
+ti["q"] = {"fl_slope_inw"}
+ti["#"] = {"st_granite"}
+ti["L"] = {"st_laser", orientation=EAST, name="laser", state=ON}
+ti["S"] = {"st_coinslot", target="laser"}
+ti["c"] = ti["-"] .. {"it_coin_m"}
+ti["O"] = {"st_oxyd"}
+ti["@"] = ti["-"] .. {"#ac_marble_black"}
+
+wo(ti, " ", {
+    "                                       ",
+    " ##################################### ",
+    " #7vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv9# ",
+    " S>- at -c-----------------------------<# ",
+    " #1^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^w-<# ",
+    " #################################>-<# ",
+    "                                 #>-<# ",
+    " #O#O# ###########################>-<# ",
+    " #7v9# #7vvvvvvvvvvvvvvvvvvvvvvvvvs-<# ",
+    " #>-<# #>---------------------------<# ",
+    " #>-<# #>-q^^^^^^^^^^^^^^^^^^^^^^^^^3# ",
+    " L>-<# #>-<########################### ",
+    " #>-<# #>-<#                           ",
+    " #>-<# #>-<########################### ",
+    " #>-<# #>-avvvvvvvvvvvvvvvvvvvvvvvvv9# ",
+    " #>-<# #>---------------------------<# ",
+    " #>-<# #1^^^^^^^^^^^^^^^^^^^^^^^^^w-<# ",
+    " #>-<# ###########################>-<# ",
+    " #>-<#                           #>-<# ",
+    " #>-<#############################>-<# ",
+    " #>-avvvvvvvvvvvvvvvvvvvvvvvvvvvvvs-<# ",
+    " #>---------------------------------<# ",
+    " #1^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^3# ",
+    " ##################################### ",
+    "                                       "})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_i/ralf02_1.xml
===================================================================
--- trunk/data/levels/enigma_i/ralf02_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_i/ralf02_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,211 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Ibiza!" el:subtitle="" el:id="ralf02"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
-      <el:author  el:name="Ralf Westram" el:email="amgine at reallysoft.de" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Ralf Westram</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-floortile1 = "fl-space"
-floortile2 = "fl-metal"
-floortile3 = "fl-gradient"
-floortile4 = "fl-inverse"
-
-walltile   = "st-rock5"
-walltile2  = "st-glass"
-
-xw = 5
-yw = 5
-
-levelw = (xw*6)+3
-levelh = (yw*6)+2
-tiles = (xw*yw+1)/2
-                       mask = "1001100101010"
-if random(1,3)==1 then mask = "0101010100101" end
-if random(1,3)==1 then mask = "0101010100110" end
-if random(1,3)==1 then mask = "0100101010101" end
-
-create_world(levelw,levelh)
-
-fill_floor("fl-water")
-draw_border(walltile)
-
-display.SetFollowMode(display.FOLLOW_SMOOTH)
-
-ftilew = 10
-ftileh = 12
-stilew = 5
-stileh = 6
-floorw = (ftilew+2)*2
-floorh = 4*ftileh
-stonew = (stilew+1)*2
-stoneh = 4*stileh
-
-function set_floor_repeated(ftile,x,y)
-    local ly = y
-    while (ly < levelh) do
-        local lx = x
-        while (lx < levelw) do
-            if lx >= 0 and ly >= 0 then
-                if ftile == "fl-gradient" then
-                    set_floor(ftile,lx,ly,{type=random(1,8)})
-                else
-                    set_floor(ftile,lx,ly)
-                end
-            end
-            lx = lx + floorw
-        end
-        ly = ly + floorh
-    end
-end
-
-function set_stone_repeated(stile,x,y)
-    local ly = y
-    while (ly < (levelh-1)) do
-        local lx = x
-        while (lx < (levelw-1)) do
-            if lx > 0 and ly > 0 then
-                set_stone(stile,lx,ly)
-            end
-            lx = lx + stonew
-        end
-        ly = ly + stoneh
-    end
-end
-
-function fill_floor_repeated(ftile,x1,y1,x2,y2)
-    for x=x1, x2 do
-        for y=y1, y2 do
-            set_floor_repeated(ftile,x,y)
-        end
-    end
-end
-
-function fill_stone_repeated(stile,x1,y1,x2,y2)
-    for x=x1, x2 do
-        for y=y1, y2 do
-            set_stone_repeated(stile,x,y)
-        end
-    end
-end
-
-function draw_floor_tile(ftile,x,y,xt,yt)
-    set_floor_repeated(ftile,x+xt,           y+yt)
-    set_floor_repeated(ftile,x+(ftilew-xt-1),y+yt)
-    set_floor_repeated(ftile,x+(ftilew-xt-1),y+(ftileh-yt-1))
-    set_floor_repeated(ftile,x+xt,           y+(ftileh-yt-1))
-end
-
-function draw_floor_tiles(ftile,x,y,xt1,yt1,xt2,yt2)
-    for xt=xt1, xt2 do
-        for yt=yt1, yt2 do
-            draw_floor_tile(ftile,x,y,xt,yt)
-        end
-    end
-end
-
-function draw_stone_tile(stile,x,y,xt,yt)
-    set_stone_repeated(stile,x+xt,           y+yt)
-    set_stone_repeated(stile,x+(stilew-xt-1),y+yt)
-    set_stone_repeated(stile,x+(stilew-xt-1),y+(stileh-yt-1))
-    set_stone_repeated(stile,x+xt,           y+(stileh-yt-1))
-end
-
-count = 0
-
-function draw_oxyd_tile(x,y,xt,yt)
-    draw_stone_tile("st-fakeoxyd",x,y,xt,yt)
-    count = count+1
-    if (strsub(mask,count,count)=="1") then
-        local d = random(1,4)
-        if     (d == 1) then oxyd(x+xt,y+yt)
-        elseif (d == 2) then oxyd(x+(stilew-xt-1),y+yt)
-        elseif (d == 3) then oxyd(x+(stilew-xt-1),y+(stileh-yt-1))
-        elseif (d == 4) then oxyd(x+xt,           y+(stileh-yt-1))
-        end
-    end
-end
-
-function draw_oxyd_tile_repeated(x,y,xt,yt)
-    local ly = y
-    while (ly < (levelh-1)) do
-        local lx = x
-        while (lx < (levelw-1)) do
-            if lx > 0 and ly > 0 then
-                draw_oxyd_tile(lx,ly,xt,yt)
-            end
-            lx = lx + stonew
-        end
-        ly = ly + stoneh
-    end
-end
-
--- grobes Muster
-function draw_floor_i(ftile,x,y)
-    draw_floor_tiles(ftile,x,y,0,0,1,3)
-    draw_floor_tiles(ftile,x,y,2,0,3,1)
-    fill_floor_repeated(ftile,x+ftilew/2-1,y,x+ftilew/2,y+ftileh-1)
-end
-
--- feines Muster
-function draw_floor_i_fein(ftile,x,y)
-    draw_floor_tile(ftile,x,y,0,0)
-    draw_floor_tile(ftile,x,y,0,1)
-    draw_floor_tile(ftile,x,y,1,0)
-    fill_floor_repeated(ftile,x+ftilew/2,y,x+ftilew/2,y+ftileh-1)
-end
-
-function draw_stone_i(stile,x,y)
-    draw_stone_tile(stile,x,y,0,0)
-    draw_stone_tile(stile,x,y,0,1)
-    draw_stone_tile(stile,x,y,1,0)
-    draw_oxyd_tile_repeated(x,y,1,1)
-    fill_stone_repeated(stile,x+2,y,x+2,y+5)
-end
-
-function draw_floor_column(ftile1,ftile2,ftile3,ftile4,x,y)
-    draw_floor_i(ftile1,x, y)
-    draw_floor_i(ftile2,x, y+ftileh)
-    draw_floor_i(ftile3,x, y+ftileh*2)
-    draw_floor_i(ftile4,x, y+ftileh*3)
-end
-
--- starting positions of floor
-x1 = -3
-x2 = x1+(floorw/4)
-y1 = -4
-y2 = y1-(ftileh/2)
-
-draw_floor_column(floortile1,floortile2,floortile3,floortile4,x1,y1)
-draw_floor_column(floortile2,floortile3,floortile4,floortile1,x2,y2)
-draw_floor_column(floortile1,floortile2,floortile3,floortile4,x1+floorw/2,y1)
-draw_floor_column(floortile3,floortile4,floortile1,floortile2,x2+floorw/2,y2)
-
-x3 = 2
-y3 = 1
-
-draw_stone_i(walltile2,x3,         y3)
-draw_stone_i(walltile2,x3,         y3+stoneh/2)
-draw_stone_i(walltile2,x3+stonew/2,y3+stoneh/4)
-draw_stone_i(walltile2,x3+stonew/2,y3-stoneh/4)
-
-oxyd_shuffle()
-set_actor("ac-blackball", levelw/2+6, levelh/2+0.5)
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_i/ralf02_2.xml (from rev 1805, trunk/data/levels/enigma_i/ralf02_1.xml)
===================================================================
--- trunk/data/levels/enigma_i/ralf02_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_i/ralf02_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,82 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Ibiza!" el:subtitle="" el:id="ralf02"/>
+      <el:version el:score="1" el:release="2" el:revision="1" el:status="released"/>
+      <el:author  el:name="Ralf Westram" el:email="amgine at reallysoft.de" el:homepage=""/>
+      <el:copyright>Copyright ? 2003 Ralf Westram</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["FollowGrid"] = false
+wo["FollowMethod"] = FOLLOW_SCROLL
+
+ti["  "] = {"fl_metal"}
+ti[": "] = {"fl_inverse"}
+ti[". "] = {"fl_space"}
+ti["v"] = {"fl_slope_ps"}
+ti["^"] = {"fl_slope_pn"}
+ti[">"] = {"fl_slope_pe"}
+ti["<"] = {"fl_slope_pw"}
+ti["7"] = {"fl_slope_ose"}
+ti["9"] = {"fl_slope_osw"}
+ti["1"] = {"fl_slope_one"}
+ti["3"] = {"fl_slope_onw"}
+ti["s"] = {"fl_slope_ise"}
+ti["a"] = {"fl_slope_isw"}
+ti["w"] = {"fl_slope_ine"}
+ti["q"] = {"fl_slope_inw"}
+ti[" #"] = {"st_tigris"}
+ti[" ="] = {"st_rawglass"}
+ti[" O"] = {"st_oxyd"}
+ti[" Q"] = {"st_oxyd", oxydcolor=OXYD_FAKE}
+ti[" @"] = {"#ac_marble_black"}
+
+wo(res.composer(res.random(ti, "- ", {"v", "^", "<", ">", "1", "3", "7", "9", "q", "w", "a", "s"})), "  ", {
+    " # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #",
+    " #. .= = = = =            . .=-=-=-=-=- - - - - - . .= = = = =   #",
+    " #. .=-Q-=-Q-=- - - - - - . .=:Q:=:Q:=: : : : : : . .=-Q-=-Q-=-  #",
+    " #. . - -=- - - - - - - - . . : :=: : : : : : : : . . - -=- - -  #",
+    " #. . - -=. . - - . . - - . . : :=. . : : . . : : . . - -=. . -  #",
+    " #. .=-Q-=.Q.=- - . . - - . .=:Q:=.Q.=: : . . : : . .=-Q-=.Q.=-  #",
+    " #. .=.=.=.=.=- - . . . . . .=.=.=.=.=: : . . . . . .=.=.=.=.=-  #",
+    " #. . . . . . - -=.=.=.=.=. . . . . . : :=.=.=.=.=. . . . . . -  #",
+    " #            - -= O = Q =            : := Q = O =            -  #",
+    " #            - -    =                : :    =                -  #",
+    " #    - -     - -    =- -     : :     : :    =: :     - -     -  #",
+    " #    - -     - -= Q =-Q-=    : :     : := Q =:Q:=    - -     -  #",
+    " #    - - - - - -=-=-=-=-=    : : : : : :=:=:=:=:=    - - - - -  #",
+    " #   =-=-=-=-=- - - - - -    =:=:=:=:=: : : : : :    =-=-=-=-=-  #",
+    " #   =:O:=:Q:=: : : : : :    =.Q.=.Q.=. . . . . .    =:Q:=:Q:=:  #",
+    " #    : :=: : : : : : : :     . .=. . . . . . . .     : :=: : :  #",
+    " #    : :=    : :     : :     . .=    . .    @. .     : :=    :  #",
+    " #   =:Q:= Q =: :     : :    =.Q.= Q =. .     . .    =:Q:= O =:  #",
+    " #   = = = = =: :            = = = = =. .            = = = = =:  #",
+    " #            : := = = = =            . .= = = = =            :  #",
+    " #- - - - - - : :=-Q-=-Q-=- - - - - - . .=-Q-=-Q-=- - - - - - :  #",
+    " #- - - - - - : : - -=- - - - - - - - . . - -=- - - - - - - - :  #",
+    " #- - : : - - : : - -=: : - - . . - - . . - -=. . - - : : - - :  #",
+    " #- - : : - - : :=-O-=:Q:=- - . . - - . .=-Q-=.O.=- - : : - - :  #",
+    " #- - : : : : : :=:=:=:=:=- - . . . . . .=.=.=.=.=- - : : : : :  #",
+    " #- -=:=:=:=:=: : : : : : - -=.=.=.=.=. . . . . . - -=:=:=:=:=:  #",
+    " #- -=.Q.=.Q.=. . . . . . - -= Q = Q =            - -=.Q.=.Q.=.  #",
+    " #- - . .=. . . . . . . . - -    =                - - . .=. . .  #",
+    " #- - . .=- - . . - - . . - -    =- -     - -     - - . .=- - .  #",
+    " #- -=.Q.=-Q-=. . - - . . - -= Q =-Q-=    - -     - -=.Q.=-Q-=.  #",
+    " #- -=-=-=-=-=. . - - - - - -=-=-=-=-=    - - - - - -=-=-=-=-=.  #",
+    " # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #"})
+
+wo:shuffleOxyd()
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_i/siegfried08_1.xml
===================================================================
--- trunk/data/levels/enigma_i/siegfried08_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_i/siegfried08_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,95 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Good Luck!" el:subtitle="" el:id="level3d"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
-      <el:author  el:name="Siegfried Fennig" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Siegfried Fennig</el:copyright>
-      <el:license el:type="GPL version 2" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-levelw = 20
-levelh = 25
-
-create_world(levelw, levelh)
-draw_border("st-marble")
-fill_floor("fl-bluegreen")
-
-enigma.AddConstantForce(15,0)
-
---oxyd nicht veraendern--
-
-oxyd(16,21)
-oxyd(16,17)
-oxyd(16,23)
-oxyd(16,15)
-
---oxyd nicht veraendern--
-
-fill_floor("fl-inverse", 3,4, 3,7)
-fill_floor("fl-inverse", 2,5, 1,5)
-fill_floor("fl-inverse", 6,5, 1,5)
-fill_floor("fl-inverse", 11,5, 6,1)
-fill_floor("fl-inverse", 11,9, 6,1)
-
-draw_stones("st-marble", {2,2}, {1,0},16)
-draw_stones("st-marble", {10,4}, {1,0},9)
-draw_stones("st-marble", {10,8}, {1,0},9)
-draw_stones("st-marble", {8,6}, {1,0},10)
-draw_stones("st-marble", {8,10}, {1,0},10)
-draw_stones("st-marble", {10,12}, {1,0},9)
-draw_stones("st-marble", {2,12}, {1,0},7)
-draw_stones("st-marble", {2,13}, {0,1},6)
-draw_stones("st-marble", {2,20}, {0,1},4)
-draw_stones("st-marble", {3,14}, {1,0},15)
-draw_stones("st-marble", {17,15}, {0,1},4)
-draw_stones("st-marble", {17,20}, {0,1},4)
-draw_stones("st-marble", {4,16}, {1,0},11)
-draw_stones("st-marble", {4,18}, {1,0},11)
-draw_stones("st-marble", {4,20}, {1,0},11)
-draw_stones("st-marble", {4,22}, {1,0},11)
-set_stones("st-marble", {{16,16},{16,18},{16,20},{16,22}})
-set_stones("st-marble", {{8,4},{8,8}})
-
-set_stones("st-death", {{8,3},{8,5},{8,7},{8,9},{8,11}})
-set_stones("st-death", {{19,1},{19,3},{19,5},{19,7},{19,9},{19,11}})
-
-oneway(9,4, enigma.SOUTH)
-oneway(9,8, enigma.SOUTH)
-oneway(9,12, enigma.SOUTH)
-oneway(18,2, enigma.SOUTH)
-oneway(18,6, enigma.SOUTH)
-oneway(18,10, enigma.SOUTH)
-oneway(2,19, enigma.WEST)
-oneway(3,16, enigma.SOUTH)
-oneway(3,18, enigma.SOUTH)
-oneway(3,20, enigma.NORTH)
-oneway(3,22, enigma.NORTH)
-oneway(4,15, enigma.WEST)
-oneway(4,17, enigma.WEST)
-oneway(4,19, enigma.WEST)
-oneway(4,21, enigma.WEST)
-oneway(4,23, enigma.WEST)
-oneway(17,19, enigma.WEST)
-oneway(15,16, enigma.NORTH)
-oneway(15,18, enigma.NORTH)
-oneway(15,20, enigma.SOUTH)
-oneway(15,22, enigma.SOUTH)
-
-set_actor("ac-blackball", 4.5,1.5)
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_i/siegfried08_2.xml (from rev 1805, trunk/data/levels/enigma_i/siegfried08_1.xml)
===================================================================
--- trunk/data/levels/enigma_i/siegfried08_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_i/siegfried08_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,65 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Good Luck!" el:subtitle="" el:id="level3d"/>
+      <el:version el:score="1" el:release="2" el:revision="1" el:status="released"/>
+      <el:author  el:name="Siegfried Fennig" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2003 Siegfried Fennig</el:copyright>
+      <el:license el:type="GPL version 2" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["GlobalForce"] = po(15, 0)
+
+ti[" "] = {"fl_bluegreen"}
+ti["-"] = {"fl_inverse"}
+ti["#"] = {"st_redbrown"}
+ti["D"] = {"st_death"}
+ti["^"] = {"st_oneway", orientation=NORTH}
+ti[">"] = {"st_oneway", orientation=EAST}
+ti["V"] = {"st_oneway", orientation=SOUTH}
+ti["<"] = {"st_oneway", orientation=WEST}
+ti["O"] = {"st_oxyd", name="upper#"}
+ti["o"] = {"st_oxyd", name="lower#"}
+ti["@"] = {"#ac_marble_black"}
+
+wo(ti, " ", {
+    "####################",
+    "#   @              D",
+    "# ################V#",
+    "#       D          D",
+    "#  ---  #V##########",
+    "# ----- D  ------  D",
+    "# ----- ##########V#",
+    "# ----- D          D",
+    "# ----- #V##########",
+    "# ----- D  ------  D",
+    "#  ---  ##########V#",
+    "#       D          D",
+    "# #######V##########",
+    "# #                #",
+    "# ################ #",
+    "# # <           O# #",
+    "# #V###########^## #",
+    "# # <           O# #",
+    "# #V###########^## #",
+    "# < <            < #",
+    "# #^###########V## #",
+    "# # <           o# #",
+    "# #^###########V## #",
+    "# # <           o# #",
+    "####################"})
+
+wo:shuffleOxyd({"upper#*", "lower#*", min=1})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_iii/duffy16_1.xml
===================================================================
--- trunk/data/levels/enigma_iii/duffy16_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_iii/duffy16_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,222 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Control Panel" el:subtitle="" el:id="duffy16"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
-      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-rooms_wide=4
-rooms_high=1
-
-levelw=1+(19*rooms_wide)
-levelh=1+(12*rooms_high)
-
-create_world( levelw, levelh)
-
-fill_floor("fl-metal", 0,0,levelw,levelh)
-
-function renderLine( line, pattern)
-    for i=1, strlen(pattern) do
-        local c = strsub( pattern, i, i)
-        if c =="#" then
-            set_stone( "st-greenbrown", i-1, line)
-        elseif c == "o" then
-            oxyd( i-1, line)
-        elseif c == "P" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser1"})
-        elseif c == "Q" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser2"})
-        elseif c == "R" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser3"})
-        elseif c == "S" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser4"})
-        elseif c == "T" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser5"})
-        elseif c == "U" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser6"})
-        elseif c == "V" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser7"})
-        elseif c == "<" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser8"})
-        elseif c == "X" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser9"})
-        elseif c == "Y" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser10"})
-        elseif c == "a" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser11"})
-        elseif c == "b" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser12"})
-        elseif c == "c" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser13"})
-        elseif c == "d" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser14"})
-        elseif c == "e" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser15"})
-        elseif c == "f" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser16"})
-        elseif c == "g" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser17"})
-        elseif c == "h" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser18"})
-        elseif c == "i" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser19"})
-        elseif c == "j" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser20"})
-        elseif c == "k" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser21"})
-        elseif c == "l" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser22"})
-        elseif c == "m" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser23"})
-        elseif c == "n" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser24"})
-        elseif c == "`" then
-            set_item("it-trigger", i-1,line, {action="onoff",target="laser25"})
-        elseif c == "z" then
-            set_actor("ac-blackball", i-.5,line+.5)
-        elseif c == "p" then
-            set_attrib(laser(i-1,line, TRUE, EAST), "name", "laser1")
-        elseif c == "q" then
-            set_attrib(laser(i-1,line, TRUE, SOUTH), "name", "laser2")
-        elseif c == "r" then
-            set_attrib(laser(i-1,line, TRUE, EAST), "name", "laser3")
-        elseif c == "s" then
-            set_attrib(laser(i-1,line, TRUE, EAST), "name", "laser4")
-        elseif c == "t" then
-            set_attrib(laser(i-1,line, TRUE, EAST), "name", "laser5")
-        elseif c == "u" then
-            set_attrib(laser(i-1,line, TRUE, EAST), "name", "laser6")
-        elseif c == "v" then
-            set_attrib(laser(i-1,line, TRUE, EAST), "name", "laser7")
-        elseif c == "," then
-            set_attrib(laser(i-1,line, TRUE, EAST), "name", "laser8")
-        elseif c == "x" then
-            set_attrib(laser(i-1,line, TRUE, EAST), "name", "laser9")
-        elseif c == "y" then
-            set_attrib(laser(i-1,line, TRUE, EAST), "name", "laser10")
-        elseif c == "A" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser11")
-        elseif c == "B" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser12")
-        elseif c == "C" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser13")
-        elseif c == "D" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser14")
-        elseif c == "E" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser15")
-        elseif c == "F" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser16")
-        elseif c == "G" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser17")
-        elseif c == "H" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser18")
-        elseif c == "I" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser19")
-        elseif c == "J" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser20")
-        elseif c == "K" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser21")
-        elseif c == "L" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser22")
-        elseif c == "M" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser23")
-        elseif c == "N" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser24")
-        elseif c == "~" then
-            set_attrib(laser(i-1,line, FALSE, SOUTH), "name", "laser25")
-        elseif c == "+" then
-            set_stone("st-wood", i-1, line)
-        elseif c == "*" then
-            set_stone("st-brownie", i-1, line)
-        elseif c == "w" then
-            draw_stones("st-glass", {i-1,line},{1,0}, 1)
-        elseif c == "/" then
-            mirrorp(i-1,line,FALSE,FALSE, 4)
-        elseif c == ";" then
-            mirrorp(i-1,line,FALSE,FALSE, 2)
-        elseif c == "?" then
-            mirrorp(i-1,line,FALSE,TRUE, 4)
-        elseif c == ":" then
-            mirrorp(i-1,line,FALSE,TRUE, 2)
-        elseif c == "/" then
-            mirrorp(i-1,line,FALSE,FALSE, 4)
-        elseif c == ";" then
-            mirrorp(i-1,line,FALSE,FALSE, 2)
-        elseif c == "?" then
-            mirrorp(i-1,line,FALSE,TRUE, 4)
-        elseif c == ":" then
-            mirrorp(i-1,line,FALSE,TRUE, 2)
-        elseif c == "|" then
-            draw_stones("st-grate1",{i-1,line}, {1,1}, 1)
-        elseif c == "0" then
-            abyss(i-1,line)
-            draw_stones("st-glass", {i-1,line},{1,1}, 1)
-        elseif c == "1" then
-            fill_floor("fl-leaves", i-1,line,1,1)
-            draw_stones("st-glass", {i-1,line},{1,0}, 1)
-        elseif c == "2" then
-            fill_floor("fl-sand", i-1,line,1,1)
-            draw_stones("st-glass", {i-1,line},{1,0}, 1)
-        elseif c == "3" then
-            fill_floor("fl-bluegreen", i-1,line,1,1)
-            draw_stones("st-glass", {i-1,line},{1,0}, 1)
-        elseif c == "4" then
-            fill_floor("fl-inverse", i-1,line, 1,1)
-            draw_stones("st-glass", {i-1,line},{1,0}, 1)
-        elseif c == "@" then
-            document(i-1,line,"text1")
-        elseif c == "Z" then
-            document(i-1,line,"text2")
-        elseif c == "!" then
-            document(i-1,line,"text3")
-        end
-    end
-end
-
--- Floor:  " "
--- Border: "#"
--- Oxyd:   "o"
-
-renderLine(00, "#############################################################################")
-renderLine(01, "#                  #                  #       w/w        w                 ;#")
-renderLine(02, "#  0          w    #     021422133    #       www        #                y?#")
-renderLine(03, "#            www   #     3       2    #                  #                x?#")
-renderLine(04, "#  1    @    w#w   #   * 3 aPbQR 3 *  #                  #                ,?#")
-renderLine(05, "#           wwww   #   * 1 cdSef 1 *  #                  #                v?#")
-renderLine(06, "#o 2        w##w   |   *   gThij   *  |                 o#                u?#")
-renderLine(07, "#          wwwww   #   * 2 kUVlm 2 *  #                  #                t?#")
-renderLine(08, "#  3       w###w   #   * 3 <XnY` 3 *  #                  #                s?#")
-renderLine(09, "#         wwwwww   #     3   z   2    #                  #                r?#")
-renderLine(10, "#  4      w####w   #     321422130    #                  # ABCDEFGHIJKLMN~q #")
-renderLine(11, "#         wwwwww   #                  #                  #p::::::::::::::::/#")
-renderLine(12, "#############################################################################")
-
-oxyd_shuffle()
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-      <el:string el:key="text1">
-        <el:english el:translate="false">01011-00100-01...</el:english>
-      </el:string>
-      <el:string el:key="text2">
-        <el:english el:translate="true">The left-most room is important!</el:english>
-      </el:string>
-      <el:string el:key="text3">
-        <el:english el:translate="true">This is the control panel.</el:english>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_iii/duffy16_2.xml (from rev 1805, trunk/data/levels/enigma_iii/duffy16_1.xml)
===================================================================
--- trunk/data/levels/enigma_iii/duffy16_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_iii/duffy16_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,68 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Control Panel" el:subtitle="" el:id="duffy16"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_metal"}
+ti["#"] = {"st_greenbrown"}
+ti["="] = {"st_rawglass"}
+ti["*"] = {"st_brownie"}
+ti["|"] = {"st_grate", flavor="cross"}
+ti["0"] = ti["="] .. {"fl_abyss"}
+ti["1"] = ti["="] .. {"fl_lawn"}
+ti["2"] = ti["="] .. {"fl_sand"}
+ti["3"] = ti["="] .. {"fl_bluegreen"}
+ti["4"] = ti["="] .. {"fl_inverse"}
+ti[":"] = {"st_mirror", orientation=BACKSLASH, transparent=true}
+ti["."] = {"st_mirror", orientation=BACKSLASH}
+ti[","] = {"st_mirror", orientation=SLASH}
+ti["laseron"] = {"st_laser", name="laser%%", state=ON}
+ti["laseroff"] = {"st_laser", name="laser%%", state=OFF}
+ti["trigger"] = {"it_trigger", target="laser%%"}
+ti["!"] = {"it_document", text="text1"}
+ti["?"] = {"st_oxyd"}
+ti["@"] = {"#ac_marble_black"}
+
+wo(res.autotile(ti, {"A", "J", "laseron"}, {"K", "Y", "laseroff", 11}, {"a", "y", "trigger"}), " ", {
+    "#############################################################################",
+    "#                  #                  #       =,=        =                 .#",
+    "#  0          =    #     021422133    #       ===        #A. #, . #, . #    #",
+    "#            ===   #     3       2    #                  #B: # J: # R: #    #",
+    "#  1    !    =#=   #   * 3 kalbc 3 *  #                  #C: # K: # S: #    #",
+    "#           ====   #   * 1 mndop 1 *  #                  #D: # L: # T: #    #",
+    "#? 2        =##=   |   *   qerst   *  |                 ?#E: # M: # U: #    #",
+    "#          =====   #   * 2 ufgvw 2 *  #                  #F: # N: # V: #    #",
+    "#  3       =###=   #   * 3 hixjy 3 *  #                  #G: # O: # W: #    #",
+    "#         ======   #     3   @   2    #                  #H: # P: # X: #    #",
+    "#  4      =####=   #     321422130    #                  #I: # Q: # Y: #    #",
+    "#         ======   #                  #                  # .  ,#.  ,#.     ,#",
+    "#############################################################################"})
+
+wo:shuffleOxyd()
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+      <el:string el:key="text1">
+        <el:english el:translate="false">01011-00100-01...</el:english>
+      </el:string>
+      <el:string el:key="text2">
+        <el:english el:translate="true">The left-most room is important!</el:english>
+      </el:string>
+      <el:string el:key="text3">
+        <el:english el:translate="true">This is the control panel.</el:english>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_iii/index.xml
===================================================================
--- trunk/data/levels/enigma_iii/index.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_iii/index.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10400" network="false" owner="Enigma Team" release="1" revision="35" title="Enigma III"/>
+  <info enigma="1.10" group="Enigma" location="10400" network="false" owner="Enigma Team" release="1" revision="36" title="Enigma III"/>
 
   <attributes/>
 
@@ -21,7 +21,7 @@
     <level _seq="13" _title="Dependants" _xpath="./ant25_2" author="Petr Machata" ctrl="force" easy="true" id="ant25" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="14" _title="Use The PIN" _xpath="./martin99_1" author="Martin Hawlisch" ctrl="force" easy="true" id="martin99" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="15" _title="Space City" _xpath="./edward25_1" author="Edward" ctrl="force" easy="false" id="edward25" rel="1" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="16" _title="Control Panel" _xpath="./duffy16_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy16" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="16" _title="Control Panel" _xpath="./duffy16_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy16" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="17" _title="Wild" _xpath="./ant28_2" author="Petr Machata" ctrl="force" easy="false" id="ant28" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="18" _title="Teamwork" _xpath="./duffy25_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy25" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="19" _title="Yo-yo" _xpath="./duffy18_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy18" rel="1" rev="1" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_tutorial/index.xml
===================================================================
--- trunk/data/levels/enigma_tutorial/index.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_tutorial/index.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10100" network="false" owner="Enigma Team" release="1" revision="28" title="Tutorial"/>
+  <info enigma="1.10" group="Enigma" location="10100" network="false" owner="Enigma Team" release="1" revision="29" title="Tutorial"/>
 
   <attributes/>
 
@@ -63,7 +63,7 @@
     <level _seq="55" _title="The Grim Reaper" _xpath="enigma_i/daniel11_1" author="Daniel Heck" ctrl="force" easy="true" id="space" rel="1" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="56" _title="Automaton Magic" _xpath="enigma_ii/ant07_1" author="Petr Machata" ctrl="force" easy="false" id="ant07" rel="1" rev="6" score="1" target="time" unit="duration"/>
     <level _seq="57" _title="Back And Forth" _xpath="enigma_ii/martin26_3" author="Martin Hawlisch" ctrl="force" easy="false" id="martin26" rel="3" rev="3" score="2" target="time" unit="duration"/>
-    <level _seq="58" _title="If They'd Just Hold Still" _xpath="enigma_i/duffy21_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy21" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="58" _title="If They'd Just Hold Still" _xpath="enigma_i/duffy21_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy21" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="59" _title="Formentera!" _xpath="enigma_i/luc06_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc06" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="60" _title="- Meditation -" _xpath="enigma_ii/wb10_2" author="Jon 'WB' Sneyers" ctrl="force" easy="false" id="wb10" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="61" _title="Is It Easy?" _xpath="enigma_i/martin06_2" author="Martin Hawlisch" ctrl="force" easy="false" id="martin06" rel="2" rev="1" score="2" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_v/alain24_1.xml
===================================================================
--- trunk/data/levels/enigma_v/alain24_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_v/alain24_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,305 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Blet" el:subtitle="" el:id="alain24"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
-      <el:author  el:name="Alain Busser" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2006 Alain Busser</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="true" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="1:24" el:difficult="0:28"/>
-    </el:info>
-    <el:luamain><![CDATA[
-levelw = 20
-levelh = 13
-
-if difficult then 
-    numax=13
-elseif not difficult then
-    numax=16
-end
-
-create_world(levelw, levelh)
-oxyd_default_flavor = "a"
-display.SetFollowMode(display.FOLLOW_SCROLLING)
-fill_floor("fl-rough-blue", 0,0, level_width,level_height)
-
-function renderLine( line, pattern)
-    for i=1, strlen(pattern) do
-        local c = strsub( pattern, i, i)
-        if c =="#" then
-            set_stone( "st-glass1", i-1, line)
-          elseif c=="z" then
-            set_actor("ac-blackball",i-0.5,line+0.5,{player=0})
-        elseif c=="k" then
-            set_stone("st-switch",i-1,line,{action="callback", target="turncoins"})
-        elseif c=="V" then
-               mirrorp(i-1,line,FALSE,FALSE, 2)
-        elseif c=="/" then
-               mirrorp(i-1,line,FALSE,FALSE, 4)
-        elseif c=="<" then
-               mirror3(i-1,line,FALSE,FALSE, 2)
-        elseif c=="-" then
-            set_attrib(laser(i-1,line,FALSE, EAST), "name", "las1")
-        elseif c=="d" then
-            document(i-1,line,"text1")
-        elseif c=="A" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch1"})
-        elseif c=="B" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch2"})
-        elseif c=="C" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch3"})
-        elseif c=="D" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch4"})
-        elseif c=="E" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch5"})
-        elseif c=="F" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch6"})
-        elseif c=="G" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch7"})
-        elseif c=="H" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch8"})
-        elseif c=="I" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch9"})
-        elseif c=="J" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch10"})
-        elseif c=="K" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch11"})
-        elseif c=="L" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch12"})
-        elseif c=="M" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch13"})
-        elseif c=="N" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch14"})
-        elseif c=="O" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch15"})
-        elseif c=="P" then
-            set_stone("st-switch",i-1,line,{action="callback", target="switch16"})
-        elseif c=="o" then
-            oxyd(i-1,line)
-        end
-    end    
-end
-
--- display function -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
-
-function display()
-    if tab[1]==1 then set_floor("fl-leaves",12,4) else set_floor("fl-red",12,4) end
-    if tab[2]==1 then set_floor("fl-leaves",11,2) else set_floor("fl-red",11,2) end
-    if tab[3]==1 then set_floor("fl-leaves",10,1) else set_floor("fl-red",10,1) end
-    if tab[4]==1 then set_floor("fl-leaves",8,0) else set_floor("fl-red",8,0) end
-    if tab[5]==1 then set_floor("fl-leaves",5,0) else set_floor("fl-red",5,0) end
-    if tab[6]==1 then set_floor("fl-leaves",3,1) else set_floor("fl-red",3,1) end
-    if tab[7]==1 then set_floor("fl-leaves",2,2) else set_floor("fl-red",2,2) end
-    if tab[8]==1 then set_floor("fl-leaves",1,4) else set_floor("fl-red",1,4) end
-    if tab[9]==1 then set_floor("fl-leaves",1,7) else set_floor("fl-red",1,7) end
-    if tab[10]==1 then set_floor("fl-leaves",2,9) else set_floor("fl-red",2,9) end
-    if tab[11]==1 then set_floor("fl-leaves",3,10) else set_floor("fl-red",3,10) end
-    if tab[12]==1 then set_floor("fl-leaves",5,11) else set_floor("fl-red",5,11) end
-    if tab[13]==1 then set_floor("fl-leaves",8,11) else set_floor("fl-red",8,11) end
-    if tab[14]==1 then set_floor("fl-leaves",10,10) else set_floor("fl-red",10,10) end
-    if tab[15]==1 then set_floor("fl-leaves",11,9) else set_floor("fl-red",11,9) end
-    if tab[16]==1 then set_floor("fl-leaves",12,7) else set_floor("fl-red",12,7) end
-    num=0
-    for n=1,16 do if tab[n]==1 then num=num+1 end end
-    if num>= numax then SendMessage("las1","on") end
-end
-
--- switch functions -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
-
-function switch1()
-  if (not difficult) or (tab[16]~=tab[1] and tab[2]~=tab[1]) then
-    tab[16]=1-tab[16]
-    tab[1]=1-tab[1]
-    tab[2]=1-tab[2]
-  end
-    display()
-end
-
-function switch2()
-  if (not difficult) or (tab[1]~=tab[2] and tab[3]~=tab[2]) then
-    tab[1]=1-tab[1]
-    tab[2]=1-tab[2]
-    tab[3]=1-tab[3]
-  end
-    display()
-end
-
-function switch3()
-  if (not difficult) or (tab[2]~=tab[3] and tab[4]~=tab[3]) then
-    tab[2]=1-tab[2]
-    tab[3]=1-tab[3]
-    tab[4]=1-tab[4]
-  end
-    display()
-end
-
-function switch4()
-  if (not difficult) or (tab[3]~=tab[4] and tab[5]~=tab[4]) then
-    tab[3]=1-tab[3]
-    tab[4]=1-tab[4]
-    tab[5]=1-tab[5]
-  end
-    display()
-end
-
-function switch5()
-  if (not difficult) or (tab[4]~=tab[5] and tab[6]~=tab[5]) then
-    tab[4]=1-tab[4]
-    tab[5]=1-tab[5]
-    tab[6]=1-tab[6]
-  end
-    display()
-end
-
-function switch6()
-  if (not difficult) or (tab[5]~=tab[6] and tab[7]~=tab[6]) then
-    tab[5]=1-tab[5]
-    tab[6]=1-tab[6]
-    tab[7]=1-tab[7]
-  end
-    display()
-end
-
-function switch7()
-  if (not difficult) or (tab[6]~=tab[7] and tab[8]~=tab[7]) then
-    tab[6]=1-tab[6]
-    tab[7]=1-tab[7]
-    tab[8]=1-tab[8]
-  end
-    display()
-end
-
-function switch8()
-  if (not difficult) or (tab[7]~=tab[8] and tab[9]~=tab[8]) then
-    tab[7]=1-tab[7]
-    tab[8]=1-tab[8]
-    tab[9]=1-tab[9]
-  end
-    display()
-end
-
-function switch9()
-  if (not difficult) or (tab[8]~=tab[9] and tab[10]~=tab[9]) then
-    tab[8]=1-tab[8]
-    tab[9]=1-tab[9]
-    tab[10]=1-tab[10]
-  end
-    display()
-end
-
-function switch10()
-  if (not difficult) or (tab[9]~=tab[10] and tab[11]~=tab[10]) then
-    tab[9]=1-tab[9]
-    tab[10]=1-tab[10]
-    tab[11]=1-tab[11]
-  end
-    display()
-end
-
-function switch11()
-  if (not difficult) or (tab[10]~=tab[11] and tab[12]~=tab[11]) then
-    tab[10]=1-tab[10]
-    tab[11]=1-tab[11]
-    tab[12]=1-tab[12]
-  end
-    display()
-end
-
-function switch12()
-  if (not difficult) or (tab[11]~=tab[12] and tab[13]~=tab[12]) then
-    tab[11]=1-tab[11]
-    tab[12]=1-tab[12]
-    tab[13]=1-tab[13]
-  end
-    display()
-end
-
-function switch13()
-  if (not difficult) or (tab[12]~=tab[13] and tab[14]~=tab[13]) then
-    tab[12]=1-tab[12]
-    tab[13]=1-tab[13]
-    tab[14]=1-tab[14]
-  end
-    display()
-end
-
-function switch14()
-  if (not difficult) or (tab[13]~=tab[14] and tab[15]~=tab[14]) then
-    tab[13]=1-tab[13]
-    tab[14]=1-tab[14]
-    tab[15]=1-tab[15]
-  end
-    display()
-end
-
-function switch15()
-  if (not difficult) or (tab[14]~=tab[15] and tab[16]~=tab[15]) then
-    tab[14]=1-tab[14]
-    tab[15]=1-tab[15]
-    tab[16]=1-tab[16]
-  end
-    display()
-end
-
-function switch16()
-  if (not difficult) or (tab[15]~=tab[16] and tab[1]~=tab[16]) then
-    tab[15]=1-tab[15]
-    tab[16]=1-tab[16]
-    tab[1]=1-tab[1]
-  end
-    display()
-end
-
-function reset()
-    for i=0,7 do
-        tab[2*i+1]=0
-        tab[2*i+2]=1
-    end
-    display()
-end
-
---               01234567890123456789
-renderLine(00 , "               /V/Vo")
-renderLine(01 , "                    ")
-renderLine(02 , "      ED            ")
-renderLine(03 , "     F  C           ")
-renderLine(04 , "    G    B          ")  
-renderLine(05 , "   H  z   A     V/V/")
-renderLine(06 , "   I  d   P   -<    ")
-renderLine(07 , "    J    O      /V/V")
-renderLine(08 , "     K  N           ")
-renderLine(09 , "      LM            ")
-renderLine(10 , "                    ")
-renderLine(11 , "                    ")
-renderLine(12 , "               V/V/o")
---               01234567890123456789
-
-if difficult then
-    document(6,7,"text2")
-end
-tab={}
-reset()
-oxyd_shuffle()
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-      <el:string el:key="text1">
-        <el:english el:translate="true">When you change the color of one square, the colors of the 2 nearest squares change as well; you must get as many green squares as possible.</el:english>
-        <el:translation el:lang="fr">En changeant la couleur d'une pastille, les deux pastilles adjacentes changent aussi de couleur; le but du jeu est d'obtenir le plus grand nombre possible de pastilles vertes.</el:translation>
-      </el:string> 
-      <el:string el:key="text2">
-        <el:english el:translate="true">You are only allowed to change a color when it is surrounded by the other color.</el:english>
-        <el:translation el:lang="fr">Vous ne pouvez changer une pastille que dans l'un des deux cas suivants: rouge-vert-rouge, ou vert-rouge-vert.</el:translation>
-      </el:string> 
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_v/alain24_2.xml (from rev 1805, trunk/data/levels/enigma_v/alain24_1.xml)
===================================================================
--- trunk/data/levels/enigma_v/alain24_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_v/alain24_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,74 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Blet" el:subtitle="" el:id="alain24"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Alain Busser" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2006 Alain Busser</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="1:24" el:difficult="0:28"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_blueslab"}
+ti["r"] = {"fl_red", name="red#", _other="g"}
+ti["g"] = {"fl_lawn", name="green#", _other="r"}
+ti[">"] = {"st_laser", orientation=EAST, name="laser"}
+ti["<"] = {"st_mirror", flavor="triangle", orientation=WEST}
+ti["M"] = {"st_mirror", orientation=SLASH}
+ti["N"] = {"st_mirror", orientation=BACKSLASH}
+ti["S"] = {"st_switch", target="change"}
+ti["d"] = {"it_document", text="text1"}
+ti["e"] = cond(wo["IsDifficult"], {"it_document", text="text2"}, ti[" "])
+ti["O"] = {"st_oxyd"}
+ti["@"] = {"ac_marble_black"}
+
+wo(ti, " ", {
+    "     r  g      MNMNO",
+    "   g      r         ",
+    "  r   SS   g        ",
+    "     S  S           ",
+    " g  S    S  r   NMNM",
+    "   S      S   ><    ",
+    "   S  d@  S     MNMN",
+    " r  S e  S  g       ",
+    "     S  S           ",
+    "  g   SS   r        ",
+    "   r      g         ",
+    "     g  r      NMNMO"})
+
+function change(value, sender)
+    all = no["red#*"] + no["green#*"]
+    cen = all:nearest(sender)
+    left = (all-cen):nearest(cen)
+    right = (all-cen-left):nearest(cen)
+    if not wo["IsDifficult"] or
+       no["red#*"][cen] and no["green#*"][left] and no["green#*"][right] or
+       no["green#*"][cen] and no["red#*"][left] and no["red#*"][right] then
+        wo[cen] = ti[cen["_other"]]
+        wo[left] = ti[left["_other"]]
+        wo[right] = ti[right["_other"]]
+    end
+    if #no["red#*"] == 0 or wo["IsDifficult"] and #no["red#*"] == 3 then
+        no["laser"]:on()
+    end
+end
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+      <el:string el:key="text1">
+        <el:english el:translate="true">When you change the color of one square, the colors of the 2 nearest squares change as well; you must get as many green squares as possible.</el:english>
+        <el:translation el:lang="fr">En changeant la couleur d'une pastille, les deux pastilles adjacentes changent aussi de couleur; le but du jeu est d'obtenir le plus grand nombre possible de pastilles vertes.</el:translation>
+      </el:string>
+      <el:string el:key="text2">
+        <el:english el:translate="true">You are only allowed to change a color when it is surrounded by the other color.</el:english>
+        <el:translation el:lang="fr">Vous ne pouvez changer une pastille que dans l'un des deux cas suivants: rouge-vert-rouge, ou vert-rouge-vert.</el:translation>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_v/duffy95_1.xml
===================================================================
--- trunk/data/levels/enigma_v/duffy95_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_v/duffy95_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,128 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Automaton" el:subtitle="" el:id="duffy95"/>
-      <el:version el:score="1" el:release="1" el:revision="1" el:status="released"/>
-      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-rooms_wide=1
-rooms_high=1
-
-levelw=1+(19*rooms_wide) +1
-levelh=1+(12*rooms_high)
-
-create_world( levelw, levelh)
-enigma.ConserveLevel = 0
-
-fill_floor("fl-leaves", 0,0,levelw,levelh)
-
-function renderLine( line, pattern)
-    for i=1, strlen(pattern) do
-        local c = strsub( pattern, i, i)
-        if c =="#" then
-            set_stone( "st-greenbrown", i-1, line)
-        elseif c =="w" then
-            set_stone( "st-glass", i-1, line)
-        elseif c == "o" then
-            oxyd( i-1, line)
-        elseif c == "*" then
-            set_stone( "st-brownie", i-1, line)
-        elseif c == "!" then
-            abyss(i-1,line)
-        elseif c == "~" then
-            set_floor("fl-water",i-1,line)
-        elseif c=="z" then
-            set_actor("ac-blackball", i-1,line+.5, {player=0})
-        elseif c == "g" then
-            draw_stones("st-grate1",{i-1,line}, {1,1}, 1)
-        elseif c=="+" then
-            set_stone( "st-wood", i-1, line)
-        elseif c=="=" then
-            set_floor("fl-space",i-1,line)
-        elseif c=="C" then
-            set_stone( "st-rotator-right", i-1, line)
-        elseif c=="c" then
-            set_stone( "st-rotator-left", i-1, line)
-        elseif c=="H" then
-            set_stone( "st-blocker", i-1, line)
-        elseif c == "N" then
-            set_stone("st-bolder", i-1,line, {name="bolder1",direction=NORTH})
-        elseif c == "E" then
-            set_stone("st-bolder", i-1,line, {name="bolder1",direction=EAST})
-        elseif c == "S" then
-            set_stone("st-bolder", i-1,line, {name="bolder1",direction=SOUTH})
-        elseif c == "W" then
-            set_stone("st-bolder", i-1,line, {name="bolder1",direction=WEST})
-            set_floor("fl-water",i-1,line)
-        elseif c == "A" then
-            set_stone("st-coinslot",i-1,line,{action="onoff", target="laser1"})
-        elseif c == "I" then
-            set_item("it-trigger", i-1,line, {action="callback", target="funcc2"})
-        elseif c == "B" then
-            doorv( i-1,line, {name="door1"})
-        elseif c == "X" then
-            set_attrib(laser(i-1,line, FALSE, WEST), "name", "laser1")
-        elseif c == "b" then
-            set_stone("st-break_bolder",i-1,line)
-        elseif c == "l" then
-            set_stone("st-break_acwhite",i-1,line)
-        elseif c == ";" then
-            mirrorp(i-1,line,FALSE,FALSE, 2)
-        elseif c == "/" then
-            mirrorp(i-1,line,FALSE,FALSE, 4)
-        elseif c == ":" then
-            mirrorp(i-1,line,FALSE,TRUE, 2)
-        elseif c == "?" then
-            mirrorp(i-1,line,FALSE,TRUE, 4)
-        elseif c == "s" then
-            set_stone("st-laserswitch",i-1,line,{action="callback",target="funcc1"})
-        elseif c == "t" then
-            set_item("it-coin2", i-1,line)
-        elseif c == "T" then
-            set_stone("st-switch",i-1,line,{action="callback",target="funcc2"})
-        elseif c == "R" then
-            set_stone("st-oneway", i-1,line, {orientation=enigma.EAST})
-        end
-    end
-end
-
-renderLine(00,"##############c###s##")
-renderLine(01,"#  B   / Cxxxxx /w:X#")
-renderLine(02,"#oo#;     x ? x ?####")
-renderLine(03,"####?    ?x cxxxxxlW#")
-renderLine(04,"#C   : :  x  xx;  lc#")
-renderLine(05,"#xxxxxccxxxxxxx  Cl##")
-renderLine(06,"#x  /x  x x ?Cxxxx ##")
-renderLine(07,"#x cxxxxx;x /  : x?##")
-renderLine(08,"#x  xx  C?xz  ? /x ##")
-renderLine(09,"cxxxxxxxxxxxxxxxxxc##")
-renderLine(10,"#   cC####H####   :##")
-renderLine(11,"#    R      tA#/  /##")
-renderLine(12,"##########!##########")
-
-ff1=0
-function funcc1()
-    if ff1==0 then
-        SendMessage("door1","open")
-        ff1=1
-    end
-end
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_v/duffy95_2.xml (from rev 1805, trunk/data/levels/enigma_v/duffy95_1.xml)
===================================================================
--- trunk/data/levels/enigma_v/duffy95_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_v/duffy95_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,61 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Automaton" el:subtitle="" el:id="duffy95"/>
+      <el:version el:score="1" el:release="2" el:revision="2" el:status="released"/>
+      <el:author  el:name="Jacob Scott" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2003 Jacob Scott</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = false
+
+ti[" "] = {"fl_lawn"}
+ti["-"] = {"fl_abyss"}
+ti["#"] = {"st_greenbrown"}
+ti["G"] = {"st_rawglass"}
+ti["B"] = {"st_break_white"}
+ti["H"] = {"st_blocker"}
+ti["M"] = {"st_mirror", orientation=SLASH}
+ti["N"] = {"st_mirror", orientation=BACKSLASH}
+ti["m"] = {"st_mirror", orientation=SLASH, transparent=true}
+ti["n"] = {"st_mirror", orientation=BACKSLASH, transparent=true}
+ti["r"] = {"st_rotator", state=CCW}
+ti["R"] = {"st_rotator", state=CW}
+ti[">"] = {"st_oneway", orientation=EAST}
+ti["<"] = {"st_boulder", orientation=WEST}
+ti["D"] = {"st_door", flavor="d", faces="ew", name="door"}
+ti["S"] = {"st_laserswitch", target="door", action="open"}
+ti["L"] = {"st_laser", orientation=WEST, name="laser"}
+ti["C"] = {"st_coinslot", target="laser"}
+ti["c"] = {"it_coin_m"}
+ti["O"] = {"st_oxyd"}
+ti["@"] = {"#ac_marble"}
+
+wo(ti, " ", {
+    "##############r###S##",
+    "#  D   M R      MGnL#",
+    "#OO#N       m   m####",
+    "####m    m  r     B<#",
+    "#R   n n       N  Br#",
+    "#     rr         RB##",
+    "#   M       mR     ##",
+    "#  r     N  M  n  m##",
+    "#       Rm @  m M  ##",
+    "r                 r##",
+    "#   rR####H####   n##",
+    "#    >      cC#M  M##",
+    "##########-##########"})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_v/index.xml
===================================================================
--- trunk/data/levels/enigma_v/index.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_v/index.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10600" network="false" owner="Enigma Team" release="1" revision="45" title="Enigma V"/>
+  <info enigma="1.10" group="Enigma" location="10600" network="false" owner="Enigma Team" release="1" revision="46" title="Enigma V"/>
 
   <attributes/>
 
@@ -54,15 +54,15 @@
     <level _seq="46" _title="Turnstile Maze" _xpath="./duffy53_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy53" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="47" _title="Swamp Stomp" _xpath="./ralf11_3" author="Ralf Westram" ctrl="force" easy="true" id="ralf11" rel="3" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="48" _title="Crossfire" _xpath="./duffy56_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy56" rel="2" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="49" _title="Swamp of Balls" _xpath="./luc08_1" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc08" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="49" _title="Swamp of Balls" _xpath="./luc08_2" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc08" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="50" _title="Anticipation" _xpath="./duffy67_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy67" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="51" _title="Build Up and Tear Down" _xpath="./duffy70_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy70" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="52" _title="Designed with love" _xpath="./just01_1" author="JuSt" ctrl="force" easy="false" id="just01" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="53" _title="A bayou by you" _xpath="./alain21_1" author="Alain Busser" ctrl="force" easy="false" id="alain21" rel="1" rev="0" score="1" target="time" unit="duration"/>
     <level _seq="54" _title="Mirror Shop" _xpath="./siegfried25_2" author="Siegfried Fennig" ctrl="force" easy="false" id="level9a" rel="2" rev="1" score="1" target="time" unit="duration"/>
-    <level _seq="55" _title="Blet" _xpath="./alain24_1" author="Alain Busser" ctrl="force" easy="true" id="alain24" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="55" _title="Blet" _xpath="./alain24_2" author="Alain Busser" ctrl="force" easy="true" id="alain24" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="56" _title="Banana Republic" _xpath="./alain26_2" author="Alain Busser" ctrl="force" easy="true" id="alain26" rel="2" rev="2" score="2" target="time" unit="duration"/>
-    <level _seq="57" _title="Too Heavy?" _xpath="./martin101_1" author="Martin Hawlisch" ctrl="force" easy="true" id="martin101" rel="1" rev="0" score="1" target="time" unit="duration"/>
+    <level _seq="57" _title="Too Heavy?" _xpath="./martin101_2" author="Martin Hawlisch" ctrl="force" easy="true" id="martin101" rel="2" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="58" _title="Now What?" _xpath="./duffy127_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy127" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="59" _title="Pneumatic Delivery" _xpath="./malla01_3" author="Manuel K?nig" ctrl="force" easy="true" id="malla01" rel="3" rev="4" score="2" target="time" unit="duration"/>
     <level _seq="60" _title="Jumpin' Jack Flash" _xpath="./ss10_2" author="Sven Siggelkow" ctrl="force" easy="true" id="ss10" rel="2" rev="3" score="1" target="time" unit="duration"/>
@@ -102,7 +102,7 @@
     <level _seq="94" _title="Pipes and Plumbing" _xpath="./andreas27_1" author="Andreas Lochmann" ctrl="force" easy="true" id="andreas27" rel="1" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="95" _title="You Must Be Kidding" _xpath="./duffy91_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy91" rel="1" rev="1" score="1" target="time" unit="duration"/>
     <level _seq="96" _title="The Chamber" _xpath="./luc31_3" author="Lukas Sch?ller" ctrl="force" easy="false" id="luc31" rel="3" rev="3" score="2" target="time" unit="duration"/>
-    <level _seq="97" _title="Automaton" _xpath="./duffy95_1" author="Jacob Scott" ctrl="force" easy="false" id="duffy95" rel="1" rev="1" score="1" target="time" unit="duration"/>
+    <level _seq="97" _title="Automaton" _xpath="./duffy95_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy95" rel="2" rev="2" score="1" target="time" unit="duration"/>
     <level _seq="98" _title="Caterpillar" _xpath="./nat15_2" author="Nat Pryce" ctrl="force" easy="true" id="nat15" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="99" _title="Spacestation" _xpath="./raoul23_1" author="Raoul Bourquin" ctrl="force" easy="true" id="raoul23" rel="1" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="100" _title="Island Labyrinth" _xpath="./duffy129_2" author="Jacob Scott" ctrl="force" easy="false" id="duffy129" rel="2" rev="2" score="1" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_v/luc08_1.xml
===================================================================
--- trunk/data/levels/enigma_v/luc08_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_v/luc08_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,71 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Swamp of Balls" el:subtitle="" el:id="luc08"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
-      <el:author  el:name="Lukas Sch?ller" el:email="Lucky_Luc at web.de" el:homepage=""/>
-      <el:copyright>Copyright ? 2005 Lukas Sch?ller</el:copyright>
-      <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-      </el:compatibility>
-      <el:modes el:easy="false" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
--- Function to open the oxyds
-grad = 1
-function comeback()
-  if(grad == 1) then
-    draw_floor("fl-wood", {18,1}, {0,2}, 6)
-    grad = 2
-  else
-    draw_floor("fl-gradient", {18,1}, {0,2}, 6, {type=3})
-    grad = 1
-  end
-end
-
--- Environment
-CreateWorld(20, 13) 
-draw_border("st-rock1")
-fill_floor("fl-wood", 0,0, 20,13)
-fill_floor("fl-swamp", 0,0, 17,13)
-draw_stones("st-white4", {18,1}, {0,2}, 6)
-draw_stones("st-rock1", {18,2}, {0,2}, 5)
-draw_floor("fl-gradient", {18,1}, {0,2}, 6, {type=3})
-
-set_floor("fl-wood", 4,4)
-set_actor("ac-whiteball", 4.5,8.5, {player=1, mouseforce=0, essential=1})
-set_floor("fl-wood", 4,8)
-set_actor("ac-whiteball", 4.5,4.5, {player=1, mouseforce=0, essential=1})
-set_floor("fl-wood", 8,4)
-set_actor("ac-whiteball", 8.5,4.5, {player=1, mouseforce=0, essential=1})
-set_floor("fl-wood", 12,4)
-set_actor("ac-whiteball", 12.5,4.5, {player=1, mouseforce=0, essential=1})
-set_floor("fl-wood", 8,8)
-set_actor("ac-whiteball", 8.5,8.5, {player=1, mouseforce=0, essential=1})
-set_floor("fl-wood", 12,8)
-set_actor("ac-whiteball", 12.5,8.5, {player=1, mouseforce=0, essential=1})
-
-oxyd_default_flavor = "c"
-oxyd(19,1)
-oxyd(19,3)
-oxyd(19,5)
-oxyd(19,7)
-oxyd(19,11)
-oxyd(19,9)
-oxyd_shuffle()
-
-set_item("it-trigger", 17,6, {action="callback", target="comeback"})
-set_actor("ac-blackball",17.5,6.5, {player=0})
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_v/luc08_2.xml (from rev 1805, trunk/data/levels/enigma_v/luc08_1.xml)
===================================================================
--- trunk/data/levels/enigma_v/luc08_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_v/luc08_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,53 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Swamp of Balls" el:subtitle="" el:id="luc08"/>
+      <el:version el:score="1" el:release="2" el:revision="1" el:status="released"/>
+      <el:author  el:name="Lukas Sch?ller" el:email="Lucky_Luc at web.de" el:homepage=""/>
+      <el:copyright>Copyright ? 2005 Lukas Sch?ller</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_wood"}
+ti["-"] = {"fl_swamp"}
+ti[">"] = {"fl_slope_pe"}
+ti["#"] = {"st_granite"}
+ti["P"] = {"st_passage", color=WHITE, flavor="frame", name="passages#"}
+ti["t"] = {"it_trigger", target="slopes"}
+ti["O"] = {"st_oxyd", name="oxyd#", flavor="c"}
+ti["A"] = {"#ac_marble_white", owner=DEFAULT, controllers=CTRL_NONE, essential=INDISPENSABLE}
+ti["@"] = ti["t"] .. {"#ac_marble_black"}
+
+wo(ti, " ", {
+    "####################",
+    "#---------------- PO",
+    "#---------------- ##",
+    "#---------------- PO",
+    "#---A---A---A---- ##",
+    "#---------------- PO",
+    "#----------------@##",
+    "#---------------- PO",
+    "#---A---A---A---- ##",
+    "#---------------- PO",
+    "#---------------- ##",
+    "#---------------- PO",
+    "####################"})
+
+wo:shuffleOxyd({no["oxyds#*"]:sort("linear"), linear=true})
+
+function slopes(value, sender)
+    wo[no["passages#*"]] = cond(value, ti[">"], ti[" "])
+end
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_v/martin101_1.xml
===================================================================
--- trunk/data/levels/enigma_v/martin101_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_v/martin101_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,66 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-      <el:identity el:title="Too Heavy?" el:subtitle="" el:id="martin101"/>
-      <el:version el:score="1" el:release="1" el:revision="0" el:status="released"/>
-      <el:author  el:name="Martin Hawlisch" el:email="" el:homepage=""/>
-      <el:copyright>Copyright ? 2003 Martin Hawlisch</el:copyright>
-      <el:license el:type="GPL version 2" el:open="true"/>
-      <el:compatibility el:enigma="0.92">
-       <el:dependency el:path="lib/ant" el:id="lib/ant" el:release="1" el:preload="true"/>
-      </el:compatibility>
-      <el:modes el:easy="true" el:single="true" el:network="false"/>
-      <el:comments>
-        <el:code>Lua 5.1 and XML converted by Leveladministrators</el:code>
-      </el:comments>
-      <el:score el:easy="-" el:difficult="-"/>
-    </el:info>
-    <el:luamain><![CDATA[
-cells={}
-
-cells[" "]=cell{floor="fl-metal"}
-cells["#"]=cell{stone="st-rock2"}
-cells["~"]=cell{floor="fl-water"}
-if not difficult then -- easy
-    cells["-"]=cells[" "]
-else
-    cells["-"]=cells["~"]
-end
-cells["w"]=cell{item="it-weight"}
-cells["k"]=cell{item="it-floppy"}
-cells["<"]=cell{stone="st-oneway-w"}
-cells[">"]=cell{stone="st-oneway-e"}
-cells["S"]=cell{stone={"st-floppy", {action="openclose", target="door1"}}}
-cells["="]=cell{{{doorh, {name="door1"}}}}
-cells["o"]=cell{parent=cells[" "],actor={"ac-blackball", {player=0, mouseforce=1}}}
-
-level = {
-   "####################",
-   "#                  #",
-   "#                o #",
-   "#                  #",
-   "#   ###########~~~~#",
-   "#   >wwwwwwwwwww~~~#",
-   "#   ###########w~~~#",
-   "#   <kwwwwwwwwww~~~#",
-   "##=S###########~~~~#",
-   "#                  #",
-   "# -- -- -  - -- -- #",
-   "# -- -- -  - -- -- #",
-   "#0##0##0#00#0##0##0#"
-}
-
-set_default_parent(cells[" "])
-
-create_world_by_map(level,cells)
-
-oxyd_shuffle()
-    ]]></el:luamain>
-    <el:i18n>
-      <el:string el:key="title">
-        <el:english el:translate="false"/>
-      </el:string>
-    </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_v/martin101_2.xml (from rev 1805, trunk/data/levels/enigma_v/martin101_1.xml)
===================================================================
--- trunk/data/levels/enigma_v/martin101_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_v/martin101_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,52 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Too Heavy?" el:subtitle="" el:id="martin101"/>
+      <el:version el:score="1" el:release="2" el:revision="1" el:status="released"/>
+      <el:author  el:name="Martin Hawlisch" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2003 Martin Hawlisch</el:copyright>
+      <el:license el:type="GPL version 2" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_metal"}
+ti["~"] = {"fl_water"}
+ti["-"] = cond(wo["IsDifficult"], ti["~"], ti[" "])
+ti["#"] = {"st_darkgray"}
+ti[">"] = {"st_oneway", orientation=EAST}
+ti["<"] = {"st_oneway", orientation=WEST}
+ti["="] = {"st_door", flavor="d", faces="ns", name="door"}
+ti["F"] = {"st_floppy", target="door"}
+ti["f"] = {"it_floppy"}
+ti["w"] = {"it_weight"}
+ti["O"] = {"st_oxyd", name="oxyds#"}
+ti["@"] = {"#ac_marble_black"}
+
+wo(ti, " ", {
+    "####################",
+    "#                  #",
+    "#                @ #",
+    "#                  #",
+    "#   ###########~~~~#",
+    "#   >wwwwwwwwwww~~~#",
+    "#   ###########w~~~#",
+    "#   <fwwwwwwwwww~~~#",
+    "##=F###########~~~~#",
+    "#                  #",
+    "# -- -- -  - -- -- #",
+    "# -- -- -  - -- -- #",
+    "#O##O##O#OO#O##O##O#"})
+
+wo:shuffleOxyd({no["oxyds#*"]:sort("linear"), linear=true})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_vii/index.xml
===================================================================
--- trunk/data/levels/enigma_vii/index.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_vii/index.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10800" network="false" owner="Enigma Team" release="1" revision="58" title="Enigma VII"/>
+  <info enigma="1.10" group="Enigma" location="10800" network="false" owner="Enigma Team" release="1" revision="59" title="Enigma VII"/>
 
   <attributes/>
 
@@ -62,8 +62,8 @@
     <level _seq="54" _title="Give more Way" _xpath="./just21_2" author="JuSt" ctrl="force" easy="true" id="just21" rel="2" rev="4" score="2" target="time" unit="duration"/>
     <level _seq="55" _title="Give Way 4 two" _xpath="./just22_2" author="JuSt" ctrl="force" easy="true" id="just22" rel="2" rev="3" score="2" target="time" unit="duration"/>
     <level _seq="56" _title="Lost in Time and Space" _xpath="./just23_2" author="JuSt" ctrl="force" easy="false" id="just23" rel="2" rev="6" score="2" target="time" unit="duration"/>
-    <level _seq="57" _title="Alternatives?" _xpath="./just24_1" author="JuSt" ctrl="force" easy="true" id="just24" rel="1" rev="2" score="1" target="time" unit="duration"/>
-    <level _seq="58" _title="No More Alternatives" _xpath="./just25_1" author="JuSt" ctrl="force" easy="true" id="just25" rel="1" rev="2" score="1" target="time" unit="duration"/>
+    <level _seq="57" _title="Alternatives?" _xpath="./just24_2" author="JuSt" ctrl="force" easy="true" id="just24" rel="2" rev="3" score="1" target="time" unit="duration"/>
+    <level _seq="58" _title="No More Alternatives" _xpath="./just25_2" author="JuSt" ctrl="force" easy="true" id="just25" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="59" _title="The Walls" _xpath="./just26_2" author="JuSt" ctrl="force" easy="true" id="just26" rel="2" rev="3" score="1" target="time" unit="duration"/>
     <level _seq="60" _title="Pull the Puller" _xpath="./just28_2" author="JuSt" ctrl="force" easy="false" id="just28" rel="2" rev="4" score="1" target="time" unit="duration"/>
     <level _seq="61" _title="Double Sense" _xpath="./joe14_1" author="Joseph Dunne" ctrl="force" easy="true" id="joe14" rel="1" rev="1" score="1" target="time" unit="duration"/>

Deleted: trunk/data/levels/enigma_vii/just24_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/just24_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_vii/just24_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,69 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-     <el:identity el:title="Alternatives?" el:subtitle="" el:id="just24"/>
-     <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
-     <el:author  el:name="JuSt" el:email="" el:homepage=""/>
-     <el:copyright>Copyright ? 2007 JuSt</el:copyright>
-     <el:license el:type="GPL v2.0 or above" el:open="true"/>
-     <el:compatibility el:enigma="1.01">
-     </el:compatibility>
-     <el:modes el:easy="true" el:single="true" el:network="false"/>
-     <el:comments>
-     </el:comments>
-     <el:score el:easy="0:43" el:difficult="1:21"/>
-    </el:info>
-    <el:luamain><![CDATA[
-enigma.ConserveLevel = 0
-create_world(20, 13)
-oxyd_default_flavor="a"
-
--- Floor Layer
-fill_floor("fl-mortar")
-fill_floor("fl-water", 16, 1, 3, 3)
-draw_floor("fl-water", {17, 4}, {1, 0}, 2)
-
--- Item Layer
-set_item("it-seed", 4, 3)
-set_item("it-seed", 10, 7)
-if difficult then
-    set_item("it-wrench", 5, 8)
-else
-    set_item("it-magicwand", 5, 8)
-end
-set_item("it-shogun-l", 9, 10, {target="laser1", action="onoff"})
-
--- Stone Layer
-oxyd(18, 11)
-oxyd(1, 11)
-oxyd(18, 1)
-oxyd(1, 1)
-draw_border("st-woven")
-draw_stones("st-woven", {16, 1}, {0, 1}, 3)
-draw_stones("st-woven", {15, 2}, {0, 1}, 2)
-draw_border("st-woven", 4, 7, 3, 3)
-set_stone("st-shogun-s", 13, 7)
-set_stone("st-shogun-m", 15, 1)
-set_stone("st-shogun-l", 4, 3)
-set_stone("st-bolder-n", 7, 1)
-set_stone("st-swap", 11, 5)
-set_stone("st-pull", 15, 6)
-set_stone("st-laser-n", 9, 4, {name="laser1", on=0})
-set_stone("st-stoneimpulse_movable", 3, 6)
-set_stone("st-grate1", 11, 9)
-set_stone("st-rotator_move-right", 16, 9)
-set_stone("st-mirror-3<tm", 6, 5)
-
--- Actor Layer
-set_actor("ac-blackball", 11.5, 9.5, {player=0, mouseforce=1})
-
-oxyd_shuffle()
-  ]]></el:luamain>
-    <el:i18n>
-     <el:string el:key="title">
-       <el:english el:translate="false"/>
-     </el:string>
-   </el:i18n>
-  </el:protected>
-</el:level>

Copied: trunk/data/levels/enigma_vii/just24_2.xml (from rev 1805, trunk/data/levels/enigma_vii/just24_1.xml)
===================================================================
--- trunk/data/levels/enigma_vii/just24_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_vii/just24_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,58 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Alternatives?" el:subtitle="" el:id="just24"/>
+      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
+      <el:author  el:name="JuSt" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2007 JuSt</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="0:43" el:difficult="1:21"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti[" "] = {"fl_mortar"}
+ti["~"] = {"fl_water"}
+ti["#"] = {"st_woven"}
+ti["^"] = {"st_boulder", orientation=NORTH}
+ti["L"] = {"st_laser", orientation=NORTH, name="laser"}
+ti["M"] = {"st_mirror", flavor="triangle", orientation=WEST, transparent=true, movable=true}
+ti["S"] = {"st_swap"}
+ti["P"] = {"st_pull"}
+ti["I"] = {"st_stoneimpulse_movable"}
+ti["R"] = {"st_rotator", state=CW, movable=true}
+ti["1"] = {"st_shogun_s"}
+ti["2"] = {"st_shogun_m"}
+ti["o"] = {"it_shogun_l", target="laser"}
+ti["."] = {"it_seed"}
+ti["0"] = ti["."] .. {"st_shogun_l"}
+ti["w"] = cond(wo["IsDifficult"], {"it_wrench"}, {"it_magicwand"})
+ti["O"] = {"st_oxyd", flavor="a"}
+ti["@"] = ti({"st_grate", flavor="cross"}) .. {"#ac_marble_black"}
+
+wo(ti, " ", {
+    "####################",
+    "#O     ^       2#~O#",
+    "#              ##~~#",
+    "#   0          ##~~#",
+    "#        L       ~~#",
+    "#     M    S       #",
+    "#  I           P   #",
+    "#   ###   .  1     #",
+    "#   #w#            #",
+    "#   ###    @    R  #",
+    "#        o         #",
+    "#O                O#",
+    "####################"})
+
+wo:shuffleOxyd()
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Deleted: trunk/data/levels/enigma_vii/just25_1.xml
===================================================================
--- trunk/data/levels/enigma_vii/just25_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_vii/just25_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -1,72 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
-  <el:protected>
-    <el:info el:type="level">
-     <el:identity el:title="No More Alternatives" el:subtitle="" el:id="just25"/>
-     <el:version el:score="1" el:release="1" el:revision="2" el:status="released"/>
-     <el:author  el:name="JuSt" el:email="" el:homepage=""/>
-     <el:copyright>Copyright ? 2007 JuSt</el:copyright>
-     <el:license el:type="GPL v2.0 or above" el:open="true"/>
-     <el:compatibility el:enigma="1.01">
-     </el:compatibility>
-     <el:modes el:easy="true" el:single="true" el:network="false"/>
-     <el:comments>
-     </el:comments>
-     <el:score el:easy="2:59" el:difficult="4:30"/>
-    </el:info>
-    <el:luamain><![CDATA[
-enigma.ConserveLevel = 0
-create_world(20, 13)
-oxyd_default_flavor="a"
-
--- Floor Layer
-fill_floor("fl-bumps")
-fill_floor("fl-water", 16, 1, 3, 3)
-draw_floor("fl-water", {17, 4}, {1, 0}, 2)
-
--- Item Layer
-set_item("it-seed", 4, 3)
-set_item("it-seed", 10, 7)
-set_item("it-glasses", 5, 8)
-set_item("it-shogun-l", 9, 10, {target="laser1", action="onoff"})
-
--- Stone Layer
-oxyd(18, 11)
-oxyd(1, 11)
-oxyd(18, 1)
-oxyd(1, 1)
-draw_border("st-stone2")
-draw_stones("st-stone2", {16, 1}, {0, 1}, 3)
-draw_stones("st-stone2", {15, 2}, {0, 1}, 2)
-draw_border("st-stone2", 4, 7, 3, 3)
-set_stone("st-death_invisible", 18, 2)
-set_stone("st-shogun-s", 13, 7)
-set_stone("st-shogun-m", 15, 1)
-set_stone("st-shogun-l", 4, 3)
-set_stone("st-swap", 11, 5)
-set_stone("st-pull", 15, 6)
-set_stone("st-laser-n", 9, 4, {name="laser1", on=0})
-set_stone("st-stoneimpulse_movable", 3, 6)
-set_stone("st-grate1", 11, 9)
-set_stone("st-rotator_move-right", 16, 9)
-if difficult then
-    set_stone("st-stone2", 7, 1)
-    set_stone("st-mirror-3<tm", 6, 5)
-else
-    set_stone("st-bolder-n", 7, 1)
-    set_stone("st-mirror-3<t", 6, 5)
-end
-
--- Actor Layer
-set_actor("ac-blackball", 11.5, 9.5, {player=0, mouseforce=1})
-
-oxyd_shuffle()
-  ]]></el:luamain>
-    <el:i18n>
-     <el:string el:key="title">
-       <el:english el:translate="false"/>
-     </el:string>
-   </el:i18n>
-  </el:protected>
-</el:level>
-

Copied: trunk/data/levels/enigma_vii/just25_2.xml (from rev 1805, trunk/data/levels/enigma_vii/just25_1.xml)
===================================================================
--- trunk/data/levels/enigma_vii/just25_1.xml	2009-09-11 22:58:14 UTC (rev 1805)
+++ trunk/data/levels/enigma_vii/just25_2.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -0,0 +1,61 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="No More Alternatives" el:subtitle="" el:id="just25"/>
+      <el:version el:score="1" el:release="2" el:revision="3" el:status="released"/>
+      <el:author  el:name="JuSt" el:email="" el:homepage=""/>
+      <el:copyright>Copyright ? 2007 JuSt</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
+      <el:comments><el:code>New API converted by R. Bourquin</el:code></el:comments>
+      <el:score el:easy="2:59" el:difficult="4:30"/>
+    </el:info>
+    <el:luamain><![CDATA[
+wo["ConserveLevel"] = false
+
+ti[" "] = {"fl_pinkbumps"}
+ti["~"] = {"fl_water"}
+ti["#"] = {"st_redmarble"}
+ti["D"] = ti["~"] .. {"st_death_invisible"}
+ti["^"] = cond(wo["IsDifficult"], ti["#"], {"st_boulder", orientation=NORTH})
+ti["L"] = {"st_laser", orientation=NORTH, name="laser"}
+ti["M"] = {"st_mirror", flavor="triangle", orientation=WEST, transparent=true, movable=wo["IsDifficult"]}
+ti["S"] = {"st_swap"}
+ti["P"] = {"st_pull"}
+ti["I"] = {"st_stoneimpulse_movable"}
+ti["R"] = {"st_rotator", state=CW, movable=true}
+ti["1"] = {"st_shogun_s"}
+ti["2"] = {"st_shogun_m"}
+ti["o"] = {"it_shogun_l", target="laser"}
+ti["."] = {"it_seed"}
+ti["0"] = ti["."] .. {"st_shogun_l"}
+ti["g"] = {"it_glasses"}
+ti["O"] = {"st_oxyd", flavor="a"}
+ti["@"] = ti({"st_grate", flavor="cross"}) .. {"#ac_marble_black"}
+
+wo(ti, " ", {
+    "####################",
+    "#O     ^       2#~O#",
+    "#              ##~D#",
+    "#   0          ##~~#",
+    "#        L       ~~#",
+    "#     M    S       #",
+    "#  I           P   #",
+    "#   ###   .  1     #",
+    "#   #g#            #",
+    "#   ###    @    R  #",
+    "#        o         #",
+    "#O                O#",
+    "####################"})
+
+wo:shuffleOxyd()
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>

Modified: trunk/data/levels/enigma_viii/mecke05_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke05_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_viii/mecke05_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -30,7 +30,7 @@
     ti["y "] = {"fl_swamp"}
 else
     ti["  "] = {"fl_rough",burnable=true}
-    ti["H "] = {"fl_rough",burnable=true,securefire=true,"hotspot"}
+    ti["H "] = {"fl_rough",burnable=true,"hotspot"}
     ti["n1"] = {"fl_rough","knight1"}
     ti["n2"] = {"fl_rough","knight2"}
     ti["n3"] = {"fl_rough","break2"}

Modified: trunk/data/levels/enigma_viii/mecke06_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke06_1.xml	2009-09-12 22:02:03 UTC (rev 1806)
+++ trunk/data/levels/enigma_viii/mecke06_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
@@ -41,14 +41,7 @@
 ti["> "] = ti["  "] .. {"st_boulder_e"}
 ti["O "] = {"st_rotator_ccw"}
 ti["t1"] = ti["  "] .. {"it_trigger", target="laser1",action="turn"}
-ti["t2"] = ti["  "] .. {"it_trigger", target="laser1",action="turn"}
-ti["t6"] = ti["  "] .. {"it_trigger", target="laser1",action="turn"}
-ti["t4"] = ti["  "] .. {"it_trigger", target="laser1",action="turn"}
-ti["t5"] = ti["  "] .. {"it_trigger", target="laser1",action="turn"}
-ti["t3"] = ti["  "] .. {"it_trigger", target="laser1",action="toggle"}
-ti["t7"] = ti["  "] .. {"it_trigger", target="laser1",action="toggle"}
-ti["t8"] = ti["  "] .. {"it_trigger", target="laser1",action="toggle"}
-ti["t9"] = ti["  "] .. {"it_trigger", target="laser1",action="toggle"}
+ti["t2"] = ti["  "] .. {"it_trigger", target="laser1",action="toggle"}
 ti["LS"] = ti["  "] .. {"st_laser_s", state=OFF, name="laser1"}
 ti["u1"] = ti["  "] .. {"it_trigger", target="maggi1",action="on"}
 ti["u2"] = ti["  "] .. {"it_trigger", target="maggi3",action="on"}
@@ -64,13 +57,13 @@
     "Y!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!          ",
     "!!#!$!#!#!$!#!#!#!$!#!$!#!#!#!#!$!#!#!!!  O       ",
     "!!#! E EdE E E E E E C C C C CdC C C$!!!  > t1  O ",
-    "!!$! s4! s ! s ! s ! ! s ! s ! s3! s#!!!  u1  t2  ",
-    "!!#! ! s !m1B! !a! ! !a! !B!m4 ! s !#!!!  t7  u3  ",
-    "!!#! sa! !r! ! ! ! ! ! ! ! ! ! ! ! s#!!!      t8  ",
-    "!!$! ! s ! ! !a!X!LS ! ! ! ! ! ! s !#!!!  u4  t3  ",
-    "!!#! s&h ! ! ! ! ! ! ! ! ! ! !a! ! s#!!!  t6      ",
-    "!!#! ! sa!m2B! ! !a! !r! !B!m3 ! s !#!!!  t9  t4  ",
-    "!!$! s1! s ! s ! s ! ! s ! s ! s2! s#!!!O t5  u2  ",
+    "!!$! s4! s ! s ! s ! ! s ! s ! s3! s#!!!  u1  t1  ",
+    "!!#! ! s !m1B! !a! ! !a! !B!m4 ! s !#!!!  t2  u3  ",
+    "!!#! sa! !r! ! ! ! ! ! ! ! ! ! ! ! s#!!!      t2  ",
+    "!!$! ! s ! ! !a!X!LS ! ! ! ! ! ! s !#!!!  u4  t2  ",
+    "!!#! s&h ! ! ! ! ! ! ! ! ! ! !a! ! s#!!!  t1      ",
+    "!!#! ! sa!m2B! ! !a! !r! !B!m3 ! s !#!!!  t2  t1  ",
+    "!!$! s1! s ! s ! s ! ! s ! s ! s2! s#!!!O t1  u2  ",
     "!!#! D DdD D D D D D B B B B BdB B B$!!!      O   ",
     "!!#!$!#!#!#!#!$!$!#!#!#!$!#!#!#!$!$!#!!!          ",
     "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!Z!B!B!B!B!B!"})



From raoul at mail.berlios.de  Wed Sep 16 20:23:04 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Wed, 16 Sep 2009 20:23:04 +0200
Subject: [Enigma-game-svn] r1808 - team_levelpacks/team_test_new_api
Message-ID: <200909161823.n8GIN42v020883@sheep.berlios.de>

Author: raoul
Date: 2009-09-16 20:23:02 +0200 (Wed, 16 Sep 2009)
New Revision: 1808

Added:
   team_levelpacks/team_test_new_api/raoulT11_1.xml
Modified:
   team_levelpacks/team_test_new_api/raoulT08_1.xml
Log:
-> Testlevel for inner marked positions for puzzle shuffling algorithm "marked"
-> Attribute value type fix



Modified: team_levelpacks/team_test_new_api/raoulT08_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT08_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
+++ team_levelpacks/team_test_new_api/raoulT08_1.xml	2009-09-16 18:23:02 UTC (rev 1808)
@@ -7,16 +7,13 @@
       <el:author  el:name="Raoul Bourquin" el:email="raoul at users.berlios.de"/>
       <el:copyright>Copyright ? 2008 Raoul Bourquin</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
-      <el:compatibility el:enigma="1.10">
-      </el:compatibility>
+      <el:compatibility el:enigma="1.10"/>
       <el:modes el:easy="false" el:single="true" el:network="false"/>
       <el:comments>
       </el:comments>
       <el:score el:easy="-" el:difficult="-"/>
     </el:info>
     <el:luamain><![CDATA[
-wo["ConserveLevel"] = true
-
 ti["  "] = {"fl_sahara"}
 
 ti["B0"] = {"st_puzzle_blue"}
@@ -39,7 +36,6 @@
 ti["Be"] = {"st_puzzle_blue", connections="nes"}
 ti["Bf"] = {"st_puzzle_blue", connections="nesw"}
 
-
 ti["b0"] = {"st_puzzle_blue", hollow=true}
 ti["b1"] = {"st_puzzle_blue", connections="w", hollow=true}
 ti["b2"] = {"st_puzzle_blue", connections="s", hollow=true}
@@ -60,7 +56,6 @@
 ti["be"] = {"st_puzzle_blue", connections="nes", hollow=true}
 ti["bf"] = {"st_puzzle_blue", connections="nesw", hollow=true}
 
-
 ti["Y0"] = {"st_puzzle_yellow"}
 ti["Y1"] = {"st_puzzle_yellow", connections="w"}
 ti["Y2"] = {"st_puzzle_yellow", connections="s"}
@@ -81,7 +76,6 @@
 ti["Ye"] = {"st_puzzle_yellow", connections="nes"}
 ti["Yf"] = {"st_puzzle_yellow", connections="nesw"}
 
-
 ti["y0"] = {"st_puzzle_yellow", hollow=true}
 ti["y1"] = {"st_puzzle_yellow", connections="w", hollow=true}
 ti["y2"] = {"st_puzzle_yellow", connections="s", hollow=true}
@@ -102,41 +96,39 @@
 ti["ye"] = {"st_puzzle_yellow", connections="nes", hollow=true}
 ti["yf"] = {"st_puzzle_yellow", connections="nesw", hollow=true}
 
-ti["LL"] = {"st_laser", orientation="w", state=ON}
+ti["LL"] = {"st_laser", orientation=WEST, state=ON}
 ti["PP"] = {"st_polarswitch", state=OFF}
 
 ti["@ "] = {"#ac_marble"}  ..ti({"it_magicwand"})
 
-w, h = wo(ti, "  ", {
-"                                                                              ",
-"  @                                                                           ",
-"                                                                              ",
-"  B0      Y0      b0      y0        PPLL                                      ",
-"  B1      Y1      b1      y1        PPLL                                      ",
-"  B2      Y2      b2      y2        PPLL                                      ",
-"  B3      Y3      b3      y3        PPLL                                      ",
-"  B4      Y4      b4      y4        PPLL                                      ",
-"  B5      Y5      b5      y5        PPLL                                      ",
-"  B6      Y6      b6      y6        PPLL                                      ",
-"  B7      Y7      b7      y7        PPLL                                      ",
-"  B8      Y8      b8      y8        PPLL                                      ",
-"  B9      Y9      b9      y9        PPLL                                      ",
-"  Ba      Ya      ba      ya        PPLL                                      ",
-"  Bb      Yb      bb      yb        PPLL                                      ",
-"  Bc      Yc      bc      yc        PPLL                                      ",
-"  Bd      Yd      bd      yd        PPLL                                      ",
-"  Be      Ye      be      ye        PPLL                                      ",
-"  Bf      Yf      bf      yf        PPLL                                      ",
-"                                                                              ",
-"                                                                              ",
-"                                                                              "
-})
-
-  ]]></el:luamain>
+wo(ti, "  ", {
+    "                                                                              ",
+    "  @                                                                           ",
+    "                                                                              ",
+    "  B0      Y0      b0      y0        PPLL                                      ",
+    "  B1      Y1      b1      y1        PPLL                                      ",
+    "  B2      Y2      b2      y2        PPLL                                      ",
+    "  B3      Y3      b3      y3        PPLL                                      ",
+    "  B4      Y4      b4      y4        PPLL                                      ",
+    "  B5      Y5      b5      y5        PPLL                                      ",
+    "  B6      Y6      b6      y6        PPLL                                      ",
+    "  B7      Y7      b7      y7        PPLL                                      ",
+    "  B8      Y8      b8      y8        PPLL                                      ",
+    "  B9      Y9      b9      y9        PPLL                                      ",
+    "  Ba      Ya      ba      ya        PPLL                                      ",
+    "  Bb      Yb      bb      yb        PPLL                                      ",
+    "  Bc      Yc      bc      yc        PPLL                                      ",
+    "  Bd      Yd      bd      yd        PPLL                                      ",
+    "  Be      Ye      be      ye        PPLL                                      ",
+    "  Bf      Yf      bf      yf        PPLL                                      ",
+    "                                                                              ",
+    "                                                                              ",
+    "                                                                              "})
+ ]]></el:luamain>
     <el:i18n>
-	 <el:string el:key="title">
-	   <el:english el:translate="false"/>
-	 </el:string>
-   </el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
   </el:protected>
 </el:level>

Added: team_levelpacks/team_test_new_api/raoulT11_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/raoulT11_1.xml	2009-09-12 22:38:22 UTC (rev 1807)
+++ team_levelpacks/team_test_new_api/raoulT11_1.xml	2009-09-16 18:23:02 UTC (rev 1808)
@@ -0,0 +1,68 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<el:level xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://enigma-game.org/schema/level/1 level.xsd" xmlns:el="http://enigma-game.org/schema/level/1">
+  <el:protected>
+    <el:info el:type="level">
+      <el:identity el:title="Test puzzle inner shuffles" el:subtitle="" el:id="raoult11"/>
+      <el:version el:score="1" el:release="1" el:revision="1" el:status="experimental"/>
+      <el:author  el:name="Raoul Bourquin" el:email=""/>
+      <el:copyright>Copyright ? 2009 Raoul Bourquin</el:copyright>
+      <el:license el:type="GPL v2.0 or above" el:open="true"/>
+      <el:compatibility el:enigma="1.10">
+        <el:dependency el:path="lib/libpuzzle" el:id="lib/libpuzzle" el:release="3" el:preload="true"/>
+      </el:compatibility>
+      <el:modes el:easy="false" el:single="true" el:network="false"/>
+      <el:score el:easy="-" el:difficult="-"/>
+    </el:info>
+    <el:luamain><![CDATA[
+ti["  "] = {"fl_sahara"}
+ti["# "] = {"st_rawglass"}
+
+ti["> "] = {"fl_dark", push_directions="e"}
+ti["< "] = {"fl_dark", push_directions="w"}
+ti["^ "] = {"fl_dark", push_directions="n"}
+
+ti["."] = {"fl_dark", push_directions="nesw"}
+ti[","] = {"fl_dark", push_directions="ew"}
+
+ti["o "] = {"it_vortex", name="vortexe#", destination="@vortexo#*"}
+
+ti["P"] = {"st_puzzle", color=YELLOW, algorithm="marked", intensity=2}
+ti["Q"] = ti["."] .. {"st_puzzle", color=YELLOW, algorithm="marked", intensity=2} .. ti({"it_vortex", name="vortexo#", destination="@vortexe#*"})
+ti["R"] = ti[","] .. {"st_puzzle", color=YELLOW, algorithm="marked", intensity=2} .. ti({"it_vortex", name="vortexo#", destination="@vortexe#*"})
+
+ti["@ "] = {"#ac_marble_black"}
+
+wo(res.puzzle(ti, "P", "Q", "R"), "  ", {
+    "# # # # # # # # # # # # # # # # # # # # ",
+    "#     o                   o           # ",
+    "# # # # # # #   # # # # # # #         # ",
+    "# P0P0P0P0P0#   # P0P0P0P0P0#         # ",
+    "# P0P0P0P0P0#   # P0P0P0Q5P0#         # ",
+    "# P0P0Q5P0P0# @ # P0P0# P0P0#         # ",
+    "# P0P0P0P0P0#   # P0Q5P0P0P0#         # ",
+    "# P0P0P0P0P0#   # P0P0P0P0P0#         # ",
+    "# # # # # # #   # # # # # # #         # ",
+    "#                   o                 # ",
+    "#                                     # ",
+    "#                                     # ",
+    "#                                     # ",
+    "#                                     # ",
+    "#   o                                 # ",
+    "# # # # # # #   # # # # # # #         # ",
+    "# P0P0P0P0P0#   # P0P0P0P0P0#         # ",
+    "# P0R5P0P0P0#   # P0P5P5P5P0#         # ",
+    "# P0P0P5P0P0<   # P0P5Q5P5P0#         # ",
+    "# P0P0P0R5P0#   # P0P5P5P5P0#         # ",
+    "# P0P0P0P0P0#   # P0P0P0P0P0#         # ",
+    "# # # ^ # # #   # # # # # # #         # ",
+    "#       o             o               # ",
+    "#                                     # ",
+    "# # # # # # # # # # # # # # # # # # # # "})
+ ]]></el:luamain>
+    <el:i18n>
+      <el:string el:key="title">
+        <el:english el:translate="false"/>
+      </el:string>
+    </el:i18n>
+  </el:protected>
+</el:level>


Property changes on: team_levelpacks/team_test_new_api/raoulT11_1.xml
___________________________________________________________________
Name: svn:eol-style
   + native



From ral at mail.berlios.de  Wed Sep 16 23:46:00 2009
From: ral at mail.berlios.de (ral at BerliOS)
Date: Wed, 16 Sep 2009 23:46:00 +0200
Subject: [Enigma-game-svn] r1809 - in trunk: data data/levels/lib src
	src/actors src/items src/stones
Message-ID: <200909162146.n8GLk0d0008008@sheep.berlios.de>

Author: ral
Date: 2009-09-16 23:45:56 +0200 (Wed, 16 Sep 2009)
New Revision: 1809

Modified:
   trunk/data/levels/lib/libpuzzle_3.xml
   trunk/data/models-2d.lua
   trunk/src/WorldProxy.cc
   trunk/src/actors/Balls.cc
   trunk/src/actors/KillerActor.cc
   trunk/src/actors/KillerActor.hh
   trunk/src/items/PullerItem.cc
   trunk/src/server.cc
   trunk/src/server.hh
   trunk/src/stones/PuzzleStone.cc
   trunk/src/world.hh
Log:
Trunk 1.1: 
- fix it_puller: attribute set of orientation
- fix ac_killer: report shield like ac_rotor and ac_top
- fix ac_marble, ac_pearl: do not shield if assigned to owner nil
- libpuzzle: extention patch by Raoul to allow marked shuffle push positions
    beneath puzzle stones
- st_puzzle - allow config of fallen puzzle object kind:
  - global attribute "FallenPuzzle", type string, default "fl_gray"
  - accepts any floor kind
  - accepts "=key" syntax like st_surprise for tile declaration usage
      (allows declaration of own friction, adhesion)
  - accepts items "it_strip", "it_pipe" with special behaviour:
    - new items have same connections as the fallen puzzle
    - existing strips join connections with fallen ones
    - existing pipes preceed fallen ones
Note:
- any object kind besides floors, pipe and strips are depreceated as
  FallenPuzzle values.


Modified: trunk/data/levels/lib/libpuzzle_3.xml
===================================================================
--- trunk/data/levels/lib/libpuzzle_3.xml	2009-09-16 18:23:02 UTC (rev 1808)
+++ trunk/data/levels/lib/libpuzzle_3.xml	2009-09-16 21:45:56 UTC (rev 1809)
@@ -34,11 +34,11 @@
 --        print("puzzle final - huddle of size "..#huddle)
     end
 --    print("puzzle final - num huddles "..#huddles)
-    
+
     -- shuffle huddles
     local width = wo["Width"]
     local height = wo["Height"]
-    local offsets = {po(-1,0), po(0,1), po(1,0), po(0,-1)}
+    local offsets = {W, S, E, N}
     local dirchars = {"w","s","e","n"}
     for h, huddle in ipairs(huddles) do
 --        print("puzzle final - shuffle huddle of size "..#huddle)
@@ -53,53 +53,70 @@
             end
             intensity = math.max(intensity, puz["intensity"])
         end
+
         for puz in huddle do
             for dir, offset in ipairs(offsets) do
                 local cand = puz - offset
                 if cand:exists() then
                     local cfloor = fl(cand)
+
+                    local may_push = true
                     if pfloors[cfloor] == nil then
-                        local may_push = true
                         if algorithm == 1 then
                             local pushdirs = cfloor["push_directions"]
                             if type(pushdirs) ~= "string" or not pushdirs:find(dirchars[dir]) then
                                 may_push = false
                             end
                         end
-                        if may_push then
-                            local length = 1
-                            local lpos = puz + offset
-                            while lpos:exists() and pfloors[fl(lpos)] ~= nil do
-                                length = length + 1
-                                lpos = lpos + offset
+                    else  -- floor is under the puzzle but if its marked, the levelautor wants to shuffle from here
+                        may_push = false
+                        if algorithm == 1 then
+                            local pushdirs = cfloor["push_directions"]
+                            if type(pushdirs) == "string" and pushdirs:find(dirchars[dir]) then
+                                may_push = true
                             end
-                            if length > 1 then
-                                table.insert(pushes, {fl(puz), dir - 1, length})
---                                print("  push ("..cfloor.x..","..cfloor.y..") dir "..(dir-1).." length "..length)
-                            end
                         end
                     end
+
+                    -- Add all possible shuffles from current position to the table
+                    if may_push then
+                        local length = 1
+                        local lpos = puz + offset
+                        while lpos:exists() and pfloors[fl(lpos)] ~= nil do
+                            length = length + 1
+                            lpos = lpos + offset
+                        end
+                        if length > 1 then
+                            table.insert(pushes, {fl(puz), dir - 1, length})
+--                          print("  push ("..cfloor.x..","..cfloor.y..") dir "..(dir-1).." length "..length)
+                        end
+                    end
+
                 end
             end
         end
+
+        -- How many pull_rotations we try to do?
         intensity = intensity * #huddle
         if intensity > 0 then
             intensity = intensity + math.random(0, 1)
         end
+
+        -- and now, let's shuffle!
         while intensity > 0 and #pushes > 0 do
             local pidx = random(#pushes)  -- select a random push pos/dir
             local puzz = st(pushes[pidx][1])
             local dir = pushes[pidx][2]
             local length = pushes[pidx][3]
             local nextpuzz = st(puzz + offsets[dir + 1])
-            
+
             -- check for leading sequence of hollow puzzles
             while length > 2 and puzz["hollow"] and nextpuzz["hollow"] do
                 puzz = nextpuzz
                 nextpuzz = st(puzz + offsets[dir + 1])
                 length = length - 1
             end
-            
+
             if not nextpuzz["hollow"] then
                 puzz:pull_rotate(dir)
             end
@@ -148,7 +165,7 @@
                             "n","nw","ns","nsw","ne","new","nes","nesw"})[connections]
                 end
             end
-            
+
             if result == nil then
                 result = ti(tile)
             else

Modified: trunk/data/models-2d.lua
===================================================================
--- trunk/data/models-2d.lua	2009-09-16 18:23:02 UTC (rev 1808)
+++ trunk/data/models-2d.lua	2009-09-16 21:45:56 UTC (rev 1809)
@@ -1827,7 +1827,6 @@
 --------------------------
 do
     DefAlias("st_break_bug-anim", "st_flat_breaking")
-    DefAlias("st-explosion", "it_explosion")
     DefAlias("st-glass_move", "st-glass");
     DefAlias("st_break_laser", "st_flat")
     DefAlias("st_break_laser-anim", "st_flat_breaking")

Modified: trunk/src/WorldProxy.cc
===================================================================
--- trunk/src/WorldProxy.cc	2009-09-16 18:23:02 UTC (rev 1808)
+++ trunk/src/WorldProxy.cc	2009-09-16 21:45:56 UTC (rev 1809)
@@ -94,6 +94,8 @@
             return server::ElectricForce;
         } else if (key == "ExtralifeGlasses") {
             return server::ExtralifeGlasses;
+        } else if (key == "FallenPuzzle") {
+            return server::FallenPuzzle;
         } else if (key == "Fragility") {
             return server::Fragility;
         } else if (key == "FrictionStrength") {
@@ -201,6 +203,8 @@
             server::ElectricForce = val;
         } else if (key == "ExtralifeGlasses") {
             server::ExtralifeGlasses = val;
+        } else if (key == "FallenPuzzle") {
+            server::FallenPuzzle = val.to_string();
         } else if (key == "Fragility") {
             server::Fragility = val;
         } else if (key == "FrictionStrength") {

Modified: trunk/src/actors/Balls.cc
===================================================================
--- trunk/src/actors/Balls.cc	2009-09-16 18:23:02 UTC (rev 1808)
+++ trunk/src/actors/Balls.cc	2009-09-16 21:45:56 UTC (rev 1809)
@@ -119,7 +119,7 @@
         // Shield, booze and invisibility can be activated in all states except DEAD
     
         if (state != DEAD) {
-            if (m.message == "_shield" && getAttr("owner") ==  (int)m.value) {
+            if (m.message == "_shield" && getAttr("owner").getType() != Value::DEFAULT &&  getAttr("owner") ==  (int)m.value) {
                 m_shield_rest_time += SHIELD_TIME;
                 update_halo();
                 return true;

Modified: trunk/src/actors/KillerActor.cc
===================================================================
--- trunk/src/actors/KillerActor.cc	2009-09-16 18:23:02 UTC (rev 1808)
+++ trunk/src/actors/KillerActor.cc	2009-09-16 21:45:56 UTC (rev 1809)
@@ -1,6 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -41,10 +41,6 @@
         return false;
     }
     
-    bool Killer::has_shield() const {
-        return false;
-    }
-
     bool Killer::on_collision(Actor *a) {
         if (a->is_on_floor())
             SendMessage(a, "_shatter");

Modified: trunk/src/actors/KillerActor.hh
===================================================================
--- trunk/src/actors/KillerActor.hh	2009-09-16 18:23:02 UTC (rev 1808)
+++ trunk/src/actors/KillerActor.hh	2009-09-16 21:45:56 UTC (rev 1809)
@@ -1,6 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -39,7 +39,6 @@
 
         // Actor interface
         virtual bool is_dead() const;
-        virtual bool has_shield() const;
         virtual bool on_collision(Actor *a);
     };
 

Modified: trunk/src/items/PullerItem.cc
===================================================================
--- trunk/src/items/PullerItem.cc	2009-09-16 18:23:02 UTC (rev 1808)
+++ trunk/src/items/PullerItem.cc	2009-09-16 21:45:56 UTC (rev 1809)
@@ -35,7 +35,7 @@
     
     void PullerItem::setAttr(const string& key, const Value &val) {
         if (key == "orientation") {
-            objFlags = (objFlags & ~OBJBIT_ORIENTATION) | ((int)(val) >> 24);
+            objFlags = (objFlags & ~OBJBIT_ORIENTATION) | (((int)(val) << 24) & OBJBIT_ORIENTATION);
         }
         Item::setAttr(key, val);
     }

Modified: trunk/src/server.cc
===================================================================
--- trunk/src/server.cc	2009-09-16 18:23:02 UTC (rev 1808)
+++ trunk/src/server.cc	2009-09-16 21:45:56 UTC (rev 1809)
@@ -119,6 +119,7 @@
 double   server::FrictionFactor;
 int      server::GlassesVisibility;         // no Lua access
 int      server::ExtralifeGlasses;
+std::string server::FallenPuzzle;
 double   server::HoleForce;
 lev::levelStatusType   server::LevelStatus; // no Lua access
 double   server::MagnetForce;
@@ -285,27 +286,31 @@
     server::FollowMethod      = display::FOLLOW_FLIP;      // FLIP
     server::FollowThreshold   = 0.5;
     server::ShowMoves         = false;
+
+    server::GlassesVisibility = 0;     // nothing
+    server::FlatForce         = 0.0;
+    server::ConstantForce     = ecl::V2(0, 0);
+    
+    // object class specific with Lua access 
     server::Brittleness       = 0.5;
+    server::BumperForce       = 200.0;
+    server::CrackSpreading    = 0.5;
+    server::ElectricForce     = 15.0;
+    server::ExtralifeGlasses  = 19;  // death + hollow + lightpassenger
+    server::FallenPuzzle      = "fl_gray";
     server::Fragility         = 1.0;
-    server::CrackSpreading    = 0.5;
-    server::ConstantForce       = ecl::V2(0, 0);
-    server::SlopeForce        = 25.0;
-    server::FlatForce         = 0.0;
     server::FrictionFactor    = 1.0;
-    server::GlassesVisibility = 0;     // nothing
-    server::ExtralifeGlasses  = 19;  // death + hollow + lightpassenger
-    server::ElectricForce     = 15.0;
-    server::BumperForce       = 200.0;
-    server::WaterSinkSpeed    = 10000;
-    server::SwampSinkSpeed    = 4;
+    server::HoleForce         = 1.0;
     server::MagnetForce       = 30;
     server::MagnetRange       = 10;
     server::MaxOxydColor      = 7;    // for compatibility
+    server::RubberViolationStrength = 50;
+    server::SlopeForce        = 25.0;
     server::SubSoil           = 0;
-    server::RubberViolationStrength = 50;
+    server::SwampSinkSpeed    = 4;
+    server::WaterSinkSpeed    = 10000;
     server::WormholeForce     = 30;
     server::WormholeRange     = 10;
-    server::HoleForce         = 1.0;
 
     move_counter = 0;
 

Modified: trunk/src/server.hh
===================================================================
--- trunk/src/server.hh	2009-09-16 18:23:02 UTC (rev 1808)
+++ trunk/src/server.hh	2009-09-16 21:45:56 UTC (rev 1809)
@@ -120,6 +120,7 @@
     
     extern int      GlassesVisibility;
     extern int      ExtralifeGlasses;
+    extern std::string FallenPuzzle;
     
     extern Value     FollowAction;
     extern bool      FollowGrid;

Modified: trunk/src/stones/PuzzleStone.cc
===================================================================
--- trunk/src/stones/PuzzleStone.cc	2009-09-16 18:23:02 UTC (rev 1808)
+++ trunk/src/stones/PuzzleStone.cc	2009-09-16 21:45:56 UTC (rev 1809)
@@ -1,6 +1,6 @@
 /*
  * Copyright (C) 2002,2003,2004 Daniel Heck
- * Copyright (C) 2008 Ronald Lamprecht
+ * Copyright (C) 2008,2009 Ronald Lamprecht
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
@@ -20,6 +20,7 @@
 
 #include "stones/PuzzleStone.hh"
 #include "errors.hh"
+#include "lua.hh"
 #include "main.hh"
 #include "player.hh"
 #include "server.hh"
@@ -128,7 +129,7 @@
 
     void PuzzleStone::init_model() {
         if (state == EXPLODING) {
-            set_anim("st-explosion");
+            set_anim("it_explosion");
             return;
         }
         int m = getConnections();
@@ -276,9 +277,29 @@
 
     void PuzzleStone::on_floor_change() {
         if (state == FALLING) {
+            GridPos p = get_pos();
             state = FALLEN;   // we need to mark the puzzle as the floor set recalls this methods
-            SetFloor(get_pos(), MakeFloor("fl_gray"));
-            KillStone(get_pos());
+            if (server::FallenPuzzle.find('=') == 0) {
+                if (lua::CallFunc(lua::LevelState(), "enigma.settile", server::FallenPuzzle.substr(1), this)) {
+                    throw XLevelRuntime(std::string("fallen puzzle set tile failed:\n")+lua::LastError(lua::LevelState()));
+                }
+            } else if (server::FallenPuzzle == "it_strip" || server::FallenPuzzle == "it_pipe") {
+                std::string con = getAttr("connections").to_string();
+                if (Item * it = GetItem(p)) {
+                    if (it->getClass() == server::FallenPuzzle) {
+                        if (server::FallenPuzzle == "it_strip")
+                            con += it->getAttr("connections").to_string();
+                        else  // pipe - keep old connections
+                            con = it->getAttr("connections").to_string();                        
+                    }
+                }
+                Item *it = MakeItem(server::FallenPuzzle.c_str());
+                it->setAttr("connections", con);
+                SetItem(p, it);
+            } else if (server::FallenPuzzle.find("fl_") == 0) {
+                SetFloor(p, MakeFloor(server::FallenPuzzle.c_str()));
+            }
+            KillStone(p);
         }
     }
     

Modified: trunk/src/world.hh
===================================================================
--- trunk/src/world.hh	2009-09-16 18:23:02 UTC (rev 1808)
+++ trunk/src/world.hh	2009-09-16 21:45:56 UTC (rev 1809)
@@ -337,20 +337,9 @@
 
     void DisposeObject(Object *o);
 
-    void DefineSimpleStone (const string &kind, const string &sound, 
-                            int hollow, int glass);
-
-    void DefineSimpleStoneMovable (const string &kind, const string &sound, 
-                                   int glass);
-
-    void DefineSimpleFloor(const string &kind, double friction,
-                           double mousefactor, bool burnable,
-                           const string &firetransform);
-
     /* Register a new object. */
     void BootRegister(Object *obj, const char * kind = NULL, bool isRegistration = true);
     void Register (const string &kind, Object *obj);
-//    void RegisterActor (Actor *ac);
 
 
     /* Shutdown object repository */



From ral at mail.berlios.de  Thu Sep 17 00:33:23 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Thu, 17 Sep 2009 00:33:23 +0200
Subject: [Enigma-game-svn] r1810 - team_levelpacks/team_test_new_api
Message-ID: <200909162233.n8GMXNC5013604@sheep.berlios.de>

Author: ral
Date: 2009-09-17 00:33:00 +0200 (Thu, 17 Sep 2009)
New Revision: 1810

Modified:
   team_levelpacks/team_test_new_api/ralT021_1.xml
   team_levelpacks/team_test_new_api/ralT035_1.xml
   team_levelpacks/team_test_new_api/ralT037_1.xml
   team_levelpacks/team_test_new_api/ralT063_1.xml
   team_levelpacks/team_test_new_api/ralT079_1.xml
Log:
Test Level new API:
- some tests for recently added features


Modified: team_levelpacks/team_test_new_api/ralT021_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT021_1.xml	2009-09-16 21:45:56 UTC (rev 1809)
+++ team_levelpacks/team_test_new_api/ralT021_1.xml	2009-09-16 22:33:00 UTC (rev 1810)
@@ -27,10 +27,13 @@
 ti["B"] = {"it_vortex", name="v2", destination="v3"}
 ti["C"] = {"it_vortex", name="v3", destination={"v1","v2","v4"}}
 ti["D"] = {"it_vortex", name="v4", destination=po(3.1,7.7)}
+ti["E"] = {"it_vortex_closed", name="v5", destination="v6"}
+ti["F"] = {"it_vortex_closed", name="v6", destination="v5", autoclose=true, autoopen=true}
 ti["R"] = {"st_rubberband"}
 ti["W"] = {"st_box"}
 ti["S"] = {"st_switch", target="autoclose"}
 ti["r"] = {"it_ring"}
+ti["b"] = {"st_brake"}
 ti["f"] = {"it_flag"}
 ti["w"] = {"it_wormhole", range=2, destination=po(15, 7)}
 ti["v"] = {"it_wormhole", state=OFF, range=2, destination=po(15, 7)}
@@ -38,7 +41,7 @@
 ti["1"] = {"#ac_marble"}
 
 w, h = wo(ti, " ", {
-"   R                ",
+"   R        E   F   ",
 "                    ",
 "                    ",
 "   A  B  C  D       ",
@@ -47,8 +50,8 @@
 "                    ",
 "      1   r    f    ",
 "   S                ",
+"          b         ",
 "                    ",
-"                    ",
 " v    w         ~   ",
 "                    "
 })

Modified: team_levelpacks/team_test_new_api/ralT035_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT035_1.xml	2009-09-16 21:45:56 UTC (rev 1809)
+++ team_levelpacks/team_test_new_api/ralT035_1.xml	2009-09-16 22:33:00 UTC (rev 1810)
@@ -16,7 +16,7 @@
     </el:info>
     <el:luamain><![CDATA[
 
-wo["ConserveLevel"] = true
+wo["ConserveLevel"] = false
 
 ti["  "] = {"fl_sahara"}
 ti["~~"] = {"fl_water"}

Modified: team_levelpacks/team_test_new_api/ralT037_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT037_1.xml	2009-09-16 21:45:56 UTC (rev 1809)
+++ team_levelpacks/team_test_new_api/ralT037_1.xml	2009-09-16 22:33:00 UTC (rev 1810)
@@ -20,12 +20,13 @@
 
 ti[" "] = {"fl_sahara"}
 ti["~"] = {"fl_water"}
-ti["s"] = {"st_shogun", "him"}
+--ti["s"] = {"st_shogun", "him"}
+ti["G"] = {"st_ghost", "ghost"}
 ti["w"] = {"st_box", "you"}
 ti["r"] = {"it_rubberband", anchor2="you", length=4}
 ti["S"] = {"st_switch", target="privat.callbacks.killwood"}
 ti["X"] = {"st_scissors"}
-ti["T"] = {"st_turnstile"}
+ti["T"] = {"st_turnstile", "turn"}
 ti["t"] = {"st_turnstilearm_n","it"}
 ti["R"] = {"it_rubberband", anchor2="it", length=4}
 ti["p"] = {"st_swap", "you"}
@@ -38,9 +39,10 @@
 ti["*"] = {"it_landmine"}
 
 
-ti["1"] = {"#ac_marble_black", "me"}
+ti["1"] = {"#ac_marble_black", "me"} .. ti{"it_brush"}
 ti["2"] = {"#ac_marble_white"}
 ti["3"] = {"#ac_pearl"}
+ti["s"] = {"#ac_bug", "him"}
 
 w, h = wo(ti, " ", {
 "                    ",
@@ -51,15 +53,24 @@
 "                    ",
 "       pw  s        ",
 "     S              ",
-"        r  1       X",
+"        r  1   G    X",
 "                    ",
 "  b  |  ;   .  B    ",
 "                    ",
 "                    "
 })
 
-enigma.AddRubberBand(no["me"], no["him"], 5, 4)
+wo:add({"ot_rubberband", "firstrubber", anchor1="him", anchor2="me", length=5, strength=4})
+--wo[po{15,5}] = {"ac_bug", "him"}
+--wo:add({"ot_rubberband", anchor1="him", anchor2="me", length=5, strength=4})
+wo:add({"ot_rubberband", anchor1="me", anchor2="ghost", length=5, strength=4})
+wo:add({"ot_wire", anchor1="turn", anchor2="ghost"})
+wo:add({"ot_wire", anchor2="you", anchor1="ghost"})
 
+--no["ghost"]["name"] = "Geist"
+no["him"]["name"] = "ghost"
+--no["firstrubber"]:kill()
+
 privat = {}
 privat.callbacks = {}
 

Modified: team_levelpacks/team_test_new_api/ralT063_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT063_1.xml	2009-09-16 21:45:56 UTC (rev 1809)
+++ team_levelpacks/team_test_new_api/ralT063_1.xml	2009-09-16 22:33:00 UTC (rev 1810)
@@ -73,13 +73,22 @@
 
 ti["@"] = {"#ac_marble"}  ..ti({"it_magicwand"})
 
+ti["i"] = {"st_switch", target="fl_samba"}
+ti["j"] = {"st_switch", target="it_strip"}
+ti["k"] = {"st_switch", target="it_pipe"}
+ti["g"] = {"st_switch", target="fl_red"}
+ti["S"] = {"fl_red", friction=4.0}
+ti["p"] = {"it_pipe_ew"} ..ti["~"]
+ti["q"] = {"it_strip_n"} ..ti["_"]
+
+
 w, h = wo(ti, " ", {
-"                                       ",
+"                         ijkg          ",
 "                               ~~~33   ",
-"                               ~~~~~   ",
+"                               p~~~~   ",
 "  111       888        111     ~~~~~   ",
 "  2|2      18-9         21             ",
-"  222       999   8     222    _____   ",
+"  222       999   8     222    q____   ",
 "                               _____   ",
 "   +         o          |      _____   ",
 "1               988-    |              ",
@@ -123,6 +132,11 @@
 wo:add({"ot_wire", anchor1="wood4", anchor2="wood5"})
 wo:add({"ot_wire", anchor1="wood4", anchor2="wood5"})
 
+function fl_samba() wo["FallenPuzzle"] = "fl_samba" end
+function it_strip() wo["FallenPuzzle"] = "it_strip" end
+function it_pipe() wo["FallenPuzzle"] = "it_pipe" end
+function fl_red() wo["FallenPuzzle"] = "=S" end
+
   ]]></el:luamain>
     <el:i18n>
 	 <el:string el:key="title">

Modified: team_levelpacks/team_test_new_api/ralT079_1.xml
===================================================================
--- team_levelpacks/team_test_new_api/ralT079_1.xml	2009-09-16 21:45:56 UTC (rev 1809)
+++ team_levelpacks/team_test_new_api/ralT079_1.xml	2009-09-16 22:33:00 UTC (rev 1810)
@@ -18,9 +18,11 @@
 
 
 wo["ConserveLevel"] = true
+wo["SubSoil"] = SUBSOIL_AUTO
 
 ti[" "] = {"fl_sahara"}
 ti["~"] = {"fl_ice"}
+ti["&"] = {"fl_water"}
 ti["."] = {"fl_space"}
 ti["1"] = {"#ac_marble", essential=DISPENSIBLE}
 ti["2"] = {"#ac_marble_white"}
@@ -72,8 +74,8 @@
 ti["p"] = {"st_puzzle", cluster=1}
 
 w, h = wo(ti, " ", {
-"L       ddd  448   C",
-"P       ddd         ",
+"L   &   ddd  448   C",
+"P   b   ddd         ",
 "   b    ddd     w  x",
 "          e         ",
 "I      1      2    4",



From ral at mail.berlios.de  Sat Sep 19 00:08:14 2009
From: ral at mail.berlios.de (ral at mail.berlios.de)
Date: Sat, 19 Sep 2009 00:08:14 +0200
Subject: [Enigma-game-svn] r1811 - trunk/doc/reference
Message-ID: <200909182208.n8IM8Emc005126@sheep.berlios.de>

Author: ral
Date: 2009-09-19 00:08:05 +0200 (Sat, 19 Sep 2009)
New Revision: 1811

Modified:
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk 1.1: Refman
- add new global attributes FallenPuzzle, SubSoil
- add 5.13 missing entries for world index operations

Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2009-09-16 22:33:00 UTC (rev 1810)
+++ trunk/doc/reference/enigma-ref.texi	2009-09-18 22:08:05 UTC (rev 1811)
@@ -7069,15 +7069,18 @@
 from this moment on.
 
 @menu
-* World Creation::   Set up world with objects
-* add::              Add single objects to the world or an inventory
-* drawBorder::       Draw a rectangular border with a tile
-* drawMap::          Draw objects given by a map of tile keys
-* drawRect::         Fill a complete rectangle with a tile
-* world floor::      Retrieval of floor objects
-* world item::       Retrieval of item objects
-* shuffleOxyd::      Oxyd Shuffling Rules
-* world stone::      Retrieval of stone objects
+* World Creation::        Set up world with objects
+* World Tile Set::        Index Operator @samp{[]} write
+* Global Attribute Set::  Index Operator @samp{[]} write
+* Global Attribute Get::  Index Operator @samp{[]} read
+* add::                   Add single objects to the world or an inventory
+* drawBorder::            Draw a rectangular border with a tile
+* drawMap::               Draw objects given by a map of tile keys
+* drawRect::              Fill a complete rectangle with a tile
+* world floor::           Retrieval of floor objects
+* world item::            Retrieval of item objects
+* shuffleOxyd::           Oxyd Shuffling Rules
+* world stone::           Retrieval of stone objects
 @end menu
 
 @c ----------------- World Creation --------------------
@@ -7149,6 +7152,70 @@
 
 @end table
 
+ at c ----------------- World Tile Set --------------------
+ at node World Tile Set
+ at subsection World Tile Set
+
+ at table @asis
+ at item @b{Syntax:}
+ at b{wo}[<@i{object} | @i{position} | @i{table} | @i{group} | @i{polist}>] = @i{tile_declarations}
+
+ at item @b{Details:}
+Index write accesses to an index that can be interpreted as a grid position or
+a list of grid positions allows you to set one or several new objects to the
+given positions according to the supplied tile declaration.
+
+ at item @b{Syntax Samples:}
+ at example
+ at i{wo}[@i{no}["@var{myobjectname}"]] = @{"@b{st_chess}"@}
+ at i{wo}[@i{po}(@var{3}, @var{4})] = @i{ti}["@var{x}"]
+ at i{wo}[@{@var{2}, @var{5}@}] = @i{ti}["@var{x}"] .. @i{ti}["@var{y}"]
+ at i{wo}[@i{no}["@var{floorgroup#*}"]] = @{"@b{it_burnable_oil}"@}
+ at i{wo}[@i{no}["@var{myobjectname}"] + @b{NEIGHBORS_4}] = @i{ti}["@var{x}"]
+ at end example
+ at end table
+
+
+ at c ----------------- Global Attribute Set --------------------
+ at node Global Attribute Set
+ at subsection Global Attribute Set
+
+ at table @asis
+ at item @b{Syntax:}
+ at b{wo}["attritbutename"] = value
+
+ at item @b{Details:}
+Write accesses to string type indices allows you to change @ref{Global Attributes}.
+Just existing attributes with write accessibility may be changed. Note that
+some attributes must be set prior @ref{World Creation} to take proper affect.
+
+ at item @b{Syntax Samples:}
+ at example
+ at i{wo}["@b{ConserveLevel}"] = true
+ at end example
+ at end table
+
+
+ at c ----------------- Global Attribute Get --------------------
+ at node Global Attribute Get
+ at subsection Global Attribute Get
+
+ at table @asis
+ at item @b{Syntax:}
+ at var{var} = @b{wo}["attritbutename"]
+
+ at item @b{Details:}
+Read accesses to string type indices allows you to retrieve @ref{Global Attributes}.
+Just existing attributes with read accessibility can be read. Note that
+some attributes report proper values just after @ref{World Creation}.
+
+ at item @b{Syntax Samples:}
+ at example
+ at var{var} = @i{wo}["@b{IsDifficult}"]
+ at end example
+ at end table
+
+
 @c ----------------- add --------------------
 @node add
 @subsection add
@@ -8677,6 +8744,7 @@
 * meditation types::
 * glasses abilities::
 * coinslot acceptance::
+* subsoil kind::
 * screen scrolling::
 * map read directions::
 @end menu
@@ -8702,8 +8770,8 @@
 @item @samp{INVISIBLE} = @code{-1}, by @ref{it_crack}
 @item @samp{SMALL} = @code{0}, by @ref{it_crack}
 @item @samp{LARGE} = @code{2}, by @ref{it_crack}
- at item @samp{YIN} = @code{0}, by @ref{fl_yinyang}
- at item @samp{YANG} = @code{1}, by @ref{fl_yinyang}
+ at item @samp{YIN} = @code{0}, by @ref{fl_yinyang} and all actors as @ref{owner} value
+ at item @samp{YANG} = @code{1}, by @ref{fl_yinyang} and all actors as @ref{owner} value
 @item @samp{EMPTY} = @code{0}, by @ref{it_extinguisher}
 @item @samp{FULL} = @code{2}, by @ref{it_extinguisher}
 @item @samp{BROKEN} = @code{1}, by @ref{it_bottle}
@@ -8892,6 +8960,19 @@
 @item @samp{COIN_REJECT} = @code{-2}, by @ref{st_coinslot}
 @end itemize
 
+ at node subsoil kind
+ at subsection subsoil kind
+
+Number constants for the global attribute @ref{SubSoil}. Please
+choose the constant that is appropriate for the coinslot and do avoid using
+numbers.
+
+ at itemize @bullet
+ at item @samp{SUBSOIL_ABYSS} = @code{0}, by @ref{it_explosion}
+ at item @samp{SUBSOIL_WATER} = @code{1}, by @ref{it_explosion}
+ at item @samp{SUBSOIL_AUTO} = @code{2}, by @ref{it_explosion}
+ at end itemize
+
 @node screen scrolling
 @subsection screen scrolling
 
@@ -8946,6 +9027,7 @@
 * CreatingPreview::
 * ElectricStrength::
 * ExtralifeGlasses::
+* FallenPuzzle::
 * FollowAction::
 * FollowGrid::
 * FollowMethod::
@@ -8966,6 +9048,7 @@
 * SlopeStrength::
 * SublevelNumber::
 * SublevelTitle::
+* SubSoil::
 * SurviveFinish::
 * SwampSinkTime::
 * WaterSinkTime::
@@ -9133,6 +9216,31 @@
 @item @b{Support:} @ @ @ref{it_extralife}
 @end table
 
+ at node FallenPuzzle
+ at subsection FallenPuzzle
+
+A global object replacement kind for @ref{st_puzzle}s fallen into @ref{fl_water}
+or @ref{fl_abyss}. Besides any floor kind you can use any key of a tile
+declaration preceeded by an equal sign @code{'='}. By this second method you
+can use attributed floor kinds with special values for friction and adhesion.
+
+Additionally you can set this global @samp{FallenPuzzle} attribute to 
+ at code{"it_pipe"} or @code{"it_stip"}. In both cases fallen puzzle objects will
+be replaced by items of the given class with the identical connections as the
+fallen puzzle stones. Just in case that an item of the given class is already
+present at one of the affected grid positions the connections of these will be
+adjusted in a special way. An existing @code{"it_pipe"} remains unchanged, but
+an @code{"it_stip"} will add the connections of the fallen puzzle to its own
+connections.
+
+ at table @asis
+ at item @b{Type:} @ @ string
+ at item @b{Values:} @ @ any floor object kind, @code{"it_strip"}, @code{"it_pipe"} or @code{"=key"}, whith key being a valid tile key
+ at item @b{Default:} @ @ @code{"fl_gray"}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{st_puzzle}
+ at end table
+
 @node FollowAction
 @subsection FollowAction
 
@@ -9454,6 +9562,25 @@
 @item @b{Support:} @ @ no objects
 @end table
 
+ at node SubSoil
+ at subsection SubSoil
+
+A global variable that defines the subsoil which replaces a floor on its
+physical destruction. @ref{it_bomb}s and @ref{ot_cannonball}s can cause 
+ at ref{it_explosion}_debris which in turn dissolves the floor to the base
+subsoil. The special value @code{SUBSOIL_AUTO} determines the subsoil based
+on the surrounding floors. Any @ref{fl_water} on a direct neighboring floor
+causes the floor to be replaced by water, too. Otherwise the default 
+ at ref{fl_abyss} will be used as replacement.
+
+ at table @asis
+ at item @b{Type:} @ @ int
+ at item @b{Values:} @ @ @code{SUBSOIL_ABYSS}, @code{SUBSOIL_WATER}, @code{SUBSOIL_AUTO}
+ at item @b{Default:} @ @ @code{SUBSOIL_ABYSS}
+ at item @b{Access:} @ @ read/write
+ at item @b{Support:} @ @ @ref{it_explosion}
+ at end table
+
 @node SurviveFinish
 @subsection SurviveFinish
 
@@ -12633,7 +12760,7 @@
 @table @asis
 @item @b{Attributes:}
 @table @asis
- at item @b{flavor}, @ @ @i{values}: @code{"wood"}, @code{"hay"}, @code{"fake"}, @code{"volcano"}; @ @ @i{default}: @code{"wood"}
+ at item @b{flavor}, @ @ @i{values}: @code{"wood"}, @code{"hay"}, @code{"greenbrown"}, @code{"volcano"}; @ @ @i{default}: @code{"wood"}
 The type of the resulting stone.
 @item @b{secure} @ @ @i{values}: @code{true}, @code{false}; @ @ @i{default}: @code{false}
 This attribute is transferred to the resulting stone. The @ref{st_volcano} and
@@ -13388,7 +13515,7 @@
 @item @samp{nil} - no remnants.
 @item @samp{hollow} - leave an @ref{it_meditation}_hollow.
 @item @samp{crack} - make an @ref{it_crack}_water.
- at item @samp{debris} - dissolve the floor to @ref{fl_abyss}
+ at item @samp{debris} - dissolve the floor to @ref{SubSoil}, which defaults to @ref{fl_abyss}
 @end itemize
 
 Note that you are not allowed to set or change the @samp{state} of an explosion
@@ -14192,7 +14319,7 @@
 @tab @image{images/st_greenbrown, 12mm} @tab @yref{st_greenbrown}
 @tab @image{images/st_greengray, 12mm} @tab @yref{st_greengray}
 @item @image{images/st_ice, 12mm} @tab @yref{st_ice}
- at tab                            @tab @yref{st_invisible}
+ at tab                            @tab @yref{st_invisible} or @yref{st_ghost} 
 @tab @image{images/st_jamb_black, 12mm} @tab @yref{st_jamb}_black
 @item @image{images/st_jamb_white, 12mm} @tab @yref{st_jamb}_white
 @tab @image{images/st_key_off, 12mm} @tab @yref{st_key}_off
@@ -17569,16 +17696,18 @@
 complete clusters by an actor pushing or a stone impulse by @ref{ot_wire} or
 @ref{st_stoneimpulse}. Of course all new positions of the moving puzzle must be
 free of other stones. If all new positions are @ref{fl_water} the blue puzzle
-will sink and leave @ref{fl_gray} thus building a bridge over water. The user
-can prohibit the sinking of the puzzle into water by pushing with a revealed
- at ref{it_magicwand}. If all new positions are @ref{fl_abyss} just complete blue
-clusters will sink and build a bridge. If all new positions are either abyss or
-water with at least one abyss floor just complete blue clusters will sink. Note
-that puzzles just sink on moves. Moving a blue fragment besides another fragment
-on abyss so that both fragments build a complete cluster will not sink the new
-cluster. It will sink as a whole on the next move. If two or more stones of a
-cluster receive wire impulses originating from a single event, the whole cluster
-will move multiple times. But it will sink on the first opportunity.
+will sink and leave an object of the kind given by the global attribute
+ at ref{FallenPuzzle}. The replacement defaults to @ref{fl_gray} building a bridge
+over the water. The user can prohibit the sinking of the puzzle into water by
+pushing with a revealed @ref{it_magicwand}. If all new positions are 
+ at ref{fl_abyss} just complete blue clusters will sink and build a bridge. If all
+new positions are either abyss or water with at least one abyss floor just 
+complete blue clusters will sink. Note that puzzles just sink on moves. Moving
+a blue fragment besides another fragment on abyss so that both fragments build
+a complete cluster will not sink the new cluster. It will sink as a whole on the
+next move. If two or more stones of a cluster receive wire impulses originating 
+from a single event, the whole cluster will move multiple times. But it will 
+sink on the first opportunity.
 
 Just single unconnected yellow puzzle stones can be moved by actors. They will
 neither sink in @ref{fl_water} nor fall in @ref{fl_abyss}. Any yellow cluster of
@@ -18073,8 +18202,8 @@
 @item @ref{it_dynamite} do ignite,
 @item @ref{it_crack} do crack,
 @item other indestructible items do remain and protect floors,
- at item other items are blown away,
- at item floors do crack to @ref{fl_abyss} if not indestructible as @ref{fl_water}, @ref{fl_swamp}, @ref{fl_abyss}.
+ at item other items are blown away by an @ref{it_explosion}_debris that may destruct the floor,too,
+ at item floors dissolve via an @ref{it_explosion}_debris if not being indestructible as @ref{fl_water}, @ref{fl_swamp}, @ref{fl_abyss}.
 @end itemize
 
 Actors will not be harmed by falling cannonballs.
@@ -19080,7 +19209,10 @@
 
 The player that owns the actor. The owner gets all items picked up by an actor
 added to his inventory. The ownership of an actor does not influence the
-ability of a player to control the actors movements.
+ability of a player to control the actors movements. Note that you need to
+assign the value @code{DEFAULT} in Lua tables to set the value @code{nil} due to
+the well known Lua table @ref{Caveats}. The other two values @code{YIN} and
+ at code{YANG} are common @ref{state values}.
 
 @table @asis
 @item @b{Type:} @ @ number



From raoulb at bluewin.ch  Sun Sep 20 15:37:30 2009
From: raoulb at bluewin.ch (Raoul)
Date: Sun, 20 Sep 2009 15:37:30 +0200
Subject: [Enigma-game-svn] rev 1812
Message-ID: <20090920153730.408c0d30@loipc.loinet.home>

-> Shortcut fixes for various levels ("ZigZag", "The wrong Place?", "Build Up Speed", "Easy Shifting..", some jump levels)
-> Some new rewrites
-> A few new levels

Note: We have now 200 new levels since last release :-)


From raoul at mail.berlios.de  Sun Sep 20 16:15:10 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sun, 20 Sep 2009 16:15:10 +0200
Subject: [Enigma-game-svn] r1813 - in trunk/data/levels: enigma_cross
	enigma_viii
Message-ID: <200909201415.n8KEFANA012144@sheep.berlios.de>

Author: raoul
Date: 2009-09-20 16:15:03 +0200 (Sun, 20 Sep 2009)
New Revision: 1813

Modified:
   trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
   trunk/data/levels/enigma_viii/index.xml
   trunk/data/levels/enigma_viii/mecke23_1.xml
   trunk/data/levels/enigma_viii/mecke29_1.xml
Log:
-> Found and fixed two more attribute type validator errors



Modified: trunk/data/levels/enigma_cross/newlevels_1.1.0.xml
===================================================================
--- trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2009-09-20 13:34:40 UTC (rev 1812)
+++ trunk/data/levels/enigma_cross/newlevels_1.1.0.xml	2009-09-20 14:15:03 UTC (rev 1813)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="65" title="Enigma 1.1 new"/>
+  <info enigma="1.10" group="Facets" location="15600" network="false" owner="Enigma Team" release="1" revision="66" title="Enigma 1.1 new"/>
 
   <attributes/>
 
@@ -121,7 +121,7 @@
     <level _seq="113" _title="Helios II" _xpath="enigma_viii/mecke08_1" author="mecke" ctrl="force" easy="true" id="mecke08" rel="1" rev="26" score="1" target="time" unit="duration"/>
     <level _seq="114" _title="Tutoxyd's Pyramid" _xpath="enigma_viii/ral21_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070822ral291" rel="2" rev="183" score="2" target="time" unit="duration"/>
     <level _seq="115" _title="Alternation I" _xpath="enigma_viii/mecke17_1" author="mecke" ctrl="force" easy="false" id="mecke17" rel="1" rev="14" score="1" target="time" unit="duration"/>
-    <level _seq="116" _title="Enigmaparcour II" _xpath="enigma_viii/mecke29_1" author="mecke" ctrl="force" easy="true" id="mecke29" rel="1" rev="17" score="1" target="time" unit="duration"/>
+    <level _seq="116" _title="Enigmaparcour II" _xpath="enigma_viii/mecke29_1" author="mecke" ctrl="force" easy="true" id="mecke29" rel="1" rev="18" score="1" target="time" unit="duration"/>
     <level _seq="117" _title="- Meditation -" _xpath="enigma_viii/devnull04_1" author="/dev/null" ctrl="force" easy="true" id="devnull04" rel="1" rev="10" score="1" target="time" unit="duration"/>
     <level _seq="118" _title="Multi-lane" _xpath="enigma_viii/devnull03_1" author="/dev/null" ctrl="force" easy="true" id="devnull03" rel="1" rev="27" score="1" target="time" unit="duration"/>
     <level _seq="119" _title="See Saw Meditation" _xpath="enigma_viii/duffy180_1" author="Jacob Scott" ctrl="force" easy="true" id="duffy180" rel="1" rev="6" score="1" target="time" unit="duration"/>
@@ -130,7 +130,7 @@
     <level _seq="122" _title="On belay?" _xpath="enigma_viii/devnull15_1" author="/dev/null" ctrl="force" easy="true" id="devnull15" rel="1" rev="9" score="1" target="time" unit="duration"/>
     <level _seq="123" _title="Hang-dogging?" _xpath="enigma_viii/devnull16_1" author="/dev/null" ctrl="force" easy="true" id="devnull16" rel="1" rev="8" score="1" target="time" unit="duration"/>
     <level _seq="124" _title="Alternation II" _xpath="enigma_viii/mecke31_1" author="mecke" ctrl="force" easy="false" id="mecke31" rel="1" rev="21" score="1" target="time" unit="duration"/>
-    <level _seq="125" _title="Fifty Years Later ..." _xpath="enigma_viii/mecke23_1" author="mecke" ctrl="force" easy="true" id="mecke23" rel="1" rev="39" score="1" target="time" unit="duration"/>
+    <level _seq="125" _title="Fifty Years Later ..." _xpath="enigma_viii/mecke23_1" author="mecke" ctrl="force" easy="true" id="mecke23" rel="1" rev="40" score="1" target="time" unit="duration"/>
     <level _seq="126" _title="Turbulencia" _xpath="enigma_viii/mecke19_1" author="mecke" ctrl="force" easy="true" id="mecke19" rel="1" rev="22" score="1" target="time" unit="duration"/>
     <level _seq="127" _title="Techno Voodoo" _xpath="enigma_viii/mecke06_1" author="mecke" ctrl="force" easy="false" id="mecke06" rel="1" rev="20" score="1" target="time" unit="duration"/>
     <level _seq="128" _title="Plutos World" _xpath="enigma_viii/mecke02_1" author="mecke" ctrl="force" easy="false" id="mecke16" rel="1" rev="23" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_viii/index.xml
===================================================================
--- trunk/data/levels/enigma_viii/index.xml	2009-09-20 13:34:40 UTC (rev 1812)
+++ trunk/data/levels/enigma_viii/index.xml	2009-09-20 14:15:03 UTC (rev 1813)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <index xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="index.xsd">
 
-  <info enigma="1.10" group="Enigma" location="10900" network="false" owner="Enigma Team" release="1" revision="58" title="Enigma VIII"/>
+  <info enigma="1.10" group="Enigma" location="10900" network="false" owner="Enigma Team" release="1" revision="59" title="Enigma VIII"/>
 
   <attributes/>
 
@@ -45,7 +45,7 @@
     <level _seq="37" _title="Helios II" _xpath="./mecke08_1" author="mecke" ctrl="force" easy="true" id="mecke08" rel="1" rev="26" score="1" target="time" unit="duration"/>
     <level _seq="38" _title="Tutoxyd's Pyramid" _xpath="./ral21_2" author="Ronald Lamprecht" ctrl="force" easy="true" id="20070822ral291" rel="2" rev="183" score="2" target="time" unit="duration"/>
     <level _seq="39" _title="Alternation I" _xpath="./mecke17_1" author="mecke" ctrl="force" easy="false" id="mecke17" rel="1" rev="14" score="1" target="time" unit="duration"/>
-    <level _seq="40" _title="Enigmaparcour II" _xpath="./mecke29_1" author="mecke" ctrl="force" easy="true" id="mecke29" rel="1" rev="17" score="1" target="time" unit="duration"/>
+    <level _seq="40" _title="Enigmaparcour II" _xpath="./mecke29_1" author="mecke" ctrl="force" easy="true" id="mecke29" rel="1" rev="18" score="1" target="time" unit="duration"/>
     <level _seq="41" _title=" - Meditation - " _xpath="./devnull07_1" author="/dev/null" ctrl="force" easy="true" id="devnull07" rel="1" rev="8" score="1" target="time" unit="duration"/>
     <level _seq="42" _title=" - Meditation - " _xpath="./devnull06_1" author="/dev/null" ctrl="force" easy="true" id="devnull06" rel="1" rev="8" score="1" target="time" unit="duration"/>
     <level _seq="43" _title="- Meditation -" _xpath="./devnull04_1" author="/dev/null" ctrl="force" easy="true" id="devnull04" rel="1" rev="10" score="1" target="time" unit="duration"/>
@@ -56,7 +56,7 @@
     <level _seq="48" _title="On belay?" _xpath="./devnull15_1" author="/dev/null" ctrl="force" easy="true" id="devnull15" rel="1" rev="9" score="1" target="time" unit="duration"/>
     <level _seq="49" _title="Hang-dogging?" _xpath="./devnull16_1" author="/dev/null" ctrl="force" easy="true" id="devnull16" rel="1" rev="8" score="1" target="time" unit="duration"/>
     <level _seq="50" _title="Alternation II" _xpath="./mecke31_1" author="mecke" ctrl="force" easy="false" id="mecke31" rel="1" rev="21" score="1" target="time" unit="duration"/>
-    <level _seq="51" _title="Fifty Years Later ..." _xpath="./mecke23_1" author="mecke" ctrl="force" easy="true" id="mecke23" rel="1" rev="39" score="1" target="time" unit="duration"/>
+    <level _seq="51" _title="Fifty Years Later ..." _xpath="./mecke23_1" author="mecke" ctrl="force" easy="true" id="mecke23" rel="1" rev="40" score="1" target="time" unit="duration"/>
     <level _seq="52" _title="Turbulencia" _xpath="./mecke19_1" author="mecke" ctrl="force" easy="true" id="mecke19" rel="1" rev="22" score="1" target="time" unit="duration"/>
     <level _seq="53" _title="Techno Voodoo" _xpath="./mecke06_1" author="mecke" ctrl="force" easy="false" id="mecke06" rel="1" rev="20" score="1" target="time" unit="duration"/>
     <level _seq="54" _title="Plutos World" _xpath="./mecke02_1" author="mecke" ctrl="force" easy="false" id="mecke16" rel="1" rev="23" score="1" target="time" unit="duration"/>

Modified: trunk/data/levels/enigma_viii/mecke23_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke23_1.xml	2009-09-20 13:34:40 UTC (rev 1812)
+++ trunk/data/levels/enigma_viii/mecke23_1.xml	2009-09-20 14:15:03 UTC (rev 1813)
@@ -3,8 +3,8 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Fifty Years Later ..." el:subtitle="Survival Training in wasted Landscapes ..." el:id="mecke23"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 39 $" el:status="released"/>
-      <el:author  el:name="mecke" el:email="" el:homepage=""/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 40 $" el:status="released"/>
+      <el:author el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
       <el:compatibility el:enigma="1.10"/>
@@ -15,8 +15,6 @@
       <el:score el:easy="79:15" el:difficult="68:29"/>
     </el:info>
     <el:luamain><![CDATA[
-wo["ConserveLevel"] = true
-
 ti[" #"] = {"fl_stone"}
 ti[" a"] = {"fl_rock"}
 ti[" ,"] = {"fl_concrete"}
@@ -223,9 +221,7 @@
     ti["L4"] = {"st_passage_black_frame"}
 end
 
-local resolver = res.composer(ti)
-
-w, h = wo(resolver, "  ", {
+wo(res.composer(ti), "  ", {
 -- 00010203040506070809101112131415161718AA20212223242526272829303132333435363738BB404142434445464748495051525354555657CC596061626364656667686970717273747576
   "7 7 7 7 7 - , # # # # # # # # # # # # D # # # # # # XX# # # # # # # # # # # D # # # # # 4 4 4 T # T 4 4 4 # # # # D # # # # # # # # # # # # , - 7 7 7 7 7 ",
   "7  _ 1 _7  aL3          XSL3          9                                     R  O          SP    nn    SP         OXF = = = =  L1XS          L1 a7  _ 1 _7 ",
@@ -280,7 +276,7 @@
 })
 
 function settimer()
-    wo[{0, 1}] = {"st_timer",action="callback",target="hux",interval=11.9,invisible=0}
+    wo[po(0, 1)] = {"st_timer", action="callback", target="hux", interval=11.9}
 end
 
 function hux()

Modified: trunk/data/levels/enigma_viii/mecke29_1.xml
===================================================================
--- trunk/data/levels/enigma_viii/mecke29_1.xml	2009-09-20 13:34:40 UTC (rev 1812)
+++ trunk/data/levels/enigma_viii/mecke29_1.xml	2009-09-20 14:15:03 UTC (rev 1813)
@@ -3,19 +3,18 @@
   <el:protected >
     <el:info el:type="level">
       <el:identity el:title="Enigmaparcour II" el:subtitle="Open the Doors" el:id="mecke29"/>
-      <el:version el:score="1" el:release="1" el:revision="$Revision: 17 $" el:status="released"/>
-      <el:author  el:name="mecke" el:email="" el:homepage=""/>
+      <el:version el:score="1" el:release="1" el:revision="$Revision: 18 $" el:status="released"/>
+      <el:author el:name="mecke" el:email="" el:homepage=""/>
       <el:copyright>Copyright ? 2008 Thomas Bernhardt</el:copyright>
       <el:license el:type="GPL v2.0 or above" el:open="true"/>
       <el:compatibility el:enigma="1.10"/>
-      <el:modes el:easy="true" el:single="true" el:network="false" el:control="force" el:scoreunit="duration" el:scoretarget="time"/>
+      <el:modes el:easy="true" el:single="true" el:network="false"/>
       <el:comments>
         <el:credits el:showinfo="true" el:showstart="false">Thanks for the new items in new API in this level"</el:credits>
       </el:comments>
       <el:score el:easy="12:36" el:difficult="14:13"/>
     </el:info>
     <el:luamain><![CDATA[
-wo["ConserveLevel"] = true
 wo["ExtralifeGlasses"] = SPOT_DEATH + SPOT_TRAP
 
 if wo ["IsDifficult"] then
@@ -26,7 +25,6 @@
     ti["  "] = {"fl_rough"}
     ti[" v"] = {"fl_bluegreen"}
 end
-
 ti["' "] = {"it_trap"}
 ti["b "] = {"it_bomb_black"}
 ti[" ~"] = {"fl_water"}
@@ -81,7 +79,7 @@
 ti["3 "] = ti[" v"] .. {"st_box_wood"}
 ti["2 "] = {"st_oneway_black", orientation=SOUTH}
 ti[" f"] = {"it_wrench"}
-ti["4 "] = ti[" f"] ..{"st_oneway", orientation=WEST}
+ti["4 "] = ti[" f"] .. {"st_oneway", orientation=WEST}
 ti["6 "] = {"st_oneway", orientation=EAST}
 ti["8 "] = {"st_oneway_white", orientation=NORTH}
 ti["Q "] = {"st_break_oxydc"}
@@ -131,11 +129,11 @@
 ti["k "] = {"st_turnstilearm", orientation=WEST}
 ti["l "] = {"st_turnstilearm", orientation=EAST}
 ti[" *"] = {"it_extralife"}
-ti["v?"] = ti[" v"] ..  {"it_yinyang"}
-ti["* "] = ti["ii"] ..  {"#ac_marble_black"}
-ti["vv"] = ti[" v"] ..  {"fl_ice",name="hu"}
-ti[" ?"] = ti["wn"] ..  {"it_yinyang"}
-ti["? "] = ti[" ?"] ..  {"#ac_marble_white"}
+ti["v?"] = ti[" v"] .. {"it_yinyang"}
+ti["* "] = ti["ii"] .. {"#ac_marble_black"}
+ti["vv"] = ti[" v"] .. {"fl_ice",name="hu"}
+ti[" ?"] = ti["wn"] .. {"it_yinyang"}
+ti["? "] = ti[" ?"] .. {"#ac_marble_white"}
 ti["J "] = {"#ac_top", range=1, strength=1}
 ti["= "] = {"#ac_horse"}
 ti["$1"] = {"it_trigger", target="door#2"}
@@ -146,11 +144,11 @@
 ti["$6"] = {"it_trigger", target="door#6"}
 ti["$7"] = {"it_trigger", target="laser2"}
 ti["$8"] = {"it_trigger", target="door#4"}
-ti["V1"] = ti["  "] ..{"it_vortex_open", name="vortex1", destination="vortex2"}
-ti["V2"] = ti["  "] ..{"it_vortex_open", name="vortex2", destination="vortex4"}
-ti["V3"] = ti["  "] ..{"it_vortex_open", name="vortex3", destination="vortex5"}
-ti["V4"] = ti["  "] ..{"it_vortex_open", name="vortex4", destination="vortex3"}
-ti["V5"] = ti["  "] ..{"it_vortex_open", name="vortex5", destination="vortex1"}
+ti["V1"] = ti["  "] .. {"it_vortex_open", name="vortex1", destination="vortex2"}
+ti["V2"] = ti["  "] .. {"it_vortex_open", name="vortex2", destination="vortex4"}
+ti["V3"] = ti["  "] .. {"it_vortex_open", name="vortex3", destination="vortex5"}
+ti["V4"] = ti["  "] .. {"it_vortex_open", name="vortex4", destination="vortex3"}
+ti["V5"] = ti["  "] .. {"it_vortex_open", name="vortex5", destination="vortex1"}
 ti[".g"] = {"it_glasses", state = SPOT_TRAP}
 ti[". "] = {"it_trap"}
 ti["PW"] = {"st_flash"}
@@ -162,12 +160,10 @@
 ti["P5"] = {"st_puzzle_yellow_sw"}
 ti["P6"] = {"st_puzzle_yellow_nw"}
 ti["P7"] = {"st_puzzle_yellow_ne"}
-ti["mm"] = {"it_sensor",action="callback",target="settimer"}
-ti["mn"] = {"it_sensor",action="callback",target="wormy"}
+ti["mm"] = {"it_sensor", action="callback", target="settimer"}
+ti["mn"] = {"it_sensor", action="callback", target="wormy"}
 
-local resolver = res.composer(ti)
-
-w, h = wo(resolver, "  ", {
+w, h = wo(res.composer(ti), "  ", {
 -- 00010203040506070809101112131415161718192021222324
   "# # # # # # D1# # # # # D1# # # # # # # # # # # # ",
   "#      ~    3 '_b~D3b~'_3  . _       _$1# T T T # ",
@@ -183,30 +179,23 @@
   "#   K2 zK4  #   h1G h1  #     8 5 8     # X6X9X7# ",
   "#  ~ ~   ~ ~D1$4K h1K $8D1K ! ! o ! ! K # X9X8X9# ",
   "#           L4  h1 _h1  L3            $6# T T T # ",
-  "# # # Y2# # D1# # # # # D1# # # Y1# # # # # # # # "
-})
+  "# # # Y2# # D1# # # # # D1# # # Y1# # # # # # # # "})
+
 function settimer()
-    wo[{0, 1}] = {"st_timer",action="callback",target="hux",interval=11.9,invisible=0}
+    wo[po(0, 1)] = {"st_timer", action="callback", target="hux", interval=11.9}
 end
 
 function hux()
-    wo[{15,1}]= {"it_burnable_oil"}
-    wo[{17,1}]= {"it_burnable_oil"}
-    wo[{16,1}]= {"it_burnable_burning"}
-    wo[{15,3}]= {"it_burnable_oil"}
-    wo[{17,3}]= {"it_burnable_oil"}
-    wo[{16,3}]= {"it_burnable_burning"}
+    wo[po(15,1) .. po(17,1) .. po(15,3) .. po(17,3)] = {"it_burnable_oil"}
+    wo[po(16,1) .. po(16,3)] = {"it_burnable_burning"}
 end
 
 function wormy ()
-    wo[{14,5}]= {"it_wormhole", range=1, strength=1, destination="hu"}
+    wo[po(14,5)] = {"it_wormhole", range=1, strength=1, destination="hu"}
 end
 
 function cher()
-    wo[{1,13}]= {"it_cherry"}
-    wo[{2,13}]= {"it_cherry"}
-    wo[{4,13}]= {"it_cherry"}
-    wo[{5,13}]= {"it_cherry"}
+    wo[po(1,13) .. po(2,13) .. po(4,13) .. po(5,13)] = {"it_cherry"}
 end
 
 wo:add({"ot_wire", anchor1="movy1", anchor2="movy2"})



From raoul at mail.berlios.de  Sun Sep 20 20:53:17 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Sun, 20 Sep 2009 20:53:17 +0200
Subject: [Enigma-game-svn] r1814 - in trunk: . doc/reference
Message-ID: <200909201853.n8KIrHhU016461@sheep.berlios.de>

Author: raoul
Date: 2009-09-20 20:53:16 +0200 (Sun, 20 Sep 2009)
New Revision: 1814

Added:
   trunk/doc/reference/level_api_constants.tex
   trunk/doc/reference/level_api_syntax.tex
   trunk/doc/reference/level_api_syntax_examples.tex
   trunk/doc/reference/level_api_tds.tex
Modified:
   trunk/configure.ac
   trunk/doc/reference/Makefile.am
Log:
-> Level API cheat sheets for level authors
   (They do NOT replace the refman!)



Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2009-09-20 14:15:03 UTC (rev 1813)
+++ trunk/configure.ac	2009-09-20 18:53:16 UTC (rev 1814)
@@ -68,6 +68,9 @@
 dnl ---------- Texi2html ----------
 AC_PATH_PROG([TEXI2HTML], [texi2html], [""])
 
+dnl ---------- PdfLatex ----------
+AC_PATH_PROG([PDFLATEX], [pdflatex], [""])
+
 dnl ---------- ImageMagick ----------
 AC_PATH_PROG([CONVERT], [convert], [""])
 

Modified: trunk/doc/reference/Makefile.am
===================================================================
--- trunk/doc/reference/Makefile.am	2009-09-20 14:15:03 UTC (rev 1813)
+++ trunk/doc/reference/Makefile.am	2009-09-20 18:53:16 UTC (rev 1814)
@@ -7,7 +7,7 @@
 refdir=@datadir@/doc/enigma/reference
 ref_DATA = $(HTML) ant_lua.txt sounds.txt soundset.lua lua2xml xml2lua
 
-EXTRA_DIST = enigma-ref.texi enigma-t2h.init $(ref_DATA)
+EXTRA_DIST = enigma-ref.texi enigma-t2h.init level_api_syntax.tex level_api_constants.tex level_api_syntax_examples.tex level_api_tds.tex $(ref_DATA)
 
 MOSTLYCLEANFILES = enigma-ref.{at,ats,aux,cp,cps,fn,fns,ky,log,ms,mss,ob,obs,pg,toc,tp,vr,vrs}
 CLEANFILES = enigma-ref.{pdf,html}
@@ -25,7 +25,10 @@
 	$(MAKE) -C images
 	$(MAKE) pdf_local
 
-pdf_local: enigma-ref.pdf
+pdf_local: enigma-ref.pdf level_api_syntax.pdf level_api_constants.pdf level_api_syntax_examples.pdf level_api_tds.pdf
 
 %.pdf: %.texi
 	$(TEXI2DVI) --pdf $<
+
+%.pdf: %.tex
+	$(PDFLATEX) $<

Added: trunk/doc/reference/level_api_constants.tex
===================================================================
--- trunk/doc/reference/level_api_constants.tex	2009-09-20 14:15:03 UTC (rev 1813)
+++ trunk/doc/reference/level_api_constants.tex	2009-09-20 18:53:16 UTC (rev 1814)
@@ -0,0 +1,225 @@
+\documentclass[10pt,landscape]{article}
+\usepackage{multicol}
+\usepackage{calc}
+\usepackage{ifthen}
+\usepackage[landscape]{geometry}
+
+\geometry{top=1cm,left=1cm,right=1cm,bottom=1cm}
+\pagestyle{empty}
+
+% Redefine section commands to use less space
+\makeatletter
+\renewcommand{\section}{\@startsection{section}{1}{0mm}%
+                                {-1ex plus -.5ex minus -.2ex}%
+                                {0.5ex plus .2ex}%
+                                {\normalfont\large\bfseries}}
+\renewcommand{\subsection}{\@startsection{subsection}{2}{0mm}%
+                                {-1explus -.5ex minus -.2ex}%
+                                {0.5ex plus .2ex}%
+                                {\normalfont\normalsize\bfseries}}
+\renewcommand{\subsubsection}{\@startsection{subsubsection}{3}{0mm}%
+                                {-1ex plus -.5ex minus -.2ex}%
+                                {1ex plus .2ex}%
+                                {\normalfont\small\bfseries}}
+\makeatother
+
+\begin{document}
+
+\raggedright
+\footnotesize
+\begin{multicols}{3}
+\setlength{\premulticols}{1pt}
+\setlength{\postmulticols}{1pt}
+\setlength{\multicolsep}{1pt}
+\setlength{\columnsep}{1pt}
+
+\begin{center}
+\Large{\textbf{Enigma Level API II}} \\
+\large{\textbf{API constants}}
+\end{center}
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt}
+\end{center}
+
+\section*{Common Constants}
+
+\subsection*{state values}
+\begin{tabular}{ll}
+\verb!OFF! & all switch like objects \\
+\verb!ON! & all switch like objects \\
+\verb!CLOSED! & all door like objects \\
+\verb!OPEN! & all door like objects \\
+\verb!IDLE! & other objects in the default passive state \\
+\verb!ACTIVE! & other objects in the active state \\
+\verb!OXYDPAIR! & just by \texttt{st\_oxyd} \\
+\verb!LIGHT! & by \texttt{st\_disco} \\
+\verb!MEDIUM! & by \texttt{st\_disco}, \texttt{it\_crack}, \texttt{it\_extinguisher} \\
+\verb!DARK! & by \texttt{st\_disco} \\
+\verb!FLOODING! & by \texttt{fl\_water}, \texttt{fl\_wood}, \texttt{fl\_hay}, \texttt{fl\_rock} \\
+\verb!INVISIBLE! & by \texttt{it\_crack} \\
+\verb!SMALL! & by \texttt{it\_crack} \\
+\verb!LARGE! & by \texttt{it\_crack} \\
+\verb!YIN! & by \texttt{fl\_yinyang} \\
+\verb!YANG! & by \texttt{fl\_yinyang} \\
+\verb!EMPTY! & by \texttt{it\_extinguisher} \\
+\verb!FULL! &  by \texttt{it\_extinguisher} \\
+\verb!BROKEN! &  by \texttt{it\_bottle} \\
+\verb!BREAKING! &  by \texttt{st\_quake} \\
+\verb!CW! &  clockwise, by \texttt{st\_rotator} \\
+\verb!CCW! & counterclockwise, by \texttt{st\_rotator}
+\end{tabular}
+
+\subsection*{color values}
+\begin{tabular}{ll}
+\verb!BLACK! & all black/white colored objects \\
+\verb!WHITE! & all black/white colored objects \\
+\verb!BLUE! & by \texttt{st\_puzzle} \\
+\verb!YELLOW! & by \texttt{st\_puzzle} \\
+\verb!NOCOLOR! & some objects, that exist in black, \\
+                & white variants, too, like \texttt{st\_switch}
+\end{tabular}
+
+\subsection*{actor controllers}
+\begin{tabular}{ll}
+\verb!CTRL_NONE! &  by all actors \\
+\verb!CTRL_YIN! &  by all actors \\
+\verb!CTRL_YANG! &  by all actors \\
+\verb!CTRL_YINYANG! &  by all actors
+\end{tabular}
+
+\subsection*{oxyd colors}
+\begin{tabular}{ll}
+\verb!OXYD_BLUE! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_RED! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_GREEN! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_YELLOW! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_CYAN! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_PURPLE! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_WHITE! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_BLACK! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_GRAY! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_ORANGE! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_PINE! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_BROWN! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_AUTO! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_FAKE! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_QUAKE! &  by \texttt{st\_oxyd} \\
+\verb!OXYD_BOLD! &  by \texttt{st\_oxyd}
+\end{tabular}
+
+\subsection*{orientations}
+\begin{tabular}{ll}
+\verb!RANDOMDIR! & by \texttt{st\_mirror} \\
+\verb!NODIR! & by \texttt{fl\_slope} \\
+\verb!WEST! & by all objects with 4 orientations \\
+\verb!SOUTH! & by all objects with 4 orientations \\
+\verb!EAST! & by all objects with 4 orientations \\
+\verb!NORTH! & by all objects with 4 orientations \\
+\verb!NORTHWEST! & by all objects with 8 orientations \\
+\verb!SOUTHWEST! & by all objects with 8 orientations \\
+\verb!SOUTHEAST! & by all objects with 8 orientations \\
+\verb!NORTHEAST! & by all objects with 8 orientations \\
+\verb!BACKSLASH! & by \texttt{st\_mirror} \\
+\verb!HORIZONTAL! & by \texttt{st\_mirror} \\
+\verb!SLASH! & by \texttt{st\_mirror} \\
+\verb!VERTICAL! & by \texttt{st\_mirror} \\
+\end{tabular}
+
+\subsection*{direction offsets}
+\begin{tabular}{ll}
+\verb!N = po(0, -1)! &  \\
+\verb!E = po(1, 0)! &  \\
+\verb!S = po(0, 1)! &  \\
+\verb!W = po(-1, 0)! &  \\
+\verb!NE = N + E! &  \\
+\verb!NW = N + W! &  \\
+\verb!SE = S + E! &  \\
+\verb!SW = S + W! &  \\
+\verb!NNE = N + NE! & by \texttt{st\_chess} \\
+\verb!ENE = E + NE! & by \texttt{st\_chess} \\
+\verb!ESE = E + SE! & by \texttt{st\_chess} \\
+\verb!SSE =  S + SE! & by \texttt{st\_chess} \\
+\verb!SSW =  S + SW! & by \texttt{st\_chess} \\
+\verb!WSW =  W + SW! & by \texttt{st\_chess} \\
+\verb!WNW =  W + NW! & by \texttt{st\_chess} \\
+\verb!NNW =  N + NW! & by \texttt{st\_chess}
+\end{tabular}
+
+\subsection*{position lists}
+\begin{tabular}{ll}
+\verb!NEIGHBORS_4 = W .. S .. E .. N! & \\
+\verb!NEIGHBORS_8 = NEIGHBORS_4 .. NW .. SW ..SE .. NE! & \\
+\verb!NEIGHBORS_CHESS = NNE .. ENE .. ESE .. SSE! & \\
+\verb! .. SSW .. WSW .. WNW .. NNW!
+\end{tabular}
+
+\subsection*{essentialness}
+\begin{tabular}{ll}
+\verb!DISPENSABLE! & by all actors and \texttt{it\_meditation} \\
+\verb!INDISPENSABLE! & by all actors and Section \texttt{it\_meditation} \\
+\verb!PERKIND! & by all actors
+\end{tabular}
+
+\subsection*{meditation types}
+\begin{tabular}{ll}
+\verb!MEDITATION_CALDERA! & by \texttt{it\_meditation} \\
+\verb!MEDITATION_HOLLOW! & by \texttt{it\_meditation} \\
+\verb!MEDITATION_DENT! & by \texttt{it\_meditation} \\
+\verb!MEDITATION_BUMP! & by \texttt{it\_meditation} \\
+\verb!MEDITATION_HILL! & by \texttt{it\_meditation} \\
+\verb!MEDITATION_VOLCANO! & by \texttt{it\_meditation}
+\end{tabular}
+
+\subsection*{glasses abilities}
+\begin{tabular}{ll}
+\verb!SPOT_NOTHING! & by \texttt{it\_glasses} \\
+\verb!SPOT_DEATH! & by \texttt{it\_glasses} \\
+\verb!SPOT_HOLLOW! & by \texttt{it\_glasses} \\
+\verb!SPOT_ACTORIMPULSE! & by \texttt{it\_glasses} \\
+\verb!SPOT_SENSOR! & by \texttt{it\_glasses} \\
+\verb!SPOT_LIGHTPASSENGER! & by \texttt{it\_glasses} \\
+\verb!SPOT_TRAP! & by \texttt{it\_glasses}
+\end{tabular}
+
+\subsection*{coinslot acceptance}
+\begin{tabular}{ll}
+\verb!COIN_IGNORE! & by \texttt{st\_coinslot} \\
+\verb!COIN_REJECT! & by \texttt{st\_coinslot}
+\end{tabular}
+
+\subsection*{subsoil kind}
+\begin{tabular}{ll}
+\verb!SUBSOIL_ABYSS! & by \texttt{it\_explosion} \\
+\verb!SUBSOIL_WATER! & by \texttt{it\_explosion} \\
+\verb!SUBSOIL_AUTO! & by \texttt{it\_explosion}
+\end{tabular}
+
+\subsection*{screen scrolling}
+\begin{tabular}{ll}
+\verb!FOLLOW_NO! & by global \texttt{FollowMethod} \\
+\verb!FOLLOW_SCROLL! & by global \texttt{FollowMethod} \\
+\verb!FOLLOW_FLIP! & by global \texttt{FollowMethod} \\
+\verb!FOLLOW_FULLSCREEN = po(19, 12)! & by global \texttt{FollowAction} \\
+\verb!FOLLOW_HALFSCREEN = po(9.5, 6)! & by global \texttt{FollowAction}
+\end{tabular}
+
+\subsection*{map read directions}
+\begin{tabular}{ll}
+\verb!MAP_IDENT! & no transformation \\
+\verb!MAP_ROT_CW! & rotate map 90 degrees clockwise \\
+\verb!MAP_ROT_180! & rotate map 180 degrees \\
+\verb!MAP_ROT_CCW! & rotate map 90 degrees counter-clockwise \\
+\verb!MAP_FLIP_BACKSLASH! & flip upper-left and lower-right corners \\
+\verb!MAP_FLIP_HORIZONTAL! & flip right and left \\
+\verb!MAP_FLIP_SLASH! & flip upper-right and lower-left corners \\
+\verb!MAP_FLIP_VERTICAL! & flip up and down
+\end{tabular}
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt} \\
+Compiled from Enigma 1.10 reference manual by Raoul
+\end{center}
+
+\end{multicols}
+\end{document}

Added: trunk/doc/reference/level_api_syntax.tex
===================================================================
--- trunk/doc/reference/level_api_syntax.tex	2009-09-20 14:15:03 UTC (rev 1813)
+++ trunk/doc/reference/level_api_syntax.tex	2009-09-20 18:53:16 UTC (rev 1814)
@@ -0,0 +1,511 @@
+\documentclass[10pt,landscape]{article}
+\usepackage{multicol}
+\usepackage{calc}
+\usepackage{ifthen}
+\usepackage[landscape]{geometry}
+
+\geometry{top=1cm,left=1cm,right=1cm,bottom=1cm}
+\pagestyle{empty}
+
+% Redefine section commands to use less space
+\makeatletter
+\renewcommand{\section}{\@startsection{section}{1}{0mm}%
+                                {-1ex plus -.5ex minus -.2ex}%
+                                {0.5ex plus .2ex}%
+                                {\normalfont\large\bfseries}}
+\renewcommand{\subsection}{\@startsection{subsection}{2}{0mm}%
+                                {-1explus -.5ex minus -.2ex}%
+                                {0.5ex plus .2ex}%
+                                {\normalfont\normalsize\bfseries}}
+\renewcommand{\subsubsection}{\@startsection{subsubsection}{3}{0mm}%
+                                {-1ex plus -.5ex minus -.2ex}%
+                                {1ex plus .2ex}%
+                                {\normalfont\small\bfseries}}
+\makeatother
+
+\begin{document}
+
+\raggedright
+\footnotesize
+\begin{multicols}{3}
+\setlength{\premulticols}{1pt}
+\setlength{\postmulticols}{1pt}
+\setlength{\multicolsep}{1pt}
+\setlength{\columnsep}{2pt}
+
+\begin{center}
+\Large{\textbf{Enigma Level API II}} \\
+\large{\textbf{Syntax Sheet}}
+\end{center}
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt}
+\end{center}
+
+On syntax descriptions of datatype operators or methods we need to list allowed argument types.
+Often several types are possible and you are allowed to choose any of a list. In these cases we
+enlist the types enclosed by \verb!<! and \verb!>! and separated by \verb!|!. These
+characters are not part of the operator or method itself and should thus not be typed into
+the level code. Note that we keep square braces \verb![!, \verb!]! and curly braces \verb!{!, \verb!}!
+as literal Lua symbols. When these braces appear in the syntax you need to type them in the code.
+
+\section*{Types}
+
+\begin{description}
+  \item[position]A position within the world that can be described by an x and y coordinate.
+  \item[positions]The singleton type of the repository of all named positions.
+  \item[object]An Enigma object like a stone, item, floor, other. Any object is a position, too.
+  \item[group]A list of objects.
+  \item[namedobjects]The singleton type of the repository of all named objects.
+  \item[default]The singleton type of default values that can be used instead of Lua?s ?nil? in anonymous table tile definitions.
+  \item[tile]A description of one or several objects for a common grid position (floor, item, stone, actor)
+  \item[tiles]The singleton type of the repository of all tile instances.
+  \item[world]The singleton type of the world that contains all objects.
+  \item[position list]A list of positions.
+\end{description}
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt}
+\end{center}
+
+
+\section*{Position}
+
+\subsection*{Addition/Subtraction}
+\begin{verbatim}
+result = pos <+|-> <pos | obj | cpos | polist>
+result = <pos | obj | cpos | polist> <+|-> pos
+\end{verbatim}
+
+\subsection*{Multiplication/Division}
+\begin{verbatim}
+result = pos <*|/> number
+result = number * pos
+\end{verbatim}
+
+\subsection*{Sign}
+\begin{verbatim}
+result = -pos
+\end{verbatim}
+
+\subsection*{Center}
+\begin{verbatim}
+result = #pos
+\end{verbatim}
+
+\subsection*{Comparison}
+\begin{verbatim}
+result = pos1 <==|~=> pos2
+\end{verbatim}
+
+\subsection*{Concatenation}
+\begin{verbatim}
+result = pos1 .. <pos2 | polist>
+result = <pos1 | polist> .. pos2
+\end{verbatim}
+
+\subsection*{Coordinate Access}
+\begin{verbatim}
+result = pos["x"]
+result = pos["y"]
+result1, result2 = pos:xy()
+\end{verbatim}
+
+\subsection*{Grid Rounding}
+\begin{verbatim}
+result = pos:grid()
+\end{verbatim}
+
+\subsection*{Existence}
+\begin{verbatim}
+result = pos:exists()
+\end{verbatim}
+
+
+
+\section*{Object}
+
+\subsection*{Attribute Access}
+\begin{verbatim}
+result = obj["attributename"]
+obj["attributename"] = value
+obj:set({attributename1=value1,
+         attributename2=value2, ...})
+\end{verbatim}
+
+\subsection*{Messaging}
+\begin{verbatim}
+result = obj:message("msg", value)
+result = obj:msg(value)
+\end{verbatim}
+
+\subsection*{Comparison}
+\begin{verbatim}
+result = obj1 <==|~=> obj2
+\end{verbatim}
+
+\subsection*{Existence}
+\begin{verbatim}
+result = -obj
+result = obj:exists()
+\end{verbatim}
+
+\subsection*{Kill}
+\begin{verbatim}
+obj:kill()
+\end{verbatim}
+
+\subsection*{Kind Checks}
+\begin{verbatim}
+result = obj:is("kind")
+result = obj:kind()
+\end{verbatim}
+
+\subsection*{Coordinate Access}
+\begin{verbatim}
+result = obj["x"]
+result = obj["y"]
+result1, result2 = obj:xy()
+\end{verbatim}
+
+\subsection*{Addition/Subtraction}
+\begin{verbatim}
+result = obj <+|-> <pos | obj | cpos | polist>
+result = <pos | obj | cpos | polist> <+|-> obj
+\end{verbatim}
+
+\subsection*{Center}
+\begin{verbatim}
+result = #obj
+\end{verbatim}
+
+\subsection*{Join}
+\begin{verbatim}
+result = obj + group
+result = group + obj
+\end{verbatim}
+
+\subsection*{Intersection}
+\begin{verbatim}
+result = obj * group
+result = group * obj
+\end{verbatim}
+
+\subsection*{Difference}
+\begin{verbatim}
+result = obj - group
+result = group - obj
+\end{verbatim}
+
+\subsection*{Sound}
+\begin{verbatim}
+result = obj:sound("name", volume)
+\end{verbatim}
+
+
+
+\section*{Group}
+
+\subsection*{Messaging}
+\begin{verbatim}
+result = group:message("msg", value)
+result = group:msg(value)
+\end{verbatim}
+
+\subsection*{Attribute Write}
+\begin{verbatim}
+group["attributename"] = value
+group:set({attributename1=value1,
+           attributename2=value2, ...})
+\end{verbatim}
+
+\subsection*{Comparison}
+\begin{verbatim}
+result = group1 <==|~=> group2
+\end{verbatim}
+
+\subsection*{Length/Size}
+\begin{verbatim}
+result = #group
+\end{verbatim}
+
+\subsection*{Member Access}
+\begin{verbatim}
+result = group[index]
+result = group[obj]
+\end{verbatim}
+
+\subsection*{Loop}
+\begin{verbatim}
+for obj in group do ... end
+\end{verbatim}
+
+\subsection*{Join}
+\begin{verbatim}
+result = group + <obj | group>
+result = <obj | group> + group
+\end{verbatim}
+
+\subsection*{Intersection}
+\begin{verbatim}
+result = <obj | group> * group
+result = group * <obj | group>
+\end{verbatim}
+
+\subsection*{Difference}
+\begin{verbatim}
+result = <obj | group> - group
+result = group - <obj | group>
+\end{verbatim}
+
+\subsection*{Shuffle}
+\begin{verbatim}
+result = group:shuffle()
+\end{verbatim}
+
+\subsection*{Sorting}
+\begin{verbatim}
+result = group:sort("circular")
+result = group:sort("linear" <, direction>)
+result = group:sort()
+\end{verbatim}
+
+\subsection*{Subset}
+\begin{verbatim}
+result = group:sub(number)
+result = group:sub(start, end)
+result = group:sub(start, -number)
+\end{verbatim}
+
+\subsection*{Nearest Object}
+\begin{verbatim}
+result = group:nearest(obj)
+\end{verbatim}
+
+
+
+\section*{NamedObjects}
+
+\subsection*{Repository Request}
+\begin{verbatim}
+result = no["name"]
+\end{verbatim}
+
+\subsection*{Object Naming}
+\begin{verbatim}
+no["name"] = obj
+\end{verbatim}
+
+
+
+\section*{PositionList}
+
+\subsection*{Comparison}
+\begin{verbatim}
+result = polist1 <==|~=> polist2
+\end{verbatim}
+
+\subsection*{Length}
+\begin{verbatim}
+result = #polist
+\end{verbatim}
+
+\subsection*{Member Access}
+\begin{verbatim}
+result = group[index]
+\end{verbatim}
+
+\subsection*{Concatenation}
+\begin{verbatim}
+result = polist1 .. <pos | polist2>
+result = <pos | polist1> .. polist2
+\end{verbatim}
+
+\subsection*{Translation}
+\begin{verbatim}
+result = polist <+|-> <pos | obj | cpos>
+result = <pos | obj | cpos> <+|-> polist
+\end{verbatim}
+
+\subsection*{Stretching}
+\begin{verbatim}
+result = polist * number
+result = number * polist
+\end{verbatim}
+
+
+
+\section*{Positions Repository}
+
+\subsection*{Repository Request}
+\begin{verbatim}
+result = po["name"]
+\end{verbatim}
+
+\subsection*{Repository Storage}
+\begin{verbatim}
+po["name"] = obj
+\end{verbatim}
+
+\subsection*{Position Convertion}
+\begin{verbatim}
+result = po(<obj | pos | {x, y} | x,y>)
+\end{verbatim}
+
+\subsection*{PositionList Convertion}
+\begin{verbatim}
+result = po(group | {pos1, pos2, pos3 })
+\end{verbatim}
+
+
+
+\section*{Tile and Object Declaration}
+
+\subsection*{Tile concat}
+\begin{verbatim}
+result = tile .. <tile | odecl>
+result = <tile | odecl> .. tile
+\end{verbatim}
+
+
+
+\section*{Tiles Repository}
+
+\subsection*{ Tiles Storage}
+\begin{verbatim}
+ti["key"] = <tile | odecl>
+\end{verbatim}
+
+\subsection*{Tiles Request}
+\begin{verbatim}
+result = ti["key"]
+\end{verbatim}
+
+\subsection*{ Tile Convertion}
+\begin{verbatim}
+result = ti(odecl)
+\end{verbatim}
+
+
+
+\section*{World}
+
+\subsection*{World Creation}
+\begin{verbatim}
+width, height = wo(topresolver, defaultkey, map)
+width, height = wo(topresolver, libmap)
+width, height = wo(topresolver, defaultkey, width, height)
+\end{verbatim}
+
+\subsection*{World Tile Set}
+\begin{verbatim}
+wo[<object | position | table |
+    group | polist>] = tile_declarations
+\end{verbatim}
+
+\subsection*{Global Attribute Set}
+\begin{verbatim}
+wo["attritbutename"] = value
+\end{verbatim}
+
+\subsection*{Global Attribute Get}
+\begin{verbatim}
+var = wo["attritbutename"]
+\end{verbatim}
+
+\subsection*{add}
+\begin{verbatim}
+wo:add(tile_declarations)
+wo:add(target, tile_declarations)
+\end{verbatim}
+
+\subsection*{drawBorder}
+\begin{verbatim}
+wo:drawBorder(upperleft_edge, lowerright_edge,
+              <tile | key, resolver>)
+wo:drawBorder(upperleft_edge, width, height,
+              <tile | key, resolver>)
+\end{verbatim}
+
+\subsection*{drawMap}
+\begin{verbatim}
+wo:drawMap(resolver, anchor, ignore, map, [readdir])
+wo:drawMap(resolver, anchor, libmap_map, [readdir])
+\end{verbatim}
+
+\subsection*{drawRect}
+\begin{verbatim}
+wo:drawRect(upperleft_edge, lowerright_edge,
+            <tile | key, resolver>)
+wo:drawRect(upperleft_edge, width, height,
+            <tile | key, resolver>)
+\end{verbatim}
+
+\subsection*{world floor}
+\begin{verbatim}
+result = wo:fl(<pos | {x, y} | x,y | obj | group | polist>)
+\end{verbatim}
+
+\subsection*{world item}
+\begin{verbatim}
+result = wo:it(<pos | {x, y} | x,y | obj | group | polist>)
+\end{verbatim}
+
+\subsection*{shuffleOxyd}
+\begin{verbatim}
+wo:shuffleOxyd(rules)
+\end{verbatim}
+
+\subsection*{world stone}
+\begin{verbatim}
+result = wo:st(<pos| {x, y} | x,y | obj | group | polist>)
+\end{verbatim}
+
+
+
+\section*{Functions}
+
+\subsection*{cond}
+\begin{verbatim}
+cond(condition, iftrue, iffalse)
+\end{verbatim}
+
+\subsection*{fl}
+\begin{verbatim}
+result = fl(<pos | {x, y} | x,y | obj | group | polist>)
+\end{verbatim}
+
+\subsection*{grp}
+\begin{verbatim}
+grp(<{obj1,obj2, ...} | obj1,obj2, ... | group>)
+\end{verbatim}
+
+\subsection*{it}
+\begin{verbatim}
+result = it(<pos | {x, y} | x,y | obj | group | polist>)
+\end{verbatim}
+
+\subsection*{ORI2DIR}
+\begin{verbatim}
+result = ORI2DIR[orientation]
+\end{verbatim}
+
+\subsection*{random}
+\begin{verbatim}
+result = random(<| n | l,u>)
+\end{verbatim}
+
+\subsection*{st}
+\begin{verbatim}
+result = st(<pos | {x, y} | x,y | obj | group | polist>)
+\end{verbatim}
+
+
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt} \\
+Compiled from Enigma 1.10 reference manual by Raoul
+\end{center}
+
+\end{multicols}
+\end{document}

Added: trunk/doc/reference/level_api_syntax_examples.tex
===================================================================
--- trunk/doc/reference/level_api_syntax_examples.tex	2009-09-20 14:15:03 UTC (rev 1813)
+++ trunk/doc/reference/level_api_syntax_examples.tex	2009-09-20 18:53:16 UTC (rev 1814)
@@ -0,0 +1,1170 @@
+\documentclass[a4paper,10pt]{article}
+\usepackage[utf8]{inputenc}
+\usepackage[landscape]{geometry}
+
+\geometry{top=1cm,left=1cm,right=1cm,bottom=1cm}
+\pagestyle{empty}
+
+\setlength{\parindent}{0pt}
+\setlength{\parskip}{0pt plus 0.5ex}
+
+% Redefine section commands to use less space
+\makeatletter
+\renewcommand{\section}{\@startsection{section}{1}{0mm}%
+                                {-1ex plus -.5ex minus -.2ex}%
+                                {0.5ex plus .2ex}%
+                                {\normalfont\large\bfseries}}
+\renewcommand{\subsection}{\@startsection{subsection}{2}{0mm}%
+                                {-1explus -.5ex minus -.2ex}%
+                                {0.5ex plus .2ex}%
+                                {\normalfont\normalsize\bfseries}}
+\renewcommand{\subsubsection}{\@startsection{subsubsection}{3}{0mm}%
+                                {-1ex plus -.5ex minus -.2ex}%
+                                {1ex plus .2ex}%
+                                {\normalfont\small\bfseries}}
+\makeatother
+
+\begin{document}
+
+\begin{center}
+\Large{\textbf{Enigma Level API II}} \\
+\large{\textbf{Syntax sheet with examples}} \\
+\small{Compiled from Enigma 1.10 reference manual by Raoul}
+\end{center}
+
+\begin{center}
+\rule{0.8\linewidth}{0.25pt}
+\end{center}
+
+\section*{Position}
+
+\subsection*{Position Addition and Subtraction}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = pos <+|-> <pos | obj | cpos | polist>
+result = <pos | obj | cpos | polist> <+|-> pos
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newpos = po(3, 4) + {1, 2}              -- = po(4, 6)
+newpos = myobject - po(1, 5)
+newpolist = po(2, 3) + NEIGHBORS_4      -- po(1, 3) .. po(2, 4) .. po(3, 3) .. po(2, 2)
+newpolist = po["myfloor#*"] - po(3, 0)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Position Multiplication and Division}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = pos <*|/> number
+result = number * pos
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newpos = 3 * po(3, 4)   -- = po(9, 12)
+newpos = po(2, 3) / 2   -- = po(1, 1.5)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Position Sign}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = -pos
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newpos = -po(3, 4)   -- = po(-3, -4)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Center}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = #pos
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newpos = #po(3, 4)   -- = po(3.5, 4.5)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Position Comparison}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = pos1 <==|~=> pos2
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+bool = po(3, 4) == po({3, 4})  -- = true
+bool = po(3, 4) == po(4, 3)    -- = false
+bool = po(3, 4) ~= po(4, 3)    -- = true
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Position Concatenation}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = pos1 .. <pos2 | polist>
+result = <pos1 | polist> .. pos2
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newpolist = po(3, 4) .. po(4, 4)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Position Coordinate Access}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = pos["x"]
+result = pos["y"]
+result1, result2 = pos:xy()
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+number = po(3, 4)["x"]            -- = 3
+number = po(3, 4).x               -- = 3
+number = po(3, 4)["y"]            -- = 4
+number = po(3, 4).y               -- = 4
+number1, number2 = po(3, 4):xy()  -- = 3, 4
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Position Grid Rounding}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = pos:grid()
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newpos = po(3.2, 4.7):grid()    -- = 3, 4
+newpos = po(-2.4, -5.0):grid()  -- = -3, -5
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Position Existence}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = pos:exists()
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+boolean = po(3.2, 4.7):exists()
+\end{verbatim}
+\end{minipage}
+
+\begin{center}
+\rule{0.8\linewidth}{0.25pt}
+\end{center}
+
+\section*{Object}
+
+\subsection*{Object Attribute Access}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = obj["attributename"]
+obj["attributename"] = value
+obj:set({attributename1=value1, attributename2=value2, ...})
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+value = obj["color"]
+value = obj.color
+obj["color"] = BLACK
+obj.color = BLACK
+obj:set({target=mydoor, action="open"})
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Object Messaging}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = obj:message("msg", value)
+result = obj:msg(value)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+value = obj:message("open")
+value = obj:open()
+value = obj:message("signal", 1)
+value = obj:signal(1)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Object Comparison}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = obj1 <==|~=> obj2
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+bool = obj1 == obj1  -- = true
+bool = obj1 == obj2  -- = false, if two different objects
+bool = obj1 ~= obj2  -- = true, if two different objects
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Object Existence}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = -obj
+result = obj:exists()
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+bool = -obj
+bool = obj:exists()
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Object Kill}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+obj:kill()
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+obj:kill()
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Object Kind Check}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = obj:is("kind")
+result = obj:kind()
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+bool = obj:is("st_chess")
+string = obj:kind()
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Object Coordinate Access}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = obj["x"]
+result = obj["y"]
+result1, result2 = obj:xy()
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+number = obj["x"]
+number = obj.x
+number = obj["y"]
+number = obj.y
+number1, number2 = obj:xy()
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Object Addition and Subtraction}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = obj <+|-> <pos | obj | cpos | polist>
+result = <pos | obj | cpos | polist> <+|-> obj
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newpos = obj + {1, 2}
+newpos = myobject - obj
+newpolist = obj + NEIGHBORS_4
+newpolist = po["myfloor#*"] - obj
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Object Center}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = #obj
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newpos = #obj   -- e.g. po(3.5, 4.5)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Object Join}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = obj + group
+result = group + obj
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newgroup = obj1 + grp(obj2, obj3, obj1)   -- = grp(obj1, obj2, obj3)
+newgroup = grp(obj2, obj3) + obj1         -- = grp(obj2, obj3, obj1)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Object Intersection}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = obj * group
+result = group * obj
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newgroup = obj1 * grp(obj1, obj2)  -- = grp(obj1)
+newgroup = grp(obj2) * obj1         -- = grp()
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Object Difference}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = obj - group
+result = group - obj
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newgroup = obj1 - grp(obj2, obj1)  -- = grp()
+newgroup = grp(obj1, obj2) - obj1  -- = grp(obj2)
+\end{verbatim}
+\end{minipage}
+
+% too rarely used, see refman for details
+% \subsection*{Object Sound}
+% \begin{minipage}[t]{0.5\textwidth}
+% \begin{verbatim}
+% result = obj:sound("name", volume)
+% \end{verbatim}
+% \end{minipage}
+% \noindent
+% \begin{minipage}[t]{0.5\textwidth}
+% \begin{verbatim}
+% obj:sound("quake")
+% obj:sound("quake", 2)
+% \end{verbatim}
+% \end{minipage}
+
+\begin{center}
+\rule{0.8\linewidth}{0.25pt}
+\end{center}
+
+\section*{Group}
+
+\subsection*{Group Messaging}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = group:message("msg", value)
+result = group:msg(value)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+value = group:message("open")
+value = group:open()
+value = group:message("signal", 1)
+value = group:signal(1)
+value = group:kill()
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Group Attribute Write}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+group["attributename"] = value
+group:set({attributename1=value1, attributename2=value2, ...})
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+group["color"] = BLACK
+group.color = BLACK
+group:set({target=mydoor, action="open"})
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Group Comparison}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = group1 <==|~=> group2
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+bool = grp(obj1, obj2) == grp(obj2, obj1)  -- = true
+bool = grp(obj1, obj2) == grp(obj1, obj3)  -- = false, if different object contents
+bool = grp(obj1) ~= grp(obj2, obj1)        -- = true, if different object contents
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Group Length}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = #group
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+number = #grp(obj1, obj2)         -- = 2
+for i = 1, #group do obj = group[i] ... end
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Group Member Access}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = group[index]
+result = group[obj]
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+object = grp(obj1, obj2)[2]     -- = obj2
+object = grp(obj1, obj2)[-1]    -- = obj2
+object = grp(obj1, obj2)[0]     -- = NULL object
+for i = 1, #group do obj = group[i] ... end
+number = grp(obj1, obj2)[obj2]  -- = 2
+number = grp(obj1, obj2)[obj3]  -- = nil
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Group Loop}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+for obj in group do ... end
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+for obj in group do obj:toggle() end
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Group Join}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = group + <obj | group>
+result = <obj | group> + group
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newgroup = obj1 + grp(obj2, obj3, obj1)   -- = grp(obj1, obj2, obj3)
+newgroup = grp(obj2, obj3) + grp(obj1, obj3)   -- = grp(obj2, obj3, obj1)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Group Intersection}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = <obj | group> * group
+result = group * <obj | group>
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newgroup = obj1 * grp(obj2, obj1)  -- = grp(obj1)
+newgroup = grp(obj1, obj2) * grp(obj2, obj1, obj3)  -- = grp(obj1, obj2)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Group Difference}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = <obj | group> - group
+result = group - <obj | group>
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newgroup = obj1 - grp(obj2, obj1)  -- = grp()
+newgroup = grp(obj1, obj2, obj3) - grp(obj2, obj4)  -- = grp(obj1, obj3)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Group Shuffle}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = group:shuffle()
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newgroup = grp(obj1, obj2)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Group Sorting}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = group:sort("circular")
+result = group:sort("linear" <, direction>)
+result = group:sort()
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newgroup = grp(obj1, obj2, obj3):sort("linear", po(2,1))
+newgroup = grp(obj1, obj2, obj3):sort("circular")
+newgroup = grp(obj1, obj2, obj3):sort()
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Group Subset}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = group:sub(number)
+result = group:sub(start, end)
+result = group:sub(start, -number)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newgroup = grp(obj1, obj2, obj3, obj4):sub(2)     -- = grp(obj1, obj2)
+newgroup = grp(obj1, obj2, obj3, obj4):sub(-2)    -- = grp(obj3, obj4)
+newgroup = grp(obj1, obj2, obj3, obj4):sub(2, 4)  -- = grp(obj2, obj3, obj4)
+newgroup = grp(obj1, obj2, obj3, obj4):sub(2, -2) -- = grp(obj2, obj3)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Group Nearest Object}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = group:nearest(obj)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newobject = grp(obj1, obj2, obj3):nearest(obj4)
+\end{verbatim}
+\end{minipage}
+
+\begin{center}
+\rule{0.8\linewidth}{0.25pt}
+\end{center}
+
+\section*{NamedObjects}
+
+\subsection*{NamedObjects Repository Request}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = no["name"]
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+obj = no["mydoor"]       -- exact name match
+group = no["mydoors#*"]  -- any suffix
+group = no["mydoor?"]    -- just one char suffix
+group = no["mydoors?#*"] -- matches e.g. "mydoorsA#123435", "mydoorsB#1213"
+\end{verbatim}
+\end{minipage}
+
+\subsection*{NamedObjects Object Naming}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+no["name"] = obj
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+no["myobject"] = obj
+\end{verbatim}
+\end{minipage}
+
+\begin{center}
+\rule{0.8\linewidth}{0.25pt}
+\end{center}
+
+\section*{PositionList}
+
+\subsection*{PositionList Comparison}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = polist1 <==|~=> polist2
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+bool = (po(2,3).. po(5,7)) == (po(2,3) .. po(5,7))  -- = true
+bool = (po(2,3).. po(5,7)) == (po(4,0) .. po(5,7))  -- = false, different positions
+bool = (po(2,3).. po(5,7)) == (po(5,7) .. po(2,3))  -- = false, different sequence
+\end{verbatim}
+\end{minipage}
+
+\subsection*{PositionList Length}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = #polist
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+number = #(po(2,3) .. po(5,7)) -- = 2
+for i = 1, #polist do pos = polist[i] ... end
+\end{verbatim}
+\end{minipage}
+
+\subsection*{PositionList Member Access}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = group[index]
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+pos = (po(2,3) .. po(5,7))[2]     -- = po(5,7)
+pos = (po(2,3) .. po(5,7))[-1]    -- = po(5,7)
+pos = (po(2,3) .. po(5,7))[0]     -- = nil
+for i = 1, #polist do pos = polist[i] ... end
+\end{verbatim}
+\end{minipage}
+
+\subsection*{PositionList Concatenation}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = polist1 .. <pos | polist2>
+result = <pos | polist1> .. polist2
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newpolist = po(po(2,3), po(5,7)) .. po(4, 4) -- = (2,3),(5,7),(4,4)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{PositionList Translation}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = polist <+|-> <pos | obj | cpos>
+result = <pos | obj | cpos> <+|-> polist
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newpolist = po(2, 3) + NEIGHBORS_4      -- po(1, 3) .. po(2, 4) .. po(3, 3) .. po(2, 2)
+newpolist = po["myfloor#*"] - po(3, 0)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{PositionList Stretching}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = polist * number
+result = number * polist
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newpolist = 2 * NEIGHBORS_4              -- = po(9, 12)
+newpolist = (po(2,4) .. po(6,7)) * 1/2   -- = (1, 2), (3, 3.5)
+\end{verbatim}
+\end{minipage}
+
+\begin{center}
+\rule{0.8\linewidth}{0.25pt}
+\end{center}
+
+\section*{Positions Repository}
+
+\subsection*{Positions Repository Request}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = po["name"]
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+pos = po["mydoor"]        -- exact name match
+polist = po["mydoors#*"]  -- any suffix
+polist = po["mydoor?"]    -- just one char suffix
+polist = po["mydoors?#*"] -- matches e.g. "mydoorsA#123435", "mydoorsB#1213"
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Positions Repository Storage}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+po["name"] = obj
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+po["mypos"] = pos
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Position Convertion}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = po(<obj | pos | {x,y} | x,y>)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+pos = po(pos2)
+pos = po(obj)
+pos = po({2, 4})
+pos = po(3, 7)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{PositionList Convertion}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = po(group | {pos1, pos2, pos3})
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+polist = po(group)
+polist = po({po(3, 7), po(2, 6)})
+\end{verbatim}
+\end{minipage}
+
+\begin{center}
+\rule{0.8\linewidth}{0.25pt}
+\end{center}
+
+\section*{Tile and Object Declaration}
+
+\subsection*{Tile concat}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = tile .. <tile | odecl>
+result = <tile | odecl> .. tile
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newtile = ti{st_chess"} .. {"fl_sahara"}
+newtile = ti{st_chess"} .. {"fl_sahara"} .. {"it_cherry"}   -- Lua error due to right to left evaluation
+newtile = (ti{st_chess"} .. {"fl_sahara"}) .. {"it_cherry"} -- evaluation order fixed
+newtile = ti{st_chess"} .. {"fl_sahara"} .. ti{"it_cherry"} -- converted one of the two critical declarations
+\end{verbatim}
+\end{minipage}
+
+\begin{center}
+\rule{0.8\linewidth}{0.25pt}
+\end{center}
+
+\section*{Tiles Repository}
+
+\subsection*{Tiles Storage}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+ti["key"] = <tile | odecl>
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+ti["#"] = tile
+ti["$"] = {st_chess"}
+ti["$"] = {st_switch"}   -- error of key reassignment
+ti["anykey"] = {st_chess"}
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Tiles Request}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = ti["key"]
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+tile = ti["#"]
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Tile Convertion}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = ti(odecl)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+tile = ti({"st_chess"})
+\end{verbatim}
+\end{minipage}
+
+\begin{center}
+\rule{0.8\linewidth}{0.25pt}
+\end{center}
+
+\section*{World}
+
+\subsection*{World Creation}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+width, height = wo(topresolver, defaultkey, map)
+width, height = wo(topresolver, libmap)
+width, height = wo(topresolver, defaultkey, width, height)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+w, h = wo(ti, "  ", 20, 13)
+w, h = wo(resolver, " ", {
+       "                    ",
+       ...
+       "                    "})
+w, h = wo(ti, mylibmap)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{add}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo:add(tile_declarations)
+wo:add(target, tile_declarations)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo:add({"ot_rubberband", anchor1="a1", anchor2="w", length=2, strength=80, threshold=0})
+wo:add(ti["r"] .. {"ot_wire", anchor1="w1", anchor2="w2"})
+wo:add(YIN, {"it_magicwand})
+wo:add(no["mybag"], {"it_magicwand} .. ti["h"] .. ti["c"])
+\end{verbatim}
+\end{minipage}
+
+\subsection*{World Tile Set}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo[<object | position | table | group | polist>] = tile_declarations
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo[no["myobjectname"]] = {"st_chess"}
+wo[po(3, 4)] = ti["x"]
+wo[{2, 5}] = ti["x"] .. ti["y"]
+wo[no["floorgroup#*"]] = {"it_burnable_oil"}
+wo[no["myobjectname"] + NEIGHBORS_4] = ti["x"]
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Global Attribute Set}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo["attritbutename"] = value
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo["ConserveLevel"] = true
+\end{verbatim}
+\end{minipage}
+
+\subsection*{Global Attribute Get}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+var = wo["attritbutename"]
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+var = wo["IsDifficult"]
+\end{verbatim}
+\end{minipage}
+
+\subsection*{drawBorder}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo:drawBorder(upperleft_edge, lowerright_edge, <tile | key, resolver>)
+wo:drawBorder(upperleft_edge, width, height, <tile | key, resolver>)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo:drawBorder(po(0, 0), wo["Width"], wo["Height"], ti["#"])
+wo:drawBorder(no["myRectUL"], no["myRectLR"], {"st_grate1"})
+wo:drawBorder(no["myRectUL"], no["myRectLR"], {"fl_water"} .. ti["X"])
+wo:drawBorder(no["myRectUL"], no["myRectLR"], "x", myresolver)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{drawMap}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo:drawMap(resolver, anchor, ignore, map, [readdir])
+wo:drawMap(resolver, anchor, libmap-map, [readdir])
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo:drawMap(ti, po(5, 7), "-", {"abcabc"})
+wo:drawMap(ti, anchor_object, "--", {"--##--##","##--##"})
+wo:drawMap(ti, {12, 5}, " ", {"122  221"}, MAP_ROT_CW)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{drawRect}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo:drawRect(upperleft_edge, lowerright_edge, <tile | key, resolver>)
+wo:drawRect(upperleft_edge, width, height, <tile | key, resolver>)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo:drawRect(po(0, 0), wo["Width"], wo["Height"], ti[" "])
+wo:drawRect(no["myRectUL"], no["myRectLR"], {"fl_water"})
+wo:drawRect(no["myRectUL"], no["myRectLR"], {"fl_water"} .. ti["#"])
+wo:drawRect(no["myRectUL"], no["myRectLR"], "x", myresolver)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{world floor}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = wo:fl(<pos| {x,y} | x,y | obj | group | polist>)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+use fl(...) instead
+\end{verbatim}
+\end{minipage}
+
+\subsection*{world item}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = wo:it(<pos | {x,y} | x,y | obj | group | polist>)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+use it(...) instead
+\end{verbatim}
+\end{minipage}
+
+\subsection*{shuffleOxyd}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo:shuffleOxyd(rules)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+wo:shuffleOxyd()
+wo:shuffleOxyd({no["borderoxyds#*"]:sort("circular"), circular=true})
+wo:shuffleOxyd({"leftoxyds#*","rightoxyds#*", min=3}, {"islandoxyds#*", max=0})
+\end{verbatim}
+\end{minipage}
+
+\subsection*{world stone}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = wo:st(<pos | {x,y} | x,y | obj | group | polist>)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+use st(...) instead
+\end{verbatim}
+\end{minipage}
+
+\begin{center}
+\rule{0.8\linewidth}{0.25pt}
+\end{center}
+
+\section*{Functions}
+
+\subsection*{cond}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+cond(condition, iftrue, iffalse)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+ti["x"] = cond(wo["IsDifficult"], {"st_death"}, ti["#"])
+ti["D"] = cond(wo["IsDifficult"], {"st_death"}, {"nil"})
+\end{verbatim}
+\end{minipage}
+
+\subsection*{fl}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = fl(<pos | {x,y} | x,y | obj | group| polist>)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+floor = fl(po(3, 5))
+floor = fl({3, 5})
+floor = fl(3, 5)
+floor = fl(mystone)
+group = fl(no["door#*"])
+group = fl(po(3, 5)..po(4, 2))
+\end{verbatim}
+\end{minipage}
+
+\subsection*{grp}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+grp(<{obj1,obj2,...} | obj1,obj2,... | group>)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+newgroup = grp(obj1, obj2, obj3)
+newgroup = grp({obj1,obj2})
+newgroup = grp{}            -- empty group
+newgroup = grp(group)       -- a copy of group cleaned of invalid ?NULL? objects
+\end{verbatim}
+\end{minipage}
+
+\subsection*{it}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = it(<pos | {x,y} | x,y | obj | group | polist>)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+item = it(po(3, 5))
+item = it({3, 5})
+item = it(3, 5)
+item = it(mystone)
+group = it(no["door#*"])
+group = it(po(3, 5)..po(4, 2))
+\end{verbatim}
+\end{minipage}
+
+\subsection*{ORI2DIR}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = ORI2DIR[orientation]
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+direction = ORI2DIR[NORTH]      -- N  = po(0, -1)
+direction = ORI2DIR[SOUTHEAST]  -- SE = po(1,  1)
+direction = ORI2DIR[NODIR]      --      po(0,  0)
+\end{verbatim}
+\end{minipage}
+
+\subsection*{random}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = random(< | n | l,u>)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+float = random()          -- e.g. 0.402834
+integer = random(20)      -- e.g. 13
+integer = random(5, 10)   -- e.g. 5
+\end{verbatim}
+\end{minipage}
+
+\subsection*{st}
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+result = st(<pos | {x,y} | x,y | obj | group | polist>)
+\end{verbatim}
+\end{minipage}
+\noindent
+\begin{minipage}[t]{0.5\textwidth}
+\begin{verbatim}
+stone = st(po(3, 5))
+stone = st({3, 5})
+stone = st(3, 5)
+stone = st(myfloor)
+group = st(no["cherry#*"])
+group = st(po(3, 5)..po(4, 2))
+\end{verbatim}
+\end{minipage}
+
+\begin{center}
+\rule{0.8\linewidth}{0.25pt}
+\end{center}
+
+\end{document}

Added: trunk/doc/reference/level_api_tds.tex
===================================================================
--- trunk/doc/reference/level_api_tds.tex	2009-09-20 14:15:03 UTC (rev 1813)
+++ trunk/doc/reference/level_api_tds.tex	2009-09-20 18:53:16 UTC (rev 1814)
@@ -0,0 +1,438 @@
+\documentclass[10pt,landscape]{article}
+\usepackage{multicol}
+\usepackage{calc}
+\usepackage{ifthen}
+\usepackage[landscape]{geometry}
+
+\geometry{top=1cm,left=1cm,right=1cm,bottom=1cm}
+\pagestyle{empty}
+
+\setlength{\parindent}{0pt}
+\setlength{\parskip}{0pt plus 0.5ex}
+
+% Redefine section commands to use less space
+\makeatletter
+\renewcommand{\section}{\@startsection{section}{1}{0mm}%
+                                {-1ex plus -.5ex minus -.2ex}%
+                                {0.5ex plus .2ex}%
+                                {\normalfont\large\bfseries}}
+\renewcommand{\subsection}{\@startsection{subsection}{2}{0mm}%
+                                {-1explus -.5ex minus -.2ex}%
+                                {0.5ex plus .2ex}%
+                                {\normalfont\normalsize\bfseries}}
+\renewcommand{\subsubsection}{\@startsection{subsubsection}{3}{0mm}%
+                                {-1ex plus -.5ex minus -.2ex}%
+                                {1ex plus .2ex}%
+                                {\normalfont\small\bfseries}}
+\makeatother
+
+\begin{document}
+
+\raggedright
+\footnotesize
+\begin{multicols}{2}
+
+% multicol parameters
+% These lengths are set only within the two main columns
+%\setlength{\columnseprule}{0.25pt}
+\setlength{\premulticols}{1pt}
+\setlength{\postmulticols}{1pt}
+\setlength{\multicolsep}{1pt}
+\setlength{\columnsep}{2pt}
+
+\begin{center}
+\Large{\textbf{Enigma Level API II}} \\
+\large{\textbf{task driven approach}} \\
+\end{center}
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt}
+\end{center}
+
+\section*{Position Tasks}
+
+\subsection*{Creating Positions}
+\begin{tabular}{@{}ll@{}}
+\verb!pos = po(7, 3)!      & "po()" to generate a position \\
+\verb!pos = po({7, 3})!    & using a table as argument \\
+\verb!pos = obj!           & every object is a valid position \\
+\verb!pos = po(12.3, 3.7)! & a position within a grid (for an actor)
+\end{tabular}
+
+\subsection*{Position Constants}
+\begin{tabular}{@{}ll@{}}
+\verb!{7,3}! & valid position for all arguments and operations
+\end{tabular}
+
+\subsection*{Coordinate Access}
+\begin{tabular}{@{}ll@{}}
+\verb!x,y = pos.x, pos.y!           & member access \\
+\verb!x,y = pos["x"], pos["y"]!     & member access \\
+\verb!x,y = pos:xy()!               & \\
+\verb!x,y = obj.x, obj.y!           & works on objects too \\
+\verb!x,y = obj:xy()!               &
+\end{tabular}
+
+\subsection*{Position Calculation}
+\begin{tabular}{@{}ll@{}}
+\verb!pos = obj + {2,7}!         & adding offset \\
+\verb!dpos = obj1 - obj2!        & difference vector \\
+\verb!dpos2 = 2 * dpos!          & scalar multiplication \\
+\verb!dpos3 = dpos / 2!          & \\
+\verb!dpos3 = (obj1 - obj2) / 2! & middle between objects
+\end{tabular}
+
+\subsection*{Center positions for set actors}
+\begin{tabular}{@{}ll@{}}
+\verb!pos_centered1 = pos + {0.5, 0.5 }! & by offset \\
+\verb!pos_centered2 = #pos!              & by special feature \\
+\verb!pos_centered3 = #obj!              &
+\end{tabular}
+
+\subsection*{Round a position to a grid}
+\begin{tabular}{@{}ll@{}}
+\verb!grid_pos = pos:grid()!                & to integer coordinates \\
+\verb!grid_pos = ((pos1 - pos2)/2):grid()!  &
+\end{tabular}
+
+\subsection*{Position comparison}
+\begin{tabular}{@{}ll@{}}
+\verb!pos_centered1 == pos_centered2! & Lua's equality operator \\
+\verb!pos_centered1 ~= pos_centered2! & Lua's inequality operator
+\end{tabular}
+
+\subsection*{Position existence}
+\begin{tabular}{@{}ll@{}}
+\verb!pos:exists()! &
+\end{tabular}
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt}
+\end{center}
+
+
+
+
+\section*{Attribute Tasks}
+
+\subsection*{Single Attribute Setting}
+\begin{tabular}{@{}ll@{}}
+\verb!obj["destination"] = po(7,3)!  & simple object attribute \\
+\verb!wo["Brittleness"] = 7.0!       & global world attribute \\
+\verb!obj["_myattribute"] = "what"!  & userattribute                % ??
+\end{tabular}
+
+\subsection*{Multiple Attribute Setting}
+\begin{tabular}{@{}ll@{}}
+\verb!obj:set({target=mydoor, action="open"})! & set multiple attributes
+\end{tabular}
+
+\subsection*{Requesting Attributes}
+\begin{tabular}{@{}ll@{}}
+\verb!value = obj["attr_name"]!             & get the value \\
+\verb!value = obj.attr_name!                & \\
+\verb!value = wo["Brittleness"]!            & get the value of a global level constant \\
+\verb!if wo["IsDifficult"] then ... end!    & often used difficult-mode switch
+\end{tabular}
+
+\subsection*{Reset Attributes}
+\begin{tabular}{@{}ll@{}}
+\verb!obj["length"] = nil!     & the default length, e.g. '1' \\
+\verb!obj["color"] = nil!      & delete color attribute - no color \\
+\verb!obj["length"] = DEFAULT! & the default length, e.g. '1'
+\end{tabular}
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt}
+\end{center}
+
+
+
+
+\section*{Object Tasks}
+
+\subsection*{Creating Objects}
+\begin{tabular}{@{}ll@{}}
+\verb!wo[pos] = {"st_chess", color=WHITE, name="Atrax"}! & on grid pos \\
+\verb!wo[#pos] = {"ac_bug"}!             & actor centered on grid pos \\
+\verb!wo[pos] = {"#ac_bug"}!             & actor centered on grid pos \\
+\verb!wo[pos] = {"ac_bug", 0.3, 0.7}!    & actor with offsets to pos \\
+\verb!wo[my_floor] = {"it_magicwand"}!   & set an wand on top of a given floor obj \\
+\verb!wo[pos] = ti["x"]!                 & tile based object definition
+\end{tabular}
+
+\subsection*{Object Naming}
+\begin{tabular}{@{}ll@{}}
+\verb!no["Atrax"] = obj!                            & \\
+\verb!wo[pos] = {"st_chess", name="Atrax"}!         & \\
+\verb!wo[pos] = {"st_chess", "Atrax", color=WHITE }!&
+\end{tabular}
+
+\subsection*{Object Autonaming}
+Each new object will have a unique name. \\
+\begin{tabular}{@{}ll@{}}
+\verb!wo[pos] = {"st_chess", name="Atrax#"}! & autonamed chesstones
+\end{tabular}
+
+\subsection*{Requesting Objects}
+\begin{tabular}{@{}ll@{}}
+\verb!obj = no["Atrax"]!        & named object retrieval from repository \\
+\verb!obj = fl(pos)!            & floor at pos \\
+\verb!obj = it(x,y)!            & item at pos \\
+\verb!obj = st(pos)!            & stone at pos \\
+\verb!obj = wo:it(pos)!         & item at pos \\
+\verb!my_item = it(my_floor)!   & get the item that is on top of the given floor
+\end{tabular}
+
+\subsection*{Killing Objects}
+\begin{tabular}{@{}ll@{}}
+\verb!wo[pos] = {"it_nil"}! & \\
+\verb!obj:kill()!           & be carefull with kill
+\end{tabular}
+
+\subsection*{Comparing Objects}
+\begin{tabular}{@{}ll@{}}
+\verb!obj1 == obj2! & \\
+\verb!obj1 ~= obj2! &
+\end{tabular}
+
+\subsection*{Existence of an object}
+\begin{tabular}{@{}ll@{}}
+\verb!obj:exists()!     & object exists? \\
+\verb!-obj!             & unary minus operator on object \\
+\verb!if -obj then ...! &
+\end{tabular}
+
+\subsection*{Messages}
+\begin{tabular}{@{}ll@{}}
+\verb!my_boulder:message("orientate", WEST)! & \\
+\verb!my_boulder:orientate(EAST)!            & \\
+\verb!my_door:open()!
+\end{tabular}
+
+\subsection*{Object Classification}
+\begin{tabular}{@{}ll@{}}
+\verb!obj:is("st_chess")!       & \\
+\verb!obj:is("st")!             & \\
+\verb!obj:is("st_chess_black")! &
+\end{tabular}
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt}
+\end{center}
+
+
+
+
+\section*{Group Tasks}
+
+\subsection*{Creating Groups}
+\begin{tabular}{@{}ll@{}}
+\verb!group = no["Atrax#*"]!            & a group of all matching objects, wildcards "*","?" allowed \\
+\verb!group = grp(obj1, obj2, obj3)!    & a group of several objects \\
+\verb!group = grp({obj1, obj2, obj3})!  & a group of objects set up in a table \\
+\verb!group = grp()!                    & an empty group
+\end{tabular}
+
+\subsection*{Group Usage}
+\begin{tabular}{@{}ll@{}}
+\verb!floor_group["friction"] = 3.2!    & set attribute on all floors in the grou \\
+\verb!door_group:message("open")!       & send message to all members \\
+\verb!door_group:open()!                & open all doors in the group \\
+\verb!stone_group:kill()!               & \\
+\verb!wo[floor_group] = {"it_coin_m"}!  & add some money on all floor positions
+\end{tabular}
+\begin{tabular}{@{}ll@{}}
+\verb!wo[pos] = {"st_switch", target=door_group, action="open"}! & multitargets \\
+\verb!wo[pos] = {"st_switch", target="door#*", action="close"}!  &
+\end{tabular}
+
+\subsection*{Group Operations}
+\begin{tabular}{@{}ll@{}}
+\verb!doors_lasers = doorgrp + lasergrp!     & join of two groups \\
+\verb!lasergrp     = doors_lasers - doorgrp! & difference of two groups \\
+\verb!common_doors = doorgrp1 * doorgrp2!    & intersection of two groups
+\end{tabular}
+
+\subsection*{Group Members}
+\begin{tabular}{@{}ll@{}}
+\verb!count = #mygroup!      & -- number of objects in the group \\
+\verb!obj   = mygroup[5]!    & -- 5th object of the group \\
+\verb!obj   = mygroup[-1]!   & -- last object of the group \\
+\verb!for i = 1, #mygroup do obj = mygroup[i] ... end! & \\
+\verb!for obj in mygroup do ... end! & \\
+\end{tabular}
+
+\subsection*{Shuffled Group}
+\begin{tabular}{@{}ll@{}}
+\verb!shuffled_group = sorted_group:shuffle()!  & \\
+\verb!shuffled_group = no["Atrax#*"]:shuffle()! &
+\end{tabular}
+
+\subsection*{Sorted Group}
+\begin{tabular}{@{}ll@{}}
+\verb!sorted_group = group:sort("linear", po(2, 1))! & \\
+\verb!sorted_group = group:sort("linear")! & \\
+\verb!sorted_group = group:sort("circular")! & \\
+\verb!sorted_group = group:sort()! &
+\end{tabular}
+
+\subsection*{Subset Group}
+\begin{tabular}{@{}ll@{}}
+\verb!sub_group = group:sub(2)!     & -- first two objects \\
+\verb!sub_group = group:sub(-2)!    & -- last two objects \\
+\verb!sub_group = group:sub(2, 4)!  & -- objects from 2 to 4 \\
+\verb!sub_group = group:sub(2, -2)! & -- two objects starting with 2
+\end{tabular}
+
+\subsection*{Nearest Object}
+\begin{tabular}{@{}ll@{}}
+\verb!object = group:nearest(reference)! &
+\end{tabular}
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt}
+\end{center}
+
+\section*{Tiles}
+
+\subsection*{Tiles}
+\begin{tabular}{@{}ll@{}}
+\verb!ti["_"] = {"fl_sahara"}!  & simple tile \\
+\verb!ti["__"] = {"fl_sahara"}! & two char tile \\
+\verb!ti[".."] = {"fl_sand"}!   & \\
+\verb!ti["##"] = {"st blocker"}! &
+\end{tabular}
+\begin{tabular}{@{}ll@{}}
+\verb!ti["switch_template"] = {"st_switch"}! & tiles can hav arbitrary names too \\
+\verb!ti[".."] = {"fl_abyss"}!               & redefinition causes error \\
+\verb!ti[".w"] = ti[".."] .. {"it_magicwand"}! & concatenation of several tiles possible \\
+\verb!ti[" w"] = {"fl_abyss"} .. ti({"it_magicwand"})! & \\
+\end{tabular}
+
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt}
+\end{center}
+
+\section*{Named Positions Tasks}
+\subsection*{Named Position Usage}
+\begin{tabular}{@{}ll@{}}
+\verb!obj["name"] = "anchor1"! & \\
+\verb!obj:kill()!              & \\
+\verb!pos = po["anchor1"]!     & position still available \\
+\verb!po["anchor2"] = pos!     &
+\end{tabular}
+
+\subsection*{Creating Position Lists}
+\begin{tabular}{@{}ll@{}}
+\verb!polist = po["deepwater#*"]! & positionlist with pos \\
+\verb!polist = po(grp)!           & of all group objects
+\end{tabular}
+
+\subsection*{Position List Usage}
+\begin{tabular}{@{}ll@{}}
+\verb!wo[polist] = ti["x"]! & \\
+\verb!grp = fl(polist)!     &
+\end{tabular}
+
+\subsection*{Position List Operations}
+\begin{tabular}{@{}ll@{}}
+\verb!wo[polist .. po["beach#*"]] = {"it_banana"}!
+\end{tabular}
+
+\subsection*{Position List Members}
+\begin{tabular}{@{}ll@{}}
+\verb!for i = 1, #pogrp do! & iterate over polist \\
+\verb!    wo[polist[i]] = {"it_cherry"}! \\
+\verb!end!
+\end{tabular}
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt}
+\end{center}
+
+\section*{Other}
+\subsection*{Nearest Object}
+\begin{tabular}{@{}ll@{}}
+\verb!ti["F"] = {"st_floppy", target="@door#*"}! & target is always the nearest door \\
+\verb!ti["B"] = {"st_blocker", name="door#"}!    & resolved at levelloadtime
+\end{tabular}
+\begin{tabular}{@{}ll@{}}
+\verb!ti["o"] = {"#ac_pearl_white", "s#", owner=DEFAULT}! & target is always the currently nearest actor \\
+\verb!ti["q"] = {"it_rubberband", anchor2="@@s#*"}!       & resolved at runtime when needed
+\end{tabular}
+
+\subsection*{Callbacks from switchlike objects}
+\verb!function my_callback(value, sender) ... end!
+Sender is the senderobject, value it's state.
+
+\subsection*{Checkerboard floor}
+\verb!ti["x"] = ti({"fl_rough_red", checkerboard=0}) .. {"fl_rough_blue", checkerboard=1}!
+
+
+\section*{World}
+\subsection*{World Initialization}
+\verb!width, height = wo(topresolver, defaultkey, map)!
+\verb!width, height = wo(topresolver, defaultkey, width, height)!
+
+\subsection*{World Advanced Methods}
+\verb!wo:add(tile_declarations)!
+\verb!wo:add(target, tile_declarations)!
+
+\verb!wo:drawBorder(upperleft_edge, lowerright_edge, tile)!
+\verb!wo:drawBorder(upperleft_edge, width, height, tile)!
+
+\verb!wo:drawMap(resolver, anchor, ignore, map, [readdir])!
+\verb!wo:drawMap(resolver, anchor, libmap-map, [readdir])!
+
+\verb!wo:drawRect(upperleft_edge, lowerright_edge, tile)!
+\verb!wo:drawRect(upperleft_edge, width, height, tile)!
+
+\verb!wo:shuffleOxyd(rules)! \\
+\verb!wo:shuffleOxyd()!
+\verb!wo:shuffleOxyd({no["borderoxyds#*"]:sort("circular"), circular=true})!
+\verb!wo:shuffleOxyd({"leftoxyds#*","rightoxyds#*", min=3, max=5})!
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt}
+\end{center}
+
+\section*{Resolvers}
+\subsection*{Autotiling}
+\verb!res.autotile(subresolver, rules)!
+\verb!res.autotile(ti, {"A", "template_switch"}, {"L", "template_laser})!
+\verb!res.autotile(ti, {"a", "e", "template_trigger}, {"A", "E", "template_door"})!
+
+\subsection*{Composer}
+\verb!res.composer(subresolver)!
+\verb!res.composer(subresolver, sequence)!
+\begin{tabular}{@{}ll@{}}
+\verb!res.composer(ti)!         & \\
+\verb!res.composer(ti, "211")!  & decompose the last two chars together
+\end{tabular}
+
+\subsection*{Puzzler}
+load the library before use:
+\verb!<el:dependency el:path="lib/libpuzzle"!
+\verb! el:id="lib/libpuzzle" el:release="3" el:preload="true"/>!
+\verb!res.puzzle(subresolver, rules)!
+\begin{tabular}{@{}ll@{}}
+\verb!res.puzzle(ti, "B", "Y", "I", "M")!  & Don't forget appr. tile declarations
+\end{tabular}
+
+\subsection*{Random}
+\verb!res.random(subresolver, hits, replacements)!
+\verb!res.random(ti, "x", {"a", "b"})!
+\verb!res.random(ti, {{"x", "y"},{"i","j"}}, {{"a", 2}, {"b", 1}})!
+
+\subsection*{Custom Resolver}
+\verb!tile = myresolver(key, x, y)!
+
+\begin{center}
+\rule{0.6\linewidth}{0.25pt} \\
+Compiled from Enigma 1.10 reference manual by Raoul
+\end{center}
+
+\end{multicols}
+\end{document}



From raoul at mail.berlios.de  Tue Sep 29 17:26:35 2009
From: raoul at mail.berlios.de (raoul at BerliOS)
Date: Tue, 29 Sep 2009 17:26:35 +0200
Subject: [Enigma-game-svn] r1815 - trunk/doc/reference
Message-ID: <200909291526.n8TFQZBo000445@sheep.berlios.de>

Author: raoul
Date: 2009-09-29 17:26:33 +0200 (Tue, 29 Sep 2009)
New Revision: 1815

Modified:
   trunk/doc/reference/Makefile.am
Log:
-> Completed make clean support w.r.t level api cheat sheets


Modified: trunk/doc/reference/Makefile.am
===================================================================
--- trunk/doc/reference/Makefile.am	2009-09-20 18:53:16 UTC (rev 1814)
+++ trunk/doc/reference/Makefile.am	2009-09-29 15:26:33 UTC (rev 1815)
@@ -9,8 +9,8 @@
 
 EXTRA_DIST = enigma-ref.texi enigma-t2h.init level_api_syntax.tex level_api_constants.tex level_api_syntax_examples.tex level_api_tds.tex $(ref_DATA)
 
-MOSTLYCLEANFILES = enigma-ref.{at,ats,aux,cp,cps,fn,fns,ky,log,ms,mss,ob,obs,pg,toc,tp,vr,vrs}
-CLEANFILES = enigma-ref.{pdf,html}
+MOSTLYCLEANFILES = enigma-ref.{at,ats,aux,cp,cps,fn,fns,ky,log,ms,mss,ob,obs,pg,toc,tp,vr,vrs} level_api_syntax.{aux,log} level_api_constants.{aux,log} level_api_syntax_examples.{aux,log} level_api_tds.{aux,log}
+CLEANFILES = enigma-ref.{pdf,html} level_api_syntax.pdf level_api_constants.pdf level_api_syntax_examples.pdf level_api_tds.pdf
 
 enigma-ref.html: $(srcdir)/enigma-ref.texi $(srcdir)/enigma-t2h.init
 	@if [ "${TEXI2HTML}" ]; then \



