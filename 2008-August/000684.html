<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1250 - trunk/doc/reference
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2008-August/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1250%20-%20trunk/doc/reference&In-Reply-To=%3C200808021326.m72DQtJf008835%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000683.html">
   <LINK REL="Next"  HREF="000685.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1250 - trunk/doc/reference</H1>
    <B>ral at mail.berlios.de</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1250%20-%20trunk/doc/reference&In-Reply-To=%3C200808021326.m72DQtJf008835%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1250 - trunk/doc/reference">ral at mail.berlios.de
       </A><BR>
    <I>Sat Aug  2 15:26:55 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000683.html">[Enigma-game-svn] r1249 - in trunk: lib-src/oxydlib src
</A></li>
        <LI>Next message: <A HREF="000685.html">[Enigma-game-svn] r1251 - trunk/doc/reference
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#684">[ date ]</a>
              <a href="thread.html#684">[ thread ]</a>
              <a href="subject.html#684">[ subject ]</a>
              <a href="author.html#684">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ral
Date: 2008-08-02 15:26:41 +0200 (Sat, 02 Aug 2008)
New Revision: 1250

Modified:
   trunk/doc/reference/enigma-ref.texi
Log:
Trunk 1.1: new API
- refman docu chapter Lua API overview and 4 big examples added 


Modified: trunk/doc/reference/enigma-ref.texi
===================================================================
--- trunk/doc/reference/enigma-ref.texi	2008-08-01 20:34:50 UTC (rev 1249)
+++ trunk/doc/reference/enigma-ref.texi	2008-08-02 13:26:41 UTC (rev 1250)
@@ -3173,6 +3173,7 @@
 @node Target - Action
 @subsection Target - Action
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at cindex</A> target action paradigm
 The &quot;target action paradigm&quot; is a classical object oriented method that allows
 you to easily plug together objects. One object is triggered by a function
 call or by an event like an actor hitting a stone, crossing over or applying an
@@ -3246,8 +3247,46 @@
 @node Callback Function
 @subsection Callback Function
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at cindex</A> callback function
+The most powerful extension to the @ref{Target - Action} paradigm that you can
+think of are callback functions. Instead of a target object as receiver of an
+action message you can supply an own @url{<A HREF="http://www.lua.org,">http://www.lua.org,</A> Lua} function that
+is called whenever the action is triggered.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+@{st_switch, target=&quot;my_magic&quot;, action=&quot;callback&quot;@}
+@{st_switch, target=&quot;my_magic&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
 
+The @samp{target} is the name of the function as a string. You may set the
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{action} to the string @samp{&quot;callback&quot;} for purpose of clarification,
+but it is not necessary as you see in the second example. The engine identifies
+the target to be of type of a Lua function and thus the action needs to be
+a callback. But you should note and remember that it is up to you to ensure that
+all object names and callback functions names are unique. 
+
+Let us look at the syntax of such a callback function
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+function my_magic(value, sender)
+    if value == true
+        wo[sender + @{1,0@}] = @{&quot;it_coin_s&quot;@}
+    end
+end
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+The function is called with two arguments. The first one is a value. The type
+and contents depends on the issuing object, but in most cases it is a boolean
+value. You will find the value described in the objects description. The second
+argument is the reference of the calling object.
+
+In the example we check if the @ref{st_switch} did just toggle to ON. If this
+is given we take the switch, which is the sender, as a position and set a new
+@{it_coin} to the grid east of it - a small bank automate that supplies money. 
+
+The @ref{Advanced Lua Examples} will show examples of real powerful callback 
+functions with a line by line comment.
+
 @node Object State
 @subsection Object State
 
@@ -3447,39 +3486,1429 @@
 @node Lua API
 @chapter Lua API
 
-Read API Concept Draft
+Knowing the basic principles of an Enigma level's world you now just need
+the language glue to write your first level. Enigma levels are written in
+the language @url{<A HREF="http://www.lua.org,">http://www.lua.org,</A> Lua}. This powerful language gives you
+the ability to write most complex, dynamical levels, while being nearly 
+transparent on writing basic standard levels. Indeed there is no reason to dig
+into this language at the very beginning.
 
+With the second Lua API version, as of Enigma 1.10, we designed an optimized
+way of describing levels in a very short and readable manner. Thus we do
+introduce you to this API by giving several examples from a basic level to most 
+thrilling dynamic real Enigma levels. You should be able to start your first
+experiments just after reading the first example with its explanations.
+
+For your convenience we do color the Lua code part. Predefined Lua variables and
+functions are colored in green. Enigma internal string constants as object kinds,
+attribute or message names are colored in blue. Level specific variable names
+and value constants are colored in magenta.
+
+After the examples and a short overview we do give details of the language
+specific API part as you can expect it for a reference manual. Please note
+that additional @ref{Advanced Features} are described in a seperate chapter.
+
+Until this chapter is finished please read the API Concept Draft, too!
+
 @menu
-* Lua Example:: 
-* Enigma Lua Types::   
-* Object Definitions and Tiles::
-* Lua Positions::
+* Basic Lua Examples:: 
+* API 2 Overview::   
+* Advanced Lua Examples:: 
+* Position::
+* Object::
+* Group::
+* NamedObjects::
+* Tile::
+* Tiles::
+* World::
 * World Creation and Resolver Chaining::
 * Custom Resolver::
 
 @end menu
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at c</A> ----------------- Lua Example -------------------- 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Lua Examples -------------------- 
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at node</A> Lua Example
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at section</A> Lua Example
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Basic Lua Examples
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> Basic Lua Examples
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at c</A> ----------------- Enigma Lua Types -------------------- 
+Let us look at two basic onescreener levels, that make use of all basic 
+techniques. While the first level is a little bit artifical, as it is designed 
+for demo purposes only, the second one is a quite dynamic real level out of
+the Enigma levelpacks.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at node</A> Enigma Lua Types
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at section</A> Enigma Lua Types
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at menu</A>
+* Basic Example::             
+* Colored Turnstiles::         Enigma Levelpack VIII, level #?
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> menu
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Basic Example -------------------- 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Basic Example
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> Basic Example
 
+Let us view the sourcecode. We did add a line count in the first two columns
+for reference purpose within this section. These line count number are not part
+of the source code itself!
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at c</A> -------------- Object Definitions and Tiles ----------------- 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+ 1    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&gt;
+ 2    &lt;el:level xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot; xsi:schemaLocation=&quot;<A HREF="http://enigma-game.org/schema/level/1">http://enigma-game.org/schema/level/1</A> level.xsd&quot; xmlns:el=&quot;<A HREF="http://enigma-game.org/schema/level/1">http://enigma-game.org/schema/level/1</A>&quot;&gt;
+ 3     &lt;el:protected&gt;
+ 4       &lt;el:info el:type=&quot;level&quot;&gt;
+ 5         &lt;el:identity el:title=&quot;Basic Level&quot; el:subtitle=&quot;&quot; el:id=&quot;20080721ral513&quot;/&gt;
+ 6         &lt;el:version el:score=&quot;1&quot; el:release=&quot;1&quot; el:revision=&quot;$Revision: 1170 $&quot; el:status=&quot;experimental&quot;/&gt;
+ 7         &lt;el:author  el:name=&quot;Ronald Lamprecht&quot; el:email=&quot;ral@@users.berlios.de&quot;/&gt;
+ 8         &lt;el:copyright&gt;Copyright @copyright{} 2008 Ronald Lamprecht&lt;/el:copyright&gt;
+ 9         &lt;el:license el:type=&quot;GPL v2.0 or above&quot; el:open=&quot;true&quot;/&gt;
+10         &lt;el:compatibility el:enigma=&quot;@var{1.10}&quot;/&gt;
+11         &lt;el:modes el:easy=&quot;true&quot; el:single=&quot;true&quot; el:network=&quot;false&quot;/&gt;
+12         &lt;el:score el:easy=&quot;-&quot; el:difficult=&quot;-&quot;/&gt;
+13       &lt;/el:info&gt;
+14       &lt;el:luamain&gt;&lt;![CDATA[
+15
+16    @i{wo}[&quot;@b{ConserveLevel}&quot;] = @var{true}
+17
+18    @i{ti}[&quot;@var{ }&quot;] = @{&quot;@b{fl-samba}&quot;@}
+19    @i{ti}[&quot;@var{.}&quot;] = @{&quot;@b{fl-abyss}&quot;@}
+20    @i{ti}[&quot;@var{~}&quot;] = @{&quot;@b{fl-water}&quot;@}
+21    @i{ti}[&quot;@var{#}&quot;] = @{&quot;@b{st-rock1}&quot;@}
+22    @i{ti}[&quot;@var{X}&quot;] = @{&quot;@b{st_oxyd}&quot;@}
+23
+24    @i{ti}[&quot;@var{L}&quot;] = @{&quot;@b{st_laser}&quot;, @b{orientation}=@var{EAST}, @b{state}=@var{ON}@}
+25    @i{ti}[&quot;@var{M}&quot;] = @{&quot;@b{st_lightpassenger}&quot;, @b{interval}=@var{0.04}@}
+26
+27    @i{ti}[&quot;@var{P}}&quot;] = @{&quot;@b{st_polarswitch}&quot;, @b{name}=&quot;@var{polar}&quot;@}
+28    @i{ti}[&quot;@var{T}&quot;] = @{&quot;@b{it_trigger}&quot;, @b{target}=&quot;@var{polar}&quot;@}
+29
+30    @i{ti}[&quot;@var{^}&quot;] = @{&quot;@b{st_boulder}&quot;, &quot;@var{boulder}&quot;, @b{orientation}=@var{NORTH}@}
+31    @i{ti}[&quot;@var{F}&quot;] = @{&quot;@b{st_fourswitch}&quot;, @b{target}=&quot;@var{boulder}&quot;, @b{action}=&quot;@var{orientate}&quot;@}
+32
+33    @i{ti}[&quot;@var{D}&quot;] = @{&quot;@b{st-door-v}&quot;, &quot;@var{door}&quot;@}
+34    @i{ti}[&quot;@var{B}&quot;] = @{&quot;@b{it_blocker}&quot;, &quot;@var{wall#}&quot;@}
+35    @i{ti}[&quot;@var{S}&quot;] = @{&quot;@b{st_switch}&quot;, @b{target}=@{&quot;@var{door}&quot;, &quot;@var{wall#*}&quot;@}@}
+36
+37    @i{ti}[&quot;@var{v}&quot;] = @{&quot;@b{it_vortex}&quot;, &quot;@var{left}&quot;, @b{destination}=&quot;@var{right}&quot;@}
+38    @i{ti}[&quot;@var{V}&quot;] = @{&quot;@b{it_vortex}&quot;, &quot;@var{right}&quot;, @b{destination}=&quot;@var{left}&quot;@}
+39
+40    @i{ti}[&quot;@var{O}&quot;] = @{&quot;@b{st_turnstile}&quot;, @b{flavor}=&quot;@var{red}&quot;@}
+41    @i{ti}[&quot;@var{E}&quot;] = @{&quot;@b{st_turnstilearm}&quot;, @b{orientation}=@var{EAST}@}
+42    @i{ti}[&quot;@var{N}&quot;] = @i{ti}[&quot;@var{.}&quot;] .. @{&quot;@b{st_turnstilearm_n}&quot;@}
+43
+44    @i{ti}[&quot;@var{+}&quot;] = @{&quot;@b{fl-samba}&quot;, @b{checkerboard}=@var{0}@} .. ti(@{&quot;@b{fl-wood}&quot;, @b{checkerboard}=@var{1}@})
+45
+46    @i{ti}[&quot;@var{1}&quot;] = @{&quot;#@b{ac-blackball}&quot;@}
+47
+48    if @i{wo}[&quot;@b{IsDifficult}&quot;] then
+49        @i{ti}[&quot;@var{=}&quot;] = @i{ti}[&quot;@var{~}&quot;]
+50    else
+51        @i{ti}[&quot;@var{=}&quot;] = @i{ti}[&quot;@var{~}&quot;] .. @{&quot;@b{it_strip_ew}&quot;@}
+52    end
+53
+54    w, h = @i{wo}(@i{ti}, &quot;@var{ }&quot;, @{
+55        &quot;@var{####################}&quot;,
+56        &quot;@var{#      ....++++++~ #}&quot;,
+57        &quot;@var{L   PM ..N.++~~~~OE#}&quot;,
+58        &quot;@var{#######  T~++++++. #}&quot;,
+59        &quot;@var{#     ^   ~++++++# #}&quot;,
+60        &quot;@var{#         =++++++X X}&quot;,
+61        &quot;@var{#         ~++++++# #}&quot;,
+62        &quot;@var{#~~~~~~~~~~~~~+++X X}&quot;,
+63        &quot;@var{#    ~   B   ~+++###}&quot;,
+64        &quot;@var{F    ~   B   ~+++++#}&quot;,
+65        &quot;@var{# 1  ~   B   #+++++#}&quot;,
+66        &quot;@var{S   v~V  B   D+++++#}&quot;,
+67        &quot;@var{####################}&quot;}
+68    @})
+69
+70    @i{wo}:@b{shuffleOxyd}()
+71
+72     ]]&gt;&lt;/el:luamain&gt;
+73        &lt;el:i18n&gt;
+74          &lt;el:string el:key=&quot;title&quot;&gt;
+75            &lt;el:english el:translate=&quot;false&quot;/&gt;
+76          &lt;/el:string&gt;
+77        &lt;/el:i18n&gt;
+78      &lt;/el:protected&gt;
+79    &lt;/el:level&gt;
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at node</A> Object Definitions and Tiles
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at section</A> Object Definitions and Tiles
+The resulting level looks like this in the game
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at c</A> ----------------- Lua Positions -------------------- 
+Let us now analyse the code line by line.
 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at node</A> Lua Positions
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at section</A> Lua Positions
+Lines 1 to 14 are the XML metadata of the level as described in 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{Level Basics}. The only line worth mentioning is
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+10         &lt;el:compatibility el:enigma=&quot;@var{1.10}&quot;/&gt;
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+You need to declare the level to be compatible to Enigma 1.10 or higher for
+the new API 2 as described in this reference manual. A value less than 1.10
+indicates compatiblity to a previous Enigma release that did use the old API 1,
+which should not be mixed up with the new API 2.
+
+The Lua part starts with line 15:
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+16    @i{wo}[&quot;@b{ConserveLevel}&quot;] = @var{true}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+Like most levels it starts with setting @ref{Global Attributes}. The handle of 
+our world is @samp{wo}. This object reference is preset
+(@pxref{World as an Object}). Concerning Lua it is an @samp{userdata},
+but most of its usage syntax is identical to that of Lua tables. Thus we access
+an attribute by providing the desired attribute name in square brackets. As we
+give a literal attribute name, we have to put it in double quotes @samp{&quot;}. In
+total this line requests the world to resurrect a killed actor as long as there
+are enough extralifes to conserve the running level (@pxref{ConserveLevel}).
+In fact @samp{true} is the default value. So we could have left this line out.
+But remember it is a demo level.
+
+The second part of a level are the tile definitions as explained in
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{World's Shape and Coordinates}. Let us start with the most simple ones:
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+18    @i{ti}[&quot;@var{ }&quot;] = @{&quot;@b{fl-samba}&quot;@}
+19    @i{ti}[&quot;@var{.}&quot;] = @{&quot;@b{fl-abyss}&quot;@}
+20    @i{ti}[&quot;@var{~}&quot;] = @{&quot;@b{fl-water}&quot;@}
+21    @i{ti}[&quot;@var{#}&quot;] = @{&quot;@b{st-rock1}&quot;@}
+22    @i{ti}[&quot;@var{X}&quot;] = @{&quot;@b{st_oxyd}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+Again we use a handle @samp{ti} which is a preset object reference for the
+tile definition repository. Like the world it is a Lua @samp{userdata}. And
+we can access it like the world by giving the desired index in square brackets.
+These indices are free to your choice. They have to be of a common character length
+if they are referenced in the world map below. For a small level one character
+keys are sufficient. You can use any ASCII character that Lua is aware of. That
+means upper and lower case characters @samp{A-Z,a-z}, the numbers and special
+characters besides backslash @samp{\} and double quote @samp{&quot;}.
+
+The assigned object definition are given as Lua anonymous tables, the curly braces,
+containing in the most simple case just the desired @ref{Object Kind}. As it
+is again a literal string, it has to be quoted. Without any further specification
+the objects are taken in their default configuaration as described in 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{Floor Objects} and following chapters.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+24    @i{ti}[&quot;@var{L}&quot;] = @{&quot;@b{st_laser}&quot;, @b{orientation}=@var{EAST}, @b{state}=@var{ON}@}
+25    @i{ti}[&quot;@var{M}&quot;] = @{&quot;@b{st_lightpassenger}&quot;, @b{interval}=@var{0.04}@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+These two lines define objects with custom configuration. The @ref{st_laser}
+should send its beam to the east and should start being switched on. The
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{st_lightpassenger} should move a little bit faster than usually. Both
+times we just have to add comma separated additional attributes. The attribute
+names are not quoted as they are followed by an equal @samp{=} sign.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+27    @i{ti}[&quot;@var{P}}&quot;] = @{&quot;@b{st_polarswitch}&quot;, @b{name}=&quot;@var{polar}&quot;@}
+28    @i{ti}[&quot;@var{T}&quot;] = @{&quot;@b{it_trigger}&quot;, @b{target}=&quot;@var{polar}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+An @ref{st_polarswitch} named for reference usage (@pxref{Object Naming}).
+The @ref{it_trigger} sets up a @ref{Target - Action}, the target being our
+polarswitch. The action attribute is omitted. It defaults to the message
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{toggle}. Thus any actor or stone on top of the trigger makes the
+polarswitch transparent, but switches it back to intransparency when leaving
+the trigger.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+30    @i{ti}[&quot;@var{^}&quot;] = @{&quot;@b{st_boulder}&quot;, &quot;@var{boulder}&quot;, @b{orientation}=@var{NORTH}@}
+31    @i{ti}[&quot;@var{F}&quot;] = @{&quot;@b{st_fourswitch}&quot;, @b{target}=&quot;@var{boulder}&quot;, @b{action}=&quot;@var{orientate}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+Another pair of objects that are coupled by @ref{Target - Action}. The
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{st_boulder} starts trying to move to north. This time we name the object
+just by giving the name as the second comma separated string. We omitted the
+attribute identifier @samp{name =}. This is a shortcut for this most common
+attribute which requires the name to be given as the second value directly 
+after the objects kind.
+
+The @ref{st_fourswitch} references the boulder as its target. We need to give
+the action as well, as we want to make use of a special action that directly 
+steers the boulder according to the fourswitch orientation.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+33    @i{ti}[&quot;@var{D}&quot;] = @{&quot;@b{st-door-v}&quot;, &quot;@var{door}&quot;@}
+34    @i{ti}[&quot;@var{B}&quot;] = @{&quot;@b{it_blocker}&quot;, &quot;@var{wall#}&quot;@}
+35    @i{ti}[&quot;@var{S}&quot;] = @{&quot;@b{st_switch}&quot;, @b{target}=@{&quot;@var{door}&quot;, &quot;@var{wall#*}&quot;@}@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+And another even more complex @ref{Target - Action}. We want a single 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{st_switch} to toggle a @ref{st_door} as well as set of @ref{it_blocker}s
+at the same time. The gaming idea is that neither with switch on nor with switch
+off the marble can pass both obstacles. The gamer needs to steer the boulder
+through the blocker wall to pass these obstacles.
+
+The setup of the door is simple. We just need to name it to be able to reference
+it later on. We want to use several blocker objects and we need to name each 
+for reference purposes. We do this by appending a hash sign @samp{#} to its
+name as described in @ref{Object Naming}. Every blocker gets a unique name.
+The switch needs to list all these objects as its targets. This is done by
+an embedded anonymous table given by the curly braces and comma separated
+values. The first one is our door's name, the second one is a wildcarded string
+that describes all our blocker objects. The asterix stands for any suffix
+that may have been added behind the hash in the process of autonaming of our
+blockers.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+37    @i{ti}[&quot;@var{v}&quot;] = @{&quot;@b{it_vortex}&quot;, &quot;@var{left}&quot;, @b{destination}=&quot;@var{right}&quot;@}
+38    @i{ti}[&quot;@var{V}&quot;] = @{&quot;@b{it_vortex}&quot;, &quot;@var{right}&quot;, @b{destination}=&quot;@var{left}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+We want to use two @ref{it_vortex} that are connected to each other allowing
+the marble to warp into both directions. We set up both vortices with a unique
+name and add the attribute @samp{destination} referencing the other vortex' name.
+
+Note that it is no problem to reference the right vortex in line 37 while it
+is named later on in line 38. We are still just defining tiles and not creating
+any objects at all.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+40    @i{ti}[&quot;@var{O}&quot;] = @{&quot;@b{st_turnstile}&quot;, @b{flavor}=&quot;@var{red}&quot;@}
+41    @i{ti}[&quot;@var{E}&quot;] = @{&quot;@b{st_turnstilearm}&quot;, @b{orientation}=@var{EAST}@}
+42    @i{ti}[&quot;@var{N}&quot;] = @i{ti}[&quot;@var{.}&quot;] .. @{&quot;@b{st_turnstilearm_n}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+Another object group is an @ref{st_turnstile} cluster with one arm disconnected.
+The first two definitions are straight forward. But in line 42 we preceed the
+arm's definition by another tile reference. It is the abyss tile defined in 
+line 19. By concatenation, the two dots @{..}, of a tile and a object
+definition we can define a new that is composed of both objects. In this case
+we define a turnstile arm on top of an abyss floor.
+
+You may be wondering why we did not define floors for the other stone and item
+tiles. We make use of the tile definition in line 18 that we will declare
+later as the default floor for our level. Thus any tile declaration that does
+not provide its own floor will set this default floor.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+44    @i{ti}[&quot;@var{+}&quot;] = @{&quot;@b{fl-samba}&quot;, @b{checkerboard}=@var{0}@} .. ti(@{&quot;@b{fl-wood}&quot;, @b{checkerboard}=@var{1}@})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+Just for fun we want to provide a checkerboard floor on the right side of our
+level. This can be done by usage of the @ref{checkerboard} attribute. Again
+we concatenate two object definitions for a single tile. Both are floors. That
+means for each grid position we try to set both floor types, but just one meets
+the checkboard condition and will be set.
+
+Please notice that we did convert one one the floor object definitions to a tile
+definition by the function call @samp{ti()}. This is necessary as Lua does not
+know how to concatenate two anonymous tables. One argument of the concatenation
+has to be a tile.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+46    @i{ti}[&quot;@var{1}&quot;] = @{&quot;#@b{ac-blackball}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+Finally we do need our marble. Unlike other objects it can be positioned 
+anywhere within a grid. The most common position is the center of the grid.
+This is simply done by preceeding the actor's kind by a hash sign @samp{#}.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+48    if @i{wo}[&quot;@b{IsDifficult}&quot;] then
+49        @i{ti}[&quot;@var{=}&quot;] = @i{ti}[&quot;@var{~}&quot;]
+50    else
+51        @i{ti}[&quot;@var{=}&quot;] = @i{ti}[&quot;@var{~}&quot;] .. @{&quot;@b{it_strip_ew}&quot;@}
+52    end
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+We encourage every level author to provide an easy mode for the levels. This
+is an example how to define mode dependant tiles. Like in line 16 we access
+a world attribute. But this time it is a read access of @ref{IsDifficult}.
+In easy mode we want a @ref{it_strip} on top of water floor that allows the 
+marble to pass and press the trigger. In difficult mode the there should be
+no passage. Thus the special tile is identical to the water tile defined in
+line 20.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+54    w, h = @i{wo}(@i{ti}, &quot;@var{ }&quot;, @{
+55        &quot;@var{####################}&quot;,
+56        &quot;@var{#      ....++++++~ #}&quot;,
+57        &quot;@var{L   PM ..N.++~~~~OE#}&quot;,
+58        &quot;@var{#######  T~++++++. #}&quot;,
+59        &quot;@var{#     ^   ~++++++# #}&quot;,
+60        &quot;@var{#         =++++++X X}&quot;,
+61        &quot;@var{#         ~++++++# #}&quot;,
+62        &quot;@var{#~~~~~~~~~~~~~+++X X}&quot;,
+63        &quot;@var{#    ~   B   ~+++###}&quot;,
+64        &quot;@var{F    ~   B   ~+++++#}&quot;,
+65        &quot;@var{# 1  ~   B   #+++++#}&quot;,
+66        &quot;@var{S   v~V  B   D+++++#}&quot;,
+67        &quot;@var{####################}&quot;}
+68    @})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+After all tiles have been defined we can create our world simply by a map that
+uses our tile keys. The first argument is our handle @samp{ti}, that defines
+how the keys should be resolved. The second argument is the key of our default
+floor. The third argument is the map as a table of strings, one for every line.
+
+The world initialization returns the width and height of our world which are
+calcluated by the maps size.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+70    @i{wo}:@b{shuffleOxyd}()
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+After the world is created and all objects are set, we can do some final
+postprocessing before the level starts to run. The most common task is the
+shuffling of the oxyds, which is just a method call of @ref{shuffleOxyd} to 
+our mighty world object.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Colored Turnstiles -------------------- 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Colored Turnstiles
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> Colored Turnstiles
+
+As this level is part of the Enigma levelpacks we recommend that you play
+the level first to get familar with the used objects and their behaviour.
+
+Now let us look at the essential Lua source code part of the level to understand
+how such an idea can be realized with the new API
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{ }&quot;] = @{&quot;@b{fl-sahara}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{#}&quot;] = @{&quot;@b{st-rock6}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{@@}&quot;] = @{&quot;#@b{ac-blackball}&quot;@}
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{N}&quot;] = @{&quot;@b{st_turnstilearm_n}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{S}&quot;] = @{&quot;@b{st_turnstilearm_s}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{E}&quot;] = @{&quot;@b{st_turnstilearm_e}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{W}&quot;] = @{&quot;@b{st_turnstilearm_w}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{R}&quot;] = @{&quot;@b{st_turnstile}&quot;, @b{action} = @{&quot;@b{open}&quot;, &quot;@b{close}&quot;@}, @b{target} = @{&quot;@var{red}#*&quot;, &quot;@var{green}#*&quot;@}@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{G}&quot;] = @{&quot;@b{st_turnstile}&quot;, @b{action} = @{&quot;@b{close}&quot;, &quot;@b{open}&quot;@}, @b{target} = @{&quot;@var{red}#*&quot;, &quot;@var{green}#*&quot;@},
+                           @b{flavor} = &quot;@b{green}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{r}&quot;] = @{&quot;@b{it_blocker}&quot;, &quot;@var{red}#&quot;@} .. @i{ti}(@{&quot;@b{fl-red}&quot;@})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{g}&quot;] = @{&quot;@b{it_blocker}&quot;, &quot;@var{green}#&quot;@} .. @i{ti}(@{&quot;@b{fl-leaves}&quot;@})
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{O}&quot;] = @{&quot;@b{st_oxyd}&quot;, @b{flavor} = &quot;@b{d}&quot;, @b{oxydcolor} = @var{OXYD_GREEN}@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{o}&quot;] = @{&quot;@b{st_oxyd}&quot;, @b{flavor} = &quot;@b{d}&quot;, @b{oxydcolor} = @var{OXYD_RED}@}
+  
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{w}, @var{h} = @i{wo}(@i{ti}, &quot;@var{ }&quot;, @{
+ -- 01234567890123456789
+   &quot;@var{#O#####O############}&quot;,
+   &quot;@var{#   r N g N rO##O#O#}&quot;,
+   &quot;@var{#WRE#WGE# R ####g#r#}&quot;,
+   &quot;@var{#   r N r S  r N   #}&quot;,
+   &quot;@var{#g#g#WG #g##r# REr##}&quot;,
+   &quot;@var{# # N S r    g S  gO}&quot;,
+   &quot;@var{#@@g RE#g#gWGE###g###}&quot;,
+   &quot;@var{# # S   g    r N  ro}&quot;,
+   &quot;@var{#r#r#WGE#r##g#WGEg##}&quot;,
+   &quot;@var{# N r S g N  r     #}&quot;,
+   &quot;@var{#WGE# RE# RE####r#g#}&quot;,
+   &quot;@var{#   g S r S go##o#o#}&quot;,
+   &quot;@var{#o#####o############}&quot;
+@})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+There are just four tile definitions that do all the dynamic actions. Let us
+look first at the blocker item definitions:
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{r}&quot;] = @{&quot;@b{it_blocker}&quot;, &quot;@var{red}#&quot;@} .. @i{ti}(@{&quot;@b{fl-red}&quot;@})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{g}&quot;] = @{&quot;@b{it_blocker}&quot;, &quot;@var{green}#&quot;@} .. @i{ti}(@{&quot;@b{fl-leaves}&quot;@})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+All blockers on red floors are autonamed with a name being composed of the
+prefix @samp{red#} and a unique random number being added by the engine as
+explained in @ref{Object Naming}. This allows us to address all these blockers
+later on.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{R}&quot;] = @{&quot;@b{st_turnstile}&quot;, @b{action} = @{&quot;@b{open}&quot;, &quot;@b{close}&quot;@}, @b{target} = @{&quot;@var{red}#*&quot;, &quot;@var{green}#*&quot;@}@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{G}&quot;] = @{&quot;@b{st_turnstile}&quot;, @b{action} = @{&quot;@b{close}&quot;, &quot;@b{open}&quot;@}, @b{target} = @{&quot;@var{red}#*&quot;, &quot;@var{green}#*&quot;@},
+                           @b{flavor} = &quot;@b{green}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Whenever the marble hits and turns an @ref{st_turnstile} it performs its actions
+on the targets. Here the author makes clever usage of multitargets and 
+multiactions as described in @ref{Target - Action}. On every turn of a red
+turnstile all objects named @samp{red#*}, that are all our blockers on a red
+floor, will be send a message @samp{open}, whereas all blockes on a green floor,
+the second target group, receives the second action message @samp{close}. It is
+essential to choose the @samp{open}, @samp{close} messages instead of 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{toggle}, as more than one red turnstile may be turned in sequence, but
+just the first red turn should &quot;toggle&quot; all blockers. The next toggling should
+occur on the first green turn following thereafter.
+
+Hope you got the basic idea of the new API. You may well start with you first
+level experiments. But you should return and read the following chapters with
+overview and advanced examples to write even more fancy levels.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- API 2 Overview -------------------- 
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> API 2 Overview
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> API 2 Overview
+
+Having analysed a first level it is time get an overview of the API 2 
+capabilities. Let us take a task driven appoach by listing the different
+possibilities and use cases by example.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at menu</A>
+* Types Overview::         
+* Position Tasks::           
+* Attribute Tasks::           
+* Object Tasks::           
+* Group Tasks::           
+* Tiles and World Tasks::           
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> menu
+
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Types Overview -------------------- 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Types Overview
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> Types Overview
+
+But first we need to introduce you to the special Enigma value types besides
+the standard Lua types @samp{nil}, @samp{boolean}, @samp{string}, 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{function} and @samp{table}:
+ 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at table</A> @asis
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Types:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at table</A> @asis
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{position:}@ @ @xref{Position}
+A position within the world that can be described by an x and y coordinate.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{object:}@ @ @xref{Object}
+An Enimga object like a stone, item, floor, other. Any object is a position, too.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{group:}@ @ @xref{Group}
+A list of objects.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{namedobjects:} @i{preset variable:} @code{@b{no}}; @ @ @xref{NamedObjects}
+The singleton type of the repository of all named objects.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{default:} @i{preset variable:} @code{@b{DEFAULT}}; @ @ @xref{Default}
+The singleton type of default values that can be used instead of Lua's @samp{nil}
+in anonymous table tile definitions.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{tile:}@ @ @xref{Tile}
+A description of one or several objects for a common grid position (floor, item,
+stone, actor)
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{tiles:} @i{preset variable:} @code{@b{ti}}; @ @ @xref{Tiles}
+The singleton type of the repository of all tile instances.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{world:} @i{preset variable:} @code{@b{wo}}; @ @ @xref{World}
+The singleton type of the world that contains all objects.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> table
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> table
+
+Please note the three handles @samp{no}, @samp{ti} and @samp{wo}. You have
+noticed two of them in the previous section @ref{Basic Lua Examples}. These
+are three variables, that are preset prior the level code gets executed.
+
+API 2 uses generally two character names for frequently used variables and
+functions to shorten the level code and to make it better readable. Authors 
+should try to use either single characters or names that are three characters or
+longer for private variable names.
+
+For the rest of this section let us assume that @samp{obj} is an object 
+reference of a stone, item or floor, which means that is of type @samp{object}.
+And let @samp{pos} be a valid variable of type @samp{position}.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Position Tasks -------------------- 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Position Tasks
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> Position Tasks
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at table</A> @asis
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Creating Positions:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{pos} = @i{po}(@var{7}, @var{3})         -- using function &quot;po()&quot; to generate a position object
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{pos} = @i{po}(@{@var{7}, @var{3}@})        -- using a table position constant as argument
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{pos} = @var{obj}              -- every object is a valid position
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{pos} = @i{po}(@var{12.3}, @var{3.7})    -- a position within a grid (for an actor) 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Absolut positions are created by the function @samp{po()}. But the most common
+way should be the reinterpretation of an object as a position. This lets you
+set other objects relatively to given ones.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Position Constants:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+@{@var{7}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">, at var</A>{3}@}     -- a valid position for all arguments and operations (@pxref{Caveats}) 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Anonymous tables with just two number values can be used in many cases directly as
+a position constant. In case of errors, e.g. when operators are not well defined
+like addition of two constants what result in an attempt of adding two Lua 
+tables, use the function @samp{po()} to convert the constant.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Coordinate Access:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{x}, @var{y} = @var{pos}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at b</A>{x}, @var{pos}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at b</A>{y}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{x}, @var{y} = @var{pos}[&quot;@b{x}&quot;], pos[&quot;@b{y}&quot;]
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{x}, @var{y} = @var{pos}:@b{xy}()
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{x}, @var{y} = @var{obj}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at b</A>{x}, @var{obj}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at b</A>{y}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{x}, @var{y} = @var{obj}:@b{xy}()
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+The x and y coordinate of a position or object can be read accessed like any
+object attribute. A position or object method call by @samp{xy()} returns
+both coordinate values at once. You can not set a position value by coordinate
+write access. Objects need to be set to a new world position. New positions
+can be calculated by position arithmetic.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Position Calculation:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{pos} = @var{obj} + @{@var{2}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">, at var</A>{7}@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{dpos} = @var{obj1} - @var{obj2}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{dpos2} = @var{2} * @var{dpos}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{dpos3} = @var{dpos} / @var{2}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Positions can be added or subtracted to get distance vectors. You can multiply
+and divide them with any number.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Center positions for set actors}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{pos_centered1} = @var{pos} + @{@var{0.5}, @var{0.5}@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{pos_centered2} = #@var{pos}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{pos_centered3} = #@var{obj}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Especially for positioning of actors you sometimes need the position of the
+center of a grid. Of course you can get it by addition of a constant position.
+But the @samp{#} operator applied on a position or an actor does the same in
+a simpler way.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Round a position to a grid}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{grid_pos} = @var{pos}:@b{grid}()
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{grid_pos} = ((@var{pos1} - @var{pos2})/@var{2}):@b{grid}()
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+A result of a position calculation needs sometimes to be rounded to integer grid
+coordinates. This is done by the @samp{grid()} method.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Position comparison}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{pos_centered1} == @var{pos_centered2}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{pos_centered1} ~= @var{pos_centered2}    -- Lua's inequality operator
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Position can be easily compared to equality.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> table
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Attribute Tasks -------------------- 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Attribute Tasks
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> Attribute Tasks
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at table</A> @asis
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Single Attribute Setting:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj}[&quot;@b{destination}&quot;] = @i{po}(@var{7}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">, at var</A>{3})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[&quot;@b{Brittleness}&quot;] = @var{7}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Object attributes as well as global world attributes can be set like Lua table
+values. They can take values of special Enigma types like position, object or
+group.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Multiple Attribute Setting:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj}:@b{set}(@{@b{target}=@var{mydoor}, @b{action}=&quot;@b{open}&quot;@})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+You can multiple attributes on any object at once with the objects @samp{set()}
+method. The arguement is an anonymous Lua table with the attribute names as keys
+and assigned values of your choice.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Requesting Attributes:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{value} = @var{obj}[&quot;@b{attr_name}&quot;]
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{value} = @i{wo}[&quot;@b{Brittleness}&quot;]
+if @i{wo}[&quot;@b{IsDifficult}&quot;] then ... end
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Attributes of objects and the world can be read like Lua table key values.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Reset Attributes:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj}[&quot;@b{length}&quot;] = nil       -- the default length, e.g. @samp{1}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj}[&quot;@b{color}&quot;]  = nil       -- delete color attribute - no color
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj}[&quot;@b{length}&quot;] = @i{DEFAULT}   -- the default length, e.g. @samp{1}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Any object attribute can be reset to its default value, what is the attributes
+&quot;delete&quot; operation, by assigning it the Lua @samp{nil} or the Enigma 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{DEFAULT} value.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> table
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Object Tasks -------------------- 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Object Tasks
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> Object Tasks
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at table</A> @asis
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Creating Objects:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[@var{pos}]  = @{&quot;@b{st_chess}&quot;, @b{color}=@var{WHITE}, @b{name}=&quot;@var{Atrax}&quot;@}   -- on grid pos
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[#@var{pos}] = @{&quot;@b{ac_bug}&quot;@}              -- actor centered on grid pos
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[@var{pos}]  = @{&quot;#@b{ac_bug}&quot;@}             -- actor centered on grid pos
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[@var{pos}]  = @{&quot;@b{ac_bug}&quot;, @var{0.3}, @var{0.7}@}    -- actor with offsets to pos
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[@var{my_floor}] = @{&quot;@b{it_magicwand}&quot;@}    -- set an wand on top of a given foor object
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[@var{pos}]  = @i{ti}[&quot;@var{x}&quot;]                 -- tile based object definition
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Besides map based object creation, that you saw in the previous basic examples,
+you can create new objects on any world position directly. The world takes a
+position, that may well be an object, as key argument. The new object is
+described either by an anonymous Lua table, containing the kind string as first
+value and additional attributes as key value pairs appended, or by a tile object.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Object Naming:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{no}[&quot;@var{Atrax}&quot;] = @var{obj}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[@var{pos}] = @{&quot;@b{st_chess}&quot;, @b{name}=&quot;@var{Atrax}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[@var{pos}] = @{&quot;@b{st_chess}&quot;, &quot;@var{Atrax}&quot;, @b{color}=@var{WHITE}@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+As explained in @ref{Object Naming}, the names are the only longtime valid
+object references. You can explicitly name an object by assigning it at the
+named object repository @samp{no} to the name as the key. But most times you
+just supply the objects name as an object attribute. If you supply the name
+attribute as the @b{second} value in the anonymous table you can omit the
+key @samp{name =} part as a common abreviation.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Object Autonaming:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[@var{pos}] = @{&quot;@b{st_chess}&quot;, @b{name}=&quot;@var{Atrax}#&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+As explained in @ref{Object Naming} you can append a hash sign @samp{#} to a
+name and use the resulting string for arbitrary number of similar objects. This
+is especially useful for building groups.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Requesting Objects:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj} = @i{no}[&quot;@var{Atrax}&quot;]       -- named object retrieval from repository
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj} = @i{it}(@var{pos})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj} = @i{it}(@var{x}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">, at var</A>{y})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj} = @i{st}(@var{pos})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj} = @i{wo}:@b{it}(@var{pos})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{my_item} = @i{it}(@var{my_floor})  -- get the item that is on top of the given floor
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+The most common way is naming objects and the requesting the @samp{no} 
+repository for the object reference. If you know the position of the desired
+object you can use one of the functions or world methods @samp{fl}, @samp{it},
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{st} that take a position, an object as position, or just the two
+coordinates as arguments. Especially requesting one type of objects that is
+positioned at the same grid as another object, the stone on top of a floor, etc.
+can be very useful.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Killing Objects:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[@var{pos}] = @{&quot;@b{it_nil}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj}:@b{kill}()
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+You remove an object by setting another replacement object at the same
+position in the same layer. If you do not want to set a new object you can use
+the placebo objects @samp{fl_nil}, @samp{it_nil}, @samp{st_nil}. Another way is
+to call the @samp{kill()} method of an object or send it a @samp{kill} message.
+You can only remove objects that are set on the grid. Neither actors nor owned
+objects like items in a players inventory can be killed - they will simply
+ignore the attempt.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Comparing Objects}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj1} == @var{obj2}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj1} ~= @var{obj2}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Objects can be directly compared on equality or inequality. It is a identity
+comparison that acknowledges that you have two references of the same object.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Existence of an object}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj}:@b{exists}()
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+- at var</A>{obj}                -- unary minus operator on object
+if <A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">- at var</A>{obj} then ...
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Object references may get invalid due to objects being killed. In most cases
+this no problem as requests to invalid objects will simply be ignored. But if
+the level logic depends on the existence of an object you can call the 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{exists()} method or simply preceed the reference by the unary minus 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{-} operator. Both ways return a simple bool value stating if the object
+reference is still valid.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Messages:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{my_boulder}:@b{message}(&quot;@b{orientate}&quot;, @var{WEST})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{my_boulder}:@b{orientate}(@var{EAST})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{my_door}:@b{open}()
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{Messages} are a main feature of Enigma. You can send them directly to any
+object by the @samp{message()} method or by using any message directly as a
+method call itself.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Object Classification:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj}:@b{is}(&quot;@b{st_chess}&quot;)
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj}:@b{is}(&quot;@b{st}&quot;)
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj}:@b{is}(&quot;@b{st_chess_black}&quot;)
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+You create objects by giving an @ref{Object Kind}. Later on you can check a
+given object for conformity to a given class or kind. Even though you can not
+create abstract kind objects like @samp{st}, you can check this way if an object
+is a stone. Checking for special subkinds may even evaluate the current state
+or other attributes of an object to report its current classification.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> table
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Group Tasks -------------------- 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Group Tasks
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> Group Tasks
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at table</A> @asis
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Creating Groups:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{group} = @i{no}[&quot;@b{Atrax}#*&quot;]           -- a group of all matching objects
+			        --   wildcards &quot;*&quot;,&quot;?&quot; allowed
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{group} = @i{grp}(@var{obj1}, @var{obj2}, @var{obj3})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{group} = @i{grp}({@var{obj1}, @var{obj2}, @var{obj3}@})  -- a group of objects set up in a table
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Requesting objects from the named object repository will result in a group of
+objects if you make proper usage of wildcards. Appending an asterix @samp{*}
+to the autonaming hash will retrieve all objects that have been set with this
+name suffix. But you can create a group by the @samp{grp} function, too. Simply
+add the desired object reference as arguments, either single or as a table.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Group Usage:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{floor_group}[&quot;@b{friction}&quot;] = @var{3.2}      -- set attribute on all floors in the group
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{door_group}:@b{message}(&quot;@b{open}&quot;)
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{door_group}:@b{open}()
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{stone_group}:@b{kill}()
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[@var{floor_group}] = @{&quot;@b{it_coin_m}&quot;@}   -- add some money on all floor positions
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[@var{pos}] = @{&quot;@b{st_switch}&quot;, @b{target}=@var{door_group}, @b{action}=&quot;@b{open}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{wo}[@var{pos}] = @{&quot;@b{st_switch}&quot;, @b{target}=&quot;@var{door}#*&quot;, @b{action}=&quot;@b{close}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Many object operations can be applied to groups in the same manner. The 
+operations will be applied to all members of the group. You set attributes,
+send messages or call any method.
+
+The world object takes a group as key, too. You can set objects of a given
+definition to many positions at once.
+
+Another usage of groups is the application as an attribute value. E.g. you can
+define multiple targets by supplying a group.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Group Operations:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{doors_lasers} = @var{doorgrp} + @var{lasergrp}       -- join of two groups
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{lasergrp}     = @var{doors_lasers} - @var{doorgrp}   -- difference of two groups
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{common_doors} = @var{doorgrp1} * @var{doorgrp2}      -- intersection of two groups
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Groups offer some standard operations known from handling with sets.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Group Members:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{count} = #@var{mygroup}        -- number of objects in the group
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{obj}   = @var{mygroup}[@var{5}]     -- 5th object of the group
+for @var{i} = @var{1}, #@var{mygroup} do @var{obj} = @var{mygroup}[@var{i}] ... end
+for @var{obj} in @var{mygroup} do ... end
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+You can access the members of a group by numbered indices. The size of a group
+is reported by the standard Lua hash @samp{#} operator. If you need to iterate
+over the objects of a group you can write easily Lua for loops. You can either
+iterate with a counter or directly iterate the content objects.
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> table
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Tiles and World Tasks -------------------- 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Tiles and World Tasks
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> Tiles and World Tasks
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at table</A> @asis
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{Tiles:}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{_}&quot;] = @{&quot;@b{fl_sahara}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{__}&quot;] = @{&quot;@b{fl_sahara}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{..}&quot;] = @{&quot;@b{fl_sand}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{##}&quot;] = @{&quot;@b{st_blocker}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{switch_template}&quot;] = @{&quot;@b{st_switch}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{..}&quot;] = @{&quot;@b{fl_abyss}&quot;@}   -- redefinition causes error to avoid common mistakes
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{.w}&quot;] = @i{ti}[&quot;@var{..}&quot;] .. @{&quot;@b{it_magicwand}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at i</A>{ti}[&quot;@var{ w}&quot;] = @{&quot;@b{fl_abyss}&quot;@} .. @i{ti}(@{&quot;@b{it_magicwand}&quot;@})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+The tiles repository @samp{ti} is like a table, but specialized on storage of
+tile definitions. You can use any string as key. You can store the same 
+definition twice at different keys. But you are not allowed to redefine an
+already set key. This is pure protection of common error situations. A
+definition stored in the repository can be used in other definitions that
+follow. Referencing a tiles repository entry at a given key like @samp{ti[&quot;..&quot;]}
+results in a tile value. Such tile values can be concatenated by the @samp{..}
+operator with other tile values and anonymous tables containing object 
+definitions. The last example is a concatenation of two prior not declared 
+object definitions. You can not concatenate two anonymous tables. Lua forbids 
+that. By converting any of the two tables by the @samp{ti()} to a tile value the 
+concatenation gets valid.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at item</A> @b{World Initialization}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+  @var{width}, @var{height} = @i{wo}(@i{ti}, &quot;@var{__}&quot;, { -- second arg: default tile key that 
+  &quot;@var{##__......}&quot;,                  --   defines the base, too - this example
+  &quot;@var{##..__.w__}&quot;,                  --   is 2 chars per tile/grid 
+  &quot;@var{##.. w__..}&quot;
+  })
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+The world is initialized by the @samp{wo()} call that is explained in details
+at @ref{World Creation and Resolver Chaining}. In the simple form you supply
+the @samp{ti} handle as the first argument. The second argument is the key of
+the default tile definition that defines the default floor to be set if a tile
+does not contain another floor object. At the same time this key defines by its
+length the standard key length as used in the following map, too. The third 
+argument is the map given as an anonymous table of strings. The worlds size is
+given by the maximum line length and the number of lines. These values are
+returned by the call.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> table
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Advanced Lua Examples -------------------- 
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Advanced Lua Examples
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> Advanced Lua Examples
+
+Now it is time to reveal the real power of the new API. Let us look again at
+two real levels. Investigate the levels first by playing and then join 
+in the line by line commentation of the source code to understand how to
+implement your own level ideas.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at menu</A>
+* Color Maze::    Enigma levelpack VIII, level #19
+* Wired::           Enigma levelpack VIII, level #22
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> menu
+
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Color Maze -------------------- 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Color Maze
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> Color Maze
+
+Let us view the Lua source code part. We did add a line count in the first two
+columns for reference purpose within this section. These line count number are 
+not part of the source code itself!
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+01    @i{wo}[&quot;@b{ConserveLevel}&quot;] = @var{false}
+02    @i{wo}[&quot;@b{FollowGrid}&quot;] = @var{false}
+03    @i{wo}[&quot;@b{FollowMethod}&quot;] = @var{FOLLOW_SCROLL}
+04    
+05    @i{ti}[&quot;@var{ }&quot;] = @{&quot;@b{fl-abyss_fake}&quot;@} .. @i{ti}(@{&quot;@b{st-glass1}&quot;@})
+06    
+07    @i{ti}[&quot;@var{!}&quot;] = @{&quot;@b{fl-rough-blue}&quot;, &quot;@var{blue#}&quot;, @var{_color}=&quot;@var{blue}&quot;@}
+08    @i{ti}[&quot;@var{@@}&quot;] = @{&quot;@b{fl-bumps}&quot;, &quot;@var{orange#}&quot;, @var{_color}=&quot;@var{orange}&quot;@}
+09    @i{ti}[&quot;@var{#}&quot;] = @{&quot;@b{fl-rough-red}&quot;, &quot;@var{red#}&quot;, @var{_color}=&quot;@var{red}&quot;@}
+10    @i{ti}[&quot;@var{$}&quot;] = @{&quot;@b{fl-leavesb}&quot;, &quot;@var{green#}&quot;, @var{_color}=&quot;@var{green}&quot;@}
+11    
+12    @i{ti}[&quot;@var{b}&quot;] = @i{ti}[&quot;@var{!}&quot;] .. @{&quot;@b{st-door-h-open}&quot;@}
+13    @i{ti}[&quot;@var{B}&quot;] = @i{ti}[&quot;@var{!}&quot;] .. @{&quot;@b{st-door-v-open}&quot;@}
+14    @i{ti}[&quot;@var{o}&quot;] = @i{ti}[&quot;@var{@@}&quot;] .. @{&quot;@b{st-door-h-open}&quot;@}
+15    @i{ti}[&quot;@var{O}&quot;] = @i{ti}[&quot;@var{@@}&quot;] .. @{&quot;@b{st-door-v-open}&quot;@}
+16    @i{ti}[&quot;@var{r}&quot;] = @i{ti}[&quot;@var{#}&quot;] .. @{&quot;@b{st-door-h-open}&quot;@}
+17    @i{ti}[&quot;@var{R}&quot;] = @i{ti}[&quot;@var{#}&quot;] .. @{&quot;@b{st-door-v-open}&quot;@}
+18    @i{ti}[&quot;@var{g}&quot;] = @i{ti}[&quot;@var{$}&quot;] .. @{&quot;@b{st-door-h-open}&quot;@}
+19    @i{ti}[&quot;@var{G}&quot;] = @i{ti}[&quot;@var{$}&quot;] .. @{&quot;@b{st-door-v-open}&quot;@}
+20    
+21    @i{ti}[&quot;@var{d}&quot;] = @{&quot;@b{it-document}&quot;, @b{text}=&quot;@var{text1}&quot;@}
+22    @i{ti}[&quot;@var{5}&quot;] = @i{ti}[&quot;@var{b}&quot;] .. @i{ti}[&quot;@var{d}&quot;]
+23    @i{ti}[&quot;@var{6}&quot;] = @i{ti}[&quot;@var{O}&quot;] .. @i{ti}[&quot;@var{d}&quot;]
+24    @i{ti}[&quot;@var{7}&quot;] = @i{ti}[&quot;@var{r}&quot;] .. @i{ti}[&quot;@var{d}&quot;]
+25    @i{ti}[&quot;@var{8}&quot;] = @i{ti}[&quot;@var{G}&quot;] .. @i{ti}[&quot;@var{d}&quot;]
+26    
+27    @i{ti}[&quot;@var{x}&quot;] = @{&quot;@b{it_sensor}&quot;, @b{invisible}=@var{true}, @b{target}=&quot;@var{gates}&quot;@}
+28    @i{ti}[&quot;@var{*}&quot;] = @i{ti}[&quot;@var{x}&quot;] .. @{&quot;#@b{ac-blackball}&quot;, &quot;@var{me}&quot;@}
+29    
+30    @i{ti}[&quot;@var{?}&quot;] = @{&quot;@b{st_oxyd_a}&quot;@}
+31    
+32    @i{wo}(@i{ti}, &quot;@var{ }&quot;, @{
+33    --      |         1    1   |2    2
+34    --      |1   5    0    5   |0    5
+35           &quot;@var{                           }&quot;,
+36           &quot;@var{ xO@@OxR#RxO@@OxB!BxR#RxB!Bx }&quot;, --01
+37           &quot;@var{ b   r   g   g   b   g   r }&quot;, 
+38           &quot;@var{ !   #   $   $   !   $   # }&quot;, 
+39           &quot;@var{ b   r   g   g   b   g   r }&quot;, 
+40           &quot;@var{ xR#RxB!BxO@@OxG$GxO@@OxO@@Ox }&quot;, --05
+41           &quot;@var{ g   g   r   g   g   b   b }&quot;, 
+42           &quot;@var{ $   $   #   $   $   !   ! }&quot;, 
+43           &quot;@var{ g   g   r   g   g   b   b }&quot;, 
+44           &quot;@var{ xR#RxO@@OxG$GxR#RxG$GxR#Rx }&quot;, 
+45           &quot;@var{ g   b   b   o       b   r }&quot;, --10
+46           &quot;@var{ $   !   !   @@       !   # }&quot;, 
+47           &quot;@var{ g   b   5   o   ?   b   r }&quot;, --
+48           &quot;@var{ xO@@OxO@@6*8$Gx   xG$GxR#Rx }&quot;, 
+49           &quot;@var{ r   b   7   b   ?   o   o }&quot;, 
+50           &quot;@var{ #   !   #   !       @@   @@ }&quot;, --15
+51           &quot;@var{ r   b   r   b       o   o }&quot;, 
+52           &quot;@var{ xG$GxB!BxR#RxO@@OxR#RxG$Gx }&quot;, 
+53           &quot;@var{ g   o   o   g   g   o   b }&quot;, 
+54           &quot;@var{ $   @@   @@   $   $   @@   ! }&quot;, 
+55           &quot;@var{ g   o   o   g   g   o   b }&quot;, --20
+56           &quot;@var{ xB!BxO@@OxR#RxR#RxO@@OxB!Bx }&quot;, 
+57           &quot;@var{ o   r   g   g   b   b   g }&quot;, 
+58           &quot;@var{ @@   #   $   $   !   !   $ }&quot;, 
+59           &quot;@var{ o   r   g   g   b   b   g }&quot;, --
+60           &quot;@var{ xR#RxB!BxB!BxR#RxO@@OxR#Rx }&quot;, --25
+61           &quot;@var{                           }&quot;@} -- 
+62    --      |         1    1   |2    2
+63    --      |1   5    0    5   |0    5
+64    )
+65    
+66    @var{last} = @b{it}(@i{no}[&quot;@var{me}&quot;])   -- the last visited sensor
+67    @var{move} = @var{0}              -- the count of link moves
+68    @var{sequence} = @{@}         -- the sequence of the 4 colors that the user did choose
+69    
+70    function @var{gates}(@var{value}, @var{sender})
+71        if @var{last} ~= @var{sender} then
+72            local @var{middle} = @var{last} + (@var{sender} - @var{last})/@var{2}
+73            local @var{color} = @b{fl}(@var{middle})[&quot;@var{_color}&quot;]
+74            if @var{color} == @var{nil} then return end  -- someone cheated, avoid throwing an exception
+75            @b{st}(@i{no}[@var{color}..&quot;@var{#*}&quot;]):@b{close}()
+76            @var{sequence}[@var{move}%@var{4}] = @var{color}
+77            if @var{move} &gt;= @var{3} then
+78                @b{st}(@i{no}[@var{sequence}[(@var{move}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{1})%@var{4}]..&quot;@var{#*}&quot;]):@b{open}()
+79            end
+80            @var{move} = @var{move} + @var{1}
+81            @var{last} = @var{sender}
+82        end
+83    end
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+
+Let us concentrate on new aspects not discussed in the previous 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at ref</A>{Basic Lua Examples}.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+01    @i{wo}[&quot;@b{ConserveLevel}&quot;] = @var{false}
+02    @i{wo}[&quot;@b{FollowGrid}&quot;] = @var{false}
+03    @i{wo}[&quot;@b{FollowMethod}&quot;] = @var{FOLLOW_SCROLL}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+This level must forbid the user to resurrect a marble at the start position.
+At the same time the user should the area around the marble as complete as
+possible. Thus the scroll mode needs to be set, too. All this is done by
+setting special @ref{Global Attributes}.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+05    @i{ti}[&quot;@var{ }&quot;] = @{&quot;@b{fl-abyss_fake}&quot;@} .. @i{ti}(@{&quot;@b{st-glass1}&quot;@})
+32    @i{wo}(@i{ti}, &quot;@var{ }&quot;, @{
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+The unaccessible areas are filled with a transparent glass on top of a black
+floor as defined in line 5. The world initialization uses this tile definition
+as the default tile. This is o.k. as it contains a floor definition. Additional
+objects like the glass stone will never be set on default usage.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+07    @i{ti}[&quot;@var{!}&quot;] = @{&quot;@b{fl-rough-blue}&quot;, &quot;@var{blue#}&quot;, @var{_color}=&quot;@var{blue}&quot;@}
+08    @i{ti}[&quot;@var{@@}&quot;] = @{&quot;@b{fl-bumps}&quot;, &quot;@var{orange#}&quot;, @var{_color}=&quot;@var{orange}&quot;@}
+09    @i{ti}[&quot;@var{#}&quot;] = @{&quot;@b{fl-rough-red}&quot;, &quot;@var{red#}&quot;, @var{_color}=&quot;@var{red}&quot;@}
+10    @i{ti}[&quot;@var{$}&quot;] = @{&quot;@b{fl-leavesb}&quot;, &quot;@var{green#}&quot;, @var{_color}=&quot;@var{green}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Every floor object is autonamed for later group access purposes. Additinally
+every floor objects sets a user attribute prefixed in its name by an underscore
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{_}. This attribute stores a string that we need later on in the callback
+function.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+12    @i{ti}[&quot;@var{b}&quot;] = @i{ti}[&quot;@var{!}&quot;] .. @{&quot;@b{st-door-h-open}&quot;@}
+13    @i{ti}[&quot;@var{B}&quot;] = @i{ti}[&quot;@var{!}&quot;] .. @{&quot;@b{st-door-v-open}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+The doors are set without being named, as we will target them by their position.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+27    @i{ti}[&quot;@var{x}&quot;] = @{&quot;@b{it_sensor}&quot;, @b{invisible}=@var{true}, @b{target}=&quot;@var{gates}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+The actors moves are detected by invisible @ref{it_sensor}s that are positioned
+on any intersection. The target is the @ref{Callback Function} @samp{gates}.
+The action can be ommited as the function name is a unique target.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+66    @var{last} = @b{it}(@i{no}[&quot;@var{me}&quot;])   -- the last visited sensor
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+A Lua variable that stores the last sensor visited by the marble. This is
+initially the sensor beneath the start position of the marble. We do get the 
+marble by name, but do store the sensor item beneath it, that is an unnamed
+object.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+67    @var{move} = @var{0}              -- the count of link moves
+68    @var{sequence} = @{@}         -- the sequence of the 4 colors that the user did choose
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+These are the essential variables for our algorithm. The user is free in 
+selecting the sequence of the colored floors. We do initialize the sequence
+by an anonymous table that will be filled with the color names. An additional
+move counter will give us the current index into this table.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+70    function @var{gates}(@var{value}, @var{sender})
+71        if @var{last} ~= @var{sender} then
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+The callback function provides the sender, the @ref{it_sensor}, that caused
+the action. It is the current sensor. As the marble can return to the last
+sensor, we have to check that it is a new sensor before taking any actions.
+A simple object comparison suffices.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+72            local @var{middle} = @var{last} + (@var{sender} - @var{last})/@var{2}
+73            local @var{color} = @b{fl}(@var{middle})[&quot;@var{_color}&quot;]
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+We need to know the color of the floor strip that the marble did pass. We do
+calculate the position of the middle of this floor strip by position calculation.
+We simply take the middle position between the last and the current intersection.
+Once we have the middle position we can get the floor object and retrieve the
+private user attribute with the color description.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+74            if @var{color} == @var{nil} then return end  -- someone cheated, avoid throwing an exception
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+In regular play we are guaranteed to get a color value. But just in case a
+gamer cheats he may have moved irregular without visiting neighboring sensors.
+Just avoid errors. The gamer can not score anyway.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+75            @b{st}(@i{no}[@var{color}..&quot;@var{#*}&quot;]):@b{close}()
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Knowing the color we want to close all doors on same colored floor strips. We
+did autoname the floors by matching name prefixes. Thus we can retrieve all
+floors of a given color by concatenating the color string with the suffix 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{#*} and requesting the named object repository. As we are interested in
+the doors we do request the stone above every floor. We provide a group of
+floors and get a group of stones. Not every floor has a door on top. That does
+not matter as only existing objects are added to the resulting stone group.
+Knowing the stones we just send them all a @samp{close} message.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+76            @var{sequence}[@var{move}%@var{4}] = @var{color}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+We need to remember the sequence of colors. We just store the color name in
+the table at the index given by the move count modulo 4. Yes we could limit
+this statement to the first four moves. But who cares? The modulo operation
+is simpler than a conditional expression.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+77            if @var{move} &gt;= @var{3} then
+78                @b{st}(@i{no}[@var{sequence}[(@var{move}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at var</A>{1})%@var{4}]..&quot;@var{#*}&quot;]):@b{open}()
+79            end
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+On the first 3 moves we just do close doors and remember the color sequence.
+But starting with the 4th move we need to open the next color in sequence.
+We do retrieve the color string of the next color from the sequence table by
+a simple modulo calulation. Having the color name we do the same trick as in
+line 75. But this time we do send the @samp{open} messages to all affected doors.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+80            @var{move} = @var{move} + @var{1}
+81            @var{last} = @var{sender}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Finally we just have to increase the move count and to remember the current
+sender as the last visited sensor.
+
+That is all to code a quite complex dynamic level idea like &quot;Color Maze&quot;.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Wired -------------------- 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Wired
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at subsection</A> Wired
+You should have restarted this level several times to notice the design changes
+of the floor pattern and the border panel stones besides the dynamic wiring of
+the stones.
+
+Let us view the Lua source code part. We did add a line count in the first two
+columns for reference purpose within this section. These line count number are 
+not part of the source code itself!
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+01	  &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
+02	    &lt;el:dependency el:path=&quot;lib/libluatools&quot; el:id=&quot;lib/libluatools&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
+03	  &lt;/el:compatibility&gt;
+...
+04    @i{ti}[&quot;@var{ }&quot;] = @{&quot;@b{fl-sahara}&quot;, @b{friction} = @var{3.5}, @b{adhesion} = @var{4.0}@}
+05    @i{ti}[&quot;@var{a}&quot;] = @{&quot;@b{fl-light}&quot;, @b{friction} = @var{3.5}, @b{adhesion} = @var{4.0}@}
+06    @i{ti}[&quot;@var{b}&quot;] = @{&quot;@b{fl-white}&quot;, @b{friction} = @var{3.5}, @b{adhesion} = @var{4.0}@}
+07    @i{ti}[&quot;@var{c}&quot;] = @{&quot;@b{fl-lightgray}&quot;, @b{friction} = @var{3.5}, @b{adhesion} = @var{4.0}@}
+08    @i{ti}[&quot;@var{_}&quot;] = @{&quot;@b{fl-water}&quot;@}
+09    @i{ti}[&quot;@var{@@}&quot;] = @{&quot;#@b{ac-blackball}&quot;@}
+10    @i{ti}[&quot;@var{w}&quot;] = @{&quot;@b{st-plain_move}&quot;, &quot;@var{wood}#&quot;@}
+11    @i{ti}[&quot;@var{t}&quot;] = @{&quot;@b{it_trigger}&quot;, &quot;@var{trigger}#&quot;@}
+12    @i{ti}[&quot;@var{d}&quot;] = @{&quot;@b{st_blocker}&quot;, &quot;@var{door}#&quot;@}
+13    @i{ti}[&quot;@var{o}&quot;] = @{&quot;@b{st_oxyd}&quot;, @b{oxydcolor} = @var{OXYD_YELLOW}, @b{flavor} = &quot;@var{a}&quot;@}
+14    @i{ti}[&quot;@var{O}&quot;] = @{&quot;@b{st_oxyd}&quot;, @b{oxydcolor} = @var{OXYD_WHITE}, @b{flavor} = &quot;@var{a}&quot;@}
+15    @i{ti}[&quot;@var{1}&quot;] = @{&quot;@b{st_panel}&quot;, @b{cluster} = @var{1}@}
+16    @i{ti}[&quot;@var{2}&quot;] = @{&quot;@b{st_panel}&quot;, @b{cluster} = @var{2}@}
+17    @i{ti}[&quot;@var{S}&quot;] = @{&quot;@b{st_switch}&quot;, @b{target} = &quot;@var{easy_mode_call}&quot;@}
+18    
+19    @var{floors}  = @{@i{ti}[&quot;@var{ }&quot;], @i{ti}[&quot;@var{a}&quot;], @i{ti}[&quot;@var{b}&quot;], @i{ti}[&quot;@var{c}&quot;]@}
+20    @var{polynom} = @i{luatools}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at i</A>{random_vector}(@var{10}, @var{4})
+21    
+22    function @var{myresolver}(@var{key}, @var{x}, @var{y})
+23      if @var{key} == &quot;@var{ }&quot; then 
+24	  return @var{floors}[@i{luatools}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at i</A>{cubic_polynomial}(@var{polynom}, @var{x}, @var{y}) % (#@var{floors}) + @var{1}]
+25      elseif    (@var{key} == &quot;@var{#}&quot;)
+26            or ((@var{key} == &quot;@var{_}&quot;) and (@i{random}(@var{4}) == @var{1}))
+27            or ((@var{key} == &quot;@var{S}&quot;) and @i{wo}[&quot;@b{IsDifficult}&quot;]) then
+28        return @i{ti}[&quot;&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">.. at i</A>{random}(@var{2})]
+29      else
+30        return @i{ti}[@var{key}]
+31      end
+32    end
+33    
+34    @var{w}, @var{h} = @i{wo}(@var{myresolver}, &quot;@var{ }&quot;, @{
+35     -- 01234567890123456789
+36       &quot;@var{####################___________________}&quot;,
+37       &quot;@var{#                  #_____###o###_______}&quot;,
+38       &quot;@var{#   w   w t   t    #_____#d   d#_______}&quot;,
+39       &quot;@var{#     w   w t   t  #___### ### ###_____}&quot;,
+40       &quot;@var{#  w     t         #___#d d#_#d d#_____}&quot;,
+41       &quot;@var{#                  ##### ###_### ###___}&quot;,
+42       &quot;@var{S    w   w t @@ t        d#___#_#d d#___}&quot;,
+43       &quot;@var{#                  #######_####### #___}&quot;,
+44       &quot;@var{#  w     t         #_______O  d# # o___}&quot;,
+45       &quot;@var{#     w   w t   t  #_______### ### #___}&quot;,
+46       &quot;@var{#   w   w t   t    #_________#d   d#___}&quot;,
+47       &quot;@var{#                  #_________###O###___}&quot;,
+48       &quot;@var{####################___________________}&quot;
+49    @})
+50    
+51    @var{door_p} = @i{luatools}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at i</A>{permutation}(@var{12})
+52    @var{wire_p} = @i{luatools}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at i</A>{permutation}(@var{12})
+53    @var{woods} = @i{no}[&quot;@var{wood}#*&quot;]
+54    @var{triggers} = @i{no}[&quot;@var{trigger}#*&quot;]
+55    @var{doors} = @i{no}[&quot;@var{door}#*&quot;]
+56    
+57    for @var{j} = @var{1}, @var{12} do
+58      @var{triggers}[@var{j}]<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at b</A>{target} = @var{doors}[@var{door_p}[@var{j}]]
+59    end
+60    
+61    for @var{j} = @var{1}, @var{9} do
+62      @i{wo}:@b{add}(@{&quot;@b{ot_wire}&quot;,
+63              @b{anchor1} = @var{woods}[@var{wire_p}[@var{j} + @var{3}]],
+64              @b{anchor2} = @var{woods}[@var{wire_p}[@var{j}%@var{3} + @var{1}]]@})
+65      @i{wo}:@b{add}(@{&quot;@b{ot_wire}&quot;, @b{name} = &quot;@var{obsolete_wire}#&quot;,
+66              @b{anchor1} = @var{woods}[@var{wire_p}[@var{j} + @var{3}]],
+67              @b{anchor2} = @var{woods}[@var{wire_p}[@var{j}%@var{9} + @var{4}]]@})
+68    end
+69    
+70    function @var{easy_mode_call}(@var{is_on}, @var{sender})
+71      if @var{is_on} then
+72        @i{no}[&quot;@var{obsolete_wire}#*&quot;]:@b{kill}()
+73      else
+74        for @var{j} = @var{1}, @var{9} do
+75          @i{wo}:@b{add}(@{&quot;@b{ot_wire}&quot;, @b{name} = &quot;@var{obsolete_wire}#&quot;,
+76             	  @b{anchor1} = @var{woods}[@var{wire_p}[@var{j} + @var{3}]],
+77                @b{anchor2} = @var{woods}[@var{wire_p}[@var{j}%@var{9} + @var{4}]]@})
+78        end
+79      end
+80    end
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+How is this versatility in design and action achieved as the last lines 69 to
+79 obviously deal just with the easy mode diffs? Let us analyse the lines
+that do the real work.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+01	  &lt;el:compatibility el:enigma=&quot;1.10&quot;&gt;
+02	    &lt;el:dependency el:path=&quot;lib/libluatools&quot; el:id=&quot;lib/libluatools&quot; el:release=&quot;1&quot; el:preload=&quot;true&quot;/&gt;
+03	  &lt;/el:compatibility&gt;
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+We make use of some functions of the luatools library. Thus we need to preload it, 
+besides declaration of compatibility to Enigma 1.10.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+04    @i{ti}[&quot;@var{ }&quot;] = @{&quot;@b{fl-sahara}&quot;, @b{friction} = @var{3.5}, @b{adhesion} = @var{4.0}@}
+05    @i{ti}[&quot;@var{a}&quot;] = @{&quot;@b{fl-light}&quot;, @b{friction} = @var{3.5}, @b{adhesion} = @var{4.0}@}
+06    @i{ti}[&quot;@var{b}&quot;] = @{&quot;@b{fl-white}&quot;, @b{friction} = @var{3.5}, @b{adhesion} = @var{4.0}@}
+07    @i{ti}[&quot;@var{c}&quot;] = @{&quot;@b{fl-lightgray}&quot;, @b{friction} = @var{3.5}, @b{adhesion} = @var{4.0}@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Four floor types that the dynamic floor is composed of. They all are unified
+in the @samp{friction} and @samp{adhesion} to provide smooth movement on the
+stylish floor.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+10    @i{ti}[&quot;@var{w}&quot;] = @{&quot;@b{st-plain_move}&quot;, &quot;@var{wood}#&quot;@}
+11    @i{ti}[&quot;@var{t}&quot;] = @{&quot;@b{it_trigger}&quot;, &quot;@var{trigger}#&quot;@}
+12    @i{ti}[&quot;@var{d}&quot;] = @{&quot;@b{st_blocker}&quot;, &quot;@var{door}#&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+The movable stone that will be wired, the target triggers and the doors to be
+opened. All are autonamed for group retrieval from the named object repository.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+13    @i{ti}[&quot;@var{o}&quot;] = @{&quot;@b{st_oxyd}&quot;, @b{oxydcolor} = @var{OXYD_YELLOW}, @b{flavor} = &quot;@var{a}&quot;@}
+14    @i{ti}[&quot;@var{O}&quot;] = @{&quot;@b{st_oxyd}&quot;, @b{oxydcolor} = @var{OXYD_WHITE}, @b{flavor} = &quot;@var{a}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+A minor design aspect: selecting two unique colors for the @ref{st_oxyd}s.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+15    @i{ti}[&quot;@var{1}&quot;] = @{&quot;@b{st_panel}&quot;, @b{cluster} = @var{1}@}
+16    @i{ti}[&quot;@var{2}&quot;] = @{&quot;@b{st_panel}&quot;, @b{cluster} = @var{2}@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+The base of the prominent all time different looking @ref{st_panel} boarder 
+design. Two tiles with panel stones assigned to two different clusters. The
+engine will automatically join all neighboring stones of the same cluster to
+big unified blocks. Now we just need to assign these tiles to the different 
+grid positions.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+17    @i{ti}[&quot;@var{S}&quot;] = @{&quot;@b{st_switch}&quot;, @b{target} = &quot;@var{easy_mode_call}&quot;@}
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+The left boarder switch that will just be used in easy mode. It is blocked in
+line 27 to not appear in the regular mode. The target is the callback function
+of lines 71 to 81.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+19    @var{floors}  = @{@i{ti}[&quot;@var{ }&quot;], @i{ti}[&quot;@var{a}&quot;], @i{ti}[&quot;@var{b}&quot;], @i{ti}[&quot;@var{c}&quot;]@}
+20    @var{polynom} = @i{luatools}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at i</A>{random_vector}(@var{10}, @var{4})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Preparations for the floor design. The four floor tiles are stored in a table
+for number based index access. Ten random numbers in the range 1 to 4 are
+stored in a table, which we will use as polynom coefficients later on.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+22    function @var{myresolver}(@var{key}, @var{x}, @var{y})
+34    @var{w}, @var{h} = @i{wo}(@var{myresolver}, &quot;@var{ }&quot;, @{
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Up to now we did look up the keys used in the map from our tiles repository
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{ti} that was the first argument of the world initialization call. But
+now we use a @ref{Custom Resolver} (@pxref{World Creation and Resolver Chaining}).
+The function starting in line 22 is called on every tile to be resolved. It has
+the task of delivering the appropriate tile.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+23      if @var{key} == &quot;@var{ }&quot; then 
+24	  return @var{floors}[@i{luatools}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at i</A>{cubic_polynomial}(@var{polynom}, @var{x}, @var{y}) % (#@var{floors}) + @var{1}]
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+These two lines generate the always changing floor design. For every map key
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{ } we calculate the cubic polynomial that is randomized due to the
+coefficients. The resulting number is limited to the number of our four floors.
+This number is taken as the index into our @samp{floors} table and the resulting
+tile definition is returned.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+25      elseif    (@var{key} == &quot;@var{#}&quot;)
+26            or ((@var{key} == &quot;@var{_}&quot;) and (@i{random}(@var{4}) == @var{1}))
+27            or ((@var{key} == &quot;@var{S}&quot;) and @i{wo}[&quot;@b{IsDifficult}&quot;]) then
+28        return @i{ti}[&quot;&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">.. at i</A>{random}(@var{2})]
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+And now we cluster the boarder panels. First we need to decide where to put
+panels at all. The positions marked @samp{#} in the map are for sure. 
+Additionally we choose randomly every 4th @samp{_} postition to be a panel 
+instead of being a water floor. Finally we replace just in difficult mode
+the switch marked as @samp{S} by a panel stone. Now we need to assign to this
+grid position one of the two panel cluster tiles. We simply generate a random
+number out of 1 and 2. But we do need a string as the tiles key. We force Lua
+to convert the number to string by concatenating an empty string @samp{&quot;&quot;} with
+the random number. Choosing the right panel variants to build up closed clusters
+is done by the enginge.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+29      else
+30        return @i{ti}[@var{key}]
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Finally for all other keys that need no special treatment we just take the
+tile definition as stored in the tiles repository.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+34    @var{w}, @var{h} = @i{wo}(@var{myresolver}, &quot;@var{ }&quot;, @{
+35     -- 01234567890123456789
+36       &quot;@var{####################___________________}&quot;,
+37       &quot;@var{#                  #_____###o###_______}&quot;,
+38       &quot;@var{#   w   w t   t    #_____#d   d#_______}&quot;,
+39       &quot;@var{#     w   w t   t  #___### ### ###_____}&quot;,
+...
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+The map uses the keys as interpreted by the custom resolver. Thus all mandatory
+panel stones are marked by @samp{#} and all may be water by @samp{_}. All spaces
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{ } do not stand for the sahara floor definition in the tiles repository,
+but are floor positions for our design floor set up in the custom resolver.
+Note that even the @samp{w} marked tiles will set a design floor, as the
+default floor is @samp{ }, too.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+51    @var{door_p} = @i{luatools}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at i</A>{permutation}(@var{12})
+52    @var{wire_p} = @i{luatools}<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at i</A>{permutation}(@var{12})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Now let us shuffle the trigger/door assignment and the wire distribution. We
+do this by permutating 12 index numbers to be used for door and wire access.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+53    @var{woods} = @i{no}[&quot;@var{wood}#*&quot;]
+54    @var{triggers} = @i{no}[&quot;@var{trigger}#*&quot;]
+55    @var{doors} = @i{no}[&quot;@var{door}#*&quot;]
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Get the groups of movable stones, triggers and doors. It is essential to do this
+once and to store the resulting groups as we want to index the group members.
+Repeated access to the named object repository does not guarantee a stable
+sorting of the result groups. Thus we operate on the stable onece retrieved
+and stored groups. 
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+57    for @var{j} = @var{1}, @var{12} do
+58      @var{triggers}[@var{j}]<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">. at b</A>{target} = @var{doors}[@var{door_p}[@var{j}]]
+59    end
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+A random assignment of the triggers to the doors. Every triggers gets a random
+indexed member of the door group as target. Note the alternative attribute
+member access on the trigger. Instead of embracing the attributes name in 
+square brackets and quoting the string constant as @samp{[&quot;target&quot;]} the
+author did prefer to write @samp{.target}. That is a legal Lua alternative
+statement as long as the attribute's name is a legal Lua name (@pxref{Caveats}).
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+61    for @var{j} = @var{1}, @var{9} do
+62      @i{wo}:@b{add}(@{&quot;@b{ot_wire}&quot;,
+63              @b{anchor1} = @var{woods}[@var{wire_p}[@var{j} + @var{3}]],
+64              @b{anchor2} = @var{woods}[@var{wire_p}[@var{j}%@var{3} + @var{1}]]@})
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Finally we need to add the @ref{ot_wire} between our movable stones. This can
+not be done within the map. We need to use the @ref{World Advanced Method} 
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at samp</A>{wo:add()}, which takes the two connected stones as two anchor attributes.
+We select the first 3 stones of our wood group as stones to be connected with
+3 other stones of the indices 4 to 12. Thus we take in every loop as the first
+anchor one of the stones 4 to 12 and connect it to one of the first 3 stones by
+a simple modulo operation. The first three stones now have three wires and are
+finished. The last 9 stones have just one wire.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+65      @i{wo}:@b{add}(@{&quot;@b{ot_wire}&quot;, @b{name} = &quot;@var{obsolete_wire}#&quot;,
+66              @b{anchor1} = @var{woods}[@var{wire_p}[@var{j} + @var{3}]],
+67              @b{anchor2} = @var{woods}[@var{wire_p}[@var{j}%@var{9} + @var{4}]]@})
+68    end
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Now we wire these remaining 9 stones in sequence, in a closed circle. That gives
+each stone 2 additinal wires. We do this by connecting each of the stones 4 to
+11 with is successor and finally connecting stone 12 to stone 4, what is done
+by the modulo operation. This completes the level for the regular mode.
+As prepartion for the easy mode we do autoname these additional wires.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+71    function @var{easy_mode_call}(@var{is_on}, @var{sender})
+72      if @var{is_on} then
+73        @i{no}[&quot;@var{obsolete_wire}#*&quot;]:@b{kill}()
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+Just for the easy mode we added a switch to remove and recreate the additional
+wires. As we named these obsolete wires we can simply kill all of them in a
+single call by applying the @samp{kill()} method to the group of these wires.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at example</A>
+73      else
+74        for @var{j} = @var{1}, @var{9} do
+75          @i{wo}:@b{add}(@{&quot;@b{ot_wire}&quot;, @b{name} = &quot;@var{obsolete_wire}#&quot;,
+76             	  @b{anchor1} = @var{woods}[@var{wire_p}[@var{j} + @var{3}]],
+77                @b{anchor2} = @var{woods}[@var{wire_p}[@var{j}%@var{9} + @var{4}]]@})
+78        end
+79      end
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at end</A> example
+When the user switches off again, the wires should be recreated. That is done
+by the same code as lines 65 to 68. Note that is essential that we stored and
+kept the used wire permutation in the variable @samp{wire_p}.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Position -------------------- 
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Position
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> Position
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Object -------------------- 
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Object
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> Object
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Group -------------------- 
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Group
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> Group
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- NamedObjects -------------------- 
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> NamedObjects
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> NamedObjects
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Tile -------------------- 
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Tile
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> Tile
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- Tiles -------------------- 
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> Tiles
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> Tiles
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at c</A> ----------------- World -------------------- 
+
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at node</A> World
<A HREF="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">+ at section</A> World
+
 @c ----------------- World Creation and Resolver Chaining -------------------- 
 
 @node World Creation and Resolver Chaining


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000683.html">[Enigma-game-svn] r1249 - in trunk: lib-src/oxydlib src
</A></li>
	<LI>Next message: <A HREF="000685.html">[Enigma-game-svn] r1251 - trunk/doc/reference
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#684">[ date ]</a>
              <a href="thread.html#684">[ thread ]</a>
              <a href="subject.html#684">[ subject ]</a>
              <a href="author.html#684">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
