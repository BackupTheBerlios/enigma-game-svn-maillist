<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Enigma-game-svn] r1115 - in trunk: data/gfx/flags25x15 src/gui
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/enigma-game-svn/2008-April/index.html" >
   <LINK REL="made" HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1115%20-%20in%20trunk%3A%20data/gfx/flags25x15%20src/gui&In-Reply-To=%3C200804290013.m3T0Dr0Q022738%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000547.html">
   <LINK REL="Next"  HREF="000549.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Enigma-game-svn] r1115 - in trunk: data/gfx/flags25x15 src/gui</H1>
    <B>andreasl at BerliOS</B> 
    <A HREF="mailto:enigma-game-svn%40lists.berlios.de?Subject=Re%3A%20%5BEnigma-game-svn%5D%20r1115%20-%20in%20trunk%3A%20data/gfx/flags25x15%20src/gui&In-Reply-To=%3C200804290013.m3T0Dr0Q022738%40sheep.berlios.de%3E"
       TITLE="[Enigma-game-svn] r1115 - in trunk: data/gfx/flags25x15 src/gui">andreasl at mail.berlios.de
       </A><BR>
    <I>Tue Apr 29 02:13:53 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000547.html">[Enigma-game-svn] r1114 - in trunk: data/gfx/flags25x15	data/music/menu data/schemas src src/gui
</A></li>
        <LI>Next message: <A HREF="000549.html">[Enigma-game-svn] r1116 - in trunk: data data/schemas src src/stones
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#548">[ date ]</a>
              <a href="thread.html#548">[ thread ]</a>
              <a href="subject.html#548">[ subject ]</a>
              <a href="author.html#548">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: andreasl
Date: 2008-04-29 02:13:52 +0200 (Tue, 29 Apr 2008)
New Revision: 1115

Added:
   trunk/data/gfx/flags25x15/de-shaded.png
   trunk/data/gfx/flags25x15/es-shaded.png
   trunk/data/gfx/flags25x15/fi-shaded.png
   trunk/data/gfx/flags25x15/fr-shaded.png
   trunk/data/gfx/flags25x15/gb-shaded.png
   trunk/data/gfx/flags25x15/hu-shaded.png
   trunk/data/gfx/flags25x15/it-shaded.png
   trunk/data/gfx/flags25x15/nl-shaded.png
   trunk/data/gfx/flags25x15/pt-shaded.png
   trunk/data/gfx/flags25x15/ru-shaded.png
   trunk/data/gfx/flags25x15/se-shaded.png
Modified:
   trunk/src/gui/MainMenu.cc
   trunk/src/gui/OptionsMenu.cc
   trunk/src/gui/widgets.cc
   trunk/src/gui/widgets.hh
Log:
Options menu restructuring:
 - Language flag buttons:
    - now own widget (RenderlessImageButton)
    - flags are shaded when not used
    - Removed default language button.
    - Shifted Enigma logo and main menu down to make
      place for the language buttons.
 - Hopefully fixed options menu translation bug.


Added: trunk/data/gfx/flags25x15/de-shaded.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/de-shaded.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx/flags25x15/es-shaded.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/es-shaded.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx/flags25x15/fi-shaded.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/fi-shaded.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx/flags25x15/fr-shaded.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/fr-shaded.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx/flags25x15/gb-shaded.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/gb-shaded.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx/flags25x15/hu-shaded.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/hu-shaded.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx/flags25x15/it-shaded.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/it-shaded.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx/flags25x15/nl-shaded.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/nl-shaded.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx/flags25x15/pt-shaded.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/pt-shaded.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx/flags25x15/ru-shaded.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/ru-shaded.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/gfx/flags25x15/se-shaded.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/gfx/flags25x15/se-shaded.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/src/gui/MainMenu.cc
===================================================================
--- trunk/src/gui/MainMenu.cc	2008-04-27 22:27:43 UTC (rev 1114)
+++ trunk/src/gui/MainMenu.cc	2008-04-29 00:13:52 UTC (rev 1115)
@@ -212,27 +212,34 @@
     {
         const video::VMInfo *vminfo = video::GetInfo();
         const int vshrink = vminfo-&gt;width &lt; 640 ? 1 : 0;
-        int y[] = {75, 150, 170, 200, 200};
+        int y[] = {75, 170, 190, 220, 220};
+        // parameters to use when flags are not at top: {75, 150, 170, 200, 200};
+#ifdef ENABLE_EXPERIMENTAL
+        y[1] = 150;
+#endif
         BuildVList b(this, Rect((vminfo-&gt;width - 150)/2, y[vminfo-&gt;tt], 150, vshrink?20:40), 5);
         m_startgame = b.add(new StaticTextButton(N_(&quot;Start Game&quot;), this));
         m_levelpack = b.add(new StaticTextButton(N_(&quot;Level Pack&quot;), this));
 #ifdef ENABLE_EXPERIMENTAL
-        m_netgame   = b.add (new StaticTextButton (N_(&quot;Network Game&quot;), this));
+        m_netgame   = b.add(new StaticTextButton(N_(&quot;Network Game&quot;), this));
         leveled     = b.add(new StaticTextButton(N_(&quot;Editor&quot;), this));
 #endif
         options     = b.add(new StaticTextButton(N_(&quot;Options&quot;), this));
         credits     = b.add(new StaticTextButton(N_(&quot;Credits&quot;), this));
         quit        = b.add(new StaticTextButton(N_(&quot;Quit&quot;), this));
-        int ly = vminfo-&gt;width - 5 - 35*NUMENTRIES(nls::languages);
+        int ly = vminfo-&gt;width - 5 - 35*(NUMENTRIES(nls::languages) - 1);
         //BuildHList l(this, Rect(ly, (vminfo-&gt;height) - 30, 30, 20), 5);
         BuildHList l(this, Rect(ly, 10, 30, 20), 5);
         //BuildVList l(this, Rect(vminfo-&gt;width - 45, 15, 30, 20), 5);
         language.clear();
         if(!vshrink)
-            for (size_t i=0; i&lt;NUMENTRIES(nls::languages); ++i)
-                language.push_back(l.add(
-                    new ImageButton(nls::languages[i].flagimage,
-                                    nls::languages[i].flagimage, this)));
+            for (size_t i=1; i&lt;NUMENTRIES(nls::languages); ++i) {
+                BorderlessImageButton *but = new BorderlessImageButton(
+                    nls::languages[i].flagimage + string(&quot;-shaded&quot;),
+                    nls::languages[i].flagimage,
+                    nls::languages[i].flagimage, this);
+                language.push_back(l.add(but));
+            }
     }
     
     void MainMenu::draw_background(ecl::GC &amp;gc) 
@@ -247,7 +254,11 @@
         Font *f = enigma::GetFont(&quot;levelmenu&quot;);
         Surface * logo(enigma::GetImage(&quot;enigma_logo3&quot;));
         int x0=(vminfo-&gt;width - logo-&gt;width())/2;
-        int y0[] = {0, 30, 40, 50, 60};
+        int y0[] = {0, 50, 60, 70, 80};
+        // parameters to use when flags are not at top: {0, 30, 40, 50, 60};
+#ifdef ENABLE_EXPERIMENTAL
+        y0[1] = 30;
+#endif
         blit(gc, x0, y0[vminfo-&gt;tt], logo);
         f-&gt;render (gc, 5, vminfo-&gt;height - 20, app.getVersionInfo().c_str());
     }
@@ -291,8 +302,8 @@
         } else if (w == quit) {
             Menu::quit();
         } else if (language.size() &gt; 0) {
-            for (size_t i=0; i&lt;NUMENTRIES(nls::languages); ++i)
-                if (w == language[i]) {
+            for (size_t i=1; i&lt;NUMENTRIES(nls::languages); ++i)
+                if (w == language[i-1]) {
                     options::SetOption (&quot;Language&quot;, nls::languages[i].localename);
                     app.setLanguage(nls::languages[i].localename);
                 }

Modified: trunk/src/gui/OptionsMenu.cc
===================================================================
--- trunk/src/gui/OptionsMenu.cc	2008-04-27 22:27:43 UTC (rev 1114)
+++ trunk/src/gui/OptionsMenu.cc	2008-04-29 00:13:52 UTC (rev 1115)
@@ -462,14 +462,14 @@
         lb-&gt;set_spacing(param[vtt].hoption_option); \
         lb-&gt;set_alignment(HALIGN_LEFT, VALIGN_TOP); \
         lb-&gt;set_default_size(param[vtt].optionb_width, param[vtt].button_height); \
-        lb-&gt;add_back(new Label(N_(label), HALIGN_LEFT, VALIGN_BOTTOM)); \
+        lb-&gt;add_back(new Label(label, HALIGN_LEFT, VALIGN_BOTTOM)); \
         optionsVList-&gt;add_back(lb); \
 // end define
 #define OPTIONS_NEW_LB(label,button) lb = new HList;\
         lb-&gt;set_spacing(param[vtt].hoption_option); \
         lb-&gt;set_alignment(HALIGN_CENTER, VALIGN_TOP); \
         lb-&gt;set_default_size(param[vtt].optionb_width, param[vtt].button_height); \
-        lb-&gt;add_back(new Label(N_(label), HALIGN_RIGHT, VALIGN_CENTER)); \
+        lb-&gt;add_back(new Label(label, HALIGN_RIGHT, VALIGN_CENTER)); \
         lb-&gt;add_back(button); \
         optionsVList-&gt;add_back(lb); \
 // end define
@@ -484,50 +484,50 @@
 
         switch (new_page) {
             case OPTIONS_MAIN:
-                OPTIONS_NEW_LB(&quot;Language: &quot;, language = new LanguageButton(this))
-                OPTIONS_NEW_LB(&quot;Fullscreen: &quot;, fullscreen = new FullscreenButton(this))
-                OPTIONS_NEW_LB(&quot;Video mode: &quot;, videomode = new VideoModeButton())
-                OPTIONS_NEW_LB(&quot;Mouse speed: &quot;, new MouseSpeedButton())
-                OPTIONS_NEW_LB(&quot;Sound volume: &quot;, new SoundVolumeButton())
-                OPTIONS_NEW_LB(&quot;Music volume: &quot;, new MusicVolumeButton())
-                OPTIONS_NEW_LB(&quot;Ratings update: &quot;, new RatingsUpdateButton())
+                OPTIONS_NEW_LB(N_(&quot;Language: &quot;), language = new LanguageButton(this))
+                OPTIONS_NEW_LB(N_(&quot;Fullscreen: &quot;), fullscreen = new FullscreenButton(this))
+                OPTIONS_NEW_LB(N_(&quot;Video mode: &quot;), videomode = new VideoModeButton())
+                OPTIONS_NEW_LB(N_(&quot;Mouse speed: &quot;), new MouseSpeedButton())
+                OPTIONS_NEW_LB(N_(&quot;Sound volume: &quot;), new SoundVolumeButton())
+                OPTIONS_NEW_LB(N_(&quot;Music volume: &quot;), new MusicVolumeButton())
+                OPTIONS_NEW_LB(N_(&quot;Ratings update: &quot;), new RatingsUpdateButton())
                 userNameTF = new TextField(app.state-&gt;getString(&quot;UserName&quot;));
                 userNameTF-&gt;setMaxChars(20);
                 userNameTF-&gt;setInvalidChars(&quot;+&quot;);
-                OPTIONS_NEW_L(&quot;User name: &quot;)
+                OPTIONS_NEW_L(N_(&quot;User name: &quot;))
                 OPTIONS_NEW_T(userNameTF)
                 break;
             case OPTIONS_VIDEO:
-                OPTIONS_NEW_LB(&quot;Fullscreen: &quot;, fullscreen = new FullscreenButton())
+                OPTIONS_NEW_LB(N_(&quot;Fullscreen: &quot;), fullscreen = new FullscreenButton())
                 fullscreen-&gt;set_listener(this);
-                OPTIONS_NEW_LB(&quot;Video mode: &quot;, videomode = new VideoModeButton())
-                OPTIONS_NEW_LB(&quot;Gamma correction: &quot;, new GammaButton())
+                OPTIONS_NEW_LB(N_(&quot;Video mode: &quot;), videomode = new VideoModeButton())
+                OPTIONS_NEW_LB(N_(&quot;Gamma correction: &quot;), new GammaButton())
                 break;
             case OPTIONS_AUDIO:
-                OPTIONS_NEW_LB(&quot;Sound set: &quot;, new SoundSetButton())
-                OPTIONS_NEW_LB(&quot;Menu music: &quot;, new MenuMusicButton)
-                OPTIONS_NEW_LB(&quot;Sound volume: &quot;, new SoundVolumeButton())
-                OPTIONS_NEW_LB(&quot;Music volume: &quot;, new MusicVolumeButton())
-                OPTIONS_NEW_LB(&quot;Stereo: &quot;, new StereoButton())
+                OPTIONS_NEW_LB(N_(&quot;Sound set: &quot;), new SoundSetButton())
+                OPTIONS_NEW_LB(N_(&quot;Menu music: &quot;), new MenuMusicButton)
+                OPTIONS_NEW_LB(N_(&quot;Sound volume: &quot;), new SoundVolumeButton())
+                OPTIONS_NEW_LB(N_(&quot;Music volume: &quot;), new MusicVolumeButton())
+                OPTIONS_NEW_LB(N_(&quot;Stereo: &quot;), new StereoButton())
                 //...(&quot;Music ingame: &quot;, new InGameMusicButton)
                 break;
             case OPTIONS_CONFIG:
-                OPTIONS_NEW_LB(&quot;Language: &quot;, language = new LanguageButton(this))
-                OPTIONS_NEW_LB(&quot;Mouse speed: &quot;, new MouseSpeedButton())
-                OPTIONS_NEW_LB(&quot;Text speed: &quot;, new TextSpeedButton())
-                OPTIONS_NEW_LB(&quot;Ratings update: &quot;, new RatingsUpdateButton())
+                OPTIONS_NEW_LB(N_(&quot;Language: &quot;), language = new LanguageButton(this))
+                OPTIONS_NEW_LB(N_(&quot;Mouse speed: &quot;), new MouseSpeedButton())
+                OPTIONS_NEW_LB(N_(&quot;Text speed: &quot;), new TextSpeedButton())
+                OPTIONS_NEW_LB(N_(&quot;Ratings update: &quot;), new RatingsUpdateButton())
                 userNameTF = new TextField(app.state-&gt;getString(&quot;UserName&quot;));
                 userNameTF-&gt;setMaxChars(20);
                 userNameTF-&gt;setInvalidChars(&quot;+&quot;);
-                OPTIONS_NEW_L(&quot;User name: &quot;)
+                OPTIONS_NEW_L(N_(&quot;User name: &quot;))
                 OPTIONS_NEW_T(userNameTF)
                 break;
             case OPTIONS_PATHS:
                 userPathTF = new TextField(XMLtoUtf8(LocalToXML(app.userPath.c_str()).x_str()).c_str());
-                OPTIONS_NEW_L(&quot;User path: &quot;)
+                OPTIONS_NEW_L(N_(&quot;User path: &quot;))
                 OPTIONS_NEW_T(userPathTF)
                 userImagePathTF = new TextField(XMLtoUtf8(LocalToXML(app.userImagePath.c_str()).x_str()).c_str());
-                OPTIONS_NEW_L(&quot;User image path: &quot;)
+                OPTIONS_NEW_L(N_(&quot;User image path: &quot;))
                 OPTIONS_NEW_T(userImagePathTF)
                 break;
         }

Modified: trunk/src/gui/widgets.cc
===================================================================
--- trunk/src/gui/widgets.cc	2008-04-27 22:27:43 UTC (rev 1114)
+++ trunk/src/gui/widgets.cc	2008-04-29 00:13:52 UTC (rev 1115)
@@ -606,7 +606,9 @@
 
 /* -------------------- Button -------------------- */
 
-Button::Button() : m_activep (false), highlight (false) {
+Button::Button()
+: m_activep (false), highlight (false)
+{
 }
 
 void Button::activate() 
@@ -632,7 +634,7 @@
 void Button::draw(ecl::GC &amp;gc, const ecl::Rect &amp;r) {
     const int borderw = 4;
 
-    ecl::Surface *s = enigma::GetImage (m_activep ? &quot;buttonhl&quot; : &quot;button&quot;);
+    ecl::Surface *s = enigma::GetImage(m_activep ? &quot;buttonhl&quot; : &quot;button&quot;);
 
     if (s) {                    // Ugly, but hey, it works
         Rect srcrect (0,0,borderw, borderw);
@@ -941,3 +943,32 @@
         blit(gc, x, y, s);
     }
 }
+
+/* -------------------- BorderlessImageButton -------------------- */
+
+BorderlessImageButton::BorderlessImageButton(const string &amp;unselected,
+    const string &amp;selected, const string &amp;mouseover, ActionListener *al)
+: fname_sel(selected), fname_unsel(unselected), fname_mouse(mouseover)
+{
+    set_listener(al);
+}
+
+void BorderlessImageButton::set_images(const string &amp;unselected,
+                                       const string &amp;selected, const string &amp;mouseover) {
+    fname_sel = selected;
+    fname_unsel = unselected;
+    fname_mouse = mouseover;
+}
+
+void BorderlessImageButton::draw(ecl::GC &amp;gc, const ecl::Rect &amp;r) {
+    string &amp;fname = m_activep ? fname_mouse : (is_pressed() ? fname_sel : fname_unsel);
+
+    if (Surface *s = enigma::GetImage(fname.c_str())) {
+        int w=s-&gt;width();
+        int h=s-&gt;height();
+        int x = get_x() + (get_w()-w)/2;
+        int y = get_y() + (get_h()-h)/2;
+        blit(gc, x, y, s);
+    }
+}
+

Modified: trunk/src/gui/widgets.hh
===================================================================
--- trunk/src/gui/widgets.hh	2008-04-27 22:27:43 UTC (rev 1114)
+++ trunk/src/gui/widgets.hh	2008-04-29 00:13:52 UTC (rev 1115)
@@ -333,7 +333,7 @@
         bool isHighlight();
     protected:
         Button();
-
+        
         // Widget interface.
         void draw(ecl::GC &amp;gc, const ecl::Rect &amp;r);
         void activate();
@@ -465,5 +465,22 @@
         std::string fname_sel, fname_unsel;
     };
 
+
+    /* -------------------- BorderlessImageButton -------------------- */
+
+    class BorderlessImageButton : public PushButton {
+    public:
+        BorderlessImageButton(const std::string &amp;unselected,
+                              const std::string &amp;selected,
+                              const std::string &amp;mouseover,
+                              ActionListener    *al = 0);
+        void set_images(const std::string &amp;unselected, const std::string &amp;selected,
+                        const std::string &amp;mouseover);
+        // Widget interface.
+        virtual void draw(ecl::GC &amp;gc, const ecl::Rect &amp;r);
+    private:
+        std::string fname_sel, fname_unsel, fname_mouse;
+    };
+
 }} // namespace enigma::gui
 #endif


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000547.html">[Enigma-game-svn] r1114 - in trunk: data/gfx/flags25x15	data/music/menu data/schemas src src/gui
</A></li>
	<LI>Next message: <A HREF="000549.html">[Enigma-game-svn] r1116 - in trunk: data data/schemas src src/stones
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#548">[ date ]</a>
              <a href="thread.html#548">[ thread ]</a>
              <a href="subject.html#548">[ subject ]</a>
              <a href="author.html#548">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/enigma-game-svn">More information about the Enigma-game-svn
mailing list</a><br>
</body></html>
